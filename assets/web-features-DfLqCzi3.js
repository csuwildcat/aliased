var Qo=Object.defineProperty;var No=$t=>{throw TypeError($t)};var Xo=($t,e,_t)=>e in $t?Qo($t,e,{enumerable:!0,configurable:!0,writable:!0,value:_t}):$t[e]=_t;var sn=($t,e,_t)=>Xo($t,typeof e!="symbol"?e+"":e,_t),Io=($t,e,_t)=>e.has($t)||No("Cannot "+_t);var Zr=($t,e,_t)=>(Io($t,e,"read from private field"),_t?_t.call($t):e.get($t)),zn=($t,e,_t)=>e.has($t)?No("Cannot add the same private member more than once"):e instanceof WeakSet?e.add($t):e.set($t,_t),Pn=($t,e,_t,At)=>(Io($t,e,"write to private field"),At?At.call($t,_t):e.set($t,_t),_t),$n=($t,e,_t)=>(Io($t,e,"access private method"),_t);var _o=($t,e,_t,At)=>({set _(xt){Pn($t,e,xt,_t)},get _(){return Zr($t,e,At)}});var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function getDefaultExportFromCjs($t){return $t&&$t.__esModule&&Object.prototype.hasOwnProperty.call($t,"default")?$t.default:$t}function getAugmentedNamespace($t){if($t.__esModule)return $t;var e=$t.default;if(typeof e=="function"){var _t=function At(){return this instanceof At?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};_t.prototype=e.prototype}else _t={};return Object.defineProperty(_t,"__esModule",{value:!0}),Object.keys($t).forEach(function(At){var xt=Object.getOwnPropertyDescriptor($t,At);Object.defineProperty(_t,At,xt.get?xt:{enumerable:!0,get:function(){return $t[At]}})}),_t}var freeGlobal$1=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$1=freeGlobal||freeSelf||Function("return this")(),_root=root$1,root=_root,Symbol$a=root.Symbol,_Symbol=Symbol$a,Symbol$9=_Symbol,objectProto$2=Object.prototype,hasOwnProperty$3=objectProto$2.hasOwnProperty,nativeObjectToString$1=objectProto$2.toString,symToStringTag$1=Symbol$9?Symbol$9.toStringTag:void 0;function getRawTag$1($t){var e=hasOwnProperty$3.call($t,symToStringTag$1),_t=$t[symToStringTag$1];try{$t[symToStringTag$1]=void 0;var At=!0}catch{}var xt=nativeObjectToString$1.call($t);return At&&(e?$t[symToStringTag$1]=_t:delete $t[symToStringTag$1]),xt}var _getRawTag=getRawTag$1,objectProto$1=Object.prototype,nativeObjectToString=objectProto$1.toString;function objectToString$3($t){return nativeObjectToString.call($t)}var _objectToString=objectToString$3,Symbol$8=_Symbol,getRawTag=_getRawTag,objectToString$2=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$8?Symbol$8.toStringTag:void 0;function baseGetTag$1($t){return $t==null?$t===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object($t)?getRawTag($t):objectToString$2($t)}var _baseGetTag=baseGetTag$1;function overArg$1($t,e){return function(_t){return $t(e(_t))}}var _overArg=overArg$1,overArg=_overArg,getPrototype$1=overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype$1;function isObjectLike$1($t){return $t!=null&&typeof $t=="object"}var isObjectLike_1=isObjectLike$1,baseGetTag=_baseGetTag,getPrototype=_getPrototype,isObjectLike=isObjectLike_1,objectTag="[object Object]",funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$2=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject($t){if(!isObjectLike($t)||baseGetTag($t)!=objectTag)return!1;var e=getPrototype($t);if(e===null)return!0;var _t=hasOwnProperty$2.call(e,"constructor")&&e.constructor;return typeof _t=="function"&&_t instanceof _t&&funcToString.call(_t)==objectCtorString}var isPlainObject_1=isPlainObject;const isPlainObject$1=getDefaultExportFromCjs(isPlainObject_1);function base$5($t,e){if($t.length>=255)throw new TypeError("Alphabet too long");for(var _t=new Uint8Array(256),At=0;At<_t.length;At++)_t[At]=255;for(var xt=0;xt<$t.length;xt++){var kt=$t.charAt(xt),Bt=kt.charCodeAt(0);if(_t[Bt]!==255)throw new TypeError(kt+" is ambiguous");_t[Bt]=xt}var Nt=$t.length,Ut=$t.charAt(0),Lt=Math.log(Nt)/Math.log(256),jt=Math.log(256)/Math.log(Nt);function Kt(Vt){if(Vt instanceof Uint8Array||(ArrayBuffer.isView(Vt)?Vt=new Uint8Array(Vt.buffer,Vt.byteOffset,Vt.byteLength):Array.isArray(Vt)&&(Vt=Uint8Array.from(Vt))),!(Vt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Vt.length===0)return"";for(var Ht=0,Wt=0,Qt=0,Xt=Vt.length;Qt!==Xt&&Vt[Qt]===0;)Qt++,Ht++;for(var Jt=(Xt-Qt)*jt+1>>>0,tr=new Uint8Array(Jt);Qt!==Xt;){for(var dr=Vt[Qt],vr=0,$r=Jt-1;(dr!==0||vr<Wt)&&$r!==-1;$r--,vr++)dr+=256*tr[$r]>>>0,tr[$r]=dr%Nt>>>0,dr=dr/Nt>>>0;if(dr!==0)throw new Error("Non-zero carry");Wt=vr,Qt++}for(var Ir=Jt-Wt;Ir!==Jt&&tr[Ir]===0;)Ir++;for(var Rr=Ut.repeat(Ht);Ir<Jt;++Ir)Rr+=$t.charAt(tr[Ir]);return Rr}function qt(Vt){if(typeof Vt!="string")throw new TypeError("Expected String");if(Vt.length===0)return new Uint8Array;var Ht=0;if(Vt[Ht]!==" "){for(var Wt=0,Qt=0;Vt[Ht]===Ut;)Wt++,Ht++;for(var Xt=(Vt.length-Ht)*Lt+1>>>0,Jt=new Uint8Array(Xt);Vt[Ht];){var tr=_t[Vt.charCodeAt(Ht)];if(tr===255)return;for(var dr=0,vr=Xt-1;(tr!==0||dr<Qt)&&vr!==-1;vr--,dr++)tr+=Nt*Jt[vr]>>>0,Jt[vr]=tr%256>>>0,tr=tr/256>>>0;if(tr!==0)throw new Error("Non-zero carry");Qt=dr,Ht++}if(Vt[Ht]!==" "){for(var $r=Xt-Qt;$r!==Xt&&Jt[$r]===0;)$r++;for(var Ir=new Uint8Array(Wt+(Xt-$r)),Rr=Wt;$r!==Xt;)Ir[Rr++]=Jt[$r++];return Ir}}}function zt(Vt){var Ht=qt(Vt);if(Ht)return Ht;throw new Error(`Non-${e} character`)}return{encode:Kt,decodeUnsafe:qt,decode:zt}}var src$3=base$5,_brrp__multiformats_scope_baseX$3=src$3;const equals$6=($t,e)=>{if($t===e)return!0;if($t.byteLength!==e.byteLength)return!1;for(let _t=0;_t<$t.byteLength;_t++)if($t[_t]!==e[_t])return!1;return!0},coerce$3=$t=>{if($t instanceof Uint8Array&&$t.constructor.name==="Uint8Array")return $t;if($t instanceof ArrayBuffer)return new Uint8Array($t);if(ArrayBuffer.isView($t))return new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength);throw new Error("Unknown type, must be binary type")};let Encoder$5=class{constructor(e,_t,At){this.name=e,this.prefix=_t,this.baseEncode=At}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$3=class{constructor(e,_t,At){if(this.name=e,this.prefix=_t,_t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=_t.codePointAt(0),this.baseDecode=At}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$3(this,e)}},ComposedDecoder$3=class{constructor(e){this.decoders=e}or(e){return or$3(this,e)}decode(e){const _t=e[0],At=this.decoders[_t];if(At)return At.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$3=($t,e)=>new ComposedDecoder$3({...$t.decoders||{[$t.prefix]:$t},...e.decoders||{[e.prefix]:e}});let Codec$3=class{constructor(e,_t,At,xt){this.name=e,this.prefix=_t,this.baseEncode=At,this.baseDecode=xt,this.encoder=new Encoder$5(e,_t,At),this.decoder=new Decoder$3(e,_t,xt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$a=({name:$t,prefix:e,encode:_t,decode:At})=>new Codec$3($t,e,_t,At),baseX$3=({prefix:$t,name:e,alphabet:_t})=>{const{encode:At,decode:xt}=_brrp__multiformats_scope_baseX$3(_t,e);return from$a({prefix:$t,name:e,encode:At,decode:kt=>coerce$3(xt(kt))})},decode$p=($t,e,_t,At)=>{const xt={};for(let jt=0;jt<e.length;++jt)xt[e[jt]]=jt;let kt=$t.length;for(;$t[kt-1]==="=";)--kt;const Bt=new Uint8Array(kt*_t/8|0);let Nt=0,Ut=0,Lt=0;for(let jt=0;jt<kt;++jt){const Kt=xt[$t[jt]];if(Kt===void 0)throw new SyntaxError(`Non-${At} character`);Ut=Ut<<_t|Kt,Nt+=_t,Nt>=8&&(Nt-=8,Bt[Lt++]=255&Ut>>Nt)}if(Nt>=_t||255&Ut<<8-Nt)throw new SyntaxError("Unexpected end of data");return Bt},encode$j=($t,e,_t)=>{const At=e[e.length-1]==="=",xt=(1<<_t)-1;let kt="",Bt=0,Nt=0;for(let Ut=0;Ut<$t.length;++Ut)for(Nt=Nt<<8|$t[Ut],Bt+=8;Bt>_t;)Bt-=_t,kt+=e[xt&Nt>>Bt];if(Bt&&(kt+=e[xt&Nt<<_t-Bt]),At)for(;kt.length*_t&7;)kt+="=";return kt},rfc4648$3=({name:$t,prefix:e,bitsPerChar:_t,alphabet:At})=>from$a({prefix:e,name:$t,encode(xt){return encode$j(xt,At,_t)},decode(xt){return decode$p(xt,At,_t,$t)}});rfc4648$3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});rfc4648$3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const base64url$3=rfc4648$3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});rfc4648$3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const textEncoder$7=new TextEncoder,textDecoder$5=new TextDecoder;let Encoder$4=class Ao{static base64UrlToBytes(e){return base64url$3.baseDecode(e)}static base64UrlToObject(e){const _t=base64url$3.baseDecode(e);return Ao.bytesToObject(_t)}static bytesToBase64Url(e){return base64url$3.baseEncode(e)}static bytesToString(e){return textDecoder$5.decode(e)}static bytesToObject(e){const _t=Ao.bytesToString(e);return JSON.parse(_t)}static objectToBytes(e){const _t=JSON.stringify(e);return textEncoder$7.encode(_t)}static stringToBase64Url(e){const _t=textEncoder$7.encode(e);return base64url$3.baseEncode(_t)}static stringToBytes(e){return textEncoder$7.encode(e)}};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const P$2=2n**255n-19n,N$2=2n**252n+27742317777372353535851937790883648493n,Gx$1=0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy$1=0x6666666666666666666666666666666666666666666666666666666666666658n,CURVE$1={a:-1n,d:37095705934669439343138083508754565189542113879843219016388785533085940283555n,p:P$2,n:N$2,h:8,Gx:Gx$1,Gy:Gy$1},err$1=($t="")=>{throw new Error($t)},str$1=$t=>typeof $t=="string",au8$1=($t,e)=>!($t instanceof Uint8Array)||typeof e=="number"&&e>0&&$t.length!==e?err$1("Uint8Array expected"):$t,u8n$4=$t=>new Uint8Array($t),toU8$1=($t,e)=>au8$1(str$1($t)?h2b$3($t):u8n$4($t),e),mod$4=($t,e=P$2)=>{let _t=$t%e;return _t>=0n?_t:e+_t},isPoint$1=$t=>$t instanceof Point$4?$t:err$1("Point expected");let Gpows$1,Point$4=class eo{constructor(e,_t,At,xt){this.ex=e,this.ey=_t,this.ez=At,this.et=xt}static fromAffine(e){return new eo(e.x,e.y,1n,mod$4(e.x*e.y))}static fromHex(e,_t=!0){const{d:At}=CURVE$1;e=toU8$1(e,32);const xt=e.slice();xt[31]=e[31]&-129;const kt=b2n_LE(xt);kt===0n||(_t&&!(0n<kt&&kt<P$2)&&err$1("bad y coord 1"),!_t&&!(0n<kt&&kt<2n**256n)&&err$1("bad y coord 2"));const Bt=mod$4(kt*kt),Nt=mod$4(Bt-1n),Ut=mod$4(At*Bt+1n);let{isValid:Lt,value:jt}=uvRatio$1(Nt,Ut);Lt||err$1("bad y coordinate 3");const Kt=(jt&1n)===1n;return(e[31]&128)!==0!==Kt&&(jt=mod$4(-jt)),new eo(jt,kt,1n,mod$4(jt*kt))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(e){const{ex:_t,ey:At,ez:xt}=this,{ex:kt,ey:Bt,ez:Nt}=isPoint$1(e),Ut=mod$4(_t*Nt),Lt=mod$4(kt*xt),jt=mod$4(At*Nt),Kt=mod$4(Bt*xt);return Ut===Lt&&jt===Kt}is0(){return this.equals(I$2)}negate(){return new eo(mod$4(-this.ex),this.ey,this.ez,mod$4(-this.et))}double(){const{ex:e,ey:_t,ez:At}=this,{a:xt}=CURVE$1,kt=mod$4(e*e),Bt=mod$4(_t*_t),Nt=mod$4(2n*mod$4(At*At)),Ut=mod$4(xt*kt),Lt=e+_t,jt=mod$4(mod$4(Lt*Lt)-kt-Bt),Kt=Ut+Bt,qt=Kt-Nt,zt=Ut-Bt,Vt=mod$4(jt*qt),Ht=mod$4(Kt*zt),Wt=mod$4(jt*zt),Qt=mod$4(qt*Kt);return new eo(Vt,Ht,Qt,Wt)}add(e){const{ex:_t,ey:At,ez:xt,et:kt}=this,{ex:Bt,ey:Nt,ez:Ut,et:Lt}=isPoint$1(e),{a:jt,d:Kt}=CURVE$1,qt=mod$4(_t*Bt),zt=mod$4(At*Nt),Vt=mod$4(kt*Kt*Lt),Ht=mod$4(xt*Ut),Wt=mod$4((_t+At)*(Bt+Nt)-qt-zt),Qt=mod$4(Ht-Vt),Xt=mod$4(Ht+Vt),Jt=mod$4(zt-jt*qt),tr=mod$4(Wt*Qt),dr=mod$4(Xt*Jt),vr=mod$4(Wt*Jt),$r=mod$4(Qt*Xt);return new eo(tr,dr,$r,vr)}mul(e,_t=!0){if(e===0n)return _t===!0?err$1("cannot multiply by 0"):I$2;if(typeof e=="bigint"&&0n<e&&e<N$2||err$1("invalid scalar, must be < L"),!_t&&this.is0()||e===1n)return this;if(this.equals(G$3))return wNAF$4(e).p;let At=I$2,xt=G$3;for(let kt=this;e>0n;kt=kt.double(),e>>=1n)e&1n?At=At.add(kt):_t&&(xt=xt.add(kt));return At}multiply(e){return this.mul(e)}clearCofactor(){return this.mul(BigInt(CURVE$1.h),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let e=this.mul(N$2/2n,!1).double();return N$2%2n&&(e=e.add(this)),e.is0()}toAffine(){const{ex:e,ey:_t,ez:At}=this;if(this.is0())return{x:0n,y:0n};const xt=invert$3(At);return mod$4(At*xt)!==1n&&err$1("invalid inverse"),{x:mod$4(e*xt),y:mod$4(_t*xt)}}toRawBytes(){const{x:e,y:_t}=this.toAffine(),At=n2b_32LE(_t);return At[31]|=e&1n?128:0,At}toHex(){return b2h$1(this.toRawBytes())}};Point$4.BASE=new Point$4(Gx$1,Gy$1,1n,mod$4(Gx$1*Gy$1));Point$4.ZERO=new Point$4(0n,1n,1n,0n);const{BASE:G$3,ZERO:I$2}=Point$4,padh$1=($t,e)=>$t.toString(16).padStart(e,"0"),b2h$1=$t=>Array.from($t).map(e=>padh$1(e,2)).join(""),h2b$3=$t=>{const e=$t.length;(!str$1($t)||e%2)&&err$1("hex invalid 1");const _t=u8n$4(e/2);for(let At=0;At<_t.length;At++){const xt=At*2,kt=$t.slice(xt,xt+2),Bt=Number.parseInt(kt,16);(Number.isNaN(Bt)||Bt<0)&&err$1("hex invalid 2"),_t[At]=Bt}return _t},n2b_32LE=$t=>h2b$3(padh$1($t,32*2)).reverse(),b2n_LE=$t=>BigInt("0x"+b2h$1(u8n$4(au8$1($t)).reverse())),concatB$1=(...$t)=>{const e=u8n$4($t.reduce((At,xt)=>At+au8$1(xt).length,0));let _t=0;return $t.forEach(At=>{e.set(At,_t),_t+=At.length}),e},invert$3=($t,e=P$2)=>{($t===0n||e<=0n)&&err$1("no inverse n="+$t+" mod="+e);let _t=mod$4($t,e),At=e,xt=0n,kt=1n;for(;_t!==0n;){const Bt=At/_t,Nt=At%_t,Ut=xt-kt*Bt;At=_t,_t=Nt,xt=kt,kt=Ut}return At===1n?mod$4(xt,e):err$1("no inverse")},pow2$2=($t,e)=>{let _t=$t;for(;e-- >0n;)_t*=_t,_t%=P$2;return _t},pow_2_252_3=$t=>{const _t=$t*$t%P$2*$t%P$2,At=pow2$2(_t,2n)*_t%P$2,xt=pow2$2(At,1n)*$t%P$2,kt=pow2$2(xt,5n)*xt%P$2,Bt=pow2$2(kt,10n)*kt%P$2,Nt=pow2$2(Bt,20n)*Bt%P$2,Ut=pow2$2(Nt,40n)*Nt%P$2,Lt=pow2$2(Ut,80n)*Ut%P$2,jt=pow2$2(Lt,80n)*Ut%P$2,Kt=pow2$2(jt,10n)*kt%P$2;return{pow_p_5_8:pow2$2(Kt,2n)*$t%P$2,b2:_t}},RM1=19681161376707505956807079304988542015446066515923890162744021073123829784752n,uvRatio$1=($t,e)=>{const _t=mod$4(e*e*e),At=mod$4(_t*_t*e),xt=pow_2_252_3($t*At).pow_p_5_8;let kt=mod$4($t*_t*xt);const Bt=mod$4(e*kt*kt),Nt=kt,Ut=mod$4(kt*RM1),Lt=Bt===$t,jt=Bt===mod$4(-$t),Kt=Bt===mod$4(-$t*RM1);return Lt&&(kt=Nt),(jt||Kt)&&(kt=Ut),(mod$4(kt)&1n)===1n&&(kt=mod$4(-kt)),{isValid:Lt||jt,value:kt}},modL_LE=$t=>mod$4(b2n_LE($t),N$2);let _shaS;const sha512a=(...$t)=>etc$1.sha512Async(...$t),sha512s=(...$t)=>typeof _shaS=="function"?_shaS(...$t):err$1("etc.sha512Sync not set"),hash2extK=$t=>{const e=$t.slice(0,32);e[0]&=248,e[31]&=127,e[31]|=64;const _t=$t.slice(32,64),At=modL_LE(e),xt=G$3.mul(At),kt=xt.toRawBytes();return{head:e,prefix:_t,scalar:At,point:xt,pointBytes:kt}},getExtendedPublicKeyAsync=$t=>sha512a(toU8$1($t,32)).then(hash2extK),getExtendedPublicKey=$t=>hash2extK(sha512s(toU8$1($t,32))),getPublicKeyAsync=$t=>getExtendedPublicKeyAsync($t).then(e=>e.pointBytes);function hashFinish($t,e){return sha512a(e.hashable).then(e.finish)}const _sign=($t,e,_t)=>{const{pointBytes:At,scalar:xt}=$t,kt=modL_LE(e),Bt=G$3.mul(kt).toRawBytes();return{hashable:concatB$1(Bt,At,_t),finish:Lt=>{const jt=mod$4(kt+modL_LE(Lt)*xt,N$2);return au8$1(concatB$1(Bt,n2b_32LE(jt)),64)}}},signAsync$1=async($t,e)=>{const _t=toU8$1($t),At=await getExtendedPublicKeyAsync(e),xt=await sha512a(At.prefix,_t);return hashFinish(!0,_sign(At,xt,_t))},_verify=($t,e,_t)=>{e=toU8$1(e),$t=toU8$1($t,64);const At=Point$4.fromHex(_t,!1),xt=Point$4.fromHex($t.slice(0,32),!1),kt=b2n_LE($t.slice(32,64)),Bt=G$3.mul(kt,!1);return{hashable:concatB$1(xt.toRawBytes(),At.toRawBytes(),e),finish:Lt=>{const jt=modL_LE(Lt);return xt.add(At.mul(jt,!1)).add(Bt.negate()).clearCofactor().is0()}}},verifyAsync=async($t,e,_t)=>hashFinish(!0,_verify($t,e,_t)),cr$2=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,etc$1={bytesToHex:b2h$1,hexToBytes:h2b$3,concatBytes:concatB$1,mod:mod$4,invert:invert$3,randomBytes:$t=>{const e=cr$2();return e||err$1("crypto.getRandomValues must be defined"),e.getRandomValues(u8n$4($t))},sha512Async:async(...$t)=>{const e=cr$2();e||err$1("crypto.subtle or etc.sha512Async must be defined");const _t=concatB$1(...$t);return u8n$4(await e.subtle.digest("SHA-512",_t.buffer))},sha512Sync:void 0};Object.defineProperties(etc$1,{sha512Sync:{configurable:!1,get(){return _shaS},set($t){_shaS||(_shaS=$t)}}});const utils$y={getExtendedPublicKeyAsync,getExtendedPublicKey,randomPrivateKey:()=>etc$1.randomBytes(32),precompute($t=8,e=G$3){return e.multiply(3n),e}},W$8=8,precompute$1=()=>{const $t=[],e=256/W$8+1;let _t=G$3,At=_t;for(let xt=0;xt<e;xt++){At=_t,$t.push(At);for(let kt=1;kt<2**(W$8-1);kt++)At=At.add(_t),$t.push(At);_t=At.double()}return $t},wNAF$4=$t=>{const e=Gpows$1||(Gpows$1=precompute$1()),_t=(jt,Kt)=>{let qt=Kt.negate();return jt?qt:Kt};let At=I$2,xt=G$3;const kt=1+256/W$8,Bt=2**(W$8-1),Nt=BigInt(2**W$8-1),Ut=2**W$8,Lt=BigInt(W$8);for(let jt=0;jt<kt;jt++){const Kt=jt*Bt;let qt=Number($t&Nt);$t>>=Lt,qt>Bt&&(qt-=Ut,$t+=1n);const zt=Kt,Vt=Kt+Math.abs(qt)-1,Ht=jt%2!==0,Wt=qt<0;qt===0?xt=xt.add(_t(Ht,e[zt])):At=At.add(_t(Wt,e[Vt]))}return{p:At,f:xt}};class DwnError extends Error{constructor(e,_t){super(`${e}: ${_t}`),this.code=e,this.name="DwnError"}}var DwnErrorCode;(function($t){$t.AuthenticateJwsMissing="AuthenticateJwsMissing",$t.AuthenticateDescriptorCidMismatch="AuthenticateDescriptorCidMismatch",$t.AuthenticationMoreThanOneSignatureNotSupported="AuthenticationMoreThanOneSignatureNotSupported",$t.AuthorizationNotGrantedToAuthor="AuthorizationNotGrantedToAuthor",$t.ComputeCidCodecNotSupported="ComputeCidCodecNotSupported",$t.ComputeCidMultihashNotSupported="ComputeCidMultihashNotSupported",$t.Ed25519InvalidJwk="Ed25519InvalidJwk",$t.EventEmitterStreamNotOpenError="EventEmitterStreamNotOpenError",$t.MessagesGrantAuthorizationMismatchedProtocol="EventsGrantAuthorizationMismatchedProtocol",$t.MessagesSubscribeAuthorizationFailed="MessagesSubscribeAuthorizationFailed",$t.MessagesSubscribeEventStreamUnimplemented="MessagesSubscribeEventStreamUnimplemented",$t.GeneralJwsVerifierGetPublicKeyNotFound="GeneralJwsVerifierGetPublicKeyNotFound",$t.GeneralJwsVerifierInvalidSignature="GeneralJwsVerifierInvalidSignature",$t.GrantAuthorizationGrantExpired="GrantAuthorizationGrantExpired",$t.GrantAuthorizationGrantMissing="GrantAuthorizationGrantMissing",$t.GrantAuthorizationGrantRevoked="GrantAuthorizationGrantRevoked",$t.GrantAuthorizationInterfaceMismatch="GrantAuthorizationInterfaceMismatch",$t.GrantAuthorizationMethodMismatch="GrantAuthorizationMethodMismatch",$t.GrantAuthorizationNotGrantedForTenant="GrantAuthorizationNotGrantedForTenant",$t.GrantAuthorizationNotGrantedToAuthor="GrantAuthorizationNotGrantedToAuthor",$t.GrantAuthorizationGrantNotYetActive="GrantAuthorizationGrantNotYetActive",$t.HdKeyDerivationPathInvalid="HdKeyDerivationPathInvalid",$t.JwsVerifySignatureUnsupportedCrv="JwsVerifySignatureUnsupportedCrv",$t.IndexInvalidCursorValueType="IndexInvalidCursorValueType",$t.IndexInvalidCursorSortProperty="IndexInvalidCursorSortProperty",$t.IndexInvalidSortPropertyInMemory="IndexInvalidSortPropertyInMemory",$t.IndexMissingIndexableProperty="IndexMissingIndexableProperty",$t.JwsDecodePlainObjectPayloadInvalid="JwsDecodePlainObjectPayloadInvalid",$t.MessagesReadInvalidCid="MessagesReadInvalidCid",$t.MessagesReadAuthorizationFailed="MessagesReadAuthorizationFailed",$t.MessageGetInvalidCid="MessageGetInvalidCid",$t.MessagesQueryAuthorizationFailed="MessagesQueryAuthorizationFailed",$t.MessagesReadVerifyScopeFailed="MessagesReadVerifyScopeFailed",$t.ParseCidCodecNotSupported="ParseCidCodecNotSupported",$t.ParseCidMultihashNotSupported="ParseCidMultihashNotSupported",$t.PermissionsProtocolCreateGrantRecordsScopeMissingProtocol="PermissionsProtocolCreateGrantRecordsScopeMissingProtocol",$t.PermissionsProtocolCreateRequestRecordsScopeMissingProtocol="PermissionsProtocolCreateRequestRecordsScopeMissingProtocol",$t.PermissionsProtocolGetScopeInvalidProtocol="PermissionsProtocolGetScopeInvalidProtocol",$t.PermissionsProtocolValidateSchemaUnexpectedRecord="PermissionsProtocolValidateSchemaUnexpectedRecord",$t.PermissionsProtocolValidateScopeContextIdProhibitedProperties="PermissionsProtocolValidateScopeContextIdProhibitedProperties",$t.PermissionsProtocolValidateScopeProtocolMismatch="PermissionsProtocolValidateScopeProtocolMismatch",$t.PermissionsProtocolValidateScopeMissingProtocolTag="PermissionsProtocolValidateScopeMissingProtocolTag",$t.PermissionsProtocolValidateRevocationProtocolTagMismatch="PermissionsProtocolValidateRevocationProtocolTagMismatch",$t.PrivateKeySignerUnableToDeduceAlgorithm="PrivateKeySignerUnableToDeduceAlgorithm",$t.PrivateKeySignerUnableToDeduceKeyId="PrivateKeySignerUnableToDeduceKeyId",$t.PrivateKeySignerUnsupportedCurve="PrivateKeySignerUnsupportedCurve",$t.ProtocolAuthorizationActionNotAllowed="ProtocolAuthorizationActionNotAllowed",$t.ProtocolAuthorizationActionRulesNotFound="ProtocolAuthorizationActionRulesNotFound",$t.ProtocolAuthorizationIncorrectDataFormat="ProtocolAuthorizationIncorrectDataFormat",$t.ProtocolAuthorizationIncorrectContextId="ProtocolAuthorizationIncorrectContextId",$t.ProtocolAuthorizationIncorrectProtocolPath="ProtocolAuthorizationIncorrectProtocolPath",$t.ProtocolAuthorizationDuplicateRoleRecipient="ProtocolAuthorizationDuplicateRoleRecipient",$t.ProtocolAuthorizationInvalidSchema="ProtocolAuthorizationInvalidSchema",$t.ProtocolAuthorizationInvalidType="ProtocolAuthorizationInvalidType",$t.ProtocolAuthorizationMatchingRoleRecordNotFound="ProtocolAuthorizationMatchingRoleRecordNotFound",$t.ProtocolAuthorizationMaxSizeInvalid="ProtocolAuthorizationMaxSizeInvalid",$t.ProtocolAuthorizationMinSizeInvalid="ProtocolAuthorizationMinSizeInvalid",$t.ProtocolAuthorizationMissingContextId="ProtocolAuthorizationMissingContextId",$t.ProtocolAuthorizationMissingRuleSet="ProtocolAuthorizationMissingRuleSet",$t.ProtocolAuthorizationParentlessIncorrectProtocolPath="ProtocolAuthorizationParentlessIncorrectProtocolPath",$t.ProtocolAuthorizationNotARole="ProtocolAuthorizationNotARole",$t.ProtocolAuthorizationParentNotFoundConstructingRecordChain="ProtocolAuthorizationParentNotFoundConstructingRecordChain",$t.ProtocolAuthorizationProtocolNotFound="ProtocolAuthorizationProtocolNotFound",$t.ProtocolAuthorizationRoleMissingRecipient="ProtocolAuthorizationRoleMissingRecipient",$t.ProtocolAuthorizationTagsInvalidSchema="ProtocolAuthorizationTagsInvalidSchema",$t.ProtocolsConfigureAuthorizationFailed="ProtocolsConfigureAuthorizationFailed",$t.ProtocolsConfigureDuplicateActorInRuleSet="ProtocolsConfigureDuplicateActorInRuleSet",$t.ProtocolsConfigureDuplicateRoleInRuleSet="ProtocolsConfigureDuplicateRoleInRuleSet",$t.ProtocolsConfigureInvalidSize="ProtocolsConfigureInvalidSize",$t.ProtocolsConfigureInvalidActionMissingOf="ProtocolsConfigureInvalidActionMissingOf",$t.ProtocolsConfigureInvalidActionOfNotAllowed="ProtocolsConfigureInvalidActionOfNotAllowed",$t.ProtocolsConfigureInvalidActionDeleteWithoutCreate="ProtocolsConfigureInvalidActionDeleteWithoutCreate",$t.ProtocolsConfigureInvalidActionUpdateWithoutCreate="ProtocolsConfigureInvalidActionUpdateWithoutCreate",$t.ProtocolsConfigureInvalidRecipientOfAction="ProtocolsConfigureInvalidRecipientOfAction",$t.ProtocolsConfigureInvalidRuleSetRecordType="ProtocolsConfigureInvalidRuleSetRecordType",$t.ProtocolsConfigureInvalidTagSchema="ProtocolsConfigureInvalidTagSchema",$t.ProtocolsConfigureRecordNestingDepthExceeded="ProtocolsConfigureRecordNestingDepthExceeded",$t.ProtocolsConfigureRoleDoesNotExistAtGivenPath="ProtocolsConfigureRoleDoesNotExistAtGivenPath",$t.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch="ProtocolsGrantAuthorizationQueryProtocolScopeMismatch",$t.ProtocolsGrantAuthorizationScopeProtocolMismatch="ProtocolsGrantAuthorizationScopeProtocolMismatch",$t.ProtocolsQueryUnauthorized="ProtocolsQueryUnauthorized",$t.RecordsAuthorDelegatedGrantAndIdExistenceMismatch="RecordsAuthorDelegatedGrantAndIdExistenceMismatch",$t.RecordsAuthorDelegatedGrantCidMismatch="RecordsAuthorDelegatedGrantCidMismatch",$t.RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch="RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch",$t.RecordsAuthorDelegatedGrantNotADelegatedGrant="RecordsAuthorDelegatedGrantNotADelegatedGrant",$t.RecordsDecryptNoMatchingKeyEncryptedFound="RecordsDecryptNoMatchingKeyEncryptedFound",$t.RecordsDeleteAuthorizationFailed="RecordsDeleteAuthorizationFailed",$t.RecordsQueryCreateFilterPublishedSortInvalid="RecordsQueryCreateFilterPublishedSortInvalid",$t.RecordsQueryParseFilterPublishedSortInvalid="RecordsQueryParseFilterPublishedSortInvalid",$t.RecordsGrantAuthorizationConditionPublicationProhibited="RecordsGrantAuthorizationConditionPublicationProhibited",$t.RecordsGrantAuthorizationConditionPublicationRequired="RecordsGrantAuthorizationConditionPublicationRequired",$t.RecordsGrantAuthorizationDeleteProtocolScopeMismatch="RecordsGrantAuthorizationDeleteProtocolScopeMismatch",$t.RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch="RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch",$t.RecordsGrantAuthorizationScopeContextIdMismatch="RecordsGrantAuthorizationScopeContextIdMismatch",$t.RecordsGrantAuthorizationScopeProtocolMismatch="RecordsGrantAuthorizationScopeProtocolMismatch",$t.RecordsGrantAuthorizationScopeProtocolPathMismatch="RecordsGrantAuthorizationScopeProtocolPathMismatch",$t.RecordsDerivePrivateKeyUnSupportedCurve="RecordsDerivePrivateKeyUnSupportedCurve",$t.RecordsInvalidAncestorKeyDerivationSegment="RecordsInvalidAncestorKeyDerivationSegment",$t.RecordsOwnerDelegatedGrantAndIdExistenceMismatch="RecordsOwnerDelegatedGrantAndIdExistenceMismatch",$t.RecordsOwnerDelegatedGrantCidMismatch="RecordsOwnerDelegatedGrantCidMismatch",$t.RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch="RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch",$t.RecordsOwnerDelegatedGrantNotADelegatedGrant="RecordsOwnerDelegatedGrantNotADelegatedGrant",$t.RecordsProtocolContextDerivationSchemeMissingContextId="RecordsProtocolContextDerivationSchemeMissingContextId",$t.RecordsProtocolPathDerivationSchemeMissingProtocol="RecordsProtocolPathDerivationSchemeMissingProtocol",$t.RecordsQueryFilterMissingRequiredProperties="RecordsQueryFilterMissingRequiredProperties",$t.RecordsReadReturnedMultiple="RecordsReadReturnedMultiple",$t.RecordsReadAuthorizationFailed="RecordsReadAuthorizationFailed",$t.RecordsSubscribeEventStreamUnimplemented="RecordsSubscribeEventStreamUnimplemented",$t.RecordsSubscribeFilterMissingRequiredProperties="RecordsSubscribeFilterMissingRequiredProperties",$t.RecordsSchemasDerivationSchemeMissingSchema="RecordsSchemasDerivationSchemeMissingSchema",$t.RecordsWriteAttestationIntegrityMoreThanOneSignature="RecordsWriteAttestationIntegrityMoreThanOneSignature",$t.RecordsWriteAttestationIntegrityDescriptorCidMismatch="RecordsWriteAttestationIntegrityDescriptorCidMismatch",$t.RecordsWriteAttestationIntegrityInvalidPayloadProperty="RecordsWriteAttestationIntegrityInvalidPayloadProperty",$t.RecordsWriteAuthorizationFailed="RecordsWriteAuthorizationFailed",$t.RecordsWriteCreateMissingSigner="RecordsWriteCreateMissingSigner",$t.RecordsWriteCreateDataAndDataCidMutuallyExclusive="RecordsWriteCreateDataAndDataCidMutuallyExclusive",$t.RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive="RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive",$t.RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive="RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive",$t.RecordsWriteDataCidMismatch="RecordsWriteDataCidMismatch",$t.RecordsWriteDataSizeMismatch="RecordsWriteDataSizeMismatch",$t.RecordsWriteGetEntryIdUndefinedAuthor="RecordsWriteGetEntryIdUndefinedAuthor",$t.RecordsWriteGetNewestWriteRecordNotFound="RecordsWriteGetNewestWriteRecordNotFound",$t.RecordsWriteGetInitialWriteNotFound="RecordsWriteGetInitialWriteNotFound",$t.RecordsWriteImmutablePropertyChanged="RecordsWriteImmutablePropertyChanged",$t.RecordsWriteMissingSigner="RecordsWriteMissingSigner",$t.RecordsWriteMissingDataInPrevious="RecordsWriteMissingDataInPrevious",$t.RecordsWriteMissingEncodedDataInPrevious="RecordsWriteMissingEncodedDataInPrevious",$t.RecordsWriteMissingProtocol="RecordsWriteMissingProtocol",$t.RecordsWriteMissingSchema="RecordsWriteMissingSchema",$t.RecordsWriteNotAllowedAfterDelete="RecordsWriteNotAllowedAfterDelete",$t.RecordsWriteOwnerAndTenantMismatch="RecordsWriteOwnerAndTenantMismatch",$t.RecordsWriteSignAsOwnerDelegateUnknownAuthor="RecordsWriteSignAsOwnerDelegateUnknownAuthor",$t.RecordsWriteSignAsOwnerUnknownAuthor="RecordsWriteSignAsOwnerUnknownAuthor",$t.RecordsWriteValidateIntegrityAttestationMismatch="RecordsWriteValidateIntegrityAttestationMismatch",$t.RecordsWriteValidateIntegrityContextIdMismatch="RecordsWriteValidateIntegrityContextIdMismatch",$t.RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload="RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload",$t.RecordsWriteValidateIntegrityDateCreatedMismatch="RecordsWriteValidateIntegrityDateCreatedMismatch",$t.RecordsWriteValidateIntegrityEncryptionCidMismatch="RecordsWriteValidateIntegrityEncryptionCidMismatch",$t.RecordsWriteValidateIntegrityRecordIdUnauthorized="RecordsWriteValidateIntegrityRecordIdUnauthorized",$t.SchemaValidatorAdditionalPropertyNotAllowed="SchemaValidatorAdditionalPropertyNotAllowed",$t.SchemaValidatorFailure="SchemaValidatorFailure",$t.SchemaValidatorSchemaNotFound="SchemaValidatorSchemaNotFound",$t.SchemaValidatorUnevaluatedPropertyNotAllowed="SchemaValidatorUnevaluatedPropertyNotAllowed",$t.Secp256k1KeyNotValid="Secp256k1KeyNotValid",$t.Secp256r1KeyNotValid="Secp256r1KeyNotValid",$t.TimestampInvalid="TimestampInvalid",$t.UrlProtocolNotNormalized="UrlProtocolNotNormalized",$t.UrlProtocolNotNormalizable="UrlProtocolNotNormalizable",$t.UrlSchemaNotNormalized="UrlSchemaNotNormalized"})(DwnErrorCode||(DwnErrorCode={}));var __awaiter$2I=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function validateKey($t){if($t.kty!=="OKP"||$t.crv!=="Ed25519")throw new DwnError(DwnErrorCode.Ed25519InvalidJwk,"invalid jwk. kty MUST be OKP. crv MUST be Ed25519")}function publicKeyToJwk($t){return{alg:"EdDSA",kty:"OKP",crv:"Ed25519",x:Encoder$4.bytesToBase64Url($t)}}const ed25519$2={sign:($t,e)=>__awaiter$2I(void 0,void 0,void 0,function*(){validateKey(e);const _t=Encoder$4.base64UrlToBytes(e.d);return signAsync$1($t,_t)}),verify:($t,e,_t)=>__awaiter$2I(void 0,void 0,void 0,function*(){validateKey(_t);const At=Encoder$4.base64UrlToBytes(_t.x);return verifyAsync(e,$t,At)}),generateKeyPair:()=>__awaiter$2I(void 0,void 0,void 0,function*(){const $t=utils$y.randomPrivateKey(),e=yield getPublicKeyAsync($t),_t=Encoder$4.bytesToBase64Url($t),At=publicKeyToJwk(e),xt=Object.assign(Object.assign({},At),{d:_t});return{publicJwk:At,privateJwk:xt}}),publicKeyToJwk:$t=>__awaiter$2I(void 0,void 0,void 0,function*(){return publicKeyToJwk($t)})};/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const B256=2n**256n,P$1=B256-0x1000003d1n,N$1=B256-0x14551231950b75fc4402da1732fc9bebfn,Gx=0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy=0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n,CURVE={p:P$1,n:N$1,a:0n,b:7n,Gx,Gy},fLen=32,crv=$t=>mod$3(mod$3($t*$t)*$t+CURVE.b),err=($t="")=>{throw new Error($t)},big=$t=>typeof $t=="bigint",str=$t=>typeof $t=="string",fe$1=$t=>big($t)&&0n<$t&&$t<P$1,ge$1=$t=>big($t)&&0n<$t&&$t<N$1,au8=($t,e)=>!($t instanceof Uint8Array)||typeof e=="number"&&e>0&&$t.length!==e?err("Uint8Array expected"):$t,u8n$3=$t=>new Uint8Array($t),toU8=($t,e)=>au8(str($t)?h2b$2($t):u8n$3($t),e),mod$3=($t,e=P$1)=>{let _t=$t%e;return _t>=0n?_t:e+_t},isPoint=$t=>$t instanceof Point$3?$t:err("Point expected");let Gpows,Point$3=class to{constructor(e,_t,At){this.px=e,this.py=_t,this.pz=At}static fromAffine(e){return new to(e.x,e.y,1n)}static fromHex(e){e=toU8(e);let _t;const At=e[0],xt=e.subarray(1),kt=slcNum(xt,0,fLen),Bt=e.length;if(Bt===33&&[2,3].includes(At)){fe$1(kt)||err("Point hex invalid: x not FE");let Nt=sqrt(crv(kt));const Ut=(Nt&1n)===1n;(At&1)===1!==Ut&&(Nt=mod$3(-Nt)),_t=new to(kt,Nt,1n)}return Bt===65&&At===4&&(_t=new to(kt,slcNum(xt,fLen,2*fLen),1n)),_t?_t.ok():err("Point is not on curve")}static fromPrivateKey(e){return G$2.mul(toPriv(e))}get x(){return this.aff().x}get y(){return this.aff().y}equals(e){const{px:_t,py:At,pz:xt}=this,{px:kt,py:Bt,pz:Nt}=isPoint(e),Ut=mod$3(_t*Nt),Lt=mod$3(kt*xt),jt=mod$3(At*Nt),Kt=mod$3(Bt*xt);return Ut===Lt&&jt===Kt}negate(){return new to(this.px,mod$3(-this.py),this.pz)}double(){return this.add(this)}add(e){const{px:_t,py:At,pz:xt}=this,{px:kt,py:Bt,pz:Nt}=isPoint(e),{a:Ut,b:Lt}=CURVE;let jt=0n,Kt=0n,qt=0n;const zt=mod$3(Lt*3n);let Vt=mod$3(_t*kt),Ht=mod$3(At*Bt),Wt=mod$3(xt*Nt),Qt=mod$3(_t+At),Xt=mod$3(kt+Bt);Qt=mod$3(Qt*Xt),Xt=mod$3(Vt+Ht),Qt=mod$3(Qt-Xt),Xt=mod$3(_t+xt);let Jt=mod$3(kt+Nt);return Xt=mod$3(Xt*Jt),Jt=mod$3(Vt+Wt),Xt=mod$3(Xt-Jt),Jt=mod$3(At+xt),jt=mod$3(Bt+Nt),Jt=mod$3(Jt*jt),jt=mod$3(Ht+Wt),Jt=mod$3(Jt-jt),qt=mod$3(Ut*Xt),jt=mod$3(zt*Wt),qt=mod$3(jt+qt),jt=mod$3(Ht-qt),qt=mod$3(Ht+qt),Kt=mod$3(jt*qt),Ht=mod$3(Vt+Vt),Ht=mod$3(Ht+Vt),Wt=mod$3(Ut*Wt),Xt=mod$3(zt*Xt),Ht=mod$3(Ht+Wt),Wt=mod$3(Vt-Wt),Wt=mod$3(Ut*Wt),Xt=mod$3(Xt+Wt),Vt=mod$3(Ht*Xt),Kt=mod$3(Kt+Vt),Vt=mod$3(Jt*Xt),jt=mod$3(Qt*jt),jt=mod$3(jt-Vt),Vt=mod$3(Qt*Ht),qt=mod$3(Jt*qt),qt=mod$3(qt+Vt),new to(jt,Kt,qt)}mul(e,_t=!0){if(!_t&&e===0n)return I$1;if(ge$1(e)||err("invalid scalar"),this.equals(G$2))return wNAF$3(e).p;let At=I$1,xt=G$2;for(let kt=this;e>0n;kt=kt.double(),e>>=1n)e&1n?At=At.add(kt):_t&&(xt=xt.add(kt));return At}mulAddQUns(e,_t,At){return this.mul(_t,!1).add(e.mul(At,!1)).ok()}toAffine(){const{px:e,py:_t,pz:At}=this;if(this.equals(I$1))return{x:0n,y:0n};if(At===1n)return{x:e,y:_t};const xt=inv(At);return mod$3(At*xt)!==1n&&err("invalid inverse"),{x:mod$3(e*xt),y:mod$3(_t*xt)}}assertValidity(){const{x:e,y:_t}=this.aff();return(!fe$1(e)||!fe$1(_t))&&err("Point invalid: x or y"),mod$3(_t*_t)===crv(e)?this:err("Point invalid: not on curve")}multiply(e){return this.mul(e)}aff(){return this.toAffine()}ok(){return this.assertValidity()}toHex(e=!0){const{x:_t,y:At}=this.aff();return(e?(At&1n)===0n?"02":"03":"04")+n2h(_t)+(e?"":n2h(At))}toRawBytes(e=!0){return h2b$2(this.toHex(e))}};Point$3.BASE=new Point$3(Gx,Gy,1n);Point$3.ZERO=new Point$3(0n,1n,0n);const{BASE:G$2,ZERO:I$1}=Point$3,padh=($t,e)=>$t.toString(16).padStart(e,"0"),b2h=$t=>Array.from($t).map(e=>padh(e,2)).join(""),h2b$2=$t=>{const e=$t.length;(!str($t)||e%2)&&err("hex invalid 1");const _t=u8n$3(e/2);for(let At=0;At<_t.length;At++){const xt=At*2,kt=$t.slice(xt,xt+2),Bt=Number.parseInt(kt,16);(Number.isNaN(Bt)||Bt<0)&&err("hex invalid 2"),_t[At]=Bt}return _t},b2n$2=$t=>BigInt("0x"+(b2h($t)||"0")),slcNum=($t,e,_t)=>b2n$2($t.slice(e,_t)),n2b=$t=>big($t)&&$t>=0n&&$t<B256?h2b$2(padh($t,2*fLen)):err("bigint expected"),n2h=$t=>b2h(n2b($t)),concatB=(...$t)=>{const e=u8n$3($t.reduce((At,xt)=>At+au8(xt).length,0));let _t=0;return $t.forEach(At=>{e.set(At,_t),_t+=At.length}),e},inv=($t,e=P$1)=>{($t===0n||e<=0n)&&err("no inverse n="+$t+" mod="+e);let _t=mod$3($t,e),At=e,xt=0n,kt=1n;for(;_t!==0n;){const Bt=At/_t,Nt=At%_t,Ut=xt-kt*Bt;At=_t,_t=Nt,xt=kt,kt=Ut}return At===1n?mod$3(xt,e):err("no inverse")},sqrt=$t=>{let e=1n;for(let _t=$t,At=(P$1+1n)/4n;At>0n;At>>=1n)At&1n&&(e=e*_t%P$1),_t=_t*_t%P$1;return mod$3(e*e)===$t?e:err("sqrt invalid")},toPriv=$t=>(big($t)||($t=b2n$2(toU8($t,fLen))),ge$1($t)?$t:err("private key out of range")),moreThanHalfN=$t=>$t>N$1>>1n;function getPublicKey$1($t,e=!0){return Point$3.fromPrivateKey($t).toRawBytes(e)}let Signature$3=class Do{constructor(e,_t,At){this.r=e,this.s=_t,this.recovery=At,this.assertValidity()}static fromCompact(e){return e=toU8(e,64),new Do(slcNum(e,0,fLen),slcNum(e,fLen,2*fLen))}assertValidity(){return ge$1(this.r)&&ge$1(this.s)?this:err()}addRecoveryBit(e){return new Do(this.r,this.s,e)}hasHighS(){return moreThanHalfN(this.s)}recoverPublicKey(e){const{r:_t,s:At,recovery:xt}=this;[0,1,2,3].includes(xt)||err("recovery id invalid");const kt=bits2int_modN(toU8(e,32)),Bt=xt===2||xt===3?_t+N$1:_t;Bt>=P$1&&err("q.x invalid");const Nt=xt&1?"03":"02",Ut=Point$3.fromHex(Nt+n2h(Bt)),Lt=inv(Bt,N$1),jt=mod$3(-kt*Lt,N$1),Kt=mod$3(At*Lt,N$1);return G$2.mulAddQUns(Ut,jt,Kt)}toCompactRawBytes(){return h2b$2(this.toCompactHex())}toCompactHex(){return n2h(this.r)+n2h(this.s)}};const bits2int=$t=>{const e=$t.length*8-256,_t=b2n$2($t);return e>0?_t>>BigInt(e):_t},bits2int_modN=$t=>mod$3(bits2int($t),N$1),i2o=$t=>n2b($t),cr$1=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;let _hmacSync;const optS={lowS:!0},optV={lowS:!0};function prepSig($t,e,_t=optS){["der","recovered","canonical"].some(Kt=>Kt in _t)&&err("sign() legacy options not supported");let{lowS:At}=_t;At==null&&(At=!0);const xt=bits2int_modN(toU8($t)),kt=i2o(xt),Bt=toPriv(e),Nt=[i2o(Bt),kt];let Ut=_t.extraEntropy;if(Ut){Ut===!0&&(Ut=etc.randomBytes(fLen));const Kt=toU8(Ut);Kt.length!==fLen&&err(),Nt.push(Kt)}const Lt=xt,jt=Kt=>{const qt=bits2int(Kt);if(!ge$1(qt))return;const zt=inv(qt,N$1),Vt=G$2.mul(qt).aff(),Ht=mod$3(Vt.x,N$1);if(Ht===0n)return;const Wt=mod$3(zt*mod$3(Lt+mod$3(Bt*Ht,N$1),N$1),N$1);if(Wt===0n)return;let Qt=Wt,Xt=(Vt.x===Ht?0:2)|Number(Vt.y&1n);return At&&moreThanHalfN(Wt)&&(Qt=mod$3(-Wt,N$1),Xt^=1),new Signature$3(Ht,Qt,Xt)};return{seed:concatB(...Nt),k2sig:jt}}function hmacDrbg$1($t){let e=u8n$3(fLen),_t=u8n$3(fLen),At=0;const xt=()=>{e.fill(1),_t.fill(0),At=0},kt="drbg: tried 1000 values";{const Bt=(...Lt)=>etc.hmacSha256Async(_t,e,...Lt),Nt=async(Lt=u8n$3())=>{_t=await Bt(u8n$3([0]),Lt),e=await Bt(),Lt.length!==0&&(_t=await Bt(u8n$3([1]),Lt),e=await Bt())},Ut=async()=>(At++>=1e3&&err(kt),e=await Bt(),e);return async(Lt,jt)=>{xt(),await Nt(Lt);let Kt;for(;!(Kt=jt(await Ut()));)await Nt();return xt(),Kt}}}async function signAsync($t,e,_t=optS){const{seed:At,k2sig:xt}=prepSig($t,e,_t);return hmacDrbg$1()(At,xt)}function verify($t,e,_t,At=optV){let{lowS:xt}=At;xt==null&&(xt=!0),"strict"in At&&err("verify() legacy options not supported");let kt,Bt,Nt;const Ut=$t&&typeof $t=="object"&&"r"in $t;!Ut&&toU8($t).length!==2*fLen&&err("signature must be 64 bytes");try{kt=Ut?new Signature$3($t.r,$t.s).assertValidity():Signature$3.fromCompact($t),Bt=bits2int_modN(toU8(e,fLen)),Nt=_t instanceof Point$3?_t.ok():Point$3.fromHex(_t)}catch{return!1}if(!kt)return!1;const{r:Lt,s:jt}=kt;if(xt&&moreThanHalfN(jt))return!1;let Kt;try{const zt=inv(jt,N$1),Vt=mod$3(Bt*zt,N$1),Ht=mod$3(Lt*zt,N$1);Kt=G$2.mulAddQUns(Nt,Vt,Ht).aff()}catch{return!1}return Kt?mod$3(Kt.x,N$1)===Lt:!1}function hashToPrivateKey($t){$t=toU8($t);const e=fLen+8;($t.length<e||$t.length>1024)&&err("expected proper params");const _t=mod$3(b2n$2($t),N$1-1n)+1n;return n2b(_t)}const etc={hexToBytes:h2b$2,bytesToHex:b2h,concatBytes:concatB,bytesToNumberBE:b2n$2,numberToBytesBE:n2b,mod:mod$3,invert:inv,hmacSha256Async:async($t,...e)=>{const _t=cr$1();if(!_t)return err("etc.hmacSha256Async not set");const At=_t.subtle,xt=await At.importKey("raw",$t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return u8n$3(await At.sign("HMAC",xt,concatB(...e)))},hmacSha256Sync:_hmacSync,hashToPrivateKey,randomBytes:$t=>{const e=cr$1();return e||err("crypto.getRandomValues must be defined"),e.getRandomValues(u8n$3($t))}},utils$x={normPrivateKeyToScalar:toPriv,isValidPrivateKey:$t=>{try{return!!toPriv($t)}catch{return!1}},randomPrivateKey:()=>hashToPrivateKey(etc.randomBytes(fLen+8)),precompute($t=8,e=G$2){return e.multiply(3n),e}};Object.defineProperties(etc,{hmacSha256Sync:{configurable:!1,get(){return _hmacSync},set($t){_hmacSync||(_hmacSync=$t)}}});const W$7=8,precompute=()=>{const $t=[],e=256/W$7+1;let _t=G$2,At=_t;for(let xt=0;xt<e;xt++){At=_t,$t.push(At);for(let kt=1;kt<2**(W$7-1);kt++)At=At.add(_t),$t.push(At);_t=At.double()}return $t},wNAF$3=$t=>{const e=Gpows||(Gpows=precompute()),_t=(jt,Kt)=>{let qt=Kt.negate();return jt?qt:Kt};let At=I$1,xt=G$2;const kt=1+256/W$7,Bt=2**(W$7-1),Nt=BigInt(2**W$7-1),Ut=2**W$7,Lt=BigInt(W$7);for(let jt=0;jt<kt;jt++){const Kt=jt*Bt;let qt=Number($t&Nt);$t>>=Lt,qt>Bt&&(qt-=Ut,$t+=1n);const zt=Kt,Vt=Kt+Math.abs(qt)-1,Ht=jt%2!==0,Wt=qt<0;qt===0?xt=xt.add(_t(Ht,e[zt])):At=At.add(_t(Wt,e[Vt]))}return{p:At,f:xt}};var encode_1$3=encode$i,MSB$5=128,REST$5=127,MSBALL$3=~REST$5,INT$3=Math.pow(2,31);function encode$i($t,e,_t){e=e||[],_t=_t||0;for(var At=_t;$t>=INT$3;)e[_t++]=$t&255|MSB$5,$t/=128;for(;$t&MSBALL$3;)e[_t++]=$t&255|MSB$5,$t>>>=7;return e[_t]=$t|0,encode$i.bytes=_t-At+1,e}var decode$o=read$4,MSB$1$3=128,REST$1$3=127;function read$4($t,At){var _t=0,At=At||0,xt=0,kt=At,Bt,Nt=$t.length;do{if(kt>=Nt)throw read$4.bytes=0,new RangeError("Could not decode varint");Bt=$t[kt++],_t+=xt<28?(Bt&REST$1$3)<<xt:(Bt&REST$1$3)*Math.pow(2,xt),xt+=7}while(Bt>=MSB$1$3);return read$4.bytes=kt-At,_t}var N1$4=Math.pow(2,7),N2$4=Math.pow(2,14),N3$4=Math.pow(2,21),N4$4=Math.pow(2,28),N5$4=Math.pow(2,35),N6$4=Math.pow(2,42),N7$4=Math.pow(2,49),N8$3=Math.pow(2,56),N9$3=Math.pow(2,63),length$4=function($t){return $t<N1$4?1:$t<N2$4?2:$t<N3$4?3:$t<N4$4?4:$t<N5$4?5:$t<N6$4?6:$t<N7$4?7:$t<N8$3?8:$t<N9$3?9:10},varint$3={encode:encode_1$3,decode:decode$o,encodingLength:length$4},_brrp_varint$3=varint$3;const decode$n=($t,e=0)=>[_brrp_varint$3.decode($t,e),_brrp_varint$3.decode.bytes],encodeTo$3=($t,e,_t=0)=>(_brrp_varint$3.encode($t,e,_t),e),encodingLength$8=$t=>_brrp_varint$3.encodingLength($t),create$2=($t,e)=>{const _t=e.byteLength,At=encodingLength$8($t),xt=At+encodingLength$8(_t),kt=new Uint8Array(xt+_t);return encodeTo$3($t,kt,0),encodeTo$3(_t,kt,At),kt.set(e,xt),new Digest$2($t,_t,e,kt)},decode$m=$t=>{const e=coerce$3($t),[_t,At]=decode$n(e),[xt,kt]=decode$n(e.subarray(At)),Bt=e.subarray(At+kt);if(Bt.byteLength!==xt)throw new Error("Incorrect length");return new Digest$2(_t,xt,Bt,e)},equals$5=($t,e)=>{if($t===e)return!0;{const _t=e;return $t.code===_t.code&&$t.size===_t.size&&_t.bytes instanceof Uint8Array&&equals$6($t.bytes,_t.bytes)}};let Digest$2=class{constructor(e,_t,At,xt){this.code=e,this.size=_t,this.digest=At,this.bytes=xt}};const from$9=({name:$t,code:e,encode:_t})=>new Hasher$2($t,e,_t);let Hasher$2=class{constructor(e,_t,At){this.name=e,this.code=_t,this.encode=At}digest(e){if(e instanceof Uint8Array){const _t=this.encode(e);return _t instanceof Uint8Array?create$2(this.code,_t):_t.then(At=>create$2(this.code,At))}else throw Error("Unknown type, must be binary type")}};const sha$6=$t=>async e=>new Uint8Array(await crypto.subtle.digest($t,e)),sha256$7=from$9({name:"sha2-256",code:18,encode:sha$6("SHA-256")});var __awaiter$2H=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$A=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Secp256k1$3=class Ni{static validateKey(e){if(e.kty!=="EC"||e.crv!=="secp256k1")throw new DwnError(DwnErrorCode.Secp256k1KeyNotValid,"Invalid SECP256K1 JWK: `kty` MUST be `EC`. `crv` MUST be `secp256k1`")}static publicKeyToJwk(e){return __awaiter$2H(this,void 0,void 0,function*(){let _t;e.byteLength===33?_t=Point$3.fromHex(e).toRawBytes(!1):_t=e;const At=Encoder$4.bytesToBase64Url(_t.subarray(1,33)),xt=Encoder$4.bytesToBase64Url(_t.subarray(33,65));return{alg:"ES256K",kty:"EC",crv:"secp256k1",x:At,y:xt}})}static privateKeyToJwk(e){return __awaiter$2H(this,void 0,void 0,function*(){const _t=yield Ni.getPublicKey(e),At=yield Ni.publicKeyToJwk(_t);return At.d=Encoder$4.bytesToBase64Url(e),At})}static publicJwkToBytes(e){const _t=Encoder$4.base64UrlToBytes(e.x),At=Encoder$4.base64UrlToBytes(e.y);return Point$3.fromAffine({x:etc.bytesToNumberBE(_t),y:etc.bytesToNumberBE(At)}).toRawBytes(!0)}static privateJwkToBytes(e){return Encoder$4.base64UrlToBytes(e.d)}static sign(e,_t){return __awaiter$2H(this,void 0,void 0,function*(){Ni.validateKey(_t);const At=yield sha256$7.encode(e),xt=Ni.privateJwkToBytes(_t);return(yield signAsync(At,xt)).toCompactRawBytes()})}static verify(e,_t,At){return __awaiter$2H(this,void 0,void 0,function*(){Ni.validateKey(At);const xt=Ni.publicJwkToBytes(At),kt=yield sha256$7.encode(e);return verify(_t,kt,xt)})}static generateKeyPair(){return __awaiter$2H(this,void 0,void 0,function*(){const e=utils$x.randomPrivateKey(),_t=getPublicKey$1(e,!1),At=Encoder$4.bytesToBase64Url(e),xt=yield Ni.publicKeyToJwk(_t),kt=Object.assign(Object.assign({},xt),{d:At});return{publicJwk:xt,privateJwk:kt}})}static generateKeyPairRaw(){return __awaiter$2H(this,void 0,void 0,function*(){const e=utils$x.randomPrivateKey();return{publicKey:getPublicKey$1(e,!0),privateKey:e}})}static getPublicKey(e){return __awaiter$2H(this,void 0,void 0,function*(){return getPublicKey$1(e,!0)})}static getPublicJwk(e){return __awaiter$2H(this,void 0,void 0,function*(){return __rest$A(e,["d"])})}};function number$4($t){if(!Number.isSafeInteger($t)||$t<0)throw new Error(`positive integer expected, not ${$t}`)}function isBytes$b($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}function bytes$5($t,...e){if(!isBytes$b($t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes($t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${$t.length}`)}function hash$7($t){if(typeof $t!="function"||typeof $t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$4($t.outputLen),number$4($t.blockLen)}function exists$6($t,e=!0){if($t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&$t.finished)throw new Error("Hash#digest() has already been called")}function output$5($t,e){bytes$5($t);const _t=e.outputLen;if($t.length<_t)throw new Error(`digestInto() expects output buffer of length at least ${_t}`)}const crypto$7=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$a($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}const u8=$t=>new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength),u32$2=$t=>new Uint32Array($t.buffer,$t.byteOffset,Math.floor($t.byteLength/4)),createView$2=$t=>new DataView($t.buffer,$t.byteOffset,$t.byteLength),rotr$1=($t,e)=>$t<<32-e|$t>>>e,rotl$4=($t,e)=>$t<<e|$t>>>32-e>>>0,isLE$3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,byteSwap=$t=>$t<<24&4278190080|$t<<8&16711680|$t>>>8&65280|$t>>>24&255,byteSwapIfBE=isLE$3?$t=>$t:$t=>byteSwap($t);function byteSwap32($t){for(let e=0;e<$t.length;e++)$t[e]=byteSwap($t[e])}const hexes$4=Array.from({length:256},($t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$4($t){bytes$5($t);let e="";for(let _t=0;_t<$t.length;_t++)e+=hexes$4[$t[_t]];return e}const asciis$4={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$4($t){if($t>=asciis$4._0&&$t<=asciis$4._9)return $t-asciis$4._0;if($t>=asciis$4._A&&$t<=asciis$4._F)return $t-(asciis$4._A-10);if($t>=asciis$4._a&&$t<=asciis$4._f)return $t-(asciis$4._a-10)}function hexToBytes$4($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);const e=$t.length,_t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const At=new Uint8Array(_t);for(let xt=0,kt=0;xt<_t;xt++,kt+=2){const Bt=asciiToBase16$4($t.charCodeAt(kt)),Nt=asciiToBase16$4($t.charCodeAt(kt+1));if(Bt===void 0||Nt===void 0){const Ut=$t[kt]+$t[kt+1];throw new Error('hex string expected, got non-hex character "'+Ut+'" at index '+kt)}At[xt]=Bt*16+Nt}return At}const nextTick$4=async()=>{};async function asyncLoop$1($t,e,_t){let At=Date.now();for(let xt=0;xt<$t;xt++){_t(xt);const kt=Date.now()-At;kt>=0&&kt<e||(await nextTick$4(),At+=kt)}}function utf8ToBytes$7($t){if(typeof $t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function toBytes$3($t){return typeof $t=="string"&&($t=utf8ToBytes$7($t)),bytes$5($t),$t}function concatBytes$4(...$t){let e=0;for(let At=0;At<$t.length;At++){const xt=$t[At];bytes$5(xt),e+=xt.length}const _t=new Uint8Array(e);for(let At=0,xt=0;At<$t.length;At++){const kt=$t[At];_t.set(kt,xt),xt+=kt.length}return _t}let Hash$9=class{clone(){return this._cloneInto()}};const toStr$5={}.toString;function checkOpts$2($t,e){if(e!==void 0&&toStr$5.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign($t,e)}function wrapConstructor$1($t){const e=At=>$t().update(toBytes$3(At)).digest(),_t=$t();return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=()=>$t(),e}function wrapConstructorWithOpts($t){const e=(At,xt)=>$t(xt).update(toBytes$3(At)).digest(),_t=$t({});return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=At=>$t(At),e}function wrapXOFConstructorWithOpts($t){const e=(At,xt)=>$t(xt).update(toBytes$3(At)).digest(),_t=$t({});return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=At=>$t(At),e}function randomBytes$6($t=32){if(crypto$7&&typeof crypto$7.getRandomValues=="function")return crypto$7.getRandomValues(new Uint8Array($t));throw new Error("crypto.getRandomValues must be defined")}const utils$w=Object.freeze(Object.defineProperty({__proto__:null,Hash:Hash$9,asyncLoop:asyncLoop$1,byteSwap,byteSwap32,byteSwapIfBE,bytesToHex:bytesToHex$4,checkOpts:checkOpts$2,concatBytes:concatBytes$4,createView:createView$2,hexToBytes:hexToBytes$4,isBytes:isBytes$a,isLE:isLE$3,nextTick:nextTick$4,randomBytes:randomBytes$6,rotl:rotl$4,rotr:rotr$1,toBytes:toBytes$3,u32:u32$2,u8,utf8ToBytes:utf8ToBytes$7,wrapConstructor:wrapConstructor$1,wrapConstructorWithOpts,wrapXOFConstructorWithOpts},Symbol.toStringTag,{value:"Module"}));function setBigUint64$3($t,e,_t,At){if(typeof $t.setBigUint64=="function")return $t.setBigUint64(e,_t,At);const xt=BigInt(32),kt=BigInt(4294967295),Bt=Number(_t>>xt&kt),Nt=Number(_t&kt),Ut=At?4:0,Lt=At?0:4;$t.setUint32(e+Ut,Bt,At),$t.setUint32(e+Lt,Nt,At)}const Chi$2=($t,e,_t)=>$t&e^~$t&_t,Maj$2=($t,e,_t)=>$t&e^$t&_t^e&_t;let HashMD$1=class extends Hash$9{constructor(e,_t,At,xt){super(),this.blockLen=e,this.outputLen=_t,this.padOffset=At,this.isLE=xt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){exists$6(this);const{view:_t,buffer:At,blockLen:xt}=this;e=toBytes$3(e);const kt=e.length;for(let Bt=0;Bt<kt;){const Nt=Math.min(xt-this.pos,kt-Bt);if(Nt===xt){const Ut=createView$2(e);for(;xt<=kt-Bt;Bt+=xt)this.process(Ut,Bt);continue}At.set(e.subarray(Bt,Bt+Nt),this.pos),this.pos+=Nt,Bt+=Nt,this.pos===xt&&(this.process(_t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$6(this),output$5(e,this),this.finished=!0;const{buffer:_t,view:At,blockLen:xt,isLE:kt}=this;let{pos:Bt}=this;_t[Bt++]=128,this.buffer.subarray(Bt).fill(0),this.padOffset>xt-Bt&&(this.process(At,0),Bt=0);for(let Kt=Bt;Kt<xt;Kt++)_t[Kt]=0;setBigUint64$3(At,xt-8,BigInt(this.length*8),kt),this.process(At,0);const Nt=createView$2(e),Ut=this.outputLen;if(Ut%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Lt=Ut/4,jt=this.get();if(Lt>jt.length)throw new Error("_sha2: outputLen bigger than state");for(let Kt=0;Kt<Lt;Kt++)Nt.setUint32(4*Kt,jt[Kt],kt)}digest(){const{buffer:e,outputLen:_t}=this;this.digestInto(e);const At=e.slice(0,_t);return this.destroy(),At}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:_t,buffer:At,length:xt,finished:kt,destroyed:Bt,pos:Nt}=this;return e.length=xt,e.pos=Nt,e.finished=kt,e.destroyed=Bt,xt%_t&&e.buffer.set(At),e}};const SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$4=class extends HashMD$1{constructor(){super(64,32,8,!1),this.A=SHA256_IV$1[0]|0,this.B=SHA256_IV$1[1]|0,this.C=SHA256_IV$1[2]|0,this.D=SHA256_IV$1[3]|0,this.E=SHA256_IV$1[4]|0,this.F=SHA256_IV$1[5]|0,this.G=SHA256_IV$1[6]|0,this.H=SHA256_IV$1[7]|0}get(){const{A:e,B:_t,C:At,D:xt,E:kt,F:Bt,G:Nt,H:Ut}=this;return[e,_t,At,xt,kt,Bt,Nt,Ut]}set(e,_t,At,xt,kt,Bt,Nt,Ut){this.A=e|0,this.B=_t|0,this.C=At|0,this.D=xt|0,this.E=kt|0,this.F=Bt|0,this.G=Nt|0,this.H=Ut|0}process(e,_t){for(let Kt=0;Kt<16;Kt++,_t+=4)SHA256_W$2[Kt]=e.getUint32(_t,!1);for(let Kt=16;Kt<64;Kt++){const qt=SHA256_W$2[Kt-15],zt=SHA256_W$2[Kt-2],Vt=rotr$1(qt,7)^rotr$1(qt,18)^qt>>>3,Ht=rotr$1(zt,17)^rotr$1(zt,19)^zt>>>10;SHA256_W$2[Kt]=Ht+SHA256_W$2[Kt-7]+Vt+SHA256_W$2[Kt-16]|0}let{A:At,B:xt,C:kt,D:Bt,E:Nt,F:Ut,G:Lt,H:jt}=this;for(let Kt=0;Kt<64;Kt++){const qt=rotr$1(Nt,6)^rotr$1(Nt,11)^rotr$1(Nt,25),zt=jt+qt+Chi$2(Nt,Ut,Lt)+SHA256_K$2[Kt]+SHA256_W$2[Kt]|0,Ht=(rotr$1(At,2)^rotr$1(At,13)^rotr$1(At,22))+Maj$2(At,xt,kt)|0;jt=Lt,Lt=Ut,Ut=Nt,Nt=Bt+zt|0,Bt=kt,kt=xt,xt=At,At=zt+Ht|0}At=At+this.A|0,xt=xt+this.B|0,kt=kt+this.C|0,Bt=Bt+this.D|0,Nt=Nt+this.E|0,Ut=Ut+this.F|0,Lt=Lt+this.G|0,jt=jt+this.H|0,this.set(At,xt,kt,Bt,Nt,Ut,Lt,jt)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},SHA224$2=class extends SHA256$4{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const sha256$5=wrapConstructor$1(()=>new SHA256$4),sha224$2=wrapConstructor$1(()=>new SHA224$2),sha256$6=Object.freeze(Object.defineProperty({__proto__:null,sha224:sha224$2,sha256:sha256$5},Symbol.toStringTag,{value:"Module"}));let HMAC$1=class extends Hash$9{constructor(e,_t){super(),this.finished=!1,this.destroyed=!1,hash$7(e);const At=toBytes$3(_t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const xt=this.blockLen,kt=new Uint8Array(xt);kt.set(At.length>xt?e.create().update(At).digest():At);for(let Bt=0;Bt<kt.length;Bt++)kt[Bt]^=54;this.iHash.update(kt),this.oHash=e.create();for(let Bt=0;Bt<kt.length;Bt++)kt[Bt]^=106;this.oHash.update(kt),kt.fill(0)}update(e){return exists$6(this),this.iHash.update(e),this}digestInto(e){exists$6(this),bytes$5(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:_t,iHash:At,finished:xt,destroyed:kt,blockLen:Bt,outputLen:Nt}=this;return e=e,e.finished=xt,e.destroyed=kt,e.blockLen=Bt,e.outputLen=Nt,e.oHash=_t._cloneInto(e.oHash),e.iHash=At._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$3=($t,e,_t)=>new HMAC$1($t,e).update(_t).digest();hmac$3.create=($t,e)=>new HMAC$1($t,e);const hmac$4=Object.freeze(Object.defineProperty({__proto__:null,HMAC:HMAC$1,hmac:hmac$3},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$e=BigInt(0),_1n$g=BigInt(1),_2n$9=BigInt(2);function isBytes$9($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}function abytes$1($t){if(!isBytes$9($t))throw new Error("Uint8Array expected")}const hexes$3=Array.from({length:256},($t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$3($t){abytes$1($t);let e="";for(let _t=0;_t<$t.length;_t++)e+=hexes$3[$t[_t]];return e}function numberToHexUnpadded$2($t){const e=$t.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$2($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);return BigInt($t===""?"0":`0x${$t}`)}const asciis$3={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$3($t){if($t>=asciis$3._0&&$t<=asciis$3._9)return $t-asciis$3._0;if($t>=asciis$3._A&&$t<=asciis$3._F)return $t-(asciis$3._A-10);if($t>=asciis$3._a&&$t<=asciis$3._f)return $t-(asciis$3._a-10)}function hexToBytes$3($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);const e=$t.length,_t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const At=new Uint8Array(_t);for(let xt=0,kt=0;xt<_t;xt++,kt+=2){const Bt=asciiToBase16$3($t.charCodeAt(kt)),Nt=asciiToBase16$3($t.charCodeAt(kt+1));if(Bt===void 0||Nt===void 0){const Ut=$t[kt]+$t[kt+1];throw new Error('hex string expected, got non-hex character "'+Ut+'" at index '+kt)}At[xt]=Bt*16+Nt}return At}function bytesToNumberBE$2($t){return hexToNumber$2(bytesToHex$3($t))}function bytesToNumberLE$2($t){return abytes$1($t),hexToNumber$2(bytesToHex$3(Uint8Array.from($t).reverse()))}function numberToBytesBE$2($t,e){return hexToBytes$3($t.toString(16).padStart(e*2,"0"))}function numberToBytesLE$2($t,e){return numberToBytesBE$2($t,e).reverse()}function numberToVarBytesBE$2($t){return hexToBytes$3(numberToHexUnpadded$2($t))}function ensureBytes$4($t,e,_t){let At;if(typeof e=="string")try{At=hexToBytes$3(e)}catch(kt){throw new Error(`${$t} must be valid hex string, got "${e}". Cause: ${kt}`)}else if(isBytes$9(e))At=Uint8Array.from(e);else throw new Error(`${$t} must be hex string or Uint8Array`);const xt=At.length;if(typeof _t=="number"&&xt!==_t)throw new Error(`${$t} expected ${_t} bytes, got ${xt}`);return At}function concatBytes$3(...$t){let e=0;for(let At=0;At<$t.length;At++){const xt=$t[At];abytes$1(xt),e+=xt.length}const _t=new Uint8Array(e);for(let At=0,xt=0;At<$t.length;At++){const kt=$t[At];_t.set(kt,xt),xt+=kt.length}return _t}function equalBytes$3($t,e){if($t.length!==e.length)return!1;let _t=0;for(let At=0;At<$t.length;At++)_t|=$t[At]^e[At];return _t===0}function utf8ToBytes$6($t){if(typeof $t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function bitLen$2($t){let e;for(e=0;$t>_0n$e;$t>>=_1n$g,e+=1);return e}function bitGet$2($t,e){return $t>>BigInt(e)&_1n$g}function bitSet$2($t,e,_t){return $t|(_t?_1n$g:_0n$e)<<BigInt(e)}const bitMask$2=$t=>(_2n$9<<BigInt($t-1))-_1n$g,u8n$2=$t=>new Uint8Array($t),u8fr$2=$t=>Uint8Array.from($t);function createHmacDrbg$2($t,e,_t){if(typeof $t!="number"||$t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof _t!="function")throw new Error("hmacFn must be a function");let At=u8n$2($t),xt=u8n$2($t),kt=0;const Bt=()=>{At.fill(1),xt.fill(0),kt=0},Nt=(...Kt)=>_t(xt,At,...Kt),Ut=(Kt=u8n$2())=>{xt=Nt(u8fr$2([0]),Kt),At=Nt(),Kt.length!==0&&(xt=Nt(u8fr$2([1]),Kt),At=Nt())},Lt=()=>{if(kt++>=1e3)throw new Error("drbg: tried 1000 values");let Kt=0;const qt=[];for(;Kt<e;){At=Nt();const zt=At.slice();qt.push(zt),Kt+=At.length}return concatBytes$3(...qt)};return(Kt,qt)=>{Bt(),Ut(Kt);let zt;for(;!(zt=qt(Lt()));)Ut();return Bt(),zt}}const validatorFns$2={bigint:$t=>typeof $t=="bigint",function:$t=>typeof $t=="function",boolean:$t=>typeof $t=="boolean",string:$t=>typeof $t=="string",stringOrUint8Array:$t=>typeof $t=="string"||isBytes$9($t),isSafeInteger:$t=>Number.isSafeInteger($t),array:$t=>Array.isArray($t),field:($t,e)=>e.Fp.isValid($t),hash:$t=>typeof $t=="function"&&Number.isSafeInteger($t.outputLen)};function validateObject$8($t,e,_t={}){const At=(xt,kt,Bt)=>{const Nt=validatorFns$2[kt];if(typeof Nt!="function")throw new Error(`Invalid validator "${kt}", expected function`);const Ut=$t[xt];if(!(Bt&&Ut===void 0)&&!Nt(Ut,$t))throw new Error(`Invalid param ${String(xt)}=${Ut} (${typeof Ut}), expected ${kt}`)};for(const[xt,kt]of Object.entries(e))At(xt,kt,!1);for(const[xt,kt]of Object.entries(_t))At(xt,kt,!0);return $t}const ut$2=Object.freeze(Object.defineProperty({__proto__:null,abytes:abytes$1,bitGet:bitGet$2,bitLen:bitLen$2,bitMask:bitMask$2,bitSet:bitSet$2,bytesToHex:bytesToHex$3,bytesToNumberBE:bytesToNumberBE$2,bytesToNumberLE:bytesToNumberLE$2,concatBytes:concatBytes$3,createHmacDrbg:createHmacDrbg$2,ensureBytes:ensureBytes$4,equalBytes:equalBytes$3,hexToBytes:hexToBytes$3,hexToNumber:hexToNumber$2,isBytes:isBytes$9,numberToBytesBE:numberToBytesBE$2,numberToBytesLE:numberToBytesLE$2,numberToHexUnpadded:numberToHexUnpadded$2,numberToVarBytesBE:numberToVarBytesBE$2,utf8ToBytes:utf8ToBytes$6,validateObject:validateObject$8},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$d=BigInt(0),_1n$f=BigInt(1),_2n$8=BigInt(2),_3n$4=BigInt(3),_4n$2=BigInt(4),_5n$3=BigInt(5),_8n$4=BigInt(8);BigInt(9);BigInt(16);function mod$2($t,e){const _t=$t%e;return _t>=_0n$d?_t:e+_t}function pow$2($t,e,_t){if(_t<=_0n$d||e<_0n$d)throw new Error("Expected power/modulo > 0");if(_t===_1n$f)return _0n$d;let At=_1n$f;for(;e>_0n$d;)e&_1n$f&&(At=At*$t%_t),$t=$t*$t%_t,e>>=_1n$f;return At}function invert$2($t,e){if($t===_0n$d||e<=_0n$d)throw new Error(`invert: expected positive integers, got n=${$t} mod=${e}`);let _t=mod$2($t,e),At=e,xt=_0n$d,kt=_1n$f;for(;_t!==_0n$d;){const Nt=At/_t,Ut=At%_t,Lt=xt-kt*Nt;At=_t,_t=Ut,xt=kt,kt=Lt}if(At!==_1n$f)throw new Error("invert: does not exist");return mod$2(xt,e)}function tonelliShanks$2($t){const e=($t-_1n$f)/_2n$8;let _t,At,xt;for(_t=$t-_1n$f,At=0;_t%_2n$8===_0n$d;_t/=_2n$8,At++);for(xt=_2n$8;xt<$t&&pow$2(xt,e,$t)!==$t-_1n$f;xt++);if(At===1){const Bt=($t+_1n$f)/_4n$2;return function(Ut,Lt){const jt=Ut.pow(Lt,Bt);if(!Ut.eql(Ut.sqr(jt),Lt))throw new Error("Cannot find square root");return jt}}const kt=(_t+_1n$f)/_2n$8;return function(Nt,Ut){if(Nt.pow(Ut,e)===Nt.neg(Nt.ONE))throw new Error("Cannot find square root");let Lt=At,jt=Nt.pow(Nt.mul(Nt.ONE,xt),_t),Kt=Nt.pow(Ut,kt),qt=Nt.pow(Ut,_t);for(;!Nt.eql(qt,Nt.ONE);){if(Nt.eql(qt,Nt.ZERO))return Nt.ZERO;let zt=1;for(let Ht=Nt.sqr(qt);zt<Lt&&!Nt.eql(Ht,Nt.ONE);zt++)Ht=Nt.sqr(Ht);const Vt=Nt.pow(jt,_1n$f<<BigInt(Lt-zt-1));jt=Nt.sqr(Vt),Kt=Nt.mul(Kt,Vt),qt=Nt.mul(qt,jt),Lt=zt}return Kt}}function FpSqrt$2($t){if($t%_4n$2===_3n$4){const e=($t+_1n$f)/_4n$2;return function(At,xt){const kt=At.pow(xt,e);if(!At.eql(At.sqr(kt),xt))throw new Error("Cannot find square root");return kt}}if($t%_8n$4===_5n$3){const e=($t-_5n$3)/_8n$4;return function(At,xt){const kt=At.mul(xt,_2n$8),Bt=At.pow(kt,e),Nt=At.mul(xt,Bt),Ut=At.mul(At.mul(Nt,_2n$8),Bt),Lt=At.mul(Nt,At.sub(Ut,At.ONE));if(!At.eql(At.sqr(Lt),xt))throw new Error("Cannot find square root");return Lt}}return tonelliShanks$2($t)}const FIELD_FIELDS$2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$2($t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},_t=FIELD_FIELDS$2.reduce((At,xt)=>(At[xt]="function",At),e);return validateObject$8($t,_t)}function FpPow$2($t,e,_t){if(_t<_0n$d)throw new Error("Expected power > 0");if(_t===_0n$d)return $t.ONE;if(_t===_1n$f)return e;let At=$t.ONE,xt=e;for(;_t>_0n$d;)_t&_1n$f&&(At=$t.mul(At,xt)),xt=$t.sqr(xt),_t>>=_1n$f;return At}function FpInvertBatch$2($t,e){const _t=new Array(e.length),At=e.reduce((kt,Bt,Nt)=>$t.is0(Bt)?kt:(_t[Nt]=kt,$t.mul(kt,Bt)),$t.ONE),xt=$t.inv(At);return e.reduceRight((kt,Bt,Nt)=>$t.is0(Bt)?kt:(_t[Nt]=$t.mul(kt,_t[Nt]),$t.mul(kt,Bt)),xt),_t}function nLength$2($t,e){const _t=e!==void 0?e:$t.toString(2).length,At=Math.ceil(_t/8);return{nBitLength:_t,nByteLength:At}}function Field$2($t,e,_t=!1,At={}){if($t<=_0n$d)throw new Error(`Expected Field ORDER > 0, got ${$t}`);const{nBitLength:xt,nByteLength:kt}=nLength$2($t,e);if(kt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const Bt=FpSqrt$2($t),Nt=Object.freeze({ORDER:$t,BITS:xt,BYTES:kt,MASK:bitMask$2(xt),ZERO:_0n$d,ONE:_1n$f,create:Ut=>mod$2(Ut,$t),isValid:Ut=>{if(typeof Ut!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof Ut}`);return _0n$d<=Ut&&Ut<$t},is0:Ut=>Ut===_0n$d,isOdd:Ut=>(Ut&_1n$f)===_1n$f,neg:Ut=>mod$2(-Ut,$t),eql:(Ut,Lt)=>Ut===Lt,sqr:Ut=>mod$2(Ut*Ut,$t),add:(Ut,Lt)=>mod$2(Ut+Lt,$t),sub:(Ut,Lt)=>mod$2(Ut-Lt,$t),mul:(Ut,Lt)=>mod$2(Ut*Lt,$t),pow:(Ut,Lt)=>FpPow$2(Nt,Ut,Lt),div:(Ut,Lt)=>mod$2(Ut*invert$2(Lt,$t),$t),sqrN:Ut=>Ut*Ut,addN:(Ut,Lt)=>Ut+Lt,subN:(Ut,Lt)=>Ut-Lt,mulN:(Ut,Lt)=>Ut*Lt,inv:Ut=>invert$2(Ut,$t),sqrt:At.sqrt||(Ut=>Bt(Nt,Ut)),invertBatch:Ut=>FpInvertBatch$2(Nt,Ut),cmov:(Ut,Lt,jt)=>jt?Lt:Ut,toBytes:Ut=>_t?numberToBytesLE$2(Ut,kt):numberToBytesBE$2(Ut,kt),fromBytes:Ut=>{if(Ut.length!==kt)throw new Error(`Fp.fromBytes: expected ${kt}, got ${Ut.length}`);return _t?bytesToNumberLE$2(Ut):bytesToNumberBE$2(Ut)}});return Object.freeze(Nt)}function getFieldBytesLength$2($t){if(typeof $t!="bigint")throw new Error("field order must be bigint");const e=$t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$2($t){const e=getFieldBytesLength$2($t);return e+Math.ceil(e/2)}function mapHashToField$2($t,e,_t=!1){const At=$t.length,xt=getFieldBytesLength$2(e),kt=getMinHashLength$2(e);if(At<16||At<kt||At>1024)throw new Error(`expected ${kt}-1024 bytes of input, got ${At}`);const Bt=_t?bytesToNumberBE$2($t):bytesToNumberLE$2($t),Nt=mod$2(Bt,e-_1n$f)+_1n$f;return _t?numberToBytesLE$2(Nt,xt):numberToBytesBE$2(Nt,xt)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$c=BigInt(0),_1n$e=BigInt(1);function wNAF$2($t,e){const _t=(xt,kt)=>{const Bt=kt.negate();return xt?Bt:kt},At=xt=>{const kt=Math.ceil(e/xt)+1,Bt=2**(xt-1);return{windows:kt,windowSize:Bt}};return{constTimeNegate:_t,unsafeLadder(xt,kt){let Bt=$t.ZERO,Nt=xt;for(;kt>_0n$c;)kt&_1n$e&&(Bt=Bt.add(Nt)),Nt=Nt.double(),kt>>=_1n$e;return Bt},precomputeWindow(xt,kt){const{windows:Bt,windowSize:Nt}=At(kt),Ut=[];let Lt=xt,jt=Lt;for(let Kt=0;Kt<Bt;Kt++){jt=Lt,Ut.push(jt);for(let qt=1;qt<Nt;qt++)jt=jt.add(Lt),Ut.push(jt);Lt=jt.double()}return Ut},wNAF(xt,kt,Bt){const{windows:Nt,windowSize:Ut}=At(xt);let Lt=$t.ZERO,jt=$t.BASE;const Kt=BigInt(2**xt-1),qt=2**xt,zt=BigInt(xt);for(let Vt=0;Vt<Nt;Vt++){const Ht=Vt*Ut;let Wt=Number(Bt&Kt);Bt>>=zt,Wt>Ut&&(Wt-=qt,Bt+=_1n$e);const Qt=Ht,Xt=Ht+Math.abs(Wt)-1,Jt=Vt%2!==0,tr=Wt<0;Wt===0?jt=jt.add(_t(Jt,kt[Qt])):Lt=Lt.add(_t(tr,kt[Xt]))}return{p:Lt,f:jt}},wNAFCached(xt,kt,Bt,Nt){const Ut=xt._WINDOW_SIZE||1;let Lt=kt.get(xt);return Lt||(Lt=this.precomputeWindow(xt,Ut),Ut!==1&&kt.set(xt,Nt(Lt))),this.wNAF(Ut,Lt,Bt)}}}function validateBasic$2($t){return validateField$2($t.Fp),validateObject$8($t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$2($t.n,$t.nBitLength),...$t,p:$t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1($t){const e=validateBasic$2($t);validateObject$8(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:_t,Fp:At,a:xt}=e;if(_t){if(!At.eql(xt,At.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof _t!="object"||typeof _t.beta!="bigint"||typeof _t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b$1}=ut$2,DER$1={Err:class extends Error{constructor(e=""){super(e)}},_parseInt($t){const{Err:e}=DER$1;if($t.length<2||$t[0]!==2)throw new e("Invalid signature integer tag");const _t=$t[1],At=$t.subarray(2,_t+2);if(!_t||At.length!==_t)throw new e("Invalid signature integer: wrong length");if(At[0]&128)throw new e("Invalid signature integer: negative");if(At[0]===0&&!(At[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n$1(At),l:$t.subarray(_t+2)}},toSig($t){const{Err:e}=DER$1,_t=typeof $t=="string"?h2b$1($t):$t;abytes$1(_t);let At=_t.length;if(At<2||_t[0]!=48)throw new e("Invalid signature tag");if(_t[1]!==At-2)throw new e("Invalid signature: incorrect length");const{d:xt,l:kt}=DER$1._parseInt(_t.subarray(2)),{d:Bt,l:Nt}=DER$1._parseInt(kt);if(Nt.length)throw new e("Invalid signature: left bytes after parsing");return{r:xt,s:Bt}},hexFromSig($t){const e=Lt=>Number.parseInt(Lt[0],16)&8?"00"+Lt:Lt,_t=Lt=>{const jt=Lt.toString(16);return jt.length&1?`0${jt}`:jt},At=e(_t($t.s)),xt=e(_t($t.r)),kt=At.length/2,Bt=xt.length/2,Nt=_t(kt),Ut=_t(Bt);return`30${_t(Bt+kt+4)}02${Ut}${xt}02${Nt}${At}`}},_0n$b=BigInt(0),_1n$d=BigInt(1);BigInt(2);const _3n$3=BigInt(3);BigInt(4);function weierstrassPoints$1($t){const e=validatePointOpts$1($t),{Fp:_t}=e,At=e.toBytes||((Vt,Ht,Wt)=>{const Qt=Ht.toAffine();return concatBytes$3(Uint8Array.from([4]),_t.toBytes(Qt.x),_t.toBytes(Qt.y))}),xt=e.fromBytes||(Vt=>{const Ht=Vt.subarray(1),Wt=_t.fromBytes(Ht.subarray(0,_t.BYTES)),Qt=_t.fromBytes(Ht.subarray(_t.BYTES,2*_t.BYTES));return{x:Wt,y:Qt}});function kt(Vt){const{a:Ht,b:Wt}=e,Qt=_t.sqr(Vt),Xt=_t.mul(Qt,Vt);return _t.add(_t.add(Xt,_t.mul(Vt,Ht)),Wt)}if(!_t.eql(_t.sqr(e.Gy),kt(e.Gx)))throw new Error("bad generator point: equation left != right");function Bt(Vt){return typeof Vt=="bigint"&&_0n$b<Vt&&Vt<e.n}function Nt(Vt){if(!Bt(Vt))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function Ut(Vt){const{allowedPrivateKeyLengths:Ht,nByteLength:Wt,wrapPrivateKey:Qt,n:Xt}=e;if(Ht&&typeof Vt!="bigint"){if(isBytes$9(Vt)&&(Vt=bytesToHex$3(Vt)),typeof Vt!="string"||!Ht.includes(Vt.length))throw new Error("Invalid key");Vt=Vt.padStart(Wt*2,"0")}let Jt;try{Jt=typeof Vt=="bigint"?Vt:bytesToNumberBE$2(ensureBytes$4("private key",Vt,Wt))}catch{throw new Error(`private key must be ${Wt} bytes, hex or bigint, not ${typeof Vt}`)}return Qt&&(Jt=mod$2(Jt,Xt)),Nt(Jt),Jt}const Lt=new Map;function jt(Vt){if(!(Vt instanceof Kt))throw new Error("ProjectivePoint expected")}class Kt{constructor(Ht,Wt,Qt){if(this.px=Ht,this.py=Wt,this.pz=Qt,Ht==null||!_t.isValid(Ht))throw new Error("x required");if(Wt==null||!_t.isValid(Wt))throw new Error("y required");if(Qt==null||!_t.isValid(Qt))throw new Error("z required")}static fromAffine(Ht){const{x:Wt,y:Qt}=Ht||{};if(!Ht||!_t.isValid(Wt)||!_t.isValid(Qt))throw new Error("invalid affine point");if(Ht instanceof Kt)throw new Error("projective point not allowed");const Xt=Jt=>_t.eql(Jt,_t.ZERO);return Xt(Wt)&&Xt(Qt)?Kt.ZERO:new Kt(Wt,Qt,_t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(Ht){const Wt=_t.invertBatch(Ht.map(Qt=>Qt.pz));return Ht.map((Qt,Xt)=>Qt.toAffine(Wt[Xt])).map(Kt.fromAffine)}static fromHex(Ht){const Wt=Kt.fromAffine(xt(ensureBytes$4("pointHex",Ht)));return Wt.assertValidity(),Wt}static fromPrivateKey(Ht){return Kt.BASE.multiply(Ut(Ht))}_setWindowSize(Ht){this._WINDOW_SIZE=Ht,Lt.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!_t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:Ht,y:Wt}=this.toAffine();if(!_t.isValid(Ht)||!_t.isValid(Wt))throw new Error("bad point: x or y not FE");const Qt=_t.sqr(Wt),Xt=kt(Ht);if(!_t.eql(Qt,Xt))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:Ht}=this.toAffine();if(_t.isOdd)return!_t.isOdd(Ht);throw new Error("Field doesn't support isOdd")}equals(Ht){jt(Ht);const{px:Wt,py:Qt,pz:Xt}=this,{px:Jt,py:tr,pz:dr}=Ht,vr=_t.eql(_t.mul(Wt,dr),_t.mul(Jt,Xt)),$r=_t.eql(_t.mul(Qt,dr),_t.mul(tr,Xt));return vr&&$r}negate(){return new Kt(this.px,_t.neg(this.py),this.pz)}double(){const{a:Ht,b:Wt}=e,Qt=_t.mul(Wt,_3n$3),{px:Xt,py:Jt,pz:tr}=this;let dr=_t.ZERO,vr=_t.ZERO,$r=_t.ZERO,Ir=_t.mul(Xt,Xt),Rr=_t.mul(Jt,Jt),Nr=_t.mul(tr,tr),kr=_t.mul(Xt,Jt);return kr=_t.add(kr,kr),$r=_t.mul(Xt,tr),$r=_t.add($r,$r),dr=_t.mul(Ht,$r),vr=_t.mul(Qt,Nr),vr=_t.add(dr,vr),dr=_t.sub(Rr,vr),vr=_t.add(Rr,vr),vr=_t.mul(dr,vr),dr=_t.mul(kr,dr),$r=_t.mul(Qt,$r),Nr=_t.mul(Ht,Nr),kr=_t.sub(Ir,Nr),kr=_t.mul(Ht,kr),kr=_t.add(kr,$r),$r=_t.add(Ir,Ir),Ir=_t.add($r,Ir),Ir=_t.add(Ir,Nr),Ir=_t.mul(Ir,kr),vr=_t.add(vr,Ir),Nr=_t.mul(Jt,tr),Nr=_t.add(Nr,Nr),Ir=_t.mul(Nr,kr),dr=_t.sub(dr,Ir),$r=_t.mul(Nr,Rr),$r=_t.add($r,$r),$r=_t.add($r,$r),new Kt(dr,vr,$r)}add(Ht){jt(Ht);const{px:Wt,py:Qt,pz:Xt}=this,{px:Jt,py:tr,pz:dr}=Ht;let vr=_t.ZERO,$r=_t.ZERO,Ir=_t.ZERO;const Rr=e.a,Nr=_t.mul(e.b,_3n$3);let kr=_t.mul(Wt,Jt),lr=_t.mul(Qt,tr),ir=_t.mul(Xt,dr),er=_t.add(Wt,Qt),rr=_t.add(Jt,tr);er=_t.mul(er,rr),rr=_t.add(kr,lr),er=_t.sub(er,rr),rr=_t.add(Wt,Xt);let yr=_t.add(Jt,dr);return rr=_t.mul(rr,yr),yr=_t.add(kr,ir),rr=_t.sub(rr,yr),yr=_t.add(Qt,Xt),vr=_t.add(tr,dr),yr=_t.mul(yr,vr),vr=_t.add(lr,ir),yr=_t.sub(yr,vr),Ir=_t.mul(Rr,rr),vr=_t.mul(Nr,ir),Ir=_t.add(vr,Ir),vr=_t.sub(lr,Ir),Ir=_t.add(lr,Ir),$r=_t.mul(vr,Ir),lr=_t.add(kr,kr),lr=_t.add(lr,kr),ir=_t.mul(Rr,ir),rr=_t.mul(Nr,rr),lr=_t.add(lr,ir),ir=_t.sub(kr,ir),ir=_t.mul(Rr,ir),rr=_t.add(rr,ir),kr=_t.mul(lr,rr),$r=_t.add($r,kr),kr=_t.mul(yr,rr),vr=_t.mul(er,vr),vr=_t.sub(vr,kr),kr=_t.mul(er,lr),Ir=_t.mul(yr,Ir),Ir=_t.add(Ir,kr),new Kt(vr,$r,Ir)}subtract(Ht){return this.add(Ht.negate())}is0(){return this.equals(Kt.ZERO)}wNAF(Ht){return zt.wNAFCached(this,Lt,Ht,Wt=>{const Qt=_t.invertBatch(Wt.map(Xt=>Xt.pz));return Wt.map((Xt,Jt)=>Xt.toAffine(Qt[Jt])).map(Kt.fromAffine)})}multiplyUnsafe(Ht){const Wt=Kt.ZERO;if(Ht===_0n$b)return Wt;if(Nt(Ht),Ht===_1n$d)return this;const{endo:Qt}=e;if(!Qt)return zt.unsafeLadder(this,Ht);let{k1neg:Xt,k1:Jt,k2neg:tr,k2:dr}=Qt.splitScalar(Ht),vr=Wt,$r=Wt,Ir=this;for(;Jt>_0n$b||dr>_0n$b;)Jt&_1n$d&&(vr=vr.add(Ir)),dr&_1n$d&&($r=$r.add(Ir)),Ir=Ir.double(),Jt>>=_1n$d,dr>>=_1n$d;return Xt&&(vr=vr.negate()),tr&&($r=$r.negate()),$r=new Kt(_t.mul($r.px,Qt.beta),$r.py,$r.pz),vr.add($r)}multiply(Ht){Nt(Ht);let Wt=Ht,Qt,Xt;const{endo:Jt}=e;if(Jt){const{k1neg:tr,k1:dr,k2neg:vr,k2:$r}=Jt.splitScalar(Wt);let{p:Ir,f:Rr}=this.wNAF(dr),{p:Nr,f:kr}=this.wNAF($r);Ir=zt.constTimeNegate(tr,Ir),Nr=zt.constTimeNegate(vr,Nr),Nr=new Kt(_t.mul(Nr.px,Jt.beta),Nr.py,Nr.pz),Qt=Ir.add(Nr),Xt=Rr.add(kr)}else{const{p:tr,f:dr}=this.wNAF(Wt);Qt=tr,Xt=dr}return Kt.normalizeZ([Qt,Xt])[0]}multiplyAndAddUnsafe(Ht,Wt,Qt){const Xt=Kt.BASE,Jt=(dr,vr)=>vr===_0n$b||vr===_1n$d||!dr.equals(Xt)?dr.multiplyUnsafe(vr):dr.multiply(vr),tr=Jt(this,Wt).add(Jt(Ht,Qt));return tr.is0()?void 0:tr}toAffine(Ht){const{px:Wt,py:Qt,pz:Xt}=this,Jt=this.is0();Ht==null&&(Ht=Jt?_t.ONE:_t.inv(Xt));const tr=_t.mul(Wt,Ht),dr=_t.mul(Qt,Ht),vr=_t.mul(Xt,Ht);if(Jt)return{x:_t.ZERO,y:_t.ZERO};if(!_t.eql(vr,_t.ONE))throw new Error("invZ was invalid");return{x:tr,y:dr}}isTorsionFree(){const{h:Ht,isTorsionFree:Wt}=e;if(Ht===_1n$d)return!0;if(Wt)return Wt(Kt,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:Ht,clearCofactor:Wt}=e;return Ht===_1n$d?this:Wt?Wt(Kt,this):this.multiplyUnsafe(e.h)}toRawBytes(Ht=!0){return this.assertValidity(),At(Kt,this,Ht)}toHex(Ht=!0){return bytesToHex$3(this.toRawBytes(Ht))}}Kt.BASE=new Kt(e.Gx,e.Gy,_t.ONE),Kt.ZERO=new Kt(_t.ZERO,_t.ONE,_t.ZERO);const qt=e.nBitLength,zt=wNAF$2(Kt,e.endo?Math.ceil(qt/2):qt);return{CURVE:e,ProjectivePoint:Kt,normPrivateKeyToScalar:Ut,weierstrassEquation:kt,isWithinCurveOrder:Bt}}function validateOpts$5($t){const e=validateBasic$2($t);return validateObject$8(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$2($t){const e=validateOpts$5($t),{Fp:_t,n:At}=e,xt=_t.BYTES+1,kt=2*_t.BYTES+1;function Bt(rr){return _0n$b<rr&&rr<_t.ORDER}function Nt(rr){return mod$2(rr,At)}function Ut(rr){return invert$2(rr,At)}const{ProjectivePoint:Lt,normPrivateKeyToScalar:jt,weierstrassEquation:Kt,isWithinCurveOrder:qt}=weierstrassPoints$1({...e,toBytes(rr,yr,fr){const gr=yr.toAffine(),ar=_t.toBytes(gr.x),nr=concatBytes$3;return fr?nr(Uint8Array.from([yr.hasEvenY()?2:3]),ar):nr(Uint8Array.from([4]),ar,_t.toBytes(gr.y))},fromBytes(rr){const yr=rr.length,fr=rr[0],gr=rr.subarray(1);if(yr===xt&&(fr===2||fr===3)){const ar=bytesToNumberBE$2(gr);if(!Bt(ar))throw new Error("Point is not on curve");const nr=Kt(ar);let ur;try{ur=_t.sqrt(nr)}catch(Sr){const Pr=Sr instanceof Error?": "+Sr.message:"";throw new Error("Point is not on curve"+Pr)}const pr=(ur&_1n$d)===_1n$d;return(fr&1)===1!==pr&&(ur=_t.neg(ur)),{x:ar,y:ur}}else if(yr===kt&&fr===4){const ar=_t.fromBytes(gr.subarray(0,_t.BYTES)),nr=_t.fromBytes(gr.subarray(_t.BYTES,2*_t.BYTES));return{x:ar,y:nr}}else throw new Error(`Point of length ${yr} was invalid. Expected ${xt} compressed bytes or ${kt} uncompressed bytes`)}}),zt=rr=>bytesToHex$3(numberToBytesBE$2(rr,e.nByteLength));function Vt(rr){const yr=At>>_1n$d;return rr>yr}function Ht(rr){return Vt(rr)?Nt(-rr):rr}const Wt=(rr,yr,fr)=>bytesToNumberBE$2(rr.slice(yr,fr));class Qt{constructor(yr,fr,gr){this.r=yr,this.s=fr,this.recovery=gr,this.assertValidity()}static fromCompact(yr){const fr=e.nByteLength;return yr=ensureBytes$4("compactSignature",yr,fr*2),new Qt(Wt(yr,0,fr),Wt(yr,fr,2*fr))}static fromDER(yr){const{r:fr,s:gr}=DER$1.toSig(ensureBytes$4("DER",yr));return new Qt(fr,gr)}assertValidity(){if(!qt(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!qt(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(yr){return new Qt(this.r,this.s,yr)}recoverPublicKey(yr){const{r:fr,s:gr,recovery:ar}=this,nr=$r(ensureBytes$4("msgHash",yr));if(ar==null||![0,1,2,3].includes(ar))throw new Error("recovery id invalid");const ur=ar===2||ar===3?fr+e.n:fr;if(ur>=_t.ORDER)throw new Error("recovery id 2 or 3 invalid");const pr=ar&1?"03":"02",br=Lt.fromHex(pr+zt(ur)),Sr=Ut(ur),Pr=Nt(-nr*Sr),Tr=Nt(gr*Sr),wr=Lt.BASE.multiplyAndAddUnsafe(br,Pr,Tr);if(!wr)throw new Error("point at infinify");return wr.assertValidity(),wr}hasHighS(){return Vt(this.s)}normalizeS(){return this.hasHighS()?new Qt(this.r,Nt(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$3(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$3(this.toCompactHex())}toCompactHex(){return zt(this.r)+zt(this.s)}}const Xt={isValidPrivateKey(rr){try{return jt(rr),!0}catch{return!1}},normPrivateKeyToScalar:jt,randomPrivateKey:()=>{const rr=getMinHashLength$2(e.n);return mapHashToField$2(e.randomBytes(rr),e.n)},precompute(rr=8,yr=Lt.BASE){return yr._setWindowSize(rr),yr.multiply(BigInt(3)),yr}};function Jt(rr,yr=!0){return Lt.fromPrivateKey(rr).toRawBytes(yr)}function tr(rr){const yr=isBytes$9(rr),fr=typeof rr=="string",gr=(yr||fr)&&rr.length;return yr?gr===xt||gr===kt:fr?gr===2*xt||gr===2*kt:rr instanceof Lt}function dr(rr,yr,fr=!0){if(tr(rr))throw new Error("first arg must be private key");if(!tr(yr))throw new Error("second arg must be public key");return Lt.fromHex(yr).multiply(jt(rr)).toRawBytes(fr)}const vr=e.bits2int||function(rr){const yr=bytesToNumberBE$2(rr),fr=rr.length*8-e.nBitLength;return fr>0?yr>>BigInt(fr):yr},$r=e.bits2int_modN||function(rr){return Nt(vr(rr))},Ir=bitMask$2(e.nBitLength);function Rr(rr){if(typeof rr!="bigint")throw new Error("bigint expected");if(!(_0n$b<=rr&&rr<Ir))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE$2(rr,e.nByteLength)}function Nr(rr,yr,fr=kr){if(["recovered","canonical"].some(Mr=>Mr in fr))throw new Error("sign() legacy options not supported");const{hash:gr,randomBytes:ar}=e;let{lowS:nr,prehash:ur,extraEntropy:pr}=fr;nr==null&&(nr=!0),rr=ensureBytes$4("msgHash",rr),ur&&(rr=ensureBytes$4("prehashed msgHash",gr(rr)));const br=$r(rr),Sr=jt(yr),Pr=[Rr(Sr),Rr(br)];if(pr!=null&&pr!==!1){const Mr=pr===!0?ar(_t.BYTES):pr;Pr.push(ensureBytes$4("extraEntropy",Mr))}const Tr=concatBytes$3(...Pr),wr=br;function Ar(Mr){const Ur=vr(Mr);if(!qt(Ur))return;const Or=Ut(Ur),Cr=Lt.BASE.multiply(Ur).toAffine(),Er=Nt(Cr.x);if(Er===_0n$b)return;const Br=Nt(Or*Nt(wr+Er*Sr));if(Br===_0n$b)return;let Lr=(Cr.x===Er?0:2)|Number(Cr.y&_1n$d),xr=Br;return nr&&Vt(Br)&&(xr=Ht(Br),Lr^=1),new Qt(Er,xr,Lr)}return{seed:Tr,k2sig:Ar}}const kr={lowS:e.lowS,prehash:!1},lr={lowS:e.lowS,prehash:!1};function ir(rr,yr,fr=kr){const{seed:gr,k2sig:ar}=Nr(rr,yr,fr),nr=e;return createHmacDrbg$2(nr.hash.outputLen,nr.nByteLength,nr.hmac)(gr,ar)}Lt.BASE._setWindowSize(8);function er(rr,yr,fr,gr=lr){var Cr;const ar=rr;if(yr=ensureBytes$4("msgHash",yr),fr=ensureBytes$4("publicKey",fr),"strict"in gr)throw new Error("options.strict was renamed to lowS");const{lowS:nr,prehash:ur}=gr;let pr,br;try{if(typeof ar=="string"||isBytes$9(ar))try{pr=Qt.fromDER(ar)}catch(Er){if(!(Er instanceof DER$1.Err))throw Er;pr=Qt.fromCompact(ar)}else if(typeof ar=="object"&&typeof ar.r=="bigint"&&typeof ar.s=="bigint"){const{r:Er,s:Br}=ar;pr=new Qt(Er,Br)}else throw new Error("PARSE");br=Lt.fromHex(fr)}catch(Er){if(Er.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(nr&&pr.hasHighS())return!1;ur&&(yr=e.hash(yr));const{r:Sr,s:Pr}=pr,Tr=$r(yr),wr=Ut(Pr),Ar=Nt(Tr*wr),Mr=Nt(Sr*wr),Ur=(Cr=Lt.BASE.multiplyAndAddUnsafe(br,Ar,Mr))==null?void 0:Cr.toAffine();return Ur?Nt(Ur.x)===Sr:!1}return{CURVE:e,getPublicKey:Jt,getSharedSecret:dr,sign:ir,verify:er,ProjectivePoint:Lt,Signature:Qt,utils:Xt}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$2($t){return{hash:$t,hmac:(e,..._t)=>hmac$3($t,e,concatBytes$4(..._t)),randomBytes:randomBytes$6}}function createCurve$2($t,e){const _t=At=>weierstrass$2({...$t,...getHash$2(At)});return Object.freeze({..._t(e),create:_t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fp$3=Field$2(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),CURVE_A$1=Fp$3.create(BigInt("-3")),CURVE_B$1=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),p256$1=createCurve$2({a:CURVE_A$1,b:CURVE_B$1,Fp:Fp$3,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},sha256$5),secp256r1$1=p256$1;function equals$4($t,e){if($t===e)return!0;if($t.byteLength!==e.byteLength)return!1;for(let _t=0;_t<$t.byteLength;_t++)if($t[_t]!==e[_t])return!1;return!0}function alloc$3($t=0){return new Uint8Array($t)}function allocUnsafe$1($t=0){return new Uint8Array($t)}function asUint8Array$1($t){return $t}function concat$2($t,e){e==null&&(e=$t.reduce((xt,kt)=>xt+kt.length,0));const _t=allocUnsafe$1(e);let At=0;for(const xt of $t)_t.set(xt,At),At+=xt.length;return _t}const empty=new Uint8Array(0);function fromHex($t){const e=$t.match(/../g);return e!=null?new Uint8Array(e.map(_t=>parseInt(_t,16))):empty}function equals$3($t,e){if($t===e)return!0;if($t.byteLength!==e.byteLength)return!1;for(let _t=0;_t<$t.byteLength;_t++)if($t[_t]!==e[_t])return!1;return!0}function coerce$2($t){if($t instanceof Uint8Array&&$t.constructor.name==="Uint8Array")return $t;if($t instanceof ArrayBuffer)return new Uint8Array($t);if(ArrayBuffer.isView($t))return new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$4($t){return new TextEncoder().encode($t)}function toString$9($t){return new TextDecoder().decode($t)}function base$4($t,e){if($t.length>=255)throw new TypeError("Alphabet too long");for(var _t=new Uint8Array(256),At=0;At<_t.length;At++)_t[At]=255;for(var xt=0;xt<$t.length;xt++){var kt=$t.charAt(xt),Bt=kt.charCodeAt(0);if(_t[Bt]!==255)throw new TypeError(kt+" is ambiguous");_t[Bt]=xt}var Nt=$t.length,Ut=$t.charAt(0),Lt=Math.log(Nt)/Math.log(256),jt=Math.log(256)/Math.log(Nt);function Kt(Vt){if(Vt instanceof Uint8Array||(ArrayBuffer.isView(Vt)?Vt=new Uint8Array(Vt.buffer,Vt.byteOffset,Vt.byteLength):Array.isArray(Vt)&&(Vt=Uint8Array.from(Vt))),!(Vt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Vt.length===0)return"";for(var Ht=0,Wt=0,Qt=0,Xt=Vt.length;Qt!==Xt&&Vt[Qt]===0;)Qt++,Ht++;for(var Jt=(Xt-Qt)*jt+1>>>0,tr=new Uint8Array(Jt);Qt!==Xt;){for(var dr=Vt[Qt],vr=0,$r=Jt-1;(dr!==0||vr<Wt)&&$r!==-1;$r--,vr++)dr+=256*tr[$r]>>>0,tr[$r]=dr%Nt>>>0,dr=dr/Nt>>>0;if(dr!==0)throw new Error("Non-zero carry");Wt=vr,Qt++}for(var Ir=Jt-Wt;Ir!==Jt&&tr[Ir]===0;)Ir++;for(var Rr=Ut.repeat(Ht);Ir<Jt;++Ir)Rr+=$t.charAt(tr[Ir]);return Rr}function qt(Vt){if(typeof Vt!="string")throw new TypeError("Expected String");if(Vt.length===0)return new Uint8Array;var Ht=0;if(Vt[Ht]!==" "){for(var Wt=0,Qt=0;Vt[Ht]===Ut;)Wt++,Ht++;for(var Xt=(Vt.length-Ht)*Lt+1>>>0,Jt=new Uint8Array(Xt);Vt[Ht];){var tr=_t[Vt.charCodeAt(Ht)];if(tr===255)return;for(var dr=0,vr=Xt-1;(tr!==0||dr<Qt)&&vr!==-1;vr--,dr++)tr+=Nt*Jt[vr]>>>0,Jt[vr]=tr%256>>>0,tr=tr/256>>>0;if(tr!==0)throw new Error("Non-zero carry");Qt=dr,Ht++}if(Vt[Ht]!==" "){for(var $r=Xt-Qt;$r!==Xt&&Jt[$r]===0;)$r++;for(var Ir=new Uint8Array(Wt+(Xt-$r)),Rr=Wt;$r!==Xt;)Ir[Rr++]=Jt[$r++];return Ir}}}function zt(Vt){var Ht=qt(Vt);if(Ht)return Ht;throw new Error(`Non-${e} character`)}return{encode:Kt,decodeUnsafe:qt,decode:zt}}var src$2=base$4,_brrp__multiformats_scope_baseX$2=src$2;let Encoder$3=class{constructor(e,_t,At){sn(this,"name");sn(this,"prefix");sn(this,"baseEncode");this.name=e,this.prefix=_t,this.baseEncode=At}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{constructor(e,_t,At){sn(this,"name");sn(this,"prefix");sn(this,"baseDecode");sn(this,"prefixCodePoint");if(this.name=e,this.prefix=_t,_t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=_t.codePointAt(0),this.baseDecode=At}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$2(this,e)}},ComposedDecoder$2=class{constructor(e){sn(this,"decoders");this.decoders=e}or(e){return or$2(this,e)}decode(e){const _t=e[0],At=this.decoders[_t];if(At!=null)return At.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$2($t,e){return new ComposedDecoder$2({...$t.decoders??{[$t.prefix]:$t},...e.decoders??{[e.prefix]:e}})}let Codec$2=class{constructor(e,_t,At,xt){sn(this,"name");sn(this,"prefix");sn(this,"baseEncode");sn(this,"baseDecode");sn(this,"encoder");sn(this,"decoder");this.name=e,this.prefix=_t,this.baseEncode=At,this.baseDecode=xt,this.encoder=new Encoder$3(e,_t,At),this.decoder=new Decoder$2(e,_t,xt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$8({name:$t,prefix:e,encode:_t,decode:At}){return new Codec$2($t,e,_t,At)}function baseX$2({name:$t,prefix:e,alphabet:_t}){const{encode:At,decode:xt}=_brrp__multiformats_scope_baseX$2(_t,$t);return from$8({prefix:e,name:$t,encode:At,decode:kt=>coerce$2(xt(kt))})}function decode$l($t,e,_t,At){const xt={};for(let jt=0;jt<e.length;++jt)xt[e[jt]]=jt;let kt=$t.length;for(;$t[kt-1]==="=";)--kt;const Bt=new Uint8Array(kt*_t/8|0);let Nt=0,Ut=0,Lt=0;for(let jt=0;jt<kt;++jt){const Kt=xt[$t[jt]];if(Kt===void 0)throw new SyntaxError(`Non-${At} character`);Ut=Ut<<_t|Kt,Nt+=_t,Nt>=8&&(Nt-=8,Bt[Lt++]=255&Ut>>Nt)}if(Nt>=_t||255&Ut<<8-Nt)throw new SyntaxError("Unexpected end of data");return Bt}function encode$h($t,e,_t){const At=e[e.length-1]==="=",xt=(1<<_t)-1;let kt="",Bt=0,Nt=0;for(let Ut=0;Ut<$t.length;++Ut)for(Nt=Nt<<8|$t[Ut],Bt+=8;Bt>_t;)Bt-=_t,kt+=e[xt&Nt>>Bt];if(Bt!==0&&(kt+=e[xt&Nt<<_t-Bt]),At)for(;kt.length*_t&7;)kt+="=";return kt}function rfc4648$2({name:$t,prefix:e,bitsPerChar:_t,alphabet:At}){return from$8({prefix:e,name:$t,encode(xt){return encode$h(xt,At,_t)},decode(xt){return decode$l(xt,At,_t,$t)}})}const base10$2=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648$2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648$2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648$2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),alphabet$3=Array.from(""),alphabetBytesToChars$1=alphabet$3.reduce(($t,e,_t)=>($t[_t]=e,$t),[]),alphabetCharsToBytes$1=alphabet$3.reduce(($t,e,_t)=>($t[e.codePointAt(0)]=_t,$t),[]);function encode$g($t){return $t.reduce((e,_t)=>(e+=alphabetBytesToChars$1[_t],e),"")}function decode$k($t){const e=[];for(const _t of $t){const At=alphabetCharsToBytes$1[_t.codePointAt(0)];if(At===void 0)throw new Error(`Non-base256emoji character: ${_t}`);e.push(At)}return new Uint8Array(e)}const base256emoji$2=from$8({prefix:"",name:"base256emoji",encode:encode$g,decode:decode$k}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"})),base32$3=rfc4648$2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$3=rfc4648$2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$4=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$3,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$3},Symbol.toStringTag,{value:"Module"})),base36$2=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base58btc$3=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$3,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base64$2=rfc4648$2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648$2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$2=rfc4648$2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648$2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$3=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$2,base64pad:base64pad$1,base64url:base64url$2,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648$2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),identity$3=from$8({prefix:"\0",name:"identity",encode:$t=>toString$9($t),decode:$t=>fromString$4($t)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$3},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var encode_1$2=encode$f,MSB$4=128,REST$4=127,MSBALL$2=~REST$4,INT$2=Math.pow(2,31);function encode$f($t,e,_t){e=e||[],_t=_t||0;for(var At=_t;$t>=INT$2;)e[_t++]=$t&255|MSB$4,$t/=128;for(;$t&MSBALL$2;)e[_t++]=$t&255|MSB$4,$t>>>=7;return e[_t]=$t|0,encode$f.bytes=_t-At+1,e}var decode$j=read$3,MSB$1$2=128,REST$1$2=127;function read$3($t,At){var _t=0,At=At||0,xt=0,kt=At,Bt,Nt=$t.length;do{if(kt>=Nt)throw read$3.bytes=0,new RangeError("Could not decode varint");Bt=$t[kt++],_t+=xt<28?(Bt&REST$1$2)<<xt:(Bt&REST$1$2)*Math.pow(2,xt),xt+=7}while(Bt>=MSB$1$2);return read$3.bytes=kt-At,_t}var N1$3=Math.pow(2,7),N2$3=Math.pow(2,14),N3$3=Math.pow(2,21),N4$3=Math.pow(2,28),N5$3=Math.pow(2,35),N6$3=Math.pow(2,42),N7$3=Math.pow(2,49),N8$2=Math.pow(2,56),N9$2=Math.pow(2,63),length$3=function($t){return $t<N1$3?1:$t<N2$3?2:$t<N3$3?3:$t<N4$3?4:$t<N5$3?5:$t<N6$3?6:$t<N7$3?7:$t<N8$2?8:$t<N9$2?9:10},varint$2={encode:encode_1$2,decode:decode$j,encodingLength:length$3},_brrp_varint$2=varint$2;function decode$i($t,e=0){return[_brrp_varint$2.decode($t,e),_brrp_varint$2.decode.bytes]}function encodeTo$2($t,e,_t=0){return _brrp_varint$2.encode($t,e,_t),e}function encodingLength$7($t){return _brrp_varint$2.encodingLength($t)}function create$1($t,e){const _t=e.byteLength,At=encodingLength$7($t),xt=At+encodingLength$7(_t),kt=new Uint8Array(xt+_t);return encodeTo$2($t,kt,0),encodeTo$2(_t,kt,At),kt.set(e,xt),new Digest$1($t,_t,e,kt)}function decode$h($t){const e=coerce$2($t),[_t,At]=decode$i(e),[xt,kt]=decode$i(e.subarray(At)),Bt=e.subarray(At+kt);if(Bt.byteLength!==xt)throw new Error("Incorrect length");return new Digest$1(_t,xt,Bt,e)}function equals$2($t,e){if($t===e)return!0;{const _t=e;return $t.code===_t.code&&$t.size===_t.size&&_t.bytes instanceof Uint8Array&&equals$3($t.bytes,_t.bytes)}}let Digest$1=class{constructor(e,_t,At,xt){sn(this,"code");sn(this,"size");sn(this,"digest");sn(this,"bytes");this.code=e,this.size=_t,this.digest=At,this.bytes=xt}};function from$7({name:$t,code:e,encode:_t}){return new Hasher$1($t,e,_t)}let Hasher$1=class{constructor(e,_t,At){sn(this,"name");sn(this,"code");sn(this,"encode");this.name=e,this.code=_t,this.encode=At}digest(e){if(e instanceof Uint8Array){const _t=this.encode(e);return _t instanceof Uint8Array?create$1(this.code,_t):_t.then(At=>create$1(this.code,At))}else throw Error("Unknown type, must be binary type")}};function format$8($t,e){const{bytes:_t,version:At}=$t;switch(At){case 0:return toStringV0$2(_t,baseCache$2($t),e??base58btc$3.encoder);default:return toStringV1$2(_t,baseCache$2($t),e??base32$3.encoder)}}const cache$3=new WeakMap;function baseCache$2($t){const e=cache$3.get($t);if(e==null){const _t=new Map;return cache$3.set($t,_t),_t}return e}var jo;let CID$2=class ai{constructor(e,_t,At,xt){sn(this,"code");sn(this,"version");sn(this,"multihash");sn(this,"bytes");sn(this,"/");sn(this,jo,"CID");this.code=_t,this.version=e,this.multihash=At,this.bytes=xt,this["/"]=xt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:_t}=this;if(e!==DAG_PB_CODE$2)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(_t.code!==SHA_256_CODE$2)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ai.createV0(_t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:_t}=this.multihash,At=create$1(e,_t);return ai.createV1(this.code,At)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return ai.equals(this,e)}static equals(e,_t){const At=_t;return At!=null&&e.code===At.code&&e.version===At.version&&equals$2(e.multihash,At.multihash)}toString(e){return format$8(this,e)}toJSON(){return{"/":format$8(this)}}link(){return this}[(jo=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const _t=e;if(_t instanceof ai)return _t;if(_t["/"]!=null&&_t["/"]===_t.bytes||_t.asCID===_t){const{version:At,code:xt,multihash:kt,bytes:Bt}=_t;return new ai(At,xt,kt,Bt??encodeCID$2(At,xt,kt.bytes))}else if(_t[cidSymbol$2]===!0){const{version:At,multihash:xt,code:kt}=_t,Bt=decode$h(xt);return ai.create(At,kt,Bt)}else return null}static create(e,_t,At){if(typeof _t!="number")throw new Error("String codecs are no longer supported");if(!(At.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(_t!==DAG_PB_CODE$2)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$2}) block encoding`);return new ai(e,_t,At,At.bytes)}case 1:{const xt=encodeCID$2(e,_t,At.bytes);return new ai(e,_t,At,xt)}default:throw new Error("Invalid version")}}static createV0(e){return ai.create(0,DAG_PB_CODE$2,e)}static createV1(e,_t){return ai.create(1,e,_t)}static decode(e){const[_t,At]=ai.decodeFirst(e);if(At.length!==0)throw new Error("Incorrect length");return _t}static decodeFirst(e){const _t=ai.inspectBytes(e),At=_t.size-_t.multihashSize,xt=coerce$2(e.subarray(At,At+_t.multihashSize));if(xt.byteLength!==_t.multihashSize)throw new Error("Incorrect length");const kt=xt.subarray(_t.multihashSize-_t.digestSize),Bt=new Digest$1(_t.multihashCode,_t.digestSize,kt,xt);return[_t.version===0?ai.createV0(Bt):ai.createV1(_t.codec,Bt),e.subarray(_t.size)]}static inspectBytes(e){let _t=0;const At=()=>{const[Kt,qt]=decode$i(e.subarray(_t));return _t+=qt,Kt};let xt=At(),kt=DAG_PB_CODE$2;if(xt===18?(xt=0,_t=0):kt=At(),xt!==0&&xt!==1)throw new RangeError(`Invalid CID version ${xt}`);const Bt=_t,Nt=At(),Ut=At(),Lt=_t+Ut,jt=Lt-Bt;return{version:xt,codec:kt,multihashCode:Nt,digestSize:Ut,multihashSize:jt,size:Lt}}static parse(e,_t){const[At,xt]=parseCIDtoBytes$2(e,_t),kt=ai.decode(xt);if(kt.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache$2(kt).set(At,e),kt}};function parseCIDtoBytes$2($t,e){switch($t[0]){case"Q":{const _t=e??base58btc$3;return[base58btc$3.prefix,_t.decode(`${base58btc$3.prefix}${$t}`)]}case base58btc$3.prefix:{const _t=e??base58btc$3;return[base58btc$3.prefix,_t.decode($t)]}case base32$3.prefix:{const _t=e??base32$3;return[base32$3.prefix,_t.decode($t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[$t[0],e.decode($t)]}}}function toStringV0$2($t,e,_t){const{prefix:At}=_t;if(At!==base58btc$3.prefix)throw Error(`Cannot string encode V0 in ${_t.name} encoding`);const xt=e.get(At);if(xt==null){const kt=_t.encode($t).slice(1);return e.set(At,kt),kt}else return xt}function toStringV1$2($t,e,_t){const{prefix:At}=_t,xt=e.get(At);if(xt==null){const kt=_t.encode($t);return e.set(At,kt),kt}else return xt}const DAG_PB_CODE$2=112,SHA_256_CODE$2=18;function encodeCID$2($t,e,_t){const At=encodingLength$7($t),xt=At+encodingLength$7(e),kt=new Uint8Array(xt+_t.byteLength);return encodeTo$2($t,kt,0),encodeTo$2(e,kt,At),kt.set(_t,xt),kt}const cidSymbol$2=Symbol.for("@ipld/js-cid/CID"),bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$4,...base36$3,...base58$1,...base64$3,...base256emoji$3};function createCodec$2($t,e,_t,At){return{name:$t,prefix:e,encoder:{name:$t,prefix:e,encode:_t},decoder:{decode:At}}}const string$2=createCodec$2("utf8","u",$t=>"u"+new TextDecoder("utf8").decode($t),$t=>new TextEncoder().encode($t.substring(1))),ascii$1=createCodec$2("ascii","a",$t=>{let e="a";for(let _t=0;_t<$t.length;_t++)e+=String.fromCharCode($t[_t]);return e},$t=>{$t=$t.substring(1);const e=allocUnsafe$1($t.length);for(let _t=0;_t<$t.length;_t++)e[_t]=$t.charCodeAt(_t);return e}),BASES$1={utf8:string$2,"utf-8":string$2,hex:bases$1.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases$1};function fromString$3($t,e="utf8"){const _t=BASES$1[e];if(_t==null)throw new Error(`Unsupported encoding "${e}"`);return _t.decoder.decode(`${_t.prefix}${$t}`)}function toString$8($t,e="utf8"){const _t=BASES$1[e];if(_t==null)throw new Error(`Unsupported encoding "${e}"`);return _t.encoder.encode($t).substring(1)}var __awaiter$2G=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const u8a={toString:toString$8,fromString:fromString$3};let Secp256r1$3=class qi{static validateKey(e){if(e.kty!=="EC"||e.crv!=="P-256")throw new DwnError(DwnErrorCode.Secp256r1KeyNotValid,"Invalid SECP256R1 JWK: `kty` MUST be `EC`. `crv` MUST be `P-256`")}static publicKeyToJwk(e){return __awaiter$2G(this,void 0,void 0,function*(){let _t;e.byteLength===33?_t=p256$1.ProjectivePoint.fromHex(e).toRawBytes(!1):_t=e;const At=Encoder$4.bytesToBase64Url(_t.subarray(1,33)),xt=Encoder$4.bytesToBase64Url(_t.subarray(33,65));return{alg:"ES256",kty:"EC",crv:"P-256",x:At,y:xt}})}static privateJwkToBytes(e){return Encoder$4.base64UrlToBytes(e.d)}static sign(e,_t){return __awaiter$2G(this,void 0,void 0,function*(){qi.validateKey(_t);const At=yield sha256$7.encode(e),xt=qi.privateJwkToBytes(_t);return Promise.resolve(p256$1.sign(At,xt).toCompactRawBytes())})}static verify(e,_t,At){return __awaiter$2G(this,void 0,void 0,function*(){qi.validateKey(At);let xt;_t.length===64?xt=p256$1.Signature.fromCompact(_t):xt=p256$1.Signature.fromDER(_t);const kt=yield sha256$7.encode(e),Bt=p256$1.ProjectivePoint.fromAffine({x:qi.bytesToBigInt(Encoder$4.base64UrlToBytes(At.x)),y:qi.bytesToBigInt(Encoder$4.base64UrlToBytes(At.y))}).toRawBytes(!1);return p256$1.verify(xt,kt,Bt)})}static generateKeyPair(){return __awaiter$2G(this,void 0,void 0,function*(){const e=p256$1.utils.randomPrivateKey(),_t=secp256r1$1.getPublicKey(e,!1),At=Encoder$4.bytesToBase64Url(e),xt=yield qi.publicKeyToJwk(_t),kt=Object.assign(Object.assign({},xt),{d:At});return{publicJwk:xt,privateJwk:kt}})}static bytesToBigInt(e){return BigInt("0x"+u8a.toString(e,"base16"))}};const signatureAlgorithms={Ed25519:ed25519$2,secp256k1:{sign:Secp256k1$3.sign,verify:Secp256k1$3.verify,generateKeyPair:Secp256k1$3.generateKeyPair,publicKeyToJwk:Secp256k1$3.publicKeyToJwk},"P-256":{sign:Secp256r1$3.sign,verify:Secp256r1$3.verify,generateKeyPair:Secp256r1$3.generateKeyPair,publicKeyToJwk:Secp256r1$3.publicKeyToJwk}};var __awaiter$2F=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class PrivateKeySigner{constructor(e){var _t,At;if(e.keyId===void 0&&e.privateJwk.kid===void 0)throw new DwnError(DwnErrorCode.PrivateKeySignerUnableToDeduceKeyId,"Unable to deduce the key ID");if(e.algorithm===void 0&&e.privateJwk.alg===void 0)throw new DwnError(DwnErrorCode.PrivateKeySignerUnableToDeduceAlgorithm,"Unable to deduce the signature algorithm");if(this.keyId=(_t=e.keyId)!==null&&_t!==void 0?_t:e.privateJwk.kid,this.algorithm=(At=e.algorithm)!==null&&At!==void 0?At:e.privateJwk.alg,this.privateJwk=e.privateJwk,this.signatureAlgorithm=signatureAlgorithms[e.privateJwk.crv],!this.signatureAlgorithm)throw new DwnError(DwnErrorCode.PrivateKeySignerUnsupportedCurve,`Unsupported crv ${e.privateJwk.crv}, crv must be one of ${Object.keys(signatureAlgorithms)}`)}sign(e){return __awaiter$2F(this,void 0,void 0,function*(){return yield this.signatureAlgorithm.sign(e,this.privateJwk)})}}var __awaiter$2E=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Jws{static getKid(e){const{kid:_t}=Encoder$4.base64UrlToObject(e.protected);return _t}static getSignerDid(e){const _t=Jws.getKid(e);return Jws.extractDid(_t)}static verifySignature(e,_t,At){return __awaiter$2E(this,void 0,void 0,function*(){const xt=signatureAlgorithms[At.crv];if(!xt)throw new DwnError(DwnErrorCode.JwsVerifySignatureUnsupportedCrv,`unsupported crv. crv must be one of ${Object.keys(signatureAlgorithms)}`);const kt=Encoder$4.stringToBytes(`${_t.protected}.${e}`),Bt=Encoder$4.base64UrlToBytes(_t.signature);return yield xt.verify(kt,Bt,At)})}static decodePlainObjectPayload(e){let _t;try{_t=Encoder$4.base64UrlToObject(e.payload)}catch{throw new DwnError(DwnErrorCode.JwsDecodePlainObjectPayloadInvalid,"payload is not a JSON object")}if(!isPlainObject$1(_t))throw new DwnError(DwnErrorCode.JwsDecodePlainObjectPayloadInvalid,"signed payload must be a plain object");return _t}static extractDid(e){const[_t]=e.split("#");return _t}static createSigners(e){return e.map(At=>Jws.createSigner(At))}static createSigner(e){const _t=e.keyPair.privateJwk,At=e.keyId;return new PrivateKeySigner({privateJwk:_t,keyId:At})}}var buffer$2={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup$2=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code$6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$2=0,len=code$6.length;i$2<len;++i$2)lookup$2[i$2]=code$6[i$2],revLookup[code$6.charCodeAt(i$2)]=i$2;revLookup[45]=62;revLookup[95]=63;function getLens($t){var e=$t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var _t=$t.indexOf("=");_t===-1&&(_t=e);var At=_t===e?0:4-_t%4;return[_t,At]}function byteLength($t){var e=getLens($t),_t=e[0],At=e[1];return(_t+At)*3/4-At}function _byteLength($t,e,_t){return(e+_t)*3/4-_t}function toByteArray($t){var e,_t=getLens($t),At=_t[0],xt=_t[1],kt=new Arr(_byteLength($t,At,xt)),Bt=0,Nt=xt>0?At-4:At,Ut;for(Ut=0;Ut<Nt;Ut+=4)e=revLookup[$t.charCodeAt(Ut)]<<18|revLookup[$t.charCodeAt(Ut+1)]<<12|revLookup[$t.charCodeAt(Ut+2)]<<6|revLookup[$t.charCodeAt(Ut+3)],kt[Bt++]=e>>16&255,kt[Bt++]=e>>8&255,kt[Bt++]=e&255;return xt===2&&(e=revLookup[$t.charCodeAt(Ut)]<<2|revLookup[$t.charCodeAt(Ut+1)]>>4,kt[Bt++]=e&255),xt===1&&(e=revLookup[$t.charCodeAt(Ut)]<<10|revLookup[$t.charCodeAt(Ut+1)]<<4|revLookup[$t.charCodeAt(Ut+2)]>>2,kt[Bt++]=e>>8&255,kt[Bt++]=e&255),kt}function tripletToBase64($t){return lookup$2[$t>>18&63]+lookup$2[$t>>12&63]+lookup$2[$t>>6&63]+lookup$2[$t&63]}function encodeChunk($t,e,_t){for(var At,xt=[],kt=e;kt<_t;kt+=3)At=($t[kt]<<16&16711680)+($t[kt+1]<<8&65280)+($t[kt+2]&255),xt.push(tripletToBase64(At));return xt.join("")}function fromByteArray($t){for(var e,_t=$t.length,At=_t%3,xt=[],kt=16383,Bt=0,Nt=_t-At;Bt<Nt;Bt+=kt)xt.push(encodeChunk($t,Bt,Bt+kt>Nt?Nt:Bt+kt));return At===1?(e=$t[_t-1],xt.push(lookup$2[e>>2]+lookup$2[e<<4&63]+"==")):At===2&&(e=($t[_t-2]<<8)+$t[_t-1],xt.push(lookup$2[e>>10]+lookup$2[e>>4&63]+lookup$2[e<<2&63]+"=")),xt.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function($t,e,_t,At,xt){var kt,Bt,Nt=xt*8-At-1,Ut=(1<<Nt)-1,Lt=Ut>>1,jt=-7,Kt=_t?xt-1:0,qt=_t?-1:1,zt=$t[e+Kt];for(Kt+=qt,kt=zt&(1<<-jt)-1,zt>>=-jt,jt+=Nt;jt>0;kt=kt*256+$t[e+Kt],Kt+=qt,jt-=8);for(Bt=kt&(1<<-jt)-1,kt>>=-jt,jt+=At;jt>0;Bt=Bt*256+$t[e+Kt],Kt+=qt,jt-=8);if(kt===0)kt=1-Lt;else{if(kt===Ut)return Bt?NaN:(zt?-1:1)*(1/0);Bt=Bt+Math.pow(2,At),kt=kt-Lt}return(zt?-1:1)*Bt*Math.pow(2,kt-At)};ieee754.write=function($t,e,_t,At,xt,kt){var Bt,Nt,Ut,Lt=kt*8-xt-1,jt=(1<<Lt)-1,Kt=jt>>1,qt=xt===23?Math.pow(2,-24)-Math.pow(2,-77):0,zt=At?0:kt-1,Vt=At?1:-1,Ht=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(Nt=isNaN(e)?1:0,Bt=jt):(Bt=Math.floor(Math.log(e)/Math.LN2),e*(Ut=Math.pow(2,-Bt))<1&&(Bt--,Ut*=2),Bt+Kt>=1?e+=qt/Ut:e+=qt*Math.pow(2,1-Kt),e*Ut>=2&&(Bt++,Ut/=2),Bt+Kt>=jt?(Nt=0,Bt=jt):Bt+Kt>=1?(Nt=(e*Ut-1)*Math.pow(2,xt),Bt=Bt+Kt):(Nt=e*Math.pow(2,Kt-1)*Math.pow(2,xt),Bt=0));xt>=8;$t[_t+zt]=Nt&255,zt+=Vt,Nt/=256,xt-=8);for(Bt=Bt<<xt|Nt,Lt+=xt;Lt>0;$t[_t+zt]=Bt&255,zt+=Vt,Bt/=256,Lt-=8);$t[_t+zt-Vt]|=Ht*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function($t){var e=base64Js,_t=ieee754,At=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;$t.Buffer=Nt,$t.SlowBuffer=Xt,$t.INSPECT_MAX_BYTES=50;var xt=2147483647;$t.kMaxLength=xt,Nt.TYPED_ARRAY_SUPPORT=kt(),!Nt.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function kt(){try{var xr=new Uint8Array(1),_r={foo:function(){return 42}};return Object.setPrototypeOf(_r,Uint8Array.prototype),Object.setPrototypeOf(xr,_r),xr.foo()===42}catch{return!1}}Object.defineProperty(Nt.prototype,"parent",{enumerable:!0,get:function(){if(Nt.isBuffer(this))return this.buffer}}),Object.defineProperty(Nt.prototype,"offset",{enumerable:!0,get:function(){if(Nt.isBuffer(this))return this.byteOffset}});function Bt(xr){if(xr>xt)throw new RangeError('The value "'+xr+'" is invalid for option "size"');var _r=new Uint8Array(xr);return Object.setPrototypeOf(_r,Nt.prototype),_r}function Nt(xr,_r,Dr){if(typeof xr=="number"){if(typeof _r=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Kt(xr)}return Ut(xr,_r,Dr)}Nt.poolSize=8192;function Ut(xr,_r,Dr){if(typeof xr=="string")return qt(xr,_r);if(ArrayBuffer.isView(xr))return Vt(xr);if(xr==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof xr);if(Er(xr,ArrayBuffer)||xr&&Er(xr.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Er(xr,SharedArrayBuffer)||xr&&Er(xr.buffer,SharedArrayBuffer)))return Ht(xr,_r,Dr);if(typeof xr=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var jr=xr.valueOf&&xr.valueOf();if(jr!=null&&jr!==xr)return Nt.from(jr,_r,Dr);var Hr=Wt(xr);if(Hr)return Hr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof xr[Symbol.toPrimitive]=="function")return Nt.from(xr[Symbol.toPrimitive]("string"),_r,Dr);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof xr)}Nt.from=function(xr,_r,Dr){return Ut(xr,_r,Dr)},Object.setPrototypeOf(Nt.prototype,Uint8Array.prototype),Object.setPrototypeOf(Nt,Uint8Array);function Lt(xr){if(typeof xr!="number")throw new TypeError('"size" argument must be of type number');if(xr<0)throw new RangeError('The value "'+xr+'" is invalid for option "size"')}function jt(xr,_r,Dr){return Lt(xr),xr<=0?Bt(xr):_r!==void 0?typeof Dr=="string"?Bt(xr).fill(_r,Dr):Bt(xr).fill(_r):Bt(xr)}Nt.alloc=function(xr,_r,Dr){return jt(xr,_r,Dr)};function Kt(xr){return Lt(xr),Bt(xr<0?0:Qt(xr)|0)}Nt.allocUnsafe=function(xr){return Kt(xr)},Nt.allocUnsafeSlow=function(xr){return Kt(xr)};function qt(xr,_r){if((typeof _r!="string"||_r==="")&&(_r="utf8"),!Nt.isEncoding(_r))throw new TypeError("Unknown encoding: "+_r);var Dr=Jt(xr,_r)|0,jr=Bt(Dr),Hr=jr.write(xr,_r);return Hr!==Dr&&(jr=jr.slice(0,Hr)),jr}function zt(xr){for(var _r=xr.length<0?0:Qt(xr.length)|0,Dr=Bt(_r),jr=0;jr<_r;jr+=1)Dr[jr]=xr[jr]&255;return Dr}function Vt(xr){if(Er(xr,Uint8Array)){var _r=new Uint8Array(xr);return Ht(_r.buffer,_r.byteOffset,_r.byteLength)}return zt(xr)}function Ht(xr,_r,Dr){if(_r<0||xr.byteLength<_r)throw new RangeError('"offset" is outside of buffer bounds');if(xr.byteLength<_r+(Dr||0))throw new RangeError('"length" is outside of buffer bounds');var jr;return _r===void 0&&Dr===void 0?jr=new Uint8Array(xr):Dr===void 0?jr=new Uint8Array(xr,_r):jr=new Uint8Array(xr,_r,Dr),Object.setPrototypeOf(jr,Nt.prototype),jr}function Wt(xr){if(Nt.isBuffer(xr)){var _r=Qt(xr.length)|0,Dr=Bt(_r);return Dr.length===0||xr.copy(Dr,0,0,_r),Dr}if(xr.length!==void 0)return typeof xr.length!="number"||Br(xr.length)?Bt(0):zt(xr);if(xr.type==="Buffer"&&Array.isArray(xr.data))return zt(xr.data)}function Qt(xr){if(xr>=xt)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+xt.toString(16)+" bytes");return xr|0}function Xt(xr){return+xr!=xr&&(xr=0),Nt.alloc(+xr)}Nt.isBuffer=function(_r){return _r!=null&&_r._isBuffer===!0&&_r!==Nt.prototype},Nt.compare=function(_r,Dr){if(Er(_r,Uint8Array)&&(_r=Nt.from(_r,_r.offset,_r.byteLength)),Er(Dr,Uint8Array)&&(Dr=Nt.from(Dr,Dr.offset,Dr.byteLength)),!Nt.isBuffer(_r)||!Nt.isBuffer(Dr))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_r===Dr)return 0;for(var jr=_r.length,Hr=Dr.length,Qr=0,Yr=Math.min(jr,Hr);Qr<Yr;++Qr)if(_r[Qr]!==Dr[Qr]){jr=_r[Qr],Hr=Dr[Qr];break}return jr<Hr?-1:Hr<jr?1:0},Nt.isEncoding=function(_r){switch(String(_r).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Nt.concat=function(_r,Dr){if(!Array.isArray(_r))throw new TypeError('"list" argument must be an Array of Buffers');if(_r.length===0)return Nt.alloc(0);var jr;if(Dr===void 0)for(Dr=0,jr=0;jr<_r.length;++jr)Dr+=_r[jr].length;var Hr=Nt.allocUnsafe(Dr),Qr=0;for(jr=0;jr<_r.length;++jr){var Yr=_r[jr];if(Er(Yr,Uint8Array))Qr+Yr.length>Hr.length?Nt.from(Yr).copy(Hr,Qr):Uint8Array.prototype.set.call(Hr,Yr,Qr);else if(Nt.isBuffer(Yr))Yr.copy(Hr,Qr);else throw new TypeError('"list" argument must be an Array of Buffers');Qr+=Yr.length}return Hr};function Jt(xr,_r){if(Nt.isBuffer(xr))return xr.length;if(ArrayBuffer.isView(xr)||Er(xr,ArrayBuffer))return xr.byteLength;if(typeof xr!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof xr);var Dr=xr.length,jr=arguments.length>2&&arguments[2]===!0;if(!jr&&Dr===0)return 0;for(var Hr=!1;;)switch(_r){case"ascii":case"latin1":case"binary":return Dr;case"utf8":case"utf-8":return Ar(xr).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Dr*2;case"hex":return Dr>>>1;case"base64":return Or(xr).length;default:if(Hr)return jr?-1:Ar(xr).length;_r=(""+_r).toLowerCase(),Hr=!0}}Nt.byteLength=Jt;function tr(xr,_r,Dr){var jr=!1;if((_r===void 0||_r<0)&&(_r=0),_r>this.length||((Dr===void 0||Dr>this.length)&&(Dr=this.length),Dr<=0)||(Dr>>>=0,_r>>>=0,Dr<=_r))return"";for(xr||(xr="utf8");;)switch(xr){case"hex":return ar(this,_r,Dr);case"utf8":case"utf-8":return er(this,_r,Dr);case"ascii":return fr(this,_r,Dr);case"latin1":case"binary":return gr(this,_r,Dr);case"base64":return ir(this,_r,Dr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return nr(this,_r,Dr);default:if(jr)throw new TypeError("Unknown encoding: "+xr);xr=(xr+"").toLowerCase(),jr=!0}}Nt.prototype._isBuffer=!0;function dr(xr,_r,Dr){var jr=xr[_r];xr[_r]=xr[Dr],xr[Dr]=jr}Nt.prototype.swap16=function(){var _r=this.length;if(_r%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Dr=0;Dr<_r;Dr+=2)dr(this,Dr,Dr+1);return this},Nt.prototype.swap32=function(){var _r=this.length;if(_r%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Dr=0;Dr<_r;Dr+=4)dr(this,Dr,Dr+3),dr(this,Dr+1,Dr+2);return this},Nt.prototype.swap64=function(){var _r=this.length;if(_r%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Dr=0;Dr<_r;Dr+=8)dr(this,Dr,Dr+7),dr(this,Dr+1,Dr+6),dr(this,Dr+2,Dr+5),dr(this,Dr+3,Dr+4);return this},Nt.prototype.toString=function(){var _r=this.length;return _r===0?"":arguments.length===0?er(this,0,_r):tr.apply(this,arguments)},Nt.prototype.toLocaleString=Nt.prototype.toString,Nt.prototype.equals=function(_r){if(!Nt.isBuffer(_r))throw new TypeError("Argument must be a Buffer");return this===_r?!0:Nt.compare(this,_r)===0},Nt.prototype.inspect=function(){var _r="",Dr=$t.INSPECT_MAX_BYTES;return _r=this.toString("hex",0,Dr).replace(/(.{2})/g,"$1 ").trim(),this.length>Dr&&(_r+=" ... "),"<Buffer "+_r+">"},At&&(Nt.prototype[At]=Nt.prototype.inspect),Nt.prototype.compare=function(_r,Dr,jr,Hr,Qr){if(Er(_r,Uint8Array)&&(_r=Nt.from(_r,_r.offset,_r.byteLength)),!Nt.isBuffer(_r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _r);if(Dr===void 0&&(Dr=0),jr===void 0&&(jr=_r?_r.length:0),Hr===void 0&&(Hr=0),Qr===void 0&&(Qr=this.length),Dr<0||jr>_r.length||Hr<0||Qr>this.length)throw new RangeError("out of range index");if(Hr>=Qr&&Dr>=jr)return 0;if(Hr>=Qr)return-1;if(Dr>=jr)return 1;if(Dr>>>=0,jr>>>=0,Hr>>>=0,Qr>>>=0,this===_r)return 0;for(var Yr=Qr-Hr,an=jr-Dr,cn=Math.min(Yr,an),Gr=this.slice(Hr,Qr),Fr=_r.slice(Dr,jr),en=0;en<cn;++en)if(Gr[en]!==Fr[en]){Yr=Gr[en],an=Fr[en];break}return Yr<an?-1:an<Yr?1:0};function vr(xr,_r,Dr,jr,Hr){if(xr.length===0)return-1;if(typeof Dr=="string"?(jr=Dr,Dr=0):Dr>2147483647?Dr=2147483647:Dr<-2147483648&&(Dr=-2147483648),Dr=+Dr,Br(Dr)&&(Dr=Hr?0:xr.length-1),Dr<0&&(Dr=xr.length+Dr),Dr>=xr.length){if(Hr)return-1;Dr=xr.length-1}else if(Dr<0)if(Hr)Dr=0;else return-1;if(typeof _r=="string"&&(_r=Nt.from(_r,jr)),Nt.isBuffer(_r))return _r.length===0?-1:$r(xr,_r,Dr,jr,Hr);if(typeof _r=="number")return _r=_r&255,typeof Uint8Array.prototype.indexOf=="function"?Hr?Uint8Array.prototype.indexOf.call(xr,_r,Dr):Uint8Array.prototype.lastIndexOf.call(xr,_r,Dr):$r(xr,[_r],Dr,jr,Hr);throw new TypeError("val must be string, number or Buffer")}function $r(xr,_r,Dr,jr,Hr){var Qr=1,Yr=xr.length,an=_r.length;if(jr!==void 0&&(jr=String(jr).toLowerCase(),jr==="ucs2"||jr==="ucs-2"||jr==="utf16le"||jr==="utf-16le")){if(xr.length<2||_r.length<2)return-1;Qr=2,Yr/=2,an/=2,Dr/=2}function cn(rn,hn){return Qr===1?rn[hn]:rn.readUInt16BE(hn*Qr)}var Gr;if(Hr){var Fr=-1;for(Gr=Dr;Gr<Yr;Gr++)if(cn(xr,Gr)===cn(_r,Fr===-1?0:Gr-Fr)){if(Fr===-1&&(Fr=Gr),Gr-Fr+1===an)return Fr*Qr}else Fr!==-1&&(Gr-=Gr-Fr),Fr=-1}else for(Dr+an>Yr&&(Dr=Yr-an),Gr=Dr;Gr>=0;Gr--){for(var en=!0,nn=0;nn<an;nn++)if(cn(xr,Gr+nn)!==cn(_r,nn)){en=!1;break}if(en)return Gr}return-1}Nt.prototype.includes=function(_r,Dr,jr){return this.indexOf(_r,Dr,jr)!==-1},Nt.prototype.indexOf=function(_r,Dr,jr){return vr(this,_r,Dr,jr,!0)},Nt.prototype.lastIndexOf=function(_r,Dr,jr){return vr(this,_r,Dr,jr,!1)};function Ir(xr,_r,Dr,jr){Dr=Number(Dr)||0;var Hr=xr.length-Dr;jr?(jr=Number(jr),jr>Hr&&(jr=Hr)):jr=Hr;var Qr=_r.length;jr>Qr/2&&(jr=Qr/2);for(var Yr=0;Yr<jr;++Yr){var an=parseInt(_r.substr(Yr*2,2),16);if(Br(an))return Yr;xr[Dr+Yr]=an}return Yr}function Rr(xr,_r,Dr,jr){return Cr(Ar(_r,xr.length-Dr),xr,Dr,jr)}function Nr(xr,_r,Dr,jr){return Cr(Mr(_r),xr,Dr,jr)}function kr(xr,_r,Dr,jr){return Cr(Or(_r),xr,Dr,jr)}function lr(xr,_r,Dr,jr){return Cr(Ur(_r,xr.length-Dr),xr,Dr,jr)}Nt.prototype.write=function(_r,Dr,jr,Hr){if(Dr===void 0)Hr="utf8",jr=this.length,Dr=0;else if(jr===void 0&&typeof Dr=="string")Hr=Dr,jr=this.length,Dr=0;else if(isFinite(Dr))Dr=Dr>>>0,isFinite(jr)?(jr=jr>>>0,Hr===void 0&&(Hr="utf8")):(Hr=jr,jr=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var Qr=this.length-Dr;if((jr===void 0||jr>Qr)&&(jr=Qr),_r.length>0&&(jr<0||Dr<0)||Dr>this.length)throw new RangeError("Attempt to write outside buffer bounds");Hr||(Hr="utf8");for(var Yr=!1;;)switch(Hr){case"hex":return Ir(this,_r,Dr,jr);case"utf8":case"utf-8":return Rr(this,_r,Dr,jr);case"ascii":case"latin1":case"binary":return Nr(this,_r,Dr,jr);case"base64":return kr(this,_r,Dr,jr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return lr(this,_r,Dr,jr);default:if(Yr)throw new TypeError("Unknown encoding: "+Hr);Hr=(""+Hr).toLowerCase(),Yr=!0}},Nt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ir(xr,_r,Dr){return _r===0&&Dr===xr.length?e.fromByteArray(xr):e.fromByteArray(xr.slice(_r,Dr))}function er(xr,_r,Dr){Dr=Math.min(xr.length,Dr);for(var jr=[],Hr=_r;Hr<Dr;){var Qr=xr[Hr],Yr=null,an=Qr>239?4:Qr>223?3:Qr>191?2:1;if(Hr+an<=Dr){var cn,Gr,Fr,en;switch(an){case 1:Qr<128&&(Yr=Qr);break;case 2:cn=xr[Hr+1],(cn&192)===128&&(en=(Qr&31)<<6|cn&63,en>127&&(Yr=en));break;case 3:cn=xr[Hr+1],Gr=xr[Hr+2],(cn&192)===128&&(Gr&192)===128&&(en=(Qr&15)<<12|(cn&63)<<6|Gr&63,en>2047&&(en<55296||en>57343)&&(Yr=en));break;case 4:cn=xr[Hr+1],Gr=xr[Hr+2],Fr=xr[Hr+3],(cn&192)===128&&(Gr&192)===128&&(Fr&192)===128&&(en=(Qr&15)<<18|(cn&63)<<12|(Gr&63)<<6|Fr&63,en>65535&&en<1114112&&(Yr=en))}}Yr===null?(Yr=65533,an=1):Yr>65535&&(Yr-=65536,jr.push(Yr>>>10&1023|55296),Yr=56320|Yr&1023),jr.push(Yr),Hr+=an}return yr(jr)}var rr=4096;function yr(xr){var _r=xr.length;if(_r<=rr)return String.fromCharCode.apply(String,xr);for(var Dr="",jr=0;jr<_r;)Dr+=String.fromCharCode.apply(String,xr.slice(jr,jr+=rr));return Dr}function fr(xr,_r,Dr){var jr="";Dr=Math.min(xr.length,Dr);for(var Hr=_r;Hr<Dr;++Hr)jr+=String.fromCharCode(xr[Hr]&127);return jr}function gr(xr,_r,Dr){var jr="";Dr=Math.min(xr.length,Dr);for(var Hr=_r;Hr<Dr;++Hr)jr+=String.fromCharCode(xr[Hr]);return jr}function ar(xr,_r,Dr){var jr=xr.length;(!_r||_r<0)&&(_r=0),(!Dr||Dr<0||Dr>jr)&&(Dr=jr);for(var Hr="",Qr=_r;Qr<Dr;++Qr)Hr+=Lr[xr[Qr]];return Hr}function nr(xr,_r,Dr){for(var jr=xr.slice(_r,Dr),Hr="",Qr=0;Qr<jr.length-1;Qr+=2)Hr+=String.fromCharCode(jr[Qr]+jr[Qr+1]*256);return Hr}Nt.prototype.slice=function(_r,Dr){var jr=this.length;_r=~~_r,Dr=Dr===void 0?jr:~~Dr,_r<0?(_r+=jr,_r<0&&(_r=0)):_r>jr&&(_r=jr),Dr<0?(Dr+=jr,Dr<0&&(Dr=0)):Dr>jr&&(Dr=jr),Dr<_r&&(Dr=_r);var Hr=this.subarray(_r,Dr);return Object.setPrototypeOf(Hr,Nt.prototype),Hr};function ur(xr,_r,Dr){if(xr%1!==0||xr<0)throw new RangeError("offset is not uint");if(xr+_r>Dr)throw new RangeError("Trying to access beyond buffer length")}Nt.prototype.readUintLE=Nt.prototype.readUIntLE=function(_r,Dr,jr){_r=_r>>>0,Dr=Dr>>>0,jr||ur(_r,Dr,this.length);for(var Hr=this[_r],Qr=1,Yr=0;++Yr<Dr&&(Qr*=256);)Hr+=this[_r+Yr]*Qr;return Hr},Nt.prototype.readUintBE=Nt.prototype.readUIntBE=function(_r,Dr,jr){_r=_r>>>0,Dr=Dr>>>0,jr||ur(_r,Dr,this.length);for(var Hr=this[_r+--Dr],Qr=1;Dr>0&&(Qr*=256);)Hr+=this[_r+--Dr]*Qr;return Hr},Nt.prototype.readUint8=Nt.prototype.readUInt8=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,1,this.length),this[_r]},Nt.prototype.readUint16LE=Nt.prototype.readUInt16LE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,2,this.length),this[_r]|this[_r+1]<<8},Nt.prototype.readUint16BE=Nt.prototype.readUInt16BE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,2,this.length),this[_r]<<8|this[_r+1]},Nt.prototype.readUint32LE=Nt.prototype.readUInt32LE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,4,this.length),(this[_r]|this[_r+1]<<8|this[_r+2]<<16)+this[_r+3]*16777216},Nt.prototype.readUint32BE=Nt.prototype.readUInt32BE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,4,this.length),this[_r]*16777216+(this[_r+1]<<16|this[_r+2]<<8|this[_r+3])},Nt.prototype.readIntLE=function(_r,Dr,jr){_r=_r>>>0,Dr=Dr>>>0,jr||ur(_r,Dr,this.length);for(var Hr=this[_r],Qr=1,Yr=0;++Yr<Dr&&(Qr*=256);)Hr+=this[_r+Yr]*Qr;return Qr*=128,Hr>=Qr&&(Hr-=Math.pow(2,8*Dr)),Hr},Nt.prototype.readIntBE=function(_r,Dr,jr){_r=_r>>>0,Dr=Dr>>>0,jr||ur(_r,Dr,this.length);for(var Hr=Dr,Qr=1,Yr=this[_r+--Hr];Hr>0&&(Qr*=256);)Yr+=this[_r+--Hr]*Qr;return Qr*=128,Yr>=Qr&&(Yr-=Math.pow(2,8*Dr)),Yr},Nt.prototype.readInt8=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,1,this.length),this[_r]&128?(255-this[_r]+1)*-1:this[_r]},Nt.prototype.readInt16LE=function(_r,Dr){_r=_r>>>0,Dr||ur(_r,2,this.length);var jr=this[_r]|this[_r+1]<<8;return jr&32768?jr|4294901760:jr},Nt.prototype.readInt16BE=function(_r,Dr){_r=_r>>>0,Dr||ur(_r,2,this.length);var jr=this[_r+1]|this[_r]<<8;return jr&32768?jr|4294901760:jr},Nt.prototype.readInt32LE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,4,this.length),this[_r]|this[_r+1]<<8|this[_r+2]<<16|this[_r+3]<<24},Nt.prototype.readInt32BE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,4,this.length),this[_r]<<24|this[_r+1]<<16|this[_r+2]<<8|this[_r+3]},Nt.prototype.readFloatLE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,4,this.length),_t.read(this,_r,!0,23,4)},Nt.prototype.readFloatBE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,4,this.length),_t.read(this,_r,!1,23,4)},Nt.prototype.readDoubleLE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,8,this.length),_t.read(this,_r,!0,52,8)},Nt.prototype.readDoubleBE=function(_r,Dr){return _r=_r>>>0,Dr||ur(_r,8,this.length),_t.read(this,_r,!1,52,8)};function pr(xr,_r,Dr,jr,Hr,Qr){if(!Nt.isBuffer(xr))throw new TypeError('"buffer" argument must be a Buffer instance');if(_r>Hr||_r<Qr)throw new RangeError('"value" argument is out of bounds');if(Dr+jr>xr.length)throw new RangeError("Index out of range")}Nt.prototype.writeUintLE=Nt.prototype.writeUIntLE=function(_r,Dr,jr,Hr){if(_r=+_r,Dr=Dr>>>0,jr=jr>>>0,!Hr){var Qr=Math.pow(2,8*jr)-1;pr(this,_r,Dr,jr,Qr,0)}var Yr=1,an=0;for(this[Dr]=_r&255;++an<jr&&(Yr*=256);)this[Dr+an]=_r/Yr&255;return Dr+jr},Nt.prototype.writeUintBE=Nt.prototype.writeUIntBE=function(_r,Dr,jr,Hr){if(_r=+_r,Dr=Dr>>>0,jr=jr>>>0,!Hr){var Qr=Math.pow(2,8*jr)-1;pr(this,_r,Dr,jr,Qr,0)}var Yr=jr-1,an=1;for(this[Dr+Yr]=_r&255;--Yr>=0&&(an*=256);)this[Dr+Yr]=_r/an&255;return Dr+jr},Nt.prototype.writeUint8=Nt.prototype.writeUInt8=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,1,255,0),this[Dr]=_r&255,Dr+1},Nt.prototype.writeUint16LE=Nt.prototype.writeUInt16LE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,2,65535,0),this[Dr]=_r&255,this[Dr+1]=_r>>>8,Dr+2},Nt.prototype.writeUint16BE=Nt.prototype.writeUInt16BE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,2,65535,0),this[Dr]=_r>>>8,this[Dr+1]=_r&255,Dr+2},Nt.prototype.writeUint32LE=Nt.prototype.writeUInt32LE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,4,4294967295,0),this[Dr+3]=_r>>>24,this[Dr+2]=_r>>>16,this[Dr+1]=_r>>>8,this[Dr]=_r&255,Dr+4},Nt.prototype.writeUint32BE=Nt.prototype.writeUInt32BE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,4,4294967295,0),this[Dr]=_r>>>24,this[Dr+1]=_r>>>16,this[Dr+2]=_r>>>8,this[Dr+3]=_r&255,Dr+4},Nt.prototype.writeIntLE=function(_r,Dr,jr,Hr){if(_r=+_r,Dr=Dr>>>0,!Hr){var Qr=Math.pow(2,8*jr-1);pr(this,_r,Dr,jr,Qr-1,-Qr)}var Yr=0,an=1,cn=0;for(this[Dr]=_r&255;++Yr<jr&&(an*=256);)_r<0&&cn===0&&this[Dr+Yr-1]!==0&&(cn=1),this[Dr+Yr]=(_r/an>>0)-cn&255;return Dr+jr},Nt.prototype.writeIntBE=function(_r,Dr,jr,Hr){if(_r=+_r,Dr=Dr>>>0,!Hr){var Qr=Math.pow(2,8*jr-1);pr(this,_r,Dr,jr,Qr-1,-Qr)}var Yr=jr-1,an=1,cn=0;for(this[Dr+Yr]=_r&255;--Yr>=0&&(an*=256);)_r<0&&cn===0&&this[Dr+Yr+1]!==0&&(cn=1),this[Dr+Yr]=(_r/an>>0)-cn&255;return Dr+jr},Nt.prototype.writeInt8=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,1,127,-128),_r<0&&(_r=255+_r+1),this[Dr]=_r&255,Dr+1},Nt.prototype.writeInt16LE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,2,32767,-32768),this[Dr]=_r&255,this[Dr+1]=_r>>>8,Dr+2},Nt.prototype.writeInt16BE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,2,32767,-32768),this[Dr]=_r>>>8,this[Dr+1]=_r&255,Dr+2},Nt.prototype.writeInt32LE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,4,2147483647,-2147483648),this[Dr]=_r&255,this[Dr+1]=_r>>>8,this[Dr+2]=_r>>>16,this[Dr+3]=_r>>>24,Dr+4},Nt.prototype.writeInt32BE=function(_r,Dr,jr){return _r=+_r,Dr=Dr>>>0,jr||pr(this,_r,Dr,4,2147483647,-2147483648),_r<0&&(_r=4294967295+_r+1),this[Dr]=_r>>>24,this[Dr+1]=_r>>>16,this[Dr+2]=_r>>>8,this[Dr+3]=_r&255,Dr+4};function br(xr,_r,Dr,jr,Hr,Qr){if(Dr+jr>xr.length)throw new RangeError("Index out of range");if(Dr<0)throw new RangeError("Index out of range")}function Sr(xr,_r,Dr,jr,Hr){return _r=+_r,Dr=Dr>>>0,Hr||br(xr,_r,Dr,4),_t.write(xr,_r,Dr,jr,23,4),Dr+4}Nt.prototype.writeFloatLE=function(_r,Dr,jr){return Sr(this,_r,Dr,!0,jr)},Nt.prototype.writeFloatBE=function(_r,Dr,jr){return Sr(this,_r,Dr,!1,jr)};function Pr(xr,_r,Dr,jr,Hr){return _r=+_r,Dr=Dr>>>0,Hr||br(xr,_r,Dr,8),_t.write(xr,_r,Dr,jr,52,8),Dr+8}Nt.prototype.writeDoubleLE=function(_r,Dr,jr){return Pr(this,_r,Dr,!0,jr)},Nt.prototype.writeDoubleBE=function(_r,Dr,jr){return Pr(this,_r,Dr,!1,jr)},Nt.prototype.copy=function(_r,Dr,jr,Hr){if(!Nt.isBuffer(_r))throw new TypeError("argument should be a Buffer");if(jr||(jr=0),!Hr&&Hr!==0&&(Hr=this.length),Dr>=_r.length&&(Dr=_r.length),Dr||(Dr=0),Hr>0&&Hr<jr&&(Hr=jr),Hr===jr||_r.length===0||this.length===0)return 0;if(Dr<0)throw new RangeError("targetStart out of bounds");if(jr<0||jr>=this.length)throw new RangeError("Index out of range");if(Hr<0)throw new RangeError("sourceEnd out of bounds");Hr>this.length&&(Hr=this.length),_r.length-Dr<Hr-jr&&(Hr=_r.length-Dr+jr);var Qr=Hr-jr;return this===_r&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(Dr,jr,Hr):Uint8Array.prototype.set.call(_r,this.subarray(jr,Hr),Dr),Qr},Nt.prototype.fill=function(_r,Dr,jr,Hr){if(typeof _r=="string"){if(typeof Dr=="string"?(Hr=Dr,Dr=0,jr=this.length):typeof jr=="string"&&(Hr=jr,jr=this.length),Hr!==void 0&&typeof Hr!="string")throw new TypeError("encoding must be a string");if(typeof Hr=="string"&&!Nt.isEncoding(Hr))throw new TypeError("Unknown encoding: "+Hr);if(_r.length===1){var Qr=_r.charCodeAt(0);(Hr==="utf8"&&Qr<128||Hr==="latin1")&&(_r=Qr)}}else typeof _r=="number"?_r=_r&255:typeof _r=="boolean"&&(_r=Number(_r));if(Dr<0||this.length<Dr||this.length<jr)throw new RangeError("Out of range index");if(jr<=Dr)return this;Dr=Dr>>>0,jr=jr===void 0?this.length:jr>>>0,_r||(_r=0);var Yr;if(typeof _r=="number")for(Yr=Dr;Yr<jr;++Yr)this[Yr]=_r;else{var an=Nt.isBuffer(_r)?_r:Nt.from(_r,Hr),cn=an.length;if(cn===0)throw new TypeError('The value "'+_r+'" is invalid for argument "value"');for(Yr=0;Yr<jr-Dr;++Yr)this[Yr+Dr]=an[Yr%cn]}return this};var Tr=/[^+/0-9A-Za-z-_]/g;function wr(xr){if(xr=xr.split("=")[0],xr=xr.trim().replace(Tr,""),xr.length<2)return"";for(;xr.length%4!==0;)xr=xr+"=";return xr}function Ar(xr,_r){_r=_r||1/0;for(var Dr,jr=xr.length,Hr=null,Qr=[],Yr=0;Yr<jr;++Yr){if(Dr=xr.charCodeAt(Yr),Dr>55295&&Dr<57344){if(!Hr){if(Dr>56319){(_r-=3)>-1&&Qr.push(239,191,189);continue}else if(Yr+1===jr){(_r-=3)>-1&&Qr.push(239,191,189);continue}Hr=Dr;continue}if(Dr<56320){(_r-=3)>-1&&Qr.push(239,191,189),Hr=Dr;continue}Dr=(Hr-55296<<10|Dr-56320)+65536}else Hr&&(_r-=3)>-1&&Qr.push(239,191,189);if(Hr=null,Dr<128){if((_r-=1)<0)break;Qr.push(Dr)}else if(Dr<2048){if((_r-=2)<0)break;Qr.push(Dr>>6|192,Dr&63|128)}else if(Dr<65536){if((_r-=3)<0)break;Qr.push(Dr>>12|224,Dr>>6&63|128,Dr&63|128)}else if(Dr<1114112){if((_r-=4)<0)break;Qr.push(Dr>>18|240,Dr>>12&63|128,Dr>>6&63|128,Dr&63|128)}else throw new Error("Invalid code point")}return Qr}function Mr(xr){for(var _r=[],Dr=0;Dr<xr.length;++Dr)_r.push(xr.charCodeAt(Dr)&255);return _r}function Ur(xr,_r){for(var Dr,jr,Hr,Qr=[],Yr=0;Yr<xr.length&&!((_r-=2)<0);++Yr)Dr=xr.charCodeAt(Yr),jr=Dr>>8,Hr=Dr%256,Qr.push(Hr),Qr.push(jr);return Qr}function Or(xr){return e.toByteArray(wr(xr))}function Cr(xr,_r,Dr,jr){for(var Hr=0;Hr<jr&&!(Hr+Dr>=_r.length||Hr>=xr.length);++Hr)_r[Hr+Dr]=xr[Hr];return Hr}function Er(xr,_r){return xr instanceof _r||xr!=null&&xr.constructor!=null&&xr.constructor.name!=null&&xr.constructor.name===_r.name}function Br(xr){return xr!==xr}var Lr=function(){for(var xr="0123456789abcdef",_r=new Array(256),Dr=0;Dr<16;++Dr)for(var jr=Dr*16,Hr=0;Hr<16;++Hr)_r[jr+Hr]=xr[Dr]+xr[Hr];return _r}()})(buffer$2);var browser$f={exports:{}},process$8=browser$f.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout($t){if(cachedSetTimeout===setTimeout)return setTimeout($t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout($t,0);try{return cachedSetTimeout($t,0)}catch{try{return cachedSetTimeout.call(null,$t,0)}catch{return cachedSetTimeout.call(this,$t,0)}}}function runClearTimeout($t){if(cachedClearTimeout===clearTimeout)return clearTimeout($t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout($t);try{return cachedClearTimeout($t)}catch{try{return cachedClearTimeout.call(null,$t)}catch{return cachedClearTimeout.call(this,$t)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var $t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout($t)}}process$8.nextTick=function($t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var _t=1;_t<arguments.length;_t++)e[_t-1]=arguments[_t];queue.push(new Item($t,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item($t,e){this.fun=$t,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process$8.title="browser";process$8.browser=!0;process$8.env={};process$8.argv=[];process$8.version="";process$8.versions={};function noop$5(){}process$8.on=noop$5;process$8.addListener=noop$5;process$8.once=noop$5;process$8.off=noop$5;process$8.removeListener=noop$5;process$8.removeAllListeners=noop$5;process$8.emit=noop$5;process$8.prependListener=noop$5;process$8.prependOnceListener=noop$5;process$8.listeners=function($t){return[]};process$8.binding=function($t){throw new Error("process.binding is not supported")};process$8.cwd=function(){return"/"};process$8.chdir=function($t){throw new Error("process.chdir is not supported")};process$8.umask=function(){return 0};var browserExports$3=browser$f.exports;const process$9=getDefaultExportFromCjs(browserExports$3);(function($t){function e(){var At=this||self;return delete $t.prototype.__magic__,At}if(typeof globalThis=="object")return globalThis;if(this)return e();$t.defineProperty($t.prototype,"__magic__",{configurable:!0,get:e});var _t=__magic__;return _t})(Object);const perf$1=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,warned=new Set,PROCESS=typeof process$9=="object"&&process$9?process$9:{},emitWarning=($t,e,_t,At)=>{typeof PROCESS.emitWarning=="function"?PROCESS.emitWarning($t,e,_t,At):console.error(`[${_t}] ${e}: ${$t}`)};let AC=globalThis.AbortController,AS=globalThis.AbortSignal;var Uo;if(typeof AC>"u"){AS=class{constructor(){sn(this,"onabort");sn(this,"_onabort",[]);sn(this,"reason");sn(this,"aborted",!1)}addEventListener(At,xt){this._onabort.push(xt)}},AC=class{constructor(){sn(this,"signal",new AS);e()}abort(At){var xt,kt;if(!this.signal.aborted){this.signal.reason=At,this.signal.aborted=!0;for(const Bt of this.signal._onabort)Bt(At);(kt=(xt=this.signal).onabort)==null||kt.call(xt,At)}}};let $t=((Uo=PROCESS.env)==null?void 0:Uo.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{$t&&($t=!1,emitWarning("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const shouldWarn=$t=>!warned.has($t),isPosInt$1=$t=>$t&&$t===Math.floor($t)&&$t>0&&isFinite($t),getUintArray=$t=>isPosInt$1($t)?$t<=Math.pow(2,8)?Uint8Array:$t<=Math.pow(2,16)?Uint16Array:$t<=Math.pow(2,32)?Uint32Array:$t<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(e){super(e),this.fill(0)}}var io;const Ji=class Ji{constructor(e,_t){sn(this,"heap");sn(this,"length");if(!Zr(Ji,io))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new _t(e),this.length=0}static create(e){const _t=getUintArray(e);if(!_t)return[];Pn(Ji,io,!0);const At=new Ji(e,_t);return Pn(Ji,io,!1),At}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};io=new WeakMap,zn(Ji,io,!1);let Stack=Ji;var wi,gi,xi,_i,oo,Qn,$i,Xn,Jn,Cn,fi,vi,di,ni,Si,oi,Bi,Oi,Ei,ki,Fi,yi,gn,Po,Yi,Mi,mo,bi,Ko,Zi,so,go,ji,Ui,xo,$o,So,Yn,ko,co;const Bo=class Bo{constructor(e){zn(this,gn);zn(this,wi);zn(this,gi);zn(this,xi);zn(this,_i);zn(this,oo);sn(this,"ttl");sn(this,"ttlResolution");sn(this,"ttlAutopurge");sn(this,"updateAgeOnGet");sn(this,"updateAgeOnHas");sn(this,"allowStale");sn(this,"noDisposeOnSet");sn(this,"noUpdateTTL");sn(this,"maxEntrySize");sn(this,"sizeCalculation");sn(this,"noDeleteOnFetchRejection");sn(this,"noDeleteOnStaleGet");sn(this,"allowStaleOnFetchAbort");sn(this,"allowStaleOnFetchRejection");sn(this,"ignoreFetchAbort");zn(this,Qn);zn(this,$i);zn(this,Xn);zn(this,Jn);zn(this,Cn);zn(this,fi);zn(this,vi);zn(this,di);zn(this,ni);zn(this,Si);zn(this,oi);zn(this,Bi);zn(this,Oi);zn(this,Ei);zn(this,ki);zn(this,Fi);zn(this,yi);zn(this,Yi,()=>{});zn(this,Mi,()=>{});zn(this,mo,()=>{});zn(this,bi,()=>!1);zn(this,Zi,e=>{});zn(this,so,(e,_t,At)=>{});zn(this,go,(e,_t,At,xt)=>{if(At||xt)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});const{max:_t=0,ttl:At,ttlResolution:xt=1,ttlAutopurge:kt,updateAgeOnGet:Bt,updateAgeOnHas:Nt,allowStale:Ut,dispose:Lt,disposeAfter:jt,noDisposeOnSet:Kt,noUpdateTTL:qt,maxSize:zt=0,maxEntrySize:Vt=0,sizeCalculation:Ht,fetchMethod:Wt,noDeleteOnFetchRejection:Qt,noDeleteOnStaleGet:Xt,allowStaleOnFetchRejection:Jt,allowStaleOnFetchAbort:tr,ignoreFetchAbort:dr}=e;if(_t!==0&&!isPosInt$1(_t))throw new TypeError("max option must be a nonnegative integer");const vr=_t?getUintArray(_t):Array;if(!vr)throw new Error("invalid max value: "+_t);if(Pn(this,wi,_t),Pn(this,gi,zt),this.maxEntrySize=Vt||Zr(this,gi),this.sizeCalculation=Ht,this.sizeCalculation){if(!Zr(this,gi)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(Wt!==void 0&&typeof Wt!="function")throw new TypeError("fetchMethod must be a function if specified");if(Pn(this,oo,Wt),Pn(this,Fi,!!Wt),Pn(this,Xn,new Map),Pn(this,Jn,new Array(_t).fill(void 0)),Pn(this,Cn,new Array(_t).fill(void 0)),Pn(this,fi,new vr(_t)),Pn(this,vi,new vr(_t)),Pn(this,di,0),Pn(this,ni,0),Pn(this,Si,Stack.create(_t)),Pn(this,Qn,0),Pn(this,$i,0),typeof Lt=="function"&&Pn(this,xi,Lt),typeof jt=="function"?(Pn(this,_i,jt),Pn(this,oi,[])):(Pn(this,_i,void 0),Pn(this,oi,void 0)),Pn(this,ki,!!Zr(this,xi)),Pn(this,yi,!!Zr(this,_i)),this.noDisposeOnSet=!!Kt,this.noUpdateTTL=!!qt,this.noDeleteOnFetchRejection=!!Qt,this.allowStaleOnFetchRejection=!!Jt,this.allowStaleOnFetchAbort=!!tr,this.ignoreFetchAbort=!!dr,this.maxEntrySize!==0){if(Zr(this,gi)!==0&&!isPosInt$1(Zr(this,gi)))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt$1(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");$n(this,gn,Ko).call(this)}if(this.allowStale=!!Ut,this.noDeleteOnStaleGet=!!Xt,this.updateAgeOnGet=!!Bt,this.updateAgeOnHas=!!Nt,this.ttlResolution=isPosInt$1(xt)||xt===0?xt:1,this.ttlAutopurge=!!kt,this.ttl=At||0,this.ttl){if(!isPosInt$1(this.ttl))throw new TypeError("ttl must be a positive integer if specified");$n(this,gn,Po).call(this)}if(Zr(this,wi)===0&&this.ttl===0&&Zr(this,gi)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!Zr(this,wi)&&!Zr(this,gi)){const $r="LRU_CACHE_UNBOUNDED";shouldWarn($r)&&(warned.add($r),emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",$r,Bo))}}static unsafeExposeInternals(e){return{starts:Zr(e,Oi),ttls:Zr(e,Ei),sizes:Zr(e,Bi),keyMap:Zr(e,Xn),keyList:Zr(e,Jn),valList:Zr(e,Cn),next:Zr(e,fi),prev:Zr(e,vi),get head(){return Zr(e,di)},get tail(){return Zr(e,ni)},free:Zr(e,Si),isBackgroundFetch:_t=>{var At;return $n(At=e,gn,Yn).call(At,_t)},backgroundFetch:(_t,At,xt,kt)=>{var Bt;return $n(Bt=e,gn,So).call(Bt,_t,At,xt,kt)},moveToTail:_t=>{var At;return $n(At=e,gn,co).call(At,_t)},indexes:_t=>{var At;return $n(At=e,gn,ji).call(At,_t)},rindexes:_t=>{var At;return $n(At=e,gn,Ui).call(At,_t)},isStale:_t=>{var At;return Zr(At=e,bi).call(At,_t)}}}get max(){return Zr(this,wi)}get maxSize(){return Zr(this,gi)}get calculatedSize(){return Zr(this,$i)}get size(){return Zr(this,Qn)}get fetchMethod(){return Zr(this,oo)}get dispose(){return Zr(this,xi)}get disposeAfter(){return Zr(this,_i)}getRemainingTTL(e){return Zr(this,Xn).has(e)?1/0:0}*entries(){for(const e of $n(this,gn,ji).call(this))Zr(this,Cn)[e]!==void 0&&Zr(this,Jn)[e]!==void 0&&!$n(this,gn,Yn).call(this,Zr(this,Cn)[e])&&(yield[Zr(this,Jn)[e],Zr(this,Cn)[e]])}*rentries(){for(const e of $n(this,gn,Ui).call(this))Zr(this,Cn)[e]!==void 0&&Zr(this,Jn)[e]!==void 0&&!$n(this,gn,Yn).call(this,Zr(this,Cn)[e])&&(yield[Zr(this,Jn)[e],Zr(this,Cn)[e]])}*keys(){for(const e of $n(this,gn,ji).call(this)){const _t=Zr(this,Jn)[e];_t!==void 0&&!$n(this,gn,Yn).call(this,Zr(this,Cn)[e])&&(yield _t)}}*rkeys(){for(const e of $n(this,gn,Ui).call(this)){const _t=Zr(this,Jn)[e];_t!==void 0&&!$n(this,gn,Yn).call(this,Zr(this,Cn)[e])&&(yield _t)}}*values(){for(const e of $n(this,gn,ji).call(this))Zr(this,Cn)[e]!==void 0&&!$n(this,gn,Yn).call(this,Zr(this,Cn)[e])&&(yield Zr(this,Cn)[e])}*rvalues(){for(const e of $n(this,gn,Ui).call(this))Zr(this,Cn)[e]!==void 0&&!$n(this,gn,Yn).call(this,Zr(this,Cn)[e])&&(yield Zr(this,Cn)[e])}[Symbol.iterator](){return this.entries()}find(e,_t={}){for(const At of $n(this,gn,ji).call(this)){const xt=Zr(this,Cn)[At],kt=$n(this,gn,Yn).call(this,xt)?xt.__staleWhileFetching:xt;if(kt!==void 0&&e(kt,Zr(this,Jn)[At],this))return this.get(Zr(this,Jn)[At],_t)}}forEach(e,_t=this){for(const At of $n(this,gn,ji).call(this)){const xt=Zr(this,Cn)[At],kt=$n(this,gn,Yn).call(this,xt)?xt.__staleWhileFetching:xt;kt!==void 0&&e.call(_t,kt,Zr(this,Jn)[At],this)}}rforEach(e,_t=this){for(const At of $n(this,gn,Ui).call(this)){const xt=Zr(this,Cn)[At],kt=$n(this,gn,Yn).call(this,xt)?xt.__staleWhileFetching:xt;kt!==void 0&&e.call(_t,kt,Zr(this,Jn)[At],this)}}purgeStale(){let e=!1;for(const _t of $n(this,gn,Ui).call(this,{allowStale:!0}))Zr(this,bi).call(this,_t)&&(this.delete(Zr(this,Jn)[_t]),e=!0);return e}dump(){const e=[];for(const _t of $n(this,gn,ji).call(this,{allowStale:!0})){const At=Zr(this,Jn)[_t],xt=Zr(this,Cn)[_t],kt=$n(this,gn,Yn).call(this,xt)?xt.__staleWhileFetching:xt;if(kt===void 0||At===void 0)continue;const Bt={value:kt};if(Zr(this,Ei)&&Zr(this,Oi)){Bt.ttl=Zr(this,Ei)[_t];const Nt=perf$1.now()-Zr(this,Oi)[_t];Bt.start=Math.floor(Date.now()-Nt)}Zr(this,Bi)&&(Bt.size=Zr(this,Bi)[_t]),e.unshift([At,Bt])}return e}load(e){this.clear();for(const[_t,At]of e){if(At.start){const xt=Date.now()-At.start;At.start=perf$1.now()-xt}this.set(_t,At.value,At)}}set(e,_t,At={}){var qt,zt,Vt;if(_t===void 0)return this.delete(e),this;const{ttl:xt=this.ttl,start:kt,noDisposeOnSet:Bt=this.noDisposeOnSet,sizeCalculation:Nt=this.sizeCalculation,status:Ut}=At;let{noUpdateTTL:Lt=this.noUpdateTTL}=At;const jt=Zr(this,go).call(this,e,_t,At.size||0,Nt);if(this.maxEntrySize&&jt>this.maxEntrySize)return Ut&&(Ut.set="miss",Ut.maxEntrySizeExceeded=!0),this.delete(e),this;let Kt=Zr(this,Qn)===0?void 0:Zr(this,Xn).get(e);if(Kt===void 0)Kt=Zr(this,Qn)===0?Zr(this,ni):Zr(this,Si).length!==0?Zr(this,Si).pop():Zr(this,Qn)===Zr(this,wi)?$n(this,gn,$o).call(this,!1):Zr(this,Qn),Zr(this,Jn)[Kt]=e,Zr(this,Cn)[Kt]=_t,Zr(this,Xn).set(e,Kt),Zr(this,fi)[Zr(this,ni)]=Kt,Zr(this,vi)[Kt]=Zr(this,ni),Pn(this,ni,Kt),_o(this,Qn)._++,Zr(this,so).call(this,Kt,jt,Ut),Ut&&(Ut.set="add"),Lt=!1;else{$n(this,gn,co).call(this,Kt);const Ht=Zr(this,Cn)[Kt];if(_t!==Ht){if(Zr(this,Fi)&&$n(this,gn,Yn).call(this,Ht)?Ht.__abortController.abort(new Error("replaced")):Bt||(Zr(this,ki)&&((qt=Zr(this,xi))==null||qt.call(this,Ht,e,"set")),Zr(this,yi)&&((zt=Zr(this,oi))==null||zt.push([Ht,e,"set"]))),Zr(this,Zi).call(this,Kt),Zr(this,so).call(this,Kt,jt,Ut),Zr(this,Cn)[Kt]=_t,Ut){Ut.set="replace";const Wt=Ht&&$n(this,gn,Yn).call(this,Ht)?Ht.__staleWhileFetching:Ht;Wt!==void 0&&(Ut.oldValue=Wt)}}else Ut&&(Ut.set="update")}if(xt!==0&&!Zr(this,Ei)&&$n(this,gn,Po).call(this),Zr(this,Ei)&&(Lt||Zr(this,mo).call(this,Kt,xt,kt),Ut&&Zr(this,Mi).call(this,Ut,Kt)),!Bt&&Zr(this,yi)&&Zr(this,oi)){const Ht=Zr(this,oi);let Wt;for(;Wt=Ht==null?void 0:Ht.shift();)(Vt=Zr(this,_i))==null||Vt.call(this,...Wt)}return this}pop(){var e;try{for(;Zr(this,Qn);){const _t=Zr(this,Cn)[Zr(this,di)];if($n(this,gn,$o).call(this,!0),$n(this,gn,Yn).call(this,_t)){if(_t.__staleWhileFetching)return _t.__staleWhileFetching}else if(_t!==void 0)return _t}}finally{if(Zr(this,yi)&&Zr(this,oi)){const _t=Zr(this,oi);let At;for(;At=_t==null?void 0:_t.shift();)(e=Zr(this,_i))==null||e.call(this,...At)}}}has(e,_t={}){const{updateAgeOnHas:At=this.updateAgeOnHas,status:xt}=_t,kt=Zr(this,Xn).get(e);if(kt!==void 0){const Bt=Zr(this,Cn)[kt];if($n(this,gn,Yn).call(this,Bt)&&Bt.__staleWhileFetching===void 0)return!1;if(Zr(this,bi).call(this,kt))xt&&(xt.has="stale",Zr(this,Mi).call(this,xt,kt));else return At&&Zr(this,Yi).call(this,kt),xt&&(xt.has="hit",Zr(this,Mi).call(this,xt,kt)),!0}else xt&&(xt.has="miss");return!1}peek(e,_t={}){const{allowStale:At=this.allowStale}=_t,xt=Zr(this,Xn).get(e);if(xt!==void 0&&(At||!Zr(this,bi).call(this,xt))){const kt=Zr(this,Cn)[xt];return $n(this,gn,Yn).call(this,kt)?kt.__staleWhileFetching:kt}}async fetch(e,_t={}){const{allowStale:At=this.allowStale,updateAgeOnGet:xt=this.updateAgeOnGet,noDeleteOnStaleGet:kt=this.noDeleteOnStaleGet,ttl:Bt=this.ttl,noDisposeOnSet:Nt=this.noDisposeOnSet,size:Ut=0,sizeCalculation:Lt=this.sizeCalculation,noUpdateTTL:jt=this.noUpdateTTL,noDeleteOnFetchRejection:Kt=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:qt=this.allowStaleOnFetchRejection,ignoreFetchAbort:zt=this.ignoreFetchAbort,allowStaleOnFetchAbort:Vt=this.allowStaleOnFetchAbort,context:Ht,forceRefresh:Wt=!1,status:Qt,signal:Xt}=_t;if(!Zr(this,Fi))return Qt&&(Qt.fetch="get"),this.get(e,{allowStale:At,updateAgeOnGet:xt,noDeleteOnStaleGet:kt,status:Qt});const Jt={allowStale:At,updateAgeOnGet:xt,noDeleteOnStaleGet:kt,ttl:Bt,noDisposeOnSet:Nt,size:Ut,sizeCalculation:Lt,noUpdateTTL:jt,noDeleteOnFetchRejection:Kt,allowStaleOnFetchRejection:qt,allowStaleOnFetchAbort:Vt,ignoreFetchAbort:zt,status:Qt,signal:Xt};let tr=Zr(this,Xn).get(e);if(tr===void 0){Qt&&(Qt.fetch="miss");const dr=$n(this,gn,So).call(this,e,tr,Jt,Ht);return dr.__returned=dr}else{const dr=Zr(this,Cn)[tr];if($n(this,gn,Yn).call(this,dr)){const Nr=At&&dr.__staleWhileFetching!==void 0;return Qt&&(Qt.fetch="inflight",Nr&&(Qt.returnedStale=!0)),Nr?dr.__staleWhileFetching:dr.__returned=dr}const vr=Zr(this,bi).call(this,tr);if(!Wt&&!vr)return Qt&&(Qt.fetch="hit"),$n(this,gn,co).call(this,tr),xt&&Zr(this,Yi).call(this,tr),Qt&&Zr(this,Mi).call(this,Qt,tr),dr;const $r=$n(this,gn,So).call(this,e,tr,Jt,Ht),Rr=$r.__staleWhileFetching!==void 0&&At;return Qt&&(Qt.fetch=vr?"stale":"refresh",Rr&&vr&&(Qt.returnedStale=!0)),Rr?$r.__staleWhileFetching:$r.__returned=$r}}get(e,_t={}){const{allowStale:At=this.allowStale,updateAgeOnGet:xt=this.updateAgeOnGet,noDeleteOnStaleGet:kt=this.noDeleteOnStaleGet,status:Bt}=_t,Nt=Zr(this,Xn).get(e);if(Nt!==void 0){const Ut=Zr(this,Cn)[Nt],Lt=$n(this,gn,Yn).call(this,Ut);return Bt&&Zr(this,Mi).call(this,Bt,Nt),Zr(this,bi).call(this,Nt)?(Bt&&(Bt.get="stale"),Lt?(Bt&&At&&Ut.__staleWhileFetching!==void 0&&(Bt.returnedStale=!0),At?Ut.__staleWhileFetching:void 0):(kt||this.delete(e),Bt&&At&&(Bt.returnedStale=!0),At?Ut:void 0)):(Bt&&(Bt.get="hit"),Lt?Ut.__staleWhileFetching:($n(this,gn,co).call(this,Nt),xt&&Zr(this,Yi).call(this,Nt),Ut))}else Bt&&(Bt.get="miss")}delete(e){var At,xt,kt,Bt;let _t=!1;if(Zr(this,Qn)!==0){const Nt=Zr(this,Xn).get(e);if(Nt!==void 0)if(_t=!0,Zr(this,Qn)===1)this.clear();else{Zr(this,Zi).call(this,Nt);const Ut=Zr(this,Cn)[Nt];$n(this,gn,Yn).call(this,Ut)?Ut.__abortController.abort(new Error("deleted")):(Zr(this,ki)||Zr(this,yi))&&(Zr(this,ki)&&((At=Zr(this,xi))==null||At.call(this,Ut,e,"delete")),Zr(this,yi)&&((xt=Zr(this,oi))==null||xt.push([Ut,e,"delete"]))),Zr(this,Xn).delete(e),Zr(this,Jn)[Nt]=void 0,Zr(this,Cn)[Nt]=void 0,Nt===Zr(this,ni)?Pn(this,ni,Zr(this,vi)[Nt]):Nt===Zr(this,di)?Pn(this,di,Zr(this,fi)[Nt]):(Zr(this,fi)[Zr(this,vi)[Nt]]=Zr(this,fi)[Nt],Zr(this,vi)[Zr(this,fi)[Nt]]=Zr(this,vi)[Nt]),_o(this,Qn)._--,Zr(this,Si).push(Nt)}}if(Zr(this,yi)&&((kt=Zr(this,oi))!=null&&kt.length)){const Nt=Zr(this,oi);let Ut;for(;Ut=Nt==null?void 0:Nt.shift();)(Bt=Zr(this,_i))==null||Bt.call(this,...Ut)}return _t}clear(){var e,_t,At;for(const xt of $n(this,gn,Ui).call(this,{allowStale:!0})){const kt=Zr(this,Cn)[xt];if($n(this,gn,Yn).call(this,kt))kt.__abortController.abort(new Error("deleted"));else{const Bt=Zr(this,Jn)[xt];Zr(this,ki)&&((e=Zr(this,xi))==null||e.call(this,kt,Bt,"delete")),Zr(this,yi)&&((_t=Zr(this,oi))==null||_t.push([kt,Bt,"delete"]))}}if(Zr(this,Xn).clear(),Zr(this,Cn).fill(void 0),Zr(this,Jn).fill(void 0),Zr(this,Ei)&&Zr(this,Oi)&&(Zr(this,Ei).fill(0),Zr(this,Oi).fill(0)),Zr(this,Bi)&&Zr(this,Bi).fill(0),Pn(this,di,0),Pn(this,ni,0),Zr(this,Si).length=0,Pn(this,$i,0),Pn(this,Qn,0),Zr(this,yi)&&Zr(this,oi)){const xt=Zr(this,oi);let kt;for(;kt=xt==null?void 0:xt.shift();)(At=Zr(this,_i))==null||At.call(this,...kt)}}};wi=new WeakMap,gi=new WeakMap,xi=new WeakMap,_i=new WeakMap,oo=new WeakMap,Qn=new WeakMap,$i=new WeakMap,Xn=new WeakMap,Jn=new WeakMap,Cn=new WeakMap,fi=new WeakMap,vi=new WeakMap,di=new WeakMap,ni=new WeakMap,Si=new WeakMap,oi=new WeakMap,Bi=new WeakMap,Oi=new WeakMap,Ei=new WeakMap,ki=new WeakMap,Fi=new WeakMap,yi=new WeakMap,gn=new WeakSet,Po=function(){const e=new ZeroArray(Zr(this,wi)),_t=new ZeroArray(Zr(this,wi));Pn(this,Ei,e),Pn(this,Oi,_t),Pn(this,mo,(kt,Bt,Nt=perf$1.now())=>{if(_t[kt]=Bt!==0?Nt:0,e[kt]=Bt,Bt!==0&&this.ttlAutopurge){const Ut=setTimeout(()=>{Zr(this,bi).call(this,kt)&&this.delete(Zr(this,Jn)[kt])},Bt+1);Ut.unref&&Ut.unref()}}),Pn(this,Yi,kt=>{_t[kt]=e[kt]!==0?perf$1.now():0}),Pn(this,Mi,(kt,Bt)=>{if(e[Bt]){const Nt=e[Bt],Ut=_t[Bt];kt.ttl=Nt,kt.start=Ut,kt.now=At||xt();const Lt=kt.now-Ut;kt.remainingTTL=Nt-Lt}});let At=0;const xt=()=>{const kt=perf$1.now();if(this.ttlResolution>0){At=kt;const Bt=setTimeout(()=>At=0,this.ttlResolution);Bt.unref&&Bt.unref()}return kt};this.getRemainingTTL=kt=>{const Bt=Zr(this,Xn).get(kt);if(Bt===void 0)return 0;const Nt=e[Bt],Ut=_t[Bt];if(Nt===0||Ut===0)return 1/0;const Lt=(At||xt())-Ut;return Nt-Lt},Pn(this,bi,kt=>e[kt]!==0&&_t[kt]!==0&&(At||xt())-_t[kt]>e[kt])},Yi=new WeakMap,Mi=new WeakMap,mo=new WeakMap,bi=new WeakMap,Ko=function(){const e=new ZeroArray(Zr(this,wi));Pn(this,$i,0),Pn(this,Bi,e),Pn(this,Zi,_t=>{Pn(this,$i,Zr(this,$i)-e[_t]),e[_t]=0}),Pn(this,go,(_t,At,xt,kt)=>{if($n(this,gn,Yn).call(this,At))return 0;if(!isPosInt$1(xt))if(kt){if(typeof kt!="function")throw new TypeError("sizeCalculation must be a function");if(xt=kt(At,_t),!isPosInt$1(xt))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return xt}),Pn(this,so,(_t,At,xt)=>{if(e[_t]=At,Zr(this,gi)){const kt=Zr(this,gi)-e[_t];for(;Zr(this,$i)>kt;)$n(this,gn,$o).call(this,!0)}Pn(this,$i,Zr(this,$i)+e[_t]),xt&&(xt.entrySize=At,xt.totalCalculatedSize=Zr(this,$i))})},Zi=new WeakMap,so=new WeakMap,go=new WeakMap,ji=function*({allowStale:e=this.allowStale}={}){if(Zr(this,Qn))for(let _t=Zr(this,ni);!(!$n(this,gn,xo).call(this,_t)||((e||!Zr(this,bi).call(this,_t))&&(yield _t),_t===Zr(this,di)));)_t=Zr(this,vi)[_t]},Ui=function*({allowStale:e=this.allowStale}={}){if(Zr(this,Qn))for(let _t=Zr(this,di);!(!$n(this,gn,xo).call(this,_t)||((e||!Zr(this,bi).call(this,_t))&&(yield _t),_t===Zr(this,ni)));)_t=Zr(this,fi)[_t]},xo=function(e){return e!==void 0&&Zr(this,Xn).get(Zr(this,Jn)[e])===e},$o=function(e){var kt,Bt;const _t=Zr(this,di),At=Zr(this,Jn)[_t],xt=Zr(this,Cn)[_t];return Zr(this,Fi)&&$n(this,gn,Yn).call(this,xt)?xt.__abortController.abort(new Error("evicted")):(Zr(this,ki)||Zr(this,yi))&&(Zr(this,ki)&&((kt=Zr(this,xi))==null||kt.call(this,xt,At,"evict")),Zr(this,yi)&&((Bt=Zr(this,oi))==null||Bt.push([xt,At,"evict"]))),Zr(this,Zi).call(this,_t),e&&(Zr(this,Jn)[_t]=void 0,Zr(this,Cn)[_t]=void 0,Zr(this,Si).push(_t)),Zr(this,Qn)===1?(Pn(this,di,Pn(this,ni,0)),Zr(this,Si).length=0):Pn(this,di,Zr(this,fi)[_t]),Zr(this,Xn).delete(At),_o(this,Qn)._--,_t},So=function(e,_t,At,xt){const kt=_t===void 0?void 0:Zr(this,Cn)[_t];if($n(this,gn,Yn).call(this,kt))return kt;const Bt=new AC,{signal:Nt}=At;Nt==null||Nt.addEventListener("abort",()=>Bt.abort(Nt.reason),{signal:Bt.signal});const Ut={signal:Bt.signal,options:At,context:xt},Lt=(Ht,Wt=!1)=>{const{aborted:Qt}=Bt.signal,Xt=At.ignoreFetchAbort&&Ht!==void 0;if(At.status&&(Qt&&!Wt?(At.status.fetchAborted=!0,At.status.fetchError=Bt.signal.reason,Xt&&(At.status.fetchAbortIgnored=!0)):At.status.fetchResolved=!0),Qt&&!Xt&&!Wt)return Kt(Bt.signal.reason);const Jt=zt;return Zr(this,Cn)[_t]===zt&&(Ht===void 0?Jt.__staleWhileFetching?Zr(this,Cn)[_t]=Jt.__staleWhileFetching:this.delete(e):(At.status&&(At.status.fetchUpdated=!0),this.set(e,Ht,Ut.options))),Ht},jt=Ht=>(At.status&&(At.status.fetchRejected=!0,At.status.fetchError=Ht),Kt(Ht)),Kt=Ht=>{const{aborted:Wt}=Bt.signal,Qt=Wt&&At.allowStaleOnFetchAbort,Xt=Qt||At.allowStaleOnFetchRejection,Jt=Xt||At.noDeleteOnFetchRejection,tr=zt;if(Zr(this,Cn)[_t]===zt&&(!Jt||tr.__staleWhileFetching===void 0?this.delete(e):Qt||(Zr(this,Cn)[_t]=tr.__staleWhileFetching)),Xt)return At.status&&tr.__staleWhileFetching!==void 0&&(At.status.returnedStale=!0),tr.__staleWhileFetching;if(tr.__returned===tr)throw Ht},qt=(Ht,Wt)=>{var Xt;const Qt=(Xt=Zr(this,oo))==null?void 0:Xt.call(this,e,kt,Ut);Qt&&Qt instanceof Promise&&Qt.then(Jt=>Ht(Jt),Wt),Bt.signal.addEventListener("abort",()=>{(!At.ignoreFetchAbort||At.allowStaleOnFetchAbort)&&(Ht(),At.allowStaleOnFetchAbort&&(Ht=Jt=>Lt(Jt,!0)))})};At.status&&(At.status.fetchDispatched=!0);const zt=new Promise(qt).then(Lt,jt),Vt=Object.assign(zt,{__abortController:Bt,__staleWhileFetching:kt,__returned:void 0});return _t===void 0?(this.set(e,Vt,{...Ut.options,status:void 0}),_t=Zr(this,Xn).get(e)):Zr(this,Cn)[_t]=Vt,Vt},Yn=function(e){if(!Zr(this,Fi))return!1;const _t=e;return!!_t&&_t instanceof Promise&&_t.hasOwnProperty("__staleWhileFetching")&&_t.__abortController instanceof AC},ko=function(e,_t){Zr(this,vi)[_t]=e,Zr(this,fi)[e]=_t},co=function(e){e!==Zr(this,ni)&&(e===Zr(this,di)?Pn(this,di,Zr(this,fi)[e]):$n(this,gn,ko).call(this,Zr(this,vi)[e],Zr(this,fi)[e]),$n(this,gn,ko).call(this,Zr(this,ni),e),Pn(this,ni,e))};let LRUCache=Bo;var __awaiter$2D=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MemoryCache{constructor(e){this.timeToLiveInSeconds=e,this.cache=new LRUCache({max:1e5,ttl:e*1e3})}set(e,_t){return __awaiter$2D(this,void 0,void 0,function*(){try{this.cache.set(e,_t)}catch{}})}get(e){return __awaiter$2D(this,void 0,void 0,function*(){return this.cache.get(e)})}}const Authorization=validate20,pattern4=new RegExp("^[A-Za-z0-9_-]+$","u");function validate21($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate21.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)){for(const qt in $t)if(!(qt==="payload"||qt==="signatures"))return validate21.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:qt},message:"must NOT have additional properties"}],!1;{if($t.payload!==void 0){let qt=$t.payload;const zt=Nt;if(typeof qt=="string"){if(!pattern4.test(qt))return validate21.errors=[{instancePath:e+"/payload",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate21.errors=[{instancePath:e+"/payload",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.signatures!==void 0){let qt=$t.signatures;const zt=Nt;if(Array.isArray(qt)){if(qt.length<1)return validate21.errors=[{instancePath:e+"/signatures",schemaPath:"#/properties/signatures/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var jt=!0;const Ht=qt.length;for(let Wt=0;Wt<Ht;Wt++){let Qt=qt[Wt];const Xt=Nt;if(Qt&&typeof Qt=="object"&&!Array.isArray(Qt)){if(Qt.protected!==void 0){let tr=Qt.protected;const dr=Nt;if(typeof tr=="string"){if(!pattern4.test(tr))return validate21.errors=[{instancePath:e+"/signatures/"+Wt+"/protected",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate21.errors=[{instancePath:e+"/signatures/"+Wt+"/protected",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Kt=dr===Nt}else var Kt=!0;if(Kt)if(Qt.signature!==void 0){let tr=Qt.signature;const dr=Nt;if(typeof tr=="string"){if(!pattern4.test(tr))return validate21.errors=[{instancePath:e+"/signatures/"+Wt+"/signature",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate21.errors=[{instancePath:e+"/signatures/"+Wt+"/signature",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Kt=dr===Nt}else var Kt=!0}else return validate21.errors=[{instancePath:e+"/signatures/"+Wt,schemaPath:"#/properties/signatures/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=Xt===Nt;if(!jt)break}}}else return validate21.errors=[{instancePath:e+"/signatures",schemaPath:"#/properties/signatures/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var Lt=zt===Nt}else var Lt=!0}}else return validate21.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate21.errors=Bt,Nt===0}validate21.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate20($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate20.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){const Lt=Nt;for(const jt in $t)if(jt!=="signature")return validate20.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:jt},message:"must NOT have additional properties"}],!1;Lt===Nt&&$t.signature!==void 0&&(validate21($t.signature,{instancePath:e+"/signature",parentData:$t,parentDataProperty:"signature",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate21.errors:Bt.concat(validate21.errors),Nt=Bt.length))}else return validate20.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate20.errors=Bt,Nt===0}validate20.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const AuthorizationDelegatedGrant=validate24,schema39={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-write-unidentified.json",type:"object",required:["descriptor"],properties:{recordId:{type:"string"},contextId:{type:"string",pattern:"^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"},attestation:{$ref:"https://identity.foundation/dwn/json-schemas/general-jws.json"},authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-owner.json"},encryption:{type:"object",properties:{algorithm:{type:"string",enum:["A256CTR"]},initializationVector:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},keyEncryption:{type:"array",minItems:1,items:{type:"object",properties:{rootKeyId:{type:"string"},derivationScheme:{type:"string",enum:["dataFormats","protocolContext","protocolPath","schemas"]},derivedPublicKey:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"},algorithm:{type:"string",enum:["ECIES-ES256K"]},encryptedKey:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},initializationVector:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},ephemeralPublicKey:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"},messageAuthenticationCode:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"}},additionalProperties:!1,required:["rootKeyId","derivationScheme","algorithm","encryptedKey","initializationVector","ephemeralPublicKey","messageAuthenticationCode"]}}},additionalProperties:!1,required:["algorithm","initializationVector","keyEncryption"]},descriptor:{type:"object",properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Write"],type:"string"},recipient:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},protocol:{type:"string"},protocolPath:{type:"string",pattern:"^[a-zA-Z]+(/[a-zA-Z]+)*$"},schema:{type:"string"},tags:{type:"object",minProperties:1,maxProperties:10,additionalProperties:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"array",minItems:1,maxItems:10,items:{type:"string"}},{type:"array",minItems:1,maxItems:10,items:{type:"number"}}]}},parentId:{type:"string"},dataCid:{type:"string"},dataSize:{type:"number"},dateCreated:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},published:{type:"boolean"},datePublished:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},dataFormat:{type:"string"}},additionalProperties:!1,required:["interface","method","dataCid","dataSize","dateCreated","messageTimestamp","dataFormat"],dependencies:{parentId:["protocol"]},allOf:[{$comment:"rule defining `published` and `datePublished` relationship",anyOf:[{properties:{published:{type:"boolean",enum:[!0]}},required:["published","datePublished"]},{properties:{published:{type:"boolean",enum:[!1]}},not:{required:["datePublished"]}},{allOf:[{not:{required:["published"]}},{not:{required:["datePublished"]}}]}]}]}},$comment:"rule defining `protocol` and `contextId` relationship",anyOf:[{properties:{descriptor:{type:"object",required:["protocol","protocolPath"]}},required:["contextId"]},{allOf:[{not:{required:["contextId"]}},{properties:{descriptor:{type:"object",not:{required:["protocol"]}}}},{properties:{descriptor:{type:"object",not:{required:["protocolPath"]}}}}]}]},pattern7=new RegExp("^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$","u"),pattern12=new RegExp("^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$","u"),pattern13=new RegExp("^[a-zA-Z]+(/[a-zA-Z]+)*$","u"),pattern14=new RegExp("^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$","u"),wrapper0={validate:validate26};function validate29($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate29.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){const jt=Nt;for(const Kt in $t)if(!(Kt==="signature"||Kt==="authorDelegatedGrant"||Kt==="ownerSignature"||Kt==="ownerDelegatedGrant"))return validate29.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Kt},message:"must NOT have additional properties"}],!1;if(jt===Nt){let Kt;if($t.ownerSignature!==void 0&&$t.signature===void 0&&(Kt="signature"))return validate29.errors=[{instancePath:e,schemaPath:"#/dependencies",keyword:"dependencies",params:{property:"ownerSignature",missingProperty:Kt,depsCount:1,deps:"signature"},message:"must have property signature when property ownerSignature is present"}],!1;if($t.signature!==void 0){const qt=Nt;validate21($t.signature,{instancePath:e+"/signature",parentData:$t,parentDataProperty:"signature",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate21.errors:Bt.concat(validate21.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.authorDelegatedGrant!==void 0){const qt=Nt;wrapper0.validate($t.authorDelegatedGrant,{instancePath:e+"/authorDelegatedGrant",parentData:$t,parentDataProperty:"authorDelegatedGrant",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?wrapper0.validate.errors:Bt.concat(wrapper0.validate.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.ownerSignature!==void 0){const qt=Nt;validate21($t.ownerSignature,{instancePath:e+"/ownerSignature",parentData:$t,parentDataProperty:"ownerSignature",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate21.errors:Bt.concat(validate21.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0;if(Lt)if($t.ownerDelegatedGrant!==void 0){const qt=Nt;wrapper0.validate($t.ownerDelegatedGrant,{instancePath:e+"/ownerDelegatedGrant",parentData:$t,parentDataProperty:"ownerDelegatedGrant",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?wrapper0.validate.errors:Bt.concat(wrapper0.validate.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0}}}}else return validate29.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate29.errors=Bt,Nt===0}validate29.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const schema43={$id:"https://identity.foundation/dwn/json-schemas/general-jwk.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",required:["kty"],properties:{alg:{type:"string"},kid:{type:"string"},kty:{enum:["EC","RSA","oct","OKP"]},crv:{type:"string"},use:{type:"string"},key_ops:{type:"string"},x5u:{type:"string"},x5c:{type:"string"},x5t:{type:"string"},"x5t#S256":{type:"string"}},oneOf:[{properties:{kty:{const:"EC"},crv:{type:"string"},x:{type:"string"},y:{type:"string"},d:{type:"string"}},required:["crv","x"]},{properties:{kty:{const:"OKP"},crv:{type:"string"},x:{type:"string"},d:{type:"string"}},required:["crv","x"]},{properties:{kty:{const:"RSA"},n:{type:"string"},e:{type:"string"},d:{type:"string"},p:{type:"string"},q:{type:"string"},dp:{type:"string"},dq:{type:"string"},qi:{type:"string"},oth:{type:"object"}},required:["n","e"]},{properties:{kty:{const:"oct"},k:{type:"string"}},required:["k"]}]};function validate33($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate33.evaluated;Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0);const Lt=Nt,jt=Nt;let Kt=!1,qt=null;const zt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let er;if($t.crv===void 0&&(er="crv")||$t.x===void 0&&(er="x")){const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/required",keyword:"required",params:{missingProperty:er},message:"must have required property '"+er+"'"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}else{if($t.kty!==void 0){const rr=Nt;if($t.kty!=="EC"){const yr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/kty/const",keyword:"const",params:{allowedValue:"EC"},message:"must be equal to constant"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Vt=rr===Nt}else var Vt=!0;if(Vt){if($t.crv!==void 0){const rr=Nt;if(typeof $t.crv!="string"){const fr={instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Vt=rr===Nt}else var Vt=!0;if(Vt){if($t.x!==void 0){const rr=Nt;if(typeof $t.x!="string"){const fr={instancePath:e+"/x",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Vt=rr===Nt}else var Vt=!0;if(Vt){if($t.y!==void 0){const rr=Nt;if(typeof $t.y!="string"){const fr={instancePath:e+"/y",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/y/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Vt=rr===Nt}else var Vt=!0;if(Vt)if($t.d!==void 0){const rr=Nt;if(typeof $t.d!="string"){const fr={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Vt=rr===Nt}else var Vt=!0}}}}}var Xt=zt===Nt;if(Xt){Kt=!0,qt=0;var Ht={};Ht.kty=!0,Ht.crv=!0,Ht.x=!0,Ht.y=!0,Ht.d=!0}const Wt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let er;if($t.crv===void 0&&(er="crv")||$t.x===void 0&&(er="x")){const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/required",keyword:"required",params:{missingProperty:er},message:"must have required property '"+er+"'"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}else{if($t.kty!==void 0){const rr=Nt;if($t.kty!=="OKP"){const yr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/kty/const",keyword:"const",params:{allowedValue:"OKP"},message:"must be equal to constant"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Qt=rr===Nt}else var Qt=!0;if(Qt){if($t.crv!==void 0){const rr=Nt;if(typeof $t.crv!="string"){const fr={instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Qt=rr===Nt}else var Qt=!0;if(Qt){if($t.x!==void 0){const rr=Nt;if(typeof $t.x!="string"){const fr={instancePath:e+"/x",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Qt=rr===Nt}else var Qt=!0;if(Qt)if($t.d!==void 0){const rr=Nt;if(typeof $t.d!="string"){const fr={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}var Qt=rr===Nt}else var Qt=!0}}}}var Xt=Wt===Nt;if(Xt&&Kt)Kt=!1,qt=[qt,1];else{Xt&&(Kt=!0,qt=1,Ht!==!0&&(Ht=Ht||{},Ht.kty=!0,Ht.crv=!0,Ht.x=!0,Ht.d=!0));const er=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let yr;if($t.n===void 0&&(yr="n")||$t.e===void 0&&(yr="e")){const fr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/required",keyword:"required",params:{missingProperty:yr},message:"must have required property '"+yr+"'"};Bt===null?Bt=[fr]:Bt.push(fr),Nt++}else{if($t.kty!==void 0){const fr=Nt;if($t.kty!=="RSA"){const gr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/kty/const",keyword:"const",params:{allowedValue:"RSA"},message:"must be equal to constant"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.n!==void 0){const fr=Nt;if(typeof $t.n!="string"){const ar={instancePath:e+"/n",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/n/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.e!==void 0){const fr=Nt;if(typeof $t.e!="string"){const ar={instancePath:e+"/e",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/e/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.d!==void 0){const fr=Nt;if(typeof $t.d!="string"){const ar={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.p!==void 0){const fr=Nt;if(typeof $t.p!="string"){const ar={instancePath:e+"/p",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/p/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.q!==void 0){const fr=Nt;if(typeof $t.q!="string"){const ar={instancePath:e+"/q",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/q/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.dp!==void 0){const fr=Nt;if(typeof $t.dp!="string"){const ar={instancePath:e+"/dp",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/dp/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.dq!==void 0){const fr=Nt;if(typeof $t.dq!="string"){const ar={instancePath:e+"/dq",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/dq/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt){if($t.qi!==void 0){const fr=Nt;if(typeof $t.qi!="string"){const ar={instancePath:e+"/qi",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/qi/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var Jt=fr===Nt}else var Jt=!0;if(Jt)if($t.oth!==void 0){let fr=$t.oth;const gr=Nt;if(!(fr&&typeof fr=="object"&&!Array.isArray(fr))){const nr={instancePath:e+"/oth",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/oth/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[nr]:Bt.push(nr),Nt++}var Jt=gr===Nt}else var Jt=!0}}}}}}}}}}var Xt=er===Nt;if(Xt&&Kt)Kt=!1,qt=[qt,2];else{Xt&&(Kt=!0,qt=2,Ht!==!0&&(Ht=Ht||{},Ht.kty=!0,Ht.n=!0,Ht.e=!0,Ht.d=!0,Ht.p=!0,Ht.q=!0,Ht.dp=!0,Ht.dq=!0,Ht.qi=!0,Ht.oth=!0));const yr=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let gr;if($t.k===void 0&&(gr="k")){const ar={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/required",keyword:"required",params:{missingProperty:gr},message:"must have required property '"+gr+"'"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}else{if($t.kty!==void 0){const ar=Nt;if($t.kty!=="oct"){const nr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/properties/kty/const",keyword:"const",params:{allowedValue:"oct"},message:"must be equal to constant"};Bt===null?Bt=[nr]:Bt.push(nr),Nt++}var tr=ar===Nt}else var tr=!0;if(tr)if($t.k!==void 0){const ar=Nt;if(typeof $t.k!="string"){const ur={instancePath:e+"/k",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/properties/k/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}var tr=ar===Nt}else var tr=!0}}var Xt=yr===Nt;Xt&&Kt?(Kt=!1,qt=[qt,3]):Xt&&(Kt=!0,qt=3,Ht!==!0&&(Ht=Ht||{},Ht.kty=!0,Ht.k=!0))}}if(Kt)Nt=jt,Bt!==null&&(jt?Bt.length=jt:Bt=null);else{const er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf",keyword:"oneOf",params:{passingSchemas:qt},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[er]:Bt.push(er),Nt++,validate33.errors=Bt,!1}if(Nt===Lt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let er;if($t.kty===void 0&&(er="kty"))return validate33.errors=[{instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/required",keyword:"required",params:{missingProperty:er},message:"must have required property '"+er+"'"}],!1;if(Ht!==!0&&(Ht=Ht||{},Ht.alg=!0,Ht.kid=!0,Ht.kty=!0,Ht.crv=!0,Ht.use=!0,Ht.key_ops=!0,Ht.x5u=!0,Ht.x5c=!0,Ht.x5t=!0,Ht["x5t#S256"]=!0),$t.alg!==void 0){const rr=Nt;if(typeof $t.alg!="string")return validate33.errors=[{instancePath:e+"/alg",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/alg/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.kid!==void 0){const rr=Nt;if(typeof $t.kid!="string")return validate33.errors=[{instancePath:e+"/kid",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/kid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.kty!==void 0){let rr=$t.kty;const yr=Nt;if(!(rr==="EC"||rr==="RSA"||rr==="oct"||rr==="OKP"))return validate33.errors=[{instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/kty/enum",keyword:"enum",params:{allowedValues:schema43.properties.kty.enum},message:"must be equal to one of the allowed values"}],!1;var dr=yr===Nt}else var dr=!0;if(dr){if($t.crv!==void 0){const rr=Nt;if(typeof $t.crv!="string")return validate33.errors=[{instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.use!==void 0){const rr=Nt;if(typeof $t.use!="string")return validate33.errors=[{instancePath:e+"/use",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/use/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.key_ops!==void 0){const rr=Nt;if(typeof $t.key_ops!="string")return validate33.errors=[{instancePath:e+"/key_ops",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/key_ops/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.x5u!==void 0){const rr=Nt;if(typeof $t.x5u!="string")return validate33.errors=[{instancePath:e+"/x5u",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5u/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.x5c!==void 0){const rr=Nt;if(typeof $t.x5c!="string")return validate33.errors=[{instancePath:e+"/x5c",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5c/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr){if($t.x5t!==void 0){const rr=Nt;if(typeof $t.x5t!="string")return validate33.errors=[{instancePath:e+"/x5t",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5t/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0;if(dr)if($t["x5t#S256"]!==void 0){const rr=Nt;if(typeof $t["x5t#S256"]!="string")return validate33.errors=[{instancePath:e+"/x5t#S256",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5t%23S256/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var dr=rr===Nt}else var dr=!0}}}}}}}}}else return validate33.errors=[{instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var vr=Lt===Nt;if(vr){const er=Nt,rr=Nt,yr=Nt;let fr=!1;const gr=Nt,ar=Nt;let nr=!1;const ur=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.d===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var $r=ur===Nt;if(nr=nr||$r,nr)Nt=ar,Bt!==null&&(ar?Bt.length=ar:Bt=null);else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}if(Nt===gr)if($t&&typeof $t=="object"&&!Array.isArray($t)){if($t.kty!==void 0&&$t.kty!=="EC"){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}}else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var lr=gr===Nt;if(fr=fr||lr,lr){var Ir={};Ir.kty=!0}const pr=Nt,br=Nt;let Sr=!1;const Pr=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.d===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Rr=Pr===Nt;if(Sr=Sr||Rr,Sr)Nt=br,Bt!==null&&(br?Bt.length=br:Bt=null);else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}if(Nt===pr)if($t&&typeof $t=="object"&&!Array.isArray($t)){if($t.kty!==void 0&&$t.kty!=="OKP"){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}}else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var lr=pr===Nt;fr=fr||lr,lr&&Ir!==!0&&(Ir=Ir||{},Ir.kty=!0);const Tr=Nt,wr=Nt;let Ar=!1;const Mr=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.d===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Mr===Nt;Ar=Ar||Nr;const Ur=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.p===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Ur===Nt;Ar=Ar||Nr;const Or=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.q===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Or===Nt;Ar=Ar||Nr;const Cr=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.dp===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Cr===Nt;Ar=Ar||Nr;const Er=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.dq===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Er===Nt;Ar=Ar||Nr;const Br=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.qi===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Br===Nt;Ar=Ar||Nr;const Lr=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.oth===void 0){const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Lr===Nt;if(Ar=Ar||Nr,Ar)Nt=wr,Bt!==null&&(wr?Bt.length=wr:Bt=null);else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}if(Nt===Tr)if($t&&typeof $t=="object"&&!Array.isArray($t)){if($t.kty!==void 0){const xr=Nt;if($t.kty!=="RSA"){const _r={};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var kr=xr===Nt}else var kr=!0;if(kr)if($t.oth!==void 0){let xr=$t.oth;const _r=Nt;if(!(xr&&typeof xr=="object"&&!Array.isArray(xr))){const jr={};Bt===null?Bt=[jr]:Bt.push(jr),Nt++}var kr=_r===Nt}else var kr=!0}else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var lr=Tr===Nt;if(fr=fr||lr,lr&&Ir!==!0&&(Ir=Ir||{},Ir.kty=!0,Ir.d=!0,Ir.p=!0,Ir.q=!0,Ir.dp=!0,Ir.dq=!0,Ir.qi=!0,Ir.oth=!0),fr)Nt=yr,Bt!==null&&(yr?Bt.length=yr:Bt=null);else{const xr={};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var ir=rr===Nt;if(ir)return validate33.errors=[{instancePath:e,schemaPath:"#/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=er,Bt!==null&&(er?Bt.length=er:Bt=null)}return validate33.errors=Bt,Ut.props=Ht,Nt===0}validate33.evaluated={dynamicProps:!0,dynamicItems:!1};const func1=Object.prototype.hasOwnProperty;function validate27($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate27.evaluated;Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0);const Lt=Nt;let jt=!1;const Kt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let ur;if($t.contextId===void 0&&(ur="contextId")){const pr={instancePath:e,schemaPath:"#/anyOf/0/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}else if($t.descriptor!==void 0){let pr=$t.descriptor;if(Nt===Nt)if(pr&&typeof pr=="object"&&!Array.isArray(pr)){let Sr;if(pr.protocol===void 0&&(Sr="protocol")||pr.protocolPath===void 0&&(Sr="protocolPath")){const Pr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/0/properties/descriptor/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}}else{const Sr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/0/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++}}}var dr=Kt===Nt;if(jt=jt||dr,dr){var qt={};qt.descriptor=!0}const zt=Nt,Vt=Nt,Ht=Nt,Wt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.contextId===void 0){const ur={};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}var Qt=Wt===Nt;if(Qt){const ur={instancePath:e,schemaPath:"#/anyOf/1/allOf/0/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}else Nt=Ht,Bt!==null&&(Ht?Bt.length=Ht:Bt=null);var Xt=Vt===Nt;if(Xt){const ur=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.descriptor!==void 0){let br=$t.descriptor;if(!(br&&typeof br=="object"&&!Array.isArray(br))){const Tr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/1/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Tr]:Bt.push(Tr),Nt++}const Sr=Nt,Pr=Nt;if(br&&typeof br=="object"&&!Array.isArray(br)&&br.protocol===void 0){const Tr={};Bt===null?Bt=[Tr]:Bt.push(Tr),Nt++}var Jt=Pr===Nt;if(Jt){const Tr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/1/properties/descriptor/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[Tr]:Bt.push(Tr),Nt++}else Nt=Sr,Bt!==null&&(Sr?Bt.length=Sr:Bt=null)}var Xt=ur===Nt;if(Xt){const br=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.descriptor!==void 0){let Pr=$t.descriptor;if(!(Pr&&typeof Pr=="object"&&!Array.isArray(Pr))){const Ar={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/2/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}const Tr=Nt,wr=Nt;if(Pr&&typeof Pr=="object"&&!Array.isArray(Pr)&&Pr.protocolPath===void 0){const Ar={};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var tr=wr===Nt;if(tr){const Ar={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/2/properties/descriptor/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}else Nt=Tr,Bt!==null&&(Tr?Bt.length=Tr:Bt=null)}var Xt=br===Nt}}var dr=zt===Nt;if(jt=jt||dr,dr&&qt!==!0&&(qt=qt||{},qt.descriptor=!0),jt)Nt=Lt,Bt!==null&&(Lt?Bt.length=Lt:Bt=null);else{const ur={instancePath:e,schemaPath:"#/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return Bt===null?Bt=[ur]:Bt.push(ur),Nt++,validate27.errors=Bt,!1}if(Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let ur;if($t.descriptor===void 0&&(ur="descriptor"))return validate27.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"}],!1;if(qt!==!0&&(qt=qt||{},qt.recordId=!0,qt.contextId=!0,qt.attestation=!0,qt.authorization=!0,qt.encryption=!0,qt.descriptor=!0),$t.recordId!==void 0){const pr=Nt;if(typeof $t.recordId!="string")return validate27.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var vr=pr===Nt}else var vr=!0;if(vr){if($t.contextId!==void 0){let pr=$t.contextId;const br=Nt;if(Nt===br)if(typeof pr=="string"){if(!pattern7.test(pr))return validate27.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/pattern",keyword:"pattern",params:{pattern:"^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"},message:'must match pattern "^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"'}],!1}else return validate27.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var vr=br===Nt}else var vr=!0;if(vr){if($t.attestation!==void 0){const pr=Nt;validate21($t.attestation,{instancePath:e+"/attestation",parentData:$t,parentDataProperty:"attestation",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate21.errors:Bt.concat(validate21.errors),Nt=Bt.length);var vr=pr===Nt}else var vr=!0;if(vr){if($t.authorization!==void 0){const pr=Nt;validate29($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate29.errors:Bt.concat(validate29.errors),Nt=Bt.length);var vr=pr===Nt}else var vr=!0;if(vr){if($t.encryption!==void 0){let pr=$t.encryption;const br=Nt;if(Nt===br)if(pr&&typeof pr=="object"&&!Array.isArray(pr)){let Pr;if(pr.algorithm===void 0&&(Pr="algorithm")||pr.initializationVector===void 0&&(Pr="initializationVector")||pr.keyEncryption===void 0&&(Pr="keyEncryption"))return validate27.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/required",keyword:"required",params:{missingProperty:Pr},message:"must have required property '"+Pr+"'"}],!1;{const Tr=Nt;for(const wr in pr)if(!(wr==="algorithm"||wr==="initializationVector"||wr==="keyEncryption"))return validate27.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:wr},message:"must NOT have additional properties"}],!1;if(Tr===Nt){if(pr.algorithm!==void 0){let wr=pr.algorithm;const Ar=Nt;if(typeof wr!="string")return validate27.errors=[{instancePath:e+"/encryption/algorithm",schemaPath:"#/properties/encryption/properties/algorithm/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(wr!=="A256CTR")return validate27.errors=[{instancePath:e+"/encryption/algorithm",schemaPath:"#/properties/encryption/properties/algorithm/enum",keyword:"enum",params:{allowedValues:schema39.properties.encryption.properties.algorithm.enum},message:"must be equal to one of the allowed values"}],!1;var $r=Ar===Nt}else var $r=!0;if($r){if(pr.initializationVector!==void 0){let wr=pr.initializationVector;const Ar=Nt;if(Nt===Nt)if(typeof wr=="string"){if(!pattern4.test(wr))return validate27.errors=[{instancePath:e+"/encryption/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var $r=Ar===Nt}else var $r=!0;if($r)if(pr.keyEncryption!==void 0){let wr=pr.keyEncryption;const Ar=Nt;if(Nt===Ar)if(Array.isArray(wr)){if(wr.length<1)return validate27.errors=[{instancePath:e+"/encryption/keyEncryption",schemaPath:"#/properties/encryption/properties/keyEncryption/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var Ir=!0;const Ur=wr.length;for(let Or=0;Or<Ur;Or++){let Cr=wr[Or];const Er=Nt;if(Nt===Er)if(Cr&&typeof Cr=="object"&&!Array.isArray(Cr)){let Lr;if(Cr.rootKeyId===void 0&&(Lr="rootKeyId")||Cr.derivationScheme===void 0&&(Lr="derivationScheme")||Cr.algorithm===void 0&&(Lr="algorithm")||Cr.encryptedKey===void 0&&(Lr="encryptedKey")||Cr.initializationVector===void 0&&(Lr="initializationVector")||Cr.ephemeralPublicKey===void 0&&(Lr="ephemeralPublicKey")||Cr.messageAuthenticationCode===void 0&&(Lr="messageAuthenticationCode"))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or,schemaPath:"#/properties/encryption/properties/keyEncryption/items/required",keyword:"required",params:{missingProperty:Lr},message:"must have required property '"+Lr+"'"}],!1;{const xr=Nt;for(const _r in Cr)if(!(_r==="rootKeyId"||_r==="derivationScheme"||_r==="derivedPublicKey"||_r==="algorithm"||_r==="encryptedKey"||_r==="initializationVector"||_r==="ephemeralPublicKey"||_r==="messageAuthenticationCode"))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or,schemaPath:"#/properties/encryption/properties/keyEncryption/items/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:_r},message:"must NOT have additional properties"}],!1;if(xr===Nt){if(Cr.rootKeyId!==void 0){const _r=Nt;if(typeof Cr.rootKeyId!="string")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/rootKeyId",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/rootKeyId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Rr=_r===Nt}else var Rr=!0;if(Rr){if(Cr.derivationScheme!==void 0){let _r=Cr.derivationScheme;const Dr=Nt;if(typeof _r!="string")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/derivationScheme",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/derivationScheme/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(_r==="dataFormats"||_r==="protocolContext"||_r==="protocolPath"||_r==="schemas"))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/derivationScheme",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/derivationScheme/enum",keyword:"enum",params:{allowedValues:schema39.properties.encryption.properties.keyEncryption.items.properties.derivationScheme.enum},message:"must be equal to one of the allowed values"}],!1;var Rr=Dr===Nt}else var Rr=!0;if(Rr){if(Cr.derivedPublicKey!==void 0){const _r=Nt;validate33(Cr.derivedPublicKey,{instancePath:e+"/encryption/keyEncryption/"+Or+"/derivedPublicKey",parentData:Cr,parentDataProperty:"derivedPublicKey",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate33.errors:Bt.concat(validate33.errors),Nt=Bt.length);var Rr=_r===Nt}else var Rr=!0;if(Rr){if(Cr.algorithm!==void 0){let _r=Cr.algorithm;const Dr=Nt;if(typeof _r!="string")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/algorithm",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/algorithm/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(_r!=="ECIES-ES256K")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/algorithm",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/algorithm/enum",keyword:"enum",params:{allowedValues:schema39.properties.encryption.properties.keyEncryption.items.properties.algorithm.enum},message:"must be equal to one of the allowed values"}],!1;var Rr=Dr===Nt}else var Rr=!0;if(Rr){if(Cr.encryptedKey!==void 0){let _r=Cr.encryptedKey;const Dr=Nt;if(Nt===Nt)if(typeof _r=="string"){if(!pattern4.test(_r))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/encryptedKey",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/encryptedKey",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Rr=Dr===Nt}else var Rr=!0;if(Rr){if(Cr.initializationVector!==void 0){let _r=Cr.initializationVector;const Dr=Nt;if(Nt===Nt)if(typeof _r=="string"){if(!pattern4.test(_r))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Rr=Dr===Nt}else var Rr=!0;if(Rr){if(Cr.ephemeralPublicKey!==void 0){const _r=Nt;validate33(Cr.ephemeralPublicKey,{instancePath:e+"/encryption/keyEncryption/"+Or+"/ephemeralPublicKey",parentData:Cr,parentDataProperty:"ephemeralPublicKey",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate33.errors:Bt.concat(validate33.errors),Nt=Bt.length);var Rr=_r===Nt}else var Rr=!0;if(Rr)if(Cr.messageAuthenticationCode!==void 0){let _r=Cr.messageAuthenticationCode;const Dr=Nt;if(Nt===Nt)if(typeof _r=="string"){if(!pattern4.test(_r))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/messageAuthenticationCode",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or+"/messageAuthenticationCode",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Rr=Dr===Nt}else var Rr=!0}}}}}}}}}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Or,schemaPath:"#/properties/encryption/properties/keyEncryption/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Ir=Er===Nt;if(!Ir)break}}}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption",schemaPath:"#/properties/encryption/properties/keyEncryption/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var $r=Ar===Nt}else var $r=!0}}}}else return validate27.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var vr=br===Nt}else var vr=!0;if(vr)if($t.descriptor!==void 0){let pr=$t.descriptor;const br=Nt,Sr=Nt;let Pr=!1;const Tr=Nt;if(pr&&typeof pr=="object"&&!Array.isArray(pr)){let Lr;if(pr.published===void 0&&(Lr="published")||pr.datePublished===void 0&&(Lr="datePublished")){const xr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/required",keyword:"required",params:{missingProperty:Lr},message:"must have required property '"+Lr+"'"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}else if(pr.published!==void 0){let xr=pr.published;if(typeof xr!="boolean"){const _r={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}if(xr!==!0){const _r={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/properties/published/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.allOf[0].anyOf[0].properties.published.enum},message:"must be equal to one of the allowed values"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}}}var rr=Tr===Nt;if(Pr=Pr||rr,rr){var Nr={};Nr.published=!0}const wr=Nt,Ar=Nt,Mr=Nt;if(pr&&typeof pr=="object"&&!Array.isArray(pr)&&pr.datePublished===void 0){const Lr={};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var kr=Mr===Nt;if(kr){const Lr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}else Nt=Ar,Bt!==null&&(Ar?Bt.length=Ar:Bt=null);if(Nt===wr&&pr&&typeof pr=="object"&&!Array.isArray(pr)&&pr.published!==void 0){let Lr=pr.published;if(typeof Lr!="boolean"){const xr={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}if(Lr!==!1){const xr={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/properties/published/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.allOf[0].anyOf[1].properties.published.enum},message:"must be equal to one of the allowed values"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}}var rr=wr===Nt;Pr=Pr||rr,rr&&Nr!==!0&&(Nr=Nr||{},Nr.published=!0);const Ur=Nt,Or=Nt,Cr=Nt,Er=Nt;if(pr&&typeof pr=="object"&&!Array.isArray(pr)&&pr.published===void 0){const Lr={};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var lr=Er===Nt;if(lr){const Lr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/2/allOf/0/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}else Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);var ir=Or===Nt;if(ir){const Lr=Nt,xr=Nt,_r=Nt;if(pr&&typeof pr=="object"&&!Array.isArray(pr)&&pr.datePublished===void 0){const jr={};Bt===null?Bt=[jr]:Bt.push(jr),Nt++}var er=_r===Nt;if(er){const jr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/2/allOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[jr]:Bt.push(jr),Nt++}else Nt=xr,Bt!==null&&(xr?Bt.length=xr:Bt=null);var ir=Lr===Nt}var rr=Ur===Nt;if(Pr=Pr||rr,Pr)Nt=Sr,Bt!==null&&(Sr?Bt.length=Sr:Bt=null);else{const Lr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++,validate27.errors=Bt,!1}if(Nt===br)if(pr&&typeof pr=="object"&&!Array.isArray(pr)){let Lr;if(pr.interface===void 0&&(Lr="interface")||pr.method===void 0&&(Lr="method")||pr.dataCid===void 0&&(Lr="dataCid")||pr.dataSize===void 0&&(Lr="dataSize")||pr.dateCreated===void 0&&(Lr="dateCreated")||pr.messageTimestamp===void 0&&(Lr="messageTimestamp")||pr.dataFormat===void 0&&(Lr="dataFormat"))return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Lr},message:"must have required property '"+Lr+"'"}],!1;{const xr=Nt;for(const _r in pr)if(!func1.call(schema39.properties.descriptor.properties,_r))return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:_r},message:"must NOT have additional properties"}],!1;if(xr===Nt){let _r;if(pr.parentId!==void 0&&pr.protocol===void 0&&(_r="protocol"))return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/dependencies",keyword:"dependencies",params:{property:"parentId",missingProperty:_r,depsCount:1,deps:"protocol"},message:"must have property protocol when property parentId is present"}],!1;if(pr.interface!==void 0){let Dr=pr.interface;const jr=Nt;if(typeof Dr!="string")return validate27.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Dr!=="Records")return validate27.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.method!==void 0){let Dr=pr.method;const jr=Nt;if(typeof Dr!="string")return validate27.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Dr!=="Write")return validate27.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.recipient!==void 0){let Dr=pr.recipient;const jr=Nt;if(Nt===Nt)if(typeof Dr=="string"){if(!pattern12.test(Dr))return validate27.errors=[{instancePath:e+"/descriptor/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.protocol!==void 0){const Dr=Nt;if(typeof pr.protocol!="string")return validate27.errors=[{instancePath:e+"/descriptor/protocol",schemaPath:"#/properties/descriptor/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Dr===Nt}else var yr=!0;if(yr){if(pr.protocolPath!==void 0){let Dr=pr.protocolPath;const jr=Nt;if(Nt===jr)if(typeof Dr=="string"){if(!pattern13.test(Dr))return validate27.errors=[{instancePath:e+"/descriptor/protocolPath",schemaPath:"#/properties/descriptor/properties/protocolPath/pattern",keyword:"pattern",params:{pattern:"^[a-zA-Z]+(/[a-zA-Z]+)*$"},message:'must match pattern "^[a-zA-Z]+(/[a-zA-Z]+)*$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/protocolPath",schemaPath:"#/properties/descriptor/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.schema!==void 0){const Dr=Nt;if(typeof pr.schema!="string")return validate27.errors=[{instancePath:e+"/descriptor/schema",schemaPath:"#/properties/descriptor/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Dr===Nt}else var yr=!0;if(yr){if(pr.tags!==void 0){let Dr=pr.tags;const jr=Nt;if(Nt===jr)if(Dr&&typeof Dr=="object"&&!Array.isArray(Dr)){if(Object.keys(Dr).length>10)return validate27.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/maxProperties",keyword:"maxProperties",params:{limit:10},message:"must NOT have more than 10 properties"}],!1;if(Object.keys(Dr).length<1)return validate27.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const Qr in Dr){let Yr=Dr[Qr];const an=Nt,cn=Nt;let Gr=!1,Fr=null;const en=Nt;if(typeof Yr!="string"){const rn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}var fr=en===Nt;fr&&(Gr=!0,Fr=0);const nn=Nt;if(!(typeof Yr=="number"&&isFinite(Yr))){const rn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/1/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}var fr=nn===Nt;if(fr&&Gr)Gr=!1,Fr=[Fr,1];else{fr&&(Gr=!0,Fr=1);const rn=Nt;if(typeof Yr!="boolean"){const yn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};Bt===null?Bt=[yn]:Bt.push(yn),Nt++}var fr=rn===Nt;if(fr&&Gr)Gr=!1,Fr=[Fr,2];else{fr&&(Gr=!0,Fr=2);const yn=Nt;if(Nt===yn)if(Array.isArray(Yr))if(Yr.length>10){const mn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/maxItems",keyword:"maxItems",params:{limit:10},message:"must NOT have more than 10 items"};Bt===null?Bt=[mn]:Bt.push(mn),Nt++}else if(Yr.length<1){const mn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};Bt===null?Bt=[mn]:Bt.push(mn),Nt++}else{var gr=!0;const mn=Yr.length;for(let Mn=0;Mn<mn;Mn++){const Bn=Nt;if(typeof Yr[Mn]!="string"){const kn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+Mn,schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/items/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[kn]:Bt.push(kn),Nt++}var gr=Bn===Nt;if(!gr)break}}else{const mn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/type",keyword:"type",params:{type:"array"},message:"must be array"};Bt===null?Bt=[mn]:Bt.push(mn),Nt++}var fr=yn===Nt;if(fr&&Gr)Gr=!1,Fr=[Fr,3];else{fr&&(Gr=!0,Fr=3);const mn=Nt;if(Nt===mn)if(Array.isArray(Yr))if(Yr.length>10){const Bn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/maxItems",keyword:"maxItems",params:{limit:10},message:"must NOT have more than 10 items"};Bt===null?Bt=[Bn]:Bt.push(Bn),Nt++}else if(Yr.length<1){const Bn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};Bt===null?Bt=[Bn]:Bt.push(Bn),Nt++}else{var ar=!0;const Bn=Yr.length;for(let Sn=0;Sn<Bn;Sn++){let kn=Yr[Sn];const Un=Nt;if(!(typeof kn=="number"&&isFinite(kn))){const Ln={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+Sn,schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/items/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[Ln]:Bt.push(Ln),Nt++}var ar=Un===Nt;if(!ar)break}}else{const Bn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/type",keyword:"type",params:{type:"array"},message:"must be array"};Bt===null?Bt=[Bn]:Bt.push(Bn),Nt++}var fr=mn===Nt;fr&&Gr?(Gr=!1,Fr=[Fr,4]):fr&&(Gr=!0,Fr=4)}}}if(Gr)Nt=cn,Bt!==null&&(cn?Bt.length=cn:Bt=null);else{const rn={instancePath:e+"/descriptor/tags/"+Qr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf",keyword:"oneOf",params:{passingSchemas:Fr},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[rn]:Bt.push(rn),Nt++,validate27.errors=Bt,!1}var nr=an===Nt;if(!nr)break}}else return validate27.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.parentId!==void 0){const Dr=Nt;if(typeof pr.parentId!="string")return validate27.errors=[{instancePath:e+"/descriptor/parentId",schemaPath:"#/properties/descriptor/properties/parentId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Dr===Nt}else var yr=!0;if(yr){if(pr.dataCid!==void 0){const Dr=Nt;if(typeof pr.dataCid!="string")return validate27.errors=[{instancePath:e+"/descriptor/dataCid",schemaPath:"#/properties/descriptor/properties/dataCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Dr===Nt}else var yr=!0;if(yr){if(pr.dataSize!==void 0){let Dr=pr.dataSize;const jr=Nt;if(!(typeof Dr=="number"&&isFinite(Dr)))return validate27.errors=[{instancePath:e+"/descriptor/dataSize",schemaPath:"#/properties/descriptor/properties/dataSize/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.dateCreated!==void 0){let Dr=pr.dateCreated;const jr=Nt;if(Nt===Nt)if(typeof Dr=="string"){if(!pattern14.test(Dr))return validate27.errors=[{instancePath:e+"/descriptor/dateCreated",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/dateCreated",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.messageTimestamp!==void 0){let Dr=pr.messageTimestamp;const jr=Nt;if(Nt===Nt)if(typeof Dr=="string"){if(!pattern14.test(Dr))return validate27.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=jr===Nt}else var yr=!0;if(yr){if(pr.published!==void 0){const Dr=Nt;if(typeof pr.published!="boolean")return validate27.errors=[{instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var yr=Dr===Nt}else var yr=!0;if(yr){if(pr.datePublished!==void 0){let Dr=pr.datePublished;const jr=Nt;if(Nt===Nt)if(typeof Dr=="string"){if(!pattern14.test(Dr))return validate27.errors=[{instancePath:e+"/descriptor/datePublished",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/datePublished",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=jr===Nt}else var yr=!0;if(yr)if(pr.dataFormat!==void 0){const Dr=Nt;if(typeof pr.dataFormat!="string")return validate27.errors=[{instancePath:e+"/descriptor/dataFormat",schemaPath:"#/properties/descriptor/properties/dataFormat/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Dr===Nt}else var yr=!0}}}}}}}}}}}}}}}}else return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var vr=br===Nt}else var vr=!0}}}}}else return validate27.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate27.errors=Bt,Ut.props=qt,Nt===0}validate27.evaluated={dynamicProps:!0,dynamicItems:!1};function validate26($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate26.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),!validate27($t,{instancePath:e,parentData:_t,parentDataProperty:At,rootData:xt,dynamicAnchors:kt}))Bt=Bt===null?validate27.errors:Bt.concat(validate27.errors),Nt=Bt.length;else var Lt=validate27.evaluated.props;if(Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Kt;if($t.recordId===void 0&&(Kt="recordId")||$t.authorization===void 0&&(Kt="authorization")||$t.encodedData===void 0&&(Kt="encodedData"))return validate26.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Kt},message:"must have required property '"+Kt+"'"}],!1;if(Lt!==!0&&(Lt=Lt||{},Lt.encodedData=!0),$t.encodedData!==void 0){const qt=Nt;if(typeof $t.encodedData!="string")return validate26.errors=[{instancePath:e+"/encodedData",schemaPath:"#/properties/encodedData/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=qt===Nt}else var jt=!0;if(jt&&Lt!==!0){for(const qt in $t)if(!Lt||!Lt[qt])return validate26.errors=[{instancePath:e,schemaPath:"#/unevaluatedProperties",keyword:"unevaluatedProperties",params:{unevaluatedProperty:qt},message:"must NOT have unevaluated properties"}],!1}}else return validate26.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate26.errors=Bt,Nt===0}validate26.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate24($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate24.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){const jt=Nt;for(const Kt in $t)if(!(Kt==="signature"||Kt==="authorDelegatedGrant"))return validate24.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Kt},message:"must NOT have additional properties"}],!1;if(jt===Nt){if($t.signature!==void 0){const Kt=Nt;validate21($t.signature,{instancePath:e+"/signature",parentData:$t,parentDataProperty:"signature",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate21.errors:Bt.concat(validate21.errors),Nt=Bt.length);var Lt=Kt===Nt}else var Lt=!0;if(Lt)if($t.authorDelegatedGrant!==void 0){const Kt=Nt;validate26($t.authorDelegatedGrant,{instancePath:e+"/authorDelegatedGrant",parentData:$t,parentDataProperty:"authorDelegatedGrant",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate26.errors:Bt.concat(validate26.errors),Nt=Bt.length);var Lt=Kt===Nt}else var Lt=!0}}else return validate24.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate24.errors=Bt,Nt===0}validate24.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const AuthorizationOwner=validate29,RecordsDelete$1=validate38,schema51={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-delete.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","recordId","prune"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Delete"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},recordId:{type:"string"},prune:{type:"boolean"}}}}};function validate38($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate38.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Kt;if($t.authorization===void 0&&(Kt="authorization")||$t.descriptor===void 0&&(Kt="descriptor"))return validate38.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Kt},message:"must have required property '"+Kt+"'"}],!1;{const qt=Nt;for(const zt in $t)if(!(zt==="authorization"||zt==="descriptor"))return validate38.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:zt},message:"must NOT have additional properties"}],!1;if(qt===Nt){if($t.authorization!==void 0){const zt=Nt;validate24($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate24.errors:Bt.concat(validate24.errors),Nt=Bt.length);var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let zt=$t.descriptor;const Vt=Nt;if(Nt===Vt)if(zt&&typeof zt=="object"&&!Array.isArray(zt)){let Wt;if(zt.interface===void 0&&(Wt="interface")||zt.method===void 0&&(Wt="method")||zt.messageTimestamp===void 0&&(Wt="messageTimestamp")||zt.recordId===void 0&&(Wt="recordId")||zt.prune===void 0&&(Wt="prune"))return validate38.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Wt},message:"must have required property '"+Wt+"'"}],!1;{const Qt=Nt;for(const Xt in zt)if(!(Xt==="interface"||Xt==="method"||Xt==="messageTimestamp"||Xt==="recordId"||Xt==="prune"))return validate38.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xt},message:"must NOT have additional properties"}],!1;if(Qt===Nt){if(zt.interface!==void 0){let Xt=zt.interface;const Jt=Nt;if(typeof Xt!="string")return validate38.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Records")return validate38.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema51.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.method!==void 0){let Xt=zt.method;const Jt=Nt;if(typeof Xt!="string")return validate38.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Delete")return validate38.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema51.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.messageTimestamp!==void 0){let Xt=zt.messageTimestamp;const Jt=Nt;if(Nt===Nt)if(typeof Xt=="string"){if(!pattern14.test(Xt))return validate38.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate38.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.recordId!==void 0){const Xt=Nt;if(typeof zt.recordId!="string")return validate38.errors=[{instancePath:e+"/descriptor/recordId",schemaPath:"#/properties/descriptor/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Xt===Nt}else var jt=!0;if(jt)if(zt.prune!==void 0){const Xt=Nt;if(typeof zt.prune!="boolean")return validate38.errors=[{instancePath:e+"/descriptor/prune",schemaPath:"#/properties/descriptor/properties/prune/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var jt=Xt===Nt}else var jt=!0}}}}}}else return validate38.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Vt===Nt}else var Lt=!0}}}else return validate38.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate38.errors=Bt,Nt===0}validate38.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsQuery$1=validate40,schema53={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-query.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"},pagination:{type:"object",additionalProperties:!1,properties:{limit:{type:"number",minimum:1},cursor:{$ref:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json"}}},dateSort:{enum:["createdAscending","createdDescending","publishedAscending","publishedDescending"],type:"string"}}}}},schema70={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json",type:"object",minProperties:1,additionalProperties:!1,required:["messageCid","value"],properties:{messageCid:{type:"string"},value:{type:["string","number"]}}},schema55={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-filter.json",type:"object",minProperties:1,additionalProperties:!1,properties:{protocol:{type:"string"},protocolPath:{type:"string"},author:{oneOf:[{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}]},attester:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},recipient:{oneOf:[{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}]},contextId:{type:"string"},schema:{type:"string"},tags:{type:"object",minProperties:1,additionalProperties:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"object",minProperties:1,additionalProperties:!1,properties:{startsWith:{type:"string"}}},{$ref:"https://identity.foundation/dwn/json-schemas/string-range-filter.json"},{$ref:"https://identity.foundation/dwn/json-schemas/number-range-filter.json"}]}},recordId:{type:"string"},parentId:{type:"string"},published:{type:"boolean"},dataFormat:{type:"string"},dataSize:{$ref:"https://identity.foundation/dwn/json-schemas/number-range-filter.json"},dataCid:{type:"string"},dateCreated:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}},datePublished:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}},dateUpdated:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}}},dependencies:{datePublished:{oneOf:[{properties:{published:{enum:[!0]}},required:["published"]},{not:{required:["published"]}}]}}};function validate42($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate42.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){if(Object.keys($t).length<1)return validate42.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Pr=Nt;for(const Tr in $t)if(!func1.call(schema55.properties,Tr))return validate42.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Tr},message:"must NOT have additional properties"}],!1;if(Pr===Nt){if($t.datePublished!==void 0){const Tr=Nt,wr=Nt;let Ar=!1,Mr=null;const Ur=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let Br;if($t.published===void 0&&(Br="published")){const Lr={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf/0/required",keyword:"required",params:{missingProperty:Br},message:"must have required property '"+Br+"'"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}else if($t.published!==void 0&&$t.published!==!0){const Lr={instancePath:e+"/published",schemaPath:"#/dependencies/datePublished/oneOf/0/properties/published/enum",keyword:"enum",params:{allowedValues:schema55.dependencies.datePublished.oneOf[0].properties.published.enum},message:"must be equal to one of the allowed values"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}}var Kt=Ur===Nt;if(Kt){Ar=!0,Mr=0;var Lt={};Lt.published=!0}const Or=Nt,Cr=Nt,Er=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.published===void 0){const Br={};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var jt=Er===Nt;if(jt){const Br={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}else Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);var Kt=Or===Nt;if(Kt&&Ar?(Ar=!1,Mr=[Mr,1]):Kt&&(Ar=!0,Mr=1),Ar)Nt=wr,Bt!==null&&(wr?Bt.length=wr:Bt=null);else{const Br={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf",keyword:"oneOf",params:{passingSchemas:Mr},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[Br]:Bt.push(Br),Nt++,validate42.errors=Bt,!1}var qt=Tr===Nt}else var qt=!0;if(qt){if($t.protocol!==void 0){const Tr=Nt;if(typeof $t.protocol!="string")return validate42.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.protocolPath!==void 0){const Tr=Nt;if(typeof $t.protocolPath!="string")return validate42.errors=[{instancePath:e+"/protocolPath",schemaPath:"#/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.author!==void 0){let Tr=$t.author;const wr=Nt,Ar=Nt;let Mr=!1,Ur=null;const Or=Nt;if(Nt===Nt)if(typeof Tr=="string"){if(!pattern12.test(Tr)){const Lr={instancePath:e+"/author",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}}else{const Lr={instancePath:e+"/author",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var Ht=Or===Nt;Ht&&(Mr=!0,Ur=0);const Er=Nt;if(Nt===Er)if(Array.isArray(Tr)){var Vt=!0;const Lr=Tr.length;for(let xr=0;xr<Lr;xr++){let _r=Tr[xr];const Dr=Nt;if(Nt===Nt)if(typeof _r=="string"){if(!pattern12.test(_r)){const Qr={instancePath:e+"/author/"+xr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};Bt===null?Bt=[Qr]:Bt.push(Qr),Nt++}}else{const Qr={instancePath:e+"/author/"+xr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Qr]:Bt.push(Qr),Nt++}var Vt=Dr===Nt;if(!Vt)break}}else{const Lr={instancePath:e+"/author",schemaPath:"#/properties/author/oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var Ht=Er===Nt;if(Ht&&Mr?(Mr=!1,Ur=[Ur,1]):Ht&&(Mr=!0,Ur=1),Mr)Nt=Ar,Bt!==null&&(Ar?Bt.length=Ar:Bt=null);else{const Lr={instancePath:e+"/author",schemaPath:"#/properties/author/oneOf",keyword:"oneOf",params:{passingSchemas:Ur},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++,validate42.errors=Bt,!1}var zt=wr===Nt}else var zt=!0;if(zt){if($t.attester!==void 0){let Tr=$t.attester;const wr=Nt;if(Nt===Nt)if(typeof Tr=="string"){if(!pattern12.test(Tr))return validate42.errors=[{instancePath:e+"/attester",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate42.errors=[{instancePath:e+"/attester",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=wr===Nt}else var zt=!0;if(zt){if($t.recipient!==void 0){let Tr=$t.recipient;const wr=Nt,Ar=Nt;let Mr=!1,Ur=null;const Or=Nt;if(Nt===Nt)if(typeof Tr=="string"){if(!pattern12.test(Tr)){const Lr={instancePath:e+"/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}}else{const Lr={instancePath:e+"/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var Qt=Or===Nt;Qt&&(Mr=!0,Ur=0);const Er=Nt;if(Nt===Er)if(Array.isArray(Tr)){var Wt=!0;const Lr=Tr.length;for(let xr=0;xr<Lr;xr++){let _r=Tr[xr];const Dr=Nt;if(Nt===Nt)if(typeof _r=="string"){if(!pattern12.test(_r)){const Qr={instancePath:e+"/recipient/"+xr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};Bt===null?Bt=[Qr]:Bt.push(Qr),Nt++}}else{const Qr={instancePath:e+"/recipient/"+xr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Qr]:Bt.push(Qr),Nt++}var Wt=Dr===Nt;if(!Wt)break}}else{const Lr={instancePath:e+"/recipient",schemaPath:"#/properties/recipient/oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var Qt=Er===Nt;if(Qt&&Mr?(Mr=!1,Ur=[Ur,1]):Qt&&(Mr=!0,Ur=1),Mr)Nt=Ar,Bt!==null&&(Ar?Bt.length=Ar:Bt=null);else{const Lr={instancePath:e+"/recipient",schemaPath:"#/properties/recipient/oneOf",keyword:"oneOf",params:{passingSchemas:Ur},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++,validate42.errors=Bt,!1}var zt=wr===Nt}else var zt=!0;if(zt){if($t.contextId!==void 0){const Tr=Nt;if(typeof $t.contextId!="string")return validate42.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.schema!==void 0){const Tr=Nt;if(typeof $t.schema!="string")return validate42.errors=[{instancePath:e+"/schema",schemaPath:"#/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.tags!==void 0){let Tr=$t.tags;const wr=Nt;if(Nt===wr)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){if(Object.keys(Tr).length<1)return validate42.errors=[{instancePath:e+"/tags",schemaPath:"#/properties/tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const Mr in Tr){let Ur=Tr[Mr];const Or=Nt,Cr=Nt;let Er=!1,Br=null;const Lr=Nt;if(typeof Ur!="string"){const _r={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Xt=Lr===Nt;Xt&&(Er=!0,Br=0);const xr=Nt;if(!(typeof Ur=="number"&&isFinite(Ur))){const _r={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/1/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Xt=xr===Nt;if(Xt&&Er)Er=!1,Br=[Br,1];else{Xt&&(Er=!0,Br=1);const _r=Nt;if(typeof Ur!="boolean"){const jr={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};Bt===null?Bt=[jr]:Bt.push(jr),Nt++}var Xt=_r===Nt;if(Xt&&Er)Er=!1,Br=[Br,2];else{Xt&&(Er=!0,Br=2);const jr=Nt;if(Nt===jr)if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur))if(Object.keys(Ur).length<1){const Qr={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};Bt===null?Bt=[Qr]:Bt.push(Qr),Nt++}else{const Qr=Nt;for(const Yr in Ur)if(Yr!=="startsWith"){const an={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Yr},message:"must NOT have additional properties"};Bt===null?Bt=[an]:Bt.push(an),Nt++;break}if(Qr===Nt&&Ur.startsWith!==void 0&&typeof Ur.startsWith!="string"){const Yr={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/startsWith",schemaPath:"#/properties/tags/additionalProperties/oneOf/3/properties/startsWith/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Yr]:Bt.push(Yr),Nt++}}else{const Qr={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Qr]:Bt.push(Qr),Nt++}var Xt=jr===Nt;if(Xt&&Er)Er=!1,Br=[Br,3];else{Xt&&(Er=!0,Br=3);const Qr=Nt;if(Nt===Nt)if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur))if(Object.keys(Ur).length<1){const cn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};Bt===null?Bt=[cn]:Bt.push(cn),Nt++}else{const cn=Nt;for(const Gr in Ur)if(!(Gr==="gt"||Gr==="gte"||Gr==="lt"||Gr==="lte")){const Fr={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Gr},message:"must NOT have additional properties"};Bt===null?Bt=[Fr]:Bt.push(Fr),Nt++;break}if(cn===Nt){if(Ur.gt!==void 0){const Gr=Nt,Fr=Nt,en=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.gte===void 0){const nn={};Bt===null?Bt=[nn]:Bt.push(nn),Nt++}var Jt=en===Nt;if(Jt){const nn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[nn]:Bt.push(nn),Nt++}else Nt=Fr,Bt!==null&&(Fr?Bt.length=Fr:Bt=null);var tr=Gr===Nt}else var tr=!0;if(tr){if(Ur.gte!==void 0){const Gr=Nt,Fr=Nt,en=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.gt===void 0){const rn={};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}var dr=en===Nt;if(dr){const rn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}else Nt=Fr,Bt!==null&&(Fr?Bt.length=Fr:Bt=null);var tr=Gr===Nt}else var tr=!0;if(tr){if(Ur.lt!==void 0){const Gr=Nt,Fr=Nt,en=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.lte===void 0){const rn={};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}var vr=en===Nt;if(vr){const rn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}else Nt=Fr,Bt!==null&&(Fr?Bt.length=Fr:Bt=null);var tr=Gr===Nt}else var tr=!0;if(tr){if(Ur.lte!==void 0){const Gr=Nt,Fr=Nt,en=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.lt===void 0){const rn={};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}var $r=en===Nt;if($r){const rn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[rn]:Bt.push(rn),Nt++}else Nt=Fr,Bt!==null&&(Fr?Bt.length=Fr:Bt=null);var tr=Gr===Nt}else var tr=!0;if(tr){if(Ur.gt!==void 0){const Gr=Nt;if(typeof Ur.gt!="string"){const Fr={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/gt/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Fr]:Bt.push(Fr),Nt++}var Ir=Gr===Nt}else var Ir=!0;if(Ir){if(Ur.gte!==void 0){const Gr=Nt;if(typeof Ur.gte!="string"){const en={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/gte/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[en]:Bt.push(en),Nt++}var Ir=Gr===Nt}else var Ir=!0;if(Ir){if(Ur.lt!==void 0){const Gr=Nt;if(typeof Ur.lt!="string"){const en={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/lt/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[en]:Bt.push(en),Nt++}var Ir=Gr===Nt}else var Ir=!0;if(Ir)if(Ur.lte!==void 0){const Gr=Nt;if(typeof Ur.lte!="string"){const en={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/lte/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[en]:Bt.push(en),Nt++}var Ir=Gr===Nt}else var Ir=!0}}}}}}}}else{const cn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[cn]:Bt.push(cn),Nt++}var Xt=Qr===Nt;if(Xt&&Er)Er=!1,Br=[Br,4];else{Xt&&(Er=!0,Br=4);const cn=Nt;if(Nt===Nt)if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur))if(Object.keys(Ur).length<1){const en={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};Bt===null?Bt=[en]:Bt.push(en),Nt++}else{const en=Nt;for(const nn in Ur)if(!(nn==="gt"||nn==="gte"||nn==="lt"||nn==="lte")){const rn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nn},message:"must NOT have additional properties"};Bt===null?Bt=[rn]:Bt.push(rn),Nt++;break}if(en===Nt){if(Ur.gt!==void 0){const nn=Nt,rn=Nt,hn=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.gte===void 0){const yn={};Bt===null?Bt=[yn]:Bt.push(yn),Nt++}var Rr=hn===Nt;if(Rr){const yn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[yn]:Bt.push(yn),Nt++}else Nt=rn,Bt!==null&&(rn?Bt.length=rn:Bt=null);var Nr=nn===Nt}else var Nr=!0;if(Nr){if(Ur.gte!==void 0){const nn=Nt,rn=Nt,hn=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.gt===void 0){const wn={};Bt===null?Bt=[wn]:Bt.push(wn),Nt++}var kr=hn===Nt;if(kr){const wn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[wn]:Bt.push(wn),Nt++}else Nt=rn,Bt!==null&&(rn?Bt.length=rn:Bt=null);var Nr=nn===Nt}else var Nr=!0;if(Nr){if(Ur.lt!==void 0){const nn=Nt,rn=Nt,hn=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.lte===void 0){const wn={};Bt===null?Bt=[wn]:Bt.push(wn),Nt++}var lr=hn===Nt;if(lr){const wn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[wn]:Bt.push(wn),Nt++}else Nt=rn,Bt!==null&&(rn?Bt.length=rn:Bt=null);var Nr=nn===Nt}else var Nr=!0;if(Nr){if(Ur.lte!==void 0){const nn=Nt,rn=Nt,hn=Nt;if(Ur&&typeof Ur=="object"&&!Array.isArray(Ur)&&Ur.lt===void 0){const wn={};Bt===null?Bt=[wn]:Bt.push(wn),Nt++}var ir=hn===Nt;if(ir){const wn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"};Bt===null?Bt=[wn]:Bt.push(wn),Nt++}else Nt=rn,Bt!==null&&(rn?Bt.length=rn:Bt=null);var Nr=nn===Nt}else var Nr=!0;if(Nr){if(Ur.gt!==void 0){let nn=Ur.gt;const rn=Nt;if(!(typeof nn=="number"&&isFinite(nn))){const hn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[hn]:Bt.push(hn),Nt++}var er=rn===Nt}else var er=!0;if(er){if(Ur.gte!==void 0){let nn=Ur.gte;const rn=Nt;if(!(typeof nn=="number"&&isFinite(nn))){const yn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[yn]:Bt.push(yn),Nt++}var er=rn===Nt}else var er=!0;if(er){if(Ur.lt!==void 0){let nn=Ur.lt;const rn=Nt;if(!(typeof nn=="number"&&isFinite(nn))){const yn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[yn]:Bt.push(yn),Nt++}var er=rn===Nt}else var er=!0;if(er)if(Ur.lte!==void 0){let nn=Ur.lte;const rn=Nt;if(!(typeof nn=="number"&&isFinite(nn))){const yn={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"};Bt===null?Bt=[yn]:Bt.push(yn),Nt++}var er=rn===Nt}else var er=!0}}}}}}}}else{const en={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[en]:Bt.push(en),Nt++}var Xt=cn===Nt;Xt&&Er?(Er=!1,Br=[Br,5]):Xt&&(Er=!0,Br=5)}}}}if(Er)Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);else{const _r={instancePath:e+"/tags/"+Mr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf",keyword:"oneOf",params:{passingSchemas:Br},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[_r]:Bt.push(_r),Nt++,validate42.errors=Bt,!1}var rr=Or===Nt;if(!rr)break}}else return validate42.errors=[{instancePath:e+"/tags",schemaPath:"#/properties/tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=wr===Nt}else var zt=!0;if(zt){if($t.recordId!==void 0){const Tr=Nt;if(typeof $t.recordId!="string")return validate42.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.parentId!==void 0){const Tr=Nt;if(typeof $t.parentId!="string")return validate42.errors=[{instancePath:e+"/parentId",schemaPath:"#/properties/parentId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.published!==void 0){const Tr=Nt;if(typeof $t.published!="boolean")return validate42.errors=[{instancePath:e+"/published",schemaPath:"#/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.dataFormat!==void 0){const Tr=Nt;if(typeof $t.dataFormat!="string")return validate42.errors=[{instancePath:e+"/dataFormat",schemaPath:"#/properties/dataFormat/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.dataSize!==void 0){let Tr=$t.dataSize;const wr=Nt;if(Nt===Nt)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){if(Object.keys(Tr).length<1)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Ur=Nt;for(const Or in Tr)if(!(Or==="gt"||Or==="gte"||Or==="lt"||Or==="lte"))return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Or},message:"must NOT have additional properties"}],!1;if(Ur===Nt){if(Tr.gt!==void 0){const Or=Nt,Cr=Nt,Er=Nt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.gte===void 0){const Br={};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var yr=Er===Nt;if(yr)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);var fr=Or===Nt}else var fr=!0;if(fr){if(Tr.gte!==void 0){const Or=Nt,Cr=Nt,Er=Nt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.gt===void 0){const Lr={};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var gr=Er===Nt;if(gr)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);var fr=Or===Nt}else var fr=!0;if(fr){if(Tr.lt!==void 0){const Or=Nt,Cr=Nt,Er=Nt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.lte===void 0){const Lr={};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var ar=Er===Nt;if(ar)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);var fr=Or===Nt}else var fr=!0;if(fr){if(Tr.lte!==void 0){const Or=Nt,Cr=Nt,Er=Nt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.lt===void 0){const Lr={};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var nr=Er===Nt;if(nr)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Cr,Bt!==null&&(Cr?Bt.length=Cr:Bt=null);var fr=Or===Nt}else var fr=!0;if(fr){if(Tr.gt!==void 0){let Or=Tr.gt;const Cr=Nt;if(!(typeof Or=="number"&&isFinite(Or)))return validate42.errors=[{instancePath:e+"/dataSize/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ur=Cr===Nt}else var ur=!0;if(ur){if(Tr.gte!==void 0){let Or=Tr.gte;const Cr=Nt;if(!(typeof Or=="number"&&isFinite(Or)))return validate42.errors=[{instancePath:e+"/dataSize/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ur=Cr===Nt}else var ur=!0;if(ur){if(Tr.lt!==void 0){let Or=Tr.lt;const Cr=Nt;if(!(typeof Or=="number"&&isFinite(Or)))return validate42.errors=[{instancePath:e+"/dataSize/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ur=Cr===Nt}else var ur=!0;if(ur)if(Tr.lte!==void 0){let Or=Tr.lte;const Cr=Nt;if(!(typeof Or=="number"&&isFinite(Or)))return validate42.errors=[{instancePath:e+"/dataSize/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ur=Cr===Nt}else var ur=!0}}}}}}}}}else return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=wr===Nt}else var zt=!0;if(zt){if($t.dataCid!==void 0){const Tr=Nt;if(typeof $t.dataCid!="string")return validate42.errors=[{instancePath:e+"/dataCid",schemaPath:"#/properties/dataCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=Tr===Nt}else var zt=!0;if(zt){if($t.dateCreated!==void 0){let Tr=$t.dateCreated;const wr=Nt;if(Nt===wr)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){if(Object.keys(Tr).length<1)return validate42.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Mr=Nt;for(const Ur in Tr)if(!(Ur==="from"||Ur==="to"))return validate42.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ur},message:"must NOT have additional properties"}],!1;if(Mr===Nt){if(Tr.from!==void 0){let Ur=Tr.from;const Or=Nt;if(Nt===Nt)if(typeof Ur=="string"){if(!pattern14.test(Ur))return validate42.errors=[{instancePath:e+"/dateCreated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateCreated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var pr=Or===Nt}else var pr=!0;if(pr)if(Tr.to!==void 0){let Ur=Tr.to;const Or=Nt;if(Nt===Nt)if(typeof Ur=="string"){if(!pattern14.test(Ur))return validate42.errors=[{instancePath:e+"/dateCreated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateCreated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var pr=Or===Nt}else var pr=!0}}}else return validate42.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=wr===Nt}else var zt=!0;if(zt){if($t.datePublished!==void 0){let Tr=$t.datePublished;const wr=Nt;if(Nt===wr)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){if(Object.keys(Tr).length<1)return validate42.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Mr=Nt;for(const Ur in Tr)if(!(Ur==="from"||Ur==="to"))return validate42.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ur},message:"must NOT have additional properties"}],!1;if(Mr===Nt){if(Tr.from!==void 0){let Ur=Tr.from;const Or=Nt;if(Nt===Nt)if(typeof Ur=="string"){if(!pattern14.test(Ur))return validate42.errors=[{instancePath:e+"/datePublished/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/datePublished/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=Or===Nt}else var br=!0;if(br)if(Tr.to!==void 0){let Ur=Tr.to;const Or=Nt;if(Nt===Nt)if(typeof Ur=="string"){if(!pattern14.test(Ur))return validate42.errors=[{instancePath:e+"/datePublished/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/datePublished/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=Or===Nt}else var br=!0}}}else return validate42.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=wr===Nt}else var zt=!0;if(zt)if($t.dateUpdated!==void 0){let Tr=$t.dateUpdated;const wr=Nt;if(Nt===wr)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){if(Object.keys(Tr).length<1)return validate42.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Mr=Nt;for(const Ur in Tr)if(!(Ur==="from"||Ur==="to"))return validate42.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ur},message:"must NOT have additional properties"}],!1;if(Mr===Nt){if(Tr.from!==void 0){let Ur=Tr.from;const Or=Nt;if(Nt===Nt)if(typeof Ur=="string"){if(!pattern14.test(Ur))return validate42.errors=[{instancePath:e+"/dateUpdated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateUpdated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Sr=Or===Nt}else var Sr=!0;if(Sr)if(Tr.to!==void 0){let Ur=Tr.to;const Or=Nt;if(Nt===Nt)if(typeof Ur=="string"){if(!pattern14.test(Ur))return validate42.errors=[{instancePath:e+"/dateUpdated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateUpdated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Sr=Or===Nt}else var Sr=!0}}}else return validate42.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=wr===Nt}else var zt=!0}}}}}}}}}}}}}}}}}}}else return validate42.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate42.errors=Bt,Nt===0}validate42.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate40($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate40.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let zt;if($t.descriptor===void 0&&(zt="descriptor"))return validate40.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;{const Vt=Nt;for(const Ht in $t)if(!(Ht==="authorization"||Ht==="descriptor"))return validate40.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ht},message:"must NOT have additional properties"}],!1;if(Vt===Nt){if($t.authorization!==void 0){const Ht=Nt;validate24($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate24.errors:Bt.concat(validate24.errors),Nt=Bt.length);var Lt=Ht===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let Ht=$t.descriptor;const Wt=Nt;if(Nt===Wt)if(Ht&&typeof Ht=="object"&&!Array.isArray(Ht)){let Xt;if(Ht.interface===void 0&&(Xt="interface")||Ht.method===void 0&&(Xt="method")||Ht.messageTimestamp===void 0&&(Xt="messageTimestamp")||Ht.filter===void 0&&(Xt="filter"))return validate40.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Xt},message:"must have required property '"+Xt+"'"}],!1;{const Jt=Nt;for(const tr in Ht)if(!(tr==="interface"||tr==="method"||tr==="messageTimestamp"||tr==="filter"||tr==="pagination"||tr==="dateSort"))return validate40.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:tr},message:"must NOT have additional properties"}],!1;if(Jt===Nt){if(Ht.interface!==void 0){let tr=Ht.interface;const dr=Nt;if(typeof tr!="string")return validate40.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(tr!=="Records")return validate40.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema53.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=dr===Nt}else var jt=!0;if(jt){if(Ht.method!==void 0){let tr=Ht.method;const dr=Nt;if(typeof tr!="string")return validate40.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(tr!=="Query")return validate40.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema53.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=dr===Nt}else var jt=!0;if(jt){if(Ht.messageTimestamp!==void 0){let tr=Ht.messageTimestamp;const dr=Nt;if(Nt===Nt)if(typeof tr=="string"){if(!pattern14.test(tr))return validate40.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate40.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=dr===Nt}else var jt=!0;if(jt){if(Ht.filter!==void 0){const tr=Nt;validate42(Ht.filter,{instancePath:e+"/descriptor/filter",parentData:Ht,parentDataProperty:"filter",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate42.errors:Bt.concat(validate42.errors),Nt=Bt.length);var jt=tr===Nt}else var jt=!0;if(jt){if(Ht.pagination!==void 0){let tr=Ht.pagination;const dr=Nt;if(Nt===dr)if(tr&&typeof tr=="object"&&!Array.isArray(tr)){const $r=Nt;for(const Ir in tr)if(!(Ir==="limit"||Ir==="cursor"))return validate40.errors=[{instancePath:e+"/descriptor/pagination",schemaPath:"#/properties/descriptor/properties/pagination/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ir},message:"must NOT have additional properties"}],!1;if($r===Nt){if(tr.limit!==void 0){let Ir=tr.limit;const Rr=Nt;if(Nt===Rr)if(typeof Ir=="number"&&isFinite(Ir)){if(Ir<1||isNaN(Ir))return validate40.errors=[{instancePath:e+"/descriptor/pagination/limit",schemaPath:"#/properties/descriptor/properties/pagination/properties/limit/minimum",keyword:"minimum",params:{comparison:">=",limit:1},message:"must be >= 1"}],!1}else return validate40.errors=[{instancePath:e+"/descriptor/pagination/limit",schemaPath:"#/properties/descriptor/properties/pagination/properties/limit/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Kt=Rr===Nt}else var Kt=!0;if(Kt)if(tr.cursor!==void 0){let Ir=tr.cursor;const Rr=Nt;if(Nt===Nt)if(Ir&&typeof Ir=="object"&&!Array.isArray(Ir)){if(Object.keys(Ir).length<1)return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let lr;if(Ir.messageCid===void 0&&(lr="messageCid")||Ir.value===void 0&&(lr="value"))return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/required",keyword:"required",params:{missingProperty:lr},message:"must have required property '"+lr+"'"}],!1;{const ir=Nt;for(const er in Ir)if(!(er==="messageCid"||er==="value"))return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:er},message:"must NOT have additional properties"}],!1;if(ir===Nt){if(Ir.messageCid!==void 0){const er=Nt;if(typeof Ir.messageCid!="string")return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor/messageCid",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var qt=er===Nt}else var qt=!0;if(qt)if(Ir.value!==void 0){let er=Ir.value;const rr=Nt;if(typeof er!="string"&&!(typeof er=="number"&&isFinite(er)))return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor/value",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/value/type",keyword:"type",params:{type:schema70.properties.value.type},message:"must be string,number"}],!1;var qt=rr===Nt}else var qt=!0}}}}else return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Kt=Rr===Nt}else var Kt=!0}}else return validate40.errors=[{instancePath:e+"/descriptor/pagination",schemaPath:"#/properties/descriptor/properties/pagination/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=dr===Nt}else var jt=!0;if(jt)if(Ht.dateSort!==void 0){let tr=Ht.dateSort;const dr=Nt;if(typeof tr!="string")return validate40.errors=[{instancePath:e+"/descriptor/dateSort",schemaPath:"#/properties/descriptor/properties/dateSort/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(tr==="createdAscending"||tr==="createdDescending"||tr==="publishedAscending"||tr==="publishedDescending"))return validate40.errors=[{instancePath:e+"/descriptor/dateSort",schemaPath:"#/properties/descriptor/properties/dateSort/enum",keyword:"enum",params:{allowedValues:schema53.properties.descriptor.properties.dateSort.enum},message:"must be equal to one of the allowed values"}],!1;var jt=dr===Nt}else var jt=!0}}}}}}}else return validate40.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Wt===Nt}else var Lt=!0}}}else return validate40.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate40.errors=Bt,Nt===0}validate40.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsSubscribe$1=validate44,schema71={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-subscribe.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Subscribe"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"}}}}};function validate44($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate44.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Kt;if($t.descriptor===void 0&&(Kt="descriptor"))return validate44.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Kt},message:"must have required property '"+Kt+"'"}],!1;{const qt=Nt;for(const zt in $t)if(!(zt==="authorization"||zt==="descriptor"))return validate44.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:zt},message:"must NOT have additional properties"}],!1;if(qt===Nt){if($t.authorization!==void 0){const zt=Nt;validate24($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate24.errors:Bt.concat(validate24.errors),Nt=Bt.length);var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let zt=$t.descriptor;const Vt=Nt;if(Nt===Vt)if(zt&&typeof zt=="object"&&!Array.isArray(zt)){let Wt;if(zt.interface===void 0&&(Wt="interface")||zt.method===void 0&&(Wt="method")||zt.messageTimestamp===void 0&&(Wt="messageTimestamp")||zt.filter===void 0&&(Wt="filter"))return validate44.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Wt},message:"must have required property '"+Wt+"'"}],!1;{const Qt=Nt;for(const Xt in zt)if(!(Xt==="interface"||Xt==="method"||Xt==="messageTimestamp"||Xt==="filter"))return validate44.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xt},message:"must NOT have additional properties"}],!1;if(Qt===Nt){if(zt.interface!==void 0){let Xt=zt.interface;const Jt=Nt;if(typeof Xt!="string")return validate44.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Records")return validate44.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema71.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.method!==void 0){let Xt=zt.method;const Jt=Nt;if(typeof Xt!="string")return validate44.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Subscribe")return validate44.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema71.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.messageTimestamp!==void 0){let Xt=zt.messageTimestamp;const Jt=Nt;if(Nt===Nt)if(typeof Xt=="string"){if(!pattern14.test(Xt))return validate44.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate44.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt)if(zt.filter!==void 0){const Xt=Nt;validate42(zt.filter,{instancePath:e+"/descriptor/filter",parentData:zt,parentDataProperty:"filter",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate42.errors:Bt.concat(validate42.errors),Nt=Bt.length);var jt=Xt===Nt}else var jt=!0}}}}}else return validate44.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Vt===Nt}else var Lt=!0}}}else return validate44.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate44.errors=Bt,Nt===0}validate44.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsWrite$1=validate47;function validate47($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate47.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),!validate27($t,{instancePath:e,parentData:_t,parentDataProperty:At,rootData:xt,dynamicAnchors:kt}))Bt=Bt===null?validate27.errors:Bt.concat(validate27.errors),Nt=Bt.length;else var Lt=validate27.evaluated.props;if(Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let jt;if($t.recordId===void 0&&(jt="recordId")||$t.authorization===void 0&&(jt="authorization"))return validate47.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;if(Lt!==!0){for(const Kt in $t)if(!Lt||!Lt[Kt])return validate47.errors=[{instancePath:e,schemaPath:"#/unevaluatedProperties",keyword:"unevaluatedProperties",params:{unevaluatedProperty:Kt},message:"must NOT have unevaluated properties"}],!1}}else return validate47.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate47.errors=Bt,Nt===0}validate47.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsWriteDataEncoded=validate26,RecordsWriteUnidentified=validate27,Definitions=validate22;function validate22($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate22.evaluated;return Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)?(validate22.errors=Bt,Nt===0):(validate22.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}validate22.evaluated={dynamicProps:!1,dynamicItems:!1};const GeneralJwk=validate49;function validate49($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate49.evaluated;Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0);const Lt=Nt;let jt=!1,Kt=null;const qt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let dr;if($t.crv===void 0&&(dr="crv")||$t.x===void 0&&(dr="x")){const vr={instancePath:e,schemaPath:"#/oneOf/0/required",keyword:"required",params:{missingProperty:dr},message:"must have required property '"+dr+"'"};Bt===null?Bt=[vr]:Bt.push(vr),Nt++}else{if($t.kty!==void 0){const vr=Nt;if($t.kty!=="EC"){const $r={instancePath:e+"/kty",schemaPath:"#/oneOf/0/properties/kty/const",keyword:"const",params:{allowedValue:"EC"},message:"must be equal to constant"};Bt===null?Bt=[$r]:Bt.push($r),Nt++}var zt=vr===Nt}else var zt=!0;if(zt){if($t.crv!==void 0){const vr=Nt;if(typeof $t.crv!="string"){const Ir={instancePath:e+"/crv",schemaPath:"#/oneOf/0/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var zt=vr===Nt}else var zt=!0;if(zt){if($t.x!==void 0){const vr=Nt;if(typeof $t.x!="string"){const Ir={instancePath:e+"/x",schemaPath:"#/oneOf/0/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var zt=vr===Nt}else var zt=!0;if(zt){if($t.y!==void 0){const vr=Nt;if(typeof $t.y!="string"){const Ir={instancePath:e+"/y",schemaPath:"#/oneOf/0/properties/y/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var zt=vr===Nt}else var zt=!0;if(zt)if($t.d!==void 0){const vr=Nt;if(typeof $t.d!="string"){const Ir={instancePath:e+"/d",schemaPath:"#/oneOf/0/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var zt=vr===Nt}else var zt=!0}}}}}var Qt=qt===Nt;if(Qt){jt=!0,Kt=0;var Vt={};Vt.kty=!0,Vt.crv=!0,Vt.x=!0,Vt.y=!0,Vt.d=!0}const Ht=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let dr;if($t.crv===void 0&&(dr="crv")||$t.x===void 0&&(dr="x")){const vr={instancePath:e,schemaPath:"#/oneOf/1/required",keyword:"required",params:{missingProperty:dr},message:"must have required property '"+dr+"'"};Bt===null?Bt=[vr]:Bt.push(vr),Nt++}else{if($t.kty!==void 0){const vr=Nt;if($t.kty!=="OKP"){const $r={instancePath:e+"/kty",schemaPath:"#/oneOf/1/properties/kty/const",keyword:"const",params:{allowedValue:"OKP"},message:"must be equal to constant"};Bt===null?Bt=[$r]:Bt.push($r),Nt++}var Wt=vr===Nt}else var Wt=!0;if(Wt){if($t.crv!==void 0){const vr=Nt;if(typeof $t.crv!="string"){const Ir={instancePath:e+"/crv",schemaPath:"#/oneOf/1/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var Wt=vr===Nt}else var Wt=!0;if(Wt){if($t.x!==void 0){const vr=Nt;if(typeof $t.x!="string"){const Ir={instancePath:e+"/x",schemaPath:"#/oneOf/1/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var Wt=vr===Nt}else var Wt=!0;if(Wt)if($t.d!==void 0){const vr=Nt;if(typeof $t.d!="string"){const Ir={instancePath:e+"/d",schemaPath:"#/oneOf/1/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}var Wt=vr===Nt}else var Wt=!0}}}}var Qt=Ht===Nt;if(Qt&&jt)jt=!1,Kt=[Kt,1];else{Qt&&(jt=!0,Kt=1,Vt!==!0&&(Vt=Vt||{},Vt.kty=!0,Vt.crv=!0,Vt.x=!0,Vt.d=!0));const dr=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let $r;if($t.n===void 0&&($r="n")||$t.e===void 0&&($r="e")){const Ir={instancePath:e,schemaPath:"#/oneOf/2/required",keyword:"required",params:{missingProperty:$r},message:"must have required property '"+$r+"'"};Bt===null?Bt=[Ir]:Bt.push(Ir),Nt++}else{if($t.kty!==void 0){const Ir=Nt;if($t.kty!=="RSA"){const Rr={instancePath:e+"/kty",schemaPath:"#/oneOf/2/properties/kty/const",keyword:"const",params:{allowedValue:"RSA"},message:"must be equal to constant"};Bt===null?Bt=[Rr]:Bt.push(Rr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.n!==void 0){const Ir=Nt;if(typeof $t.n!="string"){const Nr={instancePath:e+"/n",schemaPath:"#/oneOf/2/properties/n/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.e!==void 0){const Ir=Nt;if(typeof $t.e!="string"){const Nr={instancePath:e+"/e",schemaPath:"#/oneOf/2/properties/e/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.d!==void 0){const Ir=Nt;if(typeof $t.d!="string"){const Nr={instancePath:e+"/d",schemaPath:"#/oneOf/2/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.p!==void 0){const Ir=Nt;if(typeof $t.p!="string"){const Nr={instancePath:e+"/p",schemaPath:"#/oneOf/2/properties/p/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.q!==void 0){const Ir=Nt;if(typeof $t.q!="string"){const Nr={instancePath:e+"/q",schemaPath:"#/oneOf/2/properties/q/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.dp!==void 0){const Ir=Nt;if(typeof $t.dp!="string"){const Nr={instancePath:e+"/dp",schemaPath:"#/oneOf/2/properties/dp/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.dq!==void 0){const Ir=Nt;if(typeof $t.dq!="string"){const Nr={instancePath:e+"/dq",schemaPath:"#/oneOf/2/properties/dq/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt){if($t.qi!==void 0){const Ir=Nt;if(typeof $t.qi!="string"){const Nr={instancePath:e+"/qi",schemaPath:"#/oneOf/2/properties/qi/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}var Xt=Ir===Nt}else var Xt=!0;if(Xt)if($t.oth!==void 0){let Ir=$t.oth;const Rr=Nt;if(!(Ir&&typeof Ir=="object"&&!Array.isArray(Ir))){const kr={instancePath:e+"/oth",schemaPath:"#/oneOf/2/properties/oth/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[kr]:Bt.push(kr),Nt++}var Xt=Rr===Nt}else var Xt=!0}}}}}}}}}}var Qt=dr===Nt;if(Qt&&jt)jt=!1,Kt=[Kt,2];else{Qt&&(jt=!0,Kt=2,Vt!==!0&&(Vt=Vt||{},Vt.kty=!0,Vt.n=!0,Vt.e=!0,Vt.d=!0,Vt.p=!0,Vt.q=!0,Vt.dp=!0,Vt.dq=!0,Vt.qi=!0,Vt.oth=!0));const $r=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)){let Rr;if($t.k===void 0&&(Rr="k")){const Nr={instancePath:e,schemaPath:"#/oneOf/3/required",keyword:"required",params:{missingProperty:Rr},message:"must have required property '"+Rr+"'"};Bt===null?Bt=[Nr]:Bt.push(Nr),Nt++}else{if($t.kty!==void 0){const Nr=Nt;if($t.kty!=="oct"){const kr={instancePath:e+"/kty",schemaPath:"#/oneOf/3/properties/kty/const",keyword:"const",params:{allowedValue:"oct"},message:"must be equal to constant"};Bt===null?Bt=[kr]:Bt.push(kr),Nt++}var Jt=Nr===Nt}else var Jt=!0;if(Jt)if($t.k!==void 0){const Nr=Nt;if(typeof $t.k!="string"){const lr={instancePath:e+"/k",schemaPath:"#/oneOf/3/properties/k/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[lr]:Bt.push(lr),Nt++}var Jt=Nr===Nt}else var Jt=!0}}var Qt=$r===Nt;Qt&&jt?(jt=!1,Kt=[Kt,3]):Qt&&(jt=!0,Kt=3,Vt!==!0&&(Vt=Vt||{},Vt.kty=!0,Vt.k=!0))}}if(jt)Nt=Lt,Bt!==null&&(Lt?Bt.length=Lt:Bt=null);else{const dr={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:Kt},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[dr]:Bt.push(dr),Nt++,validate49.errors=Bt,!1}if(Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let dr;if($t.kty===void 0&&(dr="kty"))return validate49.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:dr},message:"must have required property '"+dr+"'"}],!1;if(Vt!==!0&&(Vt=Vt||{},Vt.alg=!0,Vt.kid=!0,Vt.kty=!0,Vt.crv=!0,Vt.use=!0,Vt.key_ops=!0,Vt.x5u=!0,Vt.x5c=!0,Vt.x5t=!0,Vt["x5t#S256"]=!0),$t.alg!==void 0){const vr=Nt;if(typeof $t.alg!="string")return validate49.errors=[{instancePath:e+"/alg",schemaPath:"#/properties/alg/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.kid!==void 0){const vr=Nt;if(typeof $t.kid!="string")return validate49.errors=[{instancePath:e+"/kid",schemaPath:"#/properties/kid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.kty!==void 0){let vr=$t.kty;const $r=Nt;if(!(vr==="EC"||vr==="RSA"||vr==="oct"||vr==="OKP"))return validate49.errors=[{instancePath:e+"/kty",schemaPath:"#/properties/kty/enum",keyword:"enum",params:{allowedValues:schema43.properties.kty.enum},message:"must be equal to one of the allowed values"}],!1;var tr=$r===Nt}else var tr=!0;if(tr){if($t.crv!==void 0){const vr=Nt;if(typeof $t.crv!="string")return validate49.errors=[{instancePath:e+"/crv",schemaPath:"#/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.use!==void 0){const vr=Nt;if(typeof $t.use!="string")return validate49.errors=[{instancePath:e+"/use",schemaPath:"#/properties/use/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.key_ops!==void 0){const vr=Nt;if(typeof $t.key_ops!="string")return validate49.errors=[{instancePath:e+"/key_ops",schemaPath:"#/properties/key_ops/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.x5u!==void 0){const vr=Nt;if(typeof $t.x5u!="string")return validate49.errors=[{instancePath:e+"/x5u",schemaPath:"#/properties/x5u/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.x5c!==void 0){const vr=Nt;if(typeof $t.x5c!="string")return validate49.errors=[{instancePath:e+"/x5c",schemaPath:"#/properties/x5c/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr){if($t.x5t!==void 0){const vr=Nt;if(typeof $t.x5t!="string")return validate49.errors=[{instancePath:e+"/x5t",schemaPath:"#/properties/x5t/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0;if(tr)if($t["x5t#S256"]!==void 0){const vr=Nt;if(typeof $t["x5t#S256"]!="string")return validate49.errors=[{instancePath:e+"/x5t#S256",schemaPath:"#/properties/x5t%23S256/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=vr===Nt}else var tr=!0}}}}}}}}}else return validate49.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate49.errors=Bt,Ut.props=Vt,Nt===0}validate49.evaluated={dynamicProps:!0,dynamicItems:!1};const GeneralJws=validate21,JwkVerificationMethod=validate50,schema75={$id:"https://identity.foundation/dwn/json-schemas/jwk-verification-method.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",additionalProperties:!1,required:["id","type","controller","publicKeyJwk"],properties:{id:{type:"string"},type:{enum:["JsonWebKey","JsonWebKey2020"]},controller:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},publicKeyJwk:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"}}};function validate50($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate50.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let jt;if($t.id===void 0&&(jt="id")||$t.type===void 0&&(jt="type")||$t.controller===void 0&&(jt="controller")||$t.publicKeyJwk===void 0&&(jt="publicKeyJwk"))return validate50.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;{const Kt=Nt;for(const qt in $t)if(!(qt==="id"||qt==="type"||qt==="controller"||qt==="publicKeyJwk"))return validate50.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:qt},message:"must NOT have additional properties"}],!1;if(Kt===Nt){if($t.id!==void 0){const qt=Nt;if(typeof $t.id!="string")return validate50.errors=[{instancePath:e+"/id",schemaPath:"#/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.type!==void 0){let qt=$t.type;const zt=Nt;if(!(qt==="JsonWebKey"||qt==="JsonWebKey2020"))return validate50.errors=[{instancePath:e+"/type",schemaPath:"#/properties/type/enum",keyword:"enum",params:{allowedValues:schema75.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var Lt=zt===Nt}else var Lt=!0;if(Lt){if($t.controller!==void 0){let qt=$t.controller;const zt=Nt;if(Nt===Nt)if(typeof qt=="string"){if(!pattern12.test(qt))return validate50.errors=[{instancePath:e+"/controller",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate50.errors=[{instancePath:e+"/controller",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.publicKeyJwk!==void 0){const qt=Nt;validate33($t.publicKeyJwk,{instancePath:e+"/publicKeyJwk",parentData:$t,parentDataProperty:"publicKeyJwk",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate33.errors:Bt.concat(validate33.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0}}}}}else return validate50.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate50.errors=Bt,Nt===0}validate50.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesFilter=validate52,schema77={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-filter.json",type:"object",additionalProperties:!1,minProperties:1,properties:{interface:{enum:["Protocols","Records"],type:"string"},method:{enum:["Configure","Delete","Write"],type:"string"},protocol:{type:"string"},messageTimestamp:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}}}};function validate52($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate52.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)){if(Object.keys($t).length<1)return validate52.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const Kt in $t)if(!(Kt==="interface"||Kt==="method"||Kt==="protocol"||Kt==="messageTimestamp"))return validate52.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Kt},message:"must NOT have additional properties"}],!1;{if($t.interface!==void 0){let Kt=$t.interface;const qt=Nt;if(typeof Kt!="string")return validate52.errors=[{instancePath:e+"/interface",schemaPath:"#/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(Kt==="Protocols"||Kt==="Records"))return validate52.errors=[{instancePath:e+"/interface",schemaPath:"#/properties/interface/enum",keyword:"enum",params:{allowedValues:schema77.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.method!==void 0){let Kt=$t.method;const qt=Nt;if(typeof Kt!="string")return validate52.errors=[{instancePath:e+"/method",schemaPath:"#/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(Kt==="Configure"||Kt==="Delete"||Kt==="Write"))return validate52.errors=[{instancePath:e+"/method",schemaPath:"#/properties/method/enum",keyword:"enum",params:{allowedValues:schema77.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.protocol!==void 0){const Kt=Nt;if(typeof $t.protocol!="string")return validate52.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt)if($t.messageTimestamp!==void 0){let Kt=$t.messageTimestamp;const qt=Nt;if(Kt&&typeof Kt=="object"&&!Array.isArray(Kt)){if(Object.keys(Kt).length<1)return validate52.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const Vt in Kt)if(!(Vt==="from"||Vt==="to"))return validate52.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Vt},message:"must NOT have additional properties"}],!1;{if(Kt.from!==void 0){let Vt=Kt.from;const Ht=Nt;if(typeof Vt=="string"){if(!pattern14.test(Vt))return validate52.errors=[{instancePath:e+"/messageTimestamp/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate52.errors=[{instancePath:e+"/messageTimestamp/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Ht===Nt}else var jt=!0;if(jt)if(Kt.to!==void 0){let Vt=Kt.to;const Ht=Nt;if(typeof Vt=="string"){if(!pattern14.test(Vt))return validate52.errors=[{instancePath:e+"/messageTimestamp/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate52.errors=[{instancePath:e+"/messageTimestamp/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Ht===Nt}else var jt=!0}}else return validate52.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=qt===Nt}else var Lt=!0}}}}else return validate52.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate52.errors=Bt,Nt===0}validate52.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesQuery$1=validate53,schema80={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-query.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filters"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filters:{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/messages-filter.json"}},cursor:{$ref:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json"}}}}};function validate53($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate53.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let zt;if($t.authorization===void 0&&(zt="authorization")||$t.descriptor===void 0&&(zt="descriptor"))return validate53.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;{const Vt=Nt;for(const Ht in $t)if(!(Ht==="authorization"||Ht==="descriptor"))return validate53.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ht},message:"must NOT have additional properties"}],!1;if(Vt===Nt){if($t.authorization!==void 0){const Ht=Nt;validate20($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate20.errors:Bt.concat(validate20.errors),Nt=Bt.length);var Lt=Ht===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let Ht=$t.descriptor;const Wt=Nt;if(Nt===Wt)if(Ht&&typeof Ht=="object"&&!Array.isArray(Ht)){let Xt;if(Ht.interface===void 0&&(Xt="interface")||Ht.method===void 0&&(Xt="method")||Ht.messageTimestamp===void 0&&(Xt="messageTimestamp")||Ht.filters===void 0&&(Xt="filters"))return validate53.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Xt},message:"must have required property '"+Xt+"'"}],!1;{const Jt=Nt;for(const tr in Ht)if(!(tr==="interface"||tr==="method"||tr==="messageTimestamp"||tr==="filters"||tr==="cursor"))return validate53.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:tr},message:"must NOT have additional properties"}],!1;if(Jt===Nt){if(Ht.interface!==void 0){let tr=Ht.interface;const dr=Nt;if(typeof tr!="string")return validate53.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(tr!=="Messages")return validate53.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema80.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=dr===Nt}else var jt=!0;if(jt){if(Ht.method!==void 0){let tr=Ht.method;const dr=Nt;if(typeof tr!="string")return validate53.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(tr!=="Query")return validate53.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema80.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=dr===Nt}else var jt=!0;if(jt){if(Ht.messageTimestamp!==void 0){let tr=Ht.messageTimestamp;const dr=Nt;if(Nt===Nt)if(typeof tr=="string"){if(!pattern14.test(tr))return validate53.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate53.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=dr===Nt}else var jt=!0;if(jt){if(Ht.filters!==void 0){let tr=Ht.filters;const dr=Nt;if(Nt===dr)if(Array.isArray(tr)){var Kt=!0;const $r=tr.length;for(let Ir=0;Ir<$r;Ir++){const Rr=Nt;validate52(tr[Ir],{instancePath:e+"/descriptor/filters/"+Ir,parentData:tr,parentDataProperty:Ir,rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate52.errors:Bt.concat(validate52.errors),Nt=Bt.length);var Kt=Rr===Nt;if(!Kt)break}}else return validate53.errors=[{instancePath:e+"/descriptor/filters",schemaPath:"#/properties/descriptor/properties/filters/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var jt=dr===Nt}else var jt=!0;if(jt)if(Ht.cursor!==void 0){let tr=Ht.cursor;const dr=Nt;if(Nt===Nt)if(tr&&typeof tr=="object"&&!Array.isArray(tr)){if(Object.keys(tr).length<1)return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let Ir;if(tr.messageCid===void 0&&(Ir="messageCid")||tr.value===void 0&&(Ir="value"))return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/required",keyword:"required",params:{missingProperty:Ir},message:"must have required property '"+Ir+"'"}],!1;{const Rr=Nt;for(const Nr in tr)if(!(Nr==="messageCid"||Nr==="value"))return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Nr},message:"must NOT have additional properties"}],!1;if(Rr===Nt){if(tr.messageCid!==void 0){const Nr=Nt;if(typeof tr.messageCid!="string")return validate53.errors=[{instancePath:e+"/descriptor/cursor/messageCid",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var qt=Nr===Nt}else var qt=!0;if(qt)if(tr.value!==void 0){let Nr=tr.value;const kr=Nt;if(typeof Nr!="string"&&!(typeof Nr=="number"&&isFinite(Nr)))return validate53.errors=[{instancePath:e+"/descriptor/cursor/value",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/value/type",keyword:"type",params:{type:schema70.properties.value.type},message:"must be string,number"}],!1;var qt=kr===Nt}else var qt=!0}}}}else return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=dr===Nt}else var jt=!0}}}}}}else return validate53.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Wt===Nt}else var Lt=!0}}}else return validate53.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate53.errors=Bt,Nt===0}validate53.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesRead$1=validate56,schema83={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-read.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Read"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},messageCid:{type:"string"}}}}};function validate56($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate56.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Kt;if($t.authorization===void 0&&(Kt="authorization")||$t.descriptor===void 0&&(Kt="descriptor"))return validate56.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Kt},message:"must have required property '"+Kt+"'"}],!1;{const qt=Nt;for(const zt in $t)if(!(zt==="authorization"||zt==="descriptor"))return validate56.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:zt},message:"must NOT have additional properties"}],!1;if(qt===Nt){if($t.authorization!==void 0){const zt=Nt;validate20($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate20.errors:Bt.concat(validate20.errors),Nt=Bt.length);var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let zt=$t.descriptor;const Vt=Nt;if(Nt===Vt)if(zt&&typeof zt=="object"&&!Array.isArray(zt)){let Wt;if(zt.interface===void 0&&(Wt="interface")||zt.method===void 0&&(Wt="method")||zt.messageTimestamp===void 0&&(Wt="messageTimestamp"))return validate56.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Wt},message:"must have required property '"+Wt+"'"}],!1;{const Qt=Nt;for(const Xt in zt)if(!(Xt==="interface"||Xt==="method"||Xt==="messageTimestamp"||Xt==="messageCid"))return validate56.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xt},message:"must NOT have additional properties"}],!1;if(Qt===Nt){if(zt.interface!==void 0){let Xt=zt.interface;const Jt=Nt;if(typeof Xt!="string")return validate56.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Messages")return validate56.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema83.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.method!==void 0){let Xt=zt.method;const Jt=Nt;if(typeof Xt!="string")return validate56.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Read")return validate56.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema83.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.messageTimestamp!==void 0){let Xt=zt.messageTimestamp;const Jt=Nt;if(Nt===Nt)if(typeof Xt=="string"){if(!pattern14.test(Xt))return validate56.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate56.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt)if(zt.messageCid!==void 0){const Xt=Nt;if(typeof zt.messageCid!="string")return validate56.errors=[{instancePath:e+"/descriptor/messageCid",schemaPath:"#/properties/descriptor/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Xt===Nt}else var jt=!0}}}}}else return validate56.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Vt===Nt}else var Lt=!0}}}else return validate56.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate56.errors=Bt,Nt===0}validate56.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesSubscribe$1=validate58,schema85={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-subscribe.json",type:"object",additionalProperties:!1,required:["descriptor","authorization"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filters"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Subscribe"],type:"string"},messageTimestamp:{type:"string"},filters:{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/messages-filter.json"}}}}}};function validate58($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate58.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let qt;if($t.descriptor===void 0&&(qt="descriptor")||$t.authorization===void 0&&(qt="authorization"))return validate58.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:qt},message:"must have required property '"+qt+"'"}],!1;{const zt=Nt;for(const Vt in $t)if(!(Vt==="authorization"||Vt==="descriptor"))return validate58.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Vt},message:"must NOT have additional properties"}],!1;if(zt===Nt){if($t.authorization!==void 0){const Vt=Nt;validate20($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate20.errors:Bt.concat(validate20.errors),Nt=Bt.length);var Lt=Vt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let Vt=$t.descriptor;const Ht=Nt;if(Nt===Ht)if(Vt&&typeof Vt=="object"&&!Array.isArray(Vt)){let Qt;if(Vt.interface===void 0&&(Qt="interface")||Vt.method===void 0&&(Qt="method")||Vt.messageTimestamp===void 0&&(Qt="messageTimestamp")||Vt.filters===void 0&&(Qt="filters"))return validate58.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Qt},message:"must have required property '"+Qt+"'"}],!1;{const Xt=Nt;for(const Jt in Vt)if(!(Jt==="interface"||Jt==="method"||Jt==="messageTimestamp"||Jt==="filters"))return validate58.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Jt},message:"must NOT have additional properties"}],!1;if(Xt===Nt){if(Vt.interface!==void 0){let Jt=Vt.interface;const tr=Nt;if(typeof Jt!="string")return validate58.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Jt!=="Messages")return validate58.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema85.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=tr===Nt}else var jt=!0;if(jt){if(Vt.method!==void 0){let Jt=Vt.method;const tr=Nt;if(typeof Jt!="string")return validate58.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Jt!=="Subscribe")return validate58.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema85.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=tr===Nt}else var jt=!0;if(jt){if(Vt.messageTimestamp!==void 0){const Jt=Nt;if(typeof Vt.messageTimestamp!="string")return validate58.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"#/properties/descriptor/properties/messageTimestamp/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt)if(Vt.filters!==void 0){let Jt=Vt.filters;const tr=Nt;if(Nt===tr)if(Array.isArray(Jt)){var Kt=!0;const vr=Jt.length;for(let $r=0;$r<vr;$r++){const Ir=Nt;validate52(Jt[$r],{instancePath:e+"/descriptor/filters/"+$r,parentData:Jt,parentDataProperty:$r,rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate52.errors:Bt.concat(validate52.errors),Nt=Bt.length);var Kt=Ir===Nt;if(!Kt)break}}else return validate58.errors=[{instancePath:e+"/descriptor/filters",schemaPath:"#/properties/descriptor/properties/filters/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var jt=tr===Nt}else var jt=!0}}}}}else return validate58.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Ht===Nt}else var Lt=!0}}}else return validate58.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate58.errors=Bt,Nt===0}validate58.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const NumberRangeFilter=validate61;function validate61($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate61.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){if(Object.keys($t).length<1)return validate61.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Ht=Nt;for(const Wt in $t)if(!(Wt==="gt"||Wt==="gte"||Wt==="lt"||Wt==="lte"))return validate61.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Wt},message:"must NOT have additional properties"}],!1;if(Ht===Nt){if($t.gt!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.gte===void 0){const Jt={};Bt===null?Bt=[Jt]:Bt.push(Jt),Nt++}var Lt=Xt===Nt;if(Lt)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.gte!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.gt===void 0){const tr={};Bt===null?Bt=[tr]:Bt.push(tr),Nt++}var Kt=Xt===Nt;if(Kt)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.lt!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.lte===void 0){const tr={};Bt===null?Bt=[tr]:Bt.push(tr),Nt++}var qt=Xt===Nt;if(qt)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.lte!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.lt===void 0){const tr={};Bt===null?Bt=[tr]:Bt.push(tr),Nt++}var zt=Xt===Nt;if(zt)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.gt!==void 0){let Wt=$t.gt;const Qt=Nt;if(!(typeof Wt=="number"&&isFinite(Wt)))return validate61.errors=[{instancePath:e+"/gt",schemaPath:"#/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Vt=Qt===Nt}else var Vt=!0;if(Vt){if($t.gte!==void 0){let Wt=$t.gte;const Qt=Nt;if(!(typeof Wt=="number"&&isFinite(Wt)))return validate61.errors=[{instancePath:e+"/gte",schemaPath:"#/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Vt=Qt===Nt}else var Vt=!0;if(Vt){if($t.lt!==void 0){let Wt=$t.lt;const Qt=Nt;if(!(typeof Wt=="number"&&isFinite(Wt)))return validate61.errors=[{instancePath:e+"/lt",schemaPath:"#/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Vt=Qt===Nt}else var Vt=!0;if(Vt)if($t.lte!==void 0){let Wt=$t.lte;const Qt=Nt;if(!(typeof Wt=="number"&&isFinite(Wt)))return validate61.errors=[{instancePath:e+"/lte",schemaPath:"#/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Vt=Qt===Nt}else var Vt=!0}}}}}}}}}else return validate61.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate61.errors=Bt,Nt===0}validate61.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PaginationCursor=validate62;function validate62($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate62.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)){if(Object.keys($t).length<1)return validate62.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let jt;if($t.messageCid===void 0&&(jt="messageCid")||$t.value===void 0&&(jt="value"))return validate62.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;for(const Kt in $t)if(!(Kt==="messageCid"||Kt==="value"))return validate62.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Kt},message:"must NOT have additional properties"}],!1;{if($t.messageCid!==void 0){const Kt=Nt;if(typeof $t.messageCid!="string")return validate62.errors=[{instancePath:e+"/messageCid",schemaPath:"#/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt)if($t.value!==void 0){let Kt=$t.value;const qt=Nt;if(typeof Kt!="string"&&!(typeof Kt=="number"&&isFinite(Kt)))return validate62.errors=[{instancePath:e+"/value",schemaPath:"#/properties/value/type",keyword:"type",params:{type:schema70.properties.value.type},message:"must be string,number"}],!1;var Lt=qt===Nt}else var Lt=!0}}}else return validate62.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate62.errors=Bt,Nt===0}validate62.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionGrantData=validate63,schema103={type:"object",additionalProperties:!1,properties:{publication:{enum:["Required","Prohibited"],type:"string"}}};function validate65($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate65.evaluated;Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0);const Lt=Nt;let jt=!1,Kt=null;const qt=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let lr;if($t.interface===void 0&&(lr="interface")||$t.method===void 0&&(lr="method")){const ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/required",keyword:"required",params:{missingProperty:lr},message:"must have required property '"+lr+"'"};Bt===null?Bt=[ir]:Bt.push(ir),Nt++}else{const ir=Nt;for(const er in $t)if(!(er==="interface"||er==="method"||er==="protocol")){const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:er},message:"must NOT have additional properties"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++;break}if(ir===Nt){if($t.interface!==void 0){const er=Nt;if($t.interface!=="Messages"){const rr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}var Vt=er===Nt}else var Vt=!0;if(Vt){if($t.method!==void 0){const er=Nt;if($t.method!=="Query"){const yr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Vt=er===Nt}else var Vt=!0;if(Vt)if($t.protocol!==void 0){const er=Nt;if(typeof $t.protocol!="string"){const yr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Vt=er===Nt}else var Vt=!0}}}}else{const lr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[lr]:Bt.push(lr),Nt++}var Jt=qt===Nt;if(Jt){jt=!0,Kt=0;var Ht=!0}const Wt=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let lr;if($t.interface===void 0&&(lr="interface")||$t.method===void 0&&(lr="method")){const ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/required",keyword:"required",params:{missingProperty:lr},message:"must have required property '"+lr+"'"};Bt===null?Bt=[ir]:Bt.push(ir),Nt++}else{const ir=Nt;for(const er in $t)if(!(er==="interface"||er==="method"||er==="protocol")){const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:er},message:"must NOT have additional properties"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++;break}if(ir===Nt){if($t.interface!==void 0){const er=Nt;if($t.interface!=="Messages"){const rr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}var Xt=er===Nt}else var Xt=!0;if(Xt){if($t.method!==void 0){const er=Nt;if($t.method!=="Read"){const yr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Xt=er===Nt}else var Xt=!0;if(Xt)if($t.protocol!==void 0){const er=Nt;if(typeof $t.protocol!="string"){const yr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Xt=er===Nt}else var Xt=!0}}}}else{const lr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[lr]:Bt.push(lr),Nt++}var Jt=Wt===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,1];else{Jt&&(jt=!0,Kt=1,Ht!==!0&&(Ht=!0));const lr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let rr;if($t.interface===void 0&&(rr="interface")||$t.method===void 0&&(rr="method")){const yr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}else{const yr=Nt;for(const fr in $t)if(!(fr==="interface"||fr==="method"||fr==="protocol")){const gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:fr},message:"must NOT have additional properties"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++;break}if(yr===Nt){if($t.interface!==void 0){const fr=Nt;if($t.interface!=="Messages"){const gr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++}var tr=fr===Nt}else var tr=!0;if(tr){if($t.method!==void 0){const fr=Nt;if($t.method!=="Subscribe"){const ar={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var tr=fr===Nt}else var tr=!0;if(tr)if($t.protocol!==void 0){const fr=Nt;if(typeof $t.protocol!="string"){const ar={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var tr=fr===Nt}else var tr=!0}}}}else{const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}var Jt=lr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,2];else{Jt&&(jt=!0,Kt=2,Ht!==!0&&(Ht=!0));const rr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let gr;if($t.interface===void 0&&(gr="interface")||$t.method===void 0&&(gr="method")){const ar={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/required",keyword:"required",params:{missingProperty:gr},message:"must have required property '"+gr+"'"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}else{const ar=Nt;for(const nr in $t)if(!(nr==="interface"||nr==="method"||nr==="protocol")){const ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++;break}if(ar===Nt){if($t.interface!==void 0){const nr=Nt;if($t.interface!=="Protocols"){const ur={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}var dr=nr===Nt}else var dr=!0;if(dr){if($t.method!==void 0){const nr=Nt;if($t.method!=="Configure"){const pr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/method/const",keyword:"const",params:{allowedValue:"Configure"},message:"must be equal to constant"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}var dr=nr===Nt}else var dr=!0;if(dr)if($t.protocol!==void 0){const nr=Nt;if(typeof $t.protocol!="string"){const pr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}var dr=nr===Nt}else var dr=!0}}}}else{const gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++}var Jt=rr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,3];else{Jt&&(jt=!0,Kt=3,Ht!==!0&&(Ht=!0));const gr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let ur;if($t.interface===void 0&&(ur="interface")||$t.method===void 0&&(ur="method")){const pr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}else{const pr=Nt;for(const br in $t)if(!(br==="interface"||br==="method"||br==="protocol")){const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:br},message:"must NOT have additional properties"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++;break}if(pr===Nt){if($t.interface!==void 0){const br=Nt;if($t.interface!=="Protocols"){const Sr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++}var vr=br===Nt}else var vr=!0;if(vr){if($t.method!==void 0){const br=Nt;if($t.method!=="Query"){const Pr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}var vr=br===Nt}else var vr=!0;if(vr)if($t.protocol!==void 0){const br=Nt;if(typeof $t.protocol!="string"){const Pr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}var vr=br===Nt}else var vr=!0}}}}else{const ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}var Jt=gr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,4];else{Jt&&(jt=!0,Kt=4,Ht!==!0&&(Ht=!0));const ur=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Sr;if($t.interface===void 0&&(Sr="interface")||$t.method===void 0&&(Sr="method")){const Pr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}else{const Pr=Nt;for(const Tr in $t)if(!(Tr==="interface"||Tr==="method"||Tr==="protocol"||Tr==="contextId"||Tr==="protocolPath")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Tr},message:"must NOT have additional properties"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++;break}if(Pr===Nt){if($t.interface!==void 0){const Tr=Nt;if($t.interface!=="Records"){const wr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++}var $r=Tr===Nt}else var $r=!0;if($r){if($t.method!==void 0){const Tr=Nt;if($t.method!=="Read"){const Ar={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0;if($r){if($t.protocol!==void 0){const Tr=Nt;if(typeof $t.protocol!="string"){const Ar={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0;if($r){if($t.contextId!==void 0){const Tr=Nt;if(typeof $t.contextId!="string"){const Ar={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0;if($r)if($t.protocolPath!==void 0){const Tr=Nt;if(typeof $t.protocolPath!="string"){const Ar={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0}}}}}}else{const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++}var Jt=ur===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,5];else{Jt&&(jt=!0,Kt=5,Ht!==!0&&(Ht=!0));const Sr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let wr;if($t.interface===void 0&&(wr="interface")||$t.method===void 0&&(wr="method")){const Ar={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/required",keyword:"required",params:{missingProperty:wr},message:"must have required property '"+wr+"'"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}else{const Ar=Nt;for(const Mr in $t)if(!(Mr==="interface"||Mr==="method"||Mr==="protocol"||Mr==="contextId"||Mr==="protocolPath")){const Ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Mr},message:"must NOT have additional properties"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++;break}if(Ar===Nt){if($t.interface!==void 0){const Mr=Nt;if($t.interface!=="Records"){const Ur={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir){if($t.method!==void 0){const Mr=Nt;if($t.method!=="Delete"){const Or={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/method/const",keyword:"const",params:{allowedValue:"Delete"},message:"must be equal to constant"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir){if($t.protocol!==void 0){const Mr=Nt;if(typeof $t.protocol!="string"){const Or={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir){if($t.contextId!==void 0){const Mr=Nt;if(typeof $t.contextId!="string"){const Or={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir)if($t.protocolPath!==void 0){const Mr=Nt;if(typeof $t.protocolPath!="string"){const Or={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0}}}}}}else{const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++}var Jt=Sr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,6];else{Jt&&(jt=!0,Kt=6,Ht!==!0&&(Ht=!0));const wr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Ur;if($t.interface===void 0&&(Ur="interface")||$t.method===void 0&&(Ur="method")){const Or={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/required",keyword:"required",params:{missingProperty:Ur},message:"must have required property '"+Ur+"'"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}else{const Or=Nt;for(const Cr in $t)if(!(Cr==="interface"||Cr==="method"||Cr==="protocol"||Cr==="contextId"||Cr==="protocolPath")){const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Cr},message:"must NOT have additional properties"};Bt===null?Bt=[Er]:Bt.push(Er),Nt++;break}if(Or===Nt){if($t.interface!==void 0){const Cr=Nt;if($t.interface!=="Records"){const Er={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[Er]:Bt.push(Er),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr){if($t.method!==void 0){const Cr=Nt;if($t.method!=="Write"){const Br={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/method/const",keyword:"const",params:{allowedValue:"Write"},message:"must be equal to constant"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr){if($t.protocol!==void 0){const Cr=Nt;if(typeof $t.protocol!="string"){const Br={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr){if($t.contextId!==void 0){const Cr=Nt;if(typeof $t.contextId!="string"){const Br={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr)if($t.protocolPath!==void 0){const Cr=Nt;if(typeof $t.protocolPath!="string"){const Br={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0}}}}}}else{const Ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var Jt=wr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,7];else{Jt&&(jt=!0,Kt=7,Ht!==!0&&(Ht=!0));const Ur=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Er;if($t.interface===void 0&&(Er="interface")||$t.method===void 0&&(Er="method")){const Br={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/required",keyword:"required",params:{missingProperty:Er},message:"must have required property '"+Er+"'"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}else{const Br=Nt;for(const Lr in $t)if(!(Lr==="interface"||Lr==="method"||Lr==="protocol"||Lr==="contextId"||Lr==="protocolPath")){const xr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Lr},message:"must NOT have additional properties"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++;break}if(Br===Nt){if($t.interface!==void 0){const Lr=Nt;if($t.interface!=="Records"){const xr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr){if($t.method!==void 0){const Lr=Nt;if($t.method!=="Query"){const _r={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr){if($t.protocol!==void 0){const Lr=Nt;if(typeof $t.protocol!="string"){const _r={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr){if($t.contextId!==void 0){const Lr=Nt;if(typeof $t.contextId!="string"){const _r={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr)if($t.protocolPath!==void 0){const Lr=Nt;if(typeof $t.protocolPath!="string"){const _r={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0}}}}}}else{const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Er]:Bt.push(Er),Nt++}var Jt=Ur===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,8];else{Jt&&(jt=!0,Kt=8,Ht!==!0&&(Ht=!0));const Er=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let xr;if($t.interface===void 0&&(xr="interface")||$t.method===void 0&&(xr="method")){const _r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/required",keyword:"required",params:{missingProperty:xr},message:"must have required property '"+xr+"'"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}else{const _r=Nt;for(const Dr in $t)if(!(Dr==="interface"||Dr==="method"||Dr==="protocol"||Dr==="contextId"||Dr==="protocolPath")){const jr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Dr},message:"must NOT have additional properties"};Bt===null?Bt=[jr]:Bt.push(jr),Nt++;break}if(_r===Nt){if($t.interface!==void 0){const Dr=Nt;if($t.interface!=="Records"){const jr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[jr]:Bt.push(jr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr){if($t.method!==void 0){const Dr=Nt;if($t.method!=="Subscribe"){const Hr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr){if($t.protocol!==void 0){const Dr=Nt;if(typeof $t.protocol!="string"){const Hr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr){if($t.contextId!==void 0){const Dr=Nt;if(typeof $t.contextId!="string"){const Hr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr)if($t.protocolPath!==void 0){const Dr=Nt;if(typeof $t.protocolPath!="string"){const Hr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0}}}}}}else{const xr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Jt=Er===Nt;Jt&&jt?(jt=!1,Kt=[Kt,9]):Jt&&(jt=!0,Kt=9,Ht!==!0&&(Ht=!0))}}}}}}}}if(jt)Nt=Lt,Bt!==null&&(Lt?Bt.length=Lt:Bt=null);else{const lr={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:Kt},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[lr]:Bt.push(lr),Nt++,validate65.errors=Bt,!1}return validate65.errors=Bt,Ut.props=Ht,Nt===0}validate65.evaluated={dynamicProps:!0,dynamicItems:!1};function validate63($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate63.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let jt;if($t.dateExpires===void 0&&(jt="dateExpires")||$t.scope===void 0&&(jt="scope"))return validate63.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;{const Kt=Nt;for(const qt in $t)if(!(qt==="description"||qt==="dateExpires"||qt==="requestId"||qt==="delegated"||qt==="scope"||qt==="conditions"))return validate63.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:qt},message:"must NOT have additional properties"}],!1;if(Kt===Nt){if($t.description!==void 0){const qt=Nt;if(typeof $t.description!="string")return validate63.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.dateExpires!==void 0){let qt=$t.dateExpires;const zt=Nt;if(Nt===Nt)if(typeof qt=="string"){if(!pattern14.test(qt))return validate63.errors=[{instancePath:e+"/dateExpires",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate63.errors=[{instancePath:e+"/dateExpires",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=zt===Nt}else var Lt=!0;if(Lt){if($t.requestId!==void 0){const qt=Nt;if(typeof $t.requestId!="string")return validate63.errors=[{instancePath:e+"/requestId",schemaPath:"#/properties/requestId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.delegated!==void 0){const qt=Nt;if(typeof $t.delegated!="boolean")return validate63.errors=[{instancePath:e+"/delegated",schemaPath:"#/properties/delegated/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.scope!==void 0){const qt=Nt;validate65($t.scope,{instancePath:e+"/scope",parentData:$t,parentDataProperty:"scope",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate65.errors:Bt.concat(validate65.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0;if(Lt)if($t.conditions!==void 0){let qt=$t.conditions;const zt=Nt;if(Nt===Nt)if(qt&&typeof qt=="object"&&!Array.isArray(qt)){const Wt=Nt;for(const Qt in qt)if(Qt!=="publication")return validate63.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Qt},message:"must NOT have additional properties"}],!1;if(Wt===Nt&&qt.publication!==void 0){let Qt=qt.publication;if(typeof Qt!="string")return validate63.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(Qt==="Required"||Qt==="Prohibited"))return validate63.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/enum",keyword:"enum",params:{allowedValues:schema103.properties.publication.enum},message:"must be equal to one of the allowed values"}],!1}}else return validate63.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=zt===Nt}else var Lt=!0}}}}}}}else return validate63.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate63.errors=Bt,Nt===0}validate63.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionRequestData=validate68;function validate69($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate69.evaluated;Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0);const Lt=Nt;let jt=!1,Kt=null;const qt=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let lr;if($t.interface===void 0&&(lr="interface")||$t.method===void 0&&(lr="method")){const ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/required",keyword:"required",params:{missingProperty:lr},message:"must have required property '"+lr+"'"};Bt===null?Bt=[ir]:Bt.push(ir),Nt++}else{const ir=Nt;for(const er in $t)if(!(er==="interface"||er==="method"||er==="protocol")){const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:er},message:"must NOT have additional properties"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++;break}if(ir===Nt){if($t.interface!==void 0){const er=Nt;if($t.interface!=="Messages"){const rr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}var Vt=er===Nt}else var Vt=!0;if(Vt){if($t.method!==void 0){const er=Nt;if($t.method!=="Query"){const yr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Vt=er===Nt}else var Vt=!0;if(Vt)if($t.protocol!==void 0){const er=Nt;if(typeof $t.protocol!="string"){const yr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Vt=er===Nt}else var Vt=!0}}}}else{const lr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[lr]:Bt.push(lr),Nt++}var Jt=qt===Nt;if(Jt){jt=!0,Kt=0;var Ht=!0}const Wt=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let lr;if($t.interface===void 0&&(lr="interface")||$t.method===void 0&&(lr="method")){const ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/required",keyword:"required",params:{missingProperty:lr},message:"must have required property '"+lr+"'"};Bt===null?Bt=[ir]:Bt.push(ir),Nt++}else{const ir=Nt;for(const er in $t)if(!(er==="interface"||er==="method"||er==="protocol")){const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:er},message:"must NOT have additional properties"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++;break}if(ir===Nt){if($t.interface!==void 0){const er=Nt;if($t.interface!=="Messages"){const rr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}var Xt=er===Nt}else var Xt=!0;if(Xt){if($t.method!==void 0){const er=Nt;if($t.method!=="Read"){const yr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Xt=er===Nt}else var Xt=!0;if(Xt)if($t.protocol!==void 0){const er=Nt;if(typeof $t.protocol!="string"){const yr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}var Xt=er===Nt}else var Xt=!0}}}}else{const lr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[lr]:Bt.push(lr),Nt++}var Jt=Wt===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,1];else{Jt&&(jt=!0,Kt=1,Ht!==!0&&(Ht=!0));const lr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let rr;if($t.interface===void 0&&(rr="interface")||$t.method===void 0&&(rr="method")){const yr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"};Bt===null?Bt=[yr]:Bt.push(yr),Nt++}else{const yr=Nt;for(const fr in $t)if(!(fr==="interface"||fr==="method"||fr==="protocol")){const gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:fr},message:"must NOT have additional properties"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++;break}if(yr===Nt){if($t.interface!==void 0){const fr=Nt;if($t.interface!=="Messages"){const gr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++}var tr=fr===Nt}else var tr=!0;if(tr){if($t.method!==void 0){const fr=Nt;if($t.method!=="Subscribe"){const ar={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var tr=fr===Nt}else var tr=!0;if(tr)if($t.protocol!==void 0){const fr=Nt;if(typeof $t.protocol!="string"){const ar={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}var tr=fr===Nt}else var tr=!0}}}}else{const rr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[rr]:Bt.push(rr),Nt++}var Jt=lr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,2];else{Jt&&(jt=!0,Kt=2,Ht!==!0&&(Ht=!0));const rr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let gr;if($t.interface===void 0&&(gr="interface")||$t.method===void 0&&(gr="method")){const ar={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/required",keyword:"required",params:{missingProperty:gr},message:"must have required property '"+gr+"'"};Bt===null?Bt=[ar]:Bt.push(ar),Nt++}else{const ar=Nt;for(const nr in $t)if(!(nr==="interface"||nr==="method"||nr==="protocol")){const ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++;break}if(ar===Nt){if($t.interface!==void 0){const nr=Nt;if($t.interface!=="Protocols"){const ur={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}var dr=nr===Nt}else var dr=!0;if(dr){if($t.method!==void 0){const nr=Nt;if($t.method!=="Configure"){const pr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/method/const",keyword:"const",params:{allowedValue:"Configure"},message:"must be equal to constant"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}var dr=nr===Nt}else var dr=!0;if(dr)if($t.protocol!==void 0){const nr=Nt;if(typeof $t.protocol!="string"){const pr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}var dr=nr===Nt}else var dr=!0}}}}else{const gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[gr]:Bt.push(gr),Nt++}var Jt=rr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,3];else{Jt&&(jt=!0,Kt=3,Ht!==!0&&(Ht=!0));const gr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let ur;if($t.interface===void 0&&(ur="interface")||$t.method===void 0&&(ur="method")){const pr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"};Bt===null?Bt=[pr]:Bt.push(pr),Nt++}else{const pr=Nt;for(const br in $t)if(!(br==="interface"||br==="method"||br==="protocol")){const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:br},message:"must NOT have additional properties"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++;break}if(pr===Nt){if($t.interface!==void 0){const br=Nt;if($t.interface!=="Protocols"){const Sr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++}var vr=br===Nt}else var vr=!0;if(vr){if($t.method!==void 0){const br=Nt;if($t.method!=="Query"){const Pr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}var vr=br===Nt}else var vr=!0;if(vr)if($t.protocol!==void 0){const br=Nt;if(typeof $t.protocol!="string"){const Pr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}var vr=br===Nt}else var vr=!0}}}}else{const ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[ur]:Bt.push(ur),Nt++}var Jt=gr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,4];else{Jt&&(jt=!0,Kt=4,Ht!==!0&&(Ht=!0));const ur=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Sr;if($t.interface===void 0&&(Sr="interface")||$t.method===void 0&&(Sr="method")){const Pr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};Bt===null?Bt=[Pr]:Bt.push(Pr),Nt++}else{const Pr=Nt;for(const Tr in $t)if(!(Tr==="interface"||Tr==="method"||Tr==="protocol"||Tr==="contextId"||Tr==="protocolPath")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Tr},message:"must NOT have additional properties"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++;break}if(Pr===Nt){if($t.interface!==void 0){const Tr=Nt;if($t.interface!=="Records"){const wr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++}var $r=Tr===Nt}else var $r=!0;if($r){if($t.method!==void 0){const Tr=Nt;if($t.method!=="Read"){const Ar={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0;if($r){if($t.protocol!==void 0){const Tr=Nt;if(typeof $t.protocol!="string"){const Ar={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0;if($r){if($t.contextId!==void 0){const Tr=Nt;if(typeof $t.contextId!="string"){const Ar={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0;if($r)if($t.protocolPath!==void 0){const Tr=Nt;if(typeof $t.protocolPath!="string"){const Ar={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var $r=Tr===Nt}else var $r=!0}}}}}}else{const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Sr]:Bt.push(Sr),Nt++}var Jt=ur===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,5];else{Jt&&(jt=!0,Kt=5,Ht!==!0&&(Ht=!0));const Sr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let wr;if($t.interface===void 0&&(wr="interface")||$t.method===void 0&&(wr="method")){const Ar={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/required",keyword:"required",params:{missingProperty:wr},message:"must have required property '"+wr+"'"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}else{const Ar=Nt;for(const Mr in $t)if(!(Mr==="interface"||Mr==="method"||Mr==="protocol"||Mr==="contextId"||Mr==="protocolPath")){const Ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Mr},message:"must NOT have additional properties"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++;break}if(Ar===Nt){if($t.interface!==void 0){const Mr=Nt;if($t.interface!=="Records"){const Ur={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir){if($t.method!==void 0){const Mr=Nt;if($t.method!=="Delete"){const Or={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/method/const",keyword:"const",params:{allowedValue:"Delete"},message:"must be equal to constant"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir){if($t.protocol!==void 0){const Mr=Nt;if(typeof $t.protocol!="string"){const Or={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir){if($t.contextId!==void 0){const Mr=Nt;if(typeof $t.contextId!="string"){const Or={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0;if(Ir)if($t.protocolPath!==void 0){const Mr=Nt;if(typeof $t.protocolPath!="string"){const Or={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var Ir=Mr===Nt}else var Ir=!0}}}}}}else{const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++}var Jt=Sr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,6];else{Jt&&(jt=!0,Kt=6,Ht!==!0&&(Ht=!0));const wr=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Ur;if($t.interface===void 0&&(Ur="interface")||$t.method===void 0&&(Ur="method")){const Or={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/required",keyword:"required",params:{missingProperty:Ur},message:"must have required property '"+Ur+"'"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}else{const Or=Nt;for(const Cr in $t)if(!(Cr==="interface"||Cr==="method"||Cr==="protocol"||Cr==="contextId"||Cr==="protocolPath")){const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Cr},message:"must NOT have additional properties"};Bt===null?Bt=[Er]:Bt.push(Er),Nt++;break}if(Or===Nt){if($t.interface!==void 0){const Cr=Nt;if($t.interface!=="Records"){const Er={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[Er]:Bt.push(Er),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr){if($t.method!==void 0){const Cr=Nt;if($t.method!=="Write"){const Br={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/method/const",keyword:"const",params:{allowedValue:"Write"},message:"must be equal to constant"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr){if($t.protocol!==void 0){const Cr=Nt;if(typeof $t.protocol!="string"){const Br={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr){if($t.contextId!==void 0){const Cr=Nt;if(typeof $t.contextId!="string"){const Br={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0;if(Rr)if($t.protocolPath!==void 0){const Cr=Nt;if(typeof $t.protocolPath!="string"){const Br={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}var Rr=Cr===Nt}else var Rr=!0}}}}}}else{const Ur={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var Jt=wr===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,7];else{Jt&&(jt=!0,Kt=7,Ht!==!0&&(Ht=!0));const Ur=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Er;if($t.interface===void 0&&(Er="interface")||$t.method===void 0&&(Er="method")){const Br={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/required",keyword:"required",params:{missingProperty:Er},message:"must have required property '"+Er+"'"};Bt===null?Bt=[Br]:Bt.push(Br),Nt++}else{const Br=Nt;for(const Lr in $t)if(!(Lr==="interface"||Lr==="method"||Lr==="protocol"||Lr==="contextId"||Lr==="protocolPath")){const xr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Lr},message:"must NOT have additional properties"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++;break}if(Br===Nt){if($t.interface!==void 0){const Lr=Nt;if($t.interface!=="Records"){const xr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr){if($t.method!==void 0){const Lr=Nt;if($t.method!=="Query"){const _r={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr){if($t.protocol!==void 0){const Lr=Nt;if(typeof $t.protocol!="string"){const _r={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr){if($t.contextId!==void 0){const Lr=Nt;if(typeof $t.contextId!="string"){const _r={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0;if(Nr)if($t.protocolPath!==void 0){const Lr=Nt;if(typeof $t.protocolPath!="string"){const _r={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}var Nr=Lr===Nt}else var Nr=!0}}}}}}else{const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[Er]:Bt.push(Er),Nt++}var Jt=Ur===Nt;if(Jt&&jt)jt=!1,Kt=[Kt,8];else{Jt&&(jt=!0,Kt=8,Ht!==!0&&(Ht=!0));const Er=Nt;if(Nt===Nt)if($t&&typeof $t=="object"&&!Array.isArray($t)){let xr;if($t.interface===void 0&&(xr="interface")||$t.method===void 0&&(xr="method")){const _r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/required",keyword:"required",params:{missingProperty:xr},message:"must have required property '"+xr+"'"};Bt===null?Bt=[_r]:Bt.push(_r),Nt++}else{const _r=Nt;for(const Dr in $t)if(!(Dr==="interface"||Dr==="method"||Dr==="protocol"||Dr==="contextId"||Dr==="protocolPath")){const jr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Dr},message:"must NOT have additional properties"};Bt===null?Bt=[jr]:Bt.push(jr),Nt++;break}if(_r===Nt){if($t.interface!==void 0){const Dr=Nt;if($t.interface!=="Records"){const jr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};Bt===null?Bt=[jr]:Bt.push(jr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr){if($t.method!==void 0){const Dr=Nt;if($t.method!=="Subscribe"){const Hr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr){if($t.protocol!==void 0){const Dr=Nt;if(typeof $t.protocol!="string"){const Hr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr){if($t.contextId!==void 0){const Dr=Nt;if(typeof $t.contextId!="string"){const Hr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0;if(kr)if($t.protocolPath!==void 0){const Dr=Nt;if(typeof $t.protocolPath!="string"){const Hr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Hr]:Bt.push(Hr),Nt++}var kr=Dr===Nt}else var kr=!0}}}}}}else{const xr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var Jt=Er===Nt;Jt&&jt?(jt=!1,Kt=[Kt,9]):Jt&&(jt=!0,Kt=9,Ht!==!0&&(Ht=!0))}}}}}}}}if(jt)Nt=Lt,Bt!==null&&(Lt?Bt.length=Lt:Bt=null);else{const lr={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:Kt},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[lr]:Bt.push(lr),Nt++,validate69.errors=Bt,!1}return validate69.errors=Bt,Ut.props=Ht,Nt===0}validate69.evaluated={dynamicProps:!0,dynamicItems:!1};function validate68($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate68.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let jt;if($t.delegated===void 0&&(jt="delegated")||$t.scope===void 0&&(jt="scope"))return validate68.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;{const Kt=Nt;for(const qt in $t)if(!(qt==="description"||qt==="delegated"||qt==="scope"||qt==="conditions"))return validate68.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:qt},message:"must NOT have additional properties"}],!1;if(Kt===Nt){if($t.description!==void 0){const qt=Nt;if(typeof $t.description!="string")return validate68.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.delegated!==void 0){const qt=Nt;if(typeof $t.delegated!="boolean")return validate68.errors=[{instancePath:e+"/delegated",schemaPath:"#/properties/delegated/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var Lt=qt===Nt}else var Lt=!0;if(Lt){if($t.scope!==void 0){const qt=Nt;validate69($t.scope,{instancePath:e+"/scope",parentData:$t,parentDataProperty:"scope",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate69.errors:Bt.concat(validate69.errors),Nt=Bt.length);var Lt=qt===Nt}else var Lt=!0;if(Lt)if($t.conditions!==void 0){let qt=$t.conditions;const zt=Nt;if(Nt===Nt)if(qt&&typeof qt=="object"&&!Array.isArray(qt)){const Wt=Nt;for(const Qt in qt)if(Qt!=="publication")return validate68.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Qt},message:"must NOT have additional properties"}],!1;if(Wt===Nt&&qt.publication!==void 0){let Qt=qt.publication;if(typeof Qt!="string")return validate68.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(Qt==="Required"||Qt==="Prohibited"))return validate68.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/enum",keyword:"enum",params:{allowedValues:schema103.properties.publication.enum},message:"must be equal to one of the allowed values"}],!1}}else return validate68.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=zt===Nt}else var Lt=!0}}}}}else return validate68.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate68.errors=Bt,Nt===0}validate68.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionRevocationData=validate71;function validate71($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate71.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)){for(const Lt in $t)if(Lt!=="description")return validate71.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Lt},message:"must NOT have additional properties"}],!1;if($t.description!==void 0&&typeof $t.description!="string")return validate71.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1}else return validate71.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate71.errors=Bt,Nt===0}validate71.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionsDefinitions=validate64;function validate64($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate64.evaluated;return Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)?(validate64.errors=Bt,Nt===0):(validate64.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}validate64.evaluated={dynamicProps:!1,dynamicItems:!1};const PermissionsScopes=validate66;function validate66($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate66.evaluated;return Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)?(validate66.errors=Bt,Nt===0):(validate66.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}validate66.evaluated={dynamicProps:!1,dynamicItems:!1};const ProtocolDefinition=validate72,pattern37=new RegExp(".*","u"),schema119={$id:"https://identity.foundation/dwn/json-schemas/protocol-rule-set.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",additionalProperties:!1,properties:{$encryption:{type:"object",additionalProperties:!1,properties:{rootKeyId:{type:"string"},publicKeyJwk:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"}},required:["rootKeyId","publicKeyJwk"]},$actions:{type:"array",minItems:1,items:{type:"object",oneOf:[{required:["who","can"],additionalProperties:!1,properties:{who:{type:"string",enum:["anyone","author","recipient"]},of:{type:"string"},can:{type:"array",minItems:1,items:{type:"string",enum:["co-delete","co-prune","co-update","create","delete","prune","read","update"]}}}},{required:["role","can"],properties:{role:{$comment:"Must be the protocol path of a role record type",type:"string"},can:{type:"array",minItems:1,items:{type:"string",enum:["co-delete","co-update","create","delete","query","subscribe","read","update"]}}}}]}},$role:{$comment:"When `true`, this turns a record into `role` that may be used within a context/sub-context",type:"boolean"},$size:{type:"object",additionalProperties:!1,properties:{min:{type:"number",minimum:0},max:{type:"number",minimum:0}}},$tags:{type:"object",minProperties:1,properties:{$requiredTags:{type:"array",items:{type:"string"}},$allowUndefinedTags:{type:"boolean"}},patternProperties:{"^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$":{type:"object",additionalProperties:!1,properties:{type:{enum:["string","number","integer","boolean","array"]},items:{type:"object",properties:{type:{enum:["string","number","integer"]}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$":{}}},contains:{type:"object",properties:{type:{enum:["string","number","integer"]}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$":{}}}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength|minItems|maxItems|uniqueItems|minContains|maxContains)$":{}}}}}},patternProperties:{"^[^$].*$":{$ref:"https://identity.foundation/dwn/json-schemas/protocol-rule-set.json"}}},pattern39=new RegExp("^[^$].*$","u"),pattern40=new RegExp("^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$","u"),pattern41=new RegExp("^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength|minItems|maxItems|uniqueItems|minContains|maxContains)$","u"),pattern42=new RegExp("^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$","u"),wrapper2={validate:validate73};function validate73($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate73.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){const lr=Nt;for(const ir in $t)if(!(ir==="$encryption"||ir==="$actions"||ir==="$role"||ir==="$size"||ir==="$tags"||pattern39.test(ir)))return validate73.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ir},message:"must NOT have additional properties"}],!1;if(lr===Nt){if($t.$encryption!==void 0){let ir=$t.$encryption;const er=Nt;if(Nt===er)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){let rr;if(ir.rootKeyId===void 0&&(rr="rootKeyId")||ir.publicKeyJwk===void 0&&(rr="publicKeyJwk"))return validate73.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;{const yr=Nt;for(const fr in ir)if(!(fr==="rootKeyId"||fr==="publicKeyJwk"))return validate73.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:fr},message:"must NOT have additional properties"}],!1;if(yr===Nt){if(ir.rootKeyId!==void 0){const fr=Nt;if(typeof ir.rootKeyId!="string")return validate73.errors=[{instancePath:e+"/$encryption/rootKeyId",schemaPath:"#/properties/%24encryption/properties/rootKeyId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=fr===Nt}else var Lt=!0;if(Lt)if(ir.publicKeyJwk!==void 0){const fr=Nt;validate33(ir.publicKeyJwk,{instancePath:e+"/$encryption/publicKeyJwk",parentData:ir,parentDataProperty:"publicKeyJwk",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate33.errors:Bt.concat(validate33.errors),Nt=Bt.length);var Lt=fr===Nt}else var Lt=!0}}}else return validate73.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=er===Nt}else var jt=!0;if(jt){if($t.$actions!==void 0){let ir=$t.$actions;const er=Nt;if(Nt===er)if(Array.isArray(ir)){if(ir.length<1)return validate73.errors=[{instancePath:e+"/$actions",schemaPath:"#/properties/%24actions/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var Kt=!0;const yr=ir.length;for(let fr=0;fr<yr;fr++){let gr=ir[fr];const ar=Nt;if(!(gr&&typeof gr=="object"&&!Array.isArray(gr)))return validate73.errors=[{instancePath:e+"/$actions/"+fr,schemaPath:"#/properties/%24actions/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;const nr=Nt;let ur=!1,pr=null;const br=Nt;if(gr&&typeof gr=="object"&&!Array.isArray(gr)){let Tr;if(gr.who===void 0&&(Tr="who")||gr.can===void 0&&(Tr="can")){const wr={instancePath:e+"/$actions/"+fr,schemaPath:"#/properties/%24actions/items/oneOf/0/required",keyword:"required",params:{missingProperty:Tr},message:"must have required property '"+Tr+"'"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++}else{const wr=Nt;for(const Ar in gr)if(!(Ar==="who"||Ar==="of"||Ar==="can")){const Mr={instancePath:e+"/$actions/"+fr,schemaPath:"#/properties/%24actions/items/oneOf/0/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Ar},message:"must NOT have additional properties"};Bt===null?Bt=[Mr]:Bt.push(Mr),Nt++;break}if(wr===Nt){if(gr.who!==void 0){let Ar=gr.who;const Mr=Nt;if(typeof Ar!="string"){const Ur={instancePath:e+"/$actions/"+fr+"/who",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/who/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}if(!(Ar==="anyone"||Ar==="author"||Ar==="recipient")){const Ur={instancePath:e+"/$actions/"+fr+"/who",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/who/enum",keyword:"enum",params:{allowedValues:schema119.properties.$actions.items.oneOf[0].properties.who.enum},message:"must be equal to one of the allowed values"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var qt=Mr===Nt}else var qt=!0;if(qt){if(gr.of!==void 0){const Ar=Nt;if(typeof gr.of!="string"){const Ur={instancePath:e+"/$actions/"+fr+"/of",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/of/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var qt=Ar===Nt}else var qt=!0;if(qt)if(gr.can!==void 0){let Ar=gr.can;const Mr=Nt;if(Nt===Mr)if(Array.isArray(Ar))if(Ar.length<1){const Or={instancePath:e+"/$actions/"+fr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}else{var zt=!0;const Or=Ar.length;for(let Cr=0;Cr<Or;Cr++){let Er=Ar[Cr];const Br=Nt;if(typeof Er!="string"){const xr={instancePath:e+"/$actions/"+fr+"/can/"+Cr,schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/items/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}if(!(Er==="co-delete"||Er==="co-prune"||Er==="co-update"||Er==="create"||Er==="delete"||Er==="prune"||Er==="read"||Er==="update")){const xr={instancePath:e+"/$actions/"+fr+"/can/"+Cr,schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/items/enum",keyword:"enum",params:{allowedValues:schema119.properties.$actions.items.oneOf[0].properties.can.items.enum},message:"must be equal to one of the allowed values"};Bt===null?Bt=[xr]:Bt.push(xr),Nt++}var zt=Br===Nt;if(!zt)break}}else{const Or={instancePath:e+"/$actions/"+fr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/type",keyword:"type",params:{type:"array"},message:"must be array"};Bt===null?Bt=[Or]:Bt.push(Or),Nt++}var qt=Mr===Nt}else var qt=!0}}}}var Qt=br===Nt;if(Qt){ur=!0,pr=0;var Vt=!0}const Sr=Nt;if(gr&&typeof gr=="object"&&!Array.isArray(gr)){let Tr;if(gr.role===void 0&&(Tr="role")||gr.can===void 0&&(Tr="can")){const wr={instancePath:e+"/$actions/"+fr,schemaPath:"#/properties/%24actions/items/oneOf/1/required",keyword:"required",params:{missingProperty:Tr},message:"must have required property '"+Tr+"'"};Bt===null?Bt=[wr]:Bt.push(wr),Nt++}else{if(gr.role!==void 0){const wr=Nt;if(typeof gr.role!="string"){const Ar={instancePath:e+"/$actions/"+fr+"/role",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/role/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Ar]:Bt.push(Ar),Nt++}var Ht=wr===Nt}else var Ht=!0;if(Ht)if(gr.can!==void 0){let wr=gr.can;const Ar=Nt;if(Nt===Ar)if(Array.isArray(wr))if(wr.length<1){const Ur={instancePath:e+"/$actions/"+fr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}else{var Wt=!0;const Ur=wr.length;for(let Or=0;Or<Ur;Or++){let Cr=wr[Or];const Er=Nt;if(typeof Cr!="string"){const Lr={instancePath:e+"/$actions/"+fr+"/can/"+Or,schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/items/type",keyword:"type",params:{type:"string"},message:"must be string"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}if(!(Cr==="co-delete"||Cr==="co-update"||Cr==="create"||Cr==="delete"||Cr==="query"||Cr==="subscribe"||Cr==="read"||Cr==="update")){const Lr={instancePath:e+"/$actions/"+fr+"/can/"+Or,schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/items/enum",keyword:"enum",params:{allowedValues:schema119.properties.$actions.items.oneOf[1].properties.can.items.enum},message:"must be equal to one of the allowed values"};Bt===null?Bt=[Lr]:Bt.push(Lr),Nt++}var Wt=Er===Nt;if(!Wt)break}}else{const Ur={instancePath:e+"/$actions/"+fr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/type",keyword:"type",params:{type:"array"},message:"must be array"};Bt===null?Bt=[Ur]:Bt.push(Ur),Nt++}var Ht=Ar===Nt}else var Ht=!0}}var Qt=Sr===Nt;if(Qt&&ur?(ur=!1,pr=[pr,1]):Qt&&(ur=!0,pr=1,Vt!==!0&&(Vt=Vt||{},Vt.role=!0,Vt.can=!0)),ur)Nt=nr,Bt!==null&&(nr?Bt.length=nr:Bt=null);else{const Tr={instancePath:e+"/$actions/"+fr,schemaPath:"#/properties/%24actions/items/oneOf",keyword:"oneOf",params:{passingSchemas:pr},message:"must match exactly one schema in oneOf"};return Bt===null?Bt=[Tr]:Bt.push(Tr),Nt++,validate73.errors=Bt,!1}var Kt=ar===Nt;if(!Kt)break}}}else return validate73.errors=[{instancePath:e+"/$actions",schemaPath:"#/properties/%24actions/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var jt=er===Nt}else var jt=!0;if(jt){if($t.$role!==void 0){const ir=Nt;if(typeof $t.$role!="boolean")return validate73.errors=[{instancePath:e+"/$role",schemaPath:"#/properties/%24role/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var jt=ir===Nt}else var jt=!0;if(jt){if($t.$size!==void 0){let ir=$t.$size;const er=Nt;if(Nt===er)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){const yr=Nt;for(const fr in ir)if(!(fr==="min"||fr==="max"))return validate73.errors=[{instancePath:e+"/$size",schemaPath:"#/properties/%24size/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:fr},message:"must NOT have additional properties"}],!1;if(yr===Nt){if(ir.min!==void 0){let fr=ir.min;const gr=Nt;if(Nt===gr)if(typeof fr=="number"&&isFinite(fr)){if(fr<0||isNaN(fr))return validate73.errors=[{instancePath:e+"/$size/min",schemaPath:"#/properties/%24size/properties/min/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1}else return validate73.errors=[{instancePath:e+"/$size/min",schemaPath:"#/properties/%24size/properties/min/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Xt=gr===Nt}else var Xt=!0;if(Xt)if(ir.max!==void 0){let fr=ir.max;const gr=Nt;if(Nt===gr)if(typeof fr=="number"&&isFinite(fr)){if(fr<0||isNaN(fr))return validate73.errors=[{instancePath:e+"/$size/max",schemaPath:"#/properties/%24size/properties/max/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1}else return validate73.errors=[{instancePath:e+"/$size/max",schemaPath:"#/properties/%24size/properties/max/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Xt=gr===Nt}else var Xt=!0}}else return validate73.errors=[{instancePath:e+"/$size",schemaPath:"#/properties/%24size/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=er===Nt}else var jt=!0;if(jt){if($t.$tags!==void 0){let ir=$t.$tags;const er=Nt;if(Nt===er)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){if(Object.keys(ir).length<1)return validate73.errors=[{instancePath:e+"/$tags",schemaPath:"#/properties/%24tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;if(ir.$requiredTags!==void 0){let yr=ir.$requiredTags;const fr=Nt;if(Nt===fr)if(Array.isArray(yr)){var Jt=!0;const gr=yr.length;for(let ar=0;ar<gr;ar++){const nr=Nt;if(typeof yr[ar]!="string")return validate73.errors=[{instancePath:e+"/$tags/$requiredTags/"+ar,schemaPath:"#/properties/%24tags/properties/%24requiredTags/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Jt=nr===Nt;if(!Jt)break}}else return validate73.errors=[{instancePath:e+"/$tags/$requiredTags",schemaPath:"#/properties/%24tags/properties/%24requiredTags/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var tr=fr===Nt}else var tr=!0;if(tr){if(ir.$allowUndefinedTags!==void 0){const yr=Nt;if(typeof ir.$allowUndefinedTags!="boolean")return validate73.errors=[{instancePath:e+"/$tags/$allowUndefinedTags",schemaPath:"#/properties/%24tags/properties/%24allowUndefinedTags/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var tr=yr===Nt}else var tr=!0;if(tr){var dr={};dr.$requiredTags=!0,dr.$allowUndefinedTags=!0;for(const yr in ir)if(pattern40.test(yr)){let fr=ir[yr];if(Nt===Nt)if(fr&&typeof fr=="object"&&!Array.isArray(fr)){const ar=Nt;for(const nr in fr)if(!(nr==="type"||nr==="items"||nr==="contains"||pattern41.test(nr)))return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"}],!1;if(ar===Nt){if(fr.type!==void 0){let nr=fr.type;const ur=Nt;if(!(nr==="string"||nr==="number"||nr==="integer"||nr==="boolean"||nr==="array"))return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/type/enum",keyword:"enum",params:{allowedValues:schema119.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var vr=ur===Nt}else var vr=!0;if(vr){if(fr.items!==void 0){let nr=fr.items;const ur=Nt;if(Nt===ur)if(nr&&typeof nr=="object"&&!Array.isArray(nr)){if(nr.type!==void 0){let br=nr.type;const Sr=Nt;if(!(br==="string"||br==="number"||br==="integer"))return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/items/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/items/properties/type/enum",keyword:"enum",params:{allowedValues:schema119.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.items.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var $r=Sr===Nt}else var $r=!0;if($r){var Ir={};Ir.type=!0;for(const br in nr)pattern42.test(br)&&(Ir[br]=!0)}}else return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/items",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var vr=ur===Nt}else var vr=!0;if(vr)if(fr.contains!==void 0){let nr=fr.contains;const ur=Nt;if(Nt===ur)if(nr&&typeof nr=="object"&&!Array.isArray(nr)){if(nr.type!==void 0){let br=nr.type;const Sr=Nt;if(!(br==="string"||br==="number"||br==="integer"))return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/contains/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/contains/properties/type/enum",keyword:"enum",params:{allowedValues:schema119.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.contains.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var Rr=Sr===Nt}else var Rr=!0;if(Rr){var Nr={};Nr.type=!0;for(const br in nr)pattern42.test(br)&&(Nr[br]=!0)}}else return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/contains",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/contains/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var vr=ur===Nt}else var vr=!0}}}else return validate73.errors=[{instancePath:e+"/$tags/"+yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;dr[yr]=!0}}}}else return validate73.errors=[{instancePath:e+"/$tags",schemaPath:"#/properties/%24tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=er===Nt}else var jt=!0;if(jt){var kr=!0;for(const ir in $t)if(pattern39.test(ir)){const er=Nt;wrapper2.validate($t[ir],{instancePath:e+"/"+ir.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:$t,parentDataProperty:ir,rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?wrapper2.validate.errors:Bt.concat(wrapper2.validate.errors),Nt=Bt.length);var kr=er===Nt;if(!kr)break}}}}}}}}else return validate73.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate73.errors=Bt,Nt===0}validate73.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate72($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate72.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Vt;if($t.protocol===void 0&&(Vt="protocol")||$t.published===void 0&&(Vt="published")||$t.types===void 0&&(Vt="types")||$t.structure===void 0&&(Vt="structure"))return validate72.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Vt},message:"must have required property '"+Vt+"'"}],!1;{const Ht=Nt;for(const Wt in $t)if(!(Wt==="protocol"||Wt==="published"||Wt==="types"||Wt==="structure"))return validate72.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Wt},message:"must NOT have additional properties"}],!1;if(Ht===Nt){if($t.protocol!==void 0){const Wt=Nt;if(typeof $t.protocol!="string")return validate72.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Wt===Nt}else var Lt=!0;if(Lt){if($t.published!==void 0){const Wt=Nt;if(typeof $t.published!="boolean")return validate72.errors=[{instancePath:e+"/published",schemaPath:"#/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var Lt=Wt===Nt}else var Lt=!0;if(Lt){if($t.types!==void 0){let Wt=$t.types;const Qt=Nt;if(Nt===Qt)if(Wt&&typeof Wt=="object"&&!Array.isArray(Wt)){var jt={};for(const Jt in Wt)if(pattern37.test(Jt)){let tr=Wt[Jt];if(Nt===Nt)if(tr&&typeof tr=="object"&&!Array.isArray(tr)){const vr=Nt;for(const $r in tr)if(!($r==="schema"||$r==="dataFormats"))return validate72.errors=[{instancePath:e+"/types/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/types/patternProperties/.*/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:$r},message:"must NOT have additional properties"}],!1;if(vr===Nt){if(tr.schema!==void 0){const $r=Nt;if(typeof tr.schema!="string")return validate72.errors=[{instancePath:e+"/types/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1")+"/schema",schemaPath:"#/properties/types/patternProperties/.*/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Kt=$r===Nt}else var Kt=!0;if(Kt)if(tr.dataFormats!==void 0){let $r=tr.dataFormats;const Ir=Nt;if(Nt===Ir)if(Array.isArray($r)){if($r.length<1)return validate72.errors=[{instancePath:e+"/types/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats",schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var qt=!0;const Nr=$r.length;for(let kr=0;kr<Nr;kr++){const lr=Nt;if(typeof $r[kr]!="string")return validate72.errors=[{instancePath:e+"/types/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats/"+kr,schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var qt=lr===Nt;if(!qt)break}}}else return validate72.errors=[{instancePath:e+"/types/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats",schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var Kt=Ir===Nt}else var Kt=!0}}else return validate72.errors=[{instancePath:e+"/types/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/types/patternProperties/.*/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;jt[Jt]=!0}}else return validate72.errors=[{instancePath:e+"/types",schemaPath:"#/properties/types/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Qt===Nt}else var Lt=!0;if(Lt)if($t.structure!==void 0){let Wt=$t.structure;const Qt=Nt;if(Nt===Qt)if(Wt&&typeof Wt=="object"&&!Array.isArray(Wt)){var zt={};for(const Jt in Wt)pattern37.test(Jt)&&(validate73(Wt[Jt],{instancePath:e+"/structure/"+Jt.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:Wt,parentDataProperty:Jt,rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate73.errors:Bt.concat(validate73.errors),Nt=Bt.length),zt[Jt]=!0)}else return validate72.errors=[{instancePath:e+"/structure",schemaPath:"#/properties/structure/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Qt===Nt}else var Lt=!0}}}}}else return validate72.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate72.errors=Bt,Nt===0}validate72.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const ProtocolRuleSet=validate73,ProtocolsConfigure$1=validate76,schema120={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/protocols-configure.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","definition"],properties:{interface:{enum:["Protocols"],type:"string"},method:{enum:["Configure"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},definition:{$ref:"https://identity.foundation/dwn/json-schemas/protocol-definition.json"}}}}};function validate76($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate76.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Kt;if($t.authorization===void 0&&(Kt="authorization")||$t.descriptor===void 0&&(Kt="descriptor"))return validate76.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Kt},message:"must have required property '"+Kt+"'"}],!1;{const qt=Nt;for(const zt in $t)if(!(zt==="authorization"||zt==="descriptor"))return validate76.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:zt},message:"must NOT have additional properties"}],!1;if(qt===Nt){if($t.authorization!==void 0){const zt=Nt;validate24($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate24.errors:Bt.concat(validate24.errors),Nt=Bt.length);var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let zt=$t.descriptor;const Vt=Nt;if(Nt===Vt)if(zt&&typeof zt=="object"&&!Array.isArray(zt)){let Wt;if(zt.interface===void 0&&(Wt="interface")||zt.method===void 0&&(Wt="method")||zt.messageTimestamp===void 0&&(Wt="messageTimestamp")||zt.definition===void 0&&(Wt="definition"))return validate76.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Wt},message:"must have required property '"+Wt+"'"}],!1;{const Qt=Nt;for(const Xt in zt)if(!(Xt==="interface"||Xt==="method"||Xt==="messageTimestamp"||Xt==="definition"))return validate76.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xt},message:"must NOT have additional properties"}],!1;if(Qt===Nt){if(zt.interface!==void 0){let Xt=zt.interface;const Jt=Nt;if(typeof Xt!="string")return validate76.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Protocols")return validate76.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema120.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.method!==void 0){let Xt=zt.method;const Jt=Nt;if(typeof Xt!="string")return validate76.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Configure")return validate76.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema120.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.messageTimestamp!==void 0){let Xt=zt.messageTimestamp;const Jt=Nt;if(Nt===Nt)if(typeof Xt=="string"){if(!pattern14.test(Xt))return validate76.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate76.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt)if(zt.definition!==void 0){const Xt=Nt;validate72(zt.definition,{instancePath:e+"/descriptor/definition",parentData:zt,parentDataProperty:"definition",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate72.errors:Bt.concat(validate72.errors),Nt=Bt.length);var jt=Xt===Nt}else var jt=!0}}}}}else return validate76.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Vt===Nt}else var Lt=!0}}}else return validate76.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate76.errors=Bt,Nt===0}validate76.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const ProtocolsQuery$1=validate79,schema122={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/protocols-query.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp"],properties:{interface:{enum:["Protocols"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{type:"object",minProperties:1,additionalProperties:!1,properties:{protocol:{type:"string"},recipient:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}}}}}};function validate79($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate79.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let qt;if($t.descriptor===void 0&&(qt="descriptor"))return validate79.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:qt},message:"must have required property '"+qt+"'"}],!1;{const zt=Nt;for(const Vt in $t)if(!(Vt==="authorization"||Vt==="descriptor"))return validate79.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Vt},message:"must NOT have additional properties"}],!1;if(zt===Nt){if($t.authorization!==void 0){const Vt=Nt;validate20($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate20.errors:Bt.concat(validate20.errors),Nt=Bt.length);var Lt=Vt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let Vt=$t.descriptor;const Ht=Nt;if(Nt===Ht)if(Vt&&typeof Vt=="object"&&!Array.isArray(Vt)){let Qt;if(Vt.interface===void 0&&(Qt="interface")||Vt.method===void 0&&(Qt="method")||Vt.messageTimestamp===void 0&&(Qt="messageTimestamp"))return validate79.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Qt},message:"must have required property '"+Qt+"'"}],!1;{const Xt=Nt;for(const Jt in Vt)if(!(Jt==="interface"||Jt==="method"||Jt==="messageTimestamp"||Jt==="filter"))return validate79.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Jt},message:"must NOT have additional properties"}],!1;if(Xt===Nt){if(Vt.interface!==void 0){let Jt=Vt.interface;const tr=Nt;if(typeof Jt!="string")return validate79.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Jt!=="Protocols")return validate79.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema122.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=tr===Nt}else var jt=!0;if(jt){if(Vt.method!==void 0){let Jt=Vt.method;const tr=Nt;if(typeof Jt!="string")return validate79.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Jt!=="Query")return validate79.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema122.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=tr===Nt}else var jt=!0;if(jt){if(Vt.messageTimestamp!==void 0){let Jt=Vt.messageTimestamp;const tr=Nt;if(Nt===Nt)if(typeof Jt=="string"){if(!pattern14.test(Jt))return validate79.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate79.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=tr===Nt}else var jt=!0;if(jt)if(Vt.filter!==void 0){let Jt=Vt.filter;const tr=Nt;if(Nt===tr)if(Jt&&typeof Jt=="object"&&!Array.isArray(Jt)){if(Object.keys(Jt).length<1)return validate79.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const vr=Nt;for(const $r in Jt)if(!($r==="protocol"||$r==="recipient"))return validate79.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:$r},message:"must NOT have additional properties"}],!1;if(vr===Nt){if(Jt.protocol!==void 0){const $r=Nt;if(typeof Jt.protocol!="string")return validate79.errors=[{instancePath:e+"/descriptor/filter/protocol",schemaPath:"#/properties/descriptor/properties/filter/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Kt=$r===Nt}else var Kt=!0;if(Kt)if(Jt.recipient!==void 0){let $r=Jt.recipient;const Ir=Nt;if(Nt===Nt)if(typeof $r=="string"){if(!pattern12.test($r))return validate79.errors=[{instancePath:e+"/descriptor/filter/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate79.errors=[{instancePath:e+"/descriptor/filter/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Kt=Ir===Nt}else var Kt=!0}}}else return validate79.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var jt=tr===Nt}else var jt=!0}}}}}else return validate79.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Ht===Nt}else var Lt=!0}}}else return validate79.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate79.errors=Bt,Nt===0}validate79.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsRead$1=validate81,schema125={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-read.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Read"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"}}}}};function validate81($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate81.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){let Kt;if($t.descriptor===void 0&&(Kt="descriptor"))return validate81.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Kt},message:"must have required property '"+Kt+"'"}],!1;{const qt=Nt;for(const zt in $t)if(!(zt==="authorization"||zt==="descriptor"))return validate81.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:zt},message:"must NOT have additional properties"}],!1;if(qt===Nt){if($t.authorization!==void 0){const zt=Nt;validate24($t.authorization,{instancePath:e+"/authorization",parentData:$t,parentDataProperty:"authorization",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate24.errors:Bt.concat(validate24.errors),Nt=Bt.length);var Lt=zt===Nt}else var Lt=!0;if(Lt)if($t.descriptor!==void 0){let zt=$t.descriptor;const Vt=Nt;if(Nt===Vt)if(zt&&typeof zt=="object"&&!Array.isArray(zt)){let Wt;if(zt.interface===void 0&&(Wt="interface")||zt.method===void 0&&(Wt="method")||zt.messageTimestamp===void 0&&(Wt="messageTimestamp")||zt.filter===void 0&&(Wt="filter"))return validate81.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Wt},message:"must have required property '"+Wt+"'"}],!1;{const Qt=Nt;for(const Xt in zt)if(!(Xt==="interface"||Xt==="method"||Xt==="messageTimestamp"||Xt==="filter"))return validate81.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xt},message:"must NOT have additional properties"}],!1;if(Qt===Nt){if(zt.interface!==void 0){let Xt=zt.interface;const Jt=Nt;if(typeof Xt!="string")return validate81.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Records")return validate81.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema125.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.method!==void 0){let Xt=zt.method;const Jt=Nt;if(typeof Xt!="string")return validate81.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Xt!=="Read")return validate81.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema125.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt){if(zt.messageTimestamp!==void 0){let Xt=zt.messageTimestamp;const Jt=Nt;if(Nt===Nt)if(typeof Xt=="string"){if(!pattern14.test(Xt))return validate81.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate81.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var jt=Jt===Nt}else var jt=!0;if(jt)if(zt.filter!==void 0){const Xt=Nt;validate42(zt.filter,{instancePath:e+"/descriptor/filter",parentData:zt,parentDataProperty:"filter",rootData:xt,dynamicAnchors:kt})||(Bt=Bt===null?validate42.errors:Bt.concat(validate42.errors),Nt=Bt.length);var jt=Xt===Nt}else var jt=!0}}}}}else return validate81.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Lt=Vt===Nt}else var Lt=!0}}}else return validate81.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate81.errors=Bt,Nt===0}validate81.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsFilter=validate42,PublicJwk=validate33,GenericSignaturePayload=validate84;function validate84($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate84.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)){let jt;if($t.descriptorCid===void 0&&(jt="descriptorCid"))return validate84.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;for(const Kt in $t)if(!(Kt==="descriptorCid"||Kt==="delegatedGrantId"||Kt==="permissionGrantId"||Kt==="protocolRole"))return validate84.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Kt},message:"must NOT have additional properties"}],!1;{if($t.descriptorCid!==void 0){const Kt=Nt;if(typeof $t.descriptorCid!="string")return validate84.errors=[{instancePath:e+"/descriptorCid",schemaPath:"#/properties/descriptorCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.delegatedGrantId!==void 0){const Kt=Nt;if(typeof $t.delegatedGrantId!="string")return validate84.errors=[{instancePath:e+"/delegatedGrantId",schemaPath:"#/properties/delegatedGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.permissionGrantId!==void 0){const Kt=Nt;if(typeof $t.permissionGrantId!="string")return validate84.errors=[{instancePath:e+"/permissionGrantId",schemaPath:"#/properties/permissionGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt)if($t.protocolRole!==void 0){const Kt=Nt;if(typeof $t.protocolRole!="string")return validate84.errors=[{instancePath:e+"/protocolRole",schemaPath:"#/properties/protocolRole/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0}}}}else return validate84.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate84.errors=Bt,Nt===0}validate84.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsWriteSignaturePayload=validate85;function validate85($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate85.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),$t&&typeof $t=="object"&&!Array.isArray($t)){let jt;if($t.descriptorCid===void 0&&(jt="descriptorCid")||$t.recordId===void 0&&(jt="recordId"))return validate85.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:jt},message:"must have required property '"+jt+"'"}],!1;for(const Kt in $t)if(!(Kt==="descriptorCid"||Kt==="recordId"||Kt==="contextId"||Kt==="attestationCid"||Kt==="encryptionCid"||Kt==="delegatedGrantId"||Kt==="permissionGrantId"||Kt==="protocolRole"))return validate85.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Kt},message:"must NOT have additional properties"}],!1;{if($t.descriptorCid!==void 0){const Kt=Nt;if(typeof $t.descriptorCid!="string")return validate85.errors=[{instancePath:e+"/descriptorCid",schemaPath:"#/properties/descriptorCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.recordId!==void 0){const Kt=Nt;if(typeof $t.recordId!="string")return validate85.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.contextId!==void 0){const Kt=Nt;if(typeof $t.contextId!="string")return validate85.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.attestationCid!==void 0){const Kt=Nt;if(typeof $t.attestationCid!="string")return validate85.errors=[{instancePath:e+"/attestationCid",schemaPath:"#/properties/attestationCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.encryptionCid!==void 0){const Kt=Nt;if(typeof $t.encryptionCid!="string")return validate85.errors=[{instancePath:e+"/encryptionCid",schemaPath:"#/properties/encryptionCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.delegatedGrantId!==void 0){const Kt=Nt;if(typeof $t.delegatedGrantId!="string")return validate85.errors=[{instancePath:e+"/delegatedGrantId",schemaPath:"#/properties/delegatedGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt){if($t.permissionGrantId!==void 0){const Kt=Nt;if(typeof $t.permissionGrantId!="string")return validate85.errors=[{instancePath:e+"/permissionGrantId",schemaPath:"#/properties/permissionGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0;if(Lt)if($t.protocolRole!==void 0){const Kt=Nt;if(typeof $t.protocolRole!="string")return validate85.errors=[{instancePath:e+"/protocolRole",schemaPath:"#/properties/protocolRole/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Lt=Kt===Nt}else var Lt=!0}}}}}}}}else return validate85.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate85.errors=Bt,Nt===0}validate85.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const StringRangeFilter=validate86;function validate86($t,{instancePath:e="",parentData:_t,parentDataProperty:At,rootData:xt=$t,dynamicAnchors:kt={}}={}){let Bt=null,Nt=0;const Ut=validate86.evaluated;if(Ut.dynamicProps&&(Ut.props=void 0),Ut.dynamicItems&&(Ut.items=void 0),Nt===0)if($t&&typeof $t=="object"&&!Array.isArray($t)){if(Object.keys($t).length<1)return validate86.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Ht=Nt;for(const Wt in $t)if(!(Wt==="gt"||Wt==="gte"||Wt==="lt"||Wt==="lte"))return validate86.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Wt},message:"must NOT have additional properties"}],!1;if(Ht===Nt){if($t.gt!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.gte===void 0){const Jt={};Bt===null?Bt=[Jt]:Bt.push(Jt),Nt++}var Lt=Xt===Nt;if(Lt)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.gte!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.gt===void 0){const tr={};Bt===null?Bt=[tr]:Bt.push(tr),Nt++}var Kt=Xt===Nt;if(Kt)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.lt!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.lte===void 0){const tr={};Bt===null?Bt=[tr]:Bt.push(tr),Nt++}var qt=Xt===Nt;if(qt)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.lte!==void 0){const Wt=Nt,Qt=Nt,Xt=Nt;if($t&&typeof $t=="object"&&!Array.isArray($t)&&$t.lt===void 0){const tr={};Bt===null?Bt=[tr]:Bt.push(tr),Nt++}var zt=Xt===Nt;if(zt)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Nt=Qt,Bt!==null&&(Qt?Bt.length=Qt:Bt=null);var jt=Wt===Nt}else var jt=!0;if(jt){if($t.gt!==void 0){const Wt=Nt;if(typeof $t.gt!="string")return validate86.errors=[{instancePath:e+"/gt",schemaPath:"#/properties/gt/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Vt=Wt===Nt}else var Vt=!0;if(Vt){if($t.gte!==void 0){const Wt=Nt;if(typeof $t.gte!="string")return validate86.errors=[{instancePath:e+"/gte",schemaPath:"#/properties/gte/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Vt=Wt===Nt}else var Vt=!0;if(Vt){if($t.lt!==void 0){const Wt=Nt;if(typeof $t.lt!="string")return validate86.errors=[{instancePath:e+"/lt",schemaPath:"#/properties/lt/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Vt=Wt===Nt}else var Vt=!0;if(Vt)if($t.lte!==void 0){const Wt=Nt;if(typeof $t.lte!="string")return validate86.errors=[{instancePath:e+"/lte",schemaPath:"#/properties/lte/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Vt=Wt===Nt}else var Vt=!0}}}}}}}}}else return validate86.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate86.errors=Bt,Nt===0}validate86.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const precompiledValidators=Object.freeze(Object.defineProperty({__proto__:null,Authorization,AuthorizationDelegatedGrant,AuthorizationOwner,Definitions,GeneralJwk,GeneralJws,GenericSignaturePayload,JwkVerificationMethod,MessagesFilter,MessagesQuery:MessagesQuery$1,MessagesRead:MessagesRead$1,MessagesSubscribe:MessagesSubscribe$1,NumberRangeFilter,PaginationCursor,PermissionGrantData,PermissionRequestData,PermissionRevocationData,PermissionsDefinitions,PermissionsScopes,ProtocolDefinition,ProtocolRuleSet,ProtocolsConfigure:ProtocolsConfigure$1,ProtocolsQuery:ProtocolsQuery$1,PublicJwk,RecordsDelete:RecordsDelete$1,RecordsFilter,RecordsQuery:RecordsQuery$1,RecordsRead:RecordsRead$1,RecordsSubscribe:RecordsSubscribe$1,RecordsWrite:RecordsWrite$1,RecordsWriteDataEncoded,RecordsWriteSignaturePayload,RecordsWriteUnidentified,StringRangeFilter},Symbol.toStringTag,{value:"Module"}));function validateJsonSchema($t,e){const _t=precompiledValidators[$t];if(!_t)throw new DwnError(DwnErrorCode.SchemaValidatorSchemaNotFound,`schema for ${$t} not found.`);if(_t(e),!_t.errors)return;const[At]=_t.errors;let{instancePath:xt,message:kt,keyword:Bt}=At;if(xt||(xt=$t),Bt==="additionalProperties"){const Nt=At.params.additionalProperty;throw new DwnError(DwnErrorCode.SchemaValidatorAdditionalPropertyNotAllowed,`${kt}: ${xt}: ${Nt}`)}if(Bt==="unevaluatedProperties"){const Nt=At.params.unevaluatedProperty;throw new DwnError(DwnErrorCode.SchemaValidatorUnevaluatedPropertyNotAllowed,`${kt}: ${xt}: ${Nt}`)}throw new DwnError(DwnErrorCode.SchemaValidatorFailure,`${xt}: ${kt}`)}var __awaiter$2C=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class GeneralJwsVerifier{constructor(e){this.cache=e||new MemoryCache(600)}static get singleton(){return GeneralJwsVerifier._singleton===void 0&&(GeneralJwsVerifier._singleton=new GeneralJwsVerifier),GeneralJwsVerifier._singleton}static verifySignatures(e,_t){return __awaiter$2C(this,void 0,void 0,function*(){return yield GeneralJwsVerifier.singleton.verifySignatures(e,_t)})}verifySignatures(e,_t){return __awaiter$2C(this,void 0,void 0,function*(){const At=[];for(const xt of e.signatures){let kt;const Bt=Jws.getKid(xt),Nt=`${xt.protected}.${e.payload}.${xt.signature}`,Ut=yield this.cache.get(Nt);if(Ut===void 0){const jt=yield GeneralJwsVerifier.getPublicKey(Bt,_t);kt=yield Jws.verifySignature(e.payload,xt,jt),yield this.cache.set(Nt,kt)}else kt=Ut;const Lt=Jws.extractDid(Bt);if(kt)At.push(Lt);else throw new DwnError(DwnErrorCode.GeneralJwsVerifierInvalidSignature,`Signature verification failed for ${Lt}`)}return{signers:At}})}static getPublicKey(e,_t){return __awaiter$2C(this,void 0,void 0,function*(){const At=Jws.extractDid(e),{didDocument:xt}=yield _t.resolve(At),{verificationMethod:kt=[]}=xt||{};let Bt;for(const Ut of kt)if(e.endsWith(Ut.id)){Bt=Ut;break}if(!Bt)throw new DwnError(DwnErrorCode.GeneralJwsVerifierGetPublicKeyNotFound,"public key needed to verify signature not found in DID Document");validateJsonSchema("JwkVerificationMethod",Bt);const{publicKeyJwk:Nt}=Bt;return Nt})}}const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is($t){if($t===null)return"null";if($t===void 0)return"undefined";if($t===!0||$t===!1)return"boolean";const e=typeof $t;if(typeofs.includes(e))return e;if(e==="function")return"Function";if(Array.isArray($t))return"Array";if(isBuffer$1($t))return"Buffer";const _t=getObjectType($t);return _t||"Object"}function isBuffer$1($t){return $t&&$t.constructor&&$t.constructor.isBuffer&&$t.constructor.isBuffer.call(null,$t)}function getObjectType($t){const e=Object.prototype.toString.call($t).slice(8,-1);if(objectTypeNames.includes(e))return e}class Type{constructor(e,_t,At){this.major=e,this.majorEncoded=e<<5,this.name=_t,this.terminal=At}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}Type.uint=new Type(0,"uint",!0);Type.negint=new Type(1,"negint",!0);Type.bytes=new Type(2,"bytes",!0);Type.string=new Type(3,"string",!0);Type.array=new Type(4,"array",!1);Type.map=new Type(5,"map",!1);Type.tag=new Type(6,"tag",!1);Type.float=new Type(7,"float",!0);Type.false=new Type(7,"false",!0);Type.true=new Type(7,"true",!0);Type.null=new Type(7,"null",!0);Type.undefined=new Type(7,"undefined",!0);Type.break=new Type(7,"break",!0);class Token{constructor(e,_t,At){this.type=e,this.value=_t,this.encodedLength=At,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder$4=new TextDecoder,textEncoder$6=new TextEncoder;function isBuffer($t){return useBuffer&&globalThis.Buffer.isBuffer($t)}function asU8A($t){return $t instanceof Uint8Array?isBuffer($t)?new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength):$t:Uint8Array.from($t)}const toString$7=useBuffer?($t,e,_t)=>_t-e>64?globalThis.Buffer.from($t.subarray(e,_t)).toString("utf8"):utf8Slice($t,e,_t):($t,e,_t)=>_t-e>64?textDecoder$4.decode($t.subarray(e,_t)):utf8Slice($t,e,_t),fromString$2=useBuffer?$t=>$t.length>64?globalThis.Buffer.from($t):utf8ToBytes$5($t):$t=>$t.length>64?textEncoder$6.encode($t):utf8ToBytes$5($t),fromArray$1=$t=>Uint8Array.from($t),slice=useBuffer?($t,e,_t)=>isBuffer($t)?new Uint8Array($t.subarray(e,_t)):$t.slice(e,_t):($t,e,_t)=>$t.slice(e,_t),concat$1=useBuffer?($t,e)=>($t=$t.map(_t=>_t instanceof Uint8Array?_t:globalThis.Buffer.from(_t)),asU8A(globalThis.Buffer.concat($t,e))):($t,e)=>{const _t=new Uint8Array(e);let At=0;for(let xt of $t)At+xt.length>_t.length&&(xt=xt.subarray(0,_t.length-At)),_t.set(xt,At),At+=xt.length;return _t},alloc$2=useBuffer?$t=>globalThis.Buffer.allocUnsafe($t):$t=>new Uint8Array($t);function compare$1($t,e){if(isBuffer($t)&&isBuffer(e))return $t.compare(e);for(let _t=0;_t<$t.length;_t++)if($t[_t]!==e[_t])return $t[_t]<e[_t]?-1:1;return 0}function utf8ToBytes$5($t,e=1/0){let _t;const At=$t.length;let xt=null;const kt=[];for(let Bt=0;Bt<At;++Bt){if(_t=$t.charCodeAt(Bt),_t>55295&&_t<57344){if(!xt){if(_t>56319){(e-=3)>-1&&kt.push(239,191,189);continue}else if(Bt+1===At){(e-=3)>-1&&kt.push(239,191,189);continue}xt=_t;continue}if(_t<56320){(e-=3)>-1&&kt.push(239,191,189),xt=_t;continue}_t=(xt-55296<<10|_t-56320)+65536}else xt&&(e-=3)>-1&&kt.push(239,191,189);if(xt=null,_t<128){if((e-=1)<0)break;kt.push(_t)}else if(_t<2048){if((e-=2)<0)break;kt.push(_t>>6|192,_t&63|128)}else if(_t<65536){if((e-=3)<0)break;kt.push(_t>>12|224,_t>>6&63|128,_t&63|128)}else if(_t<1114112){if((e-=4)<0)break;kt.push(_t>>18|240,_t>>12&63|128,_t>>6&63|128,_t&63|128)}else throw new Error("Invalid code point")}return kt}function utf8Slice($t,e,_t){const At=[];for(;e<_t;){const xt=$t[e];let kt=null,Bt=xt>239?4:xt>223?3:xt>191?2:1;if(e+Bt<=_t){let Nt,Ut,Lt,jt;switch(Bt){case 1:xt<128&&(kt=xt);break;case 2:Nt=$t[e+1],(Nt&192)===128&&(jt=(xt&31)<<6|Nt&63,jt>127&&(kt=jt));break;case 3:Nt=$t[e+1],Ut=$t[e+2],(Nt&192)===128&&(Ut&192)===128&&(jt=(xt&15)<<12|(Nt&63)<<6|Ut&63,jt>2047&&(jt<55296||jt>57343)&&(kt=jt));break;case 4:Nt=$t[e+1],Ut=$t[e+2],Lt=$t[e+3],(Nt&192)===128&&(Ut&192)===128&&(Lt&192)===128&&(jt=(xt&15)<<18|(Nt&63)<<12|(Ut&63)<<6|Lt&63,jt>65535&&jt<1114112&&(kt=jt))}}kt===null?(kt=65533,Bt=1):kt>65535&&(kt-=65536,At.push(kt>>>10&1023|55296),kt=56320|kt&1023),At.push(kt),e+=Bt}return decodeCodePointsArray(At)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray($t){const e=$t.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,$t);let _t="",At=0;for(;At<e;)_t+=String.fromCharCode.apply(String,$t.slice(At,At+=MAX_ARGUMENTS_LENGTH));return _t}const defaultChunkSize=256;class Bl{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let _t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const xt=_t.length-(this.maxCursor-this.cursor)-1;_t.set(e,xt)}else{if(_t){const xt=_t.length-(this.maxCursor-this.cursor)-1;xt<_t.length&&(this.chunks[this.chunks.length-1]=_t.subarray(0,xt),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(_t=alloc$2(this.chunkSize),this.chunks.push(_t),this.maxCursor+=_t.length,this._initReuseChunk===null&&(this._initReuseChunk=_t),_t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let _t;if(this.chunks.length===1){const At=this.chunks[0];e&&this.cursor>At.length/2?(_t=this.cursor===At.length?At:At.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):_t=slice(At,0,this.cursor)}else _t=concat$1(this.chunks,this.cursor);return e&&this.reset(),_t}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData($t,e,_t){if($t.length-e<_t)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8($t,e,_t){assertEnoughData($t,e,1);const At=$t[e];if(_t.strict===!0&&At<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return At}function readUint16($t,e,_t){assertEnoughData($t,e,2);const At=$t[e]<<8|$t[e+1];if(_t.strict===!0&&At<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return At}function readUint32($t,e,_t){assertEnoughData($t,e,4);const At=$t[e]*16777216+($t[e+1]<<16)+($t[e+2]<<8)+$t[e+3];if(_t.strict===!0&&At<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return At}function readUint64($t,e,_t){assertEnoughData($t,e,8);const At=$t[e]*16777216+($t[e+1]<<16)+($t[e+2]<<8)+$t[e+3],xt=$t[e+4]*16777216+($t[e+5]<<16)+($t[e+6]<<8)+$t[e+7],kt=(BigInt(At)<<BigInt(32))+BigInt(xt);if(_t.strict===!0&&kt<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(kt<=Number.MAX_SAFE_INTEGER)return Number(kt);if(_t.allowBigInt===!0)return kt;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8($t,e,_t,At){return new Token(Type.uint,readUint8($t,e+1,At),2)}function decodeUint16($t,e,_t,At){return new Token(Type.uint,readUint16($t,e+1,At),3)}function decodeUint32($t,e,_t,At){return new Token(Type.uint,readUint32($t,e+1,At),5)}function decodeUint64($t,e,_t,At){return new Token(Type.uint,readUint64($t,e+1,At),9)}function encodeUint($t,e){return encodeUintValue($t,0,e.value)}function encodeUintValue($t,e,_t){if(_t<uintBoundaries[0]){const At=Number(_t);$t.push([e|At])}else if(_t<uintBoundaries[1]){const At=Number(_t);$t.push([e|24,At])}else if(_t<uintBoundaries[2]){const At=Number(_t);$t.push([e|25,At>>>8,At&255])}else if(_t<uintBoundaries[3]){const At=Number(_t);$t.push([e|26,At>>>24&255,At>>>16&255,At>>>8&255,At&255])}else{const At=BigInt(_t);if(At<uintBoundaries[4]){const xt=[e|27,0,0,0,0,0,0,0];let kt=Number(At&BigInt(4294967295)),Bt=Number(At>>BigInt(32)&BigInt(4294967295));xt[8]=kt&255,kt=kt>>8,xt[7]=kt&255,kt=kt>>8,xt[6]=kt&255,kt=kt>>8,xt[5]=kt&255,xt[4]=Bt&255,Bt=Bt>>8,xt[3]=Bt&255,Bt=Bt>>8,xt[2]=Bt&255,Bt=Bt>>8,xt[1]=Bt&255,$t.push(xt)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9};encodeUint.compareTokens=function(e,_t){return e.value<_t.value?-1:e.value>_t.value?1:0};function decodeNegint8($t,e,_t,At){return new Token(Type.negint,-1-readUint8($t,e+1,At),2)}function decodeNegint16($t,e,_t,At){return new Token(Type.negint,-1-readUint16($t,e+1,At),3)}function decodeNegint32($t,e,_t,At){return new Token(Type.negint,-1-readUint32($t,e+1,At),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64($t,e,_t,At){const xt=readUint64($t,e+1,At);if(typeof xt!="bigint"){const kt=-1-xt;if(kt>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,kt,9)}if(At.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(xt),9)}function encodeNegint($t,e){const _t=e.value,At=typeof _t=="bigint"?_t*neg1b-pos1b:_t*-1-1;encodeUintValue($t,e.type.majorEncoded,At)}encodeNegint.encodedSize=function(e){const _t=e.value,At=typeof _t=="bigint"?_t*neg1b-pos1b:_t*-1-1;return At<uintBoundaries[0]?1:At<uintBoundaries[1]?2:At<uintBoundaries[2]?3:At<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function(e,_t){return e.value<_t.value?1:e.value>_t.value?-1:0};function toToken$3($t,e,_t,At){assertEnoughData($t,e,_t+At);const xt=slice($t,e+_t,e+_t+At);return new Token(Type.bytes,xt,_t+At)}function decodeBytesCompact($t,e,_t,At){return toToken$3($t,e,1,_t)}function decodeBytes8($t,e,_t,At){return toToken$3($t,e,2,readUint8($t,e+1,At))}function decodeBytes16($t,e,_t,At){return toToken$3($t,e,3,readUint16($t,e+1,At))}function decodeBytes32($t,e,_t,At){return toToken$3($t,e,5,readUint32($t,e+1,At))}function decodeBytes64($t,e,_t,At){const xt=readUint64($t,e+1,At);if(typeof xt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3($t,e,9,xt)}function tokenBytes($t){return $t.encodedBytes===void 0&&($t.encodedBytes=$t.type===Type.string?fromString$2($t.value):$t.value),$t.encodedBytes}function encodeBytes($t,e){const _t=tokenBytes(e);encodeUintValue($t,e.type.majorEncoded,_t.length),$t.push(_t)}encodeBytes.encodedSize=function(e){const _t=tokenBytes(e);return encodeUintValue.encodedSize(_t.length)+_t.length};encodeBytes.compareTokens=function(e,_t){return compareBytes(tokenBytes(e),tokenBytes(_t))};function compareBytes($t,e){return $t.length<e.length?-1:$t.length>e.length?1:compare$1($t,e)}function toToken$2($t,e,_t,At,xt){const kt=_t+At;assertEnoughData($t,e,kt);const Bt=new Token(Type.string,toString$7($t,e+_t,e+kt),kt);return xt.retainStringBytes===!0&&(Bt.byteValue=slice($t,e+_t,e+kt)),Bt}function decodeStringCompact($t,e,_t,At){return toToken$2($t,e,1,_t,At)}function decodeString8($t,e,_t,At){return toToken$2($t,e,2,readUint8($t,e+1,At),At)}function decodeString16($t,e,_t,At){return toToken$2($t,e,3,readUint16($t,e+1,At),At)}function decodeString32($t,e,_t,At){return toToken$2($t,e,5,readUint32($t,e+1,At),At)}function decodeString64($t,e,_t,At){const xt=readUint64($t,e+1,At);if(typeof xt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2($t,e,9,xt,At)}const encodeString=encodeBytes;function toToken$1($t,e,_t,At){return new Token(Type.array,At,_t)}function decodeArrayCompact($t,e,_t,At){return toToken$1($t,e,1,_t)}function decodeArray8($t,e,_t,At){return toToken$1($t,e,2,readUint8($t,e+1,At))}function decodeArray16($t,e,_t,At){return toToken$1($t,e,3,readUint16($t,e+1,At))}function decodeArray32($t,e,_t,At){return toToken$1($t,e,5,readUint32($t,e+1,At))}function decodeArray64($t,e,_t,At){const xt=readUint64($t,e+1,At);if(typeof xt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1($t,e,9,xt)}function decodeArrayIndefinite($t,e,_t,At){if(At.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1($t,e,1,1/0)}function encodeArray($t,e){encodeUintValue($t,Type.array.majorEncoded,e.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function toToken($t,e,_t,At){return new Token(Type.map,At,_t)}function decodeMapCompact($t,e,_t,At){return toToken($t,e,1,_t)}function decodeMap8($t,e,_t,At){return toToken($t,e,2,readUint8($t,e+1,At))}function decodeMap16($t,e,_t,At){return toToken($t,e,3,readUint16($t,e+1,At))}function decodeMap32($t,e,_t,At){return toToken($t,e,5,readUint32($t,e+1,At))}function decodeMap64($t,e,_t,At){const xt=readUint64($t,e+1,At);if(typeof xt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken($t,e,9,xt)}function decodeMapIndefinite($t,e,_t,At){if(At.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken($t,e,1,1/0)}function encodeMap($t,e){encodeUintValue($t,Type.map.majorEncoded,e.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function decodeTagCompact($t,e,_t,At){return new Token(Type.tag,_t,1)}function decodeTag8($t,e,_t,At){return new Token(Type.tag,readUint8($t,e+1,At),2)}function decodeTag16($t,e,_t,At){return new Token(Type.tag,readUint16($t,e+1,At),3)}function decodeTag32($t,e,_t,At){return new Token(Type.tag,readUint32($t,e+1,At),5)}function decodeTag64($t,e,_t,At){return new Token(Type.tag,readUint64($t,e+1,At),9)}function encodeTag($t,e){encodeUintValue($t,Type.tag.majorEncoded,e.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined($t,e,_t,At){if(At.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return At.coerceUndefinedToNull===!0?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak($t,e,_t,At){if(At.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken($t,e,_t){if(_t){if(_t.allowNaN===!1&&Number.isNaN($t))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(_t.allowInfinity===!1&&($t===1/0||$t===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,$t,e)}function decodeFloat16($t,e,_t,At){return createToken(readFloat16($t,e+1),3,At)}function decodeFloat32($t,e,_t,At){return createToken(readFloat32($t,e+1),5,At)}function decodeFloat64($t,e,_t,At){return createToken(readFloat64($t,e+1),9,At)}function encodeFloat($t,e,_t){const At=e.value;if(At===!1)$t.push([Type.float.majorEncoded|MINOR_FALSE]);else if(At===!0)$t.push([Type.float.majorEncoded|MINOR_TRUE]);else if(At===null)$t.push([Type.float.majorEncoded|MINOR_NULL]);else if(At===void 0)$t.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let xt,kt=!1;(!_t||_t.float64!==!0)&&(encodeFloat16(At),xt=readFloat16(ui8a,1),At===xt||Number.isNaN(At)?(ui8a[0]=249,$t.push(ui8a.slice(0,3)),kt=!0):(encodeFloat32(At),xt=readFloat32(ui8a,1),At===xt&&(ui8a[0]=250,$t.push(ui8a.slice(0,5)),kt=!0))),kt||(encodeFloat64(At),xt=readFloat64(ui8a,1),ui8a[0]=251,$t.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,_t){const At=e.value;if(At===!1||At===!0||At===null||At===void 0)return 1;if(!_t||_t.float64!==!0){encodeFloat16(At);let xt=readFloat16(ui8a,1);if(At===xt||Number.isNaN(At))return 3;if(encodeFloat32(At),xt=readFloat32(ui8a,1),At===xt)return 5}return 9};const buffer$1=new ArrayBuffer(9),dataView=new DataView(buffer$1,1),ui8a=new Uint8Array(buffer$1,0);function encodeFloat16($t){if($t===1/0)dataView.setUint16(0,31744,!1);else if($t===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN($t))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,$t);const e=dataView.getUint32(0),_t=(e&2139095040)>>23,At=e&8388607;if(_t===255)dataView.setUint16(0,31744,!1);else if(_t===0)dataView.setUint16(0,($t&2147483648)>>16|At>>13,!1);else{const xt=_t-127;xt<-24?dataView.setUint16(0,0):xt<-14?dataView.setUint16(0,(e&2147483648)>>16|1<<24+xt,!1):dataView.setUint16(0,(e&2147483648)>>16|xt+15<<10|At>>13,!1)}}}function readFloat16($t,e){if($t.length-e<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const _t=($t[e]<<8)+$t[e+1];if(_t===31744)return 1/0;if(_t===64512)return-1/0;if(_t===32256)return NaN;const At=_t>>10&31,xt=_t&1023;let kt;return At===0?kt=xt*2**-24:At!==31?kt=(xt+1024)*2**(At-25):kt=xt===0?1/0:NaN,_t&32768?-kt:kt}function encodeFloat32($t){dataView.setFloat32(0,$t,!1)}function readFloat32($t,e){if($t.length-e<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const _t=($t.byteOffset||0)+e;return new DataView($t.buffer,_t,4).getFloat32(0,!1)}function encodeFloat64($t){dataView.setFloat64(0,$t,!1)}function readFloat64($t,e){if($t.length-e<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const _t=($t.byteOffset||0)+e;return new DataView($t.buffer,_t,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor($t,e,_t){throw new Error(`${decodeErrPrefix} encountered invalid minor (${_t}) for major ${$t[e]>>>5}`)}function errorer($t){return()=>{throw new Error(`${decodeErrPrefix} ${$t}`)}}const jump=[];for(let $t=0;$t<=23;$t++)jump[$t]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let $t=32;$t<=55;$t++)jump[$t]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let $t=64;$t<=87;$t++)jump[$t]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let $t=96;$t<=119;$t++)jump[$t]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let $t=128;$t<=151;$t++)jump[$t]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let $t=160;$t<=183;$t++)jump[$t]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let $t=192;$t<=215;$t++)jump[$t]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let $t=224;$t<=243;$t++)jump[$t]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let $t=0;$t<24;$t++)quick[$t]=new Token(Type.uint,$t,1);for(let $t=-1;$t>=-24;$t--)quick[31-$t]=new Token(Type.negint,$t,1);quick[64]=new Token(Type.bytes,new Uint8Array(0),1);quick[96]=new Token(Type.string,"",1);quick[128]=new Token(Type.array,0,1);quick[160]=new Token(Type.map,0,1);quick[244]=new Token(Type.false,!1,1);quick[245]=new Token(Type.true,!0,1);quick[246]=new Token(Type.null,null,1);function quickEncodeToken($t){switch($t.type){case Type.false:return fromArray$1([244]);case Type.true:return fromArray$1([245]);case Type.null:return fromArray$1([246]);case Type.bytes:return $t.value.length?void 0:fromArray$1([64]);case Type.string:return $t.value===""?fromArray$1([96]):void 0;case Type.array:return $t.value===0?fromArray$1([128]):void 0;case Type.map:return $t.value===0?fromArray$1([160]):void 0;case Type.uint:return $t.value<24?fromArray$1([Number($t.value)]):void 0;case Type.negint:if($t.value>=-24)return fromArray$1([31-Number($t.value)])}}const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const $t=[];return $t[Type.uint.major]=encodeUint,$t[Type.negint.major]=encodeNegint,$t[Type.bytes.major]=encodeBytes,$t[Type.string.major]=encodeString,$t[Type.array.major]=encodeArray,$t[Type.map.major]=encodeMap,$t[Type.tag.major]=encodeTag,$t[Type.float.major]=encodeFloat,$t}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(e,_t){this.obj=e,this.parent=_t}includes(e){let _t=this;do if(_t.obj===e)return!0;while(_t=_t.parent);return!1}static createCheck(e,_t){if(e&&e.includes(_t))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(_t,e)}}const simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number($t,e,_t,At){return!Number.isInteger($t)||!Number.isSafeInteger($t)?new Token(Type.float,$t):$t>=0?new Token(Type.uint,$t):new Token(Type.negint,$t)},bigint($t,e,_t,At){return $t>=BigInt(0)?new Token(Type.uint,$t):new Token(Type.negint,$t)},Uint8Array($t,e,_t,At){return new Token(Type.bytes,$t)},string($t,e,_t,At){return new Token(Type.string,$t)},boolean($t,e,_t,At){return $t?simpleTokens.true:simpleTokens.false},null($t,e,_t,At){return simpleTokens.null},undefined($t,e,_t,At){return simpleTokens.undefined},ArrayBuffer($t,e,_t,At){return new Token(Type.bytes,new Uint8Array($t))},DataView($t,e,_t,At){return new Token(Type.bytes,new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength))},Array($t,e,_t,At){if(!$t.length)return _t.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;At=Ref.createCheck(At,$t);const xt=[];let kt=0;for(const Bt of $t)xt[kt++]=objectToTokens(Bt,_t,At);return _t.addBreakTokens?[new Token(Type.array,$t.length),xt,new Token(Type.break)]:[new Token(Type.array,$t.length),xt]},Object($t,e,_t,At){const xt=e!=="Object",kt=xt?$t.keys():Object.keys($t),Bt=xt?$t.size:kt.length;if(!Bt)return _t.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;At=Ref.createCheck(At,$t);const Nt=[];let Ut=0;for(const Lt of kt)Nt[Ut++]=[objectToTokens(Lt,_t,At),objectToTokens(xt?$t.get(Lt):$t[Lt],_t,At)];return sortMapEntries(Nt,_t),_t.addBreakTokens?[new Token(Type.map,Bt),Nt,new Token(Type.break)]:[new Token(Type.map,Bt),Nt]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const $t of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${$t}Array`]=typeEncoders.DataView;function objectToTokens($t,e={},_t){const At=is($t),xt=e&&e.typeEncoders&&e.typeEncoders[At]||typeEncoders[At];if(typeof xt=="function"){const Bt=xt($t,At,e,_t);if(Bt!=null)return Bt}const kt=typeEncoders[At];if(!kt)throw new Error(`${encodeErrPrefix} unsupported type: ${At}`);return kt($t,At,e,_t)}function sortMapEntries($t,e){e.mapSorter&&$t.sort(e.mapSorter)}function mapSorter($t,e){const _t=Array.isArray($t[0])?$t[0][0]:$t[0],At=Array.isArray(e[0])?e[0][0]:e[0];if(_t.type!==At.type)return _t.type.compare(At.type);const xt=_t.type.major,kt=cborEncoders[xt].compareTokens(_t,At);return kt===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),kt}function tokensToEncoded($t,e,_t,At){if(Array.isArray(e))for(const xt of e)tokensToEncoded($t,xt,_t,At);else _t[e.type.major]($t,e,At)}function encodeCustom($t,e,_t){const At=objectToTokens($t,_t);if(!Array.isArray(At)&&_t.quickEncodeToken){const xt=_t.quickEncodeToken(At);if(xt)return xt;const kt=e[At.type.major];if(kt.encodedSize){const Bt=kt.encodedSize(At,_t),Nt=new Bl(Bt);if(kt(Nt,At,_t),Nt.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${At} was wrong`);return asU8A(Nt.chunks[0])}}return buf.reset(),tokensToEncoded(buf,At,e,_t),buf.toBytes(!0)}function encode$e($t,e){return e=Object.assign({},defaultEncodeOptions,e),encodeCustom($t,cborEncoders,e)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(e,_t={}){this.pos=0,this.data=e,this.options=_t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let _t=quick[e];if(_t===void 0){const At=jump[e];if(!At)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const xt=e&31;_t=At(this.data,this.pos,xt,this.options)}return this.pos+=_t.encodedLength,_t}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray($t,e,_t){const At=[];for(let xt=0;xt<$t.value;xt++){const kt=tokensToObject(e,_t);if(kt===BREAK){if($t.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(kt===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${xt}, expected ${$t.value})`);At[xt]=kt}return At}function tokenToMap($t,e,_t){const At=_t.useMaps===!0,xt=At?void 0:{},kt=At?new Map:void 0;for(let Bt=0;Bt<$t.value;Bt++){const Nt=tokensToObject(e,_t);if(Nt===BREAK){if($t.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(Nt===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${Bt} [no key], expected ${$t.value})`);if(At!==!0&&typeof Nt!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof Nt})`);if(_t.rejectDuplicateMapKeys===!0&&(At&&kt.has(Nt)||!At&&Nt in xt))throw new Error(`${decodeErrPrefix} found repeat map key "${Nt}"`);const Ut=tokensToObject(e,_t);if(Ut===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${Bt} [no value], expected ${$t.value})`);At?kt.set(Nt,Ut):xt[Nt]=Ut}return At?kt:xt}function tokensToObject($t,e){if($t.done())return DONE;const _t=$t.next();if(_t.type===Type.break)return BREAK;if(_t.type.terminal)return _t.value;if(_t.type===Type.array)return tokenToArray(_t,$t,e);if(_t.type===Type.map)return tokenToMap(_t,$t,e);if(_t.type===Type.tag){if(e.tags&&typeof e.tags[_t.value]=="function"){const At=tokensToObject($t,e);return e.tags[_t.value](At)}throw new Error(`${decodeErrPrefix} tag not supported (${_t.value})`)}throw new Error("unsupported")}function decode$g($t,e){if(!($t instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);e=Object.assign({},defaultDecodeOptions,e);const _t=e.tokenizer||new Tokeniser($t,e),At=tokensToObject(_t,e);if(At===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(At===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);if(!_t.done())throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return At}function base$3($t,e){if($t.length>=255)throw new TypeError("Alphabet too long");for(var _t=new Uint8Array(256),At=0;At<_t.length;At++)_t[At]=255;for(var xt=0;xt<$t.length;xt++){var kt=$t.charAt(xt),Bt=kt.charCodeAt(0);if(_t[Bt]!==255)throw new TypeError(kt+" is ambiguous");_t[Bt]=xt}var Nt=$t.length,Ut=$t.charAt(0),Lt=Math.log(Nt)/Math.log(256),jt=Math.log(256)/Math.log(Nt);function Kt(Vt){if(Vt instanceof Uint8Array||(ArrayBuffer.isView(Vt)?Vt=new Uint8Array(Vt.buffer,Vt.byteOffset,Vt.byteLength):Array.isArray(Vt)&&(Vt=Uint8Array.from(Vt))),!(Vt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Vt.length===0)return"";for(var Ht=0,Wt=0,Qt=0,Xt=Vt.length;Qt!==Xt&&Vt[Qt]===0;)Qt++,Ht++;for(var Jt=(Xt-Qt)*jt+1>>>0,tr=new Uint8Array(Jt);Qt!==Xt;){for(var dr=Vt[Qt],vr=0,$r=Jt-1;(dr!==0||vr<Wt)&&$r!==-1;$r--,vr++)dr+=256*tr[$r]>>>0,tr[$r]=dr%Nt>>>0,dr=dr/Nt>>>0;if(dr!==0)throw new Error("Non-zero carry");Wt=vr,Qt++}for(var Ir=Jt-Wt;Ir!==Jt&&tr[Ir]===0;)Ir++;for(var Rr=Ut.repeat(Ht);Ir<Jt;++Ir)Rr+=$t.charAt(tr[Ir]);return Rr}function qt(Vt){if(typeof Vt!="string")throw new TypeError("Expected String");if(Vt.length===0)return new Uint8Array;var Ht=0;if(Vt[Ht]!==" "){for(var Wt=0,Qt=0;Vt[Ht]===Ut;)Wt++,Ht++;for(var Xt=(Vt.length-Ht)*Lt+1>>>0,Jt=new Uint8Array(Xt);Vt[Ht];){var tr=_t[Vt.charCodeAt(Ht)];if(tr===255)return;for(var dr=0,vr=Xt-1;(tr!==0||dr<Qt)&&vr!==-1;vr--,dr++)tr+=Nt*Jt[vr]>>>0,Jt[vr]=tr%256>>>0,tr=tr/256>>>0;if(tr!==0)throw new Error("Non-zero carry");Qt=dr,Ht++}if(Vt[Ht]!==" "){for(var $r=Xt-Qt;$r!==Xt&&Jt[$r]===0;)$r++;for(var Ir=new Uint8Array(Wt+(Xt-$r)),Rr=Wt;$r!==Xt;)Ir[Rr++]=Jt[$r++];return Ir}}}function zt(Vt){var Ht=qt(Vt);if(Ht)return Ht;throw new Error(`Non-${e} character`)}return{encode:Kt,decodeUnsafe:qt,decode:zt}}var src$1=base$3,_brrp__multiformats_scope_baseX$1=src$1;const equals$1=($t,e)=>{if($t===e)return!0;if($t.byteLength!==e.byteLength)return!1;for(let _t=0;_t<$t.byteLength;_t++)if($t[_t]!==e[_t])return!1;return!0},coerce$1=$t=>{if($t instanceof Uint8Array&&$t.constructor.name==="Uint8Array")return $t;if($t instanceof ArrayBuffer)return new Uint8Array($t);if(ArrayBuffer.isView($t))return new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength);throw new Error("Unknown type, must be binary type")},fromString$1=$t=>new TextEncoder().encode($t),toString$6=$t=>new TextDecoder().decode($t);let Encoder$2=class{constructor(e,_t,At){this.name=e,this.prefix=_t,this.baseEncode=At}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$1=class{constructor(e,_t,At){if(this.name=e,this.prefix=_t,_t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=_t.codePointAt(0),this.baseDecode=At}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$1(this,e)}},ComposedDecoder$1=class{constructor(e){this.decoders=e}or(e){return or$1(this,e)}decode(e){const _t=e[0],At=this.decoders[_t];if(At)return At.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$1=($t,e)=>new ComposedDecoder$1({...$t.decoders||{[$t.prefix]:$t},...e.decoders||{[e.prefix]:e}});let Codec$1=class{constructor(e,_t,At,xt){this.name=e,this.prefix=_t,this.baseEncode=At,this.baseDecode=xt,this.encoder=new Encoder$2(e,_t,At),this.decoder=new Decoder$1(e,_t,xt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$6=({name:$t,prefix:e,encode:_t,decode:At})=>new Codec$1($t,e,_t,At),baseX$1=({prefix:$t,name:e,alphabet:_t})=>{const{encode:At,decode:xt}=_brrp__multiformats_scope_baseX$1(_t,e);return from$6({prefix:$t,name:e,encode:At,decode:kt=>coerce$1(xt(kt))})},decode$f=($t,e,_t,At)=>{const xt={};for(let jt=0;jt<e.length;++jt)xt[e[jt]]=jt;let kt=$t.length;for(;$t[kt-1]==="=";)--kt;const Bt=new Uint8Array(kt*_t/8|0);let Nt=0,Ut=0,Lt=0;for(let jt=0;jt<kt;++jt){const Kt=xt[$t[jt]];if(Kt===void 0)throw new SyntaxError(`Non-${At} character`);Ut=Ut<<_t|Kt,Nt+=_t,Nt>=8&&(Nt-=8,Bt[Lt++]=255&Ut>>Nt)}if(Nt>=_t||255&Ut<<8-Nt)throw new SyntaxError("Unexpected end of data");return Bt},encode$d=($t,e,_t)=>{const At=e[e.length-1]==="=",xt=(1<<_t)-1;let kt="",Bt=0,Nt=0;for(let Ut=0;Ut<$t.length;++Ut)for(Nt=Nt<<8|$t[Ut],Bt+=8;Bt>_t;)Bt-=_t,kt+=e[xt&Nt>>Bt];if(Bt&&(kt+=e[xt&Nt<<_t-Bt]),At)for(;kt.length*_t&7;)kt+="=";return kt},rfc4648$1=({name:$t,prefix:e,bitsPerChar:_t,alphabet:At})=>from$6({prefix:e,name:$t,encode(xt){return encode$d(xt,At,_t)},decode(xt){return decode$f(xt,At,_t,$t)}}),base32$1=rfc4648$1({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648$1({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648$1({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648$1({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648$1({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648$1({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648$1({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648$1({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$2=rfc4648$1({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$2=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$1,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z:base32z$2},Symbol.toStringTag,{value:"Module"})),base58btc$2=baseX$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$2,base58flickr},Symbol.toStringTag,{value:"Module"}));var encode_1$1=encode$c,MSB$3=128,REST$3=127,MSBALL$1=~REST$3,INT$1=Math.pow(2,31);function encode$c($t,e,_t){e=e||[],_t=_t||0;for(var At=_t;$t>=INT$1;)e[_t++]=$t&255|MSB$3,$t/=128;for(;$t&MSBALL$1;)e[_t++]=$t&255|MSB$3,$t>>>=7;return e[_t]=$t|0,encode$c.bytes=_t-At+1,e}var decode$e=read$2,MSB$1$1=128,REST$1$1=127;function read$2($t,At){var _t=0,At=At||0,xt=0,kt=At,Bt,Nt=$t.length;do{if(kt>=Nt)throw read$2.bytes=0,new RangeError("Could not decode varint");Bt=$t[kt++],_t+=xt<28?(Bt&REST$1$1)<<xt:(Bt&REST$1$1)*Math.pow(2,xt),xt+=7}while(Bt>=MSB$1$1);return read$2.bytes=kt-At,_t}var N1$2=Math.pow(2,7),N2$2=Math.pow(2,14),N3$2=Math.pow(2,21),N4$2=Math.pow(2,28),N5$2=Math.pow(2,35),N6$2=Math.pow(2,42),N7$2=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$2=function($t){return $t<N1$2?1:$t<N2$2?2:$t<N3$2?3:$t<N4$2?4:$t<N5$2?5:$t<N6$2?6:$t<N7$2?7:$t<N8$1?8:$t<N9$1?9:10},varint$1={encode:encode_1$1,decode:decode$e,encodingLength:length$2},_brrp_varint$1=varint$1;const decode$d=($t,e=0)=>[_brrp_varint$1.decode($t,e),_brrp_varint$1.decode.bytes],encodeTo$1=($t,e,_t=0)=>(_brrp_varint$1.encode($t,e,_t),e),encodingLength$6=$t=>_brrp_varint$1.encodingLength($t),create=($t,e)=>{const _t=e.byteLength,At=encodingLength$6($t),xt=At+encodingLength$6(_t),kt=new Uint8Array(xt+_t);return encodeTo$1($t,kt,0),encodeTo$1(_t,kt,At),kt.set(e,xt),new Digest($t,_t,e,kt)},decode$c=$t=>{const e=coerce$1($t),[_t,At]=decode$d(e),[xt,kt]=decode$d(e.subarray(At)),Bt=e.subarray(At+kt);if(Bt.byteLength!==xt)throw new Error("Incorrect length");return new Digest(_t,xt,Bt,e)},equals=($t,e)=>{if($t===e)return!0;{const _t=e;return $t.code===_t.code&&$t.size===_t.size&&_t.bytes instanceof Uint8Array&&equals$1($t.bytes,_t.bytes)}};class Digest{constructor(e,_t,At,xt){this.code=e,this.size=_t,this.digest=At,this.bytes=xt}}const format$7=($t,e)=>{const{bytes:_t,version:At}=$t;switch(At){case 0:return toStringV0$1(_t,baseCache$1($t),e||base58btc$2.encoder);default:return toStringV1$1(_t,baseCache$1($t),e||base32$1.encoder)}},cache$2=new WeakMap,baseCache$1=$t=>{const e=cache$2.get($t);if(e==null){const _t=new Map;return cache$2.set($t,_t),_t}return e};let CID$1=class ci{constructor(e,_t,At,xt){this.code=_t,this.version=e,this.multihash=At,this.bytes=xt,this["/"]=xt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:_t}=this;if(e!==DAG_PB_CODE$1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(_t.code!==SHA_256_CODE$1)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ci.createV0(_t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:_t}=this.multihash,At=create(e,_t);return ci.createV1(this.code,At)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return ci.equals(this,e)}static equals(e,_t){const At=_t;return At&&e.code===At.code&&e.version===At.version&&equals(e.multihash,At.multihash)}toString(e){return format$7(this,e)}toJSON(){return{"/":format$7(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const _t=e;if(_t instanceof ci)return _t;if(_t["/"]!=null&&_t["/"]===_t.bytes||_t.asCID===_t){const{version:At,code:xt,multihash:kt,bytes:Bt}=_t;return new ci(At,xt,kt,Bt||encodeCID$1(At,xt,kt.bytes))}else if(_t[cidSymbol$1]===!0){const{version:At,multihash:xt,code:kt}=_t,Bt=decode$c(xt);return ci.create(At,kt,Bt)}else return null}static create(e,_t,At){if(typeof _t!="number")throw new Error("String codecs are no longer supported");if(!(At.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(_t!==DAG_PB_CODE$1)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$1}) block encoding`);return new ci(e,_t,At,At.bytes)}case 1:{const xt=encodeCID$1(e,_t,At.bytes);return new ci(e,_t,At,xt)}default:throw new Error("Invalid version")}}static createV0(e){return ci.create(0,DAG_PB_CODE$1,e)}static createV1(e,_t){return ci.create(1,e,_t)}static decode(e){const[_t,At]=ci.decodeFirst(e);if(At.length)throw new Error("Incorrect length");return _t}static decodeFirst(e){const _t=ci.inspectBytes(e),At=_t.size-_t.multihashSize,xt=coerce$1(e.subarray(At,At+_t.multihashSize));if(xt.byteLength!==_t.multihashSize)throw new Error("Incorrect length");const kt=xt.subarray(_t.multihashSize-_t.digestSize),Bt=new Digest(_t.multihashCode,_t.digestSize,kt,xt);return[_t.version===0?ci.createV0(Bt):ci.createV1(_t.codec,Bt),e.subarray(_t.size)]}static inspectBytes(e){let _t=0;const At=()=>{const[Kt,qt]=decode$d(e.subarray(_t));return _t+=qt,Kt};let xt=At(),kt=DAG_PB_CODE$1;if(xt===18?(xt=0,_t=0):kt=At(),xt!==0&&xt!==1)throw new RangeError(`Invalid CID version ${xt}`);const Bt=_t,Nt=At(),Ut=At(),Lt=_t+Ut,jt=Lt-Bt;return{version:xt,codec:kt,multihashCode:Nt,digestSize:Ut,multihashSize:jt,size:Lt}}static parse(e,_t){const[At,xt]=parseCIDtoBytes$1(e,_t),kt=ci.decode(xt);if(kt.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache$1(kt).set(At,e),kt}};const parseCIDtoBytes$1=($t,e)=>{switch($t[0]){case"Q":{const _t=e||base58btc$2;return[base58btc$2.prefix,_t.decode(`${base58btc$2.prefix}${$t}`)]}case base58btc$2.prefix:{const _t=e||base58btc$2;return[base58btc$2.prefix,_t.decode($t)]}case base32$1.prefix:{const _t=e||base32$1;return[base32$1.prefix,_t.decode($t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[$t[0],e.decode($t)]}}},toStringV0$1=($t,e,_t)=>{const{prefix:At}=_t;if(At!==base58btc$2.prefix)throw Error(`Cannot string encode V0 in ${_t.name} encoding`);const xt=e.get(At);if(xt==null){const kt=_t.encode($t).slice(1);return e.set(At,kt),kt}else return xt},toStringV1$1=($t,e,_t)=>{const{prefix:At}=_t,xt=e.get(At);if(xt==null){const kt=_t.encode($t);return e.set(At,kt),kt}else return xt},DAG_PB_CODE$1=112,SHA_256_CODE$1=18,encodeCID$1=($t,e,_t)=>{const At=encodingLength$6($t),xt=At+encodingLength$6(e),kt=new Uint8Array(xt+_t.byteLength);return encodeTo$1($t,kt,0),encodeTo$1(e,kt,At),kt.set(_t,xt),kt},cidSymbol$1=Symbol.for("@ipld/js-cid/CID"),CID_CBOR_TAG=42;function cidEncoder($t){if($t.asCID!==$t&&$t["/"]!==$t.bytes)return null;const e=CID$1.asCID($t);if(!e)return null;const _t=new Uint8Array(e.bytes.byteLength+1);return _t.set(e.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,_t)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder($t){if(Number.isNaN($t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if($t===1/0||$t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}};function cidDecoder($t){if($t[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID$1.decode($t.subarray(1))}const decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const name$5="dag-cbor",code$5=113,encode$b=$t=>encode$e($t,encodeOptions),decode$b=$t=>decode$g($t,decodeOptions),cbor=Object.freeze(Object.defineProperty({__proto__:null,code:code$5,decode:decode$b,encode:encode$b,name:name$5},Symbol.toStringTag,{value:"Module"})),base58btc$1=baseX$3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});baseX$3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const base32=rfc4648$3({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});rfc4648$3({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});rfc4648$3({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});rfc4648$3({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});rfc4648$3({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});rfc4648$3({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});rfc4648$3({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});rfc4648$3({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const base32z$1=rfc4648$3({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),format$6=($t,e)=>{const{bytes:_t,version:At}=$t;switch(At){case 0:return toStringV0(_t,baseCache($t),e||base58btc$1.encoder);default:return toStringV1(_t,baseCache($t),e||base32.encoder)}},cache$1=new WeakMap,baseCache=$t=>{const e=cache$1.get($t);if(e==null){const _t=new Map;return cache$1.set($t,_t),_t}return e};class CID{constructor(e,_t,At,xt){this.code=_t,this.version=e,this.multihash=At,this.bytes=xt,this["/"]=xt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:_t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(_t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(_t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:_t}=this.multihash,At=create$2(e,_t);return CID.createV1(this.code,At)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return CID.equals(this,e)}static equals(e,_t){const At=_t;return At&&e.code===At.code&&e.version===At.version&&equals$5(e.multihash,At.multihash)}toString(e){return format$6(this,e)}toJSON(){return{"/":format$6(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const _t=e;if(_t instanceof CID)return _t;if(_t["/"]!=null&&_t["/"]===_t.bytes||_t.asCID===_t){const{version:At,code:xt,multihash:kt,bytes:Bt}=_t;return new CID(At,xt,kt,Bt||encodeCID(At,xt,kt.bytes))}else if(_t[cidSymbol]===!0){const{version:At,multihash:xt,code:kt}=_t,Bt=decode$m(xt);return CID.create(At,kt,Bt)}else return null}static create(e,_t,At){if(typeof _t!="number")throw new Error("String codecs are no longer supported");if(!(At.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(_t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(e,_t,At,At.bytes)}case 1:{const xt=encodeCID(e,_t,At.bytes);return new CID(e,_t,At,xt)}default:throw new Error("Invalid version")}}static createV0(e){return CID.create(0,DAG_PB_CODE,e)}static createV1(e,_t){return CID.create(1,e,_t)}static decode(e){const[_t,At]=CID.decodeFirst(e);if(At.length)throw new Error("Incorrect length");return _t}static decodeFirst(e){const _t=CID.inspectBytes(e),At=_t.size-_t.multihashSize,xt=coerce$3(e.subarray(At,At+_t.multihashSize));if(xt.byteLength!==_t.multihashSize)throw new Error("Incorrect length");const kt=xt.subarray(_t.multihashSize-_t.digestSize),Bt=new Digest$2(_t.multihashCode,_t.digestSize,kt,xt);return[_t.version===0?CID.createV0(Bt):CID.createV1(_t.codec,Bt),e.subarray(_t.size)]}static inspectBytes(e){let _t=0;const At=()=>{const[Kt,qt]=decode$n(e.subarray(_t));return _t+=qt,Kt};let xt=At(),kt=DAG_PB_CODE;if(xt===18?(xt=0,_t=0):kt=At(),xt!==0&&xt!==1)throw new RangeError(`Invalid CID version ${xt}`);const Bt=_t,Nt=At(),Ut=At(),Lt=_t+Ut,jt=Lt-Bt;return{version:xt,codec:kt,multihashCode:Nt,digestSize:Ut,multihashSize:jt,size:Lt}}static parse(e,_t){const[At,xt]=parseCIDtoBytes(e,_t),kt=CID.decode(xt);if(kt.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(kt).set(At,e),kt}}const parseCIDtoBytes=($t,e)=>{switch($t[0]){case"Q":{const _t=e||base58btc$1;return[base58btc$1.prefix,_t.decode(`${base58btc$1.prefix}${$t}`)]}case base58btc$1.prefix:{const _t=e||base58btc$1;return[base58btc$1.prefix,_t.decode($t)]}case base32.prefix:{const _t=e||base32;return[base32.prefix,_t.decode($t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[$t[0],e.decode($t)]}}},toStringV0=($t,e,_t)=>{const{prefix:At}=_t;if(At!==base58btc$1.prefix)throw Error(`Cannot string encode V0 in ${_t.name} encoding`);const xt=e.get(At);if(xt==null){const kt=_t.encode($t).slice(1);return e.set(At,kt),kt}else return xt},toStringV1=($t,e,_t)=>{const{prefix:At}=_t,xt=e.get(At);if(xt==null){const kt=_t.encode($t);return e.set(At,kt),kt}else return xt},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=($t,e,_t)=>{const At=encodingLength$8($t),xt=At+encodingLength$8(e),kt=new Uint8Array(xt+_t.byteLength);return encodeTo$3($t,kt,0),encodeTo$3(e,kt,At),kt.set(_t,xt),kt},cidSymbol=Symbol.for("@ipld/js-cid/CID");var __awaiter$2B=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$9=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}},__await$5=function($t){return this instanceof __await$5?(this.v=$t,this):new __await$5($t)},__asyncGenerator$4=function($t,e,_t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var At=_t.apply($t,e||[]),xt,kt=[];return xt={},Bt("next"),Bt("throw"),Bt("return"),xt[Symbol.asyncIterator]=function(){return this},xt;function Bt(qt){At[qt]&&(xt[qt]=function(zt){return new Promise(function(Vt,Ht){kt.push([qt,zt,Vt,Ht])>1||Nt(qt,zt)})})}function Nt(qt,zt){try{Ut(At[qt](zt))}catch(Vt){Kt(kt[0][3],Vt)}}function Ut(qt){qt.value instanceof __await$5?Promise.resolve(qt.value.v).then(Lt,jt):Kt(kt[0][2],qt)}function Lt(qt){Nt("next",qt)}function jt(qt){Nt("throw",qt)}function Kt(qt,zt){qt(zt),kt.shift(),kt.length&&Nt(kt[0][0],kt[0][1])}};class BlockstoreMock{open(){return __awaiter$2B(this,void 0,void 0,function*(){})}close(){return __awaiter$2B(this,void 0,void 0,function*(){})}put(e,_t,At){return __awaiter$2B(this,void 0,void 0,function*(){return e})}get(e,_t){return __awaiter$2B(this,void 0,void 0,function*(){return new Uint8Array})}has(e,_t){return __awaiter$2B(this,void 0,void 0,function*(){return!1})}delete(e,_t){return __awaiter$2B(this,void 0,void 0,function*(){})}isEmpty(e){return __awaiter$2B(this,void 0,void 0,function*(){return!0})}putMany(e,_t){return __asyncGenerator$4(this,arguments,function*(){var xt,kt,Bt,Nt;try{for(var Ut=!0,Lt=__asyncValues$9(e),jt;jt=yield __await$5(Lt.next()),xt=jt.done,!xt;Ut=!0){Nt=jt.value,Ut=!1;const Kt=Nt;yield __await$5(this.put(Kt.cid,Kt.block,_t)),yield yield __await$5(Kt.cid)}}catch(Kt){kt={error:Kt}}finally{try{!Ut&&!xt&&(Bt=Lt.return)&&(yield __await$5(Bt.call(Lt)))}finally{if(kt)throw kt.error}}})}getMany(e,_t){return __asyncGenerator$4(this,arguments,function*(){var xt,kt,Bt,Nt;try{for(var Ut=!0,Lt=__asyncValues$9(e),jt;jt=yield __await$5(Lt.next()),xt=jt.done,!xt;Ut=!0){Nt=jt.value,Ut=!1;const Kt=Nt;yield yield __await$5({cid:Kt,block:yield __await$5(this.get(Kt,_t))})}}catch(Kt){kt={error:Kt}}finally{try{!Ut&&!xt&&(Bt=Lt.return)&&(yield __await$5(Bt.call(Lt)))}finally{if(kt)throw kt.error}}})}getAll(e){return __asyncGenerator$4(this,arguments,function*(){var At,xt,kt,Bt;const Nt=this.db.iterator({keys:!0,keyEncoding:"buffer"},e);try{for(var Ut=!0,Lt=__asyncValues$9(Nt),jt;jt=yield __await$5(Lt.next()),At=jt.done,!At;Ut=!0){Bt=jt.value,Ut=!1;const[Kt,qt]=Bt;yield yield __await$5({cid:CID.decode(Kt),block:qt})}}catch(Kt){xt={error:Kt}}finally{try{!Ut&&!At&&(kt=Lt.return)&&(yield __await$5(kt.call(Lt)))}finally{if(xt)throw xt.error}}})}deleteMany(e,_t){return __asyncGenerator$4(this,arguments,function*(){var xt,kt,Bt,Nt;try{for(var Ut=!0,Lt=__asyncValues$9(e),jt;jt=yield __await$5(Lt.next()),xt=jt.done,!xt;Ut=!0){Nt=jt.value,Ut=!1;const Kt=Nt;yield __await$5(this.delete(Kt,_t)),yield yield __await$5(Kt)}}catch(Kt){kt={error:Kt}}finally{try{!Ut&&!xt&&(Bt=Lt.return)&&(yield __await$5(Bt.call(Lt)))}finally{if(kt)throw kt.error}}})}clear(){return __awaiter$2B(this,void 0,void 0,function*(){})}}function assign($t,e){for(const _t in e)Object.defineProperty($t,_t,{value:e[_t],enumerable:!0,configurable:!0});return $t}function createError($t,e,_t){if(!$t||typeof $t=="string")throw new TypeError("Please pass an Error to err-code");_t||(_t={}),typeof e=="object"&&(_t=e,e=""),e&&(_t.code=e);try{return assign($t,_t)}catch{_t.message=$t.message,_t.stack=$t.stack;const xt=function(){};return xt.prototype=Object.create(Object.getPrototypeOf($t)),assign(new xt,_t)}}var errCode=createError;const errCode$1=getDefaultExportFromCjs(errCode);function isAsyncIterable$8($t){return $t[Symbol.asyncIterator]!=null}function batch($t,e=1){return e=Number(e),isAsyncIterable$8($t)?async function*(){let _t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for await(const At of $t)for(_t.push(At);_t.length>=e;)yield _t.slice(0,e),_t=_t.slice(e);for(;_t.length>0;)yield _t.slice(0,e),_t=_t.slice(e)}():function*(){let _t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for(const At of $t)for(_t.push(At);_t.length>=e;)yield _t.slice(0,e),_t=_t.slice(e);for(;_t.length>0;)yield _t.slice(0,e),_t=_t.slice(e)}()}async function*parallelBatch($t,e=1){for await(const _t of batch($t,e)){const At=_t.map(async xt=>xt().then(kt=>({ok:!0,value:kt}),kt=>({ok:!1,err:kt})));for(let xt=0;xt<At.length;xt++){const kt=await At[xt];if(kt.ok)yield kt.value;else throw kt.err}}}const symbol=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset($t,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let _t=0;for(const At of $t){const xt=_t+At.byteLength;if(e<xt)return{buf:At,index:e-_t};_t=xt}throw new RangeError("index is out of bounds")}function isUint8ArrayList($t){return!!($t!=null&&$t[symbol])}var Lo;class Uint8ArrayList{constructor(...e){sn(this,"bufs");sn(this,"length");sn(this,Lo,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(Lo=symbol,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let _t=0;for(const At of e)if(At instanceof Uint8Array)_t+=At.byteLength,this.bufs.push(At);else if(isUint8ArrayList(At))_t+=At.byteLength,this.bufs.push(...At.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=_t}prepend(...e){this.prependAll(e)}prependAll(e){let _t=0;for(const At of e.reverse())if(At instanceof Uint8Array)_t+=At.byteLength,this.bufs.unshift(At);else if(isUint8ArrayList(At))_t+=At.byteLength,this.bufs.unshift(...At.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=_t}get(e){const _t=findBufAndOffset(this.bufs,e);return _t.buf[_t.index]}set(e,_t){const At=findBufAndOffset(this.bufs,e);At.buf[At.index]=_t}write(e,_t=0){if(e instanceof Uint8Array)for(let At=0;At<e.length;At++)this.set(_t+At,e[At]);else if(isUint8ArrayList(e))for(let At=0;At<e.length;At++)this.set(_t+At,e.get(At));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,_t){const{bufs:At,length:xt}=this._subList(e,_t);return concat$2(At,xt)}subarray(e,_t){const{bufs:At,length:xt}=this._subList(e,_t);return At.length===1?At[0]:concat$2(At,xt)}sublist(e,_t){const{bufs:At,length:xt}=this._subList(e,_t),kt=new Uint8ArrayList;return kt.length=xt,kt.bufs=[...At],kt}_subList(e,_t){if(e=e??0,_t=_t??this.length,e<0&&(e=this.length+e),_t<0&&(_t=this.length+_t),e<0||_t>this.length)throw new RangeError("index is out of bounds");if(e===_t)return{bufs:[],length:0};if(e===0&&_t===this.length)return{bufs:this.bufs,length:this.length};const At=[];let xt=0;for(let kt=0;kt<this.bufs.length;kt++){const Bt=this.bufs[kt],Nt=xt,Ut=Nt+Bt.byteLength;if(xt=Ut,e>=Ut)continue;const Lt=e>=Nt&&e<Ut,jt=_t>Nt&&_t<=Ut;if(Lt&&jt){if(e===Nt&&_t===Ut){At.push(Bt);break}const Kt=e-Nt;At.push(Bt.subarray(Kt,Kt+(_t-e)));break}if(Lt){if(e===0){At.push(Bt);continue}At.push(Bt.subarray(e-Nt));continue}if(jt){if(_t===Ut){At.push(Bt);break}At.push(Bt.subarray(0,_t-Nt));break}At.push(Bt)}return{bufs:At,length:_t-e}}indexOf(e,_t=0){if(!isUint8ArrayList(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const At=e instanceof Uint8Array?e:e.subarray();if(_t=Number(_t??0),isNaN(_t)&&(_t=0),_t<0&&(_t=this.length+_t),_t<0&&(_t=0),e.length===0)return _t>this.length?this.length:_t;const xt=At.byteLength;if(xt===0)throw new TypeError("search must be at least 1 byte long");const kt=256,Bt=new Int32Array(kt);for(let Kt=0;Kt<kt;Kt++)Bt[Kt]=-1;for(let Kt=0;Kt<xt;Kt++)Bt[At[Kt]]=Kt;const Nt=Bt,Ut=this.byteLength-At.byteLength,Lt=At.byteLength-1;let jt;for(let Kt=_t;Kt<=Ut;Kt+=jt){jt=0;for(let qt=Lt;qt>=0;qt--){const zt=this.get(Kt+qt);if(At[qt]!==zt){jt=Math.max(1,qt-Nt[zt]);break}}if(jt===0)return Kt}return-1}getInt8(e){const _t=this.subarray(e,e+1);return new DataView(_t.buffer,_t.byteOffset,_t.byteLength).getInt8(0)}setInt8(e,_t){const At=allocUnsafe$1(1);new DataView(At.buffer,At.byteOffset,At.byteLength).setInt8(0,_t),this.write(At,e)}getInt16(e,_t){const At=this.subarray(e,e+2);return new DataView(At.buffer,At.byteOffset,At.byteLength).getInt16(0,_t)}setInt16(e,_t,At){const xt=alloc$3(2);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setInt16(0,_t,At),this.write(xt,e)}getInt32(e,_t){const At=this.subarray(e,e+4);return new DataView(At.buffer,At.byteOffset,At.byteLength).getInt32(0,_t)}setInt32(e,_t,At){const xt=alloc$3(4);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setInt32(0,_t,At),this.write(xt,e)}getBigInt64(e,_t){const At=this.subarray(e,e+8);return new DataView(At.buffer,At.byteOffset,At.byteLength).getBigInt64(0,_t)}setBigInt64(e,_t,At){const xt=alloc$3(8);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setBigInt64(0,_t,At),this.write(xt,e)}getUint8(e){const _t=this.subarray(e,e+1);return new DataView(_t.buffer,_t.byteOffset,_t.byteLength).getUint8(0)}setUint8(e,_t){const At=allocUnsafe$1(1);new DataView(At.buffer,At.byteOffset,At.byteLength).setUint8(0,_t),this.write(At,e)}getUint16(e,_t){const At=this.subarray(e,e+2);return new DataView(At.buffer,At.byteOffset,At.byteLength).getUint16(0,_t)}setUint16(e,_t,At){const xt=alloc$3(2);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setUint16(0,_t,At),this.write(xt,e)}getUint32(e,_t){const At=this.subarray(e,e+4);return new DataView(At.buffer,At.byteOffset,At.byteLength).getUint32(0,_t)}setUint32(e,_t,At){const xt=alloc$3(4);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setUint32(0,_t,At),this.write(xt,e)}getBigUint64(e,_t){const At=this.subarray(e,e+8);return new DataView(At.buffer,At.byteOffset,At.byteLength).getBigUint64(0,_t)}setBigUint64(e,_t,At){const xt=alloc$3(8);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setBigUint64(0,_t,At),this.write(xt,e)}getFloat32(e,_t){const At=this.subarray(e,e+4);return new DataView(At.buffer,At.byteOffset,At.byteLength).getFloat32(0,_t)}setFloat32(e,_t,At){const xt=alloc$3(4);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setFloat32(0,_t,At),this.write(xt,e)}getFloat64(e,_t){const At=this.subarray(e,e+8);return new DataView(At.buffer,At.byteOffset,At.byteLength).getFloat64(0,_t)}setFloat64(e,_t,At){const xt=alloc$3(8);new DataView(xt.buffer,xt.byteOffset,xt.byteLength).setFloat64(0,_t,At),this.write(xt,e)}equals(e){if(e==null||!(e instanceof Uint8ArrayList)||e.bufs.length!==this.bufs.length)return!1;for(let _t=0;_t<this.bufs.length;_t++)if(!equals$4(this.bufs[_t],e.bufs[_t]))return!1;return!0}static fromUint8Arrays(e,_t){const At=new Uint8ArrayList;return At.bufs=e,_t==null&&(_t=e.reduce((xt,kt)=>xt+kt.byteLength,0)),At.length=_t,At}}const DEFAULT_CHUNK_SIZE=262144,fixedSize=($t={})=>{const e=$t.chunkSize??DEFAULT_CHUNK_SIZE;return async function*(At){let xt=new Uint8ArrayList,kt=0,Bt=!1;for await(const Nt of At)for(xt.append(Nt),kt+=Nt.length;kt>=e;)if(yield xt.slice(0,e),Bt=!0,e===xt.length)xt=new Uint8ArrayList,kt=0;else{const Ut=new Uint8ArrayList;Ut.append(xt.sublist(e)),xt=Ut,kt-=e}(!Bt||kt>0)&&(yield xt.subarray(0,kt))}},textDecoder$3=new TextDecoder;function decodeVarint($t,e){let _t=0;for(let At=0;;At+=7){if(At>=64)throw new Error("protobuf: varint overflow");if(e>=$t.length)throw new Error("protobuf: unexpected end of data");const xt=$t[e++];if(_t+=At<28?(xt&127)<<At:(xt&127)*2**At,xt<128)break}return[_t,e]}function decodeBytes($t,e){let _t;[_t,e]=decodeVarint($t,e);const At=e+_t;if(_t<0||At<0)throw new Error("protobuf: invalid length");if(At>$t.length)throw new Error("protobuf: unexpected end of data");return[$t.subarray(e,At),At]}function decodeKey($t,e){let _t;return[_t,e]=decodeVarint($t,e),[_t&7,_t>>3,e]}function decodeLink($t){const e={},_t=$t.length;let At=0;for(;At<_t;){let xt,kt;if([xt,kt,At]=decodeKey($t,At),kt===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(xt!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${xt}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,At]=decodeBytes($t,At)}else if(kt===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(xt!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${xt}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let Bt;[Bt,At]=decodeBytes($t,At),e.Name=textDecoder$3.decode(Bt)}else if(kt===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(xt!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${xt}) for Tsize`);[e.Tsize,At]=decodeVarint($t,At)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${kt}`)}if(At>_t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function decodeNode($t){const e=$t.length;let _t=0,At,xt=!1,kt;for(;_t<e;){let Nt,Ut;if([Nt,Ut,_t]=decodeKey($t,_t),Nt!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${Nt}`);if(Ut===1){if(kt)throw new Error("protobuf: (PBNode) duplicate Data section");[kt,_t]=decodeBytes($t,_t),At&&(xt=!0)}else if(Ut===2){if(xt)throw new Error("protobuf: (PBNode) duplicate Links section");At||(At=[]);let Lt;[Lt,_t]=decodeBytes($t,_t),At.push(decodeLink(Lt))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${Ut}`)}if(_t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const Bt={};return kt&&(Bt.Data=kt),Bt.Links=At||[],Bt}const textEncoder$5=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink($t,e){let _t=e.length;if(typeof $t.Tsize=="number"){if($t.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger($t.Tsize))throw new Error("Tsize too large for encoding");_t=encodeVarint(e,_t,$t.Tsize)-1,e[_t]=24}if(typeof $t.Name=="string"){const At=textEncoder$5.encode($t.Name);_t-=At.length,e.set(At,_t),_t=encodeVarint(e,_t,At.length)-1,e[_t]=18}return $t.Hash&&(_t-=$t.Hash.length,e.set($t.Hash,_t),_t=encodeVarint(e,_t,$t.Hash.length)-1,e[_t]=10),e.length-_t}function encodeNode($t){const e=sizeNode($t),_t=new Uint8Array(e);let At=e;if($t.Data&&(At-=$t.Data.length,_t.set($t.Data,At),At=encodeVarint(_t,At,$t.Data.length)-1,_t[At]=10),$t.Links)for(let xt=$t.Links.length-1;xt>=0;xt--){const kt=encodeLink($t.Links[xt],_t.subarray(0,At));At-=kt,At=encodeVarint(_t,At,kt)-1,_t[At]=18}return _t}function sizeLink($t){let e=0;if($t.Hash){const _t=$t.Hash.length;e+=1+_t+sov(_t)}if(typeof $t.Name=="string"){const _t=textEncoder$5.encode($t.Name).length;e+=1+_t+sov(_t)}return typeof $t.Tsize=="number"&&(e+=1+sov($t.Tsize)),e}function sizeNode($t){let e=0;if($t.Data){const _t=$t.Data.length;e+=1+_t+sov(_t)}if($t.Links)for(const _t of $t.Links){const At=sizeLink(_t);e+=1+At+sov(At)}return e}function encodeVarint($t,e,_t){e-=sov(_t);const At=e;for(;_t>=maxUInt32;)$t[e++]=_t&127|128,_t/=128;for(;_t>=128;)$t[e++]=_t&127|128,_t>>>=7;return $t[e]=_t,At}function sov($t){return $t%2===0&&$t++,Math.floor((len64($t)+6)/7)}function len64($t){let e=0;return $t>=maxInt32&&($t=Math.floor($t/maxInt32),e=32),$t>=65536&&($t>>>=16,e+=16),$t>=256&&($t>>>=8,e+=8),e+len8tab[$t]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder$4=new TextEncoder;function linkComparator($t,e){if($t===e)return 0;const _t=$t.Name?textEncoder$4.encode($t.Name):[],At=e.Name?textEncoder$4.encode(e.Name):[];let xt=_t.length,kt=At.length;for(let Bt=0,Nt=Math.min(xt,kt);Bt<Nt;++Bt)if(_t[Bt]!==At[Bt]){xt=_t[Bt],kt=At[Bt];break}return xt<kt?-1:kt<xt?1:0}function hasOnlyProperties($t,e){return!Object.keys($t).some(_t=>!e.includes(_t))}function asLink($t){if(typeof $t.asCID=="object"){const _t=CID$2.asCID($t);if(!_t)throw new TypeError("Invalid DAG-PB form");return{Hash:_t}}if(typeof $t!="object"||Array.isArray($t))throw new TypeError("Invalid DAG-PB form");const e={};if($t.Hash){let _t=CID$2.asCID($t.Hash);try{_t||(typeof $t.Hash=="string"?_t=CID$2.parse($t.Hash):$t.Hash instanceof Uint8Array&&(_t=CID$2.decode($t.Hash)))}catch(At){throw new TypeError(`Invalid DAG-PB form: ${At.message}`)}_t&&(e.Hash=_t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof $t.Name=="string"&&(e.Name=$t.Name),typeof $t.Tsize=="number"&&(e.Tsize=$t.Tsize),e}function prepare($t){if(($t instanceof Uint8Array||typeof $t=="string")&&($t={Data:$t}),typeof $t!="object"||Array.isArray($t))throw new TypeError("Invalid DAG-PB form");const e={};if($t.Data!==void 0)if(typeof $t.Data=="string")e.Data=textEncoder$4.encode($t.Data);else if($t.Data instanceof Uint8Array)e.Data=$t.Data;else throw new TypeError("Invalid DAG-PB form");if($t.Links!==void 0)if(Array.isArray($t.Links))e.Links=$t.Links.map(asLink),e.Links.sort(linkComparator);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function validate$1($t){if(!$t||typeof $t!="object"||Array.isArray($t)||$t instanceof Uint8Array||$t["/"]&&$t["/"]===$t.bytes)throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties($t,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if($t.Data!==void 0&&!($t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray($t.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<$t.Links.length;e++){const _t=$t.Links[e];if(!_t||typeof _t!="object"||Array.isArray(_t)||_t instanceof Uint8Array||_t["/"]&&_t["/"]===_t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!hasOnlyProperties(_t,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(_t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(_t.Hash==null||!_t.Hash["/"]||_t.Hash["/"]!==_t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(_t.Name!==void 0&&typeof _t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(_t.Tsize!==void 0){if(typeof _t.Tsize!="number"||_t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(_t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&linkComparator(_t,$t.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode($t,e=[]){return prepare({Data:$t,Links:e})}function createLink($t,e,_t){return asLink({Hash:_t,Name:$t,Tsize:e})}function toByteView($t){return $t instanceof ArrayBuffer?new Uint8Array($t,0,$t.byteLength):$t}const name$4="dag-pb",code$4=112;function encode$a($t){validate$1($t);const e={};return $t.Links&&(e.Links=$t.Links.map(_t=>{const At={};return _t.Hash&&(At.Hash=_t.Hash.bytes),_t.Name!==void 0&&(At.Name=_t.Name),_t.Tsize!==void 0&&(At.Tsize=_t.Tsize),At})),$t.Data&&(e.Data=$t.Data),encodeNode(e)}function decode$a($t){const e=toByteView($t),_t=decodeNode(e),At={};return _t.Data&&(At.Data=_t.Data),_t.Links&&(At.Links=_t.Links.map(xt=>{const kt={};try{kt.Hash=CID$2.decode(xt.Hash)}catch{}if(!kt.Hash)throw new Error("Invalid Hash field found in link, expected CID");return xt.Name!==void 0&&(kt.Name=xt.Name),xt.Tsize!==void 0&&(kt.Tsize=xt.Tsize),kt})),At}const dagPb=Object.freeze(Object.defineProperty({__proto__:null,code:code$4,createLink,createNode,decode:decode$a,encode:encode$a,name:name$4,prepare,validate:validate$1},Symbol.toStringTag,{value:"Module"})),N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),MSB$2=128,REST$2=127;function encodingLength$5($t){if($t<N1$1)return 1;if($t<N2$1)return 2;if($t<N3$1)return 3;if($t<N4$1)return 4;if($t<N5$1)return 5;if($t<N6$1)return 6;if($t<N7$1)return 7;if(Number.MAX_SAFE_INTEGER!=null&&$t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array($t,e,_t=0){switch(encodingLength$5($t)){case 8:e[_t++]=$t&255|MSB$2,$t/=128;case 7:e[_t++]=$t&255|MSB$2,$t/=128;case 6:e[_t++]=$t&255|MSB$2,$t/=128;case 5:e[_t++]=$t&255|MSB$2,$t/=128;case 4:e[_t++]=$t&255|MSB$2,$t>>>=7;case 3:e[_t++]=$t&255|MSB$2,$t>>>=7;case 2:e[_t++]=$t&255|MSB$2,$t>>>=7;case 1:{e[_t++]=$t&255,$t>>>=7;break}default:throw new Error("unreachable")}return e}function decodeUint8Array($t,e){let _t=$t[e],At=0;if(At+=_t&REST$2,_t<MSB$2||(_t=$t[e+1],At+=(_t&REST$2)<<7,_t<MSB$2)||(_t=$t[e+2],At+=(_t&REST$2)<<14,_t<MSB$2)||(_t=$t[e+3],At+=(_t&REST$2)<<21,_t<MSB$2)||(_t=$t[e+4],At+=(_t&REST$2)*N4$1,_t<MSB$2)||(_t=$t[e+5],At+=(_t&REST$2)*N5$1,_t<MSB$2)||(_t=$t[e+6],At+=(_t&REST$2)*N6$1,_t<MSB$2)||(_t=$t[e+7],At+=(_t&REST$2)*N7$1,_t<MSB$2))return At;throw new RangeError("Could not decode varint")}const f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE($t,e,_t){f32[0]=$t,e[_t]=f8b[0],e[_t+1]=f8b[1],e[_t+2]=f8b[2],e[_t+3]=f8b[3]}function readFloatLE($t,e){return f8b[0]=$t[e],f8b[1]=$t[e+1],f8b[2]=$t[e+2],f8b[3]=$t[e+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE($t,e,_t){f64[0]=$t,e[_t]=d8b[0],e[_t+1]=d8b[1],e[_t+2]=d8b[2],e[_t+3]=d8b[3],e[_t+4]=d8b[4],e[_t+5]=d8b[5],e[_t+6]=d8b[6],e[_t+7]=d8b[7]}function readDoubleLE($t,e){return d8b[0]=$t[e],d8b[1]=$t[e+1],d8b[2]=$t[e+2],d8b[3]=$t[e+3],d8b[4]=$t[e+4],d8b[5]=$t[e+5],d8b[6]=$t[e+6],d8b[7]=$t[e+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{constructor(e,_t){sn(this,"lo");sn(this,"hi");this.lo=e|0,this.hi=_t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const _t=~this.lo+1>>>0;let At=~this.hi>>>0;return _t===0&&(At=At+1>>>0),-(_t+At*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const _t=~this.lo+1>>>0;let At=~this.hi>>>0;return _t===0&&(At=At+1>>>0),-(BigInt(_t)+(BigInt(At)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,_t=(this.lo>>>28|this.hi<<4)>>>0,At=this.hi>>>24;return At===0?_t===0?e<16384?e<128?1:2:e<2097152?3:4:_t<16384?_t<128?5:6:_t<2097152?7:8:At<128?9:10}static fromBigInt(e){if(e===0n)return zero;if(e<MAX_SAFE_NUMBER_INTEGER&&e>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(e));const _t=e<0n;_t&&(e=-e);let At=e>>32n,xt=e-(At<<32n);return _t&&(At=~At|0n,xt=~xt|0n,++xt>TWO_32&&(xt=0n,++At>TWO_32&&(At=0n))),new LongBits(Number(xt),Number(At))}static fromNumber(e){if(e===0)return zero;const _t=e<0;_t&&(e=-e);let At=e>>>0,xt=(e-At)/4294967296>>>0;return _t&&(xt=~xt>>>0,At=~At>>>0,++At>4294967295&&(At=0,++xt>4294967295&&(xt=0))),new LongBits(At,xt)}static from(e){return typeof e=="number"?LongBits.fromNumber(e):typeof e=="bigint"?LongBits.fromBigInt(e):typeof e=="string"?LongBits.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new LongBits(e.low>>>0,e.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length$1($t){let e=0,_t=0;for(let At=0;At<$t.length;++At)_t=$t.charCodeAt(At),_t<128?e+=1:_t<2048?e+=2:(_t&64512)===55296&&($t.charCodeAt(At+1)&64512)===56320?(++At,e+=4):e+=3;return e}function read$1($t,e,_t){if(_t-e<1)return"";let xt;const kt=[];let Bt=0,Nt;for(;e<_t;)Nt=$t[e++],Nt<128?kt[Bt++]=Nt:Nt>191&&Nt<224?kt[Bt++]=(Nt&31)<<6|$t[e++]&63:Nt>239&&Nt<365?(Nt=((Nt&7)<<18|($t[e++]&63)<<12|($t[e++]&63)<<6|$t[e++]&63)-65536,kt[Bt++]=55296+(Nt>>10),kt[Bt++]=56320+(Nt&1023)):kt[Bt++]=(Nt&15)<<12|($t[e++]&63)<<6|$t[e++]&63,Bt>8191&&((xt??(xt=[])).push(String.fromCharCode.apply(String,kt)),Bt=0);return xt!=null?(Bt>0&&xt.push(String.fromCharCode.apply(String,kt.slice(0,Bt))),xt.join("")):String.fromCharCode.apply(String,kt.slice(0,Bt))}function write$1($t,e,_t){const At=_t;let xt,kt;for(let Bt=0;Bt<$t.length;++Bt)xt=$t.charCodeAt(Bt),xt<128?e[_t++]=xt:xt<2048?(e[_t++]=xt>>6|192,e[_t++]=xt&63|128):(xt&64512)===55296&&((kt=$t.charCodeAt(Bt+1))&64512)===56320?(xt=65536+((xt&1023)<<10)+(kt&1023),++Bt,e[_t++]=xt>>18|240,e[_t++]=xt>>12&63|128,e[_t++]=xt>>6&63|128,e[_t++]=xt&63|128):(e[_t++]=xt>>12|224,e[_t++]=xt>>6&63|128,e[_t++]=xt&63|128);return _t-At}function indexOutOfRange($t,e){return RangeError(`index out of range: ${$t.pos} + ${e??1} > ${$t.len}`)}function readFixed32End($t,e){return($t[e-4]|$t[e-3]<<8|$t[e-2]<<16|$t[e-1]<<24)>>>0}class Uint8ArrayReader{constructor(e){sn(this,"buf");sn(this,"pos");sn(this,"len");sn(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const e=readFloatLE(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const e=readDoubleLE(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),_t=this.pos,At=this.pos+e;if(At>this.len)throw indexOutOfRange(this,e);return this.pos+=e,_t===At?new Uint8Array(0):this.buf.subarray(_t,At)}string(){const e=this.bytes();return read$1(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new LongBits(0,0);let _t=0;if(this.len-this.pos>4){for(;_t<4;++_t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<_t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;_t=0}else{for(;_t<3;++_t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<_t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<_t*7)>>>0,e}if(this.len-this.pos>4){for(;_t<5;++_t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<_t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;_t<5;++_t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<_t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const e=readFixed32End(this.buf,this.pos+=4),_t=readFixed32End(this.buf,this.pos+=4);return new LongBits(e,_t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength$5(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader($t){return new Uint8ArrayReader($t instanceof Uint8Array?$t:$t.subarray())}function decodeMessage($t,e,_t){const At=createReader($t);return e.decode(At,void 0,_t)}function pool($t){let At,xt=8192;return function(Bt){if(Bt<1||Bt>4096)return allocUnsafe$1(Bt);xt+Bt>8192&&(At=allocUnsafe$1(8192),xt=0);const Nt=At.subarray(xt,xt+=Bt);return xt&7&&(xt=(xt|7)+1),Nt}}class Op{constructor(e,_t,At){sn(this,"fn");sn(this,"len");sn(this,"next");sn(this,"val");this.fn=e,this.len=_t,this.next=void 0,this.val=At}}function noop$4(){}class State{constructor(e){sn(this,"head");sn(this,"tail");sn(this,"len");sn(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const bufferPool=pool();function alloc$1($t){return globalThis.Buffer!=null?allocUnsafe$1($t):bufferPool($t)}class Uint8ArrayWriter{constructor(){sn(this,"len");sn(this,"head");sn(this,"tail");sn(this,"states");this.len=0,this.head=new Op(noop$4,0,0),this.tail=this.head,this.states=null}_push(e,_t,At){return this.tail=this.tail.next=new Op(e,_t,At),this.len+=_t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(writeVarint64,10,LongBits.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const _t=LongBits.fromBigInt(e);return this._push(writeVarint64,_t.length(),_t)}uint64Number(e){return this._push(encodeUint8Array,encodingLength$5(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const _t=LongBits.fromBigInt(e).zzEncode();return this._push(writeVarint64,_t.length(),_t)}sint64Number(e){const _t=LongBits.fromNumber(e).zzEncode();return this._push(writeVarint64,_t.length(),_t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(writeByte,1,e?1:0)}fixed32(e){return this._push(writeFixed32,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const _t=LongBits.fromBigInt(e);return this._push(writeFixed32,4,_t.lo)._push(writeFixed32,4,_t.hi)}fixed64Number(e){const _t=LongBits.fromNumber(e);return this._push(writeFixed32,4,_t.lo)._push(writeFixed32,4,_t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(writeFloatLE,4,e)}double(e){return this._push(writeDoubleLE,8,e)}bytes(e){const _t=e.length>>>0;return _t===0?this._push(writeByte,1,0):this.uint32(_t)._push(writeBytes,_t,e)}string(e){const _t=length$1(e);return _t!==0?this.uint32(_t)._push(write$1,_t,e):this._push(writeByte,1,0)}fork(){return this.states=new State(this),this.head=this.tail=new Op(noop$4,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$4,0,0),this.len=0),this}ldelim(){const e=this.head,_t=this.tail,At=this.len;return this.reset().uint32(At),At!==0&&(this.tail.next=e.next,this.tail=_t,this.len+=At),this}finish(){let e=this.head.next;const _t=alloc$1(this.len);let At=0;for(;e!=null;)e.fn(e.val,_t,At),At+=e.len,e=e.next;return _t}}function writeByte($t,e,_t){e[_t]=$t&255}function writeVarint32($t,e,_t){for(;$t>127;)e[_t++]=$t&127|128,$t>>>=7;e[_t]=$t}class VarintOp extends Op{constructor(_t,At){super(writeVarint32,_t,At);sn(this,"next");this.next=void 0}}function writeVarint64($t,e,_t){for(;$t.hi!==0;)e[_t++]=$t.lo&127|128,$t.lo=($t.lo>>>7|$t.hi<<25)>>>0,$t.hi>>>=7;for(;$t.lo>127;)e[_t++]=$t.lo&127|128,$t.lo=$t.lo>>>7;e[_t++]=$t.lo}function writeFixed32($t,e,_t){e[_t]=$t&255,e[_t+1]=$t>>>8&255,e[_t+2]=$t>>>16&255,e[_t+3]=$t>>>24}function writeBytes($t,e,_t){e.set($t,_t)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function($t){const e=$t.length>>>0;return this.uint32(e),e>0&&this._push(writeBytesBuffer,e,$t),this},Uint8ArrayWriter.prototype.string=function($t){const e=globalThis.Buffer.byteLength($t);return this.uint32(e),e>0&&this._push(writeStringBuffer,e,$t),this});function writeBytesBuffer($t,e,_t){e.set($t,_t)}function writeStringBuffer($t,e,_t){$t.length<40?write$1($t,e,_t):e.utf8Write!=null?e.utf8Write($t,_t):e.set(fromString$3($t),_t)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage($t,e){const _t=createWriter();return e.encode($t,_t,{lengthDelimited:!1}),_t.finish()}var CODEC_TYPES;(function($t){$t[$t.VARINT=0]="VARINT",$t[$t.BIT64=1]="BIT64",$t[$t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",$t[$t.START_GROUP=3]="START_GROUP",$t[$t.END_GROUP=4]="END_GROUP",$t[$t.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec$1($t,e,_t,At){return{name:$t,type:e,encode:_t,decode:At}}function enumeration($t){function e(xt){if($t[xt.toString()]==null)throw new Error("Invalid enum value");return $t[xt]}const _t=function(kt,Bt){const Nt=e(kt);Bt.int32(Nt)},At=function(kt){const Bt=kt.int32();return e(Bt)};return createCodec$1("enum",CODEC_TYPES.VARINT,_t,At)}function message($t,e){return createCodec$1("message",CODEC_TYPES.LENGTH_DELIMITED,$t,e)}var Data;(function($t){(function(At){At.Raw="Raw",At.Directory="Directory",At.File="File",At.Metadata="Metadata",At.Symlink="Symlink",At.HAMTShard="HAMTShard"})($t.DataType||($t.DataType={}));let e;(function(At){At[At.Raw=0]="Raw",At[At.Directory=1]="Directory",At[At.File=2]="File",At[At.Metadata=3]="Metadata",At[At.Symlink=4]="Symlink",At[At.HAMTShard=5]="HAMTShard"})(e||(e={})),function(At){At.codec=()=>enumeration(e)}($t.DataType||($t.DataType={}));let _t;$t.codec=()=>(_t==null&&(_t=message((At,xt,kt={})=>{if(kt.lengthDelimited!==!1&&xt.fork(),At.Type!=null&&(xt.uint32(8),$t.DataType.codec().encode(At.Type,xt)),At.Data!=null&&(xt.uint32(18),xt.bytes(At.Data)),At.filesize!=null&&(xt.uint32(24),xt.uint64(At.filesize)),At.blocksizes!=null)for(const Bt of At.blocksizes)xt.uint32(32),xt.uint64(Bt);At.hashType!=null&&(xt.uint32(40),xt.uint64(At.hashType)),At.fanout!=null&&(xt.uint32(48),xt.uint64(At.fanout)),At.mode!=null&&(xt.uint32(56),xt.uint32(At.mode)),At.mtime!=null&&(xt.uint32(66),UnixTime.codec().encode(At.mtime,xt)),kt.lengthDelimited!==!1&&xt.ldelim()},(At,xt)=>{const kt={blocksizes:[]},Bt=xt==null?At.len:At.pos+xt;for(;At.pos<Bt;){const Nt=At.uint32();switch(Nt>>>3){case 1:kt.Type=$t.DataType.codec().decode(At);break;case 2:kt.Data=At.bytes();break;case 3:kt.filesize=At.uint64();break;case 4:kt.blocksizes.push(At.uint64());break;case 5:kt.hashType=At.uint64();break;case 6:kt.fanout=At.uint64();break;case 7:kt.mode=At.uint32();break;case 8:kt.mtime=UnixTime.codec().decode(At,At.uint32());break;default:At.skipType(Nt&7);break}}return kt})),_t),$t.encode=At=>encodeMessage(At,$t.codec()),$t.decode=At=>decodeMessage(At,$t.codec())})(Data||(Data={}));var UnixTime;(function($t){let e;$t.codec=()=>(e==null&&(e=message((_t,At,xt={})=>{xt.lengthDelimited!==!1&&At.fork(),_t.Seconds!=null&&(At.uint32(8),At.int64(_t.Seconds)),_t.FractionalNanoseconds!=null&&(At.uint32(21),At.fixed32(_t.FractionalNanoseconds)),xt.lengthDelimited!==!1&&At.ldelim()},(_t,At)=>{const xt={},kt=At==null?_t.len:_t.pos+At;for(;_t.pos<kt;){const Bt=_t.uint32();switch(Bt>>>3){case 1:xt.Seconds=_t.int64();break;case 2:xt.FractionalNanoseconds=_t.fixed32();break;default:_t.skipType(Bt&7);break}}return xt})),e),$t.encode=_t=>encodeMessage(_t,$t.codec()),$t.decode=_t=>decodeMessage(_t,$t.codec())})(UnixTime||(UnixTime={}));var Metadata;(function($t){let e;$t.codec=()=>(e==null&&(e=message((_t,At,xt={})=>{xt.lengthDelimited!==!1&&At.fork(),_t.MimeType!=null&&(At.uint32(10),At.string(_t.MimeType)),xt.lengthDelimited!==!1&&At.ldelim()},(_t,At)=>{const xt={},kt=At==null?_t.len:_t.pos+At;for(;_t.pos<kt;){const Bt=_t.uint32();switch(Bt>>>3){case 1:xt.MimeType=_t.string();break;default:_t.skipType(Bt&7);break}}return xt})),e),$t.encode=_t=>encodeMessage(_t,$t.codec()),$t.decode=_t=>decodeMessage(_t,$t.codec())})(Metadata||(Metadata={}));const types$2={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},dirTypes=["directory","hamt-sharded-directory"],DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8);class UnixFS{constructor(e={type:"file"}){sn(this,"type");sn(this,"data");sn(this,"blockSizes");sn(this,"hashType");sn(this,"fanout");sn(this,"mtime");sn(this,"_mode");sn(this,"_originalMode");const{type:_t,data:At,blockSizes:xt,hashType:kt,fanout:Bt,mtime:Nt,mode:Ut}=e;if(_t!=null&&!Object.values(types$2).includes(_t))throw errCode$1(new Error("Type: "+_t+" is not valid"),"ERR_INVALID_TYPE");this.type=_t??"file",this.data=At,this.hashType=kt,this.fanout=Bt,this.blockSizes=xt??[],this._originalMode=0,this.mode=Ut,this.mtime=Nt}static unmarshal(e){const _t=Data.decode(e),At=new UnixFS({type:types$2[_t.Type!=null?_t.Type.toString():"File"],data:_t.Data,blockSizes:_t.blocksizes,mode:_t.mode,mtime:_t.mtime!=null?{secs:_t.mtime.Seconds??0n,nsecs:_t.mtime.FractionalNanoseconds}:void 0,fanout:_t.fanout});return At._originalMode=_t.mode??0,At}set mode(e){e==null?this._mode=this.isDirectory()?DEFAULT_DIRECTORY_MODE:DEFAULT_FILE_MODE:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return dirTypes.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(_t=>{e+=_t}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=Data.DataType.Raw;break;case"directory":e=Data.DataType.Directory;break;case"file":e=Data.DataType.File;break;case"metadata":e=Data.DataType.Metadata;break;case"symlink":e=Data.DataType.Symlink;break;case"hamt-sharded-directory":e=Data.DataType.HAMTShard;break;default:throw errCode$1(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let _t=this.data;(this.data==null||this.data.length===0)&&(_t=void 0);let At;this.mode!=null&&(At=this._originalMode&4294963200|(this.mode??0),At===DEFAULT_FILE_MODE&&!this.isDirectory()&&(At=void 0),At===DEFAULT_DIRECTORY_MODE&&this.isDirectory()&&(At=void 0));let xt;return this.mtime!=null&&(xt={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Data.encode({Type:e,Data:_t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:At,mtime:xt})}}const name$3="raw",code$3=85,encode$9=$t=>coerce$3($t),decode$9=$t=>coerce$3($t),raw=Object.freeze(Object.defineProperty({__proto__:null,code:code$3,decode:decode$9,encode:encode$9,name:name$3},Symbol.toStringTag,{value:"Module"}));class CustomProgressEvent extends Event{constructor(_t,At){super(_t);sn(this,"type");sn(this,"detail");this.type=_t,this.detail=At}}const persist=async($t,e,_t)=>{_t.codec==null&&(_t.codec=dagPb);const At=await sha256$7.digest($t),xt=CID.create(_t.cidVersion,_t.codec.code,At);return await e.put(xt,$t,_t),xt};function defaultBufferImporter($t){return async function*(_t,At){let xt=0n;for await(let kt of _t.content)yield async()=>{var Lt;let Bt;const Nt={codec:dagPb,cidVersion:$t.cidVersion,onProgress:$t.onProgress};$t.rawLeaves?(Nt.codec=raw,Nt.cidVersion=1):(Bt=new UnixFS({type:$t.leafType,data:kt}),kt=encode$a({Data:Bt.marshal(),Links:[]}));const Ut=await persist(kt,At,Nt);return xt+=BigInt(kt.byteLength),(Lt=$t.onProgress)==null||Lt.call($t,new CustomProgressEvent("unixfs:importer:progress:file:write",{bytesWritten:xt,cid:Ut,path:_t.path})),{cid:Ut,unixfs:Bt,size:BigInt(kt.length),block:kt}}}}const dirBuilder=async($t,e,_t)=>{const At=new UnixFS({type:"directory",mtime:$t.mtime,mode:$t.mode}),xt=encode$a(prepare({Data:At.marshal()})),kt=await persist(xt,e,_t),Bt=$t.path;return{cid:kt,path:Bt,unixfs:At,size:BigInt(xt.length),originalPath:$t.originalPath,block:xt}};async function*buildFileBatch($t,e,_t){let At=-1,xt;for await(const kt of parallelBatch(_t.bufferImporter($t,e),_t.blockWriteConcurrency)){if(At++,At===0){xt={...kt,single:!0};continue}else At===1&&xt!=null&&(yield{...xt,block:void 0,single:void 0},xt=void 0);yield{...kt,block:void 0}}xt!=null&&(yield xt)}function isSingleBlockImport($t){return $t.single===!0}const reduce$2=($t,e,_t)=>async function(xt){var jt,Kt;if(xt.length===1&&isSingleBlockImport(xt[0])&&_t.reduceSingleLeafToSelf){const qt=xt[0];let zt=qt.block;return isSingleBlockImport(qt)&&($t.mtime!==void 0||$t.mode!==void 0)&&(qt.unixfs=new UnixFS({type:"file",mtime:$t.mtime,mode:$t.mode,data:qt.block}),zt={Data:qt.unixfs.marshal(),Links:[]},qt.block=encode$a(prepare(zt)),qt.cid=await persist(qt.block,e,{..._t,cidVersion:_t.cidVersion}),qt.size=BigInt(qt.block.length)),(jt=_t.onProgress)==null||jt.call(_t,new CustomProgressEvent("unixfs:importer:progress:file:layout",{cid:qt.cid,path:qt.originalPath})),{cid:qt.cid,path:$t.path,unixfs:qt.unixfs,size:qt.size,originalPath:qt.originalPath}}const kt=new UnixFS({type:"file",mtime:$t.mtime,mode:$t.mode}),Bt=xt.filter(qt=>{var zt,Vt;return qt.cid.code===code$3&&qt.size>0||qt.unixfs!=null&&qt.unixfs.data==null&&qt.unixfs.fileSize()>0n?!0:!!((Vt=(zt=qt.unixfs)==null?void 0:zt.data)!=null&&Vt.length)}).map(qt=>{var zt;return qt.cid.code===code$3?(kt.addBlockSize(qt.size),{Name:"",Tsize:Number(qt.size),Hash:qt.cid}):(qt.unixfs==null||qt.unixfs.data==null?kt.addBlockSize(((zt=qt.unixfs)==null?void 0:zt.fileSize())??0n):kt.addBlockSize(BigInt(qt.unixfs.data.length)),{Name:"",Tsize:Number(qt.size),Hash:qt.cid})}),Nt={Data:kt.marshal(),Links:Bt},Ut=encode$a(prepare(Nt)),Lt=await persist(Ut,e,_t);return(Kt=_t.onProgress)==null||Kt.call(_t,new CustomProgressEvent("unixfs:importer:progress:file:layout",{cid:Lt,path:$t.originalPath})),{cid:Lt,path:$t.path,unixfs:kt,size:BigInt(Ut.length+Nt.Links.reduce((qt,zt)=>qt+(zt.Tsize??0),0)),originalPath:$t.originalPath,block:Ut}},fileBuilder=async($t,e,_t)=>_t.layout(buildFileBatch($t,e,_t),reduce$2($t,e,_t));function isIterable$5($t){return Symbol.iterator in $t}function isAsyncIterable$7($t){return Symbol.asyncIterator in $t}function contentAsAsyncIterable($t){try{if($t instanceof Uint8Array)return async function*(){yield $t}();if(isIterable$5($t))return async function*(){yield*$t}();if(isAsyncIterable$7($t))return $t}catch{throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function defaultDagBuilder($t){return async function*(_t,At){for await(const xt of _t){let kt;if(xt.path!=null&&(kt=xt.path,xt.path=xt.path.split("/").filter(Bt=>Bt!=null&&Bt!==".").join("/")),isFileCandidate(xt)){const Bt={path:xt.path,mtime:xt.mtime,mode:xt.mode,content:async function*(){var Ut;let Nt=0n;for await(const Lt of $t.chunker($t.chunkValidator(contentAsAsyncIterable(xt.content)))){const jt=BigInt(Lt.byteLength);Nt+=jt,(Ut=$t.onProgress)==null||Ut.call($t,new CustomProgressEvent("unixfs:importer:progress:file:read",{bytesRead:Nt,chunkSize:jt,path:xt.path})),yield Lt}}(),originalPath:kt};yield async()=>fileBuilder(Bt,At,$t)}else if(xt.path!=null){const Bt={path:xt.path,mtime:xt.mtime,mode:xt.mode,originalPath:kt};yield async()=>dirBuilder(Bt,At,$t)}else throw new Error("Import candidate must have content or path or both")}}}function isFileCandidate($t){return $t.content!=null}function asUint8Array($t){return globalThis.Buffer!=null?new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength):$t}const base10=baseX$1({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648$1({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648$1({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648$1({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet$2=Array.from(""),alphabetBytesToChars=alphabet$2.reduce(($t,e,_t)=>($t[_t]=e,$t),[]),alphabetCharsToBytes=alphabet$2.reduce(($t,e,_t)=>($t[e.codePointAt(0)]=_t,$t),[]);function encode$8($t){return $t.reduce((e,_t)=>(e+=alphabetBytesToChars[_t],e),"")}function decode$8($t){const e=[];for(const _t of $t){const At=alphabetCharsToBytes[_t.codePointAt(0)];if(At===void 0)throw new Error(`Non-base256emoji character: ${_t}`);e.push(At)}return new Uint8Array(e)}const base256emoji=from$6({prefix:"",name:"base256emoji",encode:encode$8,decode:decode$8}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base36=baseX$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base64=rfc4648$1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648$1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648$1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648$1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$1=Object.freeze(Object.defineProperty({__proto__:null,base64,base64pad,base64url:base64url$1,base64urlpad},Symbol.toStringTag,{value:"Module"})),base8=rfc4648$1({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity$2=from$6({prefix:"\0",name:"identity",encode:$t=>toString$6($t),decode:$t=>fromString$1($t)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const from$5=({name:$t,code:e,encode:_t})=>new Hasher($t,e,_t);class Hasher{constructor(e,_t,At){this.name=e,this.code=_t,this.encode=At}digest(e){if(e instanceof Uint8Array){const _t=this.encode(e);return _t instanceof Uint8Array?create(this.code,_t):_t.then(At=>create(this.code,At))}else throw Error("Unknown type, must be binary type")}}const sha$5=$t=>async e=>new Uint8Array(await crypto.subtle.digest($t,e)),sha256$4=from$5({name:"sha2-256",code:18,encode:sha$5("SHA-256")}),bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$2,...base36$1,...base58,...base64$1,...base256emoji$1};function allocUnsafe($t=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?asUint8Array(globalThis.Buffer.allocUnsafe($t)):new Uint8Array($t)}function createCodec($t,e,_t,At){return{name:$t,prefix:e,encoder:{name:$t,prefix:e,encode:_t},decoder:{decode:At}}}const string$1=createCodec("utf8","u",$t=>"u"+new TextDecoder("utf8").decode($t),$t=>new TextEncoder().encode($t.substring(1))),ascii=createCodec("ascii","a",$t=>{let e="a";for(let _t=0;_t<$t.length;_t++)e+=String.fromCharCode($t[_t]);return e},$t=>{$t=$t.substring(1);const e=allocUnsafe($t.length);for(let _t=0;_t<$t.length;_t++)e[_t]=$t.charCodeAt(_t);return e}),BASES={utf8:string$1,"utf-8":string$1,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function fromString($t,e="utf8"){const _t=BASES[e];if(_t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array(globalThis.Buffer.from($t,"utf-8")):_t.decoder.decode(`${_t.prefix}${$t}`)}const defaultChunkValidator=()=>async function*(e){for await(const _t of e){if(_t.length===void 0)throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof _t=="string"||_t instanceof String)yield fromString(_t.toString());else if(Array.isArray(_t))yield Uint8Array.from(_t);else if(_t instanceof Uint8Array)yield _t;else throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}},DEFAULT_MAX_CHILDREN_PER_NODE=174;function balanced($t){const e=DEFAULT_MAX_CHILDREN_PER_NODE;return async function _t(At,xt){const kt=[];for await(const Bt of batch(At,e))kt.push(await xt(Bt));return kt.length>1?_t(kt,xt):kt[0]}}class Dir{constructor(e,_t){sn(this,"options");sn(this,"root");sn(this,"dir");sn(this,"path");sn(this,"dirty");sn(this,"flat");sn(this,"parent");sn(this,"parentKey");sn(this,"unixfs");sn(this,"mode");sn(this,"mtime");sn(this,"cid");sn(this,"size");sn(this,"nodeSize");this.options=_t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const CID_V0=CID.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),CID_V1=CID.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class DirFlat extends Dir{constructor(_t,At){super(_t,At);sn(this,"_children");this._children=new Map}async put(_t,At){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(_t,At)}async get(_t){return Promise.resolve(this._children.get(_t))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[_t,At]of this._children.entries())yield{key:_t,child:At}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(const[_t,At]of this._children.entries())At.size!=null&&At.cid!=null&&(this.nodeSize+=_t.length+(this.options.cidVersion===1?CID_V1.bytes.byteLength:CID_V0.bytes.byteLength));return this.nodeSize}async*flush(_t){const At=[];for(const[Lt,jt]of this._children.entries()){let Kt=jt;if(jt instanceof Dir)for await(const qt of jt.flush(_t))Kt=qt,yield qt;Kt.size!=null&&Kt.cid!=null&&At.push({Name:Lt,Tsize:Number(Kt.size),Hash:Kt.cid})}const xt=new UnixFS({type:"directory",mtime:this.mtime,mode:this.mode}),kt={Data:xt.marshal(),Links:At},Bt=encode$a(prepare(kt)),Nt=await persist(Bt,_t,this.options),Ut=Bt.length+kt.Links.reduce((Lt,jt)=>Lt+(jt.Tsize==null?0:jt.Tsize),0);this.cid=Nt,this.size=Ut,yield{cid:Nt,unixfs:xt,path:this.path,size:BigInt(Ut)}}}var murmurHash3js={exports:{}};(function($t,e){(function(_t,At){var xt={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function kt(Ht){if(!Array.isArray(Ht)&&!ArrayBuffer.isView(Ht))return!1;for(var Wt=0;Wt<Ht.length;Wt++)if(!Number.isInteger(Ht[Wt])||Ht[Wt]<0||Ht[Wt]>255)return!1;return!0}function Bt(Ht,Wt){return(Ht&65535)*Wt+(((Ht>>>16)*Wt&65535)<<16)}function Nt(Ht,Wt){return Ht<<Wt|Ht>>>32-Wt}function Ut(Ht){return Ht^=Ht>>>16,Ht=Bt(Ht,2246822507),Ht^=Ht>>>13,Ht=Bt(Ht,3266489909),Ht^=Ht>>>16,Ht}function Lt(Ht,Wt){Ht=[Ht[0]>>>16,Ht[0]&65535,Ht[1]>>>16,Ht[1]&65535],Wt=[Wt[0]>>>16,Wt[0]&65535,Wt[1]>>>16,Wt[1]&65535];var Qt=[0,0,0,0];return Qt[3]+=Ht[3]+Wt[3],Qt[2]+=Qt[3]>>>16,Qt[3]&=65535,Qt[2]+=Ht[2]+Wt[2],Qt[1]+=Qt[2]>>>16,Qt[2]&=65535,Qt[1]+=Ht[1]+Wt[1],Qt[0]+=Qt[1]>>>16,Qt[1]&=65535,Qt[0]+=Ht[0]+Wt[0],Qt[0]&=65535,[Qt[0]<<16|Qt[1],Qt[2]<<16|Qt[3]]}function jt(Ht,Wt){Ht=[Ht[0]>>>16,Ht[0]&65535,Ht[1]>>>16,Ht[1]&65535],Wt=[Wt[0]>>>16,Wt[0]&65535,Wt[1]>>>16,Wt[1]&65535];var Qt=[0,0,0,0];return Qt[3]+=Ht[3]*Wt[3],Qt[2]+=Qt[3]>>>16,Qt[3]&=65535,Qt[2]+=Ht[2]*Wt[3],Qt[1]+=Qt[2]>>>16,Qt[2]&=65535,Qt[2]+=Ht[3]*Wt[2],Qt[1]+=Qt[2]>>>16,Qt[2]&=65535,Qt[1]+=Ht[1]*Wt[3],Qt[0]+=Qt[1]>>>16,Qt[1]&=65535,Qt[1]+=Ht[2]*Wt[2],Qt[0]+=Qt[1]>>>16,Qt[1]&=65535,Qt[1]+=Ht[3]*Wt[1],Qt[0]+=Qt[1]>>>16,Qt[1]&=65535,Qt[0]+=Ht[0]*Wt[3]+Ht[1]*Wt[2]+Ht[2]*Wt[1]+Ht[3]*Wt[0],Qt[0]&=65535,[Qt[0]<<16|Qt[1],Qt[2]<<16|Qt[3]]}function Kt(Ht,Wt){return Wt%=64,Wt===32?[Ht[1],Ht[0]]:Wt<32?[Ht[0]<<Wt|Ht[1]>>>32-Wt,Ht[1]<<Wt|Ht[0]>>>32-Wt]:(Wt-=32,[Ht[1]<<Wt|Ht[0]>>>32-Wt,Ht[0]<<Wt|Ht[1]>>>32-Wt])}function qt(Ht,Wt){return Wt%=64,Wt===0?Ht:Wt<32?[Ht[0]<<Wt|Ht[1]>>>32-Wt,Ht[1]<<Wt]:[Ht[1]<<Wt-32,0]}function zt(Ht,Wt){return[Ht[0]^Wt[0],Ht[1]^Wt[1]]}function Vt(Ht){return Ht=zt(Ht,[0,Ht[0]>>>1]),Ht=jt(Ht,[4283543511,3981806797]),Ht=zt(Ht,[0,Ht[0]>>>1]),Ht=jt(Ht,[3301882366,444984403]),Ht=zt(Ht,[0,Ht[0]>>>1]),Ht}xt.x86.hash32=function(Ht,Wt){if(xt.inputValidation&&!kt(Ht))return At;Wt=Wt||0;for(var Qt=Ht.length%4,Xt=Ht.length-Qt,Jt=Wt,tr=0,dr=3432918353,vr=461845907,$r=0;$r<Xt;$r=$r+4)tr=Ht[$r]|Ht[$r+1]<<8|Ht[$r+2]<<16|Ht[$r+3]<<24,tr=Bt(tr,dr),tr=Nt(tr,15),tr=Bt(tr,vr),Jt^=tr,Jt=Nt(Jt,13),Jt=Bt(Jt,5)+3864292196;switch(tr=0,Qt){case 3:tr^=Ht[$r+2]<<16;case 2:tr^=Ht[$r+1]<<8;case 1:tr^=Ht[$r],tr=Bt(tr,dr),tr=Nt(tr,15),tr=Bt(tr,vr),Jt^=tr}return Jt^=Ht.length,Jt=Ut(Jt),Jt>>>0},xt.x86.hash128=function(Ht,Wt){if(xt.inputValidation&&!kt(Ht))return At;Wt=Wt||0;for(var Qt=Ht.length%16,Xt=Ht.length-Qt,Jt=Wt,tr=Wt,dr=Wt,vr=Wt,$r=0,Ir=0,Rr=0,Nr=0,kr=597399067,lr=2869860233,ir=951274213,er=2716044179,rr=0;rr<Xt;rr=rr+16)$r=Ht[rr]|Ht[rr+1]<<8|Ht[rr+2]<<16|Ht[rr+3]<<24,Ir=Ht[rr+4]|Ht[rr+5]<<8|Ht[rr+6]<<16|Ht[rr+7]<<24,Rr=Ht[rr+8]|Ht[rr+9]<<8|Ht[rr+10]<<16|Ht[rr+11]<<24,Nr=Ht[rr+12]|Ht[rr+13]<<8|Ht[rr+14]<<16|Ht[rr+15]<<24,$r=Bt($r,kr),$r=Nt($r,15),$r=Bt($r,lr),Jt^=$r,Jt=Nt(Jt,19),Jt+=tr,Jt=Bt(Jt,5)+1444728091,Ir=Bt(Ir,lr),Ir=Nt(Ir,16),Ir=Bt(Ir,ir),tr^=Ir,tr=Nt(tr,17),tr+=dr,tr=Bt(tr,5)+197830471,Rr=Bt(Rr,ir),Rr=Nt(Rr,17),Rr=Bt(Rr,er),dr^=Rr,dr=Nt(dr,15),dr+=vr,dr=Bt(dr,5)+2530024501,Nr=Bt(Nr,er),Nr=Nt(Nr,18),Nr=Bt(Nr,kr),vr^=Nr,vr=Nt(vr,13),vr+=Jt,vr=Bt(vr,5)+850148119;switch($r=0,Ir=0,Rr=0,Nr=0,Qt){case 15:Nr^=Ht[rr+14]<<16;case 14:Nr^=Ht[rr+13]<<8;case 13:Nr^=Ht[rr+12],Nr=Bt(Nr,er),Nr=Nt(Nr,18),Nr=Bt(Nr,kr),vr^=Nr;case 12:Rr^=Ht[rr+11]<<24;case 11:Rr^=Ht[rr+10]<<16;case 10:Rr^=Ht[rr+9]<<8;case 9:Rr^=Ht[rr+8],Rr=Bt(Rr,ir),Rr=Nt(Rr,17),Rr=Bt(Rr,er),dr^=Rr;case 8:Ir^=Ht[rr+7]<<24;case 7:Ir^=Ht[rr+6]<<16;case 6:Ir^=Ht[rr+5]<<8;case 5:Ir^=Ht[rr+4],Ir=Bt(Ir,lr),Ir=Nt(Ir,16),Ir=Bt(Ir,ir),tr^=Ir;case 4:$r^=Ht[rr+3]<<24;case 3:$r^=Ht[rr+2]<<16;case 2:$r^=Ht[rr+1]<<8;case 1:$r^=Ht[rr],$r=Bt($r,kr),$r=Nt($r,15),$r=Bt($r,lr),Jt^=$r}return Jt^=Ht.length,tr^=Ht.length,dr^=Ht.length,vr^=Ht.length,Jt+=tr,Jt+=dr,Jt+=vr,tr+=Jt,dr+=Jt,vr+=Jt,Jt=Ut(Jt),tr=Ut(tr),dr=Ut(dr),vr=Ut(vr),Jt+=tr,Jt+=dr,Jt+=vr,tr+=Jt,dr+=Jt,vr+=Jt,("00000000"+(Jt>>>0).toString(16)).slice(-8)+("00000000"+(tr>>>0).toString(16)).slice(-8)+("00000000"+(dr>>>0).toString(16)).slice(-8)+("00000000"+(vr>>>0).toString(16)).slice(-8)},xt.x64.hash128=function(Ht,Wt){if(xt.inputValidation&&!kt(Ht))return At;Wt=Wt||0;for(var Qt=Ht.length%16,Xt=Ht.length-Qt,Jt=[0,Wt],tr=[0,Wt],dr=[0,0],vr=[0,0],$r=[2277735313,289559509],Ir=[1291169091,658871167],Rr=0;Rr<Xt;Rr=Rr+16)dr=[Ht[Rr+4]|Ht[Rr+5]<<8|Ht[Rr+6]<<16|Ht[Rr+7]<<24,Ht[Rr]|Ht[Rr+1]<<8|Ht[Rr+2]<<16|Ht[Rr+3]<<24],vr=[Ht[Rr+12]|Ht[Rr+13]<<8|Ht[Rr+14]<<16|Ht[Rr+15]<<24,Ht[Rr+8]|Ht[Rr+9]<<8|Ht[Rr+10]<<16|Ht[Rr+11]<<24],dr=jt(dr,$r),dr=Kt(dr,31),dr=jt(dr,Ir),Jt=zt(Jt,dr),Jt=Kt(Jt,27),Jt=Lt(Jt,tr),Jt=Lt(jt(Jt,[0,5]),[0,1390208809]),vr=jt(vr,Ir),vr=Kt(vr,33),vr=jt(vr,$r),tr=zt(tr,vr),tr=Kt(tr,31),tr=Lt(tr,Jt),tr=Lt(jt(tr,[0,5]),[0,944331445]);switch(dr=[0,0],vr=[0,0],Qt){case 15:vr=zt(vr,qt([0,Ht[Rr+14]],48));case 14:vr=zt(vr,qt([0,Ht[Rr+13]],40));case 13:vr=zt(vr,qt([0,Ht[Rr+12]],32));case 12:vr=zt(vr,qt([0,Ht[Rr+11]],24));case 11:vr=zt(vr,qt([0,Ht[Rr+10]],16));case 10:vr=zt(vr,qt([0,Ht[Rr+9]],8));case 9:vr=zt(vr,[0,Ht[Rr+8]]),vr=jt(vr,Ir),vr=Kt(vr,33),vr=jt(vr,$r),tr=zt(tr,vr);case 8:dr=zt(dr,qt([0,Ht[Rr+7]],56));case 7:dr=zt(dr,qt([0,Ht[Rr+6]],48));case 6:dr=zt(dr,qt([0,Ht[Rr+5]],40));case 5:dr=zt(dr,qt([0,Ht[Rr+4]],32));case 4:dr=zt(dr,qt([0,Ht[Rr+3]],24));case 3:dr=zt(dr,qt([0,Ht[Rr+2]],16));case 2:dr=zt(dr,qt([0,Ht[Rr+1]],8));case 1:dr=zt(dr,[0,Ht[Rr]]),dr=jt(dr,$r),dr=Kt(dr,31),dr=jt(dr,Ir),Jt=zt(Jt,dr)}return Jt=zt(Jt,[0,Ht.length]),tr=zt(tr,[0,Ht.length]),Jt=Lt(Jt,tr),tr=Lt(tr,Jt),Jt=Vt(Jt),tr=Vt(tr),Jt=Lt(Jt,tr),tr=Lt(tr,Jt),("00000000"+(Jt[0]>>>0).toString(16)).slice(-8)+("00000000"+(Jt[1]>>>0).toString(16)).slice(-8)+("00000000"+(tr[0]>>>0).toString(16)).slice(-8)+("00000000"+(tr[1]>>>0).toString(16)).slice(-8)},$t.exports&&(e=$t.exports=xt),e.murmurHash3=xt})()})(murmurHash3js,murmurHash3js.exports);var murmurHash3jsExports=murmurHash3js.exports,murmurhash3jsRevisited=murmurHash3jsExports;const mur=getDefaultExportFromCjs(murmurhash3jsRevisited),murmur3128=from$7({name:"murmur3-128",code:34,encode:$t=>fromHex(mur.x64.hash128($t))}),BITS_PER_BYTE=7;var sparseArray=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,_t){let At=this._internalPositionFor(e,!1);if(_t===void 0)At!==-1&&(this._unsetInternalPos(At),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let xt=!1;At===-1?(At=this._data.length,this._setBit(e),this._changedData=!0):xt=!0,this._setInternalPos(At,e,_t,xt),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const _t=this._internalPositionFor(e,!0);if(_t!==-1)return this._data[_t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let _t=0;for(;_t<this.length;)e(this.get(_t),_t,this),_t++}map(e){let _t=0,At=new Array(this.length);for(;_t<this.length;)At[_t]=e(this.get(_t),_t,this),_t++;return At}reduce(e,_t){let At=0,xt=_t;for(;At<this.length;){const kt=this.get(At);xt=e(xt,kt,At),At++}return xt}find(e){let _t=0,At,xt;for(;_t<this.length&&!At;)xt=this.get(_t),At=e(xt),_t++;return At?xt:void 0}_internalPositionFor(e,_t){const At=this._bytePosFor(e,_t);if(At>=this._bitArrays.length)return-1;const xt=this._bitArrays[At],kt=e-At*BITS_PER_BYTE;if(!((xt&1<<kt)>0))return-1;const Nt=this._bitArrays.slice(0,At).reduce(popCountReduce,0),Ut=~(4294967295<<kt+1),Lt=popCount(xt&Ut);return Nt+Lt-1}_bytePosFor(e,_t){const At=Math.floor(e/BITS_PER_BYTE),xt=At+1;for(;!_t&&this._bitArrays.length<xt;)this._bitArrays.push(0);return At}_setBit(e){const _t=this._bytePosFor(e,!1);this._bitArrays[_t]|=1<<e-_t*BITS_PER_BYTE}_unsetBit(e){const _t=this._bytePosFor(e,!1);this._bitArrays[_t]&=~(1<<e-_t*BITS_PER_BYTE)}_setInternalPos(e,_t,At,xt){const kt=this._data,Bt=[_t,At];if(xt)this._sortData(),kt[e]=Bt;else{if(kt.length)if(kt[kt.length-1][0]>=_t)kt.push(Bt);else if(kt[0][0]<=_t)kt.unshift(Bt);else{const Nt=Math.round(kt.length/2);this._data=kt.slice(0,Nt).concat(Bt).concat(kt.slice(Nt))}else this._data.push(Bt);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(sortInternal),this._changedData=!1}bitField(){const e=[];let _t=8,At=0,xt=0,kt;const Bt=this._bitArrays.slice();for(;Bt.length||At;){At===0&&(kt=Bt.shift(),At=7);const Ut=Math.min(At,_t),Lt=~(255<<Ut),jt=kt&Lt;xt|=jt<<8-_t,kt=kt>>>Ut,At-=Ut,_t-=Ut,(!_t||!At&&!Bt.length)&&(e.push(xt),xt=0,_t=8)}for(var Nt=e.length-1;Nt>0&&e[Nt]===0;Nt--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(valueOnly)}};function popCountReduce($t,e){return $t+popCount(e)}function popCount($t){let e=$t;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function sortInternal($t,e){return $t[0]-e[0]}function valueOnly($t){return $t[1]}const SparseArray=getDefaultExportFromCjs(sparseArray);class Bucket{constructor(e,_t,At=0){sn(this,"_options");sn(this,"_popCount");sn(this,"_parent");sn(this,"_posAtParent");sn(this,"_children");sn(this,"key");this._options=e,this._popCount=0,this._parent=_t,this._posAtParent=At,this._children=new SparseArray,this.key=null}async put(e,_t){const At=await this._findNewBucketAndPos(e);At.bucket._putAt(At,e,_t)}async get(e){const _t=await this._findChild(e);if(_t!=null)return _t.value}async del(e){const _t=await this._findPlace(e),At=_t.bucket._at(_t.pos);At!=null&&At.key===e&&_t.bucket._delAt(_t.pos)}leafCount(){return this._children.compactArray().reduce((_t,At)=>At instanceof Bucket?_t+At.leafCount():_t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const _t of e)_t instanceof Bucket?yield*_t.eachLeafSeries():yield _t}serialize(e,_t){const At=[];return _t(this._children.reduce((xt,kt,Bt)=>(kt!=null&&(kt instanceof Bucket?xt.push(kt.serialize(e,_t)):xt.push(e(kt,Bt))),xt),At))}async asyncTransform(e,_t){return asyncTransformBucket(this,e,_t)}toJSON(){return this.serialize(mapNode,reduceNodes)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const _t=await this._findPlace(e),At=_t.bucket._at(_t.pos);if(!(At instanceof Bucket)&&At!=null&&At.key===e)return At}async _findPlace(e){const _t=this._options.hash(typeof e=="string"?fromString$3(e):e),At=await _t.take(this._options.bits),xt=this._children.get(At);return xt instanceof Bucket?xt._findPlace(_t):{bucket:this,pos:At,hash:_t,existingChild:xt}}async _findNewBucketAndPos(e){const _t=await this._findPlace(e);if(_t.existingChild!=null&&_t.existingChild.key!==e){const At=new Bucket(this._options,_t.bucket,_t.pos);_t.bucket._putObjectAt(_t.pos,At);const xt=await At._findPlace(_t.existingChild.hash);return xt.bucket._putAt(xt,_t.existingChild.key,_t.existingChild.value),At._findNewBucketAndPos(_t.hash)}return _t}_putAt(e,_t,At){this._putObjectAt(e.pos,{key:_t,value:At,hash:e.hash})}_putObjectAt(e,_t){this._children.get(e)==null&&this._popCount++,this._children.set(e,_t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){const e=this._children.find(exists$5);if(e!=null&&!(e instanceof Bucket)){const _t=e.hash;_t.untake(this._options.bits);const At={pos:this._posAtParent,hash:_t,bucket:this._parent};this._parent._putAt(At,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function exists$5($t){return!!$t}function mapNode($t,e){return $t.key}function reduceNodes($t){return $t}async function asyncTransformBucket($t,e,_t){const At=[];for(const xt of $t._children.compactArray())if(xt instanceof Bucket)await asyncTransformBucket(xt,e,_t);else{const kt=await e(xt);At.push({bitField:$t._children.bitField(),children:kt})}return _t(At)}const START_MASKS=[255,254,252,248,240,224,192,128],STOP_MASKS=[1,3,7,15,31,63,127,255];class ConsumableBuffer{constructor(e){sn(this,"_value");sn(this,"_currentBytePos");sn(this,"_currentBitPos");this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let _t=e,At=0;for(;_t>0&&this._haveBits();){const xt=this._value[this._currentBytePos],kt=this._currentBitPos+1,Bt=Math.min(kt,_t),Nt=byteBitsToInt(xt,kt-Bt,Bt);At=(At<<Bt)+Nt,_t-=Bt,this._currentBitPos-=Bt,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return At}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function byteBitsToInt($t,e,_t){const At=maskFor(e,_t);return($t&At)>>>e}function maskFor($t,e){return START_MASKS[$t]&STOP_MASKS[Math.min(e+$t-1,7)]}function wrapHash($t){function e(_t){return _t instanceof InfiniteHash?_t:new InfiniteHash(_t,$t)}return e}class InfiniteHash{constructor(e,_t){sn(this,"_value");sn(this,"_hashFn");sn(this,"_depth");sn(this,"_availableBits");sn(this,"_currentBufferIndex");sn(this,"_buffers");if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=_t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let _t=e;for(;this._availableBits<_t;)await this._produceMoreBits();let At=0;for(;_t>0;){const xt=this._buffers[this._currentBufferIndex],kt=Math.min(xt.availableBits(),_t),Bt=xt.take(kt);At=(At<<kt)+Bt,_t-=kt,this._availableBits-=kt,xt.availableBits()===0&&this._currentBufferIndex++}return At}untake(e){let _t=e;for(;_t>0;){const At=this._buffers[this._currentBufferIndex],xt=Math.min(At.totalBits()-At.availableBits(),_t);At.untake(xt),_t-=xt,this._availableBits+=xt,this._currentBufferIndex>0&&At.totalBits()===At.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?concat$2([this._value,Uint8Array.from([this._depth])]):this._value,_t=await this._hashFn(e),At=new ConsumableBuffer(_t);this._buffers.push(At),this._availableBits+=At.availableBits()}}function createHAMT($t){if($t==null||$t.hashFn==null)throw new Error("please define an options.hashFn");const e={bits:$t.bits??8,hash:wrapHash($t.hashFn)};return new Bucket(e)}async function hamtHashFn($t){return(await murmur3128.encode($t)).slice(0,8).reverse()}const HAMT_HASH_CODE=BigInt(34);class DirSharded extends Dir{constructor(_t,At){super(_t,At);sn(this,"_bucket");this._bucket=createHAMT({hashFn:hamtHashFn,bits:8})}async put(_t,At){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(_t,At)}async get(_t){return this._bucket.get(_t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:_t,value:At}of this._bucket.eachLeafSeries())yield{key:_t,child:At}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=calculateSize(this._bucket,this,this.options),this.nodeSize)}async*flush(_t){for await(const At of flush(this._bucket,_t,this,this.options))yield{...At,path:this.path}}}async function*flush($t,e,_t,At){const xt=$t._children,kt=[];let Bt=0n;for(let zt=0;zt<xt.length;zt++){const Vt=xt.get(zt);if(Vt==null)continue;const Ht=zt.toString(16).toUpperCase().padStart(2,"0");if(Vt instanceof Bucket){let Wt;for await(const Qt of flush(Vt,e,null,At))Wt=Qt;if(Wt==null)throw new Error("Could not flush sharded directory, no subshard found");kt.push({Name:Ht,Tsize:Number(Wt.size),Hash:Wt.cid}),Bt+=Wt.size}else if(isDir(Vt.value)){const Wt=Vt.value;let Qt;for await(const Jt of Wt.flush(e))Qt=Jt,yield Qt;if(Qt==null)throw new Error("Did not flush dir");const Xt=Ht+Vt.key;kt.push({Name:Xt,Tsize:Number(Qt.size),Hash:Qt.cid}),Bt+=Qt.size}else{const Wt=Vt.value;if(Wt.cid==null)continue;const Qt=Ht+Vt.key,Xt=Wt.size;kt.push({Name:Qt,Tsize:Number(Xt),Hash:Wt.cid}),Bt+=BigInt(Xt??0)}}const Nt=Uint8Array.from(xt.bitField().reverse()),Ut=new UnixFS({type:"hamt-sharded-directory",data:Nt,fanout:BigInt($t.tableSize()),hashType:HAMT_HASH_CODE,mtime:_t==null?void 0:_t.mtime,mode:_t==null?void 0:_t.mode}),Lt={Data:Ut.marshal(),Links:kt},jt=encode$a(prepare(Lt)),Kt=await persist(jt,e,At),qt=BigInt(jt.byteLength)+Bt;yield{cid:Kt,unixfs:Ut,size:qt}}function isDir($t){return typeof $t.flush=="function"}function calculateSize($t,e,_t){const At=$t._children,xt=[];for(let Ut=0;Ut<At.length;Ut++){const Lt=At.get(Ut);if(Lt==null)continue;const jt=Ut.toString(16).toUpperCase().padStart(2,"0");if(Lt instanceof Bucket){const Kt=calculateSize(Lt,null,_t);xt.push({Name:jt,Tsize:Number(Kt),Hash:_t.cidVersion===0?CID_V0:CID_V1})}else if(typeof Lt.value.flush=="function"){const qt=Lt.value.nodeSize();xt.push({Name:jt+Lt.key,Tsize:Number(qt),Hash:_t.cidVersion===0?CID_V0:CID_V1})}else{const Kt=Lt.value;if(Kt.cid==null)continue;const qt=jt+Lt.key,zt=Kt.size;xt.push({Name:qt,Tsize:Number(zt),Hash:Kt.cid})}}const kt=Uint8Array.from(At.bitField().reverse()),Bt=new UnixFS({type:"hamt-sharded-directory",data:kt,fanout:BigInt($t.tableSize()),hashType:HAMT_HASH_CODE,mtime:e==null?void 0:e.mtime,mode:e==null?void 0:e.mode});return encode$a(prepare({Data:Bt.marshal(),Links:xt})).length}async function flatToShard($t,e,_t,At){let xt=e;e instanceof DirFlat&&e.estimateNodeSize()>_t&&(xt=await convertToShard(e,At));const kt=xt.parent;if(kt!=null){if(xt!==e){if($t!=null&&($t.parent=xt),xt.parentKey==null)throw new Error("No parent key found");await kt.put(xt.parentKey,xt)}return flatToShard(xt,kt,_t,At)}return xt}async function convertToShard($t,e){const _t=new DirSharded({root:$t.root,dir:!0,parent:$t.parent,parentKey:$t.parentKey,path:$t.path,dirty:$t.dirty,flat:!1,mtime:$t.mtime,mode:$t.mode},e);for await(const{key:At,child:xt}of $t.eachChildSeries())await _t.put(At,xt);return _t}const toPathComponents$1=($t="")=>($t.trim().match(/([^\\/]|\\\/)+/g)??[]).filter(Boolean);async function addToTree($t,e,_t){var Nt,Ut;const At=toPathComponents$1($t.path??""),xt=At.length-1;let kt=e,Bt="";for(let Lt=0;Lt<At.length;Lt++){const jt=At[Lt];Bt+=`${Bt!==""?"/":""}${jt}`;const Kt=Lt===xt;if(kt.dirty=!0,kt.cid=void 0,kt.size=void 0,Kt)await kt.put(jt,$t),e=await flatToShard(null,kt,_t.shardSplitThresholdBytes,_t);else{let qt=await kt.get(jt);(qt==null||!(qt instanceof Dir))&&(qt=new DirFlat({root:!1,dir:!0,parent:kt,parentKey:jt,path:Bt,dirty:!0,flat:!0,mtime:(Nt=qt==null?void 0:qt.unixfs)==null?void 0:Nt.mtime,mode:(Ut=qt==null?void 0:qt.unixfs)==null?void 0:Ut.mode},_t)),await kt.put(jt,qt),kt=qt}}return e}async function*flushAndYield($t,e){var _t;if(!($t instanceof Dir)){((_t=$t.unixfs)==null?void 0:_t.isDirectory())===!0&&(yield $t);return}yield*$t.flush(e)}function defaultTreeBuilder($t){return async function*(_t,At){let xt=new DirFlat({root:!0,dir:!0,path:"",dirty:!0,flat:!0},$t),kt,Bt=!1;for await(const Nt of _t){if(Nt==null)continue;const Ut=`${Nt.originalPath??""}`.split("/")[0];Ut!=null&&Ut!==""&&(kt==null?(kt=Ut,Bt=!0):kt!==Ut&&(Bt=!1)),xt=await addToTree(Nt,xt,$t),(Nt.unixfs==null||!Nt.unixfs.isDirectory())&&(yield Nt)}if($t.wrapWithDirectory||Bt&&xt.childCount()>1)yield*flushAndYield(xt,At);else for await(const Nt of xt.eachChildSeries())Nt!=null&&(yield*flushAndYield(Nt.child,At))}}async function*importer($t,e,_t={}){let At;Symbol.asyncIterator in $t||Symbol.iterator in $t?At=$t:At=[$t];const xt=_t.wrapWithDirectory??!1,kt=_t.shardSplitThresholdBytes??262144,Bt=_t.cidVersion??1,Nt=_t.rawLeaves??!0,Ut=_t.leafType??"file",Lt=_t.fileImportConcurrency??50,jt=_t.blockWriteConcurrency??10,Kt=_t.reduceSingleLeafToSelf??!0,qt=_t.chunker??fixedSize(),zt=_t.chunkValidator??defaultChunkValidator(),Vt=_t.dagBuilder??defaultDagBuilder({chunker:qt,chunkValidator:zt,wrapWithDirectory:xt,layout:_t.layout??balanced(),bufferImporter:_t.bufferImporter??defaultBufferImporter({cidVersion:Bt,rawLeaves:Nt,leafType:Ut,onProgress:_t.onProgress}),blockWriteConcurrency:jt,reduceSingleLeafToSelf:Kt,cidVersion:Bt,onProgress:_t.onProgress}),Ht=_t.treeBuilder??defaultTreeBuilder({wrapWithDirectory:xt,shardSplitThresholdBytes:kt,cidVersion:Bt,onProgress:_t.onProgress});for await(const Wt of Ht(parallelBatch(Vt(At,e),Lt),e))yield{cid:Wt.cid,path:Wt.path,unixfs:Wt.unixfs,size:Wt.size}}var __awaiter$2A=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$8=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}};const hashers={[sha256$7.code]:sha256$7},codecs={[code$5]:cbor};class Cid{static computeCid(e,_t=code$5,At=sha256$7.code){return __awaiter$2A(this,void 0,void 0,function*(){const xt=codecs[_t];if(!xt)throw new DwnError(DwnErrorCode.ComputeCidCodecNotSupported,`codec [${_t}] not supported`);const kt=hashers[At];if(!kt)throw new DwnError(DwnErrorCode.ComputeCidMultihashNotSupported,`multihash code [${At}] not supported`);const Bt=xt.encode(e),Nt=yield kt.digest(Bt);return(yield CID.createV1(xt.code,Nt)).toString()})}static parseCid(e){const _t=CID.parse(e).toV1();if(!codecs[_t.code])throw new DwnError(DwnErrorCode.ParseCidCodecNotSupported,`codec [${_t.code}] not supported`);if(!hashers[_t.multihash.code])throw new DwnError(DwnErrorCode.ParseCidMultihashNotSupported,`multihash code [${_t.multihash.code}] not supported`);return _t}static computeDagPbCidFromBytes(e){var _t,At,xt,kt;return __awaiter$2A(this,void 0,void 0,function*(){const Bt=importer([{content:e}],new BlockstoreMock,{cidVersion:1});let Nt;try{for(var Ut=!0,Lt=__asyncValues$8(Bt),jt;jt=yield Lt.next(),_t=jt.done,!_t;Ut=!0)kt=jt.value,Ut=!1,Nt=kt}catch(Kt){At={error:Kt}}finally{try{!Ut&&!_t&&(xt=Lt.return)&&(yield xt.call(Lt))}finally{if(At)throw At.error}}return Nt?Nt.cid.toString():""})}static computeDagPbCidFromStream(e){var _t,At,xt,kt;return __awaiter$2A(this,void 0,void 0,function*(){const Bt=importer([{content:e}],new BlockstoreMock,{cidVersion:1});let Nt;try{for(var Ut=!0,Lt=__asyncValues$8(Bt),jt;jt=yield Lt.next(),_t=jt.done,!_t;Ut=!0)kt=jt.value,Ut=!1,Nt=kt}catch(Kt){At={error:Kt}}finally{try{!Ut&&!_t&&(xt=Lt.return)&&(yield xt.call(Lt))}finally{if(At)throw At.error}}return Nt?Nt.cid.toString():""})}}var cryptoBrowserify={},browser$e={exports:{}},safeBuffer$2={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function($t,e){var _t=buffer$2,At=_t.Buffer;function xt(Bt,Nt){for(var Ut in Bt)Nt[Ut]=Bt[Ut]}At.from&&At.alloc&&At.allocUnsafe&&At.allocUnsafeSlow?$t.exports=_t:(xt(_t,e),e.Buffer=kt);function kt(Bt,Nt,Ut){return At(Bt,Nt,Ut)}kt.prototype=Object.create(At.prototype),xt(At,kt),kt.from=function(Bt,Nt,Ut){if(typeof Bt=="number")throw new TypeError("Argument must not be a number");return At(Bt,Nt,Ut)},kt.alloc=function(Bt,Nt,Ut){if(typeof Bt!="number")throw new TypeError("Argument must be a number");var Lt=At(Bt);return Nt!==void 0?typeof Ut=="string"?Lt.fill(Nt,Ut):Lt.fill(Nt):Lt.fill(0),Lt},kt.allocUnsafe=function(Bt){if(typeof Bt!="number")throw new TypeError("Argument must be a number");return At(Bt)},kt.allocUnsafeSlow=function(Bt){if(typeof Bt!="number")throw new TypeError("Argument must be a number");return _t.SlowBuffer(Bt)}})(safeBuffer$2,safeBuffer$2.exports);var safeBufferExports$1=safeBuffer$2.exports,MAX_BYTES=65536,MAX_UINT32=4294967295;function oldBrowser$1(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Buffer$G=safeBufferExports$1.Buffer,crypto$6=globalThis.crypto||globalThis.msCrypto;crypto$6&&crypto$6.getRandomValues?browser$e.exports=randomBytes$5:browser$e.exports=oldBrowser$1;function randomBytes$5($t,e){if($t>MAX_UINT32)throw new RangeError("requested too many random bytes");var _t=Buffer$G.allocUnsafe($t);if($t>0)if($t>MAX_BYTES)for(var At=0;At<$t;At+=MAX_BYTES)crypto$6.getRandomValues(_t.slice(At,At+MAX_BYTES));else crypto$6.getRandomValues(_t);return typeof e=="function"?process$9.nextTick(function(){e(null,_t)}):_t}var browserExports$2=browser$e.exports,inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(e,_t){_t&&(e.super_=_t,e.prototype=Object.create(_t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,_t){if(_t){e.super_=_t;var At=function(){};At.prototype=_t.prototype,e.prototype=new At,e.prototype.constructor=e}};var inherits_browserExports=inherits_browser.exports,readableBrowser$1={exports:{}},events={exports:{}},R$1=typeof Reflect=="object"?Reflect:null,ReflectApply=R$1&&typeof R$1.apply=="function"?R$1.apply:function(e,_t,At){return Function.prototype.apply.call(e,_t,At)},ReflectOwnKeys;R$1&&typeof R$1.ownKeys=="function"?ReflectOwnKeys=R$1.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning($t){console&&console.warn&&console.warn($t)}var NumberIsNaN$4=Number.isNaN||function(e){return e!==e};function EventEmitter$2(){EventEmitter$2.init.call(this)}events.exports=EventEmitter$2;events.exports.once=once$6;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener($t){if(typeof $t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof $t)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function($t){if(typeof $t!="number"||$t<0||NumberIsNaN$4($t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+$t+".");defaultMaxListeners=$t}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||NumberIsNaN$4(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners($t){return $t._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:$t._maxListeners}EventEmitter$2.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function(e){for(var _t=[],At=1;At<arguments.length;At++)_t.push(arguments[At]);var xt=e==="error",kt=this._events;if(kt!==void 0)xt=xt&&kt.error===void 0;else if(!xt)return!1;if(xt){var Bt;if(_t.length>0&&(Bt=_t[0]),Bt instanceof Error)throw Bt;var Nt=new Error("Unhandled error."+(Bt?" ("+Bt.message+")":""));throw Nt.context=Bt,Nt}var Ut=kt[e];if(Ut===void 0)return!1;if(typeof Ut=="function")ReflectApply(Ut,this,_t);else for(var Lt=Ut.length,jt=arrayClone(Ut,Lt),At=0;At<Lt;++At)ReflectApply(jt[At],this,_t);return!0};function _addListener($t,e,_t,At){var xt,kt,Bt;if(checkListener(_t),kt=$t._events,kt===void 0?(kt=$t._events=Object.create(null),$t._eventsCount=0):(kt.newListener!==void 0&&($t.emit("newListener",e,_t.listener?_t.listener:_t),kt=$t._events),Bt=kt[e]),Bt===void 0)Bt=kt[e]=_t,++$t._eventsCount;else if(typeof Bt=="function"?Bt=kt[e]=At?[_t,Bt]:[Bt,_t]:At?Bt.unshift(_t):Bt.push(_t),xt=_getMaxListeners($t),xt>0&&Bt.length>xt&&!Bt.warned){Bt.warned=!0;var Nt=new Error("Possible EventEmitter memory leak detected. "+Bt.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");Nt.name="MaxListenersExceededWarning",Nt.emitter=$t,Nt.type=e,Nt.count=Bt.length,ProcessEmitWarning(Nt)}return $t}EventEmitter$2.prototype.addListener=function(e,_t){return _addListener(this,e,_t,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function(e,_t){return _addListener(this,e,_t,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap($t,e,_t){var At={fired:!1,wrapFn:void 0,target:$t,type:e,listener:_t},xt=onceWrapper.bind(At);return xt.listener=_t,At.wrapFn=xt,xt}EventEmitter$2.prototype.once=function(e,_t){return checkListener(_t),this.on(e,_onceWrap(this,e,_t)),this};EventEmitter$2.prototype.prependOnceListener=function(e,_t){return checkListener(_t),this.prependListener(e,_onceWrap(this,e,_t)),this};EventEmitter$2.prototype.removeListener=function(e,_t){var At,xt,kt,Bt,Nt;if(checkListener(_t),xt=this._events,xt===void 0)return this;if(At=xt[e],At===void 0)return this;if(At===_t||At.listener===_t)--this._eventsCount===0?this._events=Object.create(null):(delete xt[e],xt.removeListener&&this.emit("removeListener",e,At.listener||_t));else if(typeof At!="function"){for(kt=-1,Bt=At.length-1;Bt>=0;Bt--)if(At[Bt]===_t||At[Bt].listener===_t){Nt=At[Bt].listener,kt=Bt;break}if(kt<0)return this;kt===0?At.shift():spliceOne(At,kt),At.length===1&&(xt[e]=At[0]),xt.removeListener!==void 0&&this.emit("removeListener",e,Nt||_t)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function(e){var _t,At,xt;if(At=this._events,At===void 0)return this;if(At.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):At[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete At[e]),this;if(arguments.length===0){var kt=Object.keys(At),Bt;for(xt=0;xt<kt.length;++xt)Bt=kt[xt],Bt!=="removeListener"&&this.removeAllListeners(Bt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_t=At[e],typeof _t=="function")this.removeListener(e,_t);else if(_t!==void 0)for(xt=_t.length-1;xt>=0;xt--)this.removeListener(e,_t[xt]);return this};function _listeners($t,e,_t){var At=$t._events;if(At===void 0)return[];var xt=At[e];return xt===void 0?[]:typeof xt=="function"?_t?[xt.listener||xt]:[xt]:_t?unwrapListeners(xt):arrayClone(xt,xt.length)}EventEmitter$2.prototype.listeners=function(e){return _listeners(this,e,!0)};EventEmitter$2.prototype.rawListeners=function(e){return _listeners(this,e,!1)};EventEmitter$2.listenerCount=function($t,e){return typeof $t.listenerCount=="function"?$t.listenerCount(e):listenerCount.call($t,e)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount($t){var e=this._events;if(e!==void 0){var _t=e[$t];if(typeof _t=="function")return 1;if(_t!==void 0)return _t.length}return 0}EventEmitter$2.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone($t,e){for(var _t=new Array(e),At=0;At<e;++At)_t[At]=$t[At];return _t}function spliceOne($t,e){for(;e+1<$t.length;e++)$t[e]=$t[e+1];$t.pop()}function unwrapListeners($t){for(var e=new Array($t.length),_t=0;_t<e.length;++_t)e[_t]=$t[_t].listener||$t[_t];return e}function once$6($t,e){return new Promise(function(_t,At){function xt(Bt){$t.removeListener(e,kt),At(Bt)}function kt(){typeof $t.removeListener=="function"&&$t.removeListener("error",xt),_t([].slice.call(arguments))}eventTargetAgnosticAddListener($t,e,kt,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter($t,xt,{once:!0})})}function addErrorHandlerIfEventEmitter($t,e,_t){typeof $t.on=="function"&&eventTargetAgnosticAddListener($t,"error",e,_t)}function eventTargetAgnosticAddListener($t,e,_t,At){if(typeof $t.on=="function")At.once?$t.once(e,_t):$t.on(e,_t);else if(typeof $t.addEventListener=="function")$t.addEventListener(e,function xt(kt){At.once&&$t.removeEventListener(e,xt),_t(kt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof $t)}var eventsExports=events.exports,streamBrowser$1=eventsExports.EventEmitter,util$6={},types$1={},shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},_t=Symbol("test"),At=Object(_t);if(typeof _t=="string"||Object.prototype.toString.call(_t)!=="[object Symbol]"||Object.prototype.toString.call(At)!=="[object Symbol]")return!1;var xt=42;e[_t]=xt;for(_t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var kt=Object.getOwnPropertySymbols(e);if(kt.length!==1||kt[0]!==_t||!Object.prototype.propertyIsEnumerable.call(e,_t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var Bt=Object.getOwnPropertyDescriptor(e,_t);if(Bt.value!==xt||Bt.enumerable!==!0)return!1}return!0},hasSymbols$2=shams$1,shams=function(){return hasSymbols$2()&&!!Symbol.toStringTag},esErrors=Error,_eval=EvalError,range=RangeError,ref$1=ReferenceError,syntax=SyntaxError,type$9=TypeError,uri$2=URIError,origSymbol=typeof Symbol<"u"&&Symbol,hasSymbolSham=shams$1,hasSymbols$1=function(){return typeof origSymbol!="function"||typeof Symbol!="function"||typeof origSymbol("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:hasSymbolSham()},test={__proto__:null,foo:{}},$Object=Object,hasProto$1=function(){return{__proto__:test}.foo===test.foo&&!(test instanceof $Object)},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",toStr$4=Object.prototype.toString,max=Math.max,funcType="[object Function]",concatty=function(e,_t){for(var At=[],xt=0;xt<e.length;xt+=1)At[xt]=e[xt];for(var kt=0;kt<_t.length;kt+=1)At[kt+e.length]=_t[kt];return At},slicy=function(e,_t){for(var At=[],xt=_t,kt=0;xt<e.length;xt+=1,kt+=1)At[kt]=e[xt];return At},joiny=function($t,e){for(var _t="",At=0;At<$t.length;At+=1)_t+=$t[At],At+1<$t.length&&(_t+=e);return _t},implementation$1=function(e){var _t=this;if(typeof _t!="function"||toStr$4.apply(_t)!==funcType)throw new TypeError(ERROR_MESSAGE+_t);for(var At=slicy(arguments,1),xt,kt=function(){if(this instanceof xt){var jt=_t.apply(this,concatty(At,arguments));return Object(jt)===jt?jt:this}return _t.apply(e,concatty(At,arguments))},Bt=max(0,_t.length-At.length),Nt=[],Ut=0;Ut<Bt;Ut++)Nt[Ut]="$"+Ut;if(xt=Function("binder","return function ("+joiny(Nt,",")+"){ return binder.apply(this,arguments); }")(kt),_t.prototype){var Lt=function(){};Lt.prototype=_t.prototype,xt.prototype=new Lt,Lt.prototype=null}return xt},implementation=implementation$1,functionBind=Function.prototype.bind||implementation,call$1=Function.prototype.call,$hasOwn=Object.prototype.hasOwnProperty,bind$1=functionBind,hasown=bind$1.call(call$1,$hasOwn),undefined$1,$Error=esErrors,$EvalError=_eval,$RangeError=range,$ReferenceError=ref$1,$SyntaxError$1=syntax,$TypeError$2=type$9,$URIError=uri$2,$Function=Function,getEvalledConstructor=function($t){try{return $Function('"use strict"; return ('+$t+").constructor;")()}catch{}},$gOPD$1=Object.getOwnPropertyDescriptor;if($gOPD$1)try{$gOPD$1({},"")}catch{$gOPD$1=null}var throwTypeError=function(){throw new $TypeError$2},ThrowTypeError=$gOPD$1?function(){try{return arguments.callee,throwTypeError}catch{try{return $gOPD$1(arguments,"callee").get}catch{return throwTypeError}}}():throwTypeError,hasSymbols=hasSymbols$1(),hasProto=hasProto$1(),getProto$1=Object.getPrototypeOf||(hasProto?function($t){return $t.__proto__}:null),needsEval={},TypedArray=typeof Uint8Array>"u"||!getProto$1?undefined$1:getProto$1(Uint8Array),INTRINSICS={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols&&getProto$1?getProto$1([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics>"u"?undefined$1:Atomics,"%BigInt%":typeof BigInt>"u"?undefined$1:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?undefined$1:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$Error,"%eval%":eval,"%EvalError%":$EvalError,"%Float32Array%":typeof Float32Array>"u"?undefined$1:Float32Array,"%Float64Array%":typeof Float64Array>"u"?undefined$1:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array>"u"?undefined$1:Int8Array,"%Int16Array%":typeof Int16Array>"u"?undefined$1:Int16Array,"%Int32Array%":typeof Int32Array>"u"?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols&&getProto$1?getProto$1(getProto$1([][Symbol.iterator]())):undefined$1,"%JSON%":typeof JSON=="object"?JSON:undefined$1,"%Map%":typeof Map>"u"?undefined$1:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hasSymbols||!getProto$1?undefined$1:getProto$1(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?undefined$1:Promise,"%Proxy%":typeof Proxy>"u"?undefined$1:Proxy,"%RangeError%":$RangeError,"%ReferenceError%":$ReferenceError,"%Reflect%":typeof Reflect>"u"?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?undefined$1:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hasSymbols||!getProto$1?undefined$1:getProto$1(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols&&getProto$1?getProto$1(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$2,"%Uint8Array%":typeof Uint8Array>"u"?undefined$1:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?undefined$1:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?undefined$1:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?undefined$1:Uint32Array,"%URIError%":$URIError,"%WeakMap%":typeof WeakMap>"u"?undefined$1:WeakMap,"%WeakRef%":typeof WeakRef>"u"?undefined$1:WeakRef,"%WeakSet%":typeof WeakSet>"u"?undefined$1:WeakSet};if(getProto$1)try{null.error}catch($t){var errorProto=getProto$1(getProto$1($t));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function $t(e){var _t;if(e==="%AsyncFunction%")_t=getEvalledConstructor("async function () {}");else if(e==="%GeneratorFunction%")_t=getEvalledConstructor("function* () {}");else if(e==="%AsyncGeneratorFunction%")_t=getEvalledConstructor("async function* () {}");else if(e==="%AsyncGenerator%"){var At=$t("%AsyncGeneratorFunction%");At&&(_t=At.prototype)}else if(e==="%AsyncIteratorPrototype%"){var xt=$t("%AsyncGenerator%");xt&&getProto$1&&(_t=getProto$1(xt.prototype))}return INTRINSICS[e]=_t,_t},LEGACY_ALIASES={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind=functionBind,hasOwn=hasown,$concat=bind.call(Function.call,Array.prototype.concat),$spliceApply=bind.call(Function.apply,Array.prototype.splice),$replace=bind.call(Function.call,String.prototype.replace),$strSlice=bind.call(Function.call,String.prototype.slice),$exec=bind.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(e){var _t=$strSlice(e,0,1),At=$strSlice(e,-1);if(_t==="%"&&At!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if(At==="%"&&_t!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var xt=[];return $replace(e,rePropName,function(kt,Bt,Nt,Ut){xt[xt.length]=Nt?$replace(Ut,reEscapeChar,"$1"):Bt||kt}),xt},getBaseIntrinsic=function(e,_t){var At=e,xt;if(hasOwn(LEGACY_ALIASES,At)&&(xt=LEGACY_ALIASES[At],At="%"+xt[0]+"%"),hasOwn(INTRINSICS,At)){var kt=INTRINSICS[At];if(kt===needsEval&&(kt=doEval(At)),typeof kt>"u"&&!_t)throw new $TypeError$2("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:xt,name:At,value:kt}}throw new $SyntaxError$1("intrinsic "+e+" does not exist!")},getIntrinsic=function(e,_t){if(typeof e!="string"||e.length===0)throw new $TypeError$2("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof _t!="boolean")throw new $TypeError$2('"allowMissing" argument must be a boolean');if($exec(/^%?[^%]*%?$/,e)===null)throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var At=stringToPath(e),xt=At.length>0?At[0]:"",kt=getBaseIntrinsic("%"+xt+"%",_t),Bt=kt.name,Nt=kt.value,Ut=!1,Lt=kt.alias;Lt&&(xt=Lt[0],$spliceApply(At,$concat([0,1],Lt)));for(var jt=1,Kt=!0;jt<At.length;jt+=1){var qt=At[jt],zt=$strSlice(qt,0,1),Vt=$strSlice(qt,-1);if((zt==='"'||zt==="'"||zt==="`"||Vt==='"'||Vt==="'"||Vt==="`")&&zt!==Vt)throw new $SyntaxError$1("property names with quotes must have matching quotes");if((qt==="constructor"||!Kt)&&(Ut=!0),xt+="."+qt,Bt="%"+xt+"%",hasOwn(INTRINSICS,Bt))Nt=INTRINSICS[Bt];else if(Nt!=null){if(!(qt in Nt)){if(!_t)throw new $TypeError$2("base intrinsic for "+e+" exists, but the property is not available.");return}if($gOPD$1&&jt+1>=At.length){var Ht=$gOPD$1(Nt,qt);Kt=!!Ht,Kt&&"get"in Ht&&!("originalValue"in Ht.get)?Nt=Ht.get:Nt=Nt[qt]}else Kt=hasOwn(Nt,qt),Nt=Nt[qt];Kt&&!Ut&&(INTRINSICS[Bt]=Nt)}}return Nt},callBind$2={exports:{}},esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var $t=getIntrinsic,e=$t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return esDefineProperty=e,esDefineProperty}var GetIntrinsic$3=getIntrinsic,$gOPD=GetIntrinsic$3("%Object.getOwnPropertyDescriptor%",!0);if($gOPD)try{$gOPD([],"length")}catch{$gOPD=null}var gopd$1=$gOPD,$defineProperty$1=requireEsDefineProperty(),$SyntaxError=syntax,$TypeError$1=type$9,gopd=gopd$1,defineDataProperty=function(e,_t,At){if(!e||typeof e!="object"&&typeof e!="function")throw new $TypeError$1("`obj` must be an object or a function`");if(typeof _t!="string"&&typeof _t!="symbol")throw new $TypeError$1("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $TypeError$1("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $TypeError$1("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $TypeError$1("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $TypeError$1("`loose`, if provided, must be a boolean");var xt=arguments.length>3?arguments[3]:null,kt=arguments.length>4?arguments[4]:null,Bt=arguments.length>5?arguments[5]:null,Nt=arguments.length>6?arguments[6]:!1,Ut=!!gopd&&gopd(e,_t);if($defineProperty$1)$defineProperty$1(e,_t,{configurable:Bt===null&&Ut?Ut.configurable:!Bt,enumerable:xt===null&&Ut?Ut.enumerable:!xt,value:At,writable:kt===null&&Ut?Ut.writable:!kt});else if(Nt||!xt&&!kt&&!Bt)e[_t]=At;else throw new $SyntaxError("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$defineProperty=requireEsDefineProperty(),hasPropertyDescriptors=function(){return!!$defineProperty};hasPropertyDescriptors.hasArrayLengthDefineBug=function(){if(!$defineProperty)return null;try{return $defineProperty([],"length",{value:1}).length!==1}catch{return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors,GetIntrinsic$2=getIntrinsic,define=defineDataProperty,hasDescriptors=hasPropertyDescriptors_1(),gOPD$1=gopd$1,$TypeError=type$9,$floor=GetIntrinsic$2("%Math.floor%"),setFunctionLength=function(e,_t){if(typeof e!="function")throw new $TypeError("`fn` is not a function");if(typeof _t!="number"||_t<0||_t>4294967295||$floor(_t)!==_t)throw new $TypeError("`length` must be a positive 32-bit integer");var At=arguments.length>2&&!!arguments[2],xt=!0,kt=!0;if("length"in e&&gOPD$1){var Bt=gOPD$1(e,"length");Bt&&!Bt.configurable&&(xt=!1),Bt&&!Bt.writable&&(kt=!1)}return(xt||kt||!At)&&(hasDescriptors?define(e,"length",_t,!0,!0):define(e,"length",_t)),e};(function($t){var e=functionBind,_t=getIntrinsic,At=setFunctionLength,xt=type$9,kt=_t("%Function.prototype.apply%"),Bt=_t("%Function.prototype.call%"),Nt=_t("%Reflect.apply%",!0)||e.call(Bt,kt),Ut=requireEsDefineProperty(),Lt=_t("%Math.max%");$t.exports=function(qt){if(typeof qt!="function")throw new xt("a function is required");var zt=Nt(e,Bt,arguments);return At(zt,1+Lt(0,qt.length-(arguments.length-1)),!0)};var jt=function(){return Nt(e,kt,arguments)};Ut?Ut($t.exports,"apply",{value:jt}):$t.exports.apply=jt})(callBind$2);var callBindExports=callBind$2.exports,GetIntrinsic$1=getIntrinsic,callBind$1=callBindExports,$indexOf$1=callBind$1(GetIntrinsic$1("String.prototype.indexOf")),callBound$2=function(e,_t){var At=GetIntrinsic$1(e,!!_t);return typeof At=="function"&&$indexOf$1(e,".prototype.")>-1?callBind$1(At):At},hasToStringTag$3=shams(),callBound$1=callBound$2,$toString$1=callBound$1("Object.prototype.toString"),isStandardArguments=function(e){return hasToStringTag$3&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:$toString$1(e)==="[object Arguments]"},isLegacyArguments=function(e){return isStandardArguments(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&$toString$1(e)!=="[object Array]"&&$toString$1(e.callee)==="[object Function]"},supportsStandardArguments=function(){return isStandardArguments(arguments)}();isStandardArguments.isLegacyArguments=isLegacyArguments;var isArguments=supportsStandardArguments?isStandardArguments:isLegacyArguments,toStr$3=Object.prototype.toString,fnToStr$1=Function.prototype.toString,isFnRegex=/^\s*(?:function)?\*/,hasToStringTag$2=shams(),getProto=Object.getPrototypeOf,getGeneratorFunc=function(){if(!hasToStringTag$2)return!1;try{return Function("return function*() {}")()}catch{}},GeneratorFunction,isGeneratorFunction=function(e){if(typeof e!="function")return!1;if(isFnRegex.test(fnToStr$1.call(e)))return!0;if(!hasToStringTag$2){var _t=toStr$3.call(e);return _t==="[object GeneratorFunction]"}if(!getProto)return!1;if(typeof GeneratorFunction>"u"){var At=getGeneratorFunc();GeneratorFunction=At?getProto(At):!1}return getProto(e)===GeneratorFunction},fnToStr=Function.prototype.toString,reflectApply=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,badArrayLike,isCallableMarker;if(typeof reflectApply=="function"&&typeof Object.defineProperty=="function")try{badArrayLike=Object.defineProperty({},"length",{get:function(){throw isCallableMarker}}),isCallableMarker={},reflectApply(function(){throw 42},null,badArrayLike)}catch($t){$t!==isCallableMarker&&(reflectApply=null)}else reflectApply=null;var constructorRegex=/^\s*class\b/,isES6ClassFn=function(e){try{var _t=fnToStr.call(e);return constructorRegex.test(_t)}catch{return!1}},tryFunctionObject=function(e){try{return isES6ClassFn(e)?!1:(fnToStr.call(e),!0)}catch{return!1}},toStr$2=Object.prototype.toString,objectClass="[object Object]",fnClass="[object Function]",genClass="[object GeneratorFunction]",ddaClass="[object HTMLAllCollection]",ddaClass2="[object HTML document.all class]",ddaClass3="[object HTMLCollection]",hasToStringTag$1=typeof Symbol=="function"&&!!Symbol.toStringTag,isIE68=!(0 in[,]),isDDA=function(){return!1};if(typeof document=="object"){var all=document.all;toStr$2.call(all)===toStr$2.call(document.all)&&(isDDA=function(e){if((isIE68||!e)&&(typeof e>"u"||typeof e=="object"))try{var _t=toStr$2.call(e);return(_t===ddaClass||_t===ddaClass2||_t===ddaClass3||_t===objectClass)&&e("")==null}catch{}return!1})}var isCallable$1=reflectApply?function(e){if(isDDA(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{reflectApply(e,null,badArrayLike)}catch(_t){if(_t!==isCallableMarker)return!1}return!isES6ClassFn(e)&&tryFunctionObject(e)}:function(e){if(isDDA(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(hasToStringTag$1)return tryFunctionObject(e);if(isES6ClassFn(e))return!1;var _t=toStr$2.call(e);return _t!==fnClass&&_t!==genClass&&!/^\[object HTML/.test(_t)?!1:tryFunctionObject(e)},isCallable=isCallable$1,toStr$1=Object.prototype.toString,hasOwnProperty$1=Object.prototype.hasOwnProperty,forEachArray=function(e,_t,At){for(var xt=0,kt=e.length;xt<kt;xt++)hasOwnProperty$1.call(e,xt)&&(At==null?_t(e[xt],xt,e):_t.call(At,e[xt],xt,e))},forEachString=function(e,_t,At){for(var xt=0,kt=e.length;xt<kt;xt++)At==null?_t(e.charAt(xt),xt,e):_t.call(At,e.charAt(xt),xt,e)},forEachObject=function(e,_t,At){for(var xt in e)hasOwnProperty$1.call(e,xt)&&(At==null?_t(e[xt],xt,e):_t.call(At,e[xt],xt,e))},forEach$3=function(e,_t,At){if(!isCallable(_t))throw new TypeError("iterator must be a function");var xt;arguments.length>=3&&(xt=At),toStr$1.call(e)==="[object Array]"?forEachArray(e,_t,xt):typeof e=="string"?forEachString(e,_t,xt):forEachObject(e,_t,xt)},forEach_1=forEach$3,possibleTypedArrayNames=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],possibleNames=possibleTypedArrayNames,g$2=globalThis,availableTypedArrays$1=function(){for(var e=[],_t=0;_t<possibleNames.length;_t++)typeof g$2[possibleNames[_t]]=="function"&&(e[e.length]=possibleNames[_t]);return e},forEach$2=forEach_1,availableTypedArrays=availableTypedArrays$1,callBind=callBindExports,callBound=callBound$2,gOPD=gopd$1,$toString=callBound("Object.prototype.toString"),hasToStringTag=shams(),g$1=globalThis,typedArrays=availableTypedArrays(),$slice=callBound("String.prototype.slice"),getPrototypeOf=Object.getPrototypeOf,$indexOf=callBound("Array.prototype.indexOf",!0)||function(e,_t){for(var At=0;At<e.length;At+=1)if(e[At]===_t)return At;return-1},cache={__proto__:null};hasToStringTag&&gOPD&&getPrototypeOf?forEach$2(typedArrays,function($t){var e=new g$1[$t];if(Symbol.toStringTag in e){var _t=getPrototypeOf(e),At=gOPD(_t,Symbol.toStringTag);if(!At){var xt=getPrototypeOf(_t);At=gOPD(xt,Symbol.toStringTag)}cache["$"+$t]=callBind(At.get)}}):forEach$2(typedArrays,function($t){var e=new g$1[$t],_t=e.slice||e.set;_t&&(cache["$"+$t]=callBind(_t))});var tryTypedArrays=function(e){var _t=!1;return forEach$2(cache,function(At,xt){if(!_t)try{"$"+At(e)===xt&&(_t=$slice(xt,1))}catch{}}),_t},trySlices=function(e){var _t=!1;return forEach$2(cache,function(At,xt){if(!_t)try{At(e),_t=$slice(xt,1)}catch{}}),_t},whichTypedArray$1=function(e){if(!e||typeof e!="object")return!1;if(!hasToStringTag){var _t=$slice($toString(e),8,-1);return $indexOf(typedArrays,_t)>-1?_t:_t!=="Object"?!1:trySlices(e)}return gOPD?tryTypedArrays(e):null},whichTypedArray=whichTypedArray$1,isTypedArray=function(e){return!!whichTypedArray(e)};(function($t){var e=isArguments,_t=isGeneratorFunction,At=whichTypedArray$1,xt=isTypedArray;function kt(jr){return jr.call.bind(jr)}var Bt=typeof BigInt<"u",Nt=typeof Symbol<"u",Ut=kt(Object.prototype.toString),Lt=kt(Number.prototype.valueOf),jt=kt(String.prototype.valueOf),Kt=kt(Boolean.prototype.valueOf);if(Bt)var qt=kt(BigInt.prototype.valueOf);if(Nt)var zt=kt(Symbol.prototype.valueOf);function Vt(jr,Hr){if(typeof jr!="object")return!1;try{return Hr(jr),!0}catch{return!1}}$t.isArgumentsObject=e,$t.isGeneratorFunction=_t,$t.isTypedArray=xt;function Ht(jr){return typeof Promise<"u"&&jr instanceof Promise||jr!==null&&typeof jr=="object"&&typeof jr.then=="function"&&typeof jr.catch=="function"}$t.isPromise=Ht;function Wt(jr){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(jr):xt(jr)||br(jr)}$t.isArrayBufferView=Wt;function Qt(jr){return At(jr)==="Uint8Array"}$t.isUint8Array=Qt;function Xt(jr){return At(jr)==="Uint8ClampedArray"}$t.isUint8ClampedArray=Xt;function Jt(jr){return At(jr)==="Uint16Array"}$t.isUint16Array=Jt;function tr(jr){return At(jr)==="Uint32Array"}$t.isUint32Array=tr;function dr(jr){return At(jr)==="Int8Array"}$t.isInt8Array=dr;function vr(jr){return At(jr)==="Int16Array"}$t.isInt16Array=vr;function $r(jr){return At(jr)==="Int32Array"}$t.isInt32Array=$r;function Ir(jr){return At(jr)==="Float32Array"}$t.isFloat32Array=Ir;function Rr(jr){return At(jr)==="Float64Array"}$t.isFloat64Array=Rr;function Nr(jr){return At(jr)==="BigInt64Array"}$t.isBigInt64Array=Nr;function kr(jr){return At(jr)==="BigUint64Array"}$t.isBigUint64Array=kr;function lr(jr){return Ut(jr)==="[object Map]"}lr.working=typeof Map<"u"&&lr(new Map);function ir(jr){return typeof Map>"u"?!1:lr.working?lr(jr):jr instanceof Map}$t.isMap=ir;function er(jr){return Ut(jr)==="[object Set]"}er.working=typeof Set<"u"&&er(new Set);function rr(jr){return typeof Set>"u"?!1:er.working?er(jr):jr instanceof Set}$t.isSet=rr;function yr(jr){return Ut(jr)==="[object WeakMap]"}yr.working=typeof WeakMap<"u"&&yr(new WeakMap);function fr(jr){return typeof WeakMap>"u"?!1:yr.working?yr(jr):jr instanceof WeakMap}$t.isWeakMap=fr;function gr(jr){return Ut(jr)==="[object WeakSet]"}gr.working=typeof WeakSet<"u"&&gr(new WeakSet);function ar(jr){return gr(jr)}$t.isWeakSet=ar;function nr(jr){return Ut(jr)==="[object ArrayBuffer]"}nr.working=typeof ArrayBuffer<"u"&&nr(new ArrayBuffer);function ur(jr){return typeof ArrayBuffer>"u"?!1:nr.working?nr(jr):jr instanceof ArrayBuffer}$t.isArrayBuffer=ur;function pr(jr){return Ut(jr)==="[object DataView]"}pr.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&pr(new DataView(new ArrayBuffer(1),0,1));function br(jr){return typeof DataView>"u"?!1:pr.working?pr(jr):jr instanceof DataView}$t.isDataView=br;var Sr=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function Pr(jr){return Ut(jr)==="[object SharedArrayBuffer]"}function Tr(jr){return typeof Sr>"u"?!1:(typeof Pr.working>"u"&&(Pr.working=Pr(new Sr)),Pr.working?Pr(jr):jr instanceof Sr)}$t.isSharedArrayBuffer=Tr;function wr(jr){return Ut(jr)==="[object AsyncFunction]"}$t.isAsyncFunction=wr;function Ar(jr){return Ut(jr)==="[object Map Iterator]"}$t.isMapIterator=Ar;function Mr(jr){return Ut(jr)==="[object Set Iterator]"}$t.isSetIterator=Mr;function Ur(jr){return Ut(jr)==="[object Generator]"}$t.isGeneratorObject=Ur;function Or(jr){return Ut(jr)==="[object WebAssembly.Module]"}$t.isWebAssemblyCompiledModule=Or;function Cr(jr){return Vt(jr,Lt)}$t.isNumberObject=Cr;function Er(jr){return Vt(jr,jt)}$t.isStringObject=Er;function Br(jr){return Vt(jr,Kt)}$t.isBooleanObject=Br;function Lr(jr){return Bt&&Vt(jr,qt)}$t.isBigIntObject=Lr;function xr(jr){return Nt&&Vt(jr,zt)}$t.isSymbolObject=xr;function _r(jr){return Cr(jr)||Er(jr)||Br(jr)||Lr(jr)||xr(jr)}$t.isBoxedPrimitive=_r;function Dr(jr){return typeof Uint8Array<"u"&&(ur(jr)||Tr(jr))}$t.isAnyArrayBuffer=Dr,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(jr){Object.defineProperty($t,jr,{enumerable:!1,value:function(){throw new Error(jr+" is not supported in userland")}})})})(types$1);var isBufferBrowser=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"};(function($t){var e={},_t=Object.getOwnPropertyDescriptors||function(Sr){for(var Pr=Object.keys(Sr),Tr={},wr=0;wr<Pr.length;wr++)Tr[Pr[wr]]=Object.getOwnPropertyDescriptor(Sr,Pr[wr]);return Tr},At=/%[sdj%]/g;$t.format=function(br){if(!vr(br)){for(var Sr=[],Pr=0;Pr<arguments.length;Pr++)Sr.push(Nt(arguments[Pr]));return Sr.join(" ")}for(var Pr=1,Tr=arguments,wr=Tr.length,Ar=String(br).replace(At,function(Ur){if(Ur==="%%")return"%";if(Pr>=wr)return Ur;switch(Ur){case"%s":return String(Tr[Pr++]);case"%d":return Number(Tr[Pr++]);case"%j":try{return JSON.stringify(Tr[Pr++])}catch{return"[Circular]"}default:return Ur}}),Mr=Tr[Pr];Pr<wr;Mr=Tr[++Pr])Jt(Mr)||!Nr(Mr)?Ar+=" "+Mr:Ar+=" "+Nt(Mr);return Ar},$t.deprecate=function(br,Sr){if(typeof process$9<"u"&&process$9.noDeprecation===!0)return br;if(typeof process$9>"u")return function(){return $t.deprecate(br,Sr).apply(this,arguments)};var Pr=!1;function Tr(){if(!Pr){if(process$9.throwDeprecation)throw new Error(Sr);process$9.traceDeprecation?console.trace(Sr):console.error(Sr),Pr=!0}return br.apply(this,arguments)}return Tr};var xt={},kt=/^$/;if(e.NODE_DEBUG){var Bt=e.NODE_DEBUG;Bt=Bt.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),kt=new RegExp("^"+Bt+"$","i")}$t.debuglog=function(br){if(br=br.toUpperCase(),!xt[br])if(kt.test(br)){var Sr=process$9.pid;xt[br]=function(){var Pr=$t.format.apply($t,arguments);console.error("%s %d: %s",br,Sr,Pr)}}else xt[br]=function(){};return xt[br]};function Nt(br,Sr){var Pr={seen:[],stylize:Lt};return arguments.length>=3&&(Pr.depth=arguments[2]),arguments.length>=4&&(Pr.colors=arguments[3]),Xt(Sr)?Pr.showHidden=Sr:Sr&&$t._extend(Pr,Sr),Ir(Pr.showHidden)&&(Pr.showHidden=!1),Ir(Pr.depth)&&(Pr.depth=2),Ir(Pr.colors)&&(Pr.colors=!1),Ir(Pr.customInspect)&&(Pr.customInspect=!0),Pr.colors&&(Pr.stylize=Ut),Kt(Pr,br,Pr.depth)}$t.inspect=Nt,Nt.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Nt.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function Ut(br,Sr){var Pr=Nt.styles[Sr];return Pr?"\x1B["+Nt.colors[Pr][0]+"m"+br+"\x1B["+Nt.colors[Pr][1]+"m":br}function Lt(br,Sr){return br}function jt(br){var Sr={};return br.forEach(function(Pr,Tr){Sr[Pr]=!0}),Sr}function Kt(br,Sr,Pr){if(br.customInspect&&Sr&&ir(Sr.inspect)&&Sr.inspect!==$t.inspect&&!(Sr.constructor&&Sr.constructor.prototype===Sr)){var Tr=Sr.inspect(Pr,br);return vr(Tr)||(Tr=Kt(br,Tr,Pr)),Tr}var wr=qt(br,Sr);if(wr)return wr;var Ar=Object.keys(Sr),Mr=jt(Ar);if(br.showHidden&&(Ar=Object.getOwnPropertyNames(Sr)),lr(Sr)&&(Ar.indexOf("message")>=0||Ar.indexOf("description")>=0))return zt(Sr);if(Ar.length===0){if(ir(Sr)){var Ur=Sr.name?": "+Sr.name:"";return br.stylize("[Function"+Ur+"]","special")}if(Rr(Sr))return br.stylize(RegExp.prototype.toString.call(Sr),"regexp");if(kr(Sr))return br.stylize(Date.prototype.toString.call(Sr),"date");if(lr(Sr))return zt(Sr)}var Or="",Cr=!1,Er=["{","}"];if(Qt(Sr)&&(Cr=!0,Er=["[","]"]),ir(Sr)){var Br=Sr.name?": "+Sr.name:"";Or=" [Function"+Br+"]"}if(Rr(Sr)&&(Or=" "+RegExp.prototype.toString.call(Sr)),kr(Sr)&&(Or=" "+Date.prototype.toUTCString.call(Sr)),lr(Sr)&&(Or=" "+zt(Sr)),Ar.length===0&&(!Cr||Sr.length==0))return Er[0]+Or+Er[1];if(Pr<0)return Rr(Sr)?br.stylize(RegExp.prototype.toString.call(Sr),"regexp"):br.stylize("[Object]","special");br.seen.push(Sr);var Lr;return Cr?Lr=Vt(br,Sr,Pr,Mr,Ar):Lr=Ar.map(function(xr){return Ht(br,Sr,Pr,Mr,xr,Cr)}),br.seen.pop(),Wt(Lr,Or,Er)}function qt(br,Sr){if(Ir(Sr))return br.stylize("undefined","undefined");if(vr(Sr)){var Pr="'"+JSON.stringify(Sr).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return br.stylize(Pr,"string")}if(dr(Sr))return br.stylize(""+Sr,"number");if(Xt(Sr))return br.stylize(""+Sr,"boolean");if(Jt(Sr))return br.stylize("null","null")}function zt(br){return"["+Error.prototype.toString.call(br)+"]"}function Vt(br,Sr,Pr,Tr,wr){for(var Ar=[],Mr=0,Ur=Sr.length;Mr<Ur;++Mr)ar(Sr,String(Mr))?Ar.push(Ht(br,Sr,Pr,Tr,String(Mr),!0)):Ar.push("");return wr.forEach(function(Or){Or.match(/^\d+$/)||Ar.push(Ht(br,Sr,Pr,Tr,Or,!0))}),Ar}function Ht(br,Sr,Pr,Tr,wr,Ar){var Mr,Ur,Or;if(Or=Object.getOwnPropertyDescriptor(Sr,wr)||{value:Sr[wr]},Or.get?Or.set?Ur=br.stylize("[Getter/Setter]","special"):Ur=br.stylize("[Getter]","special"):Or.set&&(Ur=br.stylize("[Setter]","special")),ar(Tr,wr)||(Mr="["+wr+"]"),Ur||(br.seen.indexOf(Or.value)<0?(Jt(Pr)?Ur=Kt(br,Or.value,null):Ur=Kt(br,Or.value,Pr-1),Ur.indexOf(`
`)>-1&&(Ar?Ur=Ur.split(`
`).map(function(Cr){return"  "+Cr}).join(`
`).slice(2):Ur=`
`+Ur.split(`
`).map(function(Cr){return"   "+Cr}).join(`
`))):Ur=br.stylize("[Circular]","special")),Ir(Mr)){if(Ar&&wr.match(/^\d+$/))return Ur;Mr=JSON.stringify(""+wr),Mr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Mr=Mr.slice(1,-1),Mr=br.stylize(Mr,"name")):(Mr=Mr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Mr=br.stylize(Mr,"string"))}return Mr+": "+Ur}function Wt(br,Sr,Pr){var Tr=br.reduce(function(wr,Ar){return Ar.indexOf(`
`)>=0,wr+Ar.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Tr>60?Pr[0]+(Sr===""?"":Sr+`
 `)+" "+br.join(`,
  `)+" "+Pr[1]:Pr[0]+Sr+" "+br.join(", ")+" "+Pr[1]}$t.types=types$1;function Qt(br){return Array.isArray(br)}$t.isArray=Qt;function Xt(br){return typeof br=="boolean"}$t.isBoolean=Xt;function Jt(br){return br===null}$t.isNull=Jt;function tr(br){return br==null}$t.isNullOrUndefined=tr;function dr(br){return typeof br=="number"}$t.isNumber=dr;function vr(br){return typeof br=="string"}$t.isString=vr;function $r(br){return typeof br=="symbol"}$t.isSymbol=$r;function Ir(br){return br===void 0}$t.isUndefined=Ir;function Rr(br){return Nr(br)&&rr(br)==="[object RegExp]"}$t.isRegExp=Rr,$t.types.isRegExp=Rr;function Nr(br){return typeof br=="object"&&br!==null}$t.isObject=Nr;function kr(br){return Nr(br)&&rr(br)==="[object Date]"}$t.isDate=kr,$t.types.isDate=kr;function lr(br){return Nr(br)&&(rr(br)==="[object Error]"||br instanceof Error)}$t.isError=lr,$t.types.isNativeError=lr;function ir(br){return typeof br=="function"}$t.isFunction=ir;function er(br){return br===null||typeof br=="boolean"||typeof br=="number"||typeof br=="string"||typeof br=="symbol"||typeof br>"u"}$t.isPrimitive=er,$t.isBuffer=isBufferBrowser;function rr(br){return Object.prototype.toString.call(br)}function yr(br){return br<10?"0"+br.toString(10):br.toString(10)}var fr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function gr(){var br=new Date,Sr=[yr(br.getHours()),yr(br.getMinutes()),yr(br.getSeconds())].join(":");return[br.getDate(),fr[br.getMonth()],Sr].join(" ")}$t.log=function(){console.log("%s - %s",gr(),$t.format.apply($t,arguments))},$t.inherits=inherits_browserExports,$t._extend=function(br,Sr){if(!Sr||!Nr(Sr))return br;for(var Pr=Object.keys(Sr),Tr=Pr.length;Tr--;)br[Pr[Tr]]=Sr[Pr[Tr]];return br};function ar(br,Sr){return Object.prototype.hasOwnProperty.call(br,Sr)}var nr=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;$t.promisify=function(Sr){if(typeof Sr!="function")throw new TypeError('The "original" argument must be of type Function');if(nr&&Sr[nr]){var Pr=Sr[nr];if(typeof Pr!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Pr,nr,{value:Pr,enumerable:!1,writable:!1,configurable:!0}),Pr}function Pr(){for(var Tr,wr,Ar=new Promise(function(Or,Cr){Tr=Or,wr=Cr}),Mr=[],Ur=0;Ur<arguments.length;Ur++)Mr.push(arguments[Ur]);Mr.push(function(Or,Cr){Or?wr(Or):Tr(Cr)});try{Sr.apply(this,Mr)}catch(Or){wr(Or)}return Ar}return Object.setPrototypeOf(Pr,Object.getPrototypeOf(Sr)),nr&&Object.defineProperty(Pr,nr,{value:Pr,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Pr,_t(Sr))},$t.promisify.custom=nr;function ur(br,Sr){if(!br){var Pr=new Error("Promise was rejected with a falsy value");Pr.reason=br,br=Pr}return Sr(br)}function pr(br){if(typeof br!="function")throw new TypeError('The "original" argument must be of type Function');function Sr(){for(var Pr=[],Tr=0;Tr<arguments.length;Tr++)Pr.push(arguments[Tr]);var wr=Pr.pop();if(typeof wr!="function")throw new TypeError("The last argument must be of type Function");var Ar=this,Mr=function(){return wr.apply(Ar,arguments)};br.apply(this,Pr).then(function(Ur){process$9.nextTick(Mr.bind(null,null,Ur))},function(Ur){process$9.nextTick(ur.bind(null,Ur,Mr))})}return Object.setPrototypeOf(Sr,Object.getPrototypeOf(br)),Object.defineProperties(Sr,_t(br)),Sr}$t.callbackify=pr})(util$6);var buffer_list$2,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list$2;hasRequiredBuffer_list=1;function $t(Vt,Ht){var Wt=Object.keys(Vt);if(Object.getOwnPropertySymbols){var Qt=Object.getOwnPropertySymbols(Vt);Ht&&(Qt=Qt.filter(function(Xt){return Object.getOwnPropertyDescriptor(Vt,Xt).enumerable})),Wt.push.apply(Wt,Qt)}return Wt}function e(Vt){for(var Ht=1;Ht<arguments.length;Ht++){var Wt=arguments[Ht]!=null?arguments[Ht]:{};Ht%2?$t(Object(Wt),!0).forEach(function(Qt){_t(Vt,Qt,Wt[Qt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Vt,Object.getOwnPropertyDescriptors(Wt)):$t(Object(Wt)).forEach(function(Qt){Object.defineProperty(Vt,Qt,Object.getOwnPropertyDescriptor(Wt,Qt))})}return Vt}function _t(Vt,Ht,Wt){return Ht=Bt(Ht),Ht in Vt?Object.defineProperty(Vt,Ht,{value:Wt,enumerable:!0,configurable:!0,writable:!0}):Vt[Ht]=Wt,Vt}function At(Vt,Ht){if(!(Vt instanceof Ht))throw new TypeError("Cannot call a class as a function")}function xt(Vt,Ht){for(var Wt=0;Wt<Ht.length;Wt++){var Qt=Ht[Wt];Qt.enumerable=Qt.enumerable||!1,Qt.configurable=!0,"value"in Qt&&(Qt.writable=!0),Object.defineProperty(Vt,Bt(Qt.key),Qt)}}function kt(Vt,Ht,Wt){return Ht&&xt(Vt.prototype,Ht),Object.defineProperty(Vt,"prototype",{writable:!1}),Vt}function Bt(Vt){var Ht=Nt(Vt,"string");return typeof Ht=="symbol"?Ht:String(Ht)}function Nt(Vt,Ht){if(typeof Vt!="object"||Vt===null)return Vt;var Wt=Vt[Symbol.toPrimitive];if(Wt!==void 0){var Qt=Wt.call(Vt,Ht||"default");if(typeof Qt!="object")return Qt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Ht==="string"?String:Number)(Vt)}var Ut=buffer$2,Lt=Ut.Buffer,jt=util$6,Kt=jt.inspect,qt=Kt&&Kt.custom||"inspect";function zt(Vt,Ht,Wt){Lt.prototype.copy.call(Vt,Ht,Wt)}return buffer_list$2=function(){function Vt(){At(this,Vt),this.head=null,this.tail=null,this.length=0}return kt(Vt,[{key:"push",value:function(Wt){var Qt={data:Wt,next:null};this.length>0?this.tail.next=Qt:this.head=Qt,this.tail=Qt,++this.length}},{key:"unshift",value:function(Wt){var Qt={data:Wt,next:this.head};this.length===0&&(this.tail=Qt),this.head=Qt,++this.length}},{key:"shift",value:function(){if(this.length!==0){var Wt=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,Wt}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(Wt){if(this.length===0)return"";for(var Qt=this.head,Xt=""+Qt.data;Qt=Qt.next;)Xt+=Wt+Qt.data;return Xt}},{key:"concat",value:function(Wt){if(this.length===0)return Lt.alloc(0);for(var Qt=Lt.allocUnsafe(Wt>>>0),Xt=this.head,Jt=0;Xt;)zt(Xt.data,Qt,Jt),Jt+=Xt.data.length,Xt=Xt.next;return Qt}},{key:"consume",value:function(Wt,Qt){var Xt;return Wt<this.head.data.length?(Xt=this.head.data.slice(0,Wt),this.head.data=this.head.data.slice(Wt)):Wt===this.head.data.length?Xt=this.shift():Xt=Qt?this._getString(Wt):this._getBuffer(Wt),Xt}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(Wt){var Qt=this.head,Xt=1,Jt=Qt.data;for(Wt-=Jt.length;Qt=Qt.next;){var tr=Qt.data,dr=Wt>tr.length?tr.length:Wt;if(dr===tr.length?Jt+=tr:Jt+=tr.slice(0,Wt),Wt-=dr,Wt===0){dr===tr.length?(++Xt,Qt.next?this.head=Qt.next:this.head=this.tail=null):(this.head=Qt,Qt.data=tr.slice(dr));break}++Xt}return this.length-=Xt,Jt}},{key:"_getBuffer",value:function(Wt){var Qt=Lt.allocUnsafe(Wt),Xt=this.head,Jt=1;for(Xt.data.copy(Qt),Wt-=Xt.data.length;Xt=Xt.next;){var tr=Xt.data,dr=Wt>tr.length?tr.length:Wt;if(tr.copy(Qt,Qt.length-Wt,0,dr),Wt-=dr,Wt===0){dr===tr.length?(++Jt,Xt.next?this.head=Xt.next:this.head=this.tail=null):(this.head=Xt,Xt.data=tr.slice(dr));break}++Jt}return this.length-=Jt,Qt}},{key:qt,value:function(Wt,Qt){return Kt(this,e(e({},Qt),{},{depth:0,customInspect:!1}))}}]),Vt}(),buffer_list$2}function destroy$3($t,e){var _t=this,At=this._readableState&&this._readableState.destroyed,xt=this._writableState&&this._writableState.destroyed;return At||xt?(e?e($t):$t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process$9.nextTick(emitErrorNT$3,this,$t)):process$9.nextTick(emitErrorNT$3,this,$t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy($t||null,function(kt){!e&&kt?_t._writableState?_t._writableState.errorEmitted?process$9.nextTick(emitCloseNT$2,_t):(_t._writableState.errorEmitted=!0,process$9.nextTick(emitErrorAndCloseNT,_t,kt)):process$9.nextTick(emitErrorAndCloseNT,_t,kt):e?(process$9.nextTick(emitCloseNT$2,_t),e(kt)):process$9.nextTick(emitCloseNT$2,_t)}),this)}function emitErrorAndCloseNT($t,e){emitErrorNT$3($t,e),emitCloseNT$2($t)}function emitCloseNT$2($t){$t._writableState&&!$t._writableState.emitClose||$t._readableState&&!$t._readableState.emitClose||$t.emit("close")}function undestroy$3(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT$3($t,e){$t.emit("error",e)}function errorOrDestroy$2($t,e){var _t=$t._readableState,At=$t._writableState;_t&&_t.autoDestroy||At&&At.autoDestroy?$t.destroy(e):$t.emit("error",e)}var destroy_1$3={destroy:destroy$3,undestroy:undestroy$3,errorOrDestroy:errorOrDestroy$2},errorsBrowser={};function _inheritsLoose($t,e){$t.prototype=Object.create(e.prototype),$t.prototype.constructor=$t,$t.__proto__=e}var codes$4={};function createErrorType($t,e,_t){_t||(_t=Error);function At(kt,Bt,Nt){return typeof e=="string"?e:e(kt,Bt,Nt)}var xt=function(kt){_inheritsLoose(Bt,kt);function Bt(Nt,Ut,Lt){return kt.call(this,At(Nt,Ut,Lt))||this}return Bt}(_t);xt.prototype.name=_t.name,xt.prototype.code=$t,codes$4[$t]=xt}function oneOf$1($t,e){if(Array.isArray($t)){var _t=$t.length;return $t=$t.map(function(At){return String(At)}),_t>2?"one of ".concat(e," ").concat($t.slice(0,_t-1).join(", "),", or ")+$t[_t-1]:_t===2?"one of ".concat(e," ").concat($t[0]," or ").concat($t[1]):"of ".concat(e," ").concat($t[0])}else return"of ".concat(e," ").concat(String($t))}function startsWith($t,e,_t){return $t.substr(0,e.length)===e}function endsWith($t,e,_t){return(_t===void 0||_t>$t.length)&&(_t=$t.length),$t.substring(_t-e.length,_t)===e}function includes($t,e,_t){return typeof _t!="number"&&(_t=0),_t+e.length>$t.length?!1:$t.indexOf(e,_t)!==-1}createErrorType("ERR_INVALID_OPT_VALUE",function($t,e){return'The value "'+e+'" is invalid for option "'+$t+'"'},TypeError);createErrorType("ERR_INVALID_ARG_TYPE",function($t,e,_t){var At;typeof e=="string"&&startsWith(e,"not ")?(At="must not be",e=e.replace(/^not /,"")):At="must be";var xt;if(endsWith($t," argument"))xt="The ".concat($t," ").concat(At," ").concat(oneOf$1(e,"type"));else{var kt=includes($t,".")?"property":"argument";xt='The "'.concat($t,'" ').concat(kt," ").concat(At," ").concat(oneOf$1(e,"type"))}return xt+=". Received type ".concat(typeof _t),xt},TypeError);createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");createErrorType("ERR_METHOD_NOT_IMPLEMENTED",function($t){return"The "+$t+" method is not implemented"});createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close");createErrorType("ERR_STREAM_DESTROYED",function($t){return"Cannot call "+$t+" after a stream was destroyed"});createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times");createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);createErrorType("ERR_UNKNOWN_ENCODING",function($t){return"Unknown encoding: "+$t},TypeError);createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");errorsBrowser.codes=codes$4;var ERR_INVALID_OPT_VALUE=errorsBrowser.codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom$2($t,e,_t){return $t.highWaterMark!=null?$t.highWaterMark:e?$t[_t]:null}function getHighWaterMark$4($t,e,_t,At){var xt=highWaterMarkFrom$2(e,At,_t);if(xt!=null){if(!(isFinite(xt)&&Math.floor(xt)===xt)||xt<0){var kt=At?_t:"highWaterMark";throw new ERR_INVALID_OPT_VALUE(kt,xt)}return Math.floor(xt)}return $t.objectMode?16:16*1024}var state$2={getHighWaterMark:getHighWaterMark$4},browser$d=deprecate$1;function deprecate$1($t,e){if(config$1("noDeprecation"))return $t;var _t=!1;function At(){if(!_t){if(config$1("throwDeprecation"))throw new Error(e);config$1("traceDeprecation")?console.trace(e):console.warn(e),_t=!0}return $t.apply(this,arguments)}return At}function config$1($t){try{if(!globalThis.localStorage)return!1}catch{return!1}var e=globalThis.localStorage[$t];return e==null?!1:String(e).toLowerCase()==="true"}var _stream_writable$1,hasRequired_stream_writable$1;function require_stream_writable$1(){if(hasRequired_stream_writable$1)return _stream_writable$1;hasRequired_stream_writable$1=1,_stream_writable$1=Ir;function $t(Tr){var wr=this;this.next=null,this.entry=null,this.finish=function(){Pr(wr,Tr)}}var e;Ir.WritableState=vr;var _t={deprecate:browser$d},At=streamBrowser$1,xt=buffer$2.Buffer,kt=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Bt(Tr){return xt.from(Tr)}function Nt(Tr){return xt.isBuffer(Tr)||Tr instanceof kt}var Ut=destroy_1$3,Lt=state$2,jt=Lt.getHighWaterMark,Kt=errorsBrowser.codes,qt=Kt.ERR_INVALID_ARG_TYPE,zt=Kt.ERR_METHOD_NOT_IMPLEMENTED,Vt=Kt.ERR_MULTIPLE_CALLBACK,Ht=Kt.ERR_STREAM_CANNOT_PIPE,Wt=Kt.ERR_STREAM_DESTROYED,Qt=Kt.ERR_STREAM_NULL_VALUES,Xt=Kt.ERR_STREAM_WRITE_AFTER_END,Jt=Kt.ERR_UNKNOWN_ENCODING,tr=Ut.errorOrDestroy;inherits_browserExports(Ir,At);function dr(){}function vr(Tr,wr,Ar){e=e||require_stream_duplex$1(),Tr=Tr||{},typeof Ar!="boolean"&&(Ar=wr instanceof e),this.objectMode=!!Tr.objectMode,Ar&&(this.objectMode=this.objectMode||!!Tr.writableObjectMode),this.highWaterMark=jt(this,Tr,"writableHighWaterMark",Ar),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Mr=Tr.decodeStrings===!1;this.decodeStrings=!Mr,this.defaultEncoding=Tr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Ur){yr(wr,Ur)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Tr.emitClose!==!1,this.autoDestroy=!!Tr.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new $t(this)}vr.prototype.getBuffer=function(){for(var wr=this.bufferedRequest,Ar=[];wr;)Ar.push(wr),wr=wr.next;return Ar},function(){try{Object.defineProperty(vr.prototype,"buffer",{get:_t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var $r;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?($r=Function.prototype[Symbol.hasInstance],Object.defineProperty(Ir,Symbol.hasInstance,{value:function(wr){return $r.call(this,wr)?!0:this!==Ir?!1:wr&&wr._writableState instanceof vr}})):$r=function(wr){return wr instanceof this};function Ir(Tr){e=e||require_stream_duplex$1();var wr=this instanceof e;if(!wr&&!$r.call(Ir,this))return new Ir(Tr);this._writableState=new vr(Tr,this,wr),this.writable=!0,Tr&&(typeof Tr.write=="function"&&(this._write=Tr.write),typeof Tr.writev=="function"&&(this._writev=Tr.writev),typeof Tr.destroy=="function"&&(this._destroy=Tr.destroy),typeof Tr.final=="function"&&(this._final=Tr.final)),At.call(this)}Ir.prototype.pipe=function(){tr(this,new Ht)};function Rr(Tr,wr){var Ar=new Xt;tr(Tr,Ar),process$9.nextTick(wr,Ar)}function Nr(Tr,wr,Ar,Mr){var Ur;return Ar===null?Ur=new Qt:typeof Ar!="string"&&!wr.objectMode&&(Ur=new qt("chunk",["string","Buffer"],Ar)),Ur?(tr(Tr,Ur),process$9.nextTick(Mr,Ur),!1):!0}Ir.prototype.write=function(Tr,wr,Ar){var Mr=this._writableState,Ur=!1,Or=!Mr.objectMode&&Nt(Tr);return Or&&!xt.isBuffer(Tr)&&(Tr=Bt(Tr)),typeof wr=="function"&&(Ar=wr,wr=null),Or?wr="buffer":wr||(wr=Mr.defaultEncoding),typeof Ar!="function"&&(Ar=dr),Mr.ending?Rr(this,Ar):(Or||Nr(this,Mr,Tr,Ar))&&(Mr.pendingcb++,Ur=lr(this,Mr,Or,Tr,wr,Ar)),Ur},Ir.prototype.cork=function(){this._writableState.corked++},Ir.prototype.uncork=function(){var Tr=this._writableState;Tr.corked&&(Tr.corked--,!Tr.writing&&!Tr.corked&&!Tr.bufferProcessing&&Tr.bufferedRequest&&ar(this,Tr))},Ir.prototype.setDefaultEncoding=function(wr){if(typeof wr=="string"&&(wr=wr.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((wr+"").toLowerCase())>-1))throw new Jt(wr);return this._writableState.defaultEncoding=wr,this},Object.defineProperty(Ir.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function kr(Tr,wr,Ar){return!Tr.objectMode&&Tr.decodeStrings!==!1&&typeof wr=="string"&&(wr=xt.from(wr,Ar)),wr}Object.defineProperty(Ir.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function lr(Tr,wr,Ar,Mr,Ur,Or){if(!Ar){var Cr=kr(wr,Mr,Ur);Mr!==Cr&&(Ar=!0,Ur="buffer",Mr=Cr)}var Er=wr.objectMode?1:Mr.length;wr.length+=Er;var Br=wr.length<wr.highWaterMark;if(Br||(wr.needDrain=!0),wr.writing||wr.corked){var Lr=wr.lastBufferedRequest;wr.lastBufferedRequest={chunk:Mr,encoding:Ur,isBuf:Ar,callback:Or,next:null},Lr?Lr.next=wr.lastBufferedRequest:wr.bufferedRequest=wr.lastBufferedRequest,wr.bufferedRequestCount+=1}else ir(Tr,wr,!1,Er,Mr,Ur,Or);return Br}function ir(Tr,wr,Ar,Mr,Ur,Or,Cr){wr.writelen=Mr,wr.writecb=Cr,wr.writing=!0,wr.sync=!0,wr.destroyed?wr.onwrite(new Wt("write")):Ar?Tr._writev(Ur,wr.onwrite):Tr._write(Ur,Or,wr.onwrite),wr.sync=!1}function er(Tr,wr,Ar,Mr,Ur){--wr.pendingcb,Ar?(process$9.nextTick(Ur,Mr),process$9.nextTick(br,Tr,wr),Tr._writableState.errorEmitted=!0,tr(Tr,Mr)):(Ur(Mr),Tr._writableState.errorEmitted=!0,tr(Tr,Mr),br(Tr,wr))}function rr(Tr){Tr.writing=!1,Tr.writecb=null,Tr.length-=Tr.writelen,Tr.writelen=0}function yr(Tr,wr){var Ar=Tr._writableState,Mr=Ar.sync,Ur=Ar.writecb;if(typeof Ur!="function")throw new Vt;if(rr(Ar),wr)er(Tr,Ar,Mr,wr,Ur);else{var Or=nr(Ar)||Tr.destroyed;!Or&&!Ar.corked&&!Ar.bufferProcessing&&Ar.bufferedRequest&&ar(Tr,Ar),Mr?process$9.nextTick(fr,Tr,Ar,Or,Ur):fr(Tr,Ar,Or,Ur)}}function fr(Tr,wr,Ar,Mr){Ar||gr(Tr,wr),wr.pendingcb--,Mr(),br(Tr,wr)}function gr(Tr,wr){wr.length===0&&wr.needDrain&&(wr.needDrain=!1,Tr.emit("drain"))}function ar(Tr,wr){wr.bufferProcessing=!0;var Ar=wr.bufferedRequest;if(Tr._writev&&Ar&&Ar.next){var Mr=wr.bufferedRequestCount,Ur=new Array(Mr),Or=wr.corkedRequestsFree;Or.entry=Ar;for(var Cr=0,Er=!0;Ar;)Ur[Cr]=Ar,Ar.isBuf||(Er=!1),Ar=Ar.next,Cr+=1;Ur.allBuffers=Er,ir(Tr,wr,!0,wr.length,Ur,"",Or.finish),wr.pendingcb++,wr.lastBufferedRequest=null,Or.next?(wr.corkedRequestsFree=Or.next,Or.next=null):wr.corkedRequestsFree=new $t(wr),wr.bufferedRequestCount=0}else{for(;Ar;){var Br=Ar.chunk,Lr=Ar.encoding,xr=Ar.callback,_r=wr.objectMode?1:Br.length;if(ir(Tr,wr,!1,_r,Br,Lr,xr),Ar=Ar.next,wr.bufferedRequestCount--,wr.writing)break}Ar===null&&(wr.lastBufferedRequest=null)}wr.bufferedRequest=Ar,wr.bufferProcessing=!1}Ir.prototype._write=function(Tr,wr,Ar){Ar(new zt("_write()"))},Ir.prototype._writev=null,Ir.prototype.end=function(Tr,wr,Ar){var Mr=this._writableState;return typeof Tr=="function"?(Ar=Tr,Tr=null,wr=null):typeof wr=="function"&&(Ar=wr,wr=null),Tr!=null&&this.write(Tr,wr),Mr.corked&&(Mr.corked=1,this.uncork()),Mr.ending||Sr(this,Mr,Ar),this},Object.defineProperty(Ir.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function nr(Tr){return Tr.ending&&Tr.length===0&&Tr.bufferedRequest===null&&!Tr.finished&&!Tr.writing}function ur(Tr,wr){Tr._final(function(Ar){wr.pendingcb--,Ar&&tr(Tr,Ar),wr.prefinished=!0,Tr.emit("prefinish"),br(Tr,wr)})}function pr(Tr,wr){!wr.prefinished&&!wr.finalCalled&&(typeof Tr._final=="function"&&!wr.destroyed?(wr.pendingcb++,wr.finalCalled=!0,process$9.nextTick(ur,Tr,wr)):(wr.prefinished=!0,Tr.emit("prefinish")))}function br(Tr,wr){var Ar=nr(wr);if(Ar&&(pr(Tr,wr),wr.pendingcb===0&&(wr.finished=!0,Tr.emit("finish"),wr.autoDestroy))){var Mr=Tr._readableState;(!Mr||Mr.autoDestroy&&Mr.endEmitted)&&Tr.destroy()}return Ar}function Sr(Tr,wr,Ar){wr.ending=!0,br(Tr,wr),Ar&&(wr.finished?process$9.nextTick(Ar):Tr.once("finish",Ar)),wr.ended=!0,Tr.writable=!1}function Pr(Tr,wr,Ar){var Mr=Tr.entry;for(Tr.entry=null;Mr;){var Ur=Mr.callback;wr.pendingcb--,Ur(Ar),Mr=Mr.next}wr.corkedRequestsFree.next=Tr}return Object.defineProperty(Ir.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(wr){this._writableState&&(this._writableState.destroyed=wr)}}),Ir.prototype.destroy=Ut.destroy,Ir.prototype._undestroy=Ut.undestroy,Ir.prototype._destroy=function(Tr,wr){wr(Tr)},_stream_writable$1}var _stream_duplex$1,hasRequired_stream_duplex$1;function require_stream_duplex$1(){if(hasRequired_stream_duplex$1)return _stream_duplex$1;hasRequired_stream_duplex$1=1;var $t=Object.keys||function(Lt){var jt=[];for(var Kt in Lt)jt.push(Kt);return jt};_stream_duplex$1=Bt;var e=require_stream_readable$1(),_t=require_stream_writable$1();inherits_browserExports(Bt,e);for(var At=$t(_t.prototype),xt=0;xt<At.length;xt++){var kt=At[xt];Bt.prototype[kt]||(Bt.prototype[kt]=_t.prototype[kt])}function Bt(Lt){if(!(this instanceof Bt))return new Bt(Lt);e.call(this,Lt),_t.call(this,Lt),this.allowHalfOpen=!0,Lt&&(Lt.readable===!1&&(this.readable=!1),Lt.writable===!1&&(this.writable=!1),Lt.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Nt)))}Object.defineProperty(Bt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Bt.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Bt.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Nt(){this._writableState.ended||process$9.nextTick(Ut,this)}function Ut(Lt){Lt.end()}return Object.defineProperty(Bt.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(jt){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=jt,this._writableState.destroyed=jt)}}),_stream_duplex$1}var string_decoder={},Buffer$F=safeBufferExports$1.Buffer,isEncoding=Buffer$F.isEncoding||function($t){switch($t=""+$t,$t&&$t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function _normalizeEncoding($t){if(!$t)return"utf8";for(var e;;)switch($t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return $t;default:if(e)return;$t=(""+$t).toLowerCase(),e=!0}}function normalizeEncoding$2($t){var e=_normalizeEncoding($t);if(typeof e!="string"&&(Buffer$F.isEncoding===isEncoding||!isEncoding($t)))throw new Error("Unknown encoding: "+$t);return e||$t}string_decoder.StringDecoder=StringDecoder$1;function StringDecoder$1($t){this.encoding=normalizeEncoding$2($t);var e;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:this.write=simpleWrite,this.end=simpleEnd;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer$F.allocUnsafe(e)}StringDecoder$1.prototype.write=function($t){if($t.length===0)return"";var e,_t;if(this.lastNeed){if(e=this.fillLast($t),e===void 0)return"";_t=this.lastNeed,this.lastNeed=0}else _t=0;return _t<$t.length?e?e+this.text($t,_t):this.text($t,_t):e||""};StringDecoder$1.prototype.end=utf8End;StringDecoder$1.prototype.text=utf8Text;StringDecoder$1.prototype.fillLast=function($t){if(this.lastNeed<=$t.length)return $t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);$t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,$t.length),this.lastNeed-=$t.length};function utf8CheckByte($t){return $t<=127?0:$t>>5===6?2:$t>>4===14?3:$t>>3===30?4:$t>>6===2?-1:-2}function utf8CheckIncomplete($t,e,_t){var At=e.length-1;if(At<_t)return 0;var xt=utf8CheckByte(e[At]);return xt>=0?(xt>0&&($t.lastNeed=xt-1),xt):--At<_t||xt===-2?0:(xt=utf8CheckByte(e[At]),xt>=0?(xt>0&&($t.lastNeed=xt-2),xt):--At<_t||xt===-2?0:(xt=utf8CheckByte(e[At]),xt>=0?(xt>0&&(xt===2?xt=0:$t.lastNeed=xt-3),xt):0))}function utf8CheckExtraBytes($t,e,_t){if((e[0]&192)!==128)return $t.lastNeed=0,"";if($t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return $t.lastNeed=1,"";if($t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return $t.lastNeed=2,""}}function utf8FillLast($t){var e=this.lastTotal-this.lastNeed,_t=utf8CheckExtraBytes(this,$t);if(_t!==void 0)return _t;if(this.lastNeed<=$t.length)return $t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);$t.copy(this.lastChar,e,0,$t.length),this.lastNeed-=$t.length}function utf8Text($t,e){var _t=utf8CheckIncomplete(this,$t,e);if(!this.lastNeed)return $t.toString("utf8",e);this.lastTotal=_t;var At=$t.length-(_t-this.lastNeed);return $t.copy(this.lastChar,0,At),$t.toString("utf8",e,At)}function utf8End($t){var e=$t&&$t.length?this.write($t):"";return this.lastNeed?e+"":e}function utf16Text($t,e){if(($t.length-e)%2===0){var _t=$t.toString("utf16le",e);if(_t){var At=_t.charCodeAt(_t.length-1);if(At>=55296&&At<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=$t[$t.length-2],this.lastChar[1]=$t[$t.length-1],_t.slice(0,-1)}return _t}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=$t[$t.length-1],$t.toString("utf16le",e,$t.length-1)}function utf16End($t){var e=$t&&$t.length?this.write($t):"";if(this.lastNeed){var _t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,_t)}return e}function base64Text($t,e){var _t=($t.length-e)%3;return _t===0?$t.toString("base64",e):(this.lastNeed=3-_t,this.lastTotal=3,_t===1?this.lastChar[0]=$t[$t.length-1]:(this.lastChar[0]=$t[$t.length-2],this.lastChar[1]=$t[$t.length-1]),$t.toString("base64",e,$t.length-_t))}function base64End($t){var e=$t&&$t.length?this.write($t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite($t){return $t.toString(this.encoding)}function simpleEnd($t){return $t&&$t.length?this.write($t):""}var ERR_STREAM_PREMATURE_CLOSE$4=errorsBrowser.codes.ERR_STREAM_PREMATURE_CLOSE;function once$5($t){var e=!1;return function(){if(!e){e=!0;for(var _t=arguments.length,At=new Array(_t),xt=0;xt<_t;xt++)At[xt]=arguments[xt];$t.apply(this,At)}}}function noop$3(){}function isRequest$5($t){return $t.setHeader&&typeof $t.abort=="function"}function eos$7($t,e,_t){if(typeof e=="function")return eos$7($t,null,e);e||(e={}),_t=once$5(_t||noop$3);var At=e.readable||e.readable!==!1&&$t.readable,xt=e.writable||e.writable!==!1&&$t.writable,kt=function(){$t.writable||Nt()},Bt=$t._writableState&&$t._writableState.finished,Nt=function(){xt=!1,Bt=!0,At||_t.call($t)},Ut=$t._readableState&&$t._readableState.endEmitted,Lt=function(){At=!1,Ut=!0,xt||_t.call($t)},jt=function(Vt){_t.call($t,Vt)},Kt=function(){var Vt;if(At&&!Ut)return(!$t._readableState||!$t._readableState.ended)&&(Vt=new ERR_STREAM_PREMATURE_CLOSE$4),_t.call($t,Vt);if(xt&&!Bt)return(!$t._writableState||!$t._writableState.ended)&&(Vt=new ERR_STREAM_PREMATURE_CLOSE$4),_t.call($t,Vt)},qt=function(){$t.req.on("finish",Nt)};return isRequest$5($t)?($t.on("complete",Nt),$t.on("abort",Kt),$t.req?qt():$t.on("request",qt)):xt&&!$t._writableState&&($t.on("end",kt),$t.on("close",kt)),$t.on("end",Lt),$t.on("finish",Nt),e.error!==!1&&$t.on("error",jt),$t.on("close",Kt),function(){$t.removeListener("complete",Nt),$t.removeListener("abort",Kt),$t.removeListener("request",qt),$t.req&&$t.req.removeListener("finish",Nt),$t.removeListener("end",kt),$t.removeListener("close",kt),$t.removeListener("finish",Nt),$t.removeListener("end",Lt),$t.removeListener("error",jt),$t.removeListener("close",Kt)}}var endOfStream$2=eos$7,async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var $t;function e(Jt,tr,dr){return tr=_t(tr),tr in Jt?Object.defineProperty(Jt,tr,{value:dr,enumerable:!0,configurable:!0,writable:!0}):Jt[tr]=dr,Jt}function _t(Jt){var tr=At(Jt,"string");return typeof tr=="symbol"?tr:String(tr)}function At(Jt,tr){if(typeof Jt!="object"||Jt===null)return Jt;var dr=Jt[Symbol.toPrimitive];if(dr!==void 0){var vr=dr.call(Jt,tr||"default");if(typeof vr!="object")return vr;throw new TypeError("@@toPrimitive must return a primitive value.")}return(tr==="string"?String:Number)(Jt)}var xt=endOfStream$2,kt=Symbol("lastResolve"),Bt=Symbol("lastReject"),Nt=Symbol("error"),Ut=Symbol("ended"),Lt=Symbol("lastPromise"),jt=Symbol("handlePromise"),Kt=Symbol("stream");function qt(Jt,tr){return{value:Jt,done:tr}}function zt(Jt){var tr=Jt[kt];if(tr!==null){var dr=Jt[Kt].read();dr!==null&&(Jt[Lt]=null,Jt[kt]=null,Jt[Bt]=null,tr(qt(dr,!1)))}}function Vt(Jt){process$9.nextTick(zt,Jt)}function Ht(Jt,tr){return function(dr,vr){Jt.then(function(){if(tr[Ut]){dr(qt(void 0,!0));return}tr[jt](dr,vr)},vr)}}var Wt=Object.getPrototypeOf(function(){}),Qt=Object.setPrototypeOf(($t={get stream(){return this[Kt]},next:function(){var tr=this,dr=this[Nt];if(dr!==null)return Promise.reject(dr);if(this[Ut])return Promise.resolve(qt(void 0,!0));if(this[Kt].destroyed)return new Promise(function(Rr,Nr){process$9.nextTick(function(){tr[Nt]?Nr(tr[Nt]):Rr(qt(void 0,!0))})});var vr=this[Lt],$r;if(vr)$r=new Promise(Ht(vr,this));else{var Ir=this[Kt].read();if(Ir!==null)return Promise.resolve(qt(Ir,!1));$r=new Promise(this[jt])}return this[Lt]=$r,$r}},e($t,Symbol.asyncIterator,function(){return this}),e($t,"return",function(){var tr=this;return new Promise(function(dr,vr){tr[Kt].destroy(null,function($r){if($r){vr($r);return}dr(qt(void 0,!0))})})}),$t),Wt),Xt=function(tr){var dr,vr=Object.create(Qt,(dr={},e(dr,Kt,{value:tr,writable:!0}),e(dr,kt,{value:null,writable:!0}),e(dr,Bt,{value:null,writable:!0}),e(dr,Nt,{value:null,writable:!0}),e(dr,Ut,{value:tr._readableState.endEmitted,writable:!0}),e(dr,jt,{value:function(Ir,Rr){var Nr=vr[Kt].read();Nr?(vr[Lt]=null,vr[kt]=null,vr[Bt]=null,Ir(qt(Nr,!1))):(vr[kt]=Ir,vr[Bt]=Rr)},writable:!0}),dr));return vr[Lt]=null,xt(tr,function($r){if($r&&$r.code!=="ERR_STREAM_PREMATURE_CLOSE"){var Ir=vr[Bt];Ir!==null&&(vr[Lt]=null,vr[kt]=null,vr[Bt]=null,Ir($r)),vr[Nt]=$r;return}var Rr=vr[kt];Rr!==null&&(vr[Lt]=null,vr[kt]=null,vr[Bt]=null,Rr(qt(void 0,!0))),vr[Ut]=!0}),tr.on("readable",Vt.bind(null,vr)),vr};return async_iterator=Xt,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable$1,hasRequired_stream_readable$1;function require_stream_readable$1(){if(hasRequired_stream_readable$1)return _stream_readable$1;hasRequired_stream_readable$1=1,_stream_readable$1=Rr;var $t;Rr.ReadableState=Ir,eventsExports.EventEmitter;var e=function(Cr,Er){return Cr.listeners(Er).length},_t=streamBrowser$1,At=buffer$2.Buffer,xt=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function kt(Or){return At.from(Or)}function Bt(Or){return At.isBuffer(Or)||Or instanceof xt}var Nt=util$6,Ut;Nt&&Nt.debuglog?Ut=Nt.debuglog("stream"):Ut=function(){};var Lt=requireBuffer_list(),jt=destroy_1$3,Kt=state$2,qt=Kt.getHighWaterMark,zt=errorsBrowser.codes,Vt=zt.ERR_INVALID_ARG_TYPE,Ht=zt.ERR_STREAM_PUSH_AFTER_EOF,Wt=zt.ERR_METHOD_NOT_IMPLEMENTED,Qt=zt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Xt,Jt,tr;inherits_browserExports(Rr,_t);var dr=jt.errorOrDestroy,vr=["error","close","destroy","pause","resume"];function $r(Or,Cr,Er){if(typeof Or.prependListener=="function")return Or.prependListener(Cr,Er);!Or._events||!Or._events[Cr]?Or.on(Cr,Er):Array.isArray(Or._events[Cr])?Or._events[Cr].unshift(Er):Or._events[Cr]=[Er,Or._events[Cr]]}function Ir(Or,Cr,Er){$t=$t||require_stream_duplex$1(),Or=Or||{},typeof Er!="boolean"&&(Er=Cr instanceof $t),this.objectMode=!!Or.objectMode,Er&&(this.objectMode=this.objectMode||!!Or.readableObjectMode),this.highWaterMark=qt(this,Or,"readableHighWaterMark",Er),this.buffer=new Lt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Or.emitClose!==!1,this.autoDestroy=!!Or.autoDestroy,this.destroyed=!1,this.defaultEncoding=Or.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Or.encoding&&(Xt||(Xt=string_decoder.StringDecoder),this.decoder=new Xt(Or.encoding),this.encoding=Or.encoding)}function Rr(Or){if($t=$t||require_stream_duplex$1(),!(this instanceof Rr))return new Rr(Or);var Cr=this instanceof $t;this._readableState=new Ir(Or,this,Cr),this.readable=!0,Or&&(typeof Or.read=="function"&&(this._read=Or.read),typeof Or.destroy=="function"&&(this._destroy=Or.destroy)),_t.call(this)}Object.defineProperty(Rr.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Cr){this._readableState&&(this._readableState.destroyed=Cr)}}),Rr.prototype.destroy=jt.destroy,Rr.prototype._undestroy=jt.undestroy,Rr.prototype._destroy=function(Or,Cr){Cr(Or)},Rr.prototype.push=function(Or,Cr){var Er=this._readableState,Br;return Er.objectMode?Br=!0:typeof Or=="string"&&(Cr=Cr||Er.defaultEncoding,Cr!==Er.encoding&&(Or=At.from(Or,Cr),Cr=""),Br=!0),Nr(this,Or,Cr,!1,Br)},Rr.prototype.unshift=function(Or){return Nr(this,Or,null,!0,!1)};function Nr(Or,Cr,Er,Br,Lr){Ut("readableAddChunk",Cr);var xr=Or._readableState;if(Cr===null)xr.reading=!1,yr(Or,xr);else{var _r;if(Lr||(_r=lr(xr,Cr)),_r)dr(Or,_r);else if(xr.objectMode||Cr&&Cr.length>0)if(typeof Cr!="string"&&!xr.objectMode&&Object.getPrototypeOf(Cr)!==At.prototype&&(Cr=kt(Cr)),Br)xr.endEmitted?dr(Or,new Qt):kr(Or,xr,Cr,!0);else if(xr.ended)dr(Or,new Ht);else{if(xr.destroyed)return!1;xr.reading=!1,xr.decoder&&!Er?(Cr=xr.decoder.write(Cr),xr.objectMode||Cr.length!==0?kr(Or,xr,Cr,!1):ar(Or,xr)):kr(Or,xr,Cr,!1)}else Br||(xr.reading=!1,ar(Or,xr))}return!xr.ended&&(xr.length<xr.highWaterMark||xr.length===0)}function kr(Or,Cr,Er,Br){Cr.flowing&&Cr.length===0&&!Cr.sync?(Cr.awaitDrain=0,Or.emit("data",Er)):(Cr.length+=Cr.objectMode?1:Er.length,Br?Cr.buffer.unshift(Er):Cr.buffer.push(Er),Cr.needReadable&&fr(Or)),ar(Or,Cr)}function lr(Or,Cr){var Er;return!Bt(Cr)&&typeof Cr!="string"&&Cr!==void 0&&!Or.objectMode&&(Er=new Vt("chunk",["string","Buffer","Uint8Array"],Cr)),Er}Rr.prototype.isPaused=function(){return this._readableState.flowing===!1},Rr.prototype.setEncoding=function(Or){Xt||(Xt=string_decoder.StringDecoder);var Cr=new Xt(Or);this._readableState.decoder=Cr,this._readableState.encoding=this._readableState.decoder.encoding;for(var Er=this._readableState.buffer.head,Br="";Er!==null;)Br+=Cr.write(Er.data),Er=Er.next;return this._readableState.buffer.clear(),Br!==""&&this._readableState.buffer.push(Br),this._readableState.length=Br.length,this};var ir=1073741824;function er(Or){return Or>=ir?Or=ir:(Or--,Or|=Or>>>1,Or|=Or>>>2,Or|=Or>>>4,Or|=Or>>>8,Or|=Or>>>16,Or++),Or}function rr(Or,Cr){return Or<=0||Cr.length===0&&Cr.ended?0:Cr.objectMode?1:Or!==Or?Cr.flowing&&Cr.length?Cr.buffer.head.data.length:Cr.length:(Or>Cr.highWaterMark&&(Cr.highWaterMark=er(Or)),Or<=Cr.length?Or:Cr.ended?Cr.length:(Cr.needReadable=!0,0))}Rr.prototype.read=function(Or){Ut("read",Or),Or=parseInt(Or,10);var Cr=this._readableState,Er=Or;if(Or!==0&&(Cr.emittedReadable=!1),Or===0&&Cr.needReadable&&((Cr.highWaterMark!==0?Cr.length>=Cr.highWaterMark:Cr.length>0)||Cr.ended))return Ut("read: emitReadable",Cr.length,Cr.ended),Cr.length===0&&Cr.ended?Ar(this):fr(this),null;if(Or=rr(Or,Cr),Or===0&&Cr.ended)return Cr.length===0&&Ar(this),null;var Br=Cr.needReadable;Ut("need readable",Br),(Cr.length===0||Cr.length-Or<Cr.highWaterMark)&&(Br=!0,Ut("length less than watermark",Br)),Cr.ended||Cr.reading?(Br=!1,Ut("reading or ended",Br)):Br&&(Ut("do read"),Cr.reading=!0,Cr.sync=!0,Cr.length===0&&(Cr.needReadable=!0),this._read(Cr.highWaterMark),Cr.sync=!1,Cr.reading||(Or=rr(Er,Cr)));var Lr;return Or>0?Lr=wr(Or,Cr):Lr=null,Lr===null?(Cr.needReadable=Cr.length<=Cr.highWaterMark,Or=0):(Cr.length-=Or,Cr.awaitDrain=0),Cr.length===0&&(Cr.ended||(Cr.needReadable=!0),Er!==Or&&Cr.ended&&Ar(this)),Lr!==null&&this.emit("data",Lr),Lr};function yr(Or,Cr){if(Ut("onEofChunk"),!Cr.ended){if(Cr.decoder){var Er=Cr.decoder.end();Er&&Er.length&&(Cr.buffer.push(Er),Cr.length+=Cr.objectMode?1:Er.length)}Cr.ended=!0,Cr.sync?fr(Or):(Cr.needReadable=!1,Cr.emittedReadable||(Cr.emittedReadable=!0,gr(Or)))}}function fr(Or){var Cr=Or._readableState;Ut("emitReadable",Cr.needReadable,Cr.emittedReadable),Cr.needReadable=!1,Cr.emittedReadable||(Ut("emitReadable",Cr.flowing),Cr.emittedReadable=!0,process$9.nextTick(gr,Or))}function gr(Or){var Cr=Or._readableState;Ut("emitReadable_",Cr.destroyed,Cr.length,Cr.ended),!Cr.destroyed&&(Cr.length||Cr.ended)&&(Or.emit("readable"),Cr.emittedReadable=!1),Cr.needReadable=!Cr.flowing&&!Cr.ended&&Cr.length<=Cr.highWaterMark,Tr(Or)}function ar(Or,Cr){Cr.readingMore||(Cr.readingMore=!0,process$9.nextTick(nr,Or,Cr))}function nr(Or,Cr){for(;!Cr.reading&&!Cr.ended&&(Cr.length<Cr.highWaterMark||Cr.flowing&&Cr.length===0);){var Er=Cr.length;if(Ut("maybeReadMore read 0"),Or.read(0),Er===Cr.length)break}Cr.readingMore=!1}Rr.prototype._read=function(Or){dr(this,new Wt("_read()"))},Rr.prototype.pipe=function(Or,Cr){var Er=this,Br=this._readableState;switch(Br.pipesCount){case 0:Br.pipes=Or;break;case 1:Br.pipes=[Br.pipes,Or];break;default:Br.pipes.push(Or);break}Br.pipesCount+=1,Ut("pipe count=%d opts=%j",Br.pipesCount,Cr);var Lr=(!Cr||Cr.end!==!1)&&Or!==process$9.stdout&&Or!==process$9.stderr,xr=Lr?Dr:Fr;Br.endEmitted?process$9.nextTick(xr):Er.once("end",xr),Or.on("unpipe",_r);function _r(en,nn){Ut("onunpipe"),en===Er&&nn&&nn.hasUnpiped===!1&&(nn.hasUnpiped=!0,Qr())}function Dr(){Ut("onend"),Or.end()}var jr=ur(Er);Or.on("drain",jr);var Hr=!1;function Qr(){Ut("cleanup"),Or.removeListener("close",cn),Or.removeListener("finish",Gr),Or.removeListener("drain",jr),Or.removeListener("error",an),Or.removeListener("unpipe",_r),Er.removeListener("end",Dr),Er.removeListener("end",Fr),Er.removeListener("data",Yr),Hr=!0,Br.awaitDrain&&(!Or._writableState||Or._writableState.needDrain)&&jr()}Er.on("data",Yr);function Yr(en){Ut("ondata");var nn=Or.write(en);Ut("dest.write",nn),nn===!1&&((Br.pipesCount===1&&Br.pipes===Or||Br.pipesCount>1&&Ur(Br.pipes,Or)!==-1)&&!Hr&&(Ut("false write response, pause",Br.awaitDrain),Br.awaitDrain++),Er.pause())}function an(en){Ut("onerror",en),Fr(),Or.removeListener("error",an),e(Or,"error")===0&&dr(Or,en)}$r(Or,"error",an);function cn(){Or.removeListener("finish",Gr),Fr()}Or.once("close",cn);function Gr(){Ut("onfinish"),Or.removeListener("close",cn),Fr()}Or.once("finish",Gr);function Fr(){Ut("unpipe"),Er.unpipe(Or)}return Or.emit("pipe",Er),Br.flowing||(Ut("pipe resume"),Er.resume()),Or};function ur(Or){return function(){var Er=Or._readableState;Ut("pipeOnDrain",Er.awaitDrain),Er.awaitDrain&&Er.awaitDrain--,Er.awaitDrain===0&&e(Or,"data")&&(Er.flowing=!0,Tr(Or))}}Rr.prototype.unpipe=function(Or){var Cr=this._readableState,Er={hasUnpiped:!1};if(Cr.pipesCount===0)return this;if(Cr.pipesCount===1)return Or&&Or!==Cr.pipes?this:(Or||(Or=Cr.pipes),Cr.pipes=null,Cr.pipesCount=0,Cr.flowing=!1,Or&&Or.emit("unpipe",this,Er),this);if(!Or){var Br=Cr.pipes,Lr=Cr.pipesCount;Cr.pipes=null,Cr.pipesCount=0,Cr.flowing=!1;for(var xr=0;xr<Lr;xr++)Br[xr].emit("unpipe",this,{hasUnpiped:!1});return this}var _r=Ur(Cr.pipes,Or);return _r===-1?this:(Cr.pipes.splice(_r,1),Cr.pipesCount-=1,Cr.pipesCount===1&&(Cr.pipes=Cr.pipes[0]),Or.emit("unpipe",this,Er),this)},Rr.prototype.on=function(Or,Cr){var Er=_t.prototype.on.call(this,Or,Cr),Br=this._readableState;return Or==="data"?(Br.readableListening=this.listenerCount("readable")>0,Br.flowing!==!1&&this.resume()):Or==="readable"&&!Br.endEmitted&&!Br.readableListening&&(Br.readableListening=Br.needReadable=!0,Br.flowing=!1,Br.emittedReadable=!1,Ut("on readable",Br.length,Br.reading),Br.length?fr(this):Br.reading||process$9.nextTick(br,this)),Er},Rr.prototype.addListener=Rr.prototype.on,Rr.prototype.removeListener=function(Or,Cr){var Er=_t.prototype.removeListener.call(this,Or,Cr);return Or==="readable"&&process$9.nextTick(pr,this),Er},Rr.prototype.removeAllListeners=function(Or){var Cr=_t.prototype.removeAllListeners.apply(this,arguments);return(Or==="readable"||Or===void 0)&&process$9.nextTick(pr,this),Cr};function pr(Or){var Cr=Or._readableState;Cr.readableListening=Or.listenerCount("readable")>0,Cr.resumeScheduled&&!Cr.paused?Cr.flowing=!0:Or.listenerCount("data")>0&&Or.resume()}function br(Or){Ut("readable nexttick read 0"),Or.read(0)}Rr.prototype.resume=function(){var Or=this._readableState;return Or.flowing||(Ut("resume"),Or.flowing=!Or.readableListening,Sr(this,Or)),Or.paused=!1,this};function Sr(Or,Cr){Cr.resumeScheduled||(Cr.resumeScheduled=!0,process$9.nextTick(Pr,Or,Cr))}function Pr(Or,Cr){Ut("resume",Cr.reading),Cr.reading||Or.read(0),Cr.resumeScheduled=!1,Or.emit("resume"),Tr(Or),Cr.flowing&&!Cr.reading&&Or.read(0)}Rr.prototype.pause=function(){return Ut("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Ut("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Tr(Or){var Cr=Or._readableState;for(Ut("flow",Cr.flowing);Cr.flowing&&Or.read()!==null;);}Rr.prototype.wrap=function(Or){var Cr=this,Er=this._readableState,Br=!1;Or.on("end",function(){if(Ut("wrapped end"),Er.decoder&&!Er.ended){var _r=Er.decoder.end();_r&&_r.length&&Cr.push(_r)}Cr.push(null)}),Or.on("data",function(_r){if(Ut("wrapped data"),Er.decoder&&(_r=Er.decoder.write(_r)),!(Er.objectMode&&_r==null)&&!(!Er.objectMode&&(!_r||!_r.length))){var Dr=Cr.push(_r);Dr||(Br=!0,Or.pause())}});for(var Lr in Or)this[Lr]===void 0&&typeof Or[Lr]=="function"&&(this[Lr]=function(Dr){return function(){return Or[Dr].apply(Or,arguments)}}(Lr));for(var xr=0;xr<vr.length;xr++)Or.on(vr[xr],this.emit.bind(this,vr[xr]));return this._read=function(_r){Ut("wrapped _read",_r),Br&&(Br=!1,Or.resume())},this},typeof Symbol=="function"&&(Rr.prototype[Symbol.asyncIterator]=function(){return Jt===void 0&&(Jt=requireAsync_iterator()),Jt(this)}),Object.defineProperty(Rr.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Rr.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Rr.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(Cr){this._readableState&&(this._readableState.flowing=Cr)}}),Rr._fromList=wr,Object.defineProperty(Rr.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function wr(Or,Cr){if(Cr.length===0)return null;var Er;return Cr.objectMode?Er=Cr.buffer.shift():!Or||Or>=Cr.length?(Cr.decoder?Er=Cr.buffer.join(""):Cr.buffer.length===1?Er=Cr.buffer.first():Er=Cr.buffer.concat(Cr.length),Cr.buffer.clear()):Er=Cr.buffer.consume(Or,Cr.decoder),Er}function Ar(Or){var Cr=Or._readableState;Ut("endReadable",Cr.endEmitted),Cr.endEmitted||(Cr.ended=!0,process$9.nextTick(Mr,Cr,Or))}function Mr(Or,Cr){if(Ut("endReadableNT",Or.endEmitted,Or.length),!Or.endEmitted&&Or.length===0&&(Or.endEmitted=!0,Cr.readable=!1,Cr.emit("end"),Or.autoDestroy)){var Er=Cr._writableState;(!Er||Er.autoDestroy&&Er.finished)&&Cr.destroy()}}typeof Symbol=="function"&&(Rr.from=function(Or,Cr){return tr===void 0&&(tr=requireFromBrowser()),tr(Rr,Or,Cr)});function Ur(Or,Cr){for(var Er=0,Br=Or.length;Er<Br;Er++)if(Or[Er]===Cr)return Er;return-1}return _stream_readable$1}var _stream_transform$1=Transform$d,_require$codes$1=errorsBrowser.codes,ERR_METHOD_NOT_IMPLEMENTED$2=_require$codes$1.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK$2=_require$codes$1.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes$1.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes$1.ERR_TRANSFORM_WITH_LENGTH_0,Duplex$7=require_stream_duplex$1();inherits_browserExports(Transform$d,Duplex$7);function afterTransform$1($t,e){var _t=this._transformState;_t.transforming=!1;var At=_t.writecb;if(At===null)return this.emit("error",new ERR_MULTIPLE_CALLBACK$2);_t.writechunk=null,_t.writecb=null,e!=null&&this.push(e),At($t);var xt=this._readableState;xt.reading=!1,(xt.needReadable||xt.length<xt.highWaterMark)&&this._read(xt.highWaterMark)}function Transform$d($t){if(!(this instanceof Transform$d))return new Transform$d($t);Duplex$7.call(this,$t),this._transformState={afterTransform:afterTransform$1.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,$t&&(typeof $t.transform=="function"&&(this._transform=$t.transform),typeof $t.flush=="function"&&(this._flush=$t.flush)),this.on("prefinish",prefinish$3)}function prefinish$3(){var $t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,_t){done$1($t,e,_t)}):done$1(this,null,null)}Transform$d.prototype.push=function($t,e){return this._transformState.needTransform=!1,Duplex$7.prototype.push.call(this,$t,e)};Transform$d.prototype._transform=function($t,e,_t){_t(new ERR_METHOD_NOT_IMPLEMENTED$2("_transform()"))};Transform$d.prototype._write=function($t,e,_t){var At=this._transformState;if(At.writecb=_t,At.writechunk=$t,At.writeencoding=e,!At.transforming){var xt=this._readableState;(At.needTransform||xt.needReadable||xt.length<xt.highWaterMark)&&this._read(xt.highWaterMark)}};Transform$d.prototype._read=function($t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Transform$d.prototype._destroy=function($t,e){Duplex$7.prototype._destroy.call(this,$t,function(_t){e(_t)})};function done$1($t,e,_t){if(e)return $t.emit("error",e);if(_t!=null&&$t.push(_t),$t._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if($t._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return $t.push(null)}var _stream_passthrough$1=PassThrough$5,Transform$c=_stream_transform$1;inherits_browserExports(PassThrough$5,Transform$c);function PassThrough$5($t){if(!(this instanceof PassThrough$5))return new PassThrough$5($t);Transform$c.call(this,$t)}PassThrough$5.prototype._transform=function($t,e,_t){_t(null,$t)};var eos$6;function once$4($t){var e=!1;return function(){e||(e=!0,$t.apply(void 0,arguments))}}var _require$codes=errorsBrowser.codes,ERR_MISSING_ARGS$6=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED$2=_require$codes.ERR_STREAM_DESTROYED;function noop$2($t){if($t)throw $t}function isRequest$4($t){return $t.setHeader&&typeof $t.abort=="function"}function destroyer$6($t,e,_t,At){At=once$4(At);var xt=!1;$t.on("close",function(){xt=!0}),eos$6===void 0&&(eos$6=endOfStream$2),eos$6($t,{readable:e,writable:_t},function(Bt){if(Bt)return At(Bt);xt=!0,At()});var kt=!1;return function(Bt){if(!xt&&!kt){if(kt=!0,isRequest$4($t))return $t.abort();if(typeof $t.destroy=="function")return $t.destroy();At(Bt||new ERR_STREAM_DESTROYED$2("pipe"))}}}function call($t){$t()}function pipe$3($t,e){return $t.pipe(e)}function popCallback$2($t){return!$t.length||typeof $t[$t.length-1]!="function"?noop$2:$t.pop()}function pipeline$4(){for(var $t=arguments.length,e=new Array($t),_t=0;_t<$t;_t++)e[_t]=arguments[_t];var At=popCallback$2(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new ERR_MISSING_ARGS$6("streams");var xt,kt=e.map(function(Bt,Nt){var Ut=Nt<e.length-1,Lt=Nt>0;return destroyer$6(Bt,Ut,Lt,function(jt){xt||(xt=jt),jt&&kt.forEach(call),!Ut&&(kt.forEach(call),At(xt))})});return e.reduce(pipe$3)}var pipeline_1$2=pipeline$4;(function($t,e){e=$t.exports=require_stream_readable$1(),e.Stream=e,e.Readable=e,e.Writable=require_stream_writable$1(),e.Duplex=require_stream_duplex$1(),e.Transform=_stream_transform$1,e.PassThrough=_stream_passthrough$1,e.finished=endOfStream$2,e.pipeline=pipeline_1$2})(readableBrowser$1,readableBrowser$1.exports);var readableBrowserExports$1=readableBrowser$1.exports,Buffer$E=safeBufferExports$1.Buffer,Transform$b=readableBrowserExports$1.Transform,inherits$q=inherits_browserExports;function throwIfNotStringOrBuffer($t,e){if(!Buffer$E.isBuffer($t)&&typeof $t!="string")throw new TypeError(e+" must be a string or a buffer")}function HashBase$2($t){Transform$b.call(this),this._block=Buffer$E.allocUnsafe($t),this._blockSize=$t,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}inherits$q(HashBase$2,Transform$b);HashBase$2.prototype._transform=function($t,e,_t){var At=null;try{this.update($t,e)}catch(xt){At=xt}_t(At)};HashBase$2.prototype._flush=function($t){var e=null;try{this.push(this.digest())}catch(_t){e=_t}$t(e)};HashBase$2.prototype.update=function($t,e){if(throwIfNotStringOrBuffer($t,"Data"),this._finalized)throw new Error("Digest already called");Buffer$E.isBuffer($t)||($t=Buffer$E.from($t,e));for(var _t=this._block,At=0;this._blockOffset+$t.length-At>=this._blockSize;){for(var xt=this._blockOffset;xt<this._blockSize;)_t[xt++]=$t[At++];this._update(),this._blockOffset=0}for(;At<$t.length;)_t[this._blockOffset++]=$t[At++];for(var kt=0,Bt=$t.length*8;Bt>0;++kt)this._length[kt]+=Bt,Bt=this._length[kt]/4294967296|0,Bt>0&&(this._length[kt]-=4294967296*Bt);return this};HashBase$2.prototype._update=function(){throw new Error("_update is not implemented")};HashBase$2.prototype.digest=function($t){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var e=this._digest();$t!==void 0&&(e=e.toString($t)),this._block.fill(0),this._blockOffset=0;for(var _t=0;_t<4;++_t)this._length[_t]=0;return e};HashBase$2.prototype._digest=function(){throw new Error("_digest is not implemented")};var hashBase=HashBase$2,inherits$p=inherits_browserExports,HashBase$1=hashBase,Buffer$D=safeBufferExports$1.Buffer,ARRAY16$1=new Array(16);function MD5$3(){HashBase$1.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}inherits$p(MD5$3,HashBase$1);MD5$3.prototype._update=function(){for(var $t=ARRAY16$1,e=0;e<16;++e)$t[e]=this._block.readInt32LE(e*4);var _t=this._a,At=this._b,xt=this._c,kt=this._d;_t=fnF(_t,At,xt,kt,$t[0],3614090360,7),kt=fnF(kt,_t,At,xt,$t[1],3905402710,12),xt=fnF(xt,kt,_t,At,$t[2],606105819,17),At=fnF(At,xt,kt,_t,$t[3],3250441966,22),_t=fnF(_t,At,xt,kt,$t[4],4118548399,7),kt=fnF(kt,_t,At,xt,$t[5],1200080426,12),xt=fnF(xt,kt,_t,At,$t[6],2821735955,17),At=fnF(At,xt,kt,_t,$t[7],4249261313,22),_t=fnF(_t,At,xt,kt,$t[8],1770035416,7),kt=fnF(kt,_t,At,xt,$t[9],2336552879,12),xt=fnF(xt,kt,_t,At,$t[10],4294925233,17),At=fnF(At,xt,kt,_t,$t[11],2304563134,22),_t=fnF(_t,At,xt,kt,$t[12],1804603682,7),kt=fnF(kt,_t,At,xt,$t[13],4254626195,12),xt=fnF(xt,kt,_t,At,$t[14],2792965006,17),At=fnF(At,xt,kt,_t,$t[15],1236535329,22),_t=fnG(_t,At,xt,kt,$t[1],4129170786,5),kt=fnG(kt,_t,At,xt,$t[6],3225465664,9),xt=fnG(xt,kt,_t,At,$t[11],643717713,14),At=fnG(At,xt,kt,_t,$t[0],3921069994,20),_t=fnG(_t,At,xt,kt,$t[5],3593408605,5),kt=fnG(kt,_t,At,xt,$t[10],38016083,9),xt=fnG(xt,kt,_t,At,$t[15],3634488961,14),At=fnG(At,xt,kt,_t,$t[4],3889429448,20),_t=fnG(_t,At,xt,kt,$t[9],568446438,5),kt=fnG(kt,_t,At,xt,$t[14],3275163606,9),xt=fnG(xt,kt,_t,At,$t[3],4107603335,14),At=fnG(At,xt,kt,_t,$t[8],1163531501,20),_t=fnG(_t,At,xt,kt,$t[13],2850285829,5),kt=fnG(kt,_t,At,xt,$t[2],4243563512,9),xt=fnG(xt,kt,_t,At,$t[7],1735328473,14),At=fnG(At,xt,kt,_t,$t[12],2368359562,20),_t=fnH(_t,At,xt,kt,$t[5],4294588738,4),kt=fnH(kt,_t,At,xt,$t[8],2272392833,11),xt=fnH(xt,kt,_t,At,$t[11],1839030562,16),At=fnH(At,xt,kt,_t,$t[14],4259657740,23),_t=fnH(_t,At,xt,kt,$t[1],2763975236,4),kt=fnH(kt,_t,At,xt,$t[4],1272893353,11),xt=fnH(xt,kt,_t,At,$t[7],4139469664,16),At=fnH(At,xt,kt,_t,$t[10],3200236656,23),_t=fnH(_t,At,xt,kt,$t[13],681279174,4),kt=fnH(kt,_t,At,xt,$t[0],3936430074,11),xt=fnH(xt,kt,_t,At,$t[3],3572445317,16),At=fnH(At,xt,kt,_t,$t[6],76029189,23),_t=fnH(_t,At,xt,kt,$t[9],3654602809,4),kt=fnH(kt,_t,At,xt,$t[12],3873151461,11),xt=fnH(xt,kt,_t,At,$t[15],530742520,16),At=fnH(At,xt,kt,_t,$t[2],3299628645,23),_t=fnI(_t,At,xt,kt,$t[0],4096336452,6),kt=fnI(kt,_t,At,xt,$t[7],1126891415,10),xt=fnI(xt,kt,_t,At,$t[14],2878612391,15),At=fnI(At,xt,kt,_t,$t[5],4237533241,21),_t=fnI(_t,At,xt,kt,$t[12],1700485571,6),kt=fnI(kt,_t,At,xt,$t[3],2399980690,10),xt=fnI(xt,kt,_t,At,$t[10],4293915773,15),At=fnI(At,xt,kt,_t,$t[1],2240044497,21),_t=fnI(_t,At,xt,kt,$t[8],1873313359,6),kt=fnI(kt,_t,At,xt,$t[15],4264355552,10),xt=fnI(xt,kt,_t,At,$t[6],2734768916,15),At=fnI(At,xt,kt,_t,$t[13],1309151649,21),_t=fnI(_t,At,xt,kt,$t[4],4149444226,6),kt=fnI(kt,_t,At,xt,$t[11],3174756917,10),xt=fnI(xt,kt,_t,At,$t[2],718787259,15),At=fnI(At,xt,kt,_t,$t[9],3951481745,21),this._a=this._a+_t|0,this._b=this._b+At|0,this._c=this._c+xt|0,this._d=this._d+kt|0};MD5$3.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var $t=Buffer$D.allocUnsafe(16);return $t.writeInt32LE(this._a,0),$t.writeInt32LE(this._b,4),$t.writeInt32LE(this._c,8),$t.writeInt32LE(this._d,12),$t};function rotl$3($t,e){return $t<<e|$t>>>32-e}function fnF($t,e,_t,At,xt,kt,Bt){return rotl$3($t+(e&_t|~e&At)+xt+kt|0,Bt)+e|0}function fnG($t,e,_t,At,xt,kt,Bt){return rotl$3($t+(e&At|_t&~At)+xt+kt|0,Bt)+e|0}function fnH($t,e,_t,At,xt,kt,Bt){return rotl$3($t+(e^_t^At)+xt+kt|0,Bt)+e|0}function fnI($t,e,_t,At,xt,kt,Bt){return rotl$3($t+(_t^(e|~At))+xt+kt|0,Bt)+e|0}var md5_js=MD5$3,Buffer$C=buffer$2.Buffer,inherits$o=inherits_browserExports,HashBase=hashBase,ARRAY16=new Array(16),zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],hl=[0,1518500249,1859775393,2400959708,2840853838],hr=[1352829926,1548603684,1836072691,2053994217,0];function RIPEMD160$5(){HashBase.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}inherits$o(RIPEMD160$5,HashBase);RIPEMD160$5.prototype._update=function(){for(var $t=ARRAY16,e=0;e<16;++e)$t[e]=this._block.readInt32LE(e*4);for(var _t=this._a|0,At=this._b|0,xt=this._c|0,kt=this._d|0,Bt=this._e|0,Nt=this._a|0,Ut=this._b|0,Lt=this._c|0,jt=this._d|0,Kt=this._e|0,qt=0;qt<80;qt+=1){var zt,Vt;qt<16?(zt=fn1(_t,At,xt,kt,Bt,$t[zl[qt]],hl[0],sl[qt]),Vt=fn5(Nt,Ut,Lt,jt,Kt,$t[zr[qt]],hr[0],sr[qt])):qt<32?(zt=fn2(_t,At,xt,kt,Bt,$t[zl[qt]],hl[1],sl[qt]),Vt=fn4(Nt,Ut,Lt,jt,Kt,$t[zr[qt]],hr[1],sr[qt])):qt<48?(zt=fn3(_t,At,xt,kt,Bt,$t[zl[qt]],hl[2],sl[qt]),Vt=fn3(Nt,Ut,Lt,jt,Kt,$t[zr[qt]],hr[2],sr[qt])):qt<64?(zt=fn4(_t,At,xt,kt,Bt,$t[zl[qt]],hl[3],sl[qt]),Vt=fn2(Nt,Ut,Lt,jt,Kt,$t[zr[qt]],hr[3],sr[qt])):(zt=fn5(_t,At,xt,kt,Bt,$t[zl[qt]],hl[4],sl[qt]),Vt=fn1(Nt,Ut,Lt,jt,Kt,$t[zr[qt]],hr[4],sr[qt])),_t=Bt,Bt=kt,kt=rotl$2(xt,10),xt=At,At=zt,Nt=Kt,Kt=jt,jt=rotl$2(Lt,10),Lt=Ut,Ut=Vt}var Ht=this._b+xt+jt|0;this._b=this._c+kt+Kt|0,this._c=this._d+Bt+Nt|0,this._d=this._e+_t+Ut|0,this._e=this._a+At+Lt|0,this._a=Ht};RIPEMD160$5.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var $t=Buffer$C.alloc?Buffer$C.alloc(20):new Buffer$C(20);return $t.writeInt32LE(this._a,0),$t.writeInt32LE(this._b,4),$t.writeInt32LE(this._c,8),$t.writeInt32LE(this._d,12),$t.writeInt32LE(this._e,16),$t};function rotl$2($t,e){return $t<<e|$t>>>32-e}function fn1($t,e,_t,At,xt,kt,Bt,Nt){return rotl$2($t+(e^_t^At)+kt+Bt|0,Nt)+xt|0}function fn2($t,e,_t,At,xt,kt,Bt,Nt){return rotl$2($t+(e&_t|~e&At)+kt+Bt|0,Nt)+xt|0}function fn3($t,e,_t,At,xt,kt,Bt,Nt){return rotl$2($t+((e|~_t)^At)+kt+Bt|0,Nt)+xt|0}function fn4($t,e,_t,At,xt,kt,Bt,Nt){return rotl$2($t+(e&At|_t&~At)+kt+Bt|0,Nt)+xt|0}function fn5($t,e,_t,At,xt,kt,Bt,Nt){return rotl$2($t+(e^(_t|~At))+kt+Bt|0,Nt)+xt|0}var ripemd160$1=RIPEMD160$5,sha_js={exports:{}},Buffer$B=safeBufferExports$1.Buffer;function Hash$8($t,e){this._block=Buffer$B.alloc($t),this._finalSize=e,this._blockSize=$t,this._len=0}Hash$8.prototype.update=function($t,e){typeof $t=="string"&&(e=e||"utf8",$t=Buffer$B.from($t,e));for(var _t=this._block,At=this._blockSize,xt=$t.length,kt=this._len,Bt=0;Bt<xt;){for(var Nt=kt%At,Ut=Math.min(xt-Bt,At-Nt),Lt=0;Lt<Ut;Lt++)_t[Nt+Lt]=$t[Bt+Lt];kt+=Ut,Bt+=Ut,kt%At===0&&this._update(_t)}return this._len+=xt,this};Hash$8.prototype.digest=function($t){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var _t=this._len*8;if(_t<=4294967295)this._block.writeUInt32BE(_t,this._blockSize-4);else{var At=(_t&4294967295)>>>0,xt=(_t-At)/4294967296;this._block.writeUInt32BE(xt,this._blockSize-8),this._block.writeUInt32BE(At,this._blockSize-4)}this._update(this._block);var kt=this._hash();return $t?kt.toString($t):kt};Hash$8.prototype._update=function(){throw new Error("_update must be implemented by subclass")};var hash$6=Hash$8,inherits$n=inherits_browserExports,Hash$7=hash$6,Buffer$A=safeBufferExports$1.Buffer,K$5=[1518500249,1859775393,-1894007588,-899497514],W$6=new Array(80);function Sha(){this.init(),this._w=W$6,Hash$7.call(this,64,56)}inherits$n(Sha,Hash$7);Sha.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl5$1($t){return $t<<5|$t>>>27}function rotl30$1($t){return $t<<30|$t>>>2}function ft$2($t,e,_t,At){return $t===0?e&_t|~e&At:$t===2?e&_t|e&At|_t&At:e^_t^At}Sha.prototype._update=function($t){for(var e=this._w,_t=this._a|0,At=this._b|0,xt=this._c|0,kt=this._d|0,Bt=this._e|0,Nt=0;Nt<16;++Nt)e[Nt]=$t.readInt32BE(Nt*4);for(;Nt<80;++Nt)e[Nt]=e[Nt-3]^e[Nt-8]^e[Nt-14]^e[Nt-16];for(var Ut=0;Ut<80;++Ut){var Lt=~~(Ut/20),jt=rotl5$1(_t)+ft$2(Lt,At,xt,kt)+Bt+e[Ut]+K$5[Lt]|0;Bt=kt,kt=xt,xt=rotl30$1(At),At=_t,_t=jt}this._a=_t+this._a|0,this._b=At+this._b|0,this._c=xt+this._c|0,this._d=kt+this._d|0,this._e=Bt+this._e|0};Sha.prototype._hash=function(){var $t=Buffer$A.allocUnsafe(20);return $t.writeInt32BE(this._a|0,0),$t.writeInt32BE(this._b|0,4),$t.writeInt32BE(this._c|0,8),$t.writeInt32BE(this._d|0,12),$t.writeInt32BE(this._e|0,16),$t};var sha$4=Sha,inherits$m=inherits_browserExports,Hash$6=hash$6,Buffer$z=safeBufferExports$1.Buffer,K$4=[1518500249,1859775393,-1894007588,-899497514],W$5=new Array(80);function Sha1(){this.init(),this._w=W$5,Hash$6.call(this,64,56)}inherits$m(Sha1,Hash$6);Sha1.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl1($t){return $t<<1|$t>>>31}function rotl5($t){return $t<<5|$t>>>27}function rotl30($t){return $t<<30|$t>>>2}function ft$1($t,e,_t,At){return $t===0?e&_t|~e&At:$t===2?e&_t|e&At|_t&At:e^_t^At}Sha1.prototype._update=function($t){for(var e=this._w,_t=this._a|0,At=this._b|0,xt=this._c|0,kt=this._d|0,Bt=this._e|0,Nt=0;Nt<16;++Nt)e[Nt]=$t.readInt32BE(Nt*4);for(;Nt<80;++Nt)e[Nt]=rotl1(e[Nt-3]^e[Nt-8]^e[Nt-14]^e[Nt-16]);for(var Ut=0;Ut<80;++Ut){var Lt=~~(Ut/20),jt=rotl5(_t)+ft$1(Lt,At,xt,kt)+Bt+e[Ut]+K$4[Lt]|0;Bt=kt,kt=xt,xt=rotl30(At),At=_t,_t=jt}this._a=_t+this._a|0,this._b=At+this._b|0,this._c=xt+this._c|0,this._d=kt+this._d|0,this._e=Bt+this._e|0};Sha1.prototype._hash=function(){var $t=Buffer$z.allocUnsafe(20);return $t.writeInt32BE(this._a|0,0),$t.writeInt32BE(this._b|0,4),$t.writeInt32BE(this._c|0,8),$t.writeInt32BE(this._d|0,12),$t.writeInt32BE(this._e|0,16),$t};var sha1=Sha1,inherits$l=inherits_browserExports,Hash$5=hash$6,Buffer$y=safeBufferExports$1.Buffer,K$3=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],W$4=new Array(64);function Sha256$4(){this.init(),this._w=W$4,Hash$5.call(this,64,56)}inherits$l(Sha256$4,Hash$5);Sha256$4.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function ch($t,e,_t){return _t^$t&(e^_t)}function maj$1($t,e,_t){return $t&e|_t&($t|e)}function sigma0$1($t){return($t>>>2|$t<<30)^($t>>>13|$t<<19)^($t>>>22|$t<<10)}function sigma1$1($t){return($t>>>6|$t<<26)^($t>>>11|$t<<21)^($t>>>25|$t<<7)}function gamma0($t){return($t>>>7|$t<<25)^($t>>>18|$t<<14)^$t>>>3}function gamma1($t){return($t>>>17|$t<<15)^($t>>>19|$t<<13)^$t>>>10}Sha256$4.prototype._update=function($t){for(var e=this._w,_t=this._a|0,At=this._b|0,xt=this._c|0,kt=this._d|0,Bt=this._e|0,Nt=this._f|0,Ut=this._g|0,Lt=this._h|0,jt=0;jt<16;++jt)e[jt]=$t.readInt32BE(jt*4);for(;jt<64;++jt)e[jt]=gamma1(e[jt-2])+e[jt-7]+gamma0(e[jt-15])+e[jt-16]|0;for(var Kt=0;Kt<64;++Kt){var qt=Lt+sigma1$1(Bt)+ch(Bt,Nt,Ut)+K$3[Kt]+e[Kt]|0,zt=sigma0$1(_t)+maj$1(_t,At,xt)|0;Lt=Ut,Ut=Nt,Nt=Bt,Bt=kt+qt|0,kt=xt,xt=At,At=_t,_t=qt+zt|0}this._a=_t+this._a|0,this._b=At+this._b|0,this._c=xt+this._c|0,this._d=kt+this._d|0,this._e=Bt+this._e|0,this._f=Nt+this._f|0,this._g=Ut+this._g|0,this._h=Lt+this._h|0};Sha256$4.prototype._hash=function(){var $t=Buffer$y.allocUnsafe(32);return $t.writeInt32BE(this._a,0),$t.writeInt32BE(this._b,4),$t.writeInt32BE(this._c,8),$t.writeInt32BE(this._d,12),$t.writeInt32BE(this._e,16),$t.writeInt32BE(this._f,20),$t.writeInt32BE(this._g,24),$t.writeInt32BE(this._h,28),$t};var sha256$3=Sha256$4,inherits$k=inherits_browserExports,Sha256$3=sha256$3,Hash$4=hash$6,Buffer$x=safeBufferExports$1.Buffer,W$3=new Array(64);function Sha224(){this.init(),this._w=W$3,Hash$4.call(this,64,56)}inherits$k(Sha224,Sha256$3);Sha224.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this};Sha224.prototype._hash=function(){var $t=Buffer$x.allocUnsafe(28);return $t.writeInt32BE(this._a,0),$t.writeInt32BE(this._b,4),$t.writeInt32BE(this._c,8),$t.writeInt32BE(this._d,12),$t.writeInt32BE(this._e,16),$t.writeInt32BE(this._f,20),$t.writeInt32BE(this._g,24),$t};var sha224$1=Sha224,inherits$j=inherits_browserExports,Hash$3=hash$6,Buffer$w=safeBufferExports$1.Buffer,K$2=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],W$2=new Array(160);function Sha512(){this.init(),this._w=W$2,Hash$3.call(this,128,112)}inherits$j(Sha512,Hash$3);Sha512.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function Ch($t,e,_t){return _t^$t&(e^_t)}function maj($t,e,_t){return $t&e|_t&($t|e)}function sigma0($t,e){return($t>>>28|e<<4)^(e>>>2|$t<<30)^(e>>>7|$t<<25)}function sigma1($t,e){return($t>>>14|e<<18)^($t>>>18|e<<14)^(e>>>9|$t<<23)}function Gamma0($t,e){return($t>>>1|e<<31)^($t>>>8|e<<24)^$t>>>7}function Gamma0l($t,e){return($t>>>1|e<<31)^($t>>>8|e<<24)^($t>>>7|e<<25)}function Gamma1($t,e){return($t>>>19|e<<13)^(e>>>29|$t<<3)^$t>>>6}function Gamma1l($t,e){return($t>>>19|e<<13)^(e>>>29|$t<<3)^($t>>>6|e<<26)}function getCarry($t,e){return $t>>>0<e>>>0?1:0}Sha512.prototype._update=function($t){for(var e=this._w,_t=this._ah|0,At=this._bh|0,xt=this._ch|0,kt=this._dh|0,Bt=this._eh|0,Nt=this._fh|0,Ut=this._gh|0,Lt=this._hh|0,jt=this._al|0,Kt=this._bl|0,qt=this._cl|0,zt=this._dl|0,Vt=this._el|0,Ht=this._fl|0,Wt=this._gl|0,Qt=this._hl|0,Xt=0;Xt<32;Xt+=2)e[Xt]=$t.readInt32BE(Xt*4),e[Xt+1]=$t.readInt32BE(Xt*4+4);for(;Xt<160;Xt+=2){var Jt=e[Xt-30],tr=e[Xt-15*2+1],dr=Gamma0(Jt,tr),vr=Gamma0l(tr,Jt);Jt=e[Xt-2*2],tr=e[Xt-2*2+1];var $r=Gamma1(Jt,tr),Ir=Gamma1l(tr,Jt),Rr=e[Xt-7*2],Nr=e[Xt-7*2+1],kr=e[Xt-16*2],lr=e[Xt-16*2+1],ir=vr+Nr|0,er=dr+Rr+getCarry(ir,vr)|0;ir=ir+Ir|0,er=er+$r+getCarry(ir,Ir)|0,ir=ir+lr|0,er=er+kr+getCarry(ir,lr)|0,e[Xt]=er,e[Xt+1]=ir}for(var rr=0;rr<160;rr+=2){er=e[rr],ir=e[rr+1];var yr=maj(_t,At,xt),fr=maj(jt,Kt,qt),gr=sigma0(_t,jt),ar=sigma0(jt,_t),nr=sigma1(Bt,Vt),ur=sigma1(Vt,Bt),pr=K$2[rr],br=K$2[rr+1],Sr=Ch(Bt,Nt,Ut),Pr=Ch(Vt,Ht,Wt),Tr=Qt+ur|0,wr=Lt+nr+getCarry(Tr,Qt)|0;Tr=Tr+Pr|0,wr=wr+Sr+getCarry(Tr,Pr)|0,Tr=Tr+br|0,wr=wr+pr+getCarry(Tr,br)|0,Tr=Tr+ir|0,wr=wr+er+getCarry(Tr,ir)|0;var Ar=ar+fr|0,Mr=gr+yr+getCarry(Ar,ar)|0;Lt=Ut,Qt=Wt,Ut=Nt,Wt=Ht,Nt=Bt,Ht=Vt,Vt=zt+Tr|0,Bt=kt+wr+getCarry(Vt,zt)|0,kt=xt,zt=qt,xt=At,qt=Kt,At=_t,Kt=jt,jt=Tr+Ar|0,_t=wr+Mr+getCarry(jt,Tr)|0}this._al=this._al+jt|0,this._bl=this._bl+Kt|0,this._cl=this._cl+qt|0,this._dl=this._dl+zt|0,this._el=this._el+Vt|0,this._fl=this._fl+Ht|0,this._gl=this._gl+Wt|0,this._hl=this._hl+Qt|0,this._ah=this._ah+_t+getCarry(this._al,jt)|0,this._bh=this._bh+At+getCarry(this._bl,Kt)|0,this._ch=this._ch+xt+getCarry(this._cl,qt)|0,this._dh=this._dh+kt+getCarry(this._dl,zt)|0,this._eh=this._eh+Bt+getCarry(this._el,Vt)|0,this._fh=this._fh+Nt+getCarry(this._fl,Ht)|0,this._gh=this._gh+Ut+getCarry(this._gl,Wt)|0,this._hh=this._hh+Lt+getCarry(this._hl,Qt)|0};Sha512.prototype._hash=function(){var $t=Buffer$w.allocUnsafe(64);function e(_t,At,xt){$t.writeInt32BE(_t,xt),$t.writeInt32BE(At,xt+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),$t};var sha512$3=Sha512,inherits$i=inherits_browserExports,SHA512$4=sha512$3,Hash$2=hash$6,Buffer$v=safeBufferExports$1.Buffer,W$1=new Array(160);function Sha384(){this.init(),this._w=W$1,Hash$2.call(this,128,112)}inherits$i(Sha384,SHA512$4);Sha384.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this};Sha384.prototype._hash=function(){var $t=Buffer$v.allocUnsafe(48);function e(_t,At,xt){$t.writeInt32BE(_t,xt),$t.writeInt32BE(At,xt+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),$t};var sha384$1=Sha384,exports=sha_js.exports=function(e){e=e.toLowerCase();var _t=exports[e];if(!_t)throw new Error(e+" is not supported (we accept pull requests)");return new _t};exports.sha=sha$4;exports.sha1=sha1;exports.sha224=sha224$1;exports.sha256=sha256$3;exports.sha384=sha384$1;exports.sha512=sha512$3;var sha_jsExports=sha_js.exports,streamBrowserify=Stream$3,EE$2=eventsExports.EventEmitter,inherits$h=inherits_browserExports;inherits$h(Stream$3,EE$2);Stream$3.Readable=require_stream_readable$1();Stream$3.Writable=require_stream_writable$1();Stream$3.Duplex=require_stream_duplex$1();Stream$3.Transform=_stream_transform$1;Stream$3.PassThrough=_stream_passthrough$1;Stream$3.finished=endOfStream$2;Stream$3.pipeline=pipeline_1$2;Stream$3.Stream=Stream$3;function Stream$3(){EE$2.call(this)}Stream$3.prototype.pipe=function($t,e){var _t=this;function At(jt){$t.writable&&$t.write(jt)===!1&&_t.pause&&_t.pause()}_t.on("data",At);function xt(){_t.readable&&_t.resume&&_t.resume()}$t.on("drain",xt),!$t._isStdio&&(!e||e.end!==!1)&&(_t.on("end",Bt),_t.on("close",Nt));var kt=!1;function Bt(){kt||(kt=!0,$t.end())}function Nt(){kt||(kt=!0,typeof $t.destroy=="function"&&$t.destroy())}function Ut(jt){if(Lt(),EE$2.listenerCount(this,"error")===0)throw jt}_t.on("error",Ut),$t.on("error",Ut);function Lt(){_t.removeListener("data",At),$t.removeListener("drain",xt),_t.removeListener("end",Bt),_t.removeListener("close",Nt),_t.removeListener("error",Ut),$t.removeListener("error",Ut),_t.removeListener("end",Lt),_t.removeListener("close",Lt),$t.removeListener("close",Lt)}return _t.on("end",Lt),_t.on("close",Lt),$t.on("close",Lt),$t.emit("pipe",_t),$t};var Buffer$u=safeBufferExports$1.Buffer,Transform$a=streamBrowserify.Transform,StringDecoder=string_decoder.StringDecoder,inherits$g=inherits_browserExports;function CipherBase$1($t){Transform$a.call(this),this.hashMode=typeof $t=="string",this.hashMode?this[$t]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}inherits$g(CipherBase$1,Transform$a);CipherBase$1.prototype.update=function($t,e,_t){typeof $t=="string"&&($t=Buffer$u.from($t,e));var At=this._update($t);return this.hashMode?this:(_t&&(At=this._toString(At,_t)),At)};CipherBase$1.prototype.setAutoPadding=function(){};CipherBase$1.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")};CipherBase$1.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")};CipherBase$1.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")};CipherBase$1.prototype._transform=function($t,e,_t){var At;try{this.hashMode?this._update($t):this.push(this._update($t))}catch(xt){At=xt}finally{_t(At)}};CipherBase$1.prototype._flush=function($t){var e;try{this.push(this.__final())}catch(_t){e=_t}$t(e)};CipherBase$1.prototype._finalOrDigest=function($t){var e=this.__final()||Buffer$u.alloc(0);return $t&&(e=this._toString(e,$t,!0)),e};CipherBase$1.prototype._toString=function($t,e,_t){if(this._decoder||(this._decoder=new StringDecoder(e),this._encoding=e),this._encoding!==e)throw new Error("can't switch encodings");var At=this._decoder.write($t);return _t&&(At+=this._decoder.end()),At};var cipherBase=CipherBase$1,inherits$f=inherits_browserExports,MD5$2=md5_js,RIPEMD160$4=ripemd160$1,sha$3=sha_jsExports,Base$5=cipherBase;function Hash$1($t){Base$5.call(this,"digest"),this._hash=$t}inherits$f(Hash$1,Base$5);Hash$1.prototype._update=function($t){this._hash.update($t)};Hash$1.prototype._final=function(){return this._hash.digest()};var browser$c=function(e){return e=e.toLowerCase(),e==="md5"?new MD5$2:e==="rmd160"||e==="ripemd160"?new RIPEMD160$4:new Hash$1(sha$3(e))},inherits$e=inherits_browserExports,Buffer$t=safeBufferExports$1.Buffer,Base$4=cipherBase,ZEROS$2=Buffer$t.alloc(128),blocksize=64;function Hmac$3($t,e){Base$4.call(this,"digest"),typeof e=="string"&&(e=Buffer$t.from(e)),this._alg=$t,this._key=e,e.length>blocksize?e=$t(e):e.length<blocksize&&(e=Buffer$t.concat([e,ZEROS$2],blocksize));for(var _t=this._ipad=Buffer$t.allocUnsafe(blocksize),At=this._opad=Buffer$t.allocUnsafe(blocksize),xt=0;xt<blocksize;xt++)_t[xt]=e[xt]^54,At[xt]=e[xt]^92;this._hash=[_t]}inherits$e(Hmac$3,Base$4);Hmac$3.prototype._update=function($t){this._hash.push($t)};Hmac$3.prototype._final=function(){var $t=this._alg(Buffer$t.concat(this._hash));return this._alg(Buffer$t.concat([this._opad,$t]))};var legacy$2=Hmac$3,MD5$1=md5_js,md5$2=function($t){return new MD5$1().update($t).digest()},inherits$d=inherits_browserExports,Legacy=legacy$2,Base$3=cipherBase,Buffer$s=safeBufferExports$1.Buffer,md5$1=md5$2,RIPEMD160$3=ripemd160$1,sha$2=sha_jsExports,ZEROS$1=Buffer$s.alloc(128);function Hmac$2($t,e){Base$3.call(this,"digest"),typeof e=="string"&&(e=Buffer$s.from(e));var _t=$t==="sha512"||$t==="sha384"?128:64;if(this._alg=$t,this._key=e,e.length>_t){var At=$t==="rmd160"?new RIPEMD160$3:sha$2($t);e=At.update(e).digest()}else e.length<_t&&(e=Buffer$s.concat([e,ZEROS$1],_t));for(var xt=this._ipad=Buffer$s.allocUnsafe(_t),kt=this._opad=Buffer$s.allocUnsafe(_t),Bt=0;Bt<_t;Bt++)xt[Bt]=e[Bt]^54,kt[Bt]=e[Bt]^92;this._hash=$t==="rmd160"?new RIPEMD160$3:sha$2($t),this._hash.update(xt)}inherits$d(Hmac$2,Base$3);Hmac$2.prototype._update=function($t){this._hash.update($t)};Hmac$2.prototype._final=function(){var $t=this._hash.digest(),e=this._alg==="rmd160"?new RIPEMD160$3:sha$2(this._alg);return e.update(this._opad).update($t).digest()};var browser$b=function(e,_t){return e=e.toLowerCase(),e==="rmd160"||e==="ripemd160"?new Hmac$2("rmd160",_t):e==="md5"?new Legacy(md5$1,_t):new Hmac$2(e,_t)};const sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},sha256$2={sign:"ecdsa",hash:"sha256",id:""},sha224={sign:"ecdsa",hash:"sha224",id:""},sha384={sign:"ecdsa",hash:"sha384",id:""},sha512$2={sign:"ecdsa",hash:"sha512",id:""},DSA={sign:"dsa",hash:"sha1",id:""},ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption={sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},require$$6$1={sha224WithRSAEncryption,"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption,"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption,"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption,"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:sha256$2,sha224,sha384,sha512:sha512$2,"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA,"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA,"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption,"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}};var algos=require$$6$1,browser$a={},MAX_ALLOC=Math.pow(2,30)-1,precondition=function($t,e){if(typeof $t!="number")throw new TypeError("Iterations not a number");if($t<0)throw new TypeError("Bad iterations");if(typeof e!="number")throw new TypeError("Key length not a number");if(e<0||e>MAX_ALLOC||e!==e)throw new TypeError("Bad key length")},defaultEncoding$2;if(globalThis.process&&globalThis.process.browser)defaultEncoding$2="utf-8";else if(globalThis.process&&globalThis.process.version){var pVersionMajor=parseInt(process$9.version.split(".")[0].slice(1),10);defaultEncoding$2=pVersionMajor>=6?"utf-8":"binary"}else defaultEncoding$2="utf-8";var defaultEncoding_1=defaultEncoding$2,Buffer$r=safeBufferExports$1.Buffer,toBuffer$2=function($t,e,_t){if(Buffer$r.isBuffer($t))return $t;if(typeof $t=="string")return Buffer$r.from($t,e);if(ArrayBuffer.isView($t))return Buffer$r.from($t.buffer);throw new TypeError(_t+" must be a string, a Buffer, a typed array or a DataView")},md5=md5$2,RIPEMD160$2=ripemd160$1,sha$1=sha_jsExports,Buffer$q=safeBufferExports$1.Buffer,checkParameters$1=precondition,defaultEncoding$1=defaultEncoding_1,toBuffer$1=toBuffer$2,ZEROS=Buffer$q.alloc(128),sizes={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function Hmac$1($t,e,_t){var At=getDigest($t),xt=$t==="sha512"||$t==="sha384"?128:64;e.length>xt?e=At(e):e.length<xt&&(e=Buffer$q.concat([e,ZEROS],xt));for(var kt=Buffer$q.allocUnsafe(xt+sizes[$t]),Bt=Buffer$q.allocUnsafe(xt+sizes[$t]),Nt=0;Nt<xt;Nt++)kt[Nt]=e[Nt]^54,Bt[Nt]=e[Nt]^92;var Ut=Buffer$q.allocUnsafe(xt+_t+4);kt.copy(Ut,0,0,xt),this.ipad1=Ut,this.ipad2=kt,this.opad=Bt,this.alg=$t,this.blocksize=xt,this.hash=At,this.size=sizes[$t]}Hmac$1.prototype.run=function($t,e){$t.copy(e,this.blocksize);var _t=this.hash(e);return _t.copy(this.opad,this.blocksize),this.hash(this.opad)};function getDigest($t){function e(At){return sha$1($t).update(At).digest()}function _t(At){return new RIPEMD160$2().update(At).digest()}return $t==="rmd160"||$t==="ripemd160"?_t:$t==="md5"?md5:e}function pbkdf2($t,e,_t,At,xt){checkParameters$1(_t,At),$t=toBuffer$1($t,defaultEncoding$1,"Password"),e=toBuffer$1(e,defaultEncoding$1,"Salt"),xt=xt||"sha1";var kt=new Hmac$1(xt,$t,e.length),Bt=Buffer$q.allocUnsafe(At),Nt=Buffer$q.allocUnsafe(e.length+4);e.copy(Nt,0,0,e.length);for(var Ut=0,Lt=sizes[xt],jt=Math.ceil(At/Lt),Kt=1;Kt<=jt;Kt++){Nt.writeUInt32BE(Kt,e.length);for(var qt=kt.run(Nt,kt.ipad1),zt=qt,Vt=1;Vt<_t;Vt++){zt=kt.run(zt,kt.ipad2);for(var Ht=0;Ht<Lt;Ht++)qt[Ht]^=zt[Ht]}qt.copy(Bt,Ut),Ut+=Lt}return Bt}var syncBrowser=pbkdf2,Buffer$p=safeBufferExports$1.Buffer,checkParameters=precondition,defaultEncoding=defaultEncoding_1,sync=syncBrowser,toBuffer=toBuffer$2,ZERO_BUF,subtle=globalThis.crypto&&globalThis.crypto.subtle,toBrowser={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},checks=[];function checkNative($t){if(globalThis.process&&!globalThis.process.browser||!subtle||!subtle.importKey||!subtle.deriveBits)return Promise.resolve(!1);if(checks[$t]!==void 0)return checks[$t];ZERO_BUF=ZERO_BUF||Buffer$p.alloc(8);var e=browserPbkdf2(ZERO_BUF,ZERO_BUF,10,128,$t).then(function(){return!0}).catch(function(){return!1});return checks[$t]=e,e}var nextTick$3;function getNextTick(){return nextTick$3||(globalThis.process&&globalThis.process.nextTick?nextTick$3=globalThis.process.nextTick:globalThis.queueMicrotask?nextTick$3=globalThis.queueMicrotask:globalThis.setImmediate?nextTick$3=globalThis.setImmediate:nextTick$3=globalThis.setTimeout,nextTick$3)}function browserPbkdf2($t,e,_t,At,xt){return subtle.importKey("raw",$t,{name:"PBKDF2"},!1,["deriveBits"]).then(function(kt){return subtle.deriveBits({name:"PBKDF2",salt:e,iterations:_t,hash:{name:xt}},kt,At<<3)}).then(function(kt){return Buffer$p.from(kt)})}function resolvePromise($t,e){$t.then(function(_t){getNextTick()(function(){e(null,_t)})},function(_t){getNextTick()(function(){e(_t)})})}var async=function($t,e,_t,At,xt,kt){typeof xt=="function"&&(kt=xt,xt=void 0),xt=xt||"sha1";var Bt=toBrowser[xt.toLowerCase()];if(!Bt||typeof globalThis.Promise!="function"){getNextTick()(function(){var Nt;try{Nt=sync($t,e,_t,At,xt)}catch(Ut){return kt(Ut)}kt(null,Nt)});return}if(checkParameters(_t,At),$t=toBuffer($t,defaultEncoding,"Password"),e=toBuffer(e,defaultEncoding,"Salt"),typeof kt!="function")throw new Error("No callback provided to pbkdf2");resolvePromise(checkNative(Bt).then(function(Nt){return Nt?browserPbkdf2($t,e,_t,At,Bt):sync($t,e,_t,At,xt)}),kt)};browser$a.pbkdf2=async;browser$a.pbkdf2Sync=syncBrowser;var browser$9={},des$2={},utils$v={};utils$v.readUInt32BE=function(e,_t){var At=e[0+_t]<<24|e[1+_t]<<16|e[2+_t]<<8|e[3+_t];return At>>>0};utils$v.writeUInt32BE=function(e,_t,At){e[0+At]=_t>>>24,e[1+At]=_t>>>16&255,e[2+At]=_t>>>8&255,e[3+At]=_t&255};utils$v.ip=function(e,_t,At,xt){for(var kt=0,Bt=0,Nt=6;Nt>=0;Nt-=2){for(var Ut=0;Ut<=24;Ut+=8)kt<<=1,kt|=_t>>>Ut+Nt&1;for(var Ut=0;Ut<=24;Ut+=8)kt<<=1,kt|=e>>>Ut+Nt&1}for(var Nt=6;Nt>=0;Nt-=2){for(var Ut=1;Ut<=25;Ut+=8)Bt<<=1,Bt|=_t>>>Ut+Nt&1;for(var Ut=1;Ut<=25;Ut+=8)Bt<<=1,Bt|=e>>>Ut+Nt&1}At[xt+0]=kt>>>0,At[xt+1]=Bt>>>0};utils$v.rip=function(e,_t,At,xt){for(var kt=0,Bt=0,Nt=0;Nt<4;Nt++)for(var Ut=24;Ut>=0;Ut-=8)kt<<=1,kt|=_t>>>Ut+Nt&1,kt<<=1,kt|=e>>>Ut+Nt&1;for(var Nt=4;Nt<8;Nt++)for(var Ut=24;Ut>=0;Ut-=8)Bt<<=1,Bt|=_t>>>Ut+Nt&1,Bt<<=1,Bt|=e>>>Ut+Nt&1;At[xt+0]=kt>>>0,At[xt+1]=Bt>>>0};utils$v.pc1=function(e,_t,At,xt){for(var kt=0,Bt=0,Nt=7;Nt>=5;Nt--){for(var Ut=0;Ut<=24;Ut+=8)kt<<=1,kt|=_t>>Ut+Nt&1;for(var Ut=0;Ut<=24;Ut+=8)kt<<=1,kt|=e>>Ut+Nt&1}for(var Ut=0;Ut<=24;Ut+=8)kt<<=1,kt|=_t>>Ut+Nt&1;for(var Nt=1;Nt<=3;Nt++){for(var Ut=0;Ut<=24;Ut+=8)Bt<<=1,Bt|=_t>>Ut+Nt&1;for(var Ut=0;Ut<=24;Ut+=8)Bt<<=1,Bt|=e>>Ut+Nt&1}for(var Ut=0;Ut<=24;Ut+=8)Bt<<=1,Bt|=e>>Ut+Nt&1;At[xt+0]=kt>>>0,At[xt+1]=Bt>>>0};utils$v.r28shl=function(e,_t){return e<<_t&268435455|e>>>28-_t};var pc2table=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];utils$v.pc2=function(e,_t,At,xt){for(var kt=0,Bt=0,Nt=pc2table.length>>>1,Ut=0;Ut<Nt;Ut++)kt<<=1,kt|=e>>>pc2table[Ut]&1;for(var Ut=Nt;Ut<pc2table.length;Ut++)Bt<<=1,Bt|=_t>>>pc2table[Ut]&1;At[xt+0]=kt>>>0,At[xt+1]=Bt>>>0};utils$v.expand=function(e,_t,At){var xt=0,kt=0;xt=(e&1)<<5|e>>>27;for(var Bt=23;Bt>=15;Bt-=4)xt<<=6,xt|=e>>>Bt&63;for(var Bt=11;Bt>=3;Bt-=4)kt|=e>>>Bt&63,kt<<=6;kt|=(e&31)<<1|e>>>31,_t[At+0]=xt>>>0,_t[At+1]=kt>>>0};var sTable=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];utils$v.substitute=function(e,_t){for(var At=0,xt=0;xt<4;xt++){var kt=e>>>18-xt*6&63,Bt=sTable[xt*64+kt];At<<=4,At|=Bt}for(var xt=0;xt<4;xt++){var kt=_t>>>18-xt*6&63,Bt=sTable[4*64+xt*64+kt];At<<=4,At|=Bt}return At>>>0};var permuteTable=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];utils$v.permute=function(e){for(var _t=0,At=0;At<permuteTable.length;At++)_t<<=1,_t|=e>>>permuteTable[At]&1;return _t>>>0};utils$v.padSplit=function(e,_t,At){for(var xt=e.toString(2);xt.length<_t;)xt="0"+xt;for(var kt=[],Bt=0;Bt<_t;Bt+=At)kt.push(xt.slice(Bt,Bt+At));return kt.join(" ")};var minimalisticAssert=assert$m;function assert$m($t,e){if(!$t)throw new Error(e||"Assertion failed")}assert$m.equal=function(e,_t,At){if(e!=_t)throw new Error(At||"Assertion failed: "+e+" != "+_t)};var assert$l=minimalisticAssert;function Cipher$3($t){this.options=$t,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=$t.padding!==!1}var cipher=Cipher$3;Cipher$3.prototype._init=function(){};Cipher$3.prototype.update=function(e){return e.length===0?[]:this.type==="decrypt"?this._updateDecrypt(e):this._updateEncrypt(e)};Cipher$3.prototype._buffer=function(e,_t){for(var At=Math.min(this.buffer.length-this.bufferOff,e.length-_t),xt=0;xt<At;xt++)this.buffer[this.bufferOff+xt]=e[_t+xt];return this.bufferOff+=At,At};Cipher$3.prototype._flushBuffer=function(e,_t){return this._update(this.buffer,0,e,_t),this.bufferOff=0,this.blockSize};Cipher$3.prototype._updateEncrypt=function(e){var _t=0,At=0,xt=(this.bufferOff+e.length)/this.blockSize|0,kt=new Array(xt*this.blockSize);this.bufferOff!==0&&(_t+=this._buffer(e,_t),this.bufferOff===this.buffer.length&&(At+=this._flushBuffer(kt,At)));for(var Bt=e.length-(e.length-_t)%this.blockSize;_t<Bt;_t+=this.blockSize)this._update(e,_t,kt,At),At+=this.blockSize;for(;_t<e.length;_t++,this.bufferOff++)this.buffer[this.bufferOff]=e[_t];return kt};Cipher$3.prototype._updateDecrypt=function(e){for(var _t=0,At=0,xt=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,kt=new Array(xt*this.blockSize);xt>0;xt--)_t+=this._buffer(e,_t),At+=this._flushBuffer(kt,At);return _t+=this._buffer(e,_t),kt};Cipher$3.prototype.final=function(e){var _t;e&&(_t=this.update(e));var At;return this.type==="encrypt"?At=this._finalEncrypt():At=this._finalDecrypt(),_t?_t.concat(At):At};Cipher$3.prototype._pad=function(e,_t){if(_t===0)return!1;for(;_t<e.length;)e[_t++]=0;return!0};Cipher$3.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e};Cipher$3.prototype._unpad=function(e){return e};Cipher$3.prototype._finalDecrypt=function(){assert$l.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)};var assert$k=minimalisticAssert,inherits$c=inherits_browserExports,utils$u=utils$v,Cipher$2=cipher;function DESState(){this.tmp=new Array(2),this.keys=null}function DES$3($t){Cipher$2.call(this,$t);var e=new DESState;this._desState=e,this.deriveKeys(e,$t.key)}inherits$c(DES$3,Cipher$2);var des$1=DES$3;DES$3.create=function(e){return new DES$3(e)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES$3.prototype.deriveKeys=function(e,_t){e.keys=new Array(16*2),assert$k.equal(_t.length,this.blockSize,"Invalid key length");var At=utils$u.readUInt32BE(_t,0),xt=utils$u.readUInt32BE(_t,4);utils$u.pc1(At,xt,e.tmp,0),At=e.tmp[0],xt=e.tmp[1];for(var kt=0;kt<e.keys.length;kt+=2){var Bt=shiftTable[kt>>>1];At=utils$u.r28shl(At,Bt),xt=utils$u.r28shl(xt,Bt),utils$u.pc2(At,xt,e.keys,kt)}};DES$3.prototype._update=function(e,_t,At,xt){var kt=this._desState,Bt=utils$u.readUInt32BE(e,_t),Nt=utils$u.readUInt32BE(e,_t+4);utils$u.ip(Bt,Nt,kt.tmp,0),Bt=kt.tmp[0],Nt=kt.tmp[1],this.type==="encrypt"?this._encrypt(kt,Bt,Nt,kt.tmp,0):this._decrypt(kt,Bt,Nt,kt.tmp,0),Bt=kt.tmp[0],Nt=kt.tmp[1],utils$u.writeUInt32BE(At,Bt,xt),utils$u.writeUInt32BE(At,Nt,xt+4)};DES$3.prototype._pad=function(e,_t){if(this.padding===!1)return!1;for(var At=e.length-_t,xt=_t;xt<e.length;xt++)e[xt]=At;return!0};DES$3.prototype._unpad=function(e){if(this.padding===!1)return e;for(var _t=e[e.length-1],At=e.length-_t;At<e.length;At++)assert$k.equal(e[At],_t);return e.slice(0,e.length-_t)};DES$3.prototype._encrypt=function(e,_t,At,xt,kt){for(var Bt=_t,Nt=At,Ut=0;Ut<e.keys.length;Ut+=2){var Lt=e.keys[Ut],jt=e.keys[Ut+1];utils$u.expand(Nt,e.tmp,0),Lt^=e.tmp[0],jt^=e.tmp[1];var Kt=utils$u.substitute(Lt,jt),qt=utils$u.permute(Kt),zt=Nt;Nt=(Bt^qt)>>>0,Bt=zt}utils$u.rip(Nt,Bt,xt,kt)};DES$3.prototype._decrypt=function(e,_t,At,xt,kt){for(var Bt=At,Nt=_t,Ut=e.keys.length-2;Ut>=0;Ut-=2){var Lt=e.keys[Ut],jt=e.keys[Ut+1];utils$u.expand(Bt,e.tmp,0),Lt^=e.tmp[0],jt^=e.tmp[1];var Kt=utils$u.substitute(Lt,jt),qt=utils$u.permute(Kt),zt=Bt;Bt=(Nt^qt)>>>0,Nt=zt}utils$u.rip(Bt,Nt,xt,kt)};var cbc$1={},assert$j=minimalisticAssert,inherits$b=inherits_browserExports,proto={};function CBCState($t){assert$j.equal($t.length,8,"Invalid IV length"),this.iv=new Array(8);for(var e=0;e<this.iv.length;e++)this.iv[e]=$t[e]}function instantiate($t){function e(kt){$t.call(this,kt),this._cbcInit()}inherits$b(e,$t);for(var _t=Object.keys(proto),At=0;At<_t.length;At++){var xt=_t[At];e.prototype[xt]=proto[xt]}return e.create=function(Bt){return new e(Bt)},e}cbc$1.instantiate=instantiate;proto._cbcInit=function(){var e=new CBCState(this.options.iv);this._cbcState=e};proto._update=function(e,_t,At,xt){var kt=this._cbcState,Bt=this.constructor.super_.prototype,Nt=kt.iv;if(this.type==="encrypt"){for(var Ut=0;Ut<this.blockSize;Ut++)Nt[Ut]^=e[_t+Ut];Bt._update.call(this,Nt,0,At,xt);for(var Ut=0;Ut<this.blockSize;Ut++)Nt[Ut]=At[xt+Ut]}else{Bt._update.call(this,e,_t,At,xt);for(var Ut=0;Ut<this.blockSize;Ut++)At[xt+Ut]^=Nt[Ut];for(var Ut=0;Ut<this.blockSize;Ut++)Nt[Ut]=e[_t+Ut]}};var assert$i=minimalisticAssert,inherits$a=inherits_browserExports,Cipher$1=cipher,DES$2=des$1;function EDEState($t,e){assert$i.equal(e.length,24,"Invalid key length");var _t=e.slice(0,8),At=e.slice(8,16),xt=e.slice(16,24);$t==="encrypt"?this.ciphers=[DES$2.create({type:"encrypt",key:_t}),DES$2.create({type:"decrypt",key:At}),DES$2.create({type:"encrypt",key:xt})]:this.ciphers=[DES$2.create({type:"decrypt",key:xt}),DES$2.create({type:"encrypt",key:At}),DES$2.create({type:"decrypt",key:_t})]}function EDE($t){Cipher$1.call(this,$t);var e=new EDEState(this.type,this.options.key);this._edeState=e}inherits$a(EDE,Cipher$1);var ede=EDE;EDE.create=function(e){return new EDE(e)};EDE.prototype._update=function(e,_t,At,xt){var kt=this._edeState;kt.ciphers[0]._update(e,_t,At,xt),kt.ciphers[1]._update(At,xt,At,xt),kt.ciphers[2]._update(At,xt,At,xt)};EDE.prototype._pad=DES$2.prototype._pad;EDE.prototype._unpad=DES$2.prototype._unpad;des$2.utils=utils$v;des$2.Cipher=cipher;des$2.DES=des$1;des$2.CBC=cbc$1;des$2.EDE=ede;var CipherBase=cipherBase,des=des$2,inherits$9=inherits_browserExports,Buffer$o=safeBufferExports$1.Buffer,modes$3={"des-ede3-cbc":des.CBC.instantiate(des.EDE),"des-ede3":des.EDE,"des-ede-cbc":des.CBC.instantiate(des.EDE),"des-ede":des.EDE,"des-cbc":des.CBC.instantiate(des.DES),"des-ecb":des.DES};modes$3.des=modes$3["des-cbc"];modes$3.des3=modes$3["des-ede3-cbc"];var browserifyDes=DES$1;inherits$9(DES$1,CipherBase);function DES$1($t){CipherBase.call(this);var e=$t.mode.toLowerCase(),_t=modes$3[e],At;$t.decrypt?At="decrypt":At="encrypt";var xt=$t.key;Buffer$o.isBuffer(xt)||(xt=Buffer$o.from(xt)),(e==="des-ede"||e==="des-ede-cbc")&&(xt=Buffer$o.concat([xt,xt.slice(0,8)]));var kt=$t.iv;Buffer$o.isBuffer(kt)||(kt=Buffer$o.from(kt)),this._des=_t.create({key:xt,iv:kt,type:At})}DES$1.prototype._update=function($t){return Buffer$o.from(this._des.update($t))};DES$1.prototype._final=function(){return Buffer$o.from(this._des.final())};var browser$8={},encrypter={},ecb={};ecb.encrypt=function($t,e){return $t._cipher.encryptBlock(e)};ecb.decrypt=function($t,e){return $t._cipher.decryptBlock(e)};var cbc={},bufferXor=function(e,_t){for(var At=Math.min(e.length,_t.length),xt=new buffer$2.Buffer(At),kt=0;kt<At;++kt)xt[kt]=e[kt]^_t[kt];return xt},xor$7=bufferXor;cbc.encrypt=function($t,e){var _t=xor$7(e,$t._prev);return $t._prev=$t._cipher.encryptBlock(_t),$t._prev};cbc.decrypt=function($t,e){var _t=$t._prev;$t._prev=e;var At=$t._cipher.decryptBlock(e);return xor$7(At,_t)};var cfb={},Buffer$n=safeBufferExports$1.Buffer,xor$6=bufferXor;function encryptStart($t,e,_t){var At=e.length,xt=xor$6(e,$t._cache);return $t._cache=$t._cache.slice(At),$t._prev=Buffer$n.concat([$t._prev,_t?e:xt]),xt}cfb.encrypt=function($t,e,_t){for(var At=Buffer$n.allocUnsafe(0),xt;e.length;)if($t._cache.length===0&&($t._cache=$t._cipher.encryptBlock($t._prev),$t._prev=Buffer$n.allocUnsafe(0)),$t._cache.length<=e.length)xt=$t._cache.length,At=Buffer$n.concat([At,encryptStart($t,e.slice(0,xt),_t)]),e=e.slice(xt);else{At=Buffer$n.concat([At,encryptStart($t,e,_t)]);break}return At};var cfb8={},Buffer$m=safeBufferExports$1.Buffer;function encryptByte$1($t,e,_t){var At=$t._cipher.encryptBlock($t._prev),xt=At[0]^e;return $t._prev=Buffer$m.concat([$t._prev.slice(1),Buffer$m.from([_t?e:xt])]),xt}cfb8.encrypt=function($t,e,_t){for(var At=e.length,xt=Buffer$m.allocUnsafe(At),kt=-1;++kt<At;)xt[kt]=encryptByte$1($t,e[kt],_t);return xt};var cfb1={},Buffer$l=safeBufferExports$1.Buffer;function encryptByte($t,e,_t){for(var At,xt=-1,kt=8,Bt=0,Nt,Ut;++xt<kt;)At=$t._cipher.encryptBlock($t._prev),Nt=e&1<<7-xt?128:0,Ut=At[0]^Nt,Bt+=(Ut&128)>>xt%8,$t._prev=shiftIn($t._prev,_t?Nt:Ut);return Bt}function shiftIn($t,e){var _t=$t.length,At=-1,xt=Buffer$l.allocUnsafe($t.length);for($t=Buffer$l.concat([$t,Buffer$l.from([e])]);++At<_t;)xt[At]=$t[At]<<1|$t[At+1]>>7;return xt}cfb1.encrypt=function($t,e,_t){for(var At=e.length,xt=Buffer$l.allocUnsafe(At),kt=-1;++kt<At;)xt[kt]=encryptByte($t,e[kt],_t);return xt};var ofb={},xor$5=bufferXor;function getBlock$1($t){return $t._prev=$t._cipher.encryptBlock($t._prev),$t._prev}ofb.encrypt=function($t,e){for(;$t._cache.length<e.length;)$t._cache=buffer$2.Buffer.concat([$t._cache,getBlock$1($t)]);var _t=$t._cache.slice(0,e.length);return $t._cache=$t._cache.slice(e.length),xor$5(e,_t)};var ctr={};function incr32$2($t){for(var e=$t.length,_t;e--;)if(_t=$t.readUInt8(e),_t===255)$t.writeUInt8(0,e);else{_t++,$t.writeUInt8(_t,e);break}}var incr32_1=incr32$2,xor$4=bufferXor,Buffer$k=safeBufferExports$1.Buffer,incr32$1=incr32_1;function getBlock($t){var e=$t._cipher.encryptBlockRaw($t._prev);return incr32$1($t._prev),e}var blockSize=16;ctr.encrypt=function($t,e){var _t=Math.ceil(e.length/blockSize),At=$t._cache.length;$t._cache=Buffer$k.concat([$t._cache,Buffer$k.allocUnsafe(_t*blockSize)]);for(var xt=0;xt<_t;xt++){var kt=getBlock($t),Bt=At+xt*blockSize;$t._cache.writeUInt32BE(kt[0],Bt+0),$t._cache.writeUInt32BE(kt[1],Bt+4),$t._cache.writeUInt32BE(kt[2],Bt+8),$t._cache.writeUInt32BE(kt[3],Bt+12)}var Nt=$t._cache.slice(0,e.length);return $t._cache=$t._cache.slice(e.length),xor$4(e,Nt)};const aes128={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},require$$2$1={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128,aes192,aes256,"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};var modeModules={ECB:ecb,CBC:cbc,CFB:cfb,CFB8:cfb8,CFB1:cfb1,OFB:ofb,CTR:ctr,GCM:ctr},modes$2=require$$2$1;for(var key$2 in modes$2)modes$2[key$2].module=modeModules[modes$2[key$2].mode];var modes_1=modes$2,aes$5={},Buffer$j=safeBufferExports$1.Buffer;function asUInt32Array($t){Buffer$j.isBuffer($t)||($t=Buffer$j.from($t));for(var e=$t.length/4|0,_t=new Array(e),At=0;At<e;At++)_t[At]=$t.readUInt32BE(At*4);return _t}function scrubVec($t){for(var e=0;e<$t.length;$t++)$t[e]=0}function cryptBlock($t,e,_t,At,xt){for(var kt=_t[0],Bt=_t[1],Nt=_t[2],Ut=_t[3],Lt=$t[0]^e[0],jt=$t[1]^e[1],Kt=$t[2]^e[2],qt=$t[3]^e[3],zt,Vt,Ht,Wt,Qt=4,Xt=1;Xt<xt;Xt++)zt=kt[Lt>>>24]^Bt[jt>>>16&255]^Nt[Kt>>>8&255]^Ut[qt&255]^e[Qt++],Vt=kt[jt>>>24]^Bt[Kt>>>16&255]^Nt[qt>>>8&255]^Ut[Lt&255]^e[Qt++],Ht=kt[Kt>>>24]^Bt[qt>>>16&255]^Nt[Lt>>>8&255]^Ut[jt&255]^e[Qt++],Wt=kt[qt>>>24]^Bt[Lt>>>16&255]^Nt[jt>>>8&255]^Ut[Kt&255]^e[Qt++],Lt=zt,jt=Vt,Kt=Ht,qt=Wt;return zt=(At[Lt>>>24]<<24|At[jt>>>16&255]<<16|At[Kt>>>8&255]<<8|At[qt&255])^e[Qt++],Vt=(At[jt>>>24]<<24|At[Kt>>>16&255]<<16|At[qt>>>8&255]<<8|At[Lt&255])^e[Qt++],Ht=(At[Kt>>>24]<<24|At[qt>>>16&255]<<16|At[Lt>>>8&255]<<8|At[jt&255])^e[Qt++],Wt=(At[qt>>>24]<<24|At[Lt>>>16&255]<<16|At[jt>>>8&255]<<8|At[Kt&255])^e[Qt++],zt=zt>>>0,Vt=Vt>>>0,Ht=Ht>>>0,Wt=Wt>>>0,[zt,Vt,Ht,Wt]}var RCON=[0,1,2,4,8,16,32,64,128,27,54],G$1=function(){for(var $t=new Array(256),e=0;e<256;e++)e<128?$t[e]=e<<1:$t[e]=e<<1^283;for(var _t=[],At=[],xt=[[],[],[],[]],kt=[[],[],[],[]],Bt=0,Nt=0,Ut=0;Ut<256;++Ut){var Lt=Nt^Nt<<1^Nt<<2^Nt<<3^Nt<<4;Lt=Lt>>>8^Lt&255^99,_t[Bt]=Lt,At[Lt]=Bt;var jt=$t[Bt],Kt=$t[jt],qt=$t[Kt],zt=$t[Lt]*257^Lt*16843008;xt[0][Bt]=zt<<24|zt>>>8,xt[1][Bt]=zt<<16|zt>>>16,xt[2][Bt]=zt<<8|zt>>>24,xt[3][Bt]=zt,zt=qt*16843009^Kt*65537^jt*257^Bt*16843008,kt[0][Lt]=zt<<24|zt>>>8,kt[1][Lt]=zt<<16|zt>>>16,kt[2][Lt]=zt<<8|zt>>>24,kt[3][Lt]=zt,Bt===0?Bt=Nt=1:(Bt=jt^$t[$t[$t[qt^jt]]],Nt^=$t[$t[Nt]])}return{SBOX:_t,INV_SBOX:At,SUB_MIX:xt,INV_SUB_MIX:kt}}();function AES($t){this._key=asUInt32Array($t),this._reset()}AES.blockSize=4*4;AES.keySize=256/8;AES.prototype.blockSize=AES.blockSize;AES.prototype.keySize=AES.keySize;AES.prototype._reset=function(){for(var $t=this._key,e=$t.length,_t=e+6,At=(_t+1)*4,xt=[],kt=0;kt<e;kt++)xt[kt]=$t[kt];for(kt=e;kt<At;kt++){var Bt=xt[kt-1];kt%e===0?(Bt=Bt<<8|Bt>>>24,Bt=G$1.SBOX[Bt>>>24]<<24|G$1.SBOX[Bt>>>16&255]<<16|G$1.SBOX[Bt>>>8&255]<<8|G$1.SBOX[Bt&255],Bt^=RCON[kt/e|0]<<24):e>6&&kt%e===4&&(Bt=G$1.SBOX[Bt>>>24]<<24|G$1.SBOX[Bt>>>16&255]<<16|G$1.SBOX[Bt>>>8&255]<<8|G$1.SBOX[Bt&255]),xt[kt]=xt[kt-e]^Bt}for(var Nt=[],Ut=0;Ut<At;Ut++){var Lt=At-Ut,jt=xt[Lt-(Ut%4?0:4)];Ut<4||Lt<=4?Nt[Ut]=jt:Nt[Ut]=G$1.INV_SUB_MIX[0][G$1.SBOX[jt>>>24]]^G$1.INV_SUB_MIX[1][G$1.SBOX[jt>>>16&255]]^G$1.INV_SUB_MIX[2][G$1.SBOX[jt>>>8&255]]^G$1.INV_SUB_MIX[3][G$1.SBOX[jt&255]]}this._nRounds=_t,this._keySchedule=xt,this._invKeySchedule=Nt};AES.prototype.encryptBlockRaw=function($t){return $t=asUInt32Array($t),cryptBlock($t,this._keySchedule,G$1.SUB_MIX,G$1.SBOX,this._nRounds)};AES.prototype.encryptBlock=function($t){var e=this.encryptBlockRaw($t),_t=Buffer$j.allocUnsafe(16);return _t.writeUInt32BE(e[0],0),_t.writeUInt32BE(e[1],4),_t.writeUInt32BE(e[2],8),_t.writeUInt32BE(e[3],12),_t};AES.prototype.decryptBlock=function($t){$t=asUInt32Array($t);var e=$t[1];$t[1]=$t[3],$t[3]=e;var _t=cryptBlock($t,this._invKeySchedule,G$1.INV_SUB_MIX,G$1.INV_SBOX,this._nRounds),At=Buffer$j.allocUnsafe(16);return At.writeUInt32BE(_t[0],0),At.writeUInt32BE(_t[3],4),At.writeUInt32BE(_t[2],8),At.writeUInt32BE(_t[1],12),At};AES.prototype.scrub=function(){scrubVec(this._keySchedule),scrubVec(this._invKeySchedule),scrubVec(this._key)};aes$5.AES=AES;var Buffer$i=safeBufferExports$1.Buffer,ZEROES=Buffer$i.alloc(16,0);function toArray$3($t){return[$t.readUInt32BE(0),$t.readUInt32BE(4),$t.readUInt32BE(8),$t.readUInt32BE(12)]}function fromArray($t){var e=Buffer$i.allocUnsafe(16);return e.writeUInt32BE($t[0]>>>0,0),e.writeUInt32BE($t[1]>>>0,4),e.writeUInt32BE($t[2]>>>0,8),e.writeUInt32BE($t[3]>>>0,12),e}function GHASH$1($t){this.h=$t,this.state=Buffer$i.alloc(16,0),this.cache=Buffer$i.allocUnsafe(0)}GHASH$1.prototype.ghash=function($t){for(var e=-1;++e<$t.length;)this.state[e]^=$t[e];this._multiply()};GHASH$1.prototype._multiply=function(){for(var $t=toArray$3(this.h),e=[0,0,0,0],_t,At,xt,kt=-1;++kt<128;){for(At=(this.state[~~(kt/8)]&1<<7-kt%8)!==0,At&&(e[0]^=$t[0],e[1]^=$t[1],e[2]^=$t[2],e[3]^=$t[3]),xt=($t[3]&1)!==0,_t=3;_t>0;_t--)$t[_t]=$t[_t]>>>1|($t[_t-1]&1)<<31;$t[0]=$t[0]>>>1,xt&&($t[0]=$t[0]^225<<24)}this.state=fromArray(e)};GHASH$1.prototype.update=function($t){this.cache=Buffer$i.concat([this.cache,$t]);for(var e;this.cache.length>=16;)e=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(e)};GHASH$1.prototype.final=function($t,e){return this.cache.length&&this.ghash(Buffer$i.concat([this.cache,ZEROES],16)),this.ghash(fromArray([0,$t,0,e])),this.state};var ghash=GHASH$1,aes$4=aes$5,Buffer$h=safeBufferExports$1.Buffer,Transform$9=cipherBase,inherits$8=inherits_browserExports,GHASH=ghash,xor$3=bufferXor,incr32=incr32_1;function xorTest($t,e){var _t=0;$t.length!==e.length&&_t++;for(var At=Math.min($t.length,e.length),xt=0;xt<At;++xt)_t+=$t[xt]^e[xt];return _t}function calcIv($t,e,_t){if(e.length===12)return $t._finID=Buffer$h.concat([e,Buffer$h.from([0,0,0,1])]),Buffer$h.concat([e,Buffer$h.from([0,0,0,2])]);var At=new GHASH(_t),xt=e.length,kt=xt%16;At.update(e),kt&&(kt=16-kt,At.update(Buffer$h.alloc(kt,0))),At.update(Buffer$h.alloc(8,0));var Bt=xt*8,Nt=Buffer$h.alloc(8);Nt.writeUIntBE(Bt,0,8),At.update(Nt),$t._finID=At.state;var Ut=Buffer$h.from($t._finID);return incr32(Ut),Ut}function StreamCipher$3($t,e,_t,At){Transform$9.call(this);var xt=Buffer$h.alloc(4,0);this._cipher=new aes$4.AES(e);var kt=this._cipher.encryptBlock(xt);this._ghash=new GHASH(kt),_t=calcIv(this,_t,kt),this._prev=Buffer$h.from(_t),this._cache=Buffer$h.allocUnsafe(0),this._secCache=Buffer$h.allocUnsafe(0),this._decrypt=At,this._alen=0,this._len=0,this._mode=$t,this._authTag=null,this._called=!1}inherits$8(StreamCipher$3,Transform$9);StreamCipher$3.prototype._update=function($t){if(!this._called&&this._alen){var e=16-this._alen%16;e<16&&(e=Buffer$h.alloc(e,0),this._ghash.update(e))}this._called=!0;var _t=this._mode.encrypt(this,$t);return this._decrypt?this._ghash.update($t):this._ghash.update(_t),this._len+=$t.length,_t};StreamCipher$3.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var $t=xor$3(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&xorTest($t,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=$t,this._cipher.scrub()};StreamCipher$3.prototype.getAuthTag=function(){if(this._decrypt||!Buffer$h.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag};StreamCipher$3.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e};StreamCipher$3.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length};var authCipher=StreamCipher$3,aes$3=aes$5,Buffer$g=safeBufferExports$1.Buffer,Transform$8=cipherBase,inherits$7=inherits_browserExports;function StreamCipher$2($t,e,_t,At){Transform$8.call(this),this._cipher=new aes$3.AES(e),this._prev=Buffer$g.from(_t),this._cache=Buffer$g.allocUnsafe(0),this._secCache=Buffer$g.allocUnsafe(0),this._decrypt=At,this._mode=$t}inherits$7(StreamCipher$2,Transform$8);StreamCipher$2.prototype._update=function($t){return this._mode.encrypt(this,$t,this._decrypt)};StreamCipher$2.prototype._final=function(){this._cipher.scrub()};var streamCipher=StreamCipher$2,Buffer$f=safeBufferExports$1.Buffer,MD5=md5_js;function EVP_BytesToKey($t,e,_t,At){if(Buffer$f.isBuffer($t)||($t=Buffer$f.from($t,"binary")),e&&(Buffer$f.isBuffer(e)||(e=Buffer$f.from(e,"binary")),e.length!==8))throw new RangeError("salt should be Buffer with 8 byte length");for(var xt=_t/8,kt=Buffer$f.alloc(xt),Bt=Buffer$f.alloc(At||0),Nt=Buffer$f.alloc(0);xt>0||At>0;){var Ut=new MD5;Ut.update(Nt),Ut.update($t),e&&Ut.update(e),Nt=Ut.digest();var Lt=0;if(xt>0){var jt=kt.length-xt;Lt=Math.min(xt,Nt.length),Nt.copy(kt,jt,0,Lt),xt-=Lt}if(Lt<Nt.length&&At>0){var Kt=Bt.length-At,qt=Math.min(At,Nt.length-Lt);Nt.copy(Bt,Kt,Lt,Lt+qt),At-=qt}}return Nt.fill(0),{key:kt,iv:Bt}}var evp_bytestokey=EVP_BytesToKey,MODES$1=modes_1,AuthCipher$1=authCipher,Buffer$e=safeBufferExports$1.Buffer,StreamCipher$1=streamCipher,Transform$7=cipherBase,aes$2=aes$5,ebtk$2=evp_bytestokey,inherits$6=inherits_browserExports;function Cipher($t,e,_t){Transform$7.call(this),this._cache=new Splitter$1,this._cipher=new aes$2.AES(e),this._prev=Buffer$e.from(_t),this._mode=$t,this._autopadding=!0}inherits$6(Cipher,Transform$7);Cipher.prototype._update=function($t){this._cache.add($t);for(var e,_t,At=[];e=this._cache.get();)_t=this._mode.encrypt(this,e),At.push(_t);return Buffer$e.concat(At)};var PADDING=Buffer$e.alloc(16,16);Cipher.prototype._final=function(){var $t=this._cache.flush();if(this._autopadding)return $t=this._mode.encrypt(this,$t),this._cipher.scrub(),$t;if(!$t.equals(PADDING))throw this._cipher.scrub(),new Error("data not multiple of block length")};Cipher.prototype.setAutoPadding=function($t){return this._autopadding=!!$t,this};function Splitter$1(){this.cache=Buffer$e.allocUnsafe(0)}Splitter$1.prototype.add=function($t){this.cache=Buffer$e.concat([this.cache,$t])};Splitter$1.prototype.get=function(){if(this.cache.length>15){var $t=this.cache.slice(0,16);return this.cache=this.cache.slice(16),$t}return null};Splitter$1.prototype.flush=function(){for(var $t=16-this.cache.length,e=Buffer$e.allocUnsafe($t),_t=-1;++_t<$t;)e.writeUInt8($t,_t);return Buffer$e.concat([this.cache,e])};function createCipheriv$1($t,e,_t){var At=MODES$1[$t.toLowerCase()];if(!At)throw new TypeError("invalid suite type");if(typeof e=="string"&&(e=Buffer$e.from(e)),e.length!==At.key/8)throw new TypeError("invalid key length "+e.length);if(typeof _t=="string"&&(_t=Buffer$e.from(_t)),At.mode!=="GCM"&&_t.length!==At.iv)throw new TypeError("invalid iv length "+_t.length);return At.type==="stream"?new StreamCipher$1(At.module,e,_t):At.type==="auth"?new AuthCipher$1(At.module,e,_t):new Cipher(At.module,e,_t)}function createCipher$2($t,e){var _t=MODES$1[$t.toLowerCase()];if(!_t)throw new TypeError("invalid suite type");var At=ebtk$2(e,!1,_t.key,_t.iv);return createCipheriv$1($t,At.key,At.iv)}encrypter.createCipheriv=createCipheriv$1;encrypter.createCipher=createCipher$2;var decrypter={},AuthCipher=authCipher,Buffer$d=safeBufferExports$1.Buffer,MODES=modes_1,StreamCipher=streamCipher,Transform$6=cipherBase,aes$1=aes$5,ebtk$1=evp_bytestokey,inherits$5=inherits_browserExports;function Decipher($t,e,_t){Transform$6.call(this),this._cache=new Splitter,this._last=void 0,this._cipher=new aes$1.AES(e),this._prev=Buffer$d.from(_t),this._mode=$t,this._autopadding=!0}inherits$5(Decipher,Transform$6);Decipher.prototype._update=function($t){this._cache.add($t);for(var e,_t,At=[];e=this._cache.get(this._autopadding);)_t=this._mode.decrypt(this,e),At.push(_t);return Buffer$d.concat(At)};Decipher.prototype._final=function(){var $t=this._cache.flush();if(this._autopadding)return unpad(this._mode.decrypt(this,$t));if($t)throw new Error("data not multiple of block length")};Decipher.prototype.setAutoPadding=function($t){return this._autopadding=!!$t,this};function Splitter(){this.cache=Buffer$d.allocUnsafe(0)}Splitter.prototype.add=function($t){this.cache=Buffer$d.concat([this.cache,$t])};Splitter.prototype.get=function($t){var e;if($t){if(this.cache.length>16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e}else if(this.cache.length>=16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e;return null};Splitter.prototype.flush=function(){if(this.cache.length)return this.cache};function unpad($t){var e=$t[15];if(e<1||e>16)throw new Error("unable to decrypt data");for(var _t=-1;++_t<e;)if($t[_t+(16-e)]!==e)throw new Error("unable to decrypt data");if(e!==16)return $t.slice(0,16-e)}function createDecipheriv$1($t,e,_t){var At=MODES[$t.toLowerCase()];if(!At)throw new TypeError("invalid suite type");if(typeof _t=="string"&&(_t=Buffer$d.from(_t)),At.mode!=="GCM"&&_t.length!==At.iv)throw new TypeError("invalid iv length "+_t.length);if(typeof e=="string"&&(e=Buffer$d.from(e)),e.length!==At.key/8)throw new TypeError("invalid key length "+e.length);return At.type==="stream"?new StreamCipher(At.module,e,_t,!0):At.type==="auth"?new AuthCipher(At.module,e,_t,!0):new Decipher(At.module,e,_t)}function createDecipher$1($t,e){var _t=MODES[$t.toLowerCase()];if(!_t)throw new TypeError("invalid suite type");var At=ebtk$1(e,!1,_t.key,_t.iv);return createDecipheriv$1($t,At.key,At.iv)}decrypter.createDecipher=createDecipher$1;decrypter.createDecipheriv=createDecipheriv$1;var ciphers$2=encrypter,deciphers=decrypter,modes$1=require$$2$1;function getCiphers$1(){return Object.keys(modes$1)}browser$8.createCipher=browser$8.Cipher=ciphers$2.createCipher;browser$8.createCipheriv=browser$8.Cipheriv=ciphers$2.createCipheriv;browser$8.createDecipher=browser$8.Decipher=deciphers.createDecipher;browser$8.createDecipheriv=browser$8.Decipheriv=deciphers.createDecipheriv;browser$8.listCiphers=browser$8.getCiphers=getCiphers$1;var modes={};(function($t){$t["des-ecb"]={key:8,iv:0},$t["des-cbc"]=$t.des={key:8,iv:8},$t["des-ede3-cbc"]=$t.des3={key:24,iv:8},$t["des-ede3"]={key:24,iv:0},$t["des-ede-cbc"]={key:16,iv:8},$t["des-ede"]={key:16,iv:0}})(modes);var DES=browserifyDes,aes=browser$8,aesModes=modes_1,desModes=modes,ebtk=evp_bytestokey;function createCipher$1($t,e){$t=$t.toLowerCase();var _t,At;if(aesModes[$t])_t=aesModes[$t].key,At=aesModes[$t].iv;else if(desModes[$t])_t=desModes[$t].key*8,At=desModes[$t].iv;else throw new TypeError("invalid suite type");var xt=ebtk(e,!1,_t,At);return createCipheriv($t,xt.key,xt.iv)}function createDecipher($t,e){$t=$t.toLowerCase();var _t,At;if(aesModes[$t])_t=aesModes[$t].key,At=aesModes[$t].iv;else if(desModes[$t])_t=desModes[$t].key*8,At=desModes[$t].iv;else throw new TypeError("invalid suite type");var xt=ebtk(e,!1,_t,At);return createDecipheriv($t,xt.key,xt.iv)}function createCipheriv($t,e,_t){if($t=$t.toLowerCase(),aesModes[$t])return aes.createCipheriv($t,e,_t);if(desModes[$t])return new DES({key:e,iv:_t,mode:$t});throw new TypeError("invalid suite type")}function createDecipheriv($t,e,_t){if($t=$t.toLowerCase(),aesModes[$t])return aes.createDecipheriv($t,e,_t);if(desModes[$t])return new DES({key:e,iv:_t,mode:$t,decrypt:!0});throw new TypeError("invalid suite type")}function getCiphers(){return Object.keys(desModes).concat(aes.getCiphers())}browser$9.createCipher=browser$9.Cipher=createCipher$1;browser$9.createCipheriv=browser$9.Cipheriv=createCipheriv;browser$9.createDecipher=browser$9.Decipher=createDecipher;browser$9.createDecipheriv=browser$9.Decipheriv=createDecipheriv;browser$9.listCiphers=browser$9.getCiphers=getCiphers;var browser$7={},bn$1={exports:{}};bn$1.exports;(function($t){(function(e,_t){function At(kr,lr){if(!kr)throw new Error(lr||"Assertion failed")}function xt(kr,lr){kr.super_=lr;var ir=function(){};ir.prototype=lr.prototype,kr.prototype=new ir,kr.prototype.constructor=kr}function kt(kr,lr,ir){if(kt.isBN(kr))return kr;this.negative=0,this.words=null,this.length=0,this.red=null,kr!==null&&((lr==="le"||lr==="be")&&(ir=lr,lr=10),this._init(kr||0,lr||10,ir||"be"))}typeof e=="object"?e.exports=kt:_t.BN=kt,kt.BN=kt,kt.wordSize=26;var Bt;try{typeof window<"u"&&typeof window.Buffer<"u"?Bt=window.Buffer:Bt=buffer$2.Buffer}catch{}kt.isBN=function(lr){return lr instanceof kt?!0:lr!==null&&typeof lr=="object"&&lr.constructor.wordSize===kt.wordSize&&Array.isArray(lr.words)},kt.max=function(lr,ir){return lr.cmp(ir)>0?lr:ir},kt.min=function(lr,ir){return lr.cmp(ir)<0?lr:ir},kt.prototype._init=function(lr,ir,er){if(typeof lr=="number")return this._initNumber(lr,ir,er);if(typeof lr=="object")return this._initArray(lr,ir,er);ir==="hex"&&(ir=16),At(ir===(ir|0)&&ir>=2&&ir<=36),lr=lr.toString().replace(/\s+/g,"");var rr=0;lr[0]==="-"&&(rr++,this.negative=1),rr<lr.length&&(ir===16?this._parseHex(lr,rr,er):(this._parseBase(lr,ir,rr),er==="le"&&this._initArray(this.toArray(),ir,er)))},kt.prototype._initNumber=function(lr,ir,er){lr<0&&(this.negative=1,lr=-lr),lr<67108864?(this.words=[lr&67108863],this.length=1):lr<4503599627370496?(this.words=[lr&67108863,lr/67108864&67108863],this.length=2):(At(lr<9007199254740992),this.words=[lr&67108863,lr/67108864&67108863,1],this.length=3),er==="le"&&this._initArray(this.toArray(),ir,er)},kt.prototype._initArray=function(lr,ir,er){if(At(typeof lr.length=="number"),lr.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(lr.length/3),this.words=new Array(this.length);for(var rr=0;rr<this.length;rr++)this.words[rr]=0;var yr,fr,gr=0;if(er==="be")for(rr=lr.length-1,yr=0;rr>=0;rr-=3)fr=lr[rr]|lr[rr-1]<<8|lr[rr-2]<<16,this.words[yr]|=fr<<gr&67108863,this.words[yr+1]=fr>>>26-gr&67108863,gr+=24,gr>=26&&(gr-=26,yr++);else if(er==="le")for(rr=0,yr=0;rr<lr.length;rr+=3)fr=lr[rr]|lr[rr+1]<<8|lr[rr+2]<<16,this.words[yr]|=fr<<gr&67108863,this.words[yr+1]=fr>>>26-gr&67108863,gr+=24,gr>=26&&(gr-=26,yr++);return this.strip()};function Nt(kr,lr){var ir=kr.charCodeAt(lr);return ir>=65&&ir<=70?ir-55:ir>=97&&ir<=102?ir-87:ir-48&15}function Ut(kr,lr,ir){var er=Nt(kr,ir);return ir-1>=lr&&(er|=Nt(kr,ir-1)<<4),er}kt.prototype._parseHex=function(lr,ir,er){this.length=Math.ceil((lr.length-ir)/6),this.words=new Array(this.length);for(var rr=0;rr<this.length;rr++)this.words[rr]=0;var yr=0,fr=0,gr;if(er==="be")for(rr=lr.length-1;rr>=ir;rr-=2)gr=Ut(lr,ir,rr)<<yr,this.words[fr]|=gr&67108863,yr>=18?(yr-=18,fr+=1,this.words[fr]|=gr>>>26):yr+=8;else{var ar=lr.length-ir;for(rr=ar%2===0?ir+1:ir;rr<lr.length;rr+=2)gr=Ut(lr,ir,rr)<<yr,this.words[fr]|=gr&67108863,yr>=18?(yr-=18,fr+=1,this.words[fr]|=gr>>>26):yr+=8}this.strip()};function Lt(kr,lr,ir,er){for(var rr=0,yr=Math.min(kr.length,ir),fr=lr;fr<yr;fr++){var gr=kr.charCodeAt(fr)-48;rr*=er,gr>=49?rr+=gr-49+10:gr>=17?rr+=gr-17+10:rr+=gr}return rr}kt.prototype._parseBase=function(lr,ir,er){this.words=[0],this.length=1;for(var rr=0,yr=1;yr<=67108863;yr*=ir)rr++;rr--,yr=yr/ir|0;for(var fr=lr.length-er,gr=fr%rr,ar=Math.min(fr,fr-gr)+er,nr=0,ur=er;ur<ar;ur+=rr)nr=Lt(lr,ur,ur+rr,ir),this.imuln(yr),this.words[0]+nr<67108864?this.words[0]+=nr:this._iaddn(nr);if(gr!==0){var pr=1;for(nr=Lt(lr,ur,lr.length,ir),ur=0;ur<gr;ur++)pr*=ir;this.imuln(pr),this.words[0]+nr<67108864?this.words[0]+=nr:this._iaddn(nr)}this.strip()},kt.prototype.copy=function(lr){lr.words=new Array(this.length);for(var ir=0;ir<this.length;ir++)lr.words[ir]=this.words[ir];lr.length=this.length,lr.negative=this.negative,lr.red=this.red},kt.prototype.clone=function(){var lr=new kt(null);return this.copy(lr),lr},kt.prototype._expand=function(lr){for(;this.length<lr;)this.words[this.length++]=0;return this},kt.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},kt.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},kt.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var jt=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],Kt=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],qt=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];kt.prototype.toString=function(lr,ir){lr=lr||10,ir=ir|0||1;var er;if(lr===16||lr==="hex"){er="";for(var rr=0,yr=0,fr=0;fr<this.length;fr++){var gr=this.words[fr],ar=((gr<<rr|yr)&16777215).toString(16);yr=gr>>>24-rr&16777215,yr!==0||fr!==this.length-1?er=jt[6-ar.length]+ar+er:er=ar+er,rr+=2,rr>=26&&(rr-=26,fr--)}for(yr!==0&&(er=yr.toString(16)+er);er.length%ir!==0;)er="0"+er;return this.negative!==0&&(er="-"+er),er}if(lr===(lr|0)&&lr>=2&&lr<=36){var nr=Kt[lr],ur=qt[lr];er="";var pr=this.clone();for(pr.negative=0;!pr.isZero();){var br=pr.modn(ur).toString(lr);pr=pr.idivn(ur),pr.isZero()?er=br+er:er=jt[nr-br.length]+br+er}for(this.isZero()&&(er="0"+er);er.length%ir!==0;)er="0"+er;return this.negative!==0&&(er="-"+er),er}At(!1,"Base should be between 2 and 36")},kt.prototype.toNumber=function(){var lr=this.words[0];return this.length===2?lr+=this.words[1]*67108864:this.length===3&&this.words[2]===1?lr+=4503599627370496+this.words[1]*67108864:this.length>2&&At(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-lr:lr},kt.prototype.toJSON=function(){return this.toString(16)},kt.prototype.toBuffer=function(lr,ir){return At(typeof Bt<"u"),this.toArrayLike(Bt,lr,ir)},kt.prototype.toArray=function(lr,ir){return this.toArrayLike(Array,lr,ir)},kt.prototype.toArrayLike=function(lr,ir,er){var rr=this.byteLength(),yr=er||Math.max(1,rr);At(rr<=yr,"byte array longer than desired length"),At(yr>0,"Requested array length <= 0"),this.strip();var fr=ir==="le",gr=new lr(yr),ar,nr,ur=this.clone();if(fr){for(nr=0;!ur.isZero();nr++)ar=ur.andln(255),ur.iushrn(8),gr[nr]=ar;for(;nr<yr;nr++)gr[nr]=0}else{for(nr=0;nr<yr-rr;nr++)gr[nr]=0;for(nr=0;!ur.isZero();nr++)ar=ur.andln(255),ur.iushrn(8),gr[yr-nr-1]=ar}return gr},Math.clz32?kt.prototype._countBits=function(lr){return 32-Math.clz32(lr)}:kt.prototype._countBits=function(lr){var ir=lr,er=0;return ir>=4096&&(er+=13,ir>>>=13),ir>=64&&(er+=7,ir>>>=7),ir>=8&&(er+=4,ir>>>=4),ir>=2&&(er+=2,ir>>>=2),er+ir},kt.prototype._zeroBits=function(lr){if(lr===0)return 26;var ir=lr,er=0;return ir&8191||(er+=13,ir>>>=13),ir&127||(er+=7,ir>>>=7),ir&15||(er+=4,ir>>>=4),ir&3||(er+=2,ir>>>=2),ir&1||er++,er},kt.prototype.bitLength=function(){var lr=this.words[this.length-1],ir=this._countBits(lr);return(this.length-1)*26+ir};function zt(kr){for(var lr=new Array(kr.bitLength()),ir=0;ir<lr.length;ir++){var er=ir/26|0,rr=ir%26;lr[ir]=(kr.words[er]&1<<rr)>>>rr}return lr}kt.prototype.zeroBits=function(){if(this.isZero())return 0;for(var lr=0,ir=0;ir<this.length;ir++){var er=this._zeroBits(this.words[ir]);if(lr+=er,er!==26)break}return lr},kt.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},kt.prototype.toTwos=function(lr){return this.negative!==0?this.abs().inotn(lr).iaddn(1):this.clone()},kt.prototype.fromTwos=function(lr){return this.testn(lr-1)?this.notn(lr).iaddn(1).ineg():this.clone()},kt.prototype.isNeg=function(){return this.negative!==0},kt.prototype.neg=function(){return this.clone().ineg()},kt.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},kt.prototype.iuor=function(lr){for(;this.length<lr.length;)this.words[this.length++]=0;for(var ir=0;ir<lr.length;ir++)this.words[ir]=this.words[ir]|lr.words[ir];return this.strip()},kt.prototype.ior=function(lr){return At((this.negative|lr.negative)===0),this.iuor(lr)},kt.prototype.or=function(lr){return this.length>lr.length?this.clone().ior(lr):lr.clone().ior(this)},kt.prototype.uor=function(lr){return this.length>lr.length?this.clone().iuor(lr):lr.clone().iuor(this)},kt.prototype.iuand=function(lr){var ir;this.length>lr.length?ir=lr:ir=this;for(var er=0;er<ir.length;er++)this.words[er]=this.words[er]&lr.words[er];return this.length=ir.length,this.strip()},kt.prototype.iand=function(lr){return At((this.negative|lr.negative)===0),this.iuand(lr)},kt.prototype.and=function(lr){return this.length>lr.length?this.clone().iand(lr):lr.clone().iand(this)},kt.prototype.uand=function(lr){return this.length>lr.length?this.clone().iuand(lr):lr.clone().iuand(this)},kt.prototype.iuxor=function(lr){var ir,er;this.length>lr.length?(ir=this,er=lr):(ir=lr,er=this);for(var rr=0;rr<er.length;rr++)this.words[rr]=ir.words[rr]^er.words[rr];if(this!==ir)for(;rr<ir.length;rr++)this.words[rr]=ir.words[rr];return this.length=ir.length,this.strip()},kt.prototype.ixor=function(lr){return At((this.negative|lr.negative)===0),this.iuxor(lr)},kt.prototype.xor=function(lr){return this.length>lr.length?this.clone().ixor(lr):lr.clone().ixor(this)},kt.prototype.uxor=function(lr){return this.length>lr.length?this.clone().iuxor(lr):lr.clone().iuxor(this)},kt.prototype.inotn=function(lr){At(typeof lr=="number"&&lr>=0);var ir=Math.ceil(lr/26)|0,er=lr%26;this._expand(ir),er>0&&ir--;for(var rr=0;rr<ir;rr++)this.words[rr]=~this.words[rr]&67108863;return er>0&&(this.words[rr]=~this.words[rr]&67108863>>26-er),this.strip()},kt.prototype.notn=function(lr){return this.clone().inotn(lr)},kt.prototype.setn=function(lr,ir){At(typeof lr=="number"&&lr>=0);var er=lr/26|0,rr=lr%26;return this._expand(er+1),ir?this.words[er]=this.words[er]|1<<rr:this.words[er]=this.words[er]&~(1<<rr),this.strip()},kt.prototype.iadd=function(lr){var ir;if(this.negative!==0&&lr.negative===0)return this.negative=0,ir=this.isub(lr),this.negative^=1,this._normSign();if(this.negative===0&&lr.negative!==0)return lr.negative=0,ir=this.isub(lr),lr.negative=1,ir._normSign();var er,rr;this.length>lr.length?(er=this,rr=lr):(er=lr,rr=this);for(var yr=0,fr=0;fr<rr.length;fr++)ir=(er.words[fr]|0)+(rr.words[fr]|0)+yr,this.words[fr]=ir&67108863,yr=ir>>>26;for(;yr!==0&&fr<er.length;fr++)ir=(er.words[fr]|0)+yr,this.words[fr]=ir&67108863,yr=ir>>>26;if(this.length=er.length,yr!==0)this.words[this.length]=yr,this.length++;else if(er!==this)for(;fr<er.length;fr++)this.words[fr]=er.words[fr];return this},kt.prototype.add=function(lr){var ir;return lr.negative!==0&&this.negative===0?(lr.negative=0,ir=this.sub(lr),lr.negative^=1,ir):lr.negative===0&&this.negative!==0?(this.negative=0,ir=lr.sub(this),this.negative=1,ir):this.length>lr.length?this.clone().iadd(lr):lr.clone().iadd(this)},kt.prototype.isub=function(lr){if(lr.negative!==0){lr.negative=0;var ir=this.iadd(lr);return lr.negative=1,ir._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(lr),this.negative=1,this._normSign();var er=this.cmp(lr);if(er===0)return this.negative=0,this.length=1,this.words[0]=0,this;var rr,yr;er>0?(rr=this,yr=lr):(rr=lr,yr=this);for(var fr=0,gr=0;gr<yr.length;gr++)ir=(rr.words[gr]|0)-(yr.words[gr]|0)+fr,fr=ir>>26,this.words[gr]=ir&67108863;for(;fr!==0&&gr<rr.length;gr++)ir=(rr.words[gr]|0)+fr,fr=ir>>26,this.words[gr]=ir&67108863;if(fr===0&&gr<rr.length&&rr!==this)for(;gr<rr.length;gr++)this.words[gr]=rr.words[gr];return this.length=Math.max(this.length,gr),rr!==this&&(this.negative=1),this.strip()},kt.prototype.sub=function(lr){return this.clone().isub(lr)};function Vt(kr,lr,ir){ir.negative=lr.negative^kr.negative;var er=kr.length+lr.length|0;ir.length=er,er=er-1|0;var rr=kr.words[0]|0,yr=lr.words[0]|0,fr=rr*yr,gr=fr&67108863,ar=fr/67108864|0;ir.words[0]=gr;for(var nr=1;nr<er;nr++){for(var ur=ar>>>26,pr=ar&67108863,br=Math.min(nr,lr.length-1),Sr=Math.max(0,nr-kr.length+1);Sr<=br;Sr++){var Pr=nr-Sr|0;rr=kr.words[Pr]|0,yr=lr.words[Sr]|0,fr=rr*yr+pr,ur+=fr/67108864|0,pr=fr&67108863}ir.words[nr]=pr|0,ar=ur|0}return ar!==0?ir.words[nr]=ar|0:ir.length--,ir.strip()}var Ht=function(lr,ir,er){var rr=lr.words,yr=ir.words,fr=er.words,gr=0,ar,nr,ur,pr=rr[0]|0,br=pr&8191,Sr=pr>>>13,Pr=rr[1]|0,Tr=Pr&8191,wr=Pr>>>13,Ar=rr[2]|0,Mr=Ar&8191,Ur=Ar>>>13,Or=rr[3]|0,Cr=Or&8191,Er=Or>>>13,Br=rr[4]|0,Lr=Br&8191,xr=Br>>>13,_r=rr[5]|0,Dr=_r&8191,jr=_r>>>13,Hr=rr[6]|0,Qr=Hr&8191,Yr=Hr>>>13,an=rr[7]|0,cn=an&8191,Gr=an>>>13,Fr=rr[8]|0,en=Fr&8191,nn=Fr>>>13,rn=rr[9]|0,hn=rn&8191,yn=rn>>>13,wn=yr[0]|0,mn=wn&8191,Mn=wn>>>13,Bn=yr[1]|0,Sn=Bn&8191,kn=Bn>>>13,Un=yr[2]|0,Dn=Un&8191,Ln=Un>>>13,Kn=yr[3]|0,_n=Kn&8191,jn=Kn>>>13,Gn=yr[4]|0,xn=Gn&8191,Hn=Gn>>>13,qr=yr[5]|0,Wr=qr&8191,dn=qr>>>13,ln=yr[6]|0,un=ln&8191,On=ln>>>13,Nn=yr[7]|0,Jr=Nn&8191,Vr=Nn>>>13,Xr=yr[8]|0,tn=Xr&8191,on=Xr>>>13,pn=yr[9]|0,fn=pn&8191,vn=pn>>>13;er.negative=lr.negative^ir.negative,er.length=19,ar=Math.imul(br,mn),nr=Math.imul(br,Mn),nr=nr+Math.imul(Sr,mn)|0,ur=Math.imul(Sr,Mn);var En=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(En>>>26)|0,En&=67108863,ar=Math.imul(Tr,mn),nr=Math.imul(Tr,Mn),nr=nr+Math.imul(wr,mn)|0,ur=Math.imul(wr,Mn),ar=ar+Math.imul(br,Sn)|0,nr=nr+Math.imul(br,kn)|0,nr=nr+Math.imul(Sr,Sn)|0,ur=ur+Math.imul(Sr,kn)|0;var Tn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(Tn>>>26)|0,Tn&=67108863,ar=Math.imul(Mr,mn),nr=Math.imul(Mr,Mn),nr=nr+Math.imul(Ur,mn)|0,ur=Math.imul(Ur,Mn),ar=ar+Math.imul(Tr,Sn)|0,nr=nr+Math.imul(Tr,kn)|0,nr=nr+Math.imul(wr,Sn)|0,ur=ur+Math.imul(wr,kn)|0,ar=ar+Math.imul(br,Dn)|0,nr=nr+Math.imul(br,Ln)|0,nr=nr+Math.imul(Sr,Dn)|0,ur=ur+Math.imul(Sr,Ln)|0;var In=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(In>>>26)|0,In&=67108863,ar=Math.imul(Cr,mn),nr=Math.imul(Cr,Mn),nr=nr+Math.imul(Er,mn)|0,ur=Math.imul(Er,Mn),ar=ar+Math.imul(Mr,Sn)|0,nr=nr+Math.imul(Mr,kn)|0,nr=nr+Math.imul(Ur,Sn)|0,ur=ur+Math.imul(Ur,kn)|0,ar=ar+Math.imul(Tr,Dn)|0,nr=nr+Math.imul(Tr,Ln)|0,nr=nr+Math.imul(wr,Dn)|0,ur=ur+Math.imul(wr,Ln)|0,ar=ar+Math.imul(br,_n)|0,nr=nr+Math.imul(br,jn)|0,nr=nr+Math.imul(Sr,_n)|0,ur=ur+Math.imul(Sr,jn)|0;var Rn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,ar=Math.imul(Lr,mn),nr=Math.imul(Lr,Mn),nr=nr+Math.imul(xr,mn)|0,ur=Math.imul(xr,Mn),ar=ar+Math.imul(Cr,Sn)|0,nr=nr+Math.imul(Cr,kn)|0,nr=nr+Math.imul(Er,Sn)|0,ur=ur+Math.imul(Er,kn)|0,ar=ar+Math.imul(Mr,Dn)|0,nr=nr+Math.imul(Mr,Ln)|0,nr=nr+Math.imul(Ur,Dn)|0,ur=ur+Math.imul(Ur,Ln)|0,ar=ar+Math.imul(Tr,_n)|0,nr=nr+Math.imul(Tr,jn)|0,nr=nr+Math.imul(wr,_n)|0,ur=ur+Math.imul(wr,jn)|0,ar=ar+Math.imul(br,xn)|0,nr=nr+Math.imul(br,Hn)|0,nr=nr+Math.imul(Sr,xn)|0,ur=ur+Math.imul(Sr,Hn)|0;var Vn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(Vn>>>26)|0,Vn&=67108863,ar=Math.imul(Dr,mn),nr=Math.imul(Dr,Mn),nr=nr+Math.imul(jr,mn)|0,ur=Math.imul(jr,Mn),ar=ar+Math.imul(Lr,Sn)|0,nr=nr+Math.imul(Lr,kn)|0,nr=nr+Math.imul(xr,Sn)|0,ur=ur+Math.imul(xr,kn)|0,ar=ar+Math.imul(Cr,Dn)|0,nr=nr+Math.imul(Cr,Ln)|0,nr=nr+Math.imul(Er,Dn)|0,ur=ur+Math.imul(Er,Ln)|0,ar=ar+Math.imul(Mr,_n)|0,nr=nr+Math.imul(Mr,jn)|0,nr=nr+Math.imul(Ur,_n)|0,ur=ur+Math.imul(Ur,jn)|0,ar=ar+Math.imul(Tr,xn)|0,nr=nr+Math.imul(Tr,Hn)|0,nr=nr+Math.imul(wr,xn)|0,ur=ur+Math.imul(wr,Hn)|0,ar=ar+Math.imul(br,Wr)|0,nr=nr+Math.imul(br,dn)|0,nr=nr+Math.imul(Sr,Wr)|0,ur=ur+Math.imul(Sr,dn)|0;var An=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(An>>>26)|0,An&=67108863,ar=Math.imul(Qr,mn),nr=Math.imul(Qr,Mn),nr=nr+Math.imul(Yr,mn)|0,ur=Math.imul(Yr,Mn),ar=ar+Math.imul(Dr,Sn)|0,nr=nr+Math.imul(Dr,kn)|0,nr=nr+Math.imul(jr,Sn)|0,ur=ur+Math.imul(jr,kn)|0,ar=ar+Math.imul(Lr,Dn)|0,nr=nr+Math.imul(Lr,Ln)|0,nr=nr+Math.imul(xr,Dn)|0,ur=ur+Math.imul(xr,Ln)|0,ar=ar+Math.imul(Cr,_n)|0,nr=nr+Math.imul(Cr,jn)|0,nr=nr+Math.imul(Er,_n)|0,ur=ur+Math.imul(Er,jn)|0,ar=ar+Math.imul(Mr,xn)|0,nr=nr+Math.imul(Mr,Hn)|0,nr=nr+Math.imul(Ur,xn)|0,ur=ur+Math.imul(Ur,Hn)|0,ar=ar+Math.imul(Tr,Wr)|0,nr=nr+Math.imul(Tr,dn)|0,nr=nr+Math.imul(wr,Wr)|0,ur=ur+Math.imul(wr,dn)|0,ar=ar+Math.imul(br,un)|0,nr=nr+Math.imul(br,On)|0,nr=nr+Math.imul(Sr,un)|0,ur=ur+Math.imul(Sr,On)|0;var Fn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,ar=Math.imul(cn,mn),nr=Math.imul(cn,Mn),nr=nr+Math.imul(Gr,mn)|0,ur=Math.imul(Gr,Mn),ar=ar+Math.imul(Qr,Sn)|0,nr=nr+Math.imul(Qr,kn)|0,nr=nr+Math.imul(Yr,Sn)|0,ur=ur+Math.imul(Yr,kn)|0,ar=ar+Math.imul(Dr,Dn)|0,nr=nr+Math.imul(Dr,Ln)|0,nr=nr+Math.imul(jr,Dn)|0,ur=ur+Math.imul(jr,Ln)|0,ar=ar+Math.imul(Lr,_n)|0,nr=nr+Math.imul(Lr,jn)|0,nr=nr+Math.imul(xr,_n)|0,ur=ur+Math.imul(xr,jn)|0,ar=ar+Math.imul(Cr,xn)|0,nr=nr+Math.imul(Cr,Hn)|0,nr=nr+Math.imul(Er,xn)|0,ur=ur+Math.imul(Er,Hn)|0,ar=ar+Math.imul(Mr,Wr)|0,nr=nr+Math.imul(Mr,dn)|0,nr=nr+Math.imul(Ur,Wr)|0,ur=ur+Math.imul(Ur,dn)|0,ar=ar+Math.imul(Tr,un)|0,nr=nr+Math.imul(Tr,On)|0,nr=nr+Math.imul(wr,un)|0,ur=ur+Math.imul(wr,On)|0,ar=ar+Math.imul(br,Jr)|0,nr=nr+Math.imul(br,Vr)|0,nr=nr+Math.imul(Sr,Jr)|0,ur=ur+Math.imul(Sr,Vr)|0;var Wn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(Wn>>>26)|0,Wn&=67108863,ar=Math.imul(en,mn),nr=Math.imul(en,Mn),nr=nr+Math.imul(nn,mn)|0,ur=Math.imul(nn,Mn),ar=ar+Math.imul(cn,Sn)|0,nr=nr+Math.imul(cn,kn)|0,nr=nr+Math.imul(Gr,Sn)|0,ur=ur+Math.imul(Gr,kn)|0,ar=ar+Math.imul(Qr,Dn)|0,nr=nr+Math.imul(Qr,Ln)|0,nr=nr+Math.imul(Yr,Dn)|0,ur=ur+Math.imul(Yr,Ln)|0,ar=ar+Math.imul(Dr,_n)|0,nr=nr+Math.imul(Dr,jn)|0,nr=nr+Math.imul(jr,_n)|0,ur=ur+Math.imul(jr,jn)|0,ar=ar+Math.imul(Lr,xn)|0,nr=nr+Math.imul(Lr,Hn)|0,nr=nr+Math.imul(xr,xn)|0,ur=ur+Math.imul(xr,Hn)|0,ar=ar+Math.imul(Cr,Wr)|0,nr=nr+Math.imul(Cr,dn)|0,nr=nr+Math.imul(Er,Wr)|0,ur=ur+Math.imul(Er,dn)|0,ar=ar+Math.imul(Mr,un)|0,nr=nr+Math.imul(Mr,On)|0,nr=nr+Math.imul(Ur,un)|0,ur=ur+Math.imul(Ur,On)|0,ar=ar+Math.imul(Tr,Jr)|0,nr=nr+Math.imul(Tr,Vr)|0,nr=nr+Math.imul(wr,Jr)|0,ur=ur+Math.imul(wr,Vr)|0,ar=ar+Math.imul(br,tn)|0,nr=nr+Math.imul(br,on)|0,nr=nr+Math.imul(Sr,tn)|0,ur=ur+Math.imul(Sr,on)|0;var qn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(qn>>>26)|0,qn&=67108863,ar=Math.imul(hn,mn),nr=Math.imul(hn,Mn),nr=nr+Math.imul(yn,mn)|0,ur=Math.imul(yn,Mn),ar=ar+Math.imul(en,Sn)|0,nr=nr+Math.imul(en,kn)|0,nr=nr+Math.imul(nn,Sn)|0,ur=ur+Math.imul(nn,kn)|0,ar=ar+Math.imul(cn,Dn)|0,nr=nr+Math.imul(cn,Ln)|0,nr=nr+Math.imul(Gr,Dn)|0,ur=ur+Math.imul(Gr,Ln)|0,ar=ar+Math.imul(Qr,_n)|0,nr=nr+Math.imul(Qr,jn)|0,nr=nr+Math.imul(Yr,_n)|0,ur=ur+Math.imul(Yr,jn)|0,ar=ar+Math.imul(Dr,xn)|0,nr=nr+Math.imul(Dr,Hn)|0,nr=nr+Math.imul(jr,xn)|0,ur=ur+Math.imul(jr,Hn)|0,ar=ar+Math.imul(Lr,Wr)|0,nr=nr+Math.imul(Lr,dn)|0,nr=nr+Math.imul(xr,Wr)|0,ur=ur+Math.imul(xr,dn)|0,ar=ar+Math.imul(Cr,un)|0,nr=nr+Math.imul(Cr,On)|0,nr=nr+Math.imul(Er,un)|0,ur=ur+Math.imul(Er,On)|0,ar=ar+Math.imul(Mr,Jr)|0,nr=nr+Math.imul(Mr,Vr)|0,nr=nr+Math.imul(Ur,Jr)|0,ur=ur+Math.imul(Ur,Vr)|0,ar=ar+Math.imul(Tr,tn)|0,nr=nr+Math.imul(Tr,on)|0,nr=nr+Math.imul(wr,tn)|0,ur=ur+Math.imul(wr,on)|0,ar=ar+Math.imul(br,fn)|0,nr=nr+Math.imul(br,vn)|0,nr=nr+Math.imul(Sr,fn)|0,ur=ur+Math.imul(Sr,vn)|0;var si=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(si>>>26)|0,si&=67108863,ar=Math.imul(hn,Sn),nr=Math.imul(hn,kn),nr=nr+Math.imul(yn,Sn)|0,ur=Math.imul(yn,kn),ar=ar+Math.imul(en,Dn)|0,nr=nr+Math.imul(en,Ln)|0,nr=nr+Math.imul(nn,Dn)|0,ur=ur+Math.imul(nn,Ln)|0,ar=ar+Math.imul(cn,_n)|0,nr=nr+Math.imul(cn,jn)|0,nr=nr+Math.imul(Gr,_n)|0,ur=ur+Math.imul(Gr,jn)|0,ar=ar+Math.imul(Qr,xn)|0,nr=nr+Math.imul(Qr,Hn)|0,nr=nr+Math.imul(Yr,xn)|0,ur=ur+Math.imul(Yr,Hn)|0,ar=ar+Math.imul(Dr,Wr)|0,nr=nr+Math.imul(Dr,dn)|0,nr=nr+Math.imul(jr,Wr)|0,ur=ur+Math.imul(jr,dn)|0,ar=ar+Math.imul(Lr,un)|0,nr=nr+Math.imul(Lr,On)|0,nr=nr+Math.imul(xr,un)|0,ur=ur+Math.imul(xr,On)|0,ar=ar+Math.imul(Cr,Jr)|0,nr=nr+Math.imul(Cr,Vr)|0,nr=nr+Math.imul(Er,Jr)|0,ur=ur+Math.imul(Er,Vr)|0,ar=ar+Math.imul(Mr,tn)|0,nr=nr+Math.imul(Mr,on)|0,nr=nr+Math.imul(Ur,tn)|0,ur=ur+Math.imul(Ur,on)|0,ar=ar+Math.imul(Tr,fn)|0,nr=nr+Math.imul(Tr,vn)|0,nr=nr+Math.imul(wr,fn)|0,ur=ur+Math.imul(wr,vn)|0;var ei=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(ei>>>26)|0,ei&=67108863,ar=Math.imul(hn,Dn),nr=Math.imul(hn,Ln),nr=nr+Math.imul(yn,Dn)|0,ur=Math.imul(yn,Ln),ar=ar+Math.imul(en,_n)|0,nr=nr+Math.imul(en,jn)|0,nr=nr+Math.imul(nn,_n)|0,ur=ur+Math.imul(nn,jn)|0,ar=ar+Math.imul(cn,xn)|0,nr=nr+Math.imul(cn,Hn)|0,nr=nr+Math.imul(Gr,xn)|0,ur=ur+Math.imul(Gr,Hn)|0,ar=ar+Math.imul(Qr,Wr)|0,nr=nr+Math.imul(Qr,dn)|0,nr=nr+Math.imul(Yr,Wr)|0,ur=ur+Math.imul(Yr,dn)|0,ar=ar+Math.imul(Dr,un)|0,nr=nr+Math.imul(Dr,On)|0,nr=nr+Math.imul(jr,un)|0,ur=ur+Math.imul(jr,On)|0,ar=ar+Math.imul(Lr,Jr)|0,nr=nr+Math.imul(Lr,Vr)|0,nr=nr+Math.imul(xr,Jr)|0,ur=ur+Math.imul(xr,Vr)|0,ar=ar+Math.imul(Cr,tn)|0,nr=nr+Math.imul(Cr,on)|0,nr=nr+Math.imul(Er,tn)|0,ur=ur+Math.imul(Er,on)|0,ar=ar+Math.imul(Mr,fn)|0,nr=nr+Math.imul(Mr,vn)|0,nr=nr+Math.imul(Ur,fn)|0,ur=ur+Math.imul(Ur,vn)|0;var ti=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(ti>>>26)|0,ti&=67108863,ar=Math.imul(hn,_n),nr=Math.imul(hn,jn),nr=nr+Math.imul(yn,_n)|0,ur=Math.imul(yn,jn),ar=ar+Math.imul(en,xn)|0,nr=nr+Math.imul(en,Hn)|0,nr=nr+Math.imul(nn,xn)|0,ur=ur+Math.imul(nn,Hn)|0,ar=ar+Math.imul(cn,Wr)|0,nr=nr+Math.imul(cn,dn)|0,nr=nr+Math.imul(Gr,Wr)|0,ur=ur+Math.imul(Gr,dn)|0,ar=ar+Math.imul(Qr,un)|0,nr=nr+Math.imul(Qr,On)|0,nr=nr+Math.imul(Yr,un)|0,ur=ur+Math.imul(Yr,On)|0,ar=ar+Math.imul(Dr,Jr)|0,nr=nr+Math.imul(Dr,Vr)|0,nr=nr+Math.imul(jr,Jr)|0,ur=ur+Math.imul(jr,Vr)|0,ar=ar+Math.imul(Lr,tn)|0,nr=nr+Math.imul(Lr,on)|0,nr=nr+Math.imul(xr,tn)|0,ur=ur+Math.imul(xr,on)|0,ar=ar+Math.imul(Cr,fn)|0,nr=nr+Math.imul(Cr,vn)|0,nr=nr+Math.imul(Er,fn)|0,ur=ur+Math.imul(Er,vn)|0;var hi=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(hi>>>26)|0,hi&=67108863,ar=Math.imul(hn,xn),nr=Math.imul(hn,Hn),nr=nr+Math.imul(yn,xn)|0,ur=Math.imul(yn,Hn),ar=ar+Math.imul(en,Wr)|0,nr=nr+Math.imul(en,dn)|0,nr=nr+Math.imul(nn,Wr)|0,ur=ur+Math.imul(nn,dn)|0,ar=ar+Math.imul(cn,un)|0,nr=nr+Math.imul(cn,On)|0,nr=nr+Math.imul(Gr,un)|0,ur=ur+Math.imul(Gr,On)|0,ar=ar+Math.imul(Qr,Jr)|0,nr=nr+Math.imul(Qr,Vr)|0,nr=nr+Math.imul(Yr,Jr)|0,ur=ur+Math.imul(Yr,Vr)|0,ar=ar+Math.imul(Dr,tn)|0,nr=nr+Math.imul(Dr,on)|0,nr=nr+Math.imul(jr,tn)|0,ur=ur+Math.imul(jr,on)|0,ar=ar+Math.imul(Lr,fn)|0,nr=nr+Math.imul(Lr,vn)|0,nr=nr+Math.imul(xr,fn)|0,ur=ur+Math.imul(xr,vn)|0;var li=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(li>>>26)|0,li&=67108863,ar=Math.imul(hn,Wr),nr=Math.imul(hn,dn),nr=nr+Math.imul(yn,Wr)|0,ur=Math.imul(yn,dn),ar=ar+Math.imul(en,un)|0,nr=nr+Math.imul(en,On)|0,nr=nr+Math.imul(nn,un)|0,ur=ur+Math.imul(nn,On)|0,ar=ar+Math.imul(cn,Jr)|0,nr=nr+Math.imul(cn,Vr)|0,nr=nr+Math.imul(Gr,Jr)|0,ur=ur+Math.imul(Gr,Vr)|0,ar=ar+Math.imul(Qr,tn)|0,nr=nr+Math.imul(Qr,on)|0,nr=nr+Math.imul(Yr,tn)|0,ur=ur+Math.imul(Yr,on)|0,ar=ar+Math.imul(Dr,fn)|0,nr=nr+Math.imul(Dr,vn)|0,nr=nr+Math.imul(jr,fn)|0,ur=ur+Math.imul(jr,vn)|0;var Zn=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(Zn>>>26)|0,Zn&=67108863,ar=Math.imul(hn,un),nr=Math.imul(hn,On),nr=nr+Math.imul(yn,un)|0,ur=Math.imul(yn,On),ar=ar+Math.imul(en,Jr)|0,nr=nr+Math.imul(en,Vr)|0,nr=nr+Math.imul(nn,Jr)|0,ur=ur+Math.imul(nn,Vr)|0,ar=ar+Math.imul(cn,tn)|0,nr=nr+Math.imul(cn,on)|0,nr=nr+Math.imul(Gr,tn)|0,ur=ur+Math.imul(Gr,on)|0,ar=ar+Math.imul(Qr,fn)|0,nr=nr+Math.imul(Qr,vn)|0,nr=nr+Math.imul(Yr,fn)|0,ur=ur+Math.imul(Yr,vn)|0;var ri=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(ri>>>26)|0,ri&=67108863,ar=Math.imul(hn,Jr),nr=Math.imul(hn,Vr),nr=nr+Math.imul(yn,Jr)|0,ur=Math.imul(yn,Vr),ar=ar+Math.imul(en,tn)|0,nr=nr+Math.imul(en,on)|0,nr=nr+Math.imul(nn,tn)|0,ur=ur+Math.imul(nn,on)|0,ar=ar+Math.imul(cn,fn)|0,nr=nr+Math.imul(cn,vn)|0,nr=nr+Math.imul(Gr,fn)|0,ur=ur+Math.imul(Gr,vn)|0;var ui=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(ui>>>26)|0,ui&=67108863,ar=Math.imul(hn,tn),nr=Math.imul(hn,on),nr=nr+Math.imul(yn,tn)|0,ur=Math.imul(yn,on),ar=ar+Math.imul(en,fn)|0,nr=nr+Math.imul(en,vn)|0,nr=nr+Math.imul(nn,fn)|0,ur=ur+Math.imul(nn,vn)|0;var ii=(gr+ar|0)+((nr&8191)<<13)|0;gr=(ur+(nr>>>13)|0)+(ii>>>26)|0,ii&=67108863,ar=Math.imul(hn,fn),nr=Math.imul(hn,vn),nr=nr+Math.imul(yn,fn)|0,ur=Math.imul(yn,vn);var mi=(gr+ar|0)+((nr&8191)<<13)|0;return gr=(ur+(nr>>>13)|0)+(mi>>>26)|0,mi&=67108863,fr[0]=En,fr[1]=Tn,fr[2]=In,fr[3]=Rn,fr[4]=Vn,fr[5]=An,fr[6]=Fn,fr[7]=Wn,fr[8]=qn,fr[9]=si,fr[10]=ei,fr[11]=ti,fr[12]=hi,fr[13]=li,fr[14]=Zn,fr[15]=ri,fr[16]=ui,fr[17]=ii,fr[18]=mi,gr!==0&&(fr[19]=gr,er.length++),er};Math.imul||(Ht=Vt);function Wt(kr,lr,ir){ir.negative=lr.negative^kr.negative,ir.length=kr.length+lr.length;for(var er=0,rr=0,yr=0;yr<ir.length-1;yr++){var fr=rr;rr=0;for(var gr=er&67108863,ar=Math.min(yr,lr.length-1),nr=Math.max(0,yr-kr.length+1);nr<=ar;nr++){var ur=yr-nr,pr=kr.words[ur]|0,br=lr.words[nr]|0,Sr=pr*br,Pr=Sr&67108863;fr=fr+(Sr/67108864|0)|0,Pr=Pr+gr|0,gr=Pr&67108863,fr=fr+(Pr>>>26)|0,rr+=fr>>>26,fr&=67108863}ir.words[yr]=gr,er=fr,fr=rr}return er!==0?ir.words[yr]=er:ir.length--,ir.strip()}function Qt(kr,lr,ir){var er=new Xt;return er.mulp(kr,lr,ir)}kt.prototype.mulTo=function(lr,ir){var er,rr=this.length+lr.length;return this.length===10&&lr.length===10?er=Ht(this,lr,ir):rr<63?er=Vt(this,lr,ir):rr<1024?er=Wt(this,lr,ir):er=Qt(this,lr,ir),er};function Xt(kr,lr){this.x=kr,this.y=lr}Xt.prototype.makeRBT=function(lr){for(var ir=new Array(lr),er=kt.prototype._countBits(lr)-1,rr=0;rr<lr;rr++)ir[rr]=this.revBin(rr,er,lr);return ir},Xt.prototype.revBin=function(lr,ir,er){if(lr===0||lr===er-1)return lr;for(var rr=0,yr=0;yr<ir;yr++)rr|=(lr&1)<<ir-yr-1,lr>>=1;return rr},Xt.prototype.permute=function(lr,ir,er,rr,yr,fr){for(var gr=0;gr<fr;gr++)rr[gr]=ir[lr[gr]],yr[gr]=er[lr[gr]]},Xt.prototype.transform=function(lr,ir,er,rr,yr,fr){this.permute(fr,lr,ir,er,rr,yr);for(var gr=1;gr<yr;gr<<=1)for(var ar=gr<<1,nr=Math.cos(2*Math.PI/ar),ur=Math.sin(2*Math.PI/ar),pr=0;pr<yr;pr+=ar)for(var br=nr,Sr=ur,Pr=0;Pr<gr;Pr++){var Tr=er[pr+Pr],wr=rr[pr+Pr],Ar=er[pr+Pr+gr],Mr=rr[pr+Pr+gr],Ur=br*Ar-Sr*Mr;Mr=br*Mr+Sr*Ar,Ar=Ur,er[pr+Pr]=Tr+Ar,rr[pr+Pr]=wr+Mr,er[pr+Pr+gr]=Tr-Ar,rr[pr+Pr+gr]=wr-Mr,Pr!==ar&&(Ur=nr*br-ur*Sr,Sr=nr*Sr+ur*br,br=Ur)}},Xt.prototype.guessLen13b=function(lr,ir){var er=Math.max(ir,lr)|1,rr=er&1,yr=0;for(er=er/2|0;er;er=er>>>1)yr++;return 1<<yr+1+rr},Xt.prototype.conjugate=function(lr,ir,er){if(!(er<=1))for(var rr=0;rr<er/2;rr++){var yr=lr[rr];lr[rr]=lr[er-rr-1],lr[er-rr-1]=yr,yr=ir[rr],ir[rr]=-ir[er-rr-1],ir[er-rr-1]=-yr}},Xt.prototype.normalize13b=function(lr,ir){for(var er=0,rr=0;rr<ir/2;rr++){var yr=Math.round(lr[2*rr+1]/ir)*8192+Math.round(lr[2*rr]/ir)+er;lr[rr]=yr&67108863,yr<67108864?er=0:er=yr/67108864|0}return lr},Xt.prototype.convert13b=function(lr,ir,er,rr){for(var yr=0,fr=0;fr<ir;fr++)yr=yr+(lr[fr]|0),er[2*fr]=yr&8191,yr=yr>>>13,er[2*fr+1]=yr&8191,yr=yr>>>13;for(fr=2*ir;fr<rr;++fr)er[fr]=0;At(yr===0),At((yr&-8192)===0)},Xt.prototype.stub=function(lr){for(var ir=new Array(lr),er=0;er<lr;er++)ir[er]=0;return ir},Xt.prototype.mulp=function(lr,ir,er){var rr=2*this.guessLen13b(lr.length,ir.length),yr=this.makeRBT(rr),fr=this.stub(rr),gr=new Array(rr),ar=new Array(rr),nr=new Array(rr),ur=new Array(rr),pr=new Array(rr),br=new Array(rr),Sr=er.words;Sr.length=rr,this.convert13b(lr.words,lr.length,gr,rr),this.convert13b(ir.words,ir.length,ur,rr),this.transform(gr,fr,ar,nr,rr,yr),this.transform(ur,fr,pr,br,rr,yr);for(var Pr=0;Pr<rr;Pr++){var Tr=ar[Pr]*pr[Pr]-nr[Pr]*br[Pr];nr[Pr]=ar[Pr]*br[Pr]+nr[Pr]*pr[Pr],ar[Pr]=Tr}return this.conjugate(ar,nr,rr),this.transform(ar,nr,Sr,fr,rr,yr),this.conjugate(Sr,fr,rr),this.normalize13b(Sr,rr),er.negative=lr.negative^ir.negative,er.length=lr.length+ir.length,er.strip()},kt.prototype.mul=function(lr){var ir=new kt(null);return ir.words=new Array(this.length+lr.length),this.mulTo(lr,ir)},kt.prototype.mulf=function(lr){var ir=new kt(null);return ir.words=new Array(this.length+lr.length),Qt(this,lr,ir)},kt.prototype.imul=function(lr){return this.clone().mulTo(lr,this)},kt.prototype.imuln=function(lr){At(typeof lr=="number"),At(lr<67108864);for(var ir=0,er=0;er<this.length;er++){var rr=(this.words[er]|0)*lr,yr=(rr&67108863)+(ir&67108863);ir>>=26,ir+=rr/67108864|0,ir+=yr>>>26,this.words[er]=yr&67108863}return ir!==0&&(this.words[er]=ir,this.length++),this},kt.prototype.muln=function(lr){return this.clone().imuln(lr)},kt.prototype.sqr=function(){return this.mul(this)},kt.prototype.isqr=function(){return this.imul(this.clone())},kt.prototype.pow=function(lr){var ir=zt(lr);if(ir.length===0)return new kt(1);for(var er=this,rr=0;rr<ir.length&&ir[rr]===0;rr++,er=er.sqr());if(++rr<ir.length)for(var yr=er.sqr();rr<ir.length;rr++,yr=yr.sqr())ir[rr]!==0&&(er=er.mul(yr));return er},kt.prototype.iushln=function(lr){At(typeof lr=="number"&&lr>=0);var ir=lr%26,er=(lr-ir)/26,rr=67108863>>>26-ir<<26-ir,yr;if(ir!==0){var fr=0;for(yr=0;yr<this.length;yr++){var gr=this.words[yr]&rr,ar=(this.words[yr]|0)-gr<<ir;this.words[yr]=ar|fr,fr=gr>>>26-ir}fr&&(this.words[yr]=fr,this.length++)}if(er!==0){for(yr=this.length-1;yr>=0;yr--)this.words[yr+er]=this.words[yr];for(yr=0;yr<er;yr++)this.words[yr]=0;this.length+=er}return this.strip()},kt.prototype.ishln=function(lr){return At(this.negative===0),this.iushln(lr)},kt.prototype.iushrn=function(lr,ir,er){At(typeof lr=="number"&&lr>=0);var rr;ir?rr=(ir-ir%26)/26:rr=0;var yr=lr%26,fr=Math.min((lr-yr)/26,this.length),gr=67108863^67108863>>>yr<<yr,ar=er;if(rr-=fr,rr=Math.max(0,rr),ar){for(var nr=0;nr<fr;nr++)ar.words[nr]=this.words[nr];ar.length=fr}if(fr!==0)if(this.length>fr)for(this.length-=fr,nr=0;nr<this.length;nr++)this.words[nr]=this.words[nr+fr];else this.words[0]=0,this.length=1;var ur=0;for(nr=this.length-1;nr>=0&&(ur!==0||nr>=rr);nr--){var pr=this.words[nr]|0;this.words[nr]=ur<<26-yr|pr>>>yr,ur=pr&gr}return ar&&ur!==0&&(ar.words[ar.length++]=ur),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},kt.prototype.ishrn=function(lr,ir,er){return At(this.negative===0),this.iushrn(lr,ir,er)},kt.prototype.shln=function(lr){return this.clone().ishln(lr)},kt.prototype.ushln=function(lr){return this.clone().iushln(lr)},kt.prototype.shrn=function(lr){return this.clone().ishrn(lr)},kt.prototype.ushrn=function(lr){return this.clone().iushrn(lr)},kt.prototype.testn=function(lr){At(typeof lr=="number"&&lr>=0);var ir=lr%26,er=(lr-ir)/26,rr=1<<ir;if(this.length<=er)return!1;var yr=this.words[er];return!!(yr&rr)},kt.prototype.imaskn=function(lr){At(typeof lr=="number"&&lr>=0);var ir=lr%26,er=(lr-ir)/26;if(At(this.negative===0,"imaskn works only with positive numbers"),this.length<=er)return this;if(ir!==0&&er++,this.length=Math.min(er,this.length),ir!==0){var rr=67108863^67108863>>>ir<<ir;this.words[this.length-1]&=rr}return this.strip()},kt.prototype.maskn=function(lr){return this.clone().imaskn(lr)},kt.prototype.iaddn=function(lr){return At(typeof lr=="number"),At(lr<67108864),lr<0?this.isubn(-lr):this.negative!==0?this.length===1&&(this.words[0]|0)<lr?(this.words[0]=lr-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(lr),this.negative=1,this):this._iaddn(lr)},kt.prototype._iaddn=function(lr){this.words[0]+=lr;for(var ir=0;ir<this.length&&this.words[ir]>=67108864;ir++)this.words[ir]-=67108864,ir===this.length-1?this.words[ir+1]=1:this.words[ir+1]++;return this.length=Math.max(this.length,ir+1),this},kt.prototype.isubn=function(lr){if(At(typeof lr=="number"),At(lr<67108864),lr<0)return this.iaddn(-lr);if(this.negative!==0)return this.negative=0,this.iaddn(lr),this.negative=1,this;if(this.words[0]-=lr,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var ir=0;ir<this.length&&this.words[ir]<0;ir++)this.words[ir]+=67108864,this.words[ir+1]-=1;return this.strip()},kt.prototype.addn=function(lr){return this.clone().iaddn(lr)},kt.prototype.subn=function(lr){return this.clone().isubn(lr)},kt.prototype.iabs=function(){return this.negative=0,this},kt.prototype.abs=function(){return this.clone().iabs()},kt.prototype._ishlnsubmul=function(lr,ir,er){var rr=lr.length+er,yr;this._expand(rr);var fr,gr=0;for(yr=0;yr<lr.length;yr++){fr=(this.words[yr+er]|0)+gr;var ar=(lr.words[yr]|0)*ir;fr-=ar&67108863,gr=(fr>>26)-(ar/67108864|0),this.words[yr+er]=fr&67108863}for(;yr<this.length-er;yr++)fr=(this.words[yr+er]|0)+gr,gr=fr>>26,this.words[yr+er]=fr&67108863;if(gr===0)return this.strip();for(At(gr===-1),gr=0,yr=0;yr<this.length;yr++)fr=-(this.words[yr]|0)+gr,gr=fr>>26,this.words[yr]=fr&67108863;return this.negative=1,this.strip()},kt.prototype._wordDiv=function(lr,ir){var er=this.length-lr.length,rr=this.clone(),yr=lr,fr=yr.words[yr.length-1]|0,gr=this._countBits(fr);er=26-gr,er!==0&&(yr=yr.ushln(er),rr.iushln(er),fr=yr.words[yr.length-1]|0);var ar=rr.length-yr.length,nr;if(ir!=="mod"){nr=new kt(null),nr.length=ar+1,nr.words=new Array(nr.length);for(var ur=0;ur<nr.length;ur++)nr.words[ur]=0}var pr=rr.clone()._ishlnsubmul(yr,1,ar);pr.negative===0&&(rr=pr,nr&&(nr.words[ar]=1));for(var br=ar-1;br>=0;br--){var Sr=(rr.words[yr.length+br]|0)*67108864+(rr.words[yr.length+br-1]|0);for(Sr=Math.min(Sr/fr|0,67108863),rr._ishlnsubmul(yr,Sr,br);rr.negative!==0;)Sr--,rr.negative=0,rr._ishlnsubmul(yr,1,br),rr.isZero()||(rr.negative^=1);nr&&(nr.words[br]=Sr)}return nr&&nr.strip(),rr.strip(),ir!=="div"&&er!==0&&rr.iushrn(er),{div:nr||null,mod:rr}},kt.prototype.divmod=function(lr,ir,er){if(At(!lr.isZero()),this.isZero())return{div:new kt(0),mod:new kt(0)};var rr,yr,fr;return this.negative!==0&&lr.negative===0?(fr=this.neg().divmod(lr,ir),ir!=="mod"&&(rr=fr.div.neg()),ir!=="div"&&(yr=fr.mod.neg(),er&&yr.negative!==0&&yr.iadd(lr)),{div:rr,mod:yr}):this.negative===0&&lr.negative!==0?(fr=this.divmod(lr.neg(),ir),ir!=="mod"&&(rr=fr.div.neg()),{div:rr,mod:fr.mod}):this.negative&lr.negative?(fr=this.neg().divmod(lr.neg(),ir),ir!=="div"&&(yr=fr.mod.neg(),er&&yr.negative!==0&&yr.isub(lr)),{div:fr.div,mod:yr}):lr.length>this.length||this.cmp(lr)<0?{div:new kt(0),mod:this}:lr.length===1?ir==="div"?{div:this.divn(lr.words[0]),mod:null}:ir==="mod"?{div:null,mod:new kt(this.modn(lr.words[0]))}:{div:this.divn(lr.words[0]),mod:new kt(this.modn(lr.words[0]))}:this._wordDiv(lr,ir)},kt.prototype.div=function(lr){return this.divmod(lr,"div",!1).div},kt.prototype.mod=function(lr){return this.divmod(lr,"mod",!1).mod},kt.prototype.umod=function(lr){return this.divmod(lr,"mod",!0).mod},kt.prototype.divRound=function(lr){var ir=this.divmod(lr);if(ir.mod.isZero())return ir.div;var er=ir.div.negative!==0?ir.mod.isub(lr):ir.mod,rr=lr.ushrn(1),yr=lr.andln(1),fr=er.cmp(rr);return fr<0||yr===1&&fr===0?ir.div:ir.div.negative!==0?ir.div.isubn(1):ir.div.iaddn(1)},kt.prototype.modn=function(lr){At(lr<=67108863);for(var ir=(1<<26)%lr,er=0,rr=this.length-1;rr>=0;rr--)er=(ir*er+(this.words[rr]|0))%lr;return er},kt.prototype.idivn=function(lr){At(lr<=67108863);for(var ir=0,er=this.length-1;er>=0;er--){var rr=(this.words[er]|0)+ir*67108864;this.words[er]=rr/lr|0,ir=rr%lr}return this.strip()},kt.prototype.divn=function(lr){return this.clone().idivn(lr)},kt.prototype.egcd=function(lr){At(lr.negative===0),At(!lr.isZero());var ir=this,er=lr.clone();ir.negative!==0?ir=ir.umod(lr):ir=ir.clone();for(var rr=new kt(1),yr=new kt(0),fr=new kt(0),gr=new kt(1),ar=0;ir.isEven()&&er.isEven();)ir.iushrn(1),er.iushrn(1),++ar;for(var nr=er.clone(),ur=ir.clone();!ir.isZero();){for(var pr=0,br=1;!(ir.words[0]&br)&&pr<26;++pr,br<<=1);if(pr>0)for(ir.iushrn(pr);pr-- >0;)(rr.isOdd()||yr.isOdd())&&(rr.iadd(nr),yr.isub(ur)),rr.iushrn(1),yr.iushrn(1);for(var Sr=0,Pr=1;!(er.words[0]&Pr)&&Sr<26;++Sr,Pr<<=1);if(Sr>0)for(er.iushrn(Sr);Sr-- >0;)(fr.isOdd()||gr.isOdd())&&(fr.iadd(nr),gr.isub(ur)),fr.iushrn(1),gr.iushrn(1);ir.cmp(er)>=0?(ir.isub(er),rr.isub(fr),yr.isub(gr)):(er.isub(ir),fr.isub(rr),gr.isub(yr))}return{a:fr,b:gr,gcd:er.iushln(ar)}},kt.prototype._invmp=function(lr){At(lr.negative===0),At(!lr.isZero());var ir=this,er=lr.clone();ir.negative!==0?ir=ir.umod(lr):ir=ir.clone();for(var rr=new kt(1),yr=new kt(0),fr=er.clone();ir.cmpn(1)>0&&er.cmpn(1)>0;){for(var gr=0,ar=1;!(ir.words[0]&ar)&&gr<26;++gr,ar<<=1);if(gr>0)for(ir.iushrn(gr);gr-- >0;)rr.isOdd()&&rr.iadd(fr),rr.iushrn(1);for(var nr=0,ur=1;!(er.words[0]&ur)&&nr<26;++nr,ur<<=1);if(nr>0)for(er.iushrn(nr);nr-- >0;)yr.isOdd()&&yr.iadd(fr),yr.iushrn(1);ir.cmp(er)>=0?(ir.isub(er),rr.isub(yr)):(er.isub(ir),yr.isub(rr))}var pr;return ir.cmpn(1)===0?pr=rr:pr=yr,pr.cmpn(0)<0&&pr.iadd(lr),pr},kt.prototype.gcd=function(lr){if(this.isZero())return lr.abs();if(lr.isZero())return this.abs();var ir=this.clone(),er=lr.clone();ir.negative=0,er.negative=0;for(var rr=0;ir.isEven()&&er.isEven();rr++)ir.iushrn(1),er.iushrn(1);do{for(;ir.isEven();)ir.iushrn(1);for(;er.isEven();)er.iushrn(1);var yr=ir.cmp(er);if(yr<0){var fr=ir;ir=er,er=fr}else if(yr===0||er.cmpn(1)===0)break;ir.isub(er)}while(!0);return er.iushln(rr)},kt.prototype.invm=function(lr){return this.egcd(lr).a.umod(lr)},kt.prototype.isEven=function(){return(this.words[0]&1)===0},kt.prototype.isOdd=function(){return(this.words[0]&1)===1},kt.prototype.andln=function(lr){return this.words[0]&lr},kt.prototype.bincn=function(lr){At(typeof lr=="number");var ir=lr%26,er=(lr-ir)/26,rr=1<<ir;if(this.length<=er)return this._expand(er+1),this.words[er]|=rr,this;for(var yr=rr,fr=er;yr!==0&&fr<this.length;fr++){var gr=this.words[fr]|0;gr+=yr,yr=gr>>>26,gr&=67108863,this.words[fr]=gr}return yr!==0&&(this.words[fr]=yr,this.length++),this},kt.prototype.isZero=function(){return this.length===1&&this.words[0]===0},kt.prototype.cmpn=function(lr){var ir=lr<0;if(this.negative!==0&&!ir)return-1;if(this.negative===0&&ir)return 1;this.strip();var er;if(this.length>1)er=1;else{ir&&(lr=-lr),At(lr<=67108863,"Number is too big");var rr=this.words[0]|0;er=rr===lr?0:rr<lr?-1:1}return this.negative!==0?-er|0:er},kt.prototype.cmp=function(lr){if(this.negative!==0&&lr.negative===0)return-1;if(this.negative===0&&lr.negative!==0)return 1;var ir=this.ucmp(lr);return this.negative!==0?-ir|0:ir},kt.prototype.ucmp=function(lr){if(this.length>lr.length)return 1;if(this.length<lr.length)return-1;for(var ir=0,er=this.length-1;er>=0;er--){var rr=this.words[er]|0,yr=lr.words[er]|0;if(rr!==yr){rr<yr?ir=-1:rr>yr&&(ir=1);break}}return ir},kt.prototype.gtn=function(lr){return this.cmpn(lr)===1},kt.prototype.gt=function(lr){return this.cmp(lr)===1},kt.prototype.gten=function(lr){return this.cmpn(lr)>=0},kt.prototype.gte=function(lr){return this.cmp(lr)>=0},kt.prototype.ltn=function(lr){return this.cmpn(lr)===-1},kt.prototype.lt=function(lr){return this.cmp(lr)===-1},kt.prototype.lten=function(lr){return this.cmpn(lr)<=0},kt.prototype.lte=function(lr){return this.cmp(lr)<=0},kt.prototype.eqn=function(lr){return this.cmpn(lr)===0},kt.prototype.eq=function(lr){return this.cmp(lr)===0},kt.red=function(lr){return new Rr(lr)},kt.prototype.toRed=function(lr){return At(!this.red,"Already a number in reduction context"),At(this.negative===0,"red works only with positives"),lr.convertTo(this)._forceRed(lr)},kt.prototype.fromRed=function(){return At(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},kt.prototype._forceRed=function(lr){return this.red=lr,this},kt.prototype.forceRed=function(lr){return At(!this.red,"Already a number in reduction context"),this._forceRed(lr)},kt.prototype.redAdd=function(lr){return At(this.red,"redAdd works only with red numbers"),this.red.add(this,lr)},kt.prototype.redIAdd=function(lr){return At(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,lr)},kt.prototype.redSub=function(lr){return At(this.red,"redSub works only with red numbers"),this.red.sub(this,lr)},kt.prototype.redISub=function(lr){return At(this.red,"redISub works only with red numbers"),this.red.isub(this,lr)},kt.prototype.redShl=function(lr){return At(this.red,"redShl works only with red numbers"),this.red.shl(this,lr)},kt.prototype.redMul=function(lr){return At(this.red,"redMul works only with red numbers"),this.red._verify2(this,lr),this.red.mul(this,lr)},kt.prototype.redIMul=function(lr){return At(this.red,"redMul works only with red numbers"),this.red._verify2(this,lr),this.red.imul(this,lr)},kt.prototype.redSqr=function(){return At(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},kt.prototype.redISqr=function(){return At(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},kt.prototype.redSqrt=function(){return At(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},kt.prototype.redInvm=function(){return At(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},kt.prototype.redNeg=function(){return At(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},kt.prototype.redPow=function(lr){return At(this.red&&!lr.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,lr)};var Jt={k256:null,p224:null,p192:null,p25519:null};function tr(kr,lr){this.name=kr,this.p=new kt(lr,16),this.n=this.p.bitLength(),this.k=new kt(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}tr.prototype._tmp=function(){var lr=new kt(null);return lr.words=new Array(Math.ceil(this.n/13)),lr},tr.prototype.ireduce=function(lr){var ir=lr,er;do this.split(ir,this.tmp),ir=this.imulK(ir),ir=ir.iadd(this.tmp),er=ir.bitLength();while(er>this.n);var rr=er<this.n?-1:ir.ucmp(this.p);return rr===0?(ir.words[0]=0,ir.length=1):rr>0?ir.isub(this.p):ir.strip!==void 0?ir.strip():ir._strip(),ir},tr.prototype.split=function(lr,ir){lr.iushrn(this.n,0,ir)},tr.prototype.imulK=function(lr){return lr.imul(this.k)};function dr(){tr.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}xt(dr,tr),dr.prototype.split=function(lr,ir){for(var er=4194303,rr=Math.min(lr.length,9),yr=0;yr<rr;yr++)ir.words[yr]=lr.words[yr];if(ir.length=rr,lr.length<=9){lr.words[0]=0,lr.length=1;return}var fr=lr.words[9];for(ir.words[ir.length++]=fr&er,yr=10;yr<lr.length;yr++){var gr=lr.words[yr]|0;lr.words[yr-10]=(gr&er)<<4|fr>>>22,fr=gr}fr>>>=22,lr.words[yr-10]=fr,fr===0&&lr.length>10?lr.length-=10:lr.length-=9},dr.prototype.imulK=function(lr){lr.words[lr.length]=0,lr.words[lr.length+1]=0,lr.length+=2;for(var ir=0,er=0;er<lr.length;er++){var rr=lr.words[er]|0;ir+=rr*977,lr.words[er]=ir&67108863,ir=rr*64+(ir/67108864|0)}return lr.words[lr.length-1]===0&&(lr.length--,lr.words[lr.length-1]===0&&lr.length--),lr};function vr(){tr.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}xt(vr,tr);function $r(){tr.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}xt($r,tr);function Ir(){tr.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}xt(Ir,tr),Ir.prototype.imulK=function(lr){for(var ir=0,er=0;er<lr.length;er++){var rr=(lr.words[er]|0)*19+ir,yr=rr&67108863;rr>>>=26,lr.words[er]=yr,ir=rr}return ir!==0&&(lr.words[lr.length++]=ir),lr},kt._prime=function(lr){if(Jt[lr])return Jt[lr];var ir;if(lr==="k256")ir=new dr;else if(lr==="p224")ir=new vr;else if(lr==="p192")ir=new $r;else if(lr==="p25519")ir=new Ir;else throw new Error("Unknown prime "+lr);return Jt[lr]=ir,ir};function Rr(kr){if(typeof kr=="string"){var lr=kt._prime(kr);this.m=lr.p,this.prime=lr}else At(kr.gtn(1),"modulus must be greater than 1"),this.m=kr,this.prime=null}Rr.prototype._verify1=function(lr){At(lr.negative===0,"red works only with positives"),At(lr.red,"red works only with red numbers")},Rr.prototype._verify2=function(lr,ir){At((lr.negative|ir.negative)===0,"red works only with positives"),At(lr.red&&lr.red===ir.red,"red works only with red numbers")},Rr.prototype.imod=function(lr){return this.prime?this.prime.ireduce(lr)._forceRed(this):lr.umod(this.m)._forceRed(this)},Rr.prototype.neg=function(lr){return lr.isZero()?lr.clone():this.m.sub(lr)._forceRed(this)},Rr.prototype.add=function(lr,ir){this._verify2(lr,ir);var er=lr.add(ir);return er.cmp(this.m)>=0&&er.isub(this.m),er._forceRed(this)},Rr.prototype.iadd=function(lr,ir){this._verify2(lr,ir);var er=lr.iadd(ir);return er.cmp(this.m)>=0&&er.isub(this.m),er},Rr.prototype.sub=function(lr,ir){this._verify2(lr,ir);var er=lr.sub(ir);return er.cmpn(0)<0&&er.iadd(this.m),er._forceRed(this)},Rr.prototype.isub=function(lr,ir){this._verify2(lr,ir);var er=lr.isub(ir);return er.cmpn(0)<0&&er.iadd(this.m),er},Rr.prototype.shl=function(lr,ir){return this._verify1(lr),this.imod(lr.ushln(ir))},Rr.prototype.imul=function(lr,ir){return this._verify2(lr,ir),this.imod(lr.imul(ir))},Rr.prototype.mul=function(lr,ir){return this._verify2(lr,ir),this.imod(lr.mul(ir))},Rr.prototype.isqr=function(lr){return this.imul(lr,lr.clone())},Rr.prototype.sqr=function(lr){return this.mul(lr,lr)},Rr.prototype.sqrt=function(lr){if(lr.isZero())return lr.clone();var ir=this.m.andln(3);if(At(ir%2===1),ir===3){var er=this.m.add(new kt(1)).iushrn(2);return this.pow(lr,er)}for(var rr=this.m.subn(1),yr=0;!rr.isZero()&&rr.andln(1)===0;)yr++,rr.iushrn(1);At(!rr.isZero());var fr=new kt(1).toRed(this),gr=fr.redNeg(),ar=this.m.subn(1).iushrn(1),nr=this.m.bitLength();for(nr=new kt(2*nr*nr).toRed(this);this.pow(nr,ar).cmp(gr)!==0;)nr.redIAdd(gr);for(var ur=this.pow(nr,rr),pr=this.pow(lr,rr.addn(1).iushrn(1)),br=this.pow(lr,rr),Sr=yr;br.cmp(fr)!==0;){for(var Pr=br,Tr=0;Pr.cmp(fr)!==0;Tr++)Pr=Pr.redSqr();At(Tr<Sr);var wr=this.pow(ur,new kt(1).iushln(Sr-Tr-1));pr=pr.redMul(wr),ur=wr.redSqr(),br=br.redMul(ur),Sr=Tr}return pr},Rr.prototype.invm=function(lr){var ir=lr._invmp(this.m);return ir.negative!==0?(ir.negative=0,this.imod(ir).redNeg()):this.imod(ir)},Rr.prototype.pow=function(lr,ir){if(ir.isZero())return new kt(1).toRed(this);if(ir.cmpn(1)===0)return lr.clone();var er=4,rr=new Array(1<<er);rr[0]=new kt(1).toRed(this),rr[1]=lr;for(var yr=2;yr<rr.length;yr++)rr[yr]=this.mul(rr[yr-1],lr);var fr=rr[0],gr=0,ar=0,nr=ir.bitLength()%26;for(nr===0&&(nr=26),yr=ir.length-1;yr>=0;yr--){for(var ur=ir.words[yr],pr=nr-1;pr>=0;pr--){var br=ur>>pr&1;if(fr!==rr[0]&&(fr=this.sqr(fr)),br===0&&gr===0){ar=0;continue}gr<<=1,gr|=br,ar++,!(ar!==er&&(yr!==0||pr!==0))&&(fr=this.mul(fr,rr[gr]),ar=0,gr=0)}nr=26}return fr},Rr.prototype.convertTo=function(lr){var ir=lr.umod(this.m);return ir===lr?ir.clone():ir},Rr.prototype.convertFrom=function(lr){var ir=lr.clone();return ir.red=null,ir},kt.mont=function(lr){return new Nr(lr)};function Nr(kr){Rr.call(this,kr),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new kt(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}xt(Nr,Rr),Nr.prototype.convertTo=function(lr){return this.imod(lr.ushln(this.shift))},Nr.prototype.convertFrom=function(lr){var ir=this.imod(lr.mul(this.rinv));return ir.red=null,ir},Nr.prototype.imul=function(lr,ir){if(lr.isZero()||ir.isZero())return lr.words[0]=0,lr.length=1,lr;var er=lr.imul(ir),rr=er.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),yr=er.isub(rr).iushrn(this.shift),fr=yr;return yr.cmp(this.m)>=0?fr=yr.isub(this.m):yr.cmpn(0)<0&&(fr=yr.iadd(this.m)),fr._forceRed(this)},Nr.prototype.mul=function(lr,ir){if(lr.isZero()||ir.isZero())return new kt(0)._forceRed(this);var er=lr.mul(ir),rr=er.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),yr=er.isub(rr).iushrn(this.shift),fr=yr;return yr.cmp(this.m)>=0?fr=yr.isub(this.m):yr.cmpn(0)<0&&(fr=yr.iadd(this.m)),fr._forceRed(this)},Nr.prototype.invm=function(lr){var ir=this.imod(lr._invmp(this.m).mul(this.r2));return ir._forceRed(this)}})($t,commonjsGlobal)})(bn$1);var bnExports$1=bn$1.exports,brorand={exports:{}},hasRequiredBrorand;function requireBrorand(){if(hasRequiredBrorand)return brorand.exports;hasRequiredBrorand=1;var $t;brorand.exports=function(xt){return $t||($t=new e(null)),$t.generate(xt)};function e(At){this.rand=At}if(brorand.exports.Rand=e,e.prototype.generate=function(xt){return this._rand(xt)},e.prototype._rand=function(xt){if(this.rand.getBytes)return this.rand.getBytes(xt);for(var kt=new Uint8Array(xt),Bt=0;Bt<kt.length;Bt++)kt[Bt]=this.rand.getByte();return kt},typeof self=="object")self.crypto&&self.crypto.getRandomValues?e.prototype._rand=function(xt){var kt=new Uint8Array(xt);return self.crypto.getRandomValues(kt),kt}:self.msCrypto&&self.msCrypto.getRandomValues?e.prototype._rand=function(xt){var kt=new Uint8Array(xt);return self.msCrypto.getRandomValues(kt),kt}:typeof window=="object"&&(e.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var _t=requireCryptoBrowserify();if(typeof _t.randomBytes!="function")throw new Error("Not supported");e.prototype._rand=function(xt){return _t.randomBytes(xt)}}catch{}return brorand.exports}var mr,hasRequiredMr;function requireMr(){if(hasRequiredMr)return mr;hasRequiredMr=1;var $t=bnExports$1,e=requireBrorand();function _t(At){this.rand=At||new e.Rand}return mr=_t,_t.create=function(xt){return new _t(xt)},_t.prototype._randbelow=function(xt){var kt=xt.bitLength(),Bt=Math.ceil(kt/8);do var Nt=new $t(this.rand.generate(Bt));while(Nt.cmp(xt)>=0);return Nt},_t.prototype._randrange=function(xt,kt){var Bt=kt.sub(xt);return xt.add(this._randbelow(Bt))},_t.prototype.test=function(xt,kt,Bt){var Nt=xt.bitLength(),Ut=$t.mont(xt),Lt=new $t(1).toRed(Ut);kt||(kt=Math.max(1,Nt/48|0));for(var jt=xt.subn(1),Kt=0;!jt.testn(Kt);Kt++);for(var qt=xt.shrn(Kt),zt=jt.toRed(Ut),Vt=!0;kt>0;kt--){var Ht=this._randrange(new $t(2),jt);Bt&&Bt(Ht);var Wt=Ht.toRed(Ut).redPow(qt);if(!(Wt.cmp(Lt)===0||Wt.cmp(zt)===0)){for(var Qt=1;Qt<Kt;Qt++){if(Wt=Wt.redSqr(),Wt.cmp(Lt)===0)return!1;if(Wt.cmp(zt)===0)break}if(Qt===Kt)return!1}}return Vt},_t.prototype.getDivisor=function(xt,kt){var Bt=xt.bitLength(),Nt=$t.mont(xt),Ut=new $t(1).toRed(Nt);kt||(kt=Math.max(1,Bt/48|0));for(var Lt=xt.subn(1),jt=0;!Lt.testn(jt);jt++);for(var Kt=xt.shrn(jt),qt=Lt.toRed(Nt);kt>0;kt--){var zt=this._randrange(new $t(2),Lt),Vt=xt.gcd(zt);if(Vt.cmpn(1)!==0)return Vt;var Ht=zt.toRed(Nt).redPow(Kt);if(!(Ht.cmp(Ut)===0||Ht.cmp(qt)===0)){for(var Wt=1;Wt<jt;Wt++){if(Ht=Ht.redSqr(),Ht.cmp(Ut)===0)return Ht.fromRed().subn(1).gcd(xt);if(Ht.cmp(qt)===0)break}if(Wt===jt)return Ht=Ht.redSqr(),Ht.fromRed().subn(1).gcd(xt)}}return!1},mr}var generatePrime,hasRequiredGeneratePrime;function requireGeneratePrime(){if(hasRequiredGeneratePrime)return generatePrime;hasRequiredGeneratePrime=1;var $t=browserExports$2;generatePrime=Wt,Wt.simpleSieve=Vt,Wt.fermatTest=Ht;var e=bnExports$1,_t=new e(24),At=requireMr(),xt=new At,kt=new e(1),Bt=new e(2),Nt=new e(5);new e(16),new e(8);var Ut=new e(10),Lt=new e(3);new e(7);var jt=new e(11),Kt=new e(4);new e(12);var qt=null;function zt(){if(qt!==null)return qt;var Qt=1048576,Xt=[];Xt[0]=2;for(var Jt=1,tr=3;tr<Qt;tr+=2){for(var dr=Math.ceil(Math.sqrt(tr)),vr=0;vr<Jt&&Xt[vr]<=dr&&tr%Xt[vr]!==0;vr++);Jt!==vr&&Xt[vr]<=dr||(Xt[Jt++]=tr)}return qt=Xt,Xt}function Vt(Qt){for(var Xt=zt(),Jt=0;Jt<Xt.length;Jt++)if(Qt.modn(Xt[Jt])===0)return Qt.cmpn(Xt[Jt])===0;return!0}function Ht(Qt){var Xt=e.mont(Qt);return Bt.toRed(Xt).redPow(Qt.subn(1)).fromRed().cmpn(1)===0}function Wt(Qt,Xt){if(Qt<16)return Xt===2||Xt===5?new e([140,123]):new e([140,39]);Xt=new e(Xt);for(var Jt,tr;;){for(Jt=new e($t(Math.ceil(Qt/8)));Jt.bitLength()>Qt;)Jt.ishrn(1);if(Jt.isEven()&&Jt.iadd(kt),Jt.testn(1)||Jt.iadd(Bt),Xt.cmp(Bt)){if(!Xt.cmp(Nt))for(;Jt.mod(Ut).cmp(Lt);)Jt.iadd(Kt)}else for(;Jt.mod(_t).cmp(jt);)Jt.iadd(Kt);if(tr=Jt.shrn(1),Vt(tr)&&Vt(Jt)&&Ht(tr)&&Ht(Jt)&&xt.test(tr)&&xt.test(Jt))return Jt}}return generatePrime}const modp1={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"},require$$1$3={modp1,modp2,modp5,modp14,modp15,modp16,modp17,modp18};var dh,hasRequiredDh;function requireDh(){if(hasRequiredDh)return dh;hasRequiredDh=1;var $t=bnExports$1,e=requireMr(),_t=new e,At=new $t(24),xt=new $t(11),kt=new $t(10),Bt=new $t(3),Nt=new $t(7),Ut=requireGeneratePrime(),Lt=browserExports$2;dh=Vt;function jt(Wt,Qt){return Qt=Qt||"utf8",buffer$2.Buffer.isBuffer(Wt)||(Wt=new buffer$2.Buffer(Wt,Qt)),this._pub=new $t(Wt),this}function Kt(Wt,Qt){return Qt=Qt||"utf8",buffer$2.Buffer.isBuffer(Wt)||(Wt=new buffer$2.Buffer(Wt,Qt)),this._priv=new $t(Wt),this}var qt={};function zt(Wt,Qt){var Xt=Qt.toString("hex"),Jt=[Xt,Wt.toString(16)].join("_");if(Jt in qt)return qt[Jt];var tr=0;if(Wt.isEven()||!Ut.simpleSieve||!Ut.fermatTest(Wt)||!_t.test(Wt))return tr+=1,Xt==="02"||Xt==="05"?tr+=8:tr+=4,qt[Jt]=tr,tr;_t.test(Wt.shrn(1))||(tr+=2);var dr;switch(Xt){case"02":Wt.mod(At).cmp(xt)&&(tr+=8);break;case"05":dr=Wt.mod(kt),dr.cmp(Bt)&&dr.cmp(Nt)&&(tr+=8);break;default:tr+=4}return qt[Jt]=tr,tr}function Vt(Wt,Qt,Xt){this.setGenerator(Qt),this.__prime=new $t(Wt),this._prime=$t.mont(this.__prime),this._primeLen=Wt.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,Xt?(this.setPublicKey=jt,this.setPrivateKey=Kt):this._primeCode=8}Object.defineProperty(Vt.prototype,"verifyError",{enumerable:!0,get:function(){return typeof this._primeCode!="number"&&(this._primeCode=zt(this.__prime,this.__gen)),this._primeCode}}),Vt.prototype.generateKeys=function(){return this._priv||(this._priv=new $t(Lt(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},Vt.prototype.computeSecret=function(Wt){Wt=new $t(Wt),Wt=Wt.toRed(this._prime);var Qt=Wt.redPow(this._priv).fromRed(),Xt=new buffer$2.Buffer(Qt.toArray()),Jt=this.getPrime();if(Xt.length<Jt.length){var tr=new buffer$2.Buffer(Jt.length-Xt.length);tr.fill(0),Xt=buffer$2.Buffer.concat([tr,Xt])}return Xt},Vt.prototype.getPublicKey=function(Qt){return Ht(this._pub,Qt)},Vt.prototype.getPrivateKey=function(Qt){return Ht(this._priv,Qt)},Vt.prototype.getPrime=function(Wt){return Ht(this.__prime,Wt)},Vt.prototype.getGenerator=function(Wt){return Ht(this._gen,Wt)},Vt.prototype.setGenerator=function(Wt,Qt){return Qt=Qt||"utf8",buffer$2.Buffer.isBuffer(Wt)||(Wt=new buffer$2.Buffer(Wt,Qt)),this.__gen=Wt,this._gen=new $t(Wt),this};function Ht(Wt,Qt){var Xt=new buffer$2.Buffer(Wt.toArray());return Qt?Xt.toString(Qt):Xt}return dh}var hasRequiredBrowser$3;function requireBrowser$3(){if(hasRequiredBrowser$3)return browser$7;hasRequiredBrowser$3=1;var $t=requireGeneratePrime(),e=require$$1$3,_t=requireDh();function At(Bt){var Nt=new buffer$2.Buffer(e[Bt].prime,"hex"),Ut=new buffer$2.Buffer(e[Bt].gen,"hex");return new _t(Nt,Ut)}var xt={binary:!0,hex:!0,base64:!0};function kt(Bt,Nt,Ut,Lt){return buffer$2.Buffer.isBuffer(Nt)||xt[Nt]===void 0?kt(Bt,"binary",Nt,Ut):(Nt=Nt||"binary",Lt=Lt||"binary",Ut=Ut||new buffer$2.Buffer([2]),buffer$2.Buffer.isBuffer(Ut)||(Ut=new buffer$2.Buffer(Ut,Lt)),typeof Bt=="number"?new _t($t(Bt,Ut),Ut,!0):(buffer$2.Buffer.isBuffer(Bt)||(Bt=new buffer$2.Buffer(Bt,Nt)),new _t(Bt,Ut,!0)))}return browser$7.DiffieHellmanGroup=browser$7.createDiffieHellmanGroup=browser$7.getDiffieHellman=At,browser$7.createDiffieHellman=browser$7.DiffieHellman=kt,browser$7}var readableBrowser={exports:{}},processNextickArgs={exports:{}};typeof process$9>"u"||!process$9.version||process$9.version.indexOf("v0.")===0||process$9.version.indexOf("v1.")===0&&process$9.version.indexOf("v1.8.")!==0?processNextickArgs.exports={nextTick:nextTick$2}:processNextickArgs.exports=process$9;function nextTick$2($t,e,_t,At){if(typeof $t!="function")throw new TypeError('"callback" argument must be a function');var xt=arguments.length,kt,Bt;switch(xt){case 0:case 1:return process$9.nextTick($t);case 2:return process$9.nextTick(function(){$t.call(null,e)});case 3:return process$9.nextTick(function(){$t.call(null,e,_t)});case 4:return process$9.nextTick(function(){$t.call(null,e,_t,At)});default:for(kt=new Array(xt-1),Bt=0;Bt<kt.length;)kt[Bt++]=arguments[Bt];return process$9.nextTick(function(){$t.apply(null,kt)})}}var processNextickArgsExports=processNextickArgs.exports,toString$5={}.toString,isarray=Array.isArray||function($t){return toString$5.call($t)=="[object Array]"},streamBrowser=eventsExports.EventEmitter,safeBuffer$1={exports:{}};(function($t,e){var _t=buffer$2,At=_t.Buffer;function xt(Bt,Nt){for(var Ut in Bt)Nt[Ut]=Bt[Ut]}At.from&&At.alloc&&At.allocUnsafe&&At.allocUnsafeSlow?$t.exports=_t:(xt(_t,e),e.Buffer=kt);function kt(Bt,Nt,Ut){return At(Bt,Nt,Ut)}xt(At,kt),kt.from=function(Bt,Nt,Ut){if(typeof Bt=="number")throw new TypeError("Argument must not be a number");return At(Bt,Nt,Ut)},kt.alloc=function(Bt,Nt,Ut){if(typeof Bt!="number")throw new TypeError("Argument must be a number");var Lt=At(Bt);return Nt!==void 0?typeof Ut=="string"?Lt.fill(Nt,Ut):Lt.fill(Nt):Lt.fill(0),Lt},kt.allocUnsafe=function(Bt){if(typeof Bt!="number")throw new TypeError("Argument must be a number");return At(Bt)},kt.allocUnsafeSlow=function(Bt){if(typeof Bt!="number")throw new TypeError("Argument must be a number");return _t.SlowBuffer(Bt)}})(safeBuffer$1,safeBuffer$1.exports);var safeBufferExports=safeBuffer$1.exports,util$5={};function isArray($t){return Array.isArray?Array.isArray($t):objectToString$1($t)==="[object Array]"}util$5.isArray=isArray;function isBoolean($t){return typeof $t=="boolean"}util$5.isBoolean=isBoolean;function isNull($t){return $t===null}util$5.isNull=isNull;function isNullOrUndefined($t){return $t==null}util$5.isNullOrUndefined=isNullOrUndefined;function isNumber($t){return typeof $t=="number"}util$5.isNumber=isNumber;function isString($t){return typeof $t=="string"}util$5.isString=isString;function isSymbol($t){return typeof $t=="symbol"}util$5.isSymbol=isSymbol;function isUndefined($t){return $t===void 0}util$5.isUndefined=isUndefined;function isRegExp($t){return objectToString$1($t)==="[object RegExp]"}util$5.isRegExp=isRegExp;function isObject($t){return typeof $t=="object"&&$t!==null}util$5.isObject=isObject;function isDate($t){return objectToString$1($t)==="[object Date]"}util$5.isDate=isDate;function isError$1($t){return objectToString$1($t)==="[object Error]"||$t instanceof Error}util$5.isError=isError$1;function isFunction($t){return typeof $t=="function"}util$5.isFunction=isFunction;function isPrimitive($t){return $t===null||typeof $t=="boolean"||typeof $t=="number"||typeof $t=="string"||typeof $t=="symbol"||typeof $t>"u"}util$5.isPrimitive=isPrimitive;util$5.isBuffer=buffer$2.Buffer.isBuffer;function objectToString$1($t){return Object.prototype.toString.call($t)}var BufferList={exports:{}},hasRequiredBufferList;function requireBufferList(){return hasRequiredBufferList||(hasRequiredBufferList=1,function($t){function e(kt,Bt){if(!(kt instanceof Bt))throw new TypeError("Cannot call a class as a function")}var _t=safeBufferExports.Buffer,At=util$6;function xt(kt,Bt,Nt){kt.copy(Bt,Nt)}$t.exports=function(){function kt(){e(this,kt),this.head=null,this.tail=null,this.length=0}return kt.prototype.push=function(Nt){var Ut={data:Nt,next:null};this.length>0?this.tail.next=Ut:this.head=Ut,this.tail=Ut,++this.length},kt.prototype.unshift=function(Nt){var Ut={data:Nt,next:this.head};this.length===0&&(this.tail=Ut),this.head=Ut,++this.length},kt.prototype.shift=function(){if(this.length!==0){var Nt=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,Nt}},kt.prototype.clear=function(){this.head=this.tail=null,this.length=0},kt.prototype.join=function(Nt){if(this.length===0)return"";for(var Ut=this.head,Lt=""+Ut.data;Ut=Ut.next;)Lt+=Nt+Ut.data;return Lt},kt.prototype.concat=function(Nt){if(this.length===0)return _t.alloc(0);for(var Ut=_t.allocUnsafe(Nt>>>0),Lt=this.head,jt=0;Lt;)xt(Lt.data,Ut,jt),jt+=Lt.data.length,Lt=Lt.next;return Ut},kt}(),At&&At.inspect&&At.inspect.custom&&($t.exports.prototype[At.inspect.custom]=function(){var kt=At.inspect({length:this.length});return this.constructor.name+" "+kt})}(BufferList)),BufferList.exports}var pna=processNextickArgsExports;function destroy$2($t,e){var _t=this,At=this._readableState&&this._readableState.destroyed,xt=this._writableState&&this._writableState.destroyed;return At||xt?(e?e($t):$t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,pna.nextTick(emitErrorNT$2,this,$t)):pna.nextTick(emitErrorNT$2,this,$t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy($t||null,function(kt){!e&&kt?_t._writableState?_t._writableState.errorEmitted||(_t._writableState.errorEmitted=!0,pna.nextTick(emitErrorNT$2,_t,kt)):pna.nextTick(emitErrorNT$2,_t,kt):e&&e(kt)}),this)}function undestroy$2(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT$2($t,e){$t.emit("error",e)}var destroy_1$2={destroy:destroy$2,undestroy:undestroy$2},_stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1;var $t=processNextickArgsExports;_stream_writable=Ht;function e(fr){var gr=this;this.next=null,this.entry=null,this.finish=function(){yr(gr,fr)}}var _t=!process$9.browser&&["v0.10","v0.9."].indexOf(process$9.version.slice(0,5))>-1?setImmediate:$t.nextTick,At;Ht.WritableState=zt;var xt=Object.create(util$5);xt.inherits=inherits_browserExports;var kt={deprecate:browser$d},Bt=streamBrowser,Nt=safeBufferExports.Buffer,Ut=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Lt(fr){return Nt.from(fr)}function jt(fr){return Nt.isBuffer(fr)||fr instanceof Ut}var Kt=destroy_1$2;xt.inherits(Ht,Bt);function qt(){}function zt(fr,gr){At=At||require_stream_duplex(),fr=fr||{};var ar=gr instanceof At;this.objectMode=!!fr.objectMode,ar&&(this.objectMode=this.objectMode||!!fr.writableObjectMode);var nr=fr.highWaterMark,ur=fr.writableHighWaterMark,pr=this.objectMode?16:16*1024;nr||nr===0?this.highWaterMark=nr:ar&&(ur||ur===0)?this.highWaterMark=ur:this.highWaterMark=pr,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var br=fr.decodeStrings===!1;this.decodeStrings=!br,this.defaultEncoding=fr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Sr){$r(gr,Sr)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}zt.prototype.getBuffer=function(){for(var gr=this.bufferedRequest,ar=[];gr;)ar.push(gr),gr=gr.next;return ar},function(){try{Object.defineProperty(zt.prototype,"buffer",{get:kt.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Vt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Vt=Function.prototype[Symbol.hasInstance],Object.defineProperty(Ht,Symbol.hasInstance,{value:function(fr){return Vt.call(this,fr)?!0:this!==Ht?!1:fr&&fr._writableState instanceof zt}})):Vt=function(fr){return fr instanceof this};function Ht(fr){if(At=At||require_stream_duplex(),!Vt.call(Ht,this)&&!(this instanceof At))return new Ht(fr);this._writableState=new zt(fr,this),this.writable=!0,fr&&(typeof fr.write=="function"&&(this._write=fr.write),typeof fr.writev=="function"&&(this._writev=fr.writev),typeof fr.destroy=="function"&&(this._destroy=fr.destroy),typeof fr.final=="function"&&(this._final=fr.final)),Bt.call(this)}Ht.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function Wt(fr,gr){var ar=new Error("write after end");fr.emit("error",ar),$t.nextTick(gr,ar)}function Qt(fr,gr,ar,nr){var ur=!0,pr=!1;return ar===null?pr=new TypeError("May not write null values to stream"):typeof ar!="string"&&ar!==void 0&&!gr.objectMode&&(pr=new TypeError("Invalid non-string/buffer chunk")),pr&&(fr.emit("error",pr),$t.nextTick(nr,pr),ur=!1),ur}Ht.prototype.write=function(fr,gr,ar){var nr=this._writableState,ur=!1,pr=!nr.objectMode&&jt(fr);return pr&&!Nt.isBuffer(fr)&&(fr=Lt(fr)),typeof gr=="function"&&(ar=gr,gr=null),pr?gr="buffer":gr||(gr=nr.defaultEncoding),typeof ar!="function"&&(ar=qt),nr.ended?Wt(this,ar):(pr||Qt(this,nr,fr,ar))&&(nr.pendingcb++,ur=Jt(this,nr,pr,fr,gr,ar)),ur},Ht.prototype.cork=function(){var fr=this._writableState;fr.corked++},Ht.prototype.uncork=function(){var fr=this._writableState;fr.corked&&(fr.corked--,!fr.writing&&!fr.corked&&!fr.bufferProcessing&&fr.bufferedRequest&&Nr(this,fr))},Ht.prototype.setDefaultEncoding=function(gr){if(typeof gr=="string"&&(gr=gr.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((gr+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+gr);return this._writableState.defaultEncoding=gr,this};function Xt(fr,gr,ar){return!fr.objectMode&&fr.decodeStrings!==!1&&typeof gr=="string"&&(gr=Nt.from(gr,ar)),gr}Object.defineProperty(Ht.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Jt(fr,gr,ar,nr,ur,pr){if(!ar){var br=Xt(gr,nr,ur);nr!==br&&(ar=!0,ur="buffer",nr=br)}var Sr=gr.objectMode?1:nr.length;gr.length+=Sr;var Pr=gr.length<gr.highWaterMark;if(Pr||(gr.needDrain=!0),gr.writing||gr.corked){var Tr=gr.lastBufferedRequest;gr.lastBufferedRequest={chunk:nr,encoding:ur,isBuf:ar,callback:pr,next:null},Tr?Tr.next=gr.lastBufferedRequest:gr.bufferedRequest=gr.lastBufferedRequest,gr.bufferedRequestCount+=1}else tr(fr,gr,!1,Sr,nr,ur,pr);return Pr}function tr(fr,gr,ar,nr,ur,pr,br){gr.writelen=nr,gr.writecb=br,gr.writing=!0,gr.sync=!0,ar?fr._writev(ur,gr.onwrite):fr._write(ur,pr,gr.onwrite),gr.sync=!1}function dr(fr,gr,ar,nr,ur){--gr.pendingcb,ar?($t.nextTick(ur,nr),$t.nextTick(er,fr,gr),fr._writableState.errorEmitted=!0,fr.emit("error",nr)):(ur(nr),fr._writableState.errorEmitted=!0,fr.emit("error",nr),er(fr,gr))}function vr(fr){fr.writing=!1,fr.writecb=null,fr.length-=fr.writelen,fr.writelen=0}function $r(fr,gr){var ar=fr._writableState,nr=ar.sync,ur=ar.writecb;if(vr(ar),gr)dr(fr,ar,nr,gr,ur);else{var pr=kr(ar);!pr&&!ar.corked&&!ar.bufferProcessing&&ar.bufferedRequest&&Nr(fr,ar),nr?_t(Ir,fr,ar,pr,ur):Ir(fr,ar,pr,ur)}}function Ir(fr,gr,ar,nr){ar||Rr(fr,gr),gr.pendingcb--,nr(),er(fr,gr)}function Rr(fr,gr){gr.length===0&&gr.needDrain&&(gr.needDrain=!1,fr.emit("drain"))}function Nr(fr,gr){gr.bufferProcessing=!0;var ar=gr.bufferedRequest;if(fr._writev&&ar&&ar.next){var nr=gr.bufferedRequestCount,ur=new Array(nr),pr=gr.corkedRequestsFree;pr.entry=ar;for(var br=0,Sr=!0;ar;)ur[br]=ar,ar.isBuf||(Sr=!1),ar=ar.next,br+=1;ur.allBuffers=Sr,tr(fr,gr,!0,gr.length,ur,"",pr.finish),gr.pendingcb++,gr.lastBufferedRequest=null,pr.next?(gr.corkedRequestsFree=pr.next,pr.next=null):gr.corkedRequestsFree=new e(gr),gr.bufferedRequestCount=0}else{for(;ar;){var Pr=ar.chunk,Tr=ar.encoding,wr=ar.callback,Ar=gr.objectMode?1:Pr.length;if(tr(fr,gr,!1,Ar,Pr,Tr,wr),ar=ar.next,gr.bufferedRequestCount--,gr.writing)break}ar===null&&(gr.lastBufferedRequest=null)}gr.bufferedRequest=ar,gr.bufferProcessing=!1}Ht.prototype._write=function(fr,gr,ar){ar(new Error("_write() is not implemented"))},Ht.prototype._writev=null,Ht.prototype.end=function(fr,gr,ar){var nr=this._writableState;typeof fr=="function"?(ar=fr,fr=null,gr=null):typeof gr=="function"&&(ar=gr,gr=null),fr!=null&&this.write(fr,gr),nr.corked&&(nr.corked=1,this.uncork()),nr.ending||rr(this,nr,ar)};function kr(fr){return fr.ending&&fr.length===0&&fr.bufferedRequest===null&&!fr.finished&&!fr.writing}function lr(fr,gr){fr._final(function(ar){gr.pendingcb--,ar&&fr.emit("error",ar),gr.prefinished=!0,fr.emit("prefinish"),er(fr,gr)})}function ir(fr,gr){!gr.prefinished&&!gr.finalCalled&&(typeof fr._final=="function"?(gr.pendingcb++,gr.finalCalled=!0,$t.nextTick(lr,fr,gr)):(gr.prefinished=!0,fr.emit("prefinish")))}function er(fr,gr){var ar=kr(gr);return ar&&(ir(fr,gr),gr.pendingcb===0&&(gr.finished=!0,fr.emit("finish"))),ar}function rr(fr,gr,ar){gr.ending=!0,er(fr,gr),ar&&(gr.finished?$t.nextTick(ar):fr.once("finish",ar)),gr.ended=!0,fr.writable=!1}function yr(fr,gr,ar){var nr=fr.entry;for(fr.entry=null;nr;){var ur=nr.callback;gr.pendingcb--,ur(ar),nr=nr.next}gr.corkedRequestsFree.next=fr}return Object.defineProperty(Ht.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(fr){this._writableState&&(this._writableState.destroyed=fr)}}),Ht.prototype.destroy=Kt.destroy,Ht.prototype._undestroy=Kt.undestroy,Ht.prototype._destroy=function(fr,gr){this.end(),gr(fr)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var $t=processNextickArgsExports,e=Object.keys||function(Kt){var qt=[];for(var zt in Kt)qt.push(zt);return qt};_stream_duplex=Ut;var _t=Object.create(util$5);_t.inherits=inherits_browserExports;var At=require_stream_readable(),xt=require_stream_writable();_t.inherits(Ut,At);for(var kt=e(xt.prototype),Bt=0;Bt<kt.length;Bt++){var Nt=kt[Bt];Ut.prototype[Nt]||(Ut.prototype[Nt]=xt.prototype[Nt])}function Ut(Kt){if(!(this instanceof Ut))return new Ut(Kt);At.call(this,Kt),xt.call(this,Kt),Kt&&Kt.readable===!1&&(this.readable=!1),Kt&&Kt.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,Kt&&Kt.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",Lt)}Object.defineProperty(Ut.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Lt(){this.allowHalfOpen||this._writableState.ended||$t.nextTick(jt,this)}function jt(Kt){Kt.end()}return Object.defineProperty(Ut.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(Kt){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=Kt,this._writableState.destroyed=Kt)}}),Ut.prototype._destroy=function(Kt,qt){this.push(null),this.end(),$t.nextTick(qt,Kt)},_stream_duplex}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1;var $t=processNextickArgsExports;_stream_readable=Xt;var e=isarray,_t;Xt.ReadableState=Qt,eventsExports.EventEmitter;var At=function(wr,Ar){return wr.listeners(Ar).length},xt=streamBrowser,kt=safeBufferExports.Buffer,Bt=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Nt(wr){return kt.from(wr)}function Ut(wr){return kt.isBuffer(wr)||wr instanceof Bt}var Lt=Object.create(util$5);Lt.inherits=inherits_browserExports;var jt=util$6,Kt=void 0;jt&&jt.debuglog?Kt=jt.debuglog("stream"):Kt=function(){};var qt=requireBufferList(),zt=destroy_1$2,Vt;Lt.inherits(Xt,xt);var Ht=["error","close","destroy","pause","resume"];function Wt(wr,Ar,Mr){if(typeof wr.prependListener=="function")return wr.prependListener(Ar,Mr);!wr._events||!wr._events[Ar]?wr.on(Ar,Mr):e(wr._events[Ar])?wr._events[Ar].unshift(Mr):wr._events[Ar]=[Mr,wr._events[Ar]]}function Qt(wr,Ar){_t=_t||require_stream_duplex(),wr=wr||{};var Mr=Ar instanceof _t;this.objectMode=!!wr.objectMode,Mr&&(this.objectMode=this.objectMode||!!wr.readableObjectMode);var Ur=wr.highWaterMark,Or=wr.readableHighWaterMark,Cr=this.objectMode?16:16*1024;Ur||Ur===0?this.highWaterMark=Ur:Mr&&(Or||Or===0)?this.highWaterMark=Or:this.highWaterMark=Cr,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new qt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=wr.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,wr.encoding&&(Vt||(Vt=string_decoder.StringDecoder),this.decoder=new Vt(wr.encoding),this.encoding=wr.encoding)}function Xt(wr){if(_t=_t||require_stream_duplex(),!(this instanceof Xt))return new Xt(wr);this._readableState=new Qt(wr,this),this.readable=!0,wr&&(typeof wr.read=="function"&&(this._read=wr.read),typeof wr.destroy=="function"&&(this._destroy=wr.destroy)),xt.call(this)}Object.defineProperty(Xt.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(wr){this._readableState&&(this._readableState.destroyed=wr)}}),Xt.prototype.destroy=zt.destroy,Xt.prototype._undestroy=zt.undestroy,Xt.prototype._destroy=function(wr,Ar){this.push(null),Ar(wr)},Xt.prototype.push=function(wr,Ar){var Mr=this._readableState,Ur;return Mr.objectMode?Ur=!0:typeof wr=="string"&&(Ar=Ar||Mr.defaultEncoding,Ar!==Mr.encoding&&(wr=kt.from(wr,Ar),Ar=""),Ur=!0),Jt(this,wr,Ar,!1,Ur)},Xt.prototype.unshift=function(wr){return Jt(this,wr,null,!0,!1)};function Jt(wr,Ar,Mr,Ur,Or){var Cr=wr._readableState;if(Ar===null)Cr.reading=!1,Nr(wr,Cr);else{var Er;Or||(Er=dr(Cr,Ar)),Er?wr.emit("error",Er):Cr.objectMode||Ar&&Ar.length>0?(typeof Ar!="string"&&!Cr.objectMode&&Object.getPrototypeOf(Ar)!==kt.prototype&&(Ar=Nt(Ar)),Ur?Cr.endEmitted?wr.emit("error",new Error("stream.unshift() after end event")):tr(wr,Cr,Ar,!0):Cr.ended?wr.emit("error",new Error("stream.push() after EOF")):(Cr.reading=!1,Cr.decoder&&!Mr?(Ar=Cr.decoder.write(Ar),Cr.objectMode||Ar.length!==0?tr(wr,Cr,Ar,!1):ir(wr,Cr)):tr(wr,Cr,Ar,!1))):Ur||(Cr.reading=!1)}return vr(Cr)}function tr(wr,Ar,Mr,Ur){Ar.flowing&&Ar.length===0&&!Ar.sync?(wr.emit("data",Mr),wr.read(0)):(Ar.length+=Ar.objectMode?1:Mr.length,Ur?Ar.buffer.unshift(Mr):Ar.buffer.push(Mr),Ar.needReadable&&kr(wr)),ir(wr,Ar)}function dr(wr,Ar){var Mr;return!Ut(Ar)&&typeof Ar!="string"&&Ar!==void 0&&!wr.objectMode&&(Mr=new TypeError("Invalid non-string/buffer chunk")),Mr}function vr(wr){return!wr.ended&&(wr.needReadable||wr.length<wr.highWaterMark||wr.length===0)}Xt.prototype.isPaused=function(){return this._readableState.flowing===!1},Xt.prototype.setEncoding=function(wr){return Vt||(Vt=string_decoder.StringDecoder),this._readableState.decoder=new Vt(wr),this._readableState.encoding=wr,this};var $r=8388608;function Ir(wr){return wr>=$r?wr=$r:(wr--,wr|=wr>>>1,wr|=wr>>>2,wr|=wr>>>4,wr|=wr>>>8,wr|=wr>>>16,wr++),wr}function Rr(wr,Ar){return wr<=0||Ar.length===0&&Ar.ended?0:Ar.objectMode?1:wr!==wr?Ar.flowing&&Ar.length?Ar.buffer.head.data.length:Ar.length:(wr>Ar.highWaterMark&&(Ar.highWaterMark=Ir(wr)),wr<=Ar.length?wr:Ar.ended?Ar.length:(Ar.needReadable=!0,0))}Xt.prototype.read=function(wr){Kt("read",wr),wr=parseInt(wr,10);var Ar=this._readableState,Mr=wr;if(wr!==0&&(Ar.emittedReadable=!1),wr===0&&Ar.needReadable&&(Ar.length>=Ar.highWaterMark||Ar.ended))return Kt("read: emitReadable",Ar.length,Ar.ended),Ar.length===0&&Ar.ended?Sr(this):kr(this),null;if(wr=Rr(wr,Ar),wr===0&&Ar.ended)return Ar.length===0&&Sr(this),null;var Ur=Ar.needReadable;Kt("need readable",Ur),(Ar.length===0||Ar.length-wr<Ar.highWaterMark)&&(Ur=!0,Kt("length less than watermark",Ur)),Ar.ended||Ar.reading?(Ur=!1,Kt("reading or ended",Ur)):Ur&&(Kt("do read"),Ar.reading=!0,Ar.sync=!0,Ar.length===0&&(Ar.needReadable=!0),this._read(Ar.highWaterMark),Ar.sync=!1,Ar.reading||(wr=Rr(Mr,Ar)));var Or;return wr>0?Or=nr(wr,Ar):Or=null,Or===null?(Ar.needReadable=!0,wr=0):Ar.length-=wr,Ar.length===0&&(Ar.ended||(Ar.needReadable=!0),Mr!==wr&&Ar.ended&&Sr(this)),Or!==null&&this.emit("data",Or),Or};function Nr(wr,Ar){if(!Ar.ended){if(Ar.decoder){var Mr=Ar.decoder.end();Mr&&Mr.length&&(Ar.buffer.push(Mr),Ar.length+=Ar.objectMode?1:Mr.length)}Ar.ended=!0,kr(wr)}}function kr(wr){var Ar=wr._readableState;Ar.needReadable=!1,Ar.emittedReadable||(Kt("emitReadable",Ar.flowing),Ar.emittedReadable=!0,Ar.sync?$t.nextTick(lr,wr):lr(wr))}function lr(wr){Kt("emit readable"),wr.emit("readable"),ar(wr)}function ir(wr,Ar){Ar.readingMore||(Ar.readingMore=!0,$t.nextTick(er,wr,Ar))}function er(wr,Ar){for(var Mr=Ar.length;!Ar.reading&&!Ar.flowing&&!Ar.ended&&Ar.length<Ar.highWaterMark&&(Kt("maybeReadMore read 0"),wr.read(0),Mr!==Ar.length);)Mr=Ar.length;Ar.readingMore=!1}Xt.prototype._read=function(wr){this.emit("error",new Error("_read() is not implemented"))},Xt.prototype.pipe=function(wr,Ar){var Mr=this,Ur=this._readableState;switch(Ur.pipesCount){case 0:Ur.pipes=wr;break;case 1:Ur.pipes=[Ur.pipes,wr];break;default:Ur.pipes.push(wr);break}Ur.pipesCount+=1,Kt("pipe count=%d opts=%j",Ur.pipesCount,Ar);var Or=(!Ar||Ar.end!==!1)&&wr!==process$9.stdout&&wr!==process$9.stderr,Cr=Or?Br:an;Ur.endEmitted?$t.nextTick(Cr):Mr.once("end",Cr),wr.on("unpipe",Er);function Er(cn,Gr){Kt("onunpipe"),cn===Mr&&Gr&&Gr.hasUnpiped===!1&&(Gr.hasUnpiped=!0,_r())}function Br(){Kt("onend"),wr.end()}var Lr=rr(Mr);wr.on("drain",Lr);var xr=!1;function _r(){Kt("cleanup"),wr.removeListener("close",Qr),wr.removeListener("finish",Yr),wr.removeListener("drain",Lr),wr.removeListener("error",Hr),wr.removeListener("unpipe",Er),Mr.removeListener("end",Br),Mr.removeListener("end",an),Mr.removeListener("data",jr),xr=!0,Ur.awaitDrain&&(!wr._writableState||wr._writableState.needDrain)&&Lr()}var Dr=!1;Mr.on("data",jr);function jr(cn){Kt("ondata"),Dr=!1;var Gr=wr.write(cn);Gr===!1&&!Dr&&((Ur.pipesCount===1&&Ur.pipes===wr||Ur.pipesCount>1&&Tr(Ur.pipes,wr)!==-1)&&!xr&&(Kt("false write response, pause",Ur.awaitDrain),Ur.awaitDrain++,Dr=!0),Mr.pause())}function Hr(cn){Kt("onerror",cn),an(),wr.removeListener("error",Hr),At(wr,"error")===0&&wr.emit("error",cn)}Wt(wr,"error",Hr);function Qr(){wr.removeListener("finish",Yr),an()}wr.once("close",Qr);function Yr(){Kt("onfinish"),wr.removeListener("close",Qr),an()}wr.once("finish",Yr);function an(){Kt("unpipe"),Mr.unpipe(wr)}return wr.emit("pipe",Mr),Ur.flowing||(Kt("pipe resume"),Mr.resume()),wr};function rr(wr){return function(){var Ar=wr._readableState;Kt("pipeOnDrain",Ar.awaitDrain),Ar.awaitDrain&&Ar.awaitDrain--,Ar.awaitDrain===0&&At(wr,"data")&&(Ar.flowing=!0,ar(wr))}}Xt.prototype.unpipe=function(wr){var Ar=this._readableState,Mr={hasUnpiped:!1};if(Ar.pipesCount===0)return this;if(Ar.pipesCount===1)return wr&&wr!==Ar.pipes?this:(wr||(wr=Ar.pipes),Ar.pipes=null,Ar.pipesCount=0,Ar.flowing=!1,wr&&wr.emit("unpipe",this,Mr),this);if(!wr){var Ur=Ar.pipes,Or=Ar.pipesCount;Ar.pipes=null,Ar.pipesCount=0,Ar.flowing=!1;for(var Cr=0;Cr<Or;Cr++)Ur[Cr].emit("unpipe",this,{hasUnpiped:!1});return this}var Er=Tr(Ar.pipes,wr);return Er===-1?this:(Ar.pipes.splice(Er,1),Ar.pipesCount-=1,Ar.pipesCount===1&&(Ar.pipes=Ar.pipes[0]),wr.emit("unpipe",this,Mr),this)},Xt.prototype.on=function(wr,Ar){var Mr=xt.prototype.on.call(this,wr,Ar);if(wr==="data")this._readableState.flowing!==!1&&this.resume();else if(wr==="readable"){var Ur=this._readableState;!Ur.endEmitted&&!Ur.readableListening&&(Ur.readableListening=Ur.needReadable=!0,Ur.emittedReadable=!1,Ur.reading?Ur.length&&kr(this):$t.nextTick(yr,this))}return Mr},Xt.prototype.addListener=Xt.prototype.on;function yr(wr){Kt("readable nexttick read 0"),wr.read(0)}Xt.prototype.resume=function(){var wr=this._readableState;return wr.flowing||(Kt("resume"),wr.flowing=!0,fr(this,wr)),this};function fr(wr,Ar){Ar.resumeScheduled||(Ar.resumeScheduled=!0,$t.nextTick(gr,wr,Ar))}function gr(wr,Ar){Ar.reading||(Kt("resume read 0"),wr.read(0)),Ar.resumeScheduled=!1,Ar.awaitDrain=0,wr.emit("resume"),ar(wr),Ar.flowing&&!Ar.reading&&wr.read(0)}Xt.prototype.pause=function(){return Kt("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Kt("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function ar(wr){var Ar=wr._readableState;for(Kt("flow",Ar.flowing);Ar.flowing&&wr.read()!==null;);}Xt.prototype.wrap=function(wr){var Ar=this,Mr=this._readableState,Ur=!1;wr.on("end",function(){if(Kt("wrapped end"),Mr.decoder&&!Mr.ended){var Er=Mr.decoder.end();Er&&Er.length&&Ar.push(Er)}Ar.push(null)}),wr.on("data",function(Er){if(Kt("wrapped data"),Mr.decoder&&(Er=Mr.decoder.write(Er)),!(Mr.objectMode&&Er==null)&&!(!Mr.objectMode&&(!Er||!Er.length))){var Br=Ar.push(Er);Br||(Ur=!0,wr.pause())}});for(var Or in wr)this[Or]===void 0&&typeof wr[Or]=="function"&&(this[Or]=function(Er){return function(){return wr[Er].apply(wr,arguments)}}(Or));for(var Cr=0;Cr<Ht.length;Cr++)wr.on(Ht[Cr],this.emit.bind(this,Ht[Cr]));return this._read=function(Er){Kt("wrapped _read",Er),Ur&&(Ur=!1,wr.resume())},this},Object.defineProperty(Xt.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Xt._fromList=nr;function nr(wr,Ar){if(Ar.length===0)return null;var Mr;return Ar.objectMode?Mr=Ar.buffer.shift():!wr||wr>=Ar.length?(Ar.decoder?Mr=Ar.buffer.join(""):Ar.buffer.length===1?Mr=Ar.buffer.head.data:Mr=Ar.buffer.concat(Ar.length),Ar.buffer.clear()):Mr=ur(wr,Ar.buffer,Ar.decoder),Mr}function ur(wr,Ar,Mr){var Ur;return wr<Ar.head.data.length?(Ur=Ar.head.data.slice(0,wr),Ar.head.data=Ar.head.data.slice(wr)):wr===Ar.head.data.length?Ur=Ar.shift():Ur=Mr?pr(wr,Ar):br(wr,Ar),Ur}function pr(wr,Ar){var Mr=Ar.head,Ur=1,Or=Mr.data;for(wr-=Or.length;Mr=Mr.next;){var Cr=Mr.data,Er=wr>Cr.length?Cr.length:wr;if(Er===Cr.length?Or+=Cr:Or+=Cr.slice(0,wr),wr-=Er,wr===0){Er===Cr.length?(++Ur,Mr.next?Ar.head=Mr.next:Ar.head=Ar.tail=null):(Ar.head=Mr,Mr.data=Cr.slice(Er));break}++Ur}return Ar.length-=Ur,Or}function br(wr,Ar){var Mr=kt.allocUnsafe(wr),Ur=Ar.head,Or=1;for(Ur.data.copy(Mr),wr-=Ur.data.length;Ur=Ur.next;){var Cr=Ur.data,Er=wr>Cr.length?Cr.length:wr;if(Cr.copy(Mr,Mr.length-wr,0,Er),wr-=Er,wr===0){Er===Cr.length?(++Or,Ur.next?Ar.head=Ur.next:Ar.head=Ar.tail=null):(Ar.head=Ur,Ur.data=Cr.slice(Er));break}++Or}return Ar.length-=Or,Mr}function Sr(wr){var Ar=wr._readableState;if(Ar.length>0)throw new Error('"endReadable()" called on non-empty stream');Ar.endEmitted||(Ar.ended=!0,$t.nextTick(Pr,Ar,wr))}function Pr(wr,Ar){!wr.endEmitted&&wr.length===0&&(wr.endEmitted=!0,Ar.readable=!1,Ar.emit("end"))}function Tr(wr,Ar){for(var Mr=0,Ur=wr.length;Mr<Ur;Mr++)if(wr[Mr]===Ar)return Mr;return-1}return _stream_readable}var _stream_transform=Transform$5,Duplex$6=require_stream_duplex(),util$4=Object.create(util$5);util$4.inherits=inherits_browserExports;util$4.inherits(Transform$5,Duplex$6);function afterTransform($t,e){var _t=this._transformState;_t.transforming=!1;var At=_t.writecb;if(!At)return this.emit("error",new Error("write callback called multiple times"));_t.writechunk=null,_t.writecb=null,e!=null&&this.push(e),At($t);var xt=this._readableState;xt.reading=!1,(xt.needReadable||xt.length<xt.highWaterMark)&&this._read(xt.highWaterMark)}function Transform$5($t){if(!(this instanceof Transform$5))return new Transform$5($t);Duplex$6.call(this,$t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,$t&&(typeof $t.transform=="function"&&(this._transform=$t.transform),typeof $t.flush=="function"&&(this._flush=$t.flush)),this.on("prefinish",prefinish$2)}function prefinish$2(){var $t=this;typeof this._flush=="function"?this._flush(function(e,_t){done($t,e,_t)}):done(this,null,null)}Transform$5.prototype.push=function($t,e){return this._transformState.needTransform=!1,Duplex$6.prototype.push.call(this,$t,e)};Transform$5.prototype._transform=function($t,e,_t){throw new Error("_transform() is not implemented")};Transform$5.prototype._write=function($t,e,_t){var At=this._transformState;if(At.writecb=_t,At.writechunk=$t,At.writeencoding=e,!At.transforming){var xt=this._readableState;(At.needTransform||xt.needReadable||xt.length<xt.highWaterMark)&&this._read(xt.highWaterMark)}};Transform$5.prototype._read=function($t){var e=this._transformState;e.writechunk!==null&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Transform$5.prototype._destroy=function($t,e){var _t=this;Duplex$6.prototype._destroy.call(this,$t,function(At){e(At),_t.emit("close")})};function done($t,e,_t){if(e)return $t.emit("error",e);if(_t!=null&&$t.push(_t),$t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if($t._transformState.transforming)throw new Error("Calling transform done when still transforming");return $t.push(null)}var _stream_passthrough=PassThrough$4,Transform$4=_stream_transform,util$3=Object.create(util$5);util$3.inherits=inherits_browserExports;util$3.inherits(PassThrough$4,Transform$4);function PassThrough$4($t){if(!(this instanceof PassThrough$4))return new PassThrough$4($t);Transform$4.call(this,$t)}PassThrough$4.prototype._transform=function($t,e,_t){_t(null,$t)};(function($t,e){e=$t.exports=require_stream_readable(),e.Stream=e,e.Readable=e,e.Writable=require_stream_writable(),e.Duplex=require_stream_duplex(),e.Transform=_stream_transform,e.PassThrough=_stream_passthrough})(readableBrowser,readableBrowser.exports);var readableBrowserExports=readableBrowser.exports,sign={exports:{}},bn={exports:{}};bn.exports;(function($t){(function(e,_t){function At(ir,er){if(!ir)throw new Error(er||"Assertion failed")}function xt(ir,er){ir.super_=er;var rr=function(){};rr.prototype=er.prototype,ir.prototype=new rr,ir.prototype.constructor=ir}function kt(ir,er,rr){if(kt.isBN(ir))return ir;this.negative=0,this.words=null,this.length=0,this.red=null,ir!==null&&((er==="le"||er==="be")&&(rr=er,er=10),this._init(ir||0,er||10,rr||"be"))}typeof e=="object"?e.exports=kt:_t.BN=kt,kt.BN=kt,kt.wordSize=26;var Bt;try{typeof window<"u"&&typeof window.Buffer<"u"?Bt=window.Buffer:Bt=buffer$2.Buffer}catch{}kt.isBN=function(er){return er instanceof kt?!0:er!==null&&typeof er=="object"&&er.constructor.wordSize===kt.wordSize&&Array.isArray(er.words)},kt.max=function(er,rr){return er.cmp(rr)>0?er:rr},kt.min=function(er,rr){return er.cmp(rr)<0?er:rr},kt.prototype._init=function(er,rr,yr){if(typeof er=="number")return this._initNumber(er,rr,yr);if(typeof er=="object")return this._initArray(er,rr,yr);rr==="hex"&&(rr=16),At(rr===(rr|0)&&rr>=2&&rr<=36),er=er.toString().replace(/\s+/g,"");var fr=0;er[0]==="-"&&(fr++,this.negative=1),fr<er.length&&(rr===16?this._parseHex(er,fr,yr):(this._parseBase(er,rr,fr),yr==="le"&&this._initArray(this.toArray(),rr,yr)))},kt.prototype._initNumber=function(er,rr,yr){er<0&&(this.negative=1,er=-er),er<67108864?(this.words=[er&67108863],this.length=1):er<4503599627370496?(this.words=[er&67108863,er/67108864&67108863],this.length=2):(At(er<9007199254740992),this.words=[er&67108863,er/67108864&67108863,1],this.length=3),yr==="le"&&this._initArray(this.toArray(),rr,yr)},kt.prototype._initArray=function(er,rr,yr){if(At(typeof er.length=="number"),er.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(er.length/3),this.words=new Array(this.length);for(var fr=0;fr<this.length;fr++)this.words[fr]=0;var gr,ar,nr=0;if(yr==="be")for(fr=er.length-1,gr=0;fr>=0;fr-=3)ar=er[fr]|er[fr-1]<<8|er[fr-2]<<16,this.words[gr]|=ar<<nr&67108863,this.words[gr+1]=ar>>>26-nr&67108863,nr+=24,nr>=26&&(nr-=26,gr++);else if(yr==="le")for(fr=0,gr=0;fr<er.length;fr+=3)ar=er[fr]|er[fr+1]<<8|er[fr+2]<<16,this.words[gr]|=ar<<nr&67108863,this.words[gr+1]=ar>>>26-nr&67108863,nr+=24,nr>=26&&(nr-=26,gr++);return this._strip()};function Nt(ir,er){var rr=ir.charCodeAt(er);if(rr>=48&&rr<=57)return rr-48;if(rr>=65&&rr<=70)return rr-55;if(rr>=97&&rr<=102)return rr-87;At(!1,"Invalid character in "+ir)}function Ut(ir,er,rr){var yr=Nt(ir,rr);return rr-1>=er&&(yr|=Nt(ir,rr-1)<<4),yr}kt.prototype._parseHex=function(er,rr,yr){this.length=Math.ceil((er.length-rr)/6),this.words=new Array(this.length);for(var fr=0;fr<this.length;fr++)this.words[fr]=0;var gr=0,ar=0,nr;if(yr==="be")for(fr=er.length-1;fr>=rr;fr-=2)nr=Ut(er,rr,fr)<<gr,this.words[ar]|=nr&67108863,gr>=18?(gr-=18,ar+=1,this.words[ar]|=nr>>>26):gr+=8;else{var ur=er.length-rr;for(fr=ur%2===0?rr+1:rr;fr<er.length;fr+=2)nr=Ut(er,rr,fr)<<gr,this.words[ar]|=nr&67108863,gr>=18?(gr-=18,ar+=1,this.words[ar]|=nr>>>26):gr+=8}this._strip()};function Lt(ir,er,rr,yr){for(var fr=0,gr=0,ar=Math.min(ir.length,rr),nr=er;nr<ar;nr++){var ur=ir.charCodeAt(nr)-48;fr*=yr,ur>=49?gr=ur-49+10:ur>=17?gr=ur-17+10:gr=ur,At(ur>=0&&gr<yr,"Invalid character"),fr+=gr}return fr}kt.prototype._parseBase=function(er,rr,yr){this.words=[0],this.length=1;for(var fr=0,gr=1;gr<=67108863;gr*=rr)fr++;fr--,gr=gr/rr|0;for(var ar=er.length-yr,nr=ar%fr,ur=Math.min(ar,ar-nr)+yr,pr=0,br=yr;br<ur;br+=fr)pr=Lt(er,br,br+fr,rr),this.imuln(gr),this.words[0]+pr<67108864?this.words[0]+=pr:this._iaddn(pr);if(nr!==0){var Sr=1;for(pr=Lt(er,br,er.length,rr),br=0;br<nr;br++)Sr*=rr;this.imuln(Sr),this.words[0]+pr<67108864?this.words[0]+=pr:this._iaddn(pr)}this._strip()},kt.prototype.copy=function(er){er.words=new Array(this.length);for(var rr=0;rr<this.length;rr++)er.words[rr]=this.words[rr];er.length=this.length,er.negative=this.negative,er.red=this.red};function jt(ir,er){ir.words=er.words,ir.length=er.length,ir.negative=er.negative,ir.red=er.red}if(kt.prototype._move=function(er){jt(er,this)},kt.prototype.clone=function(){var er=new kt(null);return this.copy(er),er},kt.prototype._expand=function(er){for(;this.length<er;)this.words[this.length++]=0;return this},kt.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},kt.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{kt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Kt}catch{kt.prototype.inspect=Kt}else kt.prototype.inspect=Kt;function Kt(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var qt=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],zt=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],Vt=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];kt.prototype.toString=function(er,rr){er=er||10,rr=rr|0||1;var yr;if(er===16||er==="hex"){yr="";for(var fr=0,gr=0,ar=0;ar<this.length;ar++){var nr=this.words[ar],ur=((nr<<fr|gr)&16777215).toString(16);gr=nr>>>24-fr&16777215,fr+=2,fr>=26&&(fr-=26,ar--),gr!==0||ar!==this.length-1?yr=qt[6-ur.length]+ur+yr:yr=ur+yr}for(gr!==0&&(yr=gr.toString(16)+yr);yr.length%rr!==0;)yr="0"+yr;return this.negative!==0&&(yr="-"+yr),yr}if(er===(er|0)&&er>=2&&er<=36){var pr=zt[er],br=Vt[er];yr="";var Sr=this.clone();for(Sr.negative=0;!Sr.isZero();){var Pr=Sr.modrn(br).toString(er);Sr=Sr.idivn(br),Sr.isZero()?yr=Pr+yr:yr=qt[pr-Pr.length]+Pr+yr}for(this.isZero()&&(yr="0"+yr);yr.length%rr!==0;)yr="0"+yr;return this.negative!==0&&(yr="-"+yr),yr}At(!1,"Base should be between 2 and 36")},kt.prototype.toNumber=function(){var er=this.words[0];return this.length===2?er+=this.words[1]*67108864:this.length===3&&this.words[2]===1?er+=4503599627370496+this.words[1]*67108864:this.length>2&&At(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-er:er},kt.prototype.toJSON=function(){return this.toString(16,2)},Bt&&(kt.prototype.toBuffer=function(er,rr){return this.toArrayLike(Bt,er,rr)}),kt.prototype.toArray=function(er,rr){return this.toArrayLike(Array,er,rr)};var Ht=function(er,rr){return er.allocUnsafe?er.allocUnsafe(rr):new er(rr)};kt.prototype.toArrayLike=function(er,rr,yr){this._strip();var fr=this.byteLength(),gr=yr||Math.max(1,fr);At(fr<=gr,"byte array longer than desired length"),At(gr>0,"Requested array length <= 0");var ar=Ht(er,gr),nr=rr==="le"?"LE":"BE";return this["_toArrayLike"+nr](ar,fr),ar},kt.prototype._toArrayLikeLE=function(er,rr){for(var yr=0,fr=0,gr=0,ar=0;gr<this.length;gr++){var nr=this.words[gr]<<ar|fr;er[yr++]=nr&255,yr<er.length&&(er[yr++]=nr>>8&255),yr<er.length&&(er[yr++]=nr>>16&255),ar===6?(yr<er.length&&(er[yr++]=nr>>24&255),fr=0,ar=0):(fr=nr>>>24,ar+=2)}if(yr<er.length)for(er[yr++]=fr;yr<er.length;)er[yr++]=0},kt.prototype._toArrayLikeBE=function(er,rr){for(var yr=er.length-1,fr=0,gr=0,ar=0;gr<this.length;gr++){var nr=this.words[gr]<<ar|fr;er[yr--]=nr&255,yr>=0&&(er[yr--]=nr>>8&255),yr>=0&&(er[yr--]=nr>>16&255),ar===6?(yr>=0&&(er[yr--]=nr>>24&255),fr=0,ar=0):(fr=nr>>>24,ar+=2)}if(yr>=0)for(er[yr--]=fr;yr>=0;)er[yr--]=0},Math.clz32?kt.prototype._countBits=function(er){return 32-Math.clz32(er)}:kt.prototype._countBits=function(er){var rr=er,yr=0;return rr>=4096&&(yr+=13,rr>>>=13),rr>=64&&(yr+=7,rr>>>=7),rr>=8&&(yr+=4,rr>>>=4),rr>=2&&(yr+=2,rr>>>=2),yr+rr},kt.prototype._zeroBits=function(er){if(er===0)return 26;var rr=er,yr=0;return rr&8191||(yr+=13,rr>>>=13),rr&127||(yr+=7,rr>>>=7),rr&15||(yr+=4,rr>>>=4),rr&3||(yr+=2,rr>>>=2),rr&1||yr++,yr},kt.prototype.bitLength=function(){var er=this.words[this.length-1],rr=this._countBits(er);return(this.length-1)*26+rr};function Wt(ir){for(var er=new Array(ir.bitLength()),rr=0;rr<er.length;rr++){var yr=rr/26|0,fr=rr%26;er[rr]=ir.words[yr]>>>fr&1}return er}kt.prototype.zeroBits=function(){if(this.isZero())return 0;for(var er=0,rr=0;rr<this.length;rr++){var yr=this._zeroBits(this.words[rr]);if(er+=yr,yr!==26)break}return er},kt.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},kt.prototype.toTwos=function(er){return this.negative!==0?this.abs().inotn(er).iaddn(1):this.clone()},kt.prototype.fromTwos=function(er){return this.testn(er-1)?this.notn(er).iaddn(1).ineg():this.clone()},kt.prototype.isNeg=function(){return this.negative!==0},kt.prototype.neg=function(){return this.clone().ineg()},kt.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},kt.prototype.iuor=function(er){for(;this.length<er.length;)this.words[this.length++]=0;for(var rr=0;rr<er.length;rr++)this.words[rr]=this.words[rr]|er.words[rr];return this._strip()},kt.prototype.ior=function(er){return At((this.negative|er.negative)===0),this.iuor(er)},kt.prototype.or=function(er){return this.length>er.length?this.clone().ior(er):er.clone().ior(this)},kt.prototype.uor=function(er){return this.length>er.length?this.clone().iuor(er):er.clone().iuor(this)},kt.prototype.iuand=function(er){var rr;this.length>er.length?rr=er:rr=this;for(var yr=0;yr<rr.length;yr++)this.words[yr]=this.words[yr]&er.words[yr];return this.length=rr.length,this._strip()},kt.prototype.iand=function(er){return At((this.negative|er.negative)===0),this.iuand(er)},kt.prototype.and=function(er){return this.length>er.length?this.clone().iand(er):er.clone().iand(this)},kt.prototype.uand=function(er){return this.length>er.length?this.clone().iuand(er):er.clone().iuand(this)},kt.prototype.iuxor=function(er){var rr,yr;this.length>er.length?(rr=this,yr=er):(rr=er,yr=this);for(var fr=0;fr<yr.length;fr++)this.words[fr]=rr.words[fr]^yr.words[fr];if(this!==rr)for(;fr<rr.length;fr++)this.words[fr]=rr.words[fr];return this.length=rr.length,this._strip()},kt.prototype.ixor=function(er){return At((this.negative|er.negative)===0),this.iuxor(er)},kt.prototype.xor=function(er){return this.length>er.length?this.clone().ixor(er):er.clone().ixor(this)},kt.prototype.uxor=function(er){return this.length>er.length?this.clone().iuxor(er):er.clone().iuxor(this)},kt.prototype.inotn=function(er){At(typeof er=="number"&&er>=0);var rr=Math.ceil(er/26)|0,yr=er%26;this._expand(rr),yr>0&&rr--;for(var fr=0;fr<rr;fr++)this.words[fr]=~this.words[fr]&67108863;return yr>0&&(this.words[fr]=~this.words[fr]&67108863>>26-yr),this._strip()},kt.prototype.notn=function(er){return this.clone().inotn(er)},kt.prototype.setn=function(er,rr){At(typeof er=="number"&&er>=0);var yr=er/26|0,fr=er%26;return this._expand(yr+1),rr?this.words[yr]=this.words[yr]|1<<fr:this.words[yr]=this.words[yr]&~(1<<fr),this._strip()},kt.prototype.iadd=function(er){var rr;if(this.negative!==0&&er.negative===0)return this.negative=0,rr=this.isub(er),this.negative^=1,this._normSign();if(this.negative===0&&er.negative!==0)return er.negative=0,rr=this.isub(er),er.negative=1,rr._normSign();var yr,fr;this.length>er.length?(yr=this,fr=er):(yr=er,fr=this);for(var gr=0,ar=0;ar<fr.length;ar++)rr=(yr.words[ar]|0)+(fr.words[ar]|0)+gr,this.words[ar]=rr&67108863,gr=rr>>>26;for(;gr!==0&&ar<yr.length;ar++)rr=(yr.words[ar]|0)+gr,this.words[ar]=rr&67108863,gr=rr>>>26;if(this.length=yr.length,gr!==0)this.words[this.length]=gr,this.length++;else if(yr!==this)for(;ar<yr.length;ar++)this.words[ar]=yr.words[ar];return this},kt.prototype.add=function(er){var rr;return er.negative!==0&&this.negative===0?(er.negative=0,rr=this.sub(er),er.negative^=1,rr):er.negative===0&&this.negative!==0?(this.negative=0,rr=er.sub(this),this.negative=1,rr):this.length>er.length?this.clone().iadd(er):er.clone().iadd(this)},kt.prototype.isub=function(er){if(er.negative!==0){er.negative=0;var rr=this.iadd(er);return er.negative=1,rr._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(er),this.negative=1,this._normSign();var yr=this.cmp(er);if(yr===0)return this.negative=0,this.length=1,this.words[0]=0,this;var fr,gr;yr>0?(fr=this,gr=er):(fr=er,gr=this);for(var ar=0,nr=0;nr<gr.length;nr++)rr=(fr.words[nr]|0)-(gr.words[nr]|0)+ar,ar=rr>>26,this.words[nr]=rr&67108863;for(;ar!==0&&nr<fr.length;nr++)rr=(fr.words[nr]|0)+ar,ar=rr>>26,this.words[nr]=rr&67108863;if(ar===0&&nr<fr.length&&fr!==this)for(;nr<fr.length;nr++)this.words[nr]=fr.words[nr];return this.length=Math.max(this.length,nr),fr!==this&&(this.negative=1),this._strip()},kt.prototype.sub=function(er){return this.clone().isub(er)};function Qt(ir,er,rr){rr.negative=er.negative^ir.negative;var yr=ir.length+er.length|0;rr.length=yr,yr=yr-1|0;var fr=ir.words[0]|0,gr=er.words[0]|0,ar=fr*gr,nr=ar&67108863,ur=ar/67108864|0;rr.words[0]=nr;for(var pr=1;pr<yr;pr++){for(var br=ur>>>26,Sr=ur&67108863,Pr=Math.min(pr,er.length-1),Tr=Math.max(0,pr-ir.length+1);Tr<=Pr;Tr++){var wr=pr-Tr|0;fr=ir.words[wr]|0,gr=er.words[Tr]|0,ar=fr*gr+Sr,br+=ar/67108864|0,Sr=ar&67108863}rr.words[pr]=Sr|0,ur=br|0}return ur!==0?rr.words[pr]=ur|0:rr.length--,rr._strip()}var Xt=function(er,rr,yr){var fr=er.words,gr=rr.words,ar=yr.words,nr=0,ur,pr,br,Sr=fr[0]|0,Pr=Sr&8191,Tr=Sr>>>13,wr=fr[1]|0,Ar=wr&8191,Mr=wr>>>13,Ur=fr[2]|0,Or=Ur&8191,Cr=Ur>>>13,Er=fr[3]|0,Br=Er&8191,Lr=Er>>>13,xr=fr[4]|0,_r=xr&8191,Dr=xr>>>13,jr=fr[5]|0,Hr=jr&8191,Qr=jr>>>13,Yr=fr[6]|0,an=Yr&8191,cn=Yr>>>13,Gr=fr[7]|0,Fr=Gr&8191,en=Gr>>>13,nn=fr[8]|0,rn=nn&8191,hn=nn>>>13,yn=fr[9]|0,wn=yn&8191,mn=yn>>>13,Mn=gr[0]|0,Bn=Mn&8191,Sn=Mn>>>13,kn=gr[1]|0,Un=kn&8191,Dn=kn>>>13,Ln=gr[2]|0,Kn=Ln&8191,_n=Ln>>>13,jn=gr[3]|0,Gn=jn&8191,xn=jn>>>13,Hn=gr[4]|0,qr=Hn&8191,Wr=Hn>>>13,dn=gr[5]|0,ln=dn&8191,un=dn>>>13,On=gr[6]|0,Nn=On&8191,Jr=On>>>13,Vr=gr[7]|0,Xr=Vr&8191,tn=Vr>>>13,on=gr[8]|0,pn=on&8191,fn=on>>>13,vn=gr[9]|0,En=vn&8191,Tn=vn>>>13;yr.negative=er.negative^rr.negative,yr.length=19,ur=Math.imul(Pr,Bn),pr=Math.imul(Pr,Sn),pr=pr+Math.imul(Tr,Bn)|0,br=Math.imul(Tr,Sn);var In=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(In>>>26)|0,In&=67108863,ur=Math.imul(Ar,Bn),pr=Math.imul(Ar,Sn),pr=pr+Math.imul(Mr,Bn)|0,br=Math.imul(Mr,Sn),ur=ur+Math.imul(Pr,Un)|0,pr=pr+Math.imul(Pr,Dn)|0,pr=pr+Math.imul(Tr,Un)|0,br=br+Math.imul(Tr,Dn)|0;var Rn=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,ur=Math.imul(Or,Bn),pr=Math.imul(Or,Sn),pr=pr+Math.imul(Cr,Bn)|0,br=Math.imul(Cr,Sn),ur=ur+Math.imul(Ar,Un)|0,pr=pr+Math.imul(Ar,Dn)|0,pr=pr+Math.imul(Mr,Un)|0,br=br+Math.imul(Mr,Dn)|0,ur=ur+Math.imul(Pr,Kn)|0,pr=pr+Math.imul(Pr,_n)|0,pr=pr+Math.imul(Tr,Kn)|0,br=br+Math.imul(Tr,_n)|0;var Vn=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(Vn>>>26)|0,Vn&=67108863,ur=Math.imul(Br,Bn),pr=Math.imul(Br,Sn),pr=pr+Math.imul(Lr,Bn)|0,br=Math.imul(Lr,Sn),ur=ur+Math.imul(Or,Un)|0,pr=pr+Math.imul(Or,Dn)|0,pr=pr+Math.imul(Cr,Un)|0,br=br+Math.imul(Cr,Dn)|0,ur=ur+Math.imul(Ar,Kn)|0,pr=pr+Math.imul(Ar,_n)|0,pr=pr+Math.imul(Mr,Kn)|0,br=br+Math.imul(Mr,_n)|0,ur=ur+Math.imul(Pr,Gn)|0,pr=pr+Math.imul(Pr,xn)|0,pr=pr+Math.imul(Tr,Gn)|0,br=br+Math.imul(Tr,xn)|0;var An=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(An>>>26)|0,An&=67108863,ur=Math.imul(_r,Bn),pr=Math.imul(_r,Sn),pr=pr+Math.imul(Dr,Bn)|0,br=Math.imul(Dr,Sn),ur=ur+Math.imul(Br,Un)|0,pr=pr+Math.imul(Br,Dn)|0,pr=pr+Math.imul(Lr,Un)|0,br=br+Math.imul(Lr,Dn)|0,ur=ur+Math.imul(Or,Kn)|0,pr=pr+Math.imul(Or,_n)|0,pr=pr+Math.imul(Cr,Kn)|0,br=br+Math.imul(Cr,_n)|0,ur=ur+Math.imul(Ar,Gn)|0,pr=pr+Math.imul(Ar,xn)|0,pr=pr+Math.imul(Mr,Gn)|0,br=br+Math.imul(Mr,xn)|0,ur=ur+Math.imul(Pr,qr)|0,pr=pr+Math.imul(Pr,Wr)|0,pr=pr+Math.imul(Tr,qr)|0,br=br+Math.imul(Tr,Wr)|0;var Fn=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,ur=Math.imul(Hr,Bn),pr=Math.imul(Hr,Sn),pr=pr+Math.imul(Qr,Bn)|0,br=Math.imul(Qr,Sn),ur=ur+Math.imul(_r,Un)|0,pr=pr+Math.imul(_r,Dn)|0,pr=pr+Math.imul(Dr,Un)|0,br=br+Math.imul(Dr,Dn)|0,ur=ur+Math.imul(Br,Kn)|0,pr=pr+Math.imul(Br,_n)|0,pr=pr+Math.imul(Lr,Kn)|0,br=br+Math.imul(Lr,_n)|0,ur=ur+Math.imul(Or,Gn)|0,pr=pr+Math.imul(Or,xn)|0,pr=pr+Math.imul(Cr,Gn)|0,br=br+Math.imul(Cr,xn)|0,ur=ur+Math.imul(Ar,qr)|0,pr=pr+Math.imul(Ar,Wr)|0,pr=pr+Math.imul(Mr,qr)|0,br=br+Math.imul(Mr,Wr)|0,ur=ur+Math.imul(Pr,ln)|0,pr=pr+Math.imul(Pr,un)|0,pr=pr+Math.imul(Tr,ln)|0,br=br+Math.imul(Tr,un)|0;var Wn=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(Wn>>>26)|0,Wn&=67108863,ur=Math.imul(an,Bn),pr=Math.imul(an,Sn),pr=pr+Math.imul(cn,Bn)|0,br=Math.imul(cn,Sn),ur=ur+Math.imul(Hr,Un)|0,pr=pr+Math.imul(Hr,Dn)|0,pr=pr+Math.imul(Qr,Un)|0,br=br+Math.imul(Qr,Dn)|0,ur=ur+Math.imul(_r,Kn)|0,pr=pr+Math.imul(_r,_n)|0,pr=pr+Math.imul(Dr,Kn)|0,br=br+Math.imul(Dr,_n)|0,ur=ur+Math.imul(Br,Gn)|0,pr=pr+Math.imul(Br,xn)|0,pr=pr+Math.imul(Lr,Gn)|0,br=br+Math.imul(Lr,xn)|0,ur=ur+Math.imul(Or,qr)|0,pr=pr+Math.imul(Or,Wr)|0,pr=pr+Math.imul(Cr,qr)|0,br=br+Math.imul(Cr,Wr)|0,ur=ur+Math.imul(Ar,ln)|0,pr=pr+Math.imul(Ar,un)|0,pr=pr+Math.imul(Mr,ln)|0,br=br+Math.imul(Mr,un)|0,ur=ur+Math.imul(Pr,Nn)|0,pr=pr+Math.imul(Pr,Jr)|0,pr=pr+Math.imul(Tr,Nn)|0,br=br+Math.imul(Tr,Jr)|0;var qn=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(qn>>>26)|0,qn&=67108863,ur=Math.imul(Fr,Bn),pr=Math.imul(Fr,Sn),pr=pr+Math.imul(en,Bn)|0,br=Math.imul(en,Sn),ur=ur+Math.imul(an,Un)|0,pr=pr+Math.imul(an,Dn)|0,pr=pr+Math.imul(cn,Un)|0,br=br+Math.imul(cn,Dn)|0,ur=ur+Math.imul(Hr,Kn)|0,pr=pr+Math.imul(Hr,_n)|0,pr=pr+Math.imul(Qr,Kn)|0,br=br+Math.imul(Qr,_n)|0,ur=ur+Math.imul(_r,Gn)|0,pr=pr+Math.imul(_r,xn)|0,pr=pr+Math.imul(Dr,Gn)|0,br=br+Math.imul(Dr,xn)|0,ur=ur+Math.imul(Br,qr)|0,pr=pr+Math.imul(Br,Wr)|0,pr=pr+Math.imul(Lr,qr)|0,br=br+Math.imul(Lr,Wr)|0,ur=ur+Math.imul(Or,ln)|0,pr=pr+Math.imul(Or,un)|0,pr=pr+Math.imul(Cr,ln)|0,br=br+Math.imul(Cr,un)|0,ur=ur+Math.imul(Ar,Nn)|0,pr=pr+Math.imul(Ar,Jr)|0,pr=pr+Math.imul(Mr,Nn)|0,br=br+Math.imul(Mr,Jr)|0,ur=ur+Math.imul(Pr,Xr)|0,pr=pr+Math.imul(Pr,tn)|0,pr=pr+Math.imul(Tr,Xr)|0,br=br+Math.imul(Tr,tn)|0;var si=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(si>>>26)|0,si&=67108863,ur=Math.imul(rn,Bn),pr=Math.imul(rn,Sn),pr=pr+Math.imul(hn,Bn)|0,br=Math.imul(hn,Sn),ur=ur+Math.imul(Fr,Un)|0,pr=pr+Math.imul(Fr,Dn)|0,pr=pr+Math.imul(en,Un)|0,br=br+Math.imul(en,Dn)|0,ur=ur+Math.imul(an,Kn)|0,pr=pr+Math.imul(an,_n)|0,pr=pr+Math.imul(cn,Kn)|0,br=br+Math.imul(cn,_n)|0,ur=ur+Math.imul(Hr,Gn)|0,pr=pr+Math.imul(Hr,xn)|0,pr=pr+Math.imul(Qr,Gn)|0,br=br+Math.imul(Qr,xn)|0,ur=ur+Math.imul(_r,qr)|0,pr=pr+Math.imul(_r,Wr)|0,pr=pr+Math.imul(Dr,qr)|0,br=br+Math.imul(Dr,Wr)|0,ur=ur+Math.imul(Br,ln)|0,pr=pr+Math.imul(Br,un)|0,pr=pr+Math.imul(Lr,ln)|0,br=br+Math.imul(Lr,un)|0,ur=ur+Math.imul(Or,Nn)|0,pr=pr+Math.imul(Or,Jr)|0,pr=pr+Math.imul(Cr,Nn)|0,br=br+Math.imul(Cr,Jr)|0,ur=ur+Math.imul(Ar,Xr)|0,pr=pr+Math.imul(Ar,tn)|0,pr=pr+Math.imul(Mr,Xr)|0,br=br+Math.imul(Mr,tn)|0,ur=ur+Math.imul(Pr,pn)|0,pr=pr+Math.imul(Pr,fn)|0,pr=pr+Math.imul(Tr,pn)|0,br=br+Math.imul(Tr,fn)|0;var ei=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(ei>>>26)|0,ei&=67108863,ur=Math.imul(wn,Bn),pr=Math.imul(wn,Sn),pr=pr+Math.imul(mn,Bn)|0,br=Math.imul(mn,Sn),ur=ur+Math.imul(rn,Un)|0,pr=pr+Math.imul(rn,Dn)|0,pr=pr+Math.imul(hn,Un)|0,br=br+Math.imul(hn,Dn)|0,ur=ur+Math.imul(Fr,Kn)|0,pr=pr+Math.imul(Fr,_n)|0,pr=pr+Math.imul(en,Kn)|0,br=br+Math.imul(en,_n)|0,ur=ur+Math.imul(an,Gn)|0,pr=pr+Math.imul(an,xn)|0,pr=pr+Math.imul(cn,Gn)|0,br=br+Math.imul(cn,xn)|0,ur=ur+Math.imul(Hr,qr)|0,pr=pr+Math.imul(Hr,Wr)|0,pr=pr+Math.imul(Qr,qr)|0,br=br+Math.imul(Qr,Wr)|0,ur=ur+Math.imul(_r,ln)|0,pr=pr+Math.imul(_r,un)|0,pr=pr+Math.imul(Dr,ln)|0,br=br+Math.imul(Dr,un)|0,ur=ur+Math.imul(Br,Nn)|0,pr=pr+Math.imul(Br,Jr)|0,pr=pr+Math.imul(Lr,Nn)|0,br=br+Math.imul(Lr,Jr)|0,ur=ur+Math.imul(Or,Xr)|0,pr=pr+Math.imul(Or,tn)|0,pr=pr+Math.imul(Cr,Xr)|0,br=br+Math.imul(Cr,tn)|0,ur=ur+Math.imul(Ar,pn)|0,pr=pr+Math.imul(Ar,fn)|0,pr=pr+Math.imul(Mr,pn)|0,br=br+Math.imul(Mr,fn)|0,ur=ur+Math.imul(Pr,En)|0,pr=pr+Math.imul(Pr,Tn)|0,pr=pr+Math.imul(Tr,En)|0,br=br+Math.imul(Tr,Tn)|0;var ti=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(ti>>>26)|0,ti&=67108863,ur=Math.imul(wn,Un),pr=Math.imul(wn,Dn),pr=pr+Math.imul(mn,Un)|0,br=Math.imul(mn,Dn),ur=ur+Math.imul(rn,Kn)|0,pr=pr+Math.imul(rn,_n)|0,pr=pr+Math.imul(hn,Kn)|0,br=br+Math.imul(hn,_n)|0,ur=ur+Math.imul(Fr,Gn)|0,pr=pr+Math.imul(Fr,xn)|0,pr=pr+Math.imul(en,Gn)|0,br=br+Math.imul(en,xn)|0,ur=ur+Math.imul(an,qr)|0,pr=pr+Math.imul(an,Wr)|0,pr=pr+Math.imul(cn,qr)|0,br=br+Math.imul(cn,Wr)|0,ur=ur+Math.imul(Hr,ln)|0,pr=pr+Math.imul(Hr,un)|0,pr=pr+Math.imul(Qr,ln)|0,br=br+Math.imul(Qr,un)|0,ur=ur+Math.imul(_r,Nn)|0,pr=pr+Math.imul(_r,Jr)|0,pr=pr+Math.imul(Dr,Nn)|0,br=br+Math.imul(Dr,Jr)|0,ur=ur+Math.imul(Br,Xr)|0,pr=pr+Math.imul(Br,tn)|0,pr=pr+Math.imul(Lr,Xr)|0,br=br+Math.imul(Lr,tn)|0,ur=ur+Math.imul(Or,pn)|0,pr=pr+Math.imul(Or,fn)|0,pr=pr+Math.imul(Cr,pn)|0,br=br+Math.imul(Cr,fn)|0,ur=ur+Math.imul(Ar,En)|0,pr=pr+Math.imul(Ar,Tn)|0,pr=pr+Math.imul(Mr,En)|0,br=br+Math.imul(Mr,Tn)|0;var hi=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(hi>>>26)|0,hi&=67108863,ur=Math.imul(wn,Kn),pr=Math.imul(wn,_n),pr=pr+Math.imul(mn,Kn)|0,br=Math.imul(mn,_n),ur=ur+Math.imul(rn,Gn)|0,pr=pr+Math.imul(rn,xn)|0,pr=pr+Math.imul(hn,Gn)|0,br=br+Math.imul(hn,xn)|0,ur=ur+Math.imul(Fr,qr)|0,pr=pr+Math.imul(Fr,Wr)|0,pr=pr+Math.imul(en,qr)|0,br=br+Math.imul(en,Wr)|0,ur=ur+Math.imul(an,ln)|0,pr=pr+Math.imul(an,un)|0,pr=pr+Math.imul(cn,ln)|0,br=br+Math.imul(cn,un)|0,ur=ur+Math.imul(Hr,Nn)|0,pr=pr+Math.imul(Hr,Jr)|0,pr=pr+Math.imul(Qr,Nn)|0,br=br+Math.imul(Qr,Jr)|0,ur=ur+Math.imul(_r,Xr)|0,pr=pr+Math.imul(_r,tn)|0,pr=pr+Math.imul(Dr,Xr)|0,br=br+Math.imul(Dr,tn)|0,ur=ur+Math.imul(Br,pn)|0,pr=pr+Math.imul(Br,fn)|0,pr=pr+Math.imul(Lr,pn)|0,br=br+Math.imul(Lr,fn)|0,ur=ur+Math.imul(Or,En)|0,pr=pr+Math.imul(Or,Tn)|0,pr=pr+Math.imul(Cr,En)|0,br=br+Math.imul(Cr,Tn)|0;var li=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(li>>>26)|0,li&=67108863,ur=Math.imul(wn,Gn),pr=Math.imul(wn,xn),pr=pr+Math.imul(mn,Gn)|0,br=Math.imul(mn,xn),ur=ur+Math.imul(rn,qr)|0,pr=pr+Math.imul(rn,Wr)|0,pr=pr+Math.imul(hn,qr)|0,br=br+Math.imul(hn,Wr)|0,ur=ur+Math.imul(Fr,ln)|0,pr=pr+Math.imul(Fr,un)|0,pr=pr+Math.imul(en,ln)|0,br=br+Math.imul(en,un)|0,ur=ur+Math.imul(an,Nn)|0,pr=pr+Math.imul(an,Jr)|0,pr=pr+Math.imul(cn,Nn)|0,br=br+Math.imul(cn,Jr)|0,ur=ur+Math.imul(Hr,Xr)|0,pr=pr+Math.imul(Hr,tn)|0,pr=pr+Math.imul(Qr,Xr)|0,br=br+Math.imul(Qr,tn)|0,ur=ur+Math.imul(_r,pn)|0,pr=pr+Math.imul(_r,fn)|0,pr=pr+Math.imul(Dr,pn)|0,br=br+Math.imul(Dr,fn)|0,ur=ur+Math.imul(Br,En)|0,pr=pr+Math.imul(Br,Tn)|0,pr=pr+Math.imul(Lr,En)|0,br=br+Math.imul(Lr,Tn)|0;var Zn=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(Zn>>>26)|0,Zn&=67108863,ur=Math.imul(wn,qr),pr=Math.imul(wn,Wr),pr=pr+Math.imul(mn,qr)|0,br=Math.imul(mn,Wr),ur=ur+Math.imul(rn,ln)|0,pr=pr+Math.imul(rn,un)|0,pr=pr+Math.imul(hn,ln)|0,br=br+Math.imul(hn,un)|0,ur=ur+Math.imul(Fr,Nn)|0,pr=pr+Math.imul(Fr,Jr)|0,pr=pr+Math.imul(en,Nn)|0,br=br+Math.imul(en,Jr)|0,ur=ur+Math.imul(an,Xr)|0,pr=pr+Math.imul(an,tn)|0,pr=pr+Math.imul(cn,Xr)|0,br=br+Math.imul(cn,tn)|0,ur=ur+Math.imul(Hr,pn)|0,pr=pr+Math.imul(Hr,fn)|0,pr=pr+Math.imul(Qr,pn)|0,br=br+Math.imul(Qr,fn)|0,ur=ur+Math.imul(_r,En)|0,pr=pr+Math.imul(_r,Tn)|0,pr=pr+Math.imul(Dr,En)|0,br=br+Math.imul(Dr,Tn)|0;var ri=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(ri>>>26)|0,ri&=67108863,ur=Math.imul(wn,ln),pr=Math.imul(wn,un),pr=pr+Math.imul(mn,ln)|0,br=Math.imul(mn,un),ur=ur+Math.imul(rn,Nn)|0,pr=pr+Math.imul(rn,Jr)|0,pr=pr+Math.imul(hn,Nn)|0,br=br+Math.imul(hn,Jr)|0,ur=ur+Math.imul(Fr,Xr)|0,pr=pr+Math.imul(Fr,tn)|0,pr=pr+Math.imul(en,Xr)|0,br=br+Math.imul(en,tn)|0,ur=ur+Math.imul(an,pn)|0,pr=pr+Math.imul(an,fn)|0,pr=pr+Math.imul(cn,pn)|0,br=br+Math.imul(cn,fn)|0,ur=ur+Math.imul(Hr,En)|0,pr=pr+Math.imul(Hr,Tn)|0,pr=pr+Math.imul(Qr,En)|0,br=br+Math.imul(Qr,Tn)|0;var ui=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(ui>>>26)|0,ui&=67108863,ur=Math.imul(wn,Nn),pr=Math.imul(wn,Jr),pr=pr+Math.imul(mn,Nn)|0,br=Math.imul(mn,Jr),ur=ur+Math.imul(rn,Xr)|0,pr=pr+Math.imul(rn,tn)|0,pr=pr+Math.imul(hn,Xr)|0,br=br+Math.imul(hn,tn)|0,ur=ur+Math.imul(Fr,pn)|0,pr=pr+Math.imul(Fr,fn)|0,pr=pr+Math.imul(en,pn)|0,br=br+Math.imul(en,fn)|0,ur=ur+Math.imul(an,En)|0,pr=pr+Math.imul(an,Tn)|0,pr=pr+Math.imul(cn,En)|0,br=br+Math.imul(cn,Tn)|0;var ii=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(ii>>>26)|0,ii&=67108863,ur=Math.imul(wn,Xr),pr=Math.imul(wn,tn),pr=pr+Math.imul(mn,Xr)|0,br=Math.imul(mn,tn),ur=ur+Math.imul(rn,pn)|0,pr=pr+Math.imul(rn,fn)|0,pr=pr+Math.imul(hn,pn)|0,br=br+Math.imul(hn,fn)|0,ur=ur+Math.imul(Fr,En)|0,pr=pr+Math.imul(Fr,Tn)|0,pr=pr+Math.imul(en,En)|0,br=br+Math.imul(en,Tn)|0;var mi=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(mi>>>26)|0,mi&=67108863,ur=Math.imul(wn,pn),pr=Math.imul(wn,fn),pr=pr+Math.imul(mn,pn)|0,br=Math.imul(mn,fn),ur=ur+Math.imul(rn,En)|0,pr=pr+Math.imul(rn,Tn)|0,pr=pr+Math.imul(hn,En)|0,br=br+Math.imul(hn,Tn)|0;var Qi=(nr+ur|0)+((pr&8191)<<13)|0;nr=(br+(pr>>>13)|0)+(Qi>>>26)|0,Qi&=67108863,ur=Math.imul(wn,En),pr=Math.imul(wn,Tn),pr=pr+Math.imul(mn,En)|0,br=Math.imul(mn,Tn);var Xi=(nr+ur|0)+((pr&8191)<<13)|0;return nr=(br+(pr>>>13)|0)+(Xi>>>26)|0,Xi&=67108863,ar[0]=In,ar[1]=Rn,ar[2]=Vn,ar[3]=An,ar[4]=Fn,ar[5]=Wn,ar[6]=qn,ar[7]=si,ar[8]=ei,ar[9]=ti,ar[10]=hi,ar[11]=li,ar[12]=Zn,ar[13]=ri,ar[14]=ui,ar[15]=ii,ar[16]=mi,ar[17]=Qi,ar[18]=Xi,nr!==0&&(ar[19]=nr,yr.length++),yr};Math.imul||(Xt=Qt);function Jt(ir,er,rr){rr.negative=er.negative^ir.negative,rr.length=ir.length+er.length;for(var yr=0,fr=0,gr=0;gr<rr.length-1;gr++){var ar=fr;fr=0;for(var nr=yr&67108863,ur=Math.min(gr,er.length-1),pr=Math.max(0,gr-ir.length+1);pr<=ur;pr++){var br=gr-pr,Sr=ir.words[br]|0,Pr=er.words[pr]|0,Tr=Sr*Pr,wr=Tr&67108863;ar=ar+(Tr/67108864|0)|0,wr=wr+nr|0,nr=wr&67108863,ar=ar+(wr>>>26)|0,fr+=ar>>>26,ar&=67108863}rr.words[gr]=nr,yr=ar,ar=fr}return yr!==0?rr.words[gr]=yr:rr.length--,rr._strip()}function tr(ir,er,rr){return Jt(ir,er,rr)}kt.prototype.mulTo=function(er,rr){var yr,fr=this.length+er.length;return this.length===10&&er.length===10?yr=Xt(this,er,rr):fr<63?yr=Qt(this,er,rr):fr<1024?yr=Jt(this,er,rr):yr=tr(this,er,rr),yr},kt.prototype.mul=function(er){var rr=new kt(null);return rr.words=new Array(this.length+er.length),this.mulTo(er,rr)},kt.prototype.mulf=function(er){var rr=new kt(null);return rr.words=new Array(this.length+er.length),tr(this,er,rr)},kt.prototype.imul=function(er){return this.clone().mulTo(er,this)},kt.prototype.imuln=function(er){var rr=er<0;rr&&(er=-er),At(typeof er=="number"),At(er<67108864);for(var yr=0,fr=0;fr<this.length;fr++){var gr=(this.words[fr]|0)*er,ar=(gr&67108863)+(yr&67108863);yr>>=26,yr+=gr/67108864|0,yr+=ar>>>26,this.words[fr]=ar&67108863}return yr!==0&&(this.words[fr]=yr,this.length++),rr?this.ineg():this},kt.prototype.muln=function(er){return this.clone().imuln(er)},kt.prototype.sqr=function(){return this.mul(this)},kt.prototype.isqr=function(){return this.imul(this.clone())},kt.prototype.pow=function(er){var rr=Wt(er);if(rr.length===0)return new kt(1);for(var yr=this,fr=0;fr<rr.length&&rr[fr]===0;fr++,yr=yr.sqr());if(++fr<rr.length)for(var gr=yr.sqr();fr<rr.length;fr++,gr=gr.sqr())rr[fr]!==0&&(yr=yr.mul(gr));return yr},kt.prototype.iushln=function(er){At(typeof er=="number"&&er>=0);var rr=er%26,yr=(er-rr)/26,fr=67108863>>>26-rr<<26-rr,gr;if(rr!==0){var ar=0;for(gr=0;gr<this.length;gr++){var nr=this.words[gr]&fr,ur=(this.words[gr]|0)-nr<<rr;this.words[gr]=ur|ar,ar=nr>>>26-rr}ar&&(this.words[gr]=ar,this.length++)}if(yr!==0){for(gr=this.length-1;gr>=0;gr--)this.words[gr+yr]=this.words[gr];for(gr=0;gr<yr;gr++)this.words[gr]=0;this.length+=yr}return this._strip()},kt.prototype.ishln=function(er){return At(this.negative===0),this.iushln(er)},kt.prototype.iushrn=function(er,rr,yr){At(typeof er=="number"&&er>=0);var fr;rr?fr=(rr-rr%26)/26:fr=0;var gr=er%26,ar=Math.min((er-gr)/26,this.length),nr=67108863^67108863>>>gr<<gr,ur=yr;if(fr-=ar,fr=Math.max(0,fr),ur){for(var pr=0;pr<ar;pr++)ur.words[pr]=this.words[pr];ur.length=ar}if(ar!==0)if(this.length>ar)for(this.length-=ar,pr=0;pr<this.length;pr++)this.words[pr]=this.words[pr+ar];else this.words[0]=0,this.length=1;var br=0;for(pr=this.length-1;pr>=0&&(br!==0||pr>=fr);pr--){var Sr=this.words[pr]|0;this.words[pr]=br<<26-gr|Sr>>>gr,br=Sr&nr}return ur&&br!==0&&(ur.words[ur.length++]=br),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},kt.prototype.ishrn=function(er,rr,yr){return At(this.negative===0),this.iushrn(er,rr,yr)},kt.prototype.shln=function(er){return this.clone().ishln(er)},kt.prototype.ushln=function(er){return this.clone().iushln(er)},kt.prototype.shrn=function(er){return this.clone().ishrn(er)},kt.prototype.ushrn=function(er){return this.clone().iushrn(er)},kt.prototype.testn=function(er){At(typeof er=="number"&&er>=0);var rr=er%26,yr=(er-rr)/26,fr=1<<rr;if(this.length<=yr)return!1;var gr=this.words[yr];return!!(gr&fr)},kt.prototype.imaskn=function(er){At(typeof er=="number"&&er>=0);var rr=er%26,yr=(er-rr)/26;if(At(this.negative===0,"imaskn works only with positive numbers"),this.length<=yr)return this;if(rr!==0&&yr++,this.length=Math.min(yr,this.length),rr!==0){var fr=67108863^67108863>>>rr<<rr;this.words[this.length-1]&=fr}return this._strip()},kt.prototype.maskn=function(er){return this.clone().imaskn(er)},kt.prototype.iaddn=function(er){return At(typeof er=="number"),At(er<67108864),er<0?this.isubn(-er):this.negative!==0?this.length===1&&(this.words[0]|0)<=er?(this.words[0]=er-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(er),this.negative=1,this):this._iaddn(er)},kt.prototype._iaddn=function(er){this.words[0]+=er;for(var rr=0;rr<this.length&&this.words[rr]>=67108864;rr++)this.words[rr]-=67108864,rr===this.length-1?this.words[rr+1]=1:this.words[rr+1]++;return this.length=Math.max(this.length,rr+1),this},kt.prototype.isubn=function(er){if(At(typeof er=="number"),At(er<67108864),er<0)return this.iaddn(-er);if(this.negative!==0)return this.negative=0,this.iaddn(er),this.negative=1,this;if(this.words[0]-=er,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var rr=0;rr<this.length&&this.words[rr]<0;rr++)this.words[rr]+=67108864,this.words[rr+1]-=1;return this._strip()},kt.prototype.addn=function(er){return this.clone().iaddn(er)},kt.prototype.subn=function(er){return this.clone().isubn(er)},kt.prototype.iabs=function(){return this.negative=0,this},kt.prototype.abs=function(){return this.clone().iabs()},kt.prototype._ishlnsubmul=function(er,rr,yr){var fr=er.length+yr,gr;this._expand(fr);var ar,nr=0;for(gr=0;gr<er.length;gr++){ar=(this.words[gr+yr]|0)+nr;var ur=(er.words[gr]|0)*rr;ar-=ur&67108863,nr=(ar>>26)-(ur/67108864|0),this.words[gr+yr]=ar&67108863}for(;gr<this.length-yr;gr++)ar=(this.words[gr+yr]|0)+nr,nr=ar>>26,this.words[gr+yr]=ar&67108863;if(nr===0)return this._strip();for(At(nr===-1),nr=0,gr=0;gr<this.length;gr++)ar=-(this.words[gr]|0)+nr,nr=ar>>26,this.words[gr]=ar&67108863;return this.negative=1,this._strip()},kt.prototype._wordDiv=function(er,rr){var yr=this.length-er.length,fr=this.clone(),gr=er,ar=gr.words[gr.length-1]|0,nr=this._countBits(ar);yr=26-nr,yr!==0&&(gr=gr.ushln(yr),fr.iushln(yr),ar=gr.words[gr.length-1]|0);var ur=fr.length-gr.length,pr;if(rr!=="mod"){pr=new kt(null),pr.length=ur+1,pr.words=new Array(pr.length);for(var br=0;br<pr.length;br++)pr.words[br]=0}var Sr=fr.clone()._ishlnsubmul(gr,1,ur);Sr.negative===0&&(fr=Sr,pr&&(pr.words[ur]=1));for(var Pr=ur-1;Pr>=0;Pr--){var Tr=(fr.words[gr.length+Pr]|0)*67108864+(fr.words[gr.length+Pr-1]|0);for(Tr=Math.min(Tr/ar|0,67108863),fr._ishlnsubmul(gr,Tr,Pr);fr.negative!==0;)Tr--,fr.negative=0,fr._ishlnsubmul(gr,1,Pr),fr.isZero()||(fr.negative^=1);pr&&(pr.words[Pr]=Tr)}return pr&&pr._strip(),fr._strip(),rr!=="div"&&yr!==0&&fr.iushrn(yr),{div:pr||null,mod:fr}},kt.prototype.divmod=function(er,rr,yr){if(At(!er.isZero()),this.isZero())return{div:new kt(0),mod:new kt(0)};var fr,gr,ar;return this.negative!==0&&er.negative===0?(ar=this.neg().divmod(er,rr),rr!=="mod"&&(fr=ar.div.neg()),rr!=="div"&&(gr=ar.mod.neg(),yr&&gr.negative!==0&&gr.iadd(er)),{div:fr,mod:gr}):this.negative===0&&er.negative!==0?(ar=this.divmod(er.neg(),rr),rr!=="mod"&&(fr=ar.div.neg()),{div:fr,mod:ar.mod}):this.negative&er.negative?(ar=this.neg().divmod(er.neg(),rr),rr!=="div"&&(gr=ar.mod.neg(),yr&&gr.negative!==0&&gr.isub(er)),{div:ar.div,mod:gr}):er.length>this.length||this.cmp(er)<0?{div:new kt(0),mod:this}:er.length===1?rr==="div"?{div:this.divn(er.words[0]),mod:null}:rr==="mod"?{div:null,mod:new kt(this.modrn(er.words[0]))}:{div:this.divn(er.words[0]),mod:new kt(this.modrn(er.words[0]))}:this._wordDiv(er,rr)},kt.prototype.div=function(er){return this.divmod(er,"div",!1).div},kt.prototype.mod=function(er){return this.divmod(er,"mod",!1).mod},kt.prototype.umod=function(er){return this.divmod(er,"mod",!0).mod},kt.prototype.divRound=function(er){var rr=this.divmod(er);if(rr.mod.isZero())return rr.div;var yr=rr.div.negative!==0?rr.mod.isub(er):rr.mod,fr=er.ushrn(1),gr=er.andln(1),ar=yr.cmp(fr);return ar<0||gr===1&&ar===0?rr.div:rr.div.negative!==0?rr.div.isubn(1):rr.div.iaddn(1)},kt.prototype.modrn=function(er){var rr=er<0;rr&&(er=-er),At(er<=67108863);for(var yr=(1<<26)%er,fr=0,gr=this.length-1;gr>=0;gr--)fr=(yr*fr+(this.words[gr]|0))%er;return rr?-fr:fr},kt.prototype.modn=function(er){return this.modrn(er)},kt.prototype.idivn=function(er){var rr=er<0;rr&&(er=-er),At(er<=67108863);for(var yr=0,fr=this.length-1;fr>=0;fr--){var gr=(this.words[fr]|0)+yr*67108864;this.words[fr]=gr/er|0,yr=gr%er}return this._strip(),rr?this.ineg():this},kt.prototype.divn=function(er){return this.clone().idivn(er)},kt.prototype.egcd=function(er){At(er.negative===0),At(!er.isZero());var rr=this,yr=er.clone();rr.negative!==0?rr=rr.umod(er):rr=rr.clone();for(var fr=new kt(1),gr=new kt(0),ar=new kt(0),nr=new kt(1),ur=0;rr.isEven()&&yr.isEven();)rr.iushrn(1),yr.iushrn(1),++ur;for(var pr=yr.clone(),br=rr.clone();!rr.isZero();){for(var Sr=0,Pr=1;!(rr.words[0]&Pr)&&Sr<26;++Sr,Pr<<=1);if(Sr>0)for(rr.iushrn(Sr);Sr-- >0;)(fr.isOdd()||gr.isOdd())&&(fr.iadd(pr),gr.isub(br)),fr.iushrn(1),gr.iushrn(1);for(var Tr=0,wr=1;!(yr.words[0]&wr)&&Tr<26;++Tr,wr<<=1);if(Tr>0)for(yr.iushrn(Tr);Tr-- >0;)(ar.isOdd()||nr.isOdd())&&(ar.iadd(pr),nr.isub(br)),ar.iushrn(1),nr.iushrn(1);rr.cmp(yr)>=0?(rr.isub(yr),fr.isub(ar),gr.isub(nr)):(yr.isub(rr),ar.isub(fr),nr.isub(gr))}return{a:ar,b:nr,gcd:yr.iushln(ur)}},kt.prototype._invmp=function(er){At(er.negative===0),At(!er.isZero());var rr=this,yr=er.clone();rr.negative!==0?rr=rr.umod(er):rr=rr.clone();for(var fr=new kt(1),gr=new kt(0),ar=yr.clone();rr.cmpn(1)>0&&yr.cmpn(1)>0;){for(var nr=0,ur=1;!(rr.words[0]&ur)&&nr<26;++nr,ur<<=1);if(nr>0)for(rr.iushrn(nr);nr-- >0;)fr.isOdd()&&fr.iadd(ar),fr.iushrn(1);for(var pr=0,br=1;!(yr.words[0]&br)&&pr<26;++pr,br<<=1);if(pr>0)for(yr.iushrn(pr);pr-- >0;)gr.isOdd()&&gr.iadd(ar),gr.iushrn(1);rr.cmp(yr)>=0?(rr.isub(yr),fr.isub(gr)):(yr.isub(rr),gr.isub(fr))}var Sr;return rr.cmpn(1)===0?Sr=fr:Sr=gr,Sr.cmpn(0)<0&&Sr.iadd(er),Sr},kt.prototype.gcd=function(er){if(this.isZero())return er.abs();if(er.isZero())return this.abs();var rr=this.clone(),yr=er.clone();rr.negative=0,yr.negative=0;for(var fr=0;rr.isEven()&&yr.isEven();fr++)rr.iushrn(1),yr.iushrn(1);do{for(;rr.isEven();)rr.iushrn(1);for(;yr.isEven();)yr.iushrn(1);var gr=rr.cmp(yr);if(gr<0){var ar=rr;rr=yr,yr=ar}else if(gr===0||yr.cmpn(1)===0)break;rr.isub(yr)}while(!0);return yr.iushln(fr)},kt.prototype.invm=function(er){return this.egcd(er).a.umod(er)},kt.prototype.isEven=function(){return(this.words[0]&1)===0},kt.prototype.isOdd=function(){return(this.words[0]&1)===1},kt.prototype.andln=function(er){return this.words[0]&er},kt.prototype.bincn=function(er){At(typeof er=="number");var rr=er%26,yr=(er-rr)/26,fr=1<<rr;if(this.length<=yr)return this._expand(yr+1),this.words[yr]|=fr,this;for(var gr=fr,ar=yr;gr!==0&&ar<this.length;ar++){var nr=this.words[ar]|0;nr+=gr,gr=nr>>>26,nr&=67108863,this.words[ar]=nr}return gr!==0&&(this.words[ar]=gr,this.length++),this},kt.prototype.isZero=function(){return this.length===1&&this.words[0]===0},kt.prototype.cmpn=function(er){var rr=er<0;if(this.negative!==0&&!rr)return-1;if(this.negative===0&&rr)return 1;this._strip();var yr;if(this.length>1)yr=1;else{rr&&(er=-er),At(er<=67108863,"Number is too big");var fr=this.words[0]|0;yr=fr===er?0:fr<er?-1:1}return this.negative!==0?-yr|0:yr},kt.prototype.cmp=function(er){if(this.negative!==0&&er.negative===0)return-1;if(this.negative===0&&er.negative!==0)return 1;var rr=this.ucmp(er);return this.negative!==0?-rr|0:rr},kt.prototype.ucmp=function(er){if(this.length>er.length)return 1;if(this.length<er.length)return-1;for(var rr=0,yr=this.length-1;yr>=0;yr--){var fr=this.words[yr]|0,gr=er.words[yr]|0;if(fr!==gr){fr<gr?rr=-1:fr>gr&&(rr=1);break}}return rr},kt.prototype.gtn=function(er){return this.cmpn(er)===1},kt.prototype.gt=function(er){return this.cmp(er)===1},kt.prototype.gten=function(er){return this.cmpn(er)>=0},kt.prototype.gte=function(er){return this.cmp(er)>=0},kt.prototype.ltn=function(er){return this.cmpn(er)===-1},kt.prototype.lt=function(er){return this.cmp(er)===-1},kt.prototype.lten=function(er){return this.cmpn(er)<=0},kt.prototype.lte=function(er){return this.cmp(er)<=0},kt.prototype.eqn=function(er){return this.cmpn(er)===0},kt.prototype.eq=function(er){return this.cmp(er)===0},kt.red=function(er){return new kr(er)},kt.prototype.toRed=function(er){return At(!this.red,"Already a number in reduction context"),At(this.negative===0,"red works only with positives"),er.convertTo(this)._forceRed(er)},kt.prototype.fromRed=function(){return At(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},kt.prototype._forceRed=function(er){return this.red=er,this},kt.prototype.forceRed=function(er){return At(!this.red,"Already a number in reduction context"),this._forceRed(er)},kt.prototype.redAdd=function(er){return At(this.red,"redAdd works only with red numbers"),this.red.add(this,er)},kt.prototype.redIAdd=function(er){return At(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,er)},kt.prototype.redSub=function(er){return At(this.red,"redSub works only with red numbers"),this.red.sub(this,er)},kt.prototype.redISub=function(er){return At(this.red,"redISub works only with red numbers"),this.red.isub(this,er)},kt.prototype.redShl=function(er){return At(this.red,"redShl works only with red numbers"),this.red.shl(this,er)},kt.prototype.redMul=function(er){return At(this.red,"redMul works only with red numbers"),this.red._verify2(this,er),this.red.mul(this,er)},kt.prototype.redIMul=function(er){return At(this.red,"redMul works only with red numbers"),this.red._verify2(this,er),this.red.imul(this,er)},kt.prototype.redSqr=function(){return At(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},kt.prototype.redISqr=function(){return At(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},kt.prototype.redSqrt=function(){return At(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},kt.prototype.redInvm=function(){return At(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},kt.prototype.redNeg=function(){return At(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},kt.prototype.redPow=function(er){return At(this.red&&!er.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,er)};var dr={k256:null,p224:null,p192:null,p25519:null};function vr(ir,er){this.name=ir,this.p=new kt(er,16),this.n=this.p.bitLength(),this.k=new kt(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}vr.prototype._tmp=function(){var er=new kt(null);return er.words=new Array(Math.ceil(this.n/13)),er},vr.prototype.ireduce=function(er){var rr=er,yr;do this.split(rr,this.tmp),rr=this.imulK(rr),rr=rr.iadd(this.tmp),yr=rr.bitLength();while(yr>this.n);var fr=yr<this.n?-1:rr.ucmp(this.p);return fr===0?(rr.words[0]=0,rr.length=1):fr>0?rr.isub(this.p):rr.strip!==void 0?rr.strip():rr._strip(),rr},vr.prototype.split=function(er,rr){er.iushrn(this.n,0,rr)},vr.prototype.imulK=function(er){return er.imul(this.k)};function $r(){vr.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}xt($r,vr),$r.prototype.split=function(er,rr){for(var yr=4194303,fr=Math.min(er.length,9),gr=0;gr<fr;gr++)rr.words[gr]=er.words[gr];if(rr.length=fr,er.length<=9){er.words[0]=0,er.length=1;return}var ar=er.words[9];for(rr.words[rr.length++]=ar&yr,gr=10;gr<er.length;gr++){var nr=er.words[gr]|0;er.words[gr-10]=(nr&yr)<<4|ar>>>22,ar=nr}ar>>>=22,er.words[gr-10]=ar,ar===0&&er.length>10?er.length-=10:er.length-=9},$r.prototype.imulK=function(er){er.words[er.length]=0,er.words[er.length+1]=0,er.length+=2;for(var rr=0,yr=0;yr<er.length;yr++){var fr=er.words[yr]|0;rr+=fr*977,er.words[yr]=rr&67108863,rr=fr*64+(rr/67108864|0)}return er.words[er.length-1]===0&&(er.length--,er.words[er.length-1]===0&&er.length--),er};function Ir(){vr.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}xt(Ir,vr);function Rr(){vr.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}xt(Rr,vr);function Nr(){vr.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}xt(Nr,vr),Nr.prototype.imulK=function(er){for(var rr=0,yr=0;yr<er.length;yr++){var fr=(er.words[yr]|0)*19+rr,gr=fr&67108863;fr>>>=26,er.words[yr]=gr,rr=fr}return rr!==0&&(er.words[er.length++]=rr),er},kt._prime=function(er){if(dr[er])return dr[er];var rr;if(er==="k256")rr=new $r;else if(er==="p224")rr=new Ir;else if(er==="p192")rr=new Rr;else if(er==="p25519")rr=new Nr;else throw new Error("Unknown prime "+er);return dr[er]=rr,rr};function kr(ir){if(typeof ir=="string"){var er=kt._prime(ir);this.m=er.p,this.prime=er}else At(ir.gtn(1),"modulus must be greater than 1"),this.m=ir,this.prime=null}kr.prototype._verify1=function(er){At(er.negative===0,"red works only with positives"),At(er.red,"red works only with red numbers")},kr.prototype._verify2=function(er,rr){At((er.negative|rr.negative)===0,"red works only with positives"),At(er.red&&er.red===rr.red,"red works only with red numbers")},kr.prototype.imod=function(er){return this.prime?this.prime.ireduce(er)._forceRed(this):(jt(er,er.umod(this.m)._forceRed(this)),er)},kr.prototype.neg=function(er){return er.isZero()?er.clone():this.m.sub(er)._forceRed(this)},kr.prototype.add=function(er,rr){this._verify2(er,rr);var yr=er.add(rr);return yr.cmp(this.m)>=0&&yr.isub(this.m),yr._forceRed(this)},kr.prototype.iadd=function(er,rr){this._verify2(er,rr);var yr=er.iadd(rr);return yr.cmp(this.m)>=0&&yr.isub(this.m),yr},kr.prototype.sub=function(er,rr){this._verify2(er,rr);var yr=er.sub(rr);return yr.cmpn(0)<0&&yr.iadd(this.m),yr._forceRed(this)},kr.prototype.isub=function(er,rr){this._verify2(er,rr);var yr=er.isub(rr);return yr.cmpn(0)<0&&yr.iadd(this.m),yr},kr.prototype.shl=function(er,rr){return this._verify1(er),this.imod(er.ushln(rr))},kr.prototype.imul=function(er,rr){return this._verify2(er,rr),this.imod(er.imul(rr))},kr.prototype.mul=function(er,rr){return this._verify2(er,rr),this.imod(er.mul(rr))},kr.prototype.isqr=function(er){return this.imul(er,er.clone())},kr.prototype.sqr=function(er){return this.mul(er,er)},kr.prototype.sqrt=function(er){if(er.isZero())return er.clone();var rr=this.m.andln(3);if(At(rr%2===1),rr===3){var yr=this.m.add(new kt(1)).iushrn(2);return this.pow(er,yr)}for(var fr=this.m.subn(1),gr=0;!fr.isZero()&&fr.andln(1)===0;)gr++,fr.iushrn(1);At(!fr.isZero());var ar=new kt(1).toRed(this),nr=ar.redNeg(),ur=this.m.subn(1).iushrn(1),pr=this.m.bitLength();for(pr=new kt(2*pr*pr).toRed(this);this.pow(pr,ur).cmp(nr)!==0;)pr.redIAdd(nr);for(var br=this.pow(pr,fr),Sr=this.pow(er,fr.addn(1).iushrn(1)),Pr=this.pow(er,fr),Tr=gr;Pr.cmp(ar)!==0;){for(var wr=Pr,Ar=0;wr.cmp(ar)!==0;Ar++)wr=wr.redSqr();At(Ar<Tr);var Mr=this.pow(br,new kt(1).iushln(Tr-Ar-1));Sr=Sr.redMul(Mr),br=Mr.redSqr(),Pr=Pr.redMul(br),Tr=Ar}return Sr},kr.prototype.invm=function(er){var rr=er._invmp(this.m);return rr.negative!==0?(rr.negative=0,this.imod(rr).redNeg()):this.imod(rr)},kr.prototype.pow=function(er,rr){if(rr.isZero())return new kt(1).toRed(this);if(rr.cmpn(1)===0)return er.clone();var yr=4,fr=new Array(1<<yr);fr[0]=new kt(1).toRed(this),fr[1]=er;for(var gr=2;gr<fr.length;gr++)fr[gr]=this.mul(fr[gr-1],er);var ar=fr[0],nr=0,ur=0,pr=rr.bitLength()%26;for(pr===0&&(pr=26),gr=rr.length-1;gr>=0;gr--){for(var br=rr.words[gr],Sr=pr-1;Sr>=0;Sr--){var Pr=br>>Sr&1;if(ar!==fr[0]&&(ar=this.sqr(ar)),Pr===0&&nr===0){ur=0;continue}nr<<=1,nr|=Pr,ur++,!(ur!==yr&&(gr!==0||Sr!==0))&&(ar=this.mul(ar,fr[nr]),ur=0,nr=0)}pr=26}return ar},kr.prototype.convertTo=function(er){var rr=er.umod(this.m);return rr===er?rr.clone():rr},kr.prototype.convertFrom=function(er){var rr=er.clone();return rr.red=null,rr},kt.mont=function(er){return new lr(er)};function lr(ir){kr.call(this,ir),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new kt(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}xt(lr,kr),lr.prototype.convertTo=function(er){return this.imod(er.ushln(this.shift))},lr.prototype.convertFrom=function(er){var rr=this.imod(er.mul(this.rinv));return rr.red=null,rr},lr.prototype.imul=function(er,rr){if(er.isZero()||rr.isZero())return er.words[0]=0,er.length=1,er;var yr=er.imul(rr),fr=yr.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),gr=yr.isub(fr).iushrn(this.shift),ar=gr;return gr.cmp(this.m)>=0?ar=gr.isub(this.m):gr.cmpn(0)<0&&(ar=gr.iadd(this.m)),ar._forceRed(this)},lr.prototype.mul=function(er,rr){if(er.isZero()||rr.isZero())return new kt(0)._forceRed(this);var yr=er.mul(rr),fr=yr.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),gr=yr.isub(fr).iushrn(this.shift),ar=gr;return gr.cmp(this.m)>=0?ar=gr.isub(this.m):gr.cmpn(0)<0&&(ar=gr.iadd(this.m)),ar._forceRed(this)},lr.prototype.invm=function(er){var rr=this.imod(er._invmp(this.m).mul(this.r2));return rr._forceRed(this)}})($t,commonjsGlobal)})(bn);var bnExports=bn.exports,BN$a=bnExports,randomBytes$4=browserExports$2;function blind($t){var e=getr($t),_t=e.toRed(BN$a.mont($t.modulus)).redPow(new BN$a($t.publicExponent)).fromRed();return{blinder:_t,unblinder:e.invm($t.modulus)}}function getr($t){var e=$t.modulus.byteLength(),_t;do _t=new BN$a(randomBytes$4(e));while(_t.cmp($t.modulus)>=0||!_t.umod($t.prime1)||!_t.umod($t.prime2));return _t}function crt$2($t,e){var _t=blind(e),At=e.modulus.byteLength(),xt=new BN$a($t).mul(_t.blinder).umod(e.modulus),kt=xt.toRed(BN$a.mont(e.prime1)),Bt=xt.toRed(BN$a.mont(e.prime2)),Nt=e.coefficient,Ut=e.prime1,Lt=e.prime2,jt=kt.redPow(e.exponent1).fromRed(),Kt=Bt.redPow(e.exponent2).fromRed(),qt=jt.isub(Kt).imul(Nt).umod(Ut).imul(Lt);return Kt.iadd(qt).imul(_t.unblinder).umod(e.modulus).toArrayLike(buffer$2.Buffer,"be",At)}crt$2.getr=getr;var browserifyRsa=crt$2,elliptic$1={};const name$2="elliptic",version="6.5.7",description$1="EC cryptography",main="lib/elliptic.js",files=["lib"],scripts={lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},repository={type:"git",url:"git@github.com:indutny/elliptic"},keywords=["EC","Elliptic","curve","Cryptography"],author="Fedor Indutny <fedor@indutny.com>",license="MIT",bugs={url:"https://github.com/indutny/elliptic/issues"},homepage="https://github.com/indutny/elliptic",devDependencies={brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},dependencies$1={"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"},require$$0$3={name:name$2,version,description:description$1,main,files,scripts,repository,keywords,author,license,bugs,homepage,devDependencies,dependencies:dependencies$1};var utils$t={},utils$s={};(function($t){var e=$t;function _t(kt,Bt){if(Array.isArray(kt))return kt.slice();if(!kt)return[];var Nt=[];if(typeof kt!="string"){for(var Ut=0;Ut<kt.length;Ut++)Nt[Ut]=kt[Ut]|0;return Nt}if(Bt==="hex"){kt=kt.replace(/[^a-z0-9]+/ig,""),kt.length%2!==0&&(kt="0"+kt);for(var Ut=0;Ut<kt.length;Ut+=2)Nt.push(parseInt(kt[Ut]+kt[Ut+1],16))}else for(var Ut=0;Ut<kt.length;Ut++){var Lt=kt.charCodeAt(Ut),jt=Lt>>8,Kt=Lt&255;jt?Nt.push(jt,Kt):Nt.push(Kt)}return Nt}e.toArray=_t;function At(kt){return kt.length===1?"0"+kt:kt}e.zero2=At;function xt(kt){for(var Bt="",Nt=0;Nt<kt.length;Nt++)Bt+=At(kt[Nt].toString(16));return Bt}e.toHex=xt,e.encode=function(Bt,Nt){return Nt==="hex"?xt(Bt):Bt}})(utils$s);(function($t){var e=$t,_t=bnExports$1,At=minimalisticAssert,xt=utils$s;e.assert=At,e.toArray=xt.toArray,e.zero2=xt.zero2,e.toHex=xt.toHex,e.encode=xt.encode;function kt(jt,Kt,qt){var zt=new Array(Math.max(jt.bitLength(),qt)+1),Vt;for(Vt=0;Vt<zt.length;Vt+=1)zt[Vt]=0;var Ht=1<<Kt+1,Wt=jt.clone();for(Vt=0;Vt<zt.length;Vt++){var Qt,Xt=Wt.andln(Ht-1);Wt.isOdd()?(Xt>(Ht>>1)-1?Qt=(Ht>>1)-Xt:Qt=Xt,Wt.isubn(Qt)):Qt=0,zt[Vt]=Qt,Wt.iushrn(1)}return zt}e.getNAF=kt;function Bt(jt,Kt){var qt=[[],[]];jt=jt.clone(),Kt=Kt.clone();for(var zt=0,Vt=0,Ht;jt.cmpn(-zt)>0||Kt.cmpn(-Vt)>0;){var Wt=jt.andln(3)+zt&3,Qt=Kt.andln(3)+Vt&3;Wt===3&&(Wt=-1),Qt===3&&(Qt=-1);var Xt;Wt&1?(Ht=jt.andln(7)+zt&7,(Ht===3||Ht===5)&&Qt===2?Xt=-Wt:Xt=Wt):Xt=0,qt[0].push(Xt);var Jt;Qt&1?(Ht=Kt.andln(7)+Vt&7,(Ht===3||Ht===5)&&Wt===2?Jt=-Qt:Jt=Qt):Jt=0,qt[1].push(Jt),2*zt===Xt+1&&(zt=1-zt),2*Vt===Jt+1&&(Vt=1-Vt),jt.iushrn(1),Kt.iushrn(1)}return qt}e.getJSF=Bt;function Nt(jt,Kt,qt){var zt="_"+Kt;jt.prototype[Kt]=function(){return this[zt]!==void 0?this[zt]:this[zt]=qt.call(this)}}e.cachedProperty=Nt;function Ut(jt){return typeof jt=="string"?e.toArray(jt,"hex"):jt}e.parseBytes=Ut;function Lt(jt){return new _t(jt,"hex","le")}e.intFromLE=Lt})(utils$t);var curve$1={},BN$9=bnExports$1,utils$r=utils$t,getNAF=utils$r.getNAF,getJSF=utils$r.getJSF,assert$h=utils$r.assert;function BaseCurve($t,e){this.type=$t,this.p=new BN$9(e.p,16),this.red=e.prime?BN$9.red(e.prime):BN$9.mont(this.p),this.zero=new BN$9(0).toRed(this.red),this.one=new BN$9(1).toRed(this.red),this.two=new BN$9(2).toRed(this.red),this.n=e.n&&new BN$9(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var _t=this.n&&this.p.div(this.n);!_t||_t.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var base$2=BaseCurve;BaseCurve.prototype.point=function(){throw new Error("Not implemented")};BaseCurve.prototype.validate=function(){throw new Error("Not implemented")};BaseCurve.prototype._fixedNafMul=function(e,_t){assert$h(e.precomputed);var At=e._getDoubles(),xt=getNAF(_t,1,this._bitLength),kt=(1<<At.step+1)-(At.step%2===0?2:1);kt/=3;var Bt=[],Nt,Ut;for(Nt=0;Nt<xt.length;Nt+=At.step){Ut=0;for(var Lt=Nt+At.step-1;Lt>=Nt;Lt--)Ut=(Ut<<1)+xt[Lt];Bt.push(Ut)}for(var jt=this.jpoint(null,null,null),Kt=this.jpoint(null,null,null),qt=kt;qt>0;qt--){for(Nt=0;Nt<Bt.length;Nt++)Ut=Bt[Nt],Ut===qt?Kt=Kt.mixedAdd(At.points[Nt]):Ut===-qt&&(Kt=Kt.mixedAdd(At.points[Nt].neg()));jt=jt.add(Kt)}return jt.toP()};BaseCurve.prototype._wnafMul=function(e,_t){var At=4,xt=e._getNAFPoints(At);At=xt.wnd;for(var kt=xt.points,Bt=getNAF(_t,At,this._bitLength),Nt=this.jpoint(null,null,null),Ut=Bt.length-1;Ut>=0;Ut--){for(var Lt=0;Ut>=0&&Bt[Ut]===0;Ut--)Lt++;if(Ut>=0&&Lt++,Nt=Nt.dblp(Lt),Ut<0)break;var jt=Bt[Ut];assert$h(jt!==0),e.type==="affine"?jt>0?Nt=Nt.mixedAdd(kt[jt-1>>1]):Nt=Nt.mixedAdd(kt[-jt-1>>1].neg()):jt>0?Nt=Nt.add(kt[jt-1>>1]):Nt=Nt.add(kt[-jt-1>>1].neg())}return e.type==="affine"?Nt.toP():Nt};BaseCurve.prototype._wnafMulAdd=function(e,_t,At,xt,kt){var Bt=this._wnafT1,Nt=this._wnafT2,Ut=this._wnafT3,Lt=0,jt,Kt,qt;for(jt=0;jt<xt;jt++){qt=_t[jt];var zt=qt._getNAFPoints(e);Bt[jt]=zt.wnd,Nt[jt]=zt.points}for(jt=xt-1;jt>=1;jt-=2){var Vt=jt-1,Ht=jt;if(Bt[Vt]!==1||Bt[Ht]!==1){Ut[Vt]=getNAF(At[Vt],Bt[Vt],this._bitLength),Ut[Ht]=getNAF(At[Ht],Bt[Ht],this._bitLength),Lt=Math.max(Ut[Vt].length,Lt),Lt=Math.max(Ut[Ht].length,Lt);continue}var Wt=[_t[Vt],null,null,_t[Ht]];_t[Vt].y.cmp(_t[Ht].y)===0?(Wt[1]=_t[Vt].add(_t[Ht]),Wt[2]=_t[Vt].toJ().mixedAdd(_t[Ht].neg())):_t[Vt].y.cmp(_t[Ht].y.redNeg())===0?(Wt[1]=_t[Vt].toJ().mixedAdd(_t[Ht]),Wt[2]=_t[Vt].add(_t[Ht].neg())):(Wt[1]=_t[Vt].toJ().mixedAdd(_t[Ht]),Wt[2]=_t[Vt].toJ().mixedAdd(_t[Ht].neg()));var Qt=[-3,-1,-5,-7,0,7,5,1,3],Xt=getJSF(At[Vt],At[Ht]);for(Lt=Math.max(Xt[0].length,Lt),Ut[Vt]=new Array(Lt),Ut[Ht]=new Array(Lt),Kt=0;Kt<Lt;Kt++){var Jt=Xt[0][Kt]|0,tr=Xt[1][Kt]|0;Ut[Vt][Kt]=Qt[(Jt+1)*3+(tr+1)],Ut[Ht][Kt]=0,Nt[Vt]=Wt}}var dr=this.jpoint(null,null,null),vr=this._wnafT4;for(jt=Lt;jt>=0;jt--){for(var $r=0;jt>=0;){var Ir=!0;for(Kt=0;Kt<xt;Kt++)vr[Kt]=Ut[Kt][jt]|0,vr[Kt]!==0&&(Ir=!1);if(!Ir)break;$r++,jt--}if(jt>=0&&$r++,dr=dr.dblp($r),jt<0)break;for(Kt=0;Kt<xt;Kt++){var Rr=vr[Kt];Rr!==0&&(Rr>0?qt=Nt[Kt][Rr-1>>1]:Rr<0&&(qt=Nt[Kt][-Rr-1>>1].neg()),qt.type==="affine"?dr=dr.mixedAdd(qt):dr=dr.add(qt))}}for(jt=0;jt<xt;jt++)Nt[jt]=null;return kt?dr:dr.toP()};function BasePoint($t,e){this.curve=$t,this.type=e,this.precomputed=null}BaseCurve.BasePoint=BasePoint;BasePoint.prototype.eq=function(){throw new Error("Not implemented")};BasePoint.prototype.validate=function(){return this.curve.validate(this)};BaseCurve.prototype.decodePoint=function(e,_t){e=utils$r.toArray(e,_t);var At=this.p.byteLength();if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1===2*At){e[0]===6?assert$h(e[e.length-1]%2===0):e[0]===7&&assert$h(e[e.length-1]%2===1);var xt=this.point(e.slice(1,1+At),e.slice(1+At,1+2*At));return xt}else if((e[0]===2||e[0]===3)&&e.length-1===At)return this.pointFromX(e.slice(1,1+At),e[0]===3);throw new Error("Unknown point format")};BasePoint.prototype.encodeCompressed=function(e){return this.encode(e,!0)};BasePoint.prototype._encode=function(e){var _t=this.curve.p.byteLength(),At=this.getX().toArray("be",_t);return e?[this.getY().isEven()?2:3].concat(At):[4].concat(At,this.getY().toArray("be",_t))};BasePoint.prototype.encode=function(e,_t){return utils$r.encode(this._encode(_t),e)};BasePoint.prototype.precompute=function(e){if(this.precomputed)return this;var _t={doubles:null,naf:null,beta:null};return _t.naf=this._getNAFPoints(8),_t.doubles=this._getDoubles(4,e),_t.beta=this._getBeta(),this.precomputed=_t,this};BasePoint.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var _t=this.precomputed.doubles;return _t?_t.points.length>=Math.ceil((e.bitLength()+1)/_t.step):!1};BasePoint.prototype._getDoubles=function(e,_t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var At=[this],xt=this,kt=0;kt<_t;kt+=e){for(var Bt=0;Bt<e;Bt++)xt=xt.dbl();At.push(xt)}return{step:e,points:At}};BasePoint.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var _t=[this],At=(1<<e)-1,xt=At===1?null:this.dbl(),kt=1;kt<At;kt++)_t[kt]=_t[kt-1].add(xt);return{wnd:e,points:_t}};BasePoint.prototype._getBeta=function(){return null};BasePoint.prototype.dblp=function(e){for(var _t=this,At=0;At<e;At++)_t=_t.dbl();return _t};var utils$q=utils$t,BN$8=bnExports$1,inherits$4=inherits_browserExports,Base$2=base$2,assert$g=utils$q.assert;function ShortCurve($t){Base$2.call(this,"short",$t),this.a=new BN$8($t.a,16).toRed(this.red),this.b=new BN$8($t.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism($t),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}inherits$4(ShortCurve,Base$2);var short=ShortCurve;ShortCurve.prototype._getEndomorphism=function(e){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var _t,At;if(e.beta)_t=new BN$8(e.beta,16).toRed(this.red);else{var xt=this._getEndoRoots(this.p);_t=xt[0].cmp(xt[1])<0?xt[0]:xt[1],_t=_t.toRed(this.red)}if(e.lambda)At=new BN$8(e.lambda,16);else{var kt=this._getEndoRoots(this.n);this.g.mul(kt[0]).x.cmp(this.g.x.redMul(_t))===0?At=kt[0]:(At=kt[1],assert$g(this.g.mul(At).x.cmp(this.g.x.redMul(_t))===0))}var Bt;return e.basis?Bt=e.basis.map(function(Nt){return{a:new BN$8(Nt.a,16),b:new BN$8(Nt.b,16)}}):Bt=this._getEndoBasis(At),{beta:_t,lambda:At,basis:Bt}}};ShortCurve.prototype._getEndoRoots=function(e){var _t=e===this.p?this.red:BN$8.mont(e),At=new BN$8(2).toRed(_t).redInvm(),xt=At.redNeg(),kt=new BN$8(3).toRed(_t).redNeg().redSqrt().redMul(At),Bt=xt.redAdd(kt).fromRed(),Nt=xt.redSub(kt).fromRed();return[Bt,Nt]};ShortCurve.prototype._getEndoBasis=function(e){for(var _t=this.n.ushrn(Math.floor(this.n.bitLength()/2)),At=e,xt=this.n.clone(),kt=new BN$8(1),Bt=new BN$8(0),Nt=new BN$8(0),Ut=new BN$8(1),Lt,jt,Kt,qt,zt,Vt,Ht,Wt=0,Qt,Xt;At.cmpn(0)!==0;){var Jt=xt.div(At);Qt=xt.sub(Jt.mul(At)),Xt=Nt.sub(Jt.mul(kt));var tr=Ut.sub(Jt.mul(Bt));if(!Kt&&Qt.cmp(_t)<0)Lt=Ht.neg(),jt=kt,Kt=Qt.neg(),qt=Xt;else if(Kt&&++Wt===2)break;Ht=Qt,xt=At,At=Qt,Nt=kt,kt=Xt,Ut=Bt,Bt=tr}zt=Qt.neg(),Vt=Xt;var dr=Kt.sqr().add(qt.sqr()),vr=zt.sqr().add(Vt.sqr());return vr.cmp(dr)>=0&&(zt=Lt,Vt=jt),Kt.negative&&(Kt=Kt.neg(),qt=qt.neg()),zt.negative&&(zt=zt.neg(),Vt=Vt.neg()),[{a:Kt,b:qt},{a:zt,b:Vt}]};ShortCurve.prototype._endoSplit=function(e){var _t=this.endo.basis,At=_t[0],xt=_t[1],kt=xt.b.mul(e).divRound(this.n),Bt=At.b.neg().mul(e).divRound(this.n),Nt=kt.mul(At.a),Ut=Bt.mul(xt.a),Lt=kt.mul(At.b),jt=Bt.mul(xt.b),Kt=e.sub(Nt).sub(Ut),qt=Lt.add(jt).neg();return{k1:Kt,k2:qt}};ShortCurve.prototype.pointFromX=function(e,_t){e=new BN$8(e,16),e.red||(e=e.toRed(this.red));var At=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),xt=At.redSqrt();if(xt.redSqr().redSub(At).cmp(this.zero)!==0)throw new Error("invalid point");var kt=xt.fromRed().isOdd();return(_t&&!kt||!_t&&kt)&&(xt=xt.redNeg()),this.point(e,xt)};ShortCurve.prototype.validate=function(e){if(e.inf)return!0;var _t=e.x,At=e.y,xt=this.a.redMul(_t),kt=_t.redSqr().redMul(_t).redIAdd(xt).redIAdd(this.b);return At.redSqr().redISub(kt).cmpn(0)===0};ShortCurve.prototype._endoWnafMulAdd=function(e,_t,At){for(var xt=this._endoWnafT1,kt=this._endoWnafT2,Bt=0;Bt<e.length;Bt++){var Nt=this._endoSplit(_t[Bt]),Ut=e[Bt],Lt=Ut._getBeta();Nt.k1.negative&&(Nt.k1.ineg(),Ut=Ut.neg(!0)),Nt.k2.negative&&(Nt.k2.ineg(),Lt=Lt.neg(!0)),xt[Bt*2]=Ut,xt[Bt*2+1]=Lt,kt[Bt*2]=Nt.k1,kt[Bt*2+1]=Nt.k2}for(var jt=this._wnafMulAdd(1,xt,kt,Bt*2,At),Kt=0;Kt<Bt*2;Kt++)xt[Kt]=null,kt[Kt]=null;return jt};function Point$2($t,e,_t,At){Base$2.BasePoint.call(this,$t,"affine"),e===null&&_t===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new BN$8(e,16),this.y=new BN$8(_t,16),At&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}inherits$4(Point$2,Base$2.BasePoint);ShortCurve.prototype.point=function(e,_t,At){return new Point$2(this,e,_t,At)};ShortCurve.prototype.pointFromJSON=function(e,_t){return Point$2.fromJSON(this,e,_t)};Point$2.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var _t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var At=this.curve,xt=function(kt){return At.point(kt.x.redMul(At.endo.beta),kt.y)};e.beta=_t,_t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(xt)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(xt)}}}return _t}};Point$2.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};Point$2.fromJSON=function(e,_t,At){typeof _t=="string"&&(_t=JSON.parse(_t));var xt=e.point(_t[0],_t[1],At);if(!_t[2])return xt;function kt(Nt){return e.point(Nt[0],Nt[1],At)}var Bt=_t[2];return xt.precomputed={beta:null,doubles:Bt.doubles&&{step:Bt.doubles.step,points:[xt].concat(Bt.doubles.points.map(kt))},naf:Bt.naf&&{wnd:Bt.naf.wnd,points:[xt].concat(Bt.naf.points.map(kt))}},xt};Point$2.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Point$2.prototype.isInfinity=function(){return this.inf};Point$2.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(this.x.cmp(e.x)===0)return this.curve.point(null,null);var _t=this.y.redSub(e.y);_t.cmpn(0)!==0&&(_t=_t.redMul(this.x.redSub(e.x).redInvm()));var At=_t.redSqr().redISub(this.x).redISub(e.x),xt=_t.redMul(this.x.redSub(At)).redISub(this.y);return this.curve.point(At,xt)};Point$2.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(e.cmpn(0)===0)return this.curve.point(null,null);var _t=this.curve.a,At=this.x.redSqr(),xt=e.redInvm(),kt=At.redAdd(At).redIAdd(At).redIAdd(_t).redMul(xt),Bt=kt.redSqr().redISub(this.x.redAdd(this.x)),Nt=kt.redMul(this.x.redSub(Bt)).redISub(this.y);return this.curve.point(Bt,Nt)};Point$2.prototype.getX=function(){return this.x.fromRed()};Point$2.prototype.getY=function(){return this.y.fromRed()};Point$2.prototype.mul=function(e){return e=new BN$8(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)};Point$2.prototype.mulAdd=function(e,_t,At){var xt=[this,_t],kt=[e,At];return this.curve.endo?this.curve._endoWnafMulAdd(xt,kt):this.curve._wnafMulAdd(1,xt,kt,2)};Point$2.prototype.jmulAdd=function(e,_t,At){var xt=[this,_t],kt=[e,At];return this.curve.endo?this.curve._endoWnafMulAdd(xt,kt,!0):this.curve._wnafMulAdd(1,xt,kt,2,!0)};Point$2.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||this.x.cmp(e.x)===0&&this.y.cmp(e.y)===0)};Point$2.prototype.neg=function(e){if(this.inf)return this;var _t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var At=this.precomputed,xt=function(kt){return kt.neg()};_t.precomputed={naf:At.naf&&{wnd:At.naf.wnd,points:At.naf.points.map(xt)},doubles:At.doubles&&{step:At.doubles.step,points:At.doubles.points.map(xt)}}}return _t};Point$2.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var e=this.curve.jpoint(this.x,this.y,this.curve.one);return e};function JPoint($t,e,_t,At){Base$2.BasePoint.call(this,$t,"jacobian"),e===null&&_t===null&&At===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new BN$8(0)):(this.x=new BN$8(e,16),this.y=new BN$8(_t,16),this.z=new BN$8(At,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}inherits$4(JPoint,Base$2.BasePoint);ShortCurve.prototype.jpoint=function(e,_t,At){return new JPoint(this,e,_t,At)};JPoint.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),_t=e.redSqr(),At=this.x.redMul(_t),xt=this.y.redMul(_t).redMul(e);return this.curve.point(At,xt)};JPoint.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};JPoint.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var _t=e.z.redSqr(),At=this.z.redSqr(),xt=this.x.redMul(_t),kt=e.x.redMul(At),Bt=this.y.redMul(_t.redMul(e.z)),Nt=e.y.redMul(At.redMul(this.z)),Ut=xt.redSub(kt),Lt=Bt.redSub(Nt);if(Ut.cmpn(0)===0)return Lt.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var jt=Ut.redSqr(),Kt=jt.redMul(Ut),qt=xt.redMul(jt),zt=Lt.redSqr().redIAdd(Kt).redISub(qt).redISub(qt),Vt=Lt.redMul(qt.redISub(zt)).redISub(Bt.redMul(Kt)),Ht=this.z.redMul(e.z).redMul(Ut);return this.curve.jpoint(zt,Vt,Ht)};JPoint.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var _t=this.z.redSqr(),At=this.x,xt=e.x.redMul(_t),kt=this.y,Bt=e.y.redMul(_t).redMul(this.z),Nt=At.redSub(xt),Ut=kt.redSub(Bt);if(Nt.cmpn(0)===0)return Ut.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var Lt=Nt.redSqr(),jt=Lt.redMul(Nt),Kt=At.redMul(Lt),qt=Ut.redSqr().redIAdd(jt).redISub(Kt).redISub(Kt),zt=Ut.redMul(Kt.redISub(qt)).redISub(kt.redMul(jt)),Vt=this.z.redMul(Nt);return this.curve.jpoint(qt,zt,Vt)};JPoint.prototype.dblp=function(e){if(e===0)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var _t;if(this.curve.zeroA||this.curve.threeA){var At=this;for(_t=0;_t<e;_t++)At=At.dbl();return At}var xt=this.curve.a,kt=this.curve.tinv,Bt=this.x,Nt=this.y,Ut=this.z,Lt=Ut.redSqr().redSqr(),jt=Nt.redAdd(Nt);for(_t=0;_t<e;_t++){var Kt=Bt.redSqr(),qt=jt.redSqr(),zt=qt.redSqr(),Vt=Kt.redAdd(Kt).redIAdd(Kt).redIAdd(xt.redMul(Lt)),Ht=Bt.redMul(qt),Wt=Vt.redSqr().redISub(Ht.redAdd(Ht)),Qt=Ht.redISub(Wt),Xt=Vt.redMul(Qt);Xt=Xt.redIAdd(Xt).redISub(zt);var Jt=jt.redMul(Ut);_t+1<e&&(Lt=Lt.redMul(zt)),Bt=Wt,Ut=Jt,jt=Xt}return this.curve.jpoint(Bt,jt.redMul(kt),Ut)};JPoint.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};JPoint.prototype._zeroDbl=function(){var e,_t,At;if(this.zOne){var xt=this.x.redSqr(),kt=this.y.redSqr(),Bt=kt.redSqr(),Nt=this.x.redAdd(kt).redSqr().redISub(xt).redISub(Bt);Nt=Nt.redIAdd(Nt);var Ut=xt.redAdd(xt).redIAdd(xt),Lt=Ut.redSqr().redISub(Nt).redISub(Nt),jt=Bt.redIAdd(Bt);jt=jt.redIAdd(jt),jt=jt.redIAdd(jt),e=Lt,_t=Ut.redMul(Nt.redISub(Lt)).redISub(jt),At=this.y.redAdd(this.y)}else{var Kt=this.x.redSqr(),qt=this.y.redSqr(),zt=qt.redSqr(),Vt=this.x.redAdd(qt).redSqr().redISub(Kt).redISub(zt);Vt=Vt.redIAdd(Vt);var Ht=Kt.redAdd(Kt).redIAdd(Kt),Wt=Ht.redSqr(),Qt=zt.redIAdd(zt);Qt=Qt.redIAdd(Qt),Qt=Qt.redIAdd(Qt),e=Wt.redISub(Vt).redISub(Vt),_t=Ht.redMul(Vt.redISub(e)).redISub(Qt),At=this.y.redMul(this.z),At=At.redIAdd(At)}return this.curve.jpoint(e,_t,At)};JPoint.prototype._threeDbl=function(){var e,_t,At;if(this.zOne){var xt=this.x.redSqr(),kt=this.y.redSqr(),Bt=kt.redSqr(),Nt=this.x.redAdd(kt).redSqr().redISub(xt).redISub(Bt);Nt=Nt.redIAdd(Nt);var Ut=xt.redAdd(xt).redIAdd(xt).redIAdd(this.curve.a),Lt=Ut.redSqr().redISub(Nt).redISub(Nt);e=Lt;var jt=Bt.redIAdd(Bt);jt=jt.redIAdd(jt),jt=jt.redIAdd(jt),_t=Ut.redMul(Nt.redISub(Lt)).redISub(jt),At=this.y.redAdd(this.y)}else{var Kt=this.z.redSqr(),qt=this.y.redSqr(),zt=this.x.redMul(qt),Vt=this.x.redSub(Kt).redMul(this.x.redAdd(Kt));Vt=Vt.redAdd(Vt).redIAdd(Vt);var Ht=zt.redIAdd(zt);Ht=Ht.redIAdd(Ht);var Wt=Ht.redAdd(Ht);e=Vt.redSqr().redISub(Wt),At=this.y.redAdd(this.z).redSqr().redISub(qt).redISub(Kt);var Qt=qt.redSqr();Qt=Qt.redIAdd(Qt),Qt=Qt.redIAdd(Qt),Qt=Qt.redIAdd(Qt),_t=Vt.redMul(Ht.redISub(e)).redISub(Qt)}return this.curve.jpoint(e,_t,At)};JPoint.prototype._dbl=function(){var e=this.curve.a,_t=this.x,At=this.y,xt=this.z,kt=xt.redSqr().redSqr(),Bt=_t.redSqr(),Nt=At.redSqr(),Ut=Bt.redAdd(Bt).redIAdd(Bt).redIAdd(e.redMul(kt)),Lt=_t.redAdd(_t);Lt=Lt.redIAdd(Lt);var jt=Lt.redMul(Nt),Kt=Ut.redSqr().redISub(jt.redAdd(jt)),qt=jt.redISub(Kt),zt=Nt.redSqr();zt=zt.redIAdd(zt),zt=zt.redIAdd(zt),zt=zt.redIAdd(zt);var Vt=Ut.redMul(qt).redISub(zt),Ht=At.redAdd(At).redMul(xt);return this.curve.jpoint(Kt,Vt,Ht)};JPoint.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),_t=this.y.redSqr(),At=this.z.redSqr(),xt=_t.redSqr(),kt=e.redAdd(e).redIAdd(e),Bt=kt.redSqr(),Nt=this.x.redAdd(_t).redSqr().redISub(e).redISub(xt);Nt=Nt.redIAdd(Nt),Nt=Nt.redAdd(Nt).redIAdd(Nt),Nt=Nt.redISub(Bt);var Ut=Nt.redSqr(),Lt=xt.redIAdd(xt);Lt=Lt.redIAdd(Lt),Lt=Lt.redIAdd(Lt),Lt=Lt.redIAdd(Lt);var jt=kt.redIAdd(Nt).redSqr().redISub(Bt).redISub(Ut).redISub(Lt),Kt=_t.redMul(jt);Kt=Kt.redIAdd(Kt),Kt=Kt.redIAdd(Kt);var qt=this.x.redMul(Ut).redISub(Kt);qt=qt.redIAdd(qt),qt=qt.redIAdd(qt);var zt=this.y.redMul(jt.redMul(Lt.redISub(jt)).redISub(Nt.redMul(Ut)));zt=zt.redIAdd(zt),zt=zt.redIAdd(zt),zt=zt.redIAdd(zt);var Vt=this.z.redAdd(Nt).redSqr().redISub(At).redISub(Ut);return this.curve.jpoint(qt,zt,Vt)};JPoint.prototype.mul=function(e,_t){return e=new BN$8(e,_t),this.curve._wnafMul(this,e)};JPoint.prototype.eq=function(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e)return!0;var _t=this.z.redSqr(),At=e.z.redSqr();if(this.x.redMul(At).redISub(e.x.redMul(_t)).cmpn(0)!==0)return!1;var xt=_t.redMul(this.z),kt=At.redMul(e.z);return this.y.redMul(kt).redISub(e.y.redMul(xt)).cmpn(0)===0};JPoint.prototype.eqXToP=function(e){var _t=this.z.redSqr(),At=e.toRed(this.curve.red).redMul(_t);if(this.x.cmp(At)===0)return!0;for(var xt=e.clone(),kt=this.curve.redN.redMul(_t);;){if(xt.iadd(this.curve.n),xt.cmp(this.curve.p)>=0)return!1;if(At.redIAdd(kt),this.x.cmp(At)===0)return!0}};JPoint.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};JPoint.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var BN$7=bnExports$1,inherits$3=inherits_browserExports,Base$1=base$2,utils$p=utils$t;function MontCurve($t){Base$1.call(this,"mont",$t),this.a=new BN$7($t.a,16).toRed(this.red),this.b=new BN$7($t.b,16).toRed(this.red),this.i4=new BN$7(4).toRed(this.red).redInvm(),this.two=new BN$7(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}inherits$3(MontCurve,Base$1);var mont=MontCurve;MontCurve.prototype.validate=function(e){var _t=e.normalize().x,At=_t.redSqr(),xt=At.redMul(_t).redAdd(At.redMul(this.a)).redAdd(_t),kt=xt.redSqrt();return kt.redSqr().cmp(xt)===0};function Point$1($t,e,_t){Base$1.BasePoint.call(this,$t,"projective"),e===null&&_t===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new BN$7(e,16),this.z=new BN$7(_t,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}inherits$3(Point$1,Base$1.BasePoint);MontCurve.prototype.decodePoint=function(e,_t){return this.point(utils$p.toArray(e,_t),1)};MontCurve.prototype.point=function(e,_t){return new Point$1(this,e,_t)};MontCurve.prototype.pointFromJSON=function(e){return Point$1.fromJSON(this,e)};Point$1.prototype.precompute=function(){};Point$1.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())};Point$1.fromJSON=function(e,_t){return new Point$1(e,_t[0],_t[1]||e.one)};Point$1.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point$1.prototype.isInfinity=function(){return this.z.cmpn(0)===0};Point$1.prototype.dbl=function(){var e=this.x.redAdd(this.z),_t=e.redSqr(),At=this.x.redSub(this.z),xt=At.redSqr(),kt=_t.redSub(xt),Bt=_t.redMul(xt),Nt=kt.redMul(xt.redAdd(this.curve.a24.redMul(kt)));return this.curve.point(Bt,Nt)};Point$1.prototype.add=function(){throw new Error("Not supported on Montgomery curve")};Point$1.prototype.diffAdd=function(e,_t){var At=this.x.redAdd(this.z),xt=this.x.redSub(this.z),kt=e.x.redAdd(e.z),Bt=e.x.redSub(e.z),Nt=Bt.redMul(At),Ut=kt.redMul(xt),Lt=_t.z.redMul(Nt.redAdd(Ut).redSqr()),jt=_t.x.redMul(Nt.redISub(Ut).redSqr());return this.curve.point(Lt,jt)};Point$1.prototype.mul=function(e){for(var _t=e.clone(),At=this,xt=this.curve.point(null,null),kt=this,Bt=[];_t.cmpn(0)!==0;_t.iushrn(1))Bt.push(_t.andln(1));for(var Nt=Bt.length-1;Nt>=0;Nt--)Bt[Nt]===0?(At=At.diffAdd(xt,kt),xt=xt.dbl()):(xt=At.diffAdd(xt,kt),At=At.dbl());return xt};Point$1.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")};Point$1.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")};Point$1.prototype.eq=function(e){return this.getX().cmp(e.getX())===0};Point$1.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this};Point$1.prototype.getX=function(){return this.normalize(),this.x.fromRed()};var utils$o=utils$t,BN$6=bnExports$1,inherits$2=inherits_browserExports,Base=base$2,assert$f=utils$o.assert;function EdwardsCurve($t){this.twisted=($t.a|0)!==1,this.mOneA=this.twisted&&($t.a|0)===-1,this.extended=this.mOneA,Base.call(this,"edwards",$t),this.a=new BN$6($t.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new BN$6($t.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new BN$6($t.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),assert$f(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=($t.c|0)===1}inherits$2(EdwardsCurve,Base);var edwards$1=EdwardsCurve;EdwardsCurve.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)};EdwardsCurve.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)};EdwardsCurve.prototype.jpoint=function(e,_t,At,xt){return this.point(e,_t,At,xt)};EdwardsCurve.prototype.pointFromX=function(e,_t){e=new BN$6(e,16),e.red||(e=e.toRed(this.red));var At=e.redSqr(),xt=this.c2.redSub(this.a.redMul(At)),kt=this.one.redSub(this.c2.redMul(this.d).redMul(At)),Bt=xt.redMul(kt.redInvm()),Nt=Bt.redSqrt();if(Nt.redSqr().redSub(Bt).cmp(this.zero)!==0)throw new Error("invalid point");var Ut=Nt.fromRed().isOdd();return(_t&&!Ut||!_t&&Ut)&&(Nt=Nt.redNeg()),this.point(e,Nt)};EdwardsCurve.prototype.pointFromY=function(e,_t){e=new BN$6(e,16),e.red||(e=e.toRed(this.red));var At=e.redSqr(),xt=At.redSub(this.c2),kt=At.redMul(this.d).redMul(this.c2).redSub(this.a),Bt=xt.redMul(kt.redInvm());if(Bt.cmp(this.zero)===0){if(_t)throw new Error("invalid point");return this.point(this.zero,e)}var Nt=Bt.redSqrt();if(Nt.redSqr().redSub(Bt).cmp(this.zero)!==0)throw new Error("invalid point");return Nt.fromRed().isOdd()!==_t&&(Nt=Nt.redNeg()),this.point(Nt,e)};EdwardsCurve.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var _t=e.x.redSqr(),At=e.y.redSqr(),xt=_t.redMul(this.a).redAdd(At),kt=this.c2.redMul(this.one.redAdd(this.d.redMul(_t).redMul(At)));return xt.cmp(kt)===0};function Point($t,e,_t,At,xt){Base.BasePoint.call(this,$t,"projective"),e===null&&_t===null&&At===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new BN$6(e,16),this.y=new BN$6(_t,16),this.z=At?new BN$6(At,16):this.curve.one,this.t=xt&&new BN$6(xt,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}inherits$2(Point,Base.BasePoint);EdwardsCurve.prototype.pointFromJSON=function(e){return Point.fromJSON(this,e)};EdwardsCurve.prototype.point=function(e,_t,At,xt){return new Point(this,e,_t,At,xt)};Point.fromJSON=function(e,_t){return new Point(e,_t[0],_t[1],_t[2])};Point.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)};Point.prototype._extDbl=function(){var e=this.x.redSqr(),_t=this.y.redSqr(),At=this.z.redSqr();At=At.redIAdd(At);var xt=this.curve._mulA(e),kt=this.x.redAdd(this.y).redSqr().redISub(e).redISub(_t),Bt=xt.redAdd(_t),Nt=Bt.redSub(At),Ut=xt.redSub(_t),Lt=kt.redMul(Nt),jt=Bt.redMul(Ut),Kt=kt.redMul(Ut),qt=Nt.redMul(Bt);return this.curve.point(Lt,jt,qt,Kt)};Point.prototype._projDbl=function(){var e=this.x.redAdd(this.y).redSqr(),_t=this.x.redSqr(),At=this.y.redSqr(),xt,kt,Bt,Nt,Ut,Lt;if(this.curve.twisted){Nt=this.curve._mulA(_t);var jt=Nt.redAdd(At);this.zOne?(xt=e.redSub(_t).redSub(At).redMul(jt.redSub(this.curve.two)),kt=jt.redMul(Nt.redSub(At)),Bt=jt.redSqr().redSub(jt).redSub(jt)):(Ut=this.z.redSqr(),Lt=jt.redSub(Ut).redISub(Ut),xt=e.redSub(_t).redISub(At).redMul(Lt),kt=jt.redMul(Nt.redSub(At)),Bt=jt.redMul(Lt))}else Nt=_t.redAdd(At),Ut=this.curve._mulC(this.z).redSqr(),Lt=Nt.redSub(Ut).redSub(Ut),xt=this.curve._mulC(e.redISub(Nt)).redMul(Lt),kt=this.curve._mulC(Nt).redMul(_t.redISub(At)),Bt=Nt.redMul(Lt);return this.curve.point(xt,kt,Bt)};Point.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()};Point.prototype._extAdd=function(e){var _t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),At=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),xt=this.t.redMul(this.curve.dd).redMul(e.t),kt=this.z.redMul(e.z.redAdd(e.z)),Bt=At.redSub(_t),Nt=kt.redSub(xt),Ut=kt.redAdd(xt),Lt=At.redAdd(_t),jt=Bt.redMul(Nt),Kt=Ut.redMul(Lt),qt=Bt.redMul(Lt),zt=Nt.redMul(Ut);return this.curve.point(jt,Kt,zt,qt)};Point.prototype._projAdd=function(e){var _t=this.z.redMul(e.z),At=_t.redSqr(),xt=this.x.redMul(e.x),kt=this.y.redMul(e.y),Bt=this.curve.d.redMul(xt).redMul(kt),Nt=At.redSub(Bt),Ut=At.redAdd(Bt),Lt=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(xt).redISub(kt),jt=_t.redMul(Nt).redMul(Lt),Kt,qt;return this.curve.twisted?(Kt=_t.redMul(Ut).redMul(kt.redSub(this.curve._mulA(xt))),qt=Nt.redMul(Ut)):(Kt=_t.redMul(Ut).redMul(kt.redSub(xt)),qt=this.curve._mulC(Nt).redMul(Ut)),this.curve.point(jt,Kt,qt)};Point.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)};Point.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)};Point.prototype.mulAdd=function(e,_t,At){return this.curve._wnafMulAdd(1,[this,_t],[e,At],2,!1)};Point.prototype.jmulAdd=function(e,_t,At){return this.curve._wnafMulAdd(1,[this,_t],[e,At],2,!0)};Point.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this};Point.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())};Point.prototype.getX=function(){return this.normalize(),this.x.fromRed()};Point.prototype.getY=function(){return this.normalize(),this.y.fromRed()};Point.prototype.eq=function(e){return this===e||this.getX().cmp(e.getX())===0&&this.getY().cmp(e.getY())===0};Point.prototype.eqXToP=function(e){var _t=e.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(_t)===0)return!0;for(var At=e.clone(),xt=this.curve.redN.redMul(this.z);;){if(At.iadd(this.curve.n),At.cmp(this.curve.p)>=0)return!1;if(_t.redIAdd(xt),this.x.cmp(_t)===0)return!0}};Point.prototype.toP=Point.prototype.normalize;Point.prototype.mixedAdd=Point.prototype.add;(function($t){var e=$t;e.base=base$2,e.short=short,e.mont=mont,e.edwards=edwards$1})(curve$1);var curves$1={},hash$5={},utils$n={},assert$e=minimalisticAssert,inherits$1=inherits_browserExports;utils$n.inherits=inherits$1;function isSurrogatePair($t,e){return($t.charCodeAt(e)&64512)!==55296||e<0||e+1>=$t.length?!1:($t.charCodeAt(e+1)&64512)===56320}function toArray$2($t,e){if(Array.isArray($t))return $t.slice();if(!$t)return[];var _t=[];if(typeof $t=="string")if(e){if(e==="hex")for($t=$t.replace(/[^a-z0-9]+/ig,""),$t.length%2!==0&&($t="0"+$t),xt=0;xt<$t.length;xt+=2)_t.push(parseInt($t[xt]+$t[xt+1],16))}else for(var At=0,xt=0;xt<$t.length;xt++){var kt=$t.charCodeAt(xt);kt<128?_t[At++]=kt:kt<2048?(_t[At++]=kt>>6|192,_t[At++]=kt&63|128):isSurrogatePair($t,xt)?(kt=65536+((kt&1023)<<10)+($t.charCodeAt(++xt)&1023),_t[At++]=kt>>18|240,_t[At++]=kt>>12&63|128,_t[At++]=kt>>6&63|128,_t[At++]=kt&63|128):(_t[At++]=kt>>12|224,_t[At++]=kt>>6&63|128,_t[At++]=kt&63|128)}else for(xt=0;xt<$t.length;xt++)_t[xt]=$t[xt]|0;return _t}utils$n.toArray=toArray$2;function toHex$1($t){for(var e="",_t=0;_t<$t.length;_t++)e+=zero2($t[_t].toString(16));return e}utils$n.toHex=toHex$1;function htonl($t){var e=$t>>>24|$t>>>8&65280|$t<<8&16711680|($t&255)<<24;return e>>>0}utils$n.htonl=htonl;function toHex32($t,e){for(var _t="",At=0;At<$t.length;At++){var xt=$t[At];e==="little"&&(xt=htonl(xt)),_t+=zero8(xt.toString(16))}return _t}utils$n.toHex32=toHex32;function zero2($t){return $t.length===1?"0"+$t:$t}utils$n.zero2=zero2;function zero8($t){return $t.length===7?"0"+$t:$t.length===6?"00"+$t:$t.length===5?"000"+$t:$t.length===4?"0000"+$t:$t.length===3?"00000"+$t:$t.length===2?"000000"+$t:$t.length===1?"0000000"+$t:$t}utils$n.zero8=zero8;function join32($t,e,_t,At){var xt=_t-e;assert$e(xt%4===0);for(var kt=new Array(xt/4),Bt=0,Nt=e;Bt<kt.length;Bt++,Nt+=4){var Ut;At==="big"?Ut=$t[Nt]<<24|$t[Nt+1]<<16|$t[Nt+2]<<8|$t[Nt+3]:Ut=$t[Nt+3]<<24|$t[Nt+2]<<16|$t[Nt+1]<<8|$t[Nt],kt[Bt]=Ut>>>0}return kt}utils$n.join32=join32;function split32($t,e){for(var _t=new Array($t.length*4),At=0,xt=0;At<$t.length;At++,xt+=4){var kt=$t[At];e==="big"?(_t[xt]=kt>>>24,_t[xt+1]=kt>>>16&255,_t[xt+2]=kt>>>8&255,_t[xt+3]=kt&255):(_t[xt+3]=kt>>>24,_t[xt+2]=kt>>>16&255,_t[xt+1]=kt>>>8&255,_t[xt]=kt&255)}return _t}utils$n.split32=split32;function rotr32$1($t,e){return $t>>>e|$t<<32-e}utils$n.rotr32=rotr32$1;function rotl32$2($t,e){return $t<<e|$t>>>32-e}utils$n.rotl32=rotl32$2;function sum32$3($t,e){return $t+e>>>0}utils$n.sum32=sum32$3;function sum32_3$1($t,e,_t){return $t+e+_t>>>0}utils$n.sum32_3=sum32_3$1;function sum32_4$2($t,e,_t,At){return $t+e+_t+At>>>0}utils$n.sum32_4=sum32_4$2;function sum32_5$2($t,e,_t,At,xt){return $t+e+_t+At+xt>>>0}utils$n.sum32_5=sum32_5$2;function sum64$1($t,e,_t,At){var xt=$t[e],kt=$t[e+1],Bt=At+kt>>>0,Nt=(Bt<At?1:0)+_t+xt;$t[e]=Nt>>>0,$t[e+1]=Bt}utils$n.sum64=sum64$1;function sum64_hi$1($t,e,_t,At){var xt=e+At>>>0,kt=(xt<e?1:0)+$t+_t;return kt>>>0}utils$n.sum64_hi=sum64_hi$1;function sum64_lo$1($t,e,_t,At){var xt=e+At;return xt>>>0}utils$n.sum64_lo=sum64_lo$1;function sum64_4_hi$1($t,e,_t,At,xt,kt,Bt,Nt){var Ut=0,Lt=e;Lt=Lt+At>>>0,Ut+=Lt<e?1:0,Lt=Lt+kt>>>0,Ut+=Lt<kt?1:0,Lt=Lt+Nt>>>0,Ut+=Lt<Nt?1:0;var jt=$t+_t+xt+Bt+Ut;return jt>>>0}utils$n.sum64_4_hi=sum64_4_hi$1;function sum64_4_lo$1($t,e,_t,At,xt,kt,Bt,Nt){var Ut=e+At+kt+Nt;return Ut>>>0}utils$n.sum64_4_lo=sum64_4_lo$1;function sum64_5_hi$1($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt){var jt=0,Kt=e;Kt=Kt+At>>>0,jt+=Kt<e?1:0,Kt=Kt+kt>>>0,jt+=Kt<kt?1:0,Kt=Kt+Nt>>>0,jt+=Kt<Nt?1:0,Kt=Kt+Lt>>>0,jt+=Kt<Lt?1:0;var qt=$t+_t+xt+Bt+Ut+jt;return qt>>>0}utils$n.sum64_5_hi=sum64_5_hi$1;function sum64_5_lo$1($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt){var jt=e+At+kt+Nt+Lt;return jt>>>0}utils$n.sum64_5_lo=sum64_5_lo$1;function rotr64_hi$1($t,e,_t){var At=e<<32-_t|$t>>>_t;return At>>>0}utils$n.rotr64_hi=rotr64_hi$1;function rotr64_lo$1($t,e,_t){var At=$t<<32-_t|e>>>_t;return At>>>0}utils$n.rotr64_lo=rotr64_lo$1;function shr64_hi$1($t,e,_t){return $t>>>_t}utils$n.shr64_hi=shr64_hi$1;function shr64_lo$1($t,e,_t){var At=$t<<32-_t|e>>>_t;return At>>>0}utils$n.shr64_lo=shr64_lo$1;var common$6={},utils$m=utils$n,assert$d=minimalisticAssert;function BlockHash$4(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}common$6.BlockHash=BlockHash$4;BlockHash$4.prototype.update=function(e,_t){if(e=utils$m.toArray(e,_t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var At=e.length%this._delta8;this.pending=e.slice(e.length-At,e.length),this.pending.length===0&&(this.pending=null),e=utils$m.join32(e,0,e.length-At,this.endian);for(var xt=0;xt<e.length;xt+=this._delta32)this._update(e,xt,xt+this._delta32)}return this};BlockHash$4.prototype.digest=function(e){return this.update(this._pad()),assert$d(this.pending===null),this._digest(e)};BlockHash$4.prototype._pad=function(){var e=this.pendingTotal,_t=this._delta8,At=_t-(e+this.padLength)%_t,xt=new Array(At+this.padLength);xt[0]=128;for(var kt=1;kt<At;kt++)xt[kt]=0;if(e<<=3,this.endian==="big"){for(var Bt=8;Bt<this.padLength;Bt++)xt[kt++]=0;xt[kt++]=0,xt[kt++]=0,xt[kt++]=0,xt[kt++]=0,xt[kt++]=e>>>24&255,xt[kt++]=e>>>16&255,xt[kt++]=e>>>8&255,xt[kt++]=e&255}else for(xt[kt++]=e&255,xt[kt++]=e>>>8&255,xt[kt++]=e>>>16&255,xt[kt++]=e>>>24&255,xt[kt++]=0,xt[kt++]=0,xt[kt++]=0,xt[kt++]=0,Bt=8;Bt<this.padLength;Bt++)xt[kt++]=0;return xt};var sha={},common$5={},utils$l=utils$n,rotr32=utils$l.rotr32;function ft_1$1($t,e,_t,At){if($t===0)return ch32$1(e,_t,At);if($t===1||$t===3)return p32(e,_t,At);if($t===2)return maj32$1(e,_t,At)}common$5.ft_1=ft_1$1;function ch32$1($t,e,_t){return $t&e^~$t&_t}common$5.ch32=ch32$1;function maj32$1($t,e,_t){return $t&e^$t&_t^e&_t}common$5.maj32=maj32$1;function p32($t,e,_t){return $t^e^_t}common$5.p32=p32;function s0_256$1($t){return rotr32($t,2)^rotr32($t,13)^rotr32($t,22)}common$5.s0_256=s0_256$1;function s1_256$1($t){return rotr32($t,6)^rotr32($t,11)^rotr32($t,25)}common$5.s1_256=s1_256$1;function g0_256$1($t){return rotr32($t,7)^rotr32($t,18)^$t>>>3}common$5.g0_256=g0_256$1;function g1_256$1($t){return rotr32($t,17)^rotr32($t,19)^$t>>>10}common$5.g1_256=g1_256$1;var utils$k=utils$n,common$4=common$6,shaCommon$1=common$5,rotl32$1=utils$k.rotl32,sum32$2=utils$k.sum32,sum32_5$1=utils$k.sum32_5,ft_1=shaCommon$1.ft_1,BlockHash$3=common$4.BlockHash,sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash$3.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}utils$k.inherits(SHA1,BlockHash$3);var _1=SHA1;SHA1.blockSize=512;SHA1.outSize=160;SHA1.hmacStrength=80;SHA1.padLength=64;SHA1.prototype._update=function(e,_t){for(var At=this.W,xt=0;xt<16;xt++)At[xt]=e[_t+xt];for(;xt<At.length;xt++)At[xt]=rotl32$1(At[xt-3]^At[xt-8]^At[xt-14]^At[xt-16],1);var kt=this.h[0],Bt=this.h[1],Nt=this.h[2],Ut=this.h[3],Lt=this.h[4];for(xt=0;xt<At.length;xt++){var jt=~~(xt/20),Kt=sum32_5$1(rotl32$1(kt,5),ft_1(jt,Bt,Nt,Ut),Lt,At[xt],sha1_K[jt]);Lt=Ut,Ut=Nt,Nt=rotl32$1(Bt,30),Bt=kt,kt=Kt}this.h[0]=sum32$2(this.h[0],kt),this.h[1]=sum32$2(this.h[1],Bt),this.h[2]=sum32$2(this.h[2],Nt),this.h[3]=sum32$2(this.h[3],Ut),this.h[4]=sum32$2(this.h[4],Lt)};SHA1.prototype._digest=function(e){return e==="hex"?utils$k.toHex32(this.h,"big"):utils$k.split32(this.h,"big")};var utils$j=utils$n,common$3=common$6,shaCommon=common$5,assert$c=minimalisticAssert,sum32$1=utils$j.sum32,sum32_4$1=utils$j.sum32_4,sum32_5=utils$j.sum32_5,ch32=shaCommon.ch32,maj32=shaCommon.maj32,s0_256=shaCommon.s0_256,s1_256=shaCommon.s1_256,g0_256=shaCommon.g0_256,g1_256=shaCommon.g1_256,BlockHash$2=common$3.BlockHash,sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function SHA256$3(){if(!(this instanceof SHA256$3))return new SHA256$3;BlockHash$2.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=sha256_K,this.W=new Array(64)}utils$j.inherits(SHA256$3,BlockHash$2);var _256=SHA256$3;SHA256$3.blockSize=512;SHA256$3.outSize=256;SHA256$3.hmacStrength=192;SHA256$3.padLength=64;SHA256$3.prototype._update=function(e,_t){for(var At=this.W,xt=0;xt<16;xt++)At[xt]=e[_t+xt];for(;xt<At.length;xt++)At[xt]=sum32_4$1(g1_256(At[xt-2]),At[xt-7],g0_256(At[xt-15]),At[xt-16]);var kt=this.h[0],Bt=this.h[1],Nt=this.h[2],Ut=this.h[3],Lt=this.h[4],jt=this.h[5],Kt=this.h[6],qt=this.h[7];for(assert$c(this.k.length===At.length),xt=0;xt<At.length;xt++){var zt=sum32_5(qt,s1_256(Lt),ch32(Lt,jt,Kt),this.k[xt],At[xt]),Vt=sum32$1(s0_256(kt),maj32(kt,Bt,Nt));qt=Kt,Kt=jt,jt=Lt,Lt=sum32$1(Ut,zt),Ut=Nt,Nt=Bt,Bt=kt,kt=sum32$1(zt,Vt)}this.h[0]=sum32$1(this.h[0],kt),this.h[1]=sum32$1(this.h[1],Bt),this.h[2]=sum32$1(this.h[2],Nt),this.h[3]=sum32$1(this.h[3],Ut),this.h[4]=sum32$1(this.h[4],Lt),this.h[5]=sum32$1(this.h[5],jt),this.h[6]=sum32$1(this.h[6],Kt),this.h[7]=sum32$1(this.h[7],qt)};SHA256$3.prototype._digest=function(e){return e==="hex"?utils$j.toHex32(this.h,"big"):utils$j.split32(this.h,"big")};var utils$i=utils$n,SHA256$2=_256;function SHA224$1(){if(!(this instanceof SHA224$1))return new SHA224$1;SHA256$2.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils$i.inherits(SHA224$1,SHA256$2);var _224=SHA224$1;SHA224$1.blockSize=512;SHA224$1.outSize=224;SHA224$1.hmacStrength=192;SHA224$1.padLength=64;SHA224$1.prototype._digest=function(e){return e==="hex"?utils$i.toHex32(this.h.slice(0,7),"big"):utils$i.split32(this.h.slice(0,7),"big")};var utils$h=utils$n,common$2=common$6,assert$b=minimalisticAssert,rotr64_hi=utils$h.rotr64_hi,rotr64_lo=utils$h.rotr64_lo,shr64_hi=utils$h.shr64_hi,shr64_lo=utils$h.shr64_lo,sum64=utils$h.sum64,sum64_hi=utils$h.sum64_hi,sum64_lo=utils$h.sum64_lo,sum64_4_hi=utils$h.sum64_4_hi,sum64_4_lo=utils$h.sum64_4_lo,sum64_5_hi=utils$h.sum64_5_hi,sum64_5_lo=utils$h.sum64_5_lo,BlockHash$1=common$2.BlockHash,sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function SHA512$3(){if(!(this instanceof SHA512$3))return new SHA512$3;BlockHash$1.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=sha512_K,this.W=new Array(160)}utils$h.inherits(SHA512$3,BlockHash$1);var _512=SHA512$3;SHA512$3.blockSize=1024;SHA512$3.outSize=512;SHA512$3.hmacStrength=192;SHA512$3.padLength=128;SHA512$3.prototype._prepareBlock=function(e,_t){for(var At=this.W,xt=0;xt<32;xt++)At[xt]=e[_t+xt];for(;xt<At.length;xt+=2){var kt=g1_512_hi(At[xt-4],At[xt-3]),Bt=g1_512_lo(At[xt-4],At[xt-3]),Nt=At[xt-14],Ut=At[xt-13],Lt=g0_512_hi(At[xt-30],At[xt-29]),jt=g0_512_lo(At[xt-30],At[xt-29]),Kt=At[xt-32],qt=At[xt-31];At[xt]=sum64_4_hi(kt,Bt,Nt,Ut,Lt,jt,Kt,qt),At[xt+1]=sum64_4_lo(kt,Bt,Nt,Ut,Lt,jt,Kt,qt)}};SHA512$3.prototype._update=function(e,_t){this._prepareBlock(e,_t);var At=this.W,xt=this.h[0],kt=this.h[1],Bt=this.h[2],Nt=this.h[3],Ut=this.h[4],Lt=this.h[5],jt=this.h[6],Kt=this.h[7],qt=this.h[8],zt=this.h[9],Vt=this.h[10],Ht=this.h[11],Wt=this.h[12],Qt=this.h[13],Xt=this.h[14],Jt=this.h[15];assert$b(this.k.length===At.length);for(var tr=0;tr<At.length;tr+=2){var dr=Xt,vr=Jt,$r=s1_512_hi(qt,zt),Ir=s1_512_lo(qt,zt),Rr=ch64_hi(qt,zt,Vt,Ht,Wt),Nr=ch64_lo(qt,zt,Vt,Ht,Wt,Qt),kr=this.k[tr],lr=this.k[tr+1],ir=At[tr],er=At[tr+1],rr=sum64_5_hi(dr,vr,$r,Ir,Rr,Nr,kr,lr,ir,er),yr=sum64_5_lo(dr,vr,$r,Ir,Rr,Nr,kr,lr,ir,er);dr=s0_512_hi(xt,kt),vr=s0_512_lo(xt,kt),$r=maj64_hi(xt,kt,Bt,Nt,Ut),Ir=maj64_lo(xt,kt,Bt,Nt,Ut,Lt);var fr=sum64_hi(dr,vr,$r,Ir),gr=sum64_lo(dr,vr,$r,Ir);Xt=Wt,Jt=Qt,Wt=Vt,Qt=Ht,Vt=qt,Ht=zt,qt=sum64_hi(jt,Kt,rr,yr),zt=sum64_lo(Kt,Kt,rr,yr),jt=Ut,Kt=Lt,Ut=Bt,Lt=Nt,Bt=xt,Nt=kt,xt=sum64_hi(rr,yr,fr,gr),kt=sum64_lo(rr,yr,fr,gr)}sum64(this.h,0,xt,kt),sum64(this.h,2,Bt,Nt),sum64(this.h,4,Ut,Lt),sum64(this.h,6,jt,Kt),sum64(this.h,8,qt,zt),sum64(this.h,10,Vt,Ht),sum64(this.h,12,Wt,Qt),sum64(this.h,14,Xt,Jt)};SHA512$3.prototype._digest=function(e){return e==="hex"?utils$h.toHex32(this.h,"big"):utils$h.split32(this.h,"big")};function ch64_hi($t,e,_t,At,xt){var kt=$t&_t^~$t&xt;return kt<0&&(kt+=4294967296),kt}function ch64_lo($t,e,_t,At,xt,kt){var Bt=e&At^~e&kt;return Bt<0&&(Bt+=4294967296),Bt}function maj64_hi($t,e,_t,At,xt){var kt=$t&_t^$t&xt^_t&xt;return kt<0&&(kt+=4294967296),kt}function maj64_lo($t,e,_t,At,xt,kt){var Bt=e&At^e&kt^At&kt;return Bt<0&&(Bt+=4294967296),Bt}function s0_512_hi($t,e){var _t=rotr64_hi($t,e,28),At=rotr64_hi(e,$t,2),xt=rotr64_hi(e,$t,7),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function s0_512_lo($t,e){var _t=rotr64_lo($t,e,28),At=rotr64_lo(e,$t,2),xt=rotr64_lo(e,$t,7),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function s1_512_hi($t,e){var _t=rotr64_hi($t,e,14),At=rotr64_hi($t,e,18),xt=rotr64_hi(e,$t,9),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function s1_512_lo($t,e){var _t=rotr64_lo($t,e,14),At=rotr64_lo($t,e,18),xt=rotr64_lo(e,$t,9),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function g0_512_hi($t,e){var _t=rotr64_hi($t,e,1),At=rotr64_hi($t,e,8),xt=shr64_hi($t,e,7),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function g0_512_lo($t,e){var _t=rotr64_lo($t,e,1),At=rotr64_lo($t,e,8),xt=shr64_lo($t,e,7),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function g1_512_hi($t,e){var _t=rotr64_hi($t,e,19),At=rotr64_hi(e,$t,29),xt=shr64_hi($t,e,6),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}function g1_512_lo($t,e){var _t=rotr64_lo($t,e,19),At=rotr64_lo(e,$t,29),xt=shr64_lo($t,e,6),kt=_t^At^xt;return kt<0&&(kt+=4294967296),kt}var utils$g=utils$n,SHA512$2=_512;function SHA384$1(){if(!(this instanceof SHA384$1))return new SHA384$1;SHA512$2.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils$g.inherits(SHA384$1,SHA512$2);var _384=SHA384$1;SHA384$1.blockSize=1024;SHA384$1.outSize=384;SHA384$1.hmacStrength=192;SHA384$1.padLength=128;SHA384$1.prototype._digest=function(e){return e==="hex"?utils$g.toHex32(this.h.slice(0,12),"big"):utils$g.split32(this.h.slice(0,12),"big")};sha.sha1=_1;sha.sha224=_224;sha.sha256=_256;sha.sha384=_384;sha.sha512=_512;var ripemd={},utils$f=utils$n,common$1=common$6,rotl32=utils$f.rotl32,sum32=utils$f.sum32,sum32_3=utils$f.sum32_3,sum32_4=utils$f.sum32_4,BlockHash=common$1.BlockHash;function RIPEMD160$1(){if(!(this instanceof RIPEMD160$1))return new RIPEMD160$1;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}utils$f.inherits(RIPEMD160$1,BlockHash);ripemd.ripemd160=RIPEMD160$1;RIPEMD160$1.blockSize=512;RIPEMD160$1.outSize=160;RIPEMD160$1.hmacStrength=192;RIPEMD160$1.padLength=64;RIPEMD160$1.prototype._update=function(e,_t){for(var At=this.h[0],xt=this.h[1],kt=this.h[2],Bt=this.h[3],Nt=this.h[4],Ut=At,Lt=xt,jt=kt,Kt=Bt,qt=Nt,zt=0;zt<80;zt++){var Vt=sum32(rotl32(sum32_4(At,f$2(zt,xt,kt,Bt),e[r$1[zt]+_t],K$1(zt)),s$2[zt]),Nt);At=Nt,Nt=Bt,Bt=rotl32(kt,10),kt=xt,xt=Vt,Vt=sum32(rotl32(sum32_4(Ut,f$2(79-zt,Lt,jt,Kt),e[rh[zt]+_t],Kh(zt)),sh[zt]),qt),Ut=qt,qt=Kt,Kt=rotl32(jt,10),jt=Lt,Lt=Vt}Vt=sum32_3(this.h[1],kt,Kt),this.h[1]=sum32_3(this.h[2],Bt,qt),this.h[2]=sum32_3(this.h[3],Nt,Ut),this.h[3]=sum32_3(this.h[4],At,Lt),this.h[4]=sum32_3(this.h[0],xt,jt),this.h[0]=Vt};RIPEMD160$1.prototype._digest=function(e){return e==="hex"?utils$f.toHex32(this.h,"little"):utils$f.split32(this.h,"little")};function f$2($t,e,_t,At){return $t<=15?e^_t^At:$t<=31?e&_t|~e&At:$t<=47?(e|~_t)^At:$t<=63?e&At|_t&~At:e^(_t|~At)}function K$1($t){return $t<=15?0:$t<=31?1518500249:$t<=47?1859775393:$t<=63?2400959708:2840853838}function Kh($t){return $t<=15?1352829926:$t<=31?1548603684:$t<=47?1836072691:$t<=63?2053994217:0}var r$1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s$2=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],utils$e=utils$n,assert$a=minimalisticAssert;function Hmac($t,e,_t){if(!(this instanceof Hmac))return new Hmac($t,e,_t);this.Hash=$t,this.blockSize=$t.blockSize/8,this.outSize=$t.outSize/8,this.inner=null,this.outer=null,this._init(utils$e.toArray(e,_t))}var hmac$2=Hmac;Hmac.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),assert$a(e.length<=this.blockSize);for(var _t=e.length;_t<this.blockSize;_t++)e.push(0);for(_t=0;_t<e.length;_t++)e[_t]^=54;for(this.inner=new this.Hash().update(e),_t=0;_t<e.length;_t++)e[_t]^=106;this.outer=new this.Hash().update(e)};Hmac.prototype.update=function(e,_t){return this.inner.update(e,_t),this};Hmac.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)};(function($t){var e=$t;e.utils=utils$n,e.common=common$6,e.sha=sha,e.ripemd=ripemd,e.hmac=hmac$2,e.sha1=e.sha.sha1,e.sha256=e.sha.sha256,e.sha224=e.sha.sha224,e.sha384=e.sha.sha384,e.sha512=e.sha.sha512,e.ripemd160=e.ripemd.ripemd160})(hash$5);var secp256k1$2,hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,secp256k1$2={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),secp256k1$2}(function($t){var e=$t,_t=hash$5,At=curve$1,xt=utils$t,kt=xt.assert;function Bt(Lt){Lt.type==="short"?this.curve=new At.short(Lt):Lt.type==="edwards"?this.curve=new At.edwards(Lt):this.curve=new At.mont(Lt),this.g=this.curve.g,this.n=this.curve.n,this.hash=Lt.hash,kt(this.g.validate(),"Invalid curve"),kt(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=Bt;function Nt(Lt,jt){Object.defineProperty(e,Lt,{configurable:!0,enumerable:!0,get:function(){var Kt=new Bt(jt);return Object.defineProperty(e,Lt,{configurable:!0,enumerable:!0,value:Kt}),Kt}})}Nt("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:_t.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),Nt("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:_t.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),Nt("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:_t.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),Nt("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:_t.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),Nt("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:_t.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),Nt("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:_t.sha256,gRed:!1,g:["9"]}),Nt("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:_t.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var Ut;try{Ut=requireSecp256k1()}catch{Ut=void 0}Nt("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:_t.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",Ut]})})(curves$1);var hash$4=hash$5,utils$d=utils$s,assert$9=minimalisticAssert;function HmacDRBG($t){if(!(this instanceof HmacDRBG))return new HmacDRBG($t);this.hash=$t.hash,this.predResist=!!$t.predResist,this.outLen=this.hash.outSize,this.minEntropy=$t.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=utils$d.toArray($t.entropy,$t.entropyEnc||"hex"),_t=utils$d.toArray($t.nonce,$t.nonceEnc||"hex"),At=utils$d.toArray($t.pers,$t.persEnc||"hex");assert$9(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,_t,At)}var hmacDrbg=HmacDRBG;HmacDRBG.prototype._init=function(e,_t,At){var xt=e.concat(_t).concat(At);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var kt=0;kt<this.V.length;kt++)this.K[kt]=0,this.V[kt]=1;this._update(xt),this._reseed=1,this.reseedInterval=281474976710656};HmacDRBG.prototype._hmac=function(){return new hash$4.hmac(this.hash,this.K)};HmacDRBG.prototype._update=function(e){var _t=this._hmac().update(this.V).update([0]);e&&(_t=_t.update(e)),this.K=_t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())};HmacDRBG.prototype.reseed=function(e,_t,At,xt){typeof _t!="string"&&(xt=At,At=_t,_t=null),e=utils$d.toArray(e,_t),At=utils$d.toArray(At,xt),assert$9(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(At||[])),this._reseed=1};HmacDRBG.prototype.generate=function(e,_t,At,xt){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof _t!="string"&&(xt=At,At=_t,_t=null),At&&(At=utils$d.toArray(At,xt||"hex"),this._update(At));for(var kt=[];kt.length<e;)this.V=this._hmac().update(this.V).digest(),kt=kt.concat(this.V);var Bt=kt.slice(0,e);return this._update(At),this._reseed++,utils$d.encode(Bt,_t)};var BN$5=bnExports$1,utils$c=utils$t,assert$8=utils$c.assert;function KeyPair$2($t,e){this.ec=$t,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}var key$1=KeyPair$2;KeyPair$2.fromPublic=function(e,_t,At){return _t instanceof KeyPair$2?_t:new KeyPair$2(e,{pub:_t,pubEnc:At})};KeyPair$2.fromPrivate=function(e,_t,At){return _t instanceof KeyPair$2?_t:new KeyPair$2(e,{priv:_t,privEnc:At})};KeyPair$2.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};KeyPair$2.prototype.getPublic=function(e,_t){return typeof e=="string"&&(_t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),_t?this.pub.encode(_t,e):this.pub};KeyPair$2.prototype.getPrivate=function(e){return e==="hex"?this.priv.toString(16,2):this.priv};KeyPair$2.prototype._importPrivate=function(e,_t){this.priv=new BN$5(e,_t||16),this.priv=this.priv.umod(this.ec.curve.n)};KeyPair$2.prototype._importPublic=function(e,_t){if(e.x||e.y){this.ec.curve.type==="mont"?assert$8(e.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&assert$8(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,_t)};KeyPair$2.prototype.derive=function(e){return e.validate()||assert$8(e.validate(),"public point not validated"),e.mul(this.priv).getX()};KeyPair$2.prototype.sign=function(e,_t,At){return this.ec.sign(e,this,_t,At)};KeyPair$2.prototype.verify=function(e,_t){return this.ec.verify(e,_t,this)};KeyPair$2.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var BN$4=bnExports$1,utils$b=utils$t,assert$7=utils$b.assert;function Signature$2($t,e){if($t instanceof Signature$2)return $t;this._importDER($t,e)||(assert$7($t.r&&$t.s,"Signature without r or s"),this.r=new BN$4($t.r,16),this.s=new BN$4($t.s,16),$t.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=$t.recoveryParam)}var signature$1=Signature$2;function Position(){this.place=0}function getLength($t,e){var _t=$t[e.place++];if(!(_t&128))return _t;var At=_t&15;if(At===0||At>4||$t[e.place]===0)return!1;for(var xt=0,kt=0,Bt=e.place;kt<At;kt++,Bt++)xt<<=8,xt|=$t[Bt],xt>>>=0;return xt<=127?!1:(e.place=Bt,xt)}function rmPadding($t){for(var e=0,_t=$t.length-1;!$t[e]&&!($t[e+1]&128)&&e<_t;)e++;return e===0?$t:$t.slice(e)}Signature$2.prototype._importDER=function(e,_t){e=utils$b.toArray(e,_t);var At=new Position;if(e[At.place++]!==48)return!1;var xt=getLength(e,At);if(xt===!1||xt+At.place!==e.length||e[At.place++]!==2)return!1;var kt=getLength(e,At);if(kt===!1||e[At.place]&128)return!1;var Bt=e.slice(At.place,kt+At.place);if(At.place+=kt,e[At.place++]!==2)return!1;var Nt=getLength(e,At);if(Nt===!1||e.length!==Nt+At.place||e[At.place]&128)return!1;var Ut=e.slice(At.place,Nt+At.place);if(Bt[0]===0)if(Bt[1]&128)Bt=Bt.slice(1);else return!1;if(Ut[0]===0)if(Ut[1]&128)Ut=Ut.slice(1);else return!1;return this.r=new BN$4(Bt),this.s=new BN$4(Ut),this.recoveryParam=null,!0};function constructLength($t,e){if(e<128){$t.push(e);return}var _t=1+(Math.log(e)/Math.LN2>>>3);for($t.push(_t|128);--_t;)$t.push(e>>>(_t<<3)&255);$t.push(e)}Signature$2.prototype.toDER=function(e){var _t=this.r.toArray(),At=this.s.toArray();for(_t[0]&128&&(_t=[0].concat(_t)),At[0]&128&&(At=[0].concat(At)),_t=rmPadding(_t),At=rmPadding(At);!At[0]&&!(At[1]&128);)At=At.slice(1);var xt=[2];constructLength(xt,_t.length),xt=xt.concat(_t),xt.push(2),constructLength(xt,At.length);var kt=xt.concat(At),Bt=[48];return constructLength(Bt,kt.length),Bt=Bt.concat(kt),utils$b.encode(Bt,e)};var ec,hasRequiredEc;function requireEc(){if(hasRequiredEc)return ec;hasRequiredEc=1;var $t=bnExports$1,e=hmacDrbg,_t=utils$t,At=curves$1,xt=requireBrorand(),kt=_t.assert,Bt=key$1,Nt=signature$1;function Ut(Lt){if(!(this instanceof Ut))return new Ut(Lt);typeof Lt=="string"&&(kt(Object.prototype.hasOwnProperty.call(At,Lt),"Unknown curve "+Lt),Lt=At[Lt]),Lt instanceof At.PresetCurve&&(Lt={curve:Lt}),this.curve=Lt.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=Lt.curve.g,this.g.precompute(Lt.curve.n.bitLength()+1),this.hash=Lt.hash||Lt.curve.hash}return ec=Ut,Ut.prototype.keyPair=function(jt){return new Bt(this,jt)},Ut.prototype.keyFromPrivate=function(jt,Kt){return Bt.fromPrivate(this,jt,Kt)},Ut.prototype.keyFromPublic=function(jt,Kt){return Bt.fromPublic(this,jt,Kt)},Ut.prototype.genKeyPair=function(jt){jt||(jt={});for(var Kt=new e({hash:this.hash,pers:jt.pers,persEnc:jt.persEnc||"utf8",entropy:jt.entropy||xt(this.hash.hmacStrength),entropyEnc:jt.entropy&&jt.entropyEnc||"utf8",nonce:this.n.toArray()}),qt=this.n.byteLength(),zt=this.n.sub(new $t(2));;){var Vt=new $t(Kt.generate(qt));if(!(Vt.cmp(zt)>0))return Vt.iaddn(1),this.keyFromPrivate(Vt)}},Ut.prototype._truncateToN=function(jt,Kt){var qt=jt.byteLength()*8-this.n.bitLength();return qt>0&&(jt=jt.ushrn(qt)),!Kt&&jt.cmp(this.n)>=0?jt.sub(this.n):jt},Ut.prototype.sign=function(jt,Kt,qt,zt){typeof qt=="object"&&(zt=qt,qt=null),zt||(zt={}),Kt=this.keyFromPrivate(Kt,qt),jt=this._truncateToN(new $t(jt,16));for(var Vt=this.n.byteLength(),Ht=Kt.getPrivate().toArray("be",Vt),Wt=jt.toArray("be",Vt),Qt=new e({hash:this.hash,entropy:Ht,nonce:Wt,pers:zt.pers,persEnc:zt.persEnc||"utf8"}),Xt=this.n.sub(new $t(1)),Jt=0;;Jt++){var tr=zt.k?zt.k(Jt):new $t(Qt.generate(this.n.byteLength()));if(tr=this._truncateToN(tr,!0),!(tr.cmpn(1)<=0||tr.cmp(Xt)>=0)){var dr=this.g.mul(tr);if(!dr.isInfinity()){var vr=dr.getX(),$r=vr.umod(this.n);if($r.cmpn(0)!==0){var Ir=tr.invm(this.n).mul($r.mul(Kt.getPrivate()).iadd(jt));if(Ir=Ir.umod(this.n),Ir.cmpn(0)!==0){var Rr=(dr.getY().isOdd()?1:0)|(vr.cmp($r)!==0?2:0);return zt.canonical&&Ir.cmp(this.nh)>0&&(Ir=this.n.sub(Ir),Rr^=1),new Nt({r:$r,s:Ir,recoveryParam:Rr})}}}}}},Ut.prototype.verify=function(jt,Kt,qt,zt){jt=this._truncateToN(new $t(jt,16)),qt=this.keyFromPublic(qt,zt),Kt=new Nt(Kt,"hex");var Vt=Kt.r,Ht=Kt.s;if(Vt.cmpn(1)<0||Vt.cmp(this.n)>=0||Ht.cmpn(1)<0||Ht.cmp(this.n)>=0)return!1;var Wt=Ht.invm(this.n),Qt=Wt.mul(jt).umod(this.n),Xt=Wt.mul(Vt).umod(this.n),Jt;return this.curve._maxwellTrick?(Jt=this.g.jmulAdd(Qt,qt.getPublic(),Xt),Jt.isInfinity()?!1:Jt.eqXToP(Vt)):(Jt=this.g.mulAdd(Qt,qt.getPublic(),Xt),Jt.isInfinity()?!1:Jt.getX().umod(this.n).cmp(Vt)===0)},Ut.prototype.recoverPubKey=function(Lt,jt,Kt,qt){kt((3&Kt)===Kt,"The recovery param is more than two bits"),jt=new Nt(jt,qt);var zt=this.n,Vt=new $t(Lt),Ht=jt.r,Wt=jt.s,Qt=Kt&1,Xt=Kt>>1;if(Ht.cmp(this.curve.p.umod(this.curve.n))>=0&&Xt)throw new Error("Unable to find sencond key candinate");Xt?Ht=this.curve.pointFromX(Ht.add(this.curve.n),Qt):Ht=this.curve.pointFromX(Ht,Qt);var Jt=jt.r.invm(zt),tr=zt.sub(Vt).mul(Jt).umod(zt),dr=Wt.mul(Jt).umod(zt);return this.g.mulAdd(tr,Ht,dr)},Ut.prototype.getKeyRecoveryParam=function(Lt,jt,Kt,qt){if(jt=new Nt(jt,qt),jt.recoveryParam!==null)return jt.recoveryParam;for(var zt=0;zt<4;zt++){var Vt;try{Vt=this.recoverPubKey(Lt,jt,zt)}catch{continue}if(Vt.eq(Kt))return zt}throw new Error("Unable to find valid recovery factor")},ec}var utils$a=utils$t,assert$6=utils$a.assert,parseBytes$2=utils$a.parseBytes,cachedProperty$1=utils$a.cachedProperty;function KeyPair$1($t,e){this.eddsa=$t,this._secret=parseBytes$2(e.secret),$t.isPoint(e.pub)?this._pub=e.pub:this._pubBytes=parseBytes$2(e.pub)}KeyPair$1.fromPublic=function(e,_t){return _t instanceof KeyPair$1?_t:new KeyPair$1(e,{pub:_t})};KeyPair$1.fromSecret=function(e,_t){return _t instanceof KeyPair$1?_t:new KeyPair$1(e,{secret:_t})};KeyPair$1.prototype.secret=function(){return this._secret};cachedProperty$1(KeyPair$1,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())});cachedProperty$1(KeyPair$1,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())});cachedProperty$1(KeyPair$1,"privBytes",function(){var e=this.eddsa,_t=this.hash(),At=e.encodingLength-1,xt=_t.slice(0,e.encodingLength);return xt[0]&=248,xt[At]&=127,xt[At]|=64,xt});cachedProperty$1(KeyPair$1,"priv",function(){return this.eddsa.decodeInt(this.privBytes())});cachedProperty$1(KeyPair$1,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()});cachedProperty$1(KeyPair$1,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)});KeyPair$1.prototype.sign=function(e){return assert$6(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)};KeyPair$1.prototype.verify=function(e,_t){return this.eddsa.verify(e,_t,this)};KeyPair$1.prototype.getSecret=function(e){return assert$6(this._secret,"KeyPair is public only"),utils$a.encode(this.secret(),e)};KeyPair$1.prototype.getPublic=function(e){return utils$a.encode(this.pubBytes(),e)};var key=KeyPair$1,BN$3=bnExports$1,utils$9=utils$t,assert$5=utils$9.assert,cachedProperty=utils$9.cachedProperty,parseBytes$1=utils$9.parseBytes;function Signature$1($t,e){this.eddsa=$t,typeof e!="object"&&(e=parseBytes$1(e)),Array.isArray(e)&&(assert$5(e.length===$t.encodingLength*2,"Signature has invalid size"),e={R:e.slice(0,$t.encodingLength),S:e.slice($t.encodingLength)}),assert$5(e.R&&e.S,"Signature without R or S"),$t.isPoint(e.R)&&(this._R=e.R),e.S instanceof BN$3&&(this._S=e.S),this._Rencoded=Array.isArray(e.R)?e.R:e.Rencoded,this._Sencoded=Array.isArray(e.S)?e.S:e.Sencoded}cachedProperty(Signature$1,"S",function(){return this.eddsa.decodeInt(this.Sencoded())});cachedProperty(Signature$1,"R",function(){return this.eddsa.decodePoint(this.Rencoded())});cachedProperty(Signature$1,"Rencoded",function(){return this.eddsa.encodePoint(this.R())});cachedProperty(Signature$1,"Sencoded",function(){return this.eddsa.encodeInt(this.S())});Signature$1.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())};Signature$1.prototype.toHex=function(){return utils$9.encode(this.toBytes(),"hex").toUpperCase()};var signature=Signature$1,hash$3=hash$5,curves=curves$1,utils$8=utils$t,assert$4=utils$8.assert,parseBytes=utils$8.parseBytes,KeyPair=key,Signature=signature;function EDDSA($t){if(assert$4($t==="ed25519","only tested with ed25519 so far"),!(this instanceof EDDSA))return new EDDSA($t);$t=curves[$t].curve,this.curve=$t,this.g=$t.g,this.g.precompute($t.n.bitLength()+1),this.pointClass=$t.point().constructor,this.encodingLength=Math.ceil($t.n.bitLength()/8),this.hash=hash$3.sha512}var eddsa=EDDSA;EDDSA.prototype.sign=function(e,_t){e=parseBytes(e);var At=this.keyFromSecret(_t),xt=this.hashInt(At.messagePrefix(),e),kt=this.g.mul(xt),Bt=this.encodePoint(kt),Nt=this.hashInt(Bt,At.pubBytes(),e).mul(At.priv()),Ut=xt.add(Nt).umod(this.curve.n);return this.makeSignature({R:kt,S:Ut,Rencoded:Bt})};EDDSA.prototype.verify=function(e,_t,At){if(e=parseBytes(e),_t=this.makeSignature(_t),_t.S().gte(_t.eddsa.curve.n)||_t.S().isNeg())return!1;var xt=this.keyFromPublic(At),kt=this.hashInt(_t.Rencoded(),xt.pubBytes(),e),Bt=this.g.mul(_t.S()),Nt=_t.R().add(xt.pub().mul(kt));return Nt.eq(Bt)};EDDSA.prototype.hashInt=function(){for(var e=this.hash(),_t=0;_t<arguments.length;_t++)e.update(arguments[_t]);return utils$8.intFromLE(e.digest()).umod(this.curve.n)};EDDSA.prototype.keyFromPublic=function(e){return KeyPair.fromPublic(this,e)};EDDSA.prototype.keyFromSecret=function(e){return KeyPair.fromSecret(this,e)};EDDSA.prototype.makeSignature=function(e){return e instanceof Signature?e:new Signature(this,e)};EDDSA.prototype.encodePoint=function(e){var _t=e.getY().toArray("le",this.encodingLength);return _t[this.encodingLength-1]|=e.getX().isOdd()?128:0,_t};EDDSA.prototype.decodePoint=function(e){e=utils$8.parseBytes(e);var _t=e.length-1,At=e.slice(0,_t).concat(e[_t]&-129),xt=(e[_t]&128)!==0,kt=utils$8.intFromLE(At);return this.curve.pointFromY(kt,xt)};EDDSA.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)};EDDSA.prototype.decodeInt=function(e){return utils$8.intFromLE(e)};EDDSA.prototype.isPoint=function(e){return e instanceof this.pointClass};var hasRequiredElliptic;function requireElliptic(){return hasRequiredElliptic||(hasRequiredElliptic=1,function($t){var e=$t;e.version=require$$0$3.version,e.utils=utils$t,e.rand=requireBrorand(),e.curve=curve$1,e.curves=curves$1,e.ec=requireEc(),e.eddsa=eddsa}(elliptic$1)),elliptic$1}var asn1$3={},asn1$2={},api={},vmBrowserify={},hasRequiredVmBrowserify;function requireVmBrowserify(){return hasRequiredVmBrowserify||(hasRequiredVmBrowserify=1,function(exports){var indexOf=function($t,e){if($t.indexOf)return $t.indexOf(e);for(var _t=0;_t<$t.length;_t++)if($t[_t]===e)return _t;return-1},Object_keys=function($t){if(Object.keys)return Object.keys($t);var e=[];for(var _t in $t)e.push(_t);return e},forEach=function($t,e){if($t.forEach)return $t.forEach(e);for(var _t=0;_t<$t.length;_t++)e($t[_t],_t,$t)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function($t,e,_t){Object.defineProperty($t,e,{writable:!0,enumerable:!1,configurable:!0,value:_t})}}catch{return function(e,_t,At){e[_t]=At}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function($t){if(!($t instanceof Context))throw new TypeError("needs a 'context' argument.");var e=document.createElement("iframe");e.style||(e.style={}),e.style.display="none",document.body.appendChild(e);var _t=e.contentWindow,At=_t.eval,xt=_t.execScript;!At&&xt&&(xt.call(_t,"null"),At=_t.eval),forEach(Object_keys($t),function(Nt){_t[Nt]=$t[Nt]}),forEach(globals,function(Nt){$t[Nt]&&(_t[Nt]=$t[Nt])});var kt=Object_keys(_t),Bt=At.call(_t,this.code);return forEach(Object_keys(_t),function(Nt){(Nt in $t||indexOf(kt,Nt)===-1)&&($t[Nt]=_t[Nt])}),forEach(globals,function(Nt){Nt in $t||defineProp($t,Nt,_t[Nt])}),document.body.removeChild(e),Bt},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function($t){var e=Script.createContext($t),_t=this.runInContext(e);return $t&&forEach(Object_keys(e),function(At){$t[At]=e[At]}),_t},forEach(Object_keys(Script.prototype),function($t){exports[$t]=Script[$t]=function(e){var _t=Script(e);return _t[$t].apply(_t,[].slice.call(arguments,1))}}),exports.isContext=function($t){return $t instanceof Context},exports.createScript=function($t){return exports.Script($t)},exports.createContext=Script.createContext=function($t){var e=new Context;return typeof $t=="object"&&forEach(Object_keys($t),function(_t){e[_t]=$t[_t]}),e}}(vmBrowserify)),vmBrowserify}var hasRequiredApi;function requireApi(){return hasRequiredApi||(hasRequiredApi=1,function($t){var e=requireAsn1(),_t=inherits_browserExports,At=$t;At.define=function(Bt,Nt){return new xt(Bt,Nt)};function xt(kt,Bt){this.name=kt,this.body=Bt,this.decoders={},this.encoders={}}xt.prototype._createNamed=function(Bt){var Nt;try{Nt=requireVmBrowserify().runInThisContext("(function "+this.name+`(entity) {
  this._initNamed(entity);
})`)}catch{Nt=function(Lt){this._initNamed(Lt)}}return _t(Nt,Bt),Nt.prototype._initNamed=function(Lt){Bt.call(this,Lt)},new Nt(this)},xt.prototype._getDecoder=function(Bt){return Bt=Bt||"der",this.decoders.hasOwnProperty(Bt)||(this.decoders[Bt]=this._createNamed(e.decoders[Bt])),this.decoders[Bt]},xt.prototype.decode=function(Bt,Nt,Ut){return this._getDecoder(Nt).decode(Bt,Ut)},xt.prototype._getEncoder=function(Bt){return Bt=Bt||"der",this.encoders.hasOwnProperty(Bt)||(this.encoders[Bt]=this._createNamed(e.encoders[Bt])),this.encoders[Bt]},xt.prototype.encode=function(Bt,Nt,Ut){return this._getEncoder(Nt).encode(Bt,Ut)}}(api)),api}var base$1={},reporter={},inherits=inherits_browserExports;function Reporter($t){this._reporterState={obj:null,path:[],options:$t||{},errors:[]}}reporter.Reporter=Reporter;Reporter.prototype.isError=function $t(e){return e instanceof ReporterError};Reporter.prototype.save=function $t(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}};Reporter.prototype.restore=function $t(e){var _t=this._reporterState;_t.obj=e.obj,_t.path=_t.path.slice(0,e.pathLen)};Reporter.prototype.enterKey=function $t(e){return this._reporterState.path.push(e)};Reporter.prototype.exitKey=function $t(e){var _t=this._reporterState;_t.path=_t.path.slice(0,e-1)};Reporter.prototype.leaveKey=function $t(e,_t,At){var xt=this._reporterState;this.exitKey(e),xt.obj!==null&&(xt.obj[_t]=At)};Reporter.prototype.path=function $t(){return this._reporterState.path.join("/")};Reporter.prototype.enterObject=function $t(){var e=this._reporterState,_t=e.obj;return e.obj={},_t};Reporter.prototype.leaveObject=function $t(e){var _t=this._reporterState,At=_t.obj;return _t.obj=e,At};Reporter.prototype.error=function $t(e){var _t,At=this._reporterState,xt=e instanceof ReporterError;if(xt?_t=e:_t=new ReporterError(At.path.map(function(kt){return"["+JSON.stringify(kt)+"]"}).join(""),e.message||e,e.stack),!At.options.partial)throw _t;return xt||At.errors.push(_t),_t};Reporter.prototype.wrapResult=function $t(e){var _t=this._reporterState;return _t.options.partial?{result:this.isError(e)?null:e,errors:_t.errors}:e};function ReporterError($t,e){this.path=$t,this.rethrow(e)}inherits(ReporterError,Error);ReporterError.prototype.rethrow=function $t(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,ReporterError),!this.stack)try{throw new Error(this.message)}catch(_t){this.stack=_t.stack}return this};var buffer={},hasRequiredBuffer;function requireBuffer(){if(hasRequiredBuffer)return buffer;hasRequiredBuffer=1;var $t=inherits_browserExports,e=requireBase().Reporter,_t=buffer$2.Buffer;function At(kt,Bt){if(e.call(this,Bt),!_t.isBuffer(kt)){this.error("Input not Buffer");return}this.base=kt,this.offset=0,this.length=kt.length}$t(At,e),buffer.DecoderBuffer=At,At.prototype.save=function(){return{offset:this.offset,reporter:e.prototype.save.call(this)}},At.prototype.restore=function(Bt){var Nt=new At(this.base);return Nt.offset=Bt.offset,Nt.length=this.offset,this.offset=Bt.offset,e.prototype.restore.call(this,Bt.reporter),Nt},At.prototype.isEmpty=function(){return this.offset===this.length},At.prototype.readUInt8=function(Bt){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(Bt||"DecoderBuffer overrun")},At.prototype.skip=function(Bt,Nt){if(!(this.offset+Bt<=this.length))return this.error(Nt||"DecoderBuffer overrun");var Ut=new At(this.base);return Ut._reporterState=this._reporterState,Ut.offset=this.offset,Ut.length=this.offset+Bt,this.offset+=Bt,Ut},At.prototype.raw=function(Bt){return this.base.slice(Bt?Bt.offset:this.offset,this.length)};function xt(kt,Bt){if(Array.isArray(kt))this.length=0,this.value=kt.map(function(Nt){return Nt instanceof xt||(Nt=new xt(Nt,Bt)),this.length+=Nt.length,Nt},this);else if(typeof kt=="number"){if(!(0<=kt&&kt<=255))return Bt.error("non-byte EncoderBuffer value");this.value=kt,this.length=1}else if(typeof kt=="string")this.value=kt,this.length=_t.byteLength(kt);else if(_t.isBuffer(kt))this.value=kt,this.length=kt.length;else return Bt.error("Unsupported type: "+typeof kt)}return buffer.EncoderBuffer=xt,xt.prototype.join=function(Bt,Nt){return Bt||(Bt=new _t(this.length)),Nt||(Nt=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(Ut){Ut.join(Bt,Nt),Nt+=Ut.length}):(typeof this.value=="number"?Bt[Nt]=this.value:typeof this.value=="string"?Bt.write(this.value,Nt):_t.isBuffer(this.value)&&this.value.copy(Bt,Nt),Nt+=this.length)),Bt},buffer}var node,hasRequiredNode;function requireNode(){if(hasRequiredNode)return node;hasRequiredNode=1;var $t=requireBase().Reporter,e=requireBase().EncoderBuffer,_t=requireBase().DecoderBuffer,At=minimalisticAssert,xt=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],kt=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(xt),Bt=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function Nt(Lt,jt){var Kt={};this._baseState=Kt,Kt.enc=Lt,Kt.parent=jt||null,Kt.children=null,Kt.tag=null,Kt.args=null,Kt.reverseArgs=null,Kt.choice=null,Kt.optional=!1,Kt.any=!1,Kt.obj=!1,Kt.use=null,Kt.useDecoder=null,Kt.key=null,Kt.default=null,Kt.explicit=null,Kt.implicit=null,Kt.contains=null,Kt.parent||(Kt.children=[],this._wrap())}node=Nt;var Ut=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];return Nt.prototype.clone=function(){var jt=this._baseState,Kt={};Ut.forEach(function(zt){Kt[zt]=jt[zt]});var qt=new this.constructor(Kt.parent);return qt._baseState=Kt,qt},Nt.prototype._wrap=function(){var jt=this._baseState;kt.forEach(function(Kt){this[Kt]=function(){var zt=new this.constructor(this);return jt.children.push(zt),zt[Kt].apply(zt,arguments)}},this)},Nt.prototype._init=function(jt){var Kt=this._baseState;At(Kt.parent===null),jt.call(this),Kt.children=Kt.children.filter(function(qt){return qt._baseState.parent===this},this),At.equal(Kt.children.length,1,"Root node can have only one child")},Nt.prototype._useArgs=function(jt){var Kt=this._baseState,qt=jt.filter(function(zt){return zt instanceof this.constructor},this);jt=jt.filter(function(zt){return!(zt instanceof this.constructor)},this),qt.length!==0&&(At(Kt.children===null),Kt.children=qt,qt.forEach(function(zt){zt._baseState.parent=this},this)),jt.length!==0&&(At(Kt.args===null),Kt.args=jt,Kt.reverseArgs=jt.map(function(zt){if(typeof zt!="object"||zt.constructor!==Object)return zt;var Vt={};return Object.keys(zt).forEach(function(Ht){Ht==(Ht|0)&&(Ht|=0);var Wt=zt[Ht];Vt[Wt]=Ht}),Vt}))},Bt.forEach(function(Lt){Nt.prototype[Lt]=function(){var Kt=this._baseState;throw new Error(Lt+" not implemented for encoding: "+Kt.enc)}}),xt.forEach(function(Lt){Nt.prototype[Lt]=function(){var Kt=this._baseState,qt=Array.prototype.slice.call(arguments);return At(Kt.tag===null),Kt.tag=Lt,this._useArgs(qt),this}}),Nt.prototype.use=function(jt){At(jt);var Kt=this._baseState;return At(Kt.use===null),Kt.use=jt,this},Nt.prototype.optional=function(){var jt=this._baseState;return jt.optional=!0,this},Nt.prototype.def=function(jt){var Kt=this._baseState;return At(Kt.default===null),Kt.default=jt,Kt.optional=!0,this},Nt.prototype.explicit=function(jt){var Kt=this._baseState;return At(Kt.explicit===null&&Kt.implicit===null),Kt.explicit=jt,this},Nt.prototype.implicit=function(jt){var Kt=this._baseState;return At(Kt.explicit===null&&Kt.implicit===null),Kt.implicit=jt,this},Nt.prototype.obj=function(){var jt=this._baseState,Kt=Array.prototype.slice.call(arguments);return jt.obj=!0,Kt.length!==0&&this._useArgs(Kt),this},Nt.prototype.key=function(jt){var Kt=this._baseState;return At(Kt.key===null),Kt.key=jt,this},Nt.prototype.any=function(){var jt=this._baseState;return jt.any=!0,this},Nt.prototype.choice=function(jt){var Kt=this._baseState;return At(Kt.choice===null),Kt.choice=jt,this._useArgs(Object.keys(jt).map(function(qt){return jt[qt]})),this},Nt.prototype.contains=function(jt){var Kt=this._baseState;return At(Kt.use===null),Kt.contains=jt,this},Nt.prototype._decode=function(jt,Kt){var qt=this._baseState;if(qt.parent===null)return jt.wrapResult(qt.children[0]._decode(jt,Kt));var zt=qt.default,Vt=!0,Ht=null;if(qt.key!==null&&(Ht=jt.enterKey(qt.key)),qt.optional){var Wt=null;if(qt.explicit!==null?Wt=qt.explicit:qt.implicit!==null?Wt=qt.implicit:qt.tag!==null&&(Wt=qt.tag),Wt===null&&!qt.any){var Qt=jt.save();try{qt.choice===null?this._decodeGeneric(qt.tag,jt,Kt):this._decodeChoice(jt,Kt),Vt=!0}catch{Vt=!1}jt.restore(Qt)}else if(Vt=this._peekTag(jt,Wt,qt.any),jt.isError(Vt))return Vt}var Xt;if(qt.obj&&Vt&&(Xt=jt.enterObject()),Vt){if(qt.explicit!==null){var Jt=this._decodeTag(jt,qt.explicit);if(jt.isError(Jt))return Jt;jt=Jt}var tr=jt.offset;if(qt.use===null&&qt.choice===null){if(qt.any)var Qt=jt.save();var dr=this._decodeTag(jt,qt.implicit!==null?qt.implicit:qt.tag,qt.any);if(jt.isError(dr))return dr;qt.any?zt=jt.raw(Qt):jt=dr}if(Kt&&Kt.track&&qt.tag!==null&&Kt.track(jt.path(),tr,jt.length,"tagged"),Kt&&Kt.track&&qt.tag!==null&&Kt.track(jt.path(),jt.offset,jt.length,"content"),qt.any?zt=zt:qt.choice===null?zt=this._decodeGeneric(qt.tag,jt,Kt):zt=this._decodeChoice(jt,Kt),jt.isError(zt))return zt;if(!qt.any&&qt.choice===null&&qt.children!==null&&qt.children.forEach(function(Ir){Ir._decode(jt,Kt)}),qt.contains&&(qt.tag==="octstr"||qt.tag==="bitstr")){var vr=new _t(zt);zt=this._getUse(qt.contains,jt._reporterState.obj)._decode(vr,Kt)}}return qt.obj&&Vt&&(zt=jt.leaveObject(Xt)),qt.key!==null&&(zt!==null||Vt===!0)?jt.leaveKey(Ht,qt.key,zt):Ht!==null&&jt.exitKey(Ht),zt},Nt.prototype._decodeGeneric=function(jt,Kt,qt){var zt=this._baseState;return jt==="seq"||jt==="set"?null:jt==="seqof"||jt==="setof"?this._decodeList(Kt,jt,zt.args[0],qt):/str$/.test(jt)?this._decodeStr(Kt,jt,qt):jt==="objid"&&zt.args?this._decodeObjid(Kt,zt.args[0],zt.args[1],qt):jt==="objid"?this._decodeObjid(Kt,null,null,qt):jt==="gentime"||jt==="utctime"?this._decodeTime(Kt,jt,qt):jt==="null_"?this._decodeNull(Kt,qt):jt==="bool"?this._decodeBool(Kt,qt):jt==="objDesc"?this._decodeStr(Kt,jt,qt):jt==="int"||jt==="enum"?this._decodeInt(Kt,zt.args&&zt.args[0],qt):zt.use!==null?this._getUse(zt.use,Kt._reporterState.obj)._decode(Kt,qt):Kt.error("unknown tag: "+jt)},Nt.prototype._getUse=function(jt,Kt){var qt=this._baseState;return qt.useDecoder=this._use(jt,Kt),At(qt.useDecoder._baseState.parent===null),qt.useDecoder=qt.useDecoder._baseState.children[0],qt.implicit!==qt.useDecoder._baseState.implicit&&(qt.useDecoder=qt.useDecoder.clone(),qt.useDecoder._baseState.implicit=qt.implicit),qt.useDecoder},Nt.prototype._decodeChoice=function(jt,Kt){var qt=this._baseState,zt=null,Vt=!1;return Object.keys(qt.choice).some(function(Ht){var Wt=jt.save(),Qt=qt.choice[Ht];try{var Xt=Qt._decode(jt,Kt);if(jt.isError(Xt))return!1;zt={type:Ht,value:Xt},Vt=!0}catch{return jt.restore(Wt),!1}return!0},this),Vt?zt:jt.error("Choice not matched")},Nt.prototype._createEncoderBuffer=function(jt){return new e(jt,this.reporter)},Nt.prototype._encode=function(jt,Kt,qt){var zt=this._baseState;if(!(zt.default!==null&&zt.default===jt)){var Vt=this._encodeValue(jt,Kt,qt);if(Vt!==void 0&&!this._skipDefault(Vt,Kt,qt))return Vt}},Nt.prototype._encodeValue=function(jt,Kt,qt){var zt=this._baseState;if(zt.parent===null)return zt.children[0]._encode(jt,Kt||new $t);var Qt=null;if(this.reporter=Kt,zt.optional&&jt===void 0)if(zt.default!==null)jt=zt.default;else return;var Vt=null,Ht=!1;if(zt.any)Qt=this._createEncoderBuffer(jt);else if(zt.choice)Qt=this._encodeChoice(jt,Kt);else if(zt.contains)Vt=this._getUse(zt.contains,qt)._encode(jt,Kt),Ht=!0;else if(zt.children)Vt=zt.children.map(function(tr){if(tr._baseState.tag==="null_")return tr._encode(null,Kt,jt);if(tr._baseState.key===null)return Kt.error("Child should have a key");var dr=Kt.enterKey(tr._baseState.key);if(typeof jt!="object")return Kt.error("Child expected, but input is not object");var vr=tr._encode(jt[tr._baseState.key],Kt,jt);return Kt.leaveKey(dr),vr},this).filter(function(tr){return tr}),Vt=this._createEncoderBuffer(Vt);else if(zt.tag==="seqof"||zt.tag==="setof"){if(!(zt.args&&zt.args.length===1))return Kt.error("Too many args for : "+zt.tag);if(!Array.isArray(jt))return Kt.error("seqof/setof, but data is not Array");var Wt=this.clone();Wt._baseState.implicit=null,Vt=this._createEncoderBuffer(jt.map(function(tr){var dr=this._baseState;return this._getUse(dr.args[0],jt)._encode(tr,Kt)},Wt))}else zt.use!==null?Qt=this._getUse(zt.use,qt)._encode(jt,Kt):(Vt=this._encodePrimitive(zt.tag,jt),Ht=!0);var Qt;if(!zt.any&&zt.choice===null){var Xt=zt.implicit!==null?zt.implicit:zt.tag,Jt=zt.implicit===null?"universal":"context";Xt===null?zt.use===null&&Kt.error("Tag could be omitted only for .use()"):zt.use===null&&(Qt=this._encodeComposite(Xt,Ht,Jt,Vt))}return zt.explicit!==null&&(Qt=this._encodeComposite(zt.explicit,!1,"context",Qt)),Qt},Nt.prototype._encodeChoice=function(jt,Kt){var qt=this._baseState,zt=qt.choice[jt.type];return zt||At(!1,jt.type+" not found in "+JSON.stringify(Object.keys(qt.choice))),zt._encode(jt.value,Kt)},Nt.prototype._encodePrimitive=function(jt,Kt){var qt=this._baseState;if(/str$/.test(jt))return this._encodeStr(Kt,jt);if(jt==="objid"&&qt.args)return this._encodeObjid(Kt,qt.reverseArgs[0],qt.args[1]);if(jt==="objid")return this._encodeObjid(Kt,null,null);if(jt==="gentime"||jt==="utctime")return this._encodeTime(Kt,jt);if(jt==="null_")return this._encodeNull();if(jt==="int"||jt==="enum")return this._encodeInt(Kt,qt.args&&qt.reverseArgs[0]);if(jt==="bool")return this._encodeBool(Kt);if(jt==="objDesc")return this._encodeStr(Kt,jt);throw new Error("Unsupported tag: "+jt)},Nt.prototype._isNumstr=function(jt){return/^[0-9 ]*$/.test(jt)},Nt.prototype._isPrintstr=function(jt){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(jt)},node}var hasRequiredBase;function requireBase(){return hasRequiredBase||(hasRequiredBase=1,function($t){var e=$t;e.Reporter=reporter.Reporter,e.DecoderBuffer=requireBuffer().DecoderBuffer,e.EncoderBuffer=requireBuffer().EncoderBuffer,e.Node=requireNode()}(base$1)),base$1}var constants={},der={},hasRequiredDer$2;function requireDer$2(){return hasRequiredDer$2||(hasRequiredDer$2=1,function($t){var e=requireConstants();$t.tagClass={0:"universal",1:"application",2:"context",3:"private"},$t.tagClassByName=e._reverse($t.tagClass),$t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},$t.tagByName=e._reverse($t.tag)}(der)),der}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,function($t){var e=$t;e._reverse=function(At){var xt={};return Object.keys(At).forEach(function(kt){(kt|0)==kt&&(kt=kt|0);var Bt=At[kt];xt[Bt]=kt}),xt},e.der=requireDer$2()}(constants)),constants}var decoders={},der_1$1,hasRequiredDer$1;function requireDer$1(){if(hasRequiredDer$1)return der_1$1;hasRequiredDer$1=1;var $t=inherits_browserExports,e=requireAsn1(),_t=e.base,At=e.bignum,xt=e.constants.der;function kt(Lt){this.enc="der",this.name=Lt.name,this.entity=Lt,this.tree=new Bt,this.tree._init(Lt.body)}der_1$1=kt,kt.prototype.decode=function(jt,Kt){return jt instanceof _t.DecoderBuffer||(jt=new _t.DecoderBuffer(jt,Kt)),this.tree._decode(jt,Kt)};function Bt(Lt){_t.Node.call(this,"der",Lt)}$t(Bt,_t.Node),Bt.prototype._peekTag=function(jt,Kt,qt){if(jt.isEmpty())return!1;var zt=jt.save(),Vt=Nt(jt,'Failed to peek tag: "'+Kt+'"');return jt.isError(Vt)?Vt:(jt.restore(zt),Vt.tag===Kt||Vt.tagStr===Kt||Vt.tagStr+"of"===Kt||qt)},Bt.prototype._decodeTag=function(jt,Kt,qt){var zt=Nt(jt,'Failed to decode tag of "'+Kt+'"');if(jt.isError(zt))return zt;var Vt=Ut(jt,zt.primitive,'Failed to get length of "'+Kt+'"');if(jt.isError(Vt))return Vt;if(!qt&&zt.tag!==Kt&&zt.tagStr!==Kt&&zt.tagStr+"of"!==Kt)return jt.error('Failed to match tag: "'+Kt+'"');if(zt.primitive||Vt!==null)return jt.skip(Vt,'Failed to match body of: "'+Kt+'"');var Ht=jt.save(),Wt=this._skipUntilEnd(jt,'Failed to skip indefinite length body: "'+this.tag+'"');return jt.isError(Wt)?Wt:(Vt=jt.offset-Ht.offset,jt.restore(Ht),jt.skip(Vt,'Failed to match body of: "'+Kt+'"'))},Bt.prototype._skipUntilEnd=function(jt,Kt){for(;;){var qt=Nt(jt,Kt);if(jt.isError(qt))return qt;var zt=Ut(jt,qt.primitive,Kt);if(jt.isError(zt))return zt;var Vt;if(qt.primitive||zt!==null?Vt=jt.skip(zt):Vt=this._skipUntilEnd(jt,Kt),jt.isError(Vt))return Vt;if(qt.tagStr==="end")break}},Bt.prototype._decodeList=function(jt,Kt,qt,zt){for(var Vt=[];!jt.isEmpty();){var Ht=this._peekTag(jt,"end");if(jt.isError(Ht))return Ht;var Wt=qt.decode(jt,"der",zt);if(jt.isError(Wt)&&Ht)break;Vt.push(Wt)}return Vt},Bt.prototype._decodeStr=function(jt,Kt){if(Kt==="bitstr"){var qt=jt.readUInt8();return jt.isError(qt)?qt:{unused:qt,data:jt.raw()}}else if(Kt==="bmpstr"){var zt=jt.raw();if(zt.length%2===1)return jt.error("Decoding of string type: bmpstr length mismatch");for(var Vt="",Ht=0;Ht<zt.length/2;Ht++)Vt+=String.fromCharCode(zt.readUInt16BE(Ht*2));return Vt}else if(Kt==="numstr"){var Wt=jt.raw().toString("ascii");return this._isNumstr(Wt)?Wt:jt.error("Decoding of string type: numstr unsupported characters")}else{if(Kt==="octstr")return jt.raw();if(Kt==="objDesc")return jt.raw();if(Kt==="printstr"){var Qt=jt.raw().toString("ascii");return this._isPrintstr(Qt)?Qt:jt.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(Kt)?jt.raw().toString():jt.error("Decoding of string type: "+Kt+" unsupported")}},Bt.prototype._decodeObjid=function(jt,Kt,qt){for(var zt,Vt=[],Ht=0;!jt.isEmpty();){var Wt=jt.readUInt8();Ht<<=7,Ht|=Wt&127,Wt&128||(Vt.push(Ht),Ht=0)}Wt&128&&Vt.push(Ht);var Qt=Vt[0]/40|0,Xt=Vt[0]%40;if(qt?zt=Vt:zt=[Qt,Xt].concat(Vt.slice(1)),Kt){var Jt=Kt[zt.join(" ")];Jt===void 0&&(Jt=Kt[zt.join(".")]),Jt!==void 0&&(zt=Jt)}return zt},Bt.prototype._decodeTime=function(jt,Kt){var qt=jt.raw().toString();if(Kt==="gentime")var zt=qt.slice(0,4)|0,Vt=qt.slice(4,6)|0,Ht=qt.slice(6,8)|0,Wt=qt.slice(8,10)|0,Qt=qt.slice(10,12)|0,Xt=qt.slice(12,14)|0;else if(Kt==="utctime"){var zt=qt.slice(0,2)|0,Vt=qt.slice(2,4)|0,Ht=qt.slice(4,6)|0,Wt=qt.slice(6,8)|0,Qt=qt.slice(8,10)|0,Xt=qt.slice(10,12)|0;zt<70?zt=2e3+zt:zt=1900+zt}else return jt.error("Decoding "+Kt+" time is not supported yet");return Date.UTC(zt,Vt-1,Ht,Wt,Qt,Xt,0)},Bt.prototype._decodeNull=function(jt){return null},Bt.prototype._decodeBool=function(jt){var Kt=jt.readUInt8();return jt.isError(Kt)?Kt:Kt!==0},Bt.prototype._decodeInt=function(jt,Kt){var qt=jt.raw(),zt=new At(qt);return Kt&&(zt=Kt[zt.toString(10)]||zt),zt},Bt.prototype._use=function(jt,Kt){return typeof jt=="function"&&(jt=jt(Kt)),jt._getDecoder("der").tree};function Nt(Lt,jt){var Kt=Lt.readUInt8(jt);if(Lt.isError(Kt))return Kt;var qt=xt.tagClass[Kt>>6],zt=(Kt&32)===0;if((Kt&31)===31){var Vt=Kt;for(Kt=0;(Vt&128)===128;){if(Vt=Lt.readUInt8(jt),Lt.isError(Vt))return Vt;Kt<<=7,Kt|=Vt&127}}else Kt&=31;var Ht=xt.tag[Kt];return{cls:qt,primitive:zt,tag:Kt,tagStr:Ht}}function Ut(Lt,jt,Kt){var qt=Lt.readUInt8(Kt);if(Lt.isError(qt))return qt;if(!jt&&qt===128)return null;if(!(qt&128))return qt;var zt=qt&127;if(zt>4)return Lt.error("length octect is too long");qt=0;for(var Vt=0;Vt<zt;Vt++){qt<<=8;var Ht=Lt.readUInt8(Kt);if(Lt.isError(Ht))return Ht;qt|=Ht}return qt}return der_1$1}var pem$1,hasRequiredPem$1;function requirePem$1(){if(hasRequiredPem$1)return pem$1;hasRequiredPem$1=1;var $t=inherits_browserExports,e=buffer$2.Buffer,_t=requireDer$1();function At(xt){_t.call(this,xt),this.enc="pem"}return $t(At,_t),pem$1=At,At.prototype.decode=function(kt,Bt){for(var Nt=kt.toString().split(/[\r\n]+/g),Ut=Bt.label.toUpperCase(),Lt=/^-----(BEGIN|END) ([^-]+)-----$/,jt=-1,Kt=-1,qt=0;qt<Nt.length;qt++){var zt=Nt[qt].match(Lt);if(zt!==null&&zt[2]===Ut)if(jt===-1){if(zt[1]!=="BEGIN")break;jt=qt}else{if(zt[1]!=="END")break;Kt=qt;break}}if(jt===-1||Kt===-1)throw new Error("PEM section not found for: "+Ut);var Vt=Nt.slice(jt+1,Kt).join("");Vt.replace(/[^a-z0-9\+\/=]+/gi,"");var Ht=new e(Vt,"base64");return _t.prototype.decode.call(this,Ht,Bt)},pem$1}var hasRequiredDecoders;function requireDecoders(){return hasRequiredDecoders||(hasRequiredDecoders=1,function($t){var e=$t;e.der=requireDer$1(),e.pem=requirePem$1()}(decoders)),decoders}var encoders={},der_1,hasRequiredDer;function requireDer(){if(hasRequiredDer)return der_1;hasRequiredDer=1;var $t=inherits_browserExports,e=buffer$2.Buffer,_t=requireAsn1(),At=_t.base,xt=_t.constants.der;function kt(Lt){this.enc="der",this.name=Lt.name,this.entity=Lt,this.tree=new Bt,this.tree._init(Lt.body)}der_1=kt,kt.prototype.encode=function(jt,Kt){return this.tree._encode(jt,Kt).join()};function Bt(Lt){At.Node.call(this,"der",Lt)}$t(Bt,At.Node),Bt.prototype._encodeComposite=function(jt,Kt,qt,zt){var Vt=Ut(jt,Kt,qt,this.reporter);if(zt.length<128){var Qt=new e(2);return Qt[0]=Vt,Qt[1]=zt.length,this._createEncoderBuffer([Qt,zt])}for(var Ht=1,Wt=zt.length;Wt>=256;Wt>>=8)Ht++;var Qt=new e(2+Ht);Qt[0]=Vt,Qt[1]=128|Ht;for(var Wt=1+Ht,Xt=zt.length;Xt>0;Wt--,Xt>>=8)Qt[Wt]=Xt&255;return this._createEncoderBuffer([Qt,zt])},Bt.prototype._encodeStr=function(jt,Kt){if(Kt==="bitstr")return this._createEncoderBuffer([jt.unused|0,jt.data]);if(Kt==="bmpstr"){for(var qt=new e(jt.length*2),zt=0;zt<jt.length;zt++)qt.writeUInt16BE(jt.charCodeAt(zt),zt*2);return this._createEncoderBuffer(qt)}else return Kt==="numstr"?this._isNumstr(jt)?this._createEncoderBuffer(jt):this.reporter.error("Encoding of string type: numstr supports only digits and space"):Kt==="printstr"?this._isPrintstr(jt)?this._createEncoderBuffer(jt):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(Kt)?this._createEncoderBuffer(jt):Kt==="objDesc"?this._createEncoderBuffer(jt):this.reporter.error("Encoding of string type: "+Kt+" unsupported")},Bt.prototype._encodeObjid=function(jt,Kt,qt){if(typeof jt=="string"){if(!Kt)return this.reporter.error("string objid given, but no values map found");if(!Kt.hasOwnProperty(jt))return this.reporter.error("objid not found in values map");jt=Kt[jt].split(/[\s\.]+/g);for(var zt=0;zt<jt.length;zt++)jt[zt]|=0}else if(Array.isArray(jt)){jt=jt.slice();for(var zt=0;zt<jt.length;zt++)jt[zt]|=0}if(!Array.isArray(jt))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(jt));if(!qt){if(jt[1]>=40)return this.reporter.error("Second objid identifier OOB");jt.splice(0,2,jt[0]*40+jt[1])}for(var Vt=0,zt=0;zt<jt.length;zt++){var Ht=jt[zt];for(Vt++;Ht>=128;Ht>>=7)Vt++}for(var Wt=new e(Vt),Qt=Wt.length-1,zt=jt.length-1;zt>=0;zt--){var Ht=jt[zt];for(Wt[Qt--]=Ht&127;(Ht>>=7)>0;)Wt[Qt--]=128|Ht&127}return this._createEncoderBuffer(Wt)};function Nt(Lt){return Lt<10?"0"+Lt:Lt}Bt.prototype._encodeTime=function(jt,Kt){var qt,zt=new Date(jt);return Kt==="gentime"?qt=[Nt(zt.getFullYear()),Nt(zt.getUTCMonth()+1),Nt(zt.getUTCDate()),Nt(zt.getUTCHours()),Nt(zt.getUTCMinutes()),Nt(zt.getUTCSeconds()),"Z"].join(""):Kt==="utctime"?qt=[Nt(zt.getFullYear()%100),Nt(zt.getUTCMonth()+1),Nt(zt.getUTCDate()),Nt(zt.getUTCHours()),Nt(zt.getUTCMinutes()),Nt(zt.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+Kt+" time is not supported yet"),this._encodeStr(qt,"octstr")},Bt.prototype._encodeNull=function(){return this._createEncoderBuffer("")},Bt.prototype._encodeInt=function(jt,Kt){if(typeof jt=="string"){if(!Kt)return this.reporter.error("String int or enum given, but no values map");if(!Kt.hasOwnProperty(jt))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(jt));jt=Kt[jt]}if(typeof jt!="number"&&!e.isBuffer(jt)){var qt=jt.toArray();!jt.sign&&qt[0]&128&&qt.unshift(0),jt=new e(qt)}if(e.isBuffer(jt)){var zt=jt.length;jt.length===0&&zt++;var Ht=new e(zt);return jt.copy(Ht),jt.length===0&&(Ht[0]=0),this._createEncoderBuffer(Ht)}if(jt<128)return this._createEncoderBuffer(jt);if(jt<256)return this._createEncoderBuffer([0,jt]);for(var zt=1,Vt=jt;Vt>=256;Vt>>=8)zt++;for(var Ht=new Array(zt),Vt=Ht.length-1;Vt>=0;Vt--)Ht[Vt]=jt&255,jt>>=8;return Ht[0]&128&&Ht.unshift(0),this._createEncoderBuffer(new e(Ht))},Bt.prototype._encodeBool=function(jt){return this._createEncoderBuffer(jt?255:0)},Bt.prototype._use=function(jt,Kt){return typeof jt=="function"&&(jt=jt(Kt)),jt._getEncoder("der").tree},Bt.prototype._skipDefault=function(jt,Kt,qt){var zt=this._baseState,Vt;if(zt.default===null)return!1;var Ht=jt.join();if(zt.defaultBuffer===void 0&&(zt.defaultBuffer=this._encodeValue(zt.default,Kt,qt).join()),Ht.length!==zt.defaultBuffer.length)return!1;for(Vt=0;Vt<Ht.length;Vt++)if(Ht[Vt]!==zt.defaultBuffer[Vt])return!1;return!0};function Ut(Lt,jt,Kt,qt){var zt;if(Lt==="seqof"?Lt="seq":Lt==="setof"&&(Lt="set"),xt.tagByName.hasOwnProperty(Lt))zt=xt.tagByName[Lt];else if(typeof Lt=="number"&&(Lt|0)===Lt)zt=Lt;else return qt.error("Unknown tag: "+Lt);return zt>=31?qt.error("Multi-octet tag encoding unsupported"):(jt||(zt|=32),zt|=xt.tagClassByName[Kt||"universal"]<<6,zt)}return der_1}var pem,hasRequiredPem;function requirePem(){if(hasRequiredPem)return pem;hasRequiredPem=1;var $t=inherits_browserExports,e=requireDer();function _t(At){e.call(this,At),this.enc="pem"}return $t(_t,e),pem=_t,_t.prototype.encode=function(xt,kt){for(var Bt=e.prototype.encode.call(this,xt),Nt=Bt.toString("base64"),Ut=["-----BEGIN "+kt.label+"-----"],Lt=0;Lt<Nt.length;Lt+=64)Ut.push(Nt.slice(Lt,Lt+64));return Ut.push("-----END "+kt.label+"-----"),Ut.join(`
`)},pem}var hasRequiredEncoders;function requireEncoders(){return hasRequiredEncoders||(hasRequiredEncoders=1,function($t){var e=$t;e.der=requireDer(),e.pem=requirePem()}(encoders)),encoders}var hasRequiredAsn1;function requireAsn1(){return hasRequiredAsn1||(hasRequiredAsn1=1,function($t){var e=$t;e.bignum=bnExports$1,e.define=requireApi().define,e.base=requireBase(),e.constants=requireConstants(),e.decoders=requireDecoders(),e.encoders=requireEncoders()}(asn1$2)),asn1$2}var asn=requireAsn1(),Time$1=asn.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),AttributeTypeValue=asn.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),AlgorithmIdentifier$1=asn.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),SubjectPublicKeyInfo=asn.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier$1),this.key("subjectPublicKey").bitstr())}),RelativeDistinguishedName=asn.define("RelativeDistinguishedName",function(){this.setof(AttributeTypeValue)}),RDNSequence=asn.define("RDNSequence",function(){this.seqof(RelativeDistinguishedName)}),Name=asn.define("Name",function(){this.choice({rdnSequence:this.use(RDNSequence)})}),Validity=asn.define("Validity",function(){this.seq().obj(this.key("notBefore").use(Time$1),this.key("notAfter").use(Time$1))}),Extension=asn.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),TBSCertificate=asn.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(AlgorithmIdentifier$1),this.key("issuer").use(Name),this.key("validity").use(Validity),this.key("subject").use(Name),this.key("subjectPublicKeyInfo").use(SubjectPublicKeyInfo),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(Extension).optional())}),X509Certificate=asn.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(TBSCertificate),this.key("signatureAlgorithm").use(AlgorithmIdentifier$1),this.key("signatureValue").bitstr())}),certificate=X509Certificate,asn1$1=requireAsn1();asn1$3.certificate=certificate;var RSAPrivateKey=asn1$1.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});asn1$3.RSAPrivateKey=RSAPrivateKey;var RSAPublicKey=asn1$1.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});asn1$3.RSAPublicKey=RSAPublicKey;var AlgorithmIdentifier=asn1$1.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),PublicKey$2=asn1$1.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPublicKey").bitstr())});asn1$3.PublicKey=PublicKey$2;var PrivateKeyInfo=asn1$1.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPrivateKey").octstr())});asn1$3.PrivateKey=PrivateKeyInfo;var EncryptedPrivateKeyInfo=asn1$1.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});asn1$3.EncryptedPrivateKey=EncryptedPrivateKeyInfo;var DSAPrivateKey=asn1$1.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});asn1$3.DSAPrivateKey=DSAPrivateKey;asn1$3.DSAparam=asn1$1.define("DSAparam",function(){this.int()});var ECParameters=asn1$1.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),ECPrivateKey=asn1$1.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(ECParameters),this.key("publicKey").optional().explicit(1).bitstr())});asn1$3.ECPrivateKey=ECPrivateKey;asn1$3.signature=asn1$1.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())});const require$$1$2={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};var findProc=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,startRegex=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,fullRegex=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,evp=evp_bytestokey,ciphers$1=browser$8,Buffer$c=safeBufferExports$1.Buffer,fixProc$1=function($t,e){var _t=$t.toString(),At=_t.match(findProc),xt;if(At){var Bt="aes"+At[1],Nt=Buffer$c.from(At[2],"hex"),Ut=Buffer$c.from(At[3].replace(/[\r\n]/g,""),"base64"),Lt=evp(e,Nt.slice(0,8),parseInt(At[1],10)).key,jt=[],Kt=ciphers$1.createDecipheriv(Bt,Lt,Nt);jt.push(Kt.update(Ut)),jt.push(Kt.final()),xt=Buffer$c.concat(jt)}else{var kt=_t.match(fullRegex);xt=Buffer$c.from(kt[2].replace(/[\r\n]/g,""),"base64")}var qt=_t.match(startRegex)[1];return{tag:qt,data:xt}},asn1=asn1$3,aesid=require$$1$2,fixProc=fixProc$1,ciphers=browser$8,compat$1=browser$a,Buffer$b=safeBufferExports$1.Buffer;function decrypt($t,e){var _t=$t.algorithm.decrypt.kde.kdeparams.salt,At=parseInt($t.algorithm.decrypt.kde.kdeparams.iters.toString(),10),xt=aesid[$t.algorithm.decrypt.cipher.algo.join(".")],kt=$t.algorithm.decrypt.cipher.iv,Bt=$t.subjectPrivateKey,Nt=parseInt(xt.split("-")[1],10)/8,Ut=compat$1.pbkdf2Sync(e,_t,At,Nt,"sha1"),Lt=ciphers.createDecipheriv(xt,Ut,kt),jt=[];return jt.push(Lt.update(Bt)),jt.push(Lt.final()),Buffer$b.concat(jt)}function parseKeys$2($t){var e;typeof $t=="object"&&!Buffer$b.isBuffer($t)&&(e=$t.passphrase,$t=$t.key),typeof $t=="string"&&($t=Buffer$b.from($t));var _t=fixProc($t,e),At=_t.tag,xt=_t.data,kt,Bt;switch(At){case"CERTIFICATE":Bt=asn1.certificate.decode(xt,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(Bt||(Bt=asn1.PublicKey.decode(xt,"der")),kt=Bt.algorithm.algorithm.join("."),kt){case"1.2.840.113549.1.1.1":return asn1.RSAPublicKey.decode(Bt.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return Bt.subjectPrivateKey=Bt.subjectPublicKey,{type:"ec",data:Bt};case"1.2.840.10040.4.1":return Bt.algorithm.params.pub_key=asn1.DSAparam.decode(Bt.subjectPublicKey.data,"der"),{type:"dsa",data:Bt.algorithm.params};default:throw new Error("unknown key id "+kt)}case"ENCRYPTED PRIVATE KEY":xt=asn1.EncryptedPrivateKey.decode(xt,"der"),xt=decrypt(xt,e);case"PRIVATE KEY":switch(Bt=asn1.PrivateKey.decode(xt,"der"),kt=Bt.algorithm.algorithm.join("."),kt){case"1.2.840.113549.1.1.1":return asn1.RSAPrivateKey.decode(Bt.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:Bt.algorithm.curve,privateKey:asn1.ECPrivateKey.decode(Bt.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return Bt.algorithm.params.priv_key=asn1.DSAparam.decode(Bt.subjectPrivateKey,"der"),{type:"dsa",params:Bt.algorithm.params};default:throw new Error("unknown key id "+kt)}case"RSA PUBLIC KEY":return asn1.RSAPublicKey.decode(xt,"der");case"RSA PRIVATE KEY":return asn1.RSAPrivateKey.decode(xt,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:asn1.DSAPrivateKey.decode(xt,"der")};case"EC PRIVATE KEY":return xt=asn1.ECPrivateKey.decode(xt,"der"),{curve:xt.parameters.value,privateKey:xt.privateKey};default:throw new Error("unknown key type "+At)}}parseKeys$2.signature=asn1.signature;var parseAsn1=parseKeys$2;const require$$4$1={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"};var hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign.exports;hasRequiredSign=1;var $t=safeBufferExports$1.Buffer,e=browser$b,_t=browserifyRsa,At=requireElliptic().ec,xt=bnExports,kt=parseAsn1,Bt=require$$4$1,Nt=1;function Ut(Qt,Xt,Jt,tr,dr){var vr=kt(Xt);if(vr.curve){if(tr!=="ecdsa"&&tr!=="ecdsa/rsa")throw new Error("wrong private key type");return Lt(Qt,vr)}else if(vr.type==="dsa"){if(tr!=="dsa")throw new Error("wrong private key type");return jt(Qt,vr,Jt)}if(tr!=="rsa"&&tr!=="ecdsa/rsa")throw new Error("wrong private key type");if(Xt.padding!==void 0&&Xt.padding!==Nt)throw new Error("illegal or unsupported padding mode");Qt=$t.concat([dr,Qt]);for(var $r=vr.modulus.byteLength(),Ir=[0,1];Qt.length+Ir.length+1<$r;)Ir.push(255);Ir.push(0);for(var Rr=-1;++Rr<Qt.length;)Ir.push(Qt[Rr]);var Nr=_t(Ir,vr);return Nr}function Lt(Qt,Xt){var Jt=Bt[Xt.curve.join(".")];if(!Jt)throw new Error("unknown curve "+Xt.curve.join("."));var tr=new At(Jt),dr=tr.keyFromPrivate(Xt.privateKey),vr=dr.sign(Qt);return $t.from(vr.toDER())}function jt(Qt,Xt,Jt){for(var tr=Xt.params.priv_key,dr=Xt.params.p,vr=Xt.params.q,$r=Xt.params.g,Ir=new xt(0),Rr,Nr=zt(Qt,vr).mod(vr),kr=!1,lr=qt(tr,vr,Qt,Jt);kr===!1;)Rr=Ht(vr,lr,Jt),Ir=Wt($r,Rr,dr,vr),kr=Rr.invm(vr).imul(Nr.add(tr.mul(Ir))).mod(vr),kr.cmpn(0)===0&&(kr=!1,Ir=new xt(0));return Kt(Ir,kr)}function Kt(Qt,Xt){Qt=Qt.toArray(),Xt=Xt.toArray(),Qt[0]&128&&(Qt=[0].concat(Qt)),Xt[0]&128&&(Xt=[0].concat(Xt));var Jt=Qt.length+Xt.length+4,tr=[48,Jt,2,Qt.length];return tr=tr.concat(Qt,[2,Xt.length],Xt),$t.from(tr)}function qt(Qt,Xt,Jt,tr){if(Qt=$t.from(Qt.toArray()),Qt.length<Xt.byteLength()){var dr=$t.alloc(Xt.byteLength()-Qt.length);Qt=$t.concat([dr,Qt])}var vr=Jt.length,$r=Vt(Jt,Xt),Ir=$t.alloc(vr);Ir.fill(1);var Rr=$t.alloc(vr);return Rr=e(tr,Rr).update(Ir).update($t.from([0])).update(Qt).update($r).digest(),Ir=e(tr,Rr).update(Ir).digest(),Rr=e(tr,Rr).update(Ir).update($t.from([1])).update(Qt).update($r).digest(),Ir=e(tr,Rr).update(Ir).digest(),{k:Rr,v:Ir}}function zt(Qt,Xt){var Jt=new xt(Qt),tr=(Qt.length<<3)-Xt.bitLength();return tr>0&&Jt.ishrn(tr),Jt}function Vt(Qt,Xt){Qt=zt(Qt,Xt),Qt=Qt.mod(Xt);var Jt=$t.from(Qt.toArray());if(Jt.length<Xt.byteLength()){var tr=$t.alloc(Xt.byteLength()-Jt.length);Jt=$t.concat([tr,Jt])}return Jt}function Ht(Qt,Xt,Jt){var tr,dr;do{for(tr=$t.alloc(0);tr.length*8<Qt.bitLength();)Xt.v=e(Jt,Xt.k).update(Xt.v).digest(),tr=$t.concat([tr,Xt.v]);dr=zt(tr,Qt),Xt.k=e(Jt,Xt.k).update(Xt.v).update($t.from([0])).digest(),Xt.v=e(Jt,Xt.k).update(Xt.v).digest()}while(dr.cmp(Qt)!==-1);return dr}function Wt(Qt,Xt,Jt,tr){return Qt.toRed(xt.mont(Jt)).redPow(Xt).fromRed().mod(tr)}return sign.exports=Ut,sign.exports.getKey=qt,sign.exports.makeKey=Ht,sign.exports}var verify_1,hasRequiredVerify;function requireVerify(){if(hasRequiredVerify)return verify_1;hasRequiredVerify=1;var $t=safeBufferExports$1.Buffer,e=bnExports,_t=requireElliptic().ec,At=parseAsn1,xt=require$$4$1;function kt(Lt,jt,Kt,qt,zt){var Vt=At(Kt);if(Vt.type==="ec"){if(qt!=="ecdsa"&&qt!=="ecdsa/rsa")throw new Error("wrong public key type");return Bt(Lt,jt,Vt)}else if(Vt.type==="dsa"){if(qt!=="dsa")throw new Error("wrong public key type");return Nt(Lt,jt,Vt)}if(qt!=="rsa"&&qt!=="ecdsa/rsa")throw new Error("wrong public key type");jt=$t.concat([zt,jt]);for(var Ht=Vt.modulus.byteLength(),Wt=[1],Qt=0;jt.length+Wt.length+2<Ht;)Wt.push(255),Qt+=1;Wt.push(0);for(var Xt=-1;++Xt<jt.length;)Wt.push(jt[Xt]);Wt=$t.from(Wt);var Jt=e.mont(Vt.modulus);Lt=new e(Lt).toRed(Jt),Lt=Lt.redPow(new e(Vt.publicExponent)),Lt=$t.from(Lt.fromRed().toArray());var tr=Qt<8?1:0;for(Ht=Math.min(Lt.length,Wt.length),Lt.length!==Wt.length&&(tr=1),Xt=-1;++Xt<Ht;)tr|=Lt[Xt]^Wt[Xt];return tr===0}function Bt(Lt,jt,Kt){var qt=xt[Kt.data.algorithm.curve.join(".")];if(!qt)throw new Error("unknown curve "+Kt.data.algorithm.curve.join("."));var zt=new _t(qt),Vt=Kt.data.subjectPrivateKey.data;return zt.verify(jt,Lt,Vt)}function Nt(Lt,jt,Kt){var qt=Kt.data.p,zt=Kt.data.q,Vt=Kt.data.g,Ht=Kt.data.pub_key,Wt=At.signature.decode(Lt,"der"),Qt=Wt.s,Xt=Wt.r;Ut(Qt,zt),Ut(Xt,zt);var Jt=e.mont(qt),tr=Qt.invm(zt),dr=Vt.toRed(Jt).redPow(new e(jt).mul(tr).mod(zt)).fromRed().mul(Ht.toRed(Jt).redPow(Xt.mul(tr).mod(zt)).fromRed()).mod(qt).mod(zt);return dr.cmp(Xt)===0}function Ut(Lt,jt){if(Lt.cmpn(0)<=0)throw new Error("invalid sig");if(Lt.cmp(jt)>=0)throw new Error("invalid sig")}return verify_1=kt,verify_1}var browser$6,hasRequiredBrowser$2;function requireBrowser$2(){if(hasRequiredBrowser$2)return browser$6;hasRequiredBrowser$2=1;var $t=safeBufferExports$1.Buffer,e=browser$c,_t=readableBrowserExports,At=inherits_browserExports,xt=requireSign(),kt=requireVerify(),Bt=require$$6$1;Object.keys(Bt).forEach(function(Kt){Bt[Kt].id=$t.from(Bt[Kt].id,"hex"),Bt[Kt.toLowerCase()]=Bt[Kt]});function Nt(Kt){_t.Writable.call(this);var qt=Bt[Kt];if(!qt)throw new Error("Unknown message digest");this._hashType=qt.hash,this._hash=e(qt.hash),this._tag=qt.id,this._signType=qt.sign}At(Nt,_t.Writable),Nt.prototype._write=function(qt,zt,Vt){this._hash.update(qt),Vt()},Nt.prototype.update=function(qt,zt){return this._hash.update(typeof qt=="string"?$t.from(qt,zt):qt),this},Nt.prototype.sign=function(qt,zt){this.end();var Vt=this._hash.digest(),Ht=xt(Vt,qt,this._hashType,this._signType,this._tag);return zt?Ht.toString(zt):Ht};function Ut(Kt){_t.Writable.call(this);var qt=Bt[Kt];if(!qt)throw new Error("Unknown message digest");this._hash=e(qt.hash),this._tag=qt.id,this._signType=qt.sign}At(Ut,_t.Writable),Ut.prototype._write=function(qt,zt,Vt){this._hash.update(qt),Vt()},Ut.prototype.update=function(qt,zt){return this._hash.update(typeof qt=="string"?$t.from(qt,zt):qt),this},Ut.prototype.verify=function(qt,zt,Vt){var Ht=typeof zt=="string"?$t.from(zt,Vt):zt;this.end();var Wt=this._hash.digest();return kt(Ht,Wt,qt,this._signType,this._tag)};function Lt(Kt){return new Nt(Kt)}function jt(Kt){return new Ut(Kt)}return browser$6={Sign:Lt,Verify:jt,createSign:Lt,createVerify:jt},browser$6}var browser$5,hasRequiredBrowser$1;function requireBrowser$1(){if(hasRequiredBrowser$1)return browser$5;hasRequiredBrowser$1=1;var $t=requireElliptic(),e=bnExports$1;browser$5=function(Bt){return new At(Bt)};var _t={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};_t.p224=_t.secp224r1,_t.p256=_t.secp256r1=_t.prime256v1,_t.p192=_t.secp192r1=_t.prime192v1,_t.p384=_t.secp384r1,_t.p521=_t.secp521r1;function At(kt){this.curveType=_t[kt],this.curveType||(this.curveType={name:kt}),this.curve=new $t.ec(this.curveType.name),this.keys=void 0}At.prototype.generateKeys=function(kt,Bt){return this.keys=this.curve.genKeyPair(),this.getPublicKey(kt,Bt)},At.prototype.computeSecret=function(kt,Bt,Nt){Bt=Bt||"utf8",buffer$2.Buffer.isBuffer(kt)||(kt=new buffer$2.Buffer(kt,Bt));var Ut=this.curve.keyFromPublic(kt).getPublic(),Lt=Ut.mul(this.keys.getPrivate()).getX();return xt(Lt,Nt,this.curveType.byteLength)},At.prototype.getPublicKey=function(kt,Bt){var Nt=this.keys.getPublic(Bt==="compressed",!0);return Bt==="hybrid"&&(Nt[Nt.length-1]%2?Nt[0]=7:Nt[0]=6),xt(Nt,kt)},At.prototype.getPrivateKey=function(kt){return xt(this.keys.getPrivate(),kt)},At.prototype.setPublicKey=function(kt,Bt){return Bt=Bt||"utf8",buffer$2.Buffer.isBuffer(kt)||(kt=new buffer$2.Buffer(kt,Bt)),this.keys._importPublic(kt),this},At.prototype.setPrivateKey=function(kt,Bt){Bt=Bt||"utf8",buffer$2.Buffer.isBuffer(kt)||(kt=new buffer$2.Buffer(kt,Bt));var Nt=new e(kt);return Nt=Nt.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(Nt),this};function xt(kt,Bt,Nt){Array.isArray(kt)||(kt=kt.toArray());var Ut=new buffer$2.Buffer(kt);if(Nt&&Ut.length<Nt){var Lt=new buffer$2.Buffer(Nt-Ut.length);Lt.fill(0),Ut=buffer$2.Buffer.concat([Lt,Ut])}return Bt?Ut.toString(Bt):Ut}return browser$5}var browser$4={},createHash$2=browser$c,Buffer$a=safeBufferExports$1.Buffer,mgf$2=function($t,e){for(var _t=Buffer$a.alloc(0),At=0,xt;_t.length<e;)xt=i2ops(At++),_t=Buffer$a.concat([_t,createHash$2("sha1").update($t).update(xt).digest()]);return _t.slice(0,e)};function i2ops($t){var e=Buffer$a.allocUnsafe(4);return e.writeUInt32BE($t,0),e}var xor$2=function $t(e,_t){for(var At=e.length,xt=-1;++xt<At;)e[xt]^=_t[xt];return e},BN$2=bnExports$1,Buffer$9=safeBufferExports$1.Buffer;function withPublic$2($t,e){return Buffer$9.from($t.toRed(BN$2.mont(e.modulus)).redPow(new BN$2(e.publicExponent)).fromRed().toArray())}var withPublic_1=withPublic$2,parseKeys$1=parseAsn1,randomBytes$3=browserExports$2,createHash$1=browser$c,mgf$1=mgf$2,xor$1=xor$2,BN$1=bnExports$1,withPublic$1=withPublic_1,crt$1=browserifyRsa,Buffer$8=safeBufferExports$1.Buffer,publicEncrypt=function $t(e,_t,At){var xt;e.padding?xt=e.padding:At?xt=1:xt=4;var kt=parseKeys$1(e),Bt;if(xt===4)Bt=oaep$1(kt,_t);else if(xt===1)Bt=pkcs1$1(kt,_t,At);else if(xt===3){if(Bt=new BN$1(_t),Bt.cmp(kt.modulus)>=0)throw new Error("data too long for modulus")}else throw new Error("unknown padding");return At?crt$1(Bt,kt):withPublic$1(Bt,kt)};function oaep$1($t,e){var _t=$t.modulus.byteLength(),At=e.length,xt=createHash$1("sha1").update(Buffer$8.alloc(0)).digest(),kt=xt.length,Bt=2*kt;if(At>_t-Bt-2)throw new Error("message too long");var Nt=Buffer$8.alloc(_t-At-Bt-2),Ut=_t-kt-1,Lt=randomBytes$3(kt),jt=xor$1(Buffer$8.concat([xt,Nt,Buffer$8.alloc(1,1),e],Ut),mgf$1(Lt,Ut)),Kt=xor$1(Lt,mgf$1(jt,kt));return new BN$1(Buffer$8.concat([Buffer$8.alloc(1),Kt,jt],_t))}function pkcs1$1($t,e,_t){var At=e.length,xt=$t.modulus.byteLength();if(At>xt-11)throw new Error("message too long");var kt;return _t?kt=Buffer$8.alloc(xt-At-3,255):kt=nonZero(xt-At-3),new BN$1(Buffer$8.concat([Buffer$8.from([0,_t?1:2]),kt,Buffer$8.alloc(1),e],xt))}function nonZero($t){for(var e=Buffer$8.allocUnsafe($t),_t=0,At=randomBytes$3($t*2),xt=0,kt;_t<$t;)xt===At.length&&(At=randomBytes$3($t*2),xt=0),kt=At[xt++],kt&&(e[_t++]=kt);return e}var parseKeys=parseAsn1,mgf=mgf$2,xor=xor$2,BN=bnExports$1,crt=browserifyRsa,createHash=browser$c,withPublic=withPublic_1,Buffer$7=safeBufferExports$1.Buffer,privateDecrypt=function $t(e,_t,At){var xt;e.padding?xt=e.padding:At?xt=1:xt=4;var kt=parseKeys(e),Bt=kt.modulus.byteLength();if(_t.length>Bt||new BN(_t).cmp(kt.modulus)>=0)throw new Error("decryption error");var Nt;At?Nt=withPublic(new BN(_t),kt):Nt=crt(_t,kt);var Ut=Buffer$7.alloc(Bt-Nt.length);if(Nt=Buffer$7.concat([Ut,Nt],Bt),xt===4)return oaep(kt,Nt);if(xt===1)return pkcs1(kt,Nt,At);if(xt===3)return Nt;throw new Error("unknown padding")};function oaep($t,e){var _t=$t.modulus.byteLength(),At=createHash("sha1").update(Buffer$7.alloc(0)).digest(),xt=At.length;if(e[0]!==0)throw new Error("decryption error");var kt=e.slice(1,xt+1),Bt=e.slice(xt+1),Nt=xor(kt,mgf(Bt,xt)),Ut=xor(Bt,mgf(Nt,_t-xt-1));if(compare(At,Ut.slice(0,xt)))throw new Error("decryption error");for(var Lt=xt;Ut[Lt]===0;)Lt++;if(Ut[Lt++]!==1)throw new Error("decryption error");return Ut.slice(Lt)}function pkcs1($t,e,_t){for(var At=e.slice(0,2),xt=2,kt=0;e[xt++]!==0;)if(xt>=e.length){kt++;break}var Bt=e.slice(2,xt-1);if((At.toString("hex")!=="0002"&&!_t||At.toString("hex")!=="0001"&&_t)&&kt++,Bt.length<8&&kt++,kt)throw new Error("decryption error");return e.slice(xt)}function compare($t,e){$t=Buffer$7.from($t),e=Buffer$7.from(e);var _t=0,At=$t.length;$t.length!==e.length&&(_t++,At=Math.min($t.length,e.length));for(var xt=-1;++xt<At;)_t+=$t[xt]^e[xt];return _t}(function($t){$t.publicEncrypt=publicEncrypt,$t.privateDecrypt=privateDecrypt,$t.privateEncrypt=function(_t,At){return $t.publicEncrypt(_t,At,!0)},$t.publicDecrypt=function(_t,At){return $t.privateDecrypt(_t,At,!0)}})(browser$4);var browser$3={};function oldBrowser(){throw new Error(`secure random number generation not supported by this browser
use chrome, FireFox or Internet Explorer 11`)}var safeBuffer=safeBufferExports$1,randombytes=browserExports$2,Buffer$6=safeBuffer.Buffer,kBufferMaxLength=safeBuffer.kMaxLength,crypto$5=globalThis.crypto||globalThis.msCrypto,kMaxUint32=Math.pow(2,32)-1;function assertOffset($t,e){if(typeof $t!="number"||$t!==$t)throw new TypeError("offset must be a number");if($t>kMaxUint32||$t<0)throw new TypeError("offset must be a uint32");if($t>kBufferMaxLength||$t>e)throw new RangeError("offset out of range")}function assertSize($t,e,_t){if(typeof $t!="number"||$t!==$t)throw new TypeError("size must be a number");if($t>kMaxUint32||$t<0)throw new TypeError("size must be a uint32");if($t+e>_t||$t>kBufferMaxLength)throw new RangeError("buffer too small")}crypto$5&&crypto$5.getRandomValues||!process$9.browser?(browser$3.randomFill=randomFill,browser$3.randomFillSync=randomFillSync):(browser$3.randomFill=oldBrowser,browser$3.randomFillSync=oldBrowser);function randomFill($t,e,_t,At){if(!Buffer$6.isBuffer($t)&&!($t instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if(typeof e=="function")At=e,e=0,_t=$t.length;else if(typeof _t=="function")At=_t,_t=$t.length-e;else if(typeof At!="function")throw new TypeError('"cb" argument must be a function');return assertOffset(e,$t.length),assertSize(_t,e,$t.length),actualFill($t,e,_t,At)}function actualFill($t,e,_t,At){if(process$9.browser){var xt=$t.buffer,kt=new Uint8Array(xt,e,_t);if(crypto$5.getRandomValues(kt),At){process$9.nextTick(function(){At(null,$t)});return}return $t}if(At){randombytes(_t,function(Nt,Ut){if(Nt)return At(Nt);Ut.copy($t,e),At(null,$t)});return}var Bt=randombytes(_t);return Bt.copy($t,e),$t}function randomFillSync($t,e,_t){if(typeof e>"u"&&(e=0),!Buffer$6.isBuffer($t)&&!($t instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return assertOffset(e,$t.length),_t===void 0&&(_t=$t.length-e),assertSize(_t,e,$t.length),actualFill($t,e,_t)}var hasRequiredCryptoBrowserify;function requireCryptoBrowserify(){if(hasRequiredCryptoBrowserify)return cryptoBrowserify;hasRequiredCryptoBrowserify=1,cryptoBrowserify.randomBytes=cryptoBrowserify.rng=cryptoBrowserify.pseudoRandomBytes=cryptoBrowserify.prng=browserExports$2,cryptoBrowserify.createHash=cryptoBrowserify.Hash=browser$c,cryptoBrowserify.createHmac=cryptoBrowserify.Hmac=browser$b;var $t=algos,e=Object.keys($t),_t=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(e);cryptoBrowserify.getHashes=function(){return _t};var At=browser$a;cryptoBrowserify.pbkdf2=At.pbkdf2,cryptoBrowserify.pbkdf2Sync=At.pbkdf2Sync;var xt=browser$9;cryptoBrowserify.Cipher=xt.Cipher,cryptoBrowserify.createCipher=xt.createCipher,cryptoBrowserify.Cipheriv=xt.Cipheriv,cryptoBrowserify.createCipheriv=xt.createCipheriv,cryptoBrowserify.Decipher=xt.Decipher,cryptoBrowserify.createDecipher=xt.createDecipher,cryptoBrowserify.Decipheriv=xt.Decipheriv,cryptoBrowserify.createDecipheriv=xt.createDecipheriv,cryptoBrowserify.getCiphers=xt.getCiphers,cryptoBrowserify.listCiphers=xt.listCiphers;var kt=requireBrowser$3();cryptoBrowserify.DiffieHellmanGroup=kt.DiffieHellmanGroup,cryptoBrowserify.createDiffieHellmanGroup=kt.createDiffieHellmanGroup,cryptoBrowserify.getDiffieHellman=kt.getDiffieHellman,cryptoBrowserify.createDiffieHellman=kt.createDiffieHellman,cryptoBrowserify.DiffieHellman=kt.DiffieHellman;var Bt=requireBrowser$2();cryptoBrowserify.createSign=Bt.createSign,cryptoBrowserify.Sign=Bt.Sign,cryptoBrowserify.createVerify=Bt.createVerify,cryptoBrowserify.Verify=Bt.Verify,cryptoBrowserify.createECDH=requireBrowser$1();var Nt=browser$4;cryptoBrowserify.publicEncrypt=Nt.publicEncrypt,cryptoBrowserify.privateEncrypt=Nt.privateEncrypt,cryptoBrowserify.publicDecrypt=Nt.publicDecrypt,cryptoBrowserify.privateDecrypt=Nt.privateDecrypt;var Ut=browser$3;return cryptoBrowserify.randomFill=Ut.randomFill,cryptoBrowserify.randomFillSync=Ut.randomFillSync,cryptoBrowserify.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join(`
`))},cryptoBrowserify.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6},cryptoBrowserify}var cryptoBrowserifyExports=requireCryptoBrowserify(),dist={},utils$7={};(function($t){/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */Object.defineProperty($t,"__esModule",{value:!0}),$t.setBigUint64=$t.Hash=$t.equalBytes=$t.ensureBytes=$t.checkOpts=$t.concatBytes=$t.toBytes=$t.bytesToUtf8=$t.utf8ToBytes=$t.asyncLoop=$t.nextTick=$t.hexToBytes=$t.bytesToHex=$t.isLE=$t.createView=$t.u32=$t.u16=$t.u8=void 0;const e=dr=>dr instanceof Uint8Array,_t=dr=>new Uint8Array(dr.buffer,dr.byteOffset,dr.byteLength);$t.u8=_t;const At=dr=>new Uint16Array(dr.buffer,dr.byteOffset,Math.floor(dr.byteLength/2));$t.u16=At;const xt=dr=>new Uint32Array(dr.buffer,dr.byteOffset,Math.floor(dr.byteLength/4));$t.u32=xt;const kt=dr=>new DataView(dr.buffer,dr.byteOffset,dr.byteLength);if($t.createView=kt,$t.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!$t.isLE)throw new Error("Non little-endian hardware is not supported");const Bt=Array.from({length:256},(dr,vr)=>vr.toString(16).padStart(2,"0"));function Nt(dr){if(!e(dr))throw new Error("Uint8Array expected");let vr="";for(let $r=0;$r<dr.length;$r++)vr+=Bt[dr[$r]];return vr}$t.bytesToHex=Nt;function Ut(dr){if(typeof dr!="string")throw new Error("hex string expected, got "+typeof dr);const vr=dr.length;if(vr%2)throw new Error("padded hex string expected, got unpadded hex of length "+vr);const $r=new Uint8Array(vr/2);for(let Ir=0;Ir<$r.length;Ir++){const Rr=Ir*2,Nr=dr.slice(Rr,Rr+2),kr=Number.parseInt(Nr,16);if(Number.isNaN(kr)||kr<0)throw new Error("Invalid byte sequence");$r[Ir]=kr}return $r}$t.hexToBytes=Ut;const Lt=async()=>{};$t.nextTick=Lt;async function jt(dr,vr,$r){let Ir=Date.now();for(let Rr=0;Rr<dr;Rr++){$r(Rr);const Nr=Date.now()-Ir;Nr>=0&&Nr<vr||(await(0,$t.nextTick)(),Ir+=Nr)}}$t.asyncLoop=jt;function Kt(dr){if(typeof dr!="string")throw new Error(`utf8ToBytes expected string, got ${typeof dr}`);return new Uint8Array(new TextEncoder().encode(dr))}$t.utf8ToBytes=Kt;function qt(dr){return new TextDecoder().decode(dr)}$t.bytesToUtf8=qt;function zt(dr){if(typeof dr=="string"&&(dr=Kt(dr)),!e(dr))throw new Error(`expected Uint8Array, got ${typeof dr}`);return dr}$t.toBytes=zt;function Vt(...dr){const vr=new Uint8Array(dr.reduce((Ir,Rr)=>Ir+Rr.length,0));let $r=0;return dr.forEach(Ir=>{if(!e(Ir))throw new Error("Uint8Array expected");vr.set(Ir,$r),$r+=Ir.length}),vr}$t.concatBytes=Vt;const Ht=dr=>Object.prototype.toString.call(dr)==="[object Object]"&&dr.constructor===Object;function Wt(dr,vr){if(vr!==void 0&&(typeof vr!="object"||!Ht(vr)))throw new Error("options must be object or undefined");return Object.assign(dr,vr)}$t.checkOpts=Wt;function Qt(dr,vr){if(!(dr instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof vr=="number"&&dr.length!==vr)throw new Error(`Uint8Array length ${vr} expected`)}$t.ensureBytes=Qt;function Xt(dr,vr){if(dr.length!==vr.length)throw new Error("equalBytes: Different size of Uint8Arrays");let $r=!0;for(let Ir=0;Ir<dr.length;Ir++)$r&&($r=dr[Ir]===vr[Ir]);return $r}$t.equalBytes=Xt;class Jt{}$t.Hash=Jt;function tr(dr,vr,$r,Ir){if(typeof dr.setBigUint64=="function")return dr.setBigUint64(vr,$r,Ir);const Rr=BigInt(32),Nr=BigInt(4294967295),kr=Number($r>>Rr&Nr),lr=Number($r&Nr),ir=Ir?4:0,er=Ir?0:4;dr.setUint32(vr+ir,kr,Ir),dr.setUint32(vr+er,lr,Ir)}$t.setBigUint64=tr})(utils$7);var config={},consts={};Object.defineProperty(consts,"__esModule",{value:!0});consts.AEAD_TAG_LENGTH=consts.XCHACHA20_NONCE_LENGTH=consts.CURVE25519_PUBLIC_KEY_SIZE=consts.ETH_PUBLIC_KEY_SIZE=consts.UNCOMPRESSED_PUBLIC_KEY_SIZE=consts.COMPRESSED_PUBLIC_KEY_SIZE=consts.SECRET_KEY_LENGTH=void 0;consts.SECRET_KEY_LENGTH=32;consts.COMPRESSED_PUBLIC_KEY_SIZE=33;consts.UNCOMPRESSED_PUBLIC_KEY_SIZE=65;consts.ETH_PUBLIC_KEY_SIZE=64;consts.CURVE25519_PUBLIC_KEY_SIZE=32;consts.XCHACHA20_NONCE_LENGTH=24;consts.AEAD_TAG_LENGTH=16;(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.ephemeralKeySize=$t.symmetricNonceLength=$t.symmetricAlgorithm=$t.isHkdfKeyCompressed=$t.isEphemeralKeyCompressed=$t.ellipticCurve=$t.ECIES_CONFIG=void 0;var e=consts,_t=function(){function Lt(){this.ellipticCurve="secp256k1",this.isEphemeralKeyCompressed=!1,this.isHkdfKeyCompressed=!1,this.symmetricAlgorithm="aes-256-gcm",this.symmetricNonceLength=16}return Lt}();$t.ECIES_CONFIG=new _t;var At=function(){return $t.ECIES_CONFIG.ellipticCurve};$t.ellipticCurve=At;var xt=function(){return $t.ECIES_CONFIG.isEphemeralKeyCompressed};$t.isEphemeralKeyCompressed=xt;var kt=function(){return $t.ECIES_CONFIG.isHkdfKeyCompressed};$t.isHkdfKeyCompressed=kt;var Bt=function(){return $t.ECIES_CONFIG.symmetricAlgorithm};$t.symmetricAlgorithm=Bt;var Nt=function(){return $t.ECIES_CONFIG.symmetricNonceLength};$t.symmetricNonceLength=Nt;var Ut=function(){var Lt={secp256k1:$t.ECIES_CONFIG.isEphemeralKeyCompressed?e.COMPRESSED_PUBLIC_KEY_SIZE:e.UNCOMPRESSED_PUBLIC_KEY_SIZE,x25519:e.CURVE25519_PUBLIC_KEY_SIZE,ed25519:e.CURVE25519_PUBLIC_KEY_SIZE};if($t.ECIES_CONFIG.ellipticCurve in Lt)return Lt[$t.ECIES_CONFIG.ellipticCurve];throw new Error("Not implemented")};$t.ephemeralKeySize=Ut})(config);var keys={},PrivateKey$1={},utils$6={},elliptic={},utils$5={},crypto$4={};Object.defineProperty(crypto$4,"__esModule",{value:!0});crypto$4.crypto=void 0;crypto$4.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;Object.defineProperty(utils$5,"__esModule",{value:!0});utils$5.getWebcryptoSubtle=utils$5.randomBytes=void 0;const crypto_1$1=crypto$4;function randomBytes$2($t=32){if(crypto_1$1.crypto&&typeof crypto_1$1.crypto.getRandomValues=="function")return crypto_1$1.crypto.getRandomValues(new Uint8Array($t));throw new Error("crypto.getRandomValues must be defined")}utils$5.randomBytes=randomBytes$2;function getWebcryptoSubtle$1(){if(crypto_1$1.crypto&&typeof crypto_1$1.crypto.subtle=="object"&&crypto_1$1.crypto.subtle!=null)return crypto_1$1.crypto.subtle;throw new Error("crypto.subtle must be defined")}utils$5.getWebcryptoSubtle=getWebcryptoSubtle$1;var ed25519$1={},sha512$1={},_md={},_assert$1={};Object.defineProperty(_assert$1,"__esModule",{value:!0});_assert$1.output=_assert$1.exists=_assert$1.hash=_assert$1.bytes=_assert$1.bool=_assert$1.number=_assert$1.isBytes=void 0;function number$3($t){if(!Number.isSafeInteger($t)||$t<0)throw new Error(`positive integer expected, not ${$t}`)}_assert$1.number=number$3;function bool$2($t){if(typeof $t!="boolean")throw new Error(`boolean expected, not ${$t}`)}_assert$1.bool=bool$2;function isBytes$8($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}_assert$1.isBytes=isBytes$8;function bytes$4($t,...e){if(!isBytes$8($t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes($t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${$t.length}`)}_assert$1.bytes=bytes$4;function hash$2($t){if(typeof $t!="function"||typeof $t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$3($t.outputLen),number$3($t.blockLen)}_assert$1.hash=hash$2;function exists$4($t,e=!0){if($t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&$t.finished)throw new Error("Hash#digest() has already been called")}_assert$1.exists=exists$4;function output$4($t,e){bytes$4($t);const _t=e.outputLen;if($t.length<_t)throw new Error(`digestInto() expects output buffer of length at least ${_t}`)}_assert$1.output=output$4;const assert$3={number:number$3,bool:bool$2,bytes:bytes$4,hash:hash$2,exists:exists$4,output:output$4};_assert$1.default=assert$3;var utils$4={},crypto$3={};Object.defineProperty(crypto$3,"__esModule",{value:!0});crypto$3.crypto=void 0;crypto$3.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function($t){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty($t,"__esModule",{value:!0}),$t.randomBytes=$t.wrapXOFConstructorWithOpts=$t.wrapConstructorWithOpts=$t.wrapConstructor=$t.checkOpts=$t.Hash=$t.concatBytes=$t.toBytes=$t.utf8ToBytes=$t.asyncLoop=$t.nextTick=$t.hexToBytes=$t.bytesToHex=$t.byteSwap32=$t.byteSwapIfBE=$t.byteSwap=$t.isLE=$t.rotl=$t.rotr=$t.createView=$t.u32=$t.u8=$t.isBytes=void 0;const e=crypto$3,_t=_assert$1;function At(lr){return lr instanceof Uint8Array||lr!=null&&typeof lr=="object"&&lr.constructor.name==="Uint8Array"}$t.isBytes=At;const xt=lr=>new Uint8Array(lr.buffer,lr.byteOffset,lr.byteLength);$t.u8=xt;const kt=lr=>new Uint32Array(lr.buffer,lr.byteOffset,Math.floor(lr.byteLength/4));$t.u32=kt;const Bt=lr=>new DataView(lr.buffer,lr.byteOffset,lr.byteLength);$t.createView=Bt;const Nt=(lr,ir)=>lr<<32-ir|lr>>>ir;$t.rotr=Nt;const Ut=(lr,ir)=>lr<<ir|lr>>>32-ir>>>0;$t.rotl=Ut,$t.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const Lt=lr=>lr<<24&4278190080|lr<<8&16711680|lr>>>8&65280|lr>>>24&255;$t.byteSwap=Lt,$t.byteSwapIfBE=$t.isLE?lr=>lr:lr=>(0,$t.byteSwap)(lr);function jt(lr){for(let ir=0;ir<lr.length;ir++)lr[ir]=(0,$t.byteSwap)(lr[ir])}$t.byteSwap32=jt;const Kt=Array.from({length:256},(lr,ir)=>ir.toString(16).padStart(2,"0"));function qt(lr){(0,_t.bytes)(lr);let ir="";for(let er=0;er<lr.length;er++)ir+=Kt[lr[er]];return ir}$t.bytesToHex=qt;const zt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Vt(lr){if(lr>=zt._0&&lr<=zt._9)return lr-zt._0;if(lr>=zt._A&&lr<=zt._F)return lr-(zt._A-10);if(lr>=zt._a&&lr<=zt._f)return lr-(zt._a-10)}function Ht(lr){if(typeof lr!="string")throw new Error("hex string expected, got "+typeof lr);const ir=lr.length,er=ir/2;if(ir%2)throw new Error("padded hex string expected, got unpadded hex of length "+ir);const rr=new Uint8Array(er);for(let yr=0,fr=0;yr<er;yr++,fr+=2){const gr=Vt(lr.charCodeAt(fr)),ar=Vt(lr.charCodeAt(fr+1));if(gr===void 0||ar===void 0){const nr=lr[fr]+lr[fr+1];throw new Error('hex string expected, got non-hex character "'+nr+'" at index '+fr)}rr[yr]=gr*16+ar}return rr}$t.hexToBytes=Ht;const Wt=async()=>{};$t.nextTick=Wt;async function Qt(lr,ir,er){let rr=Date.now();for(let yr=0;yr<lr;yr++){er(yr);const fr=Date.now()-rr;fr>=0&&fr<ir||(await(0,$t.nextTick)(),rr+=fr)}}$t.asyncLoop=Qt;function Xt(lr){if(typeof lr!="string")throw new Error(`utf8ToBytes expected string, got ${typeof lr}`);return new Uint8Array(new TextEncoder().encode(lr))}$t.utf8ToBytes=Xt;function Jt(lr){return typeof lr=="string"&&(lr=Xt(lr)),(0,_t.bytes)(lr),lr}$t.toBytes=Jt;function tr(...lr){let ir=0;for(let rr=0;rr<lr.length;rr++){const yr=lr[rr];(0,_t.bytes)(yr),ir+=yr.length}const er=new Uint8Array(ir);for(let rr=0,yr=0;rr<lr.length;rr++){const fr=lr[rr];er.set(fr,yr),yr+=fr.length}return er}$t.concatBytes=tr;class dr{clone(){return this._cloneInto()}}$t.Hash=dr;const vr={}.toString;function $r(lr,ir){if(ir!==void 0&&vr.call(ir)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(lr,ir)}$t.checkOpts=$r;function Ir(lr){const ir=rr=>lr().update(Jt(rr)).digest(),er=lr();return ir.outputLen=er.outputLen,ir.blockLen=er.blockLen,ir.create=()=>lr(),ir}$t.wrapConstructor=Ir;function Rr(lr){const ir=(rr,yr)=>lr(yr).update(Jt(rr)).digest(),er=lr({});return ir.outputLen=er.outputLen,ir.blockLen=er.blockLen,ir.create=rr=>lr(rr),ir}$t.wrapConstructorWithOpts=Rr;function Nr(lr){const ir=(rr,yr)=>lr(yr).update(Jt(rr)).digest(),er=lr({});return ir.outputLen=er.outputLen,ir.blockLen=er.blockLen,ir.create=rr=>lr(rr),ir}$t.wrapXOFConstructorWithOpts=Nr;function kr(lr=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(lr));throw new Error("crypto.getRandomValues must be defined")}$t.randomBytes=kr})(utils$4);Object.defineProperty(_md,"__esModule",{value:!0});_md.HashMD=_md.Maj=_md.Chi=void 0;const _assert_js_1$3=_assert$1,utils_js_1$a=utils$4;function setBigUint64$2($t,e,_t,At){if(typeof $t.setBigUint64=="function")return $t.setBigUint64(e,_t,At);const xt=BigInt(32),kt=BigInt(4294967295),Bt=Number(_t>>xt&kt),Nt=Number(_t&kt),Ut=At?4:0,Lt=At?0:4;$t.setUint32(e+Ut,Bt,At),$t.setUint32(e+Lt,Nt,At)}const Chi$1=($t,e,_t)=>$t&e^~$t&_t;_md.Chi=Chi$1;const Maj$1=($t,e,_t)=>$t&e^$t&_t^e&_t;_md.Maj=Maj$1;class HashMD extends utils_js_1$a.Hash{constructor(e,_t,At,xt){super(),this.blockLen=e,this.outputLen=_t,this.padOffset=At,this.isLE=xt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,utils_js_1$a.createView)(this.buffer)}update(e){(0,_assert_js_1$3.exists)(this);const{view:_t,buffer:At,blockLen:xt}=this;e=(0,utils_js_1$a.toBytes)(e);const kt=e.length;for(let Bt=0;Bt<kt;){const Nt=Math.min(xt-this.pos,kt-Bt);if(Nt===xt){const Ut=(0,utils_js_1$a.createView)(e);for(;xt<=kt-Bt;Bt+=xt)this.process(Ut,Bt);continue}At.set(e.subarray(Bt,Bt+Nt),this.pos),this.pos+=Nt,Bt+=Nt,this.pos===xt&&(this.process(_t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,_assert_js_1$3.exists)(this),(0,_assert_js_1$3.output)(e,this),this.finished=!0;const{buffer:_t,view:At,blockLen:xt,isLE:kt}=this;let{pos:Bt}=this;_t[Bt++]=128,this.buffer.subarray(Bt).fill(0),this.padOffset>xt-Bt&&(this.process(At,0),Bt=0);for(let Kt=Bt;Kt<xt;Kt++)_t[Kt]=0;setBigUint64$2(At,xt-8,BigInt(this.length*8),kt),this.process(At,0);const Nt=(0,utils_js_1$a.createView)(e),Ut=this.outputLen;if(Ut%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Lt=Ut/4,jt=this.get();if(Lt>jt.length)throw new Error("_sha2: outputLen bigger than state");for(let Kt=0;Kt<Lt;Kt++)Nt.setUint32(4*Kt,jt[Kt],kt)}digest(){const{buffer:e,outputLen:_t}=this;this.digestInto(e);const At=e.slice(0,_t);return this.destroy(),At}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:_t,buffer:At,length:xt,finished:kt,destroyed:Bt,pos:Nt}=this;return e.length=xt,e.pos=Nt,e.finished=kt,e.destroyed=Bt,xt%_t&&e.buffer.set(At),e}}_md.HashMD=HashMD;var _u64={};Object.defineProperty(_u64,"__esModule",{value:!0});_u64.add5L=_u64.add5H=_u64.add4H=_u64.add4L=_u64.add3H=_u64.add3L=_u64.add=_u64.rotlBL=_u64.rotlBH=_u64.rotlSL=_u64.rotlSH=_u64.rotr32L=_u64.rotr32H=_u64.rotrBL=_u64.rotrBH=_u64.rotrSL=_u64.rotrSH=_u64.shrSL=_u64.shrSH=_u64.toBig=_u64.split=_u64.fromBig=void 0;const U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1($t,e=!1){return e?{h:Number($t&U32_MASK64$1),l:Number($t>>_32n$1&U32_MASK64$1)}:{h:Number($t>>_32n$1&U32_MASK64$1)|0,l:Number($t&U32_MASK64$1)|0}}_u64.fromBig=fromBig$1;function split$1($t,e=!1){let _t=new Uint32Array($t.length),At=new Uint32Array($t.length);for(let xt=0;xt<$t.length;xt++){const{h:kt,l:Bt}=fromBig$1($t[xt],e);[_t[xt],At[xt]]=[kt,Bt]}return[_t,At]}_u64.split=split$1;const toBig$1=($t,e)=>BigInt($t>>>0)<<_32n$1|BigInt(e>>>0);_u64.toBig=toBig$1;const shrSH$1=($t,e,_t)=>$t>>>_t;_u64.shrSH=shrSH$1;const shrSL$1=($t,e,_t)=>$t<<32-_t|e>>>_t;_u64.shrSL=shrSL$1;const rotrSH$1=($t,e,_t)=>$t>>>_t|e<<32-_t;_u64.rotrSH=rotrSH$1;const rotrSL$1=($t,e,_t)=>$t<<32-_t|e>>>_t;_u64.rotrSL=rotrSL$1;const rotrBH$1=($t,e,_t)=>$t<<64-_t|e>>>_t-32;_u64.rotrBH=rotrBH$1;const rotrBL$1=($t,e,_t)=>$t>>>_t-32|e<<64-_t;_u64.rotrBL=rotrBL$1;const rotr32H$1=($t,e)=>e;_u64.rotr32H=rotr32H$1;const rotr32L$1=($t,e)=>$t;_u64.rotr32L=rotr32L$1;const rotlSH$1=($t,e,_t)=>$t<<_t|e>>>32-_t;_u64.rotlSH=rotlSH$1;const rotlSL$1=($t,e,_t)=>e<<_t|$t>>>32-_t;_u64.rotlSL=rotlSL$1;const rotlBH$1=($t,e,_t)=>e<<_t-32|$t>>>64-_t;_u64.rotlBH=rotlBH$1;const rotlBL$1=($t,e,_t)=>$t<<_t-32|e>>>64-_t;_u64.rotlBL=rotlBL$1;function add$1($t,e,_t,At){const xt=(e>>>0)+(At>>>0);return{h:$t+_t+(xt/2**32|0)|0,l:xt|0}}_u64.add=add$1;const add3L$1=($t,e,_t)=>($t>>>0)+(e>>>0)+(_t>>>0);_u64.add3L=add3L$1;const add3H$1=($t,e,_t,At)=>e+_t+At+($t/2**32|0)|0;_u64.add3H=add3H$1;const add4L$1=($t,e,_t,At)=>($t>>>0)+(e>>>0)+(_t>>>0)+(At>>>0);_u64.add4L=add4L$1;const add4H$1=($t,e,_t,At,xt)=>e+_t+At+xt+($t/2**32|0)|0;_u64.add4H=add4H$1;const add5L$1=($t,e,_t,At,xt)=>($t>>>0)+(e>>>0)+(_t>>>0)+(At>>>0)+(xt>>>0);_u64.add5L=add5L$1;const add5H$1=($t,e,_t,At,xt,kt)=>e+_t+At+xt+kt+($t/2**32|0)|0;_u64.add5H=add5H$1;const u64$1={fromBig:fromBig$1,split:split$1,toBig:toBig$1,shrSH:shrSH$1,shrSL:shrSL$1,rotrSH:rotrSH$1,rotrSL:rotrSL$1,rotrBH:rotrBH$1,rotrBL:rotrBL$1,rotr32H:rotr32H$1,rotr32L:rotr32L$1,rotlSH:rotlSH$1,rotlSL:rotlSL$1,rotlBH:rotlBH$1,rotlBL:rotlBL$1,add:add$1,add3L:add3L$1,add3H:add3H$1,add4L:add4L$1,add4H:add4H$1,add5H:add5H$1,add5L:add5L$1};_u64.default=u64$1;Object.defineProperty(sha512$1,"__esModule",{value:!0});sha512$1.sha384=sha512$1.sha512_256=sha512$1.sha512_224=sha512$1.sha512=sha512$1.SHA512=void 0;const _md_js_1$1=_md,_u64_js_1=_u64,utils_js_1$9=utils$4,[SHA512_Kh$1,SHA512_Kl$1]=_u64_js_1.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map($t=>BigInt($t))),SHA512_W_H$1=new Uint32Array(80),SHA512_W_L$1=new Uint32Array(80);let SHA512$1=class extends _md_js_1$1.HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:_t,Bh:At,Bl:xt,Ch:kt,Cl:Bt,Dh:Nt,Dl:Ut,Eh:Lt,El:jt,Fh:Kt,Fl:qt,Gh:zt,Gl:Vt,Hh:Ht,Hl:Wt}=this;return[e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt]}set(e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt){this.Ah=e|0,this.Al=_t|0,this.Bh=At|0,this.Bl=xt|0,this.Ch=kt|0,this.Cl=Bt|0,this.Dh=Nt|0,this.Dl=Ut|0,this.Eh=Lt|0,this.El=jt|0,this.Fh=Kt|0,this.Fl=qt|0,this.Gh=zt|0,this.Gl=Vt|0,this.Hh=Ht|0,this.Hl=Wt|0}process(e,_t){for(let Jt=0;Jt<16;Jt++,_t+=4)SHA512_W_H$1[Jt]=e.getUint32(_t),SHA512_W_L$1[Jt]=e.getUint32(_t+=4);for(let Jt=16;Jt<80;Jt++){const tr=SHA512_W_H$1[Jt-15]|0,dr=SHA512_W_L$1[Jt-15]|0,vr=_u64_js_1.default.rotrSH(tr,dr,1)^_u64_js_1.default.rotrSH(tr,dr,8)^_u64_js_1.default.shrSH(tr,dr,7),$r=_u64_js_1.default.rotrSL(tr,dr,1)^_u64_js_1.default.rotrSL(tr,dr,8)^_u64_js_1.default.shrSL(tr,dr,7),Ir=SHA512_W_H$1[Jt-2]|0,Rr=SHA512_W_L$1[Jt-2]|0,Nr=_u64_js_1.default.rotrSH(Ir,Rr,19)^_u64_js_1.default.rotrBH(Ir,Rr,61)^_u64_js_1.default.shrSH(Ir,Rr,6),kr=_u64_js_1.default.rotrSL(Ir,Rr,19)^_u64_js_1.default.rotrBL(Ir,Rr,61)^_u64_js_1.default.shrSL(Ir,Rr,6),lr=_u64_js_1.default.add4L($r,kr,SHA512_W_L$1[Jt-7],SHA512_W_L$1[Jt-16]),ir=_u64_js_1.default.add4H(lr,vr,Nr,SHA512_W_H$1[Jt-7],SHA512_W_H$1[Jt-16]);SHA512_W_H$1[Jt]=ir|0,SHA512_W_L$1[Jt]=lr|0}let{Ah:At,Al:xt,Bh:kt,Bl:Bt,Ch:Nt,Cl:Ut,Dh:Lt,Dl:jt,Eh:Kt,El:qt,Fh:zt,Fl:Vt,Gh:Ht,Gl:Wt,Hh:Qt,Hl:Xt}=this;for(let Jt=0;Jt<80;Jt++){const tr=_u64_js_1.default.rotrSH(Kt,qt,14)^_u64_js_1.default.rotrSH(Kt,qt,18)^_u64_js_1.default.rotrBH(Kt,qt,41),dr=_u64_js_1.default.rotrSL(Kt,qt,14)^_u64_js_1.default.rotrSL(Kt,qt,18)^_u64_js_1.default.rotrBL(Kt,qt,41),vr=Kt&zt^~Kt&Ht,$r=qt&Vt^~qt&Wt,Ir=_u64_js_1.default.add5L(Xt,dr,$r,SHA512_Kl$1[Jt],SHA512_W_L$1[Jt]),Rr=_u64_js_1.default.add5H(Ir,Qt,tr,vr,SHA512_Kh$1[Jt],SHA512_W_H$1[Jt]),Nr=Ir|0,kr=_u64_js_1.default.rotrSH(At,xt,28)^_u64_js_1.default.rotrBH(At,xt,34)^_u64_js_1.default.rotrBH(At,xt,39),lr=_u64_js_1.default.rotrSL(At,xt,28)^_u64_js_1.default.rotrBL(At,xt,34)^_u64_js_1.default.rotrBL(At,xt,39),ir=At&kt^At&Nt^kt&Nt,er=xt&Bt^xt&Ut^Bt&Ut;Qt=Ht|0,Xt=Wt|0,Ht=zt|0,Wt=Vt|0,zt=Kt|0,Vt=qt|0,{h:Kt,l:qt}=_u64_js_1.default.add(Lt|0,jt|0,Rr|0,Nr|0),Lt=Nt|0,jt=Ut|0,Nt=kt|0,Ut=Bt|0,kt=At|0,Bt=xt|0;const rr=_u64_js_1.default.add3L(Nr,lr,er);At=_u64_js_1.default.add3H(rr,Rr,kr,ir),xt=rr|0}({h:At,l:xt}=_u64_js_1.default.add(this.Ah|0,this.Al|0,At|0,xt|0)),{h:kt,l:Bt}=_u64_js_1.default.add(this.Bh|0,this.Bl|0,kt|0,Bt|0),{h:Nt,l:Ut}=_u64_js_1.default.add(this.Ch|0,this.Cl|0,Nt|0,Ut|0),{h:Lt,l:jt}=_u64_js_1.default.add(this.Dh|0,this.Dl|0,Lt|0,jt|0),{h:Kt,l:qt}=_u64_js_1.default.add(this.Eh|0,this.El|0,Kt|0,qt|0),{h:zt,l:Vt}=_u64_js_1.default.add(this.Fh|0,this.Fl|0,zt|0,Vt|0),{h:Ht,l:Wt}=_u64_js_1.default.add(this.Gh|0,this.Gl|0,Ht|0,Wt|0),{h:Qt,l:Xt}=_u64_js_1.default.add(this.Hh|0,this.Hl|0,Qt|0,Xt|0),this.set(At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt)}roundClean(){SHA512_W_H$1.fill(0),SHA512_W_L$1.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};sha512$1.SHA512=SHA512$1;class SHA512_224 extends SHA512$1{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class SHA512_256 extends SHA512$1{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class SHA384 extends SHA512$1{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}sha512$1.sha512=(0,utils_js_1$9.wrapConstructor)(()=>new SHA512$1);sha512$1.sha512_224=(0,utils_js_1$9.wrapConstructor)(()=>new SHA512_224);sha512$1.sha512_256=(0,utils_js_1$9.wrapConstructor)(()=>new SHA512_256);sha512$1.sha384=(0,utils_js_1$9.wrapConstructor)(()=>new SHA384);const require$$1$1=getAugmentedNamespace(utils$w);var edwards={},curve={},modular={},utils$3={};Object.defineProperty(utils$3,"__esModule",{value:!0});utils$3.bitMask=void 0;utils$3.isBytes=isBytes$7;utils$3.abytes=abytes;utils$3.bytesToHex=bytesToHex$2;utils$3.numberToHexUnpadded=numberToHexUnpadded$1;utils$3.hexToNumber=hexToNumber$1;utils$3.hexToBytes=hexToBytes$2;utils$3.bytesToNumberBE=bytesToNumberBE$1;utils$3.bytesToNumberLE=bytesToNumberLE$1;utils$3.numberToBytesBE=numberToBytesBE$1;utils$3.numberToBytesLE=numberToBytesLE$1;utils$3.numberToVarBytesBE=numberToVarBytesBE$1;utils$3.ensureBytes=ensureBytes$3;utils$3.concatBytes=concatBytes$2;utils$3.equalBytes=equalBytes$2;utils$3.utf8ToBytes=utf8ToBytes$4;utils$3.bitLen=bitLen$1;utils$3.bitGet=bitGet$1;utils$3.bitSet=bitSet$1;utils$3.createHmacDrbg=createHmacDrbg$1;utils$3.validateObject=validateObject$7;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$a=BigInt(0),_1n$c=BigInt(1),_2n$7=BigInt(2);function isBytes$7($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}function abytes($t){if(!isBytes$7($t))throw new Error("Uint8Array expected")}const hexes$2=Array.from({length:256},($t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2($t){abytes($t);let e="";for(let _t=0;_t<$t.length;_t++)e+=hexes$2[$t[_t]];return e}function numberToHexUnpadded$1($t){const e=$t.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);return BigInt($t===""?"0":`0x${$t}`)}const asciis$2={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$2($t){if($t>=asciis$2._0&&$t<=asciis$2._9)return $t-asciis$2._0;if($t>=asciis$2._A&&$t<=asciis$2._F)return $t-(asciis$2._A-10);if($t>=asciis$2._a&&$t<=asciis$2._f)return $t-(asciis$2._a-10)}function hexToBytes$2($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);const e=$t.length,_t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const At=new Uint8Array(_t);for(let xt=0,kt=0;xt<_t;xt++,kt+=2){const Bt=asciiToBase16$2($t.charCodeAt(kt)),Nt=asciiToBase16$2($t.charCodeAt(kt+1));if(Bt===void 0||Nt===void 0){const Ut=$t[kt]+$t[kt+1];throw new Error('hex string expected, got non-hex character "'+Ut+'" at index '+kt)}At[xt]=Bt*16+Nt}return At}function bytesToNumberBE$1($t){return hexToNumber$1(bytesToHex$2($t))}function bytesToNumberLE$1($t){return abytes($t),hexToNumber$1(bytesToHex$2(Uint8Array.from($t).reverse()))}function numberToBytesBE$1($t,e){return hexToBytes$2($t.toString(16).padStart(e*2,"0"))}function numberToBytesLE$1($t,e){return numberToBytesBE$1($t,e).reverse()}function numberToVarBytesBE$1($t){return hexToBytes$2(numberToHexUnpadded$1($t))}function ensureBytes$3($t,e,_t){let At;if(typeof e=="string")try{At=hexToBytes$2(e)}catch(kt){throw new Error(`${$t} must be valid hex string, got "${e}". Cause: ${kt}`)}else if(isBytes$7(e))At=Uint8Array.from(e);else throw new Error(`${$t} must be hex string or Uint8Array`);const xt=At.length;if(typeof _t=="number"&&xt!==_t)throw new Error(`${$t} expected ${_t} bytes, got ${xt}`);return At}function concatBytes$2(...$t){let e=0;for(let At=0;At<$t.length;At++){const xt=$t[At];abytes(xt),e+=xt.length}const _t=new Uint8Array(e);for(let At=0,xt=0;At<$t.length;At++){const kt=$t[At];_t.set(kt,xt),xt+=kt.length}return _t}function equalBytes$2($t,e){if($t.length!==e.length)return!1;let _t=0;for(let At=0;At<$t.length;At++)_t|=$t[At]^e[At];return _t===0}function utf8ToBytes$4($t){if(typeof $t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function bitLen$1($t){let e;for(e=0;$t>_0n$a;$t>>=_1n$c,e+=1);return e}function bitGet$1($t,e){return $t>>BigInt(e)&_1n$c}function bitSet$1($t,e,_t){return $t|(_t?_1n$c:_0n$a)<<BigInt(e)}const bitMask$1=$t=>(_2n$7<<BigInt($t-1))-_1n$c;utils$3.bitMask=bitMask$1;const u8n$1=$t=>new Uint8Array($t),u8fr$1=$t=>Uint8Array.from($t);function createHmacDrbg$1($t,e,_t){if(typeof $t!="number"||$t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof _t!="function")throw new Error("hmacFn must be a function");let At=u8n$1($t),xt=u8n$1($t),kt=0;const Bt=()=>{At.fill(1),xt.fill(0),kt=0},Nt=(...Kt)=>_t(xt,At,...Kt),Ut=(Kt=u8n$1())=>{xt=Nt(u8fr$1([0]),Kt),At=Nt(),Kt.length!==0&&(xt=Nt(u8fr$1([1]),Kt),At=Nt())},Lt=()=>{if(kt++>=1e3)throw new Error("drbg: tried 1000 values");let Kt=0;const qt=[];for(;Kt<e;){At=Nt();const zt=At.slice();qt.push(zt),Kt+=At.length}return concatBytes$2(...qt)};return(Kt,qt)=>{Bt(),Ut(Kt);let zt;for(;!(zt=qt(Lt()));)Ut();return Bt(),zt}}const validatorFns$1={bigint:$t=>typeof $t=="bigint",function:$t=>typeof $t=="function",boolean:$t=>typeof $t=="boolean",string:$t=>typeof $t=="string",stringOrUint8Array:$t=>typeof $t=="string"||isBytes$7($t),isSafeInteger:$t=>Number.isSafeInteger($t),array:$t=>Array.isArray($t),field:($t,e)=>e.Fp.isValid($t),hash:$t=>typeof $t=="function"&&Number.isSafeInteger($t.outputLen)};function validateObject$7($t,e,_t={}){const At=(xt,kt,Bt)=>{const Nt=validatorFns$1[kt];if(typeof Nt!="function")throw new Error(`Invalid validator "${kt}", expected function`);const Ut=$t[xt];if(!(Bt&&Ut===void 0)&&!Nt(Ut,$t))throw new Error(`Invalid param ${String(xt)}=${Ut} (${typeof Ut}), expected ${kt}`)};for(const[xt,kt]of Object.entries(e))At(xt,kt,!1);for(const[xt,kt]of Object.entries(_t))At(xt,kt,!0);return $t}Object.defineProperty(modular,"__esModule",{value:!0});modular.isNegativeLE=void 0;modular.mod=mod$1;modular.pow=pow$1;modular.pow2=pow2$1;modular.invert=invert$1;modular.tonelliShanks=tonelliShanks$1;modular.FpSqrt=FpSqrt$1;modular.validateField=validateField$1;modular.FpPow=FpPow$1;modular.FpInvertBatch=FpInvertBatch$1;modular.FpDiv=FpDiv;modular.FpIsSquare=FpIsSquare;modular.nLength=nLength$1;modular.Field=Field$1;modular.FpSqrtOdd=FpSqrtOdd;modular.FpSqrtEven=FpSqrtEven$1;modular.hashToPrivateScalar=hashToPrivateScalar;modular.getFieldBytesLength=getFieldBytesLength$1;modular.getMinHashLength=getMinHashLength$1;modular.mapHashToField=mapHashToField$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const utils_js_1$8=utils$3,_0n$9=BigInt(0),_1n$b=BigInt(1),_2n$6=BigInt(2),_3n$2=BigInt(3),_4n$1=BigInt(4),_5n$2=BigInt(5),_8n$3=BigInt(8);BigInt(9);BigInt(16);function mod$1($t,e){const _t=$t%e;return _t>=_0n$9?_t:e+_t}function pow$1($t,e,_t){if(_t<=_0n$9||e<_0n$9)throw new Error("Expected power/modulo > 0");if(_t===_1n$b)return _0n$9;let At=_1n$b;for(;e>_0n$9;)e&_1n$b&&(At=At*$t%_t),$t=$t*$t%_t,e>>=_1n$b;return At}function pow2$1($t,e,_t){let At=$t;for(;e-- >_0n$9;)At*=At,At%=_t;return At}function invert$1($t,e){if($t===_0n$9||e<=_0n$9)throw new Error(`invert: expected positive integers, got n=${$t} mod=${e}`);let _t=mod$1($t,e),At=e,xt=_0n$9,kt=_1n$b;for(;_t!==_0n$9;){const Nt=At/_t,Ut=At%_t,Lt=xt-kt*Nt;At=_t,_t=Ut,xt=kt,kt=Lt}if(At!==_1n$b)throw new Error("invert: does not exist");return mod$1(xt,e)}function tonelliShanks$1($t){const e=($t-_1n$b)/_2n$6;let _t,At,xt;for(_t=$t-_1n$b,At=0;_t%_2n$6===_0n$9;_t/=_2n$6,At++);for(xt=_2n$6;xt<$t&&pow$1(xt,e,$t)!==$t-_1n$b;xt++);if(At===1){const Bt=($t+_1n$b)/_4n$1;return function(Ut,Lt){const jt=Ut.pow(Lt,Bt);if(!Ut.eql(Ut.sqr(jt),Lt))throw new Error("Cannot find square root");return jt}}const kt=(_t+_1n$b)/_2n$6;return function(Nt,Ut){if(Nt.pow(Ut,e)===Nt.neg(Nt.ONE))throw new Error("Cannot find square root");let Lt=At,jt=Nt.pow(Nt.mul(Nt.ONE,xt),_t),Kt=Nt.pow(Ut,kt),qt=Nt.pow(Ut,_t);for(;!Nt.eql(qt,Nt.ONE);){if(Nt.eql(qt,Nt.ZERO))return Nt.ZERO;let zt=1;for(let Ht=Nt.sqr(qt);zt<Lt&&!Nt.eql(Ht,Nt.ONE);zt++)Ht=Nt.sqr(Ht);const Vt=Nt.pow(jt,_1n$b<<BigInt(Lt-zt-1));jt=Nt.sqr(Vt),Kt=Nt.mul(Kt,Vt),qt=Nt.mul(qt,jt),Lt=zt}return Kt}}function FpSqrt$1($t){if($t%_4n$1===_3n$2){const e=($t+_1n$b)/_4n$1;return function(At,xt){const kt=At.pow(xt,e);if(!At.eql(At.sqr(kt),xt))throw new Error("Cannot find square root");return kt}}if($t%_8n$3===_5n$2){const e=($t-_5n$2)/_8n$3;return function(At,xt){const kt=At.mul(xt,_2n$6),Bt=At.pow(kt,e),Nt=At.mul(xt,Bt),Ut=At.mul(At.mul(Nt,_2n$6),Bt),Lt=At.mul(Nt,At.sub(Ut,At.ONE));if(!At.eql(At.sqr(Lt),xt))throw new Error("Cannot find square root");return Lt}}return tonelliShanks$1($t)}const isNegativeLE$1=($t,e)=>(mod$1($t,e)&_1n$b)===_1n$b;modular.isNegativeLE=isNegativeLE$1;const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1($t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},_t=FIELD_FIELDS$1.reduce((At,xt)=>(At[xt]="function",At),e);return(0,utils_js_1$8.validateObject)($t,_t)}function FpPow$1($t,e,_t){if(_t<_0n$9)throw new Error("Expected power > 0");if(_t===_0n$9)return $t.ONE;if(_t===_1n$b)return e;let At=$t.ONE,xt=e;for(;_t>_0n$9;)_t&_1n$b&&(At=$t.mul(At,xt)),xt=$t.sqr(xt),_t>>=_1n$b;return At}function FpInvertBatch$1($t,e){const _t=new Array(e.length),At=e.reduce((kt,Bt,Nt)=>$t.is0(Bt)?kt:(_t[Nt]=kt,$t.mul(kt,Bt)),$t.ONE),xt=$t.inv(At);return e.reduceRight((kt,Bt,Nt)=>$t.is0(Bt)?kt:(_t[Nt]=$t.mul(kt,_t[Nt]),$t.mul(kt,Bt)),xt),_t}function FpDiv($t,e,_t){return $t.mul(e,typeof _t=="bigint"?invert$1(_t,$t.ORDER):$t.inv(_t))}function FpIsSquare($t){const e=($t.ORDER-_1n$b)/_2n$6;return _t=>{const At=$t.pow(_t,e);return $t.eql(At,$t.ZERO)||$t.eql(At,$t.ONE)}}function nLength$1($t,e){const _t=e!==void 0?e:$t.toString(2).length,At=Math.ceil(_t/8);return{nBitLength:_t,nByteLength:At}}function Field$1($t,e,_t=!1,At={}){if($t<=_0n$9)throw new Error(`Expected Field ORDER > 0, got ${$t}`);const{nBitLength:xt,nByteLength:kt}=nLength$1($t,e);if(kt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const Bt=FpSqrt$1($t),Nt=Object.freeze({ORDER:$t,BITS:xt,BYTES:kt,MASK:(0,utils_js_1$8.bitMask)(xt),ZERO:_0n$9,ONE:_1n$b,create:Ut=>mod$1(Ut,$t),isValid:Ut=>{if(typeof Ut!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof Ut}`);return _0n$9<=Ut&&Ut<$t},is0:Ut=>Ut===_0n$9,isOdd:Ut=>(Ut&_1n$b)===_1n$b,neg:Ut=>mod$1(-Ut,$t),eql:(Ut,Lt)=>Ut===Lt,sqr:Ut=>mod$1(Ut*Ut,$t),add:(Ut,Lt)=>mod$1(Ut+Lt,$t),sub:(Ut,Lt)=>mod$1(Ut-Lt,$t),mul:(Ut,Lt)=>mod$1(Ut*Lt,$t),pow:(Ut,Lt)=>FpPow$1(Nt,Ut,Lt),div:(Ut,Lt)=>mod$1(Ut*invert$1(Lt,$t),$t),sqrN:Ut=>Ut*Ut,addN:(Ut,Lt)=>Ut+Lt,subN:(Ut,Lt)=>Ut-Lt,mulN:(Ut,Lt)=>Ut*Lt,inv:Ut=>invert$1(Ut,$t),sqrt:At.sqrt||(Ut=>Bt(Nt,Ut)),invertBatch:Ut=>FpInvertBatch$1(Nt,Ut),cmov:(Ut,Lt,jt)=>jt?Lt:Ut,toBytes:Ut=>_t?(0,utils_js_1$8.numberToBytesLE)(Ut,kt):(0,utils_js_1$8.numberToBytesBE)(Ut,kt),fromBytes:Ut=>{if(Ut.length!==kt)throw new Error(`Fp.fromBytes: expected ${kt}, got ${Ut.length}`);return _t?(0,utils_js_1$8.bytesToNumberLE)(Ut):(0,utils_js_1$8.bytesToNumberBE)(Ut)}});return Object.freeze(Nt)}function FpSqrtOdd($t,e){if(!$t.isOdd)throw new Error("Field doesn't have isOdd");const _t=$t.sqrt(e);return $t.isOdd(_t)?_t:$t.neg(_t)}function FpSqrtEven$1($t,e){if(!$t.isOdd)throw new Error("Field doesn't have isOdd");const _t=$t.sqrt(e);return $t.isOdd(_t)?$t.neg(_t):_t}function hashToPrivateScalar($t,e,_t=!1){$t=(0,utils_js_1$8.ensureBytes)("privateHash",$t);const At=$t.length,xt=nLength$1(e).nByteLength+8;if(xt<24||At<xt||At>1024)throw new Error(`hashToPrivateScalar: expected ${xt}-1024 bytes of input, got ${At}`);const kt=_t?(0,utils_js_1$8.bytesToNumberLE)($t):(0,utils_js_1$8.bytesToNumberBE)($t);return mod$1(kt,e-_1n$b)+_1n$b}function getFieldBytesLength$1($t){if(typeof $t!="bigint")throw new Error("field order must be bigint");const e=$t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1($t){const e=getFieldBytesLength$1($t);return e+Math.ceil(e/2)}function mapHashToField$1($t,e,_t=!1){const At=$t.length,xt=getFieldBytesLength$1(e),kt=getMinHashLength$1(e);if(At<16||At<kt||At>1024)throw new Error(`expected ${kt}-1024 bytes of input, got ${At}`);const Bt=_t?(0,utils_js_1$8.bytesToNumberBE)($t):(0,utils_js_1$8.bytesToNumberLE)($t),Nt=mod$1(Bt,e-_1n$b)+_1n$b;return _t?(0,utils_js_1$8.numberToBytesLE)(Nt,xt):(0,utils_js_1$8.numberToBytesBE)(Nt,xt)}Object.defineProperty(curve,"__esModule",{value:!0});curve.wNAF=wNAF$1;curve.validateBasic=validateBasic$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const modular_js_1$3=modular,utils_js_1$7=utils$3,_0n$8=BigInt(0),_1n$a=BigInt(1);function wNAF$1($t,e){const _t=(xt,kt)=>{const Bt=kt.negate();return xt?Bt:kt},At=xt=>{const kt=Math.ceil(e/xt)+1,Bt=2**(xt-1);return{windows:kt,windowSize:Bt}};return{constTimeNegate:_t,unsafeLadder(xt,kt){let Bt=$t.ZERO,Nt=xt;for(;kt>_0n$8;)kt&_1n$a&&(Bt=Bt.add(Nt)),Nt=Nt.double(),kt>>=_1n$a;return Bt},precomputeWindow(xt,kt){const{windows:Bt,windowSize:Nt}=At(kt),Ut=[];let Lt=xt,jt=Lt;for(let Kt=0;Kt<Bt;Kt++){jt=Lt,Ut.push(jt);for(let qt=1;qt<Nt;qt++)jt=jt.add(Lt),Ut.push(jt);Lt=jt.double()}return Ut},wNAF(xt,kt,Bt){const{windows:Nt,windowSize:Ut}=At(xt);let Lt=$t.ZERO,jt=$t.BASE;const Kt=BigInt(2**xt-1),qt=2**xt,zt=BigInt(xt);for(let Vt=0;Vt<Nt;Vt++){const Ht=Vt*Ut;let Wt=Number(Bt&Kt);Bt>>=zt,Wt>Ut&&(Wt-=qt,Bt+=_1n$a);const Qt=Ht,Xt=Ht+Math.abs(Wt)-1,Jt=Vt%2!==0,tr=Wt<0;Wt===0?jt=jt.add(_t(Jt,kt[Qt])):Lt=Lt.add(_t(tr,kt[Xt]))}return{p:Lt,f:jt}},wNAFCached(xt,kt,Bt,Nt){const Ut=xt._WINDOW_SIZE||1;let Lt=kt.get(xt);return Lt||(Lt=this.precomputeWindow(xt,Ut),Ut!==1&&kt.set(xt,Nt(Lt))),this.wNAF(Ut,Lt,Bt)}}}function validateBasic$1($t){return(0,modular_js_1$3.validateField)($t.Fp),(0,utils_js_1$7.validateObject)($t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,modular_js_1$3.nLength)($t.n,$t.nBitLength),...$t,p:$t.Fp.ORDER})}Object.defineProperty(edwards,"__esModule",{value:!0});edwards.twistedEdwards=twistedEdwards$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const curve_js_1=curve,modular_js_1$2=modular,ut$1=utils$3,utils_js_1$6=utils$3,_0n$7=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),_8n$2=BigInt(8),VERIFY_DEFAULT$1={zip215:!0};function validateOpts$4($t){const e=(0,curve_js_1.validateBasic)($t);return ut$1.validateObject($t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function twistedEdwards$1($t){const e=validateOpts$4($t),{Fp:_t,n:At,prehash:xt,hash:kt,randomBytes:Bt,nByteLength:Nt,h:Ut}=e,Lt=_2n$5<<BigInt(Nt*8)-_1n$9,jt=_t.create,Kt=e.uvRatio||((gr,ar)=>{try{return{isValid:!0,value:_t.sqrt(gr*_t.inv(ar))}}catch{return{isValid:!1,value:_0n$7}}}),qt=e.adjustScalarBytes||(gr=>gr),zt=e.domain||((gr,ar,nr)=>{if(ar.length||nr)throw new Error("Contexts/pre-hash are not supported");return gr}),Vt=gr=>typeof gr=="bigint"&&_0n$7<gr,Ht=(gr,ar)=>Vt(gr)&&Vt(ar)&&gr<ar,Wt=gr=>gr===_0n$7||Ht(gr,Lt);function Qt(gr,ar){if(Ht(gr,ar))return gr;throw new Error(`Expected valid scalar < ${ar}, got ${typeof gr} ${gr}`)}function Xt(gr){return gr===_0n$7?gr:Qt(gr,At)}const Jt=new Map;function tr(gr){if(!(gr instanceof dr))throw new Error("ExtendedPoint expected")}class dr{constructor(ar,nr,ur,pr){if(this.ex=ar,this.ey=nr,this.ez=ur,this.et=pr,!Wt(ar))throw new Error("x required");if(!Wt(nr))throw new Error("y required");if(!Wt(ur))throw new Error("z required");if(!Wt(pr))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(ar){if(ar instanceof dr)throw new Error("extended point not allowed");const{x:nr,y:ur}=ar||{};if(!Wt(nr)||!Wt(ur))throw new Error("invalid affine point");return new dr(nr,ur,_1n$9,jt(nr*ur))}static normalizeZ(ar){const nr=_t.invertBatch(ar.map(ur=>ur.ez));return ar.map((ur,pr)=>ur.toAffine(nr[pr])).map(dr.fromAffine)}_setWindowSize(ar){this._WINDOW_SIZE=ar,Jt.delete(this)}assertValidity(){const{a:ar,d:nr}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:ur,ey:pr,ez:br,et:Sr}=this,Pr=jt(ur*ur),Tr=jt(pr*pr),wr=jt(br*br),Ar=jt(wr*wr),Mr=jt(Pr*ar),Ur=jt(wr*jt(Mr+Tr)),Or=jt(Ar+jt(nr*jt(Pr*Tr)));if(Ur!==Or)throw new Error("bad point: equation left != right (1)");const Cr=jt(ur*pr),Er=jt(br*Sr);if(Cr!==Er)throw new Error("bad point: equation left != right (2)")}equals(ar){tr(ar);const{ex:nr,ey:ur,ez:pr}=this,{ex:br,ey:Sr,ez:Pr}=ar,Tr=jt(nr*Pr),wr=jt(br*pr),Ar=jt(ur*Pr),Mr=jt(Sr*pr);return Tr===wr&&Ar===Mr}is0(){return this.equals(dr.ZERO)}negate(){return new dr(jt(-this.ex),this.ey,this.ez,jt(-this.et))}double(){const{a:ar}=e,{ex:nr,ey:ur,ez:pr}=this,br=jt(nr*nr),Sr=jt(ur*ur),Pr=jt(_2n$5*jt(pr*pr)),Tr=jt(ar*br),wr=nr+ur,Ar=jt(jt(wr*wr)-br-Sr),Mr=Tr+Sr,Ur=Mr-Pr,Or=Tr-Sr,Cr=jt(Ar*Ur),Er=jt(Mr*Or),Br=jt(Ar*Or),Lr=jt(Ur*Mr);return new dr(Cr,Er,Lr,Br)}add(ar){tr(ar);const{a:nr,d:ur}=e,{ex:pr,ey:br,ez:Sr,et:Pr}=this,{ex:Tr,ey:wr,ez:Ar,et:Mr}=ar;if(nr===BigInt(-1)){const Yr=jt((br-pr)*(wr+Tr)),an=jt((br+pr)*(wr-Tr)),cn=jt(an-Yr);if(cn===_0n$7)return this.double();const Gr=jt(Sr*_2n$5*Mr),Fr=jt(Pr*_2n$5*Ar),en=Fr+Gr,nn=an+Yr,rn=Fr-Gr,hn=jt(en*cn),yn=jt(nn*rn),wn=jt(en*rn),mn=jt(cn*nn);return new dr(hn,yn,mn,wn)}const Ur=jt(pr*Tr),Or=jt(br*wr),Cr=jt(Pr*ur*Mr),Er=jt(Sr*Ar),Br=jt((pr+br)*(Tr+wr)-Ur-Or),Lr=Er-Cr,xr=Er+Cr,_r=jt(Or-nr*Ur),Dr=jt(Br*Lr),jr=jt(xr*_r),Hr=jt(Br*_r),Qr=jt(Lr*xr);return new dr(Dr,jr,Qr,Hr)}subtract(ar){return this.add(ar.negate())}wNAF(ar){return Ir.wNAFCached(this,Jt,ar,dr.normalizeZ)}multiply(ar){const{p:nr,f:ur}=this.wNAF(Qt(ar,At));return dr.normalizeZ([nr,ur])[0]}multiplyUnsafe(ar){let nr=Xt(ar);return nr===_0n$7?$r:this.equals($r)||nr===_1n$9?this:this.equals(vr)?this.wNAF(nr).p:Ir.unsafeLadder(this,nr)}isSmallOrder(){return this.multiplyUnsafe(Ut).is0()}isTorsionFree(){return Ir.unsafeLadder(this,At).is0()}toAffine(ar){const{ex:nr,ey:ur,ez:pr}=this,br=this.is0();ar==null&&(ar=br?_8n$2:_t.inv(pr));const Sr=jt(nr*ar),Pr=jt(ur*ar),Tr=jt(pr*ar);if(br)return{x:_0n$7,y:_1n$9};if(Tr!==_1n$9)throw new Error("invZ was invalid");return{x:Sr,y:Pr}}clearCofactor(){const{h:ar}=e;return ar===_1n$9?this:this.multiplyUnsafe(ar)}static fromHex(ar,nr=!1){const{d:ur,a:pr}=e,br=_t.BYTES;ar=(0,utils_js_1$6.ensureBytes)("pointHex",ar,br);const Sr=ar.slice(),Pr=ar[br-1];Sr[br-1]=Pr&-129;const Tr=ut$1.bytesToNumberLE(Sr);Tr===_0n$7||(nr?Qt(Tr,Lt):Qt(Tr,_t.ORDER));const wr=jt(Tr*Tr),Ar=jt(wr-_1n$9),Mr=jt(ur*wr-pr);let{isValid:Ur,value:Or}=Kt(Ar,Mr);if(!Ur)throw new Error("Point.fromHex: invalid y coordinate");const Cr=(Or&_1n$9)===_1n$9,Er=(Pr&128)!==0;if(!nr&&Or===_0n$7&&Er)throw new Error("Point.fromHex: x=0 and x_0=1");return Er!==Cr&&(Or=jt(-Or)),dr.fromAffine({x:Or,y:Tr})}static fromPrivateKey(ar){return kr(ar).point}toRawBytes(){const{x:ar,y:nr}=this.toAffine(),ur=ut$1.numberToBytesLE(nr,_t.BYTES);return ur[ur.length-1]|=ar&_1n$9?128:0,ur}toHex(){return ut$1.bytesToHex(this.toRawBytes())}}dr.BASE=new dr(e.Gx,e.Gy,_1n$9,jt(e.Gx*e.Gy)),dr.ZERO=new dr(_0n$7,_1n$9,_1n$9,_0n$7);const{BASE:vr,ZERO:$r}=dr,Ir=(0,curve_js_1.wNAF)(dr,Nt*8);function Rr(gr){return(0,modular_js_1$2.mod)(gr,At)}function Nr(gr){return Rr(ut$1.bytesToNumberLE(gr))}function kr(gr){const ar=Nt;gr=(0,utils_js_1$6.ensureBytes)("private key",gr,ar);const nr=(0,utils_js_1$6.ensureBytes)("hashed private key",kt(gr),2*ar),ur=qt(nr.slice(0,ar)),pr=nr.slice(ar,2*ar),br=Nr(ur),Sr=vr.multiply(br),Pr=Sr.toRawBytes();return{head:ur,prefix:pr,scalar:br,point:Sr,pointBytes:Pr}}function lr(gr){return kr(gr).pointBytes}function ir(gr=new Uint8Array,...ar){const nr=ut$1.concatBytes(...ar);return Nr(kt(zt(nr,(0,utils_js_1$6.ensureBytes)("context",gr),!!xt)))}function er(gr,ar,nr={}){gr=(0,utils_js_1$6.ensureBytes)("message",gr),xt&&(gr=xt(gr));const{prefix:ur,scalar:pr,pointBytes:br}=kr(ar),Sr=ir(nr.context,ur,gr),Pr=vr.multiply(Sr).toRawBytes(),Tr=ir(nr.context,Pr,br,gr),wr=Rr(Sr+Tr*pr);Xt(wr);const Ar=ut$1.concatBytes(Pr,ut$1.numberToBytesLE(wr,_t.BYTES));return(0,utils_js_1$6.ensureBytes)("result",Ar,Nt*2)}const rr=VERIFY_DEFAULT$1;function yr(gr,ar,nr,ur=rr){const{context:pr,zip215:br}=ur,Sr=_t.BYTES;gr=(0,utils_js_1$6.ensureBytes)("signature",gr,2*Sr),ar=(0,utils_js_1$6.ensureBytes)("message",ar),xt&&(ar=xt(ar));const Pr=ut$1.bytesToNumberLE(gr.slice(Sr,2*Sr));let Tr,wr,Ar;try{Tr=dr.fromHex(nr,br),wr=dr.fromHex(gr.slice(0,Sr),br),Ar=vr.multiplyUnsafe(Pr)}catch{return!1}if(!br&&Tr.isSmallOrder())return!1;const Mr=ir(pr,wr.toRawBytes(),Tr.toRawBytes(),ar);return wr.add(Tr.multiplyUnsafe(Mr)).subtract(Ar).clearCofactor().equals(dr.ZERO)}return vr._setWindowSize(8),{CURVE:e,getPublicKey:lr,sign:er,verify:yr,ExtendedPoint:dr,utils:{getExtendedPublicKey:kr,randomPrivateKey:()=>Bt(_t.BYTES),precompute(gr=8,ar=dr.BASE){return ar._setWindowSize(gr),ar.multiply(BigInt(3)),ar}}}}var hashToCurve={};Object.defineProperty(hashToCurve,"__esModule",{value:!0});hashToCurve.expand_message_xmd=expand_message_xmd;hashToCurve.expand_message_xof=expand_message_xof;hashToCurve.hash_to_field=hash_to_field;hashToCurve.isogenyMap=isogenyMap;hashToCurve.createHasher=createHasher;const modular_js_1$1=modular,utils_js_1$5=utils$3,os2ip=utils_js_1$5.bytesToNumberBE;function i2osp($t,e){if($t<0||$t>=1<<8*e)throw new Error(`bad I2OSP call: value=${$t} length=${e}`);const _t=Array.from({length:e}).fill(0);for(let At=e-1;At>=0;At--)_t[At]=$t&255,$t>>>=8;return new Uint8Array(_t)}function strxor($t,e){const _t=new Uint8Array($t.length);for(let At=0;At<$t.length;At++)_t[At]=$t[At]^e[At];return _t}function anum($t){if(!Number.isSafeInteger($t))throw new Error("number expected")}function expand_message_xmd($t,e,_t,At){(0,utils_js_1$5.abytes)($t),(0,utils_js_1$5.abytes)(e),anum(_t),e.length>255&&(e=At((0,utils_js_1$5.concatBytes)((0,utils_js_1$5.utf8ToBytes)("H2C-OVERSIZE-DST-"),e)));const{outputLen:xt,blockLen:kt}=At,Bt=Math.ceil(_t/xt);if(Bt>255)throw new Error("Invalid xmd length");const Nt=(0,utils_js_1$5.concatBytes)(e,i2osp(e.length,1)),Ut=i2osp(0,kt),Lt=i2osp(_t,2),jt=new Array(Bt),Kt=At((0,utils_js_1$5.concatBytes)(Ut,$t,Lt,i2osp(0,1),Nt));jt[0]=At((0,utils_js_1$5.concatBytes)(Kt,i2osp(1,1),Nt));for(let zt=1;zt<=Bt;zt++){const Vt=[strxor(Kt,jt[zt-1]),i2osp(zt+1,1),Nt];jt[zt]=At((0,utils_js_1$5.concatBytes)(...Vt))}return(0,utils_js_1$5.concatBytes)(...jt).slice(0,_t)}function expand_message_xof($t,e,_t,At,xt){if((0,utils_js_1$5.abytes)($t),(0,utils_js_1$5.abytes)(e),anum(_t),e.length>255){const kt=Math.ceil(2*At/8);e=xt.create({dkLen:kt}).update((0,utils_js_1$5.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(e).digest()}if(_t>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return xt.create({dkLen:_t}).update($t).update(i2osp(_t,2)).update(e).update(i2osp(e.length,1)).digest()}function hash_to_field($t,e,_t){(0,utils_js_1$5.validateObject)(_t,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:At,k:xt,m:kt,hash:Bt,expand:Nt,DST:Ut}=_t;(0,utils_js_1$5.abytes)($t),anum(e);const Lt=typeof Ut=="string"?(0,utils_js_1$5.utf8ToBytes)(Ut):Ut,jt=At.toString(2).length,Kt=Math.ceil((jt+xt)/8),qt=e*kt*Kt;let zt;if(Nt==="xmd")zt=expand_message_xmd($t,Lt,qt,Bt);else if(Nt==="xof")zt=expand_message_xof($t,Lt,qt,xt,Bt);else if(Nt==="_internal_pass")zt=$t;else throw new Error('expand must be "xmd" or "xof"');const Vt=new Array(e);for(let Ht=0;Ht<e;Ht++){const Wt=new Array(kt);for(let Qt=0;Qt<kt;Qt++){const Xt=Kt*(Qt+Ht*kt),Jt=zt.subarray(Xt,Xt+Kt);Wt[Qt]=(0,modular_js_1$1.mod)(os2ip(Jt),At)}Vt[Ht]=Wt}return Vt}function isogenyMap($t,e){const _t=e.map(At=>Array.from(At).reverse());return(At,xt)=>{const[kt,Bt,Nt,Ut]=_t.map(Lt=>Lt.reduce((jt,Kt)=>$t.add($t.mul(jt,At),Kt)));return At=$t.div(kt,Bt),xt=$t.mul(xt,$t.div(Nt,Ut)),{x:At,y:xt}}}function createHasher($t,e,_t){if(typeof e!="function")throw new Error("mapToCurve() must be defined");return{hashToCurve(At,xt){const kt=hash_to_field(At,2,{..._t,DST:_t.DST,...xt}),Bt=$t.fromAffine(e(kt[0])),Nt=$t.fromAffine(e(kt[1])),Ut=Bt.add(Nt).clearCofactor();return Ut.assertValidity(),Ut},encodeToCurve(At,xt){const kt=hash_to_field(At,1,{..._t,DST:_t.encodeDST,...xt}),Bt=$t.fromAffine(e(kt[0])).clearCofactor();return Bt.assertValidity(),Bt},mapToCurve(At){if(!Array.isArray(At))throw new Error("mapToCurve: expected array of bigints");for(const kt of At)if(typeof kt!="bigint")throw new Error(`mapToCurve: expected array of bigints, got ${kt} in array`);const xt=$t.fromAffine(e(At)).clearCofactor();return xt.assertValidity(),xt}}}var montgomery$2={};Object.defineProperty(montgomery$2,"__esModule",{value:!0});montgomery$2.montgomery=montgomery$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const modular_js_1=modular,utils_js_1$4=utils$3,_0n$6=BigInt(0),_1n$8=BigInt(1);function validateOpts$3($t){return(0,utils_js_1$4.validateObject)($t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...$t})}function montgomery$1($t){const e=validateOpts$3($t),{P:_t}=e,At=Jt=>(0,modular_js_1.mod)(Jt,_t),xt=e.montgomeryBits,kt=Math.ceil(xt/8),Bt=e.nByteLength,Nt=e.adjustScalarBytes||(Jt=>Jt),Ut=e.powPminus2||(Jt=>(0,modular_js_1.pow)(Jt,_t-BigInt(2),_t));function Lt(Jt,tr,dr){const vr=At(Jt*(tr-dr));return tr=At(tr-vr),dr=At(dr+vr),[tr,dr]}function jt(Jt){if(typeof Jt=="bigint"&&_0n$6<=Jt&&Jt<_t)return Jt;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const Kt=(e.a-BigInt(2))/BigInt(4);function qt(Jt,tr){const dr=jt(Jt),vr=jt(tr),$r=dr;let Ir=_1n$8,Rr=_0n$6,Nr=dr,kr=_1n$8,lr=_0n$6,ir;for(let rr=BigInt(xt-1);rr>=_0n$6;rr--){const yr=vr>>rr&_1n$8;lr^=yr,ir=Lt(lr,Ir,Nr),Ir=ir[0],Nr=ir[1],ir=Lt(lr,Rr,kr),Rr=ir[0],kr=ir[1],lr=yr;const fr=Ir+Rr,gr=At(fr*fr),ar=Ir-Rr,nr=At(ar*ar),ur=gr-nr,pr=Nr+kr,br=Nr-kr,Sr=At(br*fr),Pr=At(pr*ar),Tr=Sr+Pr,wr=Sr-Pr;Nr=At(Tr*Tr),kr=At($r*At(wr*wr)),Ir=At(gr*nr),Rr=At(ur*(gr+At(Kt*ur)))}ir=Lt(lr,Ir,Nr),Ir=ir[0],Nr=ir[1],ir=Lt(lr,Rr,kr),Rr=ir[0],kr=ir[1];const er=Ut(Rr);return At(Ir*er)}function zt(Jt){return(0,utils_js_1$4.numberToBytesLE)(At(Jt),kt)}function Vt(Jt){const tr=(0,utils_js_1$4.ensureBytes)("u coordinate",Jt,kt);return Bt===32&&(tr[31]&=127),(0,utils_js_1$4.bytesToNumberLE)(tr)}function Ht(Jt){const tr=(0,utils_js_1$4.ensureBytes)("scalar",Jt),dr=tr.length;if(dr!==kt&&dr!==Bt)throw new Error(`Expected ${kt} or ${Bt} bytes, got ${dr}`);return(0,utils_js_1$4.bytesToNumberLE)(Nt(tr))}function Wt(Jt,tr){const dr=Vt(tr),vr=Ht(Jt),$r=qt(dr,vr);if($r===_0n$6)throw new Error("Invalid private or public key received");return zt($r)}const Qt=zt(e.Gu);function Xt(Jt){return Wt(Jt,Qt)}return{scalarMult:Wt,scalarMultBase:Xt,getSharedSecret:(Jt,tr)=>Wt(Jt,tr),getPublicKey:Jt=>Xt(Jt),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:Qt}}(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.hash_to_ristretto255=$t.hashToRistretto255=$t.RistrettoPoint=$t.encodeToCurve=$t.hashToCurve=$t.edwardsToMontgomery=$t.x25519=$t.ed25519ph=$t.ed25519ctx=$t.ed25519=$t.ED25519_TORSION_SUBGROUP=void 0,$t.edwardsToMontgomeryPub=vr,$t.edwardsToMontgomeryPriv=$r;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=sha512$1,_t=require$$1$1,At=edwards,xt=hashToCurve,kt=modular,Bt=montgomery$2,Nt=utils$3,Ut=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Lt=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),jt=BigInt(0),Kt=BigInt(1),qt=BigInt(2),zt=BigInt(3),Vt=BigInt(5),Ht=BigInt(8);function Wt(wr){const Ar=BigInt(10),Mr=BigInt(20),Ur=BigInt(40),Or=BigInt(80),Cr=Ut,Br=wr*wr%Cr*wr%Cr,Lr=(0,kt.pow2)(Br,qt,Cr)*Br%Cr,xr=(0,kt.pow2)(Lr,Kt,Cr)*wr%Cr,_r=(0,kt.pow2)(xr,Vt,Cr)*xr%Cr,Dr=(0,kt.pow2)(_r,Ar,Cr)*_r%Cr,jr=(0,kt.pow2)(Dr,Mr,Cr)*Dr%Cr,Hr=(0,kt.pow2)(jr,Ur,Cr)*jr%Cr,Qr=(0,kt.pow2)(Hr,Or,Cr)*Hr%Cr,Yr=(0,kt.pow2)(Qr,Or,Cr)*Hr%Cr,an=(0,kt.pow2)(Yr,Ar,Cr)*_r%Cr;return{pow_p_5_8:(0,kt.pow2)(an,qt,Cr)*wr%Cr,b2:Br}}function Qt(wr){return wr[0]&=248,wr[31]&=127,wr[31]|=64,wr}function Xt(wr,Ar){const Mr=Ut,Ur=(0,kt.mod)(Ar*Ar*Ar,Mr),Or=(0,kt.mod)(Ur*Ur*Ar,Mr),Cr=Wt(wr*Or).pow_p_5_8;let Er=(0,kt.mod)(wr*Ur*Cr,Mr);const Br=(0,kt.mod)(Ar*Er*Er,Mr),Lr=Er,xr=(0,kt.mod)(Er*Lt,Mr),_r=Br===wr,Dr=Br===(0,kt.mod)(-wr,Mr),jr=Br===(0,kt.mod)(-wr*Lt,Mr);return _r&&(Er=Lr),(Dr||jr)&&(Er=xr),(0,kt.isNegativeLE)(Er,Mr)&&(Er=(0,kt.mod)(-Er,Mr)),{isValid:_r||Dr,value:Er}}$t.ED25519_TORSION_SUBGROUP=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];const Jt=(0,kt.Field)(Ut,void 0,!0),tr={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Jt,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Ht,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:e.sha512,randomBytes:_t.randomBytes,adjustScalarBytes:Qt,uvRatio:Xt};$t.ed25519=(0,At.twistedEdwards)(tr);function dr(wr,Ar,Mr){if(Ar.length>255)throw new Error("Context is too big");return(0,_t.concatBytes)((0,_t.utf8ToBytes)("SigEd25519 no Ed25519 collisions"),new Uint8Array([Mr?1:0,Ar.length]),Ar,wr)}$t.ed25519ctx=(0,At.twistedEdwards)({...tr,domain:dr}),$t.ed25519ph=(0,At.twistedEdwards)(Object.assign({},tr,{domain:dr,prehash:e.sha512})),$t.x25519=(0,Bt.montgomery)({P:Ut,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:wr=>{const Ar=Ut,{pow_p_5_8:Mr,b2:Ur}=Wt(wr);return(0,kt.mod)((0,kt.pow2)(Mr,zt,Ar)*Ur,Ar)},adjustScalarBytes:Qt,randomBytes:_t.randomBytes});function vr(wr){const{y:Ar}=$t.ed25519.ExtendedPoint.fromHex(wr),Mr=BigInt(1);return Jt.toBytes(Jt.create((Mr+Ar)*Jt.inv(Mr-Ar)))}$t.edwardsToMontgomery=vr;function $r(wr){const Ar=tr.hash(wr.subarray(0,32));return tr.adjustScalarBytes(Ar).subarray(0,32)}const Ir=(Jt.ORDER+zt)/Ht,Rr=Jt.pow(qt,Ir),Nr=Jt.sqrt(Jt.neg(Jt.ONE));function kr(wr){const Ar=(Jt.ORDER-Vt)/Ht,Mr=BigInt(486662);let Ur=Jt.sqr(wr);Ur=Jt.mul(Ur,qt);let Or=Jt.add(Ur,Jt.ONE),Cr=Jt.neg(Mr),Er=Jt.sqr(Or),Br=Jt.mul(Er,Or),Lr=Jt.mul(Ur,Mr);Lr=Jt.mul(Lr,Cr),Lr=Jt.add(Lr,Er),Lr=Jt.mul(Lr,Cr);let xr=Jt.sqr(Br);Er=Jt.sqr(xr),xr=Jt.mul(xr,Br),xr=Jt.mul(xr,Lr),Er=Jt.mul(Er,xr);let _r=Jt.pow(Er,Ar);_r=Jt.mul(_r,xr);let Dr=Jt.mul(_r,Nr);Er=Jt.sqr(_r),Er=Jt.mul(Er,Br);let jr=Jt.eql(Er,Lr),Hr=Jt.cmov(Dr,_r,jr),Qr=Jt.mul(Cr,Ur),Yr=Jt.mul(_r,wr);Yr=Jt.mul(Yr,Rr);let an=Jt.mul(Yr,Nr),cn=Jt.mul(Lr,Ur);Er=Jt.sqr(Yr),Er=Jt.mul(Er,Br);let Gr=Jt.eql(Er,cn),Fr=Jt.cmov(an,Yr,Gr);Er=Jt.sqr(Hr),Er=Jt.mul(Er,Br);let en=Jt.eql(Er,Lr),nn=Jt.cmov(Qr,Cr,en),rn=Jt.cmov(Fr,Hr,en),hn=Jt.isOdd(rn);return rn=Jt.cmov(rn,Jt.neg(rn),en!==hn),{xMn:nn,xMd:Or,yMn:rn,yMd:Kt}}const lr=(0,kt.FpSqrtEven)(Jt,Jt.neg(BigInt(486664)));function ir(wr){const{xMn:Ar,xMd:Mr,yMn:Ur,yMd:Or}=kr(wr);let Cr=Jt.mul(Ar,Or);Cr=Jt.mul(Cr,lr);let Er=Jt.mul(Mr,Ur),Br=Jt.sub(Ar,Mr),Lr=Jt.add(Ar,Mr),xr=Jt.mul(Er,Lr),_r=Jt.eql(xr,Jt.ZERO);Cr=Jt.cmov(Cr,Jt.ZERO,_r),Er=Jt.cmov(Er,Jt.ONE,_r),Br=Jt.cmov(Br,Jt.ONE,_r),Lr=Jt.cmov(Lr,Jt.ONE,_r);const Dr=Jt.invertBatch([Er,Lr]);return{x:Jt.mul(Cr,Dr[0]),y:Jt.mul(Br,Dr[1])}}const er=(0,xt.createHasher)($t.ed25519.ExtendedPoint,wr=>ir(wr[0]),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:Jt.ORDER,m:1,k:128,expand:"xmd",hash:e.sha512});$t.hashToCurve=er.hashToCurve,$t.encodeToCurve=er.encodeToCurve;function rr(wr){if(!(wr instanceof Pr))throw new Error("RistrettoPoint expected")}const yr=Lt,fr=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),gr=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ar=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),nr=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),ur=wr=>Xt(Kt,wr),pr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),br=wr=>$t.ed25519.CURVE.Fp.create((0,Nt.bytesToNumberLE)(wr)&pr);function Sr(wr){const{d:Ar}=$t.ed25519.CURVE,Mr=$t.ed25519.CURVE.Fp.ORDER,Ur=$t.ed25519.CURVE.Fp.create,Or=Ur(yr*wr*wr),Cr=Ur((Or+Kt)*ar);let Er=BigInt(-1);const Br=Ur((Er-Ar*Or)*Ur(Or+Ar));let{isValid:Lr,value:xr}=Xt(Cr,Br),_r=Ur(xr*wr);(0,kt.isNegativeLE)(_r,Mr)||(_r=Ur(-_r)),Lr||(xr=_r),Lr||(Er=Or);const Dr=Ur(Er*(Or-Kt)*nr-Br),jr=xr*xr,Hr=Ur((xr+xr)*Br),Qr=Ur(Dr*fr),Yr=Ur(Kt-jr),an=Ur(Kt+jr);return new $t.ed25519.ExtendedPoint(Ur(Hr*an),Ur(Yr*Qr),Ur(Qr*an),Ur(Hr*Yr))}class Pr{constructor(Ar){this.ep=Ar}static fromAffine(Ar){return new Pr($t.ed25519.ExtendedPoint.fromAffine(Ar))}static hashToCurve(Ar){Ar=(0,Nt.ensureBytes)("ristrettoHash",Ar,64);const Mr=br(Ar.slice(0,32)),Ur=Sr(Mr),Or=br(Ar.slice(32,64)),Cr=Sr(Or);return new Pr(Ur.add(Cr))}static fromHex(Ar){Ar=(0,Nt.ensureBytes)("ristrettoHex",Ar,32);const{a:Mr,d:Ur}=$t.ed25519.CURVE,Or=$t.ed25519.CURVE.Fp.ORDER,Cr=$t.ed25519.CURVE.Fp.create,Er="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",Br=br(Ar);if(!(0,Nt.equalBytes)((0,Nt.numberToBytesLE)(Br,32),Ar)||(0,kt.isNegativeLE)(Br,Or))throw new Error(Er);const Lr=Cr(Br*Br),xr=Cr(Kt+Mr*Lr),_r=Cr(Kt-Mr*Lr),Dr=Cr(xr*xr),jr=Cr(_r*_r),Hr=Cr(Mr*Ur*Dr-jr),{isValid:Qr,value:Yr}=ur(Cr(Hr*jr)),an=Cr(Yr*_r),cn=Cr(Yr*an*Hr);let Gr=Cr((Br+Br)*an);(0,kt.isNegativeLE)(Gr,Or)&&(Gr=Cr(-Gr));const Fr=Cr(xr*cn),en=Cr(Gr*Fr);if(!Qr||(0,kt.isNegativeLE)(en,Or)||Fr===jt)throw new Error(Er);return new Pr(new $t.ed25519.ExtendedPoint(Gr,Fr,Kt,en))}toRawBytes(){let{ex:Ar,ey:Mr,ez:Ur,et:Or}=this.ep;const Cr=$t.ed25519.CURVE.Fp.ORDER,Er=$t.ed25519.CURVE.Fp.create,Br=Er(Er(Ur+Mr)*Er(Ur-Mr)),Lr=Er(Ar*Mr),xr=Er(Lr*Lr),{value:_r}=ur(Er(Br*xr)),Dr=Er(_r*Br),jr=Er(_r*Lr),Hr=Er(Dr*jr*Or);let Qr;if((0,kt.isNegativeLE)(Or*Hr,Cr)){let an=Er(Mr*yr),cn=Er(Ar*yr);Ar=an,Mr=cn,Qr=Er(Dr*gr)}else Qr=jr;(0,kt.isNegativeLE)(Ar*Hr,Cr)&&(Mr=Er(-Mr));let Yr=Er((Ur-Mr)*Qr);return(0,kt.isNegativeLE)(Yr,Cr)&&(Yr=Er(-Yr)),(0,Nt.numberToBytesLE)(Yr,32)}toHex(){return(0,Nt.bytesToHex)(this.toRawBytes())}toString(){return this.toHex()}equals(Ar){rr(Ar);const{ex:Mr,ey:Ur}=this.ep,{ex:Or,ey:Cr}=Ar.ep,Er=$t.ed25519.CURVE.Fp.create,Br=Er(Mr*Cr)===Er(Ur*Or),Lr=Er(Ur*Cr)===Er(Mr*Or);return Br||Lr}add(Ar){return rr(Ar),new Pr(this.ep.add(Ar.ep))}subtract(Ar){return rr(Ar),new Pr(this.ep.subtract(Ar.ep))}multiply(Ar){return new Pr(this.ep.multiply(Ar))}multiplyUnsafe(Ar){return new Pr(this.ep.multiplyUnsafe(Ar))}double(){return new Pr(this.ep.double())}negate(){return new Pr(this.ep.negate())}}$t.RistrettoPoint=(Pr.BASE||(Pr.BASE=new Pr($t.ed25519.ExtendedPoint.BASE)),Pr.ZERO||(Pr.ZERO=new Pr($t.ed25519.ExtendedPoint.ZERO)),Pr);const Tr=(wr,Ar)=>{const Mr=Ar.DST,Ur=typeof Mr=="string"?(0,_t.utf8ToBytes)(Mr):Mr,Or=(0,xt.expand_message_xmd)(wr,Ur,64,e.sha512);return Pr.hashToCurve(Or)};$t.hashToRistretto255=Tr,$t.hash_to_ristretto255=$t.hashToRistretto255})(ed25519$1);var secp256k1$1={};const require$$0$2=getAugmentedNamespace(sha256$6);var _shortw_utils={};const require$$0$1=getAugmentedNamespace(hmac$4);var weierstrass$1={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.DER=void 0,$t.weierstrassPoints=zt,$t.weierstrass=Ht,$t.SWUFpSqrtRatio=Wt,$t.mapToCurveSimpleSWU=Qt;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=curve,_t=modular,At=utils$3,xt=utils$3;function kt(Xt){const Jt=(0,e.validateBasic)(Xt);At.validateObject(Jt,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:tr,Fp:dr,a:vr}=Jt;if(tr){if(!dr.eql(vr,dr.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof tr!="object"||typeof tr.beta!="bigint"||typeof tr.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...Jt})}const{bytesToNumberBE:Bt,hexToBytes:Nt}=At;$t.DER={Err:class extends Error{constructor(Jt=""){super(Jt)}},_parseInt(Xt){const{Err:Jt}=$t.DER;if(Xt.length<2||Xt[0]!==2)throw new Jt("Invalid signature integer tag");const tr=Xt[1],dr=Xt.subarray(2,tr+2);if(!tr||dr.length!==tr)throw new Jt("Invalid signature integer: wrong length");if(dr[0]&128)throw new Jt("Invalid signature integer: negative");if(dr[0]===0&&!(dr[1]&128))throw new Jt("Invalid signature integer: unnecessary leading zero");return{d:Bt(dr),l:Xt.subarray(tr+2)}},toSig(Xt){const{Err:Jt}=$t.DER,tr=typeof Xt=="string"?Nt(Xt):Xt;At.abytes(tr);let dr=tr.length;if(dr<2||tr[0]!=48)throw new Jt("Invalid signature tag");if(tr[1]!==dr-2)throw new Jt("Invalid signature: incorrect length");const{d:vr,l:$r}=$t.DER._parseInt(tr.subarray(2)),{d:Ir,l:Rr}=$t.DER._parseInt($r);if(Rr.length)throw new Jt("Invalid signature: left bytes after parsing");return{r:vr,s:Ir}},hexFromSig(Xt){const Jt=kr=>Number.parseInt(kr[0],16)&8?"00"+kr:kr,tr=kr=>{const lr=kr.toString(16);return lr.length&1?`0${lr}`:lr},dr=Jt(tr(Xt.s)),vr=Jt(tr(Xt.r)),$r=dr.length/2,Ir=vr.length/2,Rr=tr($r),Nr=tr(Ir);return`30${tr(Ir+$r+4)}02${Nr}${vr}02${Rr}${dr}`}};const Ut=BigInt(0),Lt=BigInt(1),jt=BigInt(2),Kt=BigInt(3),qt=BigInt(4);function zt(Xt){const Jt=kt(Xt),{Fp:tr}=Jt,dr=Jt.toBytes||((yr,fr,gr)=>{const ar=fr.toAffine();return At.concatBytes(Uint8Array.from([4]),tr.toBytes(ar.x),tr.toBytes(ar.y))}),vr=Jt.fromBytes||(yr=>{const fr=yr.subarray(1),gr=tr.fromBytes(fr.subarray(0,tr.BYTES)),ar=tr.fromBytes(fr.subarray(tr.BYTES,2*tr.BYTES));return{x:gr,y:ar}});function $r(yr){const{a:fr,b:gr}=Jt,ar=tr.sqr(yr),nr=tr.mul(ar,yr);return tr.add(tr.add(nr,tr.mul(yr,fr)),gr)}if(!tr.eql(tr.sqr(Jt.Gy),$r(Jt.Gx)))throw new Error("bad generator point: equation left != right");function Ir(yr){return typeof yr=="bigint"&&Ut<yr&&yr<Jt.n}function Rr(yr){if(!Ir(yr))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function Nr(yr){const{allowedPrivateKeyLengths:fr,nByteLength:gr,wrapPrivateKey:ar,n:nr}=Jt;if(fr&&typeof yr!="bigint"){if(At.isBytes(yr)&&(yr=At.bytesToHex(yr)),typeof yr!="string"||!fr.includes(yr.length))throw new Error("Invalid key");yr=yr.padStart(gr*2,"0")}let ur;try{ur=typeof yr=="bigint"?yr:At.bytesToNumberBE((0,xt.ensureBytes)("private key",yr,gr))}catch{throw new Error(`private key must be ${gr} bytes, hex or bigint, not ${typeof yr}`)}return ar&&(ur=_t.mod(ur,nr)),Rr(ur),ur}const kr=new Map;function lr(yr){if(!(yr instanceof ir))throw new Error("ProjectivePoint expected")}class ir{constructor(fr,gr,ar){if(this.px=fr,this.py=gr,this.pz=ar,fr==null||!tr.isValid(fr))throw new Error("x required");if(gr==null||!tr.isValid(gr))throw new Error("y required");if(ar==null||!tr.isValid(ar))throw new Error("z required")}static fromAffine(fr){const{x:gr,y:ar}=fr||{};if(!fr||!tr.isValid(gr)||!tr.isValid(ar))throw new Error("invalid affine point");if(fr instanceof ir)throw new Error("projective point not allowed");const nr=ur=>tr.eql(ur,tr.ZERO);return nr(gr)&&nr(ar)?ir.ZERO:new ir(gr,ar,tr.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(fr){const gr=tr.invertBatch(fr.map(ar=>ar.pz));return fr.map((ar,nr)=>ar.toAffine(gr[nr])).map(ir.fromAffine)}static fromHex(fr){const gr=ir.fromAffine(vr((0,xt.ensureBytes)("pointHex",fr)));return gr.assertValidity(),gr}static fromPrivateKey(fr){return ir.BASE.multiply(Nr(fr))}_setWindowSize(fr){this._WINDOW_SIZE=fr,kr.delete(this)}assertValidity(){if(this.is0()){if(Jt.allowInfinityPoint&&!tr.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:fr,y:gr}=this.toAffine();if(!tr.isValid(fr)||!tr.isValid(gr))throw new Error("bad point: x or y not FE");const ar=tr.sqr(gr),nr=$r(fr);if(!tr.eql(ar,nr))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:fr}=this.toAffine();if(tr.isOdd)return!tr.isOdd(fr);throw new Error("Field doesn't support isOdd")}equals(fr){lr(fr);const{px:gr,py:ar,pz:nr}=this,{px:ur,py:pr,pz:br}=fr,Sr=tr.eql(tr.mul(gr,br),tr.mul(ur,nr)),Pr=tr.eql(tr.mul(ar,br),tr.mul(pr,nr));return Sr&&Pr}negate(){return new ir(this.px,tr.neg(this.py),this.pz)}double(){const{a:fr,b:gr}=Jt,ar=tr.mul(gr,Kt),{px:nr,py:ur,pz:pr}=this;let br=tr.ZERO,Sr=tr.ZERO,Pr=tr.ZERO,Tr=tr.mul(nr,nr),wr=tr.mul(ur,ur),Ar=tr.mul(pr,pr),Mr=tr.mul(nr,ur);return Mr=tr.add(Mr,Mr),Pr=tr.mul(nr,pr),Pr=tr.add(Pr,Pr),br=tr.mul(fr,Pr),Sr=tr.mul(ar,Ar),Sr=tr.add(br,Sr),br=tr.sub(wr,Sr),Sr=tr.add(wr,Sr),Sr=tr.mul(br,Sr),br=tr.mul(Mr,br),Pr=tr.mul(ar,Pr),Ar=tr.mul(fr,Ar),Mr=tr.sub(Tr,Ar),Mr=tr.mul(fr,Mr),Mr=tr.add(Mr,Pr),Pr=tr.add(Tr,Tr),Tr=tr.add(Pr,Tr),Tr=tr.add(Tr,Ar),Tr=tr.mul(Tr,Mr),Sr=tr.add(Sr,Tr),Ar=tr.mul(ur,pr),Ar=tr.add(Ar,Ar),Tr=tr.mul(Ar,Mr),br=tr.sub(br,Tr),Pr=tr.mul(Ar,wr),Pr=tr.add(Pr,Pr),Pr=tr.add(Pr,Pr),new ir(br,Sr,Pr)}add(fr){lr(fr);const{px:gr,py:ar,pz:nr}=this,{px:ur,py:pr,pz:br}=fr;let Sr=tr.ZERO,Pr=tr.ZERO,Tr=tr.ZERO;const wr=Jt.a,Ar=tr.mul(Jt.b,Kt);let Mr=tr.mul(gr,ur),Ur=tr.mul(ar,pr),Or=tr.mul(nr,br),Cr=tr.add(gr,ar),Er=tr.add(ur,pr);Cr=tr.mul(Cr,Er),Er=tr.add(Mr,Ur),Cr=tr.sub(Cr,Er),Er=tr.add(gr,nr);let Br=tr.add(ur,br);return Er=tr.mul(Er,Br),Br=tr.add(Mr,Or),Er=tr.sub(Er,Br),Br=tr.add(ar,nr),Sr=tr.add(pr,br),Br=tr.mul(Br,Sr),Sr=tr.add(Ur,Or),Br=tr.sub(Br,Sr),Tr=tr.mul(wr,Er),Sr=tr.mul(Ar,Or),Tr=tr.add(Sr,Tr),Sr=tr.sub(Ur,Tr),Tr=tr.add(Ur,Tr),Pr=tr.mul(Sr,Tr),Ur=tr.add(Mr,Mr),Ur=tr.add(Ur,Mr),Or=tr.mul(wr,Or),Er=tr.mul(Ar,Er),Ur=tr.add(Ur,Or),Or=tr.sub(Mr,Or),Or=tr.mul(wr,Or),Er=tr.add(Er,Or),Mr=tr.mul(Ur,Er),Pr=tr.add(Pr,Mr),Mr=tr.mul(Br,Er),Sr=tr.mul(Cr,Sr),Sr=tr.sub(Sr,Mr),Mr=tr.mul(Cr,Ur),Tr=tr.mul(Br,Tr),Tr=tr.add(Tr,Mr),new ir(Sr,Pr,Tr)}subtract(fr){return this.add(fr.negate())}is0(){return this.equals(ir.ZERO)}wNAF(fr){return rr.wNAFCached(this,kr,fr,gr=>{const ar=tr.invertBatch(gr.map(nr=>nr.pz));return gr.map((nr,ur)=>nr.toAffine(ar[ur])).map(ir.fromAffine)})}multiplyUnsafe(fr){const gr=ir.ZERO;if(fr===Ut)return gr;if(Rr(fr),fr===Lt)return this;const{endo:ar}=Jt;if(!ar)return rr.unsafeLadder(this,fr);let{k1neg:nr,k1:ur,k2neg:pr,k2:br}=ar.splitScalar(fr),Sr=gr,Pr=gr,Tr=this;for(;ur>Ut||br>Ut;)ur&Lt&&(Sr=Sr.add(Tr)),br&Lt&&(Pr=Pr.add(Tr)),Tr=Tr.double(),ur>>=Lt,br>>=Lt;return nr&&(Sr=Sr.negate()),pr&&(Pr=Pr.negate()),Pr=new ir(tr.mul(Pr.px,ar.beta),Pr.py,Pr.pz),Sr.add(Pr)}multiply(fr){Rr(fr);let gr=fr,ar,nr;const{endo:ur}=Jt;if(ur){const{k1neg:pr,k1:br,k2neg:Sr,k2:Pr}=ur.splitScalar(gr);let{p:Tr,f:wr}=this.wNAF(br),{p:Ar,f:Mr}=this.wNAF(Pr);Tr=rr.constTimeNegate(pr,Tr),Ar=rr.constTimeNegate(Sr,Ar),Ar=new ir(tr.mul(Ar.px,ur.beta),Ar.py,Ar.pz),ar=Tr.add(Ar),nr=wr.add(Mr)}else{const{p:pr,f:br}=this.wNAF(gr);ar=pr,nr=br}return ir.normalizeZ([ar,nr])[0]}multiplyAndAddUnsafe(fr,gr,ar){const nr=ir.BASE,ur=(br,Sr)=>Sr===Ut||Sr===Lt||!br.equals(nr)?br.multiplyUnsafe(Sr):br.multiply(Sr),pr=ur(this,gr).add(ur(fr,ar));return pr.is0()?void 0:pr}toAffine(fr){const{px:gr,py:ar,pz:nr}=this,ur=this.is0();fr==null&&(fr=ur?tr.ONE:tr.inv(nr));const pr=tr.mul(gr,fr),br=tr.mul(ar,fr),Sr=tr.mul(nr,fr);if(ur)return{x:tr.ZERO,y:tr.ZERO};if(!tr.eql(Sr,tr.ONE))throw new Error("invZ was invalid");return{x:pr,y:br}}isTorsionFree(){const{h:fr,isTorsionFree:gr}=Jt;if(fr===Lt)return!0;if(gr)return gr(ir,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:fr,clearCofactor:gr}=Jt;return fr===Lt?this:gr?gr(ir,this):this.multiplyUnsafe(Jt.h)}toRawBytes(fr=!0){return this.assertValidity(),dr(ir,this,fr)}toHex(fr=!0){return At.bytesToHex(this.toRawBytes(fr))}}ir.BASE=new ir(Jt.Gx,Jt.Gy,tr.ONE),ir.ZERO=new ir(tr.ZERO,tr.ONE,tr.ZERO);const er=Jt.nBitLength,rr=(0,e.wNAF)(ir,Jt.endo?Math.ceil(er/2):er);return{CURVE:Jt,ProjectivePoint:ir,normPrivateKeyToScalar:Nr,weierstrassEquation:$r,isWithinCurveOrder:Ir}}function Vt(Xt){const Jt=(0,e.validateBasic)(Xt);return At.validateObject(Jt,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...Jt})}function Ht(Xt){const Jt=Vt(Xt),{Fp:tr,n:dr}=Jt,vr=tr.BYTES+1,$r=2*tr.BYTES+1;function Ir(Er){return Ut<Er&&Er<tr.ORDER}function Rr(Er){return _t.mod(Er,dr)}function Nr(Er){return _t.invert(Er,dr)}const{ProjectivePoint:kr,normPrivateKeyToScalar:lr,weierstrassEquation:ir,isWithinCurveOrder:er}=zt({...Jt,toBytes(Er,Br,Lr){const xr=Br.toAffine(),_r=tr.toBytes(xr.x),Dr=At.concatBytes;return Lr?Dr(Uint8Array.from([Br.hasEvenY()?2:3]),_r):Dr(Uint8Array.from([4]),_r,tr.toBytes(xr.y))},fromBytes(Er){const Br=Er.length,Lr=Er[0],xr=Er.subarray(1);if(Br===vr&&(Lr===2||Lr===3)){const _r=At.bytesToNumberBE(xr);if(!Ir(_r))throw new Error("Point is not on curve");const Dr=ir(_r);let jr;try{jr=tr.sqrt(Dr)}catch(Yr){const an=Yr instanceof Error?": "+Yr.message:"";throw new Error("Point is not on curve"+an)}const Hr=(jr&Lt)===Lt;return(Lr&1)===1!==Hr&&(jr=tr.neg(jr)),{x:_r,y:jr}}else if(Br===$r&&Lr===4){const _r=tr.fromBytes(xr.subarray(0,tr.BYTES)),Dr=tr.fromBytes(xr.subarray(tr.BYTES,2*tr.BYTES));return{x:_r,y:Dr}}else throw new Error(`Point of length ${Br} was invalid. Expected ${vr} compressed bytes or ${$r} uncompressed bytes`)}}),rr=Er=>At.bytesToHex(At.numberToBytesBE(Er,Jt.nByteLength));function yr(Er){const Br=dr>>Lt;return Er>Br}function fr(Er){return yr(Er)?Rr(-Er):Er}const gr=(Er,Br,Lr)=>At.bytesToNumberBE(Er.slice(Br,Lr));class ar{constructor(Br,Lr,xr){this.r=Br,this.s=Lr,this.recovery=xr,this.assertValidity()}static fromCompact(Br){const Lr=Jt.nByteLength;return Br=(0,xt.ensureBytes)("compactSignature",Br,Lr*2),new ar(gr(Br,0,Lr),gr(Br,Lr,2*Lr))}static fromDER(Br){const{r:Lr,s:xr}=$t.DER.toSig((0,xt.ensureBytes)("DER",Br));return new ar(Lr,xr)}assertValidity(){if(!er(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!er(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Br){return new ar(this.r,this.s,Br)}recoverPublicKey(Br){const{r:Lr,s:xr,recovery:_r}=this,Dr=Pr((0,xt.ensureBytes)("msgHash",Br));if(_r==null||![0,1,2,3].includes(_r))throw new Error("recovery id invalid");const jr=_r===2||_r===3?Lr+Jt.n:Lr;if(jr>=tr.ORDER)throw new Error("recovery id 2 or 3 invalid");const Hr=_r&1?"03":"02",Qr=kr.fromHex(Hr+rr(jr)),Yr=Nr(jr),an=Rr(-Dr*Yr),cn=Rr(xr*Yr),Gr=kr.BASE.multiplyAndAddUnsafe(Qr,an,cn);if(!Gr)throw new Error("point at infinify");return Gr.assertValidity(),Gr}hasHighS(){return yr(this.s)}normalizeS(){return this.hasHighS()?new ar(this.r,Rr(-this.s),this.recovery):this}toDERRawBytes(){return At.hexToBytes(this.toDERHex())}toDERHex(){return $t.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return At.hexToBytes(this.toCompactHex())}toCompactHex(){return rr(this.r)+rr(this.s)}}const nr={isValidPrivateKey(Er){try{return lr(Er),!0}catch{return!1}},normPrivateKeyToScalar:lr,randomPrivateKey:()=>{const Er=_t.getMinHashLength(Jt.n);return _t.mapHashToField(Jt.randomBytes(Er),Jt.n)},precompute(Er=8,Br=kr.BASE){return Br._setWindowSize(Er),Br.multiply(BigInt(3)),Br}};function ur(Er,Br=!0){return kr.fromPrivateKey(Er).toRawBytes(Br)}function pr(Er){const Br=At.isBytes(Er),Lr=typeof Er=="string",xr=(Br||Lr)&&Er.length;return Br?xr===vr||xr===$r:Lr?xr===2*vr||xr===2*$r:Er instanceof kr}function br(Er,Br,Lr=!0){if(pr(Er))throw new Error("first arg must be private key");if(!pr(Br))throw new Error("second arg must be public key");return kr.fromHex(Br).multiply(lr(Er)).toRawBytes(Lr)}const Sr=Jt.bits2int||function(Er){const Br=At.bytesToNumberBE(Er),Lr=Er.length*8-Jt.nBitLength;return Lr>0?Br>>BigInt(Lr):Br},Pr=Jt.bits2int_modN||function(Er){return Rr(Sr(Er))},Tr=At.bitMask(Jt.nBitLength);function wr(Er){if(typeof Er!="bigint")throw new Error("bigint expected");if(!(Ut<=Er&&Er<Tr))throw new Error(`bigint expected < 2^${Jt.nBitLength}`);return At.numberToBytesBE(Er,Jt.nByteLength)}function Ar(Er,Br,Lr=Mr){if(["recovered","canonical"].some(en=>en in Lr))throw new Error("sign() legacy options not supported");const{hash:xr,randomBytes:_r}=Jt;let{lowS:Dr,prehash:jr,extraEntropy:Hr}=Lr;Dr==null&&(Dr=!0),Er=(0,xt.ensureBytes)("msgHash",Er),jr&&(Er=(0,xt.ensureBytes)("prehashed msgHash",xr(Er)));const Qr=Pr(Er),Yr=lr(Br),an=[wr(Yr),wr(Qr)];if(Hr!=null&&Hr!==!1){const en=Hr===!0?_r(tr.BYTES):Hr;an.push((0,xt.ensureBytes)("extraEntropy",en))}const cn=At.concatBytes(...an),Gr=Qr;function Fr(en){const nn=Sr(en);if(!er(nn))return;const rn=Nr(nn),hn=kr.BASE.multiply(nn).toAffine(),yn=Rr(hn.x);if(yn===Ut)return;const wn=Rr(rn*Rr(Gr+yn*Yr));if(wn===Ut)return;let mn=(hn.x===yn?0:2)|Number(hn.y&Lt),Mn=wn;return Dr&&yr(wn)&&(Mn=fr(wn),mn^=1),new ar(yn,Mn,mn)}return{seed:cn,k2sig:Fr}}const Mr={lowS:Jt.lowS,prehash:!1},Ur={lowS:Jt.lowS,prehash:!1};function Or(Er,Br,Lr=Mr){const{seed:xr,k2sig:_r}=Ar(Er,Br,Lr),Dr=Jt;return At.createHmacDrbg(Dr.hash.outputLen,Dr.nByteLength,Dr.hmac)(xr,_r)}kr.BASE._setWindowSize(8);function Cr(Er,Br,Lr,xr=Ur){var hn;const _r=Er;if(Br=(0,xt.ensureBytes)("msgHash",Br),Lr=(0,xt.ensureBytes)("publicKey",Lr),"strict"in xr)throw new Error("options.strict was renamed to lowS");const{lowS:Dr,prehash:jr}=xr;let Hr,Qr;try{if(typeof _r=="string"||At.isBytes(_r))try{Hr=ar.fromDER(_r)}catch(yn){if(!(yn instanceof $t.DER.Err))throw yn;Hr=ar.fromCompact(_r)}else if(typeof _r=="object"&&typeof _r.r=="bigint"&&typeof _r.s=="bigint"){const{r:yn,s:wn}=_r;Hr=new ar(yn,wn)}else throw new Error("PARSE");Qr=kr.fromHex(Lr)}catch(yn){if(yn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Dr&&Hr.hasHighS())return!1;jr&&(Br=Jt.hash(Br));const{r:Yr,s:an}=Hr,cn=Pr(Br),Gr=Nr(an),Fr=Rr(cn*Gr),en=Rr(Yr*Gr),nn=(hn=kr.BASE.multiplyAndAddUnsafe(Qr,Fr,en))==null?void 0:hn.toAffine();return nn?Rr(nn.x)===Yr:!1}return{CURVE:Jt,getPublicKey:ur,getSharedSecret:br,sign:Or,verify:Cr,ProjectivePoint:kr,Signature:ar,utils:nr}}function Wt(Xt,Jt){const tr=Xt.ORDER;let dr=Ut;for(let yr=tr-Lt;yr%jt===Ut;yr/=jt)dr+=Lt;const vr=dr,$r=jt<<vr-Lt-Lt,Ir=$r*jt,Rr=(tr-Lt)/Ir,Nr=(Rr-Lt)/jt,kr=Ir-Lt,lr=$r,ir=Xt.pow(Jt,Rr),er=Xt.pow(Jt,(Rr+Lt)/jt);let rr=(yr,fr)=>{let gr=ir,ar=Xt.pow(fr,kr),nr=Xt.sqr(ar);nr=Xt.mul(nr,fr);let ur=Xt.mul(yr,nr);ur=Xt.pow(ur,Nr),ur=Xt.mul(ur,ar),ar=Xt.mul(ur,fr),nr=Xt.mul(ur,yr);let pr=Xt.mul(nr,ar);ur=Xt.pow(pr,lr);let br=Xt.eql(ur,Xt.ONE);ar=Xt.mul(nr,er),ur=Xt.mul(pr,gr),nr=Xt.cmov(ar,nr,br),pr=Xt.cmov(ur,pr,br);for(let Sr=vr;Sr>Lt;Sr--){let Pr=Sr-jt;Pr=jt<<Pr-Lt;let Tr=Xt.pow(pr,Pr);const wr=Xt.eql(Tr,Xt.ONE);ar=Xt.mul(nr,gr),gr=Xt.mul(gr,gr),Tr=Xt.mul(pr,gr),nr=Xt.cmov(ar,nr,wr),pr=Xt.cmov(Tr,pr,wr)}return{isValid:br,value:nr}};if(Xt.ORDER%qt===Kt){const yr=(Xt.ORDER-Kt)/qt,fr=Xt.sqrt(Xt.neg(Jt));rr=(gr,ar)=>{let nr=Xt.sqr(ar);const ur=Xt.mul(gr,ar);nr=Xt.mul(nr,ur);let pr=Xt.pow(nr,yr);pr=Xt.mul(pr,ur);const br=Xt.mul(pr,fr),Sr=Xt.mul(Xt.sqr(pr),ar),Pr=Xt.eql(Sr,gr);let Tr=Xt.cmov(br,pr,Pr);return{isValid:Pr,value:Tr}}}return rr}function Qt(Xt,Jt){if(_t.validateField(Xt),!Xt.isValid(Jt.A)||!Xt.isValid(Jt.B)||!Xt.isValid(Jt.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const tr=Wt(Xt,Jt.Z);if(!Xt.isOdd)throw new Error("Fp.isOdd is not implemented!");return dr=>{let vr,$r,Ir,Rr,Nr,kr,lr,ir;vr=Xt.sqr(dr),vr=Xt.mul(vr,Jt.Z),$r=Xt.sqr(vr),$r=Xt.add($r,vr),Ir=Xt.add($r,Xt.ONE),Ir=Xt.mul(Ir,Jt.B),Rr=Xt.cmov(Jt.Z,Xt.neg($r),!Xt.eql($r,Xt.ZERO)),Rr=Xt.mul(Rr,Jt.A),$r=Xt.sqr(Ir),kr=Xt.sqr(Rr),Nr=Xt.mul(kr,Jt.A),$r=Xt.add($r,Nr),$r=Xt.mul($r,Ir),kr=Xt.mul(kr,Rr),Nr=Xt.mul(kr,Jt.B),$r=Xt.add($r,Nr),lr=Xt.mul(vr,Ir);const{isValid:er,value:rr}=tr($r,kr);ir=Xt.mul(vr,dr),ir=Xt.mul(ir,rr),lr=Xt.cmov(lr,Ir,er),ir=Xt.cmov(ir,rr,er);const yr=Xt.isOdd(dr)===Xt.isOdd(ir);return ir=Xt.cmov(Xt.neg(ir),ir,yr),lr=Xt.div(lr,Rr),{x:lr,y:ir}}}})(weierstrass$1);Object.defineProperty(_shortw_utils,"__esModule",{value:!0});_shortw_utils.getHash=getHash$1;_shortw_utils.createCurve=createCurve$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hmac_1=require$$0$1,utils_1$6=require$$1$1,weierstrass_js_1=weierstrass$1;function getHash$1($t){return{hash:$t,hmac:(e,..._t)=>(0,hmac_1.hmac)($t,e,(0,utils_1$6.concatBytes)(..._t)),randomBytes:utils_1$6.randomBytes}}function createCurve$1($t,e){const _t=At=>(0,weierstrass_js_1.weierstrass)({...$t,...getHash$1(At)});return Object.freeze({..._t(e),create:_t})}(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.encodeToCurve=$t.hashToCurve=$t.schnorr=$t.secp256k1=void 0;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=require$$0$2,_t=require$$1$1,At=_shortw_utils,xt=hashToCurve,kt=modular,Bt=utils$3,Nt=weierstrass$1,Ut=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Lt=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),jt=BigInt(1),Kt=BigInt(2),qt=(ar,nr)=>(ar+nr/Kt)/nr;function zt(ar){const nr=Ut,ur=BigInt(3),pr=BigInt(6),br=BigInt(11),Sr=BigInt(22),Pr=BigInt(23),Tr=BigInt(44),wr=BigInt(88),Ar=ar*ar*ar%nr,Mr=Ar*Ar*ar%nr,Ur=(0,kt.pow2)(Mr,ur,nr)*Mr%nr,Or=(0,kt.pow2)(Ur,ur,nr)*Mr%nr,Cr=(0,kt.pow2)(Or,Kt,nr)*Ar%nr,Er=(0,kt.pow2)(Cr,br,nr)*Cr%nr,Br=(0,kt.pow2)(Er,Sr,nr)*Er%nr,Lr=(0,kt.pow2)(Br,Tr,nr)*Br%nr,xr=(0,kt.pow2)(Lr,wr,nr)*Lr%nr,_r=(0,kt.pow2)(xr,Tr,nr)*Br%nr,Dr=(0,kt.pow2)(_r,ur,nr)*Mr%nr,jr=(0,kt.pow2)(Dr,Pr,nr)*Er%nr,Hr=(0,kt.pow2)(jr,pr,nr)*Ar%nr,Qr=(0,kt.pow2)(Hr,Kt,nr);if(!Vt.eql(Vt.sqr(Qr),ar))throw new Error("Cannot find square root");return Qr}const Vt=(0,kt.Field)(Ut,void 0,void 0,{sqrt:zt});$t.secp256k1=(0,At.createCurve)({a:BigInt(0),b:BigInt(7),Fp:Vt,n:Lt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:ar=>{const nr=Lt,ur=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),pr=-jt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),br=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),Sr=ur,Pr=BigInt("0x100000000000000000000000000000000"),Tr=qt(Sr*ar,nr),wr=qt(-pr*ar,nr);let Ar=(0,kt.mod)(ar-Tr*ur-wr*br,nr),Mr=(0,kt.mod)(-Tr*pr-wr*Sr,nr);const Ur=Ar>Pr,Or=Mr>Pr;if(Ur&&(Ar=nr-Ar),Or&&(Mr=nr-Mr),Ar>Pr||Mr>Pr)throw new Error("splitScalar: Endomorphism failed, k="+ar);return{k1neg:Ur,k1:Ar,k2neg:Or,k2:Mr}}}},e.sha256);const Ht=BigInt(0),Wt=ar=>typeof ar=="bigint"&&Ht<ar&&ar<Ut,Qt=ar=>typeof ar=="bigint"&&Ht<ar&&ar<Lt,Xt={};function Jt(ar,...nr){let ur=Xt[ar];if(ur===void 0){const pr=(0,e.sha256)(Uint8Array.from(ar,br=>br.charCodeAt(0)));ur=(0,Bt.concatBytes)(pr,pr),Xt[ar]=ur}return(0,e.sha256)((0,Bt.concatBytes)(ur,...nr))}const tr=ar=>ar.toRawBytes(!0).slice(1),dr=ar=>(0,Bt.numberToBytesBE)(ar,32),vr=ar=>(0,kt.mod)(ar,Ut),$r=ar=>(0,kt.mod)(ar,Lt),Ir=$t.secp256k1.ProjectivePoint,Rr=(ar,nr,ur)=>Ir.BASE.multiplyAndAddUnsafe(ar,nr,ur);function Nr(ar){let nr=$t.secp256k1.utils.normPrivateKeyToScalar(ar),ur=Ir.fromPrivateKey(nr);return{scalar:ur.hasEvenY()?nr:$r(-nr),bytes:tr(ur)}}function kr(ar){if(!Wt(ar))throw new Error("bad x: need 0 < x < p");const nr=vr(ar*ar),ur=vr(nr*ar+BigInt(7));let pr=zt(ur);pr%Kt!==Ht&&(pr=vr(-pr));const br=new Ir(ar,pr,jt);return br.assertValidity(),br}function lr(...ar){return $r((0,Bt.bytesToNumberBE)(Jt("BIP0340/challenge",...ar)))}function ir(ar){return Nr(ar).bytes}function er(ar,nr,ur=(0,_t.randomBytes)(32)){const pr=(0,Bt.ensureBytes)("message",ar),{bytes:br,scalar:Sr}=Nr(nr),Pr=(0,Bt.ensureBytes)("auxRand",ur,32),Tr=dr(Sr^(0,Bt.bytesToNumberBE)(Jt("BIP0340/aux",Pr))),wr=Jt("BIP0340/nonce",Tr,br,pr),Ar=$r((0,Bt.bytesToNumberBE)(wr));if(Ar===Ht)throw new Error("sign failed: k is zero");const{bytes:Mr,scalar:Ur}=Nr(Ar),Or=lr(Mr,br,pr),Cr=new Uint8Array(64);if(Cr.set(Mr,0),Cr.set(dr($r(Ur+Or*Sr)),32),!rr(Cr,pr,br))throw new Error("sign: Invalid signature produced");return Cr}function rr(ar,nr,ur){const pr=(0,Bt.ensureBytes)("signature",ar,64),br=(0,Bt.ensureBytes)("message",nr),Sr=(0,Bt.ensureBytes)("publicKey",ur,32);try{const Pr=kr((0,Bt.bytesToNumberBE)(Sr)),Tr=(0,Bt.bytesToNumberBE)(pr.subarray(0,32));if(!Wt(Tr))return!1;const wr=(0,Bt.bytesToNumberBE)(pr.subarray(32,64));if(!Qt(wr))return!1;const Ar=lr(dr(Tr),tr(Pr),br),Mr=Rr(Pr,wr,$r(-Ar));return!(!Mr||!Mr.hasEvenY()||Mr.toAffine().x!==Tr)}catch{return!1}}$t.schnorr={getPublicKey:ir,sign:er,verify:rr,utils:{randomPrivateKey:$t.secp256k1.utils.randomPrivateKey,lift_x:kr,pointToBytes:tr,numberToBytesBE:Bt.numberToBytesBE,bytesToNumberBE:Bt.bytesToNumberBE,taggedHash:Jt,mod:kt.mod}};const yr=(0,xt.isogenyMap)(Vt,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(ar=>ar.map(nr=>BigInt(nr)))),fr=(0,Nt.mapToCurveSimpleSWU)(Vt,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:Vt.create(BigInt("-11"))}),gr=(0,xt.createHasher)($t.secp256k1.ProjectivePoint,ar=>{const{x:nr,y:ur}=fr(Vt.create(ar[0]));return yr(nr,ur)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:Vt.ORDER,m:1,k:128,expand:"xmd",hash:e.sha256});$t.hashToCurve=gr.hashToCurve,$t.encodeToCurve=gr.encodeToCurve})(secp256k1$1);var hex={};Object.defineProperty(hex,"__esModule",{value:!0});hex.decodeHex=hex.remove0x=void 0;var utils_1$5=utils$7;function remove0x($t){return $t.startsWith("0x")||$t.startsWith("0X")?$t.slice(2):$t}hex.remove0x=remove0x;function decodeHex($t){return(0,utils_1$5.hexToBytes)(remove0x($t))}hex.decodeHex=decodeHex;var symmetric={},chacha={},_poly1305={},_assert={};Object.defineProperty(_assert,"__esModule",{value:!0});_assert.output=_assert.exists=_assert.hash=_assert.bytes=_assert.bool=_assert.number=void 0;function number$2($t){if(!Number.isSafeInteger($t)||$t<0)throw new Error(`Wrong positive integer: ${$t}`)}_assert.number=number$2;function bool$1($t){if(typeof $t!="boolean")throw new Error(`Expected boolean, not ${$t}`)}_assert.bool=bool$1;function bytes$3($t,...e){if(!($t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes($t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${$t.length}`)}_assert.bytes=bytes$3;function hash$1($t){if(typeof $t!="function"||typeof $t.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");number$2($t.outputLen),number$2($t.blockLen)}_assert.hash=hash$1;function exists$3($t,e=!0){if($t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&$t.finished)throw new Error("Hash#digest() has already been called")}_assert.exists=exists$3;function output$3($t,e){bytes$3($t);const _t=e.outputLen;if($t.length<_t)throw new Error(`digestInto() expects output buffer of length at least ${_t}`)}_assert.output=output$3;const assert$2={number:number$2,bool:bool$1,bytes:bytes$3,hash:hash$1,exists:exists$3,output:output$3};_assert.default=assert$2;Object.defineProperty(_poly1305,"__esModule",{value:!0});_poly1305.poly1305=_poly1305.wrapConstructorWithKey=void 0;const utils_js_1$3=utils$7,_assert_js_1$2=_assert,u8to16$2=($t,e)=>$t[e++]&255|($t[e++]&255)<<8;let Poly1305$2=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,utils_js_1$3.toBytes)(e),(0,utils_js_1$3.ensureBytes)(e,32);const _t=u8to16$2(e,0),At=u8to16$2(e,2),xt=u8to16$2(e,4),kt=u8to16$2(e,6),Bt=u8to16$2(e,8),Nt=u8to16$2(e,10),Ut=u8to16$2(e,12),Lt=u8to16$2(e,14);this.r[0]=_t&8191,this.r[1]=(_t>>>13|At<<3)&8191,this.r[2]=(At>>>10|xt<<6)&7939,this.r[3]=(xt>>>7|kt<<9)&8191,this.r[4]=(kt>>>4|Bt<<12)&255,this.r[5]=Bt>>>1&8190,this.r[6]=(Bt>>>14|Nt<<2)&8191,this.r[7]=(Nt>>>11|Ut<<5)&8065,this.r[8]=(Ut>>>8|Lt<<8)&8191,this.r[9]=Lt>>>5&127;for(let jt=0;jt<8;jt++)this.pad[jt]=u8to16$2(e,16+2*jt)}process(e,_t,At=!1){const xt=At?0:2048,{h:kt,r:Bt}=this,Nt=Bt[0],Ut=Bt[1],Lt=Bt[2],jt=Bt[3],Kt=Bt[4],qt=Bt[5],zt=Bt[6],Vt=Bt[7],Ht=Bt[8],Wt=Bt[9],Qt=u8to16$2(e,_t+0),Xt=u8to16$2(e,_t+2),Jt=u8to16$2(e,_t+4),tr=u8to16$2(e,_t+6),dr=u8to16$2(e,_t+8),vr=u8to16$2(e,_t+10),$r=u8to16$2(e,_t+12),Ir=u8to16$2(e,_t+14);let Rr=kt[0]+(Qt&8191),Nr=kt[1]+((Qt>>>13|Xt<<3)&8191),kr=kt[2]+((Xt>>>10|Jt<<6)&8191),lr=kt[3]+((Jt>>>7|tr<<9)&8191),ir=kt[4]+((tr>>>4|dr<<12)&8191),er=kt[5]+(dr>>>1&8191),rr=kt[6]+((dr>>>14|vr<<2)&8191),yr=kt[7]+((vr>>>11|$r<<5)&8191),fr=kt[8]+(($r>>>8|Ir<<8)&8191),gr=kt[9]+(Ir>>>5|xt),ar=0,nr=ar+Rr*Nt+Nr*(5*Wt)+kr*(5*Ht)+lr*(5*Vt)+ir*(5*zt);ar=nr>>>13,nr&=8191,nr+=er*(5*qt)+rr*(5*Kt)+yr*(5*jt)+fr*(5*Lt)+gr*(5*Ut),ar+=nr>>>13,nr&=8191;let ur=ar+Rr*Ut+Nr*Nt+kr*(5*Wt)+lr*(5*Ht)+ir*(5*Vt);ar=ur>>>13,ur&=8191,ur+=er*(5*zt)+rr*(5*qt)+yr*(5*Kt)+fr*(5*jt)+gr*(5*Lt),ar+=ur>>>13,ur&=8191;let pr=ar+Rr*Lt+Nr*Ut+kr*Nt+lr*(5*Wt)+ir*(5*Ht);ar=pr>>>13,pr&=8191,pr+=er*(5*Vt)+rr*(5*zt)+yr*(5*qt)+fr*(5*Kt)+gr*(5*jt),ar+=pr>>>13,pr&=8191;let br=ar+Rr*jt+Nr*Lt+kr*Ut+lr*Nt+ir*(5*Wt);ar=br>>>13,br&=8191,br+=er*(5*Ht)+rr*(5*Vt)+yr*(5*zt)+fr*(5*qt)+gr*(5*Kt),ar+=br>>>13,br&=8191;let Sr=ar+Rr*Kt+Nr*jt+kr*Lt+lr*Ut+ir*Nt;ar=Sr>>>13,Sr&=8191,Sr+=er*(5*Wt)+rr*(5*Ht)+yr*(5*Vt)+fr*(5*zt)+gr*(5*qt),ar+=Sr>>>13,Sr&=8191;let Pr=ar+Rr*qt+Nr*Kt+kr*jt+lr*Lt+ir*Ut;ar=Pr>>>13,Pr&=8191,Pr+=er*Nt+rr*(5*Wt)+yr*(5*Ht)+fr*(5*Vt)+gr*(5*zt),ar+=Pr>>>13,Pr&=8191;let Tr=ar+Rr*zt+Nr*qt+kr*Kt+lr*jt+ir*Lt;ar=Tr>>>13,Tr&=8191,Tr+=er*Ut+rr*Nt+yr*(5*Wt)+fr*(5*Ht)+gr*(5*Vt),ar+=Tr>>>13,Tr&=8191;let wr=ar+Rr*Vt+Nr*zt+kr*qt+lr*Kt+ir*jt;ar=wr>>>13,wr&=8191,wr+=er*Lt+rr*Ut+yr*Nt+fr*(5*Wt)+gr*(5*Ht),ar+=wr>>>13,wr&=8191;let Ar=ar+Rr*Ht+Nr*Vt+kr*zt+lr*qt+ir*Kt;ar=Ar>>>13,Ar&=8191,Ar+=er*jt+rr*Lt+yr*Ut+fr*Nt+gr*(5*Wt),ar+=Ar>>>13,Ar&=8191;let Mr=ar+Rr*Wt+Nr*Ht+kr*Vt+lr*zt+ir*qt;ar=Mr>>>13,Mr&=8191,Mr+=er*Kt+rr*jt+yr*Lt+fr*Ut+gr*Nt,ar+=Mr>>>13,Mr&=8191,ar=(ar<<2)+ar|0,ar=ar+nr|0,nr=ar&8191,ar=ar>>>13,ur+=ar,kt[0]=nr,kt[1]=ur,kt[2]=pr,kt[3]=br,kt[4]=Sr,kt[5]=Pr,kt[6]=Tr,kt[7]=wr,kt[8]=Ar,kt[9]=Mr}finalize(){const{h:e,pad:_t}=this,At=new Uint16Array(10);let xt=e[1]>>>13;e[1]&=8191;for(let Nt=2;Nt<10;Nt++)e[Nt]+=xt,xt=e[Nt]>>>13,e[Nt]&=8191;e[0]+=xt*5,xt=e[0]>>>13,e[0]&=8191,e[1]+=xt,xt=e[1]>>>13,e[1]&=8191,e[2]+=xt,At[0]=e[0]+5,xt=At[0]>>>13,At[0]&=8191;for(let Nt=1;Nt<10;Nt++)At[Nt]=e[Nt]+xt,xt=At[Nt]>>>13,At[Nt]&=8191;At[9]-=8192;let kt=(xt^1)-1;for(let Nt=0;Nt<10;Nt++)At[Nt]&=kt;kt=~kt;for(let Nt=0;Nt<10;Nt++)e[Nt]=e[Nt]&kt|At[Nt];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let Bt=e[0]+_t[0];e[0]=Bt&65535;for(let Nt=1;Nt<8;Nt++)Bt=(e[Nt]+_t[Nt]|0)+(Bt>>>16)|0,e[Nt]=Bt&65535}update(e){_assert_js_1$2.default.exists(this);const{buffer:_t,blockLen:At}=this;e=(0,utils_js_1$3.toBytes)(e);const xt=e.length;for(let kt=0;kt<xt;){const Bt=Math.min(At-this.pos,xt-kt);if(Bt===At){for(;At<=xt-kt;kt+=At)this.process(e,kt);continue}_t.set(e.subarray(kt,kt+Bt),this.pos),this.pos+=Bt,kt+=Bt,this.pos===At&&(this.process(_t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){_assert_js_1$2.default.exists(this),_assert_js_1$2.default.output(e,this),this.finished=!0;const{buffer:_t,h:At}=this;let{pos:xt}=this;if(xt){for(_t[xt++]=1;xt<16;xt++)_t[xt]=0;this.process(_t,0,!0)}this.finalize();let kt=0;for(let Bt=0;Bt<8;Bt++)e[kt++]=At[Bt]>>>0,e[kt++]=At[Bt]>>>8;return e}digest(){const{buffer:e,outputLen:_t}=this;this.digestInto(e);const At=e.slice(0,_t);return this.destroy(),At}};function wrapConstructorWithKey$2($t){const e=(At,xt)=>$t(xt).update((0,utils_js_1$3.toBytes)(At)).digest(),_t=$t(new Uint8Array(32));return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=At=>$t(At),e}_poly1305.wrapConstructorWithKey=wrapConstructorWithKey$2;_poly1305.poly1305=wrapConstructorWithKey$2($t=>new Poly1305$2($t));var _salsa={};Object.defineProperty(_salsa,"__esModule",{value:!0});_salsa.salsaBasic=void 0;const _assert_js_1$1=_assert,utils_js_1$2=utils$7,sigma16$2=(0,utils_js_1$2.utf8ToBytes)("expand 16-byte k"),sigma32$2=(0,utils_js_1$2.utf8ToBytes)("expand 32-byte k"),sigma16_32$1=(0,utils_js_1$2.u32)(sigma16$2),sigma32_32$1=(0,utils_js_1$2.u32)(sigma32$2),isAligned32$1=$t=>!($t.byteOffset%4),salsaBasic=$t=>{const{core:e,rounds:_t,counterRight:At,counterLen:xt,allow128bitKeys:kt,extendNonceFn:Bt,blockLen:Nt}=(0,utils_js_1$2.checkOpts)({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},$t);_assert_js_1$1.default.number(xt),_assert_js_1$1.default.number(_t),_assert_js_1$1.default.number(Nt),_assert_js_1$1.default.bool(At),_assert_js_1$1.default.bool(kt);const Ut=Nt/4;if(Nt%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(Lt,jt,Kt,qt,zt=0)=>{if(_assert_js_1$1.default.bytes(Lt),_assert_js_1$1.default.bytes(jt),_assert_js_1$1.default.bytes(Kt),qt||(qt=new Uint8Array(Kt.length)),_assert_js_1$1.default.bytes(qt),_assert_js_1$1.default.number(zt),zt<0||zt>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(qt.length<Kt.length)throw new Error(`Salsa/ChaCha: output (${qt.length}) is shorter than data (${Kt.length})`);const Vt=[];let Ht,Wt;if(Lt.length===32)isAligned32$1(Lt)?Ht=Lt:(Ht=Lt.slice(),Vt.push(Ht)),Wt=sigma32_32$1;else if(Lt.length===16&&kt)Ht=new Uint8Array(32),Ht.set(Lt),Ht.set(Lt,16),Wt=sigma16_32$1,Vt.push(Ht);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${Lt.length}`);if(isAligned32$1(jt)||(jt=jt.slice(),Vt.push(jt)),Bt){if(jt.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");Ht=Bt(Wt,Ht,jt.subarray(0,16),new Uint8Array(32)),Vt.push(Ht),jt=jt.subarray(16)}const Qt=16-xt;if(jt.length!==Qt)throw new Error(`Salsa/ChaCha: nonce must be ${Qt} or 16 bytes`);if(Qt!==12){const Rr=new Uint8Array(12);Rr.set(jt,At?0:12-jt.length),Vt.push(jt=Rr)}const Xt=new Uint8Array(Nt),Jt=(0,utils_js_1$2.u32)(Xt),tr=(0,utils_js_1$2.u32)(Ht),dr=(0,utils_js_1$2.u32)(jt),vr=isAligned32$1(Kt)&&(0,utils_js_1$2.u32)(Kt),$r=isAligned32$1(qt)&&(0,utils_js_1$2.u32)(qt);Vt.push(Jt);const Ir=Kt.length;for(let Rr=0,Nr=zt;Rr<Ir;Nr++){if(e(Wt,tr,dr,Jt,Nr,_t),Nr>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");const kr=Math.min(Nt,Ir-Rr);if(kr===Nt&&$r&&vr){const lr=Rr/4;if(Rr%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let ir=0;ir<Ut;ir++)$r[lr+ir]=vr[lr+ir]^Jt[ir];Rr+=Nt;continue}for(let lr=0;lr<kr;lr++)qt[Rr+lr]=Kt[Rr+lr]^Xt[lr];Rr+=kr}for(let Rr=0;Rr<Vt.length;Rr++)Vt[Rr].fill(0);return qt}};_salsa.salsaBasic=salsaBasic;(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.xchacha20poly1305=$t.chacha20poly1305=$t._poly1305_aead=$t.chacha12=$t.chacha8=$t.xchacha20=$t.chacha20=$t.chacha20orig=$t.hchacha=void 0;const e=utils$7,_t=_poly1305,At=_salsa,xt=(Kt,qt)=>Kt<<qt|Kt>>>32-qt;function kt(Kt,qt,zt,Vt,Ht,Wt=20){let Qt=Kt[0],Xt=Kt[1],Jt=Kt[2],tr=Kt[3],dr=qt[0],vr=qt[1],$r=qt[2],Ir=qt[3],Rr=qt[4],Nr=qt[5],kr=qt[6],lr=qt[7],ir=Ht,er=zt[0],rr=zt[1],yr=zt[2],fr=Qt,gr=Xt,ar=Jt,nr=tr,ur=dr,pr=vr,br=$r,Sr=Ir,Pr=Rr,Tr=Nr,wr=kr,Ar=lr,Mr=ir,Ur=er,Or=rr,Cr=yr;for(let Br=0;Br<Wt;Br+=2)fr=fr+ur|0,Mr=xt(Mr^fr,16),Pr=Pr+Mr|0,ur=xt(ur^Pr,12),fr=fr+ur|0,Mr=xt(Mr^fr,8),Pr=Pr+Mr|0,ur=xt(ur^Pr,7),gr=gr+pr|0,Ur=xt(Ur^gr,16),Tr=Tr+Ur|0,pr=xt(pr^Tr,12),gr=gr+pr|0,Ur=xt(Ur^gr,8),Tr=Tr+Ur|0,pr=xt(pr^Tr,7),ar=ar+br|0,Or=xt(Or^ar,16),wr=wr+Or|0,br=xt(br^wr,12),ar=ar+br|0,Or=xt(Or^ar,8),wr=wr+Or|0,br=xt(br^wr,7),nr=nr+Sr|0,Cr=xt(Cr^nr,16),Ar=Ar+Cr|0,Sr=xt(Sr^Ar,12),nr=nr+Sr|0,Cr=xt(Cr^nr,8),Ar=Ar+Cr|0,Sr=xt(Sr^Ar,7),fr=fr+pr|0,Cr=xt(Cr^fr,16),wr=wr+Cr|0,pr=xt(pr^wr,12),fr=fr+pr|0,Cr=xt(Cr^fr,8),wr=wr+Cr|0,pr=xt(pr^wr,7),gr=gr+br|0,Mr=xt(Mr^gr,16),Ar=Ar+Mr|0,br=xt(br^Ar,12),gr=gr+br|0,Mr=xt(Mr^gr,8),Ar=Ar+Mr|0,br=xt(br^Ar,7),ar=ar+Sr|0,Ur=xt(Ur^ar,16),Pr=Pr+Ur|0,Sr=xt(Sr^Pr,12),ar=ar+Sr|0,Ur=xt(Ur^ar,8),Pr=Pr+Ur|0,Sr=xt(Sr^Pr,7),nr=nr+ur|0,Or=xt(Or^nr,16),Tr=Tr+Or|0,ur=xt(ur^Tr,12),nr=nr+ur|0,Or=xt(Or^nr,8),Tr=Tr+Or|0,ur=xt(ur^Tr,7);let Er=0;Vt[Er++]=Qt+fr|0,Vt[Er++]=Xt+gr|0,Vt[Er++]=Jt+ar|0,Vt[Er++]=tr+nr|0,Vt[Er++]=dr+ur|0,Vt[Er++]=vr+pr|0,Vt[Er++]=$r+br|0,Vt[Er++]=Ir+Sr|0,Vt[Er++]=Rr+Pr|0,Vt[Er++]=Nr+Tr|0,Vt[Er++]=kr+wr|0,Vt[Er++]=lr+Ar|0,Vt[Er++]=ir+Mr|0,Vt[Er++]=er+Ur|0,Vt[Er++]=rr+Or|0,Vt[Er++]=yr+Cr|0}function Bt(Kt,qt,zt,Vt){const Ht=(0,e.u32)(qt),Wt=(0,e.u32)(zt),Qt=(0,e.u32)(Vt);let Xt=Kt[0],Jt=Kt[1],tr=Kt[2],dr=Kt[3],vr=Ht[0],$r=Ht[1],Ir=Ht[2],Rr=Ht[3],Nr=Ht[4],kr=Ht[5],lr=Ht[6],ir=Ht[7],er=Wt[0],rr=Wt[1],yr=Wt[2],fr=Wt[3];for(let gr=0;gr<20;gr+=2)Xt=Xt+vr|0,er=xt(er^Xt,16),Nr=Nr+er|0,vr=xt(vr^Nr,12),Xt=Xt+vr|0,er=xt(er^Xt,8),Nr=Nr+er|0,vr=xt(vr^Nr,7),Jt=Jt+$r|0,rr=xt(rr^Jt,16),kr=kr+rr|0,$r=xt($r^kr,12),Jt=Jt+$r|0,rr=xt(rr^Jt,8),kr=kr+rr|0,$r=xt($r^kr,7),tr=tr+Ir|0,yr=xt(yr^tr,16),lr=lr+yr|0,Ir=xt(Ir^lr,12),tr=tr+Ir|0,yr=xt(yr^tr,8),lr=lr+yr|0,Ir=xt(Ir^lr,7),dr=dr+Rr|0,fr=xt(fr^dr,16),ir=ir+fr|0,Rr=xt(Rr^ir,12),dr=dr+Rr|0,fr=xt(fr^dr,8),ir=ir+fr|0,Rr=xt(Rr^ir,7),Xt=Xt+$r|0,fr=xt(fr^Xt,16),lr=lr+fr|0,$r=xt($r^lr,12),Xt=Xt+$r|0,fr=xt(fr^Xt,8),lr=lr+fr|0,$r=xt($r^lr,7),Jt=Jt+Ir|0,er=xt(er^Jt,16),ir=ir+er|0,Ir=xt(Ir^ir,12),Jt=Jt+Ir|0,er=xt(er^Jt,8),ir=ir+er|0,Ir=xt(Ir^ir,7),tr=tr+Rr|0,rr=xt(rr^tr,16),Nr=Nr+rr|0,Rr=xt(Rr^Nr,12),tr=tr+Rr|0,rr=xt(rr^tr,8),Nr=Nr+rr|0,Rr=xt(Rr^Nr,7),dr=dr+vr|0,yr=xt(yr^dr,16),kr=kr+yr|0,vr=xt(vr^kr,12),dr=dr+vr|0,yr=xt(yr^dr,8),kr=kr+yr|0,vr=xt(vr^kr,7);return Qt[0]=Xt,Qt[1]=Jt,Qt[2]=tr,Qt[3]=dr,Qt[4]=er,Qt[5]=rr,Qt[6]=yr,Qt[7]=fr,Vt}$t.hchacha=Bt,$t.chacha20orig=(0,At.salsaBasic)({core:kt,counterRight:!1,counterLen:8}),$t.chacha20=(0,At.salsaBasic)({core:kt,counterRight:!1,counterLen:4,allow128bitKeys:!1}),$t.xchacha20=(0,At.salsaBasic)({core:kt,counterRight:!1,counterLen:8,extendNonceFn:Bt,allow128bitKeys:!1}),$t.chacha8=(0,At.salsaBasic)({core:kt,counterRight:!1,counterLen:4,rounds:8}),$t.chacha12=(0,At.salsaBasic)({core:kt,counterRight:!1,counterLen:4,rounds:12});const Nt=new Uint8Array(16),Ut=(Kt,qt)=>{Kt.update(qt);const zt=qt.length%16;zt&&Kt.update(Nt.subarray(zt))},Lt=(Kt,qt,zt,Vt,Ht)=>{const Wt=Kt(qt,zt,new Uint8Array(32)),Qt=_t.poly1305.create(Wt);Ht&&Ut(Qt,Ht),Ut(Qt,Vt);const Xt=new Uint8Array(16),Jt=(0,e.createView)(Xt);(0,e.setBigUint64)(Jt,0,BigInt(Ht?Ht.length:0),!0),(0,e.setBigUint64)(Jt,8,BigInt(Vt.length),!0),Qt.update(Xt);const tr=Qt.digest();return Wt.fill(0),tr},jt=Kt=>(qt,zt,Vt)=>((0,e.ensureBytes)(qt,32),(0,e.ensureBytes)(zt),{tagLength:16,encrypt:(Wt,Qt)=>{const Xt=Wt.length,Jt=Xt+16;Qt?(0,e.ensureBytes)(Qt,Jt):Qt=new Uint8Array(Jt),Kt(qt,zt,Wt,Qt,1);const tr=Lt(Kt,qt,zt,Qt.subarray(0,-16),Vt);return Qt.set(tr,Xt),Qt},decrypt:(Wt,Qt)=>{const Xt=Wt.length,Jt=Xt-16;if(Xt<16)throw new Error("encrypted data must be at least 16 bytes");Qt?(0,e.ensureBytes)(Qt,Jt):Qt=new Uint8Array(Jt);const tr=Wt.subarray(0,-16),dr=Wt.subarray(-16),vr=Lt(Kt,qt,zt,tr,Vt);if(!(0,e.equalBytes)(dr,vr))throw new Error("invalid tag");return Kt(qt,zt,tr,Qt,1),Qt}});$t._poly1305_aead=jt,$t.chacha20poly1305=(0,$t._poly1305_aead)($t.chacha20),$t.xchacha20poly1305=(0,$t._poly1305_aead)($t.xchacha20)})(chacha);var hkdf$1={},hmac$1={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.hmac=$t.HMAC=void 0;const e=_assert$1,_t=utils$4;class At extends _t.Hash{constructor(Bt,Nt){super(),this.finished=!1,this.destroyed=!1,(0,e.hash)(Bt);const Ut=(0,_t.toBytes)(Nt);if(this.iHash=Bt.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const Lt=this.blockLen,jt=new Uint8Array(Lt);jt.set(Ut.length>Lt?Bt.create().update(Ut).digest():Ut);for(let Kt=0;Kt<jt.length;Kt++)jt[Kt]^=54;this.iHash.update(jt),this.oHash=Bt.create();for(let Kt=0;Kt<jt.length;Kt++)jt[Kt]^=106;this.oHash.update(jt),jt.fill(0)}update(Bt){return(0,e.exists)(this),this.iHash.update(Bt),this}digestInto(Bt){(0,e.exists)(this),(0,e.bytes)(Bt,this.outputLen),this.finished=!0,this.iHash.digestInto(Bt),this.oHash.update(Bt),this.oHash.digestInto(Bt),this.destroy()}digest(){const Bt=new Uint8Array(this.oHash.outputLen);return this.digestInto(Bt),Bt}_cloneInto(Bt){Bt||(Bt=Object.create(Object.getPrototypeOf(this),{}));const{oHash:Nt,iHash:Ut,finished:Lt,destroyed:jt,blockLen:Kt,outputLen:qt}=this;return Bt=Bt,Bt.finished=Lt,Bt.destroyed=jt,Bt.blockLen=Kt,Bt.outputLen=qt,Bt.oHash=Nt._cloneInto(Bt.oHash),Bt.iHash=Ut._cloneInto(Bt.iHash),Bt}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}$t.HMAC=At;const xt=(kt,Bt,Nt)=>new At(kt,Bt).update(Nt).digest();$t.hmac=xt,$t.hmac.create=(kt,Bt)=>new At(kt,Bt)})(hmac$1);Object.defineProperty(hkdf$1,"__esModule",{value:!0});hkdf$1.hkdf=hkdf$1.expand=hkdf$1.extract=void 0;const _assert_js_1=_assert$1,utils_js_1$1=utils$4,hmac_js_1=hmac$1;function extract($t,e,_t){return(0,_assert_js_1.hash)($t),_t===void 0&&(_t=new Uint8Array($t.outputLen)),(0,hmac_js_1.hmac)($t,(0,utils_js_1$1.toBytes)(_t),(0,utils_js_1$1.toBytes)(e))}hkdf$1.extract=extract;const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand($t,e,_t,At=32){if((0,_assert_js_1.hash)($t),(0,_assert_js_1.number)(At),At>255*$t.outputLen)throw new Error("Length should be <= 255*HashLen");const xt=Math.ceil(At/$t.outputLen);_t===void 0&&(_t=EMPTY_BUFFER);const kt=new Uint8Array(xt*$t.outputLen),Bt=hmac_js_1.hmac.create($t,e),Nt=Bt._cloneInto(),Ut=new Uint8Array(Bt.outputLen);for(let Lt=0;Lt<xt;Lt++)HKDF_COUNTER[0]=Lt+1,Nt.update(Lt===0?EMPTY_BUFFER:Ut).update(_t).update(HKDF_COUNTER).digestInto(Ut),kt.set(Ut,$t.outputLen*Lt),Bt._cloneInto(Nt);return Bt.destroy(),Nt.destroy(),Ut.fill(0),HKDF_COUNTER.fill(0),kt.slice(0,At)}hkdf$1.expand=expand;const hkdf=($t,e,_t,At,xt)=>expand($t,extract($t,e,_t),At,xt);hkdf$1.hkdf=hkdf;var sha256$1={};Object.defineProperty(sha256$1,"__esModule",{value:!0});sha256$1.sha224=sha256$1.sha256=void 0;const _md_js_1=_md,utils_js_1=utils$4,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends _md_js_1.HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:_t,C:At,D:xt,E:kt,F:Bt,G:Nt,H:Ut}=this;return[e,_t,At,xt,kt,Bt,Nt,Ut]}set(e,_t,At,xt,kt,Bt,Nt,Ut){this.A=e|0,this.B=_t|0,this.C=At|0,this.D=xt|0,this.E=kt|0,this.F=Bt|0,this.G=Nt|0,this.H=Ut|0}process(e,_t){for(let Kt=0;Kt<16;Kt++,_t+=4)SHA256_W$1[Kt]=e.getUint32(_t,!1);for(let Kt=16;Kt<64;Kt++){const qt=SHA256_W$1[Kt-15],zt=SHA256_W$1[Kt-2],Vt=(0,utils_js_1.rotr)(qt,7)^(0,utils_js_1.rotr)(qt,18)^qt>>>3,Ht=(0,utils_js_1.rotr)(zt,17)^(0,utils_js_1.rotr)(zt,19)^zt>>>10;SHA256_W$1[Kt]=Ht+SHA256_W$1[Kt-7]+Vt+SHA256_W$1[Kt-16]|0}let{A:At,B:xt,C:kt,D:Bt,E:Nt,F:Ut,G:Lt,H:jt}=this;for(let Kt=0;Kt<64;Kt++){const qt=(0,utils_js_1.rotr)(Nt,6)^(0,utils_js_1.rotr)(Nt,11)^(0,utils_js_1.rotr)(Nt,25),zt=jt+qt+(0,_md_js_1.Chi)(Nt,Ut,Lt)+SHA256_K$1[Kt]+SHA256_W$1[Kt]|0,Ht=((0,utils_js_1.rotr)(At,2)^(0,utils_js_1.rotr)(At,13)^(0,utils_js_1.rotr)(At,22))+(0,_md_js_1.Maj)(At,xt,kt)|0;jt=Lt,Lt=Ut,Ut=Nt,Nt=Bt+zt|0,Bt=kt,kt=xt,xt=At,At=zt+Ht|0}At=At+this.A|0,xt=xt+this.B|0,kt=kt+this.C|0,Bt=Bt+this.D|0,Nt=Nt+this.E|0,Ut=Ut+this.F|0,Lt=Lt+this.G|0,jt=jt+this.H|0,this.set(At,xt,kt,Bt,Nt,Ut,Lt,jt)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}sha256$1.sha256=(0,utils_js_1.wrapConstructor)(()=>new SHA256$1);sha256$1.sha224=(0,utils_js_1.wrapConstructor)(()=>new SHA224);var compat={};Object.defineProperty(compat,"__esModule",{value:!0});compat.aes256gcm=void 0;var utils_1$4=utils$7,crypto_1=requireCryptoBrowserify(),consts_1$2=consts;function aes256gcm($t,e,_t){var At=function(kt){var Bt=(0,crypto_1.createCipheriv)("aes-256-gcm",$t,e);_t&&Bt.setAAD(_t);var Nt=Bt.update(kt),Ut=Bt.final();return(0,utils_1$4.concatBytes)(Nt,Ut,Bt.getAuthTag())},xt=function(kt){var Bt=kt.subarray(0,kt.length-consts_1$2.AEAD_TAG_LENGTH),Nt=kt.subarray(-consts_1$2.AEAD_TAG_LENGTH),Ut=(0,crypto_1.createDecipheriv)("aes-256-gcm",$t,e);_t&&Ut.setAAD(_t),Ut.setAuthTag(Nt);var Lt=Ut.update(Bt),jt=Ut.final();return(0,utils_1$4.concatBytes)(Lt,jt)};return{tagLength:consts_1$2.AEAD_TAG_LENGTH,encrypt:At,decrypt:xt}}compat.aes256gcm=aes256gcm;Object.defineProperty(symmetric,"__esModule",{value:!0});symmetric.deriveKey=symmetric.aesDecrypt=symmetric.aesEncrypt=void 0;var chacha_1=chacha,utils_1$3=utils$7,utils_2$3=utils$5,hkdf_1=hkdf$1,sha256_1=sha256$1,config_1$3=config,consts_1$1=consts,compat_1=compat;function aesEncrypt($t,e){return _exec$1(!0,$t,e)}symmetric.aesEncrypt=aesEncrypt;function aesDecrypt($t,e){return _exec$1(!1,$t,e)}symmetric.aesDecrypt=aesDecrypt;function deriveKey($t){return(0,hkdf_1.hkdf)(sha256_1.sha256,$t,void 0,void 0,32)}symmetric.deriveKey=deriveKey;function _exec$1($t,e,_t){var At=(0,config_1$3.symmetricAlgorithm)(),xt=$t?_encrypt:_decrypt;if(At==="aes-256-gcm")return xt(compat_1.aes256gcm,e,_t,(0,config_1$3.symmetricNonceLength)());if(At==="xchacha20")return xt(chacha_1.xchacha20poly1305,e,_t,consts_1$1.XCHACHA20_NONCE_LENGTH);throw new Error("Not implemented")}function _encrypt($t,e,_t,At){var xt=(0,utils_2$3.randomBytes)(At),kt=$t(e,xt),Bt=kt.encrypt(_t),Nt=Bt.subarray(0,Bt.length-consts_1$1.AEAD_TAG_LENGTH),Ut=Bt.subarray(-consts_1$1.AEAD_TAG_LENGTH);return(0,utils_1$3.concatBytes)(xt,Ut,Nt)}function _decrypt($t,e,_t,At){var xt=At+consts_1$1.AEAD_TAG_LENGTH,kt=_t.subarray(0,At),Bt=_t.subarray(At,xt),Nt=_t.subarray(xt),Ut=$t(e,Uint8Array.from(kt)),Lt=(0,utils_1$3.concatBytes)(Nt,Bt);return Ut.decrypt(Lt)}Object.defineProperty(elliptic,"__esModule",{value:!0});elliptic.hexToPublicKey=elliptic.convertPublicKeyFormat=elliptic.getSharedPoint=elliptic.getSharedKey=elliptic.getPublicKey=elliptic.isValidPrivateKey=elliptic.getValidSecret=void 0;var utils_1$2=utils$7,utils_2$2=utils$5,ed25519_1=ed25519$1,secp256k1_1=secp256k1$1,config_1$2=config,consts_1=consts,hex_1=hex,symmetric_1=symmetric;function getValidSecret(){var $t;do $t=(0,utils_2$2.randomBytes)(consts_1.SECRET_KEY_LENGTH);while(!isValidPrivateKey($t));return $t}elliptic.getValidSecret=getValidSecret;function isValidPrivateKey($t){return _exec(function(e){return e.utils.isValidPrivateKey($t)},function(){return!0},function(){return!0})}elliptic.isValidPrivateKey=isValidPrivateKey;function getPublicKey($t){return _exec(function(e){return e.getPublicKey($t)},function(e){return e.getPublicKey($t)},function(e){return e.getPublicKey($t)})}elliptic.getPublicKey=getPublicKey;function getSharedKey($t,e){return(0,symmetric_1.deriveKey)((0,utils_1$2.concatBytes)($t,e))}elliptic.getSharedKey=getSharedKey;function getSharedPoint($t,e,_t){return _exec(function(At){return At.getSharedSecret($t,e,_t)},function(At){return At.getSharedSecret($t,e)},function(At){var xt=At.utils.getExtendedPublicKey($t).scalar,kt=At.ExtendedPoint.fromHex(e).multiply(xt);return kt.toRawBytes()})}elliptic.getSharedPoint=getSharedPoint;function convertPublicKeyFormat($t,e){return _exec(function(_t){return _t.getSharedSecret(BigInt(1),$t,e)},function(){return $t},function(){return $t})}elliptic.convertPublicKeyFormat=convertPublicKeyFormat;function hexToPublicKey($t){var e=(0,hex_1.decodeHex)($t);return _exec(function(){if(e.length===consts_1.ETH_PUBLIC_KEY_SIZE){var _t=new Uint8Array(1+e.length);return _t.set([4]),_t.set(e,1),_t}return e},function(){return e},function(){return e})}elliptic.hexToPublicKey=hexToPublicKey;function _exec($t,e,_t){if((0,config_1$2.ellipticCurve)()==="secp256k1")return $t(secp256k1_1.secp256k1);if((0,config_1$2.ellipticCurve)()==="x25519")return e(ed25519_1.x25519);if((0,config_1$2.ellipticCurve)()==="ed25519")return _t(ed25519_1.ed25519);throw new Error("Not implemented")}(function($t){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(At,xt,kt,Bt){Bt===void 0&&(Bt=kt);var Nt=Object.getOwnPropertyDescriptor(xt,kt);(!Nt||("get"in Nt?!xt.__esModule:Nt.writable||Nt.configurable))&&(Nt={enumerable:!0,get:function(){return xt[kt]}}),Object.defineProperty(At,Bt,Nt)}:function(At,xt,kt,Bt){Bt===void 0&&(Bt=kt),At[Bt]=xt[kt]}),_t=commonjsGlobal&&commonjsGlobal.__exportStar||function(At,xt){for(var kt in At)kt!=="default"&&!Object.prototype.hasOwnProperty.call(xt,kt)&&e(xt,At,kt)};Object.defineProperty($t,"__esModule",{value:!0}),_t(elliptic,$t),_t(hex,$t),_t(symmetric,$t)})(utils$6);var PublicKey$1={};Object.defineProperty(PublicKey$1,"__esModule",{value:!0});PublicKey$1.PublicKey=void 0;var utils_1$1=utils$7,config_1$1=config,utils_2$1=utils$6,PublicKey=function(){function $t(e){this.data=(0,utils_2$1.convertPublicKeyFormat)(e,!0)}return $t.fromHex=function(e){return new $t((0,utils_2$1.hexToPublicKey)(e))},Object.defineProperty($t.prototype,"uncompressed",{get:function(){return buffer$2.Buffer.from((0,utils_2$1.convertPublicKeyFormat)(this.data,!1))},enumerable:!1,configurable:!0}),Object.defineProperty($t.prototype,"compressed",{get:function(){return buffer$2.Buffer.from(this.data)},enumerable:!1,configurable:!0}),$t.prototype.toHex=function(e){return e===void 0&&(e=!0),e?(0,utils_1$1.bytesToHex)(this.data):(0,utils_1$1.bytesToHex)(this.uncompressed)},$t.prototype.decapsulate=function(e){var _t,At;return(0,config_1$1.isHkdfKeyCompressed)()?(_t=this.data,At=e.multiply(this,!0)):(_t=this.uncompressed,At=e.multiply(this,!1)),(0,utils_2$1.getSharedKey)(_t,At)},$t.prototype.equals=function(e){return(0,utils_1$1.equalBytes)(this.data,e.data)},$t}();PublicKey$1.PublicKey=PublicKey;Object.defineProperty(PrivateKey$1,"__esModule",{value:!0});PrivateKey$1.PrivateKey=void 0;var utils_1=utils$7,config_1=config,utils_2=utils$6,PublicKey_1=PublicKey$1,PrivateKey=function(){function $t(e){var _t=e===void 0?(0,utils_2.getValidSecret)():e;if(!(0,utils_2.isValidPrivateKey)(_t))throw new Error("Invalid private key");this.data=_t,this.publicKey=new PublicKey_1.PublicKey((0,utils_2.getPublicKey)(_t))}return $t.fromHex=function(e){return new $t((0,utils_2.decodeHex)(e))},Object.defineProperty($t.prototype,"secret",{get:function(){return buffer$2.Buffer.from(this.data)},enumerable:!1,configurable:!0}),$t.prototype.toHex=function(){return(0,utils_1.bytesToHex)(this.data)},$t.prototype.encapsulate=function(e){var _t,At;return(0,config_1.isHkdfKeyCompressed)()?(_t=this.publicKey.compressed,At=this.multiply(e,!0)):(_t=this.publicKey.uncompressed,At=this.multiply(e,!1)),(0,utils_2.getSharedKey)(_t,At)},$t.prototype.multiply=function(e,_t){return _t===void 0&&(_t=!1),(0,utils_2.getSharedPoint)(this.data,e.compressed,_t)},$t.prototype.equals=function(e){return(0,utils_1.equalBytes)(this.data,e.data)},$t}();PrivateKey$1.PrivateKey=PrivateKey;(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.PublicKey=$t.PrivateKey=void 0;var e=PrivateKey$1;Object.defineProperty($t,"PrivateKey",{enumerable:!0,get:function(){return e.PrivateKey}});var _t=PublicKey$1;Object.defineProperty($t,"PublicKey",{enumerable:!0,get:function(){return _t.PublicKey}})})(keys);(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.utils=$t.PublicKey=$t.PrivateKey=$t.ECIES_CONFIG=$t.decrypt=$t.encrypt=void 0;var e=utils$7,_t=config,At=keys,xt=utils$6;function kt(Lt,jt){var Kt=new At.PrivateKey,qt=Lt instanceof Uint8Array?new At.PublicKey(Lt):At.PublicKey.fromHex(Lt),zt=Kt.encapsulate(qt),Vt=(0,xt.aesEncrypt)(zt,jt),Ht;return(0,_t.isEphemeralKeyCompressed)()?Ht=Kt.publicKey.compressed:Ht=Kt.publicKey.uncompressed,buffer$2.Buffer.from((0,e.concatBytes)(Ht,Vt))}$t.encrypt=kt;function Bt(Lt,jt){var Kt=Lt instanceof Uint8Array?new At.PrivateKey(Lt):At.PrivateKey.fromHex(Lt),qt=(0,_t.ephemeralKeySize)(),zt=new At.PublicKey(jt.subarray(0,qt)),Vt=jt.subarray(qt),Ht=zt.decapsulate(Kt);return buffer$2.Buffer.from((0,xt.aesDecrypt)(Ht,Vt))}$t.decrypt=Bt;var Nt=config;Object.defineProperty($t,"ECIES_CONFIG",{enumerable:!0,get:function(){return Nt.ECIES_CONFIG}});var Ut=keys;Object.defineProperty($t,"PrivateKey",{enumerable:!0,get:function(){return Ut.PrivateKey}}),Object.defineProperty($t,"PublicKey",{enumerable:!0,get:function(){return Ut.PublicKey}}),$t.utils={aesDecrypt:xt.aesDecrypt,aesEncrypt:xt.aesEncrypt,decodeHex:xt.decodeHex,getValidSecret:xt.getValidSecret,remove0x:xt.remove0x}})(dist);var browser$2={exports:{}},stream$1={exports:{}},primordials$1={ArrayIsArray($t){return Array.isArray($t)},ArrayPrototypeIncludes($t,e){return $t.includes(e)},ArrayPrototypeIndexOf($t,e){return $t.indexOf(e)},ArrayPrototypeJoin($t,e){return $t.join(e)},ArrayPrototypeMap($t,e){return $t.map(e)},ArrayPrototypePop($t,e){return $t.pop(e)},ArrayPrototypePush($t,e){return $t.push(e)},ArrayPrototypeSlice($t,e,_t){return $t.slice(e,_t)},Error,FunctionPrototypeCall($t,e,..._t){return $t.call(e,..._t)},FunctionPrototypeSymbolHasInstance($t,e){return Function.prototype[Symbol.hasInstance].call($t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties($t,e){return Object.defineProperties($t,e)},ObjectDefineProperty($t,e,_t){return Object.defineProperty($t,e,_t)},ObjectGetOwnPropertyDescriptor($t,e){return Object.getOwnPropertyDescriptor($t,e)},ObjectKeys($t){return Object.keys($t)},ObjectSetPrototypeOf($t,e){return Object.setPrototypeOf($t,e)},Promise,PromisePrototypeCatch($t,e){return $t.catch(e)},PromisePrototypeThen($t,e,_t){return $t.then(e,_t)},PromiseReject($t){return Promise.reject($t)},PromiseResolve($t){return Promise.resolve($t)},ReflectApply:Reflect.apply,RegExpPrototypeTest($t,e){return $t.test(e)},SafeSet:Set,String,StringPrototypeSlice($t,e,_t){return $t.slice(e,_t)},StringPrototypeToLowerCase($t){return $t.toLowerCase()},StringPrototypeToUpperCase($t){return $t.toUpperCase()},StringPrototypeTrim($t){return $t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet($t,e,_t){return $t.set(e,_t)},Boolean,Uint8Array},util$2={exports:{}},browser$1={exports:{}},hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser$1.exports;hasRequiredBrowser=1;const{AbortController:$t,AbortSignal:e}=typeof self<"u"?self:typeof window<"u"?window:void 0;return browser$1.exports=$t,browser$1.exports.AbortSignal=e,browser$1.exports.default=$t,browser$1.exports}(function($t){const e=buffer$2,{kResistStopPropagation:_t,SymbolDispose:At}=primordials$1,xt=globalThis.AbortSignal||requireBrowser().AbortSignal,kt=globalThis.AbortController||requireBrowser().AbortController,Bt=Object.getPrototypeOf(async function(){}).constructor,Nt=globalThis.Blob||e.Blob,Ut=typeof Nt<"u"?function(zt){return zt instanceof Nt}:function(zt){return!1},Lt=(qt,zt)=>{if(qt!==void 0&&(qt===null||typeof qt!="object"||!("aborted"in qt)))throw new ERR_INVALID_ARG_TYPE(zt,"AbortSignal",qt)},jt=(qt,zt)=>{if(typeof qt!="function")throw new ERR_INVALID_ARG_TYPE(zt,"Function",qt)};class Kt extends Error{constructor(zt){if(!Array.isArray(zt))throw new TypeError(`Expected input to be an Array, got ${typeof zt}`);let Vt="";for(let Ht=0;Ht<zt.length;Ht++)Vt+=`    ${zt[Ht].stack}
`;super(Vt),this.name="AggregateError",this.errors=zt}}$t.exports={AggregateError:Kt,kEmptyObject:Object.freeze({}),once(qt){let zt=!1;return function(...Vt){zt||(zt=!0,qt.apply(this,Vt))}},createDeferredPromise:function(){let qt,zt;return{promise:new Promise((Ht,Wt)=>{qt=Ht,zt=Wt}),resolve:qt,reject:zt}},promisify(qt){return new Promise((zt,Vt)=>{qt((Ht,...Wt)=>Ht?Vt(Ht):zt(...Wt))})},debuglog(){return function(){}},format(qt,...zt){return qt.replace(/%([sdifj])/g,function(...[Vt,Ht]){const Wt=zt.shift();return Ht==="f"?Wt.toFixed(6):Ht==="j"?JSON.stringify(Wt):Ht==="s"&&typeof Wt=="object"?`${Wt.constructor!==Object?Wt.constructor.name:""} {}`.trim():Wt.toString()})},inspect(qt){switch(typeof qt){case"string":if(qt.includes("'"))if(qt.includes('"')){if(!qt.includes("`")&&!qt.includes("${"))return`\`${qt}\``}else return`"${qt}"`;return`'${qt}'`;case"number":return isNaN(qt)?"NaN":Object.is(qt,-0)?String(qt):qt;case"bigint":return`${String(qt)}n`;case"boolean":case"undefined":return String(qt);case"object":return"{}"}},types:{isAsyncFunction(qt){return qt instanceof Bt},isArrayBufferView(qt){return ArrayBuffer.isView(qt)}},isBlob:Ut,deprecate(qt,zt){return qt},addAbortListener:eventsExports.addAbortListener||function(zt,Vt){if(zt===void 0)throw new ERR_INVALID_ARG_TYPE("signal","AbortSignal",zt);Lt(zt,"signal"),jt(Vt,"listener");let Ht;return zt.aborted?queueMicrotask(()=>Vt()):(zt.addEventListener("abort",Vt,{__proto__:null,once:!0,[_t]:!0}),Ht=()=>{zt.removeEventListener("abort",Vt)}),{__proto__:null,[At](){var Wt;(Wt=Ht)===null||Wt===void 0||Wt()}}},AbortSignalAny:xt.any||function(zt){if(zt.length===1)return zt[0];const Vt=new kt,Ht=()=>Vt.abort();return zt.forEach(Wt=>{Lt(Wt,"signals"),Wt.addEventListener("abort",Ht,{once:!0})}),Vt.signal.addEventListener("abort",()=>{zt.forEach(Wt=>Wt.removeEventListener("abort",Ht))},{once:!0}),Vt.signal}},$t.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util$2);var utilExports$1=util$2.exports,operators$1={};const{format:format$5,inspect:inspect$3,AggregateError:CustomAggregateError$1}=utilExports$1,AggregateError$2=globalThis.AggregateError||CustomAggregateError$1,kIsNodeError$1=Symbol("kIsNodeError"),kTypes$1=["string","function","number","object","Function","Object","boolean","bigint","symbol"],classRegExp$1=/^([A-Z][a-z0-9]*)+$/,nodeInternalPrefix$1="__node_internal_",codes$3={};function assert$1($t,e){if(!$t)throw new codes$3.ERR_INTERNAL_ASSERTION(e)}function addNumericalSeparator$1($t){let e="",_t=$t.length;const At=$t[0]==="-"?1:0;for(;_t>=At+4;_t-=3)e=`_${$t.slice(_t-3,_t)}${e}`;return`${$t.slice(0,_t)}${e}`}function getMessage$1($t,e,_t){if(typeof e=="function")return assert$1(e.length<=_t.length,`Code: ${$t}; The provided arguments length (${_t.length}) does not match the required ones (${e.length}).`),e(..._t);const At=(e.match(/%[dfijoOs]/g)||[]).length;return assert$1(At===_t.length,`Code: ${$t}; The provided arguments length (${_t.length}) does not match the required ones (${At}).`),_t.length===0?e:format$5(e,..._t)}function E$2($t,e,_t){_t||(_t=Error);class At extends _t{constructor(...kt){super(getMessage$1($t,e,kt))}toString(){return`${this.name} [${$t}]: ${this.message}`}}Object.defineProperties(At.prototype,{name:{value:_t.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${$t}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),At.prototype.code=$t,At.prototype[kIsNodeError$1]=!0,codes$3[$t]=At}function hideStackFrames$3($t){const e=nodeInternalPrefix$1+$t.name;return Object.defineProperty($t,"name",{value:e}),$t}function aggregateTwoErrors$5($t,e){if($t&&e&&$t!==e){if(Array.isArray(e.errors))return e.errors.push($t),e;const _t=new AggregateError$2([e,$t],e.message);return _t.code=e.code,_t}return $t||e}let AbortError$e=class extends Error{constructor(e="The operation was aborted",_t=void 0){if(_t!==void 0&&typeof _t!="object")throw new codes$3.ERR_INVALID_ARG_TYPE("options","Object",_t);super(e,_t),this.code="ABORT_ERR",this.name="AbortError"}};E$2("ERR_ASSERTION","%s",Error);E$2("ERR_INVALID_ARG_TYPE",($t,e,_t)=>{assert$1(typeof $t=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let At="The ";$t.endsWith(" argument")?At+=`${$t} `:At+=`"${$t}" ${$t.includes(".")?"property":"argument"} `,At+="must be ";const xt=[],kt=[],Bt=[];for(const Ut of e)assert$1(typeof Ut=="string","All expected entries have to be of type string"),kTypes$1.includes(Ut)?xt.push(Ut.toLowerCase()):classRegExp$1.test(Ut)?kt.push(Ut):(assert$1(Ut!=="object",'The value "object" should be written as "Object"'),Bt.push(Ut));if(kt.length>0){const Ut=xt.indexOf("object");Ut!==-1&&(xt.splice(xt,Ut,1),kt.push("Object"))}if(xt.length>0){switch(xt.length){case 1:At+=`of type ${xt[0]}`;break;case 2:At+=`one of type ${xt[0]} or ${xt[1]}`;break;default:{const Ut=xt.pop();At+=`one of type ${xt.join(", ")}, or ${Ut}`}}(kt.length>0||Bt.length>0)&&(At+=" or ")}if(kt.length>0){switch(kt.length){case 1:At+=`an instance of ${kt[0]}`;break;case 2:At+=`an instance of ${kt[0]} or ${kt[1]}`;break;default:{const Ut=kt.pop();At+=`an instance of ${kt.join(", ")}, or ${Ut}`}}Bt.length>0&&(At+=" or ")}switch(Bt.length){case 0:break;case 1:Bt[0].toLowerCase()!==Bt[0]&&(At+="an "),At+=`${Bt[0]}`;break;case 2:At+=`one of ${Bt[0]} or ${Bt[1]}`;break;default:{const Ut=Bt.pop();At+=`one of ${Bt.join(", ")}, or ${Ut}`}}if(_t==null)At+=`. Received ${_t}`;else if(typeof _t=="function"&&_t.name)At+=`. Received function ${_t.name}`;else if(typeof _t=="object"){var Nt;if((Nt=_t.constructor)!==null&&Nt!==void 0&&Nt.name)At+=`. Received an instance of ${_t.constructor.name}`;else{const Ut=inspect$3(_t,{depth:-1});At+=`. Received ${Ut}`}}else{let Ut=inspect$3(_t,{colors:!1});Ut.length>25&&(Ut=`${Ut.slice(0,25)}...`),At+=`. Received type ${typeof _t} (${Ut})`}return At},TypeError);E$2("ERR_INVALID_ARG_VALUE",($t,e,_t="is invalid")=>{let At=inspect$3(e);return At.length>128&&(At=At.slice(0,128)+"..."),`The ${$t.includes(".")?"property":"argument"} '${$t}' ${_t}. Received ${At}`},TypeError);E$2("ERR_INVALID_RETURN_VALUE",($t,e,_t)=>{var At;const xt=_t!=null&&(At=_t.constructor)!==null&&At!==void 0&&At.name?`instance of ${_t.constructor.name}`:`type ${typeof _t}`;return`Expected ${$t} to be returned from the "${e}" function but got ${xt}.`},TypeError);E$2("ERR_MISSING_ARGS",(...$t)=>{assert$1($t.length>0,"At least one arg needs to be specified");let e;const _t=$t.length;switch($t=(Array.isArray($t)?$t:[$t]).map(At=>`"${At}"`).join(" or "),_t){case 1:e+=`The ${$t[0]} argument`;break;case 2:e+=`The ${$t[0]} and ${$t[1]} arguments`;break;default:{const At=$t.pop();e+=`The ${$t.join(", ")}, and ${At} arguments`}break}return`${e} must be specified`},TypeError);E$2("ERR_OUT_OF_RANGE",($t,e,_t)=>{assert$1(e,'Missing "range" argument');let At;return Number.isInteger(_t)&&Math.abs(_t)>2**32?At=addNumericalSeparator$1(String(_t)):typeof _t=="bigint"?(At=String(_t),(_t>2n**32n||_t<-(2n**32n))&&(At=addNumericalSeparator$1(At)),At+="n"):At=inspect$3(_t),`The value of "${$t}" is out of range. It must be ${e}. Received ${At}`},RangeError);E$2("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);E$2("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);E$2("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);E$2("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);E$2("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);E$2("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);E$2("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);E$2("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);E$2("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);E$2("ERR_STREAM_WRITE_AFTER_END","write after end",Error);E$2("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var errors$2={AbortError:AbortError$e,aggregateTwoErrors:hideStackFrames$3(aggregateTwoErrors$5),hideStackFrames:hideStackFrames$3,codes:codes$3};const{ArrayIsArray:ArrayIsArray$5,ArrayPrototypeIncludes:ArrayPrototypeIncludes$1,ArrayPrototypeJoin:ArrayPrototypeJoin$1,ArrayPrototypeMap:ArrayPrototypeMap$1,NumberIsInteger:NumberIsInteger$3,NumberIsNaN:NumberIsNaN$3,NumberMAX_SAFE_INTEGER:NumberMAX_SAFE_INTEGER$1,NumberMIN_SAFE_INTEGER:NumberMIN_SAFE_INTEGER$1,NumberParseInt:NumberParseInt$1,ObjectPrototypeHasOwnProperty:ObjectPrototypeHasOwnProperty$1,RegExpPrototypeExec:RegExpPrototypeExec$1,String:String$2,StringPrototypeToUpperCase:StringPrototypeToUpperCase$1,StringPrototypeTrim:StringPrototypeTrim$1}=primordials$1,{hideStackFrames:hideStackFrames$2,codes:{ERR_SOCKET_BAD_PORT:ERR_SOCKET_BAD_PORT$1,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$a,ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$7,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$3,ERR_UNKNOWN_SIGNAL:ERR_UNKNOWN_SIGNAL$1}}=errors$2,{normalizeEncoding:normalizeEncoding$1}=utilExports$1,{isAsyncFunction:isAsyncFunction$1,isArrayBufferView:isArrayBufferView$1}=utilExports$1.types,signals$1={};function isInt32$1($t){return $t===($t|0)}function isUint32$1($t){return $t===$t>>>0}const octalReg$1=/^[0-7]+$/,modeDesc$1="must be a 32-bit unsigned integer or an octal string";function parseFileMode$1($t,e,_t){if(typeof $t>"u"&&($t=_t),typeof $t=="string"){if(RegExpPrototypeExec$1(octalReg$1,$t)===null)throw new ERR_INVALID_ARG_VALUE$7(e,$t,modeDesc$1);$t=NumberParseInt$1($t,8)}return validateUint32$1($t,e),$t}const validateInteger$4=hideStackFrames$2(($t,e,_t=NumberMIN_SAFE_INTEGER$1,At=NumberMAX_SAFE_INTEGER$1)=>{if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",$t);if(!NumberIsInteger$3($t))throw new ERR_OUT_OF_RANGE$3(e,"an integer",$t);if($t<_t||$t>At)throw new ERR_OUT_OF_RANGE$3(e,`>= ${_t} && <= ${At}`,$t)}),validateInt32$1=hideStackFrames$2(($t,e,_t=-2147483648,At=2147483647)=>{if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",$t);if(!NumberIsInteger$3($t))throw new ERR_OUT_OF_RANGE$3(e,"an integer",$t);if($t<_t||$t>At)throw new ERR_OUT_OF_RANGE$3(e,`>= ${_t} && <= ${At}`,$t)}),validateUint32$1=hideStackFrames$2(($t,e,_t=!1)=>{if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",$t);if(!NumberIsInteger$3($t))throw new ERR_OUT_OF_RANGE$3(e,"an integer",$t);const At=_t?1:0,xt=4294967295;if($t<At||$t>xt)throw new ERR_OUT_OF_RANGE$3(e,`>= ${At} && <= ${xt}`,$t)});function validateString$1($t,e){if(typeof $t!="string")throw new ERR_INVALID_ARG_TYPE$a(e,"string",$t)}function validateNumber$1($t,e,_t=void 0,At){if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",$t);if(_t!=null&&$t<_t||At!=null&&$t>At||(_t!=null||At!=null)&&NumberIsNaN$3($t))throw new ERR_OUT_OF_RANGE$3(e,`${_t!=null?`>= ${_t}`:""}${_t!=null&&At!=null?" && ":""}${At!=null?`<= ${At}`:""}`,$t)}const validateOneOf$1=hideStackFrames$2(($t,e,_t)=>{if(!ArrayPrototypeIncludes$1(_t,$t)){const xt="must be one of: "+ArrayPrototypeJoin$1(ArrayPrototypeMap$1(_t,kt=>typeof kt=="string"?`'${kt}'`:String$2(kt)),", ");throw new ERR_INVALID_ARG_VALUE$7(e,$t,xt)}});function validateBoolean$3($t,e){if(typeof $t!="boolean")throw new ERR_INVALID_ARG_TYPE$a(e,"boolean",$t)}function getOwnPropertyValueOrDefault$1($t,e,_t){return $t==null||!ObjectPrototypeHasOwnProperty$1($t,e)?_t:$t[e]}const validateObject$6=hideStackFrames$2(($t,e,_t=null)=>{const At=getOwnPropertyValueOrDefault$1(_t,"allowArray",!1),xt=getOwnPropertyValueOrDefault$1(_t,"allowFunction",!1);if(!getOwnPropertyValueOrDefault$1(_t,"nullable",!1)&&$t===null||!At&&ArrayIsArray$5($t)||typeof $t!="object"&&(!xt||typeof $t!="function"))throw new ERR_INVALID_ARG_TYPE$a(e,"Object",$t)}),validateDictionary$1=hideStackFrames$2(($t,e)=>{if($t!=null&&typeof $t!="object"&&typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$a(e,"a dictionary",$t)}),validateArray$2=hideStackFrames$2(($t,e,_t=0)=>{if(!ArrayIsArray$5($t))throw new ERR_INVALID_ARG_TYPE$a(e,"Array",$t);if($t.length<_t){const At=`must be longer than ${_t}`;throw new ERR_INVALID_ARG_VALUE$7(e,$t,At)}});function validateStringArray$1($t,e){validateArray$2($t,e);for(let _t=0;_t<$t.length;_t++)validateString$1($t[_t],`${e}[${_t}]`)}function validateBooleanArray$1($t,e){validateArray$2($t,e);for(let _t=0;_t<$t.length;_t++)validateBoolean$3($t[_t],`${e}[${_t}]`)}function validateAbortSignalArray($t,e){validateArray$2($t,e);for(let _t=0;_t<$t.length;_t++){const At=$t[_t],xt=`${e}[${_t}]`;if(At==null)throw new ERR_INVALID_ARG_TYPE$a(xt,"AbortSignal",At);validateAbortSignal$7(At,xt)}}function validateSignalName$1($t,e="signal"){if(validateString$1($t,e),signals$1[$t]===void 0)throw signals$1[StringPrototypeToUpperCase$1($t)]!==void 0?new ERR_UNKNOWN_SIGNAL$1($t+" (signals must use all capital letters)"):new ERR_UNKNOWN_SIGNAL$1($t)}const validateBuffer$1=hideStackFrames$2(($t,e="buffer")=>{if(!isArrayBufferView$1($t))throw new ERR_INVALID_ARG_TYPE$a(e,["Buffer","TypedArray","DataView"],$t)});function validateEncoding$1($t,e){const _t=normalizeEncoding$1(e),At=$t.length;if(_t==="hex"&&At%2!==0)throw new ERR_INVALID_ARG_VALUE$7("encoding",e,`is invalid for data of length ${At}`)}function validatePort$1($t,e="Port",_t=!0){if(typeof $t!="number"&&typeof $t!="string"||typeof $t=="string"&&StringPrototypeTrim$1($t).length===0||+$t!==+$t>>>0||$t>65535||$t===0&&!_t)throw new ERR_SOCKET_BAD_PORT$1(e,$t,_t);return $t|0}const validateAbortSignal$7=hideStackFrames$2(($t,e)=>{if($t!==void 0&&($t===null||typeof $t!="object"||!("aborted"in $t)))throw new ERR_INVALID_ARG_TYPE$a(e,"AbortSignal",$t)}),validateFunction$6=hideStackFrames$2(($t,e)=>{if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$a(e,"Function",$t)}),validatePlainFunction$1=hideStackFrames$2(($t,e)=>{if(typeof $t!="function"||isAsyncFunction$1($t))throw new ERR_INVALID_ARG_TYPE$a(e,"Function",$t)}),validateUndefined$1=hideStackFrames$2(($t,e)=>{if($t!==void 0)throw new ERR_INVALID_ARG_TYPE$a(e,"undefined",$t)});function validateUnion$2($t,e,_t){if(!ArrayPrototypeIncludes$1(_t,$t))throw new ERR_INVALID_ARG_TYPE$a(e,`('${ArrayPrototypeJoin$1(_t,"|")}')`,$t)}const linkValueRegExp$1=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function validateLinkHeaderFormat$1($t,e){if(typeof $t>"u"||!RegExpPrototypeExec$1(linkValueRegExp$1,$t))throw new ERR_INVALID_ARG_VALUE$7(e,$t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function validateLinkHeaderValue$1($t){if(typeof $t=="string")return validateLinkHeaderFormat$1($t,"hints"),$t;if(ArrayIsArray$5($t)){const e=$t.length;let _t="";if(e===0)return _t;for(let At=0;At<e;At++){const xt=$t[At];validateLinkHeaderFormat$1(xt,"hints"),_t+=xt,At!==e-1&&(_t+=", ")}return _t}throw new ERR_INVALID_ARG_VALUE$7("hints",$t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var validators$1={isInt32:isInt32$1,isUint32:isUint32$1,parseFileMode:parseFileMode$1,validateArray:validateArray$2,validateStringArray:validateStringArray$1,validateBooleanArray:validateBooleanArray$1,validateAbortSignalArray,validateBoolean:validateBoolean$3,validateBuffer:validateBuffer$1,validateDictionary:validateDictionary$1,validateEncoding:validateEncoding$1,validateFunction:validateFunction$6,validateInt32:validateInt32$1,validateInteger:validateInteger$4,validateNumber:validateNumber$1,validateObject:validateObject$6,validateOneOf:validateOneOf$1,validatePlainFunction:validatePlainFunction$1,validatePort:validatePort$1,validateSignalName:validateSignalName$1,validateString:validateString$1,validateUint32:validateUint32$1,validateUndefined:validateUndefined$1,validateUnion:validateUnion$2,validateAbortSignal:validateAbortSignal$7,validateLinkHeaderValue:validateLinkHeaderValue$1},endOfStream$1={exports:{}};const{SymbolAsyncIterator:SymbolAsyncIterator$5,SymbolIterator:SymbolIterator$5,SymbolFor:SymbolFor$1}=primordials$1,kIsDestroyed$1=SymbolFor$1("nodejs.stream.destroyed"),kIsErrored$1=SymbolFor$1("nodejs.stream.errored"),kIsReadable$1=SymbolFor$1("nodejs.stream.readable"),kIsWritable=SymbolFor$1("nodejs.stream.writable"),kIsDisturbed$1=SymbolFor$1("nodejs.stream.disturbed"),kIsClosedPromise$3=SymbolFor$1("nodejs.webstream.isClosedPromise"),kControllerErrorFunction$1=SymbolFor$1("nodejs.webstream.controllerErrorFunction");function isReadableNodeStream$5($t,e=!1){var _t;return!!($t&&typeof $t.pipe=="function"&&typeof $t.on=="function"&&(!e||typeof $t.pause=="function"&&typeof $t.resume=="function")&&(!$t._writableState||((_t=$t._readableState)===null||_t===void 0?void 0:_t.readable)!==!1)&&(!$t._writableState||$t._readableState))}function isWritableNodeStream$3($t){var e;return!!($t&&typeof $t.write=="function"&&typeof $t.on=="function"&&(!$t._readableState||((e=$t._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function isDuplexNodeStream$1($t){return!!($t&&typeof $t.pipe=="function"&&$t._readableState&&typeof $t.on=="function"&&typeof $t.write=="function")}function isNodeStream$9($t){return $t&&($t._readableState||$t._writableState||typeof $t.write=="function"&&typeof $t.on=="function"||typeof $t.pipe=="function"&&typeof $t.on=="function")}function isReadableStream$7($t){return!!($t&&!isNodeStream$9($t)&&typeof $t.pipeThrough=="function"&&typeof $t.getReader=="function"&&typeof $t.cancel=="function")}function isWritableStream$5($t){return!!($t&&!isNodeStream$9($t)&&typeof $t.getWriter=="function"&&typeof $t.abort=="function")}function isTransformStream$5($t){return!!($t&&!isNodeStream$9($t)&&typeof $t.readable=="object"&&typeof $t.writable=="object")}function isWebStream$5($t){return isReadableStream$7($t)||isWritableStream$5($t)||isTransformStream$5($t)}function isIterable$4($t,e){return $t==null?!1:e===!0?typeof $t[SymbolAsyncIterator$5]=="function":e===!1?typeof $t[SymbolIterator$5]=="function":typeof $t[SymbolAsyncIterator$5]=="function"||typeof $t[SymbolIterator$5]=="function"}function isDestroyed$3($t){if(!isNodeStream$9($t))return null;const e=$t._writableState,_t=$t._readableState,At=e||_t;return!!($t.destroyed||$t[kIsDestroyed$1]||At!=null&&At.destroyed)}function isWritableEnded$1($t){if(!isWritableNodeStream$3($t))return null;if($t.writableEnded===!0)return!0;const e=$t._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isWritableFinished$3($t,e){if(!isWritableNodeStream$3($t))return null;if($t.writableFinished===!0)return!0;const _t=$t._writableState;return _t!=null&&_t.errored?!1:typeof(_t==null?void 0:_t.finished)!="boolean"?null:!!(_t.finished||e===!1&&_t.ended===!0&&_t.length===0)}function isReadableEnded$2($t){if(!isReadableNodeStream$5($t))return null;if($t.readableEnded===!0)return!0;const e=$t._readableState;return!e||e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isReadableFinished$4($t,e){if(!isReadableNodeStream$5($t))return null;const _t=$t._readableState;return _t!=null&&_t.errored?!1:typeof(_t==null?void 0:_t.endEmitted)!="boolean"?null:!!(_t.endEmitted||e===!1&&_t.ended===!0&&_t.length===0)}function isReadable$7($t){return $t&&$t[kIsReadable$1]!=null?$t[kIsReadable$1]:typeof($t==null?void 0:$t.readable)!="boolean"?null:isDestroyed$3($t)?!1:isReadableNodeStream$5($t)&&$t.readable&&!isReadableFinished$4($t)}function isWritable$7($t){return $t&&$t[kIsWritable]!=null?$t[kIsWritable]:typeof($t==null?void 0:$t.writable)!="boolean"?null:isDestroyed$3($t)?!1:isWritableNodeStream$3($t)&&$t.writable&&!isWritableEnded$1($t)}function isFinished$3($t,e){return isNodeStream$9($t)?isDestroyed$3($t)?!0:!((e==null?void 0:e.readable)!==!1&&isReadable$7($t)||(e==null?void 0:e.writable)!==!1&&isWritable$7($t)):null}function isWritableErrored$3($t){var e,_t;return isNodeStream$9($t)?$t.writableErrored?$t.writableErrored:(e=(_t=$t._writableState)===null||_t===void 0?void 0:_t.errored)!==null&&e!==void 0?e:null:null}function isReadableErrored$3($t){var e,_t;return isNodeStream$9($t)?$t.readableErrored?$t.readableErrored:(e=(_t=$t._readableState)===null||_t===void 0?void 0:_t.errored)!==null&&e!==void 0?e:null:null}function isClosed$3($t){if(!isNodeStream$9($t))return null;if(typeof $t.closed=="boolean")return $t.closed;const e=$t._writableState,_t=$t._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(_t==null?void 0:_t.closed)=="boolean"?(e==null?void 0:e.closed)||(_t==null?void 0:_t.closed):typeof $t._closed=="boolean"&&isOutgoingMessage$1($t)?$t._closed:null}function isOutgoingMessage$1($t){return typeof $t._closed=="boolean"&&typeof $t._defaultKeepAlive=="boolean"&&typeof $t._removedConnection=="boolean"&&typeof $t._removedContLen=="boolean"}function isServerResponse$1($t){return typeof $t._sent100=="boolean"&&isOutgoingMessage$1($t)}function isServerRequest$3($t){var e;return typeof $t._consuming=="boolean"&&typeof $t._dumped=="boolean"&&((e=$t.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function willEmitClose$1($t){if(!isNodeStream$9($t))return null;const e=$t._writableState,_t=$t._readableState,At=e||_t;return!At&&isServerResponse$1($t)||!!(At&&At.autoDestroy&&At.emitClose&&At.closed===!1)}function isDisturbed$1($t){var e;return!!($t&&((e=$t[kIsDisturbed$1])!==null&&e!==void 0?e:$t.readableDidRead||$t.readableAborted))}function isErrored$1($t){var e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt;return!!($t&&((e=(_t=(At=(xt=(kt=(Bt=$t[kIsErrored$1])!==null&&Bt!==void 0?Bt:$t.readableErrored)!==null&&kt!==void 0?kt:$t.writableErrored)!==null&&xt!==void 0?xt:(Nt=$t._readableState)===null||Nt===void 0?void 0:Nt.errorEmitted)!==null&&At!==void 0?At:(Ut=$t._writableState)===null||Ut===void 0?void 0:Ut.errorEmitted)!==null&&_t!==void 0?_t:(Lt=$t._readableState)===null||Lt===void 0?void 0:Lt.errored)!==null&&e!==void 0?e:!((jt=$t._writableState)===null||jt===void 0)&&jt.errored))}var utils$2={isDestroyed:isDestroyed$3,kIsDestroyed:kIsDestroyed$1,isDisturbed:isDisturbed$1,kIsDisturbed:kIsDisturbed$1,isErrored:isErrored$1,kIsErrored:kIsErrored$1,isReadable:isReadable$7,kIsReadable:kIsReadable$1,kIsClosedPromise:kIsClosedPromise$3,kControllerErrorFunction:kControllerErrorFunction$1,kIsWritable,isClosed:isClosed$3,isDuplexNodeStream:isDuplexNodeStream$1,isFinished:isFinished$3,isIterable:isIterable$4,isReadableNodeStream:isReadableNodeStream$5,isReadableStream:isReadableStream$7,isReadableEnded:isReadableEnded$2,isReadableFinished:isReadableFinished$4,isReadableErrored:isReadableErrored$3,isNodeStream:isNodeStream$9,isWebStream:isWebStream$5,isWritable:isWritable$7,isWritableNodeStream:isWritableNodeStream$3,isWritableStream:isWritableStream$5,isWritableEnded:isWritableEnded$1,isWritableFinished:isWritableFinished$3,isWritableErrored:isWritableErrored$3,isServerRequest:isServerRequest$3,isServerResponse:isServerResponse$1,willEmitClose:willEmitClose$1,isTransformStream:isTransformStream$5};const process$7=browserExports$3,{AbortError:AbortError$d,codes:codes$2}=errors$2,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$9,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$3}=codes$2,{kEmptyObject:kEmptyObject$1,once:once$3}=utilExports$1,{validateAbortSignal:validateAbortSignal$6,validateFunction:validateFunction$5,validateObject:validateObject$5,validateBoolean:validateBoolean$2}=validators$1,{Promise:Promise$6,PromisePrototypeThen:PromisePrototypeThen$5,SymbolDispose:SymbolDispose$1}=primordials$1,{isClosed:isClosed$2,isReadable:isReadable$6,isReadableNodeStream:isReadableNodeStream$4,isReadableStream:isReadableStream$6,isReadableFinished:isReadableFinished$3,isReadableErrored:isReadableErrored$2,isWritable:isWritable$6,isWritableNodeStream:isWritableNodeStream$2,isWritableStream:isWritableStream$4,isWritableFinished:isWritableFinished$2,isWritableErrored:isWritableErrored$2,isNodeStream:isNodeStream$8,willEmitClose:_willEmitClose$1,kIsClosedPromise:kIsClosedPromise$2}=utils$2;let addAbortListener$1;function isRequest$3($t){return $t.setHeader&&typeof $t.abort=="function"}const nop$1=()=>{};function eos$5($t,e,_t){var At,xt;if(arguments.length===2?(_t=e,e=kEmptyObject$1):e==null?e=kEmptyObject$1:validateObject$5(e,"options"),validateFunction$5(_t,"callback"),validateAbortSignal$6(e.signal,"options.signal"),_t=once$3(_t),isReadableStream$6($t)||isWritableStream$4($t))return eosWeb$1($t,e,_t);if(!isNodeStream$8($t))throw new ERR_INVALID_ARG_TYPE$9("stream",["ReadableStream","WritableStream","Stream"],$t);const kt=(At=e.readable)!==null&&At!==void 0?At:isReadableNodeStream$4($t),Bt=(xt=e.writable)!==null&&xt!==void 0?xt:isWritableNodeStream$2($t),Nt=$t._writableState,Ut=$t._readableState,Lt=()=>{$t.writable||qt()};let jt=_willEmitClose$1($t)&&isReadableNodeStream$4($t)===kt&&isWritableNodeStream$2($t)===Bt,Kt=isWritableFinished$2($t,!1);const qt=()=>{Kt=!0,$t.destroyed&&(jt=!1),!(jt&&(!$t.readable||kt))&&(!kt||zt)&&_t.call($t)};let zt=isReadableFinished$3($t,!1);const Vt=()=>{zt=!0,$t.destroyed&&(jt=!1),!(jt&&(!$t.writable||Bt))&&(!Bt||Kt)&&_t.call($t)},Ht=dr=>{_t.call($t,dr)};let Wt=isClosed$2($t);const Qt=()=>{Wt=!0;const dr=isWritableErrored$2($t)||isReadableErrored$2($t);if(dr&&typeof dr!="boolean")return _t.call($t,dr);if(kt&&!zt&&isReadableNodeStream$4($t,!0)&&!isReadableFinished$3($t,!1))return _t.call($t,new ERR_STREAM_PREMATURE_CLOSE$3);if(Bt&&!Kt&&!isWritableFinished$2($t,!1))return _t.call($t,new ERR_STREAM_PREMATURE_CLOSE$3);_t.call($t)},Xt=()=>{Wt=!0;const dr=isWritableErrored$2($t)||isReadableErrored$2($t);if(dr&&typeof dr!="boolean")return _t.call($t,dr);_t.call($t)},Jt=()=>{$t.req.on("finish",qt)};isRequest$3($t)?($t.on("complete",qt),jt||$t.on("abort",Qt),$t.req?Jt():$t.on("request",Jt)):Bt&&!Nt&&($t.on("end",Lt),$t.on("close",Lt)),!jt&&typeof $t.aborted=="boolean"&&$t.on("aborted",Qt),$t.on("end",Vt),$t.on("finish",qt),e.error!==!1&&$t.on("error",Ht),$t.on("close",Qt),Wt?process$7.nextTick(Qt):Nt!=null&&Nt.errorEmitted||Ut!=null&&Ut.errorEmitted?jt||process$7.nextTick(Xt):(!kt&&(!jt||isReadable$6($t))&&(Kt||isWritable$6($t)===!1)||!Bt&&(!jt||isWritable$6($t))&&(zt||isReadable$6($t)===!1)||Ut&&$t.req&&$t.aborted)&&process$7.nextTick(Xt);const tr=()=>{_t=nop$1,$t.removeListener("aborted",Qt),$t.removeListener("complete",qt),$t.removeListener("abort",Qt),$t.removeListener("request",Jt),$t.req&&$t.req.removeListener("finish",qt),$t.removeListener("end",Lt),$t.removeListener("close",Lt),$t.removeListener("finish",qt),$t.removeListener("end",Vt),$t.removeListener("error",Ht),$t.removeListener("close",Qt)};if(e.signal&&!Wt){const dr=()=>{const vr=_t;tr(),vr.call($t,new AbortError$d(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)process$7.nextTick(dr);else{addAbortListener$1=addAbortListener$1||utilExports$1.addAbortListener;const vr=addAbortListener$1(e.signal,dr),$r=_t;_t=once$3((...Ir)=>{vr[SymbolDispose$1](),$r.apply($t,Ir)})}}return tr}function eosWeb$1($t,e,_t){let At=!1,xt=nop$1;if(e.signal)if(xt=()=>{At=!0,_t.call($t,new AbortError$d(void 0,{cause:e.signal.reason}))},e.signal.aborted)process$7.nextTick(xt);else{addAbortListener$1=addAbortListener$1||utilExports$1.addAbortListener;const Bt=addAbortListener$1(e.signal,xt),Nt=_t;_t=once$3((...Ut)=>{Bt[SymbolDispose$1](),Nt.apply($t,Ut)})}const kt=(...Bt)=>{At||process$7.nextTick(()=>_t.apply($t,Bt))};return PromisePrototypeThen$5($t[kIsClosedPromise$2].promise,kt,kt),nop$1}function finished$3($t,e){var _t;let At=!1;return e===null&&(e=kEmptyObject$1),(_t=e)!==null&&_t!==void 0&&_t.cleanup&&(validateBoolean$2(e.cleanup,"cleanup"),At=e.cleanup),new Promise$6((xt,kt)=>{const Bt=eos$5($t,e,Nt=>{At&&Bt(),Nt?kt(Nt):xt()})})}endOfStream$1.exports=eos$5;endOfStream$1.exports.finished=finished$3;var endOfStreamExports$1=endOfStream$1.exports;const process$6=browserExports$3,{aggregateTwoErrors:aggregateTwoErrors$4,codes:{ERR_MULTIPLE_CALLBACK:ERR_MULTIPLE_CALLBACK$1},AbortError:AbortError$c}=errors$2,{Symbol:Symbol$7}=primordials$1,{kIsDestroyed,isDestroyed:isDestroyed$2,isFinished:isFinished$2,isServerRequest:isServerRequest$2}=utils$2,kDestroy$1=Symbol$7("kDestroy"),kConstruct$1=Symbol$7("kConstruct");function checkError$1($t,e,_t){$t&&($t.stack,e&&!e.errored&&(e.errored=$t),_t&&!_t.errored&&(_t.errored=$t))}function destroy$1($t,e){const _t=this._readableState,At=this._writableState,xt=At||_t;return At!=null&&At.destroyed||_t!=null&&_t.destroyed?(typeof e=="function"&&e(),this):(checkError$1($t,At,_t),At&&(At.destroyed=!0),_t&&(_t.destroyed=!0),xt.constructed?_destroy$1(this,$t,e):this.once(kDestroy$1,function(kt){_destroy$1(this,aggregateTwoErrors$4(kt,$t),e)}),this)}function _destroy$1($t,e,_t){let At=!1;function xt(kt){if(At)return;At=!0;const Bt=$t._readableState,Nt=$t._writableState;checkError$1(kt,Nt,Bt),Nt&&(Nt.closed=!0),Bt&&(Bt.closed=!0),typeof _t=="function"&&_t(kt),kt?process$6.nextTick(emitErrorCloseNT$1,$t,kt):process$6.nextTick(emitCloseNT$1,$t)}try{$t._destroy(e||null,xt)}catch(kt){xt(kt)}}function emitErrorCloseNT$1($t,e){emitErrorNT$1($t,e),emitCloseNT$1($t)}function emitCloseNT$1($t){const e=$t._readableState,_t=$t._writableState;_t&&(_t.closeEmitted=!0),e&&(e.closeEmitted=!0),(_t!=null&&_t.emitClose||e!=null&&e.emitClose)&&$t.emit("close")}function emitErrorNT$1($t,e){const _t=$t._readableState,At=$t._writableState;At!=null&&At.errorEmitted||_t!=null&&_t.errorEmitted||(At&&(At.errorEmitted=!0),_t&&(_t.errorEmitted=!0),$t.emit("error",e))}function undestroy$1(){const $t=this._readableState,e=this._writableState;$t&&($t.constructed=!0,$t.closed=!1,$t.closeEmitted=!1,$t.destroyed=!1,$t.errored=null,$t.errorEmitted=!1,$t.reading=!1,$t.ended=$t.readable===!1,$t.endEmitted=$t.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function errorOrDestroy$1($t,e,_t){const At=$t._readableState,xt=$t._writableState;if(xt!=null&&xt.destroyed||At!=null&&At.destroyed)return this;At!=null&&At.autoDestroy||xt!=null&&xt.autoDestroy?$t.destroy(e):e&&(e.stack,xt&&!xt.errored&&(xt.errored=e),At&&!At.errored&&(At.errored=e),_t?process$6.nextTick(emitErrorNT$1,$t,e):emitErrorNT$1($t,e))}function construct$1($t,e){if(typeof $t._construct!="function")return;const _t=$t._readableState,At=$t._writableState;_t&&(_t.constructed=!1),At&&(At.constructed=!1),$t.once(kConstruct$1,e),!($t.listenerCount(kConstruct$1)>1)&&process$6.nextTick(constructNT$1,$t)}function constructNT$1($t){let e=!1;function _t(At){if(e){errorOrDestroy$1($t,At??new ERR_MULTIPLE_CALLBACK$1);return}e=!0;const xt=$t._readableState,kt=$t._writableState,Bt=kt||xt;xt&&(xt.constructed=!0),kt&&(kt.constructed=!0),Bt.destroyed?$t.emit(kDestroy$1,At):At?errorOrDestroy$1($t,At,!0):process$6.nextTick(emitConstructNT$1,$t)}try{$t._construct(At=>{process$6.nextTick(_t,At)})}catch(At){process$6.nextTick(_t,At)}}function emitConstructNT$1($t){$t.emit(kConstruct$1)}function isRequest$2($t){return($t==null?void 0:$t.setHeader)&&typeof $t.abort=="function"}function emitCloseLegacy$1($t){$t.emit("close")}function emitErrorCloseLegacy$1($t,e){$t.emit("error",e),process$6.nextTick(emitCloseLegacy$1,$t)}function destroyer$5($t,e){!$t||isDestroyed$2($t)||(!e&&!isFinished$2($t)&&(e=new AbortError$c),isServerRequest$2($t)?($t.socket=null,$t.destroy(e)):isRequest$2($t)?$t.abort():isRequest$2($t.req)?$t.req.abort():typeof $t.destroy=="function"?$t.destroy(e):typeof $t.close=="function"?$t.close():e?process$6.nextTick(emitErrorCloseLegacy$1,$t,e):process$6.nextTick(emitCloseLegacy$1,$t),$t.destroyed||($t[kIsDestroyed]=!0))}var destroy_1$1={construct:construct$1,destroyer:destroyer$5,destroy:destroy$1,undestroy:undestroy$1,errorOrDestroy:errorOrDestroy$1};const{ArrayIsArray:ArrayIsArray$4,ObjectSetPrototypeOf:ObjectSetPrototypeOf$5}=primordials$1,{EventEmitter:EE$1}=eventsExports;function Stream$2($t){EE$1.call(this,$t)}ObjectSetPrototypeOf$5(Stream$2.prototype,EE$1.prototype);ObjectSetPrototypeOf$5(Stream$2,EE$1);Stream$2.prototype.pipe=function($t,e){const _t=this;function At(jt){$t.writable&&$t.write(jt)===!1&&_t.pause&&_t.pause()}_t.on("data",At);function xt(){_t.readable&&_t.resume&&_t.resume()}$t.on("drain",xt),!$t._isStdio&&(!e||e.end!==!1)&&(_t.on("end",Bt),_t.on("close",Nt));let kt=!1;function Bt(){kt||(kt=!0,$t.end())}function Nt(){kt||(kt=!0,typeof $t.destroy=="function"&&$t.destroy())}function Ut(jt){Lt(),EE$1.listenerCount(this,"error")===0&&this.emit("error",jt)}prependListener$1(_t,"error",Ut),prependListener$1($t,"error",Ut);function Lt(){_t.removeListener("data",At),$t.removeListener("drain",xt),_t.removeListener("end",Bt),_t.removeListener("close",Nt),_t.removeListener("error",Ut),$t.removeListener("error",Ut),_t.removeListener("end",Lt),_t.removeListener("close",Lt),$t.removeListener("close",Lt)}return _t.on("end",Lt),_t.on("close",Lt),$t.on("close",Lt),$t.emit("pipe",_t),$t};function prependListener$1($t,e,_t){if(typeof $t.prependListener=="function")return $t.prependListener(e,_t);!$t._events||!$t._events[e]?$t.on(e,_t):ArrayIsArray$4($t._events[e])?$t._events[e].unshift(_t):$t._events[e]=[_t,$t._events[e]]}var legacy$1={Stream:Stream$2,prependListener:prependListener$1},addAbortSignal$1={exports:{}};(function($t){const{SymbolDispose:e}=primordials$1,{AbortError:_t,codes:At}=errors$2,{isNodeStream:xt,isWebStream:kt,kControllerErrorFunction:Bt}=utils$2,Nt=endOfStreamExports$1,{ERR_INVALID_ARG_TYPE:Ut}=At;let Lt;const jt=(Kt,qt)=>{if(typeof Kt!="object"||!("aborted"in Kt))throw new Ut(qt,"AbortSignal",Kt)};$t.exports.addAbortSignal=function(qt,zt){if(jt(qt,"signal"),!xt(zt)&&!kt(zt))throw new Ut("stream",["ReadableStream","WritableStream","Stream"],zt);return $t.exports.addAbortSignalNoValidate(qt,zt)},$t.exports.addAbortSignalNoValidate=function(Kt,qt){if(typeof Kt!="object"||!("aborted"in Kt))return qt;const zt=xt(qt)?()=>{qt.destroy(new _t(void 0,{cause:Kt.reason}))}:()=>{qt[Bt](new _t(void 0,{cause:Kt.reason}))};if(Kt.aborted)zt();else{Lt=Lt||utilExports$1.addAbortListener;const Vt=Lt(Kt,zt);Nt(qt,Vt[e])}return qt}})(addAbortSignal$1);var addAbortSignalExports$1=addAbortSignal$1.exports;const{StringPrototypeSlice:StringPrototypeSlice$1,SymbolIterator:SymbolIterator$4,TypedArrayPrototypeSet:TypedArrayPrototypeSet$1,Uint8Array:Uint8Array$2}=primordials$1,{Buffer:Buffer$5}=buffer$2,{inspect:inspect$2}=utilExports$1;var buffer_list$1=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const _t={data:e,next:null};this.length>0?this.tail.next=_t:this.head=_t,this.tail=_t,++this.length}unshift(e){const _t={data:e,next:this.head};this.length===0&&(this.tail=_t),this.head=_t,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let _t=this.head,At=""+_t.data;for(;(_t=_t.next)!==null;)At+=e+_t.data;return At}concat(e){if(this.length===0)return Buffer$5.alloc(0);const _t=Buffer$5.allocUnsafe(e>>>0);let At=this.head,xt=0;for(;At;)TypedArrayPrototypeSet$1(_t,At.data,xt),xt+=At.data.length,At=At.next;return _t}consume(e,_t){const At=this.head.data;if(e<At.length){const xt=At.slice(0,e);return this.head.data=At.slice(e),xt}return e===At.length?this.shift():_t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[SymbolIterator$4](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let _t="",At=this.head,xt=0;do{const kt=At.data;if(e>kt.length)_t+=kt,e-=kt.length;else{e===kt.length?(_t+=kt,++xt,At.next?this.head=At.next:this.head=this.tail=null):(_t+=StringPrototypeSlice$1(kt,0,e),this.head=At,At.data=StringPrototypeSlice$1(kt,e));break}++xt}while((At=At.next)!==null);return this.length-=xt,_t}_getBuffer(e){const _t=Buffer$5.allocUnsafe(e),At=e;let xt=this.head,kt=0;do{const Bt=xt.data;if(e>Bt.length)TypedArrayPrototypeSet$1(_t,Bt,At-e),e-=Bt.length;else{e===Bt.length?(TypedArrayPrototypeSet$1(_t,Bt,At-e),++kt,xt.next?this.head=xt.next:this.head=this.tail=null):(TypedArrayPrototypeSet$1(_t,new Uint8Array$2(Bt.buffer,Bt.byteOffset,e),At-e),this.head=xt,xt.data=Bt.slice(e));break}++kt}while((xt=xt.next)!==null);return this.length-=kt,_t}[Symbol.for("nodejs.util.inspect.custom")](e,_t){return inspect$2(this,{..._t,depth:0,customInspect:!1})}};const{MathFloor:MathFloor$3,NumberIsInteger:NumberIsInteger$2}=primordials$1,{validateInteger:validateInteger$3}=validators$1,{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$6}=errors$2.codes;let defaultHighWaterMarkBytes=16*1024,defaultHighWaterMarkObjectMode=16;function highWaterMarkFrom$1($t,e,_t){return $t.highWaterMark!=null?$t.highWaterMark:e?$t[_t]:null}function getDefaultHighWaterMark$1($t){return $t?defaultHighWaterMarkObjectMode:defaultHighWaterMarkBytes}function setDefaultHighWaterMark($t,e){validateInteger$3(e,"value",0),$t?defaultHighWaterMarkObjectMode=e:defaultHighWaterMarkBytes=e}function getHighWaterMark$3($t,e,_t,At){const xt=highWaterMarkFrom$1(e,At,_t);if(xt!=null){if(!NumberIsInteger$2(xt)||xt<0){const kt=At?`options.${_t}`:"options.highWaterMark";throw new ERR_INVALID_ARG_VALUE$6(kt,xt)}return MathFloor$3(xt)}return getDefaultHighWaterMark$1($t.objectMode)}var state$1={getHighWaterMark:getHighWaterMark$3,getDefaultHighWaterMark:getDefaultHighWaterMark$1,setDefaultHighWaterMark};const process$5=browserExports$3,{PromisePrototypeThen:PromisePrototypeThen$4,SymbolAsyncIterator:SymbolAsyncIterator$4,SymbolIterator:SymbolIterator$3}=primordials$1,{Buffer:Buffer$4}=buffer$2,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$8,ERR_STREAM_NULL_VALUES:ERR_STREAM_NULL_VALUES$1}=errors$2.codes;function from$4($t,e,_t){let At;if(typeof e=="string"||e instanceof Buffer$4)return new $t({objectMode:!0,..._t,read(){this.push(e),this.push(null)}});let xt;if(e&&e[SymbolAsyncIterator$4])xt=!0,At=e[SymbolAsyncIterator$4]();else if(e&&e[SymbolIterator$3])xt=!1,At=e[SymbolIterator$3]();else throw new ERR_INVALID_ARG_TYPE$8("iterable",["Iterable"],e);const kt=new $t({objectMode:!0,highWaterMark:1,..._t});let Bt=!1;kt._read=function(){Bt||(Bt=!0,Ut())},kt._destroy=function(Lt,jt){PromisePrototypeThen$4(Nt(Lt),()=>process$5.nextTick(jt,Lt),Kt=>process$5.nextTick(jt,Kt||Lt))};async function Nt(Lt){const jt=Lt!=null,Kt=typeof At.throw=="function";if(jt&&Kt){const{value:qt,done:zt}=await At.throw(Lt);if(await qt,zt)return}if(typeof At.return=="function"){const{value:qt}=await At.return();await qt}}async function Ut(){for(;;){try{const{value:Lt,done:jt}=xt?await At.next():At.next();if(jt)kt.push(null);else{const Kt=Lt&&typeof Lt.then=="function"?await Lt:Lt;if(Kt===null)throw Bt=!1,new ERR_STREAM_NULL_VALUES$1;if(kt.push(Kt))continue;Bt=!1}}catch(Lt){kt.destroy(Lt)}break}}return kt}var from_1$1=from$4,readable$1,hasRequiredReadable$1;function requireReadable$1(){if(hasRequiredReadable$1)return readable$1;hasRequiredReadable$1=1;const $t=browserExports$3,{ArrayPrototypeIndexOf:e,NumberIsInteger:_t,NumberIsNaN:At,NumberParseInt:xt,ObjectDefineProperties:kt,ObjectKeys:Bt,ObjectSetPrototypeOf:Nt,Promise:Ut,SafeSet:Lt,SymbolAsyncDispose:jt,SymbolAsyncIterator:Kt,Symbol:qt}=primordials$1;readable$1=Yr,Yr.ReadableState=Qr;const{EventEmitter:zt}=eventsExports,{Stream:Vt,prependListener:Ht}=legacy$1,{Buffer:Wt}=buffer$2,{addAbortSignal:Qt}=addAbortSignalExports$1,Xt=endOfStreamExports$1;let Jt=utilExports$1.debuglog("stream",qr=>{Jt=qr});const tr=buffer_list$1,dr=destroy_1$1,{getHighWaterMark:vr,getDefaultHighWaterMark:$r}=state$1,{aggregateTwoErrors:Ir,codes:{ERR_INVALID_ARG_TYPE:Rr,ERR_METHOD_NOT_IMPLEMENTED:Nr,ERR_OUT_OF_RANGE:kr,ERR_STREAM_PUSH_AFTER_EOF:lr,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:ir},AbortError:er}=errors$2,{validateObject:rr}=validators$1,yr=qt("kPaused"),{StringDecoder:fr}=string_decoder,gr=from_1$1;Nt(Yr.prototype,Vt.prototype),Nt(Yr,Vt);const ar=()=>{},{errorOrDestroy:nr}=dr,ur=1,pr=2,br=4,Sr=8,Pr=16,Tr=32,wr=64,Ar=128,Mr=256,Ur=512,Or=1024,Cr=2048,Er=4096,Br=8192,Lr=16384,xr=32768,_r=65536,Dr=1<<17,jr=1<<18;function Hr(qr){return{enumerable:!1,get(){return(this.state&qr)!==0},set(Wr){Wr?this.state|=qr:this.state&=~qr}}}kt(Qr.prototype,{objectMode:Hr(ur),ended:Hr(pr),endEmitted:Hr(br),reading:Hr(Sr),constructed:Hr(Pr),sync:Hr(Tr),needReadable:Hr(wr),emittedReadable:Hr(Ar),readableListening:Hr(Mr),resumeScheduled:Hr(Ur),errorEmitted:Hr(Or),emitClose:Hr(Cr),autoDestroy:Hr(Er),destroyed:Hr(Br),closed:Hr(Lr),closeEmitted:Hr(xr),multiAwaitDrain:Hr(_r),readingMore:Hr(Dr),dataEmitted:Hr(jr)});function Qr(qr,Wr,dn){typeof dn!="boolean"&&(dn=Wr instanceof requireDuplex$1()),this.state=Cr|Er|Pr|Tr,qr&&qr.objectMode&&(this.state|=ur),dn&&qr&&qr.readableObjectMode&&(this.state|=ur),this.highWaterMark=qr?vr(this,qr,"readableHighWaterMark",dn):$r(!1),this.buffer=new tr,this.length=0,this.pipes=[],this.flowing=null,this[yr]=null,qr&&qr.emitClose===!1&&(this.state&=~Cr),qr&&qr.autoDestroy===!1&&(this.state&=~Er),this.errored=null,this.defaultEncoding=qr&&qr.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,qr&&qr.encoding&&(this.decoder=new fr(qr.encoding),this.encoding=qr.encoding)}function Yr(qr){if(!(this instanceof Yr))return new Yr(qr);const Wr=this instanceof requireDuplex$1();this._readableState=new Qr(qr,this,Wr),qr&&(typeof qr.read=="function"&&(this._read=qr.read),typeof qr.destroy=="function"&&(this._destroy=qr.destroy),typeof qr.construct=="function"&&(this._construct=qr.construct),qr.signal&&!Wr&&Qt(qr.signal,this)),Vt.call(this,qr),dr.construct(this,()=>{this._readableState.needReadable&&yn(this,this._readableState)})}Yr.prototype.destroy=dr.destroy,Yr.prototype._undestroy=dr.undestroy,Yr.prototype._destroy=function(qr,Wr){Wr(qr)},Yr.prototype[zt.captureRejectionSymbol]=function(qr){this.destroy(qr)},Yr.prototype[jt]=function(){let qr;return this.destroyed||(qr=this.readableEnded?null:new er,this.destroy(qr)),new Ut((Wr,dn)=>Xt(this,ln=>ln&&ln!==qr?dn(ln):Wr(null)))},Yr.prototype.push=function(qr,Wr){return an(this,qr,Wr,!1)},Yr.prototype.unshift=function(qr,Wr){return an(this,qr,Wr,!0)};function an(qr,Wr,dn,ln){Jt("readableAddChunk",Wr);const un=qr._readableState;let On;if(un.state&ur||(typeof Wr=="string"?(dn=dn||un.defaultEncoding,un.encoding!==dn&&(ln&&un.encoding?Wr=Wt.from(Wr,dn).toString(un.encoding):(Wr=Wt.from(Wr,dn),dn=""))):Wr instanceof Wt?dn="":Vt._isUint8Array(Wr)?(Wr=Vt._uint8ArrayToBuffer(Wr),dn=""):Wr!=null&&(On=new Rr("chunk",["string","Buffer","Uint8Array"],Wr))),On)nr(qr,On);else if(Wr===null)un.state&=~Sr,nn(qr,un);else if(un.state&ur||Wr&&Wr.length>0)if(ln)if(un.state&br)nr(qr,new ir);else{if(un.destroyed||un.errored)return!1;cn(qr,un,Wr,!0)}else if(un.ended)nr(qr,new lr);else{if(un.destroyed||un.errored)return!1;un.state&=~Sr,un.decoder&&!dn?(Wr=un.decoder.write(Wr),un.objectMode||Wr.length!==0?cn(qr,un,Wr,!1):yn(qr,un)):cn(qr,un,Wr,!1)}else ln||(un.state&=~Sr,yn(qr,un));return!un.ended&&(un.length<un.highWaterMark||un.length===0)}function cn(qr,Wr,dn,ln){Wr.flowing&&Wr.length===0&&!Wr.sync&&qr.listenerCount("data")>0?(Wr.state&_r?Wr.awaitDrainWriters.clear():Wr.awaitDrainWriters=null,Wr.dataEmitted=!0,qr.emit("data",dn)):(Wr.length+=Wr.objectMode?1:dn.length,ln?Wr.buffer.unshift(dn):Wr.buffer.push(dn),Wr.state&wr&&rn(qr)),yn(qr,Wr)}Yr.prototype.isPaused=function(){const qr=this._readableState;return qr[yr]===!0||qr.flowing===!1},Yr.prototype.setEncoding=function(qr){const Wr=new fr(qr);this._readableState.decoder=Wr,this._readableState.encoding=this._readableState.decoder.encoding;const dn=this._readableState.buffer;let ln="";for(const un of dn)ln+=Wr.write(un);return dn.clear(),ln!==""&&dn.push(ln),this._readableState.length=ln.length,this};const Gr=1073741824;function Fr(qr){if(qr>Gr)throw new kr("size","<= 1GiB",qr);return qr--,qr|=qr>>>1,qr|=qr>>>2,qr|=qr>>>4,qr|=qr>>>8,qr|=qr>>>16,qr++,qr}function en(qr,Wr){return qr<=0||Wr.length===0&&Wr.ended?0:Wr.state&ur?1:At(qr)?Wr.flowing&&Wr.length?Wr.buffer.first().length:Wr.length:qr<=Wr.length?qr:Wr.ended?Wr.length:0}Yr.prototype.read=function(qr){Jt("read",qr),qr===void 0?qr=NaN:_t(qr)||(qr=xt(qr,10));const Wr=this._readableState,dn=qr;if(qr>Wr.highWaterMark&&(Wr.highWaterMark=Fr(qr)),qr!==0&&(Wr.state&=~Ar),qr===0&&Wr.needReadable&&((Wr.highWaterMark!==0?Wr.length>=Wr.highWaterMark:Wr.length>0)||Wr.ended))return Jt("read: emitReadable",Wr.length,Wr.ended),Wr.length===0&&Wr.ended?_n(this):rn(this),null;if(qr=en(qr,Wr),qr===0&&Wr.ended)return Wr.length===0&&_n(this),null;let ln=(Wr.state&wr)!==0;if(Jt("need readable",ln),(Wr.length===0||Wr.length-qr<Wr.highWaterMark)&&(ln=!0,Jt("length less than watermark",ln)),Wr.ended||Wr.reading||Wr.destroyed||Wr.errored||!Wr.constructed)ln=!1,Jt("reading, ended or constructing",ln);else if(ln){Jt("do read"),Wr.state|=Sr|Tr,Wr.length===0&&(Wr.state|=wr);try{this._read(Wr.highWaterMark)}catch(On){nr(this,On)}Wr.state&=~Tr,Wr.reading||(qr=en(dn,Wr))}let un;return qr>0?un=Kn(qr,Wr):un=null,un===null?(Wr.needReadable=Wr.length<=Wr.highWaterMark,qr=0):(Wr.length-=qr,Wr.multiAwaitDrain?Wr.awaitDrainWriters.clear():Wr.awaitDrainWriters=null),Wr.length===0&&(Wr.ended||(Wr.needReadable=!0),dn!==qr&&Wr.ended&&_n(this)),un!==null&&!Wr.errorEmitted&&!Wr.closeEmitted&&(Wr.dataEmitted=!0,this.emit("data",un)),un};function nn(qr,Wr){if(Jt("onEofChunk"),!Wr.ended){if(Wr.decoder){const dn=Wr.decoder.end();dn&&dn.length&&(Wr.buffer.push(dn),Wr.length+=Wr.objectMode?1:dn.length)}Wr.ended=!0,Wr.sync?rn(qr):(Wr.needReadable=!1,Wr.emittedReadable=!0,hn(qr))}}function rn(qr){const Wr=qr._readableState;Jt("emitReadable",Wr.needReadable,Wr.emittedReadable),Wr.needReadable=!1,Wr.emittedReadable||(Jt("emitReadable",Wr.flowing),Wr.emittedReadable=!0,$t.nextTick(hn,qr))}function hn(qr){const Wr=qr._readableState;Jt("emitReadable_",Wr.destroyed,Wr.length,Wr.ended),!Wr.destroyed&&!Wr.errored&&(Wr.length||Wr.ended)&&(qr.emit("readable"),Wr.emittedReadable=!1),Wr.needReadable=!Wr.flowing&&!Wr.ended&&Wr.length<=Wr.highWaterMark,Un(qr)}function yn(qr,Wr){!Wr.readingMore&&Wr.constructed&&(Wr.readingMore=!0,$t.nextTick(wn,qr,Wr))}function wn(qr,Wr){for(;!Wr.reading&&!Wr.ended&&(Wr.length<Wr.highWaterMark||Wr.flowing&&Wr.length===0);){const dn=Wr.length;if(Jt("maybeReadMore read 0"),qr.read(0),dn===Wr.length)break}Wr.readingMore=!1}Yr.prototype._read=function(qr){throw new Nr("_read()")},Yr.prototype.pipe=function(qr,Wr){const dn=this,ln=this._readableState;ln.pipes.length===1&&(ln.multiAwaitDrain||(ln.multiAwaitDrain=!0,ln.awaitDrainWriters=new Lt(ln.awaitDrainWriters?[ln.awaitDrainWriters]:[]))),ln.pipes.push(qr),Jt("pipe count=%d opts=%j",ln.pipes.length,Wr);const On=(!Wr||Wr.end!==!1)&&qr!==$t.stdout&&qr!==$t.stderr?Jr:Tn;ln.endEmitted?$t.nextTick(On):dn.once("end",On),qr.on("unpipe",Nn);function Nn(In,Rn){Jt("onunpipe"),In===dn&&Rn&&Rn.hasUnpiped===!1&&(Rn.hasUnpiped=!0,tn())}function Jr(){Jt("onend"),qr.end()}let Vr,Xr=!1;function tn(){Jt("cleanup"),qr.removeListener("close",vn),qr.removeListener("finish",En),Vr&&qr.removeListener("drain",Vr),qr.removeListener("error",fn),qr.removeListener("unpipe",Nn),dn.removeListener("end",Jr),dn.removeListener("end",Tn),dn.removeListener("data",pn),Xr=!0,Vr&&ln.awaitDrainWriters&&(!qr._writableState||qr._writableState.needDrain)&&Vr()}function on(){Xr||(ln.pipes.length===1&&ln.pipes[0]===qr?(Jt("false write response, pause",0),ln.awaitDrainWriters=qr,ln.multiAwaitDrain=!1):ln.pipes.length>1&&ln.pipes.includes(qr)&&(Jt("false write response, pause",ln.awaitDrainWriters.size),ln.awaitDrainWriters.add(qr)),dn.pause()),Vr||(Vr=mn(dn,qr),qr.on("drain",Vr))}dn.on("data",pn);function pn(In){Jt("ondata");const Rn=qr.write(In);Jt("dest.write",Rn),Rn===!1&&on()}function fn(In){if(Jt("onerror",In),Tn(),qr.removeListener("error",fn),qr.listenerCount("error")===0){const Rn=qr._writableState||qr._readableState;Rn&&!Rn.errorEmitted?nr(qr,In):qr.emit("error",In)}}Ht(qr,"error",fn);function vn(){qr.removeListener("finish",En),Tn()}qr.once("close",vn);function En(){Jt("onfinish"),qr.removeListener("close",vn),Tn()}qr.once("finish",En);function Tn(){Jt("unpipe"),dn.unpipe(qr)}return qr.emit("pipe",dn),qr.writableNeedDrain===!0?on():ln.flowing||(Jt("pipe resume"),dn.resume()),qr};function mn(qr,Wr){return function(){const ln=qr._readableState;ln.awaitDrainWriters===Wr?(Jt("pipeOnDrain",1),ln.awaitDrainWriters=null):ln.multiAwaitDrain&&(Jt("pipeOnDrain",ln.awaitDrainWriters.size),ln.awaitDrainWriters.delete(Wr)),(!ln.awaitDrainWriters||ln.awaitDrainWriters.size===0)&&qr.listenerCount("data")&&qr.resume()}}Yr.prototype.unpipe=function(qr){const Wr=this._readableState,dn={hasUnpiped:!1};if(Wr.pipes.length===0)return this;if(!qr){const un=Wr.pipes;Wr.pipes=[],this.pause();for(let On=0;On<un.length;On++)un[On].emit("unpipe",this,{hasUnpiped:!1});return this}const ln=e(Wr.pipes,qr);return ln===-1?this:(Wr.pipes.splice(ln,1),Wr.pipes.length===0&&this.pause(),qr.emit("unpipe",this,dn),this)},Yr.prototype.on=function(qr,Wr){const dn=Vt.prototype.on.call(this,qr,Wr),ln=this._readableState;return qr==="data"?(ln.readableListening=this.listenerCount("readable")>0,ln.flowing!==!1&&this.resume()):qr==="readable"&&!ln.endEmitted&&!ln.readableListening&&(ln.readableListening=ln.needReadable=!0,ln.flowing=!1,ln.emittedReadable=!1,Jt("on readable",ln.length,ln.reading),ln.length?rn(this):ln.reading||$t.nextTick(Bn,this)),dn},Yr.prototype.addListener=Yr.prototype.on,Yr.prototype.removeListener=function(qr,Wr){const dn=Vt.prototype.removeListener.call(this,qr,Wr);return qr==="readable"&&$t.nextTick(Mn,this),dn},Yr.prototype.off=Yr.prototype.removeListener,Yr.prototype.removeAllListeners=function(qr){const Wr=Vt.prototype.removeAllListeners.apply(this,arguments);return(qr==="readable"||qr===void 0)&&$t.nextTick(Mn,this),Wr};function Mn(qr){const Wr=qr._readableState;Wr.readableListening=qr.listenerCount("readable")>0,Wr.resumeScheduled&&Wr[yr]===!1?Wr.flowing=!0:qr.listenerCount("data")>0?qr.resume():Wr.readableListening||(Wr.flowing=null)}function Bn(qr){Jt("readable nexttick read 0"),qr.read(0)}Yr.prototype.resume=function(){const qr=this._readableState;return qr.flowing||(Jt("resume"),qr.flowing=!qr.readableListening,Sn(this,qr)),qr[yr]=!1,this};function Sn(qr,Wr){Wr.resumeScheduled||(Wr.resumeScheduled=!0,$t.nextTick(kn,qr,Wr))}function kn(qr,Wr){Jt("resume",Wr.reading),Wr.reading||qr.read(0),Wr.resumeScheduled=!1,qr.emit("resume"),Un(qr),Wr.flowing&&!Wr.reading&&qr.read(0)}Yr.prototype.pause=function(){return Jt("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Jt("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[yr]=!0,this};function Un(qr){const Wr=qr._readableState;for(Jt("flow",Wr.flowing);Wr.flowing&&qr.read()!==null;);}Yr.prototype.wrap=function(qr){let Wr=!1;qr.on("data",ln=>{!this.push(ln)&&qr.pause&&(Wr=!0,qr.pause())}),qr.on("end",()=>{this.push(null)}),qr.on("error",ln=>{nr(this,ln)}),qr.on("close",()=>{this.destroy()}),qr.on("destroy",()=>{this.destroy()}),this._read=()=>{Wr&&qr.resume&&(Wr=!1,qr.resume())};const dn=Bt(qr);for(let ln=1;ln<dn.length;ln++){const un=dn[ln];this[un]===void 0&&typeof qr[un]=="function"&&(this[un]=qr[un].bind(qr))}return this},Yr.prototype[Kt]=function(){return Dn(this)},Yr.prototype.iterator=function(qr){return qr!==void 0&&rr(qr,"options"),Dn(this,qr)};function Dn(qr,Wr){typeof qr.read!="function"&&(qr=Yr.wrap(qr,{objectMode:!0}));const dn=Ln(qr,Wr);return dn.stream=qr,dn}async function*Ln(qr,Wr){let dn=ar;function ln(Nn){this===qr?(dn(),dn=ar):dn=Nn}qr.on("readable",ln);let un;const On=Xt(qr,{writable:!1},Nn=>{un=Nn?Ir(un,Nn):null,dn(),dn=ar});try{for(;;){const Nn=qr.destroyed?null:qr.read();if(Nn!==null)yield Nn;else{if(un)throw un;if(un===null)return;await new Ut(ln)}}}catch(Nn){throw un=Ir(un,Nn),un}finally{(un||(Wr==null?void 0:Wr.destroyOnReturn)!==!1)&&(un===void 0||qr._readableState.autoDestroy)?dr.destroyer(qr,null):(qr.off("readable",ln),On())}}kt(Yr.prototype,{readable:{__proto__:null,get(){const qr=this._readableState;return!!qr&&qr.readable!==!1&&!qr.destroyed&&!qr.errorEmitted&&!qr.endEmitted},set(qr){this._readableState&&(this._readableState.readable=!!qr)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(qr){this._readableState&&(this._readableState.flowing=qr)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(qr){this._readableState&&(this._readableState.destroyed=qr)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),kt(Qr.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[yr]!==!1},set(qr){this[yr]=!!qr}}}),Yr._fromList=Kn;function Kn(qr,Wr){if(Wr.length===0)return null;let dn;return Wr.objectMode?dn=Wr.buffer.shift():!qr||qr>=Wr.length?(Wr.decoder?dn=Wr.buffer.join(""):Wr.buffer.length===1?dn=Wr.buffer.first():dn=Wr.buffer.concat(Wr.length),Wr.buffer.clear()):dn=Wr.buffer.consume(qr,Wr.decoder),dn}function _n(qr){const Wr=qr._readableState;Jt("endReadable",Wr.endEmitted),Wr.endEmitted||(Wr.ended=!0,$t.nextTick(jn,Wr,qr))}function jn(qr,Wr){if(Jt("endReadableNT",qr.endEmitted,qr.length),!qr.errored&&!qr.closeEmitted&&!qr.endEmitted&&qr.length===0){if(qr.endEmitted=!0,Wr.emit("end"),Wr.writable&&Wr.allowHalfOpen===!1)$t.nextTick(Gn,Wr);else if(qr.autoDestroy){const dn=Wr._writableState;(!dn||dn.autoDestroy&&(dn.finished||dn.writable===!1))&&Wr.destroy()}}}function Gn(qr){qr.writable&&!qr.writableEnded&&!qr.destroyed&&qr.end()}Yr.from=function(qr,Wr){return gr(Yr,qr,Wr)};let xn;function Hn(){return xn===void 0&&(xn={}),xn}return Yr.fromWeb=function(qr,Wr){return Hn().newStreamReadableFromReadableStream(qr,Wr)},Yr.toWeb=function(qr,Wr){return Hn().newReadableStreamFromStreamReadable(qr,Wr)},Yr.wrap=function(qr,Wr){var dn,ln;return new Yr({objectMode:(dn=(ln=qr.readableObjectMode)!==null&&ln!==void 0?ln:qr.objectMode)!==null&&dn!==void 0?dn:!0,...Wr,destroy(un,On){dr.destroyer(qr,un),On(un)}}).wrap(qr)},readable$1}var writable$1,hasRequiredWritable$1;function requireWritable$1(){if(hasRequiredWritable$1)return writable$1;hasRequiredWritable$1=1;const $t=browserExports$3,{ArrayPrototypeSlice:e,Error:_t,FunctionPrototypeSymbolHasInstance:At,ObjectDefineProperty:xt,ObjectDefineProperties:kt,ObjectSetPrototypeOf:Bt,StringPrototypeToLowerCase:Nt,Symbol:Ut,SymbolHasInstance:Lt}=primordials$1;writable$1=rr,rr.WritableState=ir;const{EventEmitter:jt}=eventsExports,Kt=legacy$1.Stream,{Buffer:qt}=buffer$2,zt=destroy_1$1,{addAbortSignal:Vt}=addAbortSignalExports$1,{getHighWaterMark:Ht,getDefaultHighWaterMark:Wt}=state$1,{ERR_INVALID_ARG_TYPE:Qt,ERR_METHOD_NOT_IMPLEMENTED:Xt,ERR_MULTIPLE_CALLBACK:Jt,ERR_STREAM_CANNOT_PIPE:tr,ERR_STREAM_DESTROYED:dr,ERR_STREAM_ALREADY_FINISHED:vr,ERR_STREAM_NULL_VALUES:$r,ERR_STREAM_WRITE_AFTER_END:Ir,ERR_UNKNOWN_ENCODING:Rr}=errors$2.codes,{errorOrDestroy:Nr}=zt;Bt(rr.prototype,Kt.prototype),Bt(rr,Kt);function kr(){}const lr=Ut("kOnFinished");function ir(Er,Br,Lr){typeof Lr!="boolean"&&(Lr=Br instanceof requireDuplex$1()),this.objectMode=!!(Er&&Er.objectMode),Lr&&(this.objectMode=this.objectMode||!!(Er&&Er.writableObjectMode)),this.highWaterMark=Er?Ht(this,Er,"writableHighWaterMark",Lr):Wt(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const xr=!!(Er&&Er.decodeStrings===!1);this.decodeStrings=!xr,this.defaultEncoding=Er&&Er.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=nr.bind(void 0,Br),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,er(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!Er||Er.emitClose!==!1,this.autoDestroy=!Er||Er.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[lr]=[]}function er(Er){Er.buffered=[],Er.bufferedIndex=0,Er.allBuffers=!0,Er.allNoop=!0}ir.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},xt(ir.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function rr(Er){const Br=this instanceof requireDuplex$1();if(!Br&&!At(rr,this))return new rr(Er);this._writableState=new ir(Er,this,Br),Er&&(typeof Er.write=="function"&&(this._write=Er.write),typeof Er.writev=="function"&&(this._writev=Er.writev),typeof Er.destroy=="function"&&(this._destroy=Er.destroy),typeof Er.final=="function"&&(this._final=Er.final),typeof Er.construct=="function"&&(this._construct=Er.construct),Er.signal&&Vt(Er.signal,this)),Kt.call(this,Er),zt.construct(this,()=>{const Lr=this._writableState;Lr.writing||Sr(this,Lr),Ar(this,Lr)})}xt(rr,Lt,{__proto__:null,value:function(Er){return At(this,Er)?!0:this!==rr?!1:Er&&Er._writableState instanceof ir}}),rr.prototype.pipe=function(){Nr(this,new tr)};function yr(Er,Br,Lr,xr){const _r=Er._writableState;if(typeof Lr=="function")xr=Lr,Lr=_r.defaultEncoding;else{if(!Lr)Lr=_r.defaultEncoding;else if(Lr!=="buffer"&&!qt.isEncoding(Lr))throw new Rr(Lr);typeof xr!="function"&&(xr=kr)}if(Br===null)throw new $r;if(!_r.objectMode)if(typeof Br=="string")_r.decodeStrings!==!1&&(Br=qt.from(Br,Lr),Lr="buffer");else if(Br instanceof qt)Lr="buffer";else if(Kt._isUint8Array(Br))Br=Kt._uint8ArrayToBuffer(Br),Lr="buffer";else throw new Qt("chunk",["string","Buffer","Uint8Array"],Br);let Dr;return _r.ending?Dr=new Ir:_r.destroyed&&(Dr=new dr("write")),Dr?($t.nextTick(xr,Dr),Nr(Er,Dr,!0),Dr):(_r.pendingcb++,fr(Er,_r,Br,Lr,xr))}rr.prototype.write=function(Er,Br,Lr){return yr(this,Er,Br,Lr)===!0},rr.prototype.cork=function(){this._writableState.corked++},rr.prototype.uncork=function(){const Er=this._writableState;Er.corked&&(Er.corked--,Er.writing||Sr(this,Er))},rr.prototype.setDefaultEncoding=function(Br){if(typeof Br=="string"&&(Br=Nt(Br)),!qt.isEncoding(Br))throw new Rr(Br);return this._writableState.defaultEncoding=Br,this};function fr(Er,Br,Lr,xr,_r){const Dr=Br.objectMode?1:Lr.length;Br.length+=Dr;const jr=Br.length<Br.highWaterMark;return jr||(Br.needDrain=!0),Br.writing||Br.corked||Br.errored||!Br.constructed?(Br.buffered.push({chunk:Lr,encoding:xr,callback:_r}),Br.allBuffers&&xr!=="buffer"&&(Br.allBuffers=!1),Br.allNoop&&_r!==kr&&(Br.allNoop=!1)):(Br.writelen=Dr,Br.writecb=_r,Br.writing=!0,Br.sync=!0,Er._write(Lr,xr,Br.onwrite),Br.sync=!1),jr&&!Br.errored&&!Br.destroyed}function gr(Er,Br,Lr,xr,_r,Dr,jr){Br.writelen=xr,Br.writecb=jr,Br.writing=!0,Br.sync=!0,Br.destroyed?Br.onwrite(new dr("write")):Lr?Er._writev(_r,Br.onwrite):Er._write(_r,Dr,Br.onwrite),Br.sync=!1}function ar(Er,Br,Lr,xr){--Br.pendingcb,xr(Lr),br(Br),Nr(Er,Lr)}function nr(Er,Br){const Lr=Er._writableState,xr=Lr.sync,_r=Lr.writecb;if(typeof _r!="function"){Nr(Er,new Jt);return}Lr.writing=!1,Lr.writecb=null,Lr.length-=Lr.writelen,Lr.writelen=0,Br?(Br.stack,Lr.errored||(Lr.errored=Br),Er._readableState&&!Er._readableState.errored&&(Er._readableState.errored=Br),xr?$t.nextTick(ar,Er,Lr,Br,_r):ar(Er,Lr,Br,_r)):(Lr.buffered.length>Lr.bufferedIndex&&Sr(Er,Lr),xr?Lr.afterWriteTickInfo!==null&&Lr.afterWriteTickInfo.cb===_r?Lr.afterWriteTickInfo.count++:(Lr.afterWriteTickInfo={count:1,cb:_r,stream:Er,state:Lr},$t.nextTick(ur,Lr.afterWriteTickInfo)):pr(Er,Lr,1,_r))}function ur({stream:Er,state:Br,count:Lr,cb:xr}){return Br.afterWriteTickInfo=null,pr(Er,Br,Lr,xr)}function pr(Er,Br,Lr,xr){for(!Br.ending&&!Er.destroyed&&Br.length===0&&Br.needDrain&&(Br.needDrain=!1,Er.emit("drain"));Lr-- >0;)Br.pendingcb--,xr();Br.destroyed&&br(Br),Ar(Er,Br)}function br(Er){if(Er.writing)return;for(let _r=Er.bufferedIndex;_r<Er.buffered.length;++_r){var Br;const{chunk:Dr,callback:jr}=Er.buffered[_r],Hr=Er.objectMode?1:Dr.length;Er.length-=Hr,jr((Br=Er.errored)!==null&&Br!==void 0?Br:new dr("write"))}const Lr=Er[lr].splice(0);for(let _r=0;_r<Lr.length;_r++){var xr;Lr[_r]((xr=Er.errored)!==null&&xr!==void 0?xr:new dr("end"))}er(Er)}function Sr(Er,Br){if(Br.corked||Br.bufferProcessing||Br.destroyed||!Br.constructed)return;const{buffered:Lr,bufferedIndex:xr,objectMode:_r}=Br,Dr=Lr.length-xr;if(!Dr)return;let jr=xr;if(Br.bufferProcessing=!0,Dr>1&&Er._writev){Br.pendingcb-=Dr-1;const Hr=Br.allNoop?kr:Yr=>{for(let an=jr;an<Lr.length;++an)Lr[an].callback(Yr)},Qr=Br.allNoop&&jr===0?Lr:e(Lr,jr);Qr.allBuffers=Br.allBuffers,gr(Er,Br,!0,Br.length,Qr,"",Hr),er(Br)}else{do{const{chunk:Hr,encoding:Qr,callback:Yr}=Lr[jr];Lr[jr++]=null;const an=_r?1:Hr.length;gr(Er,Br,!1,an,Hr,Qr,Yr)}while(jr<Lr.length&&!Br.writing);jr===Lr.length?er(Br):jr>256?(Lr.splice(0,jr),Br.bufferedIndex=0):Br.bufferedIndex=jr}Br.bufferProcessing=!1}rr.prototype._write=function(Er,Br,Lr){if(this._writev)this._writev([{chunk:Er,encoding:Br}],Lr);else throw new Xt("_write()")},rr.prototype._writev=null,rr.prototype.end=function(Er,Br,Lr){const xr=this._writableState;typeof Er=="function"?(Lr=Er,Er=null,Br=null):typeof Br=="function"&&(Lr=Br,Br=null);let _r;if(Er!=null){const Dr=yr(this,Er,Br);Dr instanceof _t&&(_r=Dr)}return xr.corked&&(xr.corked=1,this.uncork()),_r||(!xr.errored&&!xr.ending?(xr.ending=!0,Ar(this,xr,!0),xr.ended=!0):xr.finished?_r=new vr("end"):xr.destroyed&&(_r=new dr("end"))),typeof Lr=="function"&&(_r||xr.finished?$t.nextTick(Lr,_r):xr[lr].push(Lr)),this};function Pr(Er){return Er.ending&&!Er.destroyed&&Er.constructed&&Er.length===0&&!Er.errored&&Er.buffered.length===0&&!Er.finished&&!Er.writing&&!Er.errorEmitted&&!Er.closeEmitted}function Tr(Er,Br){let Lr=!1;function xr(_r){if(Lr){Nr(Er,_r??Jt());return}if(Lr=!0,Br.pendingcb--,_r){const Dr=Br[lr].splice(0);for(let jr=0;jr<Dr.length;jr++)Dr[jr](_r);Nr(Er,_r,Br.sync)}else Pr(Br)&&(Br.prefinished=!0,Er.emit("prefinish"),Br.pendingcb++,$t.nextTick(Mr,Er,Br))}Br.sync=!0,Br.pendingcb++;try{Er._final(xr)}catch(_r){xr(_r)}Br.sync=!1}function wr(Er,Br){!Br.prefinished&&!Br.finalCalled&&(typeof Er._final=="function"&&!Br.destroyed?(Br.finalCalled=!0,Tr(Er,Br)):(Br.prefinished=!0,Er.emit("prefinish")))}function Ar(Er,Br,Lr){Pr(Br)&&(wr(Er,Br),Br.pendingcb===0&&(Lr?(Br.pendingcb++,$t.nextTick((xr,_r)=>{Pr(_r)?Mr(xr,_r):_r.pendingcb--},Er,Br)):Pr(Br)&&(Br.pendingcb++,Mr(Er,Br))))}function Mr(Er,Br){Br.pendingcb--,Br.finished=!0;const Lr=Br[lr].splice(0);for(let xr=0;xr<Lr.length;xr++)Lr[xr]();if(Er.emit("finish"),Br.autoDestroy){const xr=Er._readableState;(!xr||xr.autoDestroy&&(xr.endEmitted||xr.readable===!1))&&Er.destroy()}}kt(rr.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(Er){this._writableState&&(this._writableState.destroyed=Er)}},writable:{__proto__:null,get(){const Er=this._writableState;return!!Er&&Er.writable!==!1&&!Er.destroyed&&!Er.errored&&!Er.ending&&!Er.ended},set(Er){this._writableState&&(this._writableState.writable=!!Er)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const Er=this._writableState;return Er?!Er.destroyed&&!Er.ending&&Er.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Ur=zt.destroy;rr.prototype.destroy=function(Er,Br){const Lr=this._writableState;return!Lr.destroyed&&(Lr.bufferedIndex<Lr.buffered.length||Lr[lr].length)&&$t.nextTick(br,Lr),Ur.call(this,Er,Br),this},rr.prototype._undestroy=zt.undestroy,rr.prototype._destroy=function(Er,Br){Br(Er)},rr.prototype[jt.captureRejectionSymbol]=function(Er){this.destroy(Er)};let Or;function Cr(){return Or===void 0&&(Or={}),Or}return rr.fromWeb=function(Er,Br){return Cr().newStreamWritableFromWritableStream(Er,Br)},rr.toWeb=function(Er){return Cr().newWritableStreamFromStreamWritable(Er)},writable$1}var duplexify$1,hasRequiredDuplexify$1;function requireDuplexify$1(){if(hasRequiredDuplexify$1)return duplexify$1;hasRequiredDuplexify$1=1;const $t=browserExports$3,e=buffer$2,{isReadable:_t,isWritable:At,isIterable:xt,isNodeStream:kt,isReadableNodeStream:Bt,isWritableNodeStream:Nt,isDuplexNodeStream:Ut,isReadableStream:Lt,isWritableStream:jt}=utils$2,Kt=endOfStreamExports$1,{AbortError:qt,codes:{ERR_INVALID_ARG_TYPE:zt,ERR_INVALID_RETURN_VALUE:Vt}}=errors$2,{destroyer:Ht}=destroy_1$1,Wt=requireDuplex$1(),Qt=requireReadable$1(),Xt=requireWritable$1(),{createDeferredPromise:Jt}=utilExports$1,tr=from_1$1,dr=globalThis.Blob||e.Blob,vr=typeof dr<"u"?function(ir){return ir instanceof dr}:function(ir){return!1},$r=globalThis.AbortController||requireBrowser().AbortController,{FunctionPrototypeCall:Ir}=primordials$1;class Rr extends Wt{constructor(ir){super(ir),(ir==null?void 0:ir.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(ir==null?void 0:ir.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify$1=function lr(ir,er){if(Ut(ir))return ir;if(Bt(ir))return kr({readable:ir});if(Nt(ir))return kr({writable:ir});if(kt(ir))return kr({writable:!1,readable:!1});if(Lt(ir))return kr({readable:Qt.fromWeb(ir)});if(jt(ir))return kr({writable:Xt.fromWeb(ir)});if(typeof ir=="function"){const{value:yr,write:fr,final:gr,destroy:ar}=Nr(ir);if(xt(yr))return tr(Rr,yr,{objectMode:!0,write:fr,final:gr,destroy:ar});const nr=yr==null?void 0:yr.then;if(typeof nr=="function"){let ur;const pr=Ir(nr,yr,br=>{if(br!=null)throw new Vt("nully","body",br)},br=>{Ht(ur,br)});return ur=new Rr({objectMode:!0,readable:!1,write:fr,final(br){gr(async()=>{try{await pr,$t.nextTick(br,null)}catch(Sr){$t.nextTick(br,Sr)}})},destroy:ar})}throw new Vt("Iterable, AsyncIterable or AsyncFunction",er,yr)}if(vr(ir))return lr(ir.arrayBuffer());if(xt(ir))return tr(Rr,ir,{objectMode:!0,writable:!1});if(Lt(ir==null?void 0:ir.readable)&&jt(ir==null?void 0:ir.writable))return Rr.fromWeb(ir);if(typeof(ir==null?void 0:ir.writable)=="object"||typeof(ir==null?void 0:ir.readable)=="object"){const yr=ir!=null&&ir.readable?Bt(ir==null?void 0:ir.readable)?ir==null?void 0:ir.readable:lr(ir.readable):void 0,fr=ir!=null&&ir.writable?Nt(ir==null?void 0:ir.writable)?ir==null?void 0:ir.writable:lr(ir.writable):void 0;return kr({readable:yr,writable:fr})}const rr=ir==null?void 0:ir.then;if(typeof rr=="function"){let yr;return Ir(rr,ir,fr=>{fr!=null&&yr.push(fr),yr.push(null)},fr=>{Ht(yr,fr)}),yr=new Rr({objectMode:!0,writable:!1,read(){}})}throw new zt(er,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],ir)};function Nr(lr){let{promise:ir,resolve:er}=Jt();const rr=new $r,yr=rr.signal;return{value:lr(async function*(){for(;;){const gr=ir;ir=null;const{chunk:ar,done:nr,cb:ur}=await gr;if($t.nextTick(ur),nr)return;if(yr.aborted)throw new qt(void 0,{cause:yr.reason});({promise:ir,resolve:er}=Jt()),yield ar}}(),{signal:yr}),write(gr,ar,nr){const ur=er;er=null,ur({chunk:gr,done:!1,cb:nr})},final(gr){const ar=er;er=null,ar({done:!0,cb:gr})},destroy(gr,ar){rr.abort(),ar(gr)}}}function kr(lr){const ir=lr.readable&&typeof lr.readable.read!="function"?Qt.wrap(lr.readable):lr.readable,er=lr.writable;let rr=!!_t(ir),yr=!!At(er),fr,gr,ar,nr,ur;function pr(br){const Sr=nr;nr=null,Sr?Sr(br):br&&ur.destroy(br)}return ur=new Rr({readableObjectMode:!!(ir!=null&&ir.readableObjectMode),writableObjectMode:!!(er!=null&&er.writableObjectMode),readable:rr,writable:yr}),yr&&(Kt(er,br=>{yr=!1,br&&Ht(ir,br),pr(br)}),ur._write=function(br,Sr,Pr){er.write(br,Sr)?Pr():fr=Pr},ur._final=function(br){er.end(),gr=br},er.on("drain",function(){if(fr){const br=fr;fr=null,br()}}),er.on("finish",function(){if(gr){const br=gr;gr=null,br()}})),rr&&(Kt(ir,br=>{rr=!1,br&&Ht(ir,br),pr(br)}),ir.on("readable",function(){if(ar){const br=ar;ar=null,br()}}),ir.on("end",function(){ur.push(null)}),ur._read=function(){for(;;){const br=ir.read();if(br===null){ar=ur._read;return}if(!ur.push(br))return}}),ur._destroy=function(br,Sr){!br&&nr!==null&&(br=new qt),ar=null,fr=null,gr=null,nr===null?Sr(br):(nr=Sr,Ht(er,br),Ht(ir,br))},ur}return duplexify$1}var duplex$1,hasRequiredDuplex$1;function requireDuplex$1(){if(hasRequiredDuplex$1)return duplex$1;hasRequiredDuplex$1=1;const{ObjectDefineProperties:$t,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:_t,ObjectSetPrototypeOf:At}=primordials$1;duplex$1=Bt;const xt=requireReadable$1(),kt=requireWritable$1();At(Bt.prototype,xt.prototype),At(Bt,xt);{const jt=_t(kt.prototype);for(let Kt=0;Kt<jt.length;Kt++){const qt=jt[Kt];Bt.prototype[qt]||(Bt.prototype[qt]=kt.prototype[qt])}}function Bt(jt){if(!(this instanceof Bt))return new Bt(jt);xt.call(this,jt),kt.call(this,jt),jt?(this.allowHalfOpen=jt.allowHalfOpen!==!1,jt.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),jt.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}$t(Bt.prototype,{writable:{__proto__:null,...e(kt.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(kt.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(kt.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(kt.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(kt.prototype,"writableLength")},writableFinished:{__proto__:null,...e(kt.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(kt.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(kt.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(kt.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(jt){this._readableState&&this._writableState&&(this._readableState.destroyed=jt,this._writableState.destroyed=jt)}}});let Nt;function Ut(){return Nt===void 0&&(Nt={}),Nt}Bt.fromWeb=function(jt,Kt){return Ut().newStreamDuplexFromReadableWritablePair(jt,Kt)},Bt.toWeb=function(jt){return Ut().newReadableWritablePairFromDuplex(jt)};let Lt;return Bt.from=function(jt){return Lt||(Lt=requireDuplexify$1()),Lt(jt,"body")},duplex$1}const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$4,Symbol:Symbol$6}=primordials$1;var transform$1=Transform$3;const{ERR_METHOD_NOT_IMPLEMENTED:ERR_METHOD_NOT_IMPLEMENTED$1}=errors$2.codes,Duplex$5=requireDuplex$1(),{getHighWaterMark:getHighWaterMark$2}=state$1;ObjectSetPrototypeOf$4(Transform$3.prototype,Duplex$5.prototype);ObjectSetPrototypeOf$4(Transform$3,Duplex$5);const kCallback$3=Symbol$6("kCallback");function Transform$3($t){if(!(this instanceof Transform$3))return new Transform$3($t);const e=$t?getHighWaterMark$2(this,$t,"readableHighWaterMark",!0):null;e===0&&($t={...$t,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:$t.writableHighWaterMark||0}),Duplex$5.call(this,$t),this._readableState.sync=!1,this[kCallback$3]=null,$t&&(typeof $t.transform=="function"&&(this._transform=$t.transform),typeof $t.flush=="function"&&(this._flush=$t.flush)),this.on("prefinish",prefinish$1)}function final$1($t){typeof this._flush=="function"&&!this.destroyed?this._flush((e,_t)=>{if(e){$t?$t(e):this.destroy(e);return}_t!=null&&this.push(_t),this.push(null),$t&&$t()}):(this.push(null),$t&&$t())}function prefinish$1(){this._final!==final$1&&final$1.call(this)}Transform$3.prototype._final=final$1;Transform$3.prototype._transform=function($t,e,_t){throw new ERR_METHOD_NOT_IMPLEMENTED$1("_transform()")};Transform$3.prototype._write=function($t,e,_t){const At=this._readableState,xt=this._writableState,kt=At.length;this._transform($t,e,(Bt,Nt)=>{if(Bt){_t(Bt);return}Nt!=null&&this.push(Nt),xt.ended||kt===At.length||At.length<At.highWaterMark?_t():this[kCallback$3]=_t})};Transform$3.prototype._read=function(){if(this[kCallback$3]){const $t=this[kCallback$3];this[kCallback$3]=null,$t()}};const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$3}=primordials$1;var passthrough$1=PassThrough$3;const Transform$2=transform$1;ObjectSetPrototypeOf$3(PassThrough$3.prototype,Transform$2.prototype);ObjectSetPrototypeOf$3(PassThrough$3,Transform$2);function PassThrough$3($t){if(!(this instanceof PassThrough$3))return new PassThrough$3($t);Transform$2.call(this,$t)}PassThrough$3.prototype._transform=function($t,e,_t){_t(null,$t)};const process$4=browserExports$3,{ArrayIsArray:ArrayIsArray$3,Promise:Promise$5,SymbolAsyncIterator:SymbolAsyncIterator$3,SymbolDispose}=primordials$1,eos$4=endOfStreamExports$1,{once:once$2}=utilExports$1,destroyImpl$1=destroy_1$1,Duplex$4=requireDuplex$1(),{aggregateTwoErrors:aggregateTwoErrors$3,codes:{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$7,ERR_INVALID_RETURN_VALUE:ERR_INVALID_RETURN_VALUE$1,ERR_MISSING_ARGS:ERR_MISSING_ARGS$5,ERR_STREAM_DESTROYED:ERR_STREAM_DESTROYED$1,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$2},AbortError:AbortError$b}=errors$2,{validateFunction:validateFunction$4,validateAbortSignal:validateAbortSignal$5}=validators$1,{isIterable:isIterable$3,isReadable:isReadable$5,isReadableNodeStream:isReadableNodeStream$3,isNodeStream:isNodeStream$7,isTransformStream:isTransformStream$4,isWebStream:isWebStream$4,isReadableStream:isReadableStream$5,isReadableFinished:isReadableFinished$2}=utils$2,AbortController$3=globalThis.AbortController||requireBrowser().AbortController;let PassThrough$2,Readable$1,addAbortListener;function destroyer$4($t,e,_t){let At=!1;$t.on("close",()=>{At=!0});const xt=eos$4($t,{readable:e,writable:_t},kt=>{At=!kt});return{destroy:kt=>{At||(At=!0,destroyImpl$1.destroyer($t,kt||new ERR_STREAM_DESTROYED$1("pipe")))},cleanup:xt}}function popCallback$1($t){return validateFunction$4($t[$t.length-1],"streams[stream.length - 1]"),$t.pop()}function makeAsyncIterable$1($t){if(isIterable$3($t))return $t;if(isReadableNodeStream$3($t))return fromReadable$1($t);throw new ERR_INVALID_ARG_TYPE$7("val",["Readable","Iterable","AsyncIterable"],$t)}async function*fromReadable$1($t){Readable$1||(Readable$1=requireReadable$1()),yield*Readable$1.prototype[SymbolAsyncIterator$3].call($t)}async function pumpToNode$1($t,e,_t,{end:At}){let xt,kt=null;const Bt=Lt=>{if(Lt&&(xt=Lt),kt){const jt=kt;kt=null,jt()}},Nt=()=>new Promise$5((Lt,jt)=>{xt?jt(xt):kt=()=>{xt?jt(xt):Lt()}});e.on("drain",Bt);const Ut=eos$4(e,{readable:!1},Bt);try{e.writableNeedDrain&&await Nt();for await(const Lt of $t)e.write(Lt)||await Nt();At&&(e.end(),await Nt()),_t()}catch(Lt){_t(xt!==Lt?aggregateTwoErrors$3(xt,Lt):Lt)}finally{Ut(),e.off("drain",Bt)}}async function pumpToWeb$1($t,e,_t,{end:At}){isTransformStream$4(e)&&(e=e.writable);const xt=e.getWriter();try{for await(const kt of $t)await xt.ready,xt.write(kt).catch(()=>{});await xt.ready,At&&await xt.close(),_t()}catch(kt){try{await xt.abort(kt),_t(kt)}catch(Bt){_t(Bt)}}}function pipeline$3(...$t){return pipelineImpl$1($t,once$2(popCallback$1($t)))}function pipelineImpl$1($t,e,_t){if($t.length===1&&ArrayIsArray$3($t[0])&&($t=$t[0]),$t.length<2)throw new ERR_MISSING_ARGS$5("streams");const At=new AbortController$3,xt=At.signal,kt=_t==null?void 0:_t.signal,Bt=[];validateAbortSignal$5(kt,"options.signal");function Nt(){Vt(new AbortError$b)}addAbortListener=addAbortListener||utilExports$1.addAbortListener;let Ut;kt&&(Ut=addAbortListener(kt,Nt));let Lt,jt;const Kt=[];let qt=0;function zt(Xt){Vt(Xt,--qt===0)}function Vt(Xt,Jt){var tr;if(Xt&&(!Lt||Lt.code==="ERR_STREAM_PREMATURE_CLOSE")&&(Lt=Xt),!(!Lt&&!Jt)){for(;Kt.length;)Kt.shift()(Lt);(tr=Ut)===null||tr===void 0||tr[SymbolDispose](),At.abort(),Jt&&(Lt||Bt.forEach(dr=>dr()),process$4.nextTick(e,Lt,jt))}}let Ht;for(let Xt=0;Xt<$t.length;Xt++){const Jt=$t[Xt],tr=Xt<$t.length-1,dr=Xt>0,vr=tr||(_t==null?void 0:_t.end)!==!1,$r=Xt===$t.length-1;if(isNodeStream$7(Jt)){let Ir=function(Rr){Rr&&Rr.name!=="AbortError"&&Rr.code!=="ERR_STREAM_PREMATURE_CLOSE"&&zt(Rr)};if(vr){const{destroy:Rr,cleanup:Nr}=destroyer$4(Jt,tr,dr);Kt.push(Rr),isReadable$5(Jt)&&$r&&Bt.push(Nr)}Jt.on("error",Ir),isReadable$5(Jt)&&$r&&Bt.push(()=>{Jt.removeListener("error",Ir)})}if(Xt===0)if(typeof Jt=="function"){if(Ht=Jt({signal:xt}),!isIterable$3(Ht))throw new ERR_INVALID_RETURN_VALUE$1("Iterable, AsyncIterable or Stream","source",Ht)}else isIterable$3(Jt)||isReadableNodeStream$3(Jt)||isTransformStream$4(Jt)?Ht=Jt:Ht=Duplex$4.from(Jt);else if(typeof Jt=="function"){if(isTransformStream$4(Ht)){var Wt;Ht=makeAsyncIterable$1((Wt=Ht)===null||Wt===void 0?void 0:Wt.readable)}else Ht=makeAsyncIterable$1(Ht);if(Ht=Jt(Ht,{signal:xt}),tr){if(!isIterable$3(Ht,!0))throw new ERR_INVALID_RETURN_VALUE$1("AsyncIterable",`transform[${Xt-1}]`,Ht)}else{var Qt;PassThrough$2||(PassThrough$2=passthrough$1);const Ir=new PassThrough$2({objectMode:!0}),Rr=(Qt=Ht)===null||Qt===void 0?void 0:Qt.then;if(typeof Rr=="function")qt++,Rr.call(Ht,lr=>{jt=lr,lr!=null&&Ir.write(lr),vr&&Ir.end(),process$4.nextTick(zt)},lr=>{Ir.destroy(lr),process$4.nextTick(zt,lr)});else if(isIterable$3(Ht,!0))qt++,pumpToNode$1(Ht,Ir,zt,{end:vr});else if(isReadableStream$5(Ht)||isTransformStream$4(Ht)){const lr=Ht.readable||Ht;qt++,pumpToNode$1(lr,Ir,zt,{end:vr})}else throw new ERR_INVALID_RETURN_VALUE$1("AsyncIterable or Promise","destination",Ht);Ht=Ir;const{destroy:Nr,cleanup:kr}=destroyer$4(Ht,!1,!0);Kt.push(Nr),$r&&Bt.push(kr)}}else if(isNodeStream$7(Jt)){if(isReadableNodeStream$3(Ht)){qt+=2;const Ir=pipe$2(Ht,Jt,zt,{end:vr});isReadable$5(Jt)&&$r&&Bt.push(Ir)}else if(isTransformStream$4(Ht)||isReadableStream$5(Ht)){const Ir=Ht.readable||Ht;qt++,pumpToNode$1(Ir,Jt,zt,{end:vr})}else if(isIterable$3(Ht))qt++,pumpToNode$1(Ht,Jt,zt,{end:vr});else throw new ERR_INVALID_ARG_TYPE$7("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ht);Ht=Jt}else if(isWebStream$4(Jt)){if(isReadableNodeStream$3(Ht))qt++,pumpToWeb$1(makeAsyncIterable$1(Ht),Jt,zt,{end:vr});else if(isReadableStream$5(Ht)||isIterable$3(Ht))qt++,pumpToWeb$1(Ht,Jt,zt,{end:vr});else if(isTransformStream$4(Ht))qt++,pumpToWeb$1(Ht.readable,Jt,zt,{end:vr});else throw new ERR_INVALID_ARG_TYPE$7("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ht);Ht=Jt}else Ht=Duplex$4.from(Jt)}return(xt!=null&&xt.aborted||kt!=null&&kt.aborted)&&process$4.nextTick(Nt),Ht}function pipe$2($t,e,_t,{end:At}){let xt=!1;if(e.on("close",()=>{xt||_t(new ERR_STREAM_PREMATURE_CLOSE$2)}),$t.pipe(e,{end:!1}),At){let kt=function(){xt=!0,e.end()};isReadableFinished$2($t)?process$4.nextTick(kt):$t.once("end",kt)}else _t();return eos$4($t,{readable:!0,writable:!1},kt=>{const Bt=$t._readableState;kt&&kt.code==="ERR_STREAM_PREMATURE_CLOSE"&&Bt&&Bt.ended&&!Bt.errored&&!Bt.errorEmitted?$t.once("end",_t).once("error",_t):_t(kt)}),eos$4(e,{readable:!1,writable:!0},_t)}var pipeline_1$1={pipelineImpl:pipelineImpl$1,pipeline:pipeline$3};const{pipeline:pipeline$2}=pipeline_1$1,Duplex$3=requireDuplex$1(),{destroyer:destroyer$3}=destroy_1$1,{isNodeStream:isNodeStream$6,isReadable:isReadable$4,isWritable:isWritable$5,isWebStream:isWebStream$3,isTransformStream:isTransformStream$3,isWritableStream:isWritableStream$3,isReadableStream:isReadableStream$4}=utils$2,{AbortError:AbortError$a,codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$5,ERR_MISSING_ARGS:ERR_MISSING_ARGS$4}}=errors$2,eos$3=endOfStreamExports$1;var compose$3=function $t(...e){if(e.length===0)throw new ERR_MISSING_ARGS$4("streams");if(e.length===1)return Duplex$3.from(e[0]);const _t=[...e];if(typeof e[0]=="function"&&(e[0]=Duplex$3.from(e[0])),typeof e[e.length-1]=="function"){const zt=e.length-1;e[zt]=Duplex$3.from(e[zt])}for(let zt=0;zt<e.length;++zt)if(!(!isNodeStream$6(e[zt])&&!isWebStream$3(e[zt]))){if(zt<e.length-1&&!(isReadable$4(e[zt])||isReadableStream$4(e[zt])||isTransformStream$3(e[zt])))throw new ERR_INVALID_ARG_VALUE$5(`streams[${zt}]`,_t[zt],"must be readable");if(zt>0&&!(isWritable$5(e[zt])||isWritableStream$3(e[zt])||isTransformStream$3(e[zt])))throw new ERR_INVALID_ARG_VALUE$5(`streams[${zt}]`,_t[zt],"must be writable")}let At,xt,kt,Bt,Nt;function Ut(zt){const Vt=Bt;Bt=null,Vt?Vt(zt):zt?Nt.destroy(zt):!qt&&!Kt&&Nt.destroy()}const Lt=e[0],jt=pipeline$2(e,Ut),Kt=!!(isWritable$5(Lt)||isWritableStream$3(Lt)||isTransformStream$3(Lt)),qt=!!(isReadable$4(jt)||isReadableStream$4(jt)||isTransformStream$3(jt));if(Nt=new Duplex$3({writableObjectMode:!!(Lt!=null&&Lt.writableObjectMode),readableObjectMode:!!(jt!=null&&jt.readableObjectMode),writable:Kt,readable:qt}),Kt){if(isNodeStream$6(Lt))Nt._write=function(Vt,Ht,Wt){Lt.write(Vt,Ht)?Wt():At=Wt},Nt._final=function(Vt){Lt.end(),xt=Vt},Lt.on("drain",function(){if(At){const Vt=At;At=null,Vt()}});else if(isWebStream$3(Lt)){const Ht=(isTransformStream$3(Lt)?Lt.writable:Lt).getWriter();Nt._write=async function(Wt,Qt,Xt){try{await Ht.ready,Ht.write(Wt).catch(()=>{}),Xt()}catch(Jt){Xt(Jt)}},Nt._final=async function(Wt){try{await Ht.ready,Ht.close().catch(()=>{}),xt=Wt}catch(Qt){Wt(Qt)}}}const zt=isTransformStream$3(jt)?jt.readable:jt;eos$3(zt,()=>{if(xt){const Vt=xt;xt=null,Vt()}})}if(qt){if(isNodeStream$6(jt))jt.on("readable",function(){if(kt){const zt=kt;kt=null,zt()}}),jt.on("end",function(){Nt.push(null)}),Nt._read=function(){for(;;){const zt=jt.read();if(zt===null){kt=Nt._read;return}if(!Nt.push(zt))return}};else if(isWebStream$3(jt)){const Vt=(isTransformStream$3(jt)?jt.readable:jt).getReader();Nt._read=async function(){for(;;)try{const{value:Ht,done:Wt}=await Vt.read();if(!Nt.push(Ht))return;if(Wt){Nt.push(null);return}}catch{return}}}}return Nt._destroy=function(zt,Vt){!zt&&Bt!==null&&(zt=new AbortError$a),kt=null,At=null,xt=null,Bt===null?Vt(zt):(Bt=Vt,isNodeStream$6(jt)&&destroyer$3(jt,zt))},Nt};const AbortController$2=globalThis.AbortController||requireBrowser().AbortController,{codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$4,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$6,ERR_MISSING_ARGS:ERR_MISSING_ARGS$3,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$2},AbortError:AbortError$9}=errors$2,{validateAbortSignal:validateAbortSignal$4,validateInteger:validateInteger$2,validateObject:validateObject$4}=validators$1,kWeakHandler$1=primordials$1.Symbol("kWeak"),kResistStopPropagation=primordials$1.Symbol("kResistStopPropagation"),{finished:finished$2}=endOfStreamExports$1,staticCompose$1=compose$3,{addAbortSignalNoValidate:addAbortSignalNoValidate$1}=addAbortSignalExports$1,{isWritable:isWritable$4,isNodeStream:isNodeStream$5}=utils$2,{deprecate}=utilExports$1,{ArrayPrototypePush:ArrayPrototypePush$1,Boolean:Boolean$1,MathFloor:MathFloor$2,Number:Number$2,NumberIsNaN:NumberIsNaN$2,Promise:Promise$4,PromiseReject:PromiseReject$1,PromiseResolve,PromisePrototypeThen:PromisePrototypeThen$3,Symbol:Symbol$5}=primordials$1,kEmpty$1=Symbol$5("kEmpty"),kEof$1=Symbol$5("kEof");function compose$2($t,e){if(e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal"),isNodeStream$5($t)&&!isWritable$4($t))throw new ERR_INVALID_ARG_VALUE$4("stream",$t,"must be writable");const _t=staticCompose$1(this,$t);return e!=null&&e.signal&&addAbortSignalNoValidate$1(e.signal,_t),_t}function map$2($t,e){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],$t);e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal");let _t=1;(e==null?void 0:e.concurrency)!=null&&(_t=MathFloor$2(e.concurrency));let At=_t-1;return(e==null?void 0:e.highWaterMark)!=null&&(At=MathFloor$2(e.highWaterMark)),validateInteger$2(_t,"options.concurrency",1),validateInteger$2(At,"options.highWaterMark",0),At+=_t,(async function*(){const kt=utilExports$1.AbortSignalAny([e==null?void 0:e.signal].filter(Boolean$1)),Bt=this,Nt=[],Ut={signal:kt};let Lt,jt,Kt=!1,qt=0;function zt(){Kt=!0,Vt()}function Vt(){qt-=1,Ht()}function Ht(){jt&&!Kt&&qt<_t&&Nt.length<At&&(jt(),jt=null)}async function Wt(){try{for await(let Qt of Bt){if(Kt)return;if(kt.aborted)throw new AbortError$9;try{if(Qt=$t(Qt,Ut),Qt===kEmpty$1)continue;Qt=PromiseResolve(Qt)}catch(Xt){Qt=PromiseReject$1(Xt)}qt+=1,PromisePrototypeThen$3(Qt,Vt,zt),Nt.push(Qt),Lt&&(Lt(),Lt=null),!Kt&&(Nt.length>=At||qt>=_t)&&await new Promise$4(Xt=>{jt=Xt})}Nt.push(kEof$1)}catch(Qt){const Xt=PromiseReject$1(Qt);PromisePrototypeThen$3(Xt,Vt,zt),Nt.push(Xt)}finally{Kt=!0,Lt&&(Lt(),Lt=null)}}Wt();try{for(;;){for(;Nt.length>0;){const Qt=await Nt[0];if(Qt===kEof$1)return;if(kt.aborted)throw new AbortError$9;Qt!==kEmpty$1&&(yield Qt),Nt.shift(),Ht()}await new Promise$4(Qt=>{Lt=Qt})}}finally{Kt=!0,jt&&(jt(),jt=null)}}).call(this)}function asIndexedPairs$1($t=void 0){return $t!=null&&validateObject$4($t,"options"),($t==null?void 0:$t.signal)!=null&&validateAbortSignal$4($t.signal,"options.signal"),(async function*(){let _t=0;for await(const xt of this){var At;if($t!=null&&(At=$t.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$9({cause:$t.signal.reason});yield[_t++,xt]}}).call(this)}async function some$1($t,e=void 0){for await(const _t of filter$2.call(this,$t,e))return!0;return!1}async function every$1($t,e=void 0){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],$t);return!await some$1.call(this,async(..._t)=>!await $t(..._t),e)}async function find$1($t,e){for await(const _t of filter$2.call(this,$t,e))return _t}async function forEach$1($t,e){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],$t);async function _t(At,xt){return await $t(At,xt),kEmpty$1}for await(const At of map$2.call(this,_t,e));}function filter$2($t,e){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],$t);async function _t(At,xt){return await $t(At,xt)?At:kEmpty$1}return map$2.call(this,_t,e)}let ReduceAwareErrMissingArgs$1=class extends ERR_MISSING_ARGS$3{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function reduce$1($t,e,_t){var At;if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$6("reducer",["Function","AsyncFunction"],$t);_t!=null&&validateObject$4(_t,"options"),(_t==null?void 0:_t.signal)!=null&&validateAbortSignal$4(_t.signal,"options.signal");let xt=arguments.length>1;if(_t!=null&&(At=_t.signal)!==null&&At!==void 0&&At.aborted){const Lt=new AbortError$9(void 0,{cause:_t.signal.reason});throw this.once("error",()=>{}),await finished$2(this.destroy(Lt)),Lt}const kt=new AbortController$2,Bt=kt.signal;if(_t!=null&&_t.signal){const Lt={once:!0,[kWeakHandler$1]:this,[kResistStopPropagation]:!0};_t.signal.addEventListener("abort",()=>kt.abort(),Lt)}let Nt=!1;try{for await(const Lt of this){var Ut;if(Nt=!0,_t!=null&&(Ut=_t.signal)!==null&&Ut!==void 0&&Ut.aborted)throw new AbortError$9;xt?e=await $t(e,Lt,{signal:Bt}):(e=Lt,xt=!0)}if(!Nt&&!xt)throw new ReduceAwareErrMissingArgs$1}finally{kt.abort()}return e}async function toArray$1($t){$t!=null&&validateObject$4($t,"options"),($t==null?void 0:$t.signal)!=null&&validateAbortSignal$4($t.signal,"options.signal");const e=[];for await(const At of this){var _t;if($t!=null&&(_t=$t.signal)!==null&&_t!==void 0&&_t.aborted)throw new AbortError$9(void 0,{cause:$t.signal.reason});ArrayPrototypePush$1(e,At)}return e}function flatMap$1($t,e){const _t=map$2.call(this,$t,e);return(async function*(){for await(const xt of _t)yield*xt}).call(this)}function toIntegerOrInfinity$1($t){if($t=Number$2($t),NumberIsNaN$2($t))return 0;if($t<0)throw new ERR_OUT_OF_RANGE$2("number",">= 0",$t);return $t}function drop$1($t,e=void 0){return e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal"),$t=toIntegerOrInfinity$1($t),(async function*(){var At;if(e!=null&&(At=e.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$9;for await(const kt of this){var xt;if(e!=null&&(xt=e.signal)!==null&&xt!==void 0&&xt.aborted)throw new AbortError$9;$t--<=0&&(yield kt)}}).call(this)}function take$1($t,e=void 0){return e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal"),$t=toIntegerOrInfinity$1($t),(async function*(){var At;if(e!=null&&(At=e.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$9;for await(const kt of this){var xt;if(e!=null&&(xt=e.signal)!==null&&xt!==void 0&&xt.aborted)throw new AbortError$9;if($t-- >0&&(yield kt),$t<=0)return}}).call(this)}operators$1.streamReturningOperators={asIndexedPairs:deprecate(asIndexedPairs$1,"readable.asIndexedPairs will be removed in a future version."),drop:drop$1,filter:filter$2,flatMap:flatMap$1,map:map$2,take:take$1,compose:compose$2};operators$1.promiseReturningOperators={every:every$1,forEach:forEach$1,reduce:reduce$1,toArray:toArray$1,some:some$1,find:find$1};var promises$1,hasRequiredPromises$1;function requirePromises$1(){if(hasRequiredPromises$1)return promises$1;hasRequiredPromises$1=1;const{ArrayPrototypePop:$t,Promise:e}=primordials$1,{isIterable:_t,isNodeStream:At,isWebStream:xt}=utils$2,{pipelineImpl:kt}=pipeline_1$1,{finished:Bt}=endOfStreamExports$1;requireStream$1();function Nt(...Ut){return new e((Lt,jt)=>{let Kt,qt;const zt=Ut[Ut.length-1];if(zt&&typeof zt=="object"&&!At(zt)&&!_t(zt)&&!xt(zt)){const Vt=$t(Ut);Kt=Vt.signal,qt=Vt.end}kt(Ut,(Vt,Ht)=>{Vt?jt(Vt):Lt(Ht)},{signal:Kt,end:qt})})}return promises$1={finished:Bt,pipeline:Nt},promises$1}var hasRequiredStream$1;function requireStream$1(){if(hasRequiredStream$1)return stream$1.exports;hasRequiredStream$1=1;const{Buffer:$t}=buffer$2,{ObjectDefineProperty:e,ObjectKeys:_t,ReflectApply:At}=primordials$1,{promisify:{custom:xt}}=utilExports$1,{streamReturningOperators:kt,promiseReturningOperators:Bt}=operators$1,{codes:{ERR_ILLEGAL_CONSTRUCTOR:Nt}}=errors$2,Ut=compose$3,{setDefaultHighWaterMark:Lt,getDefaultHighWaterMark:jt}=state$1,{pipeline:Kt}=pipeline_1$1,{destroyer:qt}=destroy_1$1,zt=endOfStreamExports$1,Vt=requirePromises$1(),Ht=utils$2,Wt=stream$1.exports=legacy$1.Stream;Wt.isDestroyed=Ht.isDestroyed,Wt.isDisturbed=Ht.isDisturbed,Wt.isErrored=Ht.isErrored,Wt.isReadable=Ht.isReadable,Wt.isWritable=Ht.isWritable,Wt.Readable=requireReadable$1();for(const Xt of _t(kt)){let tr=function(...dr){if(new.target)throw Nt();return Wt.Readable.from(At(Jt,this,dr))};const Jt=kt[Xt];e(tr,"name",{__proto__:null,value:Jt.name}),e(tr,"length",{__proto__:null,value:Jt.length}),e(Wt.Readable.prototype,Xt,{__proto__:null,value:tr,enumerable:!1,configurable:!0,writable:!0})}for(const Xt of _t(Bt)){let tr=function(...dr){if(new.target)throw Nt();return At(Jt,this,dr)};const Jt=Bt[Xt];e(tr,"name",{__proto__:null,value:Jt.name}),e(tr,"length",{__proto__:null,value:Jt.length}),e(Wt.Readable.prototype,Xt,{__proto__:null,value:tr,enumerable:!1,configurable:!0,writable:!0})}Wt.Writable=requireWritable$1(),Wt.Duplex=requireDuplex$1(),Wt.Transform=transform$1,Wt.PassThrough=passthrough$1,Wt.pipeline=Kt;const{addAbortSignal:Qt}=addAbortSignalExports$1;return Wt.addAbortSignal=Qt,Wt.finished=zt,Wt.destroy=qt,Wt.compose=Ut,Wt.setDefaultHighWaterMark=Lt,Wt.getDefaultHighWaterMark=jt,e(Wt,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return Vt}}),e(Kt,xt,{__proto__:null,enumerable:!0,get(){return Vt.pipeline}}),e(zt,xt,{__proto__:null,enumerable:!0,get(){return Vt.finished}}),Wt.Stream=Wt,Wt._isUint8Array=function(Jt){return Jt instanceof Uint8Array},Wt._uint8ArrayToBuffer=function(Jt){return $t.from(Jt.buffer,Jt.byteOffset,Jt.byteLength)},stream$1.exports}(function($t){const e=requireStream$1(),_t=requirePromises$1(),At=e.Readable.destroy;$t.exports=e.Readable,$t.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,$t.exports._isUint8Array=e._isUint8Array,$t.exports.isDisturbed=e.isDisturbed,$t.exports.isErrored=e.isErrored,$t.exports.isReadable=e.isReadable,$t.exports.Readable=e.Readable,$t.exports.Writable=e.Writable,$t.exports.Duplex=e.Duplex,$t.exports.Transform=e.Transform,$t.exports.PassThrough=e.PassThrough,$t.exports.addAbortSignal=e.addAbortSignal,$t.exports.finished=e.finished,$t.exports.destroy=e.destroy,$t.exports.destroy=At,$t.exports.pipeline=e.pipeline,$t.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return _t}}),$t.exports.Stream=e.Stream,$t.exports.default=$t.exports})(browser$2);var browserExports$1=browser$2.exports,__awaiter$2z=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};dist.ECIES_CONFIG.isEphemeralKeyCompressed=!0;class Encryption{static aes256CtrEncrypt(e,_t,At){return __awaiter$2z(this,void 0,void 0,function*(){const xt=cryptoBrowserifyExports.createCipheriv("aes-256-ctr",e,_t),kt=new browserExports$1.Readable({read(){}});return At.on("data",Bt=>{const Nt=xt.update(Bt);kt.push(Nt)}),At.on("end",()=>{const Bt=xt.final();kt.push(Bt),kt.push(null)}),At.on("error",Bt=>{kt.emit("error",Bt)}),kt})}static aes256CtrDecrypt(e,_t,At){return __awaiter$2z(this,void 0,void 0,function*(){const xt=cryptoBrowserifyExports.createDecipheriv("aes-256-ctr",e,_t),kt=new browserExports$1.Readable({read(){}});return At.on("data",Bt=>{const Nt=xt.update(Bt);kt.push(Nt)}),At.on("end",()=>{const Bt=xt.final();kt.push(Bt),kt.push(null)}),At.on("error",Bt=>{kt.emit("error",Bt)}),kt})}static eciesSecp256k1Encrypt(e,_t){return __awaiter$2z(this,void 0,void 0,function*(){const At=buffer$2.Buffer.from(e),xt=buffer$2.Buffer.from(_t),kt=dist.encrypt(At,xt);let Bt=0,Nt=Encryption.isEphemeralKeyCompressed?33:65;const Ut=kt.subarray(Bt,Nt);Bt=Nt,Nt+=dist.ECIES_CONFIG.symmetricNonceLength;const Lt=kt.subarray(Bt,Nt);Bt=Nt,Nt+=16;const jt=kt.subarray(Bt,Nt);return{ciphertext:kt.subarray(Nt),ephemeralPublicKey:Ut,initializationVector:Lt,messageAuthenticationCode:jt}})}static eciesSecp256k1Decrypt(e){return __awaiter$2z(this,void 0,void 0,function*(){const _t=buffer$2.Buffer.from(e.privateKey),At=buffer$2.Buffer.concat([e.ephemeralPublicKey,e.initializationVector,e.messageAuthenticationCode,e.ciphertext]);return dist.decrypt(_t,At)})}static get isEphemeralKeyCompressed(){return dist.ECIES_CONFIG.isEphemeralKeyCompressed}}var EncryptionAlgorithm;(function($t){$t.Aes256Ctr="A256CTR",$t.EciesSecp256k1="ECIES-ES256K"})(EncryptionAlgorithm||(EncryptionAlgorithm={}));var __awaiter$2y=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class GeneralJwsBuilder{constructor(e){this.jws=e}static create(e,_t=[]){return __awaiter$2y(this,void 0,void 0,function*(){const At={payload:Encoder$4.bytesToBase64Url(e),signatures:[]},xt=new GeneralJwsBuilder(At);for(const kt of _t)yield xt.addSignature(kt);return xt})}addSignature(e){return __awaiter$2y(this,void 0,void 0,function*(){const _t={kid:e.keyId,alg:e.algorithm},At=JSON.stringify(_t),xt=Encoder$4.stringToBase64Url(At),kt=`${xt}.${this.jws.payload}`,Bt=Encoder$4.stringToBytes(kt),Nt=yield e.sign(Bt),Ut=Encoder$4.bytesToBase64Url(Nt);this.jws.signatures.push({protected:xt,signature:Ut})})}getJws(){return this.jws}}const cr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function getWebcryptoSubtle(){if(cr&&typeof cr.subtle=="object"&&cr.subtle!=null)return cr.subtle;throw new Error("crypto.subtle must be defined")}function number$1($t){if(!Number.isSafeInteger($t)||$t<0)throw new Error(`positive integer expected, not ${$t}`)}function bool($t){if(typeof $t!="boolean")throw new Error(`boolean expected, not ${$t}`)}function isBytes$6($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}function bytes$2($t,...e){if(!isBytes$6($t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes($t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${$t.length}`)}function exists$2($t,e=!0){if($t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&$t.finished)throw new Error("Hash#digest() has already been called")}function output$2($t,e){bytes$2($t);const _t=e.outputLen;if($t.length<_t)throw new Error(`digestInto() expects output buffer of length at least ${_t}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32$1=$t=>new Uint32Array($t.buffer,$t.byteOffset,Math.floor($t.byteLength/4)),createView$1=$t=>new DataView($t.buffer,$t.byteOffset,$t.byteLength),isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$3($t){if(typeof $t!="string")throw new Error(`string expected, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function toBytes$2($t){if(typeof $t=="string")$t=utf8ToBytes$3($t);else if(isBytes$6($t))$t=$t.slice();else throw new Error(`Uint8Array expected, got ${typeof $t}`);return $t}function checkOpts$1($t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign($t,e)}function equalBytes$1($t,e){if($t.length!==e.length)return!1;let _t=0;for(let At=0;At<$t.length;At++)_t|=$t[At]^e[At];return _t===0}const wrapCipher=($t,e)=>(Object.assign(e,$t),e);function setBigUint64$1($t,e,_t,At){if(typeof $t.setBigUint64=="function")return $t.setBigUint64(e,_t,At);const xt=BigInt(32),kt=BigInt(4294967295),Bt=Number(_t>>xt&kt),Nt=Number(_t&kt),Ut=4,Lt=0;$t.setUint32(e+Ut,Bt,At),$t.setUint32(e+Lt,Nt,At)}var __awaiter$2x=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},KeyDerivationScheme;(function($t){$t.DataFormats="dataFormats",$t.ProtocolContext="protocolContext",$t.ProtocolPath="protocolPath",$t.Schemas="schemas"})(KeyDerivationScheme||(KeyDerivationScheme={}));class HdKey{static derivePrivateKey(e,_t){var At;return __awaiter$2x(this,void 0,void 0,function*(){const xt=Secp256k1$3.privateJwkToBytes(e.derivedPrivateKey),kt=(At=e.derivationPath)!==null&&At!==void 0?At:[],Bt=yield HdKey.derivePrivateKeyBytes(xt,_t),Nt=yield Secp256k1$3.privateKeyToJwk(Bt);return{rootKeyId:e.rootKeyId,derivationScheme:e.derivationScheme,derivationPath:[...kt,..._t],derivedPrivateKey:Nt}})}static derivePublicKey(e,_t){return __awaiter$2x(this,void 0,void 0,function*(){const At=yield HdKey.derivePrivateKey(e,_t);return yield Secp256k1$3.getPublicJwk(At.derivedPrivateKey)})}static derivePrivateKeyBytes(e,_t){return __awaiter$2x(this,void 0,void 0,function*(){HdKey.validateKeyDerivationPath(_t);let At=e;for(const xt of _t){const kt=Encoder$4.stringToBytes(xt);At=yield HdKey.deriveKeyUsingHkdf({hashAlgorithm:"SHA-256",initialKeyMaterial:At,info:kt,keyLengthInBytes:32})}return At})}static deriveKeyUsingHkdf(e){return __awaiter$2x(this,void 0,void 0,function*(){const{hashAlgorithm:_t,initialKeyMaterial:At,info:xt,keyLengthInBytes:kt}=e,Nt=yield getWebcryptoSubtle().importKey("raw",At,{name:"HKDF"},!1,["deriveBits"]),Ut=yield crypto.subtle.deriveBits({name:"HKDF",hash:_t,salt:new Uint8Array(0),info:xt},Nt,kt*8);return new Uint8Array(Ut)})}static validateKeyDerivationPath(e){if(e.includes(""))throw new DwnError(DwnErrorCode.HdKeyDerivationPathInvalid,`Invalid key derivation path: ${e}`)}}function lexicographicalCompare($t,e){return $t>e?1:$t<e?-1:0}function isEmptyObject$1($t){if(typeof $t!="object")return!1;for(const e in $t)return!1;return!0}function removeUndefinedProperties$2($t){Object.keys($t).forEach(e=>{$t[e]===void 0?delete $t[e]:typeof $t[e]=="object"&&removeUndefinedProperties$2($t[e])})}var __awaiter$2w=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Message{static getAuthor(e){if(e.authorization===void 0)return;let _t;return e.authorization.authorDelegatedGrant!==void 0?_t=Message.getSigner(e.authorization.authorDelegatedGrant):_t=Message.getSigner(e),_t}static validateJsonSchema(e){const _t=e.descriptor.interface,At=e.descriptor.method,xt=_t+At;validateJsonSchema(xt,e)}static getSigner(e){return e.authorization===void 0?void 0:Jws.getSignerDid(e.authorization.signature.signatures[0])}static getCid(e){return __awaiter$2w(this,void 0,void 0,function*(){const _t=Object.assign({},e);return _t.encodedData&&delete _t.encodedData,yield Cid.computeCid(_t)})}static compareCid(e,_t){return __awaiter$2w(this,void 0,void 0,function*(){const At=yield Message.getCid(e),xt=yield Message.getCid(_t);return lexicographicalCompare(At,xt)})}static createAuthorization(e){return __awaiter$2w(this,void 0,void 0,function*(){const{descriptor:_t,signer:At,delegatedGrant:xt,permissionGrantId:kt,protocolRole:Bt}=e;let Nt;xt!==void 0&&(Nt=yield Message.getCid(xt));const Lt={signature:yield Message.createSignature(_t,At,{delegatedGrantId:Nt,permissionGrantId:kt,protocolRole:Bt})};return xt!==void 0&&(Lt.authorDelegatedGrant=xt),Lt})}static createSignature(e,_t,At){return __awaiter$2w(this,void 0,void 0,function*(){const xt=yield Cid.computeCid(e),kt=Object.assign({descriptorCid:xt},At);removeUndefinedProperties$2(kt);const Bt=Encoder$4.objectToBytes(kt);return(yield GeneralJwsBuilder.create(Bt,[_t])).getJws()})}static getNewestMessage(e){return __awaiter$2w(this,void 0,void 0,function*(){let _t;for(const At of e)(_t===void 0||(yield Message.isNewer(At,_t)))&&(_t=At);return _t})}static getOldestMessage(e){return __awaiter$2w(this,void 0,void 0,function*(){let _t;for(const At of e)(_t===void 0||(yield Message.isOlder(At,_t)))&&(_t=At);return _t})}static isNewer(e,_t){return __awaiter$2w(this,void 0,void 0,function*(){return(yield Message.compareMessageTimestamp(e,_t))>0})}static isOlder(e,_t){return __awaiter$2w(this,void 0,void 0,function*(){return(yield Message.compareMessageTimestamp(e,_t))<0})}static isSignedByAuthorDelegate(e){var _t;return((_t=e.authorization)===null||_t===void 0?void 0:_t.authorDelegatedGrant)!==void 0}static isSignedByOwnerDelegate(e){var _t;return((_t=e.authorization)===null||_t===void 0?void 0:_t.ownerDelegatedGrant)!==void 0}static compareMessageTimestamp(e,_t){return __awaiter$2w(this,void 0,void 0,function*(){return e.descriptor.messageTimestamp>_t.descriptor.messageTimestamp?1:e.descriptor.messageTimestamp<_t.descriptor.messageTimestamp?-1:Message.compareCid(e,_t)})}static validateSignatureStructure(e,_t,At="GenericSignaturePayload"){return __awaiter$2w(this,void 0,void 0,function*(){if(e.signatures.length!==1)throw new DwnError(DwnErrorCode.AuthenticationMoreThanOneSignatureNotSupported,"expected no more than 1 signature for authorization purpose");const xt=Jws.decodePlainObjectPayload(e);validateJsonSchema(At,xt);const{descriptorCid:kt}=xt,Bt=yield Cid.computeCid(_t);if(kt!==Bt)throw new DwnError(DwnErrorCode.AuthenticateDescriptorCidMismatch,`provided descriptorCid ${kt} does not match expected CID ${Bt}`);return xt})}}var __awaiter$2v=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let PermissionGrant$1=class Go{static parse(e){return __awaiter$2v(this,void 0,void 0,function*(){return new Go(e)})}constructor(e){this.id=e.recordId,this.grantor=Message.getSigner(e),this.grantee=e.descriptor.recipient,this.dateGranted=e.descriptor.dateCreated;const _t=e.encodedData,At=Encoder$4.base64UrlToObject(_t);this.dateExpires=At.dateExpires,this.delegated=At.delegated,this.description=At.description,this.requestId=At.requestId,this.scope=At.scope,this.conditions=At.conditions}};var DateSort;(function($t){$t.CreatedAscending="createdAscending",$t.CreatedDescending="createdDescending",$t.PublishedAscending="publishedAscending",$t.PublishedDescending="publishedDescending"})(DateSort||(DateSort={}));var __rest$z=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class FilterUtility{static matchAnyFilter(e,_t){if(_t.length===0)return!0;for(const At of _t)if(this.matchFilter(e,At))return!0;return!1}static matchFilter(e,_t){for(const At in _t){const xt=_t[At],kt=e[At];if(kt===void 0||!(Array.isArray(kt)?this.matchAnyIndexValue(xt,kt):this.matchIndexValue(xt,kt)))return!1}return!0}static matchAnyIndexValue(e,_t){for(const At of _t)if(this.matchIndexValue(e,At))return!0;return!1}static matchIndexValue(e,_t){if(typeof e=="object"){if(Array.isArray(e)){if(this.matchOneOf(e,_t))return!0}else if(this.matchRange(e,_t))return!0}else if(_t===e)return!0;return!1}static matchOneOf(e,_t){for(const At of e)if(_t===At)return!0;return!1}static matchRange(e,_t){return!(e.lt!==void 0&&_t>=e.lt||e.lte!==void 0&&_t>e.lte||e.gt!==void 0&&_t<=e.gt||e.gte!==void 0&&_t<e.gte)}static isEqualFilter(e){return typeof e!="object"}static isRangeFilter(e){return typeof e=="object"&&!Array.isArray(e)?"gt"in e||"lt"in e||"lte"in e||"gte"in e:!1}static isOneOfFilter(e){return!!(typeof e=="object"&&Array.isArray(e))}static convertRangeCriterion(e){let _t;return e.to!==void 0&&e.from!==void 0?_t={gte:e.from,lt:e.to}:e.to!==void 0?_t={lt:e.to}:e.from!==void 0&&(_t={gte:e.from}),_t}static constructPrefixFilterAsRangeFilter(e){return{gte:e,lt:e+""}}}class FilterSelector{static reduceFilter(e){if(Object.keys(e).length<=1)return e;const{recordId:At,attester:xt,parentId:kt,recipient:Bt,contextId:Nt,author:Ut,protocolPath:Lt,schema:jt,protocol:Kt}=e,qt=__rest$z(e,["recordId","attester","parentId","recipient","contextId","author","protocolPath","schema","protocol"]);if(At!==void 0)return{recordId:At};if(xt!==void 0)return{attester:xt};if(kt!==void 0)return{parentId:kt};if(Bt!==void 0)return{recipient:Bt};if(Nt!==void 0)return{contextId:Nt};if(Lt!==void 0)return{protocolPath:Lt};if(jt!==void 0)return{schema:jt};if(Kt!==void 0)return{protocol:Kt};const Vt=Object.keys(qt)[0],Ht={};return Ht[Vt]=e[Vt],Ht}}var DwnInterfaceName;(function($t){$t.Messages="Messages",$t.Protocols="Protocols",$t.Records="Records"})(DwnInterfaceName||(DwnInterfaceName={}));var DwnMethodName;(function($t){$t.Configure="Configure",$t.Query="Query",$t.Read="Read",$t.Write="Write",$t.Delete="Delete",$t.Subscribe="Subscribe"})(DwnMethodName||(DwnMethodName={}));function validateProtocolUrlNormalized($t){let e;try{e=normalizeProtocolUrl($t)}catch{e=void 0}if($t!==e)throw new DwnError(DwnErrorCode.UrlProtocolNotNormalized,`Protocol URI ${$t} must be normalized.`)}function normalizeProtocolUrl($t){return normalizeUrl($t)}function validateSchemaUrlNormalized($t){let e;try{e=normalizeSchemaUrl($t)}catch{e=void 0}if($t!==e)throw new DwnError(DwnErrorCode.UrlSchemaNotNormalized,`Schema URI ${$t} must be normalized.`)}function normalizeSchemaUrl($t){return normalizeUrl($t)}function normalizeUrl($t){let e;/^[^:]+:(\/{2})?[^\/].*/.test($t)?e=$t:e=`http://${$t}`;try{const _t=new URL(e);return _t.search="",_t.hash="",removeTrailingSlash(_t.href)}catch{throw new DwnError(DwnErrorCode.UrlProtocolNotNormalizable,"Could not normalize protocol URI")}}function removeTrailingSlash($t){return $t.endsWith("/")?$t.slice(0,-1):$t}var __awaiter$2u=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$y=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Records{static isRecordsWrite(e){return e.descriptor.interface===DwnInterfaceName.Records&&e.descriptor.method===DwnMethodName.Write}static decrypt(e,_t,At){return __awaiter$2u(this,void 0,void 0,function*(){const{encryption:xt}=e,kt=xt.keyEncryption.find(Ht=>Ht.rootKeyId===_t.rootKeyId&&Ht.derivationScheme===_t.derivationScheme);if(kt===void 0)throw new DwnError(DwnErrorCode.RecordsDecryptNoMatchingKeyEncryptedFound,`Unable to find a symmetric key encrypted using key         with ID '${_t.rootKeyId}' and '${_t.derivationScheme}' derivation scheme.`);const Bt=Records.constructKeyDerivationPath(kt.derivationScheme,e),Nt=yield Records.derivePrivateKey(_t,Bt),Ut=Encoder$4.base64UrlToBytes(kt.encryptedKey),Lt=Secp256k1$3.publicJwkToBytes(kt.ephemeralPublicKey),jt=Encoder$4.base64UrlToBytes(kt.initializationVector),Kt=Encoder$4.base64UrlToBytes(kt.messageAuthenticationCode),qt=yield Encryption.eciesSecp256k1Decrypt({ciphertext:Ut,ephemeralPublicKey:Lt,initializationVector:jt,messageAuthenticationCode:Kt,privateKey:Nt}),zt=Encoder$4.base64UrlToBytes(xt.initializationVector);return yield Encryption.aes256CtrDecrypt(qt,zt,At)})}static constructKeyDerivationPath(e,_t){const At=_t.descriptor,xt=_t.contextId;let kt;return e===KeyDerivationScheme.DataFormats?kt=Records.constructKeyDerivationPathUsingDataFormatsScheme(At.schema,At.dataFormat):e===KeyDerivationScheme.ProtocolPath?kt=Records.constructKeyDerivationPathUsingProtocolPathScheme(At):e===KeyDerivationScheme.ProtocolContext?kt=Records.constructKeyDerivationPathUsingProtocolContextScheme(xt):kt=Records.constructKeyDerivationPathUsingSchemasScheme(At.schema),kt}static constructKeyDerivationPathUsingDataFormatsScheme(e,_t){return e!==void 0?[KeyDerivationScheme.DataFormats,e,_t]:[KeyDerivationScheme.DataFormats,_t]}static constructKeyDerivationPathUsingProtocolPathScheme(e){if(e.protocol===void 0)throw new DwnError(DwnErrorCode.RecordsProtocolPathDerivationSchemeMissingProtocol,"Unable to construct key derivation path using `protocols` scheme because `protocol` is missing.");const _t=e.protocolPath.split("/");return[KeyDerivationScheme.ProtocolPath,e.protocol,..._t]}static constructKeyDerivationPathUsingProtocolContextScheme(e){if(e===void 0)throw new DwnError(DwnErrorCode.RecordsProtocolContextDerivationSchemeMissingContextId,"Unable to construct key derivation path using `protocolContext` scheme because `contextId` is missing.");const _t=e.split("/")[0];return[KeyDerivationScheme.ProtocolContext,_t]}static constructKeyDerivationPathUsingSchemasScheme(e){if(e===void 0)throw new DwnError(DwnErrorCode.RecordsSchemasDerivationSchemeMissingSchema,"Unable to construct key derivation path using `schemas` scheme because `schema` is missing.");return[KeyDerivationScheme.Schemas,e]}static derivePrivateKey(e,_t){var At;return __awaiter$2u(this,void 0,void 0,function*(){if(e.derivedPrivateKey.crv!=="secp256k1")throw new DwnError(DwnErrorCode.RecordsDerivePrivateKeyUnSupportedCurve,`Curve ${e.derivedPrivateKey.crv} is not supported.`);const xt=(At=e.derivationPath)!==null&&At!==void 0?At:[];Records.validateAncestorKeyAndDescentKeyDerivationPathsMatch(xt,_t);const kt=_t.slice(xt.length),Bt=Secp256k1$3.privateJwkToBytes(e.derivedPrivateKey);return yield HdKey.derivePrivateKeyBytes(Bt,kt)})}static validateAncestorKeyAndDescentKeyDerivationPathsMatch(e,_t){for(let At=0;At<e.length;At++){const xt=e[At],kt=_t[At];if(xt!==kt)throw new DwnError(DwnErrorCode.RecordsInvalidAncestorKeyDerivationSegment,`Ancestor key derivation segment '${xt}' mismatches against the descendant key derivation segment '${kt}'.`)}}static getParentContextFromOfContextId(e){if(e===void 0)return;const _t=e.lastIndexOf("/");return _t===-1?"":e.substring(0,_t)}static normalizeFilter(e){let _t;e.protocol===void 0?_t=void 0:_t=normalizeProtocolUrl(e.protocol);let At;e.schema===void 0?At=void 0:At=normalizeSchemaUrl(e.schema);const xt=Object.assign(Object.assign({},e),{protocol:_t,schema:At});return removeUndefinedProperties$2(xt),xt}static isStartsWithFilter(e){return typeof e=="object"&&"startsWith"in e&&typeof e.startsWith=="string"}static buildTagIndexes(e){const _t={};for(const At in e){const xt=e[At];_t[`tag.${At}`]=xt}return _t}static convertTagsFilter(e){const _t={};for(const At in e){const xt=e[At];_t[`tag.${At}`]=this.isStartsWithFilter(xt)?FilterUtility.constructPrefixFilterAsRangeFilter(xt.startsWith):xt}return _t}static convertFilter(e,_t){const{tags:At}=e,xt=__rest$y(e,["tags"]);let kt={};At!==void 0&&(kt=Object.assign({},this.convertTagsFilter(At)));const Bt=Object.assign(Object.assign({},xt),kt),{dateCreated:Nt,datePublished:Ut,dateUpdated:Lt,contextId:jt}=e,Kt=Nt?FilterUtility.convertRangeCriterion(Nt):void 0;Kt&&(Bt.dateCreated=Kt);const qt=Ut?FilterUtility.convertRangeCriterion(Ut):void 0;qt&&(Bt.published=!0,Bt.datePublished=qt),Bt.published!==!0&&(_t===DateSort.PublishedAscending||_t===DateSort.PublishedDescending)&&(Bt.published=!0);const zt=Lt?FilterUtility.convertRangeCriterion(Lt):void 0;zt&&(Bt.messageTimestamp=zt,delete Bt.dateUpdated);const Vt=jt?FilterUtility.constructPrefixFilterAsRangeFilter(jt):void 0;return Vt&&(Bt.contextId=Vt),Array.isArray(Bt.author)&&Bt.author.length===0&&delete Bt.author,Array.isArray(Bt.recipient)&&Bt.recipient.length===0&&delete Bt.recipient,Bt}static validateDelegatedGrantReferentialIntegrity(e,_t,At){var xt,kt;return __awaiter$2u(this,void 0,void 0,function*(){const Bt=(_t==null?void 0:_t.delegatedGrantId)!==void 0,Nt=((xt=e.authorization)===null||xt===void 0?void 0:xt.authorDelegatedGrant)!==void 0;if(Bt!==Nt)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantAndIdExistenceMismatch,`delegatedGrantId in message (author) signature and authorDelegatedGrant must both exist or be undefined.          delegatedGrantId in message (author) signature defined: ${Bt},          authorDelegatedGrant defined: ${Nt}`);if(Nt){const jt=e.authorization.authorDelegatedGrant;if((yield PermissionGrant$1.parse(jt)).delegated!==!0)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantNotADelegatedGrant,"The owner delegated grant given is not a delegated grant.");const qt=jt.descriptor.recipient,zt=Message.getSigner(e);if(qt!==zt)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch,`grantedTo ${qt} in author delegated grant must be the same as the signer ${zt} of the message signature.`);const Vt=yield Message.getCid(jt);if(Vt!==_t.delegatedGrantId)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantCidMismatch,`CID of the author delegated grant ${Vt} must be the same as           the delegatedGrantId ${_t.delegatedGrantId} in the message signature.`)}const Ut=(At==null?void 0:At.delegatedGrantId)!==void 0,Lt=((kt=e.authorization)===null||kt===void 0?void 0:kt.ownerDelegatedGrant)!==void 0;if(Ut!==Lt)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantAndIdExistenceMismatch,`delegatedGrantId in owner signature and ownerDelegatedGrant must both exist or be undefined.          delegatedGrantId in owner signature defined: ${Ut},          ownerDelegatedGrant defined: ${Lt}`);if(Lt){const jt=e.authorization.ownerDelegatedGrant;if((yield PermissionGrant$1.parse(jt)).delegated!==!0)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantNotADelegatedGrant,"The owner delegated grant given is not a delegated grant.");const qt=jt.descriptor.recipient,zt=Jws.getSignerDid(e.authorization.ownerSignature.signatures[0]);if(qt!==zt)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch,`grantedTo ${qt} in owner delegated grant must be the same as the signer ${zt} of the owner signature.`);const Vt=yield Message.getCid(jt);if(Vt!==At.delegatedGrantId)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantCidMismatch,`CID of the owner delegated grant ${Vt} must be the same as           the delegatedGrantId ${At.delegatedGrantId} in the owner signature.`)}})}static shouldProtocolAuthorize(e){return e.protocolRole!==void 0}static filterIncludesPublishedRecords(e){return e.datePublished!==void 0||e.published!==!1}static filterIncludesUnpublishedRecords(e){return e.datePublished===void 0&&e.published===void 0?!0:e.published===!1}static canPerformDeleteAgainstRecord(e,_t){if(_t===void 0)return!1;if(_t.descriptor.method===DwnMethodName.Delete){if(e.descriptor.prune!==!0)return!1;if(_t.descriptor.prune===!0)return!1}return!0}static shouldBuildUnpublishedRecipientFilter(e,_t){const{recipient:At}=e;return Array.isArray(At)?At.length===0||At.includes(_t):At===void 0||At===_t}static shouldBuildUnpublishedAuthorFilter(e,_t){const{author:At}=e;return Array.isArray(At)?At.length===0||At.includes(_t):At===void 0||At===_t}}var __awaiter$2t=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class GrantAuthorization{static performBaseValidation(e){return __awaiter$2t(this,void 0,void 0,function*(){const{incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}=e,Nt=_t.descriptor;GrantAuthorization.verifyExpectedGrantorAndGrantee(At,xt,kt);const Ut=At;yield GrantAuthorization.verifyGrantActive(Ut,Nt.messageTimestamp,kt,Bt),yield GrantAuthorization.verifyGrantScopeInterfaceAndMethod(Nt.interface,Nt.method,kt)})}static verifyExpectedGrantorAndGrantee(e,_t,At){const xt=At.grantee;if(_t!==xt)throw new DwnError(DwnErrorCode.GrantAuthorizationNotGrantedToAuthor,`Permission grant is granted to ${xt}, but need to be granted to ${_t}`);const kt=At.grantor;if(e!==kt)throw new DwnError(DwnErrorCode.GrantAuthorizationNotGrantedForTenant,`Permission grant is granted by ${kt}, but need to be granted by ${e}`)}static verifyGrantActive(e,_t,At,xt){return __awaiter$2t(this,void 0,void 0,function*(){if(_t<At.dateGranted)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantNotYetActive,"The message has a timestamp before the associated permission grant becomes active");if(_t>=At.dateExpires)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantExpired,"The message has timestamp after the expiry of the associated permission grant");const kt={parentId:At.id,protocolPath:"grant/revocation",isLatestBaseState:!0},{messages:Bt}=yield xt.query(e,[kt]),Nt=yield Message.getOldestMessage(Bt);if(Nt!==void 0&&Nt.descriptor.messageTimestamp<=_t)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantRevoked,`Permission grant with CID ${At.id} has been revoked`)})}static verifyGrantScopeInterfaceAndMethod(e,_t,At){return __awaiter$2t(this,void 0,void 0,function*(){if(e!==At.scope.interface)throw new DwnError(DwnErrorCode.GrantAuthorizationInterfaceMismatch,`DWN Interface of incoming message is outside the scope of permission grant with ID ${At.id}`);if(_t!==At.scope.method)throw new DwnError(DwnErrorCode.GrantAuthorizationMethodMismatch,`DWN Method of incoming message is outside the scope of permission grant with ID ${At.id}`)})}}var PermissionConditionPublication;(function($t){$t.Required="Required",$t.Prohibited="Prohibited"})(PermissionConditionPublication||(PermissionConditionPublication={}));var __awaiter$2s=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsGrantAuthorization{static authorizeWrite(e){return __awaiter$2s(this,void 0,void 0,function*(){const{recordsWriteMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}),RecordsGrantAuthorization.verifyScope(_t,kt.scope),RecordsGrantAuthorization.verifyConditions(_t,kt.conditions)})}static authorizeRead(e){return __awaiter$2s(this,void 0,void 0,function*(){const{recordsReadMessage:_t,recordsWriteMessageToBeRead:At,expectedGrantor:xt,expectedGrantee:kt,permissionGrant:Bt,messageStore:Nt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:xt,expectedGrantee:kt,permissionGrant:Bt,messageStore:Nt}),RecordsGrantAuthorization.verifyScope(At,Bt.scope)})}static authorizeQueryOrSubscribe(e){return __awaiter$2s(this,void 0,void 0,function*(){const{incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt});const Ut=kt.scope.protocol,Lt=_t.descriptor.filter.protocol;if(Ut!==void 0&&Lt!==Ut)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch,`Grant protocol scope ${Ut} does not match protocol in message ${Lt}`)})}static authorizeDelete(e){return __awaiter$2s(this,void 0,void 0,function*(){const{recordsDeleteMessage:_t,recordsWriteToDelete:At,expectedGrantor:xt,expectedGrantee:kt,permissionGrant:Bt,messageStore:Nt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:xt,expectedGrantee:kt,permissionGrant:Bt,messageStore:Nt});const Lt=Bt.scope.protocol,jt=At.descriptor.protocol;if(Lt!==void 0&&jt!==Lt)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationDeleteProtocolScopeMismatch,`Grant protocol scope ${Lt} does not match protocol in record to delete ${jt}`)})}static verifyScope(e,_t){if(_t.protocol!==e.descriptor.protocol)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationScopeProtocolMismatch,"Grant scope specifies different protocol than what appears in the record");if(_t.contextId!==void 0&&(e.contextId===void 0||!e.contextId.startsWith(_t.contextId)))throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationScopeContextIdMismatch,"Grant scope specifies different contextId than what appears in the record");if(_t.protocolPath!==void 0&&_t.protocolPath!==e.descriptor.protocolPath)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationScopeProtocolPathMismatch,"Grant scope specifies different protocolPath than what appears in the record")}static verifyConditions(e,_t){if((_t==null?void 0:_t.publication)===PermissionConditionPublication.Required&&!e.descriptor.published)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationConditionPublicationRequired,"Permission grant requires message to be published");if((_t==null?void 0:_t.publication)===PermissionConditionPublication.Prohibited&&e.descriptor.published)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationConditionPublicationProhibited,"Permission grant prohibits message from being published")}}class JSBI extends Array{constructor(e,_t){if(super(e),this.sign=_t,Object.setPrototypeOf(this,JSBI.prototype),e>JSBI.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded")}static BigInt(e){var _t=Math.floor,At=Number.isFinite;if(typeof e=="number"){if(e===0)return JSBI.__zero();if(JSBI.__isOneDigitInt(e))return 0>e?JSBI.__oneDigit(-e,!0):JSBI.__oneDigit(e,!1);if(!At(e)||_t(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return JSBI.__fromDouble(e)}if(typeof e=="string"){const xt=JSBI.__fromString(e);if(xt===null)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return xt}if(typeof e=="boolean")return e===!0?JSBI.__oneDigit(1,!1):JSBI.__zero();if(typeof e=="object"){if(e.constructor===JSBI)return e;const xt=JSBI.__toPrimitive(e);return JSBI.BigInt(xt)}throw new TypeError("Cannot convert "+e+" to a BigInt")}toDebugString(){const e=["BigInt["];for(const _t of this)e.push((_t&&(_t>>>0).toString(16))+", ");return e.push("]"),e.join("")}toString(e=10){if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return this.length===0?"0":e&e-1?JSBI.__toStringGeneric(this,e,!1):JSBI.__toStringBasePowerOfTwo(this,e)}valueOf(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}static toNumber(e){const _t=e.length;if(_t===0)return 0;if(_t===1){const Wt=e.__unsignedDigit(0);return e.sign?-Wt:Wt}const At=e.__digit(_t-1),xt=JSBI.__clz30(At),kt=30*_t-xt;if(1024<kt)return e.sign?-1/0:1/0;let Bt=kt-1,Nt=At,Ut=_t-1;const Lt=xt+3;let jt=Lt===32?0:Nt<<Lt;jt>>>=12;const Kt=Lt-12;let qt=12<=Lt?0:Nt<<20+Lt,zt=20+Lt;for(0<Kt&&0<Ut&&(Ut--,Nt=e.__digit(Ut),jt|=Nt>>>30-Kt,qt=Nt<<Kt+2,zt=Kt+2);0<zt&&0<Ut;)Ut--,Nt=e.__digit(Ut),qt|=30<=zt?Nt<<zt-30:Nt>>>30-zt,zt-=30;const Vt=JSBI.__decideRounding(e,zt,Ut,Nt);if((Vt===1||Vt===0&&(1&qt)==1)&&(qt=qt+1>>>0,qt===0&&(jt++,jt>>>20!=0&&(jt=0,Bt++,1023<Bt))))return e.sign?-1/0:1/0;const Ht=e.sign?-2147483648:0;return Bt=Bt+1023<<20,JSBI.__kBitConversionInts[1]=Ht|Bt|jt,JSBI.__kBitConversionInts[0]=qt,JSBI.__kBitConversionDouble[0]}static unaryMinus(e){if(e.length===0)return e;const _t=e.__copy();return _t.sign=!e.sign,_t}static bitwiseNot(e){return e.sign?JSBI.__absoluteSubOne(e).__trim():JSBI.__absoluteAddOne(e,!0)}static exponentiate(e,_t){if(_t.sign)throw new RangeError("Exponent must be positive");if(_t.length===0)return JSBI.__oneDigit(1,!1);if(e.length===0)return e;if(e.length===1&&e.__digit(0)===1)return e.sign&&!(1&_t.__digit(0))?JSBI.unaryMinus(e):e;if(1<_t.length)throw new RangeError("BigInt too big");let At=_t.__unsignedDigit(0);if(At===1)return e;if(At>=JSBI.__kMaxLengthBits)throw new RangeError("BigInt too big");if(e.length===1&&e.__digit(0)===2){const Bt=1+(0|At/30),Nt=e.sign&&(1&At)!=0,Ut=new JSBI(Bt,Nt);Ut.__initializeDigits();const Lt=1<<At%30;return Ut.__setDigit(Bt-1,Lt),Ut}let xt=null,kt=e;for(1&At&&(xt=e),At>>=1;At!==0;At>>=1)kt=JSBI.multiply(kt,kt),1&At&&(xt===null?xt=kt:xt=JSBI.multiply(xt,kt));return xt}static multiply(e,_t){if(e.length===0)return e;if(_t.length===0)return _t;let At=e.length+_t.length;30<=e.__clzmsd()+_t.__clzmsd()&&At--;const xt=new JSBI(At,e.sign!==_t.sign);xt.__initializeDigits();for(let kt=0;kt<e.length;kt++)JSBI.__multiplyAccumulate(_t,e.__digit(kt),xt,kt);return xt.__trim()}static divide(e,_t){if(_t.length===0)throw new RangeError("Division by zero");if(0>JSBI.__absoluteCompare(e,_t))return JSBI.__zero();const At=e.sign!==_t.sign,xt=_t.__unsignedDigit(0);let kt;if(_t.length===1&&32767>=xt){if(xt===1)return At===e.sign?e:JSBI.unaryMinus(e);kt=JSBI.__absoluteDivSmall(e,xt,null)}else kt=JSBI.__absoluteDivLarge(e,_t,!0,!1);return kt.sign=At,kt.__trim()}static remainder(e,_t){if(_t.length===0)throw new RangeError("Division by zero");if(0>JSBI.__absoluteCompare(e,_t))return e;const At=_t.__unsignedDigit(0);if(_t.length===1&&32767>=At){if(At===1)return JSBI.__zero();const kt=JSBI.__absoluteModSmall(e,At);return kt===0?JSBI.__zero():JSBI.__oneDigit(kt,e.sign)}const xt=JSBI.__absoluteDivLarge(e,_t,!1,!0);return xt.sign=e.sign,xt.__trim()}static add(e,_t){const At=e.sign;return At===_t.sign?JSBI.__absoluteAdd(e,_t,At):0<=JSBI.__absoluteCompare(e,_t)?JSBI.__absoluteSub(e,_t,At):JSBI.__absoluteSub(_t,e,!At)}static subtract(e,_t){const At=e.sign;return At===_t.sign?0<=JSBI.__absoluteCompare(e,_t)?JSBI.__absoluteSub(e,_t,At):JSBI.__absoluteSub(_t,e,!At):JSBI.__absoluteAdd(e,_t,At)}static leftShift(e,_t){return _t.length===0||e.length===0?e:_t.sign?JSBI.__rightShiftByAbsolute(e,_t):JSBI.__leftShiftByAbsolute(e,_t)}static signedRightShift(e,_t){return _t.length===0||e.length===0?e:_t.sign?JSBI.__leftShiftByAbsolute(e,_t):JSBI.__rightShiftByAbsolute(e,_t)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(e,_t){return 0>JSBI.__compareToBigInt(e,_t)}static lessThanOrEqual(e,_t){return 0>=JSBI.__compareToBigInt(e,_t)}static greaterThan(e,_t){return 0<JSBI.__compareToBigInt(e,_t)}static greaterThanOrEqual(e,_t){return 0<=JSBI.__compareToBigInt(e,_t)}static equal(e,_t){if(e.sign!==_t.sign||e.length!==_t.length)return!1;for(let At=0;At<e.length;At++)if(e.__digit(At)!==_t.__digit(At))return!1;return!0}static notEqual(e,_t){return!JSBI.equal(e,_t)}static bitwiseAnd(e,_t){var At=Math.max;if(!e.sign&&!_t.sign)return JSBI.__absoluteAnd(e,_t).__trim();if(e.sign&&_t.sign){const xt=At(e.length,_t.length)+1;let kt=JSBI.__absoluteSubOne(e,xt);const Bt=JSBI.__absoluteSubOne(_t);return kt=JSBI.__absoluteOr(kt,Bt,kt),JSBI.__absoluteAddOne(kt,!0,kt).__trim()}return e.sign&&([e,_t]=[_t,e]),JSBI.__absoluteAndNot(e,JSBI.__absoluteSubOne(_t)).__trim()}static bitwiseXor(e,_t){var At=Math.max;if(!e.sign&&!_t.sign)return JSBI.__absoluteXor(e,_t).__trim();if(e.sign&&_t.sign){const Bt=At(e.length,_t.length),Nt=JSBI.__absoluteSubOne(e,Bt),Ut=JSBI.__absoluteSubOne(_t);return JSBI.__absoluteXor(Nt,Ut,Nt).__trim()}const xt=At(e.length,_t.length)+1;e.sign&&([e,_t]=[_t,e]);let kt=JSBI.__absoluteSubOne(_t,xt);return kt=JSBI.__absoluteXor(kt,e,kt),JSBI.__absoluteAddOne(kt,!0,kt).__trim()}static bitwiseOr(e,_t){var At=Math.max;const xt=At(e.length,_t.length);if(!e.sign&&!_t.sign)return JSBI.__absoluteOr(e,_t).__trim();if(e.sign&&_t.sign){let Bt=JSBI.__absoluteSubOne(e,xt);const Nt=JSBI.__absoluteSubOne(_t);return Bt=JSBI.__absoluteAnd(Bt,Nt,Bt),JSBI.__absoluteAddOne(Bt,!0,Bt).__trim()}e.sign&&([e,_t]=[_t,e]);let kt=JSBI.__absoluteSubOne(_t,xt);return kt=JSBI.__absoluteAndNot(kt,e,kt),JSBI.__absoluteAddOne(kt,!0,kt).__trim()}static asIntN(e,_t){var At=Math.floor;if(_t.length===0)return _t;if(e=At(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return JSBI.__zero();if(e>=JSBI.__kMaxLengthBits)return _t;const xt=0|(e+29)/30;if(_t.length<xt)return _t;const kt=_t.__unsignedDigit(xt-1),Bt=1<<(e-1)%30;if(_t.length===xt&&kt<Bt)return _t;if((kt&Bt)!==Bt)return JSBI.__truncateToNBits(e,_t);if(!_t.sign)return JSBI.__truncateAndSubFromPowerOfTwo(e,_t,!0);if(!(kt&Bt-1)){for(let Nt=xt-2;0<=Nt;Nt--)if(_t.__digit(Nt)!==0)return JSBI.__truncateAndSubFromPowerOfTwo(e,_t,!1);return _t.length===xt&&kt===Bt?_t:JSBI.__truncateToNBits(e,_t)}return JSBI.__truncateAndSubFromPowerOfTwo(e,_t,!1)}static asUintN(e,_t){var At=Math.floor;if(_t.length===0)return _t;if(e=At(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return JSBI.__zero();if(_t.sign){if(e>JSBI.__kMaxLengthBits)throw new RangeError("BigInt too big");return JSBI.__truncateAndSubFromPowerOfTwo(e,_t,!1)}if(e>=JSBI.__kMaxLengthBits)return _t;const xt=0|(e+29)/30;if(_t.length<xt)return _t;const kt=e%30;return _t.length==xt&&(kt===0||!(_t.__digit(xt-1)>>>kt))?_t:JSBI.__truncateToNBits(e,_t)}static ADD(e,_t){if(e=JSBI.__toPrimitive(e),_t=JSBI.__toPrimitive(_t),typeof e=="string")return typeof _t!="string"&&(_t=_t.toString()),e+_t;if(typeof _t=="string")return e.toString()+_t;if(e=JSBI.__toNumeric(e),_t=JSBI.__toNumeric(_t),JSBI.__isBigInt(e)&&JSBI.__isBigInt(_t))return JSBI.add(e,_t);if(typeof e=="number"&&typeof _t=="number")return e+_t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(e,_t){return JSBI.__compare(e,_t,0)}static LE(e,_t){return JSBI.__compare(e,_t,1)}static GT(e,_t){return JSBI.__compare(e,_t,2)}static GE(e,_t){return JSBI.__compare(e,_t,3)}static EQ(e,_t){for(;;){if(JSBI.__isBigInt(e))return JSBI.__isBigInt(_t)?JSBI.equal(e,_t):JSBI.EQ(_t,e);if(typeof e=="number"){if(JSBI.__isBigInt(_t))return JSBI.__equalToNumber(_t,e);if(typeof _t!="object")return e==_t;_t=JSBI.__toPrimitive(_t)}else if(typeof e=="string"){if(JSBI.__isBigInt(_t))return e=JSBI.__fromString(e),e!==null&&JSBI.equal(e,_t);if(typeof _t!="object")return e==_t;_t=JSBI.__toPrimitive(_t)}else if(typeof e=="boolean"){if(JSBI.__isBigInt(_t))return JSBI.__equalToNumber(_t,+e);if(typeof _t!="object")return e==_t;_t=JSBI.__toPrimitive(_t)}else if(typeof e=="symbol"){if(JSBI.__isBigInt(_t))return!1;if(typeof _t!="object")return e==_t;_t=JSBI.__toPrimitive(_t)}else if(typeof e=="object"){if(typeof _t=="object"&&_t.constructor!==JSBI)return e==_t;e=JSBI.__toPrimitive(e)}else return e==_t}}static NE(e,_t){return!JSBI.EQ(e,_t)}static DataViewGetBigInt64(e,_t,At=!1){return JSBI.asIntN(64,JSBI.DataViewGetBigUint64(e,_t,At))}static DataViewGetBigUint64(e,_t,At=!1){const[xt,kt]=At?[4,0]:[0,4],Bt=e.getUint32(_t+xt,At),Nt=e.getUint32(_t+kt,At),Ut=new JSBI(3,!1);return Ut.__setDigit(0,1073741823&Nt),Ut.__setDigit(1,(268435455&Bt)<<2|Nt>>>30),Ut.__setDigit(2,Bt>>>28),Ut.__trim()}static DataViewSetBigInt64(e,_t,At,xt=!1){JSBI.DataViewSetBigUint64(e,_t,At,xt)}static DataViewSetBigUint64(e,_t,At,xt=!1){At=JSBI.asUintN(64,At);let kt=0,Bt=0;if(0<At.length&&(Bt=At.__digit(0),1<At.length)){const Lt=At.__digit(1);Bt|=Lt<<30,kt=Lt>>>2,2<At.length&&(kt|=At.__digit(2)<<28)}const[Nt,Ut]=xt?[4,0]:[0,4];e.setUint32(_t+Nt,kt,xt),e.setUint32(_t+Ut,Bt,xt)}static __zero(){return new JSBI(0,!1)}static __oneDigit(e,_t){const At=new JSBI(1,_t);return At.__setDigit(0,e),At}__copy(){const e=new JSBI(this.length,this.sign);for(let _t=0;_t<this.length;_t++)e[_t]=this[_t];return e}__trim(){let e=this.length,_t=this[e-1];for(;_t===0;)e--,_t=this[e-1],this.pop();return e===0&&(this.sign=!1),this}__initializeDigits(){for(let e=0;e<this.length;e++)this[e]=0}static __decideRounding(e,_t,At,xt){if(0<_t)return-1;let kt;if(0>_t)kt=-_t-1;else{if(At===0)return-1;At--,xt=e.__digit(At),kt=29}let Bt=1<<kt;if(!(xt&Bt))return-1;if(Bt-=1,(xt&Bt)!=0)return 1;for(;0<At;)if(At--,e.__digit(At)!==0)return 1;return 0}static __fromDouble(e){JSBI.__kBitConversionDouble[0]=e;const _t=2047&JSBI.__kBitConversionInts[1]>>>20,At=_t-1023,xt=(0|At/30)+1,kt=new JSBI(xt,0>e);let Bt=1048575&JSBI.__kBitConversionInts[1]|1048576,Nt=JSBI.__kBitConversionInts[0];const Ut=20,Lt=At%30;let jt,Kt=0;if(Lt<20){const qt=Ut-Lt;Kt=qt+32,jt=Bt>>>qt,Bt=Bt<<32-qt|Nt>>>qt,Nt<<=32-qt}else if(Lt===20)Kt=32,jt=Bt,Bt=Nt,Nt=0;else{const qt=Lt-Ut;Kt=32-qt,jt=Bt<<qt|Nt>>>32-qt,Bt=Nt<<qt,Nt=0}kt.__setDigit(xt-1,jt);for(let qt=xt-2;0<=qt;qt--)0<Kt?(Kt-=30,jt=Bt>>>2,Bt=Bt<<30|Nt>>>2,Nt<<=30):jt=0,kt.__setDigit(qt,jt);return kt.__trim()}static __isWhitespace(e){return 13>=e&&9<=e||(159>=e?e==32:131071>=e?e==160||e==5760:196607>=e?(e&=131071,10>=e||e==40||e==41||e==47||e==95||e==4096):e==65279)}static __fromString(e,_t=0){let At=0;const xt=e.length;let kt=0;if(kt===xt)return JSBI.__zero();let Bt=e.charCodeAt(kt);for(;JSBI.__isWhitespace(Bt);){if(++kt===xt)return JSBI.__zero();Bt=e.charCodeAt(kt)}if(Bt===43){if(++kt===xt)return null;Bt=e.charCodeAt(kt),At=1}else if(Bt===45){if(++kt===xt)return null;Bt=e.charCodeAt(kt),At=-1}if(_t===0){if(_t=10,Bt===48){if(++kt===xt)return JSBI.__zero();if(Bt=e.charCodeAt(kt),Bt===88||Bt===120){if(_t=16,++kt===xt)return null;Bt=e.charCodeAt(kt)}else if(Bt===79||Bt===111){if(_t=8,++kt===xt)return null;Bt=e.charCodeAt(kt)}else if(Bt===66||Bt===98){if(_t=2,++kt===xt)return null;Bt=e.charCodeAt(kt)}}}else if(_t===16&&Bt===48){if(++kt===xt)return JSBI.__zero();if(Bt=e.charCodeAt(kt),Bt===88||Bt===120){if(++kt===xt)return null;Bt=e.charCodeAt(kt)}}if(At!=0&&_t!==10)return null;for(;Bt===48;){if(++kt===xt)return JSBI.__zero();Bt=e.charCodeAt(kt)}const Nt=xt-kt;let Ut=JSBI.__kMaxBitsPerChar[_t],Lt=JSBI.__kBitsPerCharTableMultiplier-1;if(Nt>1073741824/Ut)return null;const jt=Ut*Nt+Lt>>>JSBI.__kBitsPerCharTableShift,Kt=new JSBI(0|(jt+29)/30,!1),qt=10>_t?_t:10,zt=10<_t?_t-10:0;if(_t&_t-1){Kt.__initializeDigits();let Vt=!1,Ht=0;do{let Wt=0,Qt=1;for(;;){let Jt;if(Bt-48>>>0<qt)Jt=Bt-48;else if((32|Bt)-97>>>0<zt)Jt=(32|Bt)-87;else{Vt=!0;break}const tr=Qt*_t;if(1073741823<tr)break;if(Qt=tr,Wt=Wt*_t+Jt,Ht++,++kt===xt){Vt=!0;break}Bt=e.charCodeAt(kt)}Lt=30*JSBI.__kBitsPerCharTableMultiplier-1;const Xt=0|(Ut*Ht+Lt>>>JSBI.__kBitsPerCharTableShift)/30;Kt.__inplaceMultiplyAdd(Qt,Wt,Xt)}while(!Vt)}else{Ut>>=JSBI.__kBitsPerCharTableShift;const Vt=[],Ht=[];let Wt=!1;do{let Qt=0,Xt=0;for(;;){let Jt;if(Bt-48>>>0<qt)Jt=Bt-48;else if((32|Bt)-97>>>0<zt)Jt=(32|Bt)-87;else{Wt=!0;break}if(Xt+=Ut,Qt=Qt<<Ut|Jt,++kt===xt){Wt=!0;break}if(Bt=e.charCodeAt(kt),30<Xt+Ut)break}Vt.push(Qt),Ht.push(Xt)}while(!Wt);JSBI.__fillFromParts(Kt,Vt,Ht)}if(kt!==xt){if(!JSBI.__isWhitespace(Bt))return null;for(kt++;kt<xt;kt++)if(Bt=e.charCodeAt(kt),!JSBI.__isWhitespace(Bt))return null}return Kt.sign=At==-1,Kt.__trim()}static __fillFromParts(e,_t,At){let xt=0,kt=0,Bt=0;for(let Nt=_t.length-1;0<=Nt;Nt--){const Ut=_t[Nt],Lt=At[Nt];kt|=Ut<<Bt,Bt+=Lt,Bt===30?(e.__setDigit(xt++,kt),Bt=0,kt=0):30<Bt&&(e.__setDigit(xt++,1073741823&kt),Bt-=30,kt=Ut>>>Lt-Bt)}if(kt!==0){if(xt>=e.length)throw new Error("implementation bug");e.__setDigit(xt++,kt)}for(;xt<e.length;xt++)e.__setDigit(xt,0)}static __toStringBasePowerOfTwo(e,_t){const At=e.length;let xt=_t-1;xt=(85&xt>>>1)+(85&xt),xt=(51&xt>>>2)+(51&xt),xt=(15&xt>>>4)+(15&xt);const kt=xt,Bt=_t-1,Nt=e.__digit(At-1),Ut=JSBI.__clz30(Nt);let Lt=0|(30*At-Ut+kt-1)/kt;if(e.sign&&Lt++,268435456<Lt)throw new Error("string too long");const jt=Array(Lt);let Kt=Lt-1,qt=0,zt=0;for(let Ht=0;Ht<At-1;Ht++){const Wt=e.__digit(Ht),Qt=(qt|Wt<<zt)&Bt;jt[Kt--]=JSBI.__kConversionChars[Qt];const Xt=kt-zt;for(qt=Wt>>>Xt,zt=30-Xt;zt>=kt;)jt[Kt--]=JSBI.__kConversionChars[qt&Bt],qt>>>=kt,zt-=kt}const Vt=(qt|Nt<<zt)&Bt;for(jt[Kt--]=JSBI.__kConversionChars[Vt],qt=Nt>>>kt-zt;qt!==0;)jt[Kt--]=JSBI.__kConversionChars[qt&Bt],qt>>>=kt;if(e.sign&&(jt[Kt--]="-"),Kt!=-1)throw new Error("implementation bug");return jt.join("")}static __toStringGeneric(e,_t,At){const xt=e.length;if(xt===0)return"";if(xt===1){let Ht=e.__unsignedDigit(0).toString(_t);return At===!1&&e.sign&&(Ht="-"+Ht),Ht}const kt=30*xt-JSBI.__clz30(e.__digit(xt-1)),Bt=JSBI.__kMaxBitsPerChar[_t],Nt=Bt-1;let Ut=kt*JSBI.__kBitsPerCharTableMultiplier;Ut+=Nt-1,Ut=0|Ut/Nt;const Lt=Ut+1>>1,jt=JSBI.exponentiate(JSBI.__oneDigit(_t,!1),JSBI.__oneDigit(Lt,!1));let Kt,qt;const zt=jt.__unsignedDigit(0);if(jt.length===1&&32767>=zt){Kt=new JSBI(e.length,!1),Kt.__initializeDigits();let Ht=0;for(let Wt=2*e.length-1;0<=Wt;Wt--){const Qt=Ht<<15|e.__halfDigit(Wt);Kt.__setHalfDigit(Wt,0|Qt/zt),Ht=0|Qt%zt}qt=Ht.toString(_t)}else{const Ht=JSBI.__absoluteDivLarge(e,jt,!0,!0);Kt=Ht.quotient;const Wt=Ht.remainder.__trim();qt=JSBI.__toStringGeneric(Wt,_t,!0)}Kt.__trim();let Vt=JSBI.__toStringGeneric(Kt,_t,!0);for(;qt.length<Lt;)qt="0"+qt;return At===!1&&e.sign&&(Vt="-"+Vt),Vt+qt}static __unequalSign(e){return e?-1:1}static __absoluteGreater(e){return e?-1:1}static __absoluteLess(e){return e?1:-1}static __compareToBigInt(e,_t){const At=e.sign;if(At!==_t.sign)return JSBI.__unequalSign(At);const xt=JSBI.__absoluteCompare(e,_t);return 0<xt?JSBI.__absoluteGreater(At):0>xt?JSBI.__absoluteLess(At):0}static __compareToNumber(e,_t){if(JSBI.__isOneDigitInt(_t)){const At=e.sign,xt=0>_t;if(At!==xt)return JSBI.__unequalSign(At);if(e.length===0){if(xt)throw new Error("implementation bug");return _t===0?0:-1}if(1<e.length)return JSBI.__absoluteGreater(At);const kt=Math.abs(_t),Bt=e.__unsignedDigit(0);return Bt>kt?JSBI.__absoluteGreater(At):Bt<kt?JSBI.__absoluteLess(At):0}return JSBI.__compareToDouble(e,_t)}static __compareToDouble(e,_t){if(_t!==_t)return _t;if(_t===1/0)return-1;if(_t===-1/0)return 1;const At=e.sign;if(At!==0>_t)return JSBI.__unequalSign(At);if(_t===0)throw new Error("implementation bug: should be handled elsewhere");if(e.length===0)return-1;JSBI.__kBitConversionDouble[0]=_t;const xt=2047&JSBI.__kBitConversionInts[1]>>>20;if(xt==2047)throw new Error("implementation bug: handled elsewhere");const kt=xt-1023;if(0>kt)return JSBI.__absoluteGreater(At);const Bt=e.length;let Nt=e.__digit(Bt-1);const Ut=JSBI.__clz30(Nt),Lt=30*Bt-Ut,jt=kt+1;if(Lt<jt)return JSBI.__absoluteLess(At);if(Lt>jt)return JSBI.__absoluteGreater(At);let Kt=1048576|1048575&JSBI.__kBitConversionInts[1],qt=JSBI.__kBitConversionInts[0];const zt=20,Vt=29-Ut;if(Vt!==(0|(Lt-1)%30))throw new Error("implementation bug");let Ht,Wt=0;if(20>Vt){const Qt=zt-Vt;Wt=Qt+32,Ht=Kt>>>Qt,Kt=Kt<<32-Qt|qt>>>Qt,qt<<=32-Qt}else if(Vt===20)Wt=32,Ht=Kt,Kt=qt,qt=0;else{const Qt=Vt-zt;Wt=32-Qt,Ht=Kt<<Qt|qt>>>32-Qt,Kt=qt<<Qt,qt=0}if(Nt>>>=0,Ht>>>=0,Nt>Ht)return JSBI.__absoluteGreater(At);if(Nt<Ht)return JSBI.__absoluteLess(At);for(let Qt=Bt-2;0<=Qt;Qt--){0<Wt?(Wt-=30,Ht=Kt>>>2,Kt=Kt<<30|qt>>>2,qt<<=30):Ht=0;const Xt=e.__unsignedDigit(Qt);if(Xt>Ht)return JSBI.__absoluteGreater(At);if(Xt<Ht)return JSBI.__absoluteLess(At)}if(Kt!==0||qt!==0){if(Wt===0)throw new Error("implementation bug");return JSBI.__absoluteLess(At)}return 0}static __equalToNumber(e,_t){var At=Math.abs;return JSBI.__isOneDigitInt(_t)?_t===0?e.length===0:e.length===1&&e.sign===0>_t&&e.__unsignedDigit(0)===At(_t):JSBI.__compareToDouble(e,_t)===0}static __comparisonResultToBool(e,_t){return _t===0?0>e:_t===1?0>=e:_t===2?0<e:_t===3?0<=e:void 0}static __compare(e,_t,At){if(e=JSBI.__toPrimitive(e),_t=JSBI.__toPrimitive(_t),typeof e=="string"&&typeof _t=="string")switch(At){case 0:return e<_t;case 1:return e<=_t;case 2:return e>_t;case 3:return e>=_t}if(JSBI.__isBigInt(e)&&typeof _t=="string")return _t=JSBI.__fromString(_t),_t!==null&&JSBI.__comparisonResultToBool(JSBI.__compareToBigInt(e,_t),At);if(typeof e=="string"&&JSBI.__isBigInt(_t))return e=JSBI.__fromString(e),e!==null&&JSBI.__comparisonResultToBool(JSBI.__compareToBigInt(e,_t),At);if(e=JSBI.__toNumeric(e),_t=JSBI.__toNumeric(_t),JSBI.__isBigInt(e)){if(JSBI.__isBigInt(_t))return JSBI.__comparisonResultToBool(JSBI.__compareToBigInt(e,_t),At);if(typeof _t!="number")throw new Error("implementation bug");return JSBI.__comparisonResultToBool(JSBI.__compareToNumber(e,_t),At)}if(typeof e!="number")throw new Error("implementation bug");if(JSBI.__isBigInt(_t))return JSBI.__comparisonResultToBool(JSBI.__compareToNumber(_t,e),2^At);if(typeof _t!="number")throw new Error("implementation bug");return At===0?e<_t:At===1?e<=_t:At===2?e>_t:At===3?e>=_t:void 0}__clzmsd(){return JSBI.__clz30(this.__digit(this.length-1))}static __absoluteAdd(e,_t,At){if(e.length<_t.length)return JSBI.__absoluteAdd(_t,e,At);if(e.length===0)return e;if(_t.length===0)return e.sign===At?e:JSBI.unaryMinus(e);let xt=e.length;(e.__clzmsd()===0||_t.length===e.length&&_t.__clzmsd()===0)&&xt++;const kt=new JSBI(xt,At);let Bt=0,Nt=0;for(;Nt<_t.length;Nt++){const Ut=e.__digit(Nt)+_t.__digit(Nt)+Bt;Bt=Ut>>>30,kt.__setDigit(Nt,1073741823&Ut)}for(;Nt<e.length;Nt++){const Ut=e.__digit(Nt)+Bt;Bt=Ut>>>30,kt.__setDigit(Nt,1073741823&Ut)}return Nt<kt.length&&kt.__setDigit(Nt,Bt),kt.__trim()}static __absoluteSub(e,_t,At){if(e.length===0)return e;if(_t.length===0)return e.sign===At?e:JSBI.unaryMinus(e);const xt=new JSBI(e.length,At);let kt=0,Bt=0;for(;Bt<_t.length;Bt++){const Nt=e.__digit(Bt)-_t.__digit(Bt)-kt;kt=1&Nt>>>30,xt.__setDigit(Bt,1073741823&Nt)}for(;Bt<e.length;Bt++){const Nt=e.__digit(Bt)-kt;kt=1&Nt>>>30,xt.__setDigit(Bt,1073741823&Nt)}return xt.__trim()}static __absoluteAddOne(e,_t,At=null){const xt=e.length;At===null?At=new JSBI(xt,_t):At.sign=_t;let kt=1;for(let Bt=0;Bt<xt;Bt++){const Nt=e.__digit(Bt)+kt;kt=Nt>>>30,At.__setDigit(Bt,1073741823&Nt)}return kt!=0&&At.__setDigitGrow(xt,1),At}static __absoluteSubOne(e,_t){const At=e.length;_t=_t||At;const xt=new JSBI(_t,!1);let kt=1;for(let Bt=0;Bt<At;Bt++){const Nt=e.__digit(Bt)-kt;kt=1&Nt>>>30,xt.__setDigit(Bt,1073741823&Nt)}if(kt!=0)throw new Error("implementation bug");for(let Bt=At;Bt<_t;Bt++)xt.__setDigit(Bt,0);return xt}static __absoluteAnd(e,_t,At=null){let xt=e.length,kt=_t.length,Bt=kt;if(xt<kt){Bt=xt;const Lt=e,jt=xt;e=_t,xt=kt,_t=Lt,kt=jt}let Nt=Bt;At===null?At=new JSBI(Nt,!1):Nt=At.length;let Ut=0;for(;Ut<Bt;Ut++)At.__setDigit(Ut,e.__digit(Ut)&_t.__digit(Ut));for(;Ut<Nt;Ut++)At.__setDigit(Ut,0);return At}static __absoluteAndNot(e,_t,At=null){const xt=e.length,kt=_t.length;let Bt=kt;xt<kt&&(Bt=xt);let Nt=xt;At===null?At=new JSBI(Nt,!1):Nt=At.length;let Ut=0;for(;Ut<Bt;Ut++)At.__setDigit(Ut,e.__digit(Ut)&~_t.__digit(Ut));for(;Ut<xt;Ut++)At.__setDigit(Ut,e.__digit(Ut));for(;Ut<Nt;Ut++)At.__setDigit(Ut,0);return At}static __absoluteOr(e,_t,At=null){let xt=e.length,kt=_t.length,Bt=kt;if(xt<kt){Bt=xt;const Lt=e,jt=xt;e=_t,xt=kt,_t=Lt,kt=jt}let Nt=xt;At===null?At=new JSBI(Nt,!1):Nt=At.length;let Ut=0;for(;Ut<Bt;Ut++)At.__setDigit(Ut,e.__digit(Ut)|_t.__digit(Ut));for(;Ut<xt;Ut++)At.__setDigit(Ut,e.__digit(Ut));for(;Ut<Nt;Ut++)At.__setDigit(Ut,0);return At}static __absoluteXor(e,_t,At=null){let xt=e.length,kt=_t.length,Bt=kt;if(xt<kt){Bt=xt;const Lt=e,jt=xt;e=_t,xt=kt,_t=Lt,kt=jt}let Nt=xt;At===null?At=new JSBI(Nt,!1):Nt=At.length;let Ut=0;for(;Ut<Bt;Ut++)At.__setDigit(Ut,e.__digit(Ut)^_t.__digit(Ut));for(;Ut<xt;Ut++)At.__setDigit(Ut,e.__digit(Ut));for(;Ut<Nt;Ut++)At.__setDigit(Ut,0);return At}static __absoluteCompare(e,_t){const At=e.length-_t.length;if(At!=0)return At;let xt=e.length-1;for(;0<=xt&&e.__digit(xt)===_t.__digit(xt);)xt--;return 0>xt?0:e.__unsignedDigit(xt)>_t.__unsignedDigit(xt)?1:-1}static __multiplyAccumulate(e,_t,At,xt){if(_t===0)return;const kt=32767&_t,Bt=_t>>>15;let Nt=0,Ut=0;for(let Lt,jt=0;jt<e.length;jt++,xt++){Lt=At.__digit(xt);const Kt=e.__digit(jt),qt=32767&Kt,zt=Kt>>>15,Vt=JSBI.__imul(qt,kt),Ht=JSBI.__imul(qt,Bt),Wt=JSBI.__imul(zt,kt),Qt=JSBI.__imul(zt,Bt);Lt+=Ut+Vt+Nt,Nt=Lt>>>30,Lt&=1073741823,Lt+=((32767&Ht)<<15)+((32767&Wt)<<15),Nt+=Lt>>>30,Ut=Qt+(Ht>>>15)+(Wt>>>15),At.__setDigit(xt,1073741823&Lt)}for(;Nt!=0||Ut!==0;xt++){let Lt=At.__digit(xt);Lt+=Nt+Ut,Ut=0,Nt=Lt>>>30,At.__setDigit(xt,1073741823&Lt)}}static __internalMultiplyAdd(e,_t,At,xt,kt){let Bt=At,Nt=0;for(let Ut=0;Ut<xt;Ut++){const Lt=e.__digit(Ut),jt=JSBI.__imul(32767&Lt,_t),Kt=JSBI.__imul(Lt>>>15,_t),qt=jt+((32767&Kt)<<15)+Nt+Bt;Bt=qt>>>30,Nt=Kt>>>15,kt.__setDigit(Ut,1073741823&qt)}if(kt.length>xt)for(kt.__setDigit(xt++,Bt+Nt);xt<kt.length;)kt.__setDigit(xt++,0);else if(Bt+Nt!==0)throw new Error("implementation bug")}__inplaceMultiplyAdd(e,_t,At){At>this.length&&(At=this.length);const xt=32767&e,kt=e>>>15;let Bt=0,Nt=_t;for(let Ut=0;Ut<At;Ut++){const Lt=this.__digit(Ut),jt=32767&Lt,Kt=Lt>>>15,qt=JSBI.__imul(jt,xt),zt=JSBI.__imul(jt,kt),Vt=JSBI.__imul(Kt,xt),Ht=JSBI.__imul(Kt,kt);let Wt=Nt+qt+Bt;Bt=Wt>>>30,Wt&=1073741823,Wt+=((32767&zt)<<15)+((32767&Vt)<<15),Bt+=Wt>>>30,Nt=Ht+(zt>>>15)+(Vt>>>15),this.__setDigit(Ut,1073741823&Wt)}if(Bt!=0||Nt!==0)throw new Error("implementation bug")}static __absoluteDivSmall(e,_t,At=null){At===null&&(At=new JSBI(e.length,!1));let xt=0;for(let kt,Bt=2*e.length-1;0<=Bt;Bt-=2){kt=(xt<<15|e.__halfDigit(Bt))>>>0;const Nt=0|kt/_t;xt=0|kt%_t,kt=(xt<<15|e.__halfDigit(Bt-1))>>>0;const Ut=0|kt/_t;xt=0|kt%_t,At.__setDigit(Bt>>>1,Nt<<15|Ut)}return At}static __absoluteModSmall(e,_t){let At=0;for(let xt=2*e.length-1;0<=xt;xt--)At=0|((At<<15|e.__halfDigit(xt))>>>0)%_t;return At}static __absoluteDivLarge(e,_t,At,xt){const kt=_t.__halfDigitLength(),Bt=_t.length,Nt=e.__halfDigitLength()-kt;let Ut=null;At&&(Ut=new JSBI(Nt+2>>>1,!1),Ut.__initializeDigits());const Lt=new JSBI(kt+2>>>1,!1);Lt.__initializeDigits();const jt=JSBI.__clz15(_t.__halfDigit(kt-1));0<jt&&(_t=JSBI.__specialLeftShift(_t,jt,0));const Kt=JSBI.__specialLeftShift(e,jt,1),qt=_t.__halfDigit(kt-1);let zt=0;for(let Vt,Ht=Nt;0<=Ht;Ht--){Vt=32767;const Wt=Kt.__halfDigit(Ht+kt);if(Wt!==qt){const Xt=(Wt<<15|Kt.__halfDigit(Ht+kt-1))>>>0;Vt=0|Xt/qt;let Jt=0|Xt%qt;const tr=_t.__halfDigit(kt-2),dr=Kt.__halfDigit(Ht+kt-2);for(;JSBI.__imul(Vt,tr)>>>0>(Jt<<16|dr)>>>0&&(Vt--,Jt+=qt,!(32767<Jt)););}JSBI.__internalMultiplyAdd(_t,Vt,0,Bt,Lt);let Qt=Kt.__inplaceSub(Lt,Ht,kt+1);Qt!==0&&(Qt=Kt.__inplaceAdd(_t,Ht,kt),Kt.__setHalfDigit(Ht+kt,32767&Kt.__halfDigit(Ht+kt)+Qt),Vt--),At&&(1&Ht?zt=Vt<<15:Ut.__setDigit(Ht>>>1,zt|Vt))}if(xt)return Kt.__inplaceRightShift(jt),At?{quotient:Ut,remainder:Kt}:Kt;if(At)return Ut;throw new Error("unreachable")}static __clz15(e){return JSBI.__clz30(e)-15}__inplaceAdd(e,_t,At){let xt=0;for(let kt=0;kt<At;kt++){const Bt=this.__halfDigit(_t+kt)+e.__halfDigit(kt)+xt;xt=Bt>>>15,this.__setHalfDigit(_t+kt,32767&Bt)}return xt}__inplaceSub(e,_t,At){let xt=0;if(1&_t){_t>>=1;let kt=this.__digit(_t),Bt=32767&kt,Nt=0;for(;Nt<At-1>>>1;Nt++){const jt=e.__digit(Nt),Kt=(kt>>>15)-(32767&jt)-xt;xt=1&Kt>>>15,this.__setDigit(_t+Nt,(32767&Kt)<<15|32767&Bt),kt=this.__digit(_t+Nt+1),Bt=(32767&kt)-(jt>>>15)-xt,xt=1&Bt>>>15}const Ut=e.__digit(Nt),Lt=(kt>>>15)-(32767&Ut)-xt;if(xt=1&Lt>>>15,this.__setDigit(_t+Nt,(32767&Lt)<<15|32767&Bt),_t+Nt+1>=this.length)throw new RangeError("out of bounds");!(1&At)&&(kt=this.__digit(_t+Nt+1),Bt=(32767&kt)-(Ut>>>15)-xt,xt=1&Bt>>>15,this.__setDigit(_t+e.length,1073709056&kt|32767&Bt))}else{_t>>=1;let kt=0;for(;kt<e.length-1;kt++){const jt=this.__digit(_t+kt),Kt=e.__digit(kt),qt=(32767&jt)-(32767&Kt)-xt;xt=1&qt>>>15;const zt=(jt>>>15)-(Kt>>>15)-xt;xt=1&zt>>>15,this.__setDigit(_t+kt,(32767&zt)<<15|32767&qt)}const Bt=this.__digit(_t+kt),Nt=e.__digit(kt),Ut=(32767&Bt)-(32767&Nt)-xt;xt=1&Ut>>>15;let Lt=0;!(1&At)&&(Lt=(Bt>>>15)-(Nt>>>15)-xt,xt=1&Lt>>>15),this.__setDigit(_t+kt,(32767&Lt)<<15|32767&Ut)}return xt}__inplaceRightShift(e){if(e===0)return;let _t=this.__digit(0)>>>e;const At=this.length-1;for(let xt=0;xt<At;xt++){const kt=this.__digit(xt+1);this.__setDigit(xt,1073741823&kt<<30-e|_t),_t=kt>>>e}this.__setDigit(At,_t)}static __specialLeftShift(e,_t,At){const xt=e.length,kt=new JSBI(xt+At,!1);if(_t===0){for(let Nt=0;Nt<xt;Nt++)kt.__setDigit(Nt,e.__digit(Nt));return 0<At&&kt.__setDigit(xt,0),kt}let Bt=0;for(let Nt=0;Nt<xt;Nt++){const Ut=e.__digit(Nt);kt.__setDigit(Nt,1073741823&Ut<<_t|Bt),Bt=Ut>>>30-_t}return 0<At&&kt.__setDigit(xt,Bt),kt}static __leftShiftByAbsolute(e,_t){const At=JSBI.__toShiftAmount(_t);if(0>At)throw new RangeError("BigInt too big");const xt=0|At/30,kt=At%30,Bt=e.length,Nt=kt!==0&&e.__digit(Bt-1)>>>30-kt!=0,Ut=Bt+xt+(Nt?1:0),Lt=new JSBI(Ut,e.sign);if(kt===0){let jt=0;for(;jt<xt;jt++)Lt.__setDigit(jt,0);for(;jt<Ut;jt++)Lt.__setDigit(jt,e.__digit(jt-xt))}else{let jt=0;for(let Kt=0;Kt<xt;Kt++)Lt.__setDigit(Kt,0);for(let Kt=0;Kt<Bt;Kt++){const qt=e.__digit(Kt);Lt.__setDigit(Kt+xt,1073741823&qt<<kt|jt),jt=qt>>>30-kt}if(Nt)Lt.__setDigit(Bt+xt,jt);else if(jt!==0)throw new Error("implementation bug")}return Lt.__trim()}static __rightShiftByAbsolute(e,_t){const At=e.length,xt=e.sign,kt=JSBI.__toShiftAmount(_t);if(0>kt)return JSBI.__rightShiftByMaximum(xt);const Bt=0|kt/30,Nt=kt%30;let Ut=At-Bt;if(0>=Ut)return JSBI.__rightShiftByMaximum(xt);let Lt=!1;if(xt){if(e.__digit(Bt)&(1<<Nt)-1)Lt=!0;else for(let Kt=0;Kt<Bt;Kt++)if(e.__digit(Kt)!==0){Lt=!0;break}}Lt&&Nt===0&&!~e.__digit(At-1)&&Ut++;let jt=new JSBI(Ut,xt);if(Nt===0){jt.__setDigit(Ut-1,0);for(let Kt=Bt;Kt<At;Kt++)jt.__setDigit(Kt-Bt,e.__digit(Kt))}else{let Kt=e.__digit(Bt)>>>Nt;const qt=At-Bt-1;for(let zt=0;zt<qt;zt++){const Vt=e.__digit(zt+Bt+1);jt.__setDigit(zt,1073741823&Vt<<30-Nt|Kt),Kt=Vt>>>Nt}jt.__setDigit(qt,Kt)}return Lt&&(jt=JSBI.__absoluteAddOne(jt,!0,jt)),jt.__trim()}static __rightShiftByMaximum(e){return e?JSBI.__oneDigit(1,!0):JSBI.__zero()}static __toShiftAmount(e){if(1<e.length)return-1;const _t=e.__unsignedDigit(0);return _t>JSBI.__kMaxLengthBits?-1:_t}static __toPrimitive(e,_t="default"){if(typeof e!="object"||e.constructor===JSBI)return e;if(typeof Symbol<"u"&&typeof Symbol.toPrimitive=="symbol"){const kt=e[Symbol.toPrimitive];if(kt){const Bt=kt(_t);if(typeof Bt!="object")return Bt;throw new TypeError("Cannot convert object to primitive value")}}const At=e.valueOf;if(At){const kt=At.call(e);if(typeof kt!="object")return kt}const xt=e.toString;if(xt){const kt=xt.call(e);if(typeof kt!="object")return kt}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(e){return JSBI.__isBigInt(e)?e:+e}static __isBigInt(e){return typeof e=="object"&&e!==null&&e.constructor===JSBI}static __truncateToNBits(e,_t){const At=0|(e+29)/30,xt=new JSBI(At,_t.sign),kt=At-1;for(let Nt=0;Nt<kt;Nt++)xt.__setDigit(Nt,_t.__digit(Nt));let Bt=_t.__digit(kt);if(e%30!=0){const Nt=32-e%30;Bt=Bt<<Nt>>>Nt}return xt.__setDigit(kt,Bt),xt.__trim()}static __truncateAndSubFromPowerOfTwo(e,_t,At){var xt=Math.min;const kt=0|(e+29)/30,Bt=new JSBI(kt,At);let Nt=0;const Ut=kt-1;let Lt=0;for(const zt=xt(Ut,_t.length);Nt<zt;Nt++){const Vt=0-_t.__digit(Nt)-Lt;Lt=1&Vt>>>30,Bt.__setDigit(Nt,1073741823&Vt)}for(;Nt<Ut;Nt++)Bt.__setDigit(Nt,0|1073741823&-Lt);let jt=Ut<_t.length?_t.__digit(Ut):0;const Kt=e%30;let qt;if(Kt==0)qt=0-jt-Lt,qt&=1073741823;else{const zt=32-Kt;jt=jt<<zt>>>zt;const Vt=1<<32-zt;qt=Vt-jt-Lt,qt&=Vt-1}return Bt.__setDigit(Ut,qt),Bt.__trim()}__digit(e){return this[e]}__unsignedDigit(e){return this[e]>>>0}__setDigit(e,_t){this[e]=0|_t}__setDigitGrow(e,_t){this[e]=0|_t}__halfDigitLength(){const e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}__halfDigit(e){return 32767&this[e>>>1]>>>15*(1&e)}__setHalfDigit(e,_t){const At=e>>>1,xt=this.__digit(At),kt=1&e?32767&xt|_t<<15:1073709056&xt|32767&_t;this.__setDigit(At,kt)}static __digitPow(e,_t){let At=1;for(;0<_t;)1&_t&&(At*=e),_t>>>=1,e*=e;return At}static __isOneDigitInt(e){return(1073741823&e)===e}}JSBI.__kMaxLength=33554432,JSBI.__kMaxLengthBits=JSBI.__kMaxLength<<5,JSBI.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],JSBI.__kBitsPerCharTableShift=5,JSBI.__kBitsPerCharTableMultiplier=1<<JSBI.__kBitsPerCharTableShift,JSBI.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],JSBI.__kBitConversionBuffer=new ArrayBuffer(8),JSBI.__kBitConversionDouble=new Float64Array(JSBI.__kBitConversionBuffer),JSBI.__kBitConversionInts=new Int32Array(JSBI.__kBitConversionBuffer),JSBI.__clz30=Math.clz32?function($t){return Math.clz32($t)-2}:function($t){return $t===0?30:0|29-(0|Math.log($t>>>0)/Math.LN2)},JSBI.__imul=Math.imul||function($t,e){return 0|$t*e};const t={};function MakeIntrinsicClass($t,e){Object.defineProperty($t.prototype,Symbol.toStringTag,{value:e,writable:!1,enumerable:!1,configurable:!0});for(const _t of Object.getOwnPropertyNames($t)){const At=Object.getOwnPropertyDescriptor($t,_t);At.configurable&&At.enumerable&&(At.enumerable=!1,Object.defineProperty($t,_t,At))}for(const _t of Object.getOwnPropertyNames($t.prototype)){const At=Object.getOwnPropertyDescriptor($t.prototype,_t);At.configurable&&At.enumerable&&(At.enumerable=!1,Object.defineProperty($t.prototype,_t,At))}DefineIntrinsic(e,$t),DefineIntrinsic(`${e}.prototype`,$t.prototype)}function DefineIntrinsic($t,e){const _t=`%${$t}%`;if(t[_t]!==void 0)throw new Error(`intrinsic ${$t} already exists`);t[_t]=e}function GetIntrinsic($t){return t[$t]}var r,o;const n="slot-epochNanoSeconds",a="slot-timezone-identifier",i$1="slot-year",s$1="slot-month",l="slot-day",d$1="slot-hour",m$1="slot-minute",c="slot-second",h$1="slot-millisecond",u="slot-microsecond",T="slot-nanosecond",p="slot-calendar",f$1="slot-date-brand",y$1="slot-year-month-brand",I="slot-month-day-brand",S="slot-cached-instant",g="slot-time-zone",w$1="slot-years",D="slot-months",G="slot-weeks",v="slot-days",C="slot-hours",O="slot-minutes",b="slot-seconds",E$1="slot-milliseconds",M="slot-microseconds",R="slot-nanoseconds",F="slot-calendar-identifier",Y=new WeakMap,P=Symbol.for("@@Temporal__GetSlots");(r=globalThis)[P]||(r[P]=function $t(e){return Y.get(e)});const Z=globalThis[P],B=Symbol.for("@@Temporal__CreateSlots");(o=globalThis)[B]||(o[B]=function $t(e){Y.set(e,Object.create(null))});const N=globalThis[B];function HasSlot($t,...e){if(!$t||typeof $t!="object")return!1;const _t=Z($t);return!!_t&&e.every(At=>At in _t)}function GetSlot($t,e){var At;const _t=(At=Z($t))==null?void 0:At[e];if(_t===void 0)throw new TypeError(`Missing internal slot ${e}`);return _t}function SetSlot($t,e,_t){const At=Z($t);if(At===void 0)throw new TypeError("Missing slots for the given container");if(At[e])throw new TypeError(`${e} already has set`);At[e]=_t}const j=/\.[-A-Za-z_]|\.\.[-A-Za-z._]{1,12}|\.[-A-Za-z_][-A-Za-z._]{0,12}|[A-Za-z_][-A-Za-z._]{0,13}/,$=new RegExp("(?:"+[`(?:${j.source})(?:\\/(?:${j.source}))*`,"Etc/GMT(?:0|[-+]\\d{1,2})","GMT[-+]?0","EST5EDT","CST6CDT","MST7MDT","PST8PDT",/(?:[+\u2212-][0-2][0-9](?::?[0-5][0-9](?::?[0-5][0-9](?:[.,]\d{1,9})?)?)?)/.source].join("|")+")"),k=/(?:[+\u2212-]\d{6}|\d{4})/,U=/(?:0[1-9]|1[0-2])/,A=/(?:0[1-9]|[12]\d|3[01])/,L=new RegExp(`(${k.source})(?:-(${U.source})-(${A.source})|(${U.source})(${A.source}))`),x=/(\d{2})(?::(\d{2})(?::(\d{2})(?:[.,](\d{1,9}))?)?|(\d{2})(?:(\d{2})(?:[.,](\d{1,9}))?)?)?/,W=/([+\u2212-])([01][0-9]|2[0-3])(?::?([0-5][0-9])(?::?([0-5][0-9])(?:[.,](\d{1,9}))?)?)?/,q=new RegExp(`([zZ])|${W.source}?`),H=/\[(!)?([a-z_][a-z0-9_-]*)=([A-Za-z0-9]+(?:-[A-Za-z0-9]+)*)\]/g,V=new RegExp([`^${L.source}`,`(?:(?:T|\\s+)${x.source}(?:${q.source})?)?`,`(?:\\[!?(${$.source})\\])?`,`((?:${H.source})*)$`].join(""),"i"),z=new RegExp([`^T?${x.source}`,`(?:${q.source})?`,`(?:\\[!?${$.source}\\])?`,`((?:${H.source})*)$`].join(""),"i"),_=new RegExp(`^(${k.source})-?(${U.source})(?:\\[!?${$.source}\\])?((?:${H.source})*)$`),J=new RegExp(`^(?:--)?(${U.source})-?(${A.source})(?:\\[!?${$.source}\\])?((?:${H.source})*)$`),K=/(\d+)(?:[.,](\d{1,9}))?/,X=new RegExp(`(?:${K.source}H)?(?:${K.source}M)?(?:${K.source}S)?`),Q=new RegExp(`^([+-])?P${/(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?/.source}(?:T(?!$)${X.source})?$`,"i"),ee=Array.prototype.includes,te=Array.prototype.push,re=globalThis.Intl.DateTimeFormat,oe=Math.min,ne=Math.max,ae=Math.abs,ie=Math.floor,se=Math.sign,le=Math.trunc,de=Number.isNaN,me=Number.isFinite,ce=Number,he=String,ue=Number.MAX_SAFE_INTEGER,Te=Object.create,pe=Object.getOwnPropertyDescriptor,fe=Reflect.apply,ye=Reflect.ownKeys,Ie=JSBI.BigInt(0),Se=JSBI.BigInt(1),ge=JSBI.BigInt(60),we=JSBI.BigInt(24),De=JSBI.BigInt(1e3),Ge=JSBI.BigInt(1e6),ve=JSBI.BigInt(1e9),Ce=JSBI.BigInt(-1),Oe=JSBI.multiply(JSBI.BigInt(3600),ve),be=JSBI.multiply(ge,ve),Ee=JSBI.multiply(Oe,we),Me=JSBI.multiply(JSBI.BigInt(-86400),JSBI.BigInt(1e17)),Re=JSBI.multiply(JSBI.BigInt(86400),JSBI.BigInt(1e17)),Fe=-271821,Ye=275760,Pe=JSBI.multiply(JSBI.BigInt(-388152),JSBI.BigInt(1e13)),Ze=JSBI.multiply(Ee,JSBI.BigInt(3660)),Be=JSBI.multiply(Ee,JSBI.BigInt(366)),Ne=JSBI.multiply(Ee,JSBI.BigInt(14)),je=["iso8601","hebrew","islamic","islamic-umalqura","islamic-tbla","islamic-civil","islamic-rgsa","islamicc","persian","ethiopic","ethioaa","coptic","chinese","dangi","roc","indian","buddhist","japanese","gregory"];function isZero($t){return JSBI.equal($t,Ie)}function GetMethod($t,e){const _t=$t[e];if(_t!==void 0)return _t}function Call($t,e,_t){const At=arguments.length>2?_t:[];return fe($t,e,At)}function IsObject($t){return typeof $t=="object"&&$t!==null||typeof $t=="function"}function ToNumber($t){if(typeof $t=="bigint")throw new TypeError("Cannot convert BigInt to number");return ce($t)}function ToIntegerOrInfinity($t){const e=ToNumber($t);if(de(e)||e===0)return 0;if(!me(e))return e;const _t=ie(ae(e));return _t===0?0:se(e)*_t}function IsIntegralNumber($t){if(typeof $t!="number"||de($t)||!me($t))return!1;const e=ae($t);return ie(e)===e}function ToString($t){if(typeof $t=="symbol")throw new TypeError("Cannot convert a Symbol value to a String");return he($t)}function ToIntegerWithTruncation($t){const e=ToNumber($t);if(e===0)return 0;if(de(e)||!me(e))throw new RangeError("invalid number value");const _t=le(e);return _t===0?0:_t}function ToPositiveIntegerWithTruncation($t,e){const _t=ToIntegerWithTruncation($t);if(_t<=0)throw e!==void 0?new RangeError(`property '${e}' cannot be a a number less than one`):new RangeError("Cannot convert a number less than one to a positive integer");return _t}function ToIntegerIfIntegral($t){const e=ToNumber($t);if(!me(e))throw new RangeError("infinity is out of range");if(!IsIntegralNumber(e))throw new RangeError(`unsupported fractional value ${$t}`);return e===0?0:e}function divmod($t,e){return{quotient:JSBI.divide($t,e),remainder:JSBI.remainder($t,e)}}function isNegativeJSBI($t){return JSBI.lessThan($t,Ie)}function signJSBI($t){return isZero($t)?0:isNegativeJSBI($t)?-1:1}function abs($t){return JSBI.lessThan($t,Ie)?JSBI.multiply($t,Ce):$t}const $e=new Map([["year",ToIntegerWithTruncation],["month",ToPositiveIntegerWithTruncation],["monthCode",ToString],["day",ToPositiveIntegerWithTruncation],["hour",ToIntegerWithTruncation],["minute",ToIntegerWithTruncation],["second",ToIntegerWithTruncation],["millisecond",ToIntegerWithTruncation],["microsecond",ToIntegerWithTruncation],["nanosecond",ToIntegerWithTruncation],["years",ToIntegerIfIntegral],["months",ToIntegerIfIntegral],["weeks",ToIntegerIfIntegral],["days",ToIntegerIfIntegral],["hours",ToIntegerIfIntegral],["minutes",ToIntegerIfIntegral],["seconds",ToIntegerIfIntegral],["milliseconds",ToIntegerIfIntegral],["microseconds",ToIntegerIfIntegral],["nanoseconds",ToIntegerIfIntegral],["era",ToString],["eraYear",ToIntegerOrInfinity],["offset",ToString]]),ke=new Map([["hour",0],["minute",0],["second",0],["millisecond",0],["microsecond",0],["nanosecond",0]]),Ue=[["years","year","date"],["months","month","date"],["weeks","week","date"],["days","day","date"],["hours","hour","time"],["minutes","minute","time"],["seconds","second","time"],["milliseconds","millisecond","time"],["microseconds","microsecond","time"],["nanoseconds","nanosecond","time"]],Ae=new Map(Ue.map($t=>[$t[0],$t[1]])),Le=new Map(Ue.map(([$t,e])=>[e,$t])),xe=Ue.map(([,$t])=>$t),We=Array.from(Ae.keys()).sort(),qe=new Map;function getIntlDateTimeFormatEnUsForTimeZone($t){let e=qe.get($t);return e===void 0&&(e=new re("en-us",{timeZone:he($t),hour12:!1,era:"short",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),qe.set($t,e)),e}function ToObject($t){if($t==null)throw new TypeError(`Expected object not ${$t}`);return Object($t)}function CopyDataProperties($t,e,_t,At){if(e==null)return;const xt=ye(e);for(const kt of xt)if(!_t.some(Bt=>Object.is(Bt,kt))&&Object.prototype.propertyIsEnumerable.call(e,kt)){const Bt=e[kt];if(At&&At.some(Nt=>Object.is(Nt,Bt)))continue;$t[kt]=Bt}}function IsTemporalInstant($t){return HasSlot($t,n)&&!HasSlot($t,g,p)}function IsTemporalTimeZone($t){return HasSlot($t,a)}function IsTemporalCalendar($t){return HasSlot($t,F)}function IsTemporalDuration($t){return HasSlot($t,w$1,D,v,C,O,b,E$1,M,R)}function IsTemporalDate($t){return HasSlot($t,f$1)}function IsTemporalTime($t){return HasSlot($t,d$1,m$1,c,h$1,u,T)&&!HasSlot($t,i$1,s$1,l)}function IsTemporalDateTime($t){return HasSlot($t,i$1,s$1,l,d$1,m$1,c,h$1,u,T)}function IsTemporalYearMonth($t){return HasSlot($t,y$1)}function IsTemporalMonthDay($t){return HasSlot($t,I)}function IsTemporalZonedDateTime($t){return HasSlot($t,n,g,p)}function RejectTemporalLikeObject($t){if(HasSlot($t,p)||HasSlot($t,g))throw new TypeError("with() does not support a calendar or timeZone property");if(IsTemporalTime($t))throw new TypeError("with() does not accept Temporal.PlainTime, use withPlainTime() instead");if($t.calendar!==void 0)throw new TypeError("with() does not support a calendar property");if($t.timeZone!==void 0)throw new TypeError("with() does not support a timeZone property")}function ParseTemporalTimeZone($t){const{ianaName:e,offset:_t,z:At}=function(kt){if(new RegExp(`^${$.source}$`,"i").test(kt))return{ianaName:kt};try{const Bt=ParseISODateTime(kt);if(Bt.z||Bt.offset||Bt.ianaName)return Bt}catch{}throw new RangeError(`Invalid time zone: ${kt}`)}($t);return e?GetCanonicalTimeZoneIdentifier(e):At?"UTC":FormatTimeZoneOffsetString(ParseTimeZoneOffsetString(_t))}function MaybeFormatCalendarAnnotation($t,e){return e==="never"?"":FormatCalendarAnnotation(ToTemporalCalendarIdentifier($t),e)}function FormatCalendarAnnotation($t,e){return e==="never"||e==="auto"&&$t==="iso8601"?"":`[${e==="critical"?"!":""}u-ca=${$t}]`}function ParseISODateTime($t){const e=V.exec($t);if(!e)throw new RangeError(`invalid ISO 8601 string: ${$t}`);let _t=e[1];if(_t[0]===""&&(_t=`-${_t.slice(1)}`),_t==="-000000")throw new RangeError(`invalid ISO 8601 string: ${$t}`);const At=ToIntegerOrInfinity(_t),xt=ToIntegerOrInfinity(e[2]||e[4]),kt=ToIntegerOrInfinity(e[3]||e[5]),Bt=ToIntegerOrInfinity(e[6]),Nt=e[6]!==void 0,Ut=ToIntegerOrInfinity(e[7]||e[10]);let Lt=ToIntegerOrInfinity(e[8]||e[11]);Lt===60&&(Lt=59);const jt=(e[9]||e[12])+"000000000",Kt=ToIntegerOrInfinity(jt.slice(0,3)),qt=ToIntegerOrInfinity(jt.slice(3,6)),zt=ToIntegerOrInfinity(jt.slice(6,9));let Vt,Ht=!1;if(e[13])Vt=void 0,Ht=!0;else if(e[14]&&e[15]){const Jt=e[14]==="-"||e[14]===""?"-":"+",tr=e[15]||"00",dr=e[16]||"00",vr=e[17]||"00";let $r=e[18]||"0";if(Vt=`${Jt}${tr}:${dr}`,+$r){for(;$r.endsWith("0");)$r=$r.slice(0,-1);Vt+=`:${vr}.${$r}`}else+vr&&(Vt+=`:${vr}`);Vt==="-00:00"&&(Vt="+00:00")}const Wt=e[19],Qt=e[20];let Xt;for(const[,Jt,tr,dr]of Qt.matchAll(H))if(tr==="u-ca")Xt===void 0&&(Xt=dr);else if(Jt==="!")throw new RangeError(`Unrecognized annotation: !${tr}=${dr}`);return RejectDateTime(At,xt,kt,Bt,Ut,Lt,Kt,qt,zt),{year:At,month:xt,day:kt,hasTime:Nt,hour:Bt,minute:Ut,second:Lt,millisecond:Kt,microsecond:qt,nanosecond:zt,ianaName:Wt,offset:Vt,z:Ht,calendar:Xt}}function ParseTemporalYearMonthString($t){const e=_.exec($t);let _t,At,xt,kt;if(e){let Bt=e[1];if(Bt[0]===""&&(Bt=`-${Bt.slice(1)}`),Bt==="-000000")throw new RangeError(`invalid ISO 8601 string: ${$t}`);_t=ToIntegerOrInfinity(Bt),At=ToIntegerOrInfinity(e[2]);const Nt=e[3];for(const[,Ut,Lt,jt]of Nt.matchAll(H))if(Lt==="u-ca")xt===void 0&&(xt=jt);else if(Ut==="!")throw new RangeError(`Unrecognized annotation: !${Lt}=${jt}`);if(xt!==void 0&&xt!=="iso8601")throw new RangeError("YYYY-MM format is only valid with iso8601 calendar")}else{let Bt;if({year:_t,month:At,calendar:xt,day:kt,z:Bt}=ParseISODateTime($t),Bt)throw new RangeError("Z designator not supported for PlainYearMonth")}return{year:_t,month:At,calendar:xt,referenceISODay:kt}}function ParseTemporalMonthDayString($t){const e=J.exec($t);let _t,At,xt,kt;if(e){_t=ToIntegerOrInfinity(e[1]),At=ToIntegerOrInfinity(e[2]);const Bt=e[3];for(const[,Nt,Ut,Lt]of Bt.matchAll(H))if(Ut==="u-ca")xt===void 0&&(xt=Lt);else if(Nt==="!")throw new RangeError(`Unrecognized annotation: !${Ut}=${Lt}`);if(xt!==void 0&&xt!=="iso8601")throw new RangeError("MM-DD format is only valid with iso8601 calendar")}else{let Bt;if({month:_t,day:At,calendar:xt,year:kt,z:Bt}=ParseISODateTime($t),Bt)throw new RangeError("Z designator not supported for PlainMonthDay")}return{month:_t,day:At,calendar:xt,referenceISOYear:kt}}function ParseTemporalInstant($t){let{year:e,month:_t,day:At,hour:xt,minute:kt,second:Bt,millisecond:Nt,microsecond:Ut,nanosecond:Lt,offset:jt,z:Kt}=function(Ht){const Wt=ParseISODateTime(Ht);if(!Wt.z&&!Wt.offset)throw new RangeError("Temporal.Instant requires a time zone offset");return Wt}($t);if(!Kt&&!jt)throw new RangeError("Temporal.Instant requires a time zone offset");const qt=Kt?0:ParseTimeZoneOffsetString(jt);({year:e,month:_t,day:At,hour:xt,minute:kt,second:Bt,millisecond:Nt,microsecond:Ut,nanosecond:Lt}=BalanceISODateTime(e,_t,At,xt,kt,Bt,Nt,Ut,Lt-qt));const zt=GetUTCEpochNanoseconds(e,_t,At,xt,kt,Bt,Nt,Ut,Lt);if(zt===null)throw new RangeError("DateTime outside of supported range");return zt}function RegulateISODate($t,e,_t,At){let xt=$t,kt=e,Bt=_t;switch(At){case"reject":RejectISODate(xt,kt,Bt);break;case"constrain":({year:xt,month:kt,day:Bt}=ConstrainISODate(xt,kt,Bt))}return{year:xt,month:kt,day:Bt}}function RegulateTime($t,e,_t,At,xt,kt,Bt){let Nt=$t,Ut=e,Lt=_t,jt=At,Kt=xt,qt=kt;switch(Bt){case"reject":RejectTime(Nt,Ut,Lt,jt,Kt,qt);break;case"constrain":({hour:Nt,minute:Ut,second:Lt,millisecond:jt,microsecond:Kt,nanosecond:qt}=function(Vt,Ht,Wt,Qt,Xt,Jt){const tr=ConstrainToRange(Vt,0,23),dr=ConstrainToRange(Ht,0,59),vr=ConstrainToRange(Wt,0,59),$r=ConstrainToRange(Qt,0,999),Ir=ConstrainToRange(Xt,0,999),Rr=ConstrainToRange(Jt,0,999);return{hour:tr,minute:dr,second:vr,millisecond:$r,microsecond:Ir,nanosecond:Rr}}(Nt,Ut,Lt,jt,Kt,qt))}return{hour:Nt,minute:Ut,second:Lt,millisecond:jt,microsecond:Kt,nanosecond:qt}}function ToTemporalDurationRecord($t){if(!IsObject($t))return function(Vt){const Ht=Q.exec(Vt);if(!Ht)throw new RangeError(`invalid duration: ${Vt}`);if(Ht.slice(2).every(fr=>fr===void 0))throw new RangeError(`invalid duration: ${Vt}`);const Wt=Ht[1]==="-"||Ht[1]===""?-1:1,Qt=Ht[2]===void 0?0:ToIntegerWithTruncation(Ht[2])*Wt,Xt=Ht[3]===void 0?0:ToIntegerWithTruncation(Ht[3])*Wt,Jt=Ht[4]===void 0?0:ToIntegerWithTruncation(Ht[4])*Wt,tr=Ht[5]===void 0?0:ToIntegerWithTruncation(Ht[5])*Wt,dr=Ht[6]===void 0?0:ToIntegerWithTruncation(Ht[6])*Wt,vr=Ht[7],$r=Ht[8],Ir=Ht[9],Rr=Ht[10],Nr=Ht[11];let kr=0,lr=0,ir=0;if(vr!==void 0){if($r??Ir??Rr??Nr)throw new RangeError("only the smallest unit can be fractional");ir=3600*ToIntegerOrInfinity((vr+"000000000").slice(0,9))*Wt}else if(kr=$r===void 0?0:ToIntegerWithTruncation($r)*Wt,Ir!==void 0){if(Rr??Nr)throw new RangeError("only the smallest unit can be fractional");ir=60*ToIntegerOrInfinity((Ir+"000000000").slice(0,9))*Wt}else lr=Rr===void 0?0:ToIntegerWithTruncation(Rr)*Wt,Nr!==void 0&&(ir=ToIntegerOrInfinity((Nr+"000000000").slice(0,9))*Wt);const er=ir%1e3,rr=le(ir/1e3)%1e3,yr=le(ir/1e6)%1e3;return lr+=le(ir/1e9)%60,kr+=le(ir/6e10),RejectDuration(Qt,Xt,Jt,tr,dr,kr,lr,yr,rr,er),{years:Qt,months:Xt,weeks:Jt,days:tr,hours:dr,minutes:kr,seconds:lr,milliseconds:yr,microseconds:rr,nanoseconds:er}}(ToString($t));if(IsTemporalDuration($t))return{years:GetSlot($t,w$1),months:GetSlot($t,D),weeks:GetSlot($t,G),days:GetSlot($t,v),hours:GetSlot($t,C),minutes:GetSlot($t,O),seconds:GetSlot($t,b),milliseconds:GetSlot($t,E$1),microseconds:GetSlot($t,M),nanoseconds:GetSlot($t,R)};const e={years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0,microseconds:0,nanoseconds:0};let _t=function(Vt){if(!IsObject(Vt))throw new TypeError("invalid duration-like");const Ht={years:void 0,months:void 0,weeks:void 0,days:void 0,hours:void 0,minutes:void 0,seconds:void 0,milliseconds:void 0,microseconds:void 0,nanoseconds:void 0};let Wt=!1;for(const Qt of We){const Xt=Vt[Qt];Xt!==void 0&&(Wt=!0,Ht[Qt]=ToIntegerIfIntegral(Xt))}if(!Wt)throw new TypeError("invalid duration-like");return Ht}($t);for(const zt of We){const Vt=_t[zt];Vt!==void 0&&(e[zt]=Vt)}let{years:At,months:xt,weeks:kt,days:Bt,hours:Nt,minutes:Ut,seconds:Lt,milliseconds:jt,microseconds:Kt,nanoseconds:qt}=e;return RejectDuration(At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt),{years:At,months:xt,weeks:kt,days:Bt,hours:Nt,minutes:Ut,seconds:Lt,milliseconds:jt,microseconds:Kt,nanoseconds:qt}}function ToTemporalOverflow($t){return $t===void 0?"constrain":GetOption($t,"overflow",["constrain","reject"],"constrain")}function ToTemporalDisambiguation($t){return $t===void 0?"compatible":GetOption($t,"disambiguation",["compatible","earlier","later","reject"],"compatible")}function ToTemporalRoundingMode($t,e){return GetOption($t,"roundingMode",["ceil","floor","expand","trunc","halfCeil","halfFloor","halfExpand","halfTrunc","halfEven"],e)}function ToTemporalOffset($t,e){return $t===void 0?e:GetOption($t,"offset",["prefer","use","ignore","reject"],e)}function ToCalendarNameOption($t){return GetOption($t,"calendarName",["auto","always","never","critical"],"auto")}function ToTemporalRoundingIncrement($t){let e=$t.roundingIncrement;if(e===void 0)return 1;if(e=ToNumber(e),!me(e))throw new RangeError("roundingIncrement must be finite");const _t=le(e);if(_t<1||_t>1e9)throw new RangeError(`roundingIncrement must be at least 1 and at most 1e9, not ${e}`);return _t}function ValidateTemporalRoundingIncrement($t,e,_t){const At=_t?e:e-1;if($t>At)throw new RangeError(`roundingIncrement must be at least 1 and less than ${At}, not ${$t}`);if(e%$t!=0)throw new RangeError(`Rounding increment must divide evenly into ${e}`)}function ToFractionalSecondDigits($t){const e=$t.fractionalSecondDigits;if(e===void 0)return"auto";if(typeof e!="number"){if(ToString(e)!=="auto")throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`);return"auto"}const _t=ie(e);if(!me(_t)||_t<0||_t>9)throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`);return _t}function ToSecondsStringPrecisionRecord($t,e){switch($t){case"minute":return{precision:"minute",unit:"minute",increment:1};case"second":return{precision:0,unit:"second",increment:1};case"millisecond":return{precision:3,unit:"millisecond",increment:1};case"microsecond":return{precision:6,unit:"microsecond",increment:1};case"nanosecond":return{precision:9,unit:"nanosecond",increment:1}}switch(e){case"auto":return{precision:e,unit:"nanosecond",increment:1};case 0:return{precision:e,unit:"second",increment:1};case 1:case 2:case 3:return{precision:e,unit:"millisecond",increment:10**(3-e)};case 4:case 5:case 6:return{precision:e,unit:"microsecond",increment:10**(6-e)};case 7:case 8:case 9:return{precision:e,unit:"nanosecond",increment:10**(9-e)};default:throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`)}}const He=Symbol("~required~");function GetTemporalUnit($t,e,_t,At,xt=[]){const kt=[];for(const[,Lt,jt]of Ue)_t!=="datetime"&&_t!==jt||kt.push(Lt);kt.push(...xt);let Bt=At;Bt===He?Bt=void 0:Bt!==void 0&&kt.push(Bt);const Nt=[...kt];for(const Lt of kt){const jt=Le.get(Lt);jt!==void 0&&Nt.push(jt)}let Ut=GetOption($t,e,Nt,Bt);if(Ut===void 0&&At===He)throw new RangeError(`${e} is required`);return Ae.has(Ut)?Ae.get(Ut):Ut}function ToRelativeTemporalObject($t){const e=$t.relativeTo;if(e===void 0)return e;let _t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt="option",Ht=!1;if(IsObject(e)){if(IsTemporalZonedDateTime(e)||IsTemporalDate(e))return e;if(IsTemporalDateTime(e))return TemporalDateTimeToDate(e);Kt=GetTemporalCalendarSlotValueWithISODefault(e);const Wt=CalendarFields(Kt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);Wt.push("timeZone","offset");const Qt=PrepareTemporalFields(e,Wt,[]),Xt=Te(null);Xt.overflow="constrain",{year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt}=InterpretTemporalDateTimeFields(Kt,Qt,Xt),zt=Qt.offset,zt===void 0&&(Vt="wall"),qt=Qt.timeZone,qt!==void 0&&(qt=ToTemporalTimeZoneSlotValue(qt))}else{let Wt,Qt;if({year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt,calendar:Kt,ianaName:Wt,offset:zt,z:Qt}=ParseISODateTime(ToString(e)),Wt)qt=ToTemporalTimeZoneSlotValue(Wt),Qt?Vt="exact":zt||(Vt="wall"),Ht=!0;else if(Qt)throw new RangeError("Z designator not supported for PlainDate relativeTo; either remove the Z or add a bracketed time zone");if(Kt||(Kt="iso8601"),!IsBuiltinCalendar(Kt))throw new RangeError(`invalid calendar identifier ${Kt}`);Kt=ASCIILowercase(Kt)}return qt===void 0?CreateTemporalDate(_t,At,xt,Kt):CreateTemporalZonedDateTime(InterpretISODateTimeOffset(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Vt,Vt==="option"?ParseTimeZoneOffsetString(zt):0,qt,"compatible","reject",Ht),qt,Kt)}function DefaultTemporalLargestUnit($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt){for(const[jt,Kt]of[["years",$t],["months",e],["weeks",_t],["days",At],["hours",xt],["minutes",kt],["seconds",Bt],["milliseconds",Nt],["microseconds",Ut],["nanoseconds",Lt]])if(Kt!==0)return Ae.get(jt);return"nanosecond"}function LargerOfTwoTemporalUnits($t,e){return xe.indexOf($t)>xe.indexOf(e)?e:$t}function PrepareTemporalFields($t,e,_t,{emptySourceErrorMessage:At}={emptySourceErrorMessage:"no supported properties found"}){const xt=Te(null);let kt=!1;e.sort();for(const Bt of e){let Nt=$t[Bt];if(Nt!==void 0)kt=!0,$e.has(Bt)&&(Nt=$e.get(Bt)(Nt)),xt[Bt]=Nt;else if(_t!=="partial"){if(ee.call(_t,Bt))throw new TypeError(`required property '${Bt}' missing or undefined`);Nt=ke.get(Bt),xt[Bt]=Nt}}if(_t==="partial"&&!kt)throw new TypeError(At);return xt}function ToTemporalTimeRecord($t,e="complete"){const _t=["hour","microsecond","millisecond","minute","nanosecond","second"],At=PrepareTemporalFields($t,_t,"partial",{emptySourceErrorMessage:"invalid time-like"}),xt={};for(const kt of _t){const Bt=pe(At,kt);Bt!==void 0?xt[kt]=Bt.value:e==="complete"&&(xt[kt]=0)}return xt}function ToTemporalDate($t,e){let _t=$t;if(IsObject(_t)){if(IsTemporalDate(_t))return _t;if(IsTemporalZonedDateTime(_t)&&(ToTemporalOverflow(e),_t=GetPlainDateTimeFor(GetSlot(_t,g),GetSlot(_t,S),GetSlot(_t,p))),IsTemporalDateTime(_t))return ToTemporalOverflow(e),CreateTemporalDate(GetSlot(_t,i$1),GetSlot(_t,s$1),GetSlot(_t,l),GetSlot(_t,p));const Ut=GetTemporalCalendarSlotValueWithISODefault(_t);return CalendarDateFromFields(Ut,PrepareTemporalFields(_t,CalendarFields(Ut,["day","month","monthCode","year"]),[]),e)}ToTemporalOverflow(e);let{year:At,month:xt,day:kt,calendar:Bt,z:Nt}=function(Lt){return ParseISODateTime(Lt)}(ToString(_t));if(Nt)throw new RangeError("Z designator not supported for PlainDate");if(Bt||(Bt="iso8601"),!IsBuiltinCalendar(Bt))throw new RangeError(`invalid calendar identifier ${Bt}`);return Bt=ASCIILowercase(Bt),CreateTemporalDate(At,xt,kt,Bt)}function InterpretTemporalDateTimeFields($t,e,_t){let{hour:At,minute:xt,second:kt,millisecond:Bt,microsecond:Nt,nanosecond:Ut}=ToTemporalTimeRecord(e);const Lt=ToTemporalOverflow(_t),jt=CalendarDateFromFields($t,e,_t),Kt=GetSlot(jt,i$1),qt=GetSlot(jt,s$1),zt=GetSlot(jt,l);return{hour:At,minute:xt,second:kt,millisecond:Bt,microsecond:Nt,nanosecond:Ut}=RegulateTime(At,xt,kt,Bt,Nt,Ut,Lt),{year:Kt,month:qt,day:zt,hour:At,minute:xt,second:kt,millisecond:Bt,microsecond:Nt,nanosecond:Ut}}function ToTemporalDateTime($t,e){let _t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt;if(IsObject($t)){if(IsTemporalDateTime($t))return $t;if(IsTemporalZonedDateTime($t))return ToTemporalOverflow(e),GetPlainDateTimeFor(GetSlot($t,g),GetSlot($t,S),GetSlot($t,p));if(IsTemporalDate($t))return ToTemporalOverflow(e),CreateTemporalDateTime(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l),0,0,0,0,0,0,GetSlot($t,p));Kt=GetTemporalCalendarSlotValueWithISODefault($t);const qt=PrepareTemporalFields($t,CalendarFields(Kt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]),[]);({year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt}=InterpretTemporalDateTimeFields(Kt,qt,e))}else{let qt;if(ToTemporalOverflow(e),{year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt,calendar:Kt,z:qt}=function(Vt){return ParseISODateTime(Vt)}(ToString($t)),qt)throw new RangeError("Z designator not supported for PlainDateTime");if(RejectDateTime(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt),Kt||(Kt="iso8601"),!IsBuiltinCalendar(Kt))throw new RangeError(`invalid calendar identifier ${Kt}`);Kt=ASCIILowercase(Kt)}return CreateTemporalDateTime(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt)}function ToTemporalDuration($t){if(IsTemporalDuration($t))return $t;let{years:e,months:_t,weeks:At,days:xt,hours:kt,minutes:Bt,seconds:Nt,milliseconds:Ut,microseconds:Lt,nanoseconds:jt}=ToTemporalDurationRecord($t);return new(GetIntrinsic("%Temporal.Duration%"))(e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt)}function ToTemporalInstant($t){if(IsTemporalInstant($t))return $t;if(IsTemporalZonedDateTime($t))return new(GetIntrinsic("%Temporal.Instant%"))(GetSlot($t,n));const e=ParseTemporalInstant(ToString($t));return new(GetIntrinsic("%Temporal.Instant%"))(e)}function ToTemporalMonthDay($t,e){let _t=$t;if(IsObject(_t)){if(IsTemporalMonthDay(_t))return _t;let Nt,Ut;if(HasSlot(_t,p))Nt=GetSlot(_t,p),Ut=!1;else{let jt=_t.calendar;Ut=jt===void 0,jt===void 0&&(jt="iso8601"),Nt=ToTemporalCalendarSlotValue(jt)}const Lt=PrepareTemporalFields(_t,CalendarFields(Nt,["day","month","monthCode","year"]),[]);return Ut&&Lt.month!==void 0&&Lt.monthCode===void 0&&Lt.year===void 0&&(Lt.year=1972),CalendarMonthDayFromFields(Nt,Lt,e)}ToTemporalOverflow(e);let{month:At,day:xt,referenceISOYear:kt,calendar:Bt}=ParseTemporalMonthDayString(ToString(_t));if(Bt===void 0&&(Bt="iso8601"),!IsBuiltinCalendar(Bt))throw new RangeError(`invalid calendar identifier ${Bt}`);return Bt=ASCIILowercase(Bt),kt===void 0?(RejectISODate(1972,At,xt),CreateTemporalMonthDay(At,xt,Bt)):CalendarMonthDayFromFields(Bt,CreateTemporalMonthDay(At,xt,Bt,kt))}function ToTemporalTime($t,e="constrain"){let _t,At,xt,kt,Bt,Nt,Ut=$t;if(IsObject(Ut)){if(IsTemporalTime(Ut))return Ut;if(IsTemporalZonedDateTime(Ut)&&(Ut=GetPlainDateTimeFor(GetSlot(Ut,g),GetSlot(Ut,S),GetSlot(Ut,p))),IsTemporalDateTime(Ut))return new(GetIntrinsic("%Temporal.PlainTime%"))(GetSlot(Ut,d$1),GetSlot(Ut,m$1),GetSlot(Ut,c),GetSlot(Ut,h$1),GetSlot(Ut,u),GetSlot(Ut,T));({hour:_t,minute:At,second:xt,millisecond:kt,microsecond:Bt,nanosecond:Nt}=ToTemporalTimeRecord(Ut)),{hour:_t,minute:At,second:xt,millisecond:kt,microsecond:Bt,nanosecond:Nt}=RegulateTime(_t,At,xt,kt,Bt,Nt,e)}else({hour:_t,minute:At,second:xt,millisecond:kt,microsecond:Bt,nanosecond:Nt}=function(jt){const Kt=z.exec(jt);let qt,zt,Vt,Ht,Wt,Qt,Xt;if(Kt){qt=ToIntegerOrInfinity(Kt[1]),zt=ToIntegerOrInfinity(Kt[2]||Kt[5]),Vt=ToIntegerOrInfinity(Kt[3]||Kt[6]),Vt===60&&(Vt=59);const Jt=(Kt[4]||Kt[7])+"000000000";Ht=ToIntegerOrInfinity(Jt.slice(0,3)),Wt=ToIntegerOrInfinity(Jt.slice(3,6)),Qt=ToIntegerOrInfinity(Jt.slice(6,9)),Xt=Kt[14];for(const[,tr,dr,vr]of Xt.matchAll(H))if(dr!=="u-ca"&&tr==="!")throw new RangeError(`Unrecognized annotation: !${dr}=${vr}`);if(Kt[8])throw new RangeError("Z designator not supported for PlainTime")}else{let Jt,tr;if({hasTime:tr,hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt,z:Jt}=ParseISODateTime(jt),!tr)throw new RangeError(`time is missing in string: ${jt}`);if(Jt)throw new RangeError("Z designator not supported for PlainTime")}if(/[tT ][0-9][0-9]/.test(jt))return{hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt};try{const{month:Jt,day:tr}=ParseTemporalMonthDayString(jt);RejectISODate(1972,Jt,tr)}catch{try{const{year:Jt,month:tr}=ParseTemporalYearMonthString(jt);RejectISODate(Jt,tr,1)}catch{return{hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt}}}throw new RangeError(`invalid ISO 8601 time-only string ${jt}; may need a T prefix`)}(ToString(Ut))),RejectTime(_t,At,xt,kt,Bt,Nt);return new(GetIntrinsic("%Temporal.PlainTime%"))(_t,At,xt,kt,Bt,Nt)}function ToTemporalYearMonth($t,e){if(IsObject($t)){if(IsTemporalYearMonth($t))return $t;const Bt=GetTemporalCalendarSlotValueWithISODefault($t);return CalendarYearMonthFromFields(Bt,PrepareTemporalFields($t,CalendarFields(Bt,["month","monthCode","year"]),[]),e)}ToTemporalOverflow(e);let{year:_t,month:At,referenceISODay:xt,calendar:kt}=ParseTemporalYearMonthString(ToString($t));if(kt===void 0&&(kt="iso8601"),!IsBuiltinCalendar(kt))throw new RangeError(`invalid calendar identifier ${kt}`);return kt=ASCIILowercase(kt),xt===void 0?(RejectISODate(_t,At,1),CreateTemporalYearMonth(_t,At,kt)):CalendarYearMonthFromFields(kt,CreateTemporalYearMonth(_t,At,kt,xt))}function InterpretISODateTimeOffset($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt){const Ht=new(GetIntrinsic("%Temporal.PlainDateTime%"))($t,e,_t,At,xt,kt,Bt,Nt,Ut);if(Lt==="wall"||zt==="ignore")return GetSlot(GetInstantFor(Kt,Ht,qt),n);if(Lt==="exact"||zt==="use"){const Qt=GetUTCEpochNanoseconds($t,e,_t,At,xt,kt,Bt,Nt,Ut);if(Qt===null)throw new RangeError("ZonedDateTime outside of supported range");return JSBI.subtract(Qt,JSBI.BigInt(jt))}const Wt=GetPossibleInstantsFor(Kt,Ht);for(const Qt of Wt){const Xt=GetOffsetNanosecondsFor(Kt,Qt),Jt=JSBI.toNumber(RoundNumberToIncrement(JSBI.BigInt(Xt),be,"halfExpand"));if(Xt===jt||Vt&&Jt===jt)return GetSlot(Qt,n)}if(zt==="reject"){const Qt=FormatTimeZoneOffsetString(jt),Xt=IsTemporalTimeZone(Kt)?GetSlot(Kt,a):"time zone";throw new RangeError(`Offset ${Qt} is invalid for ${Ht.toString()} in ${Xt}`)}return GetSlot(DisambiguatePossibleInstants(Wt,Kt,Ht,qt),n)}function ToTemporalZonedDateTime($t,e){let _t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt=!1,Qt="option";if(IsObject($t)){if(IsTemporalZonedDateTime($t))return $t;zt=GetTemporalCalendarSlotValueWithISODefault($t);const Jt=CalendarFields(zt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);Jt.push("timeZone","offset");const tr=PrepareTemporalFields($t,Jt,["timeZone"]);Kt=ToTemporalTimeZoneSlotValue(tr.timeZone),qt=tr.offset,qt===void 0&&(Qt="wall"),Vt=ToTemporalDisambiguation(e),Ht=ToTemporalOffset(e,"reject"),{year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt}=InterpretTemporalDateTimeFields(zt,tr,e)}else{let Jt,tr;if({year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt,ianaName:Jt,offset:qt,z:tr,calendar:zt}=function(vr){const $r=ParseISODateTime(vr);if(!$r.ianaName)throw new RangeError("Temporal.ZonedDateTime requires a time zone ID in brackets");return $r}(ToString($t)),Kt=ToTemporalTimeZoneSlotValue(Jt),tr?Qt="exact":qt||(Qt="wall"),zt||(zt="iso8601"),!IsBuiltinCalendar(zt))throw new RangeError(`invalid calendar identifier ${zt}`);zt=ASCIILowercase(zt),Wt=!0,Vt=ToTemporalDisambiguation(e),Ht=ToTemporalOffset(e,"reject"),ToTemporalOverflow(e)}let Xt=0;return Qt==="option"&&(Xt=ParseTimeZoneOffsetString(qt)),CreateTemporalZonedDateTime(InterpretISODateTimeOffset(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Qt,Xt,Kt,Vt,Ht,Wt),Kt,zt)}function CreateTemporalDateSlots($t,e,_t,At,xt){RejectISODate(e,_t,At),RejectDateRange(e,_t,At),N($t),SetSlot($t,i$1,e),SetSlot($t,s$1,_t),SetSlot($t,l,At),SetSlot($t,p,xt),SetSlot($t,f$1,!0)}function CreateTemporalDate($t,e,_t,At="iso8601"){const xt=GetIntrinsic("%Temporal.PlainDate%"),kt=Te(xt.prototype);return CreateTemporalDateSlots(kt,$t,e,_t,At),kt}function CreateTemporalDateTimeSlots($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt){RejectDateTime(e,_t,At,xt,kt,Bt,Nt,Ut,Lt),RejectDateTimeRange(e,_t,At,xt,kt,Bt,Nt,Ut,Lt),N($t),SetSlot($t,i$1,e),SetSlot($t,s$1,_t),SetSlot($t,l,At),SetSlot($t,d$1,xt),SetSlot($t,m$1,kt),SetSlot($t,c,Bt),SetSlot($t,h$1,Nt),SetSlot($t,u,Ut),SetSlot($t,T,Lt),SetSlot($t,p,jt)}function CreateTemporalDateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt="iso8601"){const jt=GetIntrinsic("%Temporal.PlainDateTime%"),Kt=Te(jt.prototype);return CreateTemporalDateTimeSlots(Kt,$t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt),Kt}function CreateTemporalMonthDaySlots($t,e,_t,At,xt){RejectISODate(xt,e,_t),RejectDateRange(xt,e,_t),N($t),SetSlot($t,s$1,e),SetSlot($t,l,_t),SetSlot($t,i$1,xt),SetSlot($t,p,At),SetSlot($t,I,!0)}function CreateTemporalMonthDay($t,e,_t="iso8601",At=1972){const xt=GetIntrinsic("%Temporal.PlainMonthDay%"),kt=Te(xt.prototype);return CreateTemporalMonthDaySlots(kt,$t,e,_t,At),kt}function CreateTemporalYearMonthSlots($t,e,_t,At,xt){RejectISODate(e,_t,xt),function(Bt,Nt){RejectToRange(Bt,Fe,Ye),Bt===Fe?RejectToRange(Nt,4,12):Bt===Ye&&RejectToRange(Nt,1,9)}(e,_t),N($t),SetSlot($t,i$1,e),SetSlot($t,s$1,_t),SetSlot($t,l,xt),SetSlot($t,p,At),SetSlot($t,y$1,!0)}function CreateTemporalYearMonth($t,e,_t="iso8601",At=1){const xt=GetIntrinsic("%Temporal.PlainYearMonth%"),kt=Te(xt.prototype);return CreateTemporalYearMonthSlots(kt,$t,e,_t,At),kt}function CreateTemporalZonedDateTimeSlots($t,e,_t,At){ValidateEpochNanoseconds(e),N($t),SetSlot($t,n,e),SetSlot($t,g,_t),SetSlot($t,p,At);const xt=new(GetIntrinsic("%Temporal.Instant%"))(GetSlot($t,n));SetSlot($t,S,xt)}function CreateTemporalZonedDateTime($t,e,_t="iso8601"){const At=GetIntrinsic("%Temporal.ZonedDateTime%"),xt=Te(At.prototype);return CreateTemporalZonedDateTimeSlots(xt,$t,e,_t),xt}function CalendarFields($t,e){if(typeof $t=="string"){const xt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.fields%"),xt,[e])}const _t=Call(GetMethod($t,"fields"),$t,[e]),At=[];for(const xt of _t){if(typeof xt!="string")throw new TypeError("bad return from calendar.fields()");te.call(At,xt)}return At}function CalendarMergeFields($t,e,_t){if(typeof $t=="string"){const xt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.mergeFields%"),xt,[e,_t])}const At=Call(GetMethod($t,"mergeFields"),$t,[e,_t]);if(!IsObject(At))throw new TypeError("bad return from calendar.mergeFields()");return At}function CalendarDateAdd($t,e,_t,At,xt){let kt=xt;if(typeof $t=="string"){const Nt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dateAdd%"),Nt,[e,_t,At])}kt===void 0&&(kt=GetMethod($t,"dateAdd"));const Bt=fe(kt,$t,[e,_t,At]);if(!IsTemporalDate(Bt))throw new TypeError("invalid result");return Bt}function CalendarDateUntil($t,e,_t,At,xt){let kt=xt;if(typeof $t=="string"){const Nt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dateUntil%"),Nt,[e,_t,At])}kt===void 0&&(kt=GetMethod($t,"dateUntil"));const Bt=fe(kt,$t,[e,_t,At]);if(!IsTemporalDuration(Bt))throw new TypeError("invalid result");return Bt}function CalendarYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.year%"),At,[e])}let _t=Call(GetMethod($t,"year"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar year result must be an integer");if(!IsIntegralNumber(_t))throw new RangeError("calendar year result must be an integer");return _t}function CalendarMonth($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.month%"),At,[e])}let _t=Call(GetMethod($t,"month"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar month result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar month result must be a positive integer");return _t}function CalendarMonthCode($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.monthCode%"),At,[e])}let _t=Call(GetMethod($t,"monthCode"),$t,[e]);if(typeof _t!="string")throw new TypeError("calendar monthCode result must be a string");return _t}function CalendarDay($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.day%"),At,[e])}const _t=Call(GetMethod($t,"day"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar day result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar day result must be a positive integer");return _t}function CalendarEra($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.era%"),At,[e])}let _t=Call(GetMethod($t,"era"),$t,[e]);if(_t===void 0)return _t;if(typeof _t!="string")throw new TypeError("calendar era result must be a string or undefined");return _t}function CalendarEraYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.eraYear%"),At,[e])}let _t=Call(GetMethod($t,"eraYear"),$t,[e]);if(_t===void 0)return _t;if(typeof _t!="number")throw new TypeError("calendar eraYear result must be an integer or undefined");if(!IsIntegralNumber(_t))throw new RangeError("calendar eraYear result must be an integer or undefined");return _t}function CalendarDayOfWeek($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dayOfWeek%"),At,[e])}const _t=Call(GetMethod($t,"dayOfWeek"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar dayOfWeek result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar dayOfWeek result must be a positive integer");return _t}function CalendarDayOfYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dayOfYear%"),At,[e])}const _t=Call(GetMethod($t,"dayOfYear"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar dayOfYear result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar dayOfYear result must be a positive integer");return _t}function CalendarWeekOfYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.weekOfYear%"),At,[e])}const _t=Call(GetMethod($t,"weekOfYear"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar weekOfYear result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar weekOfYear result must be a positive integer");return _t}function CalendarYearOfWeek($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.yearOfWeek%"),At,[e])}const _t=Call(GetMethod($t,"yearOfWeek"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar yearOfWeek result must be an integer");if(!IsIntegralNumber(_t))throw new RangeError("calendar yearOfWeek result must be an integer");return _t}function CalendarDaysInWeek($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.daysInWeek%"),At,[e])}const _t=Call(GetMethod($t,"daysInWeek"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar daysInWeek result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar daysInWeek result must be a positive integer");return _t}function CalendarDaysInMonth($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.daysInMonth%"),At,[e])}const _t=Call(GetMethod($t,"daysInMonth"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar daysInMonth result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar daysInMonth result must be a positive integer");return _t}function CalendarDaysInYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.daysInYear%"),At,[e])}const _t=Call(GetMethod($t,"daysInYear"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar daysInYear result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar daysInYear result must be a positive integer");return _t}function CalendarMonthsInYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.monthsInYear%"),At,[e])}const _t=Call(GetMethod($t,"monthsInYear"),$t,[e]);if(typeof _t!="number")throw new TypeError("calendar monthsInYear result must be a positive integer");if(!IsIntegralNumber(_t)||_t<1)throw new RangeError("calendar monthsInYear result must be a positive integer");return _t}function CalendarInLeapYear($t,e){if(typeof $t=="string"){const At=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.inLeapYear%"),At,[e])}const _t=Call(GetMethod($t,"inLeapYear"),$t,[e]);if(typeof _t!="boolean")throw new TypeError("calendar inLeapYear result must be a boolean");return _t}function ToTemporalCalendarSlotValue($t){if(IsObject($t)){if(HasSlot($t,p))return GetSlot($t,p);if(!function(xt){return!!IsTemporalCalendar(xt)||"dateAdd"in xt&&"dateFromFields"in xt&&"dateUntil"in xt&&"day"in xt&&"dayOfWeek"in xt&&"dayOfYear"in xt&&"daysInMonth"in xt&&"daysInWeek"in xt&&"daysInYear"in xt&&"fields"in xt&&"id"in xt&&"inLeapYear"in xt&&"mergeFields"in xt&&"month"in xt&&"monthCode"in xt&&"monthDayFromFields"in xt&&"monthsInYear"in xt&&"weekOfYear"in xt&&"year"in xt&&"yearMonthFromFields"in xt&&"yearOfWeek"in xt}($t))throw new TypeError("expected a Temporal.Calendar or object implementing the Temporal.Calendar protocol");return $t}const e=ToString($t);if(IsBuiltinCalendar(e))return ASCIILowercase(e);let _t;try{({calendar:_t}=ParseISODateTime(e))}catch{try{({calendar:_t}=ParseTemporalYearMonthString(e))}catch{({calendar:_t}=ParseTemporalMonthDayString(e))}}if(_t||(_t="iso8601"),!IsBuiltinCalendar(_t))throw new RangeError(`invalid calendar identifier ${_t}`);return ASCIILowercase(_t)}function GetTemporalCalendarSlotValueWithISODefault($t){if(HasSlot($t,p))return GetSlot($t,p);const{calendar:e}=$t;return e===void 0?"iso8601":ToTemporalCalendarSlotValue(e)}function ToTemporalCalendarIdentifier($t){if(typeof $t=="string")return $t;const e=$t.id;if(typeof e!="string")throw new TypeError("calendar.id should be a string");return e}function ToTemporalCalendarObject($t){return IsObject($t)?$t:new(GetIntrinsic("%Temporal.Calendar%"))($t)}function CalendarEquals($t,e){return $t===e?!0:ToTemporalCalendarIdentifier($t)===ToTemporalCalendarIdentifier(e)}function ThrowIfCalendarsNotEqual($t,e,_t){if($t===e)return;const At=ToTemporalCalendarIdentifier($t),xt=ToTemporalCalendarIdentifier(e);if(At!==xt)throw new RangeError(`cannot ${_t} of ${At} and ${xt} calendars`)}function ConsolidateCalendars($t,e){if($t===e)return e;const _t=ToTemporalCalendarIdentifier($t),At=ToTemporalCalendarIdentifier(e);if(_t===At||_t==="iso8601")return e;if(At==="iso8601")return $t;throw new RangeError("irreconcilable calendars")}function CalendarDateFromFields($t,e,_t,At){if(typeof $t=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dateFromFields%"),kt,[e,_t])}const xt=Call(GetMethod($t,"dateFromFields"),$t,[e,_t]);if(!IsTemporalDate(xt))throw new TypeError("invalid result");return xt}function CalendarYearMonthFromFields($t,e,_t){if(typeof $t=="string"){const xt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.yearMonthFromFields%"),xt,[e,_t])}let At=Call(GetMethod($t,"yearMonthFromFields"),$t,[e,_t]);if(!IsTemporalYearMonth(At))throw new TypeError("invalid result");return At}function CalendarMonthDayFromFields($t,e,_t){if(typeof $t=="string"){const xt=new(GetIntrinsic("%Temporal.Calendar%"))($t);return Call(GetIntrinsic("%Temporal.Calendar.prototype.monthDayFromFields%"),xt,[e,_t])}let At=Call(GetMethod($t,"monthDayFromFields"),$t,[e,_t]);if(!IsTemporalMonthDay(At))throw new TypeError("invalid result");return At}function ToTemporalTimeZoneSlotValue($t){if(IsObject($t)){if(IsTemporalZonedDateTime($t))return GetSlot($t,g);if(!function(_t){return!!IsTemporalTimeZone(_t)||"getOffsetNanosecondsFor"in _t&&"getPossibleInstantsFor"in _t&&"id"in _t}($t))throw new TypeError("expected a Temporal.TimeZone or object implementing the Temporal.TimeZone protocol");return $t}return ParseTemporalTimeZone(ToString($t))}function ToTemporalTimeZoneIdentifier($t){if(typeof $t=="string")return $t;const e=$t.id;if(typeof e!="string")throw new TypeError("timeZone.id should be a string");return e}function ToTemporalTimeZoneObject($t){return IsObject($t)?$t:new(GetIntrinsic("%Temporal.TimeZone%"))($t)}function TimeZoneEquals($t,e){return $t===e?!0:ToTemporalTimeZoneIdentifier($t)===ToTemporalTimeZoneIdentifier(e)}function TemporalDateTimeToDate($t){return CreateTemporalDate(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l),GetSlot($t,p))}function TemporalDateTimeToTime($t){return new(GetIntrinsic("%Temporal.PlainTime%"))(GetSlot($t,d$1),GetSlot($t,m$1),GetSlot($t,c),GetSlot($t,h$1),GetSlot($t,u),GetSlot($t,T))}function GetOffsetNanosecondsFor($t,e,_t){if(typeof $t=="string"){const xt=new(GetIntrinsic("%Temporal.TimeZone%"))($t);return Call(GetIntrinsic("%Temporal.TimeZone.prototype.getOffsetNanosecondsFor%"),xt,[e])}const At=Call(GetMethod($t,"getOffsetNanosecondsFor"),$t,[e]);if(typeof At!="number")throw new TypeError("bad return from getOffsetNanosecondsFor");if(!IsIntegralNumber(At)||ae(At)>=864e11)throw new RangeError("out-of-range return from getOffsetNanosecondsFor");return At}function GetOffsetStringFor($t,e){return FormatTimeZoneOffsetString(GetOffsetNanosecondsFor($t,e))}function GetPlainDateTimeFor($t,e,_t){const At=GetSlot(e,n),xt=GetOffsetNanosecondsFor($t,e);let{year:kt,month:Bt,day:Nt,hour:Ut,minute:Lt,second:jt,millisecond:Kt,microsecond:qt,nanosecond:zt}=GetISOPartsFromEpoch(At);return{year:kt,month:Bt,day:Nt,hour:Ut,minute:Lt,second:jt,millisecond:Kt,microsecond:qt,nanosecond:zt}=BalanceISODateTime(kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt+xt),CreateTemporalDateTime(kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,_t)}function GetInstantFor($t,e,_t){return DisambiguatePossibleInstants(GetPossibleInstantsFor($t,e),$t,e,_t)}function DisambiguatePossibleInstants($t,e,_t,At){const xt=GetIntrinsic("%Temporal.Instant%"),kt=$t.length;if(kt===1)return $t[0];if(kt)switch(At){case"compatible":case"earlier":return $t[0];case"later":return $t[kt-1];case"reject":throw new RangeError("multiple instants found")}const Bt=GetSlot(_t,i$1),Nt=GetSlot(_t,s$1),Ut=GetSlot(_t,l),Lt=GetSlot(_t,d$1),jt=GetSlot(_t,m$1),Kt=GetSlot(_t,c),qt=GetSlot(_t,h$1),zt=GetSlot(_t,u),Vt=GetSlot(_t,T),Ht=GetUTCEpochNanoseconds(Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt);if(Ht===null)throw new RangeError("DateTime outside of supported range");const Wt=new xt(JSBI.subtract(Ht,Ee)),Qt=new xt(JSBI.add(Ht,Ee)),Xt=GetOffsetNanosecondsFor(e,Wt),Jt=GetOffsetNanosecondsFor(e,Qt)-Xt;switch(At){case"earlier":{const tr=GetSlot(_t,p),dr=GetIntrinsic("%Temporal.PlainDateTime%"),vr=AddDateTime(Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,tr,0,0,0,0,0,0,0,0,0,-Jt,void 0);return GetPossibleInstantsFor(e,new dr(vr.year,vr.month,vr.day,vr.hour,vr.minute,vr.second,vr.millisecond,vr.microsecond,vr.nanosecond,tr))[0]}case"compatible":case"later":{const tr=GetSlot(_t,p),dr=GetIntrinsic("%Temporal.PlainDateTime%"),vr=AddDateTime(Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,tr,0,0,0,0,0,0,0,0,0,Jt,void 0),$r=GetPossibleInstantsFor(e,new dr(vr.year,vr.month,vr.day,vr.hour,vr.minute,vr.second,vr.millisecond,vr.microsecond,vr.nanosecond,tr));return $r[$r.length-1]}case"reject":throw new RangeError("no such instant found")}}function GetPossibleInstantsFor($t,e,_t){if(typeof $t=="string"){const kt=new(GetIntrinsic("%Temporal.TimeZone%"))($t);return Call(GetIntrinsic("%Temporal.TimeZone.prototype.getPossibleInstantsFor%"),kt,[e])}const At=Call(GetMethod($t,"getPossibleInstantsFor"),$t,[e]),xt=[];for(const kt of At){if(!IsTemporalInstant(kt))throw new TypeError("bad return from getPossibleInstantsFor");te.call(xt,kt)}return xt}function ISOYearString($t){let e;return $t<0||$t>9999?e=($t<0?"-":"+")+`000000${ae($t)}`.slice(-6):e=`0000${$t}`.slice(-4),e}function ISODateTimePartString($t){return`00${$t}`.slice(-2)}function FormatSecondsStringPart($t,e,_t,At,xt){if(xt==="minute")return"";const kt=`:${ISODateTimePartString($t)}`;let Bt,Nt=1e6*e+1e3*_t+At;if(xt==="auto"){if(Nt===0)return kt;for(Bt=`${Nt}`.padStart(9,"0");Bt[Bt.length-1]==="0";)Bt=Bt.slice(0,-1)}else{if(xt===0)return kt;Bt=`${Nt}`.padStart(9,"0").slice(0,xt)}return`${kt}.${Bt}`}function TemporalInstantToString($t,e,_t){let At=e;At===void 0&&(At="UTC");const xt=GetPlainDateTimeFor(At,$t,"iso8601"),kt=ISOYearString(GetSlot(xt,i$1)),Bt=ISODateTimePartString(GetSlot(xt,s$1)),Nt=ISODateTimePartString(GetSlot(xt,l)),Ut=ISODateTimePartString(GetSlot(xt,d$1)),Lt=ISODateTimePartString(GetSlot(xt,m$1)),jt=FormatSecondsStringPart(GetSlot(xt,c),GetSlot(xt,h$1),GetSlot(xt,u),GetSlot(xt,T),_t);let Kt="Z";return e!==void 0&&(Kt=FormatISOTimeZoneOffsetString(GetOffsetNanosecondsFor(At,$t))),`${kt}-${Bt}-${Nt}T${Ut}:${Lt}${jt}${Kt}`}function TemporalDurationToString($t,e="auto",_t){function At(Rr){return Rr<=ue?Rr.toString(10):JSBI.BigInt(Rr).toString(10)}const xt=GetSlot($t,w$1),kt=GetSlot($t,D),Bt=GetSlot($t,G),Nt=GetSlot($t,v),Ut=GetSlot($t,C),Lt=GetSlot($t,O);let jt=GetSlot($t,b),Kt=GetSlot($t,E$1),qt=GetSlot($t,M),zt=GetSlot($t,R);const Vt=DurationSign(xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt);if(_t){const{unit:Rr,increment:Nr,roundingMode:kr}=_t;({seconds:jt,milliseconds:Kt,microseconds:qt,nanoseconds:zt}=RoundDuration(0,0,0,0,0,0,jt,Kt,qt,zt,Nr,Rr,kr))}const Ht=[];xt&&Ht.push(`${At(ae(xt))}Y`),kt&&Ht.push(`${At(ae(kt))}M`),Bt&&Ht.push(`${At(ae(Bt))}W`),Nt&&Ht.push(`${At(ae(Nt))}D`);const Wt=[];Ut&&Wt.push(`${At(ae(Ut))}H`),Lt&&Wt.push(`${At(ae(Lt))}M`);const Qt=[];let Xt,Jt,tr,dr,vr=TotalDurationNanoseconds(0,0,0,jt,Kt,qt,zt,0);({quotient:vr,remainder:Xt}=divmod(vr,De)),{quotient:vr,remainder:Jt}=divmod(vr,De),{quotient:dr,remainder:tr}=divmod(vr,De);const $r=1e6*ae(JSBI.toNumber(tr))+1e3*ae(JSBI.toNumber(Jt))+ae(JSBI.toNumber(Xt));let Ir;if(e==="auto"){if($r!==0)for(Ir=`${$r}`.padStart(9,"0");Ir[Ir.length-1]==="0";)Ir=Ir.slice(0,-1)}else e!==0&&(Ir=`${$r}`.padStart(9,"0").slice(0,e));return Ir&&Qt.unshift(".",Ir),JSBI.equal(dr,Ie)&&!Qt.length&&e==="auto"||Qt.unshift(abs(dr).toString()),Qt.length&&Wt.push(`${Qt.join("")}S`),Wt.length&&Wt.unshift("T"),Ht.length||Wt.length?`${Vt<0?"-":""}P${Ht.join("")}${Wt.join("")}`:"PT0S"}function TemporalDateToString($t,e="auto"){return`${ISOYearString(GetSlot($t,i$1))}-${ISODateTimePartString(GetSlot($t,s$1))}-${ISODateTimePartString(GetSlot($t,l))}${MaybeFormatCalendarAnnotation(GetSlot($t,p),e)}`}function TemporalDateTimeToString($t,e,_t="auto",At){let xt=GetSlot($t,i$1),kt=GetSlot($t,s$1),Bt=GetSlot($t,l),Nt=GetSlot($t,d$1),Ut=GetSlot($t,m$1),Lt=GetSlot($t,c),jt=GetSlot($t,h$1),Kt=GetSlot($t,u),qt=GetSlot($t,T);if(At){const{unit:zt,increment:Vt,roundingMode:Ht}=At;({year:xt,month:kt,day:Bt,hour:Nt,minute:Ut,second:Lt,millisecond:jt,microsecond:Kt,nanosecond:qt}=RoundISODateTime(xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,Vt,zt,Ht))}return`${ISOYearString(xt)}-${ISODateTimePartString(kt)}-${ISODateTimePartString(Bt)}T${ISODateTimePartString(Nt)}:${ISODateTimePartString(Ut)}${FormatSecondsStringPart(Lt,jt,Kt,qt,e)}${MaybeFormatCalendarAnnotation(GetSlot($t,p),_t)}`}function TemporalMonthDayToString($t,e="auto"){let _t=`${ISODateTimePartString(GetSlot($t,s$1))}-${ISODateTimePartString(GetSlot($t,l))}`;const At=ToTemporalCalendarIdentifier(GetSlot($t,p));(e==="always"||e==="critical"||At!=="iso8601")&&(_t=`${ISOYearString(GetSlot($t,i$1))}-${_t}`);const xt=FormatCalendarAnnotation(At,e);return xt&&(_t+=xt),_t}function TemporalYearMonthToString($t,e="auto"){let _t=`${ISOYearString(GetSlot($t,i$1))}-${ISODateTimePartString(GetSlot($t,s$1))}`;const At=ToTemporalCalendarIdentifier(GetSlot($t,p));(e==="always"||e==="critical"||At!=="iso8601")&&(_t+=`-${ISODateTimePartString(GetSlot($t,l))}`);const xt=FormatCalendarAnnotation(At,e);return xt&&(_t+=xt),_t}function TemporalZonedDateTimeToString($t,e,_t="auto",At="auto",xt="auto",kt){let Bt=GetSlot($t,S);if(kt){const{unit:jt,increment:Kt,roundingMode:qt}=kt,zt=RoundInstant(GetSlot($t,n),Kt,jt,qt);Bt=new(GetIntrinsic("%Temporal.Instant%"))(zt)}const Nt=GetSlot($t,g),Ut=GetPlainDateTimeFor(Nt,Bt,"iso8601");let Lt=`${ISOYearString(GetSlot(Ut,i$1))}-${ISODateTimePartString(GetSlot(Ut,s$1))}-${ISODateTimePartString(GetSlot(Ut,l))}T${ISODateTimePartString(GetSlot(Ut,d$1))}:${ISODateTimePartString(GetSlot(Ut,m$1))}${FormatSecondsStringPart(GetSlot(Ut,c),GetSlot(Ut,h$1),GetSlot(Ut,u),GetSlot(Ut,T),e)}`;return xt!=="never"&&(Lt+=FormatISOTimeZoneOffsetString(GetOffsetNanosecondsFor(Nt,Bt))),At!=="never"&&(Lt+=`[${At==="critical"?"!":""}${ToTemporalTimeZoneIdentifier(Nt)}]`),Lt+=MaybeFormatCalendarAnnotation(GetSlot($t,p),_t),Lt}function IsTimeZoneOffsetString($t){return ze.test(he($t))}function ParseTimeZoneOffsetString($t){const e=ze.exec(he($t));if(!e)throw new RangeError(`invalid time zone offset: ${$t}`);return(e[1]==="-"||e[1]===""?-1:1)*(1e9*(60*(60*+e[2]+ +(e[3]||0))+ +(e[4]||0))+ +((e[5]||0)+"000000000").slice(0,9))}function GetCanonicalTimeZoneIdentifier($t){return IsTimeZoneOffsetString($t)?FormatTimeZoneOffsetString(ParseTimeZoneOffsetString($t)):getIntlDateTimeFormatEnUsForTimeZone(he($t)).resolvedOptions().timeZone}function GetNamedTimeZoneOffsetNanoseconds($t,e){const{year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt,nanosecond:jt}=GetNamedTimeZoneDateTimeParts($t,e),Kt=_t%400,qt=(_t-Kt)/400,zt=JSBI.multiply(JSBI.BigInt(146097),Ee),Vt=GetUTCEpochNanoseconds(Kt,At,xt,kt,Bt,Nt,Ut,Lt,jt),Ht=JSBI.add(Vt,JSBI.multiply(zt,JSBI.BigInt(qt)));return JSBI.toNumber(JSBI.subtract(Ht,e))}function FormatTimeZoneOffsetString($t){const e=$t<0?"-":"+",_t=ae($t),At=_t%1e9,xt=ie(_t/1e9)%60,kt=ie(_t/6e10)%60,Bt=ISODateTimePartString(ie(_t/36e11)),Nt=ISODateTimePartString(kt),Ut=ISODateTimePartString(xt);let Lt="";if(At){let jt=`${At}`.padStart(9,"0");for(;jt[jt.length-1]==="0";)jt=jt.slice(0,-1);Lt=`:${Ut}.${jt}`}else xt&&(Lt=`:${Ut}`);return`${e}${Bt}:${Nt}${Lt}`}function FormatISOTimeZoneOffsetString($t){let e=JSBI.toNumber(RoundNumberToIncrement(JSBI.BigInt($t),be,"halfExpand"));const _t=e<0?"-":"+";e=ae(e);const At=e/6e10%60;return`${_t}${ISODateTimePartString(ie(e/36e11))}:${ISODateTimePartString(At)}`}function GetUTCEpochNanoseconds($t,e,_t,At,xt,kt,Bt,Nt,Ut){const Lt=new Date;Lt.setUTCHours(At,xt,kt,Bt),Lt.setUTCFullYear($t,e-1,_t);const jt=Lt.getTime();if(de(jt))return null;let Kt=JSBI.multiply(JSBI.BigInt(jt),Ge);return Kt=JSBI.add(Kt,JSBI.multiply(JSBI.BigInt(Nt),De)),Kt=JSBI.add(Kt,JSBI.BigInt(Ut)),JSBI.lessThan(Kt,Me)||JSBI.greaterThan(Kt,Re)?null:Kt}function GetISOPartsFromEpoch($t){const{quotient:e,remainder:_t}=divmod($t,Ge);let At=JSBI.toNumber(e),xt=JSBI.toNumber(_t);xt<0&&(xt+=1e6,At-=1);const kt=ie(xt/1e3)%1e3,Bt=xt%1e3,Nt=new Date(At);return{epochMilliseconds:At,year:Nt.getUTCFullYear(),month:Nt.getUTCMonth()+1,day:Nt.getUTCDate(),hour:Nt.getUTCHours(),minute:Nt.getUTCMinutes(),second:Nt.getUTCSeconds(),millisecond:Nt.getUTCMilliseconds(),microsecond:kt,nanosecond:Bt}}function GetNamedTimeZoneDateTimeParts($t,e){const{epochMilliseconds:_t,millisecond:At,microsecond:xt,nanosecond:kt}=GetISOPartsFromEpoch(e),{year:Bt,month:Nt,day:Ut,hour:Lt,minute:jt,second:Kt}=function(zt,Vt){const Ht=getIntlDateTimeFormatEnUsForTimeZone(zt).format(new Date(Vt));return function(Qt){const Xt=Qt.split(/[^\w]+/);if(Xt.length!==7)throw new RangeError(`expected 7 parts in "${Qt}`);const Jt=+Xt[0],tr=+Xt[1];let dr=+Xt[2];const vr=Xt[3].toUpperCase();if(vr==="B"||vr==="BC")dr=1-dr;else if(vr!=="A"&&vr!=="AD")throw new RangeError(`Unknown era ${vr} in "${Qt}`);let $r=+Xt[4];$r===24&&($r=0);const Ir=+Xt[5],Rr=+Xt[6];if(!(me(dr)&&me(Jt)&&me(tr)&&me($r)&&me(Ir)&&me(Rr)))throw new RangeError(`Invalid number in "${Qt}`);return{year:dr,month:Jt,day:tr,hour:$r,minute:Ir,second:Rr}}(Ht)}($t,_t);return BalanceISODateTime(Bt,Nt,Ut,Lt,jt,Kt,At,xt,kt)}function maxJSBI($t,e){return JSBI.lessThan($t,e)?e:$t}function afterLatestPossibleTzdbRuleChange(){return JSBI.add(Ve(),Ze)}function GetNamedTimeZoneNextTransition($t,e){if(JSBI.lessThan(e,Pe))return GetNamedTimeZoneNextTransition($t,Pe);const _t=JSBI.add(e,Be),At=maxJSBI(afterLatestPossibleTzdbRuleChange(),_t);let xt=maxJSBI(Pe,e);const kt=GetNamedTimeZoneOffsetNanoseconds($t,xt);let Bt=xt,Nt=kt;for(;kt===Nt&&JSBI.lessThan(JSBI.BigInt(xt),At);){if(Bt=JSBI.add(xt,Ne),JSBI.greaterThan(Bt,Re))return null;Nt=GetNamedTimeZoneOffsetNanoseconds($t,Bt),kt===Nt&&(xt=Bt)}return kt===Nt?null:bisect(Ut=>GetNamedTimeZoneOffsetNanoseconds($t,Ut),xt,Bt,kt,Nt)}function GetNamedTimeZonePreviousTransition($t,e){const _t=afterLatestPossibleTzdbRuleChange(),At=JSBI.greaterThan(e,_t),xt=At?JSBI.subtract(e,Be):Pe;if($t==="Africa/Casablanca"||$t==="Africa/El_Aaiun"){const Lt=GetSlot(ToTemporalInstant("2088-01-01T00Z"),n);if(JSBI.lessThan(Lt,e))return GetNamedTimeZonePreviousTransition($t,Lt)}let kt=JSBI.subtract(e,Se);if(JSBI.lessThan(kt,Pe))return null;const Bt=GetNamedTimeZoneOffsetNanoseconds($t,kt);let Nt=kt,Ut=Bt;for(;Bt===Ut&&JSBI.greaterThan(kt,xt);){if(Nt=JSBI.subtract(kt,Ne),JSBI.lessThan(Nt,Pe))return null;Ut=GetNamedTimeZoneOffsetNanoseconds($t,Nt),Bt===Ut&&(kt=Nt)}if(Bt===Ut){if(At){const Lt=JSBI.subtract(_t,Ee);return GetNamedTimeZonePreviousTransition($t,Lt)}return null}return bisect(Lt=>GetNamedTimeZoneOffsetNanoseconds($t,Lt),Nt,kt,Ut,Bt)}function LeapYear($t){return $t===void 0?!1:$t%4==0&&($t%100!=0||$t%400==0)}function ISODaysInMonth($t,e){return{standard:[31,28,31,30,31,30,31,31,30,31,30,31],leapyear:[31,29,31,30,31,30,31,31,30,31,30,31]}[LeapYear($t)?"leapyear":"standard"][e-1]}function DayOfWeek($t,e,_t){const At=e+(e<3?10:-2),xt=$t-(e<3?1:0),kt=ie(xt/100),Bt=xt-100*kt,Nt=(_t+ie(2.6*At-.2)+(Bt+ie(Bt/4))+(ie(kt/4)-2*kt))%7;return Nt+(Nt<=0?7:0)}function DayOfYear($t,e,_t){let At=_t;for(let xt=e-1;xt>0;xt--)At+=ISODaysInMonth($t,xt);return At}function WeekOfYear($t,e,_t){const At=DayOfYear($t,e,_t),xt=DayOfWeek($t,e,_t)||7,kt=DayOfWeek($t,1,1),Bt=ie((At-xt+10)/7);return Bt<1?kt===5||kt===6&&LeapYear($t-1)?{week:53,year:$t-1}:{week:52,year:$t-1}:Bt===53&&(LeapYear($t)?366:365)-At<4-xt?{week:1,year:$t+1}:{week:Bt,year:$t}}function DurationSign($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt){for(const jt of[$t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt])if(jt!==0)return jt<0?-1:1;return 0}function BalanceISOYearMonth($t,e){let _t=$t,At=e;if(!me(_t)||!me(At))throw new RangeError("infinity is out of range");return At-=1,_t+=ie(At/12),At%=12,At<0&&(At+=12),At+=1,{year:_t,month:At}}function BalanceISODate($t,e,_t){let At=$t,xt=e,kt=_t;if(!me(kt))throw new RangeError("infinity is out of range");({year:At,month:xt}=BalanceISOYearMonth(At,xt));const Bt=146097;if(ae(kt)>Bt){const Lt=le(kt/Bt);At+=400*Lt,kt-=Lt*Bt}let Nt=0,Ut=xt>2?At:At-1;for(;Nt=LeapYear(Ut)?366:365,kt<-Nt;)At-=1,Ut-=1,kt+=Nt;for(Ut+=1;Nt=LeapYear(Ut)?366:365,kt>Nt;)At+=1,Ut+=1,kt-=Nt;for(;kt<1;)({year:At,month:xt}=BalanceISOYearMonth(At,xt-1)),kt+=ISODaysInMonth(At,xt);for(;kt>ISODaysInMonth(At,xt);)kt-=ISODaysInMonth(At,xt),{year:At,month:xt}=BalanceISOYearMonth(At,xt+1);return{year:At,month:xt,day:kt}}function BalanceISODateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut){const{deltaDays:Lt,hour:jt,minute:Kt,second:qt,millisecond:zt,microsecond:Vt,nanosecond:Ht}=BalanceTime(At,xt,kt,Bt,Nt,Ut),{year:Wt,month:Qt,day:Xt}=BalanceISODate($t,e,_t+Lt);return{year:Wt,month:Qt,day:Xt,hour:jt,minute:Kt,second:qt,millisecond:zt,microsecond:Vt,nanosecond:Ht}}function BalanceTime($t,e,_t,At,xt,kt){let Bt,Nt=JSBI.BigInt($t),Ut=JSBI.BigInt(e),Lt=JSBI.BigInt(_t),jt=JSBI.BigInt(At),Kt=JSBI.BigInt(xt),qt=JSBI.BigInt(kt);return{quotient:Bt,remainder:qt}=NonNegativeBigIntDivmod(qt,De),Kt=JSBI.add(Kt,Bt),{quotient:Bt,remainder:Kt}=NonNegativeBigIntDivmod(Kt,De),jt=JSBI.add(jt,Bt),{quotient:Bt,remainder:jt}=NonNegativeBigIntDivmod(jt,De),Lt=JSBI.add(Lt,Bt),{quotient:Bt,remainder:Lt}=NonNegativeBigIntDivmod(Lt,ge),Ut=JSBI.add(Ut,Bt),{quotient:Bt,remainder:Ut}=NonNegativeBigIntDivmod(Ut,ge),Nt=JSBI.add(Nt,Bt),{quotient:Bt,remainder:Nt}=NonNegativeBigIntDivmod(Nt,we),{deltaDays:JSBI.toNumber(Bt),hour:JSBI.toNumber(Nt),minute:JSBI.toNumber(Ut),second:JSBI.toNumber(Lt),millisecond:JSBI.toNumber(jt),microsecond:JSBI.toNumber(Kt),nanosecond:JSBI.toNumber(qt)}}function TotalDurationNanoseconds($t,e,_t,At,xt,kt,Bt,Nt){const Ut=JSBI.BigInt($t);let Lt=JSBI.BigInt(Bt);$t!==0&&(Lt=JSBI.subtract(JSBI.BigInt(Bt),JSBI.BigInt(Nt)));const jt=JSBI.add(JSBI.BigInt(e),JSBI.multiply(Ut,JSBI.BigInt(24))),Kt=JSBI.add(JSBI.BigInt(_t),JSBI.multiply(jt,ge)),qt=JSBI.add(JSBI.BigInt(At),JSBI.multiply(Kt,ge)),zt=JSBI.add(JSBI.BigInt(xt),JSBI.multiply(qt,De)),Vt=JSBI.add(JSBI.BigInt(kt),JSBI.multiply(zt,De));return JSBI.add(JSBI.BigInt(Lt),JSBI.multiply(Vt,De))}function NanosecondsToDays($t,e){const _t=GetIntrinsic("%Temporal.Instant%"),At=se(JSBI.toNumber($t));let xt=JSBI.BigInt($t),kt=864e11;if(At===0)return{days:0,nanoseconds:Ie,dayLengthNs:kt};if(!IsTemporalZonedDateTime(e)){let Jt;return{quotient:Jt,remainder:xt}=divmod(xt,JSBI.BigInt(kt)),{days:JSBI.toNumber(Jt),nanoseconds:xt,dayLengthNs:kt}}const Bt=GetSlot(e,n),Nt=GetSlot(e,S),Ut=JSBI.add(Bt,xt),Lt=new _t(Ut),jt=GetSlot(e,g),Kt=GetSlot(e,p),qt=GetPlainDateTimeFor(jt,Nt,Kt),zt=GetPlainDateTimeFor(jt,Lt,Kt);let{days:Vt}=DifferenceISODateTime(GetSlot(qt,i$1),GetSlot(qt,s$1),GetSlot(qt,l),GetSlot(qt,d$1),GetSlot(qt,m$1),GetSlot(qt,c),GetSlot(qt,h$1),GetSlot(qt,u),GetSlot(qt,T),GetSlot(zt,i$1),GetSlot(zt,s$1),GetSlot(zt,l),GetSlot(zt,d$1),GetSlot(zt,m$1),GetSlot(zt,c),GetSlot(zt,h$1),GetSlot(zt,u),GetSlot(zt,T),Kt,"day",Te(null)),Ht=AddZonedDateTime(Nt,jt,Kt,0,0,0,Vt,0,0,0,0,0,0),Wt=JSBI.BigInt(Vt);if(At===1)for(;JSBI.greaterThan(Wt,Ie)&&JSBI.greaterThan(Ht,Ut);)Wt=JSBI.subtract(Wt,Se),Ht=AddZonedDateTime(Nt,jt,Kt,0,0,0,JSBI.toNumber(Wt),0,0,0,0,0,0);xt=JSBI.subtract(Ut,Ht);let Qt=!1,Xt=new _t(Ht);do{const Jt=AddZonedDateTime(Xt,jt,Kt,0,0,0,At,0,0,0,0,0,0),tr=GetSlot(Xt,n);kt=JSBI.toNumber(JSBI.subtract(Jt,tr)),Qt=JSBI.greaterThanOrEqual(JSBI.multiply(JSBI.subtract(xt,JSBI.BigInt(kt)),JSBI.BigInt(At)),Ie),Qt&&(xt=JSBI.subtract(xt,JSBI.BigInt(kt)),Xt=new _t(Jt),Wt=JSBI.add(Wt,JSBI.BigInt(At)))}while(Qt);if(!isZero(Wt)&&signJSBI(Wt)!==At)throw new RangeError("Time zone or calendar converted nanoseconds into a number of days with the opposite sign");if(!isZero(xt)&&signJSBI(xt)!==At)throw isNegativeJSBI(xt)&&At===1?new Error("assert not reached"):new RangeError("Time zone or calendar ended up with a remainder of nanoseconds with the opposite sign");if(JSBI.greaterThanOrEqual(abs(xt),abs(JSBI.BigInt(kt))))throw new Error("assert not reached");return{days:JSBI.toNumber(Wt),nanoseconds:xt,dayLengthNs:ae(kt)}}function BalanceDuration($t,e,_t,At,xt,kt,Bt,Nt,Ut){let Lt=BalancePossiblyInfiniteDuration($t,e,_t,At,xt,kt,Bt,Nt,Ut);if(Lt==="positive overflow"||Lt==="negative overflow")throw new RangeError("Duration out of range");return Lt}function BalancePossiblyInfiniteDuration($t,e,_t,At,xt,kt,Bt,Nt,Ut){let Lt,jt,Kt,qt,zt,Vt,Ht=$t;if(IsTemporalZonedDateTime(Ut)){const $r=AddZonedDateTime(GetSlot(Ut,S),GetSlot(Ut,g),GetSlot(Ut,p),0,0,0,Ht,e,_t,At,xt,kt,Bt),Ir=GetSlot(Ut,n);Lt=JSBI.subtract($r,Ir)}else Lt=TotalDurationNanoseconds(Ht,e,_t,At,xt,kt,Bt,0);Nt==="year"||Nt==="month"||Nt==="week"||Nt==="day"?{days:Ht,nanoseconds:Lt}=NanosecondsToDays(Lt,Ut):Ht=0;const Wt=JSBI.lessThan(Lt,Ie)?-1:1;switch(Lt=abs(Lt),jt=Kt=qt=zt=Vt=Ie,Nt){case"year":case"month":case"week":case"day":case"hour":({quotient:jt,remainder:Lt}=divmod(Lt,De)),{quotient:Kt,remainder:jt}=divmod(jt,De),{quotient:qt,remainder:Kt}=divmod(Kt,De),{quotient:zt,remainder:qt}=divmod(qt,ge),{quotient:Vt,remainder:zt}=divmod(zt,ge);break;case"minute":({quotient:jt,remainder:Lt}=divmod(Lt,De)),{quotient:Kt,remainder:jt}=divmod(jt,De),{quotient:qt,remainder:Kt}=divmod(Kt,De),{quotient:zt,remainder:qt}=divmod(qt,ge);break;case"second":({quotient:jt,remainder:Lt}=divmod(Lt,De)),{quotient:Kt,remainder:jt}=divmod(jt,De),{quotient:qt,remainder:Kt}=divmod(Kt,De);break;case"millisecond":({quotient:jt,remainder:Lt}=divmod(Lt,De)),{quotient:Kt,remainder:jt}=divmod(jt,De);break;case"microsecond":({quotient:jt,remainder:Lt}=divmod(Lt,De));break;case"nanosecond":break;default:throw new Error("assert not reached")}const Qt=JSBI.toNumber(Vt)*Wt,Xt=JSBI.toNumber(zt)*Wt,Jt=JSBI.toNumber(qt)*Wt,tr=JSBI.toNumber(Kt)*Wt,dr=JSBI.toNumber(jt)*Wt,vr=JSBI.toNumber(Lt)*Wt;for(const $r of[Ht,Qt,Xt,Jt,tr,dr,vr])if(!me($r))return Wt===1?"positive overflow":"negative overflow";return{days:Ht,hours:Qt,minutes:Xt,seconds:Jt,milliseconds:tr,microseconds:dr,nanoseconds:vr}}function UnbalanceDurationRelative($t,e,_t,At,xt,kt){const Bt=GetIntrinsic("%Temporal.Duration%"),Nt=DurationSign($t,e,_t,At,0,0,0,0,0,0);if(Nt===0)return{years:$t,months:e,weeks:_t,days:At};const Ut=JSBI.BigInt(Nt);let Lt,jt,Kt=JSBI.BigInt($t),qt=JSBI.BigInt(e),zt=JSBI.BigInt(_t),Vt=JSBI.BigInt(At);kt&&(jt=ToTemporalDate(kt),Lt=GetSlot(jt,p));const Ht=new Bt(Nt),Wt=new Bt(0,Nt),Qt=new Bt(0,0,Nt);switch(xt){case"year":break;case"month":{if(!Lt)throw new RangeError("a starting point is required for months balancing");let Xt,Jt;for(typeof Lt!="string"&&(Xt=GetMethod(Lt,"dateAdd"),Jt=GetMethod(Lt,"dateUntil"));!isZero(Kt);){const tr=CalendarDateAdd(Lt,jt,Ht,void 0,Xt),dr=Te(null);dr.largestUnit="month";const vr=CalendarDateUntil(Lt,jt,tr,dr,Jt),$r=JSBI.BigInt(GetSlot(vr,D));jt=tr,qt=JSBI.add(qt,$r),Kt=JSBI.subtract(Kt,Ut)}}break;case"week":{if(!Lt)throw new RangeError("a starting point is required for weeks balancing");const Xt=typeof Lt!="string"?GetMethod(Lt,"dateAdd"):void 0;for(;!isZero(Kt);){let Jt;({relativeTo:jt,days:Jt}=MoveRelativeDate(Lt,jt,Ht,Xt)),Vt=JSBI.add(Vt,JSBI.BigInt(Jt)),Kt=JSBI.subtract(Kt,Ut)}for(;!isZero(qt);){let Jt;({relativeTo:jt,days:Jt}=MoveRelativeDate(Lt,jt,Wt,Xt)),Vt=JSBI.add(Vt,JSBI.BigInt(Jt)),qt=JSBI.subtract(qt,Ut)}break}default:{if(isZero(Kt)&&isZero(qt)&&isZero(zt))break;if(!Lt)throw new RangeError("a starting point is required for balancing calendar units");const Xt=typeof Lt!="string"?GetMethod(Lt,"dateAdd"):void 0;for(;!isZero(Kt);){let Jt;({relativeTo:jt,days:Jt}=MoveRelativeDate(Lt,jt,Ht,Xt)),Vt=JSBI.add(Vt,JSBI.BigInt(Jt)),Kt=JSBI.subtract(Kt,Ut)}for(;!isZero(qt);){let Jt;({relativeTo:jt,days:Jt}=MoveRelativeDate(Lt,jt,Wt,Xt)),Vt=JSBI.add(Vt,JSBI.BigInt(Jt)),qt=JSBI.subtract(qt,Ut)}for(;!isZero(zt);){let Jt;({relativeTo:jt,days:Jt}=MoveRelativeDate(Lt,jt,Qt,Xt)),Vt=JSBI.add(Vt,JSBI.BigInt(Jt)),zt=JSBI.subtract(zt,Ut)}break}}return{years:JSBI.toNumber(Kt),months:JSBI.toNumber(qt),weeks:JSBI.toNumber(zt),days:JSBI.toNumber(Vt)}}function CalculateOffsetShift($t,e,_t,At,xt){if(IsTemporalZonedDateTime($t)){const kt=GetSlot($t,S),Bt=GetSlot($t,g),Nt=GetSlot($t,p),Ut=GetOffsetNanosecondsFor(Bt,kt),Lt=AddZonedDateTime(kt,Bt,Nt,e,_t,At,xt,0,0,0,0,0,0);return GetOffsetNanosecondsFor(Bt,new(GetIntrinsic("%Temporal.Instant%"))(Lt))-Ut}return 0}function CreateNegatedTemporalDuration($t){return new(GetIntrinsic("%Temporal.Duration%"))(-GetSlot($t,w$1),-GetSlot($t,D),-GetSlot($t,G),-GetSlot($t,v),-GetSlot($t,C),-GetSlot($t,O),-GetSlot($t,b),-GetSlot($t,E$1),-GetSlot($t,M),-GetSlot($t,R))}function ConstrainToRange($t,e,_t){return oe(_t,ne(e,$t))}function ConstrainISODate($t,e,_t){const At=ConstrainToRange(e,1,12);return{year:$t,month:At,day:ConstrainToRange(_t,1,ISODaysInMonth($t,At))}}function RejectToRange($t,e,_t){if($t<e||$t>_t)throw new RangeError(`value out of range: ${e} <= ${$t} <= ${_t}`)}function RejectISODate($t,e,_t){RejectToRange(e,1,12),RejectToRange(_t,1,ISODaysInMonth($t,e))}function RejectDateRange($t,e,_t){RejectDateTimeRange($t,e,_t,12,0,0,0,0,0)}function RejectTime($t,e,_t,At,xt,kt){RejectToRange($t,0,23),RejectToRange(e,0,59),RejectToRange(_t,0,59),RejectToRange(At,0,999),RejectToRange(xt,0,999),RejectToRange(kt,0,999)}function RejectDateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut){RejectISODate($t,e,_t),RejectTime(At,xt,kt,Bt,Nt,Ut)}function RejectDateTimeRange($t,e,_t,At,xt,kt,Bt,Nt,Ut){if(RejectToRange($t,Fe,Ye),$t===Fe&&GetUTCEpochNanoseconds($t,e,_t+1,At,xt,kt,Bt,Nt,Ut-1)==null||$t===Ye&&GetUTCEpochNanoseconds($t,e,_t-1,At,xt,kt,Bt,Nt,Ut+1)==null)throw new RangeError("DateTime outside of supported range")}function ValidateEpochNanoseconds($t){if(JSBI.lessThan($t,Me)||JSBI.greaterThan($t,Re))throw new RangeError("Instant outside of supported range")}function RejectDuration($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt){const jt=DurationSign($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt);for(const Kt of[$t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt]){if(!me(Kt))throw new RangeError("infinite values not allowed as duration fields");const qt=se(Kt);if(qt!==0&&qt!==jt)throw new RangeError("mixed-sign values not allowed as duration fields")}}function DifferenceISODate($t,e,_t,At,xt,kt,Bt){switch(Bt){case"year":case"month":{const Nt=-CompareISODate($t,e,_t,At,xt,kt);if(Nt===0)return{years:0,months:0,weeks:0,days:0};const Ut={year:$t,month:e,day:_t},Lt={year:At,month:xt,day:kt};let jt=Lt.year-Ut.year,Kt=AddISODate($t,e,_t,jt,0,0,0,"constrain"),qt=-CompareISODate(Kt.year,Kt.month,Kt.day,At,xt,kt);if(qt===0)return Bt==="year"?{years:jt,months:0,weeks:0,days:0}:{years:0,months:12*jt,weeks:0,days:0};let zt=Lt.month-Ut.month;if(qt!==Nt&&(jt-=Nt,zt+=12*Nt),Kt=AddISODate($t,e,_t,jt,zt,0,0,"constrain"),qt=-CompareISODate(Kt.year,Kt.month,Kt.day,At,xt,kt),qt===0)return Bt==="year"?{years:jt,months:zt,weeks:0,days:0}:{years:0,months:zt+12*jt,weeks:0,days:0};qt!==Nt&&(zt-=Nt,zt===-Nt&&(jt-=Nt,zt=11*Nt),Kt=AddISODate($t,e,_t,jt,zt,0,0,"constrain"));let Vt=0;return Vt=Kt.month===Lt.month?Lt.day-Kt.day:Nt<0?-Kt.day-(ISODaysInMonth(Lt.year,Lt.month)-Lt.day):Lt.day+(ISODaysInMonth(Kt.year,Kt.month)-Kt.day),Bt==="month"&&(zt+=12*jt,jt=0),{years:jt,months:zt,weeks:0,days:Vt}}case"week":case"day":{let Nt,Ut,Lt;CompareISODate($t,e,_t,At,xt,kt)<0?(Ut={year:$t,month:e,day:_t},Nt={year:At,month:xt,day:kt},Lt=1):(Ut={year:At,month:xt,day:kt},Nt={year:$t,month:e,day:_t},Lt=-1);let jt=DayOfYear(Nt.year,Nt.month,Nt.day)-DayOfYear(Ut.year,Ut.month,Ut.day);for(let qt=Ut.year;qt<Nt.year;++qt)jt+=LeapYear(qt)?366:365;let Kt=0;return Bt==="week"&&(Kt=ie(jt/7),jt%=7),Kt*=Lt,jt*=Lt,{years:0,months:0,weeks:Kt,days:jt}}default:throw new Error("assert not reached")}}function DifferenceTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt){let qt=Bt-$t,zt=Nt-e,Vt=Ut-_t,Ht=Lt-At,Wt=jt-xt,Qt=Kt-kt;const Xt=DurationSign(0,0,0,0,qt,zt,Vt,Ht,Wt,Qt);qt*=Xt,zt*=Xt,Vt*=Xt,Ht*=Xt,Wt*=Xt,Qt*=Xt;let Jt=0;if({deltaDays:Jt,hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt}=BalanceTime(qt,zt,Vt,Ht,Wt,Qt),Jt!=0)throw new Error("assertion failure in DifferenceTime: _bt_.[[Days]] should be 0");return qt*=Xt,zt*=Xt,Vt*=Xt,Ht*=Xt,Wt*=Xt,Qt*=Xt,{hours:qt,minutes:zt,seconds:Vt,milliseconds:Ht,microseconds:Wt,nanoseconds:Qt}}function DifferenceInstant($t,e,_t,At,xt,kt){const Bt=JSBI.subtract(e,$t);let Nt=0,Ut=0,Lt=JSBI.toNumber(JSBI.remainder(Bt,De)),jt=JSBI.toNumber(JSBI.remainder(JSBI.divide(Bt,De),De)),Kt=JSBI.toNumber(JSBI.remainder(JSBI.divide(Bt,Ge),De)),qt=JSBI.toNumber(JSBI.divide(Bt,ve));return{hours:Nt,minutes:Ut,seconds:qt,milliseconds:Kt,microseconds:jt,nanoseconds:Lt}=RoundDuration(0,0,0,0,0,0,qt,Kt,jt,Lt,_t,At,kt),BalanceDuration(0,Nt,Ut,qt,Kt,jt,Lt,xt)}function DifferenceISODateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr){let dr=$t,vr=e,$r=_t,{hours:Ir,minutes:Rr,seconds:Nr,milliseconds:kr,microseconds:lr,nanoseconds:ir}=DifferenceTime(At,xt,kt,Bt,Nt,Ut,qt,zt,Vt,Ht,Wt,Qt);const er=DurationSign(0,0,0,0,Ir,Rr,Nr,kr,lr,ir);CompareISODate(Lt,jt,Kt,dr,vr,$r)===-er&&({year:dr,month:vr,day:$r}=BalanceISODate(dr,vr,$r-er),{hours:Ir,minutes:Rr,seconds:Nr,milliseconds:kr,microseconds:lr,nanoseconds:ir}=BalanceDuration(-er,Ir,Rr,Nr,kr,lr,ir,Jt));const rr=CreateTemporalDate(dr,vr,$r,Xt),yr=CreateTemporalDate(Lt,jt,Kt,Xt),fr=LargerOfTwoTemporalUnits("day",Jt),gr=CopyOptions(tr);gr.largestUnit=fr;let{years:ar,months:nr,weeks:ur,days:pr}=CalendarDateUntil(Xt,rr,yr,gr);return{days:pr,hours:Ir,minutes:Rr,seconds:Nr,milliseconds:kr,microseconds:lr,nanoseconds:ir}=BalanceDuration(pr,Ir,Rr,Nr,kr,lr,ir,Jt),{years:ar,months:nr,weeks:ur,days:pr,hours:Ir,minutes:Rr,seconds:Nr,milliseconds:kr,microseconds:lr,nanoseconds:ir}}function DifferenceZonedDateTime($t,e,_t,At,xt,kt){const Bt=JSBI.subtract(e,$t);if(JSBI.equal(Bt,Ie))return{years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0,microseconds:0,nanoseconds:0};const Nt=GetIntrinsic("%Temporal.Instant%"),Ut=new Nt($t),Lt=new Nt(e),jt=GetPlainDateTimeFor(_t,Ut,At),Kt=GetPlainDateTimeFor(_t,Lt,At);let{years:qt,months:zt,weeks:Vt,days:Ht}=DifferenceISODateTime(GetSlot(jt,i$1),GetSlot(jt,s$1),GetSlot(jt,l),GetSlot(jt,d$1),GetSlot(jt,m$1),GetSlot(jt,c),GetSlot(jt,h$1),GetSlot(jt,u),GetSlot(jt,T),GetSlot(Kt,i$1),GetSlot(Kt,s$1),GetSlot(Kt,l),GetSlot(Kt,d$1),GetSlot(Kt,m$1),GetSlot(Kt,c),GetSlot(Kt,h$1),GetSlot(Kt,u),GetSlot(Kt,T),At,xt,kt);const Wt=AddZonedDateTime(Ut,_t,At,qt,zt,Vt,0,0,0,0,0,0,0);let Qt=JSBI.subtract(e,Wt);const Xt=CreateTemporalZonedDateTime(Wt,_t,At);({nanoseconds:Qt,days:Ht}=NanosecondsToDays(Qt,Xt));const{hours:Jt,minutes:tr,seconds:dr,milliseconds:vr,microseconds:$r,nanoseconds:Ir}=BalanceDuration(0,0,0,0,0,0,JSBI.toNumber(Qt),"hour");return{years:qt,months:zt,weeks:Vt,days:Ht,hours:Jt,minutes:tr,seconds:dr,milliseconds:vr,microseconds:$r,nanoseconds:Ir}}function GetDifferenceSettings($t,e,_t,At,xt,kt){const Bt=Ue.reduce((zt,Vt)=>{const Ht=Vt[0],Wt=Vt[1],Qt=Vt[2];return _t!=="datetime"&&Qt!==_t||At.includes(Wt)||zt.push(Wt,Ht),zt},[]);let Nt=GetTemporalUnit(e,"largestUnit",_t,"auto");if(At.includes(Nt))throw new RangeError(`largestUnit must be one of ${Bt.join(", ")}, not ${Nt}`);const Ut=ToTemporalRoundingIncrement(e);let Lt=ToTemporalRoundingMode(e,"trunc");$t==="since"&&(Lt=function(Vt){switch(Vt){case"ceil":return"floor";case"floor":return"ceil";case"halfCeil":return"halfFloor";case"halfFloor":return"halfCeil";default:return Vt}}(Lt));const jt=GetTemporalUnit(e,"smallestUnit",_t,xt);if(At.includes(jt))throw new RangeError(`smallestUnit must be one of ${Bt.join(", ")}, not ${jt}`);const Kt=LargerOfTwoTemporalUnits(kt,jt);if(Nt==="auto"&&(Nt=Kt),LargerOfTwoTemporalUnits(Nt,jt)!==Nt)throw new RangeError(`largestUnit ${Nt} cannot be smaller than smallestUnit ${jt}`);const qt={hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[jt];return qt!==void 0&&ValidateTemporalRoundingIncrement(Ut,qt,!1),{largestUnit:Nt,roundingIncrement:Ut,roundingMode:Lt,smallestUnit:jt}}function DifferenceTemporalInstant($t,e,_t,At){const xt=$t==="since"?-1:1,kt=ToTemporalInstant(_t),Bt=GetDifferenceSettings($t,CopyOptions(At),"time",[],"nanosecond","second"),Nt=GetSlot(e,n),Ut=GetSlot(kt,n);let{hours:Lt,minutes:jt,seconds:Kt,milliseconds:qt,microseconds:zt,nanoseconds:Vt}=DifferenceInstant(Nt,Ut,Bt.roundingIncrement,Bt.smallestUnit,Bt.largestUnit,Bt.roundingMode);return new(GetIntrinsic("%Temporal.Duration%"))(0,0,0,0,xt*Lt,xt*jt,xt*Kt,xt*qt,xt*zt,xt*Vt)}function DifferenceTemporalPlainDate($t,e,_t,At){const xt=$t==="since"?-1:1,kt=ToTemporalDate(_t),Bt=GetSlot(e,p);ThrowIfCalendarsNotEqual(Bt,GetSlot(kt,p),"compute difference between dates");const Nt=CopyOptions(At),Ut=GetDifferenceSettings($t,Nt,"date",[],"day","day");Nt.largestUnit=Ut.largestUnit;let{years:Lt,months:jt,weeks:Kt,days:qt}=CalendarDateUntil(Bt,e,kt,Nt);return Ut.smallestUnit==="day"&&Ut.roundingIncrement===1||({years:Lt,months:jt,weeks:Kt,days:qt}=RoundDuration(Lt,jt,Kt,qt,0,0,0,0,0,0,Ut.roundingIncrement,Ut.smallestUnit,Ut.roundingMode,e)),new(GetIntrinsic("%Temporal.Duration%"))(xt*Lt,xt*jt,xt*Kt,xt*qt,0,0,0,0,0,0)}function DifferenceTemporalPlainDateTime($t,e,_t,At){const xt=$t==="since"?-1:1,kt=ToTemporalDateTime(_t),Bt=GetSlot(e,p);ThrowIfCalendarsNotEqual(Bt,GetSlot(kt,p),"compute difference between dates");const Nt=CopyOptions(At),Ut=GetDifferenceSettings($t,Nt,"datetime",[],"nanosecond","day");let{years:Lt,months:jt,weeks:Kt,days:qt,hours:zt,minutes:Vt,seconds:Ht,milliseconds:Wt,microseconds:Qt,nanoseconds:Xt}=DifferenceISODateTime(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),GetSlot(kt,i$1),GetSlot(kt,s$1),GetSlot(kt,l),GetSlot(kt,d$1),GetSlot(kt,m$1),GetSlot(kt,c),GetSlot(kt,h$1),GetSlot(kt,u),GetSlot(kt,T),Bt,Ut.largestUnit,Nt);const Jt=TemporalDateTimeToDate(e);return{years:Lt,months:jt,weeks:Kt,days:qt,hours:zt,minutes:Vt,seconds:Ht,milliseconds:Wt,microseconds:Qt,nanoseconds:Xt}=RoundDuration(Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Ut.roundingIncrement,Ut.smallestUnit,Ut.roundingMode,Jt),{days:qt,hours:zt,minutes:Vt,seconds:Ht,milliseconds:Wt,microseconds:Qt,nanoseconds:Xt}=BalanceDuration(qt,zt,Vt,Ht,Wt,Qt,Xt,Ut.largestUnit),new(GetIntrinsic("%Temporal.Duration%"))(xt*Lt,xt*jt,xt*Kt,xt*qt,xt*zt,xt*Vt,xt*Ht,xt*Wt,xt*Qt,xt*Xt)}function DifferenceTemporalPlainTime($t,e,_t,At){const xt=$t==="since"?-1:1,kt=ToTemporalTime(_t),Bt=GetDifferenceSettings($t,CopyOptions(At),"time",[],"nanosecond","hour");let{hours:Nt,minutes:Ut,seconds:Lt,milliseconds:jt,microseconds:Kt,nanoseconds:qt}=DifferenceTime(GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),GetSlot(kt,d$1),GetSlot(kt,m$1),GetSlot(kt,c),GetSlot(kt,h$1),GetSlot(kt,u),GetSlot(kt,T));return{hours:Nt,minutes:Ut,seconds:Lt,milliseconds:jt,microseconds:Kt,nanoseconds:qt}=RoundDuration(0,0,0,0,Nt,Ut,Lt,jt,Kt,qt,Bt.roundingIncrement,Bt.smallestUnit,Bt.roundingMode),{hours:Nt,minutes:Ut,seconds:Lt,milliseconds:jt,microseconds:Kt,nanoseconds:qt}=BalanceDuration(0,Nt,Ut,Lt,jt,Kt,qt,Bt.largestUnit),new(GetIntrinsic("%Temporal.Duration%"))(0,0,0,0,xt*Nt,xt*Ut,xt*Lt,xt*jt,xt*Kt,xt*qt)}function DifferenceTemporalPlainYearMonth($t,e,_t,At){const xt=$t==="since"?-1:1,kt=ToTemporalYearMonth(_t),Bt=GetSlot(e,p);ThrowIfCalendarsNotEqual(Bt,GetSlot(kt,p),"compute difference between months");const Nt=CopyOptions(At),Ut=GetDifferenceSettings($t,Nt,"date",["week","day"],"month","year");Nt.largestUnit=Ut.largestUnit;const Lt=CalendarFields(Bt,["monthCode","year"]),jt=PrepareTemporalFields(e,Lt,[]);jt.day=1;const Kt=CalendarDateFromFields(Bt,jt),qt=PrepareTemporalFields(kt,Lt,[]);qt.day=1;const zt=CalendarDateFromFields(Bt,qt);let{years:Vt,months:Ht}=CalendarDateUntil(Bt,Kt,zt,Nt);return Ut.smallestUnit==="month"&&Ut.roundingIncrement===1||({years:Vt,months:Ht}=RoundDuration(Vt,Ht,0,0,0,0,0,0,0,0,Ut.roundingIncrement,Ut.smallestUnit,Ut.roundingMode,Kt)),new(GetIntrinsic("%Temporal.Duration%"))(xt*Vt,xt*Ht,0,0,0,0,0,0,0,0)}function DifferenceTemporalZonedDateTime($t,e,_t,At){const xt=$t==="since"?-1:1,kt=ToTemporalZonedDateTime(_t),Bt=GetSlot(e,p);ThrowIfCalendarsNotEqual(Bt,GetSlot(kt,p),"compute difference between dates");const Nt=CopyOptions(At),Ut=GetDifferenceSettings($t,Nt,"datetime",[],"nanosecond","hour");Nt.largestUnit=Ut.largestUnit;const Lt=GetSlot(e,n),jt=GetSlot(kt,n);let Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr;if(Ut.largestUnit!=="year"&&Ut.largestUnit!=="month"&&Ut.largestUnit!=="week"&&Ut.largestUnit!=="day")Kt=0,qt=0,zt=0,Vt=0,{hours:Ht,minutes:Wt,seconds:Qt,milliseconds:Xt,microseconds:Jt,nanoseconds:tr}=DifferenceInstant(Lt,jt,Ut.roundingIncrement,Ut.smallestUnit,Ut.largestUnit,Ut.roundingMode);else{const dr=GetSlot(e,g);if(!TimeZoneEquals(dr,GetSlot(kt,g)))throw new RangeError("When calculating difference between time zones, largestUnit must be 'hours' or smaller because day lengths can vary between time zones due to DST or time zone offset changes.");({years:Kt,months:qt,weeks:zt,days:Vt,hours:Ht,minutes:Wt,seconds:Qt,milliseconds:Xt,microseconds:Jt,nanoseconds:tr}=DifferenceZonedDateTime(Lt,jt,dr,Bt,Ut.largestUnit,Nt)),{years:Kt,months:qt,weeks:zt,days:Vt,hours:Ht,minutes:Wt,seconds:Qt,milliseconds:Xt,microseconds:Jt,nanoseconds:tr}=RoundDuration(Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr,Ut.roundingIncrement,Ut.smallestUnit,Ut.roundingMode,e),{years:Kt,months:qt,weeks:zt,days:Vt,hours:Ht,minutes:Wt,seconds:Qt,milliseconds:Xt,microseconds:Jt,nanoseconds:tr}=AdjustRoundedDurationDays(Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr,Ut.roundingIncrement,Ut.smallestUnit,Ut.roundingMode,e)}return new(GetIntrinsic("%Temporal.Duration%"))(xt*Kt,xt*qt,xt*zt,xt*Vt,xt*Ht,xt*Wt,xt*Qt,xt*Xt,xt*Jt,xt*tr)}function AddISODate($t,e,_t,At,xt,kt,Bt,Nt){let Ut=$t,Lt=e,jt=_t,Kt=kt,qt=Bt;return Ut+=At,Lt+=xt,{year:Ut,month:Lt}=BalanceISOYearMonth(Ut,Lt),{year:Ut,month:Lt,day:jt}=RegulateISODate(Ut,Lt,jt,Nt),qt+=7*Kt,jt+=qt,{year:Ut,month:Lt,day:jt}=BalanceISODate(Ut,Lt,jt),{year:Ut,month:Lt,day:jt}}function AddTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt){let qt=$t,zt=e,Vt=_t,Ht=At,Wt=xt,Qt=kt;qt+=Bt,zt+=Nt,Vt+=Ut,Ht+=Lt,Wt+=jt,Qt+=Kt;let Xt=0;return{deltaDays:Xt,hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt}=BalanceTime(qt,zt,Vt,Ht,Wt,Qt),{deltaDays:Xt,hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt}}function AddDuration($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr){const dr=LargerOfTwoTemporalUnits(DefaultTemporalLargestUnit($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt),DefaultTemporalLargestUnit(jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt));let vr,$r,Ir,Rr,Nr,kr,lr,ir,er,rr;if(tr)if(IsTemporalDate(tr)){const yr=GetIntrinsic("%Temporal.Duration%"),fr=GetSlot(tr,p),gr=new yr($t,e,_t,At,0,0,0,0,0,0),ar=new yr(jt,Kt,qt,zt,0,0,0,0,0,0),nr=typeof fr!="string"?GetMethod(fr,"dateAdd"):void 0,ur=CalendarDateAdd(fr,tr,gr,void 0,nr),pr=CalendarDateAdd(fr,ur,ar,void 0,nr),br=LargerOfTwoTemporalUnits("day",dr),Sr=Te(null);Sr.largestUnit=br,{years:vr,months:$r,weeks:Ir,days:Rr}=CalendarDateUntil(fr,tr,pr,Sr),{days:Rr,hours:Nr,minutes:kr,seconds:lr,milliseconds:ir,microseconds:er,nanoseconds:rr}=BalanceDuration(Rr,JSBI.add(JSBI.BigInt(xt),JSBI.BigInt(Vt)),JSBI.add(JSBI.BigInt(kt),JSBI.BigInt(Ht)),JSBI.add(JSBI.BigInt(Bt),JSBI.BigInt(Wt)),JSBI.add(JSBI.BigInt(Nt),JSBI.BigInt(Qt)),JSBI.add(JSBI.BigInt(Ut),JSBI.BigInt(Xt)),JSBI.add(JSBI.BigInt(Lt),JSBI.BigInt(Jt)),dr)}else{const yr=GetIntrinsic("%Temporal.Instant%"),fr=GetSlot(tr,g),gr=GetSlot(tr,p),ar=AddZonedDateTime(GetSlot(tr,S),fr,gr,$t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt),nr=AddZonedDateTime(new yr(ar),fr,gr,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt);dr!=="year"&&dr!=="month"&&dr!=="week"&&dr!=="day"?(vr=0,$r=0,Ir=0,Rr=0,{hours:Nr,minutes:kr,seconds:lr,milliseconds:ir,microseconds:er,nanoseconds:rr}=DifferenceInstant(GetSlot(tr,n),nr,1,"nanosecond",dr,"halfExpand")):{years:vr,months:$r,weeks:Ir,days:Rr,hours:Nr,minutes:kr,seconds:lr,milliseconds:ir,microseconds:er,nanoseconds:rr}=DifferenceZonedDateTime(GetSlot(tr,n),nr,fr,gr,dr,Te(null))}else{if(dr==="year"||dr==="month"||dr==="week")throw new RangeError("relativeTo is required for years, months, or weeks arithmetic");vr=$r=Ir=0,{days:Rr,hours:Nr,minutes:kr,seconds:lr,milliseconds:ir,microseconds:er,nanoseconds:rr}=BalanceDuration(At+zt,JSBI.add(JSBI.BigInt(xt),JSBI.BigInt(Vt)),JSBI.add(JSBI.BigInt(kt),JSBI.BigInt(Ht)),JSBI.add(JSBI.BigInt(Bt),JSBI.BigInt(Wt)),JSBI.add(JSBI.BigInt(Nt),JSBI.BigInt(Qt)),JSBI.add(JSBI.BigInt(Ut),JSBI.BigInt(Xt)),JSBI.add(JSBI.BigInt(Lt),JSBI.BigInt(Jt)),dr)}return RejectDuration(vr,$r,Ir,Rr,Nr,kr,lr,ir,er,rr),{years:vr,months:$r,weeks:Ir,days:Rr,hours:Nr,minutes:kr,seconds:lr,milliseconds:ir,microseconds:er,nanoseconds:rr}}function AddInstant($t,e,_t,At,xt,kt,Bt){let Nt=Ie;Nt=JSBI.add(Nt,JSBI.BigInt(Bt)),Nt=JSBI.add(Nt,JSBI.multiply(JSBI.BigInt(kt),De)),Nt=JSBI.add(Nt,JSBI.multiply(JSBI.BigInt(xt),Ge)),Nt=JSBI.add(Nt,JSBI.multiply(JSBI.BigInt(At),ve)),Nt=JSBI.add(Nt,JSBI.multiply(JSBI.BigInt(_t),JSBI.BigInt(6e10))),Nt=JSBI.add(Nt,JSBI.multiply(JSBI.BigInt(e),JSBI.BigInt(36e11)));const Ut=JSBI.add($t,Nt);return ValidateEpochNanoseconds(Ut),Ut}function AddDateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr){let dr=zt,{deltaDays:vr,hour:$r,minute:Ir,second:Rr,millisecond:Nr,microsecond:kr,nanosecond:lr}=AddTime(At,xt,kt,Bt,Nt,Ut,Vt,Ht,Wt,Qt,Xt,Jt);dr+=vr;const ir=GetIntrinsic("%Temporal.Duration%"),er=CalendarDateAdd(Lt,CreateTemporalDate($t,e,_t,Lt),new ir(jt,Kt,qt,dr,0,0,0,0,0,0),tr);return{year:GetSlot(er,i$1),month:GetSlot(er,s$1),day:GetSlot(er,l),hour:$r,minute:Ir,second:Rr,millisecond:Nr,microsecond:kr,nanosecond:lr}}function AddZonedDateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt){const Vt=GetIntrinsic("%Temporal.Duration%");if(DurationSign(At,xt,kt,Bt,0,0,0,0,0,0)===0)return AddInstant(GetSlot($t,n),Nt,Ut,Lt,jt,Kt,qt);const Ht=GetPlainDateTimeFor(e,$t,_t),Wt=CalendarDateAdd(_t,CreateTemporalDate(GetSlot(Ht,i$1),GetSlot(Ht,s$1),GetSlot(Ht,l),_t),new Vt(At,xt,kt,Bt,0,0,0,0,0,0),zt),Qt=CreateTemporalDateTime(GetSlot(Wt,i$1),GetSlot(Wt,s$1),GetSlot(Wt,l),GetSlot(Ht,d$1),GetSlot(Ht,m$1),GetSlot(Ht,c),GetSlot(Ht,h$1),GetSlot(Ht,u),GetSlot(Ht,T),_t);return AddInstant(GetSlot(GetInstantFor(e,Qt,"compatible"),n),Nt,Ut,Lt,jt,Kt,qt)}function AddDurationToOrSubtractDurationFromDuration($t,e,_t,At){const xt=$t==="subtract"?-1:1;let{years:kt,months:Bt,weeks:Nt,days:Ut,hours:Lt,minutes:jt,seconds:Kt,milliseconds:qt,microseconds:zt,nanoseconds:Vt}=ToTemporalDurationRecord(_t);const Ht=ToRelativeTemporalObject(GetOptionsObject(At));return{years:kt,months:Bt,weeks:Nt,days:Ut,hours:Lt,minutes:jt,seconds:Kt,milliseconds:qt,microseconds:zt,nanoseconds:Vt}=AddDuration(GetSlot(e,w$1),GetSlot(e,D),GetSlot(e,G),GetSlot(e,v),GetSlot(e,C),GetSlot(e,O),GetSlot(e,b),GetSlot(e,E$1),GetSlot(e,M),GetSlot(e,R),xt*kt,xt*Bt,xt*Nt,xt*Ut,xt*Lt,xt*jt,xt*Kt,xt*qt,xt*zt,xt*Vt,Ht),new(GetIntrinsic("%Temporal.Duration%"))(kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt)}function AddDurationToOrSubtractDurationFromInstant($t,e,_t){const At=$t==="subtract"?-1:1,{hours:xt,minutes:kt,seconds:Bt,milliseconds:Nt,microseconds:Ut,nanoseconds:Lt}=function(qt,zt){let Vt=ToTemporalDurationRecord(qt);for(const Ht of zt)if(Vt[Ht]!==0)throw new RangeError(`Duration field ${Ht} not supported by Temporal.Instant. Try Temporal.ZonedDateTime instead.`);return Vt}(_t,["years","months","weeks","days"]),jt=AddInstant(GetSlot(e,n),At*xt,At*kt,At*Bt,At*Nt,At*Ut,At*Lt);return new(GetIntrinsic("%Temporal.Instant%"))(jt)}function AddDurationToOrSubtractDurationFromPlainDateTime($t,e,_t,At){const xt=$t==="subtract"?-1:1,{years:kt,months:Bt,weeks:Nt,days:Ut,hours:Lt,minutes:jt,seconds:Kt,milliseconds:qt,microseconds:zt,nanoseconds:Vt}=ToTemporalDurationRecord(_t),Ht=GetOptionsObject(At),Wt=GetSlot(e,p),{year:Qt,month:Xt,day:Jt,hour:tr,minute:dr,second:vr,millisecond:$r,microsecond:Ir,nanosecond:Rr}=AddDateTime(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),Wt,xt*kt,xt*Bt,xt*Nt,xt*Ut,xt*Lt,xt*jt,xt*Kt,xt*qt,xt*zt,xt*Vt,Ht);return CreateTemporalDateTime(Qt,Xt,Jt,tr,dr,vr,$r,Ir,Rr,Wt)}function AddDurationToOrSubtractDurationFromPlainTime($t,e,_t){const At=$t==="subtract"?-1:1,{hours:xt,minutes:kt,seconds:Bt,milliseconds:Nt,microseconds:Ut,nanoseconds:Lt}=ToTemporalDurationRecord(_t);let{hour:jt,minute:Kt,second:qt,millisecond:zt,microsecond:Vt,nanosecond:Ht}=AddTime(GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),At*xt,At*kt,At*Bt,At*Nt,At*Ut,At*Lt);return{hour:jt,minute:Kt,second:qt,millisecond:zt,microsecond:Vt,nanosecond:Ht}=RegulateTime(jt,Kt,qt,zt,Vt,Ht,"reject"),new(GetIntrinsic("%Temporal.PlainTime%"))(jt,Kt,qt,zt,Vt,Ht)}function AddDurationToOrSubtractDurationFromPlainYearMonth($t,e,_t,At){let xt=ToTemporalDurationRecord(_t);$t==="subtract"&&(xt={years:-xt.years,months:-xt.months,weeks:-xt.weeks,days:-xt.days,hours:-xt.hours,minutes:-xt.minutes,seconds:-xt.seconds,milliseconds:-xt.milliseconds,microseconds:-xt.microseconds,nanoseconds:-xt.nanoseconds});let{years:kt,months:Bt,weeks:Nt,days:Ut,hours:Lt,minutes:jt,seconds:Kt,milliseconds:qt,microseconds:zt,nanoseconds:Vt}=xt;({days:Ut}=BalanceDuration(Ut,Lt,jt,Kt,qt,zt,Vt,"day"));const Ht=GetOptionsObject(At),Wt=GetSlot(e,p),Qt=CalendarFields(Wt,["monthCode","year"]),Xt=PrepareTemporalFields(e,Qt,[]),Jt=Te(null);CopyDataProperties(Jt,Xt,[]),Xt.day=1;let tr=CalendarDateFromFields(Wt,Xt);const dr=DurationSign(kt,Bt,Nt,Ut,0,0,0,0,0,0),vr=GetMethod(Wt,"dateAdd"),$r=GetIntrinsic("%Temporal.Duration%");if(dr<0){const Nr=CalendarDateAdd(Wt,tr,new $r(0,1,0,0,0,0,0,0,0,0),void 0,vr),kr=CalendarDateAdd(Wt,Nr,new $r(0,0,0,-1,0,0,0,0,0,0),void 0,vr);Jt.day=CalendarDay(Wt,kr),tr=CalendarDateFromFields(Wt,Jt)}const Ir=new $r(kt,Bt,Nt,Ut,0,0,0,0,0,0),Rr=CopyOptions(Ht);return CalendarYearMonthFromFields(Wt,PrepareTemporalFields(CalendarDateAdd(Wt,tr,Ir,Ht,vr),Qt,[]),Rr)}function AddDurationToOrSubtractDurationFromZonedDateTime($t,e,_t,At){const xt=$t==="subtract"?-1:1,{years:kt,months:Bt,weeks:Nt,days:Ut,hours:Lt,minutes:jt,seconds:Kt,milliseconds:qt,microseconds:zt,nanoseconds:Vt}=ToTemporalDurationRecord(_t),Ht=GetOptionsObject(At),Wt=GetSlot(e,g),Qt=GetSlot(e,p);return CreateTemporalZonedDateTime(AddZonedDateTime(GetSlot(e,S),Wt,Qt,xt*kt,xt*Bt,xt*Nt,xt*Ut,xt*Lt,xt*jt,xt*Kt,xt*qt,xt*zt,xt*Vt,Ht),Wt,Qt)}function RoundNumberToIncrement($t,e,_t){if(JSBI.equal(e,Se))return $t;let{quotient:At,remainder:xt}=divmod($t,e);if(JSBI.equal(xt,Ie))return $t;const kt=JSBI.lessThan(xt,Ie)?-1:1,Bt=abs(JSBI.multiply(xt,JSBI.BigInt(2))),Nt=JSBI.equal(Bt,e),Ut=JSBI.greaterThan(Bt,e);switch(_t){case"ceil":kt>0&&(At=JSBI.add(At,JSBI.BigInt(kt)));break;case"floor":kt<0&&(At=JSBI.add(At,JSBI.BigInt(kt)));break;case"expand":At=JSBI.add(At,JSBI.BigInt(kt));break;case"trunc":break;case"halfCeil":(Ut||Nt&&kt>0)&&(At=JSBI.add(At,JSBI.BigInt(kt)));break;case"halfFloor":(Ut||Nt&&kt<0)&&(At=JSBI.add(At,JSBI.BigInt(kt)));break;case"halfExpand":(Ut||Nt)&&(At=JSBI.add(At,JSBI.BigInt(kt)));break;case"halfTrunc":Ut&&(At=JSBI.add(At,JSBI.BigInt(kt)));break;case"halfEven":(Ut||Nt&&JSBI.toNumber(JSBI.remainder(abs(At),JSBI.BigInt(2)))===1)&&(At=JSBI.add(At,JSBI.BigInt(kt)))}return JSBI.multiply(At,e)}function RoundInstant($t,e,_t,At){let{remainder:xt}=NonNegativeBigIntDivmod($t,Ee);const kt=JSBI.subtract($t,xt),Bt=RoundNumberToIncrement(xt,JSBI.BigInt(_e[_t]*e),At);return JSBI.add(kt,Bt)}function RoundISODateTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt=864e11){const{deltaDays:zt,hour:Vt,minute:Ht,second:Wt,millisecond:Qt,microsecond:Xt,nanosecond:Jt}=RoundTime(At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt),{year:tr,month:dr,day:vr}=BalanceISODate($t,e,_t+zt);return{year:tr,month:dr,day:vr,hour:Vt,minute:Ht,second:Wt,millisecond:Qt,microsecond:Xt,nanosecond:Jt}}function RoundTime($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt=864e11){let jt=Ie;switch(Nt){case"day":case"hour":jt=JSBI.BigInt($t);case"minute":jt=JSBI.add(JSBI.multiply(jt,ge),JSBI.BigInt(e));case"second":jt=JSBI.add(JSBI.multiply(jt,ge),JSBI.BigInt(_t));case"millisecond":jt=JSBI.add(JSBI.multiply(jt,De),JSBI.BigInt(At));case"microsecond":jt=JSBI.add(JSBI.multiply(jt,De),JSBI.BigInt(xt));case"nanosecond":jt=JSBI.add(JSBI.multiply(jt,De),JSBI.BigInt(kt))}const Kt=Nt==="day"?Lt:_e[Nt],qt=RoundNumberToIncrement(jt,JSBI.BigInt(Kt*Bt),Ut),zt=JSBI.toNumber(JSBI.divide(qt,JSBI.BigInt(Kt)));switch(Nt){case"day":return{deltaDays:zt,hour:0,minute:0,second:0,millisecond:0,microsecond:0,nanosecond:0};case"hour":return BalanceTime(zt,0,0,0,0,0);case"minute":return BalanceTime($t,zt,0,0,0,0);case"second":return BalanceTime($t,e,zt,0,0,0);case"millisecond":return BalanceTime($t,e,_t,zt,0,0);case"microsecond":return BalanceTime($t,e,_t,At,zt,0);case"nanosecond":return BalanceTime($t,e,_t,At,xt,zt);default:throw new Error(`Invalid unit ${Nt}`)}}function DaysUntil($t,e){return DifferenceISODate(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l),GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),"day").days}function MoveRelativeDate($t,e,_t,At){const xt=CalendarDateAdd($t,e,_t,void 0,At);return{relativeTo:xt,days:DaysUntil(e,xt)}}function MoveRelativeZonedDateTime($t,e,_t,At,xt){const kt=GetSlot($t,g),Bt=GetSlot($t,p);return CreateTemporalZonedDateTime(AddZonedDateTime(GetSlot($t,S),kt,Bt,e,_t,At,xt,0,0,0,0,0,0),kt,Bt)}function AdjustRoundedDurationDays($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt){let Vt=$t,Ht=e,Wt=_t,Qt=At,Xt=xt,Jt=kt,tr=Bt,dr=Nt,vr=Ut,$r=Lt;if(!IsTemporalZonedDateTime(zt)||Kt==="year"||Kt==="month"||Kt==="week"||Kt==="day"||Kt==="nanosecond"&&jt===1)return{years:Vt,months:Ht,weeks:Wt,days:Qt,hours:Xt,minutes:Jt,seconds:tr,milliseconds:dr,microseconds:vr,nanoseconds:$r};let Ir=TotalDurationNanoseconds(0,Xt,Jt,tr,dr,vr,$r,0);const Rr=se(JSBI.toNumber(Ir)),Nr=GetSlot(zt,g),kr=GetSlot(zt,p),lr=AddZonedDateTime(GetSlot(zt,S),Nr,kr,Vt,Ht,Wt,Qt,0,0,0,0,0,0),ir=AddZonedDateTime(new(GetIntrinsic("%Temporal.Instant%"))(lr),Nr,kr,0,0,0,Rr,0,0,0,0,0,0),er=JSBI.subtract(ir,lr);return JSBI.greaterThanOrEqual(JSBI.multiply(JSBI.subtract(Ir,er),JSBI.BigInt(Rr)),Ie)&&({years:Vt,months:Ht,weeks:Wt,days:Qt}=AddDuration(Vt,Ht,Wt,Qt,0,0,0,0,0,0,0,0,0,Rr,0,0,0,0,0,0,zt),Ir=RoundInstant(JSBI.subtract(Ir,er),jt,Kt,qt),{hours:Xt,minutes:Jt,seconds:tr,milliseconds:dr,microseconds:vr,nanoseconds:$r}=BalanceDuration(0,0,0,0,0,0,JSBI.toNumber(Ir),"hour")),{years:Vt,months:Ht,weeks:Wt,days:Qt,hours:Xt,minutes:Jt,seconds:tr,milliseconds:dr,microseconds:vr,nanoseconds:$r}}function RoundDuration($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt){let Vt=$t,Ht=e,Wt=_t,Qt=At,Xt=xt,Jt=kt,tr=Bt,dr=Nt,vr=Ut,$r=JSBI.BigInt(Lt);const Ir=GetIntrinsic("%Temporal.Duration%");let Rr,Nr,kr,lr,ir=zt;if(ir){if(IsTemporalZonedDateTime(ir))Nr=ir,ir=ToTemporalDate(ir);else if(!IsTemporalDate(ir))throw new TypeError("starting point must be PlainDate or ZonedDateTime");Rr=GetSlot(ir,p)}if(Kt==="year"||Kt==="month"||Kt==="week"||Kt==="day"){let er,rr,yr;$r=TotalDurationNanoseconds(0,Xt,Jt,tr,dr,vr,Lt,0),Nr&&(er=MoveRelativeZonedDateTime(Nr,Vt,Ht,Wt,Qt)),{days:rr,nanoseconds:$r,dayLengthNs:yr}=NanosecondsToDays($r,er),kr=JSBI.BigInt(yr),Qt+=rr,Xt=Jt=tr=dr=vr=0}switch(Kt){case"year":{if(!Rr)throw new RangeError("A starting point is required for years rounding");const er=new Ir(Vt),rr=typeof Rr!="string"?GetMethod(Rr,"dateAdd"):void 0,yr=CalendarDateAdd(Rr,ir,er,void 0,rr),fr=CalendarDateAdd(Rr,ir,new Ir(Vt,Ht,Wt),void 0,rr);ir=yr,Qt+=DaysUntil(yr,fr);const gr=CalendarDateAdd(Rr,ir,new Ir(0,0,0,Qt),void 0,rr),ar=Te(null);ar.largestUnit="year";const nr=CalendarDateUntil(Rr,ir,gr,ar).years;Vt+=nr;const ur=ir;ir=CalendarDateAdd(Rr,ir,new Ir(nr),void 0,rr),Qt-=DaysUntil(ur,ir);const pr=new Ir(Qt<0?-1:1);let{days:br}=MoveRelativeDate(Rr,ir,pr,rr);br=ae(br);const Sr=JSBI.multiply(JSBI.BigInt(br),kr);$r=JSBI.add(JSBI.add(JSBI.multiply(Sr,JSBI.BigInt(Vt)),JSBI.multiply(JSBI.BigInt(Qt),kr)),$r);const Pr=RoundNumberToIncrement($r,JSBI.multiply(Sr,JSBI.BigInt(jt)),qt);lr=BigIntDivideToNumber($r,Sr),Vt=JSBI.toNumber(JSBI.divide(Pr,Sr)),$r=Ie,Ht=Wt=Qt=0;break}case"month":{if(!Rr)throw new RangeError("A starting point is required for months rounding");const er=new Ir(Vt,Ht),rr=typeof Rr!="string"?GetMethod(Rr,"dateAdd"):void 0,yr=CalendarDateAdd(Rr,ir,er,void 0,rr),fr=CalendarDateAdd(Rr,ir,new Ir(Vt,Ht,Wt),void 0,rr);ir=yr,Qt+=DaysUntil(yr,fr);const gr=se(Qt),ar=new Ir(0,Qt<0?-1:1);let nr;for({relativeTo:ir,days:nr}=MoveRelativeDate(Rr,ir,ar,rr);ae(Qt)>=ae(nr);)Ht+=gr,Qt-=nr,{relativeTo:ir,days:nr}=MoveRelativeDate(Rr,ir,ar,rr);nr=ae(nr);const ur=JSBI.multiply(JSBI.BigInt(nr),kr);$r=JSBI.add(JSBI.add(JSBI.multiply(ur,JSBI.BigInt(Ht)),JSBI.multiply(JSBI.BigInt(Qt),kr)),$r);const pr=RoundNumberToIncrement($r,JSBI.multiply(ur,JSBI.BigInt(jt)),qt);lr=BigIntDivideToNumber($r,ur),Ht=JSBI.toNumber(JSBI.divide(pr,ur)),$r=Ie,Wt=Qt=0;break}case"week":{if(!Rr)throw new RangeError("A starting point is required for weeks rounding");const er=se(Qt),rr=new Ir(0,0,Qt<0?-1:1),yr=typeof Rr!="string"?GetMethod(Rr,"dateAdd"):void 0;let fr;for({relativeTo:ir,days:fr}=MoveRelativeDate(Rr,ir,rr,yr);ae(Qt)>=ae(fr);)Wt+=er,Qt-=fr,{relativeTo:ir,days:fr}=MoveRelativeDate(Rr,ir,rr,yr);fr=ae(fr);const gr=JSBI.multiply(JSBI.BigInt(fr),kr);$r=JSBI.add(JSBI.add(JSBI.multiply(gr,JSBI.BigInt(Wt)),JSBI.multiply(JSBI.BigInt(Qt),kr)),$r);const ar=RoundNumberToIncrement($r,JSBI.multiply(gr,JSBI.BigInt(jt)),qt);lr=BigIntDivideToNumber($r,gr),Wt=JSBI.toNumber(JSBI.divide(ar,gr)),$r=Ie,Qt=0;break}case"day":{const er=kr;$r=JSBI.add(JSBI.multiply(er,JSBI.BigInt(Qt)),$r);const rr=RoundNumberToIncrement($r,JSBI.multiply(er,JSBI.BigInt(jt)),qt);lr=BigIntDivideToNumber($r,er),Qt=JSBI.toNumber(JSBI.divide(rr,er)),$r=Ie;break}case"hour":{let rr=JSBI.multiply(JSBI.BigInt(Xt),JSBI.BigInt(36e11));rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(Jt),JSBI.BigInt(6e10))),rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(tr),ve)),rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(dr),Ge)),rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(vr),De)),rr=JSBI.add(rr,$r),lr=BigIntDivideToNumber(rr,JSBI.BigInt(36e11));const yr=RoundNumberToIncrement(rr,JSBI.BigInt(36e11*jt),qt);Xt=JSBI.toNumber(JSBI.divide(yr,JSBI.BigInt(36e11))),$r=Ie,Jt=tr=dr=vr=0;break}case"minute":{let rr=JSBI.multiply(JSBI.BigInt(Jt),JSBI.BigInt(6e10));rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(tr),ve)),rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(dr),Ge)),rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(vr),De)),rr=JSBI.add(rr,$r),lr=BigIntDivideToNumber(rr,JSBI.BigInt(6e10));const yr=RoundNumberToIncrement(rr,JSBI.BigInt(6e10*jt),qt);Jt=JSBI.toNumber(JSBI.divide(yr,JSBI.BigInt(6e10))),$r=Ie,tr=dr=vr=0;break}case"second":{let rr=JSBI.multiply(JSBI.BigInt(tr),ve);rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(dr),Ge)),rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(vr),De)),rr=JSBI.add(rr,$r),lr=BigIntDivideToNumber(rr,JSBI.BigInt(1e9));const yr=RoundNumberToIncrement(rr,JSBI.BigInt(1e9*jt),qt);tr=JSBI.toNumber(JSBI.divide(yr,JSBI.BigInt(1e9))),$r=Ie,dr=vr=0;break}case"millisecond":{let rr=JSBI.multiply(JSBI.BigInt(dr),Ge);rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(vr),De)),rr=JSBI.add(rr,$r),lr=BigIntDivideToNumber(rr,JSBI.BigInt(1e6));const yr=RoundNumberToIncrement(rr,JSBI.BigInt(1e6*jt),qt);dr=JSBI.toNumber(JSBI.divide(yr,JSBI.BigInt(1e6))),$r=Ie,vr=0;break}case"microsecond":{let rr=JSBI.multiply(JSBI.BigInt(vr),De);rr=JSBI.add(rr,$r),lr=BigIntDivideToNumber(rr,JSBI.BigInt(1e3));const yr=RoundNumberToIncrement(rr,JSBI.BigInt(1e3*jt),qt);vr=JSBI.toNumber(JSBI.divide(yr,JSBI.BigInt(1e3))),$r=Ie;break}case"nanosecond":lr=JSBI.toNumber($r),$r=RoundNumberToIncrement(JSBI.BigInt($r),JSBI.BigInt(jt),qt)}return{years:Vt,months:Ht,weeks:Wt,days:Qt,hours:Xt,minutes:Jt,seconds:tr,milliseconds:dr,microseconds:vr,nanoseconds:JSBI.toNumber($r),total:lr}}function CompareISODate($t,e,_t,At,xt,kt){for(const[Bt,Nt]of[[$t,At],[e,xt],[_t,kt]])if(Bt!==Nt)return ComparisonResult(Bt-Nt);return 0}function NonNegativeBigIntDivmod($t,e){let{quotient:_t,remainder:At}=divmod($t,e);return JSBI.lessThan(At,Ie)&&(_t=JSBI.subtract(_t,Se),At=JSBI.add(At,e)),{quotient:_t,remainder:At}}function BigIntFloorDiv($t,e){const{quotient:_t,remainder:At}=divmod($t,e);return isZero(At)||!isNegativeJSBI($t)==!isNegativeJSBI(e)?_t:JSBI.subtract(_t,Se)}function BigIntDivideToNumber($t,e){const{quotient:_t,remainder:At}=divmod($t,e);return JSBI.toNumber(_t)+JSBI.toNumber(At)/JSBI.toNumber(e)}function ToBigIntExternal($t){const e=ToBigInt($t);return globalThis.BigInt!==void 0?globalThis.BigInt(e.toString(10)):e}function ToBigInt($t){let e=$t;if(typeof $t=="object"){const _t=$t[Symbol.toPrimitive];_t&&typeof _t=="function"&&(e=fe(_t,$t,["number"]))}if(typeof e=="number")throw new TypeError("cannot convert number to bigint");return typeof e=="bigint"?JSBI.BigInt(e.toString(10)):JSBI.BigInt(e)}const Ve=(()=>{let $t=JSBI.BigInt(Date.now()%1e6);return()=>{const e=JSBI.BigInt(Date.now()),_t=JSBI.add(JSBI.multiply(e,Ge),$t);return $t=JSBI.remainder(e,Ge),JSBI.greaterThan(_t,Re)?Re:JSBI.lessThan(_t,Me)?Me:_t}})();function DefaultTimeZone(){return new re().resolvedOptions().timeZone}function ComparisonResult($t){return $t<0?-1:$t>0?1:$t}function GetOptionsObject($t){if($t===void 0)return Te(null);if(IsObject($t)&&$t!==null)return $t;throw new TypeError("Options parameter must be an object, not "+($t===null?"null":typeof $t))}function CreateOnePropObject($t,e){const _t=Te(null);return _t[$t]=e,_t}function CopyOptions($t){const e=Te(null);return CopyDataProperties(e,GetOptionsObject($t),[]),e}function GetOption($t,e,_t,At){let xt=$t[e];if(xt!==void 0){if(xt=ToString(xt),!_t.includes(xt))throw new RangeError(`${e} must be one of ${_t.join(", ")}, not ${xt}`);return xt}return At}function IsBuiltinCalendar($t){return je.includes(ASCIILowercase($t))}function ASCIILowercase($t){return $t.replace(/[A-Z]/g,e=>{const _t=e.charCodeAt(0);return String.fromCharCode(_t+32)})}const ze=new RegExp(`^${W.source}$`);function bisect($t,e,_t,At=$t(e),xt=$t(_t)){let kt=JSBI.BigInt(e),Bt=JSBI.BigInt(_t),Nt=At,Ut=xt;for(;JSBI.greaterThan(JSBI.subtract(Bt,kt),Se);){const Lt=JSBI.divide(JSBI.add(kt,Bt),JSBI.BigInt(2)),jt=$t(Lt);if(jt===Nt)kt=Lt,Nt=jt;else{if(jt!==Ut)throw new Error(`invalid state in bisection ${Nt} - ${jt} - ${Ut}`);Bt=Lt,Ut=jt}}return Bt}const _e={hour:36e11,minute:6e10,second:1e9,millisecond:1e6,microsecond:1e3,nanosecond:1},Je=Symbol("date"),Ke=Symbol("ym"),Xe=Symbol("md"),Qe=Symbol("time"),et=Symbol("datetime"),tt=Symbol("instant"),rt=Symbol("original"),ot=Symbol("timezone"),nt=Symbol("calendar-id"),at=Symbol("locale"),it=Symbol("options"),descriptor=$t=>({value:$t,enumerable:!0,writable:!1,configurable:!0}),st=globalThis.Intl.DateTimeFormat,lt=Object.assign,dt=Object.prototype.hasOwnProperty,mt=Reflect.apply;function getPropLazy($t,e){let _t=$t[e];return typeof _t=="function"&&(_t=new st($t[at],_t($t[it])),$t[e]=_t),_t}function DateTimeFormatImpl($t,e={}){if(!(this instanceof DateTimeFormatImpl))return new DateTimeFormatImpl($t,e);const _t=e!==void 0,At=_t?lt({},e):{},xt=new st($t,At),kt=xt.resolvedOptions();if(_t){const Bt=lt({},kt);for(const Nt in Bt)mt(dt,At,[Nt])||delete Bt[Nt];this[it]=Bt}else this[it]=At;this[at]=kt.locale,this[rt]=xt,this[ot]=kt.timeZone,this[nt]=kt.calendar,this[Je]=dateAmend,this[Ke]=yearMonthAmend,this[Xe]=monthDayAmend,this[Qe]=timeAmend,this[et]=datetimeAmend,this[tt]=instantAmend}Object.defineProperty(DateTimeFormatImpl,"name",{writable:!0,value:"DateTimeFormat"}),DateTimeFormatImpl.supportedLocalesOf=function($t,e){return st.supportedLocalesOf($t,e)};const ct={resolvedOptions:descriptor(function $t(){return this[rt].resolvedOptions()}),format:descriptor(function $t(e,..._t){let{instant:At,formatter:xt}=extractOverrides(e,this);return At&&xt?xt.format(At.epochMilliseconds):this[rt].format(e,..._t)}),formatRange:descriptor(function $t(e,_t){if(isTemporalObject(e)||isTemporalObject(_t)){if(!sameTemporalType(e,_t))throw new TypeError("Intl.DateTimeFormat.formatRange accepts two values of the same type");const{instant:At,formatter:xt}=extractOverrides(e,this),{instant:kt,formatter:Bt}=extractOverrides(_t,this);if(At&&kt&&xt&&Bt&&xt===Bt)return xt.formatRange(At.epochMilliseconds,kt.epochMilliseconds)}return this[rt].formatRange(e,_t)})};"formatToParts"in st.prototype&&(ct.formatToParts=descriptor(function $t(e,..._t){let{instant:At,formatter:xt}=extractOverrides(e,this);return At&&xt?xt.formatToParts(At.epochMilliseconds):this[rt].formatToParts(e,..._t)})),"formatRangeToParts"in st.prototype&&(ct.formatRangeToParts=descriptor(function $t(e,_t){if(isTemporalObject(e)||isTemporalObject(_t)){if(!sameTemporalType(e,_t))throw new TypeError("Intl.DateTimeFormat.formatRangeToParts accepts two values of the same type");const{instant:At,formatter:xt}=extractOverrides(e,this),{instant:kt,formatter:Bt}=extractOverrides(_t,this);if(At&&kt&&xt&&Bt&&xt===Bt)return xt.formatRangeToParts(At.epochMilliseconds,kt.epochMilliseconds)}return this[rt].formatRangeToParts(e,_t)})),DateTimeFormatImpl.prototype=Object.create(st.prototype,ct),Object.defineProperty(DateTimeFormatImpl,"prototype",{writable:!1,enumerable:!1,configurable:!1});const ht=DateTimeFormatImpl;function amend($t={},e={}){const _t=lt({},$t);for(const At of["year","month","day","hour","minute","second","weekday","dayPeriod","timeZoneName","dateStyle","timeStyle"])_t[At]=At in e?e[At]:_t[At],_t[At]!==!1&&_t[At]!==void 0||delete _t[At];return _t}function timeAmend($t){let e=amend($t,{year:!1,month:!1,day:!1,weekday:!1,timeZoneName:!1,dateStyle:!1});return hasTimeOptions(e)||(e=lt({},e,{hour:"numeric",minute:"numeric",second:"numeric"})),e}function yearMonthAmend($t){let e=amend($t,{day:!1,hour:!1,minute:!1,second:!1,weekday:!1,dayPeriod:!1,timeZoneName:!1,dateStyle:!1,timeStyle:!1});return"year"in e||"month"in e||(e=lt(e,{year:"numeric",month:"numeric"})),e}function monthDayAmend($t){let e=amend($t,{year:!1,hour:!1,minute:!1,second:!1,weekday:!1,dayPeriod:!1,timeZoneName:!1,dateStyle:!1,timeStyle:!1});return"month"in e||"day"in e||(e=lt({},e,{month:"numeric",day:"numeric"})),e}function dateAmend($t){let e=amend($t,{hour:!1,minute:!1,second:!1,dayPeriod:!1,timeZoneName:!1,timeStyle:!1});return hasDateOptions(e)||(e=lt({},e,{year:"numeric",month:"numeric",day:"numeric"})),e}function datetimeAmend($t){let e=amend($t,{timeZoneName:!1});return hasTimeOptions(e)||hasDateOptions(e)||(e=lt({},e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})),e}function instantAmend($t){let e=$t;return hasTimeOptions(e)||hasDateOptions(e)||(e=lt({},e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})),e}function hasDateOptions($t){return"year"in $t||"month"in $t||"day"in $t||"weekday"in $t||"dateStyle"in $t}function hasTimeOptions($t){return"hour"in $t||"minute"in $t||"second"in $t||"timeStyle"in $t||"dayPeriod"in $t}function isTemporalObject($t){return IsTemporalDate($t)||IsTemporalTime($t)||IsTemporalDateTime($t)||IsTemporalZonedDateTime($t)||IsTemporalYearMonth($t)||IsTemporalMonthDay($t)||IsTemporalInstant($t)}function sameTemporalType($t,e){return!(!isTemporalObject($t)||!isTemporalObject(e))&&!(IsTemporalTime($t)&&!IsTemporalTime(e))&&!(IsTemporalDate($t)&&!IsTemporalDate(e))&&!(IsTemporalDateTime($t)&&!IsTemporalDateTime(e))&&!(IsTemporalZonedDateTime($t)&&!IsTemporalZonedDateTime(e))&&!(IsTemporalYearMonth($t)&&!IsTemporalYearMonth(e))&&!(IsTemporalMonthDay($t)&&!IsTemporalMonthDay(e))&&!(IsTemporalInstant($t)&&!IsTemporalInstant(e))}function extractOverrides($t,e){const _t=GetIntrinsic("%Temporal.PlainDateTime%");if(IsTemporalTime($t)){const At=new _t(1970,1,1,GetSlot($t,d$1),GetSlot($t,m$1),GetSlot($t,c),GetSlot($t,h$1),GetSlot($t,u),GetSlot($t,T),e[nt]);return{instant:GetInstantFor(e[ot],At,"compatible"),formatter:getPropLazy(e,Qe)}}if(IsTemporalYearMonth($t)){const At=GetSlot($t,i$1),xt=GetSlot($t,s$1),kt=GetSlot($t,l),Bt=ToTemporalCalendarIdentifier(GetSlot($t,p));if(Bt!==e[nt])throw new RangeError(`cannot format PlainYearMonth with calendar ${Bt} in locale with calendar ${e[nt]}`);const Nt=new _t(At,xt,kt,12,0,0,0,0,0,Bt);return{instant:GetInstantFor(e[ot],Nt,"compatible"),formatter:getPropLazy(e,Ke)}}if(IsTemporalMonthDay($t)){const At=GetSlot($t,i$1),xt=GetSlot($t,s$1),kt=GetSlot($t,l),Bt=ToTemporalCalendarIdentifier(GetSlot($t,p));if(Bt!==e[nt])throw new RangeError(`cannot format PlainMonthDay with calendar ${Bt} in locale with calendar ${e[nt]}`);const Nt=new _t(At,xt,kt,12,0,0,0,0,0,Bt);return{instant:GetInstantFor(e[ot],Nt,"compatible"),formatter:getPropLazy(e,Xe)}}if(IsTemporalDate($t)){const At=GetSlot($t,i$1),xt=GetSlot($t,s$1),kt=GetSlot($t,l),Bt=ToTemporalCalendarIdentifier(GetSlot($t,p));if(Bt!=="iso8601"&&Bt!==e[nt])throw new RangeError(`cannot format PlainDate with calendar ${Bt} in locale with calendar ${e[nt]}`);const Nt=new _t(At,xt,kt,12,0,0,0,0,0,e[nt]);return{instant:GetInstantFor(e[ot],Nt,"compatible"),formatter:getPropLazy(e,Je)}}if(IsTemporalDateTime($t)){const At=GetSlot($t,i$1),xt=GetSlot($t,s$1),kt=GetSlot($t,l),Bt=GetSlot($t,d$1),Nt=GetSlot($t,m$1),Ut=GetSlot($t,c),Lt=GetSlot($t,h$1),jt=GetSlot($t,u),Kt=GetSlot($t,T),qt=ToTemporalCalendarIdentifier(GetSlot($t,p));if(qt!=="iso8601"&&qt!==e[nt])throw new RangeError(`cannot format PlainDateTime with calendar ${qt} in locale with calendar ${e[nt]}`);let zt=$t;return qt==="iso8601"&&(zt=new _t(At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,e[nt])),{instant:GetInstantFor(e[ot],zt,"compatible"),formatter:getPropLazy(e,et)}}if(IsTemporalZonedDateTime($t))throw new TypeError("Temporal.ZonedDateTime not supported in DateTimeFormat methods. Use toLocaleString() instead.");return IsTemporalInstant($t)?{instant:$t,formatter:getPropLazy(e,tt)}:{}}class Instant{constructor(e){if(arguments.length<1)throw new TypeError("missing argument: epochNanoseconds is required");const _t=ToBigInt(e);ValidateEpochNanoseconds(_t),N(this),SetSlot(this,n,_t)}get epochSeconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const e=GetSlot(this,n);return JSBI.toNumber(BigIntFloorDiv(e,ve))}get epochMilliseconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const e=JSBI.BigInt(GetSlot(this,n));return JSBI.toNumber(BigIntFloorDiv(e,Ge))}get epochMicroseconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return ToBigIntExternal(BigIntFloorDiv(JSBI.BigInt(GetSlot(this,n)),De))}get epochNanoseconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return ToBigIntExternal(JSBI.BigInt(GetSlot(this,n)))}add(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromInstant("add",this,e)}subtract(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromInstant("subtract",this,e)}until(e,_t){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return DifferenceTemporalInstant("until",this,e,_t)}since(e,_t){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return DifferenceTemporalInstant("since",this,e,_t)}round(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const _t=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),At=ToTemporalRoundingIncrement(_t),xt=ToTemporalRoundingMode(_t,"halfExpand"),kt=GetTemporalUnit(_t,"smallestUnit","time",He);ValidateTemporalRoundingIncrement(At,{hour:24,minute:1440,second:86400,millisecond:864e5,microsecond:864e8,nanosecond:864e11}[kt],!0);const Bt=RoundInstant(GetSlot(this,n),At,kt,xt);return new Instant(Bt)}equals(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const _t=ToTemporalInstant(e),At=GetSlot(this,n),xt=GetSlot(_t,n);return JSBI.equal(JSBI.BigInt(At),JSBI.BigInt(xt))}toString(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const _t=GetOptionsObject(e),At=ToFractionalSecondDigits(_t),xt=ToTemporalRoundingMode(_t,"trunc"),kt=GetTemporalUnit(_t,"smallestUnit","time",void 0);if(kt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');let Bt=_t.timeZone;Bt!==void 0&&(Bt=ToTemporalTimeZoneSlotValue(Bt));const{precision:Nt,unit:Ut,increment:Lt}=ToSecondsStringPrecisionRecord(kt,At),jt=RoundInstant(GetSlot(this,n),Lt,Ut,xt);return TemporalInstantToString(new Instant(jt),Bt,Nt)}toJSON(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return TemporalInstantToString(this,void 0,"auto")}toLocaleString(e,_t){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return new ht(e,_t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.Instant")}toZonedDateTime(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument in toZonedDateTime");const _t=e.calendar;if(_t===void 0)throw new TypeError("missing calendar property in toZonedDateTime");const At=ToTemporalCalendarSlotValue(_t),xt=e.timeZone;if(xt===void 0)throw new TypeError("missing timeZone property in toZonedDateTime");const kt=ToTemporalTimeZoneSlotValue(xt);return CreateTemporalZonedDateTime(GetSlot(this,n),kt,At)}toZonedDateTimeISO(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const _t=ToTemporalTimeZoneSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(this,n),_t,"iso8601")}static fromEpochSeconds(e){const _t=ToNumber(e),At=JSBI.multiply(JSBI.BigInt(_t),ve);return ValidateEpochNanoseconds(At),new Instant(At)}static fromEpochMilliseconds(e){const _t=ToNumber(e),At=JSBI.multiply(JSBI.BigInt(_t),Ge);return ValidateEpochNanoseconds(At),new Instant(At)}static fromEpochMicroseconds(e){const _t=ToBigInt(e),At=JSBI.multiply(_t,De);return ValidateEpochNanoseconds(At),new Instant(At)}static fromEpochNanoseconds(e){const _t=ToBigInt(e);return ValidateEpochNanoseconds(_t),new Instant(_t)}static from(e){return IsTemporalInstant(e)?new Instant(GetSlot(e,n)):ToTemporalInstant(e)}static compare(e,_t){const At=ToTemporalInstant(e),xt=ToTemporalInstant(_t),kt=GetSlot(At,n),Bt=GetSlot(xt,n);return JSBI.lessThan(kt,Bt)?-1:JSBI.greaterThan(kt,Bt)?1:0}}MakeIntrinsicClass(Instant,"Temporal.Instant");const Tt=Array.prototype.includes,pt=Array.prototype.push,ft=globalThis.Intl.DateTimeFormat,yt=Array.prototype.sort,It=Math.abs,St=Math.floor,gt=Object.create,wt=Object.entries,Dt=Set,Gt=Reflect.ownKeys,vt=Set.prototype.add,Ct=Set.prototype.values,Ot={};class Calendar{constructor(e){if(arguments.length<1)throw new RangeError("missing argument: id is required");const _t=ToString(e);if(!IsBuiltinCalendar(_t))throw new RangeError(`invalid calendar identifier ${_t}`);N(this),SetSlot(this,F,ASCIILowercase(_t))}get id(){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return GetSlot(this,F)}dateFromFields(e,_t){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid fields");const At=GetOptionsObject(_t),xt=GetSlot(this,F);return Ot[xt].dateFromFields(e,At,xt)}yearMonthFromFields(e,_t){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid fields");const At=GetOptionsObject(_t),xt=GetSlot(this,F);return Ot[xt].yearMonthFromFields(e,At,xt)}monthDayFromFields(e,_t){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid fields");const At=GetOptionsObject(_t),xt=GetSlot(this,F);return Ot[xt].monthDayFromFields(e,At,xt)}fields(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const _t=[],At=new Set(["year","month","monthCode","day","hour","minute","second","millisecond","microsecond","nanosecond"]);for(const xt of e){if(typeof xt!="string")throw new TypeError("invalid fields");if(!At.has(xt))throw new RangeError(`invalid field name ${xt}`);At.delete(xt),pt.call(_t,xt)}return Ot[GetSlot(this,F)].fields(_t)}mergeFields(e,_t){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=ToObject(e),xt=gt(null);CopyDataProperties(xt,At,[],[void 0]);const kt=ToObject(_t),Bt=gt(null);CopyDataProperties(Bt,kt,[],[void 0]);const Nt=Gt(Bt),Ut=Ot[GetSlot(this,F)].fieldKeysToIgnore(Nt),Lt=gt(null),jt=Gt(xt);for(const Kt of jt){let qt;qt=Call(Tt,Ut,[Kt])?Bt[Kt]:xt[Kt],qt!==void 0&&(Lt[Kt]=qt)}return CopyDataProperties(Lt,Bt,[]),Lt}dateAdd(e,_t,At){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const xt=ToTemporalDate(e),kt=ToTemporalDuration(_t),Bt=ToTemporalOverflow(GetOptionsObject(At)),{days:Nt}=BalanceDuration(GetSlot(kt,v),GetSlot(kt,C),GetSlot(kt,O),GetSlot(kt,b),GetSlot(kt,E$1),GetSlot(kt,M),GetSlot(kt,R),"day"),Ut=GetSlot(this,F);return Ot[Ut].dateAdd(xt,GetSlot(kt,w$1),GetSlot(kt,D),GetSlot(kt,G),Nt,Bt,Ut)}dateUntil(e,_t,At){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const xt=ToTemporalDate(e),kt=ToTemporalDate(_t);let Bt=GetTemporalUnit(GetOptionsObject(At),"largestUnit","date","auto");Bt==="auto"&&(Bt="day");const{years:Nt,months:Ut,weeks:Lt,days:jt}=Ot[GetSlot(this,F)].dateUntil(xt,kt,Bt);return new(GetIntrinsic("%Temporal.Duration%"))(Nt,Ut,Lt,jt,0,0,0,0,0,0)}year(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].year(_t)}month(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(IsTemporalMonthDay(_t))throw new TypeError("use monthCode on PlainMonthDay instead");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].month(_t)}monthCode(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||IsTemporalMonthDay(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].monthCode(_t)}day(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalMonthDay(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].day(_t)}era(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].era(_t)}eraYear(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].eraYear(_t)}dayOfWeek(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e);return Ot[GetSlot(this,F)].dayOfWeek(_t)}dayOfYear(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e);return Ot[GetSlot(this,F)].dayOfYear(_t)}weekOfYear(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e);return Ot[GetSlot(this,F)].weekOfYear(_t)}yearOfWeek(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e);return Ot[GetSlot(this,F)].yearOfWeek(_t)}daysInWeek(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e);return Ot[GetSlot(this,F)].daysInWeek(_t)}daysInMonth(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].daysInMonth(_t)}daysInYear(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].daysInYear(_t)}monthsInYear(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].monthsInYear(_t)}inLeapYear(e){let _t=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(_t)||(_t=ToTemporalDate(_t)),Ot[GetSlot(this,F)].inLeapYear(_t)}toString(){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return GetSlot(this,F)}toJSON(){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return GetSlot(this,F)}static from(e){return ToTemporalCalendarObject(ToTemporalCalendarSlotValue(e))}}function monthCodeNumberPart($t){if(!$t.startsWith("M"))throw new RangeError(`Invalid month code: ${$t}.  Month codes must start with M.`);const e=+$t.slice(1);if(isNaN(e))throw new RangeError(`Invalid month code: ${$t}`);return e}function buildMonthCode($t,e=!1){return`M${$t.toString().padStart(2,"0")}${e?"L":""}`}function resolveNonLunisolarMonth($t,e,_t=12){let{month:At,monthCode:xt}=$t;if(xt===void 0){if(At===void 0)throw new TypeError("Either month or monthCode are required");e==="reject"&&RejectToRange(At,1,_t),e==="constrain"&&(At=ConstrainToRange(At,1,_t)),xt=buildMonthCode(At)}else{const kt=monthCodeNumberPart(xt);if(At!==void 0&&At!==kt)throw new RangeError(`monthCode ${xt} and month ${At} must match if both are present`);if(xt!==buildMonthCode(kt))throw new RangeError(`Invalid month code: ${xt}`);if(At=kt,At<1||At>_t)throw new RangeError(`Invalid monthCode: ${xt}`)}return{...$t,month:At,monthCode:xt}}MakeIntrinsicClass(Calendar,"Temporal.Calendar"),DefineIntrinsic("Temporal.Calendar.from",Calendar.from),DefineIntrinsic("Temporal.Calendar.prototype.dateAdd",Calendar.prototype.dateAdd),DefineIntrinsic("Temporal.Calendar.prototype.dateFromFields",Calendar.prototype.dateFromFields),DefineIntrinsic("Temporal.Calendar.prototype.dateUntil",Calendar.prototype.dateUntil),DefineIntrinsic("Temporal.Calendar.prototype.day",Calendar.prototype.day),DefineIntrinsic("Temporal.Calendar.prototype.dayOfWeek",Calendar.prototype.dayOfWeek),DefineIntrinsic("Temporal.Calendar.prototype.dayOfYear",Calendar.prototype.dayOfYear),DefineIntrinsic("Temporal.Calendar.prototype.daysInMonth",Calendar.prototype.daysInMonth),DefineIntrinsic("Temporal.Calendar.prototype.daysInWeek",Calendar.prototype.daysInWeek),DefineIntrinsic("Temporal.Calendar.prototype.daysInYear",Calendar.prototype.daysInYear),DefineIntrinsic("Temporal.Calendar.prototype.era",Calendar.prototype.era),DefineIntrinsic("Temporal.Calendar.prototype.eraYear",Calendar.prototype.eraYear),DefineIntrinsic("Temporal.Calendar.prototype.fields",Calendar.prototype.fields),DefineIntrinsic("Temporal.Calendar.prototype.inLeapYear",Calendar.prototype.inLeapYear),DefineIntrinsic("Temporal.Calendar.prototype.mergeFields",Calendar.prototype.mergeFields),DefineIntrinsic("Temporal.Calendar.prototype.month",Calendar.prototype.month),DefineIntrinsic("Temporal.Calendar.prototype.monthCode",Calendar.prototype.monthCode),DefineIntrinsic("Temporal.Calendar.prototype.monthDayFromFields",Calendar.prototype.monthDayFromFields),DefineIntrinsic("Temporal.Calendar.prototype.monthsInYear",Calendar.prototype.monthsInYear),DefineIntrinsic("Temporal.Calendar.prototype.weekOfYear",Calendar.prototype.weekOfYear),DefineIntrinsic("Temporal.Calendar.prototype.year",Calendar.prototype.year),DefineIntrinsic("Temporal.Calendar.prototype.yearMonthFromFields",Calendar.prototype.yearMonthFromFields),DefineIntrinsic("Temporal.Calendar.prototype.yearOfWeek",Calendar.prototype.yearOfWeek),Ot.iso8601={dateFromFields($t,e,_t){let At=PrepareTemporalFields($t,["day","month","monthCode","year"],["year","day"]);const xt=ToTemporalOverflow(e);At=resolveNonLunisolarMonth(At);let{year:kt,month:Bt,day:Nt}=At;return{year:kt,month:Bt,day:Nt}=RegulateISODate(kt,Bt,Nt,xt),CreateTemporalDate(kt,Bt,Nt,_t)},yearMonthFromFields($t,e,_t){let At=PrepareTemporalFields($t,["month","monthCode","year"],["year"]);const xt=ToTemporalOverflow(e);At=resolveNonLunisolarMonth(At);let{year:kt,month:Bt}=At;return{year:kt,month:Bt}=function(Ut,Lt,jt){let Kt=Ut,qt=Lt;switch(jt){case"reject":RejectISODate(Kt,qt,1);break;case"constrain":({year:Kt,month:qt}=ConstrainISODate(Kt,qt))}return{year:Kt,month:qt}}(kt,Bt,xt),CreateTemporalYearMonth(kt,Bt,_t,1)},monthDayFromFields($t,e,_t){let At=PrepareTemporalFields($t,["day","month","monthCode","year"],["day"]);const xt=ToTemporalOverflow(e);if(At.month!==void 0&&At.year===void 0&&At.monthCode===void 0)throw new TypeError("either year or monthCode required with month");const kt=At.monthCode===void 0;At=resolveNonLunisolarMonth(At);let{month:Bt,day:Nt,year:Ut}=At;return{month:Bt,day:Nt}=RegulateISODate(kt?Ut:1972,Bt,Nt,xt),CreateTemporalMonthDay(Bt,Nt,_t,1972)},fields:$t=>$t,fieldKeysToIgnore($t){const e=new Dt;for(let _t=0;_t<$t.length;_t++){const At=$t[_t];Call(vt,e,[At]),At==="month"?Call(vt,e,["monthCode"]):At==="monthCode"&&Call(vt,e,["month"])}return[...Call(Ct,e,[])]},dateAdd($t,e,_t,At,xt,kt,Bt){let Nt=GetSlot($t,i$1),Ut=GetSlot($t,s$1),Lt=GetSlot($t,l);return{year:Nt,month:Ut,day:Lt}=AddISODate(Nt,Ut,Lt,e,_t,At,xt,kt),CreateTemporalDate(Nt,Ut,Lt,Bt)},dateUntil:($t,e,_t)=>DifferenceISODate(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l),GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),_t),year:$t=>GetSlot($t,i$1),era(){},eraYear(){},month:$t=>GetSlot($t,s$1),monthCode:$t=>buildMonthCode(GetSlot($t,s$1)),day:$t=>GetSlot($t,l),dayOfWeek:$t=>DayOfWeek(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l)),dayOfYear:$t=>DayOfYear(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l)),weekOfYear:$t=>WeekOfYear(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l)).week,yearOfWeek:$t=>WeekOfYear(GetSlot($t,i$1),GetSlot($t,s$1),GetSlot($t,l)).year,daysInWeek:()=>7,daysInMonth:$t=>ISODaysInMonth(GetSlot($t,i$1),GetSlot($t,s$1)),daysInYear($t){let e=$t;return HasSlot(e,i$1)||(e=ToTemporalDate(e)),LeapYear(GetSlot(e,i$1))?366:365},monthsInYear:()=>12,inLeapYear($t){let e=$t;return HasSlot(e,i$1)||(e=ToTemporalDate(e)),LeapYear(GetSlot(e,i$1))}};class OneObjectCache{constructor(e){if(this.map=new Map,this.calls=0,this.hits=0,this.misses=0,this.now=globalThis.performance?globalThis.performance.now():Date.now(),e!==void 0){let _t=0;for(const At of e.map.entries()){if(++_t>OneObjectCache.MAX_CACHE_ENTRIES)break;this.map.set(...At)}}}get(e){const _t=this.map.get(e);return _t&&(this.hits++,this.report()),this.calls++,_t}set(e,_t){this.map.set(e,_t),this.misses++,this.report()}report(){}setObject(e){if(OneObjectCache.objectMap.get(e))throw new RangeError("object already cached");OneObjectCache.objectMap.set(e,this),this.report()}static getCacheForObject(e){let _t=OneObjectCache.objectMap.get(e);return _t||(_t=new OneObjectCache,OneObjectCache.objectMap.set(e,_t)),_t}}function toUtcIsoDateString({isoYear:$t,isoMonth:e,isoDay:_t}){return`${ISOYearString($t)}-${ISODateTimePartString(e)}-${ISODateTimePartString(_t)}T00:00Z`}function simpleDateDiff($t,e){return{years:$t.year-e.year,months:$t.month-e.month,days:$t.day-e.day}}OneObjectCache.objectMap=new WeakMap,OneObjectCache.MAX_CACHE_ENTRIES=1e3;class HelperBase{constructor(){this.eraLength="short",this.hasEra=!0,this.erasBeginMidYear=!1}getFormatter(){return this.formatter===void 0&&(this.formatter=new ft(`en-US-u-ca-${this.id}`,{day:"numeric",month:"numeric",year:"numeric",era:this.eraLength,timeZone:"UTC"})),this.formatter}isoToCalendarDate(e,_t){const{year:At,month:xt,day:kt}=e,Bt=JSON.stringify({func:"isoToCalendarDate",isoYear:At,isoMonth:xt,isoDay:kt,id:this.id}),Nt=_t.get(Bt);if(Nt)return Nt;const Ut=this.getFormatter();let Lt,jt;try{jt=toUtcIsoDateString({isoYear:At,isoMonth:xt,isoDay:kt}),Lt=Ut.formatToParts(new Date(jt))}catch{throw new RangeError(`Invalid ISO date: ${JSON.stringify({isoYear:At,isoMonth:xt,isoDay:kt})}`)}const Kt={};for(let{type:zt,value:Vt}of Lt){if(zt==="year"&&(Kt.eraYear=+Vt),zt==="relatedYear"&&(Kt.eraYear=+Vt),zt==="month"){const Ht=/^([0-9]*)(.*?)$/.exec(Vt);if(!Ht||Ht.length!=3||!Ht[1]&&!Ht[2])throw new RangeError(`Unexpected month: ${Vt}`);if(Kt.month=Ht[1]?+Ht[1]:1,Kt.month<1)throw new RangeError(`Invalid month ${Vt} from ${jt}[u-ca-${this.id}] (probably due to https://bugs.chromium.org/p/v8/issues/detail?id=10527)`);if(Kt.month>13)throw new RangeError(`Invalid month ${Vt} from ${jt}[u-ca-${this.id}] (probably due to https://bugs.chromium.org/p/v8/issues/detail?id=10529)`);Ht[2]&&(Kt.monthExtra=Ht[2])}zt==="day"&&(Kt.day=+Vt),this.hasEra&&zt==="era"&&Vt!=null&&Vt!==""&&(Vt=Vt.split(" (")[0],Kt.era=Vt.normalize("NFD").replace(/[^-0-9 \p{L}]/gu,"").replace(" ","-").toLowerCase())}if(Kt.eraYear===void 0)throw new RangeError(`Intl.DateTimeFormat.formatToParts lacks relatedYear in ${this.id} calendar. Try Node 14+ or modern browsers.`);if(this.reviseIntlEra){const{era:zt,eraYear:Vt}=this.reviseIntlEra(Kt,e);Kt.era=zt,Kt.eraYear=Vt}this.checkIcuBugs&&this.checkIcuBugs(e);const qt=this.adjustCalendarDate(Kt,_t,"constrain",!0);if(qt.year===void 0)throw new RangeError(`Missing year converting ${JSON.stringify(e)}`);if(qt.month===void 0)throw new RangeError(`Missing month converting ${JSON.stringify(e)}`);if(qt.day===void 0)throw new RangeError(`Missing day converting ${JSON.stringify(e)}`);return _t.set(Bt,qt),["constrain","reject"].forEach(zt=>{const Vt=JSON.stringify({func:"calendarToIsoDate",year:qt.year,month:qt.month,day:qt.day,overflow:zt,id:this.id});_t.set(Vt,e)}),qt}validateCalendarDate(e){const{era:_t,month:At,year:xt,day:kt,eraYear:Bt,monthCode:Nt,monthExtra:Ut}=e;if(Ut!==void 0)throw new RangeError("Unexpected `monthExtra` value");if(xt===void 0&&Bt===void 0)throw new TypeError("year or eraYear is required");if(At===void 0&&Nt===void 0)throw new TypeError("month or monthCode is required");if(kt===void 0)throw new RangeError("Missing day");if(Nt!==void 0){if(typeof Nt!="string")throw new RangeError("monthCode must be a string, not "+typeof Nt);if(!/^M([01]?\d)(L?)$/.test(Nt))throw new RangeError(`Invalid monthCode: ${Nt}`)}if(this.constantEra){if(_t!==void 0&&_t!==this.constantEra)throw new RangeError(`era must be ${this.constantEra}, not ${_t}`);if(Bt!==void 0&&xt!==void 0&&Bt!==xt)throw new RangeError(`eraYear ${Bt} does not match year ${xt}`)}if(this.hasEra&&e.era===void 0!=(e.eraYear===void 0))throw new RangeError("properties 'era' and 'eraYear' must be provided together")}adjustCalendarDate(e,_t,At="constrain",xt=!1){if(this.calendarType==="lunisolar")throw new RangeError("Override required for lunisolar calendars");let kt=e;if(this.validateCalendarDate(kt),this.constantEra){const{year:Lt,eraYear:jt}=kt;kt={...kt,era:this.constantEra,year:Lt!==void 0?Lt:jt,eraYear:jt!==void 0?jt:Lt}}const Bt=this.monthsInYear(kt,_t);let{month:Nt,monthCode:Ut}=kt;return{month:Nt,monthCode:Ut}=resolveNonLunisolarMonth(kt,At,Bt),{...kt,month:Nt,monthCode:Ut}}regulateMonthDayNaive(e,_t,At){const xt=this.monthsInYear(e,At);let{month:kt,day:Bt}=e;return _t==="reject"?(RejectToRange(kt,1,xt),RejectToRange(Bt,1,this.maximumMonthLength(e))):(kt=ConstrainToRange(kt,1,xt),Bt=ConstrainToRange(Bt,1,this.maximumMonthLength({...e,month:kt}))),{...e,month:kt,day:Bt}}calendarToIsoDate(e,_t="constrain",At){const xt=e;let kt=this.adjustCalendarDate(e,At,_t,!1);kt=this.regulateMonthDayNaive(kt,_t,At);const{year:Bt,month:Nt,day:Ut}=kt,Lt=JSON.stringify({func:"calendarToIsoDate",year:Bt,month:Nt,day:Ut,overflow:_t,id:this.id});let jt,Kt=At.get(Lt);if(Kt||xt.year!==void 0&&xt.month!==void 0&&xt.day!==void 0&&(xt.year!==kt.year||xt.month!==kt.month||xt.day!==kt.day)&&(jt=JSON.stringify({func:"calendarToIsoDate",year:xt.year,month:xt.month,day:xt.day,overflow:_t,id:this.id}),Kt=At.get(jt),Kt))return Kt;let qt=this.estimateIsoDate({year:Bt,month:Nt,day:Ut});const zt=Xt=>{let Jt=this.addDaysIso(qt,Xt);if(kt.day>this.minimumMonthLength(kt)){let tr=this.isoToCalendarDate(Jt,At);for(;tr.month!==Nt||tr.year!==Bt;){if(_t==="reject")throw new RangeError(`day ${Ut} does not exist in month ${Nt} of year ${Bt}`);Jt=this.addDaysIso(Jt,-1),tr=this.isoToCalendarDate(Jt,At)}}return Jt};let Vt=0,Ht=this.isoToCalendarDate(qt,At),Wt=simpleDateDiff(kt,Ht);if(Wt.years!==0||Wt.months!==0||Wt.days!==0){const Xt=365*Wt.years+30*Wt.months+Wt.days;qt=this.addDaysIso(qt,Xt),Ht=this.isoToCalendarDate(qt,At),Wt=simpleDateDiff(kt,Ht),Wt.years===0&&Wt.months===0?qt=zt(Wt.days):Vt=this.compareCalendarDates(kt,Ht)}let Qt=8;for(;Vt;){qt=this.addDaysIso(qt,Vt*Qt);const Xt=Ht;Ht=this.isoToCalendarDate(qt,At);const Jt=Vt;if(Vt=this.compareCalendarDates(kt,Ht),Vt){if(Wt=simpleDateDiff(kt,Ht),Wt.years===0&&Wt.months===0)qt=zt(Wt.days),Vt=0;else if(Jt&&Vt!==Jt)if(Qt>1)Qt/=2;else{if(_t==="reject")throw new RangeError(`Can't find ISO date from calendar date: ${JSON.stringify({...xt})}`);this.compareCalendarDates(Ht,Xt)>0&&(qt=this.addDaysIso(qt,-1)),Vt=0}}}if(At.set(Lt,qt),jt&&At.set(jt,qt),kt.year===void 0||kt.month===void 0||kt.day===void 0||kt.monthCode===void 0||this.hasEra&&(kt.era===void 0||kt.eraYear===void 0))throw new RangeError("Unexpected missing property");return qt}temporalToCalendarDate(e,_t){const At={year:GetSlot(e,i$1),month:GetSlot(e,s$1),day:GetSlot(e,l)};return this.isoToCalendarDate(At,_t)}compareCalendarDates(e,_t){const At=PrepareTemporalFields(e,["day","month","year"],["day","month","year"]),xt=PrepareTemporalFields(_t,["day","month","year"],["day","month","year"]);return At.year!==xt.year?ComparisonResult(At.year-xt.year):At.month!==xt.month?ComparisonResult(At.month-xt.month):At.day!==xt.day?ComparisonResult(At.day-xt.day):0}regulateDate(e,_t="constrain",At){const xt=this.calendarToIsoDate(e,_t,At);return this.isoToCalendarDate(xt,At)}addDaysIso(e,_t){return AddISODate(e.year,e.month,e.day,0,0,0,_t,"constrain")}addDaysCalendar(e,_t,At){const xt=this.calendarToIsoDate(e,"constrain",At),kt=this.addDaysIso(xt,_t);return this.isoToCalendarDate(kt,At)}addMonthsCalendar(e,_t,At,xt){let kt=e;const{day:Bt}=kt;for(let Nt=0,Ut=It(_t);Nt<Ut;Nt++){const{month:Lt}=kt,jt=kt,Kt=_t<0?-Math.max(Bt,this.daysInPreviousMonth(kt,xt)):this.daysInMonth(kt,xt),qt=this.calendarToIsoDate(kt,"constrain",xt);let zt=this.addDaysIso(qt,Kt);if(kt=this.isoToCalendarDate(zt,xt),_t>0){const Vt=this.monthsInYear(jt,xt);for(;kt.month-1!=Lt%Vt;)zt=this.addDaysIso(zt,-1),kt=this.isoToCalendarDate(zt,xt)}kt.day!==Bt&&(kt=this.regulateDate({...kt,day:Bt},"constrain",xt))}if(At==="reject"&&kt.day!==Bt)throw new RangeError(`Day ${Bt} does not exist in resulting calendar month`);return kt}addCalendar(e,{years:_t=0,months:At=0,weeks:xt=0,days:kt=0},Bt,Nt){const{year:Ut,day:Lt,monthCode:jt}=e,Kt=this.adjustCalendarDate({year:Ut+_t,monthCode:jt,day:Lt},Nt),qt=this.addMonthsCalendar(Kt,At,Bt,Nt),zt=kt+7*xt;return this.addDaysCalendar(qt,zt,Nt)}untilCalendar(e,_t,At,xt){let kt=0,Bt=0,Nt=0,Ut=0;switch(At){case"day":kt=this.calendarDaysUntil(e,_t,xt);break;case"week":{const Lt=this.calendarDaysUntil(e,_t,xt);kt=Lt%7,Bt=(Lt-kt)/7;break}case"month":case"year":{const Lt=this.compareCalendarDates(_t,e);if(!Lt)return{years:0,months:0,weeks:0,days:0};const jt=_t.year-e.year,Kt=_t.day-e.day;if(At==="year"&&jt){let Vt=0;_t.monthCode>e.monthCode&&(Vt=1),_t.monthCode<e.monthCode&&(Vt=-1),Vt||(Vt=Math.sign(Kt)),Ut=Vt*Lt<0?jt-Lt:jt}let qt,zt=Ut?this.addCalendar(e,{years:Ut},"constrain",xt):e;do Nt+=Lt,qt=zt,zt=this.addMonthsCalendar(qt,Lt,"constrain",xt),zt.day!==e.day&&(zt=this.regulateDate({...zt,day:e.day},"constrain",xt));while(this.compareCalendarDates(_t,zt)*Lt>=0);Nt-=Lt,kt=this.calendarDaysUntil(qt,_t,xt);break}}return{years:Ut,months:Nt,weeks:Bt,days:kt}}daysInMonth(e,_t){const{day:At}=e,xt=this.maximumMonthLength(e),kt=this.minimumMonthLength(e);if(kt===xt)return kt;const Bt=At<=xt-kt?xt:kt,Nt=this.calendarToIsoDate(e,"constrain",_t),Ut=this.addDaysIso(Nt,Bt),Lt=this.isoToCalendarDate(Ut,_t),jt=this.addDaysIso(Ut,-Lt.day);return this.isoToCalendarDate(jt,_t).day}daysInPreviousMonth(e,_t){const{day:At,month:xt,year:kt}=e;let Bt={year:xt>1?kt:kt-1,month:xt,day:1};const Nt=xt>1?xt-1:this.monthsInYear(Bt,_t);Bt={...Bt,month:Nt};const Ut=this.minimumMonthLength(Bt),Lt=this.maximumMonthLength(Bt);if(Ut===Lt)return Lt;const jt=this.calendarToIsoDate(e,"constrain",_t),Kt=this.addDaysIso(jt,-At);return this.isoToCalendarDate(Kt,_t).day}startOfCalendarYear(e){return{year:e.year,month:1,monthCode:"M01",day:1}}startOfCalendarMonth(e){return{year:e.year,month:e.month,day:1}}calendarDaysUntil(e,_t,At){const xt=this.calendarToIsoDate(e,"constrain",At),kt=this.calendarToIsoDate(_t,"constrain",At);return this.isoDaysUntil(xt,kt)}isoDaysUntil(e,_t){return DifferenceISODate(e.year,e.month,e.day,_t.year,_t.month,_t.day,"day").days}monthDayFromFields(e,_t,At){let xt,kt,Bt,Nt,Ut,{monthCode:Lt,day:jt}=e;if(Lt===void 0){let{year:zt,era:Vt,eraYear:Ht}=e;if(zt===void 0&&(Vt===void 0||Ht===void 0))throw new TypeError("when `monthCode` is omitted, `year` (or `era` and `eraYear`) and `month` are required");({monthCode:Lt,day:jt}=this.isoToCalendarDate(this.calendarToIsoDate(e,_t,At),At))}const Kt=this.isoToCalendarDate({year:1972,month:12,day:31},At),qt=Kt.monthCode>Lt||Kt.monthCode===Lt&&Kt.day>=jt?Kt.year:Kt.year-1;for(let zt=0;zt<100;zt++){const Vt=this.adjustCalendarDate({day:jt,monthCode:Lt,year:qt-zt},At),Ht=this.calendarToIsoDate(Vt,"constrain",At),Wt=this.isoToCalendarDate(Ht,At);if({year:xt,month:kt,day:Bt}=Ht,Wt.monthCode===Lt&&Wt.day===jt)return{month:kt,day:Bt,year:xt};_t==="constrain"&&(Nt===void 0||Wt.monthCode===Nt.monthCode&&Wt.day>Nt.day)&&(Nt=Wt,Ut=Ht)}if(_t==="constrain"&&Ut!==void 0)return Ut;throw new RangeError(`No recent ${this.id} year with monthCode ${Lt} and day ${jt}`)}}class HebrewHelper extends HelperBase{constructor(){super(...arguments),this.id="hebrew",this.calendarType="lunisolar",this.months={Tishri:{leap:1,regular:1,monthCode:"M01",days:30},Heshvan:{leap:2,regular:2,monthCode:"M02",days:{min:29,max:30}},Kislev:{leap:3,regular:3,monthCode:"M03",days:{min:29,max:30}},Tevet:{leap:4,regular:4,monthCode:"M04",days:29},Shevat:{leap:5,regular:5,monthCode:"M05",days:30},Adar:{leap:void 0,regular:6,monthCode:"M06",days:29},"Adar I":{leap:6,regular:void 0,monthCode:"M05L",days:30},"Adar II":{leap:7,regular:void 0,monthCode:"M06",days:29},Nisan:{leap:8,regular:7,monthCode:"M07",days:30},Iyar:{leap:9,regular:8,monthCode:"M08",days:29},Sivan:{leap:10,regular:9,monthCode:"M09",days:30},Tamuz:{leap:11,regular:10,monthCode:"M10",days:29},Av:{leap:12,regular:11,monthCode:"M11",days:30},Elul:{leap:13,regular:12,monthCode:"M12",days:29}},this.hasEra=!1}inLeapYear(e){const{year:_t}=e;return(7*_t+1)%19<7}monthsInYear(e){return this.inLeapYear(e)?13:12}minimumMonthLength(e){return this.minMaxMonthLength(e,"min")}maximumMonthLength(e){return this.minMaxMonthLength(e,"max")}minMaxMonthLength(e,_t){const{month:At,year:xt}=e,kt=this.getMonthCode(xt,At),Bt=wt(this.months).find(Ut=>Ut[1].monthCode===kt);if(Bt===void 0)throw new RangeError(`unmatched Hebrew month: ${At}`);const Nt=Bt[1].days;return typeof Nt=="number"?Nt:Nt[_t]}estimateIsoDate(e){const{year:_t}=e;return{year:_t-3760,month:1,day:1}}getMonthCode(e,_t){return this.inLeapYear({year:e})?_t===6?buildMonthCode(5,!0):buildMonthCode(_t<6?_t:_t-1):buildMonthCode(_t)}adjustCalendarDate(e,_t,At="constrain",xt=!1){let{year:kt,eraYear:Bt,month:Nt,monthCode:Ut,day:Lt,monthExtra:jt}=e;if(kt===void 0&&Bt!==void 0&&(kt=Bt),Bt===void 0&&kt!==void 0&&(Bt=kt),xt){if(jt){const Kt=this.months[jt];if(!Kt)throw new RangeError(`Unrecognized month from formatToParts: ${jt}`);Nt=this.inLeapYear({year:kt})?Kt.leap:Kt.regular}return Ut=this.getMonthCode(kt,Nt),{year:kt,month:Nt,day:Lt,era:void 0,eraYear:Bt,monthCode:Ut}}if(this.validateCalendarDate(e),Nt===void 0)if(Ut.endsWith("L")){if(Ut!=="M05L")throw new RangeError(`Hebrew leap month must have monthCode M05L, not ${Ut}`);if(Nt=6,!this.inLeapYear({year:kt})){if(At==="reject")throw new RangeError(`Hebrew monthCode M05L is invalid in year ${kt} which is not a leap year`);Nt=6,Ut="M06"}}else{Nt=monthCodeNumberPart(Ut),this.inLeapYear({year:kt})&&Nt>=6&&Nt++;const Kt=this.monthsInYear({year:kt});if(Nt<1||Nt>Kt)throw new RangeError(`Invalid monthCode: ${Ut}`)}else if(At==="reject"?(RejectToRange(Nt,1,this.monthsInYear({year:kt})),RejectToRange(Lt,1,this.maximumMonthLength({year:kt,month:Nt}))):(Nt=ConstrainToRange(Nt,1,this.monthsInYear({year:kt})),Lt=ConstrainToRange(Lt,1,this.maximumMonthLength({year:kt,month:Nt}))),Ut===void 0)Ut=this.getMonthCode(kt,Nt);else if(this.getMonthCode(kt,Nt)!==Ut)throw new RangeError(`monthCode ${Ut} doesn't correspond to month ${Nt} in Hebrew year ${kt}`);return{...e,day:Lt,month:Nt,monthCode:Ut,year:kt,eraYear:Bt}}}class IslamicBaseHelper extends HelperBase{constructor(){super(...arguments),this.calendarType="lunar",this.DAYS_PER_ISLAMIC_YEAR=354+11/30,this.DAYS_PER_ISO_YEAR=365.2425,this.constantEra="ah"}inLeapYear(e,_t){return this.daysInMonth({year:e.year,month:12,day:1},_t)===30}monthsInYear(){return 12}minimumMonthLength(){return 29}maximumMonthLength(){return 30}estimateIsoDate(e){const{year:_t}=this.adjustCalendarDate(e);return{year:St(_t*this.DAYS_PER_ISLAMIC_YEAR/this.DAYS_PER_ISO_YEAR)+622,month:1,day:1}}}class IslamicHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic"}}class IslamicUmalquraHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-umalqura"}}class IslamicTblaHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-tbla"}}class IslamicCivilHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-civil"}}class IslamicRgsaHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-rgsa"}}class IslamicCcHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamicc"}}class PersianHelper extends HelperBase{constructor(){super(...arguments),this.id="persian",this.calendarType="solar",this.constantEra="ap"}inLeapYear(e,_t){return IslamicHelper.prototype.inLeapYear.call(this,e,_t)}monthsInYear(){return 12}minimumMonthLength(e){const{month:_t}=e;return _t===12?29:_t<=6?31:30}maximumMonthLength(e){const{month:_t}=e;return _t===12?30:_t<=6?31:30}estimateIsoDate(e){const{year:_t}=this.adjustCalendarDate(e);return{year:_t+621,month:1,day:1}}}class IndianHelper extends HelperBase{constructor(){super(...arguments),this.id="indian",this.calendarType="solar",this.constantEra="saka",this.months={1:{length:30,month:3,day:22,leap:{length:31,month:3,day:21}},2:{length:31,month:4,day:21},3:{length:31,month:5,day:22},4:{length:31,month:6,day:22},5:{length:31,month:7,day:23},6:{length:31,month:8,day:23},7:{length:30,month:9,day:23},8:{length:30,month:10,day:23},9:{length:30,month:11,day:22},10:{length:30,month:12,day:22},11:{length:30,month:1,nextYear:!0,day:21},12:{length:30,month:2,nextYear:!0,day:20}},this.vulnerableToBceBug=new Date("0000-01-01T00:00Z").toLocaleDateString("en-US-u-ca-indian",{timeZone:"UTC"})!=="10/11/-79 Saka"}inLeapYear(e){return isGregorianLeapYear(e.year+78)}monthsInYear(){return 12}minimumMonthLength(e){return this.getMonthInfo(e).length}maximumMonthLength(e){return this.getMonthInfo(e).length}getMonthInfo(e){const{month:_t}=e;let At=this.months[_t];if(At===void 0)throw new RangeError(`Invalid month: ${_t}`);return this.inLeapYear(e)&&At.leap&&(At=At.leap),At}estimateIsoDate(e){const _t=this.adjustCalendarDate(e),At=this.getMonthInfo(_t);return AddISODate(_t.year+78+(At.nextYear?1:0),At.month,At.day,0,0,0,_t.day-1,"constrain")}checkIcuBugs(e){if(this.vulnerableToBceBug&&e.year<1)throw new RangeError(`calendar '${this.id}' is broken for ISO dates before 0001-01-01 (see https://bugs.chromium.org/p/v8/issues/detail?id=10529)`)}}function isGregorianLeapYear($t){return $t%4==0&&($t%100!=0||$t%400==0)}class GregorianBaseHelper extends HelperBase{constructor(e,_t){super(),this.calendarType="solar",this.v8IsVulnerableToJulianBug=new Date("+001001-01-01T00:00Z").toLocaleDateString("en-US-u-ca-japanese",{timeZone:"UTC"}).startsWith("12"),this.calendarIsVulnerableToJulianBug=!1,this.id=e;const{eras:At,anchorEra:xt}=function(Bt){let Nt,Ut=Bt;if(Ut.length===0)throw new RangeError("Invalid era data: eras are required");if(Ut.length===1&&Ut[0].reverseOf)throw new RangeError("Invalid era data: anchor era cannot count years backwards");if(Ut.length===1&&!Ut[0].name)throw new RangeError("Invalid era data: at least one named era is required");if(Ut.filter(jt=>jt.reverseOf!=null).length>1)throw new RangeError("Invalid era data: only one era can count years backwards");Ut.forEach(jt=>{if(jt.isAnchor||!jt.anchorEpoch&&!jt.reverseOf){if(Nt)throw new RangeError("Invalid era data: cannot have multiple anchor eras");Nt=jt,jt.anchorEpoch={year:jt.hasYearZero?0:1}}else if(!jt.name)throw new RangeError("If era name is blank, it must be the anchor era")}),Ut=Ut.filter(jt=>jt.name),Ut.forEach(jt=>{const{reverseOf:Kt}=jt;if(Kt){const qt=Ut.find(zt=>zt.name===Kt);if(qt===void 0)throw new RangeError(`Invalid era data: unmatched reverseOf era: ${Kt}`);jt.reverseOf=qt,jt.anchorEpoch=qt.anchorEpoch,jt.isoEpoch=qt.isoEpoch}jt.anchorEpoch.month===void 0&&(jt.anchorEpoch.month=1),jt.anchorEpoch.day===void 0&&(jt.anchorEpoch.day=1)}),yt.call(Ut,(jt,Kt)=>{if(jt.reverseOf)return 1;if(Kt.reverseOf)return-1;if(!jt.isoEpoch||!Kt.isoEpoch)throw new RangeError("Invalid era data: missing ISO epoch");return Kt.isoEpoch.year-jt.isoEpoch.year});const Lt=Ut[Ut.length-1].reverseOf;if(Lt&&Lt!==Ut[Ut.length-2])throw new RangeError("Invalid era data: invalid reverse-sign era");return Ut.forEach((jt,Kt)=>{jt.genericName="era"+(Ut.length-1-Kt)}),{eras:Ut,anchorEra:Nt||Ut[0]}}(_t);this.anchorEra=xt,this.eras=At}inLeapYear(e){const{year:_t}=this.estimateIsoDate({month:1,day:1,year:e.year});return isGregorianLeapYear(_t)}monthsInYear(){return 12}minimumMonthLength(e){const{month:_t}=e;return _t===2?this.inLeapYear(e)?29:28:[4,6,9,11].indexOf(_t)>=0?30:31}maximumMonthLength(e){return this.minimumMonthLength(e)}completeEraYear(e){const _t=(Nt,Ut)=>{const Lt=e[Nt];if(Lt!=null&&Lt!=Ut)throw new RangeError(`Input ${Nt} ${Lt} doesn't match calculated value ${Ut}`)},At=Nt=>{let Ut;const Lt={...e,year:Nt},jt=this.eras.find((Kt,qt)=>{if(qt===this.eras.length-1){if(Kt.reverseOf){if(Nt>0)throw new RangeError(`Signed year ${Nt} is invalid for era ${Kt.name}`);return Ut=Kt.anchorEpoch.year-Nt,!0}return Ut=Nt-Kt.anchorEpoch.year+(Kt.hasYearZero?0:1),!0}return this.compareCalendarDates(Lt,Kt.anchorEpoch)>=0&&(Ut=Nt-Kt.anchorEpoch.year+(Kt.hasYearZero?0:1),!0)});if(!jt)throw new RangeError(`Year ${Nt} was not matched by any era`);return{eraYear:Ut,era:jt.name}};let{year:xt,eraYear:kt,era:Bt}=e;if(xt!=null)({eraYear:kt,era:Bt}=At(xt)),_t("era",Bt),_t("eraYear",kt);else{if(kt==null)throw new RangeError("Either `year` or `eraYear` and `era` are required");{const Nt=Bt===void 0?void 0:this.eras.find(Ut=>Ut.name===Bt||Ut.genericName===Bt);if(!Nt)throw new RangeError(`Era ${Bt} (ISO year ${kt}) was not matched by any era`);if(kt<1&&Nt.reverseOf)throw new RangeError(`Years in ${Bt} era must be positive, not ${xt}`);xt=Nt.reverseOf?Nt.anchorEpoch.year-kt:kt+Nt.anchorEpoch.year-(Nt.hasYearZero?0:1),_t("year",xt),{eraYear:kt,era:Bt}=At(xt)}}return{...e,year:xt,eraYear:kt,era:Bt}}adjustCalendarDate(e,_t,At="constrain"){let xt=e;const{month:kt,monthCode:Bt}=xt;return kt===void 0&&(xt={...xt,month:monthCodeNumberPart(Bt)}),this.validateCalendarDate(xt),xt=this.completeEraYear(xt),super.adjustCalendarDate(xt,_t,At)}estimateIsoDate(e){const _t=this.adjustCalendarDate(e),{year:At,month:xt,day:kt}=_t,{anchorEra:Bt}=this;return RegulateISODate(At+Bt.isoEpoch.year-(Bt.hasYearZero?0:1),xt,kt,"constrain")}checkIcuBugs(e){if(this.calendarIsVulnerableToJulianBug&&this.v8IsVulnerableToJulianBug&&CompareISODate(e.year,e.month,e.day,1582,10,15)<0)throw new RangeError(`calendar '${this.id}' is broken for ISO dates before 1582-10-15 (see https://bugs.chromium.org/p/chromium/issues/detail?id=1173158)`)}}class OrthodoxBaseHelper extends GregorianBaseHelper{constructor(e,_t){super(e,_t)}inLeapYear(e){const{year:_t}=e;return(_t+1)%4==0}monthsInYear(){return 13}minimumMonthLength(e){const{month:_t}=e;return _t===13?this.inLeapYear(e)?6:5:30}maximumMonthLength(e){return this.minimumMonthLength(e)}}class EthioaaHelper extends OrthodoxBaseHelper{constructor(){super("ethioaa",[{name:"era0",isoEpoch:{year:-5492,month:7,day:17}}])}}class CopticHelper extends OrthodoxBaseHelper{constructor(){super("coptic",[{name:"era1",isoEpoch:{year:284,month:8,day:29}},{name:"era0",reverseOf:"era1"}])}}class EthiopicHelper extends OrthodoxBaseHelper{constructor(){super("ethiopic",[{name:"era0",isoEpoch:{year:-5492,month:7,day:17}},{name:"era1",isoEpoch:{year:8,month:8,day:27},anchorEpoch:{year:5501}}])}}class RocHelper extends GregorianBaseHelper{constructor(){super("roc",[{name:"minguo",isoEpoch:{year:1912,month:1,day:1}},{name:"before-roc",reverseOf:"minguo"}]),this.calendarIsVulnerableToJulianBug=!0}}class BuddhistHelper extends GregorianBaseHelper{constructor(){super("buddhist",[{name:"be",hasYearZero:!0,isoEpoch:{year:-543,month:1,day:1}}]),this.calendarIsVulnerableToJulianBug=!0}}class GregoryHelper extends GregorianBaseHelper{constructor(){super("gregory",[{name:"ce",isoEpoch:{year:1,month:1,day:1}},{name:"bce",reverseOf:"ce"}])}reviseIntlEra(e){let{era:_t,eraYear:At}=e;return _t!=="bc"&&_t!=="b"||(_t="bce"),_t!=="ad"&&_t!=="a"||(_t="ce"),{era:_t,eraYear:At}}}class JapaneseHelper extends GregorianBaseHelper{constructor(){super("japanese",[{name:"reiwa",isoEpoch:{year:2019,month:5,day:1},anchorEpoch:{year:2019,month:5,day:1}},{name:"heisei",isoEpoch:{year:1989,month:1,day:8},anchorEpoch:{year:1989,month:1,day:8}},{name:"showa",isoEpoch:{year:1926,month:12,day:25},anchorEpoch:{year:1926,month:12,day:25}},{name:"taisho",isoEpoch:{year:1912,month:7,day:30},anchorEpoch:{year:1912,month:7,day:30}},{name:"meiji",isoEpoch:{year:1868,month:9,day:8},anchorEpoch:{year:1868,month:9,day:8}},{name:"ce",isoEpoch:{year:1,month:1,day:1}},{name:"bce",reverseOf:"ce"}]),this.calendarIsVulnerableToJulianBug=!0,this.eraLength="long",this.erasBeginMidYear=!0}reviseIntlEra(e,_t){const{era:At,eraYear:xt}=e,{year:kt}=_t;return this.eras.find(Bt=>Bt.name===At)?{era:At,eraYear:xt}:kt<1?{era:"bce",eraYear:1-kt}:{era:"ce",eraYear:kt}}}class ChineseBaseHelper extends HelperBase{constructor(){super(...arguments),this.calendarType="lunisolar",this.hasEra=!1}inLeapYear(e,_t){const At=this.getMonthList(e.year,_t);return wt(At).length===13}monthsInYear(e,_t){return this.inLeapYear(e,_t)?13:12}minimumMonthLength(){return 29}maximumMonthLength(){return 30}getMonthList(e,_t){if(e===void 0)throw new TypeError("Missing year");const At=JSON.stringify({func:"getMonthList",calendarYear:e,id:this.id}),xt=_t.get(At);if(xt)return xt;const kt=this.getFormatter(),Bt=(Wt,Qt)=>{const Xt=toUtcIsoDateString({isoYear:Wt,isoMonth:2,isoDay:1}),Jt=new Date(Xt);Jt.setUTCDate(Qt+1);const tr=kt.formatToParts(Jt),dr=tr.find(Ir=>Ir.type==="month").value,vr=+tr.find(Ir=>Ir.type==="day").value;let $r=tr.find(Ir=>Ir.type==="relatedYear");if($r===void 0)throw new RangeError(`Intl.DateTimeFormat.formatToParts lacks relatedYear in ${this.id} calendar. Try Node 14+ or modern browsers.`);return $r=+$r.value,{calendarMonthString:dr,calendarDay:vr,calendarYearToVerify:$r}};let Nt=17,{calendarMonthString:Ut,calendarDay:Lt,calendarYearToVerify:jt}=Bt(e,Nt);Ut!=="1"&&(Nt+=29,{calendarMonthString:Ut,calendarDay:Lt}=Bt(e,Nt)),Nt-=Lt-5;const Kt={};let qt,zt,Vt=1,Ht=!1;do({calendarMonthString:Ut,calendarDay:Lt,calendarYearToVerify:jt}=Bt(e,Nt)),qt&&(Kt[zt].daysInMonth=qt+30-Lt),jt!==e?Ht=!0:(Kt[Ut]={monthIndex:Vt++},Nt+=30),qt=Lt,zt=Ut;while(!Ht);return Kt[zt].daysInMonth=qt+30-Lt,_t.set(At,Kt),Kt}estimateIsoDate(e){const{year:_t,month:At}=e;return{year:_t,month:At>=12?12:At+1,day:1}}adjustCalendarDate(e,_t,At="constrain",xt=!1){let{year:kt,month:Bt,monthExtra:Nt,day:Ut,monthCode:Lt,eraYear:jt}=e;if(xt){if(kt=jt,Nt&&Nt!=="bis")throw new RangeError(`Unexpected leap month suffix: ${Nt}`);const Kt=buildMonthCode(Bt,Nt!==void 0),qt=`${Bt}${Nt||""}`,zt=this.getMonthList(kt,_t)[qt];if(zt===void 0)throw new RangeError(`Unmatched month ${qt} in Chinese year ${kt}`);return Bt=zt.monthIndex,{year:kt,month:Bt,day:Ut,era:void 0,eraYear:jt,monthCode:Kt}}if(this.validateCalendarDate(e),kt===void 0&&(kt=jt),jt===void 0&&(jt=kt),Bt===void 0){const Kt=this.getMonthList(kt,_t);let qt=Lt.replace("L","bis").slice(1);qt[0]==="0"&&(qt=qt.slice(1));let zt=Kt[qt];if(Bt=zt&&zt.monthIndex,Bt===void 0&&Lt.endsWith("L")&&Lt!="M13L"&&At==="constrain"){let Vt=Lt.slice(1,-1);Vt[0]==="0"&&(Vt=Vt.slice(1)),zt=Kt[Vt],zt&&(Bt=zt.monthIndex,Lt=buildMonthCode(Vt))}if(Bt===void 0)throw new RangeError(`Unmatched month ${Lt} in Chinese year ${kt}`)}else if(Lt===void 0){const Kt=this.getMonthList(kt,_t),qt=wt(Kt),zt=qt.length;At==="reject"?(RejectToRange(Bt,1,zt),RejectToRange(Ut,1,this.maximumMonthLength())):(Bt=ConstrainToRange(Bt,1,zt),Ut=ConstrainToRange(Ut,1,this.maximumMonthLength()));const Vt=qt.find(([,Ht])=>Ht.monthIndex===Bt);if(Vt===void 0)throw new RangeError(`Invalid month ${Bt} in Chinese year ${kt}`);Lt=buildMonthCode(Vt[0].replace("bis",""),Vt[0].indexOf("bis")!==-1)}else{const Kt=this.getMonthList(kt,_t);let qt=Lt.replace("L","bis").slice(1);qt[0]==="0"&&(qt=qt.slice(1));const zt=Kt[qt];if(!zt)throw new RangeError(`Unmatched monthCode ${Lt} in Chinese year ${kt}`);if(Bt!==zt.monthIndex)throw new RangeError(`monthCode ${Lt} doesn't correspond to month ${Bt} in Chinese year ${kt}`)}return{...e,year:kt,eraYear:jt,month:Bt,monthCode:Lt,day:Ut}}}class ChineseHelper extends ChineseBaseHelper{constructor(){super(...arguments),this.id="chinese"}}class DangiHelper extends ChineseBaseHelper{constructor(){super(...arguments),this.id="dangi"}}class NonIsoCalendar{constructor(e){this.helper=e}dateFromFields(e,_t,At){const xt=new OneObjectCache,kt=PrepareTemporalFields(e,this.fields(["day","month","monthCode","year"]),[]),Bt=ToTemporalOverflow(_t),{year:Nt,month:Ut,day:Lt}=this.helper.calendarToIsoDate(kt,Bt,xt),jt=CreateTemporalDate(Nt,Ut,Lt,At);return xt.setObject(jt),jt}yearMonthFromFields(e,_t,At){const xt=new OneObjectCache,kt=PrepareTemporalFields(e,this.fields(["month","monthCode","year"]),[]),Bt=ToTemporalOverflow(_t),{year:Nt,month:Ut,day:Lt}=this.helper.calendarToIsoDate({...kt,day:1},Bt,xt),jt=CreateTemporalYearMonth(Nt,Ut,At,Lt);return xt.setObject(jt),jt}monthDayFromFields(e,_t,At){const xt=new OneObjectCache,kt=PrepareTemporalFields(e,this.fields(["day","month","monthCode","year"]),[]),Bt=ToTemporalOverflow(_t),{year:Nt,month:Ut,day:Lt}=this.helper.monthDayFromFields(kt,Bt,xt),jt=CreateTemporalMonthDay(Ut,Lt,At,Nt);return xt.setObject(jt),jt}fields(e){let _t=e;return Tt.call(_t,"year")&&(_t=[..._t,"era","eraYear"]),_t}fieldKeysToIgnore(e){const _t=new Dt;for(let At=0;At<e.length;At++){const xt=e[At];switch(Call(vt,_t,[xt]),xt){case"era":Call(vt,_t,["eraYear"]),Call(vt,_t,["year"]);break;case"eraYear":Call(vt,_t,["era"]),Call(vt,_t,["year"]);break;case"year":Call(vt,_t,["era"]),Call(vt,_t,["eraYear"]);break;case"month":Call(vt,_t,["monthCode"]),this.helper.erasBeginMidYear&&(Call(vt,_t,["era"]),Call(vt,_t,["eraYear"]));break;case"monthCode":Call(vt,_t,["month"]),this.helper.erasBeginMidYear&&(Call(vt,_t,["era"]),Call(vt,_t,["eraYear"]));break;case"day":this.helper.erasBeginMidYear&&(Call(vt,_t,["era"]),Call(vt,_t,["eraYear"]))}}return[...Call(Ct,_t,[])]}dateAdd(e,_t,At,xt,kt,Bt,Nt){const Ut=OneObjectCache.getCacheForObject(e),Lt=this.helper.temporalToCalendarDate(e,Ut),jt=this.helper.addCalendar(Lt,{years:_t,months:At,weeks:xt,days:kt},Bt,Ut),Kt=this.helper.calendarToIsoDate(jt,"constrain",Ut),{year:qt,month:zt,day:Vt}=Kt,Ht=CreateTemporalDate(qt,zt,Vt,Nt);return new OneObjectCache(Ut).setObject(Ht),Ht}dateUntil(e,_t,At){const xt=OneObjectCache.getCacheForObject(e),kt=OneObjectCache.getCacheForObject(_t),Bt=this.helper.temporalToCalendarDate(e,xt),Nt=this.helper.temporalToCalendarDate(_t,kt);return this.helper.untilCalendar(Bt,Nt,At,xt)}year(e){const _t=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,_t).year}month(e){const _t=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,_t).month}day(e){const _t=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,_t).day}era(e){if(!this.helper.hasEra)return;const _t=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,_t).era}eraYear(e){if(!this.helper.hasEra)return;const _t=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,_t).eraYear}monthCode(e){const _t=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,_t).monthCode}dayOfWeek(e){return Ot.iso8601.dayOfWeek(e)}dayOfYear(e){const _t=OneObjectCache.getCacheForObject(e),At=this.helper.isoToCalendarDate(e,_t),xt=this.helper.startOfCalendarYear(At);return this.helper.calendarDaysUntil(xt,At,_t)+1}weekOfYear(e){return Ot.iso8601.weekOfYear(e)}yearOfWeek(e){return Ot.iso8601.yearOfWeek(e)}daysInWeek(e){return Ot.iso8601.daysInWeek(e)}daysInMonth(e){const _t=OneObjectCache.getCacheForObject(e),At=this.helper.temporalToCalendarDate(e,_t),xt=this.helper.maximumMonthLength(At);if(xt===this.helper.minimumMonthLength(At))return xt;const kt=this.helper.startOfCalendarMonth(At),Bt=this.helper.addMonthsCalendar(kt,1,"constrain",_t);return this.helper.calendarDaysUntil(kt,Bt,_t)}daysInYear(e){let _t=e;HasSlot(_t,i$1)||(_t=ToTemporalDate(_t));const At=OneObjectCache.getCacheForObject(_t),xt=this.helper.temporalToCalendarDate(_t,At),kt=this.helper.startOfCalendarYear(xt),Bt=this.helper.addCalendar(kt,{years:1},"constrain",At);return this.helper.calendarDaysUntil(kt,Bt,At)}monthsInYear(e){const _t=OneObjectCache.getCacheForObject(e),At=this.helper.temporalToCalendarDate(e,_t);return this.helper.monthsInYear(At,_t)}inLeapYear(e){let _t=e;HasSlot(_t,i$1)||(_t=ToTemporalDate(_t));const At=OneObjectCache.getCacheForObject(_t),xt=this.helper.temporalToCalendarDate(_t,At);return this.helper.inLeapYear(xt,At)}}for(const $t of[HebrewHelper,PersianHelper,EthiopicHelper,EthioaaHelper,CopticHelper,ChineseHelper,DangiHelper,RocHelper,IndianHelper,BuddhistHelper,GregoryHelper,JapaneseHelper,IslamicHelper,IslamicUmalquraHelper,IslamicTblaHelper,IslamicCivilHelper,IslamicRgsaHelper,IslamicCcHelper]){const e=new $t;Ot[e.id]=new NonIsoCalendar(e)}class PlainDate{constructor(e,_t,At,xt="iso8601"){CreateTemporalDateSlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(_t),ToIntegerWithTruncation(At),ToTemporalCalendarSlotValue(xt))}get calendarId(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get era(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),this)}get eraYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),this)}get year(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),this)}get month(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),this)}get monthCode(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get day(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),this)}get dayOfWeek(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDayOfWeek(GetSlot(this,p),this)}get dayOfYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDayOfYear(GetSlot(this,p),this)}get weekOfYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarWeekOfYear(GetSlot(this,p),this)}get yearOfWeek(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarYearOfWeek(GetSlot(this,p),this)}get daysInWeek(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDaysInWeek(GetSlot(this,p),this)}get daysInMonth(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),this)}get daysInYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),this)}get monthsInYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),this)}get inLeapYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),this)}with(e,_t){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const At=GetOptionsObject(_t),xt=GetSlot(this,p),kt=CalendarFields(xt,["day","month","monthCode","year"]);let Bt=PrepareTemporalFields(this,kt,[]);return Bt=CalendarMergeFields(xt,Bt,PrepareTemporalFields(e,kt,"partial")),Bt=PrepareTemporalFields(Bt,kt,[]),CalendarDateFromFields(xt,Bt,At)}withCalendar(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const _t=ToTemporalCalendarSlotValue(e);return new PlainDate(GetSlot(this,i$1),GetSlot(this,s$1),GetSlot(this,l),_t)}add(e,_t){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const At=ToTemporalDuration(e),xt=GetOptionsObject(_t);return CalendarDateAdd(GetSlot(this,p),this,At,xt)}subtract(e,_t){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const At=CreateNegatedTemporalDuration(ToTemporalDuration(e)),xt=GetOptionsObject(_t);return CalendarDateAdd(GetSlot(this,p),this,At,xt)}until(e,_t){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDate("until",this,e,_t)}since(e,_t){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDate("since",this,e,_t)}equals(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e);for(const At of[i$1,s$1,l])if(GetSlot(this,At)!==GetSlot(_t,At))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(_t,p))}toString(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return TemporalDateToString(this,ToCalendarNameOption(GetOptionsObject(e)))}toJSON(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return TemporalDateToString(this)}toLocaleString(e,_t){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return new ht(e,_t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainDate")}toPlainDateTime(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const _t=GetSlot(this,i$1),At=GetSlot(this,s$1),xt=GetSlot(this,l),kt=GetSlot(this,p);if(e===void 0)return CreateTemporalDateTime(_t,At,xt,0,0,0,0,0,0,kt);const Bt=ToTemporalTime(e);return CreateTemporalDateTime(_t,At,xt,GetSlot(Bt,d$1),GetSlot(Bt,m$1),GetSlot(Bt,c),GetSlot(Bt,h$1),GetSlot(Bt,u),GetSlot(Bt,T),kt)}toZonedDateTime(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");let _t,At;if(IsObject(e))if(IsTemporalTimeZone(e))_t=e;else{const Vt=e.timeZone;Vt===void 0?_t=ToTemporalTimeZoneSlotValue(e):(_t=ToTemporalTimeZoneSlotValue(Vt),At=e.plainTime)}else _t=ToTemporalTimeZoneSlotValue(e);const xt=GetSlot(this,i$1),kt=GetSlot(this,s$1),Bt=GetSlot(this,l),Nt=GetSlot(this,p);let Ut=0,Lt=0,jt=0,Kt=0,qt=0,zt=0;return At!==void 0&&(At=ToTemporalTime(At),Ut=GetSlot(At,d$1),Lt=GetSlot(At,m$1),jt=GetSlot(At,c),Kt=GetSlot(At,h$1),qt=GetSlot(At,u),zt=GetSlot(At,T)),CreateTemporalZonedDateTime(GetSlot(GetInstantFor(_t,CreateTemporalDateTime(xt,kt,Bt,Ut,Lt,jt,Kt,qt,zt,Nt),"compatible"),n),_t,Nt)}toPlainYearMonth(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarYearMonthFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarMonthDayFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["day","monthCode"]),[]))}getISOFields(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoMonth:GetSlot(this,s$1),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,_t){const At=GetOptionsObject(_t);return IsTemporalDate(e)?(ToTemporalOverflow(At),CreateTemporalDate(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,p))):ToTemporalDate(e,At)}static compare(e,_t){const At=ToTemporalDate(e),xt=ToTemporalDate(_t);return CompareISODate(GetSlot(At,i$1),GetSlot(At,s$1),GetSlot(At,l),GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l))}}MakeIntrinsicClass(PlainDate,"Temporal.PlainDate");class PlainDateTime{constructor(e,_t,At,xt=0,kt=0,Bt=0,Nt=0,Ut=0,Lt=0,jt="iso8601"){CreateTemporalDateTimeSlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(_t),ToIntegerWithTruncation(At),xt===void 0?0:ToIntegerWithTruncation(xt),kt===void 0?0:ToIntegerWithTruncation(kt),Bt===void 0?0:ToIntegerWithTruncation(Bt),Nt===void 0?0:ToIntegerWithTruncation(Nt),Ut===void 0?0:ToIntegerWithTruncation(Ut),Lt===void 0?0:ToIntegerWithTruncation(Lt),ToTemporalCalendarSlotValue(jt))}get calendarId(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get year(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),this)}get month(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),this)}get monthCode(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get day(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),this)}get hour(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,d$1)}get minute(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,m$1)}get second(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,c)}get millisecond(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,h$1)}get microsecond(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,u)}get nanosecond(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,T)}get era(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),this)}get eraYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),this)}get dayOfWeek(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfWeek(GetSlot(this,p),this)}get dayOfYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfYear(GetSlot(this,p),this)}get weekOfYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarWeekOfYear(GetSlot(this,p),this)}get yearOfWeek(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarYearOfWeek(GetSlot(this,p),this)}get daysInWeek(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInWeek(GetSlot(this,p),this)}get daysInYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),this)}get daysInMonth(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),this)}get monthsInYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),this)}get inLeapYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),this)}with(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const At=GetOptionsObject(_t),xt=GetSlot(this,p),kt=CalendarFields(xt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);let Bt=PrepareTemporalFields(this,kt,[]);Bt=CalendarMergeFields(xt,Bt,PrepareTemporalFields(e,kt,"partial")),Bt=PrepareTemporalFields(Bt,kt,[]);const{year:Nt,month:Ut,day:Lt,hour:jt,minute:Kt,second:qt,millisecond:zt,microsecond:Vt,nanosecond:Ht}=InterpretTemporalDateTimeFields(xt,Bt,At);return CreateTemporalDateTime(Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,xt)}withPlainTime(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const _t=GetSlot(this,i$1),At=GetSlot(this,s$1),xt=GetSlot(this,l),kt=GetSlot(this,p);if(e===void 0)return CreateTemporalDateTime(_t,At,xt,0,0,0,0,0,0,kt);const Bt=ToTemporalTime(e);return CreateTemporalDateTime(_t,At,xt,GetSlot(Bt,d$1),GetSlot(Bt,m$1),GetSlot(Bt,c),GetSlot(Bt,h$1),GetSlot(Bt,u),GetSlot(Bt,T),kt)}withPlainDate(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e),At=GetSlot(_t,i$1),xt=GetSlot(_t,s$1),kt=GetSlot(_t,l);let Bt=GetSlot(_t,p);const Nt=GetSlot(this,d$1),Ut=GetSlot(this,m$1),Lt=GetSlot(this,c),jt=GetSlot(this,h$1),Kt=GetSlot(this,u),qt=GetSlot(this,T);return Bt=ConsolidateCalendars(GetSlot(this,p),Bt),CreateTemporalDateTime(At,xt,kt,Nt,Ut,Lt,jt,Kt,qt,Bt)}withCalendar(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalCalendarSlotValue(e);return new PlainDateTime(GetSlot(this,i$1),GetSlot(this,s$1),GetSlot(this,l),GetSlot(this,d$1),GetSlot(this,m$1),GetSlot(this,c),GetSlot(this,h$1),GetSlot(this,u),GetSlot(this,T),_t)}add(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainDateTime("add",this,e,_t)}subtract(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainDateTime("subtract",this,e,_t)}until(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDateTime("until",this,e,_t)}since(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDateTime("since",this,e,_t)}round(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const _t=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),At=ToTemporalRoundingIncrement(_t),xt=ToTemporalRoundingMode(_t,"halfExpand"),kt=GetTemporalUnit(_t,"smallestUnit","time",He,["day"]),Bt={day:1,hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[kt];ValidateTemporalRoundingIncrement(At,Bt,Bt===1);let Nt=GetSlot(this,i$1),Ut=GetSlot(this,s$1),Lt=GetSlot(this,l),jt=GetSlot(this,d$1),Kt=GetSlot(this,m$1),qt=GetSlot(this,c),zt=GetSlot(this,h$1),Vt=GetSlot(this,u),Ht=GetSlot(this,T);return{year:Nt,month:Ut,day:Lt,hour:jt,minute:Kt,second:qt,millisecond:zt,microsecond:Vt,nanosecond:Ht}=RoundISODateTime(Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,At,kt,xt),CreateTemporalDateTime(Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,GetSlot(this,p))}equals(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalDateTime(e);for(const At of[i$1,s$1,l,d$1,m$1,c,h$1,u,T])if(GetSlot(this,At)!==GetSlot(_t,At))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(_t,p))}toString(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const _t=GetOptionsObject(e),At=ToCalendarNameOption(_t),xt=ToFractionalSecondDigits(_t),kt=ToTemporalRoundingMode(_t,"trunc"),Bt=GetTemporalUnit(_t,"smallestUnit","time",void 0);if(Bt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const{precision:Nt,unit:Ut,increment:Lt}=ToSecondsStringPrecisionRecord(Bt,xt);return TemporalDateTimeToString(this,Nt,At,{unit:Ut,increment:Lt,roundingMode:kt})}toJSON(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToString(this,"auto")}toLocaleString(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return new ht(e,_t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainDateTime")}toZonedDateTime(e,_t){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalTimeZoneSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(At,this,ToTemporalDisambiguation(GetOptionsObject(_t))),n),At,GetSlot(this,p))}toPlainDate(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToDate(this)}toPlainYearMonth(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarYearMonthFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarMonthDayFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["day","monthCode"]),[]))}toPlainTime(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToTime(this)}getISOFields(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoHour:GetSlot(this,d$1),isoMicrosecond:GetSlot(this,u),isoMillisecond:GetSlot(this,h$1),isoMinute:GetSlot(this,m$1),isoMonth:GetSlot(this,s$1),isoNanosecond:GetSlot(this,T),isoSecond:GetSlot(this,c),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,_t){const At=GetOptionsObject(_t);return IsTemporalDateTime(e)?(ToTemporalOverflow(At),CreateTemporalDateTime(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),GetSlot(e,p))):ToTemporalDateTime(e,At)}static compare(e,_t){const At=ToTemporalDateTime(e),xt=ToTemporalDateTime(_t);for(const kt of[i$1,s$1,l,d$1,m$1,c,h$1,u,T]){const Bt=GetSlot(At,kt),Nt=GetSlot(xt,kt);if(Bt!==Nt)return ComparisonResult(Bt-Nt)}return 0}}MakeIntrinsicClass(PlainDateTime,"Temporal.PlainDateTime");class Duration{constructor(e=0,_t=0,At=0,xt=0,kt=0,Bt=0,Nt=0,Ut=0,Lt=0,jt=0){const Kt=e===void 0?0:ToIntegerIfIntegral(e),qt=_t===void 0?0:ToIntegerIfIntegral(_t),zt=At===void 0?0:ToIntegerIfIntegral(At),Vt=xt===void 0?0:ToIntegerIfIntegral(xt),Ht=kt===void 0?0:ToIntegerIfIntegral(kt),Wt=Bt===void 0?0:ToIntegerIfIntegral(Bt),Qt=Nt===void 0?0:ToIntegerIfIntegral(Nt),Xt=Ut===void 0?0:ToIntegerIfIntegral(Ut),Jt=Lt===void 0?0:ToIntegerIfIntegral(Lt),tr=jt===void 0?0:ToIntegerIfIntegral(jt);RejectDuration(Kt,qt,zt,Vt,Ht,Wt,Qt,Xt,Jt,tr),N(this),SetSlot(this,w$1,Kt),SetSlot(this,D,qt),SetSlot(this,G,zt),SetSlot(this,v,Vt),SetSlot(this,C,Ht),SetSlot(this,O,Wt),SetSlot(this,b,Qt),SetSlot(this,E$1,Xt),SetSlot(this,M,Jt),SetSlot(this,R,tr)}get years(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,w$1)}get months(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,D)}get weeks(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,G)}get days(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,v)}get hours(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,C)}get minutes(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,O)}get seconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,b)}get milliseconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,E$1)}get microseconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,M)}get nanoseconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,R)}get sign(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return DurationSign(GetSlot(this,w$1),GetSlot(this,D),GetSlot(this,G),GetSlot(this,v),GetSlot(this,C),GetSlot(this,O),GetSlot(this,b),GetSlot(this,E$1),GetSlot(this,M),GetSlot(this,R))}get blank(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return DurationSign(GetSlot(this,w$1),GetSlot(this,D),GetSlot(this,G),GetSlot(this,v),GetSlot(this,C),GetSlot(this,O),GetSlot(this,b),GetSlot(this,E$1),GetSlot(this,M),GetSlot(this,R))===0}with(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");const _t=PrepareTemporalFields(e,["days","hours","microseconds","milliseconds","minutes","months","nanoseconds","seconds","weeks","years"],"partial"),{years:At=GetSlot(this,w$1),months:xt=GetSlot(this,D),weeks:kt=GetSlot(this,G),days:Bt=GetSlot(this,v),hours:Nt=GetSlot(this,C),minutes:Ut=GetSlot(this,O),seconds:Lt=GetSlot(this,b),milliseconds:jt=GetSlot(this,E$1),microseconds:Kt=GetSlot(this,M),nanoseconds:qt=GetSlot(this,R)}=_t;return new Duration(At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt)}negated(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return CreateNegatedTemporalDuration(this)}abs(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return new Duration(Math.abs(GetSlot(this,w$1)),Math.abs(GetSlot(this,D)),Math.abs(GetSlot(this,G)),Math.abs(GetSlot(this,v)),Math.abs(GetSlot(this,C)),Math.abs(GetSlot(this,O)),Math.abs(GetSlot(this,b)),Math.abs(GetSlot(this,E$1)),Math.abs(GetSlot(this,M)),Math.abs(GetSlot(this,R)))}add(e,_t){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromDuration("add",this,e,_t)}subtract(e,_t){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromDuration("subtract",this,e,_t)}round(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");let _t=GetSlot(this,w$1),At=GetSlot(this,D),xt=GetSlot(this,G),kt=GetSlot(this,v),Bt=GetSlot(this,C),Nt=GetSlot(this,O),Ut=GetSlot(this,b),Lt=GetSlot(this,E$1),jt=GetSlot(this,M),Kt=GetSlot(this,R),qt=DefaultTemporalLargestUnit(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt);const zt=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e);let Vt=GetTemporalUnit(zt,"largestUnit","datetime",void 0,["auto"]),Ht=ToRelativeTemporalObject(zt);const Wt=ToTemporalRoundingIncrement(zt),Qt=ToTemporalRoundingMode(zt,"halfExpand");let Xt=GetTemporalUnit(zt,"smallestUnit","datetime",void 0),Jt=!0;Xt||(Jt=!1,Xt="nanosecond"),qt=LargerOfTwoTemporalUnits(qt,Xt);let tr=!0;if(Vt||(tr=!1,Vt=qt),Vt==="auto"&&(Vt=qt),!Jt&&!tr)throw new RangeError("at least one of smallestUnit or largestUnit is required");if(LargerOfTwoTemporalUnits(Vt,Xt)!==Vt)throw new RangeError(`largestUnit ${Vt} cannot be smaller than smallestUnit ${Xt}`);const dr={hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[Xt];return dr!==void 0&&ValidateTemporalRoundingIncrement(Wt,dr,!1),{years:_t,months:At,weeks:xt,days:kt}=UnbalanceDurationRelative(_t,At,xt,kt,Vt,Ht),{years:_t,months:At,weeks:xt,days:kt,hours:Bt,minutes:Nt,seconds:Ut,milliseconds:Lt,microseconds:jt,nanoseconds:Kt}=RoundDuration(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,Wt,Xt,Qt,Ht),{years:_t,months:At,weeks:xt,days:kt,hours:Bt,minutes:Nt,seconds:Ut,milliseconds:Lt,microseconds:jt,nanoseconds:Kt}=AdjustRoundedDurationDays(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,Wt,Xt,Qt,Ht),{days:kt,hours:Bt,minutes:Nt,seconds:Ut,milliseconds:Lt,microseconds:jt,nanoseconds:Kt}=BalanceDuration(kt,Bt,Nt,Ut,Lt,jt,Kt,Vt,Ht),{years:_t,months:At,weeks:xt,days:kt}=function($r,Ir,Rr,Nr,kr,lr){const ir=GetIntrinsic("%Temporal.Duration%"),er=DurationSign($r,Ir,Rr,Nr,0,0,0,0,0,0);if(er===0)return{years:$r,months:Ir,weeks:Rr,days:Nr};const rr=JSBI.BigInt(er);let yr,fr,gr=JSBI.BigInt($r),ar=JSBI.BigInt(Ir),nr=JSBI.BigInt(Rr),ur=JSBI.BigInt(Nr);lr&&(fr=ToTemporalDate(lr),yr=GetSlot(fr,p));const pr=new ir(er),br=new ir(0,er),Sr=new ir(0,0,er);switch(kr){case"year":{if(!yr)throw new RangeError("a starting point is required for years balancing");const Pr=typeof yr!="string"?GetMethod(yr,"dateAdd"):void 0;let Tr,wr,Ar;for({relativeTo:Tr,days:wr}=MoveRelativeDate(yr,fr,pr,Pr);JSBI.greaterThanOrEqual(abs(ur),JSBI.BigInt(ae(wr)));)ur=JSBI.subtract(ur,JSBI.BigInt(wr)),gr=JSBI.add(gr,rr),fr=Tr,{relativeTo:Tr,days:wr}=MoveRelativeDate(yr,fr,pr,Pr);for({relativeTo:Tr,days:Ar}=MoveRelativeDate(yr,fr,br,Pr);JSBI.greaterThanOrEqual(abs(ur),JSBI.BigInt(ae(Ar)));)ur=JSBI.subtract(ur,JSBI.BigInt(Ar)),ar=JSBI.add(ar,rr),fr=Tr,{relativeTo:Tr,days:Ar}=MoveRelativeDate(yr,fr,br,Pr);Tr=CalendarDateAdd(yr,fr,pr,void 0,Pr);const Mr=typeof yr!="string"?GetMethod(yr,"dateUntil"):void 0,Ur=Te(null);Ur.largestUnit="month";let Or=CalendarDateUntil(yr,fr,Tr,Ur,Mr),Cr=GetSlot(Or,D);for(;JSBI.greaterThanOrEqual(abs(ar),JSBI.BigInt(ae(Cr)));){ar=JSBI.subtract(ar,JSBI.BigInt(Cr)),gr=JSBI.add(gr,rr),fr=Tr,Tr=CalendarDateAdd(yr,fr,pr,void 0,Pr);const Er=Te(null);Er.largestUnit="month",Or=CalendarDateUntil(yr,fr,Tr,Er,Mr),Cr=GetSlot(Or,D)}break}case"month":{if(!yr)throw new RangeError("a starting point is required for months balancing");const Pr=typeof yr!="string"?GetMethod(yr,"dateAdd"):void 0;let Tr,wr;for({relativeTo:Tr,days:wr}=MoveRelativeDate(yr,fr,br,Pr);JSBI.greaterThanOrEqual(abs(ur),JSBI.BigInt(ae(wr)));)ur=JSBI.subtract(ur,JSBI.BigInt(wr)),ar=JSBI.add(ar,rr),fr=Tr,{relativeTo:Tr,days:wr}=MoveRelativeDate(yr,fr,br,Pr);break}case"week":{if(!yr)throw new RangeError("a starting point is required for weeks balancing");const Pr=typeof yr!="string"?GetMethod(yr,"dateAdd"):void 0;let Tr,wr;for({relativeTo:Tr,days:wr}=MoveRelativeDate(yr,fr,Sr,Pr);JSBI.greaterThanOrEqual(abs(ur),JSBI.BigInt(ae(wr)));)ur=JSBI.subtract(ur,JSBI.BigInt(wr)),nr=JSBI.add(nr,rr),fr=Tr,{relativeTo:Tr,days:wr}=MoveRelativeDate(yr,fr,Sr,Pr);break}}return{years:JSBI.toNumber(gr),months:JSBI.toNumber(ar),weeks:JSBI.toNumber(nr),days:JSBI.toNumber(ur)}}(_t,At,xt,kt,Vt,Ht),new Duration(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt)}total(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");let _t=GetSlot(this,w$1),At=GetSlot(this,D),xt=GetSlot(this,G),kt=GetSlot(this,v),Bt=GetSlot(this,C),Nt=GetSlot(this,O),Ut=GetSlot(this,b),Lt=GetSlot(this,E$1),jt=GetSlot(this,M),Kt=GetSlot(this,R);if(e===void 0)throw new TypeError("options argument is required");const qt=typeof e=="string"?CreateOnePropObject("unit",e):GetOptionsObject(e),zt=ToRelativeTemporalObject(qt),Vt=GetTemporalUnit(qt,"unit","datetime",He);let Ht;({years:_t,months:At,weeks:xt,days:kt}=UnbalanceDurationRelative(_t,At,xt,kt,Vt,zt)),IsTemporalZonedDateTime(zt)&&(Ht=MoveRelativeZonedDateTime(zt,_t,At,xt,0));let Wt=BalancePossiblyInfiniteDuration(kt,Bt,Nt,Ut,Lt,jt,Kt,Vt,Ht);if(Wt==="positive overflow")return 1/0;if(Wt==="negative overflow")return-1/0;({days:kt,hours:Bt,minutes:Nt,seconds:Ut,milliseconds:Lt,microseconds:jt,nanoseconds:Kt}=Wt);const{total:Qt}=RoundDuration(_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,1,Vt,"trunc",zt);return Qt}toString(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");const _t=GetOptionsObject(e),At=ToFractionalSecondDigits(_t),xt=ToTemporalRoundingMode(_t,"trunc"),kt=GetTemporalUnit(_t,"smallestUnit","time",void 0);if(kt==="hour"||kt==="minute")throw new RangeError('smallestUnit must be a time unit other than "hours" or "minutes"');const{precision:Bt,unit:Nt,increment:Ut}=ToSecondsStringPrecisionRecord(kt,At);return TemporalDurationToString(this,Bt,{unit:Nt,increment:Ut,roundingMode:xt})}toJSON(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return TemporalDurationToString(this)}toLocaleString(e,_t){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return typeof Intl<"u"&&Intl.DurationFormat!==void 0?new Intl.DurationFormat(e,_t).format(this):(console.warn("Temporal.Duration.prototype.toLocaleString() requires Intl.DurationFormat."),TemporalDurationToString(this))}valueOf(){throw new TypeError("use compare() to compare Temporal.Duration")}static from(e){return IsTemporalDuration(e)?new Duration(GetSlot(e,w$1),GetSlot(e,D),GetSlot(e,G),GetSlot(e,v),GetSlot(e,C),GetSlot(e,O),GetSlot(e,b),GetSlot(e,E$1),GetSlot(e,M),GetSlot(e,R)):ToTemporalDuration(e)}static compare(e,_t,At){const xt=ToTemporalDuration(e),kt=ToTemporalDuration(_t),Bt=ToRelativeTemporalObject(GetOptionsObject(At)),Nt=GetSlot(xt,w$1),Ut=GetSlot(xt,D),Lt=GetSlot(xt,G);let jt=GetSlot(xt,v);const Kt=GetSlot(xt,C),qt=GetSlot(xt,O),zt=GetSlot(xt,b),Vt=GetSlot(xt,E$1),Ht=GetSlot(xt,M);let Wt=GetSlot(xt,R);const Qt=GetSlot(kt,w$1),Xt=GetSlot(kt,D),Jt=GetSlot(kt,G);let tr=GetSlot(kt,v);const dr=GetSlot(kt,C),vr=GetSlot(kt,O),$r=GetSlot(kt,b),Ir=GetSlot(kt,E$1),Rr=GetSlot(kt,M);let Nr=GetSlot(kt,R);const kr=CalculateOffsetShift(Bt,Nt,Ut,Lt,jt),lr=CalculateOffsetShift(Bt,Qt,Xt,Jt,tr);Nt===0&&Qt===0&&Ut===0&&Xt===0&&Lt===0&&Jt===0||({days:jt}=UnbalanceDurationRelative(Nt,Ut,Lt,jt,"day",Bt),{days:tr}=UnbalanceDurationRelative(Qt,Xt,Jt,tr,"day",Bt));const ir=TotalDurationNanoseconds(jt,Kt,qt,zt,Vt,Ht,Wt,kr),er=TotalDurationNanoseconds(tr,dr,vr,$r,Ir,Rr,Nr,lr);return ComparisonResult(JSBI.toNumber(JSBI.subtract(ir,er)))}}MakeIntrinsicClass(Duration,"Temporal.Duration");const bt=Object.create;class PlainMonthDay{constructor(e,_t,At="iso8601",xt=1972){CreateTemporalMonthDaySlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(_t),ToTemporalCalendarSlotValue(At),ToIntegerWithTruncation(xt))}get monthCode(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get day(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),this)}get calendarId(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}with(e,_t){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const At=GetOptionsObject(_t),xt=GetSlot(this,p),kt=CalendarFields(xt,["day","month","monthCode","year"]);let Bt=PrepareTemporalFields(this,kt,[]);return Bt=CalendarMergeFields(xt,Bt,PrepareTemporalFields(e,kt,"partial")),Bt=PrepareTemporalFields(Bt,kt,[]),CalendarMonthDayFromFields(xt,Bt,At)}equals(e){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");const _t=ToTemporalMonthDay(e);for(const At of[s$1,l,i$1])if(GetSlot(this,At)!==GetSlot(_t,At))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(_t,p))}toString(e){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return TemporalMonthDayToString(this,ToCalendarNameOption(GetOptionsObject(e)))}toJSON(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return TemporalMonthDayToString(this)}toLocaleString(e,_t){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return new ht(e,_t).format(this)}valueOf(){throw new TypeError("use equals() to compare Temporal.PlainMonthDay")}toPlainDate(e){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("argument should be an object");const _t=GetSlot(this,p),At=CalendarFields(_t,["day","monthCode"]),xt=PrepareTemporalFields(this,At,[]),kt=CalendarFields(_t,["year"]);let Bt=CalendarMergeFields(_t,xt,PrepareTemporalFields(e,kt,[]));Bt=PrepareTemporalFields(Bt,[...new Set([...At,...kt])],[]);const Nt=bt(null);return Nt.overflow="reject",CalendarDateFromFields(_t,Bt,Nt)}getISOFields(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoMonth:GetSlot(this,s$1),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,_t){const At=GetOptionsObject(_t);return IsTemporalMonthDay(e)?(ToTemporalOverflow(At),CreateTemporalMonthDay(GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,p),GetSlot(e,i$1))):ToTemporalMonthDay(e,At)}}MakeIntrinsicClass(PlainMonthDay,"Temporal.PlainMonthDay");const instant=()=>new(GetIntrinsic("%Temporal.Instant%"))(Ve()),plainDateTime=($t,e=DefaultTimeZone())=>{const _t=ToTemporalTimeZoneSlotValue(e),At=ToTemporalCalendarSlotValue($t);return GetPlainDateTimeFor(_t,instant(),At)},plainDateTimeISO=($t=DefaultTimeZone())=>GetPlainDateTimeFor(ToTemporalTimeZoneSlotValue($t),instant(),"iso8601"),zonedDateTime=($t,e=DefaultTimeZone())=>{const _t=ToTemporalTimeZoneSlotValue(e),At=ToTemporalCalendarSlotValue($t);return CreateTemporalZonedDateTime(Ve(),_t,At)},Et={instant,plainDateTime,plainDateTimeISO,plainDate:($t,e=DefaultTimeZone())=>TemporalDateTimeToDate(plainDateTime($t,e)),plainDateISO:($t=DefaultTimeZone())=>TemporalDateTimeToDate(plainDateTimeISO($t)),plainTimeISO:($t=DefaultTimeZone())=>TemporalDateTimeToTime(plainDateTimeISO($t)),timeZoneId:()=>DefaultTimeZone(),zonedDateTime,zonedDateTimeISO:($t=DefaultTimeZone())=>zonedDateTime("iso8601",$t),[Symbol.toStringTag]:"Temporal.Now"};Object.defineProperty(Et,Symbol.toStringTag,{value:"Temporal.Now",writable:!1,enumerable:!1,configurable:!0});const Mt=Object.assign;function TemporalTimeToString($t,e,_t){let At=GetSlot($t,d$1),xt=GetSlot($t,m$1),kt=GetSlot($t,c),Bt=GetSlot($t,h$1),Nt=GetSlot($t,u),Ut=GetSlot($t,T);if(_t){const{unit:Lt,increment:jt,roundingMode:Kt}=_t;({hour:At,minute:xt,second:kt,millisecond:Bt,microsecond:Nt,nanosecond:Ut}=RoundTime(At,xt,kt,Bt,Nt,Ut,jt,Lt,Kt))}return`${ISODateTimePartString(At)}:${ISODateTimePartString(xt)}${FormatSecondsStringPart(kt,Bt,Nt,Ut,e)}`}class PlainTime{constructor(e=0,_t=0,At=0,xt=0,kt=0,Bt=0){const Nt=e===void 0?0:ToIntegerWithTruncation(e),Ut=_t===void 0?0:ToIntegerWithTruncation(_t),Lt=At===void 0?0:ToIntegerWithTruncation(At),jt=xt===void 0?0:ToIntegerWithTruncation(xt),Kt=kt===void 0?0:ToIntegerWithTruncation(kt),qt=Bt===void 0?0:ToIntegerWithTruncation(Bt);RejectTime(Nt,Ut,Lt,jt,Kt,qt),N(this),SetSlot(this,d$1,Nt),SetSlot(this,m$1,Ut),SetSlot(this,c,Lt),SetSlot(this,h$1,jt),SetSlot(this,u,Kt),SetSlot(this,T,qt)}get hour(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,d$1)}get minute(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,m$1)}get second(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,c)}get millisecond(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,h$1)}get microsecond(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,u)}get nanosecond(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,T)}with(e,_t){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const At=ToTemporalOverflow(GetOptionsObject(_t)),xt=ToTemporalTimeRecord(e,"partial"),kt=ToTemporalTimeRecord(this);let{hour:Bt,minute:Nt,second:Ut,millisecond:Lt,microsecond:jt,nanosecond:Kt}=Mt(kt,xt);return{hour:Bt,minute:Nt,second:Ut,millisecond:Lt,microsecond:jt,nanosecond:Kt}=RegulateTime(Bt,Nt,Ut,Lt,jt,Kt,At),new PlainTime(Bt,Nt,Ut,Lt,jt,Kt)}add(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainTime("add",this,e)}subtract(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainTime("subtract",this,e)}until(e,_t){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainTime("until",this,e,_t)}since(e,_t){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainTime("since",this,e,_t)}round(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const _t=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),At=ToTemporalRoundingIncrement(_t),xt=ToTemporalRoundingMode(_t,"halfExpand"),kt=GetTemporalUnit(_t,"smallestUnit","time",He);ValidateTemporalRoundingIncrement(At,{hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[kt],!1);let Bt=GetSlot(this,d$1),Nt=GetSlot(this,m$1),Ut=GetSlot(this,c),Lt=GetSlot(this,h$1),jt=GetSlot(this,u),Kt=GetSlot(this,T);return{hour:Bt,minute:Nt,second:Ut,millisecond:Lt,microsecond:jt,nanosecond:Kt}=RoundTime(Bt,Nt,Ut,Lt,jt,Kt,At,kt,xt),new PlainTime(Bt,Nt,Ut,Lt,jt,Kt)}equals(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalTime(e);for(const At of[d$1,m$1,c,h$1,u,T])if(GetSlot(this,At)!==GetSlot(_t,At))return!1;return!0}toString(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");const _t=GetOptionsObject(e),At=ToFractionalSecondDigits(_t),xt=ToTemporalRoundingMode(_t,"trunc"),kt=GetTemporalUnit(_t,"smallestUnit","time",void 0);if(kt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const{precision:Bt,unit:Nt,increment:Ut}=ToSecondsStringPrecisionRecord(kt,At);return TemporalTimeToString(this,Bt,{unit:Nt,increment:Ut,roundingMode:xt})}toJSON(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return TemporalTimeToString(this,"auto")}toLocaleString(e,_t){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return new ht(e,_t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainTime")}toPlainDateTime(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e),At=GetSlot(_t,i$1),xt=GetSlot(_t,s$1),kt=GetSlot(_t,l),Bt=GetSlot(_t,p);return CreateTemporalDateTime(At,xt,kt,GetSlot(this,d$1),GetSlot(this,m$1),GetSlot(this,c),GetSlot(this,h$1),GetSlot(this,u),GetSlot(this,T),Bt)}toZonedDateTime(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");const _t=e.plainDate;if(_t===void 0)throw new TypeError("missing date property");const At=ToTemporalDate(_t),xt=e.timeZone;if(xt===void 0)throw new TypeError("missing timeZone property");const kt=ToTemporalTimeZoneSlotValue(xt),Bt=GetSlot(At,i$1),Nt=GetSlot(At,s$1),Ut=GetSlot(At,l),Lt=GetSlot(At,p),jt=GetSlot(this,d$1),Kt=GetSlot(this,m$1),qt=GetSlot(this,c),zt=GetSlot(this,h$1),Vt=GetSlot(this,u),Ht=GetSlot(this,T);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(kt,new(GetIntrinsic("%Temporal.PlainDateTime%"))(Bt,Nt,Ut,jt,Kt,qt,zt,Vt,Ht,Lt),"compatible"),n),kt,Lt)}getISOFields(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return{isoHour:GetSlot(this,d$1),isoMicrosecond:GetSlot(this,u),isoMillisecond:GetSlot(this,h$1),isoMinute:GetSlot(this,m$1),isoNanosecond:GetSlot(this,T),isoSecond:GetSlot(this,c)}}static from(e,_t){const At=ToTemporalOverflow(GetOptionsObject(_t));return IsTemporalTime(e)?new PlainTime(GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T)):ToTemporalTime(e,At)}static compare(e,_t){const At=ToTemporalTime(e),xt=ToTemporalTime(_t);for(const kt of[d$1,m$1,c,h$1,u,T]){const Bt=GetSlot(At,kt),Nt=GetSlot(xt,kt);if(Bt!==Nt)return ComparisonResult(Bt-Nt)}return 0}}MakeIntrinsicClass(PlainTime,"Temporal.PlainTime");class TimeZone{constructor(e){if(arguments.length<1)throw new RangeError("missing argument: identifier is required");const _t=GetCanonicalTimeZoneIdentifier(e);N(this),SetSlot(this,a,_t)}get id(){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetSlot(this,a)}getOffsetNanosecondsFor(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const _t=ToTemporalInstant(e),At=GetSlot(this,a);return IsTimeZoneOffsetString(At)?ParseTimeZoneOffsetString(At):GetNamedTimeZoneOffsetNanoseconds(At,GetSlot(_t,n))}getOffsetStringFor(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetOffsetStringFor(this,ToTemporalInstant(e))}getPlainDateTimeFor(e,_t="iso8601"){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetPlainDateTimeFor(this,ToTemporalInstant(e),ToTemporalCalendarSlotValue(_t))}getInstantFor(e,_t){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetInstantFor(this,ToTemporalDateTime(e),ToTemporalDisambiguation(GetOptionsObject(_t)))}getPossibleInstantsFor(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const _t=ToTemporalDateTime(e),At=GetIntrinsic("%Temporal.Instant%"),xt=GetSlot(this,a);if(IsTimeZoneOffsetString(xt)){const Bt=GetUTCEpochNanoseconds(GetSlot(_t,i$1),GetSlot(_t,s$1),GetSlot(_t,l),GetSlot(_t,d$1),GetSlot(_t,m$1),GetSlot(_t,c),GetSlot(_t,h$1),GetSlot(_t,u),GetSlot(_t,T));if(Bt===null)throw new RangeError("DateTime outside of supported range");const Nt=ParseTimeZoneOffsetString(xt);return[new At(JSBI.subtract(Bt,JSBI.BigInt(Nt)))]}return function(Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt){const Qt=GetUTCEpochNanoseconds(Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt);if(Qt===null)throw new RangeError("DateTime outside of supported range");let Xt=JSBI.subtract(Qt,Ee);JSBI.lessThan(Xt,Me)&&(Xt=Qt);let Jt=JSBI.add(Qt,Ee);JSBI.greaterThan(Jt,Re)&&(Jt=Qt);const tr=GetNamedTimeZoneOffsetNanoseconds(Nt,Xt),dr=GetNamedTimeZoneOffsetNanoseconds(Nt,Jt);return(tr===dr?[tr]:[tr,dr]).map(vr=>{const $r=JSBI.subtract(Qt,JSBI.BigInt(vr)),Ir=GetNamedTimeZoneDateTimeParts(Nt,$r);if(Ut===Ir.year&&Lt===Ir.month&&jt===Ir.day&&Kt===Ir.hour&&qt===Ir.minute&&zt===Ir.second&&Vt===Ir.millisecond&&Ht===Ir.microsecond&&Wt===Ir.nanosecond)return $r}).filter(vr=>vr!==void 0)}(xt,GetSlot(_t,i$1),GetSlot(_t,s$1),GetSlot(_t,l),GetSlot(_t,d$1),GetSlot(_t,m$1),GetSlot(_t,c),GetSlot(_t,h$1),GetSlot(_t,u),GetSlot(_t,T)).map(Bt=>new At(Bt))}getNextTransition(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const _t=ToTemporalInstant(e),At=GetSlot(this,a);if(IsTimeZoneOffsetString(At)||At==="UTC")return null;let xt=GetSlot(_t,n);const kt=GetIntrinsic("%Temporal.Instant%");return xt=GetNamedTimeZoneNextTransition(At,xt),xt===null?null:new kt(xt)}getPreviousTransition(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const _t=ToTemporalInstant(e),At=GetSlot(this,a);if(IsTimeZoneOffsetString(At)||At==="UTC")return null;let xt=GetSlot(_t,n);const kt=GetIntrinsic("%Temporal.Instant%");return xt=GetNamedTimeZonePreviousTransition(At,xt),xt===null?null:new kt(xt)}toString(){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetSlot(this,a)}toJSON(){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetSlot(this,a)}static from(e){return ToTemporalTimeZoneObject(ToTemporalTimeZoneSlotValue(e))}}MakeIntrinsicClass(TimeZone,"Temporal.TimeZone"),DefineIntrinsic("Temporal.TimeZone.prototype.getOffsetNanosecondsFor",TimeZone.prototype.getOffsetNanosecondsFor),DefineIntrinsic("Temporal.TimeZone.prototype.getPossibleInstantsFor",TimeZone.prototype.getPossibleInstantsFor);const Rt=Object.create;class PlainYearMonth{constructor(e,_t,At="iso8601",xt=1){CreateTemporalYearMonthSlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(_t),ToTemporalCalendarSlotValue(At),ToIntegerWithTruncation(xt))}get year(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),this)}get month(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),this)}get monthCode(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get calendarId(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get era(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),this)}get eraYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),this)}get daysInMonth(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),this)}get daysInYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),this)}get monthsInYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),this)}get inLeapYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),this)}with(e,_t){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const At=GetOptionsObject(_t),xt=GetSlot(this,p),kt=CalendarFields(xt,["month","monthCode","year"]);let Bt=PrepareTemporalFields(this,kt,[]);return Bt=CalendarMergeFields(xt,Bt,PrepareTemporalFields(e,kt,"partial")),Bt=PrepareTemporalFields(Bt,kt,[]),CalendarYearMonthFromFields(xt,Bt,At)}add(e,_t){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainYearMonth("add",this,e,_t)}subtract(e,_t){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainYearMonth("subtract",this,e,_t)}until(e,_t){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainYearMonth("until",this,e,_t)}since(e,_t){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainYearMonth("since",this,e,_t)}equals(e){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");const _t=ToTemporalYearMonth(e);for(const At of[i$1,s$1,l])if(GetSlot(this,At)!==GetSlot(_t,At))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(_t,p))}toString(e){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return TemporalYearMonthToString(this,ToCalendarNameOption(GetOptionsObject(e)))}toJSON(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return TemporalYearMonthToString(this)}toLocaleString(e,_t){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return new ht(e,_t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainYearMonth")}toPlainDate(e){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("argument should be an object");const _t=GetSlot(this,p),At=CalendarFields(_t,["monthCode","year"]),xt=PrepareTemporalFields(this,At,[]),kt=CalendarFields(_t,["day"]);let Bt=CalendarMergeFields(_t,xt,PrepareTemporalFields(e,kt,[]));Bt=PrepareTemporalFields(Bt,[...new Set([...At,...kt])],[]);const Nt=Rt(null);return Nt.overflow="reject",CalendarDateFromFields(_t,Bt,Nt)}getISOFields(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoMonth:GetSlot(this,s$1),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,_t){const At=GetOptionsObject(_t);return IsTemporalYearMonth(e)?(ToTemporalOverflow(At),CreateTemporalYearMonth(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,p),GetSlot(e,l))):ToTemporalYearMonth(e,At)}static compare(e,_t){const At=ToTemporalYearMonth(e),xt=ToTemporalYearMonth(_t);return CompareISODate(GetSlot(At,i$1),GetSlot(At,s$1),GetSlot(At,l),GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l))}}MakeIntrinsicClass(PlainYearMonth,"Temporal.PlainYearMonth");const Ft=ht.prototype.resolvedOptions,Yt=Object.create;class ZonedDateTime{constructor(e,_t,At="iso8601"){if(arguments.length<1)throw new TypeError("missing argument: epochNanoseconds is required");CreateTemporalZonedDateTimeSlots(this,ToBigInt(e),ToTemporalTimeZoneSlotValue(_t),ToTemporalCalendarSlotValue(At))}get calendarId(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get timeZoneId(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalTimeZoneIdentifier(GetSlot(this,g))}get year(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),dateTime(this))}get month(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),dateTime(this))}get monthCode(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),dateTime(this))}get day(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),dateTime(this))}get hour(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),d$1)}get minute(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),m$1)}get second(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),c)}get millisecond(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),h$1)}get microsecond(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),u)}get nanosecond(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),T)}get era(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),dateTime(this))}get eraYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),dateTime(this))}get epochSeconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,n);return JSBI.toNumber(BigIntFloorDiv(e,ve))}get epochMilliseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,n);return JSBI.toNumber(BigIntFloorDiv(e,Ge))}get epochMicroseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToBigIntExternal(BigIntFloorDiv(GetSlot(this,n),De))}get epochNanoseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToBigIntExternal(GetSlot(this,n))}get dayOfWeek(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfWeek(GetSlot(this,p),dateTime(this))}get dayOfYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfYear(GetSlot(this,p),dateTime(this))}get weekOfYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarWeekOfYear(GetSlot(this,p),dateTime(this))}get yearOfWeek(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarYearOfWeek(GetSlot(this,p),dateTime(this))}get hoursInDay(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=dateTime(this),_t=GetIntrinsic("%Temporal.PlainDateTime%"),At=GetSlot(e,i$1),xt=GetSlot(e,s$1),kt=GetSlot(e,l),Bt=new _t(At,xt,kt,0,0,0,0,0,0),Nt=AddISODate(At,xt,kt,0,0,0,1,"reject"),Ut=new _t(Nt.year,Nt.month,Nt.day,0,0,0,0,0,0),Lt=GetSlot(this,g),jt=GetSlot(GetInstantFor(Lt,Bt,"compatible"),n),Kt=GetSlot(GetInstantFor(Lt,Ut,"compatible"),n);return BigIntDivideToNumber(JSBI.subtract(Kt,jt),Oe)}get daysInWeek(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInWeek(GetSlot(this,p),dateTime(this))}get daysInMonth(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),dateTime(this))}get daysInYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),dateTime(this))}get monthsInYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),dateTime(this))}get inLeapYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),dateTime(this))}get offset(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetOffsetStringFor(GetSlot(this,g),GetSlot(this,S))}get offsetNanoseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetOffsetNanosecondsFor(GetSlot(this,g),GetSlot(this,S))}with(e,_t){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid zoned-date-time-like");RejectTemporalLikeObject(e);const At=GetOptionsObject(_t),xt=GetSlot(this,p);let kt=CalendarFields(xt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);kt.push("offset");let Bt=PrepareTemporalFields(this,kt,["offset"]);Bt=CalendarMergeFields(xt,Bt,PrepareTemporalFields(e,kt,"partial")),Bt=PrepareTemporalFields(Bt,kt,["offset"]);const Nt=ToTemporalDisambiguation(At),Ut=ToTemporalOffset(At,"prefer");let{year:Lt,month:jt,day:Kt,hour:qt,minute:zt,second:Vt,millisecond:Ht,microsecond:Wt,nanosecond:Qt}=InterpretTemporalDateTimeFields(xt,Bt,At);const Xt=ParseTimeZoneOffsetString(Bt.offset),Jt=GetSlot(this,g);return CreateTemporalZonedDateTime(InterpretISODateTimeOffset(Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,"option",Xt,Jt,Nt,Ut,!1),Jt,xt)}withPlainDate(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalDate(e),At=GetSlot(_t,i$1),xt=GetSlot(_t,s$1),kt=GetSlot(_t,l);let Bt=GetSlot(_t,p);const Nt=dateTime(this),Ut=GetSlot(Nt,d$1),Lt=GetSlot(Nt,m$1),jt=GetSlot(Nt,c),Kt=GetSlot(Nt,h$1),qt=GetSlot(Nt,u),zt=GetSlot(Nt,T);Bt=ConsolidateCalendars(GetSlot(this,p),Bt);const Vt=GetSlot(this,g);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(Vt,new(GetIntrinsic("%Temporal.PlainDateTime%"))(At,xt,kt,Ut,Lt,jt,Kt,qt,zt,Bt),"compatible"),n),Vt,Bt)}withPlainTime(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const _t=GetIntrinsic("%Temporal.PlainTime%"),At=e===void 0?new _t:ToTemporalTime(e),xt=dateTime(this),kt=GetSlot(xt,i$1),Bt=GetSlot(xt,s$1),Nt=GetSlot(xt,l),Ut=GetSlot(this,p),Lt=GetSlot(At,d$1),jt=GetSlot(At,m$1),Kt=GetSlot(At,c),qt=GetSlot(At,h$1),zt=GetSlot(At,u),Vt=GetSlot(At,T),Ht=GetSlot(this,g);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(Ht,new(GetIntrinsic("%Temporal.PlainDateTime%"))(kt,Bt,Nt,Lt,jt,Kt,qt,zt,Vt,Ut),"compatible"),n),Ht,Ut)}withTimeZone(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalTimeZoneSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(this,n),_t,GetSlot(this,p))}withCalendar(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalCalendarSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(this,n),GetSlot(this,g),_t)}add(e,_t){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromZonedDateTime("add",this,e,_t)}subtract(e,_t){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromZonedDateTime("subtract",this,e,_t)}until(e,_t){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalZonedDateTime("until",this,e,_t)}since(e,_t){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalZonedDateTime("since",this,e,_t)}round(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const _t=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),At=ToTemporalRoundingIncrement(_t),xt=ToTemporalRoundingMode(_t,"halfExpand"),kt=GetTemporalUnit(_t,"smallestUnit","time",He,["day"]),Bt={day:1,hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[kt];ValidateTemporalRoundingIncrement(At,Bt,Bt===1);const Nt=dateTime(this);let Ut=GetSlot(Nt,i$1),Lt=GetSlot(Nt,s$1),jt=GetSlot(Nt,l),Kt=GetSlot(Nt,d$1),qt=GetSlot(Nt,m$1),zt=GetSlot(Nt,c),Vt=GetSlot(Nt,h$1),Ht=GetSlot(Nt,u),Wt=GetSlot(Nt,T);const Qt=GetIntrinsic("%Temporal.PlainDateTime%"),Xt=GetSlot(this,g),Jt=GetSlot(this,p),tr=GetInstantFor(Xt,new Qt(GetSlot(Nt,i$1),GetSlot(Nt,s$1),GetSlot(Nt,l),0,0,0,0,0,0),"compatible"),dr=AddZonedDateTime(tr,Xt,Jt,0,0,0,1,0,0,0,0,0,0),vr=JSBI.subtract(dr,JSBI.BigInt(GetSlot(tr,n)));if(JSBI.lessThanOrEqual(vr,Ie))throw new RangeError("cannot round a ZonedDateTime in a calendar with zero or negative length days");return{year:Ut,month:Lt,day:jt,hour:Kt,minute:qt,second:zt,millisecond:Vt,microsecond:Ht,nanosecond:Wt}=RoundISODateTime(Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,At,kt,xt,JSBI.toNumber(vr)),CreateTemporalZonedDateTime(InterpretISODateTimeOffset(Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,"option",GetOffsetNanosecondsFor(Xt,GetSlot(this,S)),Xt,"compatible","prefer",!1),Xt,GetSlot(this,p))}equals(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const _t=ToTemporalZonedDateTime(e),At=GetSlot(this,n),xt=GetSlot(_t,n);return!!JSBI.equal(JSBI.BigInt(At),JSBI.BigInt(xt))&&!!TimeZoneEquals(GetSlot(this,g),GetSlot(_t,g))&&CalendarEquals(GetSlot(this,p),GetSlot(_t,p))}toString(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const _t=GetOptionsObject(e),At=ToCalendarNameOption(_t),xt=ToFractionalSecondDigits(_t),kt=function(zt){return GetOption(zt,"offset",["auto","never"],"auto")}(_t),Bt=ToTemporalRoundingMode(_t,"trunc"),Nt=GetTemporalUnit(_t,"smallestUnit","time",void 0);if(Nt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const Ut=function(zt){return GetOption(zt,"timeZoneName",["auto","never","critical"],"auto")}(_t),{precision:Lt,unit:jt,increment:Kt}=ToSecondsStringPrecisionRecord(Nt,xt);return TemporalZonedDateTimeToString(this,Lt,At,Ut,kt,{unit:jt,increment:Kt,roundingMode:Bt})}toLocaleString(e,_t){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=GetOptionsObject(_t),xt=Yt(null);if(CopyDataProperties(xt,At,["timeZone"]),At.timeZone!==void 0)throw new TypeError("ZonedDateTime toLocaleString does not accept a timeZone option");xt.year===void 0&&xt.month===void 0&&xt.day===void 0&&xt.weekday===void 0&&xt.dateStyle===void 0&&xt.hour===void 0&&xt.minute===void 0&&xt.second===void 0&&xt.timeStyle===void 0&&xt.dayPeriod===void 0&&xt.timeZoneName===void 0&&(xt.timeZoneName="short");let kt=ToTemporalTimeZoneIdentifier(GetSlot(this,g));if(IsTimeZoneOffsetString(kt))throw new RangeError("toLocaleString does not support offset string time zones");kt=GetCanonicalTimeZoneIdentifier(kt),xt.timeZone=kt;const Bt=new ht(e,xt),Nt=Call(Ft,Bt,[]).calendar,Ut=ToTemporalCalendarIdentifier(GetSlot(this,p));if(Ut!=="iso8601"&&Nt!=="iso8601"&&Nt!==Ut)throw new RangeError(`cannot format ZonedDateTime with calendar ${Ut} in locale with calendar ${Nt}`);return Bt.format(GetSlot(this,S))}toJSON(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return TemporalZonedDateTimeToString(this,"auto")}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.ZonedDateTime")}startOfDay(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=dateTime(this),_t=GetIntrinsic("%Temporal.PlainDateTime%"),At=GetSlot(this,p),xt=new _t(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),0,0,0,0,0,0,At),kt=GetSlot(this,g);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(kt,xt,"compatible"),n),kt,At)}toInstant(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return new(GetIntrinsic("%Temporal.Instant%"))(GetSlot(this,n))}toPlainDate(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToDate(dateTime(this))}toPlainTime(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToTime(dateTime(this))}toPlainDateTime(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return dateTime(this)}toPlainYearMonth(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarYearMonthFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarMonthDayFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["day","monthCode"]),[]))}getISOFields(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=dateTime(this),_t=GetSlot(this,g);return{calendar:GetSlot(this,p),isoDay:GetSlot(e,l),isoHour:GetSlot(e,d$1),isoMicrosecond:GetSlot(e,u),isoMillisecond:GetSlot(e,h$1),isoMinute:GetSlot(e,m$1),isoMonth:GetSlot(e,s$1),isoNanosecond:GetSlot(e,T),isoSecond:GetSlot(e,c),isoYear:GetSlot(e,i$1),offset:GetOffsetStringFor(_t,GetSlot(this,S)),timeZone:_t}}getCalendar(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}getTimeZone(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalTimeZoneObject(GetSlot(this,g))}static from(e,_t){const At=GetOptionsObject(_t);return IsTemporalZonedDateTime(e)?(ToTemporalDisambiguation(At),ToTemporalOffset(At,"reject"),ToTemporalOverflow(At),CreateTemporalZonedDateTime(GetSlot(e,n),GetSlot(e,g),GetSlot(e,p))):ToTemporalZonedDateTime(e,At)}static compare(e,_t){const At=ToTemporalZonedDateTime(e),xt=ToTemporalZonedDateTime(_t),kt=GetSlot(At,n),Bt=GetSlot(xt,n);return JSBI.lessThan(JSBI.BigInt(kt),JSBI.BigInt(Bt))?-1:JSBI.greaterThan(JSBI.BigInt(kt),JSBI.BigInt(Bt))?1:0}}function dateTime($t){return GetPlainDateTimeFor(GetSlot($t,g),GetSlot($t,S),GetSlot($t,p))}MakeIntrinsicClass(ZonedDateTime,"Temporal.ZonedDateTime");var Pt=Object.freeze({__proto__:null,Calendar,Duration,Instant,Now:Et,PlainDate,PlainDateTime,PlainMonthDay,PlainTime,PlainYearMonth,TimeZone,ZonedDateTime});const Zt=[Instant,Calendar,PlainDate,PlainDateTime,Duration,PlainMonthDay,PlainTime,TimeZone,PlainYearMonth,ZonedDateTime];for(const $t of Zt){const e=Object.getOwnPropertyDescriptor($t,"prototype");(e.configurable||e.enumerable||e.writable)&&(e.configurable=!1,e.enumerable=!1,e.writable=!1,Object.defineProperty($t,"prototype",e))}var __awaiter$2r=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Time{static sleep(e){return __awaiter$2r(this,void 0,void 0,function*(){return new Promise(_t=>setTimeout(_t,e))})}static minimalSleep(){return __awaiter$2r(this,void 0,void 0,function*(){yield Time.sleep(2)})}static getCurrentTimestamp(){return Pt.Now.instant().toString({smallestUnit:"microseconds"})}static createTimestamp(e){const{year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt}=e;return Pt.ZonedDateTime.from({timeZone:"UTC",year:_t,month:At,day:xt,hour:kt,minute:Bt,second:Nt,millisecond:Ut,microsecond:Lt}).toInstant().toString({smallestUnit:"microseconds"})}static createOffsetTimestamp(e,_t){const At=_t?Pt.Instant.from(_t):Pt.Now.instant(),xt=Pt.Duration.from(e);return At.add(xt).toString({smallestUnit:"microseconds"})}static validateTimestamp(e){try{Pt.Instant.from(e)}catch{throw new DwnError(DwnErrorCode.TimestampInvalid,`Invalid timestamp: ${e}`)}}}var __awaiter$2q=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$x=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class RecordsWrite{get message(){if(this._message.authorization===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingSigner,"This RecordsWrite is not yet signed, JSON message cannot be generated from an incomplete state.");return this._message}get author(){return this._author}get signaturePayload(){return this._signaturePayload}get owner(){return this._owner}get ownerSignaturePayload(){return this._ownerSignaturePayload}get isSignedByAuthorDelegate(){return Message.isSignedByAuthorDelegate(this._message)}get isSignedByOwnerDelegate(){return Message.isSignedByOwnerDelegate(this._message)}get signer(){return Message.getSigner(this._message)}get ownerSignatureSigner(){var e;return((e=this._message.authorization)===null||e===void 0?void 0:e.ownerSignature)===void 0?void 0:Jws.getSignerDid(this._message.authorization.ownerSignature.signatures[0])}constructor(e,_t){this.parentContextId=_t,this._message=e,e.authorization!==void 0&&(this._author=Message.getAuthor(e),this._signaturePayload=Jws.decodePlainObjectPayload(e.authorization.signature),e.authorization.ownerSignature!==void 0&&(e.authorization.ownerDelegatedGrant!==void 0?this._owner=Message.getSigner(e.authorization.ownerDelegatedGrant):this._owner=Jws.getSignerDid(e.authorization.ownerSignature.signatures[0]),this._ownerSignaturePayload=Jws.decodePlainObjectPayload(e.authorization.ownerSignature))),this.attesters=RecordsWrite.getAttesters(e)}static parse(e){return __awaiter$2q(this,void 0,void 0,function*(){const _t=JSON.parse(JSON.stringify(e));yield Message.validateSignatureStructure(_t.authorization.signature,_t.descriptor,"RecordsWriteSignaturePayload"),_t.authorization.ownerSignature!==void 0&&(yield Message.validateSignatureStructure(_t.authorization.ownerSignature,_t.descriptor)),yield RecordsWrite.validateAttestationIntegrity(_t);const At=new RecordsWrite(_t);return yield At.validateIntegrity(),At})}static create(e){var _t,At,xt,kt;return __awaiter$2q(this,void 0,void 0,function*(){if(e.protocol===void 0&&e.protocolPath!==void 0||e.protocol!==void 0&&e.protocolPath===void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive,"`protocol` and `protocolPath` must both be defined or undefined at the same time");if(e.data===void 0&&e.dataCid===void 0||e.data!==void 0&&e.dataCid!==void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateDataAndDataCidMutuallyExclusive,"one and only one parameter between `data` and `dataCid` is required");if(e.dataCid===void 0&&e.dataSize!==void 0||e.dataCid!==void 0&&e.dataSize===void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive,"`dataCid` and `dataSize` must both be defined or undefined at the same time");if(e.signer===void 0&&e.delegatedGrant!==void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateMissingSigner,"`signer` must be given when `delegatedGrant` is given");const Bt=(_t=e.dataCid)!==null&&_t!==void 0?_t:yield Cid.computeDagPbCidFromBytes(e.data),Nt=(At=e.dataSize)!==null&&At!==void 0?At:e.data.length,Ut=Time.getCurrentTimestamp(),Lt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,protocol:e.protocol!==void 0?normalizeProtocolUrl(e.protocol):void 0,protocolPath:e.protocolPath,recipient:e.recipient,schema:e.schema!==void 0?normalizeSchemaUrl(e.schema):void 0,tags:e.tags,parentId:RecordsWrite.getRecordIdFromContextId(e.parentContextId),dataCid:Bt,dataSize:Nt,dateCreated:(xt=e.dateCreated)!==null&&xt!==void 0?xt:Ut,messageTimestamp:(kt=e.messageTimestamp)!==null&&kt!==void 0?kt:Ut,published:e.published,datePublished:e.datePublished,dataFormat:e.dataFormat};e.published===!0&&e.datePublished===void 0&&(Lt.datePublished=Ut),removeUndefinedProperties$2(Lt);const jt=e.recordId,Kt=yield Cid.computeCid(Lt),qt=yield RecordsWrite.createAttestation(Kt,e.attestationSigners),zt=yield RecordsWrite.createEncryptionProperty(Lt,e.encryptionInput),Vt={recordId:jt,descriptor:Lt};qt!==void 0&&(Vt.attestation=qt),zt!==void 0&&(Vt.encryption=zt);const Ht=new RecordsWrite(Vt,e.parentContextId);return e.signer!==void 0&&(yield Ht.sign({signer:e.signer,delegatedGrant:e.delegatedGrant,permissionGrantId:e.permissionGrantId,protocolRole:e.protocolRole})),Ht})}static getRecordIdFromContextId(e){return e==null?void 0:e.split("/").filter(_t=>_t!=="").pop()}static createFrom(e){var _t,At,xt,kt;return __awaiter$2q(this,void 0,void 0,function*(){const Bt=e.recordsWriteMessage,Nt=yield RecordsWrite.parse(Bt),Ut=Time.getCurrentTimestamp(),Lt=(_t=e.published)!==null&&_t!==void 0?_t:e.datePublished?!0:Bt.descriptor.published;let jt;e.datePublished?jt=e.datePublished:Lt&&(Bt.descriptor.published?jt=Bt.descriptor.datePublished:jt=Ut);const Kt={recipient:Bt.descriptor.recipient,recordId:Bt.recordId,dateCreated:Bt.descriptor.dateCreated,protocol:Bt.descriptor.protocol,protocolPath:Bt.descriptor.protocolPath,schema:Bt.descriptor.schema,parentContextId:Records.getParentContextFromOfContextId(Bt.contextId),messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Ut,published:Lt,datePublished:jt,tags:e.tags,data:e.data,dataCid:e.data?void 0:Bt.descriptor.dataCid,dataSize:e.data?void 0:Bt.descriptor.dataSize,dataFormat:(xt=e.dataFormat)!==null&&xt!==void 0?xt:Bt.descriptor.dataFormat,protocolRole:(kt=e.protocolRole)!==null&&kt!==void 0?kt:Nt.signaturePayload.protocolRole,delegatedGrant:e.delegatedGrant,signer:e.signer,attestationSigners:e.attestationSigners};return yield RecordsWrite.create(Kt)})}toJSON(){return this.message}encryptSymmetricEncryptionKey(e){return __awaiter$2q(this,void 0,void 0,function*(){this._message.encryption=yield RecordsWrite.createEncryptionProperty(this._message.descriptor,e),delete this._message.authorization,this._signaturePayload=void 0,this._author=void 0})}sign(e){var _t;return __awaiter$2q(this,void 0,void 0,function*(){const{signer:At,delegatedGrant:xt,permissionGrantId:kt,protocolRole:Bt}=e;let Nt,Ut;xt!==void 0?(Nt=yield Message.getCid(xt),Ut=Jws.getSignerDid(xt.authorization.signature.signatures[0])):Ut=Jws.extractDid(At.keyId);const Lt=this._message.descriptor,jt=yield Cid.computeCid(Lt);this._message.recordId=(_t=this._message.recordId)!==null&&_t!==void 0?_t:yield RecordsWrite.getEntryId(Ut,Lt),this._message.descriptor.protocol!==void 0&&(this.parentContextId===void 0||this.parentContextId===""?this._message.contextId=this._message.recordId:this._message.contextId=this.parentContextId+"/"+this._message.recordId);const Kt=yield RecordsWrite.createSignerSignature({recordId:this._message.recordId,contextId:this._message.contextId,descriptorCid:jt,attestation:this._message.attestation,encryption:this._message.encryption,signer:At,delegatedGrantId:Nt,permissionGrantId:kt,protocolRole:Bt});this._message.authorization={signature:Kt},xt!==void 0&&(this._message.authorization.authorDelegatedGrant=xt),this._signaturePayload=Jws.decodePlainObjectPayload(Kt),this._author=Ut})}signAsOwner(e){return __awaiter$2q(this,void 0,void 0,function*(){if(this._author===void 0)throw new DwnError(DwnErrorCode.RecordsWriteSignAsOwnerUnknownAuthor,"Unable to sign as owner without message signature because owner needs to sign over `recordId` which depends on author DID.");const _t=this._message.descriptor,At=yield Message.createSignature(_t,e);this._message.authorization.ownerSignature=At,this._ownerSignaturePayload=Jws.decodePlainObjectPayload(At),this._owner=Jws.extractDid(e.keyId)})}signAsOwnerDelegate(e,_t){return __awaiter$2q(this,void 0,void 0,function*(){if(this._author===void 0)throw new DwnError(DwnErrorCode.RecordsWriteSignAsOwnerDelegateUnknownAuthor,"Unable to sign as owner delegate without message signature because owner delegate needs to sign over `recordId` which depends on author DID.");const At=yield Message.getCid(_t),xt=this._message.descriptor,kt=yield Message.createSignature(xt,e,{delegatedGrantId:At});this._message.authorization.ownerSignature=kt,this._message.authorization.ownerDelegatedGrant=_t,this._ownerSignaturePayload=Jws.decodePlainObjectPayload(kt),this._owner=Jws.getSignerDid(_t.authorization.signature.signatures[0])})}validateIntegrity(){return __awaiter$2q(this,void 0,void 0,function*(){if(yield this.isInitialWrite()){const At=this.message.descriptor.dateCreated,xt=this.message.descriptor.messageTimestamp;if(xt!==At)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityDateCreatedMismatch,`messageTimestamp ${xt} must match dateCreated ${At} for the initial write`);if(this.message.descriptor.protocol!==void 0&&this.message.descriptor.parentId===void 0){const kt=yield this.getEntryId();if(this.message.contextId!==kt)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityContextIdMismatch,`contextId in message: ${this.message.contextId} does not match deterministic contextId: ${kt}`)}}const _t=this.signaturePayload;if(this.message.recordId!==_t.recordId)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityRecordIdUnauthorized,`recordId in message ${this.message.recordId} does not match recordId in authorization: ${_t.recordId}`);if(this.message.contextId!==_t.contextId)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload,`contextId in message ${this.message.contextId} does not match contextId in authorization: ${_t.contextId}`);if(yield Records.validateDelegatedGrantReferentialIntegrity(this.message,_t,this.ownerSignaturePayload),_t.attestationCid!==void 0){const At=yield Cid.computeCid(this.message.attestation),xt=_t.attestationCid;if(xt!==At)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityAttestationMismatch,`CID ${At} of attestation property in message does not match attestationCid in authorization: ${xt}`)}if(_t.encryptionCid!==void 0){const At=yield Cid.computeCid(this.message.encryption),xt=_t.encryptionCid;if(xt!==At)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityEncryptionCidMismatch,`CID ${At} of encryption property in message does not match encryptionCid in authorization: ${xt}`)}this.message.descriptor.protocol!==void 0&&validateProtocolUrlNormalized(this.message.descriptor.protocol),this.message.descriptor.schema!==void 0&&validateSchemaUrlNormalized(this.message.descriptor.schema),Time.validateTimestamp(this.message.descriptor.messageTimestamp),Time.validateTimestamp(this.message.descriptor.dateCreated),this.message.descriptor.datePublished&&Time.validateTimestamp(this.message.descriptor.datePublished)})}static validateAttestationIntegrity(e){return __awaiter$2q(this,void 0,void 0,function*(){if(e.attestation===void 0)return;if(e.attestation.signatures.length!==1)throw new DwnError(DwnErrorCode.RecordsWriteAttestationIntegrityMoreThanOneSignature,`Currently implementation only supports 1 attester, but got ${e.attestation.signatures.length}`);const _t=Jws.decodePlainObjectPayload(e.attestation),{descriptorCid:At}=_t,xt=yield Cid.computeCid(e.descriptor);if(At!==xt)throw new DwnError(DwnErrorCode.RecordsWriteAttestationIntegrityDescriptorCidMismatch,`descriptorCid ${At} does not match expected descriptorCid ${xt}`);const kt=Object.keys(_t).length;if(kt>1)throw new DwnError(DwnErrorCode.RecordsWriteAttestationIntegrityInvalidPayloadProperty,`Only 'descriptorCid' is allowed in attestation payload, but got ${kt} properties.`)})}getEntryId(){return __awaiter$2q(this,void 0,void 0,function*(){return yield RecordsWrite.getEntryId(this.author,this.message.descriptor)})}static getEntryId(e,_t){return __awaiter$2q(this,void 0,void 0,function*(){if(e===void 0)throw new DwnError(DwnErrorCode.RecordsWriteGetEntryIdUndefinedAuthor,"Property `author` is needed to compute entry ID.");const At=Object.assign({},_t);return At.author=e,yield Cid.computeCid(At)})}isInitialWrite(){return __awaiter$2q(this,void 0,void 0,function*(){return(yield this.getEntryId())===this.message.recordId})}constructIndexes(e){return __awaiter$2q(this,void 0,void 0,function*(){const _t=this.message,At=_t.descriptor,{tags:xt}=At,kt=__rest$x(At,["tags"]);delete kt.published;let Bt=Object.assign(Object.assign({},kt),{isLatestBaseState:e,published:!!_t.descriptor.published,author:this.author,recordId:_t.recordId,entryId:yield RecordsWrite.getEntryId(this.author,this.message.descriptor)});if(xt!==void 0&&e===!0){const Nt=Records.buildTagIndexes(Object.assign({},xt));Bt=Object.assign(Object.assign({},Bt),Nt)}return this.attesters.length>0&&(Bt.attester=this.attesters[0]),_t.contextId!==void 0&&(Bt.contextId=_t.contextId),Bt})}authorizeAuthorDelegate(e){return __awaiter$2q(this,void 0,void 0,function*(){const _t=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeWrite({recordsWriteMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:_t,messageStore:e})})}authorizeOwnerDelegate(e){return __awaiter$2q(this,void 0,void 0,function*(){const _t=yield PermissionGrant$1.parse(this.message.authorization.ownerDelegatedGrant);yield RecordsGrantAuthorization.authorizeWrite({recordsWriteMessage:this.message,expectedGrantor:this.owner,expectedGrantee:this.ownerSignatureSigner,permissionGrant:_t,messageStore:e})})}static isInitialWrite(e){return __awaiter$2q(this,void 0,void 0,function*(){if(e.descriptor.interface!==DwnInterfaceName.Records||e.descriptor.method!==DwnMethodName.Write)return!1;const _t=e,At=Message.getAuthor(_t);return(yield RecordsWrite.getEntryId(At,_t.descriptor))===_t.recordId})}static createEncryptionProperty(e,_t){var At,xt;return __awaiter$2q(this,void 0,void 0,function*(){if(_t===void 0)return;const kt=[];for(const Nt of _t.keyEncryptionInputs){if(Nt.derivationScheme===KeyDerivationScheme.ProtocolPath&&e.protocol===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingProtocol,"`protocols` encryption scheme cannot be applied to record without the `protocol` property.");if(Nt.derivationScheme===KeyDerivationScheme.Schemas&&e.schema===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingSchema,"`schemas` encryption scheme cannot be applied to record without the `schema` property.");const Ut=Secp256k1$3.publicJwkToBytes(Nt.publicKey),Lt=yield Encryption.eciesSecp256k1Encrypt(Ut,_t.key),jt=Encoder$4.bytesToBase64Url(Lt.ciphertext),Kt=yield Secp256k1$3.publicKeyToJwk(Lt.ephemeralPublicKey),qt=Encoder$4.bytesToBase64Url(Lt.initializationVector),zt=Encoder$4.bytesToBase64Url(Lt.messageAuthenticationCode),Vt={rootKeyId:Nt.publicKeyId,algorithm:(At=Nt.algorithm)!==null&&At!==void 0?At:EncryptionAlgorithm.EciesSecp256k1,derivationScheme:Nt.derivationScheme,ephemeralPublicKey:Kt,initializationVector:qt,messageAuthenticationCode:zt,encryptedKey:jt};Nt.derivationScheme===KeyDerivationScheme.ProtocolContext&&(Vt.derivedPublicKey=Nt.publicKey),kt.push(Vt)}return{algorithm:(xt=_t.algorithm)!==null&&xt!==void 0?xt:EncryptionAlgorithm.Aes256Ctr,initializationVector:Encoder$4.bytesToBase64Url(_t.initializationVector),keyEncryption:kt}})}static createAttestation(e,_t){return __awaiter$2q(this,void 0,void 0,function*(){if(_t===void 0||_t.length===0)return;const At={descriptorCid:e},xt=Encoder$4.objectToBytes(At);return(yield GeneralJwsBuilder.create(xt,_t)).getJws()})}static createSignerSignature(e){return __awaiter$2q(this,void 0,void 0,function*(){const{recordId:_t,contextId:At,descriptorCid:xt,attestation:kt,encryption:Bt,signer:Nt,delegatedGrantId:Ut,permissionGrantId:Lt,protocolRole:jt}=e,Kt=kt?yield Cid.computeCid(kt):void 0,qt=Bt?yield Cid.computeCid(Bt):void 0,zt={recordId:_t,descriptorCid:xt,contextId:At,attestationCid:Kt,encryptionCid:qt,delegatedGrantId:Ut,permissionGrantId:Lt,protocolRole:jt};removeUndefinedProperties$2(zt);const Vt=Encoder$4.objectToBytes(zt);return(yield GeneralJwsBuilder.create(Vt,[Nt])).getJws()})}static getInitialWrite(e){return __awaiter$2q(this,void 0,void 0,function*(){for(const _t of e)if(yield RecordsWrite.isInitialWrite(_t))return _t;throw new DwnError(DwnErrorCode.RecordsWriteGetInitialWriteNotFound,"Initial write is not found.")})}static verifyEqualityOfImmutableProperties(e,_t){const At=["dataCid","dataSize","dataFormat","datePublished","published","messageTimestamp","tags"];let xt=[];xt.push(...Object.keys(e.descriptor)),xt.push(...Object.keys(_t.descriptor)),xt=[...new Set(xt)];for(const kt of xt)if(At.indexOf(kt)===-1){const Bt=e.descriptor[kt],Nt=_t.descriptor[kt];if(Nt!==Bt)throw new DwnError(DwnErrorCode.RecordsWriteImmutablePropertyChanged,`${kt} is an immutable property: cannot change '${Bt}' to '${Nt}'`)}return!0}static getAttesters(e){var _t,At;return((At=(_t=e.attestation)===null||_t===void 0?void 0:_t.signatures)!==null&&At!==void 0?At:[]).map(Bt=>Jws.getSignerDid(Bt))}static fetchNewestRecordsWrite(e,_t,At){return __awaiter$2q(this,void 0,void 0,function*(){const xt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,recordId:At},{messages:kt}=yield e.query(_t,[xt]),Bt=yield Message.getNewestMessage(kt);if(Bt!==void 0)return Bt;throw new DwnError(DwnErrorCode.RecordsWriteGetNewestWriteRecordNotFound,"record not found")})}static fetchInitialRecordsWrite(e,_t,At){return __awaiter$2q(this,void 0,void 0,function*(){const xt={entryId:At},{messages:kt}=yield e.query(_t,[xt]);return kt.length===0?void 0:yield RecordsWrite.parse(kt[0])})}}var __awaiter$2p=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function authenticate($t,e){return __awaiter$2p(this,void 0,void 0,function*(){if($t===void 0)throw new DwnError(DwnErrorCode.AuthenticateJwsMissing,"Missing JWS.");if(yield GeneralJwsVerifier.verifySignatures($t.signature,e),$t.ownerSignature!==void 0&&(yield GeneralJwsVerifier.verifySignatures($t.ownerSignature,e)),$t.authorDelegatedGrant!==void 0){const _t=yield RecordsWrite.parse($t.authorDelegatedGrant);yield GeneralJwsVerifier.verifySignatures(_t.message.authorization.signature,e)}if($t.ownerDelegatedGrant!==void 0){const _t=yield RecordsWrite.parse($t.ownerDelegatedGrant);yield GeneralJwsVerifier.verifySignatures(_t.message.authorization.signature,e)}})}var __awaiter$2o=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class AllowAllTenantGate{isActiveTenant(e){return __awaiter$2o(this,void 0,void 0,function*(){return{isActiveTenant:!0}})}}class AbstractMessage{get message(){return this._message}get signer(){return this._signer}get author(){return this._author}get signaturePayload(){return this._signaturePayload}get isSignedByAuthorDelegate(){return Message.isSignedByAuthorDelegate(this._message)}constructor(e){this._message=e,e.authorization!==void 0&&(this._signer=Message.getSigner(e),e.authorization.authorDelegatedGrant!==void 0?this._author=Message.getSigner(e.authorization.authorDelegatedGrant):this._author=this._signer,this._signaturePayload=Jws.decodePlainObjectPayload(e.authorization.signature))}toJSON(){return this.message}}var __awaiter$2n=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsQuery extends AbstractMessage{static parse(e){return __awaiter$2n(this,void 0,void 0,function*(){if(e.descriptor.filter.published===!1&&(e.descriptor.dateSort===DateSort.PublishedAscending||e.descriptor.dateSort===DateSort.PublishedDescending))throw new DwnError(DwnErrorCode.RecordsQueryParseFilterPublishedSortInvalid,`queries must not filter for \`published:false\` and sort by ${e.descriptor.dateSort}`);let _t;if(e.authorization!==void 0&&(_t=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,_t),(_t==null?void 0:_t.protocolRole)!==void 0&&e.descriptor.filter.protocolPath===void 0)throw new DwnError(DwnErrorCode.RecordsQueryFilterMissingRequiredProperties,"Role-authorized queries must include `protocolPath` in the filter");return e.descriptor.filter.protocol!==void 0&&validateProtocolUrlNormalized(e.descriptor.filter.protocol),e.descriptor.filter.schema!==void 0&&validateSchemaUrlNormalized(e.descriptor.filter.schema),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsQuery(e)})}static create(e){var _t;return __awaiter$2n(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Records,method:DwnMethodName.Query,messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Time.getCurrentTimestamp(),filter:Records.normalizeFilter(e.filter),dateSort:e.dateSort,pagination:e.pagination};if(e.filter.published===!1&&(e.dateSort===DateSort.PublishedAscending||e.dateSort===DateSort.PublishedDescending))throw new DwnError(DwnErrorCode.RecordsQueryCreateFilterPublishedSortInvalid,`queries must not filter for \`published:false\` and sort by ${e.dateSort}`);removeUndefinedProperties$2(At);const xt=e.signer;let kt;xt&&(kt=yield Message.createAuthorization({descriptor:At,signer:xt,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}));const Bt={descriptor:At,authorization:kt};return Message.validateJsonSchema(Bt),new RecordsQuery(Bt)})}authorizeDelegate(e){return __awaiter$2n(this,void 0,void 0,function*(){const _t=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:this.message,expectedGrantee:this.signer,expectedGrantor:this.author,permissionGrant:_t,messageStore:e})})}}var __awaiter$2m=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DataStream{static toBytes(e){return __awaiter$2m(this,void 0,void 0,function*(){return new Promise((_t,At)=>{const xt=[];e.on("data",kt=>{xt.push(kt)}),e.on("end",()=>{const kt=DataStream.concatenateArrayOfBytes(xt);_t(kt)}),e.on("error",At)})})}static toObject(e){return __awaiter$2m(this,void 0,void 0,function*(){const _t=yield DataStream.toBytes(e);return Encoder$4.bytesToObject(_t)})}static concatenateArrayOfBytes(e){const _t=e.reduce((kt,Bt)=>kt+Bt.length,0),At=new Uint8Array(_t);let xt=0;for(const kt of e)At.set(kt,xt),xt+=kt.length;return At}static fromBytes(e){let At=0;return new browserExports$1.Readable({read(kt){At+1e5>e.length?(this.push(e.subarray(At)),this.push(null)):(this.push(e.subarray(At,At+1e5)),At=At+1e5)}})}static fromObject(e){const _t=Encoder$4.objectToBytes(e);return DataStream.fromBytes(_t)}static duplicateDataStream(e,_t){const At=[];for(let xt=0;xt<_t;xt++){const kt=new browserExports$1.PassThrough;e.pipe(kt),At.push(kt)}return At}}function messageReplyFromError($t,e){const _t=$t instanceof Error?$t.message:"Error";return{status:{code:e,detail:_t}}}var __awaiter$2l=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let PermissionRequest$1=class Fo{static parse(e){return __awaiter$2l(this,void 0,void 0,function*(){return new Fo(e)})}constructor(e){this.id=e.recordId,this.requester=Message.getSigner(e);const _t=e.encodedData,At=Encoder$4.base64UrlToObject(_t);this.delegated=At.delegated,this.description=At.description,this.scope=At.scope,this.conditions=At.conditions}};var __awaiter$2k=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class PermissionsProtocol{static parseRequest(e){return Encoder$4.base64UrlToObject(e)}static createRequest(e){return __awaiter$2k(this,void 0,void 0,function*(){if(this.isRecordPermissionScope(e.scope)&&e.scope.protocol===void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolCreateRequestRecordsScopeMissingProtocol,"Permission request for Records must have a scope with a `protocol` property");const _t=PermissionsProtocol.normalizePermissionScope(e.scope),At={description:e.description,delegated:e.delegated,scope:_t,conditions:e.conditions};let xt;this.hasProtocolScope(_t)&&(xt={protocol:_t.protocol});const kt=Encoder$4.objectToBytes(At),Bt=yield RecordsWrite.create({signer:e.signer,messageTimestamp:e.dateRequested,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,dataFormat:"application/json",data:kt,tags:xt}),Nt=Object.assign(Object.assign({},Bt.message),{encodedData:Encoder$4.bytesToBase64Url(kt)});return{recordsWrite:Bt,permissionRequestData:At,permissionRequestBytes:kt,dataEncodedMessage:Nt}})}static createGrant(e){return __awaiter$2k(this,void 0,void 0,function*(){if(this.isRecordPermissionScope(e.scope)&&e.scope.protocol===void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolCreateGrantRecordsScopeMissingProtocol,"Permission grants for Records must have a scope with a `protocol` property");const _t=PermissionsProtocol.normalizePermissionScope(e.scope),At={dateExpires:e.dateExpires,requestId:e.requestId,description:e.description,delegated:e.delegated,scope:_t,conditions:e.conditions};let xt;this.hasProtocolScope(_t)&&(xt={protocol:_t.protocol});const kt=Encoder$4.objectToBytes(At),Bt=yield RecordsWrite.create({signer:e.signer,messageTimestamp:e.dateGranted,dateCreated:e.dateGranted,recipient:e.grantedTo,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,dataFormat:"application/json",data:kt,tags:xt}),Nt=Object.assign(Object.assign({},Bt.message),{encodedData:Encoder$4.bytesToBase64Url(kt)});return{recordsWrite:Bt,permissionGrantData:At,permissionGrantBytes:kt,dataEncodedMessage:Nt}})}static createRevocation(e){return __awaiter$2k(this,void 0,void 0,function*(){const _t={description:e.description},At=e.grant.id;let xt;this.hasProtocolScope(e.grant.scope)&&(xt={protocol:normalizeProtocolUrl(e.grant.scope.protocol)});const kt=Encoder$4.objectToBytes(_t),Bt=yield RecordsWrite.create({signer:e.signer,parentContextId:At,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath,dataFormat:"application/json",data:kt,tags:xt}),Nt=Object.assign(Object.assign({},Bt.message),{encodedData:Encoder$4.bytesToBase64Url(kt)});return{recordsWrite:Bt,permissionRevocationData:_t,permissionRevocationBytes:kt,dataEncodedMessage:Nt}})}static validateSchema(e,_t){const At=Encoder$4.bytesToString(_t),xt=JSON.parse(At);if(e.descriptor.protocolPath===PermissionsProtocol.requestPath){const kt=xt;validateJsonSchema("PermissionRequestData",kt),PermissionsProtocol.validateScopeAndTags(kt.scope,e)}else if(e.descriptor.protocolPath===PermissionsProtocol.grantPath){validateJsonSchema("PermissionGrantData",xt);const kt=xt;PermissionsProtocol.validateScopeAndTags(kt.scope,e),Time.validateTimestamp(kt.dateExpires)}else if(e.descriptor.protocolPath===PermissionsProtocol.revocationPath)validateJsonSchema("PermissionRevocationData",xt);else throw new DwnError(DwnErrorCode.PermissionsProtocolValidateSchemaUnexpectedRecord,`Unexpected permission record: ${e.descriptor.protocolPath}`)}static fetchGrant(e,_t,At){return __awaiter$2k(this,void 0,void 0,function*(){const xt={recordId:At,isLatestBaseState:!0},{messages:kt}=yield _t.query(e,[xt]),Bt=kt[0],Nt=Bt==null?void 0:Bt.descriptor.interface,Ut=Bt==null?void 0:Bt.descriptor.method;if(Nt!==DwnInterfaceName.Records||Ut!==DwnMethodName.Write||Bt.descriptor.protocolPath!==PermissionsProtocol.grantPath)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantMissing,`Could not find permission grant with record ID ${At}.`);const Lt=Bt;return yield PermissionGrant$1.parse(Lt)})}static getScopeFromPermissionRecord(e,_t,At){return __awaiter$2k(this,void 0,void 0,function*(){if(At.descriptor.protocol!==PermissionsProtocol.uri)throw new DwnError(DwnErrorCode.PermissionsProtocolGetScopeInvalidProtocol,`Unexpected protocol for permission record: ${At.descriptor.protocol}`);return At.descriptor.protocolPath===PermissionsProtocol.revocationPath?(yield PermissionsProtocol.fetchGrant(e,_t,At.descriptor.parentId)).scope:At.descriptor.protocolPath===PermissionsProtocol.grantPath?(yield PermissionGrant$1.parse(At)).scope:(yield PermissionRequest$1.parse(At)).scope})}static normalizePermissionScope(e){const _t=Object.assign({},e);return PermissionsProtocol.hasProtocolScope(_t)&&(_t.protocol=normalizeProtocolUrl(_t.protocol)),_t}static isRecordPermissionScope(e){return e.interface==="Records"}static hasProtocolScope(e){return"protocol"in e&&e.protocol!==void 0}static validateTags(e,_t){if(e.descriptor.tags===void 0||e.descriptor.tags.protocol===void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateScopeMissingProtocolTag,"Permission grants must have a `tags` property that contains a protocol tag");const At=e.descriptor.tags.protocol;if(At!==_t)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateScopeProtocolMismatch,`Permission grants must have a scope with a protocol that matches the tagged protocol: ${At}`)}static validateScopeAndTags(e,_t){if(this.hasProtocolScope(e)&&(validateProtocolUrlNormalized(e.protocol),this.validateTags(_t,e.protocol)),!!this.isRecordPermissionScope(e)&&e.contextId!==void 0&&e.protocolPath!==void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateScopeContextIdProhibitedProperties,"Permission grants cannot have both `contextId` and `protocolPath` present")}}PermissionsProtocol.uri="https://tbd.website/dwn/permissions";PermissionsProtocol.requestPath="request";PermissionsProtocol.grantPath="grant";PermissionsProtocol.revocationPath="grant/revocation";PermissionsProtocol.definition={published:!0,protocol:PermissionsProtocol.uri,types:{request:{dataFormats:["application/json"]},grant:{dataFormats:["application/json"]},revocation:{dataFormats:["application/json"]}},structure:{request:{$size:{max:1e4},$actions:[{who:"anyone",can:["create"]}]},grant:{$size:{max:1e4},$actions:[{who:"recipient",of:"grant",can:["read","query"]}],revocation:{$size:{max:1e4},$actions:[{who:"anyone",can:["read"]}]}}}};class Messages{static normalizeFilters(e){const _t=[];for(const At of e){const xt=At.protocol!==void 0?normalizeProtocolUrl(At.protocol):void 0,kt=Object.assign(Object.assign({},At),{protocol:xt});removeUndefinedProperties$2(kt),isEmptyObject$1(kt)||_t.push(kt)}return _t}static convertFilters(e){const _t=[];for(const At of e){const xt=this.constructPermissionRecordsFilter(At);xt&&_t.push(xt),_t.push(this.convertFilter(At))}return _t}static constructPermissionRecordsFilter(e){const{protocol:_t,messageTimestamp:At}=e;if(_t!==void 0){const xt=Object.assign({protocol:PermissionsProtocol.uri},Records.convertTagsFilter({protocol:_t}));if(At!=null){const kt=FilterUtility.convertRangeCriterion(At);kt&&(xt.messageTimestamp=kt)}return xt}}static convertFilter(e){const _t=Object.assign({},e),{messageTimestamp:At}=e,xt=At?FilterUtility.convertRangeCriterion(At):void 0;return xt&&(_t.messageTimestamp=xt,delete _t.dateUpdated),_t}}var __awaiter$2j=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesGrantAuthorization{static authorizeMessagesRead(e){return __awaiter$2j(this,void 0,void 0,function*(){const{messagesReadMessage:_t,messageToRead:At,expectedGrantor:xt,expectedGrantee:kt,permissionGrant:Bt,messageStore:Nt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:xt,expectedGrantee:kt,permissionGrant:Bt,messageStore:Nt});const Ut=Bt.scope;yield MessagesGrantAuthorization.verifyScope(xt,At,Ut,Nt)})}static authorizeQueryOrSubscribe(e){return __awaiter$2j(this,void 0,void 0,function*(){const{incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}=e;if(yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}),PermissionsProtocol.hasProtocolScope(kt.scope)){const Nt=kt.scope.protocol;for(const Ut of _t.descriptor.filters)if(Ut.protocol!==Nt)throw new DwnError(DwnErrorCode.MessagesGrantAuthorizationMismatchedProtocol,`The protocol ${Ut.protocol} does not match the scoped protocol ${Nt}`)}})}static verifyScope(e,_t,At,xt){return __awaiter$2j(this,void 0,void 0,function*(){if(At.protocol!==void 0){if(_t.descriptor.interface===DwnInterfaceName.Records){const kt=_t,Bt=Records.isRecordsWrite(kt)?kt:yield RecordsWrite.fetchNewestRecordsWrite(xt,e,kt.descriptor.recordId);if(Bt.descriptor.protocol===At.protocol)return;if(Bt.descriptor.protocol===PermissionsProtocol.uri){const Nt=yield PermissionsProtocol.getScopeFromPermissionRecord(e,xt,Bt);if(PermissionsProtocol.hasProtocolScope(Nt)&&Nt.protocol===At.protocol)return}}else if(_t.descriptor.interface===DwnInterfaceName.Protocols&&_t.descriptor.definition.protocol===At.protocol)return;throw new DwnError(DwnErrorCode.MessagesReadVerifyScopeFailed,"record message failed scope authorization")}})}}var __awaiter$2i=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesQuery extends AbstractMessage{static parse(e){return __awaiter$2i(this,void 0,void 0,function*(){Message.validateJsonSchema(e),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor);for(const _t of e.descriptor.filters)"protocol"in _t&&_t.protocol!==void 0&&validateProtocolUrlNormalized(_t.protocol);return new MessagesQuery(e)})}static create(e){var _t;return __awaiter$2i(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Messages,method:DwnMethodName.Query,filters:e.filters?Messages.normalizeFilters(e.filters):[],messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Time.getCurrentTimestamp(),cursor:e.cursor};removeUndefinedProperties$2(At);const{permissionGrantId:xt,signer:kt}=e,Bt=yield Message.createAuthorization({descriptor:At,signer:kt,permissionGrantId:xt}),Nt={descriptor:At,authorization:Bt};return Message.validateJsonSchema(Nt),new MessagesQuery(Nt)})}}var __awaiter$2h=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesQueryHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.eventLog=At}handle({tenant:e,message:_t}){return __awaiter$2h(this,void 0,void 0,function*(){let At;try{At=yield MessagesQuery.parse(_t)}catch(Nt){return messageReplyFromError(Nt,400)}try{yield authenticate(_t.authorization,this.didResolver),yield MessagesQueryHandler.authorizeMessagesQuery(e,At,this.messageStore)}catch(Nt){return messageReplyFromError(Nt,401)}const xt=Messages.convertFilters(_t.descriptor.filters),{events:kt,cursor:Bt}=yield this.eventLog.queryEvents(e,xt,_t.descriptor.cursor);return{status:{code:200,detail:"OK"},entries:kt,cursor:Bt}})}static authorizeMessagesQuery(e,_t,At){return __awaiter$2h(this,void 0,void 0,function*(){if(_t.author!==e)if(_t.author!==void 0&&_t.signaturePayload.permissionGrantId!==void 0){const xt=yield PermissionsProtocol.fetchGrant(e,At,_t.signaturePayload.permissionGrantId);yield MessagesGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:_t.message,expectedGrantor:e,expectedGrantee:_t.author,permissionGrant:xt,messageStore:At})}else throw new DwnError(DwnErrorCode.MessagesQueryAuthorizationFailed,"message failed authorization")})}}var __awaiter$2g=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesRead extends AbstractMessage{static parse(e){return __awaiter$2g(this,void 0,void 0,function*(){return Message.validateJsonSchema(e),this.validateMessageCid(e.descriptor.messageCid),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor),Time.validateTimestamp(e.descriptor.messageTimestamp),new MessagesRead(e)})}static create(e){var _t;return __awaiter$2g(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Messages,method:DwnMethodName.Read,messageCid:e.messageCid,messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Time.getCurrentTimestamp()},{signer:xt,permissionGrantId:kt}=e,Bt=yield Message.createAuthorization({descriptor:At,signer:xt,permissionGrantId:kt}),Nt={descriptor:At,authorization:Bt};return Message.validateJsonSchema(Nt),MessagesRead.validateMessageCid(e.messageCid),new MessagesRead(Nt)})}static validateMessageCid(e){try{Cid.parseCid(e)}catch{throw new DwnError(DwnErrorCode.MessagesReadInvalidCid,`${e} is not a valid CID`)}}}var __awaiter$2f=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesReadHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.dataStore=At}handle({tenant:e,message:_t}){return __awaiter$2f(this,void 0,void 0,function*(){let At;try{At=yield MessagesRead.parse(_t)}catch(Bt){return messageReplyFromError(Bt,400)}try{yield authenticate(_t.authorization,this.didResolver)}catch(Bt){return messageReplyFromError(Bt,401)}const xt=yield this.messageStore.get(e,_t.descriptor.messageCid);if(xt===void 0)return{status:{code:404,detail:"Not Found"}};try{yield MessagesReadHandler.authorizeMessagesRead(e,At,xt,this.messageStore)}catch(Bt){return messageReplyFromError(Bt,401)}const kt={message:xt,messageCid:_t.descriptor.messageCid};if(Records.isRecordsWrite(xt)){const Bt=kt.message;if(Bt.encodedData!==void 0){const Nt=Encoder$4.base64UrlToBytes(Bt.encodedData);kt.data=DataStream.fromBytes(Nt),delete Bt.encodedData}else{const Nt=yield this.dataStore.get(e,Bt.recordId,Bt.descriptor.dataCid);(Nt==null?void 0:Nt.dataStream)!==void 0&&(kt.data=Nt.dataStream)}}return{status:{code:200,detail:"OK"},entry:kt}})}static authorizeMessagesRead(e,_t,At,xt){return __awaiter$2f(this,void 0,void 0,function*(){if(_t.author!==e)if(_t.author!==void 0&&_t.signaturePayload.permissionGrantId!==void 0){const kt=yield PermissionsProtocol.fetchGrant(e,xt,_t.signaturePayload.permissionGrantId);yield MessagesGrantAuthorization.authorizeMessagesRead({messagesReadMessage:_t.message,messageToRead:At,expectedGrantor:e,expectedGrantee:_t.author,permissionGrant:kt,messageStore:xt})}else throw new DwnError(DwnErrorCode.MessagesReadAuthorizationFailed,"protocol message failed authorization")})}}var __awaiter$2e=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesSubscribe extends AbstractMessage{static parse(e){return __awaiter$2e(this,void 0,void 0,function*(){Message.validateJsonSchema(e),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor);for(const _t of e.descriptor.filters)"protocol"in _t&&_t.protocol!==void 0&&validateProtocolUrlNormalized(_t.protocol);return Time.validateTimestamp(e.descriptor.messageTimestamp),new MessagesSubscribe(e)})}static create(e){var _t,At;return __awaiter$2e(this,void 0,void 0,function*(){const xt=Time.getCurrentTimestamp(),kt={interface:DwnInterfaceName.Messages,method:DwnMethodName.Subscribe,filters:(_t=e.filters)!==null&&_t!==void 0?_t:[],messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:xt};removeUndefinedProperties$2(kt);const{permissionGrantId:Bt,signer:Nt}=e,Ut=yield Message.createAuthorization({descriptor:kt,signer:Nt,permissionGrantId:Bt}),Lt={descriptor:kt,authorization:Ut};return Message.validateJsonSchema(Lt),new MessagesSubscribe(Lt)})}}var __awaiter$2d=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessagesSubscribeHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.eventStream=At}handle({tenant:e,message:_t,subscriptionHandler:At}){return __awaiter$2d(this,void 0,void 0,function*(){if(this.eventStream===void 0)return messageReplyFromError(new DwnError(DwnErrorCode.MessagesSubscribeEventStreamUnimplemented,"Subscriptions are not supported"),501);let xt;try{xt=yield MessagesSubscribe.parse(_t)}catch(jt){return messageReplyFromError(jt,400)}try{yield authenticate(_t.authorization,this.didResolver),yield MessagesSubscribeHandler.authorizeMessagesSubscribe(e,xt,this.messageStore)}catch(jt){return messageReplyFromError(jt,401)}const{filters:kt}=_t.descriptor,Bt=Messages.convertFilters(kt),Nt=yield Message.getCid(_t),Ut=(jt,Kt,qt)=>{e===jt&&FilterUtility.matchAnyFilter(qt,Bt)&&At(Kt)},Lt=yield this.eventStream.subscribe(e,Nt,Ut);return{status:{code:200,detail:"OK"},subscription:Lt}})}static authorizeMessagesSubscribe(e,_t,At){return __awaiter$2d(this,void 0,void 0,function*(){if(_t.author!==e)if(_t.author!==void 0&&_t.signaturePayload.permissionGrantId!==void 0){const xt=yield PermissionsProtocol.fetchGrant(e,At,_t.signaturePayload.permissionGrantId);yield MessagesGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:_t.message,expectedGrantor:e,expectedGrantee:_t.author,permissionGrant:xt,messageStore:At})}else throw new DwnError(DwnErrorCode.MessagesSubscribeAuthorizationFailed,"message failed authorization")})}}var _2020={exports:{}},core$3={},validate={},boolSchema={},errors$1={},codegen={},code$2={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.regexpCode=$t.getEsmExportName=$t.getProperty=$t.safeStringify=$t.stringify=$t.strConcat=$t.addCodeArg=$t.str=$t._=$t.nil=$t._Code=$t.Name=$t.IDENTIFIER=$t._CodeOrName=void 0;class e{}$t._CodeOrName=e,$t.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class _t extends e{constructor(Xt){if(super(),!$t.IDENTIFIER.test(Xt))throw new Error("CodeGen: name must be a valid identifier");this.str=Xt}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}$t.Name=_t;class At extends e{constructor(Xt){super(),this._items=typeof Xt=="string"?[Xt]:Xt}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const Xt=this._items[0];return Xt===""||Xt==='""'}get str(){var Xt;return(Xt=this._str)!==null&&Xt!==void 0?Xt:this._str=this._items.reduce((Jt,tr)=>`${Jt}${tr}`,"")}get names(){var Xt;return(Xt=this._names)!==null&&Xt!==void 0?Xt:this._names=this._items.reduce((Jt,tr)=>(tr instanceof _t&&(Jt[tr.str]=(Jt[tr.str]||0)+1),Jt),{})}}$t._Code=At,$t.nil=new At("");function xt(Qt,...Xt){const Jt=[Qt[0]];let tr=0;for(;tr<Xt.length;)Nt(Jt,Xt[tr]),Jt.push(Qt[++tr]);return new At(Jt)}$t._=xt;const kt=new At("+");function Bt(Qt,...Xt){const Jt=[zt(Qt[0])];let tr=0;for(;tr<Xt.length;)Jt.push(kt),Nt(Jt,Xt[tr]),Jt.push(kt,zt(Qt[++tr]));return Ut(Jt),new At(Jt)}$t.str=Bt;function Nt(Qt,Xt){Xt instanceof At?Qt.push(...Xt._items):Xt instanceof _t?Qt.push(Xt):Qt.push(Kt(Xt))}$t.addCodeArg=Nt;function Ut(Qt){let Xt=1;for(;Xt<Qt.length-1;){if(Qt[Xt]===kt){const Jt=Lt(Qt[Xt-1],Qt[Xt+1]);if(Jt!==void 0){Qt.splice(Xt-1,3,Jt);continue}Qt[Xt++]="+"}Xt++}}function Lt(Qt,Xt){if(Xt==='""')return Qt;if(Qt==='""')return Xt;if(typeof Qt=="string")return Xt instanceof _t||Qt[Qt.length-1]!=='"'?void 0:typeof Xt!="string"?`${Qt.slice(0,-1)}${Xt}"`:Xt[0]==='"'?Qt.slice(0,-1)+Xt.slice(1):void 0;if(typeof Xt=="string"&&Xt[0]==='"'&&!(Qt instanceof _t))return`"${Qt}${Xt.slice(1)}`}function jt(Qt,Xt){return Xt.emptyStr()?Qt:Qt.emptyStr()?Xt:Bt`${Qt}${Xt}`}$t.strConcat=jt;function Kt(Qt){return typeof Qt=="number"||typeof Qt=="boolean"||Qt===null?Qt:zt(Array.isArray(Qt)?Qt.join(","):Qt)}function qt(Qt){return new At(zt(Qt))}$t.stringify=qt;function zt(Qt){return JSON.stringify(Qt).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}$t.safeStringify=zt;function Vt(Qt){return typeof Qt=="string"&&$t.IDENTIFIER.test(Qt)?new At(`.${Qt}`):xt`[${Qt}]`}$t.getProperty=Vt;function Ht(Qt){if(typeof Qt=="string"&&$t.IDENTIFIER.test(Qt))return new At(`${Qt}`);throw new Error(`CodeGen: invalid export name: ${Qt}, use explicit $id name mapping`)}$t.getEsmExportName=Ht;function Wt(Qt){return new At(Qt.toString())}$t.regexpCode=Wt})(code$2);var scope$1={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.ValueScope=$t.ValueScopeName=$t.Scope=$t.varKinds=$t.UsedValueState=void 0;const e=code$2;class _t extends Error{constructor(Lt){super(`CodeGen: "code" for ${Lt} not defined`),this.value=Lt.value}}var At;(function(Ut){Ut[Ut.Started=0]="Started",Ut[Ut.Completed=1]="Completed"})(At=$t.UsedValueState||($t.UsedValueState={})),$t.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class xt{constructor({prefixes:Lt,parent:jt}={}){this._names={},this._prefixes=Lt,this._parent=jt}toName(Lt){return Lt instanceof e.Name?Lt:this.name(Lt)}name(Lt){return new e.Name(this._newName(Lt))}_newName(Lt){const jt=this._names[Lt]||this._nameGroup(Lt);return`${Lt}${jt.index++}`}_nameGroup(Lt){var jt,Kt;if(!((Kt=(jt=this._parent)===null||jt===void 0?void 0:jt._prefixes)===null||Kt===void 0)&&Kt.has(Lt)||this._prefixes&&!this._prefixes.has(Lt))throw new Error(`CodeGen: prefix "${Lt}" is not allowed in this scope`);return this._names[Lt]={prefix:Lt,index:0}}}$t.Scope=xt;class kt extends e.Name{constructor(Lt,jt){super(jt),this.prefix=Lt}setValue(Lt,{property:jt,itemIndex:Kt}){this.value=Lt,this.scopePath=(0,e._)`.${new e.Name(jt)}[${Kt}]`}}$t.ValueScopeName=kt;const Bt=(0,e._)`\n`;class Nt extends xt{constructor(Lt){super(Lt),this._values={},this._scope=Lt.scope,this.opts={...Lt,_n:Lt.lines?Bt:e.nil}}get(){return this._scope}name(Lt){return new kt(Lt,this._newName(Lt))}value(Lt,jt){var Kt;if(jt.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const qt=this.toName(Lt),{prefix:zt}=qt,Vt=(Kt=jt.key)!==null&&Kt!==void 0?Kt:jt.ref;let Ht=this._values[zt];if(Ht){const Xt=Ht.get(Vt);if(Xt)return Xt}else Ht=this._values[zt]=new Map;Ht.set(Vt,qt);const Wt=this._scope[zt]||(this._scope[zt]=[]),Qt=Wt.length;return Wt[Qt]=jt.ref,qt.setValue(jt,{property:zt,itemIndex:Qt}),qt}getValue(Lt,jt){const Kt=this._values[Lt];if(Kt)return Kt.get(jt)}scopeRefs(Lt,jt=this._values){return this._reduceValues(jt,Kt=>{if(Kt.scopePath===void 0)throw new Error(`CodeGen: name "${Kt}" has no value`);return(0,e._)`${Lt}${Kt.scopePath}`})}scopeCode(Lt=this._values,jt,Kt){return this._reduceValues(Lt,qt=>{if(qt.value===void 0)throw new Error(`CodeGen: name "${qt}" has no value`);return qt.value.code},jt,Kt)}_reduceValues(Lt,jt,Kt={},qt){let zt=e.nil;for(const Vt in Lt){const Ht=Lt[Vt];if(!Ht)continue;const Wt=Kt[Vt]=Kt[Vt]||new Map;Ht.forEach(Qt=>{if(Wt.has(Qt))return;Wt.set(Qt,At.Started);let Xt=jt(Qt);if(Xt){const Jt=this.opts.es5?$t.varKinds.var:$t.varKinds.const;zt=(0,e._)`${zt}${Jt} ${Qt} = ${Xt};${this.opts._n}`}else if(Xt=qt==null?void 0:qt(Qt))zt=(0,e._)`${zt}${Xt}${this.opts._n}`;else throw new _t(Qt);Wt.set(Qt,At.Completed)})}return zt}}$t.ValueScope=Nt})(scope$1);(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.or=$t.and=$t.not=$t.CodeGen=$t.operators=$t.varKinds=$t.ValueScopeName=$t.ValueScope=$t.Scope=$t.Name=$t.regexpCode=$t.stringify=$t.getProperty=$t.nil=$t.strConcat=$t.str=$t._=void 0;const e=code$2,_t=scope$1;var At=code$2;Object.defineProperty($t,"_",{enumerable:!0,get:function(){return At._}}),Object.defineProperty($t,"str",{enumerable:!0,get:function(){return At.str}}),Object.defineProperty($t,"strConcat",{enumerable:!0,get:function(){return At.strConcat}}),Object.defineProperty($t,"nil",{enumerable:!0,get:function(){return At.nil}}),Object.defineProperty($t,"getProperty",{enumerable:!0,get:function(){return At.getProperty}}),Object.defineProperty($t,"stringify",{enumerable:!0,get:function(){return At.stringify}}),Object.defineProperty($t,"regexpCode",{enumerable:!0,get:function(){return At.regexpCode}}),Object.defineProperty($t,"Name",{enumerable:!0,get:function(){return At.Name}});var xt=scope$1;Object.defineProperty($t,"Scope",{enumerable:!0,get:function(){return xt.Scope}}),Object.defineProperty($t,"ValueScope",{enumerable:!0,get:function(){return xt.ValueScope}}),Object.defineProperty($t,"ValueScopeName",{enumerable:!0,get:function(){return xt.ValueScopeName}}),Object.defineProperty($t,"varKinds",{enumerable:!0,get:function(){return xt.varKinds}}),$t.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class kt{optimizeNodes(){return this}optimizeNames(Sr,Pr){return this}}class Bt extends kt{constructor(Sr,Pr,Tr){super(),this.varKind=Sr,this.name=Pr,this.rhs=Tr}render({es5:Sr,_n:Pr}){const Tr=Sr?_t.varKinds.var:this.varKind,wr=this.rhs===void 0?"":` = ${this.rhs}`;return`${Tr} ${this.name}${wr};`+Pr}optimizeNames(Sr,Pr){if(Sr[this.name.str])return this.rhs&&(this.rhs=er(this.rhs,Sr,Pr)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class Nt extends kt{constructor(Sr,Pr,Tr){super(),this.lhs=Sr,this.rhs=Pr,this.sideEffects=Tr}render({_n:Sr}){return`${this.lhs} = ${this.rhs};`+Sr}optimizeNames(Sr,Pr){if(!(this.lhs instanceof e.Name&&!Sr[this.lhs.str]&&!this.sideEffects))return this.rhs=er(this.rhs,Sr,Pr),this}get names(){const Sr=this.lhs instanceof e.Name?{}:{...this.lhs.names};return ir(Sr,this.rhs)}}class Ut extends Nt{constructor(Sr,Pr,Tr,wr){super(Sr,Tr,wr),this.op=Pr}render({_n:Sr}){return`${this.lhs} ${this.op}= ${this.rhs};`+Sr}}class Lt extends kt{constructor(Sr){super(),this.label=Sr,this.names={}}render({_n:Sr}){return`${this.label}:`+Sr}}class jt extends kt{constructor(Sr){super(),this.label=Sr,this.names={}}render({_n:Sr}){return`break${this.label?` ${this.label}`:""};`+Sr}}class Kt extends kt{constructor(Sr){super(),this.error=Sr}render({_n:Sr}){return`throw ${this.error};`+Sr}get names(){return this.error.names}}class qt extends kt{constructor(Sr){super(),this.code=Sr}render({_n:Sr}){return`${this.code};`+Sr}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(Sr,Pr){return this.code=er(this.code,Sr,Pr),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class zt extends kt{constructor(Sr=[]){super(),this.nodes=Sr}render(Sr){return this.nodes.reduce((Pr,Tr)=>Pr+Tr.render(Sr),"")}optimizeNodes(){const{nodes:Sr}=this;let Pr=Sr.length;for(;Pr--;){const Tr=Sr[Pr].optimizeNodes();Array.isArray(Tr)?Sr.splice(Pr,1,...Tr):Tr?Sr[Pr]=Tr:Sr.splice(Pr,1)}return Sr.length>0?this:void 0}optimizeNames(Sr,Pr){const{nodes:Tr}=this;let wr=Tr.length;for(;wr--;){const Ar=Tr[wr];Ar.optimizeNames(Sr,Pr)||(rr(Sr,Ar.names),Tr.splice(wr,1))}return Tr.length>0?this:void 0}get names(){return this.nodes.reduce((Sr,Pr)=>lr(Sr,Pr.names),{})}}class Vt extends zt{render(Sr){return"{"+Sr._n+super.render(Sr)+"}"+Sr._n}}class Ht extends zt{}class Wt extends Vt{}Wt.kind="else";class Qt extends Vt{constructor(Sr,Pr){super(Pr),this.condition=Sr}render(Sr){let Pr=`if(${this.condition})`+super.render(Sr);return this.else&&(Pr+="else "+this.else.render(Sr)),Pr}optimizeNodes(){super.optimizeNodes();const Sr=this.condition;if(Sr===!0)return this.nodes;let Pr=this.else;if(Pr){const Tr=Pr.optimizeNodes();Pr=this.else=Array.isArray(Tr)?new Wt(Tr):Tr}if(Pr)return Sr===!1?Pr instanceof Qt?Pr:Pr.nodes:this.nodes.length?this:new Qt(yr(Sr),Pr instanceof Qt?[Pr]:Pr.nodes);if(!(Sr===!1||!this.nodes.length))return this}optimizeNames(Sr,Pr){var Tr;if(this.else=(Tr=this.else)===null||Tr===void 0?void 0:Tr.optimizeNames(Sr,Pr),!!(super.optimizeNames(Sr,Pr)||this.else))return this.condition=er(this.condition,Sr,Pr),this}get names(){const Sr=super.names;return ir(Sr,this.condition),this.else&&lr(Sr,this.else.names),Sr}}Qt.kind="if";class Xt extends Vt{}Xt.kind="for";class Jt extends Xt{constructor(Sr){super(),this.iteration=Sr}render(Sr){return`for(${this.iteration})`+super.render(Sr)}optimizeNames(Sr,Pr){if(super.optimizeNames(Sr,Pr))return this.iteration=er(this.iteration,Sr,Pr),this}get names(){return lr(super.names,this.iteration.names)}}class tr extends Xt{constructor(Sr,Pr,Tr,wr){super(),this.varKind=Sr,this.name=Pr,this.from=Tr,this.to=wr}render(Sr){const Pr=Sr.es5?_t.varKinds.var:this.varKind,{name:Tr,from:wr,to:Ar}=this;return`for(${Pr} ${Tr}=${wr}; ${Tr}<${Ar}; ${Tr}++)`+super.render(Sr)}get names(){const Sr=ir(super.names,this.from);return ir(Sr,this.to)}}class dr extends Xt{constructor(Sr,Pr,Tr,wr){super(),this.loop=Sr,this.varKind=Pr,this.name=Tr,this.iterable=wr}render(Sr){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(Sr)}optimizeNames(Sr,Pr){if(super.optimizeNames(Sr,Pr))return this.iterable=er(this.iterable,Sr,Pr),this}get names(){return lr(super.names,this.iterable.names)}}class vr extends Vt{constructor(Sr,Pr,Tr){super(),this.name=Sr,this.args=Pr,this.async=Tr}render(Sr){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(Sr)}}vr.kind="func";class $r extends zt{render(Sr){return"return "+super.render(Sr)}}$r.kind="return";class Ir extends Vt{render(Sr){let Pr="try"+super.render(Sr);return this.catch&&(Pr+=this.catch.render(Sr)),this.finally&&(Pr+=this.finally.render(Sr)),Pr}optimizeNodes(){var Sr,Pr;return super.optimizeNodes(),(Sr=this.catch)===null||Sr===void 0||Sr.optimizeNodes(),(Pr=this.finally)===null||Pr===void 0||Pr.optimizeNodes(),this}optimizeNames(Sr,Pr){var Tr,wr;return super.optimizeNames(Sr,Pr),(Tr=this.catch)===null||Tr===void 0||Tr.optimizeNames(Sr,Pr),(wr=this.finally)===null||wr===void 0||wr.optimizeNames(Sr,Pr),this}get names(){const Sr=super.names;return this.catch&&lr(Sr,this.catch.names),this.finally&&lr(Sr,this.finally.names),Sr}}class Rr extends Vt{constructor(Sr){super(),this.error=Sr}render(Sr){return`catch(${this.error})`+super.render(Sr)}}Rr.kind="catch";class Nr extends Vt{render(Sr){return"finally"+super.render(Sr)}}Nr.kind="finally";class kr{constructor(Sr,Pr={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...Pr,_n:Pr.lines?`
`:""},this._extScope=Sr,this._scope=new _t.Scope({parent:Sr}),this._nodes=[new Ht]}toString(){return this._root.render(this.opts)}name(Sr){return this._scope.name(Sr)}scopeName(Sr){return this._extScope.name(Sr)}scopeValue(Sr,Pr){const Tr=this._extScope.value(Sr,Pr);return(this._values[Tr.prefix]||(this._values[Tr.prefix]=new Set)).add(Tr),Tr}getScopeValue(Sr,Pr){return this._extScope.getValue(Sr,Pr)}scopeRefs(Sr){return this._extScope.scopeRefs(Sr,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(Sr,Pr,Tr,wr){const Ar=this._scope.toName(Pr);return Tr!==void 0&&wr&&(this._constants[Ar.str]=Tr),this._leafNode(new Bt(Sr,Ar,Tr)),Ar}const(Sr,Pr,Tr){return this._def(_t.varKinds.const,Sr,Pr,Tr)}let(Sr,Pr,Tr){return this._def(_t.varKinds.let,Sr,Pr,Tr)}var(Sr,Pr,Tr){return this._def(_t.varKinds.var,Sr,Pr,Tr)}assign(Sr,Pr,Tr){return this._leafNode(new Nt(Sr,Pr,Tr))}add(Sr,Pr){return this._leafNode(new Ut(Sr,$t.operators.ADD,Pr))}code(Sr){return typeof Sr=="function"?Sr():Sr!==e.nil&&this._leafNode(new qt(Sr)),this}object(...Sr){const Pr=["{"];for(const[Tr,wr]of Sr)Pr.length>1&&Pr.push(","),Pr.push(Tr),(Tr!==wr||this.opts.es5)&&(Pr.push(":"),(0,e.addCodeArg)(Pr,wr));return Pr.push("}"),new e._Code(Pr)}if(Sr,Pr,Tr){if(this._blockNode(new Qt(Sr)),Pr&&Tr)this.code(Pr).else().code(Tr).endIf();else if(Pr)this.code(Pr).endIf();else if(Tr)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(Sr){return this._elseNode(new Qt(Sr))}else(){return this._elseNode(new Wt)}endIf(){return this._endBlockNode(Qt,Wt)}_for(Sr,Pr){return this._blockNode(Sr),Pr&&this.code(Pr).endFor(),this}for(Sr,Pr){return this._for(new Jt(Sr),Pr)}forRange(Sr,Pr,Tr,wr,Ar=this.opts.es5?_t.varKinds.var:_t.varKinds.let){const Mr=this._scope.toName(Sr);return this._for(new tr(Ar,Mr,Pr,Tr),()=>wr(Mr))}forOf(Sr,Pr,Tr,wr=_t.varKinds.const){const Ar=this._scope.toName(Sr);if(this.opts.es5){const Mr=Pr instanceof e.Name?Pr:this.var("_arr",Pr);return this.forRange("_i",0,(0,e._)`${Mr}.length`,Ur=>{this.var(Ar,(0,e._)`${Mr}[${Ur}]`),Tr(Ar)})}return this._for(new dr("of",wr,Ar,Pr),()=>Tr(Ar))}forIn(Sr,Pr,Tr,wr=this.opts.es5?_t.varKinds.var:_t.varKinds.const){if(this.opts.ownProperties)return this.forOf(Sr,(0,e._)`Object.keys(${Pr})`,Tr);const Ar=this._scope.toName(Sr);return this._for(new dr("in",wr,Ar,Pr),()=>Tr(Ar))}endFor(){return this._endBlockNode(Xt)}label(Sr){return this._leafNode(new Lt(Sr))}break(Sr){return this._leafNode(new jt(Sr))}return(Sr){const Pr=new $r;if(this._blockNode(Pr),this.code(Sr),Pr.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode($r)}try(Sr,Pr,Tr){if(!Pr&&!Tr)throw new Error('CodeGen: "try" without "catch" and "finally"');const wr=new Ir;if(this._blockNode(wr),this.code(Sr),Pr){const Ar=this.name("e");this._currNode=wr.catch=new Rr(Ar),Pr(Ar)}return Tr&&(this._currNode=wr.finally=new Nr,this.code(Tr)),this._endBlockNode(Rr,Nr)}throw(Sr){return this._leafNode(new Kt(Sr))}block(Sr,Pr){return this._blockStarts.push(this._nodes.length),Sr&&this.code(Sr).endBlock(Pr),this}endBlock(Sr){const Pr=this._blockStarts.pop();if(Pr===void 0)throw new Error("CodeGen: not in self-balancing block");const Tr=this._nodes.length-Pr;if(Tr<0||Sr!==void 0&&Tr!==Sr)throw new Error(`CodeGen: wrong number of nodes: ${Tr} vs ${Sr} expected`);return this._nodes.length=Pr,this}func(Sr,Pr=e.nil,Tr,wr){return this._blockNode(new vr(Sr,Pr,Tr)),wr&&this.code(wr).endFunc(),this}endFunc(){return this._endBlockNode(vr)}optimize(Sr=1){for(;Sr-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(Sr){return this._currNode.nodes.push(Sr),this}_blockNode(Sr){this._currNode.nodes.push(Sr),this._nodes.push(Sr)}_endBlockNode(Sr,Pr){const Tr=this._currNode;if(Tr instanceof Sr||Pr&&Tr instanceof Pr)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${Pr?`${Sr.kind}/${Pr.kind}`:Sr.kind}"`)}_elseNode(Sr){const Pr=this._currNode;if(!(Pr instanceof Qt))throw new Error('CodeGen: "else" without "if"');return this._currNode=Pr.else=Sr,this}get _root(){return this._nodes[0]}get _currNode(){const Sr=this._nodes;return Sr[Sr.length-1]}set _currNode(Sr){const Pr=this._nodes;Pr[Pr.length-1]=Sr}}$t.CodeGen=kr;function lr(br,Sr){for(const Pr in Sr)br[Pr]=(br[Pr]||0)+(Sr[Pr]||0);return br}function ir(br,Sr){return Sr instanceof e._CodeOrName?lr(br,Sr.names):br}function er(br,Sr,Pr){if(br instanceof e.Name)return Tr(br);if(!wr(br))return br;return new e._Code(br._items.reduce((Ar,Mr)=>(Mr instanceof e.Name&&(Mr=Tr(Mr)),Mr instanceof e._Code?Ar.push(...Mr._items):Ar.push(Mr),Ar),[]));function Tr(Ar){const Mr=Pr[Ar.str];return Mr===void 0||Sr[Ar.str]!==1?Ar:(delete Sr[Ar.str],Mr)}function wr(Ar){return Ar instanceof e._Code&&Ar._items.some(Mr=>Mr instanceof e.Name&&Sr[Mr.str]===1&&Pr[Mr.str]!==void 0)}}function rr(br,Sr){for(const Pr in Sr)br[Pr]=(br[Pr]||0)-(Sr[Pr]||0)}function yr(br){return typeof br=="boolean"||typeof br=="number"||br===null?!br:(0,e._)`!${pr(br)}`}$t.not=yr;const fr=ur($t.operators.AND);function gr(...br){return br.reduce(fr)}$t.and=gr;const ar=ur($t.operators.OR);function nr(...br){return br.reduce(ar)}$t.or=nr;function ur(br){return(Sr,Pr)=>Sr===e.nil?Pr:Pr===e.nil?Sr:(0,e._)`${pr(Sr)} ${br} ${pr(Pr)}`}function pr(br){return br instanceof e.Name?br:(0,e._)`(${br})`}})(codegen);var util$1={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.checkStrictMode=$t.getErrorPath=$t.Type=$t.useFunc=$t.setEvaluated=$t.evaluatedPropsToName=$t.mergeEvaluated=$t.eachItem=$t.unescapeJsonPointer=$t.escapeJsonPointer=$t.escapeFragment=$t.unescapeFragment=$t.schemaRefOrVal=$t.schemaHasRulesButRef=$t.schemaHasRules=$t.checkUnknownRules=$t.alwaysValidSchema=$t.toHash=void 0;const e=codegen,_t=code$2;function At(vr){const $r={};for(const Ir of vr)$r[Ir]=!0;return $r}$t.toHash=At;function xt(vr,$r){return typeof $r=="boolean"?$r:Object.keys($r).length===0?!0:(kt(vr,$r),!Bt($r,vr.self.RULES.all))}$t.alwaysValidSchema=xt;function kt(vr,$r=vr.schema){const{opts:Ir,self:Rr}=vr;if(!Ir.strictSchema||typeof $r=="boolean")return;const Nr=Rr.RULES.keywords;for(const kr in $r)Nr[kr]||dr(vr,`unknown keyword: "${kr}"`)}$t.checkUnknownRules=kt;function Bt(vr,$r){if(typeof vr=="boolean")return!vr;for(const Ir in vr)if($r[Ir])return!0;return!1}$t.schemaHasRules=Bt;function Nt(vr,$r){if(typeof vr=="boolean")return!vr;for(const Ir in vr)if(Ir!=="$ref"&&$r.all[Ir])return!0;return!1}$t.schemaHasRulesButRef=Nt;function Ut({topSchemaRef:vr,schemaPath:$r},Ir,Rr,Nr){if(!Nr){if(typeof Ir=="number"||typeof Ir=="boolean")return Ir;if(typeof Ir=="string")return(0,e._)`${Ir}`}return(0,e._)`${vr}${$r}${(0,e.getProperty)(Rr)}`}$t.schemaRefOrVal=Ut;function Lt(vr){return qt(decodeURIComponent(vr))}$t.unescapeFragment=Lt;function jt(vr){return encodeURIComponent(Kt(vr))}$t.escapeFragment=jt;function Kt(vr){return typeof vr=="number"?`${vr}`:vr.replace(/~/g,"~0").replace(/\//g,"~1")}$t.escapeJsonPointer=Kt;function qt(vr){return vr.replace(/~1/g,"/").replace(/~0/g,"~")}$t.unescapeJsonPointer=qt;function zt(vr,$r){if(Array.isArray(vr))for(const Ir of vr)$r(Ir);else $r(vr)}$t.eachItem=zt;function Vt({mergeNames:vr,mergeToName:$r,mergeValues:Ir,resultToName:Rr}){return(Nr,kr,lr,ir)=>{const er=lr===void 0?kr:lr instanceof e.Name?(kr instanceof e.Name?vr(Nr,kr,lr):$r(Nr,kr,lr),lr):kr instanceof e.Name?($r(Nr,lr,kr),kr):Ir(kr,lr);return ir===e.Name&&!(er instanceof e.Name)?Rr(Nr,er):er}}$t.mergeEvaluated={props:Vt({mergeNames:(vr,$r,Ir)=>vr.if((0,e._)`${Ir} !== true && ${$r} !== undefined`,()=>{vr.if((0,e._)`${$r} === true`,()=>vr.assign(Ir,!0),()=>vr.assign(Ir,(0,e._)`${Ir} || {}`).code((0,e._)`Object.assign(${Ir}, ${$r})`))}),mergeToName:(vr,$r,Ir)=>vr.if((0,e._)`${Ir} !== true`,()=>{$r===!0?vr.assign(Ir,!0):(vr.assign(Ir,(0,e._)`${Ir} || {}`),Wt(vr,Ir,$r))}),mergeValues:(vr,$r)=>vr===!0?!0:{...vr,...$r},resultToName:Ht}),items:Vt({mergeNames:(vr,$r,Ir)=>vr.if((0,e._)`${Ir} !== true && ${$r} !== undefined`,()=>vr.assign(Ir,(0,e._)`${$r} === true ? true : ${Ir} > ${$r} ? ${Ir} : ${$r}`)),mergeToName:(vr,$r,Ir)=>vr.if((0,e._)`${Ir} !== true`,()=>vr.assign(Ir,$r===!0?!0:(0,e._)`${Ir} > ${$r} ? ${Ir} : ${$r}`)),mergeValues:(vr,$r)=>vr===!0?!0:Math.max(vr,$r),resultToName:(vr,$r)=>vr.var("items",$r)})};function Ht(vr,$r){if($r===!0)return vr.var("props",!0);const Ir=vr.var("props",(0,e._)`{}`);return $r!==void 0&&Wt(vr,Ir,$r),Ir}$t.evaluatedPropsToName=Ht;function Wt(vr,$r,Ir){Object.keys(Ir).forEach(Rr=>vr.assign((0,e._)`${$r}${(0,e.getProperty)(Rr)}`,!0))}$t.setEvaluated=Wt;const Qt={};function Xt(vr,$r){return vr.scopeValue("func",{ref:$r,code:Qt[$r.code]||(Qt[$r.code]=new _t._Code($r.code))})}$t.useFunc=Xt;var Jt;(function(vr){vr[vr.Num=0]="Num",vr[vr.Str=1]="Str"})(Jt=$t.Type||($t.Type={}));function tr(vr,$r,Ir){if(vr instanceof e.Name){const Rr=$r===Jt.Num;return Ir?Rr?(0,e._)`"[" + ${vr} + "]"`:(0,e._)`"['" + ${vr} + "']"`:Rr?(0,e._)`"/" + ${vr}`:(0,e._)`"/" + ${vr}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return Ir?(0,e.getProperty)(vr).toString():"/"+Kt(vr)}$t.getErrorPath=tr;function dr(vr,$r,Ir=vr.opts.strictSchema){if(Ir){if($r=`strict mode: ${$r}`,Ir===!0)throw new Error($r);vr.self.logger.warn($r)}}$t.checkStrictMode=dr})(util$1);var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$x=codegen,names={data:new codegen_1$x.Name("data"),valCxt:new codegen_1$x.Name("valCxt"),instancePath:new codegen_1$x.Name("instancePath"),parentData:new codegen_1$x.Name("parentData"),parentDataProperty:new codegen_1$x.Name("parentDataProperty"),rootData:new codegen_1$x.Name("rootData"),dynamicAnchors:new codegen_1$x.Name("dynamicAnchors"),vErrors:new codegen_1$x.Name("vErrors"),errors:new codegen_1$x.Name("errors"),this:new codegen_1$x.Name("this"),self:new codegen_1$x.Name("self"),scope:new codegen_1$x.Name("scope"),json:new codegen_1$x.Name("json"),jsonPos:new codegen_1$x.Name("jsonPos"),jsonLen:new codegen_1$x.Name("jsonLen"),jsonPart:new codegen_1$x.Name("jsonPart")};names$1.default=names;(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.extendErrors=$t.resetErrorsCount=$t.reportExtraError=$t.reportError=$t.keyword$DataError=$t.keywordError=void 0;const e=codegen,_t=util$1,At=names$1;$t.keywordError={message:({keyword:Wt})=>(0,e.str)`must pass "${Wt}" keyword validation`},$t.keyword$DataError={message:({keyword:Wt,schemaType:Qt})=>Qt?(0,e.str)`"${Wt}" keyword must be ${Qt} ($data)`:(0,e.str)`"${Wt}" keyword is invalid ($data)`};function xt(Wt,Qt=$t.keywordError,Xt,Jt){const{it:tr}=Wt,{gen:dr,compositeRule:vr,allErrors:$r}=tr,Ir=Kt(Wt,Qt,Xt);Jt??(vr||$r)?Ut(dr,Ir):Lt(tr,(0,e._)`[${Ir}]`)}$t.reportError=xt;function kt(Wt,Qt=$t.keywordError,Xt){const{it:Jt}=Wt,{gen:tr,compositeRule:dr,allErrors:vr}=Jt,$r=Kt(Wt,Qt,Xt);Ut(tr,$r),dr||vr||Lt(Jt,At.default.vErrors)}$t.reportExtraError=kt;function Bt(Wt,Qt){Wt.assign(At.default.errors,Qt),Wt.if((0,e._)`${At.default.vErrors} !== null`,()=>Wt.if(Qt,()=>Wt.assign((0,e._)`${At.default.vErrors}.length`,Qt),()=>Wt.assign(At.default.vErrors,null)))}$t.resetErrorsCount=Bt;function Nt({gen:Wt,keyword:Qt,schemaValue:Xt,data:Jt,errsCount:tr,it:dr}){if(tr===void 0)throw new Error("ajv implementation error");const vr=Wt.name("err");Wt.forRange("i",tr,At.default.errors,$r=>{Wt.const(vr,(0,e._)`${At.default.vErrors}[${$r}]`),Wt.if((0,e._)`${vr}.instancePath === undefined`,()=>Wt.assign((0,e._)`${vr}.instancePath`,(0,e.strConcat)(At.default.instancePath,dr.errorPath))),Wt.assign((0,e._)`${vr}.schemaPath`,(0,e.str)`${dr.errSchemaPath}/${Qt}`),dr.opts.verbose&&(Wt.assign((0,e._)`${vr}.schema`,Xt),Wt.assign((0,e._)`${vr}.data`,Jt))})}$t.extendErrors=Nt;function Ut(Wt,Qt){const Xt=Wt.const("err",Qt);Wt.if((0,e._)`${At.default.vErrors} === null`,()=>Wt.assign(At.default.vErrors,(0,e._)`[${Xt}]`),(0,e._)`${At.default.vErrors}.push(${Xt})`),Wt.code((0,e._)`${At.default.errors}++`)}function Lt(Wt,Qt){const{gen:Xt,validateName:Jt,schemaEnv:tr}=Wt;tr.$async?Xt.throw((0,e._)`new ${Wt.ValidationError}(${Qt})`):(Xt.assign((0,e._)`${Jt}.errors`,Qt),Xt.return(!1))}const jt={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function Kt(Wt,Qt,Xt){const{createErrors:Jt}=Wt.it;return Jt===!1?(0,e._)`{}`:qt(Wt,Qt,Xt)}function qt(Wt,Qt,Xt={}){const{gen:Jt,it:tr}=Wt,dr=[zt(tr,Xt),Vt(Wt,Xt)];return Ht(Wt,Qt,dr),Jt.object(...dr)}function zt({errorPath:Wt},{instancePath:Qt}){const Xt=Qt?(0,e.str)`${Wt}${(0,_t.getErrorPath)(Qt,_t.Type.Str)}`:Wt;return[At.default.instancePath,(0,e.strConcat)(At.default.instancePath,Xt)]}function Vt({keyword:Wt,it:{errSchemaPath:Qt}},{schemaPath:Xt,parentSchema:Jt}){let tr=Jt?Qt:(0,e.str)`${Qt}/${Wt}`;return Xt&&(tr=(0,e.str)`${tr}${(0,_t.getErrorPath)(Xt,_t.Type.Str)}`),[jt.schemaPath,tr]}function Ht(Wt,{params:Qt,message:Xt},Jt){const{keyword:tr,data:dr,schemaValue:vr,it:$r}=Wt,{opts:Ir,propertyName:Rr,topSchemaRef:Nr,schemaPath:kr}=$r;Jt.push([jt.keyword,tr],[jt.params,typeof Qt=="function"?Qt(Wt):Qt||(0,e._)`{}`]),Ir.messages&&Jt.push([jt.message,typeof Xt=="function"?Xt(Wt):Xt]),Ir.verbose&&Jt.push([jt.schema,vr],[jt.parentSchema,(0,e._)`${Nr}${kr}`],[At.default.data,dr]),Rr&&Jt.push([jt.propertyName,Rr])}})(errors$1);Object.defineProperty(boolSchema,"__esModule",{value:!0});boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$2=errors$1,codegen_1$w=codegen,names_1$9=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema($t){const{gen:e,schema:_t,validateName:At}=$t;_t===!1?falseSchemaError($t,!1):typeof _t=="object"&&_t.$async===!0?e.return(names_1$9.default.data):(e.assign((0,codegen_1$w._)`${At}.errors`,null),e.return(!0))}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema;function boolOrEmptySchema($t,e){const{gen:_t,schema:At}=$t;At===!1?(_t.var(e,!1),falseSchemaError($t)):_t.var(e,!0)}boolSchema.boolOrEmptySchema=boolOrEmptySchema;function falseSchemaError($t,e){const{gen:_t,data:At}=$t,xt={gen:_t,keyword:"false schema",data:At,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:$t};(0,errors_1$2.reportError)(xt,boolError,void 0,e)}var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0});rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType($t){return typeof $t=="string"&&jsonTypes.has($t)}rules.isJSONType=isJSONType;function getRules(){const $t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...$t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},$t.number,$t.string,$t.array,$t.object],post:{rules:[]},all:{},keywords:{}}}rules.getRules=getRules;var applicability={};Object.defineProperty(applicability,"__esModule",{value:!0});applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function schemaHasRulesForType({schema:$t,self:e},_t){const At=e.RULES.types[_t];return At&&At!==!0&&shouldUseGroup($t,At)}applicability.schemaHasRulesForType=schemaHasRulesForType;function shouldUseGroup($t,e){return e.rules.some(_t=>shouldUseRule($t,_t))}applicability.shouldUseGroup=shouldUseGroup;function shouldUseRule($t,e){var _t;return $t[e.keyword]!==void 0||((_t=e.definition.implements)===null||_t===void 0?void 0:_t.some(At=>$t[At]!==void 0))}applicability.shouldUseRule=shouldUseRule;(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.reportTypeError=$t.checkDataTypes=$t.checkDataType=$t.coerceAndCheckDataType=$t.getJSONTypes=$t.getSchemaTypes=$t.DataType=void 0;const e=rules,_t=applicability,At=errors$1,xt=codegen,kt=util$1;var Bt;(function(Jt){Jt[Jt.Correct=0]="Correct",Jt[Jt.Wrong=1]="Wrong"})(Bt=$t.DataType||($t.DataType={}));function Nt(Jt){const tr=Ut(Jt.type);if(tr.includes("null")){if(Jt.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!tr.length&&Jt.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');Jt.nullable===!0&&tr.push("null")}return tr}$t.getSchemaTypes=Nt;function Ut(Jt){const tr=Array.isArray(Jt)?Jt:Jt?[Jt]:[];if(tr.every(e.isJSONType))return tr;throw new Error("type must be JSONType or JSONType[]: "+tr.join(","))}$t.getJSONTypes=Ut;function Lt(Jt,tr){const{gen:dr,data:vr,opts:$r}=Jt,Ir=Kt(tr,$r.coerceTypes),Rr=tr.length>0&&!(Ir.length===0&&tr.length===1&&(0,_t.schemaHasRulesForType)(Jt,tr[0]));if(Rr){const Nr=Ht(tr,vr,$r.strictNumbers,Bt.Wrong);dr.if(Nr,()=>{Ir.length?qt(Jt,tr,Ir):Qt(Jt)})}return Rr}$t.coerceAndCheckDataType=Lt;const jt=new Set(["string","number","integer","boolean","null"]);function Kt(Jt,tr){return tr?Jt.filter(dr=>jt.has(dr)||tr==="array"&&dr==="array"):[]}function qt(Jt,tr,dr){const{gen:vr,data:$r,opts:Ir}=Jt,Rr=vr.let("dataType",(0,xt._)`typeof ${$r}`),Nr=vr.let("coerced",(0,xt._)`undefined`);Ir.coerceTypes==="array"&&vr.if((0,xt._)`${Rr} == 'object' && Array.isArray(${$r}) && ${$r}.length == 1`,()=>vr.assign($r,(0,xt._)`${$r}[0]`).assign(Rr,(0,xt._)`typeof ${$r}`).if(Ht(tr,$r,Ir.strictNumbers),()=>vr.assign(Nr,$r))),vr.if((0,xt._)`${Nr} !== undefined`);for(const lr of dr)(jt.has(lr)||lr==="array"&&Ir.coerceTypes==="array")&&kr(lr);vr.else(),Qt(Jt),vr.endIf(),vr.if((0,xt._)`${Nr} !== undefined`,()=>{vr.assign($r,Nr),zt(Jt,Nr)});function kr(lr){switch(lr){case"string":vr.elseIf((0,xt._)`${Rr} == "number" || ${Rr} == "boolean"`).assign(Nr,(0,xt._)`"" + ${$r}`).elseIf((0,xt._)`${$r} === null`).assign(Nr,(0,xt._)`""`);return;case"number":vr.elseIf((0,xt._)`${Rr} == "boolean" || ${$r} === null
              || (${Rr} == "string" && ${$r} && ${$r} == +${$r})`).assign(Nr,(0,xt._)`+${$r}`);return;case"integer":vr.elseIf((0,xt._)`${Rr} === "boolean" || ${$r} === null
              || (${Rr} === "string" && ${$r} && ${$r} == +${$r} && !(${$r} % 1))`).assign(Nr,(0,xt._)`+${$r}`);return;case"boolean":vr.elseIf((0,xt._)`${$r} === "false" || ${$r} === 0 || ${$r} === null`).assign(Nr,!1).elseIf((0,xt._)`${$r} === "true" || ${$r} === 1`).assign(Nr,!0);return;case"null":vr.elseIf((0,xt._)`${$r} === "" || ${$r} === 0 || ${$r} === false`),vr.assign(Nr,null);return;case"array":vr.elseIf((0,xt._)`${Rr} === "string" || ${Rr} === "number"
              || ${Rr} === "boolean" || ${$r} === null`).assign(Nr,(0,xt._)`[${$r}]`)}}}function zt({gen:Jt,parentData:tr,parentDataProperty:dr},vr){Jt.if((0,xt._)`${tr} !== undefined`,()=>Jt.assign((0,xt._)`${tr}[${dr}]`,vr))}function Vt(Jt,tr,dr,vr=Bt.Correct){const $r=vr===Bt.Correct?xt.operators.EQ:xt.operators.NEQ;let Ir;switch(Jt){case"null":return(0,xt._)`${tr} ${$r} null`;case"array":Ir=(0,xt._)`Array.isArray(${tr})`;break;case"object":Ir=(0,xt._)`${tr} && typeof ${tr} == "object" && !Array.isArray(${tr})`;break;case"integer":Ir=Rr((0,xt._)`!(${tr} % 1) && !isNaN(${tr})`);break;case"number":Ir=Rr();break;default:return(0,xt._)`typeof ${tr} ${$r} ${Jt}`}return vr===Bt.Correct?Ir:(0,xt.not)(Ir);function Rr(Nr=xt.nil){return(0,xt.and)((0,xt._)`typeof ${tr} == "number"`,Nr,dr?(0,xt._)`isFinite(${tr})`:xt.nil)}}$t.checkDataType=Vt;function Ht(Jt,tr,dr,vr){if(Jt.length===1)return Vt(Jt[0],tr,dr,vr);let $r;const Ir=(0,kt.toHash)(Jt);if(Ir.array&&Ir.object){const Rr=(0,xt._)`typeof ${tr} != "object"`;$r=Ir.null?Rr:(0,xt._)`!${tr} || ${Rr}`,delete Ir.null,delete Ir.array,delete Ir.object}else $r=xt.nil;Ir.number&&delete Ir.integer;for(const Rr in Ir)$r=(0,xt.and)($r,Vt(Rr,tr,dr,vr));return $r}$t.checkDataTypes=Ht;const Wt={message:({schema:Jt})=>`must be ${Jt}`,params:({schema:Jt,schemaValue:tr})=>typeof Jt=="string"?(0,xt._)`{type: ${Jt}}`:(0,xt._)`{type: ${tr}}`};function Qt(Jt){const tr=Xt(Jt);(0,At.reportError)(tr,Wt)}$t.reportTypeError=Qt;function Xt(Jt){const{gen:tr,data:dr,schema:vr}=Jt,$r=(0,kt.schemaRefOrVal)(Jt,vr,"type");return{gen:tr,keyword:"type",data:dr,schema:vr.type,schemaCode:$r,schemaValue:$r,parentSchema:vr,params:{},it:Jt}}})(dataType);var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0});defaults.assignDefaults=void 0;const codegen_1$v=codegen,util_1$t=util$1;function assignDefaults($t,e){const{properties:_t,items:At}=$t.schema;if(e==="object"&&_t)for(const xt in _t)assignDefault($t,xt,_t[xt].default);else e==="array"&&Array.isArray(At)&&At.forEach((xt,kt)=>assignDefault($t,kt,xt.default))}defaults.assignDefaults=assignDefaults;function assignDefault($t,e,_t){const{gen:At,compositeRule:xt,data:kt,opts:Bt}=$t;if(_t===void 0)return;const Nt=(0,codegen_1$v._)`${kt}${(0,codegen_1$v.getProperty)(e)}`;if(xt){(0,util_1$t.checkStrictMode)($t,`default is ignored for: ${Nt}`);return}let Ut=(0,codegen_1$v._)`${Nt} === undefined`;Bt.useDefaults==="empty"&&(Ut=(0,codegen_1$v._)`${Ut} || ${Nt} === null || ${Nt} === ""`),At.if(Ut,(0,codegen_1$v._)`${Nt} = ${(0,codegen_1$v.stringify)(_t)}`)}var keyword={},code$1={};Object.defineProperty(code$1,"__esModule",{value:!0});code$1.validateUnion=code$1.validateArray=code$1.usePattern=code$1.callValidateCode=code$1.schemaProperties=code$1.allSchemaProperties=code$1.noPropertyInData=code$1.propertyInData=code$1.isOwnProperty=code$1.hasPropFunc=code$1.reportMissingProp=code$1.checkMissingProp=code$1.checkReportMissingProp=void 0;const codegen_1$u=codegen,util_1$s=util$1,names_1$8=names$1,util_2$1=util$1;function checkReportMissingProp($t,e){const{gen:_t,data:At,it:xt}=$t;_t.if(noPropertyInData(_t,At,e,xt.opts.ownProperties),()=>{$t.setParams({missingProperty:(0,codegen_1$u._)`${e}`},!0),$t.error()})}code$1.checkReportMissingProp=checkReportMissingProp;function checkMissingProp({gen:$t,data:e,it:{opts:_t}},At,xt){return(0,codegen_1$u.or)(...At.map(kt=>(0,codegen_1$u.and)(noPropertyInData($t,e,kt,_t.ownProperties),(0,codegen_1$u._)`${xt} = ${kt}`)))}code$1.checkMissingProp=checkMissingProp;function reportMissingProp($t,e){$t.setParams({missingProperty:e},!0),$t.error()}code$1.reportMissingProp=reportMissingProp;function hasPropFunc($t){return $t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,codegen_1$u._)`Object.prototype.hasOwnProperty`})}code$1.hasPropFunc=hasPropFunc;function isOwnProperty($t,e,_t){return(0,codegen_1$u._)`${hasPropFunc($t)}.call(${e}, ${_t})`}code$1.isOwnProperty=isOwnProperty;function propertyInData($t,e,_t,At){const xt=(0,codegen_1$u._)`${e}${(0,codegen_1$u.getProperty)(_t)} !== undefined`;return At?(0,codegen_1$u._)`${xt} && ${isOwnProperty($t,e,_t)}`:xt}code$1.propertyInData=propertyInData;function noPropertyInData($t,e,_t,At){const xt=(0,codegen_1$u._)`${e}${(0,codegen_1$u.getProperty)(_t)} === undefined`;return At?(0,codegen_1$u.or)(xt,(0,codegen_1$u.not)(isOwnProperty($t,e,_t))):xt}code$1.noPropertyInData=noPropertyInData;function allSchemaProperties($t){return $t?Object.keys($t).filter(e=>e!=="__proto__"):[]}code$1.allSchemaProperties=allSchemaProperties;function schemaProperties($t,e){return allSchemaProperties(e).filter(_t=>!(0,util_1$s.alwaysValidSchema)($t,e[_t]))}code$1.schemaProperties=schemaProperties;function callValidateCode({schemaCode:$t,data:e,it:{gen:_t,topSchemaRef:At,schemaPath:xt,errorPath:kt},it:Bt},Nt,Ut,Lt){const jt=Lt?(0,codegen_1$u._)`${$t}, ${e}, ${At}${xt}`:e,Kt=[[names_1$8.default.instancePath,(0,codegen_1$u.strConcat)(names_1$8.default.instancePath,kt)],[names_1$8.default.parentData,Bt.parentData],[names_1$8.default.parentDataProperty,Bt.parentDataProperty],[names_1$8.default.rootData,names_1$8.default.rootData]];Bt.opts.dynamicRef&&Kt.push([names_1$8.default.dynamicAnchors,names_1$8.default.dynamicAnchors]);const qt=(0,codegen_1$u._)`${jt}, ${_t.object(...Kt)}`;return Ut!==codegen_1$u.nil?(0,codegen_1$u._)`${Nt}.call(${Ut}, ${qt})`:(0,codegen_1$u._)`${Nt}(${qt})`}code$1.callValidateCode=callValidateCode;const newRegExp=(0,codegen_1$u._)`new RegExp`;function usePattern({gen:$t,it:{opts:e}},_t){const At=e.unicodeRegExp?"u":"",{regExp:xt}=e.code,kt=xt(_t,At);return $t.scopeValue("pattern",{key:kt.toString(),ref:kt,code:(0,codegen_1$u._)`${xt.code==="new RegExp"?newRegExp:(0,util_2$1.useFunc)($t,xt)}(${_t}, ${At})`})}code$1.usePattern=usePattern;function validateArray$1($t){const{gen:e,data:_t,keyword:At,it:xt}=$t,kt=e.name("valid");if(xt.allErrors){const Nt=e.let("valid",!0);return Bt(()=>e.assign(Nt,!1)),Nt}return e.var(kt,!0),Bt(()=>e.break()),kt;function Bt(Nt){const Ut=e.const("len",(0,codegen_1$u._)`${_t}.length`);e.forRange("i",0,Ut,Lt=>{$t.subschema({keyword:At,dataProp:Lt,dataPropType:util_1$s.Type.Num},kt),e.if((0,codegen_1$u.not)(kt),Nt)})}}code$1.validateArray=validateArray$1;function validateUnion$1($t){const{gen:e,schema:_t,keyword:At,it:xt}=$t;if(!Array.isArray(_t))throw new Error("ajv implementation error");if(_t.some(Ut=>(0,util_1$s.alwaysValidSchema)(xt,Ut))&&!xt.opts.unevaluated)return;const Bt=e.let("valid",!1),Nt=e.name("_valid");e.block(()=>_t.forEach((Ut,Lt)=>{const jt=$t.subschema({keyword:At,schemaProp:Lt,compositeRule:!0},Nt);e.assign(Bt,(0,codegen_1$u._)`${Bt} || ${Nt}`),$t.mergeValidEvaluated(jt,Nt)||e.if((0,codegen_1$u.not)(Bt))})),$t.result(Bt,()=>$t.reset(),()=>$t.error(!0))}code$1.validateUnion=validateUnion$1;Object.defineProperty(keyword,"__esModule",{value:!0});keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$t=codegen,names_1$7=names$1,code_1$9=code$1,errors_1$1=errors$1;function macroKeywordCode($t,e){const{gen:_t,keyword:At,schema:xt,parentSchema:kt,it:Bt}=$t,Nt=e.macro.call(Bt.self,xt,kt,Bt),Ut=useKeyword(_t,At,Nt);Bt.opts.validateSchema!==!1&&Bt.self.validateSchema(Nt,!0);const Lt=_t.name("valid");$t.subschema({schema:Nt,schemaPath:codegen_1$t.nil,errSchemaPath:`${Bt.errSchemaPath}/${At}`,topSchemaRef:Ut,compositeRule:!0},Lt),$t.pass(Lt,()=>$t.error(!0))}keyword.macroKeywordCode=macroKeywordCode;function funcKeywordCode($t,e){var _t;const{gen:At,keyword:xt,schema:kt,parentSchema:Bt,$data:Nt,it:Ut}=$t;checkAsyncKeyword(Ut,e);const Lt=!Nt&&e.compile?e.compile.call(Ut.self,kt,Bt,Ut):e.validate,jt=useKeyword(At,xt,Lt),Kt=At.let("valid");$t.block$data(Kt,qt),$t.ok((_t=e.valid)!==null&&_t!==void 0?_t:Kt);function qt(){if(e.errors===!1)Ht(),e.modifying&&modifyData($t),Wt(()=>$t.error());else{const Qt=e.async?zt():Vt();e.modifying&&modifyData($t),Wt(()=>addErrs($t,Qt))}}function zt(){const Qt=At.let("ruleErrs",null);return At.try(()=>Ht((0,codegen_1$t._)`await `),Xt=>At.assign(Kt,!1).if((0,codegen_1$t._)`${Xt} instanceof ${Ut.ValidationError}`,()=>At.assign(Qt,(0,codegen_1$t._)`${Xt}.errors`),()=>At.throw(Xt))),Qt}function Vt(){const Qt=(0,codegen_1$t._)`${jt}.errors`;return At.assign(Qt,null),Ht(codegen_1$t.nil),Qt}function Ht(Qt=e.async?(0,codegen_1$t._)`await `:codegen_1$t.nil){const Xt=Ut.opts.passContext?names_1$7.default.this:names_1$7.default.self,Jt=!("compile"in e&&!Nt||e.schema===!1);At.assign(Kt,(0,codegen_1$t._)`${Qt}${(0,code_1$9.callValidateCode)($t,jt,Xt,Jt)}`,e.modifying)}function Wt(Qt){var Xt;At.if((0,codegen_1$t.not)((Xt=e.valid)!==null&&Xt!==void 0?Xt:Kt),Qt)}}keyword.funcKeywordCode=funcKeywordCode;function modifyData($t){const{gen:e,data:_t,it:At}=$t;e.if(At.parentData,()=>e.assign(_t,(0,codegen_1$t._)`${At.parentData}[${At.parentDataProperty}]`))}function addErrs($t,e){const{gen:_t}=$t;_t.if((0,codegen_1$t._)`Array.isArray(${e})`,()=>{_t.assign(names_1$7.default.vErrors,(0,codegen_1$t._)`${names_1$7.default.vErrors} === null ? ${e} : ${names_1$7.default.vErrors}.concat(${e})`).assign(names_1$7.default.errors,(0,codegen_1$t._)`${names_1$7.default.vErrors}.length`),(0,errors_1$1.extendErrors)($t)},()=>$t.error())}function checkAsyncKeyword({schemaEnv:$t},e){if(e.async&&!$t.$async)throw new Error("async keyword in sync schema")}function useKeyword($t,e,_t){if(_t===void 0)throw new Error(`keyword "${e}" failed to compile`);return $t.scopeValue("keyword",typeof _t=="function"?{ref:_t}:{ref:_t,code:(0,codegen_1$t.stringify)(_t)})}function validSchemaType($t,e,_t=!1){return!e.length||e.some(At=>At==="array"?Array.isArray($t):At==="object"?$t&&typeof $t=="object"&&!Array.isArray($t):typeof $t==At||_t&&typeof $t>"u")}keyword.validSchemaType=validSchemaType;function validateKeywordUsage({schema:$t,opts:e,self:_t,errSchemaPath:At},xt,kt){if(Array.isArray(xt.keyword)?!xt.keyword.includes(kt):xt.keyword!==kt)throw new Error("ajv implementation error");const Bt=xt.dependencies;if(Bt!=null&&Bt.some(Nt=>!Object.prototype.hasOwnProperty.call($t,Nt)))throw new Error(`parent schema must have dependencies of ${kt}: ${Bt.join(",")}`);if(xt.validateSchema&&!xt.validateSchema($t[kt])){const Ut=`keyword "${kt}" value is invalid at path "${At}": `+_t.errorsText(xt.validateSchema.errors);if(e.validateSchema==="log")_t.logger.error(Ut);else throw new Error(Ut)}}keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0});subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$s=codegen,util_1$r=util$1;function getSubschema($t,{keyword:e,schemaProp:_t,schema:At,schemaPath:xt,errSchemaPath:kt,topSchemaRef:Bt}){if(e!==void 0&&At!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const Nt=$t.schema[e];return _t===void 0?{schema:Nt,schemaPath:(0,codegen_1$s._)`${$t.schemaPath}${(0,codegen_1$s.getProperty)(e)}`,errSchemaPath:`${$t.errSchemaPath}/${e}`}:{schema:Nt[_t],schemaPath:(0,codegen_1$s._)`${$t.schemaPath}${(0,codegen_1$s.getProperty)(e)}${(0,codegen_1$s.getProperty)(_t)}`,errSchemaPath:`${$t.errSchemaPath}/${e}/${(0,util_1$r.escapeFragment)(_t)}`}}if(At!==void 0){if(xt===void 0||kt===void 0||Bt===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:At,schemaPath:xt,topSchemaRef:Bt,errSchemaPath:kt}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=getSubschema;function extendSubschemaData($t,e,{dataProp:_t,dataPropType:At,data:xt,dataTypes:kt,propertyName:Bt}){if(xt!==void 0&&_t!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:Nt}=e;if(_t!==void 0){const{errorPath:Lt,dataPathArr:jt,opts:Kt}=e,qt=Nt.let("data",(0,codegen_1$s._)`${e.data}${(0,codegen_1$s.getProperty)(_t)}`,!0);Ut(qt),$t.errorPath=(0,codegen_1$s.str)`${Lt}${(0,util_1$r.getErrorPath)(_t,At,Kt.jsPropertySyntax)}`,$t.parentDataProperty=(0,codegen_1$s._)`${_t}`,$t.dataPathArr=[...jt,$t.parentDataProperty]}if(xt!==void 0){const Lt=xt instanceof codegen_1$s.Name?xt:Nt.let("data",xt,!0);Ut(Lt),Bt!==void 0&&($t.propertyName=Bt)}kt&&($t.dataTypes=kt);function Ut(Lt){$t.data=Lt,$t.dataLevel=e.dataLevel+1,$t.dataTypes=[],e.definedProperties=new Set,$t.parentData=e.data,$t.dataNames=[...e.dataNames,Lt]}}subschema.extendSubschemaData=extendSubschemaData;function extendSubschemaMode($t,{jtdDiscriminator:e,jtdMetadata:_t,compositeRule:At,createErrors:xt,allErrors:kt}){At!==void 0&&($t.compositeRule=At),xt!==void 0&&($t.createErrors=xt),kt!==void 0&&($t.allErrors=kt),$t.jtdDiscriminator=e,$t.jtdMetadata=_t}subschema.extendSubschemaMode=extendSubschemaMode;var resolve$5={},fastDeepEqual=function $t(e,_t){if(e===_t)return!0;if(e&&_t&&typeof e=="object"&&typeof _t=="object"){if(e.constructor!==_t.constructor)return!1;var At,xt,kt;if(Array.isArray(e)){if(At=e.length,At!=_t.length)return!1;for(xt=At;xt--!==0;)if(!$t(e[xt],_t[xt]))return!1;return!0}if(e.constructor===RegExp)return e.source===_t.source&&e.flags===_t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===_t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===_t.toString();if(kt=Object.keys(e),At=kt.length,At!==Object.keys(_t).length)return!1;for(xt=At;xt--!==0;)if(!Object.prototype.hasOwnProperty.call(_t,kt[xt]))return!1;for(xt=At;xt--!==0;){var Bt=kt[xt];if(!$t(e[Bt],_t[Bt]))return!1}return!0}return e!==e&&_t!==_t},jsonSchemaTraverse={exports:{}},traverse$1=jsonSchemaTraverse.exports=function($t,e,_t){typeof e=="function"&&(_t=e,e={}),_t=e.cb||_t;var At=typeof _t=="function"?_t:_t.pre||function(){},xt=_t.post||function(){};_traverse(e,At,xt,$t,"",$t)};traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function _traverse($t,e,_t,At,xt,kt,Bt,Nt,Ut,Lt){if(At&&typeof At=="object"&&!Array.isArray(At)){e(At,xt,kt,Bt,Nt,Ut,Lt);for(var jt in At){var Kt=At[jt];if(Array.isArray(Kt)){if(jt in traverse$1.arrayKeywords)for(var qt=0;qt<Kt.length;qt++)_traverse($t,e,_t,Kt[qt],xt+"/"+jt+"/"+qt,kt,xt,jt,At,qt)}else if(jt in traverse$1.propsKeywords){if(Kt&&typeof Kt=="object")for(var zt in Kt)_traverse($t,e,_t,Kt[zt],xt+"/"+jt+"/"+escapeJsonPtr(zt),kt,xt,jt,At,zt)}else(jt in traverse$1.keywords||$t.allKeys&&!(jt in traverse$1.skipKeywords))&&_traverse($t,e,_t,Kt,xt+"/"+jt,kt,xt,jt,At)}_t(At,xt,kt,Bt,Nt,Ut,Lt)}}function escapeJsonPtr($t){return $t.replace(/~/g,"~0").replace(/\//g,"~1")}var jsonSchemaTraverseExports=jsonSchemaTraverse.exports;Object.defineProperty(resolve$5,"__esModule",{value:!0});resolve$5.getSchemaRefs=resolve$5.resolveUrl=resolve$5.normalizeId=resolve$5._getFullPath=resolve$5.getFullPath=resolve$5.inlineRef=void 0;const util_1$q=util$1,equal$2=fastDeepEqual,traverse=jsonSchemaTraverseExports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef($t,e=!0){return typeof $t=="boolean"?!0:e===!0?!hasRef($t):e?countKeys($t)<=e:!1}resolve$5.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef($t){for(const e in $t){if(REF_KEYWORDS.has(e))return!0;const _t=$t[e];if(Array.isArray(_t)&&_t.some(hasRef)||typeof _t=="object"&&hasRef(_t))return!0}return!1}function countKeys($t){let e=0;for(const _t in $t){if(_t==="$ref")return 1/0;if(e++,!SIMPLE_INLINED.has(_t)&&(typeof $t[_t]=="object"&&(0,util_1$q.eachItem)($t[_t],At=>e+=countKeys(At)),e===1/0))return 1/0}return e}function getFullPath($t,e="",_t){_t!==!1&&(e=normalizeId(e));const At=$t.parse(e);return _getFullPath($t,At)}resolve$5.getFullPath=getFullPath;function _getFullPath($t,e){return $t.serialize(e).split("#")[0]+"#"}resolve$5._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId($t){return $t?$t.replace(TRAILING_SLASH_HASH,""):""}resolve$5.normalizeId=normalizeId;function resolveUrl($t,e,_t){return _t=normalizeId(_t),$t.resolve(e,_t)}resolve$5.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs($t,e){if(typeof $t=="boolean")return{};const{schemaId:_t,uriResolver:At}=this.opts,xt=normalizeId($t[_t]||e),kt={"":xt},Bt=getFullPath(At,xt,!1),Nt={},Ut=new Set;return traverse($t,{allKeys:!0},(Kt,qt,zt,Vt)=>{if(Vt===void 0)return;const Ht=Bt+qt;let Wt=kt[Vt];typeof Kt[_t]=="string"&&(Wt=Qt.call(this,Kt[_t])),Xt.call(this,Kt.$anchor),Xt.call(this,Kt.$dynamicAnchor),kt[qt]=Wt;function Qt(Jt){const tr=this.opts.uriResolver.resolve;if(Jt=normalizeId(Wt?tr(Wt,Jt):Jt),Ut.has(Jt))throw jt(Jt);Ut.add(Jt);let dr=this.refs[Jt];return typeof dr=="string"&&(dr=this.refs[dr]),typeof dr=="object"?Lt(Kt,dr.schema,Jt):Jt!==normalizeId(Ht)&&(Jt[0]==="#"?(Lt(Kt,Nt[Jt],Jt),Nt[Jt]=Kt):this.refs[Jt]=Ht),Jt}function Xt(Jt){if(typeof Jt=="string"){if(!ANCHOR.test(Jt))throw new Error(`invalid anchor "${Jt}"`);Qt.call(this,`#${Jt}`)}}}),Nt;function Lt(Kt,qt,zt){if(qt!==void 0&&!equal$2(Kt,qt))throw jt(zt)}function jt(Kt){return new Error(`reference "${Kt}" resolves to more than one schema`)}}resolve$5.getSchemaRefs=getSchemaRefs;Object.defineProperty(validate,"__esModule",{value:!0});validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$r=codegen,names_1$6=names$1,resolve_1$2=resolve$5,util_1$p=util$1,errors_1=errors$1;function validateFunctionCode($t){if(isSchemaObj($t)&&(checkKeywords($t),schemaCxtHasRules($t))){topSchemaObjCode($t);return}validateFunction$3($t,()=>(0,boolSchema_1.topBoolOrEmptySchema)($t))}validate.validateFunctionCode=validateFunctionCode;function validateFunction$3({gen:$t,validateName:e,schema:_t,schemaEnv:At,opts:xt},kt){xt.code.es5?$t.func(e,(0,codegen_1$r._)`${names_1$6.default.data}, ${names_1$6.default.valCxt}`,At.$async,()=>{$t.code((0,codegen_1$r._)`"use strict"; ${funcSourceUrl(_t,xt)}`),destructureValCxtES5($t,xt),$t.code(kt)}):$t.func(e,(0,codegen_1$r._)`${names_1$6.default.data}, ${destructureValCxt(xt)}`,At.$async,()=>$t.code(funcSourceUrl(_t,xt)).code(kt))}function destructureValCxt($t){return(0,codegen_1$r._)`{${names_1$6.default.instancePath}="", ${names_1$6.default.parentData}, ${names_1$6.default.parentDataProperty}, ${names_1$6.default.rootData}=${names_1$6.default.data}${$t.dynamicRef?(0,codegen_1$r._)`, ${names_1$6.default.dynamicAnchors}={}`:codegen_1$r.nil}}={}`}function destructureValCxtES5($t,e){$t.if(names_1$6.default.valCxt,()=>{$t.var(names_1$6.default.instancePath,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.instancePath}`),$t.var(names_1$6.default.parentData,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.parentData}`),$t.var(names_1$6.default.parentDataProperty,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.parentDataProperty}`),$t.var(names_1$6.default.rootData,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.rootData}`),e.dynamicRef&&$t.var(names_1$6.default.dynamicAnchors,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.dynamicAnchors}`)},()=>{$t.var(names_1$6.default.instancePath,(0,codegen_1$r._)`""`),$t.var(names_1$6.default.parentData,(0,codegen_1$r._)`undefined`),$t.var(names_1$6.default.parentDataProperty,(0,codegen_1$r._)`undefined`),$t.var(names_1$6.default.rootData,names_1$6.default.data),e.dynamicRef&&$t.var(names_1$6.default.dynamicAnchors,(0,codegen_1$r._)`{}`)})}function topSchemaObjCode($t){const{schema:e,opts:_t,gen:At}=$t;validateFunction$3($t,()=>{_t.$comment&&e.$comment&&commentKeyword($t),checkNoDefault($t),At.let(names_1$6.default.vErrors,null),At.let(names_1$6.default.errors,0),_t.unevaluated&&resetEvaluated($t),typeAndKeywords($t),returnResults($t)})}function resetEvaluated($t){const{gen:e,validateName:_t}=$t;$t.evaluated=e.const("evaluated",(0,codegen_1$r._)`${_t}.evaluated`),e.if((0,codegen_1$r._)`${$t.evaluated}.dynamicProps`,()=>e.assign((0,codegen_1$r._)`${$t.evaluated}.props`,(0,codegen_1$r._)`undefined`)),e.if((0,codegen_1$r._)`${$t.evaluated}.dynamicItems`,()=>e.assign((0,codegen_1$r._)`${$t.evaluated}.items`,(0,codegen_1$r._)`undefined`))}function funcSourceUrl($t,e){const _t=typeof $t=="object"&&$t[e.schemaId];return _t&&(e.code.source||e.code.process)?(0,codegen_1$r._)`/*# sourceURL=${_t} */`:codegen_1$r.nil}function subschemaCode($t,e){if(isSchemaObj($t)&&(checkKeywords($t),schemaCxtHasRules($t))){subSchemaObjCode($t,e);return}(0,boolSchema_1.boolOrEmptySchema)($t,e)}function schemaCxtHasRules({schema:$t,self:e}){if(typeof $t=="boolean")return!$t;for(const _t in $t)if(e.RULES.all[_t])return!0;return!1}function isSchemaObj($t){return typeof $t.schema!="boolean"}function subSchemaObjCode($t,e){const{schema:_t,gen:At,opts:xt}=$t;xt.$comment&&_t.$comment&&commentKeyword($t),updateContext($t),checkAsyncSchema($t);const kt=At.const("_errs",names_1$6.default.errors);typeAndKeywords($t,kt),At.var(e,(0,codegen_1$r._)`${kt} === ${names_1$6.default.errors}`)}function checkKeywords($t){(0,util_1$p.checkUnknownRules)($t),checkRefsAndKeywords($t)}function typeAndKeywords($t,e){if($t.opts.jtd)return schemaKeywords($t,[],!1,e);const _t=(0,dataType_1$1.getSchemaTypes)($t.schema),At=(0,dataType_1$1.coerceAndCheckDataType)($t,_t);schemaKeywords($t,_t,!At,e)}function checkRefsAndKeywords($t){const{schema:e,errSchemaPath:_t,opts:At,self:xt}=$t;e.$ref&&At.ignoreKeywordsWithRef&&(0,util_1$p.schemaHasRulesButRef)(e,xt.RULES)&&xt.logger.warn(`$ref: keywords ignored in schema at path "${_t}"`)}function checkNoDefault($t){const{schema:e,opts:_t}=$t;e.default!==void 0&&_t.useDefaults&&_t.strictSchema&&(0,util_1$p.checkStrictMode)($t,"default is ignored in the schema root")}function updateContext($t){const e=$t.schema[$t.opts.schemaId];e&&($t.baseId=(0,resolve_1$2.resolveUrl)($t.opts.uriResolver,$t.baseId,e))}function checkAsyncSchema($t){if($t.schema.$async&&!$t.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:$t,schemaEnv:e,schema:_t,errSchemaPath:At,opts:xt}){const kt=_t.$comment;if(xt.$comment===!0)$t.code((0,codegen_1$r._)`${names_1$6.default.self}.logger.log(${kt})`);else if(typeof xt.$comment=="function"){const Bt=(0,codegen_1$r.str)`${At}/$comment`,Nt=$t.scopeValue("root",{ref:e.root});$t.code((0,codegen_1$r._)`${names_1$6.default.self}.opts.$comment(${kt}, ${Bt}, ${Nt}.schema)`)}}function returnResults($t){const{gen:e,schemaEnv:_t,validateName:At,ValidationError:xt,opts:kt}=$t;_t.$async?e.if((0,codegen_1$r._)`${names_1$6.default.errors} === 0`,()=>e.return(names_1$6.default.data),()=>e.throw((0,codegen_1$r._)`new ${xt}(${names_1$6.default.vErrors})`)):(e.assign((0,codegen_1$r._)`${At}.errors`,names_1$6.default.vErrors),kt.unevaluated&&assignEvaluated($t),e.return((0,codegen_1$r._)`${names_1$6.default.errors} === 0`))}function assignEvaluated({gen:$t,evaluated:e,props:_t,items:At}){_t instanceof codegen_1$r.Name&&$t.assign((0,codegen_1$r._)`${e}.props`,_t),At instanceof codegen_1$r.Name&&$t.assign((0,codegen_1$r._)`${e}.items`,At)}function schemaKeywords($t,e,_t,At){const{gen:xt,schema:kt,data:Bt,allErrors:Nt,opts:Ut,self:Lt}=$t,{RULES:jt}=Lt;if(kt.$ref&&(Ut.ignoreKeywordsWithRef||!(0,util_1$p.schemaHasRulesButRef)(kt,jt))){xt.block(()=>keywordCode($t,"$ref",jt.all.$ref.definition));return}Ut.jtd||checkStrictTypes($t,e),xt.block(()=>{for(const qt of jt.rules)Kt(qt);Kt(jt.post)});function Kt(qt){(0,applicability_1.shouldUseGroup)(kt,qt)&&(qt.type?(xt.if((0,dataType_2.checkDataType)(qt.type,Bt,Ut.strictNumbers)),iterateKeywords($t,qt),e.length===1&&e[0]===qt.type&&_t&&(xt.else(),(0,dataType_2.reportTypeError)($t)),xt.endIf()):iterateKeywords($t,qt),Nt||xt.if((0,codegen_1$r._)`${names_1$6.default.errors} === ${At||0}`))}}function iterateKeywords($t,e){const{gen:_t,schema:At,opts:{useDefaults:xt}}=$t;xt&&(0,defaults_1.assignDefaults)($t,e.type),_t.block(()=>{for(const kt of e.rules)(0,applicability_1.shouldUseRule)(At,kt)&&keywordCode($t,kt.keyword,kt.definition,e.type)})}function checkStrictTypes($t,e){$t.schemaEnv.meta||!$t.opts.strictTypes||(checkContextTypes($t,e),$t.opts.allowUnionTypes||checkMultipleTypes($t,e),checkKeywordTypes($t,$t.dataTypes))}function checkContextTypes($t,e){if(e.length){if(!$t.dataTypes.length){$t.dataTypes=e;return}e.forEach(_t=>{includesType($t.dataTypes,_t)||strictTypesError($t,`type "${_t}" not allowed by context "${$t.dataTypes.join(",")}"`)}),narrowSchemaTypes($t,e)}}function checkMultipleTypes($t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&strictTypesError($t,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes($t,e){const _t=$t.self.RULES.all;for(const At in _t){const xt=_t[At];if(typeof xt=="object"&&(0,applicability_1.shouldUseRule)($t.schema,xt)){const{type:kt}=xt.definition;kt.length&&!kt.some(Bt=>hasApplicableType(e,Bt))&&strictTypesError($t,`missing type "${kt.join(",")}" for keyword "${At}"`)}}}function hasApplicableType($t,e){return $t.includes(e)||e==="number"&&$t.includes("integer")}function includesType($t,e){return $t.includes(e)||e==="integer"&&$t.includes("number")}function narrowSchemaTypes($t,e){const _t=[];for(const At of $t.dataTypes)includesType(e,At)?_t.push(At):e.includes("integer")&&At==="number"&&_t.push("integer");$t.dataTypes=_t}function strictTypesError($t,e){const _t=$t.schemaEnv.baseId+$t.errSchemaPath;e+=` at "${_t}" (strictTypes)`,(0,util_1$p.checkStrictMode)($t,e,$t.opts.strictTypes)}class KeywordCxt{constructor(e,_t,At){if((0,keyword_1.validateKeywordUsage)(e,_t,At),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=At,this.data=e.data,this.schema=e.schema[At],this.$data=_t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$p.schemaRefOrVal)(e,this.schema,At,this.$data),this.schemaType=_t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=_t,this.$data)this.schemaCode=e.gen.const("vSchema",getData(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,_t.schemaType,_t.allowUndefined))throw new Error(`${At} value must be ${JSON.stringify(_t.schemaType)}`);("code"in _t?_t.trackErrors:_t.errors!==!1)&&(this.errsCount=e.gen.const("_errs",names_1$6.default.errors))}result(e,_t,At){this.failResult((0,codegen_1$r.not)(e),_t,At)}failResult(e,_t,At){this.gen.if(e),At?At():this.error(),_t?(this.gen.else(),_t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,_t){this.failResult((0,codegen_1$r.not)(e),void 0,_t)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:_t}=this;this.fail((0,codegen_1$r._)`${_t} !== undefined && (${(0,codegen_1$r.or)(this.invalid$data(),e)})`)}error(e,_t,At){if(_t){this.setParams(_t),this._error(e,At),this.setParams({});return}this._error(e,At)}_error(e,_t){(e?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,_t)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,_t){_t?Object.assign(this.params,e):this.params=e}block$data(e,_t,At=codegen_1$r.nil){this.gen.block(()=>{this.check$data(e,At),_t()})}check$data(e=codegen_1$r.nil,_t=codegen_1$r.nil){if(!this.$data)return;const{gen:At,schemaCode:xt,schemaType:kt,def:Bt}=this;At.if((0,codegen_1$r.or)((0,codegen_1$r._)`${xt} === undefined`,_t)),e!==codegen_1$r.nil&&At.assign(e,!0),(kt.length||Bt.validateSchema)&&(At.elseIf(this.invalid$data()),this.$dataError(),e!==codegen_1$r.nil&&At.assign(e,!1)),At.else()}invalid$data(){const{gen:e,schemaCode:_t,schemaType:At,def:xt,it:kt}=this;return(0,codegen_1$r.or)(Bt(),Nt());function Bt(){if(At.length){if(!(_t instanceof codegen_1$r.Name))throw new Error("ajv implementation error");const Ut=Array.isArray(At)?At:[At];return(0,codegen_1$r._)`${(0,dataType_2.checkDataTypes)(Ut,_t,kt.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$r.nil}function Nt(){if(xt.validateSchema){const Ut=e.scopeValue("validate$data",{ref:xt.validateSchema});return(0,codegen_1$r._)`!${Ut}(${_t})`}return codegen_1$r.nil}}subschema(e,_t){const At=(0,subschema_1.getSubschema)(this.it,e);(0,subschema_1.extendSubschemaData)(At,this.it,e),(0,subschema_1.extendSubschemaMode)(At,e);const xt={...this.it,...At,items:void 0,props:void 0};return subschemaCode(xt,_t),xt}mergeEvaluated(e,_t){const{it:At,gen:xt}=this;At.opts.unevaluated&&(At.props!==!0&&e.props!==void 0&&(At.props=util_1$p.mergeEvaluated.props(xt,e.props,At.props,_t)),At.items!==!0&&e.items!==void 0&&(At.items=util_1$p.mergeEvaluated.items(xt,e.items,At.items,_t)))}mergeValidEvaluated(e,_t){const{it:At,gen:xt}=this;if(At.opts.unevaluated&&(At.props!==!0||At.items!==!0))return xt.if(_t,()=>this.mergeEvaluated(e,codegen_1$r.Name)),!0}}validate.KeywordCxt=KeywordCxt;function keywordCode($t,e,_t,At){const xt=new KeywordCxt($t,_t,e);"code"in _t?_t.code(xt,At):xt.$data&&_t.validate?(0,keyword_1.funcKeywordCode)(xt,_t):"macro"in _t?(0,keyword_1.macroKeywordCode)(xt,_t):(_t.compile||_t.validate)&&(0,keyword_1.funcKeywordCode)(xt,_t)}const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData($t,{dataLevel:e,dataNames:_t,dataPathArr:At}){let xt,kt;if($t==="")return names_1$6.default.rootData;if($t[0]==="/"){if(!JSON_POINTER.test($t))throw new Error(`Invalid JSON-pointer: ${$t}`);xt=$t,kt=names_1$6.default.rootData}else{const Lt=RELATIVE_JSON_POINTER.exec($t);if(!Lt)throw new Error(`Invalid JSON-pointer: ${$t}`);const jt=+Lt[1];if(xt=Lt[2],xt==="#"){if(jt>=e)throw new Error(Ut("property/index",jt));return At[e-jt]}if(jt>e)throw new Error(Ut("data",jt));if(kt=_t[e-jt],!xt)return kt}let Bt=kt;const Nt=xt.split("/");for(const Lt of Nt)Lt&&(kt=(0,codegen_1$r._)`${kt}${(0,codegen_1$r.getProperty)((0,util_1$p.unescapeJsonPointer)(Lt))}`,Bt=(0,codegen_1$r._)`${Bt} && ${kt}`);return Bt;function Ut(Lt,jt){return`Cannot access ${Lt} ${jt} levels up, current level is ${e}`}}validate.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$5;class MissingRefError extends Error{constructor(e,_t,At,xt){super(xt||`can't resolve reference ${At} from id ${_t}`),this.missingRef=(0,resolve_1$1.resolveUrl)(e,_t,At),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(e,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0});compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$q=codegen,validation_error_1=validation_error,names_1$5=names$1,resolve_1=resolve$5,util_1$o=util$1,validate_1$1=validate;class SchemaEnv{constructor(e){var _t;this.refs={},this.dynamicAnchors={};let At;typeof e.schema=="object"&&(At=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(_t=e.baseId)!==null&&_t!==void 0?_t:(0,resolve_1.normalizeId)(At==null?void 0:At[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=At==null?void 0:At.$async,this.refs={}}}compile.SchemaEnv=SchemaEnv;function compileSchema($t){const e=getCompilingSchema.call(this,$t);if(e)return e;const _t=(0,resolve_1.getFullPath)(this.opts.uriResolver,$t.root.baseId),{es5:At,lines:xt}=this.opts.code,{ownProperties:kt}=this.opts,Bt=new codegen_1$q.CodeGen(this.scope,{es5:At,lines:xt,ownProperties:kt});let Nt;$t.$async&&(Nt=Bt.scopeValue("Error",{ref:validation_error_1.default,code:(0,codegen_1$q._)`require("ajv/dist/runtime/validation_error").default`}));const Ut=Bt.scopeName("validate");$t.validateName=Ut;const Lt={gen:Bt,allErrors:this.opts.allErrors,data:names_1$5.default.data,parentData:names_1$5.default.parentData,parentDataProperty:names_1$5.default.parentDataProperty,dataNames:[names_1$5.default.data],dataPathArr:[codegen_1$q.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:Bt.scopeValue("schema",this.opts.code.source===!0?{ref:$t.schema,code:(0,codegen_1$q.stringify)($t.schema)}:{ref:$t.schema}),validateName:Ut,ValidationError:Nt,schema:$t.schema,schemaEnv:$t,rootId:_t,baseId:$t.baseId||_t,schemaPath:codegen_1$q.nil,errSchemaPath:$t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,codegen_1$q._)`""`,opts:this.opts,self:this};let jt;try{this._compilations.add($t),(0,validate_1$1.validateFunctionCode)(Lt),Bt.optimize(this.opts.code.optimize);const Kt=Bt.toString();jt=`${Bt.scopeRefs(names_1$5.default.scope)}return ${Kt}`,this.opts.code.process&&(jt=this.opts.code.process(jt,$t));const zt=new Function(`${names_1$5.default.self}`,`${names_1$5.default.scope}`,jt)(this,this.scope.get());if(this.scope.value(Ut,{ref:zt}),zt.errors=null,zt.schema=$t.schema,zt.schemaEnv=$t,$t.$async&&(zt.$async=!0),this.opts.code.source===!0&&(zt.source={validateName:Ut,validateCode:Kt,scopeValues:Bt._values}),this.opts.unevaluated){const{props:Vt,items:Ht}=Lt;zt.evaluated={props:Vt instanceof codegen_1$q.Name?void 0:Vt,items:Ht instanceof codegen_1$q.Name?void 0:Ht,dynamicProps:Vt instanceof codegen_1$q.Name,dynamicItems:Ht instanceof codegen_1$q.Name},zt.source&&(zt.source.evaluated=(0,codegen_1$q.stringify)(zt.evaluated))}return $t.validate=zt,$t}catch(Kt){throw delete $t.validate,delete $t.validateName,jt&&this.logger.error("Error compiling schema, function code:",jt),Kt}finally{this._compilations.delete($t)}}compile.compileSchema=compileSchema;function resolveRef($t,e,_t){var At;_t=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,_t);const xt=$t.refs[_t];if(xt)return xt;let kt=resolve$4.call(this,$t,_t);if(kt===void 0){const Bt=(At=$t.localRefs)===null||At===void 0?void 0:At[_t],{schemaId:Nt}=this.opts;Bt&&(kt=new SchemaEnv({schema:Bt,schemaId:Nt,root:$t,baseId:e}))}if(kt!==void 0)return $t.refs[_t]=inlineOrCompile.call(this,kt)}compile.resolveRef=resolveRef;function inlineOrCompile($t){return(0,resolve_1.inlineRef)($t.schema,this.opts.inlineRefs)?$t.schema:$t.validate?$t:compileSchema.call(this,$t)}function getCompilingSchema($t){for(const e of this._compilations)if(sameSchemaEnv(e,$t))return e}compile.getCompilingSchema=getCompilingSchema;function sameSchemaEnv($t,e){return $t.schema===e.schema&&$t.root===e.root&&$t.baseId===e.baseId}function resolve$4($t,e){let _t;for(;typeof(_t=this.refs[e])=="string";)e=_t;return _t||this.schemas[e]||resolveSchema.call(this,$t,e)}function resolveSchema($t,e){const _t=this.opts.uriResolver.parse(e),At=(0,resolve_1._getFullPath)(this.opts.uriResolver,_t);let xt=(0,resolve_1.getFullPath)(this.opts.uriResolver,$t.baseId,void 0);if(Object.keys($t.schema).length>0&&At===xt)return getJsonPointer.call(this,_t,$t);const kt=(0,resolve_1.normalizeId)(At),Bt=this.refs[kt]||this.schemas[kt];if(typeof Bt=="string"){const Nt=resolveSchema.call(this,$t,Bt);return typeof(Nt==null?void 0:Nt.schema)!="object"?void 0:getJsonPointer.call(this,_t,Nt)}if(typeof(Bt==null?void 0:Bt.schema)=="object"){if(Bt.validate||compileSchema.call(this,Bt),kt===(0,resolve_1.normalizeId)(e)){const{schema:Nt}=Bt,{schemaId:Ut}=this.opts,Lt=Nt[Ut];return Lt&&(xt=(0,resolve_1.resolveUrl)(this.opts.uriResolver,xt,Lt)),new SchemaEnv({schema:Nt,schemaId:Ut,root:$t,baseId:xt})}return getJsonPointer.call(this,_t,Bt)}}compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer($t,{baseId:e,schema:_t,root:At}){var xt;if(((xt=$t.fragment)===null||xt===void 0?void 0:xt[0])!=="/")return;for(const Nt of $t.fragment.slice(1).split("/")){if(typeof _t=="boolean")return;const Ut=_t[(0,util_1$o.unescapeFragment)(Nt)];if(Ut===void 0)return;_t=Ut;const Lt=typeof _t=="object"&&_t[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(Nt)&&Lt&&(e=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,Lt))}let kt;if(typeof _t!="boolean"&&_t.$ref&&!(0,util_1$o.schemaHasRulesButRef)(_t,this.RULES)){const Nt=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,_t.$ref);kt=resolveSchema.call(this,At,Nt)}const{schemaId:Bt}=this.opts;if(kt=kt||new SchemaEnv({schema:_t,schemaId:Bt,root:At,baseId:e}),kt.schema!==kt.root.schema)return kt}const $id$8="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$8="object",required$1=["$data"],properties$9={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$8,description,type:type$8,required:required$1,properties:properties$9,additionalProperties:additionalProperties$1};var uri$1={},uri_all={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function($t,e){(function(_t,At){At(e)})(commonjsGlobal,function(_t){function At(){for(var Jr=arguments.length,Vr=Array(Jr),Xr=0;Xr<Jr;Xr++)Vr[Xr]=arguments[Xr];if(Vr.length>1){Vr[0]=Vr[0].slice(0,-1);for(var tn=Vr.length-1,on=1;on<tn;++on)Vr[on]=Vr[on].slice(1,-1);return Vr[tn]=Vr[tn].slice(1),Vr.join("")}else return Vr[0]}function xt(Jr){return"(?:"+Jr+")"}function kt(Jr){return Jr===void 0?"undefined":Jr===null?"null":Object.prototype.toString.call(Jr).split(" ").pop().split("]").shift().toLowerCase()}function Bt(Jr){return Jr.toUpperCase()}function Nt(Jr){return Jr!=null?Jr instanceof Array?Jr:typeof Jr.length!="number"||Jr.split||Jr.setInterval||Jr.call?[Jr]:Array.prototype.slice.call(Jr):[]}function Ut(Jr,Vr){var Xr=Jr;if(Vr)for(var tn in Vr)Xr[tn]=Vr[tn];return Xr}function Lt(Jr){var Vr="[A-Za-z]",Xr="[0-9]",tn=At(Xr,"[A-Fa-f]"),on=xt(xt("%[EFef]"+tn+"%"+tn+tn+"%"+tn+tn)+"|"+xt("%[89A-Fa-f]"+tn+"%"+tn+tn)+"|"+xt("%"+tn+tn)),pn="[\\:\\/\\?\\#\\[\\]\\@]",fn="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",vn=At(pn,fn),En=Jr?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Tn=Jr?"[\\uE000-\\uF8FF]":"[]",In=At(Vr,Xr,"[\\-\\.\\_\\~]",En);xt(Vr+At(Vr,Xr,"[\\+\\-\\.]")+"*"),xt(xt(on+"|"+At(In,fn,"[\\:]"))+"*");var Rn=xt(xt("25[0-5]")+"|"+xt("2[0-4]"+Xr)+"|"+xt("1"+Xr+Xr)+"|"+xt("0?[1-9]"+Xr)+"|0?0?"+Xr),Vn=xt(Rn+"\\."+Rn+"\\."+Rn+"\\."+Rn),An=xt(tn+"{1,4}"),Fn=xt(xt(An+"\\:"+An)+"|"+Vn),Wn=xt(xt(An+"\\:")+"{6}"+Fn),qn=xt("\\:\\:"+xt(An+"\\:")+"{5}"+Fn),si=xt(xt(An)+"?\\:\\:"+xt(An+"\\:")+"{4}"+Fn),ei=xt(xt(xt(An+"\\:")+"{0,1}"+An)+"?\\:\\:"+xt(An+"\\:")+"{3}"+Fn),ti=xt(xt(xt(An+"\\:")+"{0,2}"+An)+"?\\:\\:"+xt(An+"\\:")+"{2}"+Fn),hi=xt(xt(xt(An+"\\:")+"{0,3}"+An)+"?\\:\\:"+An+"\\:"+Fn),li=xt(xt(xt(An+"\\:")+"{0,4}"+An)+"?\\:\\:"+Fn),Zn=xt(xt(xt(An+"\\:")+"{0,5}"+An)+"?\\:\\:"+An),ri=xt(xt(xt(An+"\\:")+"{0,6}"+An)+"?\\:\\:"),ui=xt([Wn,qn,si,ei,ti,hi,li,Zn,ri].join("|")),ii=xt(xt(In+"|"+on)+"+");xt("[vV]"+tn+"+\\."+At(In,fn,"[\\:]")+"+"),xt(xt(on+"|"+At(In,fn))+"*");var mi=xt(on+"|"+At(In,fn,"[\\:\\@]"));return xt(xt(on+"|"+At(In,fn,"[\\@]"))+"+"),xt(xt(mi+"|"+At("[\\/\\?]",Tn))+"*"),{NOT_SCHEME:new RegExp(At("[^]",Vr,Xr,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(At("[^\\%\\:]",In,fn),"g"),NOT_HOST:new RegExp(At("[^\\%\\[\\]\\:]",In,fn),"g"),NOT_PATH:new RegExp(At("[^\\%\\/\\:\\@]",In,fn),"g"),NOT_PATH_NOSCHEME:new RegExp(At("[^\\%\\/\\@]",In,fn),"g"),NOT_QUERY:new RegExp(At("[^\\%]",In,fn,"[\\:\\@\\/\\?]",Tn),"g"),NOT_FRAGMENT:new RegExp(At("[^\\%]",In,fn,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(At("[^]",In,fn),"g"),UNRESERVED:new RegExp(In,"g"),OTHER_CHARS:new RegExp(At("[^\\%]",In,vn),"g"),PCT_ENCODED:new RegExp(on,"g"),IPV4ADDRESS:new RegExp("^("+Vn+")$"),IPV6ADDRESS:new RegExp("^\\[?("+ui+")"+xt(xt("\\%25|\\%(?!"+tn+"{2})")+"("+ii+")")+"?\\]?$")}}var jt=Lt(!1),Kt=Lt(!0),qt=function(){function Jr(Vr,Xr){var tn=[],on=!0,pn=!1,fn=void 0;try{for(var vn=Vr[Symbol.iterator](),En;!(on=(En=vn.next()).done)&&(tn.push(En.value),!(Xr&&tn.length===Xr));on=!0);}catch(Tn){pn=!0,fn=Tn}finally{try{!on&&vn.return&&vn.return()}finally{if(pn)throw fn}}return tn}return function(Vr,Xr){if(Array.isArray(Vr))return Vr;if(Symbol.iterator in Object(Vr))return Jr(Vr,Xr);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),zt=function(Jr){if(Array.isArray(Jr)){for(var Vr=0,Xr=Array(Jr.length);Vr<Jr.length;Vr++)Xr[Vr]=Jr[Vr];return Xr}else return Array.from(Jr)},Vt=2147483647,Ht=36,Wt=1,Qt=26,Xt=38,Jt=700,tr=72,dr=128,vr="-",$r=/^xn--/,Ir=/[^\0-\x7E]/,Rr=/[\x2E\u3002\uFF0E\uFF61]/g,Nr={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},kr=Ht-Wt,lr=Math.floor,ir=String.fromCharCode;function er(Jr){throw new RangeError(Nr[Jr])}function rr(Jr,Vr){for(var Xr=[],tn=Jr.length;tn--;)Xr[tn]=Vr(Jr[tn]);return Xr}function yr(Jr,Vr){var Xr=Jr.split("@"),tn="";Xr.length>1&&(tn=Xr[0]+"@",Jr=Xr[1]),Jr=Jr.replace(Rr,".");var on=Jr.split("."),pn=rr(on,Vr).join(".");return tn+pn}function fr(Jr){for(var Vr=[],Xr=0,tn=Jr.length;Xr<tn;){var on=Jr.charCodeAt(Xr++);if(on>=55296&&on<=56319&&Xr<tn){var pn=Jr.charCodeAt(Xr++);(pn&64512)==56320?Vr.push(((on&1023)<<10)+(pn&1023)+65536):(Vr.push(on),Xr--)}else Vr.push(on)}return Vr}var gr=function(Vr){return String.fromCodePoint.apply(String,zt(Vr))},ar=function(Vr){return Vr-48<10?Vr-22:Vr-65<26?Vr-65:Vr-97<26?Vr-97:Ht},nr=function(Vr,Xr){return Vr+22+75*(Vr<26)-((Xr!=0)<<5)},ur=function(Vr,Xr,tn){var on=0;for(Vr=tn?lr(Vr/Jt):Vr>>1,Vr+=lr(Vr/Xr);Vr>kr*Qt>>1;on+=Ht)Vr=lr(Vr/kr);return lr(on+(kr+1)*Vr/(Vr+Xt))},pr=function(Vr){var Xr=[],tn=Vr.length,on=0,pn=dr,fn=tr,vn=Vr.lastIndexOf(vr);vn<0&&(vn=0);for(var En=0;En<vn;++En)Vr.charCodeAt(En)>=128&&er("not-basic"),Xr.push(Vr.charCodeAt(En));for(var Tn=vn>0?vn+1:0;Tn<tn;){for(var In=on,Rn=1,Vn=Ht;;Vn+=Ht){Tn>=tn&&er("invalid-input");var An=ar(Vr.charCodeAt(Tn++));(An>=Ht||An>lr((Vt-on)/Rn))&&er("overflow"),on+=An*Rn;var Fn=Vn<=fn?Wt:Vn>=fn+Qt?Qt:Vn-fn;if(An<Fn)break;var Wn=Ht-Fn;Rn>lr(Vt/Wn)&&er("overflow"),Rn*=Wn}var qn=Xr.length+1;fn=ur(on-In,qn,In==0),lr(on/qn)>Vt-pn&&er("overflow"),pn+=lr(on/qn),on%=qn,Xr.splice(on++,0,pn)}return String.fromCodePoint.apply(String,Xr)},br=function(Vr){var Xr=[];Vr=fr(Vr);var tn=Vr.length,on=dr,pn=0,fn=tr,vn=!0,En=!1,Tn=void 0;try{for(var In=Vr[Symbol.iterator](),Rn;!(vn=(Rn=In.next()).done);vn=!0){var Vn=Rn.value;Vn<128&&Xr.push(ir(Vn))}}catch(ao){En=!0,Tn=ao}finally{try{!vn&&In.return&&In.return()}finally{if(En)throw Tn}}var An=Xr.length,Fn=An;for(An&&Xr.push(vr);Fn<tn;){var Wn=Vt,qn=!0,si=!1,ei=void 0;try{for(var ti=Vr[Symbol.iterator](),hi;!(qn=(hi=ti.next()).done);qn=!0){var li=hi.value;li>=on&&li<Wn&&(Wn=li)}}catch(ao){si=!0,ei=ao}finally{try{!qn&&ti.return&&ti.return()}finally{if(si)throw ei}}var Zn=Fn+1;Wn-on>lr((Vt-pn)/Zn)&&er("overflow"),pn+=(Wn-on)*Zn,on=Wn;var ri=!0,ui=!1,ii=void 0;try{for(var mi=Vr[Symbol.iterator](),Qi;!(ri=(Qi=mi.next()).done);ri=!0){var Xi=Qi.value;if(Xi<on&&++pn>Vt&&er("overflow"),Xi==on){for(var vo=pn,bo=Ht;;bo+=Ht){var wo=bo<=fn?Wt:bo>=fn+Qt?Qt:bo-fn;if(vo<wo)break;var Oo=vo-wo,Mo=Ht-wo;Xr.push(ir(nr(wo+Oo%Mo,0))),vo=lr(Oo/Mo)}Xr.push(ir(nr(vo,0))),fn=ur(pn,Zn,Fn==An),pn=0,++Fn}}}catch(ao){ui=!0,ii=ao}finally{try{!ri&&mi.return&&mi.return()}finally{if(ui)throw ii}}++pn,++on}return Xr.join("")},Sr=function(Vr){return yr(Vr,function(Xr){return $r.test(Xr)?pr(Xr.slice(4).toLowerCase()):Xr})},Pr=function(Vr){return yr(Vr,function(Xr){return Ir.test(Xr)?"xn--"+br(Xr):Xr})},Tr={version:"2.1.0",ucs2:{decode:fr,encode:gr},decode:pr,encode:br,toASCII:Pr,toUnicode:Sr},wr={};function Ar(Jr){var Vr=Jr.charCodeAt(0),Xr=void 0;return Vr<16?Xr="%0"+Vr.toString(16).toUpperCase():Vr<128?Xr="%"+Vr.toString(16).toUpperCase():Vr<2048?Xr="%"+(Vr>>6|192).toString(16).toUpperCase()+"%"+(Vr&63|128).toString(16).toUpperCase():Xr="%"+(Vr>>12|224).toString(16).toUpperCase()+"%"+(Vr>>6&63|128).toString(16).toUpperCase()+"%"+(Vr&63|128).toString(16).toUpperCase(),Xr}function Mr(Jr){for(var Vr="",Xr=0,tn=Jr.length;Xr<tn;){var on=parseInt(Jr.substr(Xr+1,2),16);if(on<128)Vr+=String.fromCharCode(on),Xr+=3;else if(on>=194&&on<224){if(tn-Xr>=6){var pn=parseInt(Jr.substr(Xr+4,2),16);Vr+=String.fromCharCode((on&31)<<6|pn&63)}else Vr+=Jr.substr(Xr,6);Xr+=6}else if(on>=224){if(tn-Xr>=9){var fn=parseInt(Jr.substr(Xr+4,2),16),vn=parseInt(Jr.substr(Xr+7,2),16);Vr+=String.fromCharCode((on&15)<<12|(fn&63)<<6|vn&63)}else Vr+=Jr.substr(Xr,9);Xr+=9}else Vr+=Jr.substr(Xr,3),Xr+=3}return Vr}function Ur(Jr,Vr){function Xr(tn){var on=Mr(tn);return on.match(Vr.UNRESERVED)?on:tn}return Jr.scheme&&(Jr.scheme=String(Jr.scheme).replace(Vr.PCT_ENCODED,Xr).toLowerCase().replace(Vr.NOT_SCHEME,"")),Jr.userinfo!==void 0&&(Jr.userinfo=String(Jr.userinfo).replace(Vr.PCT_ENCODED,Xr).replace(Vr.NOT_USERINFO,Ar).replace(Vr.PCT_ENCODED,Bt)),Jr.host!==void 0&&(Jr.host=String(Jr.host).replace(Vr.PCT_ENCODED,Xr).toLowerCase().replace(Vr.NOT_HOST,Ar).replace(Vr.PCT_ENCODED,Bt)),Jr.path!==void 0&&(Jr.path=String(Jr.path).replace(Vr.PCT_ENCODED,Xr).replace(Jr.scheme?Vr.NOT_PATH:Vr.NOT_PATH_NOSCHEME,Ar).replace(Vr.PCT_ENCODED,Bt)),Jr.query!==void 0&&(Jr.query=String(Jr.query).replace(Vr.PCT_ENCODED,Xr).replace(Vr.NOT_QUERY,Ar).replace(Vr.PCT_ENCODED,Bt)),Jr.fragment!==void 0&&(Jr.fragment=String(Jr.fragment).replace(Vr.PCT_ENCODED,Xr).replace(Vr.NOT_FRAGMENT,Ar).replace(Vr.PCT_ENCODED,Bt)),Jr}function Or(Jr){return Jr.replace(/^0*(.*)/,"$1")||"0"}function Cr(Jr,Vr){var Xr=Jr.match(Vr.IPV4ADDRESS)||[],tn=qt(Xr,2),on=tn[1];return on?on.split(".").map(Or).join("."):Jr}function Er(Jr,Vr){var Xr=Jr.match(Vr.IPV6ADDRESS)||[],tn=qt(Xr,3),on=tn[1],pn=tn[2];if(on){for(var fn=on.toLowerCase().split("::").reverse(),vn=qt(fn,2),En=vn[0],Tn=vn[1],In=Tn?Tn.split(":").map(Or):[],Rn=En.split(":").map(Or),Vn=Vr.IPV4ADDRESS.test(Rn[Rn.length-1]),An=Vn?7:8,Fn=Rn.length-An,Wn=Array(An),qn=0;qn<An;++qn)Wn[qn]=In[qn]||Rn[Fn+qn]||"";Vn&&(Wn[An-1]=Cr(Wn[An-1],Vr));var si=Wn.reduce(function(Zn,ri,ui){if(!ri||ri==="0"){var ii=Zn[Zn.length-1];ii&&ii.index+ii.length===ui?ii.length++:Zn.push({index:ui,length:1})}return Zn},[]),ei=si.sort(function(Zn,ri){return ri.length-Zn.length})[0],ti=void 0;if(ei&&ei.length>1){var hi=Wn.slice(0,ei.index),li=Wn.slice(ei.index+ei.length);ti=hi.join(":")+"::"+li.join(":")}else ti=Wn.join(":");return pn&&(ti+="%"+pn),ti}else return Jr}var Br=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Lr="".match(/(){0}/)[1]===void 0;function xr(Jr){var Vr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Xr={},tn=Vr.iri!==!1?Kt:jt;Vr.reference==="suffix"&&(Jr=(Vr.scheme?Vr.scheme+":":"")+"//"+Jr);var on=Jr.match(Br);if(on){Lr?(Xr.scheme=on[1],Xr.userinfo=on[3],Xr.host=on[4],Xr.port=parseInt(on[5],10),Xr.path=on[6]||"",Xr.query=on[7],Xr.fragment=on[8],isNaN(Xr.port)&&(Xr.port=on[5])):(Xr.scheme=on[1]||void 0,Xr.userinfo=Jr.indexOf("@")!==-1?on[3]:void 0,Xr.host=Jr.indexOf("//")!==-1?on[4]:void 0,Xr.port=parseInt(on[5],10),Xr.path=on[6]||"",Xr.query=Jr.indexOf("?")!==-1?on[7]:void 0,Xr.fragment=Jr.indexOf("#")!==-1?on[8]:void 0,isNaN(Xr.port)&&(Xr.port=Jr.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?on[4]:void 0)),Xr.host&&(Xr.host=Er(Cr(Xr.host,tn),tn)),Xr.scheme===void 0&&Xr.userinfo===void 0&&Xr.host===void 0&&Xr.port===void 0&&!Xr.path&&Xr.query===void 0?Xr.reference="same-document":Xr.scheme===void 0?Xr.reference="relative":Xr.fragment===void 0?Xr.reference="absolute":Xr.reference="uri",Vr.reference&&Vr.reference!=="suffix"&&Vr.reference!==Xr.reference&&(Xr.error=Xr.error||"URI is not a "+Vr.reference+" reference.");var pn=wr[(Vr.scheme||Xr.scheme||"").toLowerCase()];if(!Vr.unicodeSupport&&(!pn||!pn.unicodeSupport)){if(Xr.host&&(Vr.domainHost||pn&&pn.domainHost))try{Xr.host=Tr.toASCII(Xr.host.replace(tn.PCT_ENCODED,Mr).toLowerCase())}catch(fn){Xr.error=Xr.error||"Host's domain name can not be converted to ASCII via punycode: "+fn}Ur(Xr,jt)}else Ur(Xr,tn);pn&&pn.parse&&pn.parse(Xr,Vr)}else Xr.error=Xr.error||"URI can not be parsed.";return Xr}function _r(Jr,Vr){var Xr=Vr.iri!==!1?Kt:jt,tn=[];return Jr.userinfo!==void 0&&(tn.push(Jr.userinfo),tn.push("@")),Jr.host!==void 0&&tn.push(Er(Cr(String(Jr.host),Xr),Xr).replace(Xr.IPV6ADDRESS,function(on,pn,fn){return"["+pn+(fn?"%25"+fn:"")+"]"})),(typeof Jr.port=="number"||typeof Jr.port=="string")&&(tn.push(":"),tn.push(String(Jr.port))),tn.length?tn.join(""):void 0}var Dr=/^\.\.?\//,jr=/^\/\.(\/|$)/,Hr=/^\/\.\.(\/|$)/,Qr=/^\/?(?:.|\n)*?(?=\/|$)/;function Yr(Jr){for(var Vr=[];Jr.length;)if(Jr.match(Dr))Jr=Jr.replace(Dr,"");else if(Jr.match(jr))Jr=Jr.replace(jr,"/");else if(Jr.match(Hr))Jr=Jr.replace(Hr,"/"),Vr.pop();else if(Jr==="."||Jr==="..")Jr="";else{var Xr=Jr.match(Qr);if(Xr){var tn=Xr[0];Jr=Jr.slice(tn.length),Vr.push(tn)}else throw new Error("Unexpected dot segment condition")}return Vr.join("")}function an(Jr){var Vr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Xr=Vr.iri?Kt:jt,tn=[],on=wr[(Vr.scheme||Jr.scheme||"").toLowerCase()];if(on&&on.serialize&&on.serialize(Jr,Vr),Jr.host&&!Xr.IPV6ADDRESS.test(Jr.host)){if(Vr.domainHost||on&&on.domainHost)try{Jr.host=Vr.iri?Tr.toUnicode(Jr.host):Tr.toASCII(Jr.host.replace(Xr.PCT_ENCODED,Mr).toLowerCase())}catch(vn){Jr.error=Jr.error||"Host's domain name can not be converted to "+(Vr.iri?"Unicode":"ASCII")+" via punycode: "+vn}}Ur(Jr,Xr),Vr.reference!=="suffix"&&Jr.scheme&&(tn.push(Jr.scheme),tn.push(":"));var pn=_r(Jr,Vr);if(pn!==void 0&&(Vr.reference!=="suffix"&&tn.push("//"),tn.push(pn),Jr.path&&Jr.path.charAt(0)!=="/"&&tn.push("/")),Jr.path!==void 0){var fn=Jr.path;!Vr.absolutePath&&(!on||!on.absolutePath)&&(fn=Yr(fn)),pn===void 0&&(fn=fn.replace(/^\/\//,"/%2F")),tn.push(fn)}return Jr.query!==void 0&&(tn.push("?"),tn.push(Jr.query)),Jr.fragment!==void 0&&(tn.push("#"),tn.push(Jr.fragment)),tn.join("")}function cn(Jr,Vr){var Xr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},tn=arguments[3],on={};return tn||(Jr=xr(an(Jr,Xr),Xr),Vr=xr(an(Vr,Xr),Xr)),Xr=Xr||{},!Xr.tolerant&&Vr.scheme?(on.scheme=Vr.scheme,on.userinfo=Vr.userinfo,on.host=Vr.host,on.port=Vr.port,on.path=Yr(Vr.path||""),on.query=Vr.query):(Vr.userinfo!==void 0||Vr.host!==void 0||Vr.port!==void 0?(on.userinfo=Vr.userinfo,on.host=Vr.host,on.port=Vr.port,on.path=Yr(Vr.path||""),on.query=Vr.query):(Vr.path?(Vr.path.charAt(0)==="/"?on.path=Yr(Vr.path):((Jr.userinfo!==void 0||Jr.host!==void 0||Jr.port!==void 0)&&!Jr.path?on.path="/"+Vr.path:Jr.path?on.path=Jr.path.slice(0,Jr.path.lastIndexOf("/")+1)+Vr.path:on.path=Vr.path,on.path=Yr(on.path)),on.query=Vr.query):(on.path=Jr.path,Vr.query!==void 0?on.query=Vr.query:on.query=Jr.query),on.userinfo=Jr.userinfo,on.host=Jr.host,on.port=Jr.port),on.scheme=Jr.scheme),on.fragment=Vr.fragment,on}function Gr(Jr,Vr,Xr){var tn=Ut({scheme:"null"},Xr);return an(cn(xr(Jr,tn),xr(Vr,tn),tn,!0),tn)}function Fr(Jr,Vr){return typeof Jr=="string"?Jr=an(xr(Jr,Vr),Vr):kt(Jr)==="object"&&(Jr=xr(an(Jr,Vr),Vr)),Jr}function en(Jr,Vr,Xr){return typeof Jr=="string"?Jr=an(xr(Jr,Xr),Xr):kt(Jr)==="object"&&(Jr=an(Jr,Xr)),typeof Vr=="string"?Vr=an(xr(Vr,Xr),Xr):kt(Vr)==="object"&&(Vr=an(Vr,Xr)),Jr===Vr}function nn(Jr,Vr){return Jr&&Jr.toString().replace(!Vr||!Vr.iri?jt.ESCAPE:Kt.ESCAPE,Ar)}function rn(Jr,Vr){return Jr&&Jr.toString().replace(!Vr||!Vr.iri?jt.PCT_ENCODED:Kt.PCT_ENCODED,Mr)}var hn={scheme:"http",domainHost:!0,parse:function(Vr,Xr){return Vr.host||(Vr.error=Vr.error||"HTTP URIs must have a host."),Vr},serialize:function(Vr,Xr){var tn=String(Vr.scheme).toLowerCase()==="https";return(Vr.port===(tn?443:80)||Vr.port==="")&&(Vr.port=void 0),Vr.path||(Vr.path="/"),Vr}},yn={scheme:"https",domainHost:hn.domainHost,parse:hn.parse,serialize:hn.serialize};function wn(Jr){return typeof Jr.secure=="boolean"?Jr.secure:String(Jr.scheme).toLowerCase()==="wss"}var mn={scheme:"ws",domainHost:!0,parse:function(Vr,Xr){var tn=Vr;return tn.secure=wn(tn),tn.resourceName=(tn.path||"/")+(tn.query?"?"+tn.query:""),tn.path=void 0,tn.query=void 0,tn},serialize:function(Vr,Xr){if((Vr.port===(wn(Vr)?443:80)||Vr.port==="")&&(Vr.port=void 0),typeof Vr.secure=="boolean"&&(Vr.scheme=Vr.secure?"wss":"ws",Vr.secure=void 0),Vr.resourceName){var tn=Vr.resourceName.split("?"),on=qt(tn,2),pn=on[0],fn=on[1];Vr.path=pn&&pn!=="/"?pn:void 0,Vr.query=fn,Vr.resourceName=void 0}return Vr.fragment=void 0,Vr}},Mn={scheme:"wss",domainHost:mn.domainHost,parse:mn.parse,serialize:mn.serialize},Bn={},Sn="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",kn="[0-9A-Fa-f]",Un=xt(xt("%[EFef]"+kn+"%"+kn+kn+"%"+kn+kn)+"|"+xt("%[89A-Fa-f]"+kn+"%"+kn+kn)+"|"+xt("%"+kn+kn)),Dn="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Ln="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Kn=At(Ln,'[\\"\\\\]'),_n="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",jn=new RegExp(Sn,"g"),Gn=new RegExp(Un,"g"),xn=new RegExp(At("[^]",Dn,"[\\.]",'[\\"]',Kn),"g"),Hn=new RegExp(At("[^]",Sn,_n),"g"),qr=Hn;function Wr(Jr){var Vr=Mr(Jr);return Vr.match(jn)?Vr:Jr}var dn={scheme:"mailto",parse:function(Vr,Xr){var tn=Vr,on=tn.to=tn.path?tn.path.split(","):[];if(tn.path=void 0,tn.query){for(var pn=!1,fn={},vn=tn.query.split("&"),En=0,Tn=vn.length;En<Tn;++En){var In=vn[En].split("=");switch(In[0]){case"to":for(var Rn=In[1].split(","),Vn=0,An=Rn.length;Vn<An;++Vn)on.push(Rn[Vn]);break;case"subject":tn.subject=rn(In[1],Xr);break;case"body":tn.body=rn(In[1],Xr);break;default:pn=!0,fn[rn(In[0],Xr)]=rn(In[1],Xr);break}}pn&&(tn.headers=fn)}tn.query=void 0;for(var Fn=0,Wn=on.length;Fn<Wn;++Fn){var qn=on[Fn].split("@");if(qn[0]=rn(qn[0]),Xr.unicodeSupport)qn[1]=rn(qn[1],Xr).toLowerCase();else try{qn[1]=Tr.toASCII(rn(qn[1],Xr).toLowerCase())}catch(si){tn.error=tn.error||"Email address's domain name can not be converted to ASCII via punycode: "+si}on[Fn]=qn.join("@")}return tn},serialize:function(Vr,Xr){var tn=Vr,on=Nt(Vr.to);if(on){for(var pn=0,fn=on.length;pn<fn;++pn){var vn=String(on[pn]),En=vn.lastIndexOf("@"),Tn=vn.slice(0,En).replace(Gn,Wr).replace(Gn,Bt).replace(xn,Ar),In=vn.slice(En+1);try{In=Xr.iri?Tr.toUnicode(In):Tr.toASCII(rn(In,Xr).toLowerCase())}catch(Fn){tn.error=tn.error||"Email address's domain name can not be converted to "+(Xr.iri?"Unicode":"ASCII")+" via punycode: "+Fn}on[pn]=Tn+"@"+In}tn.path=on.join(",")}var Rn=Vr.headers=Vr.headers||{};Vr.subject&&(Rn.subject=Vr.subject),Vr.body&&(Rn.body=Vr.body);var Vn=[];for(var An in Rn)Rn[An]!==Bn[An]&&Vn.push(An.replace(Gn,Wr).replace(Gn,Bt).replace(Hn,Ar)+"="+Rn[An].replace(Gn,Wr).replace(Gn,Bt).replace(qr,Ar));return Vn.length&&(tn.query=Vn.join("&")),tn}},ln=/^([^\:]+)\:(.*)/,un={scheme:"urn",parse:function(Vr,Xr){var tn=Vr.path&&Vr.path.match(ln),on=Vr;if(tn){var pn=Xr.scheme||on.scheme||"urn",fn=tn[1].toLowerCase(),vn=tn[2],En=pn+":"+(Xr.nid||fn),Tn=wr[En];on.nid=fn,on.nss=vn,on.path=void 0,Tn&&(on=Tn.parse(on,Xr))}else on.error=on.error||"URN can not be parsed.";return on},serialize:function(Vr,Xr){var tn=Xr.scheme||Vr.scheme||"urn",on=Vr.nid,pn=tn+":"+(Xr.nid||on),fn=wr[pn];fn&&(Vr=fn.serialize(Vr,Xr));var vn=Vr,En=Vr.nss;return vn.path=(on||Xr.nid)+":"+En,vn}},On=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Nn={scheme:"urn:uuid",parse:function(Vr,Xr){var tn=Vr;return tn.uuid=tn.nss,tn.nss=void 0,!Xr.tolerant&&(!tn.uuid||!tn.uuid.match(On))&&(tn.error=tn.error||"UUID is not valid."),tn},serialize:function(Vr,Xr){var tn=Vr;return tn.nss=(Vr.uuid||"").toLowerCase(),tn}};wr[hn.scheme]=hn,wr[yn.scheme]=yn,wr[mn.scheme]=mn,wr[Mn.scheme]=Mn,wr[dn.scheme]=dn,wr[un.scheme]=un,wr[Nn.scheme]=Nn,_t.SCHEMES=wr,_t.pctEncChar=Ar,_t.pctDecChars=Mr,_t.parse=xr,_t.removeDotSegments=Yr,_t.serialize=an,_t.resolveComponents=cn,_t.resolve=Gr,_t.normalize=Fr,_t.equal=en,_t.escapeComponent=nn,_t.unescapeComponent=rn,Object.defineProperty(_t,"__esModule",{value:!0})})})(uri_all,uri_all.exports);var uri_allExports=uri_all.exports;Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=uri_allExports;uri.code='require("ajv/dist/runtime/uri").default';uri$1.default=uri;(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.CodeGen=$t.Name=$t.nil=$t.stringify=$t.str=$t._=$t.KeywordCxt=void 0;var e=validate;Object.defineProperty($t,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var _t=codegen;Object.defineProperty($t,"_",{enumerable:!0,get:function(){return _t._}}),Object.defineProperty($t,"str",{enumerable:!0,get:function(){return _t.str}}),Object.defineProperty($t,"stringify",{enumerable:!0,get:function(){return _t.stringify}}),Object.defineProperty($t,"nil",{enumerable:!0,get:function(){return _t.nil}}),Object.defineProperty($t,"Name",{enumerable:!0,get:function(){return _t.Name}}),Object.defineProperty($t,"CodeGen",{enumerable:!0,get:function(){return _t.CodeGen}});const At=validation_error,xt=ref_error,kt=rules,Bt=compile,Nt=codegen,Ut=resolve$5,Lt=dataType,jt=util$1,Kt=require$$9,qt=uri$1,zt=(nr,ur)=>new RegExp(nr,ur);zt.code="new RegExp";const Vt=["removeAdditional","useDefaults","coerceTypes"],Ht=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Wt={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Qt={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},Xt=200;function Jt(nr){var ur,pr,br,Sr,Pr,Tr,wr,Ar,Mr,Ur,Or,Cr,Er,Br,Lr,xr,_r,Dr,jr,Hr,Qr,Yr,an,cn,Gr;const Fr=nr.strict,en=(ur=nr.code)===null||ur===void 0?void 0:ur.optimize,nn=en===!0||en===void 0?1:en||0,rn=(br=(pr=nr.code)===null||pr===void 0?void 0:pr.regExp)!==null&&br!==void 0?br:zt,hn=(Sr=nr.uriResolver)!==null&&Sr!==void 0?Sr:qt.default;return{strictSchema:(Tr=(Pr=nr.strictSchema)!==null&&Pr!==void 0?Pr:Fr)!==null&&Tr!==void 0?Tr:!0,strictNumbers:(Ar=(wr=nr.strictNumbers)!==null&&wr!==void 0?wr:Fr)!==null&&Ar!==void 0?Ar:!0,strictTypes:(Ur=(Mr=nr.strictTypes)!==null&&Mr!==void 0?Mr:Fr)!==null&&Ur!==void 0?Ur:"log",strictTuples:(Cr=(Or=nr.strictTuples)!==null&&Or!==void 0?Or:Fr)!==null&&Cr!==void 0?Cr:"log",strictRequired:(Br=(Er=nr.strictRequired)!==null&&Er!==void 0?Er:Fr)!==null&&Br!==void 0?Br:!1,code:nr.code?{...nr.code,optimize:nn,regExp:rn}:{optimize:nn,regExp:rn},loopRequired:(Lr=nr.loopRequired)!==null&&Lr!==void 0?Lr:Xt,loopEnum:(xr=nr.loopEnum)!==null&&xr!==void 0?xr:Xt,meta:(_r=nr.meta)!==null&&_r!==void 0?_r:!0,messages:(Dr=nr.messages)!==null&&Dr!==void 0?Dr:!0,inlineRefs:(jr=nr.inlineRefs)!==null&&jr!==void 0?jr:!0,schemaId:(Hr=nr.schemaId)!==null&&Hr!==void 0?Hr:"$id",addUsedSchema:(Qr=nr.addUsedSchema)!==null&&Qr!==void 0?Qr:!0,validateSchema:(Yr=nr.validateSchema)!==null&&Yr!==void 0?Yr:!0,validateFormats:(an=nr.validateFormats)!==null&&an!==void 0?an:!0,unicodeRegExp:(cn=nr.unicodeRegExp)!==null&&cn!==void 0?cn:!0,int32range:(Gr=nr.int32range)!==null&&Gr!==void 0?Gr:!0,uriResolver:hn}}class tr{constructor(ur={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,ur=this.opts={...ur,...Jt(ur)};const{es5:pr,lines:br}=this.opts.code;this.scope=new Nt.ValueScope({scope:{},prefixes:Ht,es5:pr,lines:br}),this.logger=lr(ur.logger);const Sr=ur.validateFormats;ur.validateFormats=!1,this.RULES=(0,kt.getRules)(),dr.call(this,Wt,ur,"NOT SUPPORTED"),dr.call(this,Qt,ur,"DEPRECATED","warn"),this._metaOpts=Nr.call(this),ur.formats&&Ir.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),ur.keywords&&Rr.call(this,ur.keywords),typeof ur.meta=="object"&&this.addMetaSchema(ur.meta),$r.call(this),ur.validateFormats=Sr}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:ur,meta:pr,schemaId:br}=this.opts;let Sr=Kt;br==="id"&&(Sr={...Kt},Sr.id=Sr.$id,delete Sr.$id),pr&&ur&&this.addMetaSchema(Sr,Sr[br],!1)}defaultMeta(){const{meta:ur,schemaId:pr}=this.opts;return this.opts.defaultMeta=typeof ur=="object"?ur[pr]||ur:void 0}validate(ur,pr){let br;if(typeof ur=="string"){if(br=this.getSchema(ur),!br)throw new Error(`no schema with key or ref "${ur}"`)}else br=this.compile(ur);const Sr=br(pr);return"$async"in br||(this.errors=br.errors),Sr}compile(ur,pr){const br=this._addSchema(ur,pr);return br.validate||this._compileSchemaEnv(br)}compileAsync(ur,pr){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:br}=this.opts;return Sr.call(this,ur,pr);async function Sr(Ur,Or){await Pr.call(this,Ur.$schema);const Cr=this._addSchema(Ur,Or);return Cr.validate||Tr.call(this,Cr)}async function Pr(Ur){Ur&&!this.getSchema(Ur)&&await Sr.call(this,{$ref:Ur},!0)}async function Tr(Ur){try{return this._compileSchemaEnv(Ur)}catch(Or){if(!(Or instanceof xt.default))throw Or;return wr.call(this,Or),await Ar.call(this,Or.missingSchema),Tr.call(this,Ur)}}function wr({missingSchema:Ur,missingRef:Or}){if(this.refs[Ur])throw new Error(`AnySchema ${Ur} is loaded but ${Or} cannot be resolved`)}async function Ar(Ur){const Or=await Mr.call(this,Ur);this.refs[Ur]||await Pr.call(this,Or.$schema),this.refs[Ur]||this.addSchema(Or,Ur,pr)}async function Mr(Ur){const Or=this._loading[Ur];if(Or)return Or;try{return await(this._loading[Ur]=br(Ur))}finally{delete this._loading[Ur]}}}addSchema(ur,pr,br,Sr=this.opts.validateSchema){if(Array.isArray(ur)){for(const Tr of ur)this.addSchema(Tr,void 0,br,Sr);return this}let Pr;if(typeof ur=="object"){const{schemaId:Tr}=this.opts;if(Pr=ur[Tr],Pr!==void 0&&typeof Pr!="string")throw new Error(`schema ${Tr} must be string`)}return pr=(0,Ut.normalizeId)(pr||Pr),this._checkUnique(pr),this.schemas[pr]=this._addSchema(ur,br,pr,Sr,!0),this}addMetaSchema(ur,pr,br=this.opts.validateSchema){return this.addSchema(ur,pr,!0,br),this}validateSchema(ur,pr){if(typeof ur=="boolean")return!0;let br;if(br=ur.$schema,br!==void 0&&typeof br!="string")throw new Error("$schema must be a string");if(br=br||this.opts.defaultMeta||this.defaultMeta(),!br)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const Sr=this.validate(br,ur);if(!Sr&&pr){const Pr="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(Pr);else throw new Error(Pr)}return Sr}getSchema(ur){let pr;for(;typeof(pr=vr.call(this,ur))=="string";)ur=pr;if(pr===void 0){const{schemaId:br}=this.opts,Sr=new Bt.SchemaEnv({schema:{},schemaId:br});if(pr=Bt.resolveSchema.call(this,Sr,ur),!pr)return;this.refs[ur]=pr}return pr.validate||this._compileSchemaEnv(pr)}removeSchema(ur){if(ur instanceof RegExp)return this._removeAllSchemas(this.schemas,ur),this._removeAllSchemas(this.refs,ur),this;switch(typeof ur){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const pr=vr.call(this,ur);return typeof pr=="object"&&this._cache.delete(pr.schema),delete this.schemas[ur],delete this.refs[ur],this}case"object":{const pr=ur;this._cache.delete(pr);let br=ur[this.opts.schemaId];return br&&(br=(0,Ut.normalizeId)(br),delete this.schemas[br],delete this.refs[br]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(ur){for(const pr of ur)this.addKeyword(pr);return this}addKeyword(ur,pr){let br;if(typeof ur=="string")br=ur,typeof pr=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),pr.keyword=br);else if(typeof ur=="object"&&pr===void 0){if(pr=ur,br=pr.keyword,Array.isArray(br)&&!br.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(er.call(this,br,pr),!pr)return(0,jt.eachItem)(br,Pr=>rr.call(this,Pr)),this;fr.call(this,pr);const Sr={...pr,type:(0,Lt.getJSONTypes)(pr.type),schemaType:(0,Lt.getJSONTypes)(pr.schemaType)};return(0,jt.eachItem)(br,Sr.type.length===0?Pr=>rr.call(this,Pr,Sr):Pr=>Sr.type.forEach(Tr=>rr.call(this,Pr,Sr,Tr))),this}getKeyword(ur){const pr=this.RULES.all[ur];return typeof pr=="object"?pr.definition:!!pr}removeKeyword(ur){const{RULES:pr}=this;delete pr.keywords[ur],delete pr.all[ur];for(const br of pr.rules){const Sr=br.rules.findIndex(Pr=>Pr.keyword===ur);Sr>=0&&br.rules.splice(Sr,1)}return this}addFormat(ur,pr){return typeof pr=="string"&&(pr=new RegExp(pr)),this.formats[ur]=pr,this}errorsText(ur=this.errors,{separator:pr=", ",dataVar:br="data"}={}){return!ur||ur.length===0?"No errors":ur.map(Sr=>`${br}${Sr.instancePath} ${Sr.message}`).reduce((Sr,Pr)=>Sr+pr+Pr)}$dataMetaSchema(ur,pr){const br=this.RULES.all;ur=JSON.parse(JSON.stringify(ur));for(const Sr of pr){const Pr=Sr.split("/").slice(1);let Tr=ur;for(const wr of Pr)Tr=Tr[wr];for(const wr in br){const Ar=br[wr];if(typeof Ar!="object")continue;const{$data:Mr}=Ar.definition,Ur=Tr[wr];Mr&&Ur&&(Tr[wr]=ar(Ur))}}return ur}_removeAllSchemas(ur,pr){for(const br in ur){const Sr=ur[br];(!pr||pr.test(br))&&(typeof Sr=="string"?delete ur[br]:Sr&&!Sr.meta&&(this._cache.delete(Sr.schema),delete ur[br]))}}_addSchema(ur,pr,br,Sr=this.opts.validateSchema,Pr=this.opts.addUsedSchema){let Tr;const{schemaId:wr}=this.opts;if(typeof ur=="object")Tr=ur[wr];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof ur!="boolean")throw new Error("schema must be object or boolean")}let Ar=this._cache.get(ur);if(Ar!==void 0)return Ar;br=(0,Ut.normalizeId)(Tr||br);const Mr=Ut.getSchemaRefs.call(this,ur,br);return Ar=new Bt.SchemaEnv({schema:ur,schemaId:wr,meta:pr,baseId:br,localRefs:Mr}),this._cache.set(Ar.schema,Ar),Pr&&!br.startsWith("#")&&(br&&this._checkUnique(br),this.refs[br]=Ar),Sr&&this.validateSchema(ur,!0),Ar}_checkUnique(ur){if(this.schemas[ur]||this.refs[ur])throw new Error(`schema with key or id "${ur}" already exists`)}_compileSchemaEnv(ur){if(ur.meta?this._compileMetaSchema(ur):Bt.compileSchema.call(this,ur),!ur.validate)throw new Error("ajv implementation error");return ur.validate}_compileMetaSchema(ur){const pr=this.opts;this.opts=this._metaOpts;try{Bt.compileSchema.call(this,ur)}finally{this.opts=pr}}}$t.default=tr,tr.ValidationError=At.default,tr.MissingRefError=xt.default;function dr(nr,ur,pr,br="error"){for(const Sr in nr){const Pr=Sr;Pr in ur&&this.logger[br](`${pr}: option ${Sr}. ${nr[Pr]}`)}}function vr(nr){return nr=(0,Ut.normalizeId)(nr),this.schemas[nr]||this.refs[nr]}function $r(){const nr=this.opts.schemas;if(nr)if(Array.isArray(nr))this.addSchema(nr);else for(const ur in nr)this.addSchema(nr[ur],ur)}function Ir(){for(const nr in this.opts.formats){const ur=this.opts.formats[nr];ur&&this.addFormat(nr,ur)}}function Rr(nr){if(Array.isArray(nr)){this.addVocabulary(nr);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const ur in nr){const pr=nr[ur];pr.keyword||(pr.keyword=ur),this.addKeyword(pr)}}function Nr(){const nr={...this.opts};for(const ur of Vt)delete nr[ur];return nr}const kr={log(){},warn(){},error(){}};function lr(nr){if(nr===!1)return kr;if(nr===void 0)return console;if(nr.log&&nr.warn&&nr.error)return nr;throw new Error("logger must implement log, warn and error methods")}const ir=/^[a-z_$][a-z0-9_$:-]*$/i;function er(nr,ur){const{RULES:pr}=this;if((0,jt.eachItem)(nr,br=>{if(pr.keywords[br])throw new Error(`Keyword ${br} is already defined`);if(!ir.test(br))throw new Error(`Keyword ${br} has invalid name`)}),!!ur&&ur.$data&&!("code"in ur||"validate"in ur))throw new Error('$data keyword must have "code" or "validate" function')}function rr(nr,ur,pr){var br;const Sr=ur==null?void 0:ur.post;if(pr&&Sr)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:Pr}=this;let Tr=Sr?Pr.post:Pr.rules.find(({type:Ar})=>Ar===pr);if(Tr||(Tr={type:pr,rules:[]},Pr.rules.push(Tr)),Pr.keywords[nr]=!0,!ur)return;const wr={keyword:nr,definition:{...ur,type:(0,Lt.getJSONTypes)(ur.type),schemaType:(0,Lt.getJSONTypes)(ur.schemaType)}};ur.before?yr.call(this,Tr,wr,ur.before):Tr.rules.push(wr),Pr.all[nr]=wr,(br=ur.implements)===null||br===void 0||br.forEach(Ar=>this.addKeyword(Ar))}function yr(nr,ur,pr){const br=nr.rules.findIndex(Sr=>Sr.keyword===pr);br>=0?nr.rules.splice(br,0,ur):(nr.rules.push(ur),this.logger.warn(`rule ${pr} is not defined`))}function fr(nr){let{metaSchema:ur}=nr;ur!==void 0&&(nr.$data&&this.opts.$data&&(ur=ar(ur)),nr.validateSchema=this.compile(ur,!0))}const gr={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function ar(nr){return{anyOf:[nr,gr]}}})(core$3);var draft2020={},core$2={},id={};Object.defineProperty(id,"__esModule",{value:!0});const def$B={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id.default=def$B;var ref={};Object.defineProperty(ref,"__esModule",{value:!0});ref.callRef=ref.getValidate=void 0;const ref_error_1=ref_error,code_1$8=code$1,codegen_1$p=codegen,names_1$4=names$1,compile_1$2=compile,util_1$n=util$1,def$A={keyword:"$ref",schemaType:"string",code($t){const{gen:e,schema:_t,it:At}=$t,{baseId:xt,schemaEnv:kt,validateName:Bt,opts:Nt,self:Ut}=At,{root:Lt}=kt;if((_t==="#"||_t==="#/")&&xt===Lt.baseId)return Kt();const jt=compile_1$2.resolveRef.call(Ut,Lt,xt,_t);if(jt===void 0)throw new ref_error_1.default(At.opts.uriResolver,xt,_t);if(jt instanceof compile_1$2.SchemaEnv)return qt(jt);return zt(jt);function Kt(){if(kt===Lt)return callRef($t,Bt,kt,kt.$async);const Vt=e.scopeValue("root",{ref:Lt});return callRef($t,(0,codegen_1$p._)`${Vt}.validate`,Lt,Lt.$async)}function qt(Vt){const Ht=getValidate($t,Vt);callRef($t,Ht,Vt,Vt.$async)}function zt(Vt){const Ht=e.scopeValue("schema",Nt.code.source===!0?{ref:Vt,code:(0,codegen_1$p.stringify)(Vt)}:{ref:Vt}),Wt=e.name("valid"),Qt=$t.subschema({schema:Vt,dataTypes:[],schemaPath:codegen_1$p.nil,topSchemaRef:Ht,errSchemaPath:_t},Wt);$t.mergeEvaluated(Qt),$t.ok(Wt)}}};function getValidate($t,e){const{gen:_t}=$t;return e.validate?_t.scopeValue("validate",{ref:e.validate}):(0,codegen_1$p._)`${_t.scopeValue("wrapper",{ref:e})}.validate`}ref.getValidate=getValidate;function callRef($t,e,_t,At){const{gen:xt,it:kt}=$t,{allErrors:Bt,schemaEnv:Nt,opts:Ut}=kt,Lt=Ut.passContext?names_1$4.default.this:codegen_1$p.nil;At?jt():Kt();function jt(){if(!Nt.$async)throw new Error("async schema referenced by sync schema");const Vt=xt.let("valid");xt.try(()=>{xt.code((0,codegen_1$p._)`await ${(0,code_1$8.callValidateCode)($t,e,Lt)}`),zt(e),Bt||xt.assign(Vt,!0)},Ht=>{xt.if((0,codegen_1$p._)`!(${Ht} instanceof ${kt.ValidationError})`,()=>xt.throw(Ht)),qt(Ht),Bt||xt.assign(Vt,!1)}),$t.ok(Vt)}function Kt(){$t.result((0,code_1$8.callValidateCode)($t,e,Lt),()=>zt(e),()=>qt(e))}function qt(Vt){const Ht=(0,codegen_1$p._)`${Vt}.errors`;xt.assign(names_1$4.default.vErrors,(0,codegen_1$p._)`${names_1$4.default.vErrors} === null ? ${Ht} : ${names_1$4.default.vErrors}.concat(${Ht})`),xt.assign(names_1$4.default.errors,(0,codegen_1$p._)`${names_1$4.default.vErrors}.length`)}function zt(Vt){var Ht;if(!kt.opts.unevaluated)return;const Wt=(Ht=_t==null?void 0:_t.validate)===null||Ht===void 0?void 0:Ht.evaluated;if(kt.props!==!0)if(Wt&&!Wt.dynamicProps)Wt.props!==void 0&&(kt.props=util_1$n.mergeEvaluated.props(xt,Wt.props,kt.props));else{const Qt=xt.var("props",(0,codegen_1$p._)`${Vt}.evaluated.props`);kt.props=util_1$n.mergeEvaluated.props(xt,Qt,kt.props,codegen_1$p.Name)}if(kt.items!==!0)if(Wt&&!Wt.dynamicItems)Wt.items!==void 0&&(kt.items=util_1$n.mergeEvaluated.items(xt,Wt.items,kt.items));else{const Qt=xt.var("items",(0,codegen_1$p._)`${Vt}.evaluated.items`);kt.items=util_1$n.mergeEvaluated.items(xt,Qt,kt.items,codegen_1$p.Name)}}}ref.callRef=callRef;ref.default=def$A;Object.defineProperty(core$2,"__esModule",{value:!0});const id_1=id,ref_1$2=ref,core$1=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1$2.default];core$2.default=core$1;var validation$2={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$o=codegen,ops=codegen_1$o.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$k={message:({keyword:$t,schemaCode:e})=>(0,codegen_1$o.str)`must be ${KWDs[$t].okStr} ${e}`,params:({keyword:$t,schemaCode:e})=>(0,codegen_1$o._)`{comparison: ${KWDs[$t].okStr}, limit: ${e}}`},def$z={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$k,code($t){const{keyword:e,data:_t,schemaCode:At}=$t;$t.fail$data((0,codegen_1$o._)`${_t} ${KWDs[e].fail} ${At} || isNaN(${_t})`)}};limitNumber.default=def$z;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$n=codegen,error$j={message:({schemaCode:$t})=>(0,codegen_1$n.str)`must be multiple of ${$t}`,params:({schemaCode:$t})=>(0,codegen_1$n._)`{multipleOf: ${$t}}`},def$y={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$j,code($t){const{gen:e,data:_t,schemaCode:At,it:xt}=$t,kt=xt.opts.multipleOfPrecision,Bt=e.let("res"),Nt=kt?(0,codegen_1$n._)`Math.abs(Math.round(${Bt}) - ${Bt}) > 1e-${kt}`:(0,codegen_1$n._)`${Bt} !== parseInt(${Bt})`;$t.fail$data((0,codegen_1$n._)`(${At} === 0 || (${Bt} = ${_t}/${At}, ${Nt}))`)}};multipleOf.default=def$y;var limitLength={},ucs2length$1={};Object.defineProperty(ucs2length$1,"__esModule",{value:!0});function ucs2length($t){const e=$t.length;let _t=0,At=0,xt;for(;At<e;)_t++,xt=$t.charCodeAt(At++),xt>=55296&&xt<=56319&&At<e&&(xt=$t.charCodeAt(At),(xt&64512)===56320&&At++);return _t}ucs2length$1.default=ucs2length;ucs2length.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$m=codegen,util_1$m=util$1,ucs2length_1=ucs2length$1,error$i={message({keyword:$t,schemaCode:e}){const _t=$t==="maxLength"?"more":"fewer";return(0,codegen_1$m.str)`must NOT have ${_t} than ${e} characters`},params:({schemaCode:$t})=>(0,codegen_1$m._)`{limit: ${$t}}`},def$x={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$i,code($t){const{keyword:e,data:_t,schemaCode:At,it:xt}=$t,kt=e==="maxLength"?codegen_1$m.operators.GT:codegen_1$m.operators.LT,Bt=xt.opts.unicode===!1?(0,codegen_1$m._)`${_t}.length`:(0,codegen_1$m._)`${(0,util_1$m.useFunc)($t.gen,ucs2length_1.default)}(${_t})`;$t.fail$data((0,codegen_1$m._)`${Bt} ${kt} ${At}`)}};limitLength.default=def$x;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code$1,codegen_1$l=codegen,error$h={message:({schemaCode:$t})=>(0,codegen_1$l.str)`must match pattern "${$t}"`,params:({schemaCode:$t})=>(0,codegen_1$l._)`{pattern: ${$t}}`},def$w={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$h,code($t){const{data:e,$data:_t,schema:At,schemaCode:xt,it:kt}=$t,Bt=kt.opts.unicodeRegExp?"u":"",Nt=_t?(0,codegen_1$l._)`(new RegExp(${xt}, ${Bt}))`:(0,code_1$7.usePattern)($t,At);$t.fail$data((0,codegen_1$l._)`!${Nt}.test(${e})`)}};pattern.default=def$w;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$k=codegen,error$g={message({keyword:$t,schemaCode:e}){const _t=$t==="maxProperties"?"more":"fewer";return(0,codegen_1$k.str)`must NOT have ${_t} than ${e} properties`},params:({schemaCode:$t})=>(0,codegen_1$k._)`{limit: ${$t}}`},def$v={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$g,code($t){const{keyword:e,data:_t,schemaCode:At}=$t,xt=e==="maxProperties"?codegen_1$k.operators.GT:codegen_1$k.operators.LT;$t.fail$data((0,codegen_1$k._)`Object.keys(${_t}).length ${xt} ${At}`)}};limitProperties.default=def$v;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code$1,codegen_1$j=codegen,util_1$l=util$1,error$f={message:({params:{missingProperty:$t}})=>(0,codegen_1$j.str)`must have required property '${$t}'`,params:({params:{missingProperty:$t}})=>(0,codegen_1$j._)`{missingProperty: ${$t}}`},def$u={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$f,code($t){const{gen:e,schema:_t,schemaCode:At,data:xt,$data:kt,it:Bt}=$t,{opts:Nt}=Bt;if(!kt&&_t.length===0)return;const Ut=_t.length>=Nt.loopRequired;if(Bt.allErrors?Lt():jt(),Nt.strictRequired){const zt=$t.parentSchema.properties,{definedProperties:Vt}=$t.it;for(const Ht of _t)if((zt==null?void 0:zt[Ht])===void 0&&!Vt.has(Ht)){const Wt=Bt.schemaEnv.baseId+Bt.errSchemaPath,Qt=`required property "${Ht}" is not defined at "${Wt}" (strictRequired)`;(0,util_1$l.checkStrictMode)(Bt,Qt,Bt.opts.strictRequired)}}function Lt(){if(Ut||kt)$t.block$data(codegen_1$j.nil,Kt);else for(const zt of _t)(0,code_1$6.checkReportMissingProp)($t,zt)}function jt(){const zt=e.let("missing");if(Ut||kt){const Vt=e.let("valid",!0);$t.block$data(Vt,()=>qt(zt,Vt)),$t.ok(Vt)}else e.if((0,code_1$6.checkMissingProp)($t,_t,zt)),(0,code_1$6.reportMissingProp)($t,zt),e.else()}function Kt(){e.forOf("prop",At,zt=>{$t.setParams({missingProperty:zt}),e.if((0,code_1$6.noPropertyInData)(e,xt,zt,Nt.ownProperties),()=>$t.error())})}function qt(zt,Vt){$t.setParams({missingProperty:zt}),e.forOf(zt,At,()=>{e.assign(Vt,(0,code_1$6.propertyInData)(e,xt,zt,Nt.ownProperties)),e.if((0,codegen_1$j.not)(Vt),()=>{$t.error(),e.break()})},codegen_1$j.nil)}}};required.default=def$u;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$i=codegen,error$e={message({keyword:$t,schemaCode:e}){const _t=$t==="maxItems"?"more":"fewer";return(0,codegen_1$i.str)`must NOT have ${_t} than ${e} items`},params:({schemaCode:$t})=>(0,codegen_1$i._)`{limit: ${$t}}`},def$t={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$e,code($t){const{keyword:e,data:_t,schemaCode:At}=$t,xt=e==="maxItems"?codegen_1$i.operators.GT:codegen_1$i.operators.LT;$t.fail$data((0,codegen_1$i._)`${_t}.length ${xt} ${At}`)}};limitItems.default=def$t;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default';equal$1.default=equal;Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$h=codegen,util_1$k=util$1,equal_1$2=equal$1,error$d={message:({params:{i:$t,j:e}})=>(0,codegen_1$h.str)`must NOT have duplicate items (items ## ${e} and ${$t} are identical)`,params:({params:{i:$t,j:e}})=>(0,codegen_1$h._)`{i: ${$t}, j: ${e}}`},def$s={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$d,code($t){const{gen:e,data:_t,$data:At,schema:xt,parentSchema:kt,schemaCode:Bt,it:Nt}=$t;if(!At&&!xt)return;const Ut=e.let("valid"),Lt=kt.items?(0,dataType_1.getSchemaTypes)(kt.items):[];$t.block$data(Ut,jt,(0,codegen_1$h._)`${Bt} === false`),$t.ok(Ut);function jt(){const Vt=e.let("i",(0,codegen_1$h._)`${_t}.length`),Ht=e.let("j");$t.setParams({i:Vt,j:Ht}),e.assign(Ut,!0),e.if((0,codegen_1$h._)`${Vt} > 1`,()=>(Kt()?qt:zt)(Vt,Ht))}function Kt(){return Lt.length>0&&!Lt.some(Vt=>Vt==="object"||Vt==="array")}function qt(Vt,Ht){const Wt=e.name("item"),Qt=(0,dataType_1.checkDataTypes)(Lt,Wt,Nt.opts.strictNumbers,dataType_1.DataType.Wrong),Xt=e.const("indices",(0,codegen_1$h._)`{}`);e.for((0,codegen_1$h._)`;${Vt}--;`,()=>{e.let(Wt,(0,codegen_1$h._)`${_t}[${Vt}]`),e.if(Qt,(0,codegen_1$h._)`continue`),Lt.length>1&&e.if((0,codegen_1$h._)`typeof ${Wt} == "string"`,(0,codegen_1$h._)`${Wt} += "_"`),e.if((0,codegen_1$h._)`typeof ${Xt}[${Wt}] == "number"`,()=>{e.assign(Ht,(0,codegen_1$h._)`${Xt}[${Wt}]`),$t.error(),e.assign(Ut,!1).break()}).code((0,codegen_1$h._)`${Xt}[${Wt}] = ${Vt}`)})}function zt(Vt,Ht){const Wt=(0,util_1$k.useFunc)(e,equal_1$2.default),Qt=e.name("outer");e.label(Qt).for((0,codegen_1$h._)`;${Vt}--;`,()=>e.for((0,codegen_1$h._)`${Ht} = ${Vt}; ${Ht}--;`,()=>e.if((0,codegen_1$h._)`${Wt}(${_t}[${Vt}], ${_t}[${Ht}])`,()=>{$t.error(),e.assign(Ut,!1).break(Qt)})))}}};uniqueItems.default=def$s;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$g=codegen,util_1$j=util$1,equal_1$1=equal$1,error$c={message:"must be equal to constant",params:({schemaCode:$t})=>(0,codegen_1$g._)`{allowedValue: ${$t}}`},def$r={keyword:"const",$data:!0,error:error$c,code($t){const{gen:e,data:_t,$data:At,schemaCode:xt,schema:kt}=$t;At||kt&&typeof kt=="object"?$t.fail$data((0,codegen_1$g._)`!${(0,util_1$j.useFunc)(e,equal_1$1.default)}(${_t}, ${xt})`):$t.fail((0,codegen_1$g._)`${kt} !== ${_t}`)}};_const.default=def$r;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$f=codegen,util_1$i=util$1,equal_1=equal$1,error$b={message:"must be equal to one of the allowed values",params:({schemaCode:$t})=>(0,codegen_1$f._)`{allowedValues: ${$t}}`},def$q={keyword:"enum",schemaType:"array",$data:!0,error:error$b,code($t){const{gen:e,data:_t,$data:At,schema:xt,schemaCode:kt,it:Bt}=$t;if(!At&&xt.length===0)throw new Error("enum must have non-empty array");const Nt=xt.length>=Bt.opts.loopEnum;let Ut;const Lt=()=>Ut??(Ut=(0,util_1$i.useFunc)(e,equal_1.default));let jt;if(Nt||At)jt=e.let("valid"),$t.block$data(jt,Kt);else{if(!Array.isArray(xt))throw new Error("ajv implementation error");const zt=e.const("vSchema",kt);jt=(0,codegen_1$f.or)(...xt.map((Vt,Ht)=>qt(zt,Ht)))}$t.pass(jt);function Kt(){e.assign(jt,!1),e.forOf("v",kt,zt=>e.if((0,codegen_1$f._)`${Lt()}(${_t}, ${zt})`,()=>e.assign(jt,!0).break()))}function qt(zt,Vt){const Ht=xt[Vt];return typeof Ht=="object"&&Ht!==null?(0,codegen_1$f._)`${Lt()}(${_t}, ${zt}[${Vt}])`:(0,codegen_1$f._)`${_t} === ${Ht}`}}};_enum.default=def$q;Object.defineProperty(validation$2,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation$1=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$2.default=validation$1;var applicator$1={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0});additionalItems.validateAdditionalItems=void 0;const codegen_1$e=codegen,util_1$h=util$1,error$a={message:({params:{len:$t}})=>(0,codegen_1$e.str)`must NOT have more than ${$t} items`,params:({params:{len:$t}})=>(0,codegen_1$e._)`{limit: ${$t}}`},def$p={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$a,code($t){const{parentSchema:e,it:_t}=$t,{items:At}=e;if(!Array.isArray(At)){(0,util_1$h.checkStrictMode)(_t,'"additionalItems" is ignored when "items" is not an array of schemas');return}validateAdditionalItems($t,At)}};function validateAdditionalItems($t,e){const{gen:_t,schema:At,data:xt,keyword:kt,it:Bt}=$t;Bt.items=!0;const Nt=_t.const("len",(0,codegen_1$e._)`${xt}.length`);if(At===!1)$t.setParams({len:e.length}),$t.pass((0,codegen_1$e._)`${Nt} <= ${e.length}`);else if(typeof At=="object"&&!(0,util_1$h.alwaysValidSchema)(Bt,At)){const Lt=_t.var("valid",(0,codegen_1$e._)`${Nt} <= ${e.length}`);_t.if((0,codegen_1$e.not)(Lt),()=>Ut(Lt)),$t.ok(Lt)}function Ut(Lt){_t.forRange("i",e.length,Nt,jt=>{$t.subschema({keyword:kt,dataProp:jt,dataPropType:util_1$h.Type.Num},Lt),Bt.allErrors||_t.if((0,codegen_1$e.not)(Lt),()=>_t.break())})}}additionalItems.validateAdditionalItems=validateAdditionalItems;additionalItems.default=def$p;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0});items.validateTuple=void 0;const codegen_1$d=codegen,util_1$g=util$1,code_1$5=code$1,def$o={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code($t){const{schema:e,it:_t}=$t;if(Array.isArray(e))return validateTuple($t,"additionalItems",e);_t.items=!0,!(0,util_1$g.alwaysValidSchema)(_t,e)&&$t.ok((0,code_1$5.validateArray)($t))}};function validateTuple($t,e,_t=$t.schema){const{gen:At,parentSchema:xt,data:kt,keyword:Bt,it:Nt}=$t;jt(xt),Nt.opts.unevaluated&&_t.length&&Nt.items!==!0&&(Nt.items=util_1$g.mergeEvaluated.items(At,_t.length,Nt.items));const Ut=At.name("valid"),Lt=At.const("len",(0,codegen_1$d._)`${kt}.length`);_t.forEach((Kt,qt)=>{(0,util_1$g.alwaysValidSchema)(Nt,Kt)||(At.if((0,codegen_1$d._)`${Lt} > ${qt}`,()=>$t.subschema({keyword:Bt,schemaProp:qt,dataProp:qt},Ut)),$t.ok(Ut))});function jt(Kt){const{opts:qt,errSchemaPath:zt}=Nt,Vt=_t.length,Ht=Vt===Kt.minItems&&(Vt===Kt.maxItems||Kt[e]===!1);if(qt.strictTuples&&!Ht){const Wt=`"${Bt}" is ${Vt}-tuple, but minItems or maxItems/${e} are not specified or different at path "${zt}"`;(0,util_1$g.checkStrictMode)(Nt,Wt,qt.strictTuples)}}}items.validateTuple=validateTuple;items.default=def$o;Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$n={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:$t=>(0,items_1$1.validateTuple)($t,"items")};prefixItems.default=def$n;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$f=util$1,code_1$4=code$1,additionalItems_1$1=additionalItems,error$9={message:({params:{len:$t}})=>(0,codegen_1$c.str)`must NOT have more than ${$t} items`,params:({params:{len:$t}})=>(0,codegen_1$c._)`{limit: ${$t}}`},def$m={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$9,code($t){const{schema:e,parentSchema:_t,it:At}=$t,{prefixItems:xt}=_t;At.items=!0,!(0,util_1$f.alwaysValidSchema)(At,e)&&(xt?(0,additionalItems_1$1.validateAdditionalItems)($t,xt):$t.ok((0,code_1$4.validateArray)($t)))}};items2020.default=def$m;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$b=codegen,util_1$e=util$1,error$8={message:({params:{min:$t,max:e}})=>e===void 0?(0,codegen_1$b.str)`must contain at least ${$t} valid item(s)`:(0,codegen_1$b.str)`must contain at least ${$t} and no more than ${e} valid item(s)`,params:({params:{min:$t,max:e}})=>e===void 0?(0,codegen_1$b._)`{minContains: ${$t}}`:(0,codegen_1$b._)`{minContains: ${$t}, maxContains: ${e}}`},def$l={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$8,code($t){const{gen:e,schema:_t,parentSchema:At,data:xt,it:kt}=$t;let Bt,Nt;const{minContains:Ut,maxContains:Lt}=At;kt.opts.next?(Bt=Ut===void 0?1:Ut,Nt=Lt):Bt=1;const jt=e.const("len",(0,codegen_1$b._)`${xt}.length`);if($t.setParams({min:Bt,max:Nt}),Nt===void 0&&Bt===0){(0,util_1$e.checkStrictMode)(kt,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(Nt!==void 0&&Bt>Nt){(0,util_1$e.checkStrictMode)(kt,'"minContains" > "maxContains" is always invalid'),$t.fail();return}if((0,util_1$e.alwaysValidSchema)(kt,_t)){let Ht=(0,codegen_1$b._)`${jt} >= ${Bt}`;Nt!==void 0&&(Ht=(0,codegen_1$b._)`${Ht} && ${jt} <= ${Nt}`),$t.pass(Ht);return}kt.items=!0;const Kt=e.name("valid");Nt===void 0&&Bt===1?zt(Kt,()=>e.if(Kt,()=>e.break())):Bt===0?(e.let(Kt,!0),Nt!==void 0&&e.if((0,codegen_1$b._)`${xt}.length > 0`,qt)):(e.let(Kt,!1),qt()),$t.result(Kt,()=>$t.reset());function qt(){const Ht=e.name("_valid"),Wt=e.let("count",0);zt(Ht,()=>e.if(Ht,()=>Vt(Wt)))}function zt(Ht,Wt){e.forRange("i",0,jt,Qt=>{$t.subschema({keyword:"contains",dataProp:Qt,dataPropType:util_1$e.Type.Num,compositeRule:!0},Ht),Wt()})}function Vt(Ht){e.code((0,codegen_1$b._)`${Ht}++`),Nt===void 0?e.if((0,codegen_1$b._)`${Ht} >= ${Bt}`,()=>e.assign(Kt,!0).break()):(e.if((0,codegen_1$b._)`${Ht} > ${Nt}`,()=>e.assign(Kt,!1).break()),Bt===1?e.assign(Kt,!0):e.if((0,codegen_1$b._)`${Ht} >= ${Bt}`,()=>e.assign(Kt,!0)))}}};contains.default=def$l;var dependencies={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.validateSchemaDeps=$t.validatePropertyDeps=$t.error=void 0;const e=codegen,_t=util$1,At=code$1;$t.error={message:({params:{property:Ut,depsCount:Lt,deps:jt}})=>{const Kt=Lt===1?"property":"properties";return(0,e.str)`must have ${Kt} ${jt} when property ${Ut} is present`},params:({params:{property:Ut,depsCount:Lt,deps:jt,missingProperty:Kt}})=>(0,e._)`{property: ${Ut},
    missingProperty: ${Kt},
    depsCount: ${Lt},
    deps: ${jt}}`};const xt={keyword:"dependencies",type:"object",schemaType:"object",error:$t.error,code(Ut){const[Lt,jt]=kt(Ut);Bt(Ut,Lt),Nt(Ut,jt)}};function kt({schema:Ut}){const Lt={},jt={};for(const Kt in Ut){if(Kt==="__proto__")continue;const qt=Array.isArray(Ut[Kt])?Lt:jt;qt[Kt]=Ut[Kt]}return[Lt,jt]}function Bt(Ut,Lt=Ut.schema){const{gen:jt,data:Kt,it:qt}=Ut;if(Object.keys(Lt).length===0)return;const zt=jt.let("missing");for(const Vt in Lt){const Ht=Lt[Vt];if(Ht.length===0)continue;const Wt=(0,At.propertyInData)(jt,Kt,Vt,qt.opts.ownProperties);Ut.setParams({property:Vt,depsCount:Ht.length,deps:Ht.join(", ")}),qt.allErrors?jt.if(Wt,()=>{for(const Qt of Ht)(0,At.checkReportMissingProp)(Ut,Qt)}):(jt.if((0,e._)`${Wt} && (${(0,At.checkMissingProp)(Ut,Ht,zt)})`),(0,At.reportMissingProp)(Ut,zt),jt.else())}}$t.validatePropertyDeps=Bt;function Nt(Ut,Lt=Ut.schema){const{gen:jt,data:Kt,keyword:qt,it:zt}=Ut,Vt=jt.name("valid");for(const Ht in Lt)(0,_t.alwaysValidSchema)(zt,Lt[Ht])||(jt.if((0,At.propertyInData)(jt,Kt,Ht,zt.opts.ownProperties),()=>{const Wt=Ut.subschema({keyword:qt,schemaProp:Ht},Vt);Ut.mergeValidEvaluated(Wt,Vt)},()=>jt.var(Vt,!0)),Ut.ok(Vt))}$t.validateSchemaDeps=Nt,$t.default=xt})(dependencies);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$a=codegen,util_1$d=util$1,error$7={message:"property name must be valid",params:({params:$t})=>(0,codegen_1$a._)`{propertyName: ${$t.propertyName}}`},def$k={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$7,code($t){const{gen:e,schema:_t,data:At,it:xt}=$t;if((0,util_1$d.alwaysValidSchema)(xt,_t))return;const kt=e.name("valid");e.forIn("key",At,Bt=>{$t.setParams({propertyName:Bt}),$t.subschema({keyword:"propertyNames",data:Bt,dataTypes:["string"],propertyName:Bt,compositeRule:!0},kt),e.if((0,codegen_1$a.not)(kt),()=>{$t.error(!0),xt.allErrors||e.break()})}),$t.ok(kt)}};propertyNames.default=def$k;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code$1,codegen_1$9=codegen,names_1$3=names$1,util_1$c=util$1,error$6={message:"must NOT have additional properties",params:({params:$t})=>(0,codegen_1$9._)`{additionalProperty: ${$t.additionalProperty}}`},def$j={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$6,code($t){const{gen:e,schema:_t,parentSchema:At,data:xt,errsCount:kt,it:Bt}=$t;if(!kt)throw new Error("ajv implementation error");const{allErrors:Nt,opts:Ut}=Bt;if(Bt.props=!0,Ut.removeAdditional!=="all"&&(0,util_1$c.alwaysValidSchema)(Bt,_t))return;const Lt=(0,code_1$3.allSchemaProperties)(At.properties),jt=(0,code_1$3.allSchemaProperties)(At.patternProperties);Kt(),$t.ok((0,codegen_1$9._)`${kt} === ${names_1$3.default.errors}`);function Kt(){e.forIn("key",xt,Wt=>{!Lt.length&&!jt.length?Vt(Wt):e.if(qt(Wt),()=>Vt(Wt))})}function qt(Wt){let Qt;if(Lt.length>8){const Xt=(0,util_1$c.schemaRefOrVal)(Bt,At.properties,"properties");Qt=(0,code_1$3.isOwnProperty)(e,Xt,Wt)}else Lt.length?Qt=(0,codegen_1$9.or)(...Lt.map(Xt=>(0,codegen_1$9._)`${Wt} === ${Xt}`)):Qt=codegen_1$9.nil;return jt.length&&(Qt=(0,codegen_1$9.or)(Qt,...jt.map(Xt=>(0,codegen_1$9._)`${(0,code_1$3.usePattern)($t,Xt)}.test(${Wt})`))),(0,codegen_1$9.not)(Qt)}function zt(Wt){e.code((0,codegen_1$9._)`delete ${xt}[${Wt}]`)}function Vt(Wt){if(Ut.removeAdditional==="all"||Ut.removeAdditional&&_t===!1){zt(Wt);return}if(_t===!1){$t.setParams({additionalProperty:Wt}),$t.error(),Nt||e.break();return}if(typeof _t=="object"&&!(0,util_1$c.alwaysValidSchema)(Bt,_t)){const Qt=e.name("valid");Ut.removeAdditional==="failing"?(Ht(Wt,Qt,!1),e.if((0,codegen_1$9.not)(Qt),()=>{$t.reset(),zt(Wt)})):(Ht(Wt,Qt),Nt||e.if((0,codegen_1$9.not)(Qt),()=>e.break()))}}function Ht(Wt,Qt,Xt){const Jt={keyword:"additionalProperties",dataProp:Wt,dataPropType:util_1$c.Type.Str};Xt===!1&&Object.assign(Jt,{compositeRule:!0,createErrors:!1,allErrors:!1}),$t.subschema(Jt,Qt)}}};additionalProperties.default=def$j;var properties$8={};Object.defineProperty(properties$8,"__esModule",{value:!0});const validate_1=validate,code_1$2=code$1,util_1$b=util$1,additionalProperties_1$1=additionalProperties,def$i={keyword:"properties",type:"object",schemaType:"object",code($t){const{gen:e,schema:_t,parentSchema:At,data:xt,it:kt}=$t;kt.opts.removeAdditional==="all"&&At.additionalProperties===void 0&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(kt,additionalProperties_1$1.default,"additionalProperties"));const Bt=(0,code_1$2.allSchemaProperties)(_t);for(const Kt of Bt)kt.definedProperties.add(Kt);kt.opts.unevaluated&&Bt.length&&kt.props!==!0&&(kt.props=util_1$b.mergeEvaluated.props(e,(0,util_1$b.toHash)(Bt),kt.props));const Nt=Bt.filter(Kt=>!(0,util_1$b.alwaysValidSchema)(kt,_t[Kt]));if(Nt.length===0)return;const Ut=e.name("valid");for(const Kt of Nt)Lt(Kt)?jt(Kt):(e.if((0,code_1$2.propertyInData)(e,xt,Kt,kt.opts.ownProperties)),jt(Kt),kt.allErrors||e.else().var(Ut,!0),e.endIf()),$t.it.definedProperties.add(Kt),$t.ok(Ut);function Lt(Kt){return kt.opts.useDefaults&&!kt.compositeRule&&_t[Kt].default!==void 0}function jt(Kt){$t.subschema({keyword:"properties",schemaProp:Kt,dataProp:Kt},Ut)}}};properties$8.default=def$i;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code$1,codegen_1$8=codegen,util_1$a=util$1,util_2=util$1,def$h={keyword:"patternProperties",type:"object",schemaType:"object",code($t){const{gen:e,schema:_t,data:At,parentSchema:xt,it:kt}=$t,{opts:Bt}=kt,Nt=(0,code_1$1.allSchemaProperties)(_t),Ut=Nt.filter(Ht=>(0,util_1$a.alwaysValidSchema)(kt,_t[Ht]));if(Nt.length===0||Ut.length===Nt.length&&(!kt.opts.unevaluated||kt.props===!0))return;const Lt=Bt.strictSchema&&!Bt.allowMatchingProperties&&xt.properties,jt=e.name("valid");kt.props!==!0&&!(kt.props instanceof codegen_1$8.Name)&&(kt.props=(0,util_2.evaluatedPropsToName)(e,kt.props));const{props:Kt}=kt;qt();function qt(){for(const Ht of Nt)Lt&&zt(Ht),kt.allErrors?Vt(Ht):(e.var(jt,!0),Vt(Ht),e.if(jt))}function zt(Ht){for(const Wt in Lt)new RegExp(Ht).test(Wt)&&(0,util_1$a.checkStrictMode)(kt,`property ${Wt} matches pattern ${Ht} (use allowMatchingProperties)`)}function Vt(Ht){e.forIn("key",At,Wt=>{e.if((0,codegen_1$8._)`${(0,code_1$1.usePattern)($t,Ht)}.test(${Wt})`,()=>{const Qt=Ut.includes(Ht);Qt||$t.subschema({keyword:"patternProperties",schemaProp:Ht,dataProp:Wt,dataPropType:util_2.Type.Str},jt),kt.opts.unevaluated&&Kt!==!0?e.assign((0,codegen_1$8._)`${Kt}[${Wt}]`,!0):!Qt&&!kt.allErrors&&e.if((0,codegen_1$8.not)(jt),()=>e.break())})})}}};patternProperties.default=def$h;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$9=util$1,def$g={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code($t){const{gen:e,schema:_t,it:At}=$t;if((0,util_1$9.alwaysValidSchema)(At,_t)){$t.fail();return}const xt=e.name("valid");$t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},xt),$t.failResult(xt,()=>$t.reset(),()=>$t.error())},error:{message:"must NOT be valid"}};not.default=def$g;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code$1,def$f={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$f;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$8=util$1,error$5={message:"must match exactly one schema in oneOf",params:({params:$t})=>(0,codegen_1$7._)`{passingSchemas: ${$t.passing}}`},def$e={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$5,code($t){const{gen:e,schema:_t,parentSchema:At,it:xt}=$t;if(!Array.isArray(_t))throw new Error("ajv implementation error");if(xt.opts.discriminator&&At.discriminator)return;const kt=_t,Bt=e.let("valid",!1),Nt=e.let("passing",null),Ut=e.name("_valid");$t.setParams({passing:Nt}),e.block(Lt),$t.result(Bt,()=>$t.reset(),()=>$t.error(!0));function Lt(){kt.forEach((jt,Kt)=>{let qt;(0,util_1$8.alwaysValidSchema)(xt,jt)?e.var(Ut,!0):qt=$t.subschema({keyword:"oneOf",schemaProp:Kt,compositeRule:!0},Ut),Kt>0&&e.if((0,codegen_1$7._)`${Ut} && ${Bt}`).assign(Bt,!1).assign(Nt,(0,codegen_1$7._)`[${Nt}, ${Kt}]`).else(),e.if(Ut,()=>{e.assign(Bt,!0),e.assign(Nt,Kt),qt&&$t.mergeEvaluated(qt,codegen_1$7.Name)})})}}};oneOf.default=def$e;var allOf$1={};Object.defineProperty(allOf$1,"__esModule",{value:!0});const util_1$7=util$1,def$d={keyword:"allOf",schemaType:"array",code($t){const{gen:e,schema:_t,it:At}=$t;if(!Array.isArray(_t))throw new Error("ajv implementation error");const xt=e.name("valid");_t.forEach((kt,Bt)=>{if((0,util_1$7.alwaysValidSchema)(At,kt))return;const Nt=$t.subschema({keyword:"allOf",schemaProp:Bt},xt);$t.ok(xt),$t.mergeEvaluated(Nt)})}};allOf$1.default=def$d;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$6=codegen,util_1$6=util$1,error$4={message:({params:$t})=>(0,codegen_1$6.str)`must match "${$t.ifClause}" schema`,params:({params:$t})=>(0,codegen_1$6._)`{failingKeyword: ${$t.ifClause}}`},def$c={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$4,code($t){const{gen:e,parentSchema:_t,it:At}=$t;_t.then===void 0&&_t.else===void 0&&(0,util_1$6.checkStrictMode)(At,'"if" without "then" and "else" is ignored');const xt=hasSchema(At,"then"),kt=hasSchema(At,"else");if(!xt&&!kt)return;const Bt=e.let("valid",!0),Nt=e.name("_valid");if(Ut(),$t.reset(),xt&&kt){const jt=e.let("ifClause");$t.setParams({ifClause:jt}),e.if(Nt,Lt("then",jt),Lt("else",jt))}else xt?e.if(Nt,Lt("then")):e.if((0,codegen_1$6.not)(Nt),Lt("else"));$t.pass(Bt,()=>$t.error(!0));function Ut(){const jt=$t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},Nt);$t.mergeEvaluated(jt)}function Lt(jt,Kt){return()=>{const qt=$t.subschema({keyword:jt},Nt);e.assign(Bt,Nt),$t.mergeValidEvaluated(qt,Bt),Kt?e.assign(Kt,(0,codegen_1$6._)`${jt}`):$t.setParams({ifClause:jt})}}}};function hasSchema($t,e){const _t=$t.schema[e];return _t!==void 0&&!(0,util_1$6.alwaysValidSchema)($t,_t)}_if.default=def$c;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$5=util$1,def$b={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:$t,parentSchema:e,it:_t}){e.if===void 0&&(0,util_1$5.checkStrictMode)(_t,`"${$t}" without "if" is ignored`)}};thenElse.default=def$b;Object.defineProperty(applicator$1,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1$2=dependencies,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$8,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf$1,if_1=_if,thenElse_1=thenElse;function getApplicator($t=!1){const e=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1$2.default,properties_1.default,patternProperties_1.default];return $t?e.push(prefixItems_1.default,items2020_1.default):e.push(additionalItems_1.default,items_1.default),e.push(contains_1.default),e}applicator$1.default=getApplicator;var dynamic$1={},dynamicAnchor$1={};Object.defineProperty(dynamicAnchor$1,"__esModule",{value:!0});dynamicAnchor$1.dynamicAnchor=void 0;const codegen_1$5=codegen,names_1$2=names$1,compile_1$1=compile,ref_1$1=ref,def$a={keyword:"$dynamicAnchor",schemaType:"string",code:$t=>dynamicAnchor($t,$t.schema)};function dynamicAnchor($t,e){const{gen:_t,it:At}=$t;At.schemaEnv.root.dynamicAnchors[e]=!0;const xt=(0,codegen_1$5._)`${names_1$2.default.dynamicAnchors}${(0,codegen_1$5.getProperty)(e)}`,kt=At.errSchemaPath==="#"?At.validateName:_getValidate($t);_t.if((0,codegen_1$5._)`!${xt}`,()=>_t.assign(xt,kt))}dynamicAnchor$1.dynamicAnchor=dynamicAnchor;function _getValidate($t){const{schemaEnv:e,schema:_t,self:At}=$t.it,{root:xt,baseId:kt,localRefs:Bt,meta:Nt}=e.root,{schemaId:Ut}=At.opts,Lt=new compile_1$1.SchemaEnv({schema:_t,schemaId:Ut,root:xt,baseId:kt,localRefs:Bt,meta:Nt});return compile_1$1.compileSchema.call(At,Lt),(0,ref_1$1.getValidate)($t,Lt)}dynamicAnchor$1.default=def$a;var dynamicRef$1={};Object.defineProperty(dynamicRef$1,"__esModule",{value:!0});dynamicRef$1.dynamicRef=void 0;const codegen_1$4=codegen,names_1$1=names$1,ref_1=ref,def$9={keyword:"$dynamicRef",schemaType:"string",code:$t=>dynamicRef($t,$t.schema)};function dynamicRef($t,e){const{gen:_t,keyword:At,it:xt}=$t;if(e[0]!=="#")throw new Error(`"${At}" only supports hash fragment reference`);const kt=e.slice(1);if(xt.allErrors)Bt();else{const Ut=_t.let("valid",!1);Bt(Ut),$t.ok(Ut)}function Bt(Ut){if(xt.schemaEnv.root.dynamicAnchors[kt]){const Lt=_t.let("_v",(0,codegen_1$4._)`${names_1$1.default.dynamicAnchors}${(0,codegen_1$4.getProperty)(kt)}`);_t.if(Lt,Nt(Lt,Ut),Nt(xt.validateName,Ut))}else Nt(xt.validateName,Ut)()}function Nt(Ut,Lt){return Lt?()=>_t.block(()=>{(0,ref_1.callRef)($t,Ut),_t.let(Lt,!0)}):()=>(0,ref_1.callRef)($t,Ut)}}dynamicRef$1.dynamicRef=dynamicRef;dynamicRef$1.default=def$9;var recursiveAnchor={};Object.defineProperty(recursiveAnchor,"__esModule",{value:!0});const dynamicAnchor_1$1=dynamicAnchor$1,util_1$4=util$1,def$8={keyword:"$recursiveAnchor",schemaType:"boolean",code($t){$t.schema?(0,dynamicAnchor_1$1.dynamicAnchor)($t,""):(0,util_1$4.checkStrictMode)($t.it,"$recursiveAnchor: false is ignored")}};recursiveAnchor.default=def$8;var recursiveRef={};Object.defineProperty(recursiveRef,"__esModule",{value:!0});const dynamicRef_1$1=dynamicRef$1,def$7={keyword:"$recursiveRef",schemaType:"string",code:$t=>(0,dynamicRef_1$1.dynamicRef)($t,$t.schema)};recursiveRef.default=def$7;Object.defineProperty(dynamic$1,"__esModule",{value:!0});const dynamicAnchor_1=dynamicAnchor$1,dynamicRef_1=dynamicRef$1,recursiveAnchor_1=recursiveAnchor,recursiveRef_1=recursiveRef,dynamic=[dynamicAnchor_1.default,dynamicRef_1.default,recursiveAnchor_1.default,recursiveRef_1.default];dynamic$1.default=dynamic;var next$1={},dependentRequired={};Object.defineProperty(dependentRequired,"__esModule",{value:!0});const dependencies_1$1=dependencies,def$6={keyword:"dependentRequired",type:"object",schemaType:"object",error:dependencies_1$1.error,code:$t=>(0,dependencies_1$1.validatePropertyDeps)($t)};dependentRequired.default=def$6;var dependentSchemas={};Object.defineProperty(dependentSchemas,"__esModule",{value:!0});const dependencies_1=dependencies,def$5={keyword:"dependentSchemas",type:"object",schemaType:"object",code:$t=>(0,dependencies_1.validateSchemaDeps)($t)};dependentSchemas.default=def$5;var limitContains={};Object.defineProperty(limitContains,"__esModule",{value:!0});const util_1$3=util$1,def$4={keyword:["maxContains","minContains"],type:"array",schemaType:"number",code({keyword:$t,parentSchema:e,it:_t}){e.contains===void 0&&(0,util_1$3.checkStrictMode)(_t,`"${$t}" without "contains" is ignored`)}};limitContains.default=def$4;Object.defineProperty(next$1,"__esModule",{value:!0});const dependentRequired_1=dependentRequired,dependentSchemas_1=dependentSchemas,limitContains_1=limitContains,next=[dependentRequired_1.default,dependentSchemas_1.default,limitContains_1.default];next$1.default=next;var unevaluated$2={},unevaluatedProperties={};Object.defineProperty(unevaluatedProperties,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$2=util$1,names_1=names$1,error$3={message:"must NOT have unevaluated properties",params:({params:$t})=>(0,codegen_1$3._)`{unevaluatedProperty: ${$t.unevaluatedProperty}}`},def$3={keyword:"unevaluatedProperties",type:"object",schemaType:["boolean","object"],trackErrors:!0,error:error$3,code($t){const{gen:e,schema:_t,data:At,errsCount:xt,it:kt}=$t;if(!xt)throw new Error("ajv implementation error");const{allErrors:Bt,props:Nt}=kt;Nt instanceof codegen_1$3.Name?e.if((0,codegen_1$3._)`${Nt} !== true`,()=>e.forIn("key",At,Kt=>e.if(Lt(Nt,Kt),()=>Ut(Kt)))):Nt!==!0&&e.forIn("key",At,Kt=>Nt===void 0?Ut(Kt):e.if(jt(Nt,Kt),()=>Ut(Kt))),kt.props=!0,$t.ok((0,codegen_1$3._)`${xt} === ${names_1.default.errors}`);function Ut(Kt){if(_t===!1){$t.setParams({unevaluatedProperty:Kt}),$t.error(),Bt||e.break();return}if(!(0,util_1$2.alwaysValidSchema)(kt,_t)){const qt=e.name("valid");$t.subschema({keyword:"unevaluatedProperties",dataProp:Kt,dataPropType:util_1$2.Type.Str},qt),Bt||e.if((0,codegen_1$3.not)(qt),()=>e.break())}}function Lt(Kt,qt){return(0,codegen_1$3._)`!${Kt} || !${Kt}[${qt}]`}function jt(Kt,qt){const zt=[];for(const Vt in Kt)Kt[Vt]===!0&&zt.push((0,codegen_1$3._)`${qt} !== ${Vt}`);return(0,codegen_1$3.and)(...zt)}}};unevaluatedProperties.default=def$3;var unevaluatedItems={};Object.defineProperty(unevaluatedItems,"__esModule",{value:!0});const codegen_1$2=codegen,util_1$1=util$1,error$2={message:({params:{len:$t}})=>(0,codegen_1$2.str)`must NOT have more than ${$t} items`,params:({params:{len:$t}})=>(0,codegen_1$2._)`{limit: ${$t}}`},def$2={keyword:"unevaluatedItems",type:"array",schemaType:["boolean","object"],error:error$2,code($t){const{gen:e,schema:_t,data:At,it:xt}=$t,kt=xt.items||0;if(kt===!0)return;const Bt=e.const("len",(0,codegen_1$2._)`${At}.length`);if(_t===!1)$t.setParams({len:kt}),$t.fail((0,codegen_1$2._)`${Bt} > ${kt}`);else if(typeof _t=="object"&&!(0,util_1$1.alwaysValidSchema)(xt,_t)){const Ut=e.var("valid",(0,codegen_1$2._)`${Bt} <= ${kt}`);e.if((0,codegen_1$2.not)(Ut),()=>Nt(Ut,kt)),$t.ok(Ut)}xt.items=!0;function Nt(Ut,Lt){e.forRange("i",Lt,Bt,jt=>{$t.subschema({keyword:"unevaluatedItems",dataProp:jt,dataPropType:util_1$1.Type.Num},Ut),xt.allErrors||e.if((0,codegen_1$2.not)(Ut),()=>e.break())})}}};unevaluatedItems.default=def$2;Object.defineProperty(unevaluated$2,"__esModule",{value:!0});const unevaluatedProperties_1=unevaluatedProperties,unevaluatedItems_1=unevaluatedItems,unevaluated$1=[unevaluatedProperties_1.default,unevaluatedItems_1.default];unevaluated$2.default=unevaluated$1;var format$4={},format$3={};Object.defineProperty(format$3,"__esModule",{value:!0});const codegen_1$1=codegen,error$1={message:({schemaCode:$t})=>(0,codegen_1$1.str)`must match format "${$t}"`,params:({schemaCode:$t})=>(0,codegen_1$1._)`{format: ${$t}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code($t,e){const{gen:_t,data:At,$data:xt,schema:kt,schemaCode:Bt,it:Nt}=$t,{opts:Ut,errSchemaPath:Lt,schemaEnv:jt,self:Kt}=Nt;if(!Ut.validateFormats)return;xt?qt():zt();function qt(){const Vt=_t.scopeValue("formats",{ref:Kt.formats,code:Ut.code.formats}),Ht=_t.const("fDef",(0,codegen_1$1._)`${Vt}[${Bt}]`),Wt=_t.let("fType"),Qt=_t.let("format");_t.if((0,codegen_1$1._)`typeof ${Ht} == "object" && !(${Ht} instanceof RegExp)`,()=>_t.assign(Wt,(0,codegen_1$1._)`${Ht}.type || "string"`).assign(Qt,(0,codegen_1$1._)`${Ht}.validate`),()=>_t.assign(Wt,(0,codegen_1$1._)`"string"`).assign(Qt,Ht)),$t.fail$data((0,codegen_1$1.or)(Xt(),Jt()));function Xt(){return Ut.strictSchema===!1?codegen_1$1.nil:(0,codegen_1$1._)`${Bt} && !${Qt}`}function Jt(){const tr=jt.$async?(0,codegen_1$1._)`(${Ht}.async ? await ${Qt}(${At}) : ${Qt}(${At}))`:(0,codegen_1$1._)`${Qt}(${At})`,dr=(0,codegen_1$1._)`(typeof ${Qt} == "function" ? ${tr} : ${Qt}.test(${At}))`;return(0,codegen_1$1._)`${Qt} && ${Qt} !== true && ${Wt} === ${e} && !${dr}`}}function zt(){const Vt=Kt.formats[kt];if(!Vt){Xt();return}if(Vt===!0)return;const[Ht,Wt,Qt]=Jt(Vt);Ht===e&&$t.pass(tr());function Xt(){if(Ut.strictSchema===!1){Kt.logger.warn(dr());return}throw new Error(dr());function dr(){return`unknown format "${kt}" ignored in schema at path "${Lt}"`}}function Jt(dr){const vr=dr instanceof RegExp?(0,codegen_1$1.regexpCode)(dr):Ut.code.formats?(0,codegen_1$1._)`${Ut.code.formats}${(0,codegen_1$1.getProperty)(kt)}`:void 0,$r=_t.scopeValue("formats",{key:kt,ref:dr,code:vr});return typeof dr=="object"&&!(dr instanceof RegExp)?[dr.type||"string",dr.validate,(0,codegen_1$1._)`${$r}.validate`]:["string",dr,$r]}function tr(){if(typeof Vt=="object"&&!(Vt instanceof RegExp)&&Vt.async){if(!jt.$async)throw new Error("async format in sync schema");return(0,codegen_1$1._)`await ${Qt}(${At})`}return typeof Wt=="function"?(0,codegen_1$1._)`${Qt}(${At})`:(0,codegen_1$1._)`${Qt}.test(${At})`}}}};format$3.default=def$1;Object.defineProperty(format$4,"__esModule",{value:!0});const format_1$1=format$3,format$2=[format_1$1.default];format$4.default=format$2;var metadata$1={};Object.defineProperty(metadata$1,"__esModule",{value:!0});metadata$1.contentVocabulary=metadata$1.metadataVocabulary=void 0;metadata$1.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];metadata$1.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(draft2020,"__esModule",{value:!0});const core_1=core$2,validation_1=validation$2,applicator_1=applicator$1,dynamic_1=dynamic$1,next_1=next$1,unevaluated_1=unevaluated$2,format_1=format$4,metadata_1=metadata$1,draft2020Vocabularies=[dynamic_1.default,core_1.default,validation_1.default,(0,applicator_1.default)(!0),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary,next_1.default,unevaluated_1.default];draft2020.default=draft2020Vocabularies;var discriminator={},types={};(function($t){Object.defineProperty($t,"__esModule",{value:!0}),$t.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}($t.DiscrError||($t.DiscrError={}))})(types);Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1=codegen,types_1=types,compile_1=compile,util_1=util$1,error={message:({params:{discrError:$t,tagName:e}})=>$t===types_1.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:$t,tag:e,tagName:_t}})=>(0,codegen_1._)`{error: ${$t}, tag: ${_t}, tagValue: ${e}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error,code($t){const{gen:e,data:_t,schema:At,parentSchema:xt,it:kt}=$t,{oneOf:Bt}=xt;if(!kt.opts.discriminator)throw new Error("discriminator: requires discriminator option");const Nt=At.propertyName;if(typeof Nt!="string")throw new Error("discriminator: requires propertyName");if(At.mapping)throw new Error("discriminator: mapping is not supported");if(!Bt)throw new Error("discriminator: requires oneOf keyword");const Ut=e.let("valid",!1),Lt=e.const("tag",(0,codegen_1._)`${_t}${(0,codegen_1.getProperty)(Nt)}`);e.if((0,codegen_1._)`typeof ${Lt} == "string"`,()=>jt(),()=>$t.error(!1,{discrError:types_1.DiscrError.Tag,tag:Lt,tagName:Nt})),$t.ok(Ut);function jt(){const zt=qt();e.if(!1);for(const Vt in zt)e.elseIf((0,codegen_1._)`${Lt} === ${Vt}`),e.assign(Ut,Kt(zt[Vt]));e.else(),$t.error(!1,{discrError:types_1.DiscrError.Mapping,tag:Lt,tagName:Nt}),e.endIf()}function Kt(zt){const Vt=e.name("valid"),Ht=$t.subschema({keyword:"oneOf",schemaProp:zt},Vt);return $t.mergeEvaluated(Ht,codegen_1.Name),Vt}function qt(){var zt;const Vt={},Ht=Qt(xt);let Wt=!0;for(let tr=0;tr<Bt.length;tr++){let dr=Bt[tr];dr!=null&&dr.$ref&&!(0,util_1.schemaHasRulesButRef)(dr,kt.self.RULES)&&(dr=compile_1.resolveRef.call(kt.self,kt.schemaEnv.root,kt.baseId,dr==null?void 0:dr.$ref),dr instanceof compile_1.SchemaEnv&&(dr=dr.schema));const vr=(zt=dr==null?void 0:dr.properties)===null||zt===void 0?void 0:zt[Nt];if(typeof vr!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${Nt}"`);Wt=Wt&&(Ht||Qt(dr)),Xt(vr,tr)}if(!Wt)throw new Error(`discriminator: "${Nt}" must be required`);return Vt;function Qt({required:tr}){return Array.isArray(tr)&&tr.includes(Nt)}function Xt(tr,dr){if(tr.const)Jt(tr.const,dr);else if(tr.enum)for(const vr of tr.enum)Jt(vr,dr);else throw new Error(`discriminator: "properties/${Nt}" must have "const" or "enum"`)}function Jt(tr,dr){if(typeof tr!="string"||tr in Vt)throw new Error(`discriminator: "${Nt}" values must be unique strings`);Vt[tr]=dr}}}};discriminator.default=def;var jsonSchema202012={};const $schema$7="https://json-schema.org/draft/2020-12/schema",$id$7="https://json-schema.org/draft/2020-12/schema",$vocabulary$7={"https://json-schema.org/draft/2020-12/vocab/core":!0,"https://json-schema.org/draft/2020-12/vocab/applicator":!0,"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0,"https://json-schema.org/draft/2020-12/vocab/validation":!0,"https://json-schema.org/draft/2020-12/vocab/meta-data":!0,"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0,"https://json-schema.org/draft/2020-12/vocab/content":!0},$dynamicAnchor$7="meta",title$7="Core and Validation specifications meta-schema",allOf=[{$ref:"meta/core"},{$ref:"meta/applicator"},{$ref:"meta/unevaluated"},{$ref:"meta/validation"},{$ref:"meta/meta-data"},{$ref:"meta/format-annotation"},{$ref:"meta/content"}],type$7=["object","boolean"],$comment="This meta-schema also defines keywords that have appeared in previous drafts in order to prevent incompatible extensions as they remain in common use.",properties$7={definitions:{$comment:'"definitions" has been replaced by "$defs".',type:"object",additionalProperties:{$dynamicRef:"#meta"},deprecated:!0,default:{}},dependencies:{$comment:'"dependencies" has been split and replaced by "dependentSchemas" and "dependentRequired" in order to serve their differing semantics.',type:"object",additionalProperties:{anyOf:[{$dynamicRef:"#meta"},{$ref:"meta/validation#/$defs/stringArray"}]},deprecated:!0,default:{}},$recursiveAnchor:{$comment:'"$recursiveAnchor" has been replaced by "$dynamicAnchor".',$ref:"meta/core#/$defs/anchorString",deprecated:!0},$recursiveRef:{$comment:'"$recursiveRef" has been replaced by "$dynamicRef".',$ref:"meta/core#/$defs/uriReferenceString",deprecated:!0}},require$$0={$schema:$schema$7,$id:$id$7,$vocabulary:$vocabulary$7,$dynamicAnchor:$dynamicAnchor$7,title:title$7,allOf,type:type$7,$comment,properties:properties$7},$schema$6="https://json-schema.org/draft/2020-12/schema",$id$6="https://json-schema.org/draft/2020-12/meta/applicator",$vocabulary$6={"https://json-schema.org/draft/2020-12/vocab/applicator":!0},$dynamicAnchor$6="meta",title$6="Applicator vocabulary meta-schema",type$6=["object","boolean"],properties$6={prefixItems:{$ref:"#/$defs/schemaArray"},items:{$dynamicRef:"#meta"},contains:{$dynamicRef:"#meta"},additionalProperties:{$dynamicRef:"#meta"},properties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},patternProperties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},propertyNames:{format:"regex"},default:{}},dependentSchemas:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},propertyNames:{$dynamicRef:"#meta"},if:{$dynamicRef:"#meta"},then:{$dynamicRef:"#meta"},else:{$dynamicRef:"#meta"},allOf:{$ref:"#/$defs/schemaArray"},anyOf:{$ref:"#/$defs/schemaArray"},oneOf:{$ref:"#/$defs/schemaArray"},not:{$dynamicRef:"#meta"}},$defs$2={schemaArray:{type:"array",minItems:1,items:{$dynamicRef:"#meta"}}},require$$1={$schema:$schema$6,$id:$id$6,$vocabulary:$vocabulary$6,$dynamicAnchor:$dynamicAnchor$6,title:title$6,type:type$6,properties:properties$6,$defs:$defs$2},$schema$5="https://json-schema.org/draft/2020-12/schema",$id$5="https://json-schema.org/draft/2020-12/meta/unevaluated",$vocabulary$5={"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0},$dynamicAnchor$5="meta",title$5="Unevaluated applicator vocabulary meta-schema",type$5=["object","boolean"],properties$5={unevaluatedItems:{$dynamicRef:"#meta"},unevaluatedProperties:{$dynamicRef:"#meta"}},require$$2={$schema:$schema$5,$id:$id$5,$vocabulary:$vocabulary$5,$dynamicAnchor:$dynamicAnchor$5,title:title$5,type:type$5,properties:properties$5},$schema$4="https://json-schema.org/draft/2020-12/schema",$id$4="https://json-schema.org/draft/2020-12/meta/content",$vocabulary$4={"https://json-schema.org/draft/2020-12/vocab/content":!0},$dynamicAnchor$4="meta",title$4="Content vocabulary meta-schema",type$4=["object","boolean"],properties$4={contentEncoding:{type:"string"},contentMediaType:{type:"string"},contentSchema:{$dynamicRef:"#meta"}},require$$3={$schema:$schema$4,$id:$id$4,$vocabulary:$vocabulary$4,$dynamicAnchor:$dynamicAnchor$4,title:title$4,type:type$4,properties:properties$4},$schema$3="https://json-schema.org/draft/2020-12/schema",$id$3="https://json-schema.org/draft/2020-12/meta/core",$vocabulary$3={"https://json-schema.org/draft/2020-12/vocab/core":!0},$dynamicAnchor$3="meta",title$3="Core vocabulary meta-schema",type$3=["object","boolean"],properties$3={$id:{$ref:"#/$defs/uriReferenceString",$comment:"Non-empty fragments not allowed.",pattern:"^[^#]*#?$"},$schema:{$ref:"#/$defs/uriString"},$ref:{$ref:"#/$defs/uriReferenceString"},$anchor:{$ref:"#/$defs/anchorString"},$dynamicRef:{$ref:"#/$defs/uriReferenceString"},$dynamicAnchor:{$ref:"#/$defs/anchorString"},$vocabulary:{type:"object",propertyNames:{$ref:"#/$defs/uriString"},additionalProperties:{type:"boolean"}},$comment:{type:"string"},$defs:{type:"object",additionalProperties:{$dynamicRef:"#meta"}}},$defs$1={anchorString:{type:"string",pattern:"^[A-Za-z_][-A-Za-z0-9._]*$"},uriString:{type:"string",format:"uri"},uriReferenceString:{type:"string",format:"uri-reference"}},require$$4={$schema:$schema$3,$id:$id$3,$vocabulary:$vocabulary$3,$dynamicAnchor:$dynamicAnchor$3,title:title$3,type:type$3,properties:properties$3,$defs:$defs$1},$schema$2="https://json-schema.org/draft/2020-12/schema",$id$2="https://json-schema.org/draft/2020-12/meta/format-annotation",$vocabulary$2={"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0},$dynamicAnchor$2="meta",title$2="Format vocabulary meta-schema for annotation results",type$2=["object","boolean"],properties$2={format:{type:"string"}},require$$5={$schema:$schema$2,$id:$id$2,$vocabulary:$vocabulary$2,$dynamicAnchor:$dynamicAnchor$2,title:title$2,type:type$2,properties:properties$2},$schema$1="https://json-schema.org/draft/2020-12/schema",$id$1="https://json-schema.org/draft/2020-12/meta/meta-data",$vocabulary$1={"https://json-schema.org/draft/2020-12/vocab/meta-data":!0},$dynamicAnchor$1="meta",title$1="Meta-data vocabulary meta-schema",type$1=["object","boolean"],properties$1={title:{type:"string"},description:{type:"string"},default:!0,deprecated:{type:"boolean",default:!1},readOnly:{type:"boolean",default:!1},writeOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0}},require$$6={$schema:$schema$1,$id:$id$1,$vocabulary:$vocabulary$1,$dynamicAnchor:$dynamicAnchor$1,title:title$1,type:type$1,properties:properties$1},$schema="https://json-schema.org/draft/2020-12/schema",$id="https://json-schema.org/draft/2020-12/meta/validation",$vocabulary={"https://json-schema.org/draft/2020-12/vocab/validation":!0},$dynamicAnchor="meta",title="Validation vocabulary meta-schema",type=["object","boolean"],properties={type:{anyOf:[{$ref:"#/$defs/simpleTypes"},{type:"array",items:{$ref:"#/$defs/simpleTypes"},minItems:1,uniqueItems:!0}]},const:!0,enum:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/$defs/nonNegativeInteger"},minLength:{$ref:"#/$defs/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},maxItems:{$ref:"#/$defs/nonNegativeInteger"},minItems:{$ref:"#/$defs/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},maxContains:{$ref:"#/$defs/nonNegativeInteger"},minContains:{$ref:"#/$defs/nonNegativeInteger",default:1},maxProperties:{$ref:"#/$defs/nonNegativeInteger"},minProperties:{$ref:"#/$defs/nonNegativeIntegerDefault0"},required:{$ref:"#/$defs/stringArray"},dependentRequired:{type:"object",additionalProperties:{$ref:"#/$defs/stringArray"}}},$defs={nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{$ref:"#/$defs/nonNegativeInteger",default:0},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},require$$7={$schema,$id,$vocabulary,$dynamicAnchor,title,type,properties,$defs};Object.defineProperty(jsonSchema202012,"__esModule",{value:!0});const metaSchema=require$$0,applicator=require$$1,unevaluated=require$$2,content=require$$3,core=require$$4,format$1=require$$5,metadata=require$$6,validation=require$$7,META_SUPPORT_DATA=["/properties"];function addMetaSchema2020($t){return[metaSchema,applicator,unevaluated,content,core,e(this,format$1),metadata,e(this,validation)].forEach(_t=>this.addMetaSchema(_t,void 0,!1)),this;function e(_t,At){return $t?_t.$dataMetaSchema(At,META_SUPPORT_DATA):At}}jsonSchema202012.default=addMetaSchema2020;(function($t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const _t=core$3,At=draft2020,xt=discriminator,kt=jsonSchema202012,Bt="https://json-schema.org/draft/2020-12/schema";class Nt extends _t.default{constructor(zt={}){super({...zt,dynamicRef:!0,next:!0,unevaluated:!0})}_addVocabularies(){super._addVocabularies(),At.default.forEach(zt=>this.addVocabulary(zt)),this.opts.discriminator&&this.addKeyword(xt.default)}_addDefaultMetaSchema(){super._addDefaultMetaSchema();const{$data:zt,meta:Vt}=this.opts;Vt&&(kt.default.call(this,zt),this.refs["http://json-schema.org/schema"]=Bt)}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(Bt)?Bt:void 0)}}$t.exports=e=Nt,Object.defineProperty(e,"__esModule",{value:!0}),e.default=Nt;var Ut=validate;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return Ut.KeywordCxt}});var Lt=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return Lt._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return Lt.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return Lt.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return Lt.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return Lt.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return Lt.CodeGen}});var jt=validation_error;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return jt.default}});var Kt=ref_error;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return Kt.default}})})(_2020,_2020.exports);var _2020Exports=_2020.exports;const Ajv=getDefaultExportFromCjs(_2020Exports);var __awaiter$2c=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class ProtocolsGrantAuthorization{static authorizeConfigure(e){return __awaiter$2c(this,void 0,void 0,function*(){const{protocolsConfigureMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:_t,expectedGrantor:At,expectedGrantee:xt,permissionGrant:kt,messageStore:Bt}),ProtocolsGrantAuthorization.verifyScope(_t,kt.scope)})}static authorizeQuery(e){var _t;return __awaiter$2c(this,void 0,void 0,function*(){const{expectedGrantee:At,expectedGrantor:xt,incomingMessage:kt,permissionGrant:Bt,messageStore:Nt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:kt,expectedGrantor:xt,expectedGrantee:At,permissionGrant:Bt,messageStore:Nt});const Lt=Bt.scope.protocol,jt=(_t=kt.descriptor.filter)===null||_t===void 0?void 0:_t.protocol;if(Lt!==void 0&&jt!==Lt)throw new DwnError(DwnErrorCode.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch,`Grant protocol scope ${Lt} does not match protocol in message ${jt}`)})}static verifyScope(e,_t){if(_t.protocol!==void 0&&_t.protocol!==e.descriptor.definition.protocol)throw new DwnError(DwnErrorCode.ProtocolsGrantAuthorizationScopeProtocolMismatch,"Grant scope specifies different protocol than what appears in the configure message.")}}var ProtocolActor;(function($t){$t.Anyone="anyone",$t.Author="author",$t.Recipient="recipient"})(ProtocolActor||(ProtocolActor={}));var ProtocolAction;(function($t){$t.CoDelete="co-delete",$t.CoPrune="co-prune",$t.CoUpdate="co-update",$t.Create="create",$t.Delete="delete",$t.Prune="prune",$t.Query="query",$t.Read="read",$t.Subscribe="subscribe",$t.Update="update"})(ProtocolAction||(ProtocolAction={}));var __awaiter$2b=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$w=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class ProtocolsConfigure extends AbstractMessage{static parse(e){return __awaiter$2b(this,void 0,void 0,function*(){return Message.validateJsonSchema(e),ProtocolsConfigure.validateProtocolDefinition(e.descriptor.definition),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor),Time.validateTimestamp(e.descriptor.messageTimestamp),new ProtocolsConfigure(e)})}static create(e){var _t;return __awaiter$2b(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Time.getCurrentTimestamp(),definition:ProtocolsConfigure.normalizeDefinition(e.definition)},xt=yield Message.createAuthorization({descriptor:At,signer:e.signer,delegatedGrant:e.delegatedGrant,permissionGrantId:e.permissionGrantId}),kt={descriptor:At,authorization:xt};return Message.validateJsonSchema(kt),ProtocolsConfigure.validateProtocolDefinition(kt.descriptor.definition),new ProtocolsConfigure(kt)})}authorizeAuthorDelegate(e){return __awaiter$2b(this,void 0,void 0,function*(){const _t=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield ProtocolsGrantAuthorization.authorizeConfigure({protocolsConfigureMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:_t,messageStore:e})})}static validateProtocolDefinition(e){const{protocol:_t,types:At}=e;validateProtocolUrlNormalized(_t);for(const xt in At){const kt=At[xt].schema;kt!==void 0&&validateSchemaUrlNormalized(kt)}ProtocolsConfigure.validateStructure(e)}static validateStructure(e){const _t=Object.keys(e.types),At=ProtocolsConfigure.fetchAllRolePathsRecursively("",e.structure,[]);ProtocolsConfigure.validateRuleSetRecursively({ruleSet:e.structure,ruleSetProtocolPath:"",recordTypes:_t,roles:At})}static fetchAllRolePathsRecursively(e,_t,At){if(e.split("/").length>10)throw new DwnError(DwnErrorCode.ProtocolsConfigureRecordNestingDepthExceeded,"Record nesting depth exceeded 10 levels.");for(const xt in _t){if(xt.startsWith("$"))continue;const kt=_t[xt];let Bt;e===""?Bt=xt:Bt=`${e}/${xt}`,kt.$role?At.push(Bt):ProtocolsConfigure.fetchAllRolePathsRecursively(Bt,kt,At)}return At}static validateRuleSetRecursively(e){var _t;const{ruleSet:At,ruleSetProtocolPath:xt,recordTypes:kt,roles:Bt}=e;if(At.$size!==void 0){const{min:Ut=0,max:Lt}=At.$size;if(Lt!==void 0&&Lt<Ut)throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidSize,`Invalid size range found: max limit ${Lt} less than min limit ${Ut} at protocol path '${xt}'`)}if(At.$tags){const Ut=new Ajv.default,Lt=At.$tags,jt=__rest$w(Lt,["$allowUndefinedTags","$requiredTags"]);for(const Kt in jt){const qt=jt[Kt];if(!Ut.validateSchema(qt)){const zt=Ut.errorsText(Ut.errors,{dataVar:`${xt}/$tags/${Kt}`});throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidTagSchema,`tags schema validation error: ${zt}`)}}}const Nt=(_t=At.$actions)!==null&&_t!==void 0?_t:[];for(let Ut=0;Ut<Nt.length;Ut++){const Lt=Nt[Ut];if(Lt.role!==void 0&&!Bt.includes(Lt.role))throw new DwnError(DwnErrorCode.ProtocolsConfigureRoleDoesNotExistAtGivenPath,`Role in action ${JSON.stringify(Lt)} for rule set ${xt} does not exist.`);if(Lt.who==="anyone"&&Lt.of)throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionOfNotAllowed,`'of' is not allowed at rule set protocol path (${xt})`);if(Lt.who===ProtocolActor.Recipient&&Lt.of===void 0&&Lt.can.some(Kt=>![ProtocolAction.CoUpdate,ProtocolAction.CoDelete,ProtocolAction.CoPrune].includes(Kt)))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidRecipientOfAction,"Rules for `recipient` without `of` property must have `can` containing only `co-update`, `co-delete`, and `co-prune`.");if(Lt.who===ProtocolActor.Author&&!Lt.of)throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionMissingOf,"'of' is required when 'author' is specified as 'who'");if(Lt.can!==void 0){if(Lt.can.includes(ProtocolAction.Update)&&!Lt.can.includes(ProtocolAction.Create))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionUpdateWithoutCreate,`Action rule ${JSON.stringify(Lt)} contains 'update' action but missing the required 'create' action.`);if(Lt.can.includes(ProtocolAction.Delete)&&!Lt.can.includes(ProtocolAction.Create))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionDeleteWithoutCreate,`Action rule ${JSON.stringify(Lt)} contains 'delete' action but missing the required 'create' action.`)}for(let jt=Ut+1;jt<Nt.length;jt++){const Kt=Nt[jt];if(Lt.who!==void 0){if(Lt.who===Kt.who&&Lt.of===Kt.of)throw new DwnError(DwnErrorCode.ProtocolsConfigureDuplicateActorInRuleSet,`More than one action rule per actor ${Lt.who} of ${Lt.of} not allowed within a rule set: ${JSON.stringify(Lt)}`)}else if(Lt.role===Kt.role)throw new DwnError(DwnErrorCode.ProtocolsConfigureDuplicateRoleInRuleSet,`More than one action rule per role ${Lt.role} not allowed within a rule set: ${JSON.stringify(Lt)}`)}}for(const Ut in At){if(Ut.startsWith("$"))continue;if(!kt.includes(Ut))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidRuleSetRecordType,`Rule set ${Ut} is not declared as an allowed type in the protocol definition.`);const Lt=At[Ut];let jt;xt===""?jt=Ut:jt=`${xt}/${Ut}`,ProtocolsConfigure.validateRuleSetRecursively({ruleSet:Lt,ruleSetProtocolPath:jt,recordTypes:kt,roles:Bt})}}static normalizeDefinition(e){const _t=Object.assign({},e.types);for(const At in _t){const xt=_t[At].schema;xt!==void 0&&(_t[At].schema=normalizeSchemaUrl(xt))}return Object.assign(Object.assign({},e),{protocol:normalizeProtocolUrl(e.protocol),types:_t})}}var __awaiter$2a=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$v=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class ProtocolsConfigureHandler{constructor(e,_t,At,xt){this.didResolver=e,this.messageStore=_t,this.eventLog=At,this.eventStream=xt}handle({tenant:e,message:_t}){return __awaiter$2a(this,void 0,void 0,function*(){let At;try{At=yield ProtocolsConfigure.parse(_t)}catch(jt){return messageReplyFromError(jt,400)}try{yield authenticate(_t.authorization,this.didResolver),yield ProtocolsConfigureHandler.authorizeProtocolsConfigure(e,At,this.messageStore)}catch(jt){return messageReplyFromError(jt,401)}const xt={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,protocol:_t.descriptor.definition.protocol},{messages:kt}=yield this.messageStore.query(e,[xt]);let Bt=yield Message.getNewestMessage(kt),Nt=!1;(Bt===void 0||(yield Message.isNewer(_t,Bt)))&&(Nt=!0,Bt=_t);let Ut;if(Nt){const jt=ProtocolsConfigureHandler.constructIndexes(At);yield this.messageStore.put(e,_t,jt);const Kt=yield Message.getCid(_t);yield this.eventLog.append(e,Kt,jt),this.eventStream!==void 0&&this.eventStream.emit(e,{message:_t},jt),Ut={status:{code:202,detail:"Accepted"}}}else Ut={status:{code:409,detail:"Conflict"}};const Lt=[];for(const jt of kt)if(yield Message.isNewer(Bt,jt)){const Kt=yield Message.getCid(jt);Lt.push(Kt),yield this.messageStore.delete(e,Kt)}return yield this.eventLog.deleteEventsByCid(e,Lt),Ut})}static constructIndexes(e){const _t=e.message.descriptor,{definition:At}=_t,xt=__rest$v(_t,["definition"]),{author:kt}=e;return Object.assign(Object.assign({},xt),{author:kt,protocol:At.protocol,published:At.published})}static authorizeProtocolsConfigure(e,_t,At){return __awaiter$2a(this,void 0,void 0,function*(){if(_t.isSignedByAuthorDelegate&&(yield _t.authorizeAuthorDelegate(At)),_t.author!==e)if(_t.author!==void 0&&_t.signaturePayload.permissionGrantId!==void 0){const xt=yield PermissionsProtocol.fetchGrant(e,At,_t.signaturePayload.permissionGrantId);yield ProtocolsGrantAuthorization.authorizeConfigure({protocolsConfigureMessage:_t.message,expectedGrantor:e,expectedGrantee:_t.author,permissionGrant:xt,messageStore:At})}else throw new DwnError(DwnErrorCode.ProtocolsConfigureAuthorizationFailed,"message failed authorization")})}}var __awaiter$29=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class ProtocolsQuery extends AbstractMessage{static parse(e){return __awaiter$29(this,void 0,void 0,function*(){return e.authorization!==void 0&&(yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),e.descriptor.filter!==void 0&&validateProtocolUrlNormalized(e.descriptor.filter.protocol),Time.validateTimestamp(e.descriptor.messageTimestamp),new ProtocolsQuery(e)})}static create(e){var _t;return __awaiter$29(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Query,messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Time.getCurrentTimestamp(),filter:e.filter?ProtocolsQuery.normalizeFilter(e.filter):void 0};removeUndefinedProperties$2(At);let xt;e.signer!==void 0&&(xt=yield Message.createAuthorization({descriptor:At,signer:e.signer,permissionGrantId:e.permissionGrantId}));const kt={descriptor:At,authorization:xt};return Message.validateJsonSchema(kt),new ProtocolsQuery(kt)})}static normalizeFilter(e){return Object.assign(Object.assign({},e),{protocol:normalizeProtocolUrl(e.protocol)})}authorize(e,_t){return __awaiter$29(this,void 0,void 0,function*(){if(this.author!==e)if(this.author!==void 0&&this.signaturePayload.permissionGrantId){const At=yield PermissionsProtocol.fetchGrant(e,_t,this.signaturePayload.permissionGrantId);yield ProtocolsGrantAuthorization.authorizeQuery({expectedGrantor:e,expectedGrantee:this.author,incomingMessage:this.message,permissionGrant:At,messageStore:_t})}else throw new DwnError(DwnErrorCode.ProtocolsQueryUnauthorized,"The ProtocolsQuery failed authorization")})}}var __awaiter$28=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class ProtocolsQueryHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.dataStore=At}handle({tenant:e,message:_t}){return __awaiter$28(this,void 0,void 0,function*(){let At;try{At=yield ProtocolsQuery.parse(_t)}catch(Bt){return messageReplyFromError(Bt,400)}try{yield authenticate(_t.authorization,this.didResolver),yield At.authorize(e,this.messageStore)}catch(Bt){if(Bt.code===DwnErrorCode.AuthenticateJwsMissing||Bt.code===DwnErrorCode.ProtocolsQueryUnauthorized||Bt.code===DwnErrorCode.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch){const Nt=yield this.fetchPublishedProtocolsConfigure(e,At);return{status:{code:200,detail:"OK"},entries:Nt}}else return messageReplyFromError(Bt,401)}const xt=Object.assign(Object.assign({},_t.descriptor.filter),{interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure});removeUndefinedProperties$2(xt);const{messages:kt}=yield this.messageStore.query(e,[xt]);return{status:{code:200,detail:"OK"},entries:kt}})}fetchPublishedProtocolsConfigure(e,_t){return __awaiter$28(this,void 0,void 0,function*(){const At=Object.assign(Object.assign({},_t.message.descriptor.filter),{interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,published:!0}),{messages:xt}=yield this.messageStore.query(e,[At]);return xt})}}var __awaiter$27=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$u=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class ProtocolAuthorization{static validateReferentialIntegrity(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){const xt=yield ProtocolAuthorization.fetchProtocolDefinition(e,_t.message.descriptor.protocol,At);ProtocolAuthorization.verifyType(_t.message,xt.types),yield ProtocolAuthorization.verifyProtocolPathAndContextId(e,_t,At);const kt=ProtocolAuthorization.getRuleSet(_t.message.descriptor.protocolPath,xt);yield ProtocolAuthorization.verifyAsRoleRecordIfNeeded(e,_t,kt,At),ProtocolAuthorization.verifySizeLimit(_t,kt),ProtocolAuthorization.verifyTagsIfNeeded(_t,kt)})}static authorizeWrite(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){const xt=yield ProtocolAuthorization.fetchInitialWrite(e,_t.message.recordId,At);let kt;xt===void 0?kt=yield ProtocolAuthorization.constructRecordChain(e,_t.message.descriptor.parentId,At):kt=yield ProtocolAuthorization.constructRecordChain(e,_t.message.recordId,At);const Bt=yield ProtocolAuthorization.fetchProtocolDefinition(e,_t.message.descriptor.protocol,At),Nt=ProtocolAuthorization.getRuleSet(_t.message.descriptor.protocolPath,Bt);yield ProtocolAuthorization.verifyInvokedRole(e,_t,_t.message.descriptor.protocol,_t.message.contextId,Bt,At),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,_t,Nt,kt,At)})}static authorizeRead(e,_t,At,xt){return __awaiter$27(this,void 0,void 0,function*(){const kt=yield ProtocolAuthorization.constructRecordChain(e,At.message.recordId,xt),Bt=yield ProtocolAuthorization.fetchProtocolDefinition(e,At.message.descriptor.protocol,xt),Nt=ProtocolAuthorization.getRuleSet(At.message.descriptor.protocolPath,Bt);yield ProtocolAuthorization.verifyInvokedRole(e,_t,At.message.descriptor.protocol,At.message.contextId,Bt,xt),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,_t,Nt,kt,xt)})}static authorizeQueryOrSubscribe(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){const{protocol:xt,protocolPath:kt,contextId:Bt}=_t.message.descriptor.filter,Nt=yield ProtocolAuthorization.fetchProtocolDefinition(e,xt,At),Ut=ProtocolAuthorization.getRuleSet(kt,Nt);yield ProtocolAuthorization.verifyInvokedRole(e,_t,xt,Bt,Nt,At),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,_t,Ut,[],At)})}static authorizeDelete(e,_t,At,xt){return __awaiter$27(this,void 0,void 0,function*(){const kt=yield ProtocolAuthorization.constructRecordChain(e,_t.message.descriptor.recordId,xt),Bt=yield ProtocolAuthorization.fetchProtocolDefinition(e,At.message.descriptor.protocol,xt),Nt=ProtocolAuthorization.getRuleSet(At.message.descriptor.protocolPath,Bt);yield ProtocolAuthorization.verifyInvokedRole(e,_t,At.message.descriptor.protocol,At.message.contextId,Bt,xt),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,_t,Nt,kt,xt)})}static fetchProtocolDefinition(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){if(_t===PermissionsProtocol.uri)return PermissionsProtocol.definition;const xt={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,protocol:_t},{messages:kt}=yield At.query(e,[xt]);if(kt.length===0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationProtocolNotFound,`unable to find protocol definition for ${_t}`);return kt[0].descriptor.definition})}static constructRecordChain(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){if(_t===void 0)return[];const xt=[];let kt=_t;for(;kt!==void 0;){const Bt=yield ProtocolAuthorization.fetchInitialWrite(e,kt,At);if(Bt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationParentNotFoundConstructingRecordChain,`Unexpected error that should never trigger: no parent found with ID ${kt} when constructing record chain.`);xt.push(Bt),kt=Bt.descriptor.parentId}return xt.reverse()})}static fetchInitialWrite(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){const xt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,recordId:_t},{messages:kt}=yield At.query(e,[xt]);return kt.length===0?void 0:yield RecordsWrite.getInitialWrite(kt)})}static getRuleSet(e,_t){const At=ProtocolAuthorization.getRuleSetAtProtocolPath(e,_t);if(At===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMissingRuleSet,`No rule set defined for protocolPath ${e}`);return At}static verifyProtocolPathAndContextId(e,_t,At){var xt;return __awaiter$27(this,void 0,void 0,function*(){const kt=_t.message.descriptor.protocolPath,Bt=ProtocolAuthorization.getTypeName(kt),Nt=_t.message.descriptor.parentId;if(Nt===void 0){if(kt!==Bt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationParentlessIncorrectProtocolPath,`Declared protocol path '${kt}' is not valid for records with no parent'.`);return}const Ut=_t.message.descriptor.protocol,Lt={isLatestBaseState:!0,interface:DwnInterfaceName.Records,method:DwnMethodName.Write,protocol:Ut,recordId:Nt},{messages:jt}=yield At.query(e,[Lt]),Kt=jt[0];if(`${(xt=Kt==null?void 0:Kt.descriptor)===null||xt===void 0?void 0:xt.protocolPath}/${Bt}`!==kt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationIncorrectProtocolPath,`Could not find matching parent record to verify declared protocol path '${kt}'.`);const Vt=`${Kt.contextId}/${_t.message.recordId}`,Ht=_t.message.contextId;if(Ht!==Vt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationIncorrectContextId,`Declared contextId '${Ht}' is not the same as expected: '${Vt}'.`)})}static verifyType(e,_t){const At=Object.keys(_t),xt=e.descriptor.protocolPath,kt=ProtocolAuthorization.getTypeName(xt);if(!At.includes(kt))throw new DwnError(DwnErrorCode.ProtocolAuthorizationInvalidType,`record with type ${kt} not allowed in protocol`);const Bt=e.descriptor.protocolPath,Nt=ProtocolAuthorization.getTypeName(Bt),Ut=_t[Nt],{schema:Lt}=e.descriptor;if(Ut.schema!==void 0&&Ut.schema!==Lt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationInvalidSchema,`type '${Nt}' must have schema '${Ut.schema}',         instead has '${Lt}'`);const{dataFormat:jt}=e.descriptor;if(Ut.dataFormats!==void 0&&!Ut.dataFormats.includes(jt))throw new DwnError(DwnErrorCode.ProtocolAuthorizationIncorrectDataFormat,`type '${Nt}' must have data format in (${Ut.dataFormats}),         instead has '${jt}'`)}static verifyInvokedRole(e,_t,At,xt,kt,Bt){var Nt;return __awaiter$27(this,void 0,void 0,function*(){const Ut=(Nt=_t.signaturePayload)===null||Nt===void 0?void 0:Nt.protocolRole;if(Ut===void 0)return;const Lt=ProtocolAuthorization.getRuleSetAtProtocolPath(Ut,kt);if(Lt===void 0||!Lt.$role)throw new DwnError(DwnErrorCode.ProtocolAuthorizationNotARole,`Protocol path ${Ut} does not match role record type.`);const jt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,protocol:At,protocolPath:Ut,recipient:_t.author,isLatestBaseState:!0},Kt=Ut.split("/").length-1;if(xt===void 0&&Kt>0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMissingContextId,"Could not verify role because contextId is missing.");if(Kt>0){const Vt=xt.split("/").slice(0,Kt).join("/"),Ht=FilterUtility.constructPrefixFilterAsRangeFilter(Vt);jt.contextId=Ht}const{messages:qt}=yield Bt.query(e,[jt]);if(qt.length===0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMatchingRoleRecordNotFound,`No matching role record found for protocol path ${Ut}`)})}static getActionsSeekingARuleMatch(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){switch(_t.message.descriptor.method){case DwnMethodName.Delete:const xt=_t,kt=xt.message.descriptor.recordId,Bt=yield RecordsWrite.fetchInitialRecordsWrite(At,e,kt);if(Bt===void 0)return[];const Nt=[];return xt.message.descriptor.prune?(Nt.push(ProtocolAction.CoPrune),_t.author===Bt.author&&Nt.push(ProtocolAction.Prune)):(Nt.push(ProtocolAction.CoDelete),_t.author===Bt.author&&Nt.push(ProtocolAction.Delete)),Nt;case DwnMethodName.Query:return[ProtocolAction.Query];case DwnMethodName.Read:return[ProtocolAction.Read];case DwnMethodName.Subscribe:return[ProtocolAction.Subscribe];case DwnMethodName.Write:if(yield _t.isInitialWrite())return[ProtocolAction.Create];{const jt=_t.message.recordId,Kt=yield RecordsWrite.fetchInitialRecordsWrite(At,e,jt);return Kt===void 0?[]:_t.author===Kt.author?[ProtocolAction.CoUpdate,ProtocolAction.Update]:[ProtocolAction.CoUpdate]}}return[]})}static authorizeAgainstAllowedActions(e,_t,At,xt,kt){var Bt;return __awaiter$27(this,void 0,void 0,function*(){const Nt=_t.message.descriptor.method,Ut=yield ProtocolAuthorization.getActionsSeekingARuleMatch(e,_t,kt),Lt=_t.author,jt=At.$actions;if(jt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationActionRulesNotFound,`no action rule defined for Records${Nt}, ${Lt} is unauthorized`);const Kt=(Bt=_t.signaturePayload)===null||Bt===void 0?void 0:Bt.protocolRole;for(const qt of jt){if(!qt.can.some(Ht=>Ut.includes(Ht)))continue;if(qt.who===ProtocolActor.Anyone)return;if(Lt===void 0)continue;if(Kt!==void 0){if(qt.role===Kt)return;continue}if(qt.who===ProtocolActor.Recipient&&qt.of===void 0){let Ht;if(_t.message.descriptor.method===DwnMethodName.Write?Ht=_t.message:Ht=xt[xt.length-1],Ht.descriptor.recipient===Lt)return;continue}if(yield ProtocolAuthorization.checkActor(Lt,qt,xt))return}throw new DwnError(DwnErrorCode.ProtocolAuthorizationActionNotAllowed,`Inbound message action Records${Nt} by author ${_t.author} not allowed.`)})}static verifySizeLimit(e,_t){const{min:At=0,max:xt}=_t.$size||{},kt=e.message.descriptor.dataSize;if(kt<At)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMinSizeInvalid,`data size ${kt} is less than allowed ${At}`);if(xt!==void 0&&kt>xt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMaxSizeInvalid,`data size ${kt} is more than allowed ${xt}`)}static verifyTagsIfNeeded(e,_t){if(_t.$tags!==void 0){const{tags:At={},protocol:xt,protocolPath:kt}=e.message.descriptor,Bt=_t.$tags,{$allowUndefinedTags:Nt,$requiredTags:Ut}=Bt,Lt=__rest$u(Bt,["$allowUndefinedTags","$requiredTags"]),jt=Nt||!1,Kt=Ut||[],qt=new Ajv.default,zt=qt.compile({type:"object",properties:Lt,required:Kt,additionalProperties:jt});if(!zt(At)){const Ht=qt.errorsText(zt.errors,{dataVar:`${xt}/${kt}/$tags`});throw new DwnError(DwnErrorCode.ProtocolAuthorizationTagsInvalidSchema,`tags schema validation error: ${Ht}`)}}}static verifyAsRoleRecordIfNeeded(e,_t,At,xt){return __awaiter$27(this,void 0,void 0,function*(){if(!At.$role)return;const kt=_t,Bt=kt.message.descriptor.recipient;if(Bt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationRoleMissingRecipient,"Role records must have a recipient");const Nt=kt.message.descriptor.protocolPath,Ut={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0,protocol:kt.message.descriptor.protocol,protocolPath:Nt,recipient:Bt},Lt=Records.getParentContextFromOfContextId(kt.message.contextId);if(Lt!==""){const zt=FilterUtility.constructPrefixFilterAsRangeFilter(Lt);Ut.contextId=zt}const{messages:jt}=yield xt.query(e,[Ut]);if(jt.filter(zt=>zt.recordId!==kt.message.recordId).length>0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationDuplicateRoleRecipient,`DID '${Bt}' is already recipient of a role record at protocol path '${Nt} under the parent context ${Lt}.`)})}static getRuleSetAtProtocolPath(e,_t){const At=e.split("/");let xt=_t.structure,kt=0;for(;kt<At.length;){const Bt=At[kt],Nt=xt[Bt];if(Nt===void 0)return;xt=Nt,kt++}return xt}static checkActor(e,_t,At){return __awaiter$27(this,void 0,void 0,function*(){const xt=At.find(kt=>kt.descriptor.protocolPath===_t.of);if(xt===void 0)return!1;if(_t.who===ProtocolActor.Recipient)return e===xt.descriptor.recipient;{const kt=(yield RecordsWrite.parse(xt)).author;return e===kt}})}static getTypeName(e){return e.split("/").slice(-1)[0]}}var __awaiter$26=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsDelete extends AbstractMessage{static parse(e){return __awaiter$26(this,void 0,void 0,function*(){let _t;return e.authorization!==void 0&&(_t=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,_t),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsDelete(e)})}static create(e){var _t,At;return __awaiter$26(this,void 0,void 0,function*(){const xt=e.recordId,kt=Time.getCurrentTimestamp(),Bt={interface:DwnInterfaceName.Records,method:DwnMethodName.Delete,messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:kt,recordId:xt,prune:(At=e.prune)!==null&&At!==void 0?At:!1},Nt=yield Message.createAuthorization({descriptor:Bt,signer:e.signer,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}),Ut={descriptor:Bt,authorization:Nt};return Message.validateJsonSchema(Ut),new RecordsDelete(Ut)})}constructIndexes(e){const _t=this.message,At=Object.assign({},_t.descriptor),{protocol:xt,protocolPath:kt,recipient:Bt,schema:Nt,parentId:Ut,dateCreated:Lt}=e.descriptor,jt=Object.assign({protocol:xt,protocolPath:kt,recipient:Bt,schema:Nt,parentId:Ut,dateCreated:Lt,contextId:e.contextId,author:this.author},At);return removeUndefinedProperties$2(jt),jt}authorizeDelegate(e,_t){return __awaiter$26(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeDelete({recordsDeleteMessage:this.message,recordsWriteToDelete:e,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:At,messageStore:_t})})}}var __awaiter$25=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},ResumableTaskName;(function($t){$t.RecordsDelete="RecordsDelete"})(ResumableTaskName||(ResumableTaskName={}));class ResumableTaskManager{constructor(e,_t){this.resumableTaskStore=e,this.resumableTaskBatchSize=100,this.resumableTaskHandlers={[ResumableTaskName.RecordsDelete]:At=>__awaiter$25(this,void 0,void 0,function*(){return yield _t.performRecordsDelete(At)})}}run(e){return __awaiter$25(this,void 0,void 0,function*(){const _t=ResumableTaskManager.timeoutExtensionFrequencyInSeconds*2,At=yield this.resumableTaskStore.register(e,_t);yield this.runWithAutomaticTimeoutExtension(At)})}runWithAutomaticTimeoutExtension(e){return __awaiter$25(this,void 0,void 0,function*(){const _t=ResumableTaskManager.timeoutExtensionFrequencyInSeconds*2;let At;try{At=setInterval(()=>{this.resumableTaskStore.extend(e.id,_t)},ResumableTaskManager.timeoutExtensionFrequencyInSeconds*1e3);const xt=this.resumableTaskHandlers[e.task.name];yield xt(e.task.data),yield this.resumableTaskStore.delete(e.id)}finally{ResumableTaskManager.clearTimeoutExtensionTimer(At)}})}static clearTimeoutExtensionTimer(e){clearInterval(e)}resumeTasksAndWaitForCompletion(){return __awaiter$25(this,void 0,void 0,function*(){for(;;){const e=yield this.resumableTaskStore.grab(this.resumableTaskBatchSize);if(e===void 0||e.length===0)break;yield this.retryTasksUntilCompletion(e)}})}retryTasksUntilCompletion(e){return __awaiter$25(this,void 0,void 0,function*(){let _t=e;for(;_t.length>0;){const At=_t;_t=[];const xt=At.map(kt=>__awaiter$25(this,void 0,void 0,function*(){try{yield this.runWithAutomaticTimeoutExtension(kt)}catch(Bt){console.error("Error while running resumable task:",Bt),console.error("Resumable task:",e),_t.push(kt)}}));yield Promise.all(xt)}})}}ResumableTaskManager.timeoutExtensionFrequencyInSeconds=30;var __awaiter$24=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsDeleteHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.resumableTaskManager=At}handle({tenant:e,message:_t}){return __awaiter$24(this,void 0,void 0,function*(){let At;try{At=yield RecordsDelete.parse(_t)}catch(Lt){return messageReplyFromError(Lt,400)}try{yield authenticate(_t.authorization,this.didResolver)}catch(Lt){return messageReplyFromError(Lt,401)}const xt={interface:DwnInterfaceName.Records,recordId:_t.descriptor.recordId},{messages:kt}=yield this.messageStore.query(e,[xt]),Bt=yield Message.getNewestMessage(kt);if(!Records.canPerformDeleteAgainstRecord(_t,Bt))return{status:{code:404,detail:"Not Found"}};if(!(yield Message.isNewer(_t,Bt)))return{status:{code:409,detail:"Conflict"}};try{const Lt=yield RecordsWrite.fetchInitialRecordsWrite(this.messageStore,e,_t.descriptor.recordId);yield RecordsDeleteHandler.authorizeRecordsDelete(e,At,Lt,this.messageStore)}catch(Lt){return messageReplyFromError(Lt,401)}return yield this.resumableTaskManager.run({name:ResumableTaskName.RecordsDelete,data:{tenant:e,message:_t}}),{status:{code:202,detail:"Accepted"}}})}static authorizeRecordsDelete(e,_t,At,xt){return __awaiter$24(this,void 0,void 0,function*(){if(Message.isSignedByAuthorDelegate(_t.message)&&(yield _t.authorizeDelegate(At.message,xt)),_t.author!==e)if(At.message.descriptor.protocol!==void 0)yield ProtocolAuthorization.authorizeDelete(e,_t,At,xt);else throw new DwnError(DwnErrorCode.RecordsDeleteAuthorizationFailed,"RecordsDelete message failed authorization")})}}var SortDirection;(function($t){$t[$t.Descending=-1]="Descending",$t[$t.Ascending=1]="Ascending"})(SortDirection||(SortDirection={}));var __awaiter$23=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsQueryHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.dataStore=At}handle({tenant:e,message:_t}){return __awaiter$23(this,void 0,void 0,function*(){let At;try{At=yield RecordsQuery.parse(_t)}catch(Bt){return messageReplyFromError(Bt,400)}let xt,kt;if(Records.filterIncludesPublishedRecords(At.message.descriptor.filter)&&At.author===void 0){const Bt=yield this.fetchPublishedRecords(e,At);xt=Bt.messages,kt=Bt.cursor}else{try{yield authenticate(_t.authorization,this.didResolver),yield RecordsQueryHandler.authorizeRecordsQuery(e,At,this.messageStore)}catch(Bt){return messageReplyFromError(Bt,401)}if(At.author===e){const Bt=yield this.fetchRecordsAsOwner(e,At);xt=Bt.messages,kt=Bt.cursor}else{const Bt=yield this.fetchRecordsAsNonOwner(e,At);xt=Bt.messages,kt=Bt.cursor}}for(const Bt of xt)if(!(yield RecordsWrite.isInitialWrite(Bt))){const Ut=(yield this.messageStore.query(e,[{recordId:Bt.recordId,isLatestBaseState:!1,method:DwnMethodName.Write}])).messages[0];delete Ut.encodedData,Bt.initialWrite=Ut}return{status:{code:200,detail:"OK"},entries:xt,cursor:kt}})}convertDateSort(e){switch(e){case DateSort.CreatedAscending:return{dateCreated:SortDirection.Ascending};case DateSort.CreatedDescending:return{dateCreated:SortDirection.Descending};case DateSort.PublishedAscending:return{datePublished:SortDirection.Ascending};case DateSort.PublishedDescending:return{datePublished:SortDirection.Descending};default:return{dateCreated:SortDirection.Ascending}}}fetchRecordsAsOwner(e,_t){return __awaiter$23(this,void 0,void 0,function*(){const{dateSort:At,filter:xt,pagination:kt}=_t.message.descriptor,Bt=Object.assign(Object.assign({},Records.convertFilter(xt,At)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0}),Nt=this.convertDateSort(At);return this.messageStore.query(e,[Bt],Nt,kt)})}fetchRecordsAsNonOwner(e,_t){return __awaiter$23(this,void 0,void 0,function*(){const{dateSort:At,pagination:xt,filter:kt}=_t.message.descriptor,Bt=[];Records.filterIncludesPublishedRecords(kt)&&Bt.push(RecordsQueryHandler.buildPublishedRecordsFilter(_t)),Records.filterIncludesUnpublishedRecords(kt)&&(Records.shouldBuildUnpublishedAuthorFilter(kt,_t.author)&&Bt.push(RecordsQueryHandler.buildUnpublishedRecordsByQueryAuthorFilter(_t)),Records.shouldProtocolAuthorize(_t.signaturePayload)&&Bt.push(RecordsQueryHandler.buildUnpublishedProtocolAuthorizedRecordsFilter(_t)),Records.shouldBuildUnpublishedRecipientFilter(kt,_t.author)&&Bt.push(RecordsQueryHandler.buildUnpublishedRecordsForQueryAuthorFilter(_t)));const Nt=this.convertDateSort(At);return this.messageStore.query(e,Bt,Nt,xt)})}fetchPublishedRecords(e,_t){return __awaiter$23(this,void 0,void 0,function*(){const{dateSort:At,pagination:xt}=_t.message.descriptor,kt=RecordsQueryHandler.buildPublishedRecordsFilter(_t),Bt=this.convertDateSort(At);return this.messageStore.query(e,[kt],Bt,xt)})}static buildPublishedRecordsFilter(e){const{dateSort:_t,filter:At}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(At,_t)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,published:!0,isLatestBaseState:!0})}static buildUnpublishedRecordsForQueryAuthorFilter(e){const{dateSort:_t,filter:At}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(At,_t)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,recipient:e.author,isLatestBaseState:!0,published:!1})}static buildUnpublishedProtocolAuthorizedRecordsFilter(e){const{dateSort:_t,filter:At}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(At,_t)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0,published:!1})}static buildUnpublishedRecordsByQueryAuthorFilter(e){const{dateSort:_t,filter:At}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(At,_t)),{author:e.author,interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0,published:!1})}static authorizeRecordsQuery(e,_t,At){return __awaiter$23(this,void 0,void 0,function*(){Message.isSignedByAuthorDelegate(_t.message)&&(yield _t.authorizeDelegate(At)),Records.shouldProtocolAuthorize(_t.signaturePayload)&&(yield ProtocolAuthorization.authorizeQueryOrSubscribe(e,_t,At))})}}var __awaiter$22=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsRead extends AbstractMessage{static parse(e){return __awaiter$22(this,void 0,void 0,function*(){let _t;return e.authorization!==void 0&&(_t=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,_t),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsRead(e)})}static create(e){var _t;return __awaiter$22(this,void 0,void 0,function*(){const{filter:At,signer:xt,permissionGrantId:kt,protocolRole:Bt}=e,Nt=Time.getCurrentTimestamp(),Ut={interface:DwnInterfaceName.Records,method:DwnMethodName.Read,filter:Records.normalizeFilter(At),messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Nt};removeUndefinedProperties$2(Ut);let Lt;xt!==void 0&&(Lt=yield Message.createAuthorization({descriptor:Ut,signer:xt,permissionGrantId:kt,protocolRole:Bt,delegatedGrant:e.delegatedGrant}));const jt={descriptor:Ut,authorization:Lt};return Message.validateJsonSchema(jt),new RecordsRead(jt)})}authorizeDelegate(e,_t){return __awaiter$22(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeRead({recordsReadMessage:this.message,recordsWriteMessageToBeRead:e,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:At,messageStore:_t})})}}var __awaiter$21=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsReadHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.dataStore=At}handle({tenant:e,message:_t}){return __awaiter$21(this,void 0,void 0,function*(){let At;try{At=yield RecordsRead.parse(_t)}catch(jt){return messageReplyFromError(jt,400)}try{At.author!==void 0&&(yield authenticate(_t.authorization,this.didResolver))}catch(jt){return messageReplyFromError(jt,401)}const xt=Object.assign({interface:DwnInterfaceName.Records,isLatestBaseState:!0},Records.convertFilter(_t.descriptor.filter)),{messages:kt}=yield this.messageStore.query(e,[xt]);if(kt.length===0)return{status:{code:404,detail:"Not Found"}};if(kt.length>1)return messageReplyFromError(new DwnError(DwnErrorCode.RecordsReadReturnedMultiple,"Multiple records exist for the RecordsRead filter"),400);const Bt=kt[0];try{yield RecordsReadHandler.authorizeRecordsRead(e,At,yield RecordsWrite.parse(Bt),this.messageStore)}catch(jt){return messageReplyFromError(jt,401)}let Nt;if(Bt.encodedData!==void 0){const jt=Encoder$4.base64UrlToBytes(Bt.encodedData);Nt=DataStream.fromBytes(jt),delete Bt.encodedData}else{const jt=yield this.dataStore.get(e,Bt.recordId,Bt.descriptor.dataCid);if((jt==null?void 0:jt.dataStream)===void 0)return{status:{code:404,detail:"Not Found"}};Nt=jt.dataStream}const Ut=Object.assign(Object.assign({},Bt),{data:Nt});if(!(yield RecordsWrite.isInitialWrite(Ut))){const Kt=(yield this.messageStore.query(e,[{recordId:Ut.recordId,isLatestBaseState:!1,method:DwnMethodName.Write}])).messages[0];delete Kt.encodedData,Ut.initialWrite=Kt}return{status:{code:200,detail:"OK"},record:Ut}})}static authorizeRecordsRead(e,_t,At,xt){return __awaiter$21(this,void 0,void 0,function*(){Message.isSignedByAuthorDelegate(_t.message)&&(yield _t.authorizeDelegate(At.message,xt));const{descriptor:kt}=At.message;if(_t.author!==e){if(kt.published===!0)return;if(_t.author!==void 0&&_t.author===kt.recipient)return;if(_t.author!==void 0&&_t.signaturePayload.permissionGrantId!==void 0){const Bt=yield PermissionsProtocol.fetchGrant(e,xt,_t.signaturePayload.permissionGrantId);yield RecordsGrantAuthorization.authorizeRead({recordsReadMessage:_t.message,recordsWriteMessageToBeRead:At.message,expectedGrantor:e,expectedGrantee:_t.author,permissionGrant:Bt,messageStore:xt})}else if(kt.protocol!==void 0)yield ProtocolAuthorization.authorizeRead(e,_t,At,xt);else throw new DwnError(DwnErrorCode.RecordsReadAuthorizationFailed,"message failed authorization")}})}}var __awaiter$20=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsSubscribe extends AbstractMessage{static parse(e){return __awaiter$20(this,void 0,void 0,function*(){let _t;if(e.authorization!==void 0&&(_t=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,_t),(_t==null?void 0:_t.protocolRole)!==void 0&&e.descriptor.filter.protocolPath===void 0)throw new DwnError(DwnErrorCode.RecordsSubscribeFilterMissingRequiredProperties,"Role-authorized subscriptions must include `protocolPath` in the filter");return e.descriptor.filter.protocol!==void 0&&validateProtocolUrlNormalized(e.descriptor.filter.protocol),e.descriptor.filter.schema!==void 0&&validateSchemaUrlNormalized(e.descriptor.filter.schema),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsSubscribe(e)})}static create(e){var _t;return __awaiter$20(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Records,method:DwnMethodName.Subscribe,messageTimestamp:(_t=e.messageTimestamp)!==null&&_t!==void 0?_t:Time.getCurrentTimestamp(),filter:Records.normalizeFilter(e.filter)};removeUndefinedProperties$2(At);const xt=e.signer;let kt;xt&&(kt=yield Message.createAuthorization({descriptor:At,signer:xt,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}));const Bt={descriptor:At,authorization:kt};return Message.validateJsonSchema(Bt),new RecordsSubscribe(Bt)})}authorizeDelegate(e){return __awaiter$20(this,void 0,void 0,function*(){const _t=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:_t,messageStore:e})})}}var __awaiter$1$=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsSubscribeHandler{constructor(e,_t,At){this.didResolver=e,this.messageStore=_t,this.eventStream=At}handle({tenant:e,message:_t,subscriptionHandler:At}){return __awaiter$1$(this,void 0,void 0,function*(){if(this.eventStream===void 0)return messageReplyFromError(new DwnError(DwnErrorCode.RecordsSubscribeEventStreamUnimplemented,"Subscriptions are not supported"),501);let xt;try{xt=yield RecordsSubscribe.parse(_t)}catch(Lt){return messageReplyFromError(Lt,400)}let kt=[];if(Records.filterIncludesPublishedRecords(xt.message.descriptor.filter)&&xt.author===void 0)kt=[RecordsSubscribeHandler.buildPublishedRecordsFilter(xt)],delete _t.authorization;else{try{yield authenticate(_t.authorization,this.didResolver),yield RecordsSubscribeHandler.authorizeRecordsSubscribe(e,xt,this.messageStore)}catch(Lt){return messageReplyFromError(Lt,401)}xt.author===e?kt=yield RecordsSubscribeHandler.filterAsOwner(xt):kt=yield RecordsSubscribeHandler.filterAsNonOwner(xt)}const Bt=(Lt,jt,Kt)=>{e===Lt&&FilterUtility.matchAnyFilter(Kt,kt)&&At(jt)},Nt=yield Message.getCid(_t),Ut=yield this.eventStream.subscribe(e,Nt,Bt);return{status:{code:200,detail:"OK"},subscription:Ut}})}static filterAsOwner(e){return __awaiter$1$(this,void 0,void 0,function*(){const{filter:_t}=e.message.descriptor;return[Object.assign(Object.assign({},Records.convertFilter(_t)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete]})]})}static filterAsNonOwner(e){return __awaiter$1$(this,void 0,void 0,function*(){const _t=[],{filter:At}=e.message.descriptor;return Records.filterIncludesPublishedRecords(At)&&_t.push(RecordsSubscribeHandler.buildPublishedRecordsFilter(e)),Records.filterIncludesUnpublishedRecords(At)&&(Records.shouldBuildUnpublishedAuthorFilter(At,e.author)&&_t.push(RecordsSubscribeHandler.buildUnpublishedRecordsBySubscribeAuthorFilter(e)),Records.shouldProtocolAuthorize(e.signaturePayload)&&_t.push(RecordsSubscribeHandler.buildUnpublishedProtocolAuthorizedRecordsFilter(e)),Records.shouldBuildUnpublishedRecipientFilter(At,e.author)&&_t.push(RecordsSubscribeHandler.buildUnpublishedRecordsForSubscribeAuthorFilter(e))),_t})}static buildPublishedRecordsFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],published:!0})}static buildUnpublishedRecordsForSubscribeAuthorFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],recipient:e.author,published:!1})}static buildUnpublishedProtocolAuthorizedRecordsFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],published:!1})}static buildUnpublishedRecordsBySubscribeAuthorFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{author:e.author,interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],published:!1})}static authorizeRecordsSubscribe(e,_t,At){return __awaiter$1$(this,void 0,void 0,function*(){Message.isSignedByAuthorDelegate(_t.message)&&(yield _t.authorizeDelegate(At)),Records.shouldProtocolAuthorize(_t.signaturePayload)&&(yield ProtocolAuthorization.authorizeQueryOrSubscribe(e,_t,At))})}}class DwnConstant{}DwnConstant.maxDataSizeAllowedToBeEncoded=3e4;var __awaiter$1_=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class StorageController{constructor({messageStore:e,dataStore:_t,eventLog:At,eventStream:xt}){this.messageStore=e,this.dataStore=_t,this.eventLog=At,this.eventStream=xt}performRecordsDelete({tenant:e,message:_t}){return __awaiter$1_(this,void 0,void 0,function*(){const At={interface:DwnInterfaceName.Records,recordId:_t.descriptor.recordId},{messages:xt}=yield this.messageStore.query(e,[At]),kt=yield Message.getNewestMessage(xt);if(!Records.canPerformDeleteAgainstRecord(_t,kt))return;const Bt=yield RecordsDelete.parse(_t),Nt=yield RecordsWrite.getInitialWrite(xt),Ut=Bt.constructIndexes(Nt),Lt=yield Message.getCid(_t);yield this.messageStore.put(e,_t,Ut),yield this.eventLog.append(e,Lt,Ut),this.eventStream!==void 0&&this.eventStream.emit(e,{message:_t,initialWrite:Nt},Ut),_t.descriptor.prune&&(yield StorageController.purgeRecordDescendants(e,_t.descriptor.recordId,this.messageStore,this.dataStore,this.eventLog)),yield StorageController.deleteAllOlderMessagesButKeepInitialWrite(e,xt,_t,this.messageStore,this.dataStore,this.eventLog)})}static deleteFromDataStoreIfNeeded(e,_t,At,xt){return __awaiter$1_(this,void 0,void 0,function*(){if(At.descriptor.method!==DwnMethodName.Write)return;const kt=At;kt.descriptor.dataSize<=DwnConstant.maxDataSizeAllowedToBeEncoded||kt.descriptor.dataCid!==xt.descriptor.dataCid&&(yield e.delete(_t,kt.recordId,kt.descriptor.dataCid))})}static purgeRecordDescendants(e,_t,At,xt,kt){return __awaiter$1_(this,void 0,void 0,function*(){const Bt={interface:DwnInterfaceName.Records,parentId:_t},{messages:Nt}=yield At.query(e,[Bt]),Ut=new Map;for(const Lt of Nt){let jt;Records.isRecordsWrite(Lt)?jt=Lt.recordId:jt=Lt.descriptor.recordId,Ut.has(jt)||Ut.set(jt,[]),Ut.get(jt).push(Lt)}for(const Lt of Ut.keys())yield StorageController.purgeRecordDescendants(e,Lt,At,xt,kt);for(const Lt of Ut.keys())yield StorageController.purgeRecordMessages(e,Ut.get(Lt),At,xt,kt)})}static purgeRecordMessages(e,_t,At,xt,kt){return __awaiter$1_(this,void 0,void 0,function*(){const Bt=_t.filter(Lt=>Lt.descriptor.method===DwnMethodName.Write),Nt=yield Message.getNewestMessage(Bt);yield xt.delete(e,Nt.recordId,Nt.descriptor.dataCid);const Ut=yield Promise.all(_t.map(Lt=>Message.getCid(Lt)));yield kt.deleteEventsByCid(e,Ut),yield Promise.all(Ut.map(Lt=>At.delete(e,Lt)))})}static deleteAllOlderMessagesButKeepInitialWrite(e,_t,At,xt,kt,Bt){return __awaiter$1_(this,void 0,void 0,function*(){const Nt=[];for(const Ut of _t){if(yield Message.isOlder(Ut,At)){yield StorageController.deleteFromDataStoreIfNeeded(kt,e,Ut,At);const jt=yield Message.getCid(Ut);if(yield xt.delete(e,jt),yield RecordsWrite.isInitialWrite(Ut)){const Vt=yield(yield RecordsWrite.parse(Ut)).constructIndexes(!1),Ht=Ut;delete Ht.encodedData,yield xt.put(e,Ht,Vt)}else{const qt=yield Message.getCid(Ut);Nt.push(qt)}}yield Bt.deleteEventsByCid(e,Nt)}})}}var __awaiter$1Z=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class RecordsWriteHandler{constructor(e,_t,At,xt,kt){this.didResolver=e,this.messageStore=_t,this.dataStore=At,this.eventLog=xt,this.eventStream=kt}handle({tenant:e,message:_t,dataStream:At}){return __awaiter$1Z(this,void 0,void 0,function*(){let xt;try{xt=yield RecordsWrite.parse(_t),_t.descriptor.protocol!==void 0&&(yield ProtocolAuthorization.validateReferentialIntegrity(e,xt,this.messageStore))}catch(zt){return messageReplyFromError(zt,400)}try{yield authenticate(_t.authorization,this.didResolver),yield RecordsWriteHandler.authorizeRecordsWrite(e,xt,this.messageStore)}catch(zt){return messageReplyFromError(zt,401)}const kt={interface:DwnInterfaceName.Records,recordId:_t.recordId},{messages:Bt}=yield this.messageStore.query(e,[kt]),Nt=yield xt.isInitialWrite();let Ut;if(!Nt)try{Ut=yield RecordsWrite.getInitialWrite(Bt),RecordsWrite.verifyEqualityOfImmutableProperties(Ut,_t)}catch(zt){return messageReplyFromError(zt,400)}const Lt=yield Message.getNewestMessage(Bt);let jt=!1,Kt;if(Lt===void 0||(yield Message.isNewer(_t,Lt))?(jt=!0,Kt=_t):Kt=Lt,!jt)return{status:{code:409,detail:"Conflict"}};try{if((Lt==null?void 0:Lt.descriptor.method)===DwnMethodName.Delete)throw new DwnError(DwnErrorCode.RecordsWriteNotAllowedAfterDelete,"RecordsWrite is not allowed after a RecordsDelete.");yield this.preProcessingForCoreRecordsWrite(e,_t);let zt=!1,Vt=_t;if(At!==void 0)Vt=yield this.processMessageWithDataStream(e,_t,At),zt=!0;else if(!Nt){const Wt=Lt;Vt=yield this.processMessageWithoutDataStream(e,_t,Wt),zt=!0}const Ht=yield xt.constructIndexes(zt);yield this.messageStore.put(e,Vt,Ht),yield this.eventLog.append(e,yield Message.getCid(_t),Ht),this.eventStream!==void 0&&zt&&this.eventStream.emit(e,{message:_t,initialWrite:Ut},Ht)}catch(zt){const Vt=zt;if(Vt.code!==void 0&&(Vt.code===DwnErrorCode.RecordsWriteMissingEncodedDataInPrevious||Vt.code===DwnErrorCode.RecordsWriteMissingDataInPrevious||Vt.code===DwnErrorCode.RecordsWriteNotAllowedAfterDelete||Vt.code===DwnErrorCode.RecordsWriteDataCidMismatch||Vt.code===DwnErrorCode.RecordsWriteDataSizeMismatch||Vt.code.startsWith("PermissionsProtocolValidate")||Vt.code.startsWith("SchemaValidator")))return messageReplyFromError(zt,400);throw zt}const qt={status:Nt&&At===void 0?{code:204,detail:"No Content"}:{code:202,detail:"Accepted"}};return yield StorageController.deleteAllOlderMessagesButKeepInitialWrite(e,Bt,Kt,this.messageStore,this.dataStore,this.eventLog),yield this.postProcessingForCoreRecordsWrite(e,xt),qt})}preProcessingForCoreRecordsWrite(e,_t){var At;return __awaiter$1Z(this,void 0,void 0,function*(){if(_t.descriptor.protocol===PermissionsProtocol.uri&&_t.descriptor.protocolPath===PermissionsProtocol.revocationPath){const xt=_t.descriptor.parentId,kt=yield PermissionsProtocol.fetchGrant(e,this.messageStore,xt),Bt=(At=_t.descriptor.tags)===null||At===void 0?void 0:At.protocol,Nt="protocol"in kt.scope?kt.scope.protocol:void 0;if(Nt!==Bt)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateRevocationProtocolTagMismatch,`Revocation protocol ${Bt} does not match grant protocol ${Nt}`)}})}static validateSchemaForCoreRecordsWrite(e,_t){e.descriptor.protocol===PermissionsProtocol.uri&&PermissionsProtocol.validateSchema(e,_t)}postProcessingForCoreRecordsWrite(e,_t){return __awaiter$1Z(this,void 0,void 0,function*(){if(_t.message.descriptor.protocol===PermissionsProtocol.uri&&_t.message.descriptor.protocolPath===PermissionsProtocol.revocationPath){const xt={permissionGrantId:_t.message.descriptor.parentId,dateCreated:{gte:_t.message.descriptor.messageTimestamp}},{messages:kt}=yield this.messageStore.query(e,[xt]),Bt=[];for(const Nt of kt){const Ut=yield Message.getCid(Nt);yield this.messageStore.delete(e,Ut)}this.eventLog.deleteEventsByCid(e,Bt)}})}cloneAndAddEncodedData(e,_t){return __awaiter$1Z(this,void 0,void 0,function*(){const At=Object.assign({},e);return At.encodedData=Encoder$4.bytesToBase64Url(_t),At})}processMessageWithDataStream(e,_t,At){return __awaiter$1Z(this,void 0,void 0,function*(){let xt=_t;if(_t.descriptor.dataSize<=DwnConstant.maxDataSizeAllowedToBeEncoded){const kt=yield DataStream.toBytes(At),Bt=yield Cid.computeDagPbCidFromBytes(kt);RecordsWriteHandler.validateDataIntegrity(_t.descriptor.dataCid,_t.descriptor.dataSize,Bt,kt.length),RecordsWriteHandler.validateSchemaForCoreRecordsWrite(_t,kt),xt=yield this.cloneAndAddEncodedData(_t,kt)}else{const[kt,Bt]=DataStream.duplicateDataStream(At,2);try{const[Nt,Ut]=yield Promise.all([Cid.computeDagPbCidFromStream(kt),this.dataStore.put(e,_t.recordId,_t.descriptor.dataCid,Bt)]);RecordsWriteHandler.validateDataIntegrity(_t.descriptor.dataCid,_t.descriptor.dataSize,Nt,Ut.dataSize)}catch(Nt){throw yield this.dataStore.delete(e,_t.recordId,_t.descriptor.dataCid),Nt}}return xt})}processMessageWithoutDataStream(e,_t,At){return __awaiter$1Z(this,void 0,void 0,function*(){const xt=Object.assign({},_t),{dataCid:kt,dataSize:Bt}=_t.descriptor;if(RecordsWriteHandler.validateDataIntegrity(kt,Bt,At.descriptor.dataCid,At.descriptor.dataSize),Bt<=DwnConstant.maxDataSizeAllowedToBeEncoded)if(At.encodedData!==void 0)xt.encodedData=At.encodedData;else throw new DwnError(DwnErrorCode.RecordsWriteMissingEncodedDataInPrevious,"No dataStream was provided and unable to get data from previous message");else if((yield this.dataStore.get(e,At.recordId,_t.descriptor.dataCid))===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingDataInPrevious,"No dataStream was provided and unable to get data from previous message");return xt})}static validateDataIntegrity(e,_t,At,xt){if(e!==At)throw new DwnError(DwnErrorCode.RecordsWriteDataCidMismatch,`actual data CID ${At} does not match dataCid in descriptor: ${e}`);if(_t!==xt)throw new DwnError(DwnErrorCode.RecordsWriteDataSizeMismatch,`actual data size ${xt} bytes does not match dataSize in descriptor: ${_t}`)}static authorizeRecordsWrite(e,_t,At){return __awaiter$1Z(this,void 0,void 0,function*(){if(_t.owner!==void 0&&_t.owner!==e)throw new DwnError(DwnErrorCode.RecordsWriteOwnerAndTenantMismatch,`Owner ${_t.owner} must be the same as tenant ${e} when specified.`);if(_t.isSignedByAuthorDelegate&&(yield _t.authorizeAuthorDelegate(At)),_t.isSignedByOwnerDelegate&&(yield _t.authorizeOwnerDelegate(At)),_t.owner===void 0){if(_t.author===e)return;if(_t.author!==void 0&&_t.signaturePayload.permissionGrantId!==void 0){const xt=yield PermissionsProtocol.fetchGrant(e,At,_t.signaturePayload.permissionGrantId);yield RecordsGrantAuthorization.authorizeWrite({recordsWriteMessage:_t.message,expectedGrantor:e,expectedGrantee:_t.author,permissionGrant:xt,messageStore:At})}else if(_t.message.descriptor.protocol!==void 0)yield ProtocolAuthorization.authorizeWrite(e,_t,At);else throw new DwnError(DwnErrorCode.RecordsWriteAuthorizationFailed,"message failed authorization")}})}}var DidVerificationRelationship$2;(function($t){$t.authentication="authentication",$t.assertionMethod="assertionMethod",$t.keyAgreement="keyAgreement",$t.capabilityInvocation="capabilityInvocation",$t.capabilityDelegation="capabilityDelegation"})(DidVerificationRelationship$2||(DidVerificationRelationship$2={}));const EMPTY_DID_RESOLUTION_RESULT$2={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};let Did$2=class qo{constructor({method:e,id:_t,path:At,query:xt,fragment:kt,params:Bt}){this.uri=`did:${e}:${_t}`,this.method=e,this.id=_t,this.path=At,this.query=xt,this.fragment=kt,this.params=Bt}static parse(e){if(!e)return null;const _t=qo.DID_URI_PATTERN.exec(e);if(!_t||!_t.groups)return null;const{method:At,id:xt,path:kt,query:Bt,fragment:Nt}=_t.groups,Ut={uri:`did:${At}:${xt}`,method:At,id:xt};if(kt&&(Ut.path=kt),Bt&&(Ut.query=Bt.slice(1)),Nt&&(Ut.fragment=Nt.slice(1)),Bt){const Lt={},jt=Bt.slice(1).split("&");for(const Kt of jt){const[qt,zt]=Kt.split("=");Lt[qt]=zt}Ut.params=Lt}return Ut}};Did$2.METHOD_PATTERN="([a-z0-9]+)";Did$2.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Did$2.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Did$2.PCT_ENCODED_PATTERN})`;Did$2.METHOD_ID_PATTERN=`((?:${Did$2.ID_CHAR_PATTERN}*:)*(${Did$2.ID_CHAR_PATTERN}+))`;Did$2.PATH_PATTERN="(/[^#?]*)?";Did$2.QUERY_PATTERN="([?][^#]*)?";Did$2.FRAGMENT_PATTERN="(#.*)?";Did$2.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Did$2.METHOD_PATTERN}):(?<id>${Did$2.METHOD_ID_PATTERN})(?<path>${Did$2.PATH_PATTERN})(?<query>${Did$2.QUERY_PATTERN})(?<fragment>${Did$2.FRAGMENT_PATTERN})$`);let DidError$2=class zo extends Error{constructor(e,_t){super(`${e}: ${_t}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zo)}};var DidErrorCode$2;(function($t){$t.InvalidDid="invalidDid",$t.MethodNotSupported="methodNotSupported",$t.InternalError="internalError",$t.InvalidDidDocument="invalidDidDocument",$t.InvalidDidDocumentLength="invalidDidDocumentLength",$t.InvalidDidUrl="invalidDidUrl",$t.InvalidPreviousDidProof="invalidPreviousDidProof",$t.InvalidPublicKey="invalidPublicKey",$t.InvalidPublicKeyLength="invalidPublicKeyLength",$t.InvalidPublicKeyType="invalidPublicKeyType",$t.InvalidSignature="invalidSignature",$t.NotFound="notFound",$t.RepresentationNotSupported="representationNotSupported",$t.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(DidErrorCode$2||(DidErrorCode$2={}));const perf=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,now=()=>perf.now(),isPosInt=$t=>$t&&$t===Math.floor($t)&&$t>0&&isFinite($t),isPosIntOrInf=$t=>$t===1/0||isPosInt($t);class TTLCache{constructor({max:e=1/0,ttl:_t,updateAgeOnGet:At=!1,checkAgeOnGet:xt=!1,noUpdateTTL:kt=!1,dispose:Bt,noDisposeOnSet:Nt=!1}={}){if(this.expirations=Object.create(null),this.data=new Map,this.expirationMap=new Map,_t!==void 0&&!isPosIntOrInf(_t))throw new TypeError("ttl must be positive integer or Infinity if set");if(!isPosIntOrInf(e))throw new TypeError("max must be positive integer or Infinity");if(this.ttl=_t,this.max=e,this.updateAgeOnGet=!!At,this.checkAgeOnGet=!!xt,this.noUpdateTTL=!!kt,this.noDisposeOnSet=!!Nt,Bt!==void 0){if(typeof Bt!="function")throw new TypeError("dispose must be function if set");this.dispose=Bt}this.timer=void 0,this.timerExpiration=void 0}setTimer(e,_t){if(this.timerExpiration<e)return;this.timer&&clearTimeout(this.timer);const At=setTimeout(()=>{this.timer=void 0,this.timerExpiration=void 0,this.purgeStale();for(const xt in this.expirations){this.setTimer(xt,xt-now());break}},_t);At.unref&&At.unref(),this.timerExpiration=e,this.timer=At}cancelTimer(){this.timer&&(clearTimeout(this.timer),this.timerExpiration=void 0,this.timer=void 0)}cancelTimers(){return process$9.emitWarning('TTLCache.cancelTimers has been renamed to TTLCache.cancelTimer (no "s"), and will be removed in the next major version update'),this.cancelTimer()}clear(){const e=this.dispose!==TTLCache.prototype.dispose?[...this]:[];this.data.clear(),this.expirationMap.clear(),this.cancelTimer(),this.expirations=Object.create(null);for(const[_t,At]of e)this.dispose(At,_t,"delete")}setTTL(e,_t=this.ttl){const At=this.expirationMap.get(e);if(At!==void 0){const xt=this.expirations[At];!xt||xt.length<=1?delete this.expirations[At]:this.expirations[At]=xt.filter(kt=>kt!==e)}if(_t!==1/0){const xt=Math.floor(now()+_t);this.expirationMap.set(e,xt),this.expirations[xt]||(this.expirations[xt]=[],this.setTimer(xt,_t)),this.expirations[xt].push(e)}else this.expirationMap.set(e,1/0)}set(e,_t,{ttl:At=this.ttl,noUpdateTTL:xt=this.noUpdateTTL,noDisposeOnSet:kt=this.noDisposeOnSet}={}){if(!isPosIntOrInf(At))throw new TypeError("ttl must be positive integer or Infinity");if(this.expirationMap.has(e)){xt||this.setTTL(e,At);const Bt=this.data.get(e);Bt!==_t&&(this.data.set(e,_t),kt||this.dispose(Bt,e,"set"))}else this.setTTL(e,At),this.data.set(e,_t);for(;this.size>this.max;)this.purgeToCapacity();return this}has(e){return this.data.has(e)}getRemainingTTL(e){const _t=this.expirationMap.get(e);return _t===1/0?_t:_t!==void 0?Math.max(0,Math.ceil(_t-now())):0}get(e,{updateAgeOnGet:_t=this.updateAgeOnGet,ttl:At=this.ttl,checkAgeOnGet:xt=this.checkAgeOnGet}={}){const kt=this.data.get(e);if(xt&&this.getRemainingTTL(e)===0){this.delete(e);return}return _t&&this.setTTL(e,At),kt}dispose(e,_t){}delete(e){const _t=this.expirationMap.get(e);if(_t!==void 0){const At=this.data.get(e);this.data.delete(e),this.expirationMap.delete(e);const xt=this.expirations[_t];return xt&&(xt.length<=1?delete this.expirations[_t]:this.expirations[_t]=xt.filter(kt=>kt!==e)),this.dispose(At,e,"delete"),this.size===0&&this.cancelTimer(),!0}return!1}purgeToCapacity(){for(const e in this.expirations){const _t=this.expirations[e];if(this.size-_t.length>=this.max){delete this.expirations[e];const At=[];for(const xt of _t)At.push([xt,this.data.get(xt)]),this.data.delete(xt),this.expirationMap.delete(xt);for(const[xt,kt]of At)this.dispose(kt,xt,"evict")}else{const At=this.size-this.max,xt=[];for(const kt of _t.splice(0,At))xt.push([kt,this.data.get(kt)]),this.data.delete(kt),this.expirationMap.delete(kt);for(const[kt,Bt]of xt)this.dispose(Bt,kt,"evict");return}}}get size(){return this.data.size}purgeStale(){const e=Math.ceil(now());for(const _t in this.expirations){if(_t==="Infinity"||_t>e)return;const At=[...this.expirations[_t]||[]],xt=[];delete this.expirations[_t];for(const kt of At)xt.push([kt,this.data.get(kt)]),this.data.delete(kt),this.expirationMap.delete(kt);for(const[kt,Bt]of xt)this.dispose(Bt,kt,"stale")}this.size===0&&this.cancelTimer()}*entries(){for(const e in this.expirations)for(const _t of this.expirations[e])yield[_t,this.data.get(_t)]}*keys(){for(const e in this.expirations)for(const _t of this.expirations[e])yield _t}*values(){for(const e in this.expirations)for(const _t of this.expirations[e])yield this.data.get(_t)}[Symbol.iterator](){return this.entries()}}var ttlcache=TTLCache;const TtlCache=getDefaultExportFromCjs(ttlcache);function coerce($t){if($t instanceof Uint8Array&&$t.constructor.name==="Uint8Array")return $t;if($t instanceof ArrayBuffer)return new Uint8Array($t);if(ArrayBuffer.isView($t))return new Uint8Array($t.buffer,$t.byteOffset,$t.byteLength);throw new Error("Unknown type, must be binary type")}function base($t,e){if($t.length>=255)throw new TypeError("Alphabet too long");for(var _t=new Uint8Array(256),At=0;At<_t.length;At++)_t[At]=255;for(var xt=0;xt<$t.length;xt++){var kt=$t.charAt(xt),Bt=kt.charCodeAt(0);if(_t[Bt]!==255)throw new TypeError(kt+" is ambiguous");_t[Bt]=xt}var Nt=$t.length,Ut=$t.charAt(0),Lt=Math.log(Nt)/Math.log(256),jt=Math.log(256)/Math.log(Nt);function Kt(Vt){if(Vt instanceof Uint8Array||(ArrayBuffer.isView(Vt)?Vt=new Uint8Array(Vt.buffer,Vt.byteOffset,Vt.byteLength):Array.isArray(Vt)&&(Vt=Uint8Array.from(Vt))),!(Vt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Vt.length===0)return"";for(var Ht=0,Wt=0,Qt=0,Xt=Vt.length;Qt!==Xt&&Vt[Qt]===0;)Qt++,Ht++;for(var Jt=(Xt-Qt)*jt+1>>>0,tr=new Uint8Array(Jt);Qt!==Xt;){for(var dr=Vt[Qt],vr=0,$r=Jt-1;(dr!==0||vr<Wt)&&$r!==-1;$r--,vr++)dr+=256*tr[$r]>>>0,tr[$r]=dr%Nt>>>0,dr=dr/Nt>>>0;if(dr!==0)throw new Error("Non-zero carry");Wt=vr,Qt++}for(var Ir=Jt-Wt;Ir!==Jt&&tr[Ir]===0;)Ir++;for(var Rr=Ut.repeat(Ht);Ir<Jt;++Ir)Rr+=$t.charAt(tr[Ir]);return Rr}function qt(Vt){if(typeof Vt!="string")throw new TypeError("Expected String");if(Vt.length===0)return new Uint8Array;var Ht=0;if(Vt[Ht]!==" "){for(var Wt=0,Qt=0;Vt[Ht]===Ut;)Wt++,Ht++;for(var Xt=(Vt.length-Ht)*Lt+1>>>0,Jt=new Uint8Array(Xt);Vt[Ht];){var tr=_t[Vt.charCodeAt(Ht)];if(tr===255)return;for(var dr=0,vr=Xt-1;(tr!==0||dr<Qt)&&vr!==-1;vr--,dr++)tr+=Nt*Jt[vr]>>>0,Jt[vr]=tr%256>>>0,tr=tr/256>>>0;if(tr!==0)throw new Error("Non-zero carry");Qt=dr,Ht++}if(Vt[Ht]!==" "){for(var $r=Xt-Qt;$r!==Xt&&Jt[$r]===0;)$r++;for(var Ir=new Uint8Array(Wt+(Xt-$r)),Rr=Wt;$r!==Xt;)Ir[Rr++]=Jt[$r++];return Ir}}}function zt(Vt){var Ht=qt(Vt);if(Ht)return Ht;throw new Error(`Non-${e} character`)}return{encode:Kt,decodeUnsafe:qt,decode:zt}}var src=base,_brrp__multiformats_scope_baseX=src;let Encoder$1=class{constructor(e,_t,At){sn(this,"name");sn(this,"prefix");sn(this,"baseEncode");this.name=e,this.prefix=_t,this.baseEncode=At}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}};class Decoder{constructor(e,_t,At){sn(this,"name");sn(this,"prefix");sn(this,"baseDecode");sn(this,"prefixCodePoint");if(this.name=e,this.prefix=_t,_t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=_t.codePointAt(0),this.baseDecode=At}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or(this,e)}}class ComposedDecoder{constructor(e){sn(this,"decoders");this.decoders=e}or(e){return or(this,e)}decode(e){const _t=e[0],At=this.decoders[_t];if(At!=null)return At.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or($t,e){return new ComposedDecoder({...$t.decoders??{[$t.prefix]:$t},...e.decoders??{[e.prefix]:e}})}class Codec{constructor(e,_t,At,xt){sn(this,"name");sn(this,"prefix");sn(this,"baseEncode");sn(this,"baseDecode");sn(this,"encoder");sn(this,"decoder");this.name=e,this.prefix=_t,this.baseEncode=At,this.baseDecode=xt,this.encoder=new Encoder$1(e,_t,At),this.decoder=new Decoder(e,_t,xt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function from$3({name:$t,prefix:e,encode:_t,decode:At}){return new Codec($t,e,_t,At)}function baseX({name:$t,prefix:e,alphabet:_t}){const{encode:At,decode:xt}=_brrp__multiformats_scope_baseX(_t,$t);return from$3({prefix:e,name:$t,encode:At,decode:kt=>coerce(xt(kt))})}function decode$7($t,e,_t,At){const xt={};for(let jt=0;jt<e.length;++jt)xt[e[jt]]=jt;let kt=$t.length;for(;$t[kt-1]==="=";)--kt;const Bt=new Uint8Array(kt*_t/8|0);let Nt=0,Ut=0,Lt=0;for(let jt=0;jt<kt;++jt){const Kt=xt[$t[jt]];if(Kt===void 0)throw new SyntaxError(`Non-${At} character`);Ut=Ut<<_t|Kt,Nt+=_t,Nt>=8&&(Nt-=8,Bt[Lt++]=255&Ut>>Nt)}if(Nt>=_t||255&Ut<<8-Nt)throw new SyntaxError("Unexpected end of data");return Bt}function encode$7($t,e,_t){const At=e[e.length-1]==="=",xt=(1<<_t)-1;let kt="",Bt=0,Nt=0;for(let Ut=0;Ut<$t.length;++Ut)for(Nt=Nt<<8|$t[Ut],Bt+=8;Bt>_t;)Bt-=_t,kt+=e[xt&Nt>>Bt];if(Bt!==0&&(kt+=e[xt&Nt<<_t-Bt]),At)for(;kt.length*_t&7;)kt+="=";return kt}function rfc4648({name:$t,prefix:e,bitsPerChar:_t,alphabet:At}){return from$3({prefix:e,name:$t,encode(xt){return encode$7(xt,At,_t)},decode(xt){return decode$7(xt,At,_t,$t)}})}rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function isArrayBufferSlice$1($t){return $t.byteOffset!==0||$t.byteLength!==$t.buffer.byteLength}function isAsyncIterable$6($t){return typeof $t!="object"||$t===null?!1:typeof $t[Symbol.asyncIterator]=="function"}function universalTypeOf$1($t){const _t=Object.prototype.toString.call($t).match(/\s([a-zA-Z0-9]+)/),[At,xt]=_t;return xt}var __awaiter$1Y=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$7=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}};const textEncoder$3=new TextEncoder,textDecoder$2=new TextDecoder;let Convert$1=class pi{constructor(e,_t){this.data=e,this.format=_t}static arrayBuffer(e){return new pi(e,"ArrayBuffer")}static asyncIterable(e){if(!isAsyncIterable$6(e))throw new TypeError("Input must be of type AsyncIterable.");return new pi(e,"AsyncIterable")}static base32Z(e){return new pi(e,"Base32Z")}static base58Btc(e){return new pi(e,"Base58Btc")}static base64Url(e){return new pi(e,"Base64Url")}static bufferSource(e){return new pi(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new pi(e,"Hex")}static multibase(e){return new pi(e,"Multibase")}static object(e){return new pi(e,"Object")}static string(e){return new pi(e,"String")}static uint8Array(e){return new pi(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return base58btc.baseDecode(this.data).buffer;case"Base64Url":return base64url.baseDecode(this.data).buffer;case"BufferSource":{if(universalTypeOf$1(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return isArrayBufferSlice$1(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return __awaiter$1Y(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return base32z.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base58btc.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return base58btc.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base64url.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return base64url.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),_t=textEncoder$3.encode(e);return base64url.baseEncode(_t)}case"String":{const e=textEncoder$3.encode(this.data);return base64url.baseEncode(e)}case"Uint8Array":return base64url.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){return __awaiter$1Y(this,void 0,void 0,function*(){var e,_t,At,xt;switch(this.format){case"AsyncIterable":{const Ut=[];try{for(var kt=!0,Bt=__asyncValues$7(this.data),Nt;Nt=yield Bt.next(),e=Nt.done,!e;kt=!0){xt=Nt.value,kt=!1;const jt=xt;Ut.push(jt)}}catch(jt){_t={error:jt}}finally{try{!kt&&!e&&(At=Bt.return)&&(yield At.call(Bt))}finally{if(_t)throw _t.error}}return new Blob(Ut)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(_t,At)=>At.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const _t=this.toUint8Array();return pi.uint8Array(_t).toHex()}case"Base64Url":{const _t=this.toUint8Array();return pi.uint8Array(_t).toHex()}case"Uint8Array":{let _t="";for(let At=0;At<this.data.length;At++)_t+=e[this.data[At]];return _t}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=base64url.baseDecode(this.data),_t=textDecoder$2.decode(e);return JSON.parse(_t)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=textDecoder$2.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return __awaiter$1Y(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return textDecoder$2.decode(this.data);case"Base64Url":{const e=base64url.baseDecode(this.data);return textDecoder$2.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return textDecoder$2.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){return __awaiter$1Y(this,void 0,void 0,function*(){var e,_t,At,xt;switch(this.format){case"AsyncIterable":{let Ut="";try{for(var kt=!0,Bt=__asyncValues$7(this.data),Nt;Nt=yield Bt.next(),e=Nt.done,!e;kt=!0){xt=Nt.value,kt=!1;const Lt=xt;typeof Lt=="string"?Ut+=Lt:Ut+=textDecoder$2.decode(Lt,{stream:!0})}}catch(Lt){_t={error:Lt}}finally{try{!kt&&!e&&(At=Bt.return)&&(yield At.call(Bt))}finally{if(_t)throw _t.error}}return Ut+=textDecoder$2.decode(void 0,{stream:!1}),Ut}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return base32z.baseDecode(this.data);case"Base58Btc":return base58btc.baseDecode(this.data);case"Base64Url":return base64url.baseDecode(this.data);case"BufferSource":{const e=universalTypeOf$1(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let _t=0;_t<this.data.length;_t+=2){const At=parseInt(this.data.substring(_t,_t+2),16);if(isNaN(At))throw new TypeError("Input is not a valid hexadecimal string.");e[_t/2]=At}return e}case"Object":{const e=JSON.stringify(this.data);return textEncoder$3.encode(e)}case"String":return textEncoder$3.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return __awaiter$1Y(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}};var encode_1=encode$6,MSB=128,REST=127,MSBALL=~REST,INT=Math.pow(2,31);function encode$6($t,e,_t){e=e||[],_t=_t||0;for(var At=_t;$t>=INT;)e[_t++]=$t&255|MSB,$t/=128;for(;$t&MSBALL;)e[_t++]=$t&255|MSB,$t>>>=7;return e[_t]=$t|0,encode$6.bytes=_t-At+1,e}var decode$6=read,MSB$1=128,REST$1=127;function read($t,At){var _t=0,At=At||0,xt=0,kt=At,Bt,Nt=$t.length;do{if(kt>=Nt)throw read.bytes=0,new RangeError("Could not decode varint");Bt=$t[kt++],_t+=xt<28?(Bt&REST$1)<<xt:(Bt&REST$1)*Math.pow(2,xt),xt+=7}while(Bt>=MSB$1);return read.bytes=kt-At,_t}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length=function($t){return $t<N1?1:$t<N2?2:$t<N3?3:$t<N4?4:$t<N5?5:$t<N6?6:$t<N7?7:$t<N8?8:$t<N9?9:10},varint={encode:encode_1,decode:decode$6,encodingLength:length},_brrp_varint=varint;function decode$5($t,e=0){return[_brrp_varint.decode($t,e),_brrp_varint.decode.bytes]}function encodeTo($t,e,_t=0){return _brrp_varint.encode($t,e,_t),e}function encodingLength$4($t){return _brrp_varint.encodingLength($t)}let Multicodec$1=class Li{static addPrefix(e){var _t;let{code:At,data:xt,name:kt}=e;if(!(kt?!At:At))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(At=Li.codeToName.has(At)?At:Li.nameToCode.get(kt),At===void 0)throw new Error(`Unsupported multicodec: ${(_t=e.name)!==null&&_t!==void 0?_t:e.code}`);const Bt=encodingLength$4(At),Nt=new Uint8Array(Bt+xt.byteLength);return Nt.set(xt,Bt),encodeTo(At,Nt),Nt}static getCodeFromData(e){const{prefixedData:_t}=e,[At,xt]=decode$5(_t);return At}static getCodeFromName(e){const{name:_t}=e,At=Li.nameToCode.get(_t);if(At===void 0)throw new Error(`Unsupported multicodec: ${_t}`);return At}static getNameFromCode(e){const{code:_t}=e,At=Li.codeToName.get(_t);if(At===void 0)throw new Error(`Unsupported multicodec: ${_t}`);return At}static registerCodec(e){Li.codeToName.set(e.code,e.name),Li.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:_t}=e,[At,xt]=decode$5(_t),kt=Li.codeToName.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return{code:At,data:_t.slice(xt),name:kt}}};Multicodec$1.codeToName=new Map;Multicodec$1.nameToCode=new Map;Multicodec$1.registerCodec({code:237,name:"ed25519-pub"});Multicodec$1.registerCodec({code:4864,name:"ed25519-priv"});Multicodec$1.registerCodec({code:236,name:"x25519-pub"});Multicodec$1.registerCodec({code:4866,name:"x25519-priv"});Multicodec$1.registerCodec({code:231,name:"secp256k1-pub"});Multicodec$1.registerCodec({code:4865,name:"secp256k1-priv"});function removeUndefinedProperties$1($t){Object.keys($t).forEach(e=>{$t[e]===void 0?delete $t[e]:typeof $t[e]=="object"&&removeUndefinedProperties$1($t[e])})}var browserLevel={},abstractLevel$1={},abstractLevel={},levelSupports={};levelSupports.supports=function $t(...e){const _t=e.reduce((At,xt)=>Object.assign(At,xt),{});return Object.assign(_t,{snapshots:_t.snapshots||!1,permanence:_t.permanence||!1,seek:_t.seek||!1,clear:_t.clear||!1,getMany:_t.getMany||!1,keyIterator:_t.keyIterator||!1,valueIterator:_t.valueIterator||!1,iteratorNextv:_t.iteratorNextv||!1,iteratorAll:_t.iteratorAll||!1,status:_t.status||!1,createIfMissing:_t.createIfMissing||!1,errorIfExists:_t.errorIfExists||!1,deferredOpen:_t.deferredOpen||!1,promises:_t.promises||!1,streams:_t.streams||!1,encodings:Object.assign({},_t.encodings),events:Object.assign({},_t.events),additionalMethods:Object.assign({},_t.additionalMethods)})};var levelTranscoder={},moduleError=class extends Error{constructor(e,_t){super(e||""),typeof _t=="object"&&_t!==null&&(_t.code&&(this.code=String(_t.code)),_t.expected&&(this.expected=!0),_t.transient&&(this.transient=!0),_t.cause&&(this.cause=_t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},encodings$1={};let lazy=null;var textEndec$1=function(){return lazy===null&&(lazy={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),lazy},formats$2={},encoding={};const ModuleError$8=moduleError,formats$1=new Set(["buffer","view","utf8"]);let Encoding$2=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!formats$1.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};encoding.Encoding=Encoding$2;const{Buffer:Buffer$3}=buffer$2||{},{Encoding:Encoding$1}=encoding,textEndec=textEndec$1;let BufferFormat$2=class extends Encoding$1{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new ViewFormat$2({encode:this.encode,decode:e=>this.decode(Buffer$3.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},ViewFormat$2=class extends Encoding$1{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new BufferFormat$2({encode:e=>{const _t=this.encode(e);return Buffer$3.from(_t.buffer,_t.byteOffset,_t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},UTF8Format$2=class extends Encoding$1{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new BufferFormat$2({encode:e=>Buffer$3.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:_t}=textEndec();return new ViewFormat$2({encode:At=>e.encode(this.encode(At)),decode:At=>this.decode(_t.decode(At)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};formats$2.BufferFormat=BufferFormat$2;formats$2.ViewFormat=ViewFormat$2;formats$2.UTF8Format=UTF8Format$2;const{Buffer:Buffer$2}=buffer$2||{Buffer:{isBuffer:()=>!1}},{textEncoder:textEncoder$2,textDecoder:textDecoder$1}=textEndec$1(),{BufferFormat:BufferFormat$1,ViewFormat:ViewFormat$1,UTF8Format:UTF8Format$1}=formats$2,identity$1=$t=>$t;encodings$1.utf8=new UTF8Format$1({encode:function($t){return Buffer$2.isBuffer($t)?$t.toString("utf8"):ArrayBuffer.isView($t)?textDecoder$1.decode($t):String($t)},decode:identity$1,name:"utf8",createViewTranscoder(){return new ViewFormat$1({encode:function($t){return ArrayBuffer.isView($t)?$t:textEncoder$2.encode($t)},decode:function($t){return textDecoder$1.decode($t)},name:`${this.name}+view`})},createBufferTranscoder(){return new BufferFormat$1({encode:function($t){return Buffer$2.isBuffer($t)?$t:ArrayBuffer.isView($t)?Buffer$2.from($t.buffer,$t.byteOffset,$t.byteLength):Buffer$2.from(String($t),"utf8")},decode:function($t){return $t.toString("utf8")},name:`${this.name}+buffer`})}});encodings$1.json=new UTF8Format$1({encode:JSON.stringify,decode:JSON.parse,name:"json"});encodings$1.buffer=new BufferFormat$1({encode:function($t){return Buffer$2.isBuffer($t)?$t:ArrayBuffer.isView($t)?Buffer$2.from($t.buffer,$t.byteOffset,$t.byteLength):Buffer$2.from(String($t),"utf8")},decode:identity$1,name:"buffer",createViewTranscoder(){return new ViewFormat$1({encode:function($t){return ArrayBuffer.isView($t)?$t:Buffer$2.from(String($t),"utf8")},decode:function($t){return Buffer$2.from($t.buffer,$t.byteOffset,$t.byteLength)},name:`${this.name}+view`})}});encodings$1.view=new ViewFormat$1({encode:function($t){return ArrayBuffer.isView($t)?$t:textEncoder$2.encode($t)},decode:identity$1,name:"view",createBufferTranscoder(){return new BufferFormat$1({encode:function($t){return Buffer$2.isBuffer($t)?$t:ArrayBuffer.isView($t)?Buffer$2.from($t.buffer,$t.byteOffset,$t.byteLength):Buffer$2.from(String($t),"utf8")},decode:identity$1,name:`${this.name}+buffer`})}});encodings$1.hex=new BufferFormat$1({encode:function($t){return Buffer$2.isBuffer($t)?$t:Buffer$2.from(String($t),"hex")},decode:function($t){return $t.toString("hex")},name:"hex"});encodings$1.base64=new BufferFormat$1({encode:function($t){return Buffer$2.isBuffer($t)?$t:Buffer$2.from(String($t),"base64")},decode:function($t){return $t.toString("base64")},name:"base64"});const ModuleError$7=moduleError,encodings=encodings$1,{Encoding}=encoding,{BufferFormat,ViewFormat,UTF8Format}=formats$2,kFormats=Symbol("formats"),kEncodings=Symbol("encodings"),validFormats=new Set(["buffer","view","utf8"]);let Transcoder$1=class{constructor(e){if(Array.isArray(e)){if(!e.every(_t=>validFormats.has(_t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[kEncodings]=new Map,this[kFormats]=new Set(e);for(const _t in encodings)try{this.encoding(_t)}catch(At){if(At.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw At}}encodings(){return Array.from(new Set(this[kEncodings].values()))}encoding(e){let _t=this[kEncodings].get(e);if(_t===void 0){if(typeof e=="string"&&e!==""){if(_t=lookup$1[e],!_t)throw new ModuleError$7(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");_t=from$2(e)}const{name:At,format:xt}=_t;if(!this[kFormats].has(xt))if(this[kFormats].has("view"))_t=_t.createViewTranscoder();else if(this[kFormats].has("buffer"))_t=_t.createBufferTranscoder();else if(this[kFormats].has("utf8"))_t=_t.createUTF8Transcoder();else throw new ModuleError$7(`Encoding '${At}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const kt of[e,At,_t.name,_t.commonName])this[kEncodings].set(kt,_t)}return _t}};levelTranscoder.Transcoder=Transcoder$1;function from$2($t){if($t instanceof Encoding)return $t;const e="type"in $t&&typeof $t.type=="string"?$t.type:void 0,_t=$t.name||e||`anonymous-${anonymousCount++}`;switch(detectFormat($t)){case"view":return new ViewFormat({...$t,name:_t});case"utf8":return new UTF8Format({...$t,name:_t});case"buffer":return new BufferFormat({...$t,name:_t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function detectFormat($t){return"format"in $t&&$t.format!==void 0?$t.format:"buffer"in $t&&typeof $t.buffer=="boolean"?$t.buffer?"buffer":"utf8":"code"in $t&&Number.isInteger($t.code)?"view":"buffer"}const aliases={binary:encodings.buffer,"utf-8":encodings.utf8},lookup$1={...encodings,...aliases};let anonymousCount=0;var catering={},nextTickBrowser$1=typeof queueMicrotask=="function"?queueMicrotask:$t=>Promise.resolve().then($t),nextTick$1=nextTickBrowser$1;catering.fromCallback=function($t,e){if($t===void 0){var _t=new Promise(function(At,xt){$t=function(kt,Bt){kt?xt(kt):At(Bt)}});$t[e!==void 0?e:"promise"]=_t}else if(typeof $t!="function")throw new TypeError("Callback must be a function");return $t};catering.fromPromise=function($t,e){if(e===void 0)return $t;$t.then(function(_t){nextTick$1(()=>e(null,_t))}).catch(function(_t){nextTick$1(()=>e(_t))})};var abstractIterator={},common={};common.getCallback=function($t,e){return typeof $t=="function"?$t:e};common.getOptions=function($t,e){return typeof $t=="object"&&$t!==null?$t:e!==void 0?e:{}};const{fromCallback:fromCallback$3}=catering,ModuleError$6=moduleError,{getOptions:getOptions$2,getCallback:getCallback$2}=common,kPromise$3=Symbol("promise"),kCallback$2=Symbol("callback"),kWorking=Symbol("working"),kHandleOne$1=Symbol("handleOne"),kHandleMany$1=Symbol("handleMany"),kAutoClose=Symbol("autoClose"),kFinishWork=Symbol("finishWork"),kReturnMany=Symbol("returnMany"),kClosing=Symbol("closing"),kHandleClose=Symbol("handleClose"),kClosed=Symbol("closed"),kCloseCallbacks$1=Symbol("closeCallbacks"),kKeyEncoding$1=Symbol("keyEncoding"),kValueEncoding$1=Symbol("valueEncoding"),kAbortOnClose=Symbol("abortOnClose"),kLegacy=Symbol("legacy"),kKeys=Symbol("keys"),kValues=Symbol("values"),kLimit=Symbol("limit"),kCount=Symbol("count"),emptyOptions$1=Object.freeze({}),noop$1=()=>{};let warnedEnd=!1;class CommonIterator{constructor(e,_t,At){if(typeof e!="object"||e===null){const xt=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${xt}`)}if(typeof _t!="object"||_t===null)throw new TypeError("The second argument must be an options object");this[kClosed]=!1,this[kCloseCallbacks$1]=[],this[kWorking]=!1,this[kClosing]=!1,this[kAutoClose]=!1,this[kCallback$2]=null,this[kHandleOne$1]=this[kHandleOne$1].bind(this),this[kHandleMany$1]=this[kHandleMany$1].bind(this),this[kHandleClose]=this[kHandleClose].bind(this),this[kKeyEncoding$1]=_t[kKeyEncoding$1],this[kValueEncoding$1]=_t[kValueEncoding$1],this[kLegacy]=At,this[kLimit]=Number.isInteger(_t.limit)&&_t.limit>=0?_t.limit:1/0,this[kCount]=0,this[kAbortOnClose]=!!_t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[kCount]}get limit(){return this[kLimit]}next(e){let _t;if(e===void 0)_t=new Promise((At,xt)=>{e=(kt,Bt,Nt)=>{kt?xt(kt):this[kLegacy]?Bt===void 0&&Nt===void 0?At():At([Bt,Nt]):At(Bt)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[kClosing]?this.nextTick(e,new ModuleError$6("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(e,new ModuleError$6("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[kWorking]=!0,this[kCallback$2]=e,this[kCount]>=this[kLimit]?this.nextTick(this[kHandleOne$1],null):this._next(this[kHandleOne$1])),_t}_next(e){this.nextTick(e)}nextv(e,_t,At){return At=getCallback$2(_t,At),At=fromCallback$3(At,kPromise$3),_t=getOptions$2(_t,emptyOptions$1),Number.isInteger(e)?(this[kClosing]?this.nextTick(At,new ModuleError$6("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(At,new ModuleError$6("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[kLimit]<1/0&&(e=Math.min(e,this[kLimit]-this[kCount])),this[kWorking]=!0,this[kCallback$2]=At,e<=0?this.nextTick(this[kHandleMany$1],null,[]):this._nextv(e,_t,this[kHandleMany$1])),At[kPromise$3]):(this.nextTick(At,new TypeError("The first argument 'size' must be an integer")),At[kPromise$3])}_nextv(e,_t,At){const xt=[],kt=(Bt,Nt,Ut)=>{if(Bt)return At(Bt);if(this[kLegacy]?Nt===void 0&&Ut===void 0:Nt===void 0)return At(null,xt);xt.push(this[kLegacy]?[Nt,Ut]:Nt),xt.length===e?At(null,xt):this._next(kt)};this._next(kt)}all(e,_t){return _t=getCallback$2(e,_t),_t=fromCallback$3(_t,kPromise$3),e=getOptions$2(e,emptyOptions$1),this[kClosing]?this.nextTick(_t,new ModuleError$6("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(_t,new ModuleError$6("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[kWorking]=!0,this[kCallback$2]=_t,this[kAutoClose]=!0,this[kCount]>=this[kLimit]?this.nextTick(this[kHandleMany$1],null,[]):this._all(e,this[kHandleMany$1])),_t[kPromise$3]}_all(e,_t){let At=this[kCount];const xt=[],kt=()=>{const Nt=this[kLimit]<1/0?Math.min(1e3,this[kLimit]-At):1e3;Nt<=0?this.nextTick(_t,null,xt):this._nextv(Nt,emptyOptions$1,Bt)},Bt=(Nt,Ut)=>{Nt?_t(Nt):Ut.length===0?_t(null,xt):(xt.push.apply(xt,Ut),At+=Ut.length,kt())};kt()}[kFinishWork](){const e=this[kCallback$2];return this[kAbortOnClose]&&e===null?noop$1:(this[kWorking]=!1,this[kCallback$2]=null,this[kClosing]&&this._close(this[kHandleClose]),e)}[kReturnMany](e,_t,At){this[kAutoClose]?this.close(e.bind(null,_t,At)):e(_t,At)}seek(e,_t){if(_t=getOptions$2(_t,emptyOptions$1),!this[kClosing]){if(this[kWorking])throw new ModuleError$6("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const At=this.db.keyEncoding(_t.keyEncoding||this[kKeyEncoding$1]),xt=At.format;_t.keyEncoding!==xt&&(_t={..._t,keyEncoding:xt});const kt=this.db.prefixKey(At.encode(e),xt);this._seek(kt,_t)}}}_seek(e,_t){throw new ModuleError$6("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=fromCallback$3(e,kPromise$3),this[kClosed]?this.nextTick(e):this[kClosing]?this[kCloseCallbacks$1].push(e):(this[kClosing]=!0,this[kCloseCallbacks$1].push(e),this[kWorking]?this[kAbortOnClose]&&this[kFinishWork]()(new ModuleError$6("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[kHandleClose])),e[kPromise$3]}_close(e){this.nextTick(e)}[kHandleClose](){this[kClosed]=!0,this.db.detachResource(this);const e=this[kCloseCallbacks$1];this[kCloseCallbacks$1]=[];for(const _t of e)_t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[kClosed]||await this.close()}}}let AbstractIterator$3=class extends CommonIterator{constructor(e,_t){super(e,_t,!0),this[kKeys]=_t.keys!==!1,this[kValues]=_t.values!==!1}[kHandleOne$1](e,_t,At){const xt=this[kFinishWork]();if(e)return xt(e);try{_t=this[kKeys]&&_t!==void 0?this[kKeyEncoding$1].decode(_t):void 0,At=this[kValues]&&At!==void 0?this[kValueEncoding$1].decode(At):void 0}catch(kt){return xt(new IteratorDecodeError("entry",kt))}_t===void 0&&At===void 0||this[kCount]++,xt(null,_t,At)}[kHandleMany$1](e,_t){const At=this[kFinishWork]();if(e)return this[kReturnMany](At,e);try{for(const xt of _t){const kt=xt[0],Bt=xt[1];xt[0]=this[kKeys]&&kt!==void 0?this[kKeyEncoding$1].decode(kt):void 0,xt[1]=this[kValues]&&Bt!==void 0?this[kValueEncoding$1].decode(Bt):void 0}}catch(xt){return this[kReturnMany](At,new IteratorDecodeError("entries",xt))}this[kCount]+=_t.length,this[kReturnMany](At,null,_t)}end(e){return!warnedEnd&&typeof console<"u"&&(warnedEnd=!0,console.warn(new ModuleError$6("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},AbstractKeyIterator$2=class extends CommonIterator{constructor(e,_t){super(e,_t,!1)}[kHandleOne$1](e,_t){const At=this[kFinishWork]();if(e)return At(e);try{_t=_t!==void 0?this[kKeyEncoding$1].decode(_t):void 0}catch(xt){return At(new IteratorDecodeError("key",xt))}_t!==void 0&&this[kCount]++,At(null,_t)}[kHandleMany$1](e,_t){const At=this[kFinishWork]();if(e)return this[kReturnMany](At,e);try{for(let xt=0;xt<_t.length;xt++){const kt=_t[xt];_t[xt]=kt!==void 0?this[kKeyEncoding$1].decode(kt):void 0}}catch(xt){return this[kReturnMany](At,new IteratorDecodeError("keys",xt))}this[kCount]+=_t.length,this[kReturnMany](At,null,_t)}},AbstractValueIterator$2=class extends CommonIterator{constructor(e,_t){super(e,_t,!1)}[kHandleOne$1](e,_t){const At=this[kFinishWork]();if(e)return At(e);try{_t=_t!==void 0?this[kValueEncoding$1].decode(_t):void 0}catch(xt){return At(new IteratorDecodeError("value",xt))}_t!==void 0&&this[kCount]++,At(null,_t)}[kHandleMany$1](e,_t){const At=this[kFinishWork]();if(e)return this[kReturnMany](At,e);try{for(let xt=0;xt<_t.length;xt++){const kt=_t[xt];_t[xt]=kt!==void 0?this[kValueEncoding$1].decode(kt):void 0}}catch(xt){return this[kReturnMany](At,new IteratorDecodeError("values",xt))}this[kCount]+=_t.length,this[kReturnMany](At,null,_t)}};class IteratorDecodeError extends ModuleError$6{constructor(e,_t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:_t})}}for(const $t of["_ended property","_nexting property","_end method"])Object.defineProperty(AbstractIterator$3.prototype,$t.split(" ")[0],{get(){throw new ModuleError$6(`The ${$t} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new ModuleError$6(`The ${$t} has been removed`,{code:"LEVEL_LEGACY"})}});AbstractIterator$3.keyEncoding=kKeyEncoding$1;AbstractIterator$3.valueEncoding=kValueEncoding$1;abstractIterator.AbstractIterator=AbstractIterator$3;abstractIterator.AbstractKeyIterator=AbstractKeyIterator$2;abstractIterator.AbstractValueIterator=AbstractValueIterator$2;var defaultKvIterator={};const{AbstractKeyIterator:AbstractKeyIterator$1,AbstractValueIterator:AbstractValueIterator$1}=abstractIterator,kIterator=Symbol("iterator"),kCallback$1=Symbol("callback"),kHandleOne=Symbol("handleOne"),kHandleMany=Symbol("handleMany");let DefaultKeyIterator$1=class extends AbstractKeyIterator$1{constructor(e,_t){super(e,_t),this[kIterator]=e.iterator({..._t,keys:!0,values:!1}),this[kHandleOne]=this[kHandleOne].bind(this),this[kHandleMany]=this[kHandleMany].bind(this)}},DefaultValueIterator$1=class extends AbstractValueIterator$1{constructor(e,_t){super(e,_t),this[kIterator]=e.iterator({..._t,keys:!1,values:!0}),this[kHandleOne]=this[kHandleOne].bind(this),this[kHandleMany]=this[kHandleMany].bind(this)}};for(const $t of[DefaultKeyIterator$1,DefaultValueIterator$1]){const e=$t===DefaultKeyIterator$1,_t=e?At=>At[0]:At=>At[1];$t.prototype._next=function(At){this[kCallback$1]=At,this[kIterator].next(this[kHandleOne])},$t.prototype[kHandleOne]=function(At,xt,kt){const Bt=this[kCallback$1];At?Bt(At):Bt(null,e?xt:kt)},$t.prototype._nextv=function(At,xt,kt){this[kCallback$1]=kt,this[kIterator].nextv(At,xt,this[kHandleMany])},$t.prototype._all=function(At,xt){this[kCallback$1]=xt,this[kIterator].all(At,this[kHandleMany])},$t.prototype[kHandleMany]=function(At,xt){const kt=this[kCallback$1];At?kt(At):kt(null,xt.map(_t))},$t.prototype._seek=function(At,xt){this[kIterator].seek(At,xt)},$t.prototype._close=function(At){this[kIterator].close(At)}}defaultKvIterator.DefaultKeyIterator=DefaultKeyIterator$1;defaultKvIterator.DefaultValueIterator=DefaultValueIterator$1;var deferredIterator={};const{AbstractIterator:AbstractIterator$2,AbstractKeyIterator,AbstractValueIterator}=abstractIterator,ModuleError$5=moduleError,kNut=Symbol("nut"),kUndefer$1=Symbol("undefer"),kFactory=Symbol("factory");let DeferredIterator$1=class extends AbstractIterator$2{constructor(e,_t){super(e,_t),this[kNut]=null,this[kFactory]=()=>e.iterator(_t),this.db.defer(()=>this[kUndefer$1]())}},DeferredKeyIterator$1=class extends AbstractKeyIterator{constructor(e,_t){super(e,_t),this[kNut]=null,this[kFactory]=()=>e.keys(_t),this.db.defer(()=>this[kUndefer$1]())}},DeferredValueIterator$1=class extends AbstractValueIterator{constructor(e,_t){super(e,_t),this[kNut]=null,this[kFactory]=()=>e.values(_t),this.db.defer(()=>this[kUndefer$1]())}};for(const $t of[DeferredIterator$1,DeferredKeyIterator$1,DeferredValueIterator$1])$t.prototype[kUndefer$1]=function(){this.db.status==="open"&&(this[kNut]=this[kFactory]())},$t.prototype._next=function(e){this[kNut]!==null?this[kNut].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new ModuleError$5("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},$t.prototype._nextv=function(e,_t,At){this[kNut]!==null?this[kNut].nextv(e,_t,At):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,_t,At)):this.nextTick(At,new ModuleError$5("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},$t.prototype._all=function(e,_t){this[kNut]!==null?this[kNut].all(_t):this.db.status==="opening"?this.db.defer(()=>this._all(e,_t)):this.nextTick(_t,new ModuleError$5("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},$t.prototype._seek=function(e,_t){this[kNut]!==null?this[kNut]._seek(e,_t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,_t))},$t.prototype._close=function(e){this[kNut]!==null?this[kNut].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};deferredIterator.DeferredIterator=DeferredIterator$1;deferredIterator.DeferredKeyIterator=DeferredKeyIterator$1;deferredIterator.DeferredValueIterator=DeferredValueIterator$1;var defaultChainedBatch={},abstractChainedBatch={};const{fromCallback:fromCallback$2}=catering,ModuleError$4=moduleError,{getCallback:getCallback$1,getOptions:getOptions$1}=common,kPromise$2=Symbol("promise"),kStatus$1=Symbol("status"),kOperations$1=Symbol("operations"),kFinishClose=Symbol("finishClose"),kCloseCallbacks=Symbol("closeCallbacks");let AbstractChainedBatch$1=class{constructor(e){if(typeof e!="object"||e===null){const _t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${_t}`)}this[kOperations$1]=[],this[kCloseCallbacks]=[],this[kStatus$1]="open",this[kFinishClose]=this[kFinishClose].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[kOperations$1].length}put(e,_t,At){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const xt=this.db._checkKey(e)||this.db._checkValue(_t);if(xt)throw xt;const kt=At&&At.sublevel!=null?At.sublevel:this.db,Bt=At,Nt=kt.keyEncoding(At&&At.keyEncoding),Ut=kt.valueEncoding(At&&At.valueEncoding),Lt=Nt.format;At={...At,keyEncoding:Lt,valueEncoding:Ut.format},kt!==this.db&&(At.sublevel=null);const jt=kt.prefixKey(Nt.encode(e),Lt),Kt=Ut.encode(_t);return this._put(jt,Kt,At),this[kOperations$1].push({...Bt,type:"put",key:e,value:_t}),this}_put(e,_t,At){}del(e,_t){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const At=this.db._checkKey(e);if(At)throw At;const xt=_t&&_t.sublevel!=null?_t.sublevel:this.db,kt=_t,Bt=xt.keyEncoding(_t&&_t.keyEncoding),Nt=Bt.format;return _t={..._t,keyEncoding:Nt},xt!==this.db&&(_t.sublevel=null),this._del(xt.prefixKey(Bt.encode(e),Nt),_t),this[kOperations$1].push({...kt,type:"del",key:e}),this}_del(e,_t){}clear(){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[kOperations$1]=[],this}_clear(){}write(e,_t){return _t=getCallback$1(e,_t),_t=fromCallback$2(_t,kPromise$2),e=getOptions$1(e),this[kStatus$1]!=="open"?this.nextTick(_t,new ModuleError$4("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(_t):(this[kStatus$1]="writing",this._write(e,At=>{this[kStatus$1]="closing",this[kCloseCallbacks].push(()=>_t(At)),At||this.db.emit("batch",this[kOperations$1]),this._close(this[kFinishClose])})),_t[kPromise$2]}_write(e,_t){}close(e){return e=fromCallback$2(e,kPromise$2),this[kStatus$1]==="closing"?this[kCloseCallbacks].push(e):this[kStatus$1]==="closed"?this.nextTick(e):(this[kCloseCallbacks].push(e),this[kStatus$1]!=="writing"&&(this[kStatus$1]="closing",this._close(this[kFinishClose]))),e[kPromise$2]}_close(e){this.nextTick(e)}[kFinishClose](){this[kStatus$1]="closed",this.db.detachResource(this);const e=this[kCloseCallbacks];this[kCloseCallbacks]=[];for(const _t of e)_t()}};abstractChainedBatch.AbstractChainedBatch=AbstractChainedBatch$1;const{AbstractChainedBatch}=abstractChainedBatch,ModuleError$3=moduleError,kEncoded=Symbol("encoded");let DefaultChainedBatch$1=class extends AbstractChainedBatch{constructor(e){super(e),this[kEncoded]=[]}_put(e,_t,At){this[kEncoded].push({...At,type:"put",key:e,value:_t})}_del(e,_t){this[kEncoded].push({..._t,type:"del",key:e})}_clear(){this[kEncoded]=[]}_write(e,_t){this.db.status==="opening"?this.db.defer(()=>this._write(e,_t)):this.db.status==="open"?this[kEncoded].length===0?this.nextTick(_t):this.db._batch(this[kEncoded],e,_t):this.nextTick(_t,new ModuleError$3("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};defaultChainedBatch.DefaultChainedBatch=DefaultChainedBatch$1;const ModuleError$2=moduleError,hasOwnProperty=Object.prototype.hasOwnProperty,rangeOptions$1=new Set(["lt","lte","gt","gte"]);var rangeOptions_1=function($t,e){const _t={};for(const At in $t)if(hasOwnProperty.call($t,At)&&!(At==="keyEncoding"||At==="valueEncoding")){if(At==="start"||At==="end")throw new ModuleError$2(`The legacy range option '${At}' has been removed`,{code:"LEVEL_LEGACY"});if(At==="encoding")throw new ModuleError$2("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});rangeOptions$1.has(At)?_t[At]=e.encode($t[At]):_t[At]=$t[At]}return _t.reverse=!!_t.reverse,_t.limit=Number.isInteger(_t.limit)&&_t.limit>=0?_t.limit:-1,_t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let promise;var queueMicrotask_1=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):$t=>(promise||(promise=Promise.resolve())).then($t).catch(e=>setTimeout(()=>{throw e},0)),nextTickBrowser,hasRequiredNextTickBrowser;function requireNextTickBrowser(){if(hasRequiredNextTickBrowser)return nextTickBrowser;hasRequiredNextTickBrowser=1;const $t=queueMicrotask_1;return nextTickBrowser=function(e,..._t){_t.length===0?$t(e):$t(()=>e(..._t))},nextTickBrowser}var abstractSublevelIterator={},hasRequiredAbstractSublevelIterator;function requireAbstractSublevelIterator(){if(hasRequiredAbstractSublevelIterator)return abstractSublevelIterator;hasRequiredAbstractSublevelIterator=1;const{AbstractIterator:$t,AbstractKeyIterator:e,AbstractValueIterator:_t}=abstractIterator,At=Symbol("unfix"),xt=Symbol("iterator"),kt=Symbol("handleOne"),Bt=Symbol("handleMany"),Nt=Symbol("callback");class Ut extends $t{constructor(qt,zt,Vt,Ht){super(qt,zt),this[xt]=Vt,this[At]=Ht,this[kt]=this[kt].bind(this),this[Bt]=this[Bt].bind(this),this[Nt]=null}[kt](qt,zt,Vt){const Ht=this[Nt];if(qt)return Ht(qt);zt!==void 0&&(zt=this[At](zt)),Ht(qt,zt,Vt)}[Bt](qt,zt){const Vt=this[Nt];if(qt)return Vt(qt);for(const Ht of zt){const Wt=Ht[0];Wt!==void 0&&(Ht[0]=this[At](Wt))}Vt(qt,zt)}}class Lt extends e{constructor(qt,zt,Vt,Ht){super(qt,zt),this[xt]=Vt,this[At]=Ht,this[kt]=this[kt].bind(this),this[Bt]=this[Bt].bind(this),this[Nt]=null}[kt](qt,zt){const Vt=this[Nt];if(qt)return Vt(qt);zt!==void 0&&(zt=this[At](zt)),Vt(qt,zt)}[Bt](qt,zt){const Vt=this[Nt];if(qt)return Vt(qt);for(let Ht=0;Ht<zt.length;Ht++){const Wt=zt[Ht];Wt!==void 0&&(zt[Ht]=this[At](Wt))}Vt(qt,zt)}}class jt extends _t{constructor(qt,zt,Vt){super(qt,zt),this[xt]=Vt}}for(const Kt of[Ut,Lt])Kt.prototype._next=function(qt){this[Nt]=qt,this[xt].next(this[kt])},Kt.prototype._nextv=function(qt,zt,Vt){this[Nt]=Vt,this[xt].nextv(qt,zt,this[Bt])},Kt.prototype._all=function(qt,zt){this[Nt]=zt,this[xt].all(qt,this[Bt])};for(const Kt of[jt])Kt.prototype._next=function(qt){this[xt].next(qt)},Kt.prototype._nextv=function(qt,zt,Vt){this[xt].nextv(qt,zt,Vt)},Kt.prototype._all=function(qt,zt){this[xt].all(qt,zt)};for(const Kt of[Ut,Lt,jt])Kt.prototype._seek=function(qt,zt){this[xt].seek(qt,zt)},Kt.prototype._close=function(qt){this[xt].close(qt)};return abstractSublevelIterator.AbstractSublevelIterator=Ut,abstractSublevelIterator.AbstractSublevelKeyIterator=Lt,abstractSublevelIterator.AbstractSublevelValueIterator=jt,abstractSublevelIterator}var abstractSublevel,hasRequiredAbstractSublevel;function requireAbstractSublevel(){if(hasRequiredAbstractSublevel)return abstractSublevel;hasRequiredAbstractSublevel=1;const $t=moduleError,{Buffer:e}=buffer$2||{},{AbstractSublevelIterator:_t,AbstractSublevelKeyIterator:At,AbstractSublevelValueIterator:xt}=requireAbstractSublevelIterator(),kt=Symbol("prefix"),Bt=Symbol("upperBound"),Nt=Symbol("prefixRange"),Ut=Symbol("parent"),Lt=Symbol("unfix"),jt=new TextEncoder,Kt={separator:"!"};abstractSublevel=function({AbstractLevel:Qt}){class Xt extends Qt{static defaults(tr){if(typeof tr=="string")throw new $t("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(tr&&tr.open)throw new $t("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return tr==null?Kt:tr.separator?tr:{...tr,separator:"!"}}constructor(tr,dr,vr){const{separator:$r,manifest:Ir,...Rr}=Xt.defaults(vr);dr=Wt(dr,$r);const Nr=$r.charCodeAt(0)+1,kr=tr[Ut]||tr;if(!jt.encode(dr).every(er=>er>Nr&&er<127))throw new $t(`Prefix must use bytes > ${Nr} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(qt(kr,Ir),Rr);const lr=(tr.prefix||"")+$r+dr+$r,ir=lr.slice(0,-1)+String.fromCharCode(Nr);this[Ut]=kr,this[kt]=new Vt(lr),this[Bt]=new Vt(ir),this[Lt]=new Ht,this.nextTick=kr.nextTick}prefixKey(tr,dr){if(dr==="utf8")return this[kt].utf8+tr;if(tr.byteLength===0)return this[kt][dr];if(dr==="view"){const vr=this[kt].view,$r=new Uint8Array(vr.byteLength+tr.byteLength);return $r.set(vr,0),$r.set(tr,vr.byteLength),$r}else{const vr=this[kt].buffer;return e.concat([vr,tr],vr.byteLength+tr.byteLength)}}[Nt](tr,dr){tr.gte!==void 0?tr.gte=this.prefixKey(tr.gte,dr):tr.gt!==void 0?tr.gt=this.prefixKey(tr.gt,dr):tr.gte=this[kt][dr],tr.lte!==void 0?tr.lte=this.prefixKey(tr.lte,dr):tr.lt!==void 0?tr.lt=this.prefixKey(tr.lt,dr):tr.lte=this[Bt][dr]}get prefix(){return this[kt].utf8}get db(){return this[Ut]}_open(tr,dr){this[Ut].open({passive:!0},dr)}_put(tr,dr,vr,$r){this[Ut].put(tr,dr,vr,$r)}_get(tr,dr,vr){this[Ut].get(tr,dr,vr)}_getMany(tr,dr,vr){this[Ut].getMany(tr,dr,vr)}_del(tr,dr,vr){this[Ut].del(tr,dr,vr)}_batch(tr,dr,vr){this[Ut].batch(tr,dr,vr)}_clear(tr,dr){this[Nt](tr,tr.keyEncoding),this[Ut].clear(tr,dr)}_iterator(tr){this[Nt](tr,tr.keyEncoding);const dr=this[Ut].iterator(tr),vr=this[Lt].get(this[kt].utf8.length,tr.keyEncoding);return new _t(this,tr,dr,vr)}_keys(tr){this[Nt](tr,tr.keyEncoding);const dr=this[Ut].keys(tr),vr=this[Lt].get(this[kt].utf8.length,tr.keyEncoding);return new At(this,tr,dr,vr)}_values(tr){this[Nt](tr,tr.keyEncoding);const dr=this[Ut].values(tr);return new xt(this,tr,dr)}}return{AbstractSublevel:Xt}};const qt=function(Qt,Xt){return{...Qt.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...Xt,encodings:{utf8:zt(Qt,"utf8"),buffer:zt(Qt,"buffer"),view:zt(Qt,"view")}}},zt=function(Qt,Xt){return Qt.supports.encodings[Xt]?Qt.keyEncoding(Xt).name===Xt:!1};class Vt{constructor(Xt){this.utf8=Xt,this.view=jt.encode(Xt),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class Ht{constructor(){this.cache=new Map}get(Xt,Jt){let tr=this.cache.get(Jt);return tr===void 0&&(Jt==="view"?tr=(function(dr,vr){return vr.subarray(dr)}).bind(null,Xt):tr=(function(dr,vr){return vr.slice(dr)}).bind(null,Xt),this.cache.set(Jt,tr)),tr}}const Wt=function(Qt,Xt){let Jt=0,tr=Qt.length;for(;Jt<tr&&Qt[Jt]===Xt;)Jt++;for(;tr>Jt&&Qt[tr-1]===Xt;)tr--;return Qt.slice(Jt,tr)};return abstractSublevel}const{supports}=levelSupports,{Transcoder}=levelTranscoder,{EventEmitter:EventEmitter$1}=eventsExports,{fromCallback:fromCallback$1}=catering,ModuleError$1=moduleError,{AbstractIterator:AbstractIterator$1}=abstractIterator,{DefaultKeyIterator,DefaultValueIterator}=defaultKvIterator,{DeferredIterator,DeferredKeyIterator,DeferredValueIterator}=deferredIterator,{DefaultChainedBatch}=defaultChainedBatch,{getCallback,getOptions}=common,rangeOptions=rangeOptions_1,kPromise$1=Symbol("promise"),kLanded=Symbol("landed"),kResources=Symbol("resources"),kCloseResources=Symbol("closeResources"),kOperations=Symbol("operations"),kUndefer=Symbol("undefer"),kDeferOpen=Symbol("deferOpen"),kOptions$1=Symbol("options"),kStatus=Symbol("status"),kDefaultOptions=Symbol("defaultOptions"),kTranscoder=Symbol("transcoder"),kKeyEncoding=Symbol("keyEncoding"),kValueEncoding=Symbol("valueEncoding"),noop=()=>{};let AbstractLevel$1=class extends EventEmitter$1{constructor(e,_t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");_t=getOptions(_t);const{keyEncoding:At,valueEncoding:xt,passive:kt,...Bt}=_t;this[kResources]=new Set,this[kOperations]=[],this[kDeferOpen]=!0,this[kOptions$1]=Bt,this[kStatus]="opening",this.supports=supports(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[kTranscoder]=new Transcoder(formats(this)),this[kKeyEncoding]=this[kTranscoder].encoding(At||"utf8"),this[kValueEncoding]=this[kTranscoder].encoding(xt||"utf8");for(const Nt of this[kTranscoder].encodings())this.supports.encodings[Nt.commonName]||(this.supports.encodings[Nt.commonName]=!0);this[kDefaultOptions]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[kKeyEncoding].commonName,valueEncoding:this[kValueEncoding].commonName}),key:Object.freeze({keyEncoding:this[kKeyEncoding].commonName})},this.nextTick(()=>{this[kDeferOpen]&&this.open({passive:!1},noop)})}get status(){return this[kStatus]}keyEncoding(e){return this[kTranscoder].encoding(e??this[kKeyEncoding])}valueEncoding(e){return this[kTranscoder].encoding(e??this[kValueEncoding])}open(e,_t){_t=getCallback(e,_t),_t=fromCallback$1(_t,kPromise$1),e={...this[kOptions$1],...getOptions(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const At=xt=>{this[kStatus]==="closing"||this[kStatus]==="opening"?this.once(kLanded,xt?()=>At(xt):At):this[kStatus]!=="open"?_t(new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:xt})):_t()};return e.passive?this[kStatus]==="opening"?this.once(kLanded,At):this.nextTick(At):this[kStatus]==="closed"||this[kDeferOpen]?(this[kDeferOpen]=!1,this[kStatus]="opening",this.emit("opening"),this._open(e,xt=>{if(xt){this[kStatus]="closed",this[kCloseResources](()=>{this.emit(kLanded),At(xt)}),this[kUndefer]();return}this[kStatus]="open",this[kUndefer](),this.emit(kLanded),this[kStatus]==="open"&&this.emit("open"),this[kStatus]==="open"&&this.emit("ready"),At()})):this[kStatus]==="open"?this.nextTick(At):this.once(kLanded,()=>this.open(e,_t)),_t[kPromise$1]}_open(e,_t){this.nextTick(_t)}close(e){e=fromCallback$1(e,kPromise$1);const _t=At=>{this[kStatus]==="opening"||this[kStatus]==="closing"?this.once(kLanded,At?_t(At):_t):this[kStatus]!=="closed"?e(new ModuleError$1("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:At})):e()};if(this[kStatus]==="open"){this[kStatus]="closing",this.emit("closing");const At=xt=>{this[kStatus]="open",this[kUndefer](),this.emit(kLanded),_t(xt)};this[kCloseResources](()=>{this._close(xt=>{if(xt)return At(xt);this[kStatus]="closed",this[kUndefer](),this.emit(kLanded),this[kStatus]==="closed"&&this.emit("closed"),_t()})})}else this[kStatus]==="closed"?this.nextTick(_t):this.once(kLanded,()=>this.close(e));return e[kPromise$1]}[kCloseResources](e){if(this[kResources].size===0)return this.nextTick(e);let _t=this[kResources].size,At=!0;const xt=()=>{--_t===0&&(At?this.nextTick(e):e())};for(const kt of this[kResources])kt.close(xt);At=!1,this[kResources].clear()}_close(e){this.nextTick(e)}get(e,_t,At){if(At=getCallback(_t,At),At=fromCallback$1(At,kPromise$1),_t=getOptions(_t,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.get(e,_t,At)),At[kPromise$1];if(maybeError(this,At))return At[kPromise$1];const xt=this._checkKey(e);if(xt)return this.nextTick(At,xt),At[kPromise$1];const kt=this.keyEncoding(_t.keyEncoding),Bt=this.valueEncoding(_t.valueEncoding),Nt=kt.format,Ut=Bt.format;return(_t.keyEncoding!==Nt||_t.valueEncoding!==Ut)&&(_t=Object.assign({},_t,{keyEncoding:Nt,valueEncoding:Ut})),this._get(this.prefixKey(kt.encode(e),Nt),_t,(Lt,jt)=>{if(Lt)return(Lt.code==="LEVEL_NOT_FOUND"||Lt.notFound||/NotFound/i.test(Lt))&&(Lt.code||(Lt.code="LEVEL_NOT_FOUND"),Lt.notFound||(Lt.notFound=!0),Lt.status||(Lt.status=404)),At(Lt);try{jt=Bt.decode(jt)}catch(Kt){return At(new ModuleError$1("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:Kt}))}At(null,jt)}),At[kPromise$1]}_get(e,_t,At){this.nextTick(At,new Error("NotFound"))}getMany(e,_t,At){if(At=getCallback(_t,At),At=fromCallback$1(At,kPromise$1),_t=getOptions(_t,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.getMany(e,_t,At)),At[kPromise$1];if(maybeError(this,At))return At[kPromise$1];if(!Array.isArray(e))return this.nextTick(At,new TypeError("The first argument 'keys' must be an array")),At[kPromise$1];if(e.length===0)return this.nextTick(At,null,[]),At[kPromise$1];const xt=this.keyEncoding(_t.keyEncoding),kt=this.valueEncoding(_t.valueEncoding),Bt=xt.format,Nt=kt.format;(_t.keyEncoding!==Bt||_t.valueEncoding!==Nt)&&(_t=Object.assign({},_t,{keyEncoding:Bt,valueEncoding:Nt}));const Ut=new Array(e.length);for(let Lt=0;Lt<e.length;Lt++){const jt=e[Lt],Kt=this._checkKey(jt);if(Kt)return this.nextTick(At,Kt),At[kPromise$1];Ut[Lt]=this.prefixKey(xt.encode(jt),Bt)}return this._getMany(Ut,_t,(Lt,jt)=>{if(Lt)return At(Lt);try{for(let Kt=0;Kt<jt.length;Kt++)jt[Kt]!==void 0&&(jt[Kt]=kt.decode(jt[Kt]))}catch(Kt){return At(new ModuleError$1(`Could not decode one or more of ${jt.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:Kt}))}At(null,jt)}),At[kPromise$1]}_getMany(e,_t,At){this.nextTick(At,null,new Array(e.length).fill(void 0))}put(e,_t,At,xt){if(xt=getCallback(At,xt),xt=fromCallback$1(xt,kPromise$1),At=getOptions(At,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.put(e,_t,At,xt)),xt[kPromise$1];if(maybeError(this,xt))return xt[kPromise$1];const kt=this._checkKey(e)||this._checkValue(_t);if(kt)return this.nextTick(xt,kt),xt[kPromise$1];const Bt=this.keyEncoding(At.keyEncoding),Nt=this.valueEncoding(At.valueEncoding),Ut=Bt.format,Lt=Nt.format;(At.keyEncoding!==Ut||At.valueEncoding!==Lt)&&(At=Object.assign({},At,{keyEncoding:Ut,valueEncoding:Lt}));const jt=this.prefixKey(Bt.encode(e),Ut),Kt=Nt.encode(_t);return this._put(jt,Kt,At,qt=>{if(qt)return xt(qt);this.emit("put",e,_t),xt()}),xt[kPromise$1]}_put(e,_t,At,xt){this.nextTick(xt)}del(e,_t,At){if(At=getCallback(_t,At),At=fromCallback$1(At,kPromise$1),_t=getOptions(_t,this[kDefaultOptions].key),this[kStatus]==="opening")return this.defer(()=>this.del(e,_t,At)),At[kPromise$1];if(maybeError(this,At))return At[kPromise$1];const xt=this._checkKey(e);if(xt)return this.nextTick(At,xt),At[kPromise$1];const kt=this.keyEncoding(_t.keyEncoding),Bt=kt.format;return _t.keyEncoding!==Bt&&(_t=Object.assign({},_t,{keyEncoding:Bt})),this._del(this.prefixKey(kt.encode(e),Bt),_t,Nt=>{if(Nt)return At(Nt);this.emit("del",e),At()}),At[kPromise$1]}_del(e,_t,At){this.nextTick(At)}batch(e,_t,At){if(!arguments.length){if(this[kStatus]==="opening")return new DefaultChainedBatch(this);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?At=e:At=getCallback(_t,At),At=fromCallback$1(At,kPromise$1),_t=getOptions(_t,this[kDefaultOptions].empty),this[kStatus]==="opening")return this.defer(()=>this.batch(e,_t,At)),At[kPromise$1];if(maybeError(this,At))return At[kPromise$1];if(!Array.isArray(e))return this.nextTick(At,new TypeError("The first argument 'operations' must be an array")),At[kPromise$1];if(e.length===0)return this.nextTick(At),At[kPromise$1];const xt=new Array(e.length),{keyEncoding:kt,valueEncoding:Bt,...Nt}=_t;for(let Ut=0;Ut<e.length;Ut++){if(typeof e[Ut]!="object"||e[Ut]===null)return this.nextTick(At,new TypeError("A batch operation must be an object")),At[kPromise$1];const Lt=Object.assign({},e[Ut]);if(Lt.type!=="put"&&Lt.type!=="del")return this.nextTick(At,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),At[kPromise$1];const jt=this._checkKey(Lt.key);if(jt)return this.nextTick(At,jt),At[kPromise$1];const Kt=Lt.sublevel!=null?Lt.sublevel:this,qt=Kt.keyEncoding(Lt.keyEncoding||kt),zt=qt.format;if(Lt.key=Kt.prefixKey(qt.encode(Lt.key),zt),Lt.keyEncoding=zt,Lt.type==="put"){const Vt=this._checkValue(Lt.value);if(Vt)return this.nextTick(At,Vt),At[kPromise$1];const Ht=Kt.valueEncoding(Lt.valueEncoding||Bt);Lt.value=Ht.encode(Lt.value),Lt.valueEncoding=Ht.format}Kt!==this&&(Lt.sublevel=null),xt[Ut]=Lt}return this._batch(xt,Nt,Ut=>{if(Ut)return At(Ut);this.emit("batch",e),At()}),At[kPromise$1]}_batch(e,_t,At){this.nextTick(At)}sublevel(e,_t){return this._sublevel(e,AbstractSublevel.defaults(_t))}_sublevel(e,_t){return new AbstractSublevel(this,e,_t)}prefixKey(e,_t){return e}clear(e,_t){if(_t=getCallback(e,_t),_t=fromCallback$1(_t,kPromise$1),e=getOptions(e,this[kDefaultOptions].empty),this[kStatus]==="opening")return this.defer(()=>this.clear(e,_t)),_t[kPromise$1];if(maybeError(this,_t))return _t[kPromise$1];const At=e,xt=this.keyEncoding(e.keyEncoding);return e=rangeOptions(e,xt),e.keyEncoding=xt.format,e.limit===0?this.nextTick(_t):this._clear(e,kt=>{if(kt)return _t(kt);this.emit("clear",At),_t()}),_t[kPromise$1]}_clear(e,_t){this.nextTick(_t)}iterator(e){const _t=this.keyEncoding(e&&e.keyEncoding),At=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,_t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[AbstractIterator$1.keyEncoding]=_t,e[AbstractIterator$1.valueEncoding]=At,e.keyEncoding=_t.format,e.valueEncoding=At.format,this[kStatus]==="opening")return new DeferredIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new AbstractIterator$1(this,e)}keys(e){const _t=this.keyEncoding(e&&e.keyEncoding),At=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,_t),e[AbstractIterator$1.keyEncoding]=_t,e[AbstractIterator$1.valueEncoding]=At,e.keyEncoding=_t.format,e.valueEncoding=At.format,this[kStatus]==="opening")return new DeferredKeyIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new DefaultKeyIterator(this,e)}values(e){const _t=this.keyEncoding(e&&e.keyEncoding),At=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,_t),e[AbstractIterator$1.keyEncoding]=_t,e[AbstractIterator$1.valueEncoding]=At,e.keyEncoding=_t.format,e.valueEncoding=At.format,this[kStatus]==="opening")return new DeferredValueIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new DefaultValueIterator(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[kOperations].push(e)}[kUndefer](){if(this[kOperations].length===0)return;const e=this[kOperations];this[kOperations]=[];for(const _t of e)_t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[kResources].add(e)}detachResource(e){this[kResources].delete(e)}_chainedBatch(){return new DefaultChainedBatch(this)}_checkKey(e){if(e==null)return new ModuleError$1("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new ModuleError$1("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};AbstractLevel$1.prototype.nextTick=requireNextTickBrowser();const{AbstractSublevel}=requireAbstractSublevel()({AbstractLevel:AbstractLevel$1});abstractLevel.AbstractLevel=AbstractLevel$1;abstractLevel.AbstractSublevel=AbstractSublevel;const maybeError=function($t,e){return $t[kStatus]!=="open"?($t.nextTick(e,new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},formats=function($t){return Object.keys($t.supports.encodings).filter(e=>!!$t.supports.encodings[e])};abstractLevel$1.AbstractLevel=abstractLevel.AbstractLevel;abstractLevel$1.AbstractSublevel=abstractLevel.AbstractSublevel;abstractLevel$1.AbstractIterator=abstractIterator.AbstractIterator;abstractLevel$1.AbstractKeyIterator=abstractIterator.AbstractKeyIterator;abstractLevel$1.AbstractValueIterator=abstractIterator.AbstractValueIterator;abstractLevel$1.AbstractChainedBatch=abstractChainedBatch.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var runParallelLimit_1=runParallelLimit;const queueMicrotask$1=queueMicrotask_1;function runParallelLimit($t,e,_t){if(typeof e!="number")throw new Error("second argument must be a Number");let At,xt,kt,Bt,Nt,Ut=!0,Lt;Array.isArray($t)?(At=[],kt=xt=$t.length):(Bt=Object.keys($t),At={},kt=xt=Bt.length);function jt(qt){function zt(){_t&&_t(qt,At),_t=null}Ut?queueMicrotask$1(zt):zt()}function Kt(qt,zt,Vt){if(At[qt]=Vt,zt&&(Nt=!0),--kt===0||zt)jt(zt);else if(!Nt&&Lt<xt){let Ht;Bt?(Ht=Bt[Lt],Lt+=1,$t[Ht](function(Wt,Qt){Kt(Ht,Wt,Qt)})):(Ht=Lt,Lt+=1,$t[Ht](function(Wt,Qt){Kt(Ht,Wt,Qt)}))}}Lt=e,kt?Bt?Bt.some(function(qt,zt){return $t[qt](function(Vt,Ht){Kt(qt,Vt,Ht)}),zt===e-1}):$t.some(function(qt,zt){return qt(function(Vt,Ht){Kt(zt,Vt,Ht)}),zt===e-1}):jt(null),Ut=!1}var iterator={},keyRange=function $t(e){const _t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,At=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,xt=e.gte===void 0,kt=e.lte===void 0;return _t!==void 0&&At!==void 0?IDBKeyRange.bound(_t,At,xt,kt):_t!==void 0?IDBKeyRange.lowerBound(_t,xt):At!==void 0?IDBKeyRange.upperBound(At,kt):null};const textEncoder$1=new TextEncoder;var deserialize$2=function($t){return $t instanceof Uint8Array?$t:$t instanceof ArrayBuffer?new Uint8Array($t):textEncoder$1.encode($t)};const{AbstractIterator}=abstractLevel$1,createKeyRange$1=keyRange,deserialize$1=deserialize$2,kCache=Symbol("cache"),kFinished=Symbol("finished"),kOptions=Symbol("options"),kCurrentOptions=Symbol("currentOptions"),kPosition=Symbol("position"),kLocation$1=Symbol("location"),kFirst=Symbol("first"),emptyOptions={};let Iterator$1=class extends AbstractIterator{constructor(e,_t,At){super(e,At),this[kCache]=[],this[kFinished]=this.limit===0,this[kOptions]=At,this[kCurrentOptions]={...At},this[kPosition]=void 0,this[kLocation$1]=_t,this[kFirst]=!0}_nextv(e,_t,At){if(this[kFirst]=!1,this[kFinished])return this.nextTick(At,null,[]);if(this[kCache].length>0)return e=Math.min(e,this[kCache].length),this.nextTick(At,null,this[kCache].splice(0,e));this[kPosition]!==void 0&&(this[kOptions].reverse?(this[kCurrentOptions].lt=this[kPosition],this[kCurrentOptions].lte=void 0):(this[kCurrentOptions].gt=this[kPosition],this[kCurrentOptions].gte=void 0));let xt;try{xt=createKeyRange$1(this[kCurrentOptions])}catch{return this[kFinished]=!0,this.nextTick(At,null,[])}const kt=this.db.db.transaction([this[kLocation$1]],"readonly"),Bt=kt.objectStore(this[kLocation$1]),Nt=[];if(this[kOptions].reverse){const Ut=!this[kOptions].values&&Bt.openKeyCursor?"openKeyCursor":"openCursor";Bt[Ut](xt,"prev").onsuccess=Lt=>{const jt=Lt.target.result;if(jt){const{key:Kt,value:qt}=jt;this[kPosition]=Kt,Nt.push([this[kOptions].keys&&Kt!==void 0?deserialize$1(Kt):void 0,this[kOptions].values&&qt!==void 0?deserialize$1(qt):void 0]),Nt.length<e?jt.continue():maybeCommit(kt)}else this[kFinished]=!0}}else{let Ut,Lt;const jt=()=>{if(Ut===void 0||Lt===void 0)return;const Kt=Math.max(Ut.length,Lt.length);Kt===0||e===1/0?this[kFinished]=!0:this[kPosition]=Ut[Kt-1],Nt.length=Kt;for(let qt=0;qt<Kt;qt++){const zt=Ut[qt],Vt=Lt[qt];Nt[qt]=[this[kOptions].keys&&zt!==void 0?deserialize$1(zt):void 0,this[kOptions].values&&Vt!==void 0?deserialize$1(Vt):void 0]}maybeCommit(kt)};this[kOptions].keys||e<1/0?Bt.getAllKeys(xt,e<1/0?e:void 0).onsuccess=Kt=>{Ut=Kt.target.result,jt()}:(Ut=[],this.nextTick(jt)),this[kOptions].values?Bt.getAll(xt,e<1/0?e:void 0).onsuccess=Kt=>{Lt=Kt.target.result,jt()}:(Lt=[],this.nextTick(jt))}kt.onabort=()=>{At(kt.error||new Error("aborted by user")),At=null},kt.oncomplete=()=>{At(null,Nt),At=null}}_next(e){if(this[kCache].length>0){const[_t,At]=this[kCache].shift();this.nextTick(e,null,_t,At)}else if(this[kFinished])this.nextTick(e);else{let _t=Math.min(100,this.limit-this.count);this[kFirst]&&(this[kFirst]=!1,_t=1),this._nextv(_t,emptyOptions,(At,xt)=>{if(At)return e(At);this[kCache]=xt,this._next(e)})}}_all(e,_t){this[kFirst]=!1;const At=this[kCache].splice(0,this[kCache].length),xt=this.limit-this.count-At.length;if(xt<=0)return this.nextTick(_t,null,At);this._nextv(xt,emptyOptions,(kt,Bt)=>{if(kt)return _t(kt);At.length>0&&(Bt=At.concat(Bt)),_t(null,Bt)})}_seek(e,_t){this[kFirst]=!0,this[kCache]=[],this[kFinished]=!1,this[kPosition]=void 0,this[kCurrentOptions]={...this[kOptions]};let At;try{At=createKeyRange$1(this[kOptions])}catch{this[kFinished]=!0;return}At!==null&&!At.includes(e)?this[kFinished]=!0:this[kOptions].reverse?this[kCurrentOptions].lte=e:this[kCurrentOptions].gte=e}};iterator.Iterator=Iterator$1;function maybeCommit($t){typeof $t.commit=="function"&&$t.commit()}var clear$1=function $t(e,_t,At,xt,kt){if(xt.limit===0)return e.nextTick(kt);const Bt=e.db.transaction([_t],"readwrite"),Nt=Bt.objectStore(_t);let Ut=0;Bt.oncomplete=function(){kt()},Bt.onabort=function(){kt(Bt.error||new Error("aborted by user"))};const Lt=Nt.openKeyCursor?"openKeyCursor":"openCursor",jt=xt.reverse?"prev":"next";Nt[Lt](At,jt).onsuccess=function(Kt){const qt=Kt.target.result;qt&&(Nt.delete(qt.key).onsuccess=function(){(xt.limit<=0||++Ut<xt.limit)&&qt.continue()})}};const{AbstractLevel}=abstractLevel$1,ModuleError=moduleError,parallel$1=runParallelLimit_1,{fromCallback}=catering,{Iterator}=iterator,deserialize=deserialize$2,clear=clear$1,createKeyRange=keyRange,DEFAULT_PREFIX="level-js-",kIDB=Symbol("idb"),kNamePrefix=Symbol("namePrefix"),kLocation=Symbol("location"),kVersion=Symbol("version"),kStore=Symbol("store"),kOnComplete=Symbol("onComplete"),kPromise=Symbol("promise");class BrowserLevel extends AbstractLevel{constructor(e,_t,At){if(typeof _t=="function"||typeof At=="function")throw new ModuleError("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:xt,version:kt,...Bt}=_t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},Bt),typeof e!="string")throw new Error("constructor requires a location string argument");this[kLocation]=e,this[kNamePrefix]=xt??DEFAULT_PREFIX,this[kVersion]=parseInt(kt||1,10),this[kIDB]=null}get location(){return this[kLocation]}get namePrefix(){return this[kNamePrefix]}get version(){return this[kVersion]}get db(){return this[kIDB]}get type(){return"browser-level"}_open(e,_t){const At=indexedDB.open(this[kNamePrefix]+this[kLocation],this[kVersion]);At.onerror=function(){_t(At.error||new Error("unknown error"))},At.onsuccess=()=>{this[kIDB]=At.result,_t()},At.onupgradeneeded=xt=>{const kt=xt.target.result;kt.objectStoreNames.contains(this[kLocation])||kt.createObjectStore(this[kLocation])}}[kStore](e){return this[kIDB].transaction([this[kLocation]],e).objectStore(this[kLocation])}[kOnComplete](e,_t){const At=e.transaction;At.onabort=function(){_t(At.error||new Error("aborted by user"))},At.oncomplete=function(){_t(null,e.result)}}_get(e,_t,At){const xt=this[kStore]("readonly");let kt;try{kt=xt.get(e)}catch(Bt){return this.nextTick(At,Bt)}this[kOnComplete](kt,function(Bt,Nt){if(Bt)return At(Bt);if(Nt===void 0)return At(new ModuleError("Entry not found",{code:"LEVEL_NOT_FOUND"}));At(null,deserialize(Nt))})}_getMany(e,_t,At){const xt=this[kStore]("readonly"),kt=e.map(Bt=>Nt=>{let Ut;try{Ut=xt.get(Bt)}catch(Lt){return Nt(Lt)}Ut.onsuccess=()=>{const Lt=Ut.result;Nt(null,Lt===void 0?Lt:deserialize(Lt))},Ut.onerror=Lt=>{Lt.stopPropagation(),Nt(Ut.error)}});parallel$1(kt,16,At)}_del(e,_t,At){const xt=this[kStore]("readwrite");let kt;try{kt=xt.delete(e)}catch(Bt){return this.nextTick(At,Bt)}this[kOnComplete](kt,At)}_put(e,_t,At,xt){const kt=this[kStore]("readwrite");let Bt;try{Bt=kt.put(_t,e)}catch(Nt){return this.nextTick(xt,Nt)}this[kOnComplete](Bt,xt)}_iterator(e){return new Iterator(this,this[kLocation],e)}_batch(e,_t,At){const xt=this[kStore]("readwrite"),kt=xt.transaction;let Bt=0,Nt;kt.onabort=function(){At(Nt||kt.error||new Error("aborted by user"))},kt.oncomplete=function(){At()};function Ut(){const Lt=e[Bt++],jt=Lt.key;let Kt;try{Kt=Lt.type==="del"?xt.delete(jt):xt.put(Lt.value,jt)}catch(qt){Nt=qt,kt.abort();return}Bt<e.length?Kt.onsuccess=Ut:typeof kt.commit=="function"&&kt.commit()}Ut()}_clear(e,_t){let At,xt;try{At=createKeyRange(e)}catch{return this.nextTick(_t)}if(e.limit>=0)return clear(this,this[kLocation],At,e,_t);try{const kt=this[kStore]("readwrite");xt=At?kt.delete(At):kt.clear()}catch(kt){return this.nextTick(_t,kt)}this[kOnComplete](xt,_t)}_close(e){this[kIDB].close(),this.nextTick(e)}}BrowserLevel.destroy=function($t,e,_t){typeof e=="function"&&(_t=e,e=DEFAULT_PREFIX),_t=fromCallback(_t,kPromise);const At=indexedDB.deleteDatabase(e+$t);return At.onsuccess=function(){_t()},At.onerror=function(xt){_t(xt)},_t[kPromise]};browserLevel.BrowserLevel=BrowserLevel;var Level$1=browserLevel.BrowserLevel,__awaiter$1X=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let MemoryStore$1=class{constructor(){this.store=new Map}clear(){return __awaiter$1X(this,void 0,void 0,function*(){this.store.clear()})}close(){return __awaiter$1X(this,void 0,void 0,function*(){})}delete(e){return __awaiter$1X(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return __awaiter$1X(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return __awaiter$1X(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return __awaiter$1X(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,_t){return __awaiter$1X(this,void 0,void 0,function*(){this.store.set(e,_t)})}};var __await$4=function($t){return this instanceof __await$4?(this.v=$t,this):new __await$4($t)},browser={exports:{}},stream={exports:{}},primordials={ArrayIsArray($t){return Array.isArray($t)},ArrayPrototypeIncludes($t,e){return $t.includes(e)},ArrayPrototypeIndexOf($t,e){return $t.indexOf(e)},ArrayPrototypeJoin($t,e){return $t.join(e)},ArrayPrototypeMap($t,e){return $t.map(e)},ArrayPrototypePop($t,e){return $t.pop(e)},ArrayPrototypePush($t,e){return $t.push(e)},ArrayPrototypeSlice($t,e,_t){return $t.slice(e,_t)},Error,FunctionPrototypeCall($t,e,..._t){return $t.call(e,..._t)},FunctionPrototypeSymbolHasInstance($t,e){return Function.prototype[Symbol.hasInstance].call($t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties($t,e){return Object.defineProperties($t,e)},ObjectDefineProperty($t,e,_t){return Object.defineProperty($t,e,_t)},ObjectGetOwnPropertyDescriptor($t,e){return Object.getOwnPropertyDescriptor($t,e)},ObjectKeys($t){return Object.keys($t)},ObjectSetPrototypeOf($t,e){return Object.setPrototypeOf($t,e)},Promise,PromisePrototypeCatch($t,e){return $t.catch(e)},PromisePrototypeThen($t,e,_t){return $t.then(e,_t)},PromiseReject($t){return Promise.reject($t)},ReflectApply:Reflect.apply,RegExpPrototypeTest($t,e){return $t.test(e)},SafeSet:Set,String,StringPrototypeSlice($t,e,_t){return $t.slice(e,_t)},StringPrototypeToLowerCase($t){return $t.toLowerCase()},StringPrototypeToUpperCase($t){return $t.toUpperCase()},StringPrototypeTrim($t){return $t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet($t,e,_t){return $t.set(e,_t)},Uint8Array},util={exports:{}};(function($t){const e=buffer$2,_t=Object.getPrototypeOf(async function(){}).constructor,At=globalThis.Blob||e.Blob,xt=typeof At<"u"?function(Nt){return Nt instanceof At}:function(Nt){return!1};class kt extends Error{constructor(Nt){if(!Array.isArray(Nt))throw new TypeError(`Expected input to be an Array, got ${typeof Nt}`);let Ut="";for(let Lt=0;Lt<Nt.length;Lt++)Ut+=`    ${Nt[Lt].stack}
`;super(Ut),this.name="AggregateError",this.errors=Nt}}$t.exports={AggregateError:kt,kEmptyObject:Object.freeze({}),once(Bt){let Nt=!1;return function(...Ut){Nt||(Nt=!0,Bt.apply(this,Ut))}},createDeferredPromise:function(){let Bt,Nt;return{promise:new Promise((Lt,jt)=>{Bt=Lt,Nt=jt}),resolve:Bt,reject:Nt}},promisify(Bt){return new Promise((Nt,Ut)=>{Bt((Lt,...jt)=>Lt?Ut(Lt):Nt(...jt))})},debuglog(){return function(){}},format(Bt,...Nt){return Bt.replace(/%([sdifj])/g,function(...[Ut,Lt]){const jt=Nt.shift();return Lt==="f"?jt.toFixed(6):Lt==="j"?JSON.stringify(jt):Lt==="s"&&typeof jt=="object"?`${jt.constructor!==Object?jt.constructor.name:""} {}`.trim():jt.toString()})},inspect(Bt){switch(typeof Bt){case"string":if(Bt.includes("'"))if(Bt.includes('"')){if(!Bt.includes("`")&&!Bt.includes("${"))return`\`${Bt}\``}else return`"${Bt}"`;return`'${Bt}'`;case"number":return isNaN(Bt)?"NaN":Object.is(Bt,-0)?String(Bt):Bt;case"bigint":return`${String(Bt)}n`;case"boolean":case"undefined":return String(Bt);case"object":return"{}"}},types:{isAsyncFunction(Bt){return Bt instanceof _t},isArrayBufferView(Bt){return ArrayBuffer.isView(Bt)}},isBlob:xt},$t.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util);var utilExports=util.exports,operators={};const{format,inspect:inspect$1,AggregateError:CustomAggregateError}=utilExports,AggregateError$1=globalThis.AggregateError||CustomAggregateError,kIsNodeError=Symbol("kIsNodeError"),kTypes=["string","function","number","object","Function","Object","boolean","bigint","symbol"],classRegExp=/^([A-Z][a-z0-9]*)+$/,nodeInternalPrefix="__node_internal_",codes$1={};function assert($t,e){if(!$t)throw new codes$1.ERR_INTERNAL_ASSERTION(e)}function addNumericalSeparator($t){let e="",_t=$t.length;const At=$t[0]==="-"?1:0;for(;_t>=At+4;_t-=3)e=`_${$t.slice(_t-3,_t)}${e}`;return`${$t.slice(0,_t)}${e}`}function getMessage($t,e,_t){if(typeof e=="function")return assert(e.length<=_t.length,`Code: ${$t}; The provided arguments length (${_t.length}) does not match the required ones (${e.length}).`),e(..._t);const At=(e.match(/%[dfijoOs]/g)||[]).length;return assert(At===_t.length,`Code: ${$t}; The provided arguments length (${_t.length}) does not match the required ones (${At}).`),_t.length===0?e:format(e,..._t)}function E($t,e,_t){_t||(_t=Error);class At extends _t{constructor(...kt){super(getMessage($t,e,kt))}toString(){return`${this.name} [${$t}]: ${this.message}`}}Object.defineProperties(At.prototype,{name:{value:_t.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${$t}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),At.prototype.code=$t,At.prototype[kIsNodeError]=!0,codes$1[$t]=At}function hideStackFrames$1($t){const e=nodeInternalPrefix+$t.name;return Object.defineProperty($t,"name",{value:e}),$t}function aggregateTwoErrors$2($t,e){if($t&&e&&$t!==e){if(Array.isArray(e.errors))return e.errors.push($t),e;const _t=new AggregateError$1([e,$t],e.message);return _t.code=e.code,_t}return $t||e}let AbortError$8=class extends Error{constructor(e="The operation was aborted",_t=void 0){if(_t!==void 0&&typeof _t!="object")throw new codes$1.ERR_INVALID_ARG_TYPE("options","Object",_t);super(e,_t),this.code="ABORT_ERR",this.name="AbortError"}};E("ERR_ASSERTION","%s",Error);E("ERR_INVALID_ARG_TYPE",($t,e,_t)=>{assert(typeof $t=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let At="The ";$t.endsWith(" argument")?At+=`${$t} `:At+=`"${$t}" ${$t.includes(".")?"property":"argument"} `,At+="must be ";const xt=[],kt=[],Bt=[];for(const Ut of e)assert(typeof Ut=="string","All expected entries have to be of type string"),kTypes.includes(Ut)?xt.push(Ut.toLowerCase()):classRegExp.test(Ut)?kt.push(Ut):(assert(Ut!=="object",'The value "object" should be written as "Object"'),Bt.push(Ut));if(kt.length>0){const Ut=xt.indexOf("object");Ut!==-1&&(xt.splice(xt,Ut,1),kt.push("Object"))}if(xt.length>0){switch(xt.length){case 1:At+=`of type ${xt[0]}`;break;case 2:At+=`one of type ${xt[0]} or ${xt[1]}`;break;default:{const Ut=xt.pop();At+=`one of type ${xt.join(", ")}, or ${Ut}`}}(kt.length>0||Bt.length>0)&&(At+=" or ")}if(kt.length>0){switch(kt.length){case 1:At+=`an instance of ${kt[0]}`;break;case 2:At+=`an instance of ${kt[0]} or ${kt[1]}`;break;default:{const Ut=kt.pop();At+=`an instance of ${kt.join(", ")}, or ${Ut}`}}Bt.length>0&&(At+=" or ")}switch(Bt.length){case 0:break;case 1:Bt[0].toLowerCase()!==Bt[0]&&(At+="an "),At+=`${Bt[0]}`;break;case 2:At+=`one of ${Bt[0]} or ${Bt[1]}`;break;default:{const Ut=Bt.pop();At+=`one of ${Bt.join(", ")}, or ${Ut}`}}if(_t==null)At+=`. Received ${_t}`;else if(typeof _t=="function"&&_t.name)At+=`. Received function ${_t.name}`;else if(typeof _t=="object"){var Nt;if((Nt=_t.constructor)!==null&&Nt!==void 0&&Nt.name)At+=`. Received an instance of ${_t.constructor.name}`;else{const Ut=inspect$1(_t,{depth:-1});At+=`. Received ${Ut}`}}else{let Ut=inspect$1(_t,{colors:!1});Ut.length>25&&(Ut=`${Ut.slice(0,25)}...`),At+=`. Received type ${typeof _t} (${Ut})`}return At},TypeError);E("ERR_INVALID_ARG_VALUE",($t,e,_t="is invalid")=>{let At=inspect$1(e);return At.length>128&&(At=At.slice(0,128)+"..."),`The ${$t.includes(".")?"property":"argument"} '${$t}' ${_t}. Received ${At}`},TypeError);E("ERR_INVALID_RETURN_VALUE",($t,e,_t)=>{var At;const xt=_t!=null&&(At=_t.constructor)!==null&&At!==void 0&&At.name?`instance of ${_t.constructor.name}`:`type ${typeof _t}`;return`Expected ${$t} to be returned from the "${e}" function but got ${xt}.`},TypeError);E("ERR_MISSING_ARGS",(...$t)=>{assert($t.length>0,"At least one arg needs to be specified");let e;const _t=$t.length;switch($t=(Array.isArray($t)?$t:[$t]).map(At=>`"${At}"`).join(" or "),_t){case 1:e+=`The ${$t[0]} argument`;break;case 2:e+=`The ${$t[0]} and ${$t[1]} arguments`;break;default:{const At=$t.pop();e+=`The ${$t.join(", ")}, and ${At} arguments`}break}return`${e} must be specified`},TypeError);E("ERR_OUT_OF_RANGE",($t,e,_t)=>{assert(e,'Missing "range" argument');let At;return Number.isInteger(_t)&&Math.abs(_t)>2**32?At=addNumericalSeparator(String(_t)):typeof _t=="bigint"?(At=String(_t),(_t>2n**32n||_t<-(2n**32n))&&(At=addNumericalSeparator(At)),At+="n"):At=inspect$1(_t),`The value of "${$t}" is out of range. It must be ${e}. Received ${At}`},RangeError);E("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);E("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);E("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);E("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);E("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);E("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);E("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);E("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);E("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);E("ERR_STREAM_WRITE_AFTER_END","write after end",Error);E("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var errors={AbortError:AbortError$8,aggregateTwoErrors:hideStackFrames$1(aggregateTwoErrors$2),hideStackFrames:hideStackFrames$1,codes:codes$1};const{ArrayIsArray:ArrayIsArray$2,ArrayPrototypeIncludes,ArrayPrototypeJoin,ArrayPrototypeMap,NumberIsInteger:NumberIsInteger$1,NumberIsNaN:NumberIsNaN$1,NumberMAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER,NumberParseInt,ObjectPrototypeHasOwnProperty,RegExpPrototypeExec,String:String$1,StringPrototypeToUpperCase,StringPrototypeTrim}=primordials,{hideStackFrames,codes:{ERR_SOCKET_BAD_PORT,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$5,ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$3,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$1,ERR_UNKNOWN_SIGNAL}}=errors,{normalizeEncoding}=utilExports,{isAsyncFunction,isArrayBufferView}=utilExports.types,signals={};function isInt32($t){return $t===($t|0)}function isUint32($t){return $t===$t>>>0}const octalReg=/^[0-7]+$/,modeDesc="must be a 32-bit unsigned integer or an octal string";function parseFileMode($t,e,_t){if(typeof $t>"u"&&($t=_t),typeof $t=="string"){if(RegExpPrototypeExec(octalReg,$t)===null)throw new ERR_INVALID_ARG_VALUE$3(e,$t,modeDesc);$t=NumberParseInt($t,8)}return validateUint32($t,e),$t}const validateInteger$1=hideStackFrames(($t,e,_t=NumberMIN_SAFE_INTEGER,At=NumberMAX_SAFE_INTEGER)=>{if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",$t);if(!NumberIsInteger$1($t))throw new ERR_OUT_OF_RANGE$1(e,"an integer",$t);if($t<_t||$t>At)throw new ERR_OUT_OF_RANGE$1(e,`>= ${_t} && <= ${At}`,$t)}),validateInt32=hideStackFrames(($t,e,_t=-2147483648,At=2147483647)=>{if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",$t);if(!NumberIsInteger$1($t))throw new ERR_OUT_OF_RANGE$1(e,"an integer",$t);if($t<_t||$t>At)throw new ERR_OUT_OF_RANGE$1(e,`>= ${_t} && <= ${At}`,$t)}),validateUint32=hideStackFrames(($t,e,_t=!1)=>{if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",$t);if(!NumberIsInteger$1($t))throw new ERR_OUT_OF_RANGE$1(e,"an integer",$t);const At=_t?1:0,xt=4294967295;if($t<At||$t>xt)throw new ERR_OUT_OF_RANGE$1(e,`>= ${At} && <= ${xt}`,$t)});function validateString($t,e){if(typeof $t!="string")throw new ERR_INVALID_ARG_TYPE$5(e,"string",$t)}function validateNumber($t,e,_t=void 0,At){if(typeof $t!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",$t);if(_t!=null&&$t<_t||At!=null&&$t>At||(_t!=null||At!=null)&&NumberIsNaN$1($t))throw new ERR_OUT_OF_RANGE$1(e,`${_t!=null?`>= ${_t}`:""}${_t!=null&&At!=null?" && ":""}${At!=null?`<= ${At}`:""}`,$t)}const validateOneOf=hideStackFrames(($t,e,_t)=>{if(!ArrayPrototypeIncludes(_t,$t)){const xt="must be one of: "+ArrayPrototypeJoin(ArrayPrototypeMap(_t,kt=>typeof kt=="string"?`'${kt}'`:String$1(kt)),", ");throw new ERR_INVALID_ARG_VALUE$3(e,$t,xt)}});function validateBoolean$1($t,e){if(typeof $t!="boolean")throw new ERR_INVALID_ARG_TYPE$5(e,"boolean",$t)}function getOwnPropertyValueOrDefault($t,e,_t){return $t==null||!ObjectPrototypeHasOwnProperty($t,e)?_t:$t[e]}const validateObject$3=hideStackFrames(($t,e,_t=null)=>{const At=getOwnPropertyValueOrDefault(_t,"allowArray",!1),xt=getOwnPropertyValueOrDefault(_t,"allowFunction",!1);if(!getOwnPropertyValueOrDefault(_t,"nullable",!1)&&$t===null||!At&&ArrayIsArray$2($t)||typeof $t!="object"&&(!xt||typeof $t!="function"))throw new ERR_INVALID_ARG_TYPE$5(e,"Object",$t)}),validateDictionary=hideStackFrames(($t,e)=>{if($t!=null&&typeof $t!="object"&&typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$5(e,"a dictionary",$t)}),validateArray=hideStackFrames(($t,e,_t=0)=>{if(!ArrayIsArray$2($t))throw new ERR_INVALID_ARG_TYPE$5(e,"Array",$t);if($t.length<_t){const At=`must be longer than ${_t}`;throw new ERR_INVALID_ARG_VALUE$3(e,$t,At)}});function validateStringArray($t,e){validateArray($t,e);for(let _t=0;_t<$t.length;_t++)validateString($t[_t],`${e}[${_t}]`)}function validateBooleanArray($t,e){validateArray($t,e);for(let _t=0;_t<$t.length;_t++)validateBoolean$1($t[_t],`${e}[${_t}]`)}function validateSignalName($t,e="signal"){if(validateString($t,e),signals[$t]===void 0)throw signals[StringPrototypeToUpperCase($t)]!==void 0?new ERR_UNKNOWN_SIGNAL($t+" (signals must use all capital letters)"):new ERR_UNKNOWN_SIGNAL($t)}const validateBuffer=hideStackFrames(($t,e="buffer")=>{if(!isArrayBufferView($t))throw new ERR_INVALID_ARG_TYPE$5(e,["Buffer","TypedArray","DataView"],$t)});function validateEncoding($t,e){const _t=normalizeEncoding(e),At=$t.length;if(_t==="hex"&&At%2!==0)throw new ERR_INVALID_ARG_VALUE$3("encoding",e,`is invalid for data of length ${At}`)}function validatePort($t,e="Port",_t=!0){if(typeof $t!="number"&&typeof $t!="string"||typeof $t=="string"&&StringPrototypeTrim($t).length===0||+$t!==+$t>>>0||$t>65535||$t===0&&!_t)throw new ERR_SOCKET_BAD_PORT(e,$t,_t);return $t|0}const validateAbortSignal$3=hideStackFrames(($t,e)=>{if($t!==void 0&&($t===null||typeof $t!="object"||!("aborted"in $t)))throw new ERR_INVALID_ARG_TYPE$5(e,"AbortSignal",$t)}),validateFunction$2=hideStackFrames(($t,e)=>{if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$5(e,"Function",$t)}),validatePlainFunction=hideStackFrames(($t,e)=>{if(typeof $t!="function"||isAsyncFunction($t))throw new ERR_INVALID_ARG_TYPE$5(e,"Function",$t)}),validateUndefined=hideStackFrames(($t,e)=>{if($t!==void 0)throw new ERR_INVALID_ARG_TYPE$5(e,"undefined",$t)});function validateUnion($t,e,_t){if(!ArrayPrototypeIncludes(_t,$t))throw new ERR_INVALID_ARG_TYPE$5(e,`('${ArrayPrototypeJoin(_t,"|")}')`,$t)}const linkValueRegExp=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function validateLinkHeaderFormat($t,e){if(typeof $t>"u"||!RegExpPrototypeExec(linkValueRegExp,$t))throw new ERR_INVALID_ARG_VALUE$3(e,$t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function validateLinkHeaderValue($t){if(typeof $t=="string")return validateLinkHeaderFormat($t,"hints"),$t;if(ArrayIsArray$2($t)){const e=$t.length;let _t="";if(e===0)return _t;for(let At=0;At<e;At++){const xt=$t[At];validateLinkHeaderFormat(xt,"hints"),_t+=xt,At!==e-1&&(_t+=", ")}return _t}throw new ERR_INVALID_ARG_VALUE$3("hints",$t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var validators={isInt32,isUint32,parseFileMode,validateArray,validateStringArray,validateBooleanArray,validateBoolean:validateBoolean$1,validateBuffer,validateDictionary,validateEncoding,validateFunction:validateFunction$2,validateInt32,validateInteger:validateInteger$1,validateNumber,validateObject:validateObject$3,validateOneOf,validatePlainFunction,validatePort,validateSignalName,validateString,validateUint32,validateUndefined,validateUnion,validateAbortSignal:validateAbortSignal$3,validateLinkHeaderValue},endOfStream={exports:{}};const{Symbol:Symbol$4,SymbolAsyncIterator:SymbolAsyncIterator$2,SymbolIterator:SymbolIterator$2,SymbolFor}=primordials,kDestroyed$1=Symbol$4("kDestroyed"),kIsErrored=Symbol$4("kIsErrored"),kIsReadable=Symbol$4("kIsReadable"),kIsDisturbed=Symbol$4("kIsDisturbed"),kIsClosedPromise$1=SymbolFor("nodejs.webstream.isClosedPromise"),kControllerErrorFunction=SymbolFor("nodejs.webstream.controllerErrorFunction");function isReadableNodeStream$2($t,e=!1){var _t;return!!($t&&typeof $t.pipe=="function"&&typeof $t.on=="function"&&(!e||typeof $t.pause=="function"&&typeof $t.resume=="function")&&(!$t._writableState||((_t=$t._readableState)===null||_t===void 0?void 0:_t.readable)!==!1)&&(!$t._writableState||$t._readableState))}function isWritableNodeStream$1($t){var e;return!!($t&&typeof $t.write=="function"&&typeof $t.on=="function"&&(!$t._readableState||((e=$t._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function isDuplexNodeStream($t){return!!($t&&typeof $t.pipe=="function"&&$t._readableState&&typeof $t.on=="function"&&typeof $t.write=="function")}function isNodeStream$4($t){return $t&&($t._readableState||$t._writableState||typeof $t.write=="function"&&typeof $t.on=="function"||typeof $t.pipe=="function"&&typeof $t.on=="function")}function isReadableStream$3($t){return!!($t&&!isNodeStream$4($t)&&typeof $t.pipeThrough=="function"&&typeof $t.getReader=="function"&&typeof $t.cancel=="function")}function isWritableStream$2($t){return!!($t&&!isNodeStream$4($t)&&typeof $t.getWriter=="function"&&typeof $t.abort=="function")}function isTransformStream$2($t){return!!($t&&!isNodeStream$4($t)&&typeof $t.readable=="object"&&typeof $t.writable=="object")}function isWebStream$2($t){return isReadableStream$3($t)||isWritableStream$2($t)||isTransformStream$2($t)}function isIterable$2($t,e){return $t==null?!1:e===!0?typeof $t[SymbolAsyncIterator$2]=="function":e===!1?typeof $t[SymbolIterator$2]=="function":typeof $t[SymbolAsyncIterator$2]=="function"||typeof $t[SymbolIterator$2]=="function"}function isDestroyed$1($t){if(!isNodeStream$4($t))return null;const e=$t._writableState,_t=$t._readableState,At=e||_t;return!!($t.destroyed||$t[kDestroyed$1]||At!=null&&At.destroyed)}function isWritableEnded($t){if(!isWritableNodeStream$1($t))return null;if($t.writableEnded===!0)return!0;const e=$t._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isWritableFinished$1($t,e){if(!isWritableNodeStream$1($t))return null;if($t.writableFinished===!0)return!0;const _t=$t._writableState;return _t!=null&&_t.errored?!1:typeof(_t==null?void 0:_t.finished)!="boolean"?null:!!(_t.finished||e===!1&&_t.ended===!0&&_t.length===0)}function isReadableEnded$1($t){if(!isReadableNodeStream$2($t))return null;if($t.readableEnded===!0)return!0;const e=$t._readableState;return!e||e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isReadableFinished$1($t,e){if(!isReadableNodeStream$2($t))return null;const _t=$t._readableState;return _t!=null&&_t.errored?!1:typeof(_t==null?void 0:_t.endEmitted)!="boolean"?null:!!(_t.endEmitted||e===!1&&_t.ended===!0&&_t.length===0)}function isReadable$3($t){return $t&&$t[kIsReadable]!=null?$t[kIsReadable]:typeof($t==null?void 0:$t.readable)!="boolean"?null:isDestroyed$1($t)?!1:isReadableNodeStream$2($t)&&$t.readable&&!isReadableFinished$1($t)}function isWritable$3($t){return typeof($t==null?void 0:$t.writable)!="boolean"?null:isDestroyed$1($t)?!1:isWritableNodeStream$1($t)&&$t.writable&&!isWritableEnded($t)}function isFinished$1($t,e){return isNodeStream$4($t)?isDestroyed$1($t)?!0:!((e==null?void 0:e.readable)!==!1&&isReadable$3($t)||(e==null?void 0:e.writable)!==!1&&isWritable$3($t)):null}function isWritableErrored$1($t){var e,_t;return isNodeStream$4($t)?$t.writableErrored?$t.writableErrored:(e=(_t=$t._writableState)===null||_t===void 0?void 0:_t.errored)!==null&&e!==void 0?e:null:null}function isReadableErrored$1($t){var e,_t;return isNodeStream$4($t)?$t.readableErrored?$t.readableErrored:(e=(_t=$t._readableState)===null||_t===void 0?void 0:_t.errored)!==null&&e!==void 0?e:null:null}function isClosed$1($t){if(!isNodeStream$4($t))return null;if(typeof $t.closed=="boolean")return $t.closed;const e=$t._writableState,_t=$t._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(_t==null?void 0:_t.closed)=="boolean"?(e==null?void 0:e.closed)||(_t==null?void 0:_t.closed):typeof $t._closed=="boolean"&&isOutgoingMessage($t)?$t._closed:null}function isOutgoingMessage($t){return typeof $t._closed=="boolean"&&typeof $t._defaultKeepAlive=="boolean"&&typeof $t._removedConnection=="boolean"&&typeof $t._removedContLen=="boolean"}function isServerResponse($t){return typeof $t._sent100=="boolean"&&isOutgoingMessage($t)}function isServerRequest$1($t){var e;return typeof $t._consuming=="boolean"&&typeof $t._dumped=="boolean"&&((e=$t.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function willEmitClose($t){if(!isNodeStream$4($t))return null;const e=$t._writableState,_t=$t._readableState,At=e||_t;return!At&&isServerResponse($t)||!!(At&&At.autoDestroy&&At.emitClose&&At.closed===!1)}function isDisturbed($t){var e;return!!($t&&((e=$t[kIsDisturbed])!==null&&e!==void 0?e:$t.readableDidRead||$t.readableAborted))}function isErrored($t){var e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt;return!!($t&&((e=(_t=(At=(xt=(kt=(Bt=$t[kIsErrored])!==null&&Bt!==void 0?Bt:$t.readableErrored)!==null&&kt!==void 0?kt:$t.writableErrored)!==null&&xt!==void 0?xt:(Nt=$t._readableState)===null||Nt===void 0?void 0:Nt.errorEmitted)!==null&&At!==void 0?At:(Ut=$t._writableState)===null||Ut===void 0?void 0:Ut.errorEmitted)!==null&&_t!==void 0?_t:(Lt=$t._readableState)===null||Lt===void 0?void 0:Lt.errored)!==null&&e!==void 0?e:!((jt=$t._writableState)===null||jt===void 0)&&jt.errored))}var utils$1={kDestroyed:kDestroyed$1,isDisturbed,kIsDisturbed,isErrored,kIsErrored,isReadable:isReadable$3,kIsReadable,kIsClosedPromise:kIsClosedPromise$1,kControllerErrorFunction,isClosed:isClosed$1,isDestroyed:isDestroyed$1,isDuplexNodeStream,isFinished:isFinished$1,isIterable:isIterable$2,isReadableNodeStream:isReadableNodeStream$2,isReadableStream:isReadableStream$3,isReadableEnded:isReadableEnded$1,isReadableFinished:isReadableFinished$1,isReadableErrored:isReadableErrored$1,isNodeStream:isNodeStream$4,isWebStream:isWebStream$2,isWritable:isWritable$3,isWritableNodeStream:isWritableNodeStream$1,isWritableStream:isWritableStream$2,isWritableEnded,isWritableFinished:isWritableFinished$1,isWritableErrored:isWritableErrored$1,isServerRequest:isServerRequest$1,isServerResponse,willEmitClose,isTransformStream:isTransformStream$2};const process$3=browserExports$3,{AbortError:AbortError$7,codes}=errors,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$4,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$1}=codes,{kEmptyObject,once:once$1}=utilExports,{validateAbortSignal:validateAbortSignal$2,validateFunction:validateFunction$1,validateObject:validateObject$2,validateBoolean}=validators,{Promise:Promise$3,PromisePrototypeThen:PromisePrototypeThen$2}=primordials,{isClosed,isReadable:isReadable$2,isReadableNodeStream:isReadableNodeStream$1,isReadableStream:isReadableStream$2,isReadableFinished,isReadableErrored,isWritable:isWritable$2,isWritableNodeStream,isWritableStream:isWritableStream$1,isWritableFinished,isWritableErrored,isNodeStream:isNodeStream$3,willEmitClose:_willEmitClose,kIsClosedPromise}=utils$1;function isRequest$1($t){return $t.setHeader&&typeof $t.abort=="function"}const nop=()=>{};function eos$2($t,e,_t){var At,xt;if(arguments.length===2?(_t=e,e=kEmptyObject):e==null?e=kEmptyObject:validateObject$2(e,"options"),validateFunction$1(_t,"callback"),validateAbortSignal$2(e.signal,"options.signal"),_t=once$1(_t),isReadableStream$2($t)||isWritableStream$1($t))return eosWeb($t,e,_t);if(!isNodeStream$3($t))throw new ERR_INVALID_ARG_TYPE$4("stream",["ReadableStream","WritableStream","Stream"],$t);const kt=(At=e.readable)!==null&&At!==void 0?At:isReadableNodeStream$1($t),Bt=(xt=e.writable)!==null&&xt!==void 0?xt:isWritableNodeStream($t),Nt=$t._writableState,Ut=$t._readableState,Lt=()=>{$t.writable||qt()};let jt=_willEmitClose($t)&&isReadableNodeStream$1($t)===kt&&isWritableNodeStream($t)===Bt,Kt=isWritableFinished($t,!1);const qt=()=>{Kt=!0,$t.destroyed&&(jt=!1),!(jt&&(!$t.readable||kt))&&(!kt||zt)&&_t.call($t)};let zt=isReadableFinished($t,!1);const Vt=()=>{zt=!0,$t.destroyed&&(jt=!1),!(jt&&(!$t.writable||Bt))&&(!Bt||Kt)&&_t.call($t)},Ht=dr=>{_t.call($t,dr)};let Wt=isClosed($t);const Qt=()=>{Wt=!0;const dr=isWritableErrored($t)||isReadableErrored($t);if(dr&&typeof dr!="boolean")return _t.call($t,dr);if(kt&&!zt&&isReadableNodeStream$1($t,!0)&&!isReadableFinished($t,!1))return _t.call($t,new ERR_STREAM_PREMATURE_CLOSE$1);if(Bt&&!Kt&&!isWritableFinished($t,!1))return _t.call($t,new ERR_STREAM_PREMATURE_CLOSE$1);_t.call($t)},Xt=()=>{Wt=!0;const dr=isWritableErrored($t)||isReadableErrored($t);if(dr&&typeof dr!="boolean")return _t.call($t,dr);_t.call($t)},Jt=()=>{$t.req.on("finish",qt)};isRequest$1($t)?($t.on("complete",qt),jt||$t.on("abort",Qt),$t.req?Jt():$t.on("request",Jt)):Bt&&!Nt&&($t.on("end",Lt),$t.on("close",Lt)),!jt&&typeof $t.aborted=="boolean"&&$t.on("aborted",Qt),$t.on("end",Vt),$t.on("finish",qt),e.error!==!1&&$t.on("error",Ht),$t.on("close",Qt),Wt?process$3.nextTick(Qt):Nt!=null&&Nt.errorEmitted||Ut!=null&&Ut.errorEmitted?jt||process$3.nextTick(Xt):(!kt&&(!jt||isReadable$2($t))&&(Kt||isWritable$2($t)===!1)||!Bt&&(!jt||isWritable$2($t))&&(zt||isReadable$2($t)===!1)||Ut&&$t.req&&$t.aborted)&&process$3.nextTick(Xt);const tr=()=>{_t=nop,$t.removeListener("aborted",Qt),$t.removeListener("complete",qt),$t.removeListener("abort",Qt),$t.removeListener("request",Jt),$t.req&&$t.req.removeListener("finish",qt),$t.removeListener("end",Lt),$t.removeListener("close",Lt),$t.removeListener("finish",qt),$t.removeListener("end",Vt),$t.removeListener("error",Ht),$t.removeListener("close",Qt)};if(e.signal&&!Wt){const dr=()=>{const vr=_t;tr(),vr.call($t,new AbortError$7(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)process$3.nextTick(dr);else{const vr=_t;_t=once$1((...$r)=>{e.signal.removeEventListener("abort",dr),vr.apply($t,$r)}),e.signal.addEventListener("abort",dr)}}return tr}function eosWeb($t,e,_t){let At=!1,xt=nop;if(e.signal)if(xt=()=>{At=!0,_t.call($t,new AbortError$7(void 0,{cause:e.signal.reason}))},e.signal.aborted)process$3.nextTick(xt);else{const Bt=_t;_t=once$1((...Nt)=>{e.signal.removeEventListener("abort",xt),Bt.apply($t,Nt)}),e.signal.addEventListener("abort",xt)}const kt=(...Bt)=>{At||process$3.nextTick(()=>_t.apply($t,Bt))};return PromisePrototypeThen$2($t[kIsClosedPromise].promise,kt,kt),nop}function finished$1($t,e){var _t;let At=!1;return e===null&&(e=kEmptyObject),(_t=e)!==null&&_t!==void 0&&_t.cleanup&&(validateBoolean(e.cleanup,"cleanup"),At=e.cleanup),new Promise$3((xt,kt)=>{const Bt=eos$2($t,e,Nt=>{At&&Bt(),Nt?kt(Nt):xt()})})}endOfStream.exports=eos$2;endOfStream.exports.finished=finished$1;var endOfStreamExports=endOfStream.exports;const process$2=browserExports$3,{aggregateTwoErrors:aggregateTwoErrors$1,codes:{ERR_MULTIPLE_CALLBACK},AbortError:AbortError$6}=errors,{Symbol:Symbol$3}=primordials,{kDestroyed,isDestroyed,isFinished,isServerRequest}=utils$1,kDestroy=Symbol$3("kDestroy"),kConstruct=Symbol$3("kConstruct");function checkError($t,e,_t){$t&&($t.stack,e&&!e.errored&&(e.errored=$t),_t&&!_t.errored&&(_t.errored=$t))}function destroy($t,e){const _t=this._readableState,At=this._writableState,xt=At||_t;return At!=null&&At.destroyed||_t!=null&&_t.destroyed?(typeof e=="function"&&e(),this):(checkError($t,At,_t),At&&(At.destroyed=!0),_t&&(_t.destroyed=!0),xt.constructed?_destroy(this,$t,e):this.once(kDestroy,function(kt){_destroy(this,aggregateTwoErrors$1(kt,$t),e)}),this)}function _destroy($t,e,_t){let At=!1;function xt(kt){if(At)return;At=!0;const Bt=$t._readableState,Nt=$t._writableState;checkError(kt,Nt,Bt),Nt&&(Nt.closed=!0),Bt&&(Bt.closed=!0),typeof _t=="function"&&_t(kt),kt?process$2.nextTick(emitErrorCloseNT,$t,kt):process$2.nextTick(emitCloseNT,$t)}try{$t._destroy(e||null,xt)}catch(kt){xt(kt)}}function emitErrorCloseNT($t,e){emitErrorNT($t,e),emitCloseNT($t)}function emitCloseNT($t){const e=$t._readableState,_t=$t._writableState;_t&&(_t.closeEmitted=!0),e&&(e.closeEmitted=!0),(_t!=null&&_t.emitClose||e!=null&&e.emitClose)&&$t.emit("close")}function emitErrorNT($t,e){const _t=$t._readableState,At=$t._writableState;At!=null&&At.errorEmitted||_t!=null&&_t.errorEmitted||(At&&(At.errorEmitted=!0),_t&&(_t.errorEmitted=!0),$t.emit("error",e))}function undestroy(){const $t=this._readableState,e=this._writableState;$t&&($t.constructed=!0,$t.closed=!1,$t.closeEmitted=!1,$t.destroyed=!1,$t.errored=null,$t.errorEmitted=!1,$t.reading=!1,$t.ended=$t.readable===!1,$t.endEmitted=$t.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function errorOrDestroy($t,e,_t){const At=$t._readableState,xt=$t._writableState;if(xt!=null&&xt.destroyed||At!=null&&At.destroyed)return this;At!=null&&At.autoDestroy||xt!=null&&xt.autoDestroy?$t.destroy(e):e&&(e.stack,xt&&!xt.errored&&(xt.errored=e),At&&!At.errored&&(At.errored=e),_t?process$2.nextTick(emitErrorNT,$t,e):emitErrorNT($t,e))}function construct($t,e){if(typeof $t._construct!="function")return;const _t=$t._readableState,At=$t._writableState;_t&&(_t.constructed=!1),At&&(At.constructed=!1),$t.once(kConstruct,e),!($t.listenerCount(kConstruct)>1)&&process$2.nextTick(constructNT,$t)}function constructNT($t){let e=!1;function _t(At){if(e){errorOrDestroy($t,At??new ERR_MULTIPLE_CALLBACK);return}e=!0;const xt=$t._readableState,kt=$t._writableState,Bt=kt||xt;xt&&(xt.constructed=!0),kt&&(kt.constructed=!0),Bt.destroyed?$t.emit(kDestroy,At):At?errorOrDestroy($t,At,!0):process$2.nextTick(emitConstructNT,$t)}try{$t._construct(At=>{process$2.nextTick(_t,At)})}catch(At){process$2.nextTick(_t,At)}}function emitConstructNT($t){$t.emit(kConstruct)}function isRequest($t){return($t==null?void 0:$t.setHeader)&&typeof $t.abort=="function"}function emitCloseLegacy($t){$t.emit("close")}function emitErrorCloseLegacy($t,e){$t.emit("error",e),process$2.nextTick(emitCloseLegacy,$t)}function destroyer$2($t,e){!$t||isDestroyed($t)||(!e&&!isFinished($t)&&(e=new AbortError$6),isServerRequest($t)?($t.socket=null,$t.destroy(e)):isRequest($t)?$t.abort():isRequest($t.req)?$t.req.abort():typeof $t.destroy=="function"?$t.destroy(e):typeof $t.close=="function"?$t.close():e?process$2.nextTick(emitErrorCloseLegacy,$t,e):process$2.nextTick(emitCloseLegacy,$t),$t.destroyed||($t[kDestroyed]=!0))}var destroy_1={construct,destroyer:destroyer$2,destroy,undestroy,errorOrDestroy};const{ArrayIsArray:ArrayIsArray$1,ObjectSetPrototypeOf:ObjectSetPrototypeOf$2}=primordials,{EventEmitter:EE}=eventsExports;function Stream$1($t){EE.call(this,$t)}ObjectSetPrototypeOf$2(Stream$1.prototype,EE.prototype);ObjectSetPrototypeOf$2(Stream$1,EE);Stream$1.prototype.pipe=function($t,e){const _t=this;function At(jt){$t.writable&&$t.write(jt)===!1&&_t.pause&&_t.pause()}_t.on("data",At);function xt(){_t.readable&&_t.resume&&_t.resume()}$t.on("drain",xt),!$t._isStdio&&(!e||e.end!==!1)&&(_t.on("end",Bt),_t.on("close",Nt));let kt=!1;function Bt(){kt||(kt=!0,$t.end())}function Nt(){kt||(kt=!0,typeof $t.destroy=="function"&&$t.destroy())}function Ut(jt){Lt(),EE.listenerCount(this,"error")===0&&this.emit("error",jt)}prependListener(_t,"error",Ut),prependListener($t,"error",Ut);function Lt(){_t.removeListener("data",At),$t.removeListener("drain",xt),_t.removeListener("end",Bt),_t.removeListener("close",Nt),_t.removeListener("error",Ut),$t.removeListener("error",Ut),_t.removeListener("end",Lt),_t.removeListener("close",Lt),$t.removeListener("close",Lt)}return _t.on("end",Lt),_t.on("close",Lt),$t.on("close",Lt),$t.emit("pipe",_t),$t};function prependListener($t,e,_t){if(typeof $t.prependListener=="function")return $t.prependListener(e,_t);!$t._events||!$t._events[e]?$t.on(e,_t):ArrayIsArray$1($t._events[e])?$t._events[e].unshift(_t):$t._events[e]=[_t,$t._events[e]]}var legacy={Stream:Stream$1,prependListener},addAbortSignal={exports:{}};(function($t){const{AbortError:e,codes:_t}=errors,{isNodeStream:At,isWebStream:xt,kControllerErrorFunction:kt}=utils$1,Bt=endOfStreamExports,{ERR_INVALID_ARG_TYPE:Nt}=_t,Ut=(Lt,jt)=>{if(typeof Lt!="object"||!("aborted"in Lt))throw new Nt(jt,"AbortSignal",Lt)};$t.exports.addAbortSignal=function(jt,Kt){if(Ut(jt,"signal"),!At(Kt)&&!xt(Kt))throw new Nt("stream",["ReadableStream","WritableStream","Stream"],Kt);return $t.exports.addAbortSignalNoValidate(jt,Kt)},$t.exports.addAbortSignalNoValidate=function(Lt,jt){if(typeof Lt!="object"||!("aborted"in Lt))return jt;const Kt=At(jt)?()=>{jt.destroy(new e(void 0,{cause:Lt.reason}))}:()=>{jt[kt](new e(void 0,{cause:Lt.reason}))};return Lt.aborted?Kt():(Lt.addEventListener("abort",Kt),Bt(jt,()=>Lt.removeEventListener("abort",Kt))),jt}})(addAbortSignal);var addAbortSignalExports=addAbortSignal.exports;const{StringPrototypeSlice,SymbolIterator:SymbolIterator$1,TypedArrayPrototypeSet,Uint8Array:Uint8Array$1}=primordials,{Buffer:Buffer$1}=buffer$2,{inspect}=utilExports;var buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const _t={data:e,next:null};this.length>0?this.tail.next=_t:this.head=_t,this.tail=_t,++this.length}unshift(e){const _t={data:e,next:this.head};this.length===0&&(this.tail=_t),this.head=_t,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let _t=this.head,At=""+_t.data;for(;(_t=_t.next)!==null;)At+=e+_t.data;return At}concat(e){if(this.length===0)return Buffer$1.alloc(0);const _t=Buffer$1.allocUnsafe(e>>>0);let At=this.head,xt=0;for(;At;)TypedArrayPrototypeSet(_t,At.data,xt),xt+=At.data.length,At=At.next;return _t}consume(e,_t){const At=this.head.data;if(e<At.length){const xt=At.slice(0,e);return this.head.data=At.slice(e),xt}return e===At.length?this.shift():_t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[SymbolIterator$1](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let _t="",At=this.head,xt=0;do{const kt=At.data;if(e>kt.length)_t+=kt,e-=kt.length;else{e===kt.length?(_t+=kt,++xt,At.next?this.head=At.next:this.head=this.tail=null):(_t+=StringPrototypeSlice(kt,0,e),this.head=At,At.data=StringPrototypeSlice(kt,e));break}++xt}while((At=At.next)!==null);return this.length-=xt,_t}_getBuffer(e){const _t=Buffer$1.allocUnsafe(e),At=e;let xt=this.head,kt=0;do{const Bt=xt.data;if(e>Bt.length)TypedArrayPrototypeSet(_t,Bt,At-e),e-=Bt.length;else{e===Bt.length?(TypedArrayPrototypeSet(_t,Bt,At-e),++kt,xt.next?this.head=xt.next:this.head=this.tail=null):(TypedArrayPrototypeSet(_t,new Uint8Array$1(Bt.buffer,Bt.byteOffset,e),At-e),this.head=xt,xt.data=Bt.slice(e));break}++kt}while((xt=xt.next)!==null);return this.length-=kt,_t}[Symbol.for("nodejs.util.inspect.custom")](e,_t){return inspect(this,{..._t,depth:0,customInspect:!1})}};const{MathFloor:MathFloor$1,NumberIsInteger}=primordials,{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$2}=errors.codes;function highWaterMarkFrom($t,e,_t){return $t.highWaterMark!=null?$t.highWaterMark:e?$t[_t]:null}function getDefaultHighWaterMark($t){return $t?16:16*1024}function getHighWaterMark$1($t,e,_t,At){const xt=highWaterMarkFrom(e,At,_t);if(xt!=null){if(!NumberIsInteger(xt)||xt<0){const kt=At?`options.${_t}`:"options.highWaterMark";throw new ERR_INVALID_ARG_VALUE$2(kt,xt)}return MathFloor$1(xt)}return getDefaultHighWaterMark($t.objectMode)}var state={getHighWaterMark:getHighWaterMark$1,getDefaultHighWaterMark};const process$1=browserExports$3,{PromisePrototypeThen:PromisePrototypeThen$1,SymbolAsyncIterator:SymbolAsyncIterator$1,SymbolIterator}=primordials,{Buffer}=buffer$2,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$3,ERR_STREAM_NULL_VALUES}=errors.codes;function from$1($t,e,_t){let At;if(typeof e=="string"||e instanceof Buffer)return new $t({objectMode:!0,..._t,read(){this.push(e),this.push(null)}});let xt;if(e&&e[SymbolAsyncIterator$1])xt=!0,At=e[SymbolAsyncIterator$1]();else if(e&&e[SymbolIterator])xt=!1,At=e[SymbolIterator]();else throw new ERR_INVALID_ARG_TYPE$3("iterable",["Iterable"],e);const kt=new $t({objectMode:!0,highWaterMark:1,..._t});let Bt=!1;kt._read=function(){Bt||(Bt=!0,Ut())},kt._destroy=function(Lt,jt){PromisePrototypeThen$1(Nt(Lt),()=>process$1.nextTick(jt,Lt),Kt=>process$1.nextTick(jt,Kt||Lt))};async function Nt(Lt){const jt=Lt!=null,Kt=typeof At.throw=="function";if(jt&&Kt){const{value:qt,done:zt}=await At.throw(Lt);if(await qt,zt)return}if(typeof At.return=="function"){const{value:qt}=await At.return();await qt}}async function Ut(){for(;;){try{const{value:Lt,done:jt}=xt?await At.next():At.next();if(jt)kt.push(null);else{const Kt=Lt&&typeof Lt.then=="function"?await Lt:Lt;if(Kt===null)throw Bt=!1,new ERR_STREAM_NULL_VALUES;if(kt.push(Kt))continue;Bt=!1}}catch(Lt){kt.destroy(Lt)}break}}return kt}var from_1=from$1,readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const $t=browserExports$3,{ArrayPrototypeIndexOf:e,NumberIsInteger:_t,NumberIsNaN:At,NumberParseInt:xt,ObjectDefineProperties:kt,ObjectKeys:Bt,ObjectSetPrototypeOf:Nt,Promise:Ut,SafeSet:Lt,SymbolAsyncIterator:jt,Symbol:Kt}=primordials;readable=nr,nr.ReadableState=ar;const{EventEmitter:qt}=eventsExports,{Stream:zt,prependListener:Vt}=legacy,{Buffer:Ht}=buffer$2,{addAbortSignal:Wt}=addAbortSignalExports,Qt=endOfStreamExports;let Xt=utilExports.debuglog("stream",Gr=>{Xt=Gr});const Jt=buffer_list,tr=destroy_1,{getHighWaterMark:dr,getDefaultHighWaterMark:vr}=state,{aggregateTwoErrors:$r,codes:{ERR_INVALID_ARG_TYPE:Ir,ERR_METHOD_NOT_IMPLEMENTED:Rr,ERR_OUT_OF_RANGE:Nr,ERR_STREAM_PUSH_AFTER_EOF:kr,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:lr}}=errors,{validateObject:ir}=validators,er=Kt("kPaused"),{StringDecoder:rr}=string_decoder,yr=from_1;Nt(nr.prototype,zt.prototype),Nt(nr,zt);const fr=()=>{},{errorOrDestroy:gr}=tr;function ar(Gr,Fr,en){typeof en!="boolean"&&(en=Fr instanceof requireDuplex()),this.objectMode=!!(Gr&&Gr.objectMode),en&&(this.objectMode=this.objectMode||!!(Gr&&Gr.readableObjectMode)),this.highWaterMark=Gr?dr(this,Gr,"readableHighWaterMark",en):vr(!1),this.buffer=new Jt,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[er]=null,this.errorEmitted=!1,this.emitClose=!Gr||Gr.emitClose!==!1,this.autoDestroy=!Gr||Gr.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=Gr&&Gr.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,Gr&&Gr.encoding&&(this.decoder=new rr(Gr.encoding),this.encoding=Gr.encoding)}function nr(Gr){if(!(this instanceof nr))return new nr(Gr);const Fr=this instanceof requireDuplex();this._readableState=new ar(Gr,this,Fr),Gr&&(typeof Gr.read=="function"&&(this._read=Gr.read),typeof Gr.destroy=="function"&&(this._destroy=Gr.destroy),typeof Gr.construct=="function"&&(this._construct=Gr.construct),Gr.signal&&!Fr&&Wt(Gr.signal,this)),zt.call(this,Gr),tr.construct(this,()=>{this._readableState.needReadable&&Mr(this,this._readableState)})}nr.prototype.destroy=tr.destroy,nr.prototype._undestroy=tr.undestroy,nr.prototype._destroy=function(Gr,Fr){Fr(Gr)},nr.prototype[qt.captureRejectionSymbol]=function(Gr){this.destroy(Gr)},nr.prototype.push=function(Gr,Fr){return ur(this,Gr,Fr,!1)},nr.prototype.unshift=function(Gr,Fr){return ur(this,Gr,Fr,!0)};function ur(Gr,Fr,en,nn){Xt("readableAddChunk",Fr);const rn=Gr._readableState;let hn;if(rn.objectMode||(typeof Fr=="string"?(en=en||rn.defaultEncoding,rn.encoding!==en&&(nn&&rn.encoding?Fr=Ht.from(Fr,en).toString(rn.encoding):(Fr=Ht.from(Fr,en),en=""))):Fr instanceof Ht?en="":zt._isUint8Array(Fr)?(Fr=zt._uint8ArrayToBuffer(Fr),en=""):Fr!=null&&(hn=new Ir("chunk",["string","Buffer","Uint8Array"],Fr))),hn)gr(Gr,hn);else if(Fr===null)rn.reading=!1,Tr(Gr,rn);else if(rn.objectMode||Fr&&Fr.length>0)if(nn)if(rn.endEmitted)gr(Gr,new lr);else{if(rn.destroyed||rn.errored)return!1;pr(Gr,rn,Fr,!0)}else if(rn.ended)gr(Gr,new kr);else{if(rn.destroyed||rn.errored)return!1;rn.reading=!1,rn.decoder&&!en?(Fr=rn.decoder.write(Fr),rn.objectMode||Fr.length!==0?pr(Gr,rn,Fr,!1):Mr(Gr,rn)):pr(Gr,rn,Fr,!1)}else nn||(rn.reading=!1,Mr(Gr,rn));return!rn.ended&&(rn.length<rn.highWaterMark||rn.length===0)}function pr(Gr,Fr,en,nn){Fr.flowing&&Fr.length===0&&!Fr.sync&&Gr.listenerCount("data")>0?(Fr.multiAwaitDrain?Fr.awaitDrainWriters.clear():Fr.awaitDrainWriters=null,Fr.dataEmitted=!0,Gr.emit("data",en)):(Fr.length+=Fr.objectMode?1:en.length,nn?Fr.buffer.unshift(en):Fr.buffer.push(en),Fr.needReadable&&wr(Gr)),Mr(Gr,Fr)}nr.prototype.isPaused=function(){const Gr=this._readableState;return Gr[er]===!0||Gr.flowing===!1},nr.prototype.setEncoding=function(Gr){const Fr=new rr(Gr);this._readableState.decoder=Fr,this._readableState.encoding=this._readableState.decoder.encoding;const en=this._readableState.buffer;let nn="";for(const rn of en)nn+=Fr.write(rn);return en.clear(),nn!==""&&en.push(nn),this._readableState.length=nn.length,this};const br=1073741824;function Sr(Gr){if(Gr>br)throw new Nr("size","<= 1GiB",Gr);return Gr--,Gr|=Gr>>>1,Gr|=Gr>>>2,Gr|=Gr>>>4,Gr|=Gr>>>8,Gr|=Gr>>>16,Gr++,Gr}function Pr(Gr,Fr){return Gr<=0||Fr.length===0&&Fr.ended?0:Fr.objectMode?1:At(Gr)?Fr.flowing&&Fr.length?Fr.buffer.first().length:Fr.length:Gr<=Fr.length?Gr:Fr.ended?Fr.length:0}nr.prototype.read=function(Gr){Xt("read",Gr),Gr===void 0?Gr=NaN:_t(Gr)||(Gr=xt(Gr,10));const Fr=this._readableState,en=Gr;if(Gr>Fr.highWaterMark&&(Fr.highWaterMark=Sr(Gr)),Gr!==0&&(Fr.emittedReadable=!1),Gr===0&&Fr.needReadable&&((Fr.highWaterMark!==0?Fr.length>=Fr.highWaterMark:Fr.length>0)||Fr.ended))return Xt("read: emitReadable",Fr.length,Fr.ended),Fr.length===0&&Fr.ended?Hr(this):wr(this),null;if(Gr=Pr(Gr,Fr),Gr===0&&Fr.ended)return Fr.length===0&&Hr(this),null;let nn=Fr.needReadable;if(Xt("need readable",nn),(Fr.length===0||Fr.length-Gr<Fr.highWaterMark)&&(nn=!0,Xt("length less than watermark",nn)),Fr.ended||Fr.reading||Fr.destroyed||Fr.errored||!Fr.constructed)nn=!1,Xt("reading, ended or constructing",nn);else if(nn){Xt("do read"),Fr.reading=!0,Fr.sync=!0,Fr.length===0&&(Fr.needReadable=!0);try{this._read(Fr.highWaterMark)}catch(hn){gr(this,hn)}Fr.sync=!1,Fr.reading||(Gr=Pr(en,Fr))}let rn;return Gr>0?rn=jr(Gr,Fr):rn=null,rn===null?(Fr.needReadable=Fr.length<=Fr.highWaterMark,Gr=0):(Fr.length-=Gr,Fr.multiAwaitDrain?Fr.awaitDrainWriters.clear():Fr.awaitDrainWriters=null),Fr.length===0&&(Fr.ended||(Fr.needReadable=!0),en!==Gr&&Fr.ended&&Hr(this)),rn!==null&&!Fr.errorEmitted&&!Fr.closeEmitted&&(Fr.dataEmitted=!0,this.emit("data",rn)),rn};function Tr(Gr,Fr){if(Xt("onEofChunk"),!Fr.ended){if(Fr.decoder){const en=Fr.decoder.end();en&&en.length&&(Fr.buffer.push(en),Fr.length+=Fr.objectMode?1:en.length)}Fr.ended=!0,Fr.sync?wr(Gr):(Fr.needReadable=!1,Fr.emittedReadable=!0,Ar(Gr))}}function wr(Gr){const Fr=Gr._readableState;Xt("emitReadable",Fr.needReadable,Fr.emittedReadable),Fr.needReadable=!1,Fr.emittedReadable||(Xt("emitReadable",Fr.flowing),Fr.emittedReadable=!0,$t.nextTick(Ar,Gr))}function Ar(Gr){const Fr=Gr._readableState;Xt("emitReadable_",Fr.destroyed,Fr.length,Fr.ended),!Fr.destroyed&&!Fr.errored&&(Fr.length||Fr.ended)&&(Gr.emit("readable"),Fr.emittedReadable=!1),Fr.needReadable=!Fr.flowing&&!Fr.ended&&Fr.length<=Fr.highWaterMark,xr(Gr)}function Mr(Gr,Fr){!Fr.readingMore&&Fr.constructed&&(Fr.readingMore=!0,$t.nextTick(Ur,Gr,Fr))}function Ur(Gr,Fr){for(;!Fr.reading&&!Fr.ended&&(Fr.length<Fr.highWaterMark||Fr.flowing&&Fr.length===0);){const en=Fr.length;if(Xt("maybeReadMore read 0"),Gr.read(0),en===Fr.length)break}Fr.readingMore=!1}nr.prototype._read=function(Gr){throw new Rr("_read()")},nr.prototype.pipe=function(Gr,Fr){const en=this,nn=this._readableState;nn.pipes.length===1&&(nn.multiAwaitDrain||(nn.multiAwaitDrain=!0,nn.awaitDrainWriters=new Lt(nn.awaitDrainWriters?[nn.awaitDrainWriters]:[]))),nn.pipes.push(Gr),Xt("pipe count=%d opts=%j",nn.pipes.length,Fr);const hn=(!Fr||Fr.end!==!1)&&Gr!==$t.stdout&&Gr!==$t.stderr?wn:Kn;nn.endEmitted?$t.nextTick(hn):en.once("end",hn),Gr.on("unpipe",yn);function yn(_n,jn){Xt("onunpipe"),_n===en&&jn&&jn.hasUnpiped===!1&&(jn.hasUnpiped=!0,Bn())}function wn(){Xt("onend"),Gr.end()}let mn,Mn=!1;function Bn(){Xt("cleanup"),Gr.removeListener("close",Dn),Gr.removeListener("finish",Ln),mn&&Gr.removeListener("drain",mn),Gr.removeListener("error",Un),Gr.removeListener("unpipe",yn),en.removeListener("end",wn),en.removeListener("end",Kn),en.removeListener("data",kn),Mn=!0,mn&&nn.awaitDrainWriters&&(!Gr._writableState||Gr._writableState.needDrain)&&mn()}function Sn(){Mn||(nn.pipes.length===1&&nn.pipes[0]===Gr?(Xt("false write response, pause",0),nn.awaitDrainWriters=Gr,nn.multiAwaitDrain=!1):nn.pipes.length>1&&nn.pipes.includes(Gr)&&(Xt("false write response, pause",nn.awaitDrainWriters.size),nn.awaitDrainWriters.add(Gr)),en.pause()),mn||(mn=Or(en,Gr),Gr.on("drain",mn))}en.on("data",kn);function kn(_n){Xt("ondata");const jn=Gr.write(_n);Xt("dest.write",jn),jn===!1&&Sn()}function Un(_n){if(Xt("onerror",_n),Kn(),Gr.removeListener("error",Un),Gr.listenerCount("error")===0){const jn=Gr._writableState||Gr._readableState;jn&&!jn.errorEmitted?gr(Gr,_n):Gr.emit("error",_n)}}Vt(Gr,"error",Un);function Dn(){Gr.removeListener("finish",Ln),Kn()}Gr.once("close",Dn);function Ln(){Xt("onfinish"),Gr.removeListener("close",Dn),Kn()}Gr.once("finish",Ln);function Kn(){Xt("unpipe"),en.unpipe(Gr)}return Gr.emit("pipe",en),Gr.writableNeedDrain===!0?nn.flowing&&Sn():nn.flowing||(Xt("pipe resume"),en.resume()),Gr};function Or(Gr,Fr){return function(){const nn=Gr._readableState;nn.awaitDrainWriters===Fr?(Xt("pipeOnDrain",1),nn.awaitDrainWriters=null):nn.multiAwaitDrain&&(Xt("pipeOnDrain",nn.awaitDrainWriters.size),nn.awaitDrainWriters.delete(Fr)),(!nn.awaitDrainWriters||nn.awaitDrainWriters.size===0)&&Gr.listenerCount("data")&&Gr.resume()}}nr.prototype.unpipe=function(Gr){const Fr=this._readableState,en={hasUnpiped:!1};if(Fr.pipes.length===0)return this;if(!Gr){const rn=Fr.pipes;Fr.pipes=[],this.pause();for(let hn=0;hn<rn.length;hn++)rn[hn].emit("unpipe",this,{hasUnpiped:!1});return this}const nn=e(Fr.pipes,Gr);return nn===-1?this:(Fr.pipes.splice(nn,1),Fr.pipes.length===0&&this.pause(),Gr.emit("unpipe",this,en),this)},nr.prototype.on=function(Gr,Fr){const en=zt.prototype.on.call(this,Gr,Fr),nn=this._readableState;return Gr==="data"?(nn.readableListening=this.listenerCount("readable")>0,nn.flowing!==!1&&this.resume()):Gr==="readable"&&!nn.endEmitted&&!nn.readableListening&&(nn.readableListening=nn.needReadable=!0,nn.flowing=!1,nn.emittedReadable=!1,Xt("on readable",nn.length,nn.reading),nn.length?wr(this):nn.reading||$t.nextTick(Er,this)),en},nr.prototype.addListener=nr.prototype.on,nr.prototype.removeListener=function(Gr,Fr){const en=zt.prototype.removeListener.call(this,Gr,Fr);return Gr==="readable"&&$t.nextTick(Cr,this),en},nr.prototype.off=nr.prototype.removeListener,nr.prototype.removeAllListeners=function(Gr){const Fr=zt.prototype.removeAllListeners.apply(this,arguments);return(Gr==="readable"||Gr===void 0)&&$t.nextTick(Cr,this),Fr};function Cr(Gr){const Fr=Gr._readableState;Fr.readableListening=Gr.listenerCount("readable")>0,Fr.resumeScheduled&&Fr[er]===!1?Fr.flowing=!0:Gr.listenerCount("data")>0?Gr.resume():Fr.readableListening||(Fr.flowing=null)}function Er(Gr){Xt("readable nexttick read 0"),Gr.read(0)}nr.prototype.resume=function(){const Gr=this._readableState;return Gr.flowing||(Xt("resume"),Gr.flowing=!Gr.readableListening,Br(this,Gr)),Gr[er]=!1,this};function Br(Gr,Fr){Fr.resumeScheduled||(Fr.resumeScheduled=!0,$t.nextTick(Lr,Gr,Fr))}function Lr(Gr,Fr){Xt("resume",Fr.reading),Fr.reading||Gr.read(0),Fr.resumeScheduled=!1,Gr.emit("resume"),xr(Gr),Fr.flowing&&!Fr.reading&&Gr.read(0)}nr.prototype.pause=function(){return Xt("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Xt("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[er]=!0,this};function xr(Gr){const Fr=Gr._readableState;for(Xt("flow",Fr.flowing);Fr.flowing&&Gr.read()!==null;);}nr.prototype.wrap=function(Gr){let Fr=!1;Gr.on("data",nn=>{!this.push(nn)&&Gr.pause&&(Fr=!0,Gr.pause())}),Gr.on("end",()=>{this.push(null)}),Gr.on("error",nn=>{gr(this,nn)}),Gr.on("close",()=>{this.destroy()}),Gr.on("destroy",()=>{this.destroy()}),this._read=()=>{Fr&&Gr.resume&&(Fr=!1,Gr.resume())};const en=Bt(Gr);for(let nn=1;nn<en.length;nn++){const rn=en[nn];this[rn]===void 0&&typeof Gr[rn]=="function"&&(this[rn]=Gr[rn].bind(Gr))}return this},nr.prototype[jt]=function(){return _r(this)},nr.prototype.iterator=function(Gr){return Gr!==void 0&&ir(Gr,"options"),_r(this,Gr)};function _r(Gr,Fr){typeof Gr.read!="function"&&(Gr=nr.wrap(Gr,{objectMode:!0}));const en=Dr(Gr,Fr);return en.stream=Gr,en}async function*Dr(Gr,Fr){let en=fr;function nn(yn){this===Gr?(en(),en=fr):en=yn}Gr.on("readable",nn);let rn;const hn=Qt(Gr,{writable:!1},yn=>{rn=yn?$r(rn,yn):null,en(),en=fr});try{for(;;){const yn=Gr.destroyed?null:Gr.read();if(yn!==null)yield yn;else{if(rn)throw rn;if(rn===null)return;await new Ut(nn)}}}catch(yn){throw rn=$r(rn,yn),rn}finally{(rn||(Fr==null?void 0:Fr.destroyOnReturn)!==!1)&&(rn===void 0||Gr._readableState.autoDestroy)?tr.destroyer(Gr,null):(Gr.off("readable",nn),hn())}}kt(nr.prototype,{readable:{__proto__:null,get(){const Gr=this._readableState;return!!Gr&&Gr.readable!==!1&&!Gr.destroyed&&!Gr.errorEmitted&&!Gr.endEmitted},set(Gr){this._readableState&&(this._readableState.readable=!!Gr)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(Gr){this._readableState&&(this._readableState.flowing=Gr)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(Gr){this._readableState&&(this._readableState.destroyed=Gr)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),kt(ar.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[er]!==!1},set(Gr){this[er]=!!Gr}}}),nr._fromList=jr;function jr(Gr,Fr){if(Fr.length===0)return null;let en;return Fr.objectMode?en=Fr.buffer.shift():!Gr||Gr>=Fr.length?(Fr.decoder?en=Fr.buffer.join(""):Fr.buffer.length===1?en=Fr.buffer.first():en=Fr.buffer.concat(Fr.length),Fr.buffer.clear()):en=Fr.buffer.consume(Gr,Fr.decoder),en}function Hr(Gr){const Fr=Gr._readableState;Xt("endReadable",Fr.endEmitted),Fr.endEmitted||(Fr.ended=!0,$t.nextTick(Qr,Fr,Gr))}function Qr(Gr,Fr){if(Xt("endReadableNT",Gr.endEmitted,Gr.length),!Gr.errored&&!Gr.closeEmitted&&!Gr.endEmitted&&Gr.length===0){if(Gr.endEmitted=!0,Fr.emit("end"),Fr.writable&&Fr.allowHalfOpen===!1)$t.nextTick(Yr,Fr);else if(Gr.autoDestroy){const en=Fr._writableState;(!en||en.autoDestroy&&(en.finished||en.writable===!1))&&Fr.destroy()}}}function Yr(Gr){Gr.writable&&!Gr.writableEnded&&!Gr.destroyed&&Gr.end()}nr.from=function(Gr,Fr){return yr(nr,Gr,Fr)};let an;function cn(){return an===void 0&&(an={}),an}return nr.fromWeb=function(Gr,Fr){return cn().newStreamReadableFromReadableStream(Gr,Fr)},nr.toWeb=function(Gr,Fr){return cn().newReadableStreamFromStreamReadable(Gr,Fr)},nr.wrap=function(Gr,Fr){var en,nn;return new nr({objectMode:(en=(nn=Gr.readableObjectMode)!==null&&nn!==void 0?nn:Gr.objectMode)!==null&&en!==void 0?en:!0,...Fr,destroy(rn,hn){tr.destroyer(Gr,rn),hn(rn)}}).wrap(Gr)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const $t=browserExports$3,{ArrayPrototypeSlice:e,Error:_t,FunctionPrototypeSymbolHasInstance:At,ObjectDefineProperty:xt,ObjectDefineProperties:kt,ObjectSetPrototypeOf:Bt,StringPrototypeToLowerCase:Nt,Symbol:Ut,SymbolHasInstance:Lt}=primordials;writable=rr,rr.WritableState=ir;const{EventEmitter:jt}=eventsExports,Kt=legacy.Stream,{Buffer:qt}=buffer$2,zt=destroy_1,{addAbortSignal:Vt}=addAbortSignalExports,{getHighWaterMark:Ht,getDefaultHighWaterMark:Wt}=state,{ERR_INVALID_ARG_TYPE:Qt,ERR_METHOD_NOT_IMPLEMENTED:Xt,ERR_MULTIPLE_CALLBACK:Jt,ERR_STREAM_CANNOT_PIPE:tr,ERR_STREAM_DESTROYED:dr,ERR_STREAM_ALREADY_FINISHED:vr,ERR_STREAM_NULL_VALUES:$r,ERR_STREAM_WRITE_AFTER_END:Ir,ERR_UNKNOWN_ENCODING:Rr}=errors.codes,{errorOrDestroy:Nr}=zt;Bt(rr.prototype,Kt.prototype),Bt(rr,Kt);function kr(){}const lr=Ut("kOnFinished");function ir(Er,Br,Lr){typeof Lr!="boolean"&&(Lr=Br instanceof requireDuplex()),this.objectMode=!!(Er&&Er.objectMode),Lr&&(this.objectMode=this.objectMode||!!(Er&&Er.writableObjectMode)),this.highWaterMark=Er?Ht(this,Er,"writableHighWaterMark",Lr):Wt(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const xr=!!(Er&&Er.decodeStrings===!1);this.decodeStrings=!xr,this.defaultEncoding=Er&&Er.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=nr.bind(void 0,Br),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,er(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!Er||Er.emitClose!==!1,this.autoDestroy=!Er||Er.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[lr]=[]}function er(Er){Er.buffered=[],Er.bufferedIndex=0,Er.allBuffers=!0,Er.allNoop=!0}ir.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},xt(ir.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function rr(Er){const Br=this instanceof requireDuplex();if(!Br&&!At(rr,this))return new rr(Er);this._writableState=new ir(Er,this,Br),Er&&(typeof Er.write=="function"&&(this._write=Er.write),typeof Er.writev=="function"&&(this._writev=Er.writev),typeof Er.destroy=="function"&&(this._destroy=Er.destroy),typeof Er.final=="function"&&(this._final=Er.final),typeof Er.construct=="function"&&(this._construct=Er.construct),Er.signal&&Vt(Er.signal,this)),Kt.call(this,Er),zt.construct(this,()=>{const Lr=this._writableState;Lr.writing||Sr(this,Lr),Ar(this,Lr)})}xt(rr,Lt,{__proto__:null,value:function(Er){return At(this,Er)?!0:this!==rr?!1:Er&&Er._writableState instanceof ir}}),rr.prototype.pipe=function(){Nr(this,new tr)};function yr(Er,Br,Lr,xr){const _r=Er._writableState;if(typeof Lr=="function")xr=Lr,Lr=_r.defaultEncoding;else{if(!Lr)Lr=_r.defaultEncoding;else if(Lr!=="buffer"&&!qt.isEncoding(Lr))throw new Rr(Lr);typeof xr!="function"&&(xr=kr)}if(Br===null)throw new $r;if(!_r.objectMode)if(typeof Br=="string")_r.decodeStrings!==!1&&(Br=qt.from(Br,Lr),Lr="buffer");else if(Br instanceof qt)Lr="buffer";else if(Kt._isUint8Array(Br))Br=Kt._uint8ArrayToBuffer(Br),Lr="buffer";else throw new Qt("chunk",["string","Buffer","Uint8Array"],Br);let Dr;return _r.ending?Dr=new Ir:_r.destroyed&&(Dr=new dr("write")),Dr?($t.nextTick(xr,Dr),Nr(Er,Dr,!0),Dr):(_r.pendingcb++,fr(Er,_r,Br,Lr,xr))}rr.prototype.write=function(Er,Br,Lr){return yr(this,Er,Br,Lr)===!0},rr.prototype.cork=function(){this._writableState.corked++},rr.prototype.uncork=function(){const Er=this._writableState;Er.corked&&(Er.corked--,Er.writing||Sr(this,Er))},rr.prototype.setDefaultEncoding=function(Br){if(typeof Br=="string"&&(Br=Nt(Br)),!qt.isEncoding(Br))throw new Rr(Br);return this._writableState.defaultEncoding=Br,this};function fr(Er,Br,Lr,xr,_r){const Dr=Br.objectMode?1:Lr.length;Br.length+=Dr;const jr=Br.length<Br.highWaterMark;return jr||(Br.needDrain=!0),Br.writing||Br.corked||Br.errored||!Br.constructed?(Br.buffered.push({chunk:Lr,encoding:xr,callback:_r}),Br.allBuffers&&xr!=="buffer"&&(Br.allBuffers=!1),Br.allNoop&&_r!==kr&&(Br.allNoop=!1)):(Br.writelen=Dr,Br.writecb=_r,Br.writing=!0,Br.sync=!0,Er._write(Lr,xr,Br.onwrite),Br.sync=!1),jr&&!Br.errored&&!Br.destroyed}function gr(Er,Br,Lr,xr,_r,Dr,jr){Br.writelen=xr,Br.writecb=jr,Br.writing=!0,Br.sync=!0,Br.destroyed?Br.onwrite(new dr("write")):Lr?Er._writev(_r,Br.onwrite):Er._write(_r,Dr,Br.onwrite),Br.sync=!1}function ar(Er,Br,Lr,xr){--Br.pendingcb,xr(Lr),br(Br),Nr(Er,Lr)}function nr(Er,Br){const Lr=Er._writableState,xr=Lr.sync,_r=Lr.writecb;if(typeof _r!="function"){Nr(Er,new Jt);return}Lr.writing=!1,Lr.writecb=null,Lr.length-=Lr.writelen,Lr.writelen=0,Br?(Br.stack,Lr.errored||(Lr.errored=Br),Er._readableState&&!Er._readableState.errored&&(Er._readableState.errored=Br),xr?$t.nextTick(ar,Er,Lr,Br,_r):ar(Er,Lr,Br,_r)):(Lr.buffered.length>Lr.bufferedIndex&&Sr(Er,Lr),xr?Lr.afterWriteTickInfo!==null&&Lr.afterWriteTickInfo.cb===_r?Lr.afterWriteTickInfo.count++:(Lr.afterWriteTickInfo={count:1,cb:_r,stream:Er,state:Lr},$t.nextTick(ur,Lr.afterWriteTickInfo)):pr(Er,Lr,1,_r))}function ur({stream:Er,state:Br,count:Lr,cb:xr}){return Br.afterWriteTickInfo=null,pr(Er,Br,Lr,xr)}function pr(Er,Br,Lr,xr){for(!Br.ending&&!Er.destroyed&&Br.length===0&&Br.needDrain&&(Br.needDrain=!1,Er.emit("drain"));Lr-- >0;)Br.pendingcb--,xr();Br.destroyed&&br(Br),Ar(Er,Br)}function br(Er){if(Er.writing)return;for(let _r=Er.bufferedIndex;_r<Er.buffered.length;++_r){var Br;const{chunk:Dr,callback:jr}=Er.buffered[_r],Hr=Er.objectMode?1:Dr.length;Er.length-=Hr,jr((Br=Er.errored)!==null&&Br!==void 0?Br:new dr("write"))}const Lr=Er[lr].splice(0);for(let _r=0;_r<Lr.length;_r++){var xr;Lr[_r]((xr=Er.errored)!==null&&xr!==void 0?xr:new dr("end"))}er(Er)}function Sr(Er,Br){if(Br.corked||Br.bufferProcessing||Br.destroyed||!Br.constructed)return;const{buffered:Lr,bufferedIndex:xr,objectMode:_r}=Br,Dr=Lr.length-xr;if(!Dr)return;let jr=xr;if(Br.bufferProcessing=!0,Dr>1&&Er._writev){Br.pendingcb-=Dr-1;const Hr=Br.allNoop?kr:Yr=>{for(let an=jr;an<Lr.length;++an)Lr[an].callback(Yr)},Qr=Br.allNoop&&jr===0?Lr:e(Lr,jr);Qr.allBuffers=Br.allBuffers,gr(Er,Br,!0,Br.length,Qr,"",Hr),er(Br)}else{do{const{chunk:Hr,encoding:Qr,callback:Yr}=Lr[jr];Lr[jr++]=null;const an=_r?1:Hr.length;gr(Er,Br,!1,an,Hr,Qr,Yr)}while(jr<Lr.length&&!Br.writing);jr===Lr.length?er(Br):jr>256?(Lr.splice(0,jr),Br.bufferedIndex=0):Br.bufferedIndex=jr}Br.bufferProcessing=!1}rr.prototype._write=function(Er,Br,Lr){if(this._writev)this._writev([{chunk:Er,encoding:Br}],Lr);else throw new Xt("_write()")},rr.prototype._writev=null,rr.prototype.end=function(Er,Br,Lr){const xr=this._writableState;typeof Er=="function"?(Lr=Er,Er=null,Br=null):typeof Br=="function"&&(Lr=Br,Br=null);let _r;if(Er!=null){const Dr=yr(this,Er,Br);Dr instanceof _t&&(_r=Dr)}return xr.corked&&(xr.corked=1,this.uncork()),_r||(!xr.errored&&!xr.ending?(xr.ending=!0,Ar(this,xr,!0),xr.ended=!0):xr.finished?_r=new vr("end"):xr.destroyed&&(_r=new dr("end"))),typeof Lr=="function"&&(_r||xr.finished?$t.nextTick(Lr,_r):xr[lr].push(Lr)),this};function Pr(Er){return Er.ending&&!Er.destroyed&&Er.constructed&&Er.length===0&&!Er.errored&&Er.buffered.length===0&&!Er.finished&&!Er.writing&&!Er.errorEmitted&&!Er.closeEmitted}function Tr(Er,Br){let Lr=!1;function xr(_r){if(Lr){Nr(Er,_r??Jt());return}if(Lr=!0,Br.pendingcb--,_r){const Dr=Br[lr].splice(0);for(let jr=0;jr<Dr.length;jr++)Dr[jr](_r);Nr(Er,_r,Br.sync)}else Pr(Br)&&(Br.prefinished=!0,Er.emit("prefinish"),Br.pendingcb++,$t.nextTick(Mr,Er,Br))}Br.sync=!0,Br.pendingcb++;try{Er._final(xr)}catch(_r){xr(_r)}Br.sync=!1}function wr(Er,Br){!Br.prefinished&&!Br.finalCalled&&(typeof Er._final=="function"&&!Br.destroyed?(Br.finalCalled=!0,Tr(Er,Br)):(Br.prefinished=!0,Er.emit("prefinish")))}function Ar(Er,Br,Lr){Pr(Br)&&(wr(Er,Br),Br.pendingcb===0&&(Lr?(Br.pendingcb++,$t.nextTick((xr,_r)=>{Pr(_r)?Mr(xr,_r):_r.pendingcb--},Er,Br)):Pr(Br)&&(Br.pendingcb++,Mr(Er,Br))))}function Mr(Er,Br){Br.pendingcb--,Br.finished=!0;const Lr=Br[lr].splice(0);for(let xr=0;xr<Lr.length;xr++)Lr[xr]();if(Er.emit("finish"),Br.autoDestroy){const xr=Er._readableState;(!xr||xr.autoDestroy&&(xr.endEmitted||xr.readable===!1))&&Er.destroy()}}kt(rr.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(Er){this._writableState&&(this._writableState.destroyed=Er)}},writable:{__proto__:null,get(){const Er=this._writableState;return!!Er&&Er.writable!==!1&&!Er.destroyed&&!Er.errored&&!Er.ending&&!Er.ended},set(Er){this._writableState&&(this._writableState.writable=!!Er)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const Er=this._writableState;return Er?!Er.destroyed&&!Er.ending&&Er.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Ur=zt.destroy;rr.prototype.destroy=function(Er,Br){const Lr=this._writableState;return!Lr.destroyed&&(Lr.bufferedIndex<Lr.buffered.length||Lr[lr].length)&&$t.nextTick(br,Lr),Ur.call(this,Er,Br),this},rr.prototype._undestroy=zt.undestroy,rr.prototype._destroy=function(Er,Br){Br(Er)},rr.prototype[jt.captureRejectionSymbol]=function(Er){this.destroy(Er)};let Or;function Cr(){return Or===void 0&&(Or={}),Or}return rr.fromWeb=function(Er,Br){return Cr().newStreamWritableFromWritableStream(Er,Br)},rr.toWeb=function(Er){return Cr().newWritableStreamFromStreamWritable(Er)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const $t=browserExports$3,e=buffer$2,{isReadable:_t,isWritable:At,isIterable:xt,isNodeStream:kt,isReadableNodeStream:Bt,isWritableNodeStream:Nt,isDuplexNodeStream:Ut}=utils$1,Lt=endOfStreamExports,{AbortError:jt,codes:{ERR_INVALID_ARG_TYPE:Kt,ERR_INVALID_RETURN_VALUE:qt}}=errors,{destroyer:zt}=destroy_1,Vt=requireDuplex(),Ht=requireReadable(),{createDeferredPromise:Wt}=utilExports,Qt=from_1,Xt=globalThis.Blob||e.Blob,Jt=typeof Xt<"u"?function(Nr){return Nr instanceof Xt}:function(Nr){return!1},tr=globalThis.AbortController||requireBrowser().AbortController,{FunctionPrototypeCall:dr}=primordials;class vr extends Vt{constructor(Nr){super(Nr),(Nr==null?void 0:Nr.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(Nr==null?void 0:Nr.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function Rr(Nr,kr){if(Ut(Nr))return Nr;if(Bt(Nr))return Ir({readable:Nr});if(Nt(Nr))return Ir({writable:Nr});if(kt(Nr))return Ir({writable:!1,readable:!1});if(typeof Nr=="function"){const{value:ir,write:er,final:rr,destroy:yr}=$r(Nr);if(xt(ir))return Qt(vr,ir,{objectMode:!0,write:er,final:rr,destroy:yr});const fr=ir==null?void 0:ir.then;if(typeof fr=="function"){let gr;const ar=dr(fr,ir,nr=>{if(nr!=null)throw new qt("nully","body",nr)},nr=>{zt(gr,nr)});return gr=new vr({objectMode:!0,readable:!1,write:er,final(nr){rr(async()=>{try{await ar,$t.nextTick(nr,null)}catch(ur){$t.nextTick(nr,ur)}})},destroy:yr})}throw new qt("Iterable, AsyncIterable or AsyncFunction",kr,ir)}if(Jt(Nr))return Rr(Nr.arrayBuffer());if(xt(Nr))return Qt(vr,Nr,{objectMode:!0,writable:!1});if(typeof(Nr==null?void 0:Nr.writable)=="object"||typeof(Nr==null?void 0:Nr.readable)=="object"){const ir=Nr!=null&&Nr.readable?Bt(Nr==null?void 0:Nr.readable)?Nr==null?void 0:Nr.readable:Rr(Nr.readable):void 0,er=Nr!=null&&Nr.writable?Nt(Nr==null?void 0:Nr.writable)?Nr==null?void 0:Nr.writable:Rr(Nr.writable):void 0;return Ir({readable:ir,writable:er})}const lr=Nr==null?void 0:Nr.then;if(typeof lr=="function"){let ir;return dr(lr,Nr,er=>{er!=null&&ir.push(er),ir.push(null)},er=>{zt(ir,er)}),ir=new vr({objectMode:!0,writable:!1,read(){}})}throw new Kt(kr,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],Nr)};function $r(Rr){let{promise:Nr,resolve:kr}=Wt();const lr=new tr,ir=lr.signal;return{value:Rr(async function*(){for(;;){const rr=Nr;Nr=null;const{chunk:yr,done:fr,cb:gr}=await rr;if($t.nextTick(gr),fr)return;if(ir.aborted)throw new jt(void 0,{cause:ir.reason});({promise:Nr,resolve:kr}=Wt()),yield yr}}(),{signal:ir}),write(rr,yr,fr){const gr=kr;kr=null,gr({chunk:rr,done:!1,cb:fr})},final(rr){const yr=kr;kr=null,yr({done:!0,cb:rr})},destroy(rr,yr){lr.abort(),yr(rr)}}}function Ir(Rr){const Nr=Rr.readable&&typeof Rr.readable.read!="function"?Ht.wrap(Rr.readable):Rr.readable,kr=Rr.writable;let lr=!!_t(Nr),ir=!!At(kr),er,rr,yr,fr,gr;function ar(nr){const ur=fr;fr=null,ur?ur(nr):nr&&gr.destroy(nr)}return gr=new vr({readableObjectMode:!!(Nr!=null&&Nr.readableObjectMode),writableObjectMode:!!(kr!=null&&kr.writableObjectMode),readable:lr,writable:ir}),ir&&(Lt(kr,nr=>{ir=!1,nr&&zt(Nr,nr),ar(nr)}),gr._write=function(nr,ur,pr){kr.write(nr,ur)?pr():er=pr},gr._final=function(nr){kr.end(),rr=nr},kr.on("drain",function(){if(er){const nr=er;er=null,nr()}}),kr.on("finish",function(){if(rr){const nr=rr;rr=null,nr()}})),lr&&(Lt(Nr,nr=>{lr=!1,nr&&zt(Nr,nr),ar(nr)}),Nr.on("readable",function(){if(yr){const nr=yr;yr=null,nr()}}),Nr.on("end",function(){gr.push(null)}),gr._read=function(){for(;;){const nr=Nr.read();if(nr===null){yr=gr._read;return}if(!gr.push(nr))return}}),gr._destroy=function(nr,ur){!nr&&fr!==null&&(nr=new jt),yr=null,er=null,rr=null,fr===null?ur(nr):(fr=ur,zt(kr,nr),zt(Nr,nr))},gr}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:$t,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:_t,ObjectSetPrototypeOf:At}=primordials;duplex=Bt;const xt=requireReadable(),kt=requireWritable();At(Bt.prototype,xt.prototype),At(Bt,xt);{const jt=_t(kt.prototype);for(let Kt=0;Kt<jt.length;Kt++){const qt=jt[Kt];Bt.prototype[qt]||(Bt.prototype[qt]=kt.prototype[qt])}}function Bt(jt){if(!(this instanceof Bt))return new Bt(jt);xt.call(this,jt),kt.call(this,jt),jt?(this.allowHalfOpen=jt.allowHalfOpen!==!1,jt.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),jt.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}$t(Bt.prototype,{writable:{__proto__:null,...e(kt.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(kt.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(kt.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(kt.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(kt.prototype,"writableLength")},writableFinished:{__proto__:null,...e(kt.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(kt.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(kt.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(kt.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(jt){this._readableState&&this._writableState&&(this._readableState.destroyed=jt,this._writableState.destroyed=jt)}}});let Nt;function Ut(){return Nt===void 0&&(Nt={}),Nt}Bt.fromWeb=function(jt,Kt){return Ut().newStreamDuplexFromReadableWritablePair(jt,Kt)},Bt.toWeb=function(jt){return Ut().newReadableWritablePairFromDuplex(jt)};let Lt;return Bt.from=function(jt){return Lt||(Lt=requireDuplexify()),Lt(jt,"body")},duplex}const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$1,Symbol:Symbol$2}=primordials;var transform=Transform$1;const{ERR_METHOD_NOT_IMPLEMENTED}=errors.codes,Duplex$2=requireDuplex(),{getHighWaterMark}=state;ObjectSetPrototypeOf$1(Transform$1.prototype,Duplex$2.prototype);ObjectSetPrototypeOf$1(Transform$1,Duplex$2);const kCallback=Symbol$2("kCallback");function Transform$1($t){if(!(this instanceof Transform$1))return new Transform$1($t);const e=$t?getHighWaterMark(this,$t,"readableHighWaterMark",!0):null;e===0&&($t={...$t,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:$t.writableHighWaterMark||0}),Duplex$2.call(this,$t),this._readableState.sync=!1,this[kCallback]=null,$t&&(typeof $t.transform=="function"&&(this._transform=$t.transform),typeof $t.flush=="function"&&(this._flush=$t.flush)),this.on("prefinish",prefinish)}function final($t){typeof this._flush=="function"&&!this.destroyed?this._flush((e,_t)=>{if(e){$t?$t(e):this.destroy(e);return}_t!=null&&this.push(_t),this.push(null),$t&&$t()}):(this.push(null),$t&&$t())}function prefinish(){this._final!==final&&final.call(this)}Transform$1.prototype._final=final;Transform$1.prototype._transform=function($t,e,_t){throw new ERR_METHOD_NOT_IMPLEMENTED("_transform()")};Transform$1.prototype._write=function($t,e,_t){const At=this._readableState,xt=this._writableState,kt=At.length;this._transform($t,e,(Bt,Nt)=>{if(Bt){_t(Bt);return}Nt!=null&&this.push(Nt),xt.ended||kt===At.length||At.length<At.highWaterMark?_t():this[kCallback]=_t})};Transform$1.prototype._read=function(){if(this[kCallback]){const $t=this[kCallback];this[kCallback]=null,$t()}};const{ObjectSetPrototypeOf}=primordials;var passthrough=PassThrough$1;const Transform=transform;ObjectSetPrototypeOf(PassThrough$1.prototype,Transform.prototype);ObjectSetPrototypeOf(PassThrough$1,Transform);function PassThrough$1($t){if(!(this instanceof PassThrough$1))return new PassThrough$1($t);Transform.call(this,$t)}PassThrough$1.prototype._transform=function($t,e,_t){_t(null,$t)};const process=browserExports$3,{ArrayIsArray,Promise:Promise$2,SymbolAsyncIterator}=primordials,eos$1=endOfStreamExports,{once}=utilExports,destroyImpl=destroy_1,Duplex$1=requireDuplex(),{aggregateTwoErrors,codes:{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$2,ERR_INVALID_RETURN_VALUE,ERR_MISSING_ARGS:ERR_MISSING_ARGS$2,ERR_STREAM_DESTROYED,ERR_STREAM_PREMATURE_CLOSE},AbortError:AbortError$5}=errors,{validateFunction,validateAbortSignal:validateAbortSignal$1}=validators,{isIterable:isIterable$1,isReadable:isReadable$1,isReadableNodeStream,isNodeStream:isNodeStream$2,isTransformStream:isTransformStream$1,isWebStream:isWebStream$1,isReadableStream:isReadableStream$1,isReadableEnded}=utils$1,AbortController$1=globalThis.AbortController||requireBrowser().AbortController;let PassThrough,Readable;function destroyer$1($t,e,_t){let At=!1;$t.on("close",()=>{At=!0});const xt=eos$1($t,{readable:e,writable:_t},kt=>{At=!kt});return{destroy:kt=>{At||(At=!0,destroyImpl.destroyer($t,kt||new ERR_STREAM_DESTROYED("pipe")))},cleanup:xt}}function popCallback($t){return validateFunction($t[$t.length-1],"streams[stream.length - 1]"),$t.pop()}function makeAsyncIterable($t){if(isIterable$1($t))return $t;if(isReadableNodeStream($t))return fromReadable($t);throw new ERR_INVALID_ARG_TYPE$2("val",["Readable","Iterable","AsyncIterable"],$t)}async function*fromReadable($t){Readable||(Readable=requireReadable()),yield*Readable.prototype[SymbolAsyncIterator].call($t)}async function pumpToNode($t,e,_t,{end:At}){let xt,kt=null;const Bt=Lt=>{if(Lt&&(xt=Lt),kt){const jt=kt;kt=null,jt()}},Nt=()=>new Promise$2((Lt,jt)=>{xt?jt(xt):kt=()=>{xt?jt(xt):Lt()}});e.on("drain",Bt);const Ut=eos$1(e,{readable:!1},Bt);try{e.writableNeedDrain&&await Nt();for await(const Lt of $t)e.write(Lt)||await Nt();At&&e.end(),await Nt(),_t()}catch(Lt){_t(xt!==Lt?aggregateTwoErrors(xt,Lt):Lt)}finally{Ut(),e.off("drain",Bt)}}async function pumpToWeb($t,e,_t,{end:At}){isTransformStream$1(e)&&(e=e.writable);const xt=e.getWriter();try{for await(const kt of $t)await xt.ready,xt.write(kt).catch(()=>{});await xt.ready,At&&await xt.close(),_t()}catch(kt){try{await xt.abort(kt),_t(kt)}catch(Bt){_t(Bt)}}}function pipeline$1(...$t){return pipelineImpl($t,once(popCallback($t)))}function pipelineImpl($t,e,_t){if($t.length===1&&ArrayIsArray($t[0])&&($t=$t[0]),$t.length<2)throw new ERR_MISSING_ARGS$2("streams");const At=new AbortController$1,xt=At.signal,kt=_t==null?void 0:_t.signal,Bt=[];validateAbortSignal$1(kt,"options.signal");function Nt(){zt(new AbortError$5)}kt==null||kt.addEventListener("abort",Nt);let Ut,Lt;const jt=[];let Kt=0;function qt(Qt){zt(Qt,--Kt===0)}function zt(Qt,Xt){if(Qt&&(!Ut||Ut.code==="ERR_STREAM_PREMATURE_CLOSE")&&(Ut=Qt),!(!Ut&&!Xt)){for(;jt.length;)jt.shift()(Ut);kt==null||kt.removeEventListener("abort",Nt),At.abort(),Xt&&(Ut||Bt.forEach(Jt=>Jt()),process.nextTick(e,Ut,Lt))}}let Vt;for(let Qt=0;Qt<$t.length;Qt++){const Xt=$t[Qt],Jt=Qt<$t.length-1,tr=Qt>0,dr=Jt||(_t==null?void 0:_t.end)!==!1,vr=Qt===$t.length-1;if(isNodeStream$2(Xt)){let $r=function(Ir){Ir&&Ir.name!=="AbortError"&&Ir.code!=="ERR_STREAM_PREMATURE_CLOSE"&&qt(Ir)};if(dr){const{destroy:Ir,cleanup:Rr}=destroyer$1(Xt,Jt,tr);jt.push(Ir),isReadable$1(Xt)&&vr&&Bt.push(Rr)}Xt.on("error",$r),isReadable$1(Xt)&&vr&&Bt.push(()=>{Xt.removeListener("error",$r)})}if(Qt===0)if(typeof Xt=="function"){if(Vt=Xt({signal:xt}),!isIterable$1(Vt))throw new ERR_INVALID_RETURN_VALUE("Iterable, AsyncIterable or Stream","source",Vt)}else isIterable$1(Xt)||isReadableNodeStream(Xt)||isTransformStream$1(Xt)?Vt=Xt:Vt=Duplex$1.from(Xt);else if(typeof Xt=="function"){if(isTransformStream$1(Vt)){var Ht;Vt=makeAsyncIterable((Ht=Vt)===null||Ht===void 0?void 0:Ht.readable)}else Vt=makeAsyncIterable(Vt);if(Vt=Xt(Vt,{signal:xt}),Jt){if(!isIterable$1(Vt,!0))throw new ERR_INVALID_RETURN_VALUE("AsyncIterable",`transform[${Qt-1}]`,Vt)}else{var Wt;PassThrough||(PassThrough=passthrough);const $r=new PassThrough({objectMode:!0}),Ir=(Wt=Vt)===null||Wt===void 0?void 0:Wt.then;if(typeof Ir=="function")Kt++,Ir.call(Vt,kr=>{Lt=kr,kr!=null&&$r.write(kr),dr&&$r.end(),process.nextTick(qt)},kr=>{$r.destroy(kr),process.nextTick(qt,kr)});else if(isIterable$1(Vt,!0))Kt++,pumpToNode(Vt,$r,qt,{end:dr});else if(isReadableStream$1(Vt)||isTransformStream$1(Vt)){const kr=Vt.readable||Vt;Kt++,pumpToNode(kr,$r,qt,{end:dr})}else throw new ERR_INVALID_RETURN_VALUE("AsyncIterable or Promise","destination",Vt);Vt=$r;const{destroy:Rr,cleanup:Nr}=destroyer$1(Vt,!1,!0);jt.push(Rr),vr&&Bt.push(Nr)}}else if(isNodeStream$2(Xt)){if(isReadableNodeStream(Vt)){Kt+=2;const $r=pipe$1(Vt,Xt,qt,{end:dr});isReadable$1(Xt)&&vr&&Bt.push($r)}else if(isTransformStream$1(Vt)||isReadableStream$1(Vt)){const $r=Vt.readable||Vt;Kt++,pumpToNode($r,Xt,qt,{end:dr})}else if(isIterable$1(Vt))Kt++,pumpToNode(Vt,Xt,qt,{end:dr});else throw new ERR_INVALID_ARG_TYPE$2("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Vt);Vt=Xt}else if(isWebStream$1(Xt)){if(isReadableNodeStream(Vt))Kt++,pumpToWeb(makeAsyncIterable(Vt),Xt,qt,{end:dr});else if(isReadableStream$1(Vt)||isIterable$1(Vt))Kt++,pumpToWeb(Vt,Xt,qt,{end:dr});else if(isTransformStream$1(Vt))Kt++,pumpToWeb(Vt.readable,Xt,qt,{end:dr});else throw new ERR_INVALID_ARG_TYPE$2("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Vt);Vt=Xt}else Vt=Duplex$1.from(Xt)}return(xt!=null&&xt.aborted||kt!=null&&kt.aborted)&&process.nextTick(Nt),Vt}function pipe$1($t,e,_t,{end:At}){let xt=!1;if(e.on("close",()=>{xt||_t(new ERR_STREAM_PREMATURE_CLOSE)}),$t.pipe(e,{end:!1}),At){let kt=function(){xt=!0,e.end()};isReadableEnded($t)?process.nextTick(kt):$t.once("end",kt)}else _t();return eos$1($t,{readable:!0,writable:!1},kt=>{const Bt=$t._readableState;kt&&kt.code==="ERR_STREAM_PREMATURE_CLOSE"&&Bt&&Bt.ended&&!Bt.errored&&!Bt.errorEmitted?$t.once("end",_t).once("error",_t):_t(kt)}),eos$1(e,{readable:!1,writable:!0},_t)}var pipeline_1={pipelineImpl,pipeline:pipeline$1};const{pipeline}=pipeline_1,Duplex=requireDuplex(),{destroyer}=destroy_1,{isNodeStream:isNodeStream$1,isReadable,isWritable:isWritable$1,isWebStream,isTransformStream,isWritableStream,isReadableStream}=utils$1,{AbortError:AbortError$4,codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$1,ERR_MISSING_ARGS:ERR_MISSING_ARGS$1}}=errors,eos=endOfStreamExports;var compose$1=function $t(...e){if(e.length===0)throw new ERR_MISSING_ARGS$1("streams");if(e.length===1)return Duplex.from(e[0]);const _t=[...e];if(typeof e[0]=="function"&&(e[0]=Duplex.from(e[0])),typeof e[e.length-1]=="function"){const zt=e.length-1;e[zt]=Duplex.from(e[zt])}for(let zt=0;zt<e.length;++zt)if(!(!isNodeStream$1(e[zt])&&!isWebStream(e[zt]))){if(zt<e.length-1&&!(isReadable(e[zt])||isReadableStream(e[zt])||isTransformStream(e[zt])))throw new ERR_INVALID_ARG_VALUE$1(`streams[${zt}]`,_t[zt],"must be readable");if(zt>0&&!(isWritable$1(e[zt])||isWritableStream(e[zt])||isTransformStream(e[zt])))throw new ERR_INVALID_ARG_VALUE$1(`streams[${zt}]`,_t[zt],"must be writable")}let At,xt,kt,Bt,Nt;function Ut(zt){const Vt=Bt;Bt=null,Vt?Vt(zt):zt?Nt.destroy(zt):!qt&&!Kt&&Nt.destroy()}const Lt=e[0],jt=pipeline(e,Ut),Kt=!!(isWritable$1(Lt)||isWritableStream(Lt)||isTransformStream(Lt)),qt=!!(isReadable(jt)||isReadableStream(jt)||isTransformStream(jt));if(Nt=new Duplex({writableObjectMode:!!(Lt!=null&&Lt.writableObjectMode),readableObjectMode:!!(jt!=null&&jt.writableObjectMode),writable:Kt,readable:qt}),Kt){if(isNodeStream$1(Lt))Nt._write=function(Vt,Ht,Wt){Lt.write(Vt,Ht)?Wt():At=Wt},Nt._final=function(Vt){Lt.end(),xt=Vt},Lt.on("drain",function(){if(At){const Vt=At;At=null,Vt()}});else if(isWebStream(Lt)){const Ht=(isTransformStream(Lt)?Lt.writable:Lt).getWriter();Nt._write=async function(Wt,Qt,Xt){try{await Ht.ready,Ht.write(Wt).catch(()=>{}),Xt()}catch(Jt){Xt(Jt)}},Nt._final=async function(Wt){try{await Ht.ready,Ht.close().catch(()=>{}),xt=Wt}catch(Qt){Wt(Qt)}}}const zt=isTransformStream(jt)?jt.readable:jt;eos(zt,()=>{if(xt){const Vt=xt;xt=null,Vt()}})}if(qt){if(isNodeStream$1(jt))jt.on("readable",function(){if(kt){const zt=kt;kt=null,zt()}}),jt.on("end",function(){Nt.push(null)}),Nt._read=function(){for(;;){const zt=jt.read();if(zt===null){kt=Nt._read;return}if(!Nt.push(zt))return}};else if(isWebStream(jt)){const Vt=(isTransformStream(jt)?jt.readable:jt).getReader();Nt._read=async function(){for(;;)try{const{value:Ht,done:Wt}=await Vt.read();if(!Nt.push(Ht))return;if(Wt){Nt.push(null);return}}catch{return}}}}return Nt._destroy=function(zt,Vt){!zt&&Bt!==null&&(zt=new AbortError$4),kt=null,At=null,xt=null,Bt===null?Vt(zt):(Bt=Vt,isNodeStream$1(jt)&&destroyer(jt,zt))},Nt};const AbortController=globalThis.AbortController||requireBrowser().AbortController,{codes:{ERR_INVALID_ARG_VALUE,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$1,ERR_MISSING_ARGS,ERR_OUT_OF_RANGE},AbortError:AbortError$3}=errors,{validateAbortSignal,validateInteger,validateObject:validateObject$1}=validators,kWeakHandler=primordials.Symbol("kWeak"),{finished}=endOfStreamExports,staticCompose=compose$1,{addAbortSignalNoValidate}=addAbortSignalExports,{isWritable,isNodeStream}=utils$1,{ArrayPrototypePush,MathFloor,Number:Number$1,NumberIsNaN,Promise:Promise$1,PromiseReject,PromisePrototypeThen,Symbol:Symbol$1}=primordials,kEmpty=Symbol$1("kEmpty"),kEof=Symbol$1("kEof");function compose($t,e){if(e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),isNodeStream($t)&&!isWritable($t))throw new ERR_INVALID_ARG_VALUE("stream",$t,"must be writable");const _t=staticCompose(this,$t);return e!=null&&e.signal&&addAbortSignalNoValidate(e.signal,_t),_t}function map$1($t,e){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],$t);e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal");let _t=1;return(e==null?void 0:e.concurrency)!=null&&(_t=MathFloor(e.concurrency)),validateInteger(_t,"concurrency",1),(async function*(){var xt,kt;const Bt=new AbortController,Nt=this,Ut=[],Lt=Bt.signal,jt={signal:Lt},Kt=()=>Bt.abort();e!=null&&(xt=e.signal)!==null&&xt!==void 0&&xt.aborted&&Kt(),e==null||(kt=e.signal)===null||kt===void 0||kt.addEventListener("abort",Kt);let qt,zt,Vt=!1;function Ht(){Vt=!0}async function Wt(){try{for await(let Jt of Nt){var Qt;if(Vt)return;if(Lt.aborted)throw new AbortError$3;try{Jt=$t(Jt,jt)}catch(tr){Jt=PromiseReject(tr)}Jt!==kEmpty&&(typeof((Qt=Jt)===null||Qt===void 0?void 0:Qt.catch)=="function"&&Jt.catch(Ht),Ut.push(Jt),qt&&(qt(),qt=null),!Vt&&Ut.length&&Ut.length>=_t&&await new Promise$1(tr=>{zt=tr}))}Ut.push(kEof)}catch(Jt){const tr=PromiseReject(Jt);PromisePrototypeThen(tr,void 0,Ht),Ut.push(tr)}finally{var Xt;Vt=!0,qt&&(qt(),qt=null),e==null||(Xt=e.signal)===null||Xt===void 0||Xt.removeEventListener("abort",Kt)}}Wt();try{for(;;){for(;Ut.length>0;){const Qt=await Ut[0];if(Qt===kEof)return;if(Lt.aborted)throw new AbortError$3;Qt!==kEmpty&&(yield Qt),Ut.shift(),zt&&(zt(),zt=null)}await new Promise$1(Qt=>{qt=Qt})}}finally{Bt.abort(),Vt=!0,zt&&(zt(),zt=null)}}).call(this)}function asIndexedPairs($t=void 0){return $t!=null&&validateObject$1($t,"options"),($t==null?void 0:$t.signal)!=null&&validateAbortSignal($t.signal,"options.signal"),(async function*(){let _t=0;for await(const xt of this){var At;if($t!=null&&(At=$t.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$3({cause:$t.signal.reason});yield[_t++,xt]}}).call(this)}async function some($t,e=void 0){for await(const _t of filter$1.call(this,$t,e))return!0;return!1}async function every($t,e=void 0){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],$t);return!await some.call(this,async(..._t)=>!await $t(..._t),e)}async function find($t,e){for await(const _t of filter$1.call(this,$t,e))return _t}async function forEach($t,e){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],$t);async function _t(At,xt){return await $t(At,xt),kEmpty}for await(const At of map$1.call(this,_t,e));}function filter$1($t,e){if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],$t);async function _t(At,xt){return await $t(At,xt)?At:kEmpty}return map$1.call(this,_t,e)}class ReduceAwareErrMissingArgs extends ERR_MISSING_ARGS{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function reduce($t,e,_t){var At;if(typeof $t!="function")throw new ERR_INVALID_ARG_TYPE$1("reducer",["Function","AsyncFunction"],$t);_t!=null&&validateObject$1(_t,"options"),(_t==null?void 0:_t.signal)!=null&&validateAbortSignal(_t.signal,"options.signal");let xt=arguments.length>1;if(_t!=null&&(At=_t.signal)!==null&&At!==void 0&&At.aborted){const Lt=new AbortError$3(void 0,{cause:_t.signal.reason});throw this.once("error",()=>{}),await finished(this.destroy(Lt)),Lt}const kt=new AbortController,Bt=kt.signal;if(_t!=null&&_t.signal){const Lt={once:!0,[kWeakHandler]:this};_t.signal.addEventListener("abort",()=>kt.abort(),Lt)}let Nt=!1;try{for await(const Lt of this){var Ut;if(Nt=!0,_t!=null&&(Ut=_t.signal)!==null&&Ut!==void 0&&Ut.aborted)throw new AbortError$3;xt?e=await $t(e,Lt,{signal:Bt}):(e=Lt,xt=!0)}if(!Nt&&!xt)throw new ReduceAwareErrMissingArgs}finally{kt.abort()}return e}async function toArray($t){$t!=null&&validateObject$1($t,"options"),($t==null?void 0:$t.signal)!=null&&validateAbortSignal($t.signal,"options.signal");const e=[];for await(const At of this){var _t;if($t!=null&&(_t=$t.signal)!==null&&_t!==void 0&&_t.aborted)throw new AbortError$3(void 0,{cause:$t.signal.reason});ArrayPrototypePush(e,At)}return e}function flatMap($t,e){const _t=map$1.call(this,$t,e);return(async function*(){for await(const xt of _t)yield*xt}).call(this)}function toIntegerOrInfinity($t){if($t=Number$1($t),NumberIsNaN($t))return 0;if($t<0)throw new ERR_OUT_OF_RANGE("number",">= 0",$t);return $t}function drop($t,e=void 0){return e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),$t=toIntegerOrInfinity($t),(async function*(){var At;if(e!=null&&(At=e.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$3;for await(const kt of this){var xt;if(e!=null&&(xt=e.signal)!==null&&xt!==void 0&&xt.aborted)throw new AbortError$3;$t--<=0&&(yield kt)}}).call(this)}function take($t,e=void 0){return e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),$t=toIntegerOrInfinity($t),(async function*(){var At;if(e!=null&&(At=e.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$3;for await(const kt of this){var xt;if(e!=null&&(xt=e.signal)!==null&&xt!==void 0&&xt.aborted)throw new AbortError$3;if($t-- >0)yield kt;else return}}).call(this)}operators.streamReturningOperators={asIndexedPairs,drop,filter:filter$1,flatMap,map:map$1,take,compose};operators.promiseReturningOperators={every,forEach,reduce,toArray,some,find};var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:$t,Promise:e}=primordials,{isIterable:_t,isNodeStream:At,isWebStream:xt}=utils$1,{pipelineImpl:kt}=pipeline_1,{finished:Bt}=endOfStreamExports;requireStream();function Nt(...Ut){return new e((Lt,jt)=>{let Kt,qt;const zt=Ut[Ut.length-1];if(zt&&typeof zt=="object"&&!At(zt)&&!_t(zt)&&!xt(zt)){const Vt=$t(Ut);Kt=Vt.signal,qt=Vt.end}kt(Ut,(Vt,Ht)=>{Vt?jt(Vt):Lt(Ht)},{signal:Kt,end:qt})})}return promises={finished:Bt,pipeline:Nt},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:$t}=buffer$2,{ObjectDefineProperty:e,ObjectKeys:_t,ReflectApply:At}=primordials,{promisify:{custom:xt}}=utilExports,{streamReturningOperators:kt,promiseReturningOperators:Bt}=operators,{codes:{ERR_ILLEGAL_CONSTRUCTOR:Nt}}=errors,Ut=compose$1,{pipeline:Lt}=pipeline_1,{destroyer:jt}=destroy_1,Kt=endOfStreamExports,qt=requirePromises(),zt=utils$1,Vt=stream.exports=legacy.Stream;Vt.isDisturbed=zt.isDisturbed,Vt.isErrored=zt.isErrored,Vt.isReadable=zt.isReadable,Vt.Readable=requireReadable();for(const Wt of _t(kt)){let Xt=function(...Jt){if(new.target)throw Nt();return Vt.Readable.from(At(Qt,this,Jt))};const Qt=kt[Wt];e(Xt,"name",{__proto__:null,value:Qt.name}),e(Xt,"length",{__proto__:null,value:Qt.length}),e(Vt.Readable.prototype,Wt,{__proto__:null,value:Xt,enumerable:!1,configurable:!0,writable:!0})}for(const Wt of _t(Bt)){let Xt=function(...Jt){if(new.target)throw Nt();return At(Qt,this,Jt)};const Qt=Bt[Wt];e(Xt,"name",{__proto__:null,value:Qt.name}),e(Xt,"length",{__proto__:null,value:Qt.length}),e(Vt.Readable.prototype,Wt,{__proto__:null,value:Xt,enumerable:!1,configurable:!0,writable:!0})}Vt.Writable=requireWritable(),Vt.Duplex=requireDuplex(),Vt.Transform=transform,Vt.PassThrough=passthrough,Vt.pipeline=Lt;const{addAbortSignal:Ht}=addAbortSignalExports;return Vt.addAbortSignal=Ht,Vt.finished=Kt,Vt.destroy=jt,Vt.compose=Ut,e(Vt,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return qt}}),e(Lt,xt,{__proto__:null,enumerable:!0,get(){return qt.pipeline}}),e(Kt,xt,{__proto__:null,enumerable:!0,get(){return qt.finished}}),Vt.Stream=Vt,Vt._isUint8Array=function(Qt){return Qt instanceof Uint8Array},Vt._uint8ArrayToBuffer=function(Qt){return $t.from(Qt.buffer,Qt.byteOffset,Qt.byteLength)},stream.exports}(function($t){const e=requireStream(),_t=requirePromises(),At=e.Readable.destroy;$t.exports=e.Readable,$t.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,$t.exports._isUint8Array=e._isUint8Array,$t.exports.isDisturbed=e.isDisturbed,$t.exports.isErrored=e.isErrored,$t.exports.isReadable=e.isReadable,$t.exports.Readable=e.Readable,$t.exports.Writable=e.Writable,$t.exports.Duplex=e.Duplex,$t.exports.Transform=e.Transform,$t.exports.PassThrough=e.PassThrough,$t.exports.addAbortSignal=e.addAbortSignal,$t.exports.finished=e.finished,$t.exports.destroy=e.destroy,$t.exports.destroy=At,$t.exports.pipeline=e.pipeline,$t.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return _t}}),$t.exports.Stream=e.Stream,$t.exports.default=$t.exports})(browser);var browserExports=browser.exports,__awaiter$1W=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let Sha256$2=class{static digest(e){return __awaiter$1W(this,arguments,void 0,function*({data:_t}){return sha256$5(_t)})}},CryptoAlgorithm$2=class{};var __awaiter$1V=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let Sha2Algorithm$2=class extends CryptoAlgorithm$2{digest(e){return __awaiter$1V(this,arguments,void 0,function*({algorithm:_t,data:At}){switch(_t){case"SHA-256":return yield Sha256$2.digest({data:At})}})}};function number($t){if(!Number.isSafeInteger($t)||$t<0)throw new Error(`Wrong positive integer: ${$t}`)}function isBytes$5($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}function bytes$1($t,...e){if(!isBytes$5($t))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes($t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${$t.length}`)}function hash($t){if(typeof $t!="function"||typeof $t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number($t.outputLen),number($t.blockLen)}function exists$1($t,e=!0){if($t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&$t.finished)throw new Error("Hash#digest() has already been called")}function output$1($t,e){bytes$1($t);const _t=e.outputLen;if($t.length<_t)throw new Error(`digestInto() expects output buffer of length at least ${_t}`)}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$4($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}const createView=$t=>new DataView($t.buffer,$t.byteOffset,$t.byteLength),rotr=($t,e)=>$t<<32-e|$t>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$1=Array.from({length:256},($t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1($t){if(!isBytes$4($t))throw new Error("Uint8Array expected");let e="";for(let _t=0;_t<$t.length;_t++)e+=hexes$1[$t[_t]];return e}const asciis$1={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$1($t){if($t>=asciis$1._0&&$t<=asciis$1._9)return $t-asciis$1._0;if($t>=asciis$1._A&&$t<=asciis$1._F)return $t-(asciis$1._A-10);if($t>=asciis$1._a&&$t<=asciis$1._f)return $t-(asciis$1._a-10)}function hexToBytes$1($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);const e=$t.length,_t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const At=new Uint8Array(_t);for(let xt=0,kt=0;xt<_t;xt++,kt+=2){const Bt=asciiToBase16$1($t.charCodeAt(kt)),Nt=asciiToBase16$1($t.charCodeAt(kt+1));if(Bt===void 0||Nt===void 0){const Ut=$t[kt]+$t[kt+1];throw new Error('hex string expected, got non-hex character "'+Ut+'" at index '+kt)}At[xt]=Bt*16+Nt}return At}const nextTick=async()=>{};async function asyncLoop($t,e,_t){let At=Date.now();for(let xt=0;xt<$t;xt++){_t(xt);const kt=Date.now()-At;kt>=0&&kt<e||(await nextTick(),At+=kt)}}function utf8ToBytes$2($t){if(typeof $t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function toBytes$1($t){if(typeof $t=="string"&&($t=utf8ToBytes$2($t)),!isBytes$4($t))throw new Error(`expected Uint8Array, got ${typeof $t}`);return $t}function concatBytes$1(...$t){let e=0;for(let At=0;At<$t.length;At++){const xt=$t[At];if(!isBytes$4(xt))throw new Error("Uint8Array expected");e+=xt.length}const _t=new Uint8Array(e);for(let At=0,xt=0;At<$t.length;At++){const kt=$t[At];_t.set(kt,xt),xt+=kt.length}return _t}class Hash{clone(){return this._cloneInto()}}const toStr={}.toString;function checkOpts($t,e){if(e!==void 0&&toStr.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign($t,e)}function wrapConstructor($t){const e=At=>$t().update(toBytes$1(At)).digest(),_t=$t();return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=()=>$t(),e}function randomBytes$1($t=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array($t));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64($t,e,_t,At){if(typeof $t.setBigUint64=="function")return $t.setBigUint64(e,_t,At);const xt=BigInt(32),kt=BigInt(4294967295),Bt=Number(_t>>xt&kt),Nt=Number(_t&kt),Ut=At?4:0,Lt=At?0:4;$t.setUint32(e+Ut,Bt,At),$t.setUint32(e+Lt,Nt,At)}class SHA2 extends Hash{constructor(e,_t,At,xt){super(),this.blockLen=e,this.outputLen=_t,this.padOffset=At,this.isLE=xt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){exists$1(this);const{view:_t,buffer:At,blockLen:xt}=this;e=toBytes$1(e);const kt=e.length;for(let Bt=0;Bt<kt;){const Nt=Math.min(xt-this.pos,kt-Bt);if(Nt===xt){const Ut=createView(e);for(;xt<=kt-Bt;Bt+=xt)this.process(Ut,Bt);continue}At.set(e.subarray(Bt,Bt+Nt),this.pos),this.pos+=Nt,Bt+=Nt,this.pos===xt&&(this.process(_t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$1(this),output$1(e,this),this.finished=!0;const{buffer:_t,view:At,blockLen:xt,isLE:kt}=this;let{pos:Bt}=this;_t[Bt++]=128,this.buffer.subarray(Bt).fill(0),this.padOffset>xt-Bt&&(this.process(At,0),Bt=0);for(let Kt=Bt;Kt<xt;Kt++)_t[Kt]=0;setBigUint64(At,xt-8,BigInt(this.length*8),kt),this.process(At,0);const Nt=createView(e),Ut=this.outputLen;if(Ut%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Lt=Ut/4,jt=this.get();if(Lt>jt.length)throw new Error("_sha2: outputLen bigger than state");for(let Kt=0;Kt<Lt;Kt++)Nt.setUint32(4*Kt,jt[Kt],kt)}digest(){const{buffer:e,outputLen:_t}=this;this.digestInto(e);const At=e.slice(0,_t);return this.destroy(),At}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:_t,buffer:At,length:xt,finished:kt,destroyed:Bt,pos:Nt}=this;return e.length=xt,e.pos=Nt,e.finished=kt,e.destroyed=Bt,xt%_t&&e.buffer.set(At),e}}const Chi=($t,e,_t)=>$t&e^~$t&_t,Maj=($t,e,_t)=>$t&e^$t&_t^e&_t,SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:_t,C:At,D:xt,E:kt,F:Bt,G:Nt,H:Ut}=this;return[e,_t,At,xt,kt,Bt,Nt,Ut]}set(e,_t,At,xt,kt,Bt,Nt,Ut){this.A=e|0,this.B=_t|0,this.C=At|0,this.D=xt|0,this.E=kt|0,this.F=Bt|0,this.G=Nt|0,this.H=Ut|0}process(e,_t){for(let Kt=0;Kt<16;Kt++,_t+=4)SHA256_W[Kt]=e.getUint32(_t,!1);for(let Kt=16;Kt<64;Kt++){const qt=SHA256_W[Kt-15],zt=SHA256_W[Kt-2],Vt=rotr(qt,7)^rotr(qt,18)^qt>>>3,Ht=rotr(zt,17)^rotr(zt,19)^zt>>>10;SHA256_W[Kt]=Ht+SHA256_W[Kt-7]+Vt+SHA256_W[Kt-16]|0}let{A:At,B:xt,C:kt,D:Bt,E:Nt,F:Ut,G:Lt,H:jt}=this;for(let Kt=0;Kt<64;Kt++){const qt=rotr(Nt,6)^rotr(Nt,11)^rotr(Nt,25),zt=jt+qt+Chi(Nt,Ut,Lt)+SHA256_K[Kt]+SHA256_W[Kt]|0,Ht=(rotr(At,2)^rotr(At,13)^rotr(At,22))+Maj(At,xt,kt)|0;jt=Lt,Lt=Ut,Ut=Nt,Nt=Bt+zt|0,Bt=kt,kt=xt,xt=At,At=zt+Ht|0}At=At+this.A|0,xt=xt+this.B|0,kt=kt+this.C|0,Bt=Bt+this.D|0,Nt=Nt+this.E|0,Ut=Ut+this.F|0,Lt=Lt+this.G|0,jt=jt+this.H|0,this.set(At,xt,kt,Bt,Nt,Ut,Lt,jt)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256=wrapConstructor(()=>new SHA256);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$5=BigInt(0),_1n$7=BigInt(1),_2n$4=BigInt(2);function isBytes$3($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}const hexes=Array.from({length:256},($t,e)=>e.toString(16).padStart(2,"0"));function bytesToHex($t){if(!isBytes$3($t))throw new Error("Uint8Array expected");let e="";for(let _t=0;_t<$t.length;_t++)e+=hexes[$t[_t]];return e}function numberToHexUnpadded($t){const e=$t.toString(16);return e.length&1?`0${e}`:e}function hexToNumber($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);return BigInt($t===""?"0":`0x${$t}`)}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16($t){if($t>=asciis._0&&$t<=asciis._9)return $t-asciis._0;if($t>=asciis._A&&$t<=asciis._F)return $t-(asciis._A-10);if($t>=asciis._a&&$t<=asciis._f)return $t-(asciis._a-10)}function hexToBytes($t){if(typeof $t!="string")throw new Error("hex string expected, got "+typeof $t);const e=$t.length,_t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const At=new Uint8Array(_t);for(let xt=0,kt=0;xt<_t;xt++,kt+=2){const Bt=asciiToBase16($t.charCodeAt(kt)),Nt=asciiToBase16($t.charCodeAt(kt+1));if(Bt===void 0||Nt===void 0){const Ut=$t[kt]+$t[kt+1];throw new Error('hex string expected, got non-hex character "'+Ut+'" at index '+kt)}At[xt]=Bt*16+Nt}return At}function bytesToNumberBE($t){return hexToNumber(bytesToHex($t))}function bytesToNumberLE($t){if(!isBytes$3($t))throw new Error("Uint8Array expected");return hexToNumber(bytesToHex(Uint8Array.from($t).reverse()))}function numberToBytesBE($t,e){return hexToBytes($t.toString(16).padStart(e*2,"0"))}function numberToBytesLE($t,e){return numberToBytesBE($t,e).reverse()}function numberToVarBytesBE($t){return hexToBytes(numberToHexUnpadded($t))}function ensureBytes$2($t,e,_t){let At;if(typeof e=="string")try{At=hexToBytes(e)}catch(kt){throw new Error(`${$t} must be valid hex string, got "${e}". Cause: ${kt}`)}else if(isBytes$3(e))At=Uint8Array.from(e);else throw new Error(`${$t} must be hex string or Uint8Array`);const xt=At.length;if(typeof _t=="number"&&xt!==_t)throw new Error(`${$t} expected ${_t} bytes, got ${xt}`);return At}function concatBytes(...$t){let e=0;for(let xt=0;xt<$t.length;xt++){const kt=$t[xt];if(!isBytes$3(kt))throw new Error("Uint8Array expected");e+=kt.length}let _t=new Uint8Array(e),At=0;for(let xt=0;xt<$t.length;xt++){const kt=$t[xt];_t.set(kt,At),At+=kt.length}return _t}function equalBytes($t,e){if($t.length!==e.length)return!1;let _t=0;for(let At=0;At<$t.length;At++)_t|=$t[At]^e[At];return _t===0}function utf8ToBytes$1($t){if(typeof $t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function bitLen($t){let e;for(e=0;$t>_0n$5;$t>>=_1n$7,e+=1);return e}function bitGet($t,e){return $t>>BigInt(e)&_1n$7}const bitSet=($t,e,_t)=>$t|(_t?_1n$7:_0n$5)<<BigInt(e),bitMask=$t=>(_2n$4<<BigInt($t-1))-_1n$7,u8n=$t=>new Uint8Array($t),u8fr=$t=>Uint8Array.from($t);function createHmacDrbg($t,e,_t){if(typeof $t!="number"||$t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof _t!="function")throw new Error("hmacFn must be a function");let At=u8n($t),xt=u8n($t),kt=0;const Bt=()=>{At.fill(1),xt.fill(0),kt=0},Nt=(...Kt)=>_t(xt,At,...Kt),Ut=(Kt=u8n())=>{xt=Nt(u8fr([0]),Kt),At=Nt(),Kt.length!==0&&(xt=Nt(u8fr([1]),Kt),At=Nt())},Lt=()=>{if(kt++>=1e3)throw new Error("drbg: tried 1000 values");let Kt=0;const qt=[];for(;Kt<e;){At=Nt();const zt=At.slice();qt.push(zt),Kt+=At.length}return concatBytes(...qt)};return(Kt,qt)=>{Bt(),Ut(Kt);let zt;for(;!(zt=qt(Lt()));)Ut();return Bt(),zt}}const validatorFns={bigint:$t=>typeof $t=="bigint",function:$t=>typeof $t=="function",boolean:$t=>typeof $t=="boolean",string:$t=>typeof $t=="string",stringOrUint8Array:$t=>typeof $t=="string"||isBytes$3($t),isSafeInteger:$t=>Number.isSafeInteger($t),array:$t=>Array.isArray($t),field:($t,e)=>e.Fp.isValid($t),hash:$t=>typeof $t=="function"&&Number.isSafeInteger($t.outputLen)};function validateObject($t,e,_t={}){const At=(xt,kt,Bt)=>{const Nt=validatorFns[kt];if(typeof Nt!="function")throw new Error(`Invalid validator "${kt}", expected function`);const Ut=$t[xt];if(!(Bt&&Ut===void 0)&&!Nt(Ut,$t))throw new Error(`Invalid param ${String(xt)}=${Ut} (${typeof Ut}), expected ${kt}`)};for(const[xt,kt]of Object.entries(e))At(xt,kt,!1);for(const[xt,kt]of Object.entries(_t))At(xt,kt,!0);return $t}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes:ensureBytes$2,equalBytes,hexToBytes,hexToNumber,isBytes:isBytes$3,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$1,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$6=BigInt(1),_2n$3=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod($t,e){const _t=$t%e;return _t>=_0n$4?_t:e+_t}function pow($t,e,_t){if(_t<=_0n$4||e<_0n$4)throw new Error("Expected power/modulo > 0");if(_t===_1n$6)return _0n$4;let At=_1n$6;for(;e>_0n$4;)e&_1n$6&&(At=At*$t%_t),$t=$t*$t%_t,e>>=_1n$6;return At}function pow2($t,e,_t){let At=$t;for(;e-- >_0n$4;)At*=At,At%=_t;return At}function invert($t,e){if($t===_0n$4||e<=_0n$4)throw new Error(`invert: expected positive integers, got n=${$t} mod=${e}`);let _t=mod($t,e),At=e,xt=_0n$4,kt=_1n$6;for(;_t!==_0n$4;){const Nt=At/_t,Ut=At%_t,Lt=xt-kt*Nt;At=_t,_t=Ut,xt=kt,kt=Lt}if(At!==_1n$6)throw new Error("invert: does not exist");return mod(xt,e)}function tonelliShanks($t){const e=($t-_1n$6)/_2n$3;let _t,At,xt;for(_t=$t-_1n$6,At=0;_t%_2n$3===_0n$4;_t/=_2n$3,At++);for(xt=_2n$3;xt<$t&&pow(xt,e,$t)!==$t-_1n$6;xt++);if(At===1){const Bt=($t+_1n$6)/_4n;return function(Ut,Lt){const jt=Ut.pow(Lt,Bt);if(!Ut.eql(Ut.sqr(jt),Lt))throw new Error("Cannot find square root");return jt}}const kt=(_t+_1n$6)/_2n$3;return function(Nt,Ut){if(Nt.pow(Ut,e)===Nt.neg(Nt.ONE))throw new Error("Cannot find square root");let Lt=At,jt=Nt.pow(Nt.mul(Nt.ONE,xt),_t),Kt=Nt.pow(Ut,kt),qt=Nt.pow(Ut,_t);for(;!Nt.eql(qt,Nt.ONE);){if(Nt.eql(qt,Nt.ZERO))return Nt.ZERO;let zt=1;for(let Ht=Nt.sqr(qt);zt<Lt&&!Nt.eql(Ht,Nt.ONE);zt++)Ht=Nt.sqr(Ht);const Vt=Nt.pow(jt,_1n$6<<BigInt(Lt-zt-1));jt=Nt.sqr(Vt),Kt=Nt.mul(Kt,Vt),qt=Nt.mul(qt,jt),Lt=zt}return Kt}}function FpSqrt($t){if($t%_4n===_3n$1){const e=($t+_1n$6)/_4n;return function(At,xt){const kt=At.pow(xt,e);if(!At.eql(At.sqr(kt),xt))throw new Error("Cannot find square root");return kt}}if($t%_8n$1===_5n$1){const e=($t-_5n$1)/_8n$1;return function(At,xt){const kt=At.mul(xt,_2n$3),Bt=At.pow(kt,e),Nt=At.mul(xt,Bt),Ut=At.mul(At.mul(Nt,_2n$3),Bt),Lt=At.mul(Nt,At.sub(Ut,At.ONE));if(!At.eql(At.sqr(Lt),xt))throw new Error("Cannot find square root");return Lt}}return tonelliShanks($t)}const isNegativeLE=($t,e)=>(mod($t,e)&_1n$6)===_1n$6,FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField($t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},_t=FIELD_FIELDS.reduce((At,xt)=>(At[xt]="function",At),e);return validateObject($t,_t)}function FpPow($t,e,_t){if(_t<_0n$4)throw new Error("Expected power > 0");if(_t===_0n$4)return $t.ONE;if(_t===_1n$6)return e;let At=$t.ONE,xt=e;for(;_t>_0n$4;)_t&_1n$6&&(At=$t.mul(At,xt)),xt=$t.sqr(xt),_t>>=_1n$6;return At}function FpInvertBatch($t,e){const _t=new Array(e.length),At=e.reduce((kt,Bt,Nt)=>$t.is0(Bt)?kt:(_t[Nt]=kt,$t.mul(kt,Bt)),$t.ONE),xt=$t.inv(At);return e.reduceRight((kt,Bt,Nt)=>$t.is0(Bt)?kt:(_t[Nt]=$t.mul(kt,_t[Nt]),$t.mul(kt,Bt)),xt),_t}function nLength($t,e){const _t=e!==void 0?e:$t.toString(2).length,At=Math.ceil(_t/8);return{nBitLength:_t,nByteLength:At}}function Field($t,e,_t=!1,At={}){if($t<=_0n$4)throw new Error(`Expected Field ORDER > 0, got ${$t}`);const{nBitLength:xt,nByteLength:kt}=nLength($t,e);if(kt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const Bt=FpSqrt($t),Nt=Object.freeze({ORDER:$t,BITS:xt,BYTES:kt,MASK:bitMask(xt),ZERO:_0n$4,ONE:_1n$6,create:Ut=>mod(Ut,$t),isValid:Ut=>{if(typeof Ut!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof Ut}`);return _0n$4<=Ut&&Ut<$t},is0:Ut=>Ut===_0n$4,isOdd:Ut=>(Ut&_1n$6)===_1n$6,neg:Ut=>mod(-Ut,$t),eql:(Ut,Lt)=>Ut===Lt,sqr:Ut=>mod(Ut*Ut,$t),add:(Ut,Lt)=>mod(Ut+Lt,$t),sub:(Ut,Lt)=>mod(Ut-Lt,$t),mul:(Ut,Lt)=>mod(Ut*Lt,$t),pow:(Ut,Lt)=>FpPow(Nt,Ut,Lt),div:(Ut,Lt)=>mod(Ut*invert(Lt,$t),$t),sqrN:Ut=>Ut*Ut,addN:(Ut,Lt)=>Ut+Lt,subN:(Ut,Lt)=>Ut-Lt,mulN:(Ut,Lt)=>Ut*Lt,inv:Ut=>invert(Ut,$t),sqrt:At.sqrt||(Ut=>Bt(Nt,Ut)),invertBatch:Ut=>FpInvertBatch(Nt,Ut),cmov:(Ut,Lt,jt)=>jt?Lt:Ut,toBytes:Ut=>_t?numberToBytesLE(Ut,kt):numberToBytesBE(Ut,kt),fromBytes:Ut=>{if(Ut.length!==kt)throw new Error(`Fp.fromBytes: expected ${kt}, got ${Ut.length}`);return _t?bytesToNumberLE(Ut):bytesToNumberBE(Ut)}});return Object.freeze(Nt)}function FpSqrtEven($t,e){if(!$t.isOdd)throw new Error("Field doesn't have isOdd");const _t=$t.sqrt(e);return $t.isOdd(_t)?$t.neg(_t):_t}function getFieldBytesLength($t){if(typeof $t!="bigint")throw new Error("field order must be bigint");const e=$t.toString(2).length;return Math.ceil(e/8)}function getMinHashLength($t){const e=getFieldBytesLength($t);return e+Math.ceil(e/2)}function mapHashToField($t,e,_t=!1){const At=$t.length,xt=getFieldBytesLength(e),kt=getMinHashLength(e);if(At<16||At<kt||At>1024)throw new Error(`expected ${kt}-1024 bytes of input, got ${At}`);const Bt=_t?bytesToNumberBE($t):bytesToNumberLE($t),Nt=mod(Bt,e-_1n$6)+_1n$6;return _t?numberToBytesLE(Nt,xt):numberToBytesBE(Nt,xt)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$5=BigInt(1);function wNAF($t,e){const _t=(xt,kt)=>{const Bt=kt.negate();return xt?Bt:kt},At=xt=>{const kt=Math.ceil(e/xt)+1,Bt=2**(xt-1);return{windows:kt,windowSize:Bt}};return{constTimeNegate:_t,unsafeLadder(xt,kt){let Bt=$t.ZERO,Nt=xt;for(;kt>_0n$3;)kt&_1n$5&&(Bt=Bt.add(Nt)),Nt=Nt.double(),kt>>=_1n$5;return Bt},precomputeWindow(xt,kt){const{windows:Bt,windowSize:Nt}=At(kt),Ut=[];let Lt=xt,jt=Lt;for(let Kt=0;Kt<Bt;Kt++){jt=Lt,Ut.push(jt);for(let qt=1;qt<Nt;qt++)jt=jt.add(Lt),Ut.push(jt);Lt=jt.double()}return Ut},wNAF(xt,kt,Bt){const{windows:Nt,windowSize:Ut}=At(xt);let Lt=$t.ZERO,jt=$t.BASE;const Kt=BigInt(2**xt-1),qt=2**xt,zt=BigInt(xt);for(let Vt=0;Vt<Nt;Vt++){const Ht=Vt*Ut;let Wt=Number(Bt&Kt);Bt>>=zt,Wt>Ut&&(Wt-=qt,Bt+=_1n$5);const Qt=Ht,Xt=Ht+Math.abs(Wt)-1,Jt=Vt%2!==0,tr=Wt<0;Wt===0?jt=jt.add(_t(Jt,kt[Qt])):Lt=Lt.add(_t(tr,kt[Xt]))}return{p:Lt,f:jt}},wNAFCached(xt,kt,Bt,Nt){const Ut=xt._WINDOW_SIZE||1;let Lt=kt.get(xt);return Lt||(Lt=this.precomputeWindow(xt,Ut),Ut!==1&&kt.set(xt,Nt(Lt))),this.wNAF(Ut,Lt,Bt)}}}function validateBasic($t){return validateField($t.Fp),validateObject($t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength($t.n,$t.nBitLength),...$t,p:$t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts($t){const e=validateBasic($t);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:_t,Fp:At,a:xt}=e;if(_t){if(!At.eql(xt,At.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof _t!="object"||typeof _t.beta!="bigint"||typeof _t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(e=""){super(e)}},_parseInt($t){const{Err:e}=DER;if($t.length<2||$t[0]!==2)throw new e("Invalid signature integer tag");const _t=$t[1],At=$t.subarray(2,_t+2);if(!_t||At.length!==_t)throw new e("Invalid signature integer: wrong length");if(At[0]&128)throw new e("Invalid signature integer: negative");if(At[0]===0&&!(At[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n(At),l:$t.subarray(_t+2)}},toSig($t){const{Err:e}=DER,_t=typeof $t=="string"?h2b($t):$t;if(!isBytes$3(_t))throw new Error("ui8a expected");let At=_t.length;if(At<2||_t[0]!=48)throw new e("Invalid signature tag");if(_t[1]!==At-2)throw new e("Invalid signature: incorrect length");const{d:xt,l:kt}=DER._parseInt(_t.subarray(2)),{d:Bt,l:Nt}=DER._parseInt(kt);if(Nt.length)throw new e("Invalid signature: left bytes after parsing");return{r:xt,s:Bt}},hexFromSig($t){const e=Lt=>Number.parseInt(Lt[0],16)&8?"00"+Lt:Lt,_t=Lt=>{const jt=Lt.toString(16);return jt.length&1?`0${jt}`:jt},At=e(_t($t.s)),xt=e(_t($t.r)),kt=At.length/2,Bt=xt.length/2,Nt=_t(kt),Ut=_t(Bt);return`30${_t(Bt+kt+4)}02${Ut}${xt}02${Nt}${At}`}},_0n$2=BigInt(0),_1n$4=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints($t){const e=validatePointOpts($t),{Fp:_t}=e,At=e.toBytes||((Vt,Ht,Wt)=>{const Qt=Ht.toAffine();return concatBytes(Uint8Array.from([4]),_t.toBytes(Qt.x),_t.toBytes(Qt.y))}),xt=e.fromBytes||(Vt=>{const Ht=Vt.subarray(1),Wt=_t.fromBytes(Ht.subarray(0,_t.BYTES)),Qt=_t.fromBytes(Ht.subarray(_t.BYTES,2*_t.BYTES));return{x:Wt,y:Qt}});function kt(Vt){const{a:Ht,b:Wt}=e,Qt=_t.sqr(Vt),Xt=_t.mul(Qt,Vt);return _t.add(_t.add(Xt,_t.mul(Vt,Ht)),Wt)}if(!_t.eql(_t.sqr(e.Gy),kt(e.Gx)))throw new Error("bad generator point: equation left != right");function Bt(Vt){return typeof Vt=="bigint"&&_0n$2<Vt&&Vt<e.n}function Nt(Vt){if(!Bt(Vt))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function Ut(Vt){const{allowedPrivateKeyLengths:Ht,nByteLength:Wt,wrapPrivateKey:Qt,n:Xt}=e;if(Ht&&typeof Vt!="bigint"){if(isBytes$3(Vt)&&(Vt=bytesToHex(Vt)),typeof Vt!="string"||!Ht.includes(Vt.length))throw new Error("Invalid key");Vt=Vt.padStart(Wt*2,"0")}let Jt;try{Jt=typeof Vt=="bigint"?Vt:bytesToNumberBE(ensureBytes$2("private key",Vt,Wt))}catch{throw new Error(`private key must be ${Wt} bytes, hex or bigint, not ${typeof Vt}`)}return Qt&&(Jt=mod(Jt,Xt)),Nt(Jt),Jt}const Lt=new Map;function jt(Vt){if(!(Vt instanceof Kt))throw new Error("ProjectivePoint expected")}class Kt{constructor(Ht,Wt,Qt){if(this.px=Ht,this.py=Wt,this.pz=Qt,Ht==null||!_t.isValid(Ht))throw new Error("x required");if(Wt==null||!_t.isValid(Wt))throw new Error("y required");if(Qt==null||!_t.isValid(Qt))throw new Error("z required")}static fromAffine(Ht){const{x:Wt,y:Qt}=Ht||{};if(!Ht||!_t.isValid(Wt)||!_t.isValid(Qt))throw new Error("invalid affine point");if(Ht instanceof Kt)throw new Error("projective point not allowed");const Xt=Jt=>_t.eql(Jt,_t.ZERO);return Xt(Wt)&&Xt(Qt)?Kt.ZERO:new Kt(Wt,Qt,_t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(Ht){const Wt=_t.invertBatch(Ht.map(Qt=>Qt.pz));return Ht.map((Qt,Xt)=>Qt.toAffine(Wt[Xt])).map(Kt.fromAffine)}static fromHex(Ht){const Wt=Kt.fromAffine(xt(ensureBytes$2("pointHex",Ht)));return Wt.assertValidity(),Wt}static fromPrivateKey(Ht){return Kt.BASE.multiply(Ut(Ht))}_setWindowSize(Ht){this._WINDOW_SIZE=Ht,Lt.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!_t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:Ht,y:Wt}=this.toAffine();if(!_t.isValid(Ht)||!_t.isValid(Wt))throw new Error("bad point: x or y not FE");const Qt=_t.sqr(Wt),Xt=kt(Ht);if(!_t.eql(Qt,Xt))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:Ht}=this.toAffine();if(_t.isOdd)return!_t.isOdd(Ht);throw new Error("Field doesn't support isOdd")}equals(Ht){jt(Ht);const{px:Wt,py:Qt,pz:Xt}=this,{px:Jt,py:tr,pz:dr}=Ht,vr=_t.eql(_t.mul(Wt,dr),_t.mul(Jt,Xt)),$r=_t.eql(_t.mul(Qt,dr),_t.mul(tr,Xt));return vr&&$r}negate(){return new Kt(this.px,_t.neg(this.py),this.pz)}double(){const{a:Ht,b:Wt}=e,Qt=_t.mul(Wt,_3n),{px:Xt,py:Jt,pz:tr}=this;let dr=_t.ZERO,vr=_t.ZERO,$r=_t.ZERO,Ir=_t.mul(Xt,Xt),Rr=_t.mul(Jt,Jt),Nr=_t.mul(tr,tr),kr=_t.mul(Xt,Jt);return kr=_t.add(kr,kr),$r=_t.mul(Xt,tr),$r=_t.add($r,$r),dr=_t.mul(Ht,$r),vr=_t.mul(Qt,Nr),vr=_t.add(dr,vr),dr=_t.sub(Rr,vr),vr=_t.add(Rr,vr),vr=_t.mul(dr,vr),dr=_t.mul(kr,dr),$r=_t.mul(Qt,$r),Nr=_t.mul(Ht,Nr),kr=_t.sub(Ir,Nr),kr=_t.mul(Ht,kr),kr=_t.add(kr,$r),$r=_t.add(Ir,Ir),Ir=_t.add($r,Ir),Ir=_t.add(Ir,Nr),Ir=_t.mul(Ir,kr),vr=_t.add(vr,Ir),Nr=_t.mul(Jt,tr),Nr=_t.add(Nr,Nr),Ir=_t.mul(Nr,kr),dr=_t.sub(dr,Ir),$r=_t.mul(Nr,Rr),$r=_t.add($r,$r),$r=_t.add($r,$r),new Kt(dr,vr,$r)}add(Ht){jt(Ht);const{px:Wt,py:Qt,pz:Xt}=this,{px:Jt,py:tr,pz:dr}=Ht;let vr=_t.ZERO,$r=_t.ZERO,Ir=_t.ZERO;const Rr=e.a,Nr=_t.mul(e.b,_3n);let kr=_t.mul(Wt,Jt),lr=_t.mul(Qt,tr),ir=_t.mul(Xt,dr),er=_t.add(Wt,Qt),rr=_t.add(Jt,tr);er=_t.mul(er,rr),rr=_t.add(kr,lr),er=_t.sub(er,rr),rr=_t.add(Wt,Xt);let yr=_t.add(Jt,dr);return rr=_t.mul(rr,yr),yr=_t.add(kr,ir),rr=_t.sub(rr,yr),yr=_t.add(Qt,Xt),vr=_t.add(tr,dr),yr=_t.mul(yr,vr),vr=_t.add(lr,ir),yr=_t.sub(yr,vr),Ir=_t.mul(Rr,rr),vr=_t.mul(Nr,ir),Ir=_t.add(vr,Ir),vr=_t.sub(lr,Ir),Ir=_t.add(lr,Ir),$r=_t.mul(vr,Ir),lr=_t.add(kr,kr),lr=_t.add(lr,kr),ir=_t.mul(Rr,ir),rr=_t.mul(Nr,rr),lr=_t.add(lr,ir),ir=_t.sub(kr,ir),ir=_t.mul(Rr,ir),rr=_t.add(rr,ir),kr=_t.mul(lr,rr),$r=_t.add($r,kr),kr=_t.mul(yr,rr),vr=_t.mul(er,vr),vr=_t.sub(vr,kr),kr=_t.mul(er,lr),Ir=_t.mul(yr,Ir),Ir=_t.add(Ir,kr),new Kt(vr,$r,Ir)}subtract(Ht){return this.add(Ht.negate())}is0(){return this.equals(Kt.ZERO)}wNAF(Ht){return zt.wNAFCached(this,Lt,Ht,Wt=>{const Qt=_t.invertBatch(Wt.map(Xt=>Xt.pz));return Wt.map((Xt,Jt)=>Xt.toAffine(Qt[Jt])).map(Kt.fromAffine)})}multiplyUnsafe(Ht){const Wt=Kt.ZERO;if(Ht===_0n$2)return Wt;if(Nt(Ht),Ht===_1n$4)return this;const{endo:Qt}=e;if(!Qt)return zt.unsafeLadder(this,Ht);let{k1neg:Xt,k1:Jt,k2neg:tr,k2:dr}=Qt.splitScalar(Ht),vr=Wt,$r=Wt,Ir=this;for(;Jt>_0n$2||dr>_0n$2;)Jt&_1n$4&&(vr=vr.add(Ir)),dr&_1n$4&&($r=$r.add(Ir)),Ir=Ir.double(),Jt>>=_1n$4,dr>>=_1n$4;return Xt&&(vr=vr.negate()),tr&&($r=$r.negate()),$r=new Kt(_t.mul($r.px,Qt.beta),$r.py,$r.pz),vr.add($r)}multiply(Ht){Nt(Ht);let Wt=Ht,Qt,Xt;const{endo:Jt}=e;if(Jt){const{k1neg:tr,k1:dr,k2neg:vr,k2:$r}=Jt.splitScalar(Wt);let{p:Ir,f:Rr}=this.wNAF(dr),{p:Nr,f:kr}=this.wNAF($r);Ir=zt.constTimeNegate(tr,Ir),Nr=zt.constTimeNegate(vr,Nr),Nr=new Kt(_t.mul(Nr.px,Jt.beta),Nr.py,Nr.pz),Qt=Ir.add(Nr),Xt=Rr.add(kr)}else{const{p:tr,f:dr}=this.wNAF(Wt);Qt=tr,Xt=dr}return Kt.normalizeZ([Qt,Xt])[0]}multiplyAndAddUnsafe(Ht,Wt,Qt){const Xt=Kt.BASE,Jt=(dr,vr)=>vr===_0n$2||vr===_1n$4||!dr.equals(Xt)?dr.multiplyUnsafe(vr):dr.multiply(vr),tr=Jt(this,Wt).add(Jt(Ht,Qt));return tr.is0()?void 0:tr}toAffine(Ht){const{px:Wt,py:Qt,pz:Xt}=this,Jt=this.is0();Ht==null&&(Ht=Jt?_t.ONE:_t.inv(Xt));const tr=_t.mul(Wt,Ht),dr=_t.mul(Qt,Ht),vr=_t.mul(Xt,Ht);if(Jt)return{x:_t.ZERO,y:_t.ZERO};if(!_t.eql(vr,_t.ONE))throw new Error("invZ was invalid");return{x:tr,y:dr}}isTorsionFree(){const{h:Ht,isTorsionFree:Wt}=e;if(Ht===_1n$4)return!0;if(Wt)return Wt(Kt,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:Ht,clearCofactor:Wt}=e;return Ht===_1n$4?this:Wt?Wt(Kt,this):this.multiplyUnsafe(e.h)}toRawBytes(Ht=!0){return this.assertValidity(),At(Kt,this,Ht)}toHex(Ht=!0){return bytesToHex(this.toRawBytes(Ht))}}Kt.BASE=new Kt(e.Gx,e.Gy,_t.ONE),Kt.ZERO=new Kt(_t.ZERO,_t.ONE,_t.ZERO);const qt=e.nBitLength,zt=wNAF(Kt,e.endo?Math.ceil(qt/2):qt);return{CURVE:e,ProjectivePoint:Kt,normPrivateKeyToScalar:Ut,weierstrassEquation:kt,isWithinCurveOrder:Bt}}function validateOpts$2($t){const e=validateBasic($t);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass($t){const e=validateOpts$2($t),{Fp:_t,n:At}=e,xt=_t.BYTES+1,kt=2*_t.BYTES+1;function Bt(rr){return _0n$2<rr&&rr<_t.ORDER}function Nt(rr){return mod(rr,At)}function Ut(rr){return invert(rr,At)}const{ProjectivePoint:Lt,normPrivateKeyToScalar:jt,weierstrassEquation:Kt,isWithinCurveOrder:qt}=weierstrassPoints({...e,toBytes(rr,yr,fr){const gr=yr.toAffine(),ar=_t.toBytes(gr.x),nr=concatBytes;return fr?nr(Uint8Array.from([yr.hasEvenY()?2:3]),ar):nr(Uint8Array.from([4]),ar,_t.toBytes(gr.y))},fromBytes(rr){const yr=rr.length,fr=rr[0],gr=rr.subarray(1);if(yr===xt&&(fr===2||fr===3)){const ar=bytesToNumberBE(gr);if(!Bt(ar))throw new Error("Point is not on curve");const nr=Kt(ar);let ur=_t.sqrt(nr);const pr=(ur&_1n$4)===_1n$4;return(fr&1)===1!==pr&&(ur=_t.neg(ur)),{x:ar,y:ur}}else if(yr===kt&&fr===4){const ar=_t.fromBytes(gr.subarray(0,_t.BYTES)),nr=_t.fromBytes(gr.subarray(_t.BYTES,2*_t.BYTES));return{x:ar,y:nr}}else throw new Error(`Point of length ${yr} was invalid. Expected ${xt} compressed bytes or ${kt} uncompressed bytes`)}}),zt=rr=>bytesToHex(numberToBytesBE(rr,e.nByteLength));function Vt(rr){const yr=At>>_1n$4;return rr>yr}function Ht(rr){return Vt(rr)?Nt(-rr):rr}const Wt=(rr,yr,fr)=>bytesToNumberBE(rr.slice(yr,fr));class Qt{constructor(yr,fr,gr){this.r=yr,this.s=fr,this.recovery=gr,this.assertValidity()}static fromCompact(yr){const fr=e.nByteLength;return yr=ensureBytes$2("compactSignature",yr,fr*2),new Qt(Wt(yr,0,fr),Wt(yr,fr,2*fr))}static fromDER(yr){const{r:fr,s:gr}=DER.toSig(ensureBytes$2("DER",yr));return new Qt(fr,gr)}assertValidity(){if(!qt(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!qt(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(yr){return new Qt(this.r,this.s,yr)}recoverPublicKey(yr){const{r:fr,s:gr,recovery:ar}=this,nr=$r(ensureBytes$2("msgHash",yr));if(ar==null||![0,1,2,3].includes(ar))throw new Error("recovery id invalid");const ur=ar===2||ar===3?fr+e.n:fr;if(ur>=_t.ORDER)throw new Error("recovery id 2 or 3 invalid");const pr=ar&1?"03":"02",br=Lt.fromHex(pr+zt(ur)),Sr=Ut(ur),Pr=Nt(-nr*Sr),Tr=Nt(gr*Sr),wr=Lt.BASE.multiplyAndAddUnsafe(br,Pr,Tr);if(!wr)throw new Error("point at infinify");return wr.assertValidity(),wr}hasHighS(){return Vt(this.s)}normalizeS(){return this.hasHighS()?new Qt(this.r,Nt(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return zt(this.r)+zt(this.s)}}const Xt={isValidPrivateKey(rr){try{return jt(rr),!0}catch{return!1}},normPrivateKeyToScalar:jt,randomPrivateKey:()=>{const rr=getMinHashLength(e.n);return mapHashToField(e.randomBytes(rr),e.n)},precompute(rr=8,yr=Lt.BASE){return yr._setWindowSize(rr),yr.multiply(BigInt(3)),yr}};function Jt(rr,yr=!0){return Lt.fromPrivateKey(rr).toRawBytes(yr)}function tr(rr){const yr=isBytes$3(rr),fr=typeof rr=="string",gr=(yr||fr)&&rr.length;return yr?gr===xt||gr===kt:fr?gr===2*xt||gr===2*kt:rr instanceof Lt}function dr(rr,yr,fr=!0){if(tr(rr))throw new Error("first arg must be private key");if(!tr(yr))throw new Error("second arg must be public key");return Lt.fromHex(yr).multiply(jt(rr)).toRawBytes(fr)}const vr=e.bits2int||function(rr){const yr=bytesToNumberBE(rr),fr=rr.length*8-e.nBitLength;return fr>0?yr>>BigInt(fr):yr},$r=e.bits2int_modN||function(rr){return Nt(vr(rr))},Ir=bitMask(e.nBitLength);function Rr(rr){if(typeof rr!="bigint")throw new Error("bigint expected");if(!(_0n$2<=rr&&rr<Ir))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE(rr,e.nByteLength)}function Nr(rr,yr,fr=kr){if(["recovered","canonical"].some(Mr=>Mr in fr))throw new Error("sign() legacy options not supported");const{hash:gr,randomBytes:ar}=e;let{lowS:nr,prehash:ur,extraEntropy:pr}=fr;nr==null&&(nr=!0),rr=ensureBytes$2("msgHash",rr),ur&&(rr=ensureBytes$2("prehashed msgHash",gr(rr)));const br=$r(rr),Sr=jt(yr),Pr=[Rr(Sr),Rr(br)];if(pr!=null){const Mr=pr===!0?ar(_t.BYTES):pr;Pr.push(ensureBytes$2("extraEntropy",Mr))}const Tr=concatBytes(...Pr),wr=br;function Ar(Mr){const Ur=vr(Mr);if(!qt(Ur))return;const Or=Ut(Ur),Cr=Lt.BASE.multiply(Ur).toAffine(),Er=Nt(Cr.x);if(Er===_0n$2)return;const Br=Nt(Or*Nt(wr+Er*Sr));if(Br===_0n$2)return;let Lr=(Cr.x===Er?0:2)|Number(Cr.y&_1n$4),xr=Br;return nr&&Vt(Br)&&(xr=Ht(Br),Lr^=1),new Qt(Er,xr,Lr)}return{seed:Tr,k2sig:Ar}}const kr={lowS:e.lowS,prehash:!1},lr={lowS:e.lowS,prehash:!1};function ir(rr,yr,fr=kr){const{seed:gr,k2sig:ar}=Nr(rr,yr,fr),nr=e;return createHmacDrbg(nr.hash.outputLen,nr.nByteLength,nr.hmac)(gr,ar)}Lt.BASE._setWindowSize(8);function er(rr,yr,fr,gr=lr){var Cr;const ar=rr;if(yr=ensureBytes$2("msgHash",yr),fr=ensureBytes$2("publicKey",fr),"strict"in gr)throw new Error("options.strict was renamed to lowS");const{lowS:nr,prehash:ur}=gr;let pr,br;try{if(typeof ar=="string"||isBytes$3(ar))try{pr=Qt.fromDER(ar)}catch(Er){if(!(Er instanceof DER.Err))throw Er;pr=Qt.fromCompact(ar)}else if(typeof ar=="object"&&typeof ar.r=="bigint"&&typeof ar.s=="bigint"){const{r:Er,s:Br}=ar;pr=new Qt(Er,Br)}else throw new Error("PARSE");br=Lt.fromHex(fr)}catch(Er){if(Er.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(nr&&pr.hasHighS())return!1;ur&&(yr=e.hash(yr));const{r:Sr,s:Pr}=pr,Tr=$r(yr),wr=Ut(Pr),Ar=Nt(Tr*wr),Mr=Nt(Sr*wr),Ur=(Cr=Lt.BASE.multiplyAndAddUnsafe(br,Ar,Mr))==null?void 0:Cr.toAffine();return Ur?Nt(Ur.x)===Sr:!1}return{CURVE:e,getPublicKey:Jt,getSharedSecret:dr,sign:ir,verify:er,ProjectivePoint:Lt,Signature:Qt,utils:Xt}}class HMAC extends Hash{constructor(e,_t){super(),this.finished=!1,this.destroyed=!1,hash(e);const At=toBytes$1(_t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const xt=this.blockLen,kt=new Uint8Array(xt);kt.set(At.length>xt?e.create().update(At).digest():At);for(let Bt=0;Bt<kt.length;Bt++)kt[Bt]^=54;this.iHash.update(kt),this.oHash=e.create();for(let Bt=0;Bt<kt.length;Bt++)kt[Bt]^=106;this.oHash.update(kt),kt.fill(0)}update(e){return exists$1(this),this.iHash.update(e),this}digestInto(e){exists$1(this),bytes$1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:_t,iHash:At,finished:xt,destroyed:kt,blockLen:Bt,outputLen:Nt}=this;return e=e,e.finished=xt,e.destroyed=kt,e.blockLen=Bt,e.outputLen=Nt,e.oHash=_t._cloneInto(e.oHash),e.iHash=At._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=($t,e,_t)=>new HMAC($t,e).update(_t).digest();hmac.create=($t,e)=>new HMAC($t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash($t){return{hash:$t,hmac:(e,..._t)=>hmac($t,e,concatBytes$1(..._t)),randomBytes:randomBytes$1}}function createCurve($t,e){const _t=At=>weierstrass({...$t,...getHash(At)});return Object.freeze({..._t(e),create:_t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$3=BigInt(1),_2n$2=BigInt(2),divNearest=($t,e)=>($t+e/_2n$2)/e;function sqrtMod($t){const e=secp256k1P,_t=BigInt(3),At=BigInt(6),xt=BigInt(11),kt=BigInt(22),Bt=BigInt(23),Nt=BigInt(44),Ut=BigInt(88),Lt=$t*$t*$t%e,jt=Lt*Lt*$t%e,Kt=pow2(jt,_t,e)*jt%e,qt=pow2(Kt,_t,e)*jt%e,zt=pow2(qt,_2n$2,e)*Lt%e,Vt=pow2(zt,xt,e)*zt%e,Ht=pow2(Vt,kt,e)*Vt%e,Wt=pow2(Ht,Nt,e)*Ht%e,Qt=pow2(Wt,Ut,e)*Wt%e,Xt=pow2(Qt,Nt,e)*Ht%e,Jt=pow2(Xt,_t,e)*jt%e,tr=pow2(Jt,Bt,e)*Vt%e,dr=pow2(tr,At,e)*Lt%e,vr=pow2(dr,_2n$2,e);if(!Fp$2.eql(Fp$2.sqr(vr),$t))throw new Error("Cannot find square root");return vr}const Fp$2=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fp$2,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:$t=>{const e=secp256k1N,_t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),At=-_1n$3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),xt=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),kt=_t,Bt=BigInt("0x100000000000000000000000000000000"),Nt=divNearest(kt*$t,e),Ut=divNearest(-At*$t,e);let Lt=mod($t-Nt*_t-Ut*xt,e),jt=mod(-Nt*At-Ut*kt,e);const Kt=Lt>Bt,qt=jt>Bt;if(Kt&&(Lt=e-Lt),qt&&(jt=e-jt),Lt>Bt||jt>Bt)throw new Error("splitScalar: Endomorphism failed, k="+$t);return{k1neg:Kt,k1:Lt,k2neg:qt,k2:jt}}}},sha256);BigInt(0);secp256k1.ProjectivePoint;function canonicalize$4($t){const e=At=>{if(At!==null&&typeof At=="object"&&!Array.isArray(At)){const xt=Object.keys(At).sort(),kt={};for(const Bt of xt)kt[Bt]=e(At[Bt]);return kt}return At},_t=e($t);return JSON.stringify(_t)}var __awaiter$1U=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const KEY_URI_PREFIX_JWK$2="urn:jwk:";function computeJwkThumbprint$2($t){return __awaiter$1U(this,arguments,void 0,function*({jwk:e}){const _t=e.kty;let At;if(_t==="EC")At={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(_t==="oct")At={k:e.k,kty:e.kty};else if(_t==="OKP")At={crv:e.crv,kty:e.kty,x:e.x};else if(_t==="RSA")At={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${_t}`);removeUndefinedProperties$1(At);const xt=canonicalize$4(At),kt=Convert$1.string(xt).toUint8Array(),Bt=yield Sha256$2.digest({data:kt});return Convert$1.uint8Array(Bt).toBase64Url()})}function isEcPrivateJwk$2($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t&&"d"in $t)||$t.kty!=="EC"||typeof $t.d!="string"||typeof $t.x!="string")}function isEcPublicJwk$2($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t)||"d"in $t||$t.kty!=="EC"||typeof $t.x!="string")}function isOkpPrivateJwk$2($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t&&"d"in $t)||$t.kty!=="OKP"||typeof $t.d!="string"||typeof $t.x!="string")}function isOkpPublicJwk$2($t){return!(!$t||typeof $t!="object"||"d"in $t||!("kty"in $t&&"crv"in $t&&"x"in $t)||$t.kty!=="OKP"||typeof $t.x!="string")}function isPrivateJwk$2($t){if(!$t||typeof $t!="object")return!1;switch($t.kty){case"EC":case"OKP":case"RSA":return"d"in $t;case"oct":return"k"in $t;default:return!1}}var __awaiter$1T=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$t=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Secp256k1$2=class Ti{static adjustSignatureToLowS(e){return __awaiter$1T(this,arguments,void 0,function*({signature:_t}){const At=secp256k1.Signature.fromCompact(_t);return At.hasHighS()?At.normalizeS().toCompactRawBytes():_t})}static bytesToPrivateKey(e){return __awaiter$1T(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=yield Ti.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"secp256k1",d:Convert$1.uint8Array(_t).toBase64Url(),x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$2({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:_t}){const At=yield Ti.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"secp256k1",x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$2({jwk:xt}),xt})}static compressPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256k1.ProjectivePoint.fromHex(_t).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({key:_t}){const At=yield Ti.privateKeyToBytes({privateKey:_t}),xt=yield Ti.getCurvePoint({keyBytes:At}),kt={kty:"EC",crv:"secp256k1",x:Convert$1.uint8Array(xt.x).toBase64Url(),y:Convert$1.uint8Array(xt.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static convertDerToCompactSignature(e){return __awaiter$1T(this,arguments,void 0,function*({derSignature:_t}){return secp256k1.Signature.fromDER(_t).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256k1.ProjectivePoint.fromHex(_t).toRawBytes(!1)})}static generateKey(){return __awaiter$1T(this,void 0,void 0,function*(){const e=secp256k1.utils.randomPrivateKey(),_t=yield Ti.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$2({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({key:_t}){var At;if(!(isEcPrivateJwk$2(_t)&&_t.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let xt=__rest$t(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$2({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1T(this,arguments,void 0,function*({privateKey:_t}){if(!isEcPrivateJwk$2(_t))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1T(this,arguments,void 0,function*({publicKey:_t}){if(!(isEcPublicJwk$2(_t)&&_t.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const At=new Uint8Array([4]),xt=Convert$1.base64Url(_t.x).toUint8Array(),kt=Convert$1.base64Url(_t.y).toUint8Array();return new Uint8Array([...At,...xt,...kt])})}static sharedSecret(e){return __awaiter$1T(this,arguments,void 0,function*({privateKeyA:_t,publicKeyB:At}){if("x"in _t&&"x"in At&&_t.x===At.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const xt=yield Ti.privateKeyToBytes({privateKey:_t}),kt=yield Ti.publicKeyToBytes({publicKey:At});return secp256k1.getSharedSecret(xt,kt,!0).slice(1)})}static sign(e){return __awaiter$1T(this,arguments,void 0,function*({data:_t,key:At}){const xt=yield Ti.privateKeyToBytes({privateKey:At}),kt=sha256$5(_t);return secp256k1.sign(kt,xt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$1T(this,arguments,void 0,function*({privateKeyBytes:_t}){return secp256k1.utils.isValidPrivateKey(_t)})}static validatePublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:_t}){try{secp256k1.ProjectivePoint.fromHex(_t).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1T(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=yield Ti.publicKeyToBytes({publicKey:_t}),Bt=sha256$5(xt);return secp256k1.verify(At,Bt,kt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$1T(this,arguments,void 0,function*({keyBytes:_t}){_t.byteLength===32&&(_t=secp256k1.getPublicKey(_t));const At=secp256k1.ProjectivePoint.fromHex(_t),xt=numberToBytesBE(At.x,32),kt=numberToBytesBE(At.y,32);return{x:xt,y:kt}})}};/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fp$1=Field(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),CURVE_A=Fp$1.create(BigInt("-3")),CURVE_B=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),p256=createCurve({a:CURVE_A,b:CURVE_B,Fp:Fp$1,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},sha256),secp256r1=p256;var __awaiter$1S=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$s=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Secp256r1$2=class Ii{static adjustSignatureToLowS(e){return __awaiter$1S(this,arguments,void 0,function*({signature:_t}){const At=secp256r1.Signature.fromCompact(_t);return At.hasHighS()?At.normalizeS().toCompactRawBytes():_t})}static bytesToPrivateKey(e){return __awaiter$1S(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=yield Ii.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"P-256",d:Convert$1.uint8Array(_t).toBase64Url(),x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$2({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:_t}){const At=yield Ii.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"P-256",x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$2({jwk:xt}),xt})}static compressPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256r1.ProjectivePoint.fromHex(_t).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({key:_t}){const At=yield Ii.privateKeyToBytes({privateKey:_t}),xt=yield Ii.getCurvePoint({keyBytes:At}),kt={kty:"EC",crv:"P-256",x:Convert$1.uint8Array(xt.x).toBase64Url(),y:Convert$1.uint8Array(xt.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static convertDerToCompactSignature(e){return __awaiter$1S(this,arguments,void 0,function*({derSignature:_t}){return secp256r1.Signature.fromDER(_t).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256r1.ProjectivePoint.fromHex(_t).toRawBytes(!1)})}static generateKey(){return __awaiter$1S(this,void 0,void 0,function*(){const e=secp256r1.utils.randomPrivateKey(),_t=yield Ii.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$2({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({key:_t}){var At;if(!(isEcPrivateJwk$2(_t)&&_t.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let xt=__rest$s(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$2({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1S(this,arguments,void 0,function*({privateKey:_t}){if(!isEcPrivateJwk$2(_t))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1S(this,arguments,void 0,function*({publicKey:_t}){if(!(isEcPublicJwk$2(_t)&&_t.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const At=new Uint8Array([4]),xt=Convert$1.base64Url(_t.x).toUint8Array(),kt=Convert$1.base64Url(_t.y).toUint8Array();return new Uint8Array([...At,...xt,...kt])})}static sharedSecret(e){return __awaiter$1S(this,arguments,void 0,function*({privateKeyA:_t,publicKeyB:At}){if("x"in _t&&"x"in At&&_t.x===At.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const xt=yield Ii.privateKeyToBytes({privateKey:_t}),kt=yield Ii.publicKeyToBytes({publicKey:At});return secp256r1.getSharedSecret(xt,kt,!0).slice(1)})}static sign(e){return __awaiter$1S(this,arguments,void 0,function*({data:_t,key:At}){const xt=yield Ii.privateKeyToBytes({privateKey:At}),kt=sha256$5(_t);return secp256r1.sign(kt,xt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$1S(this,arguments,void 0,function*({privateKeyBytes:_t}){return secp256r1.utils.isValidPrivateKey(_t)})}static validatePublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:_t}){try{secp256r1.ProjectivePoint.fromHex(_t).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1S(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=yield Ii.publicKeyToBytes({publicKey:_t}),Bt=sha256$5(xt);return secp256r1.verify(At,Bt,kt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$1S(this,arguments,void 0,function*({keyBytes:_t}){_t.byteLength===32&&(_t=secp256r1.getPublicKey(_t));const At=secp256r1.ProjectivePoint.fromHex(_t),xt=numberToBytesBE(At.x,32),kt=numberToBytesBE(At.y,32);return{x:xt,y:kt}})}};var __awaiter$1R=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let EcdsaAlgorithm$3=class extends CryptoAlgorithm$2{computePublicKey(e){return __awaiter$1R(this,arguments,void 0,function*({key:_t}){if(!isEcPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(_t.crv){case"secp256k1":{const At=yield Secp256k1$2.computePublicKey({key:_t});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$2.computePublicKey({key:_t});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}generateKey(e){return __awaiter$1R(this,arguments,void 0,function*({algorithm:_t}){switch(_t){case"ES256K":case"secp256k1":{const At=yield Secp256k1$2.generateKey();return At.alg="ES256K",At}case"ES256":case"secp256r1":{const At=yield Secp256r1$2.generateKey();return At.alg="ES256",At}}})}getPublicKey(e){return __awaiter$1R(this,arguments,void 0,function*({key:_t}){if(!isEcPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(_t.crv){case"secp256k1":{const At=yield Secp256k1$2.getPublicKey({key:_t});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$2.getPublicKey({key:_t});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}sign(e){return __awaiter$1R(this,arguments,void 0,function*({key:_t,data:At}){if(!isEcPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(_t.crv){case"secp256k1":return yield Secp256k1$2.sign({key:_t,data:At});case"P-256":return yield Secp256r1$2.sign({key:_t,data:At});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}verify(e){return __awaiter$1R(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){if(!isEcPublicJwk$2(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(_t.crv){case"secp256k1":return yield Secp256k1$2.verify({key:_t,signature:At,data:xt});case"P-256":return yield Secp256r1$2.verify({key:_t,signature:At,data:xt});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}};const U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig($t,e=!1){return e?{h:Number($t&U32_MASK64),l:Number($t>>_32n&U32_MASK64)}:{h:Number($t>>_32n&U32_MASK64)|0,l:Number($t&U32_MASK64)|0}}function split($t,e=!1){let _t=new Uint32Array($t.length),At=new Uint32Array($t.length);for(let xt=0;xt<$t.length;xt++){const{h:kt,l:Bt}=fromBig($t[xt],e);[_t[xt],At[xt]]=[kt,Bt]}return[_t,At]}const toBig=($t,e)=>BigInt($t>>>0)<<_32n|BigInt(e>>>0),shrSH=($t,e,_t)=>$t>>>_t,shrSL=($t,e,_t)=>$t<<32-_t|e>>>_t,rotrSH=($t,e,_t)=>$t>>>_t|e<<32-_t,rotrSL=($t,e,_t)=>$t<<32-_t|e>>>_t,rotrBH=($t,e,_t)=>$t<<64-_t|e>>>_t-32,rotrBL=($t,e,_t)=>$t>>>_t-32|e<<64-_t,rotr32H=($t,e)=>e,rotr32L=($t,e)=>$t,rotlSH=($t,e,_t)=>$t<<_t|e>>>32-_t,rotlSL=($t,e,_t)=>e<<_t|$t>>>32-_t,rotlBH=($t,e,_t)=>e<<_t-32|$t>>>64-_t,rotlBL=($t,e,_t)=>$t<<_t-32|e>>>64-_t;function add($t,e,_t,At){const xt=(e>>>0)+(At>>>0);return{h:$t+_t+(xt/2**32|0)|0,l:xt|0}}const add3L=($t,e,_t)=>($t>>>0)+(e>>>0)+(_t>>>0),add3H=($t,e,_t,At)=>e+_t+At+($t/2**32|0)|0,add4L=($t,e,_t,At)=>($t>>>0)+(e>>>0)+(_t>>>0)+(At>>>0),add4H=($t,e,_t,At,xt)=>e+_t+At+xt+($t/2**32|0)|0,add5L=($t,e,_t,At,xt)=>($t>>>0)+(e>>>0)+(_t>>>0)+(At>>>0)+(xt>>>0),add5H=($t,e,_t,At,xt,kt)=>e+_t+At+xt+kt+($t/2**32|0)|0,u64={fromBig,split,toBig,shrSH,shrSL,rotrSH,rotrSL,rotrBH,rotrBL,rotr32H,rotr32L,rotlSH,rotlSL,rotlBH,rotlBL,add,add3L,add3H,add4L,add4H,add5H,add5L},[SHA512_Kh,SHA512_Kl]=u64.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map($t=>BigInt($t))),SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:_t,Bh:At,Bl:xt,Ch:kt,Cl:Bt,Dh:Nt,Dl:Ut,Eh:Lt,El:jt,Fh:Kt,Fl:qt,Gh:zt,Gl:Vt,Hh:Ht,Hl:Wt}=this;return[e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt]}set(e,_t,At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt){this.Ah=e|0,this.Al=_t|0,this.Bh=At|0,this.Bl=xt|0,this.Ch=kt|0,this.Cl=Bt|0,this.Dh=Nt|0,this.Dl=Ut|0,this.Eh=Lt|0,this.El=jt|0,this.Fh=Kt|0,this.Fl=qt|0,this.Gh=zt|0,this.Gl=Vt|0,this.Hh=Ht|0,this.Hl=Wt|0}process(e,_t){for(let Jt=0;Jt<16;Jt++,_t+=4)SHA512_W_H[Jt]=e.getUint32(_t),SHA512_W_L[Jt]=e.getUint32(_t+=4);for(let Jt=16;Jt<80;Jt++){const tr=SHA512_W_H[Jt-15]|0,dr=SHA512_W_L[Jt-15]|0,vr=u64.rotrSH(tr,dr,1)^u64.rotrSH(tr,dr,8)^u64.shrSH(tr,dr,7),$r=u64.rotrSL(tr,dr,1)^u64.rotrSL(tr,dr,8)^u64.shrSL(tr,dr,7),Ir=SHA512_W_H[Jt-2]|0,Rr=SHA512_W_L[Jt-2]|0,Nr=u64.rotrSH(Ir,Rr,19)^u64.rotrBH(Ir,Rr,61)^u64.shrSH(Ir,Rr,6),kr=u64.rotrSL(Ir,Rr,19)^u64.rotrBL(Ir,Rr,61)^u64.shrSL(Ir,Rr,6),lr=u64.add4L($r,kr,SHA512_W_L[Jt-7],SHA512_W_L[Jt-16]),ir=u64.add4H(lr,vr,Nr,SHA512_W_H[Jt-7],SHA512_W_H[Jt-16]);SHA512_W_H[Jt]=ir|0,SHA512_W_L[Jt]=lr|0}let{Ah:At,Al:xt,Bh:kt,Bl:Bt,Ch:Nt,Cl:Ut,Dh:Lt,Dl:jt,Eh:Kt,El:qt,Fh:zt,Fl:Vt,Gh:Ht,Gl:Wt,Hh:Qt,Hl:Xt}=this;for(let Jt=0;Jt<80;Jt++){const tr=u64.rotrSH(Kt,qt,14)^u64.rotrSH(Kt,qt,18)^u64.rotrBH(Kt,qt,41),dr=u64.rotrSL(Kt,qt,14)^u64.rotrSL(Kt,qt,18)^u64.rotrBL(Kt,qt,41),vr=Kt&zt^~Kt&Ht,$r=qt&Vt^~qt&Wt,Ir=u64.add5L(Xt,dr,$r,SHA512_Kl[Jt],SHA512_W_L[Jt]),Rr=u64.add5H(Ir,Qt,tr,vr,SHA512_Kh[Jt],SHA512_W_H[Jt]),Nr=Ir|0,kr=u64.rotrSH(At,xt,28)^u64.rotrBH(At,xt,34)^u64.rotrBH(At,xt,39),lr=u64.rotrSL(At,xt,28)^u64.rotrBL(At,xt,34)^u64.rotrBL(At,xt,39),ir=At&kt^At&Nt^kt&Nt,er=xt&Bt^xt&Ut^Bt&Ut;Qt=Ht|0,Xt=Wt|0,Ht=zt|0,Wt=Vt|0,zt=Kt|0,Vt=qt|0,{h:Kt,l:qt}=u64.add(Lt|0,jt|0,Rr|0,Nr|0),Lt=Nt|0,jt=Ut|0,Nt=kt|0,Ut=Bt|0,kt=At|0,Bt=xt|0;const rr=u64.add3L(Nr,lr,er);At=u64.add3H(rr,Rr,kr,ir),xt=rr|0}({h:At,l:xt}=u64.add(this.Ah|0,this.Al|0,At|0,xt|0)),{h:kt,l:Bt}=u64.add(this.Bh|0,this.Bl|0,kt|0,Bt|0),{h:Nt,l:Ut}=u64.add(this.Ch|0,this.Cl|0,Nt|0,Ut|0),{h:Lt,l:jt}=u64.add(this.Dh|0,this.Dl|0,Lt|0,jt|0),{h:Kt,l:qt}=u64.add(this.Eh|0,this.El|0,Kt|0,qt|0),{h:zt,l:Vt}=u64.add(this.Fh|0,this.Fl|0,zt|0,Vt|0),{h:Ht,l:Wt}=u64.add(this.Gh|0,this.Gl|0,Ht|0,Wt|0),{h:Qt,l:Xt}=u64.add(this.Hh|0,this.Hl|0,Qt|0,Xt|0),this.set(At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt,Vt,Ht,Wt,Qt,Xt)}roundClean(){SHA512_W_H.fill(0),SHA512_W_L.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha512=wrapConstructor(()=>new SHA512);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$1=BigInt(0),_1n$2=BigInt(1),_2n$1=BigInt(2),_8n=BigInt(8),VERIFY_DEFAULT={zip215:!0};function validateOpts$1($t){const e=validateBasic($t);return validateObject($t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function twistedEdwards($t){const e=validateOpts$1($t),{Fp:_t,n:At,prehash:xt,hash:kt,randomBytes:Bt,nByteLength:Nt,h:Ut}=e,Lt=_2n$1<<BigInt(Nt*8)-_1n$2,jt=_t.create,Kt=e.uvRatio||((gr,ar)=>{try{return{isValid:!0,value:_t.sqrt(gr*_t.inv(ar))}}catch{return{isValid:!1,value:_0n$1}}}),qt=e.adjustScalarBytes||(gr=>gr),zt=e.domain||((gr,ar,nr)=>{if(ar.length||nr)throw new Error("Contexts/pre-hash are not supported");return gr}),Vt=gr=>typeof gr=="bigint"&&_0n$1<gr,Ht=(gr,ar)=>Vt(gr)&&Vt(ar)&&gr<ar,Wt=gr=>gr===_0n$1||Ht(gr,Lt);function Qt(gr,ar){if(Ht(gr,ar))return gr;throw new Error(`Expected valid scalar < ${ar}, got ${typeof gr} ${gr}`)}function Xt(gr){return gr===_0n$1?gr:Qt(gr,At)}const Jt=new Map;function tr(gr){if(!(gr instanceof dr))throw new Error("ExtendedPoint expected")}class dr{constructor(ar,nr,ur,pr){if(this.ex=ar,this.ey=nr,this.ez=ur,this.et=pr,!Wt(ar))throw new Error("x required");if(!Wt(nr))throw new Error("y required");if(!Wt(ur))throw new Error("z required");if(!Wt(pr))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(ar){if(ar instanceof dr)throw new Error("extended point not allowed");const{x:nr,y:ur}=ar||{};if(!Wt(nr)||!Wt(ur))throw new Error("invalid affine point");return new dr(nr,ur,_1n$2,jt(nr*ur))}static normalizeZ(ar){const nr=_t.invertBatch(ar.map(ur=>ur.ez));return ar.map((ur,pr)=>ur.toAffine(nr[pr])).map(dr.fromAffine)}_setWindowSize(ar){this._WINDOW_SIZE=ar,Jt.delete(this)}assertValidity(){const{a:ar,d:nr}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:ur,ey:pr,ez:br,et:Sr}=this,Pr=jt(ur*ur),Tr=jt(pr*pr),wr=jt(br*br),Ar=jt(wr*wr),Mr=jt(Pr*ar),Ur=jt(wr*jt(Mr+Tr)),Or=jt(Ar+jt(nr*jt(Pr*Tr)));if(Ur!==Or)throw new Error("bad point: equation left != right (1)");const Cr=jt(ur*pr),Er=jt(br*Sr);if(Cr!==Er)throw new Error("bad point: equation left != right (2)")}equals(ar){tr(ar);const{ex:nr,ey:ur,ez:pr}=this,{ex:br,ey:Sr,ez:Pr}=ar,Tr=jt(nr*Pr),wr=jt(br*pr),Ar=jt(ur*Pr),Mr=jt(Sr*pr);return Tr===wr&&Ar===Mr}is0(){return this.equals(dr.ZERO)}negate(){return new dr(jt(-this.ex),this.ey,this.ez,jt(-this.et))}double(){const{a:ar}=e,{ex:nr,ey:ur,ez:pr}=this,br=jt(nr*nr),Sr=jt(ur*ur),Pr=jt(_2n$1*jt(pr*pr)),Tr=jt(ar*br),wr=nr+ur,Ar=jt(jt(wr*wr)-br-Sr),Mr=Tr+Sr,Ur=Mr-Pr,Or=Tr-Sr,Cr=jt(Ar*Ur),Er=jt(Mr*Or),Br=jt(Ar*Or),Lr=jt(Ur*Mr);return new dr(Cr,Er,Lr,Br)}add(ar){tr(ar);const{a:nr,d:ur}=e,{ex:pr,ey:br,ez:Sr,et:Pr}=this,{ex:Tr,ey:wr,ez:Ar,et:Mr}=ar;if(nr===BigInt(-1)){const Yr=jt((br-pr)*(wr+Tr)),an=jt((br+pr)*(wr-Tr)),cn=jt(an-Yr);if(cn===_0n$1)return this.double();const Gr=jt(Sr*_2n$1*Mr),Fr=jt(Pr*_2n$1*Ar),en=Fr+Gr,nn=an+Yr,rn=Fr-Gr,hn=jt(en*cn),yn=jt(nn*rn),wn=jt(en*rn),mn=jt(cn*nn);return new dr(hn,yn,mn,wn)}const Ur=jt(pr*Tr),Or=jt(br*wr),Cr=jt(Pr*ur*Mr),Er=jt(Sr*Ar),Br=jt((pr+br)*(Tr+wr)-Ur-Or),Lr=Er-Cr,xr=Er+Cr,_r=jt(Or-nr*Ur),Dr=jt(Br*Lr),jr=jt(xr*_r),Hr=jt(Br*_r),Qr=jt(Lr*xr);return new dr(Dr,jr,Qr,Hr)}subtract(ar){return this.add(ar.negate())}wNAF(ar){return Ir.wNAFCached(this,Jt,ar,dr.normalizeZ)}multiply(ar){const{p:nr,f:ur}=this.wNAF(Qt(ar,At));return dr.normalizeZ([nr,ur])[0]}multiplyUnsafe(ar){let nr=Xt(ar);return nr===_0n$1?$r:this.equals($r)||nr===_1n$2?this:this.equals(vr)?this.wNAF(nr).p:Ir.unsafeLadder(this,nr)}isSmallOrder(){return this.multiplyUnsafe(Ut).is0()}isTorsionFree(){return Ir.unsafeLadder(this,At).is0()}toAffine(ar){const{ex:nr,ey:ur,ez:pr}=this,br=this.is0();ar==null&&(ar=br?_8n:_t.inv(pr));const Sr=jt(nr*ar),Pr=jt(ur*ar),Tr=jt(pr*ar);if(br)return{x:_0n$1,y:_1n$2};if(Tr!==_1n$2)throw new Error("invZ was invalid");return{x:Sr,y:Pr}}clearCofactor(){const{h:ar}=e;return ar===_1n$2?this:this.multiplyUnsafe(ar)}static fromHex(ar,nr=!1){const{d:ur,a:pr}=e,br=_t.BYTES;ar=ensureBytes$2("pointHex",ar,br);const Sr=ar.slice(),Pr=ar[br-1];Sr[br-1]=Pr&-129;const Tr=bytesToNumberLE(Sr);Tr===_0n$1||(nr?Qt(Tr,Lt):Qt(Tr,_t.ORDER));const wr=jt(Tr*Tr),Ar=jt(wr-_1n$2),Mr=jt(ur*wr-pr);let{isValid:Ur,value:Or}=Kt(Ar,Mr);if(!Ur)throw new Error("Point.fromHex: invalid y coordinate");const Cr=(Or&_1n$2)===_1n$2,Er=(Pr&128)!==0;if(!nr&&Or===_0n$1&&Er)throw new Error("Point.fromHex: x=0 and x_0=1");return Er!==Cr&&(Or=jt(-Or)),dr.fromAffine({x:Or,y:Tr})}static fromPrivateKey(ar){return kr(ar).point}toRawBytes(){const{x:ar,y:nr}=this.toAffine(),ur=numberToBytesLE(nr,_t.BYTES);return ur[ur.length-1]|=ar&_1n$2?128:0,ur}toHex(){return bytesToHex(this.toRawBytes())}}dr.BASE=new dr(e.Gx,e.Gy,_1n$2,jt(e.Gx*e.Gy)),dr.ZERO=new dr(_0n$1,_1n$2,_1n$2,_0n$1);const{BASE:vr,ZERO:$r}=dr,Ir=wNAF(dr,Nt*8);function Rr(gr){return mod(gr,At)}function Nr(gr){return Rr(bytesToNumberLE(gr))}function kr(gr){const ar=Nt;gr=ensureBytes$2("private key",gr,ar);const nr=ensureBytes$2("hashed private key",kt(gr),2*ar),ur=qt(nr.slice(0,ar)),pr=nr.slice(ar,2*ar),br=Nr(ur),Sr=vr.multiply(br),Pr=Sr.toRawBytes();return{head:ur,prefix:pr,scalar:br,point:Sr,pointBytes:Pr}}function lr(gr){return kr(gr).pointBytes}function ir(gr=new Uint8Array,...ar){const nr=concatBytes(...ar);return Nr(kt(zt(nr,ensureBytes$2("context",gr),!!xt)))}function er(gr,ar,nr={}){gr=ensureBytes$2("message",gr),xt&&(gr=xt(gr));const{prefix:ur,scalar:pr,pointBytes:br}=kr(ar),Sr=ir(nr.context,ur,gr),Pr=vr.multiply(Sr).toRawBytes(),Tr=ir(nr.context,Pr,br,gr),wr=Rr(Sr+Tr*pr);Xt(wr);const Ar=concatBytes(Pr,numberToBytesLE(wr,_t.BYTES));return ensureBytes$2("result",Ar,Nt*2)}const rr=VERIFY_DEFAULT;function yr(gr,ar,nr,ur=rr){const{context:pr,zip215:br}=ur,Sr=_t.BYTES;gr=ensureBytes$2("signature",gr,2*Sr),ar=ensureBytes$2("message",ar),xt&&(ar=xt(ar));const Pr=bytesToNumberLE(gr.slice(Sr,2*Sr));let Tr,wr,Ar;try{Tr=dr.fromHex(nr,br),wr=dr.fromHex(gr.slice(0,Sr),br),Ar=vr.multiplyUnsafe(Pr)}catch{return!1}if(!br&&Tr.isSmallOrder())return!1;const Mr=ir(pr,wr.toRawBytes(),Tr.toRawBytes(),ar);return wr.add(Tr.multiplyUnsafe(Mr)).subtract(Ar).clearCofactor().equals(dr.ZERO)}return vr._setWindowSize(8),{CURVE:e,getPublicKey:lr,sign:er,verify:yr,ExtendedPoint:dr,utils:{getExtendedPublicKey:kr,randomPrivateKey:()=>Bt(_t.BYTES),precompute(gr=8,ar=dr.BASE){return ar._setWindowSize(gr),ar.multiply(BigInt(3)),ar}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n=BigInt(0),_1n$1=BigInt(1);function validateOpts($t){return validateObject($t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...$t})}function montgomery($t){const e=validateOpts($t),{P:_t}=e,At=Jt=>mod(Jt,_t),xt=e.montgomeryBits,kt=Math.ceil(xt/8),Bt=e.nByteLength,Nt=e.adjustScalarBytes||(Jt=>Jt),Ut=e.powPminus2||(Jt=>pow(Jt,_t-BigInt(2),_t));function Lt(Jt,tr,dr){const vr=At(Jt*(tr-dr));return tr=At(tr-vr),dr=At(dr+vr),[tr,dr]}function jt(Jt){if(typeof Jt=="bigint"&&_0n<=Jt&&Jt<_t)return Jt;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const Kt=(e.a-BigInt(2))/BigInt(4);function qt(Jt,tr){const dr=jt(Jt),vr=jt(tr),$r=dr;let Ir=_1n$1,Rr=_0n,Nr=dr,kr=_1n$1,lr=_0n,ir;for(let rr=BigInt(xt-1);rr>=_0n;rr--){const yr=vr>>rr&_1n$1;lr^=yr,ir=Lt(lr,Ir,Nr),Ir=ir[0],Nr=ir[1],ir=Lt(lr,Rr,kr),Rr=ir[0],kr=ir[1],lr=yr;const fr=Ir+Rr,gr=At(fr*fr),ar=Ir-Rr,nr=At(ar*ar),ur=gr-nr,pr=Nr+kr,br=Nr-kr,Sr=At(br*fr),Pr=At(pr*ar),Tr=Sr+Pr,wr=Sr-Pr;Nr=At(Tr*Tr),kr=At($r*At(wr*wr)),Ir=At(gr*nr),Rr=At(ur*(gr+At(Kt*ur)))}ir=Lt(lr,Ir,Nr),Ir=ir[0],Nr=ir[1],ir=Lt(lr,Rr,kr),Rr=ir[0],kr=ir[1];const er=Ut(Rr);return At(Ir*er)}function zt(Jt){return numberToBytesLE(At(Jt),kt)}function Vt(Jt){const tr=ensureBytes$2("u coordinate",Jt,kt);return Bt===32&&(tr[31]&=127),bytesToNumberLE(tr)}function Ht(Jt){const tr=ensureBytes$2("scalar",Jt),dr=tr.length;if(dr!==kt&&dr!==Bt)throw new Error(`Expected ${kt} or ${Bt} bytes, got ${dr}`);return bytesToNumberLE(Nt(tr))}function Wt(Jt,tr){const dr=Vt(tr),vr=Ht(Jt),$r=qt(dr,vr);if($r===_0n)throw new Error("Invalid private or public key received");return zt($r)}const Qt=zt(e.Gu);function Xt(Jt){return Wt(Jt,Qt)}return{scalarMult:Wt,scalarMultBase:Xt,getSharedSecret:(Jt,tr)=>Wt(Jt,tr),getPublicKey:Jt=>Xt(Jt),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:Qt}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ED25519_P=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const _1n=BigInt(1),_2n=BigInt(2),_5n=BigInt(5),_10n=BigInt(10),_20n=BigInt(20),_40n=BigInt(40),_80n=BigInt(80);function ed25519_pow_2_252_3($t){const e=ED25519_P,At=$t*$t%e*$t%e,xt=pow2(At,_2n,e)*At%e,kt=pow2(xt,_1n,e)*$t%e,Bt=pow2(kt,_5n,e)*kt%e,Nt=pow2(Bt,_10n,e)*Bt%e,Ut=pow2(Nt,_20n,e)*Nt%e,Lt=pow2(Ut,_40n,e)*Ut%e,jt=pow2(Lt,_80n,e)*Lt%e,Kt=pow2(jt,_80n,e)*Lt%e,qt=pow2(Kt,_10n,e)*Bt%e;return{pow_p_5_8:pow2(qt,_2n,e)*$t%e,b2:At}}function adjustScalarBytes($t){return $t[0]&=248,$t[31]&=127,$t[31]|=64,$t}function uvRatio($t,e){const _t=ED25519_P,At=mod(e*e*e,_t),xt=mod(At*At*e,_t),kt=ed25519_pow_2_252_3($t*xt).pow_p_5_8;let Bt=mod($t*At*kt,_t);const Nt=mod(e*Bt*Bt,_t),Ut=Bt,Lt=mod(Bt*ED25519_SQRT_M1,_t),jt=Nt===$t,Kt=Nt===mod(-$t,_t),qt=Nt===mod(-$t*ED25519_SQRT_M1,_t);return jt&&(Bt=Ut),(Kt||qt)&&(Bt=Lt),isNegativeLE(Bt,_t)&&(Bt=mod(-Bt,_t)),{isValid:jt||Kt,value:Bt}}const Fp=Field(ED25519_P,void 0,!0),ed25519Defaults={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:sha512,randomBytes:randomBytes$1,adjustScalarBytes,uvRatio},ed25519=twistedEdwards(ed25519Defaults);function ed25519_domain($t,e,_t){if(e.length>255)throw new Error("Context is too big");return concatBytes$1(utf8ToBytes$2("SigEd25519 no Ed25519 collisions"),new Uint8Array([_t?1:0,e.length]),e,$t)}({...ed25519Defaults});({...ed25519Defaults});const x25519=montgomery({P:ED25519_P,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:$t=>{const e=ED25519_P,{pow_p_5_8:_t,b2:At}=ed25519_pow_2_252_3($t);return mod(pow2(_t,BigInt(3),e)*At,e)},adjustScalarBytes,randomBytes:randomBytes$1});function edwardsToMontgomeryPub($t){const{y:e}=ed25519.ExtendedPoint.fromHex($t),_t=BigInt(1);return Fp.toBytes(Fp.create((_t+e)*Fp.inv(_t-e)))}function edwardsToMontgomeryPriv($t){const e=ed25519Defaults.hash($t.subarray(0,32));return ed25519Defaults.adjustScalarBytes(e).subarray(0,32)}const ELL2_C1=(Fp.ORDER+BigInt(3))/BigInt(8);Fp.pow(_2n,ELL2_C1);Fp.sqrt(Fp.neg(Fp.ONE));(Fp.ORDER-BigInt(5))/BigInt(8);BigInt(486662);FpSqrtEven(Fp,Fp.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235");BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578");BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838");BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var __awaiter$1Q=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$r=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Ed25519$2=class Ki{static bytesToPrivateKey(e){return __awaiter$1Q(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=ed25519.getPublicKey(_t),xt={crv:"Ed25519",d:Convert$1.uint8Array(_t).toBase64Url(),kty:"OKP",x:Convert$1.uint8Array(At).toBase64Url()};return xt.kid=yield computeJwkThumbprint$2({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKeyBytes:_t}){const At={kty:"OKP",crv:"Ed25519",x:Convert$1.uint8Array(_t).toBase64Url()};return At.kid=yield computeJwkThumbprint$2({jwk:At}),At})}static computePublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({key:_t}){const At=yield Ki.privateKeyToBytes({privateKey:_t}),xt=ed25519.getPublicKey(At),kt={kty:"OKP",crv:"Ed25519",x:Convert$1.uint8Array(xt).toBase64Url()};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static convertPrivateKeyToX25519(e){return __awaiter$1Q(this,arguments,void 0,function*({privateKey:_t}){const At=yield Ki.privateKeyToBytes({privateKey:_t}),xt=edwardsToMontgomeryPriv(At),kt=x25519.getPublicKey(xt),Bt={kty:"OKP",crv:"X25519",d:Convert$1.uint8Array(xt).toBase64Url(),x:Convert$1.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static convertPublicKeyToX25519(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKey:_t}){const At=yield Ki.publicKeyToBytes({publicKey:_t});if(!(yield Ki.validatePublicKey({publicKeyBytes:At})))throw new Error("Ed25519: Invalid public key.");const kt=edwardsToMontgomeryPub(At),Bt={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static generateKey(){return __awaiter$1Q(this,void 0,void 0,function*(){const e=ed25519.utils.randomPrivateKey(),_t=yield Ki.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$2({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({key:_t}){var At;if(!(isOkpPrivateJwk$2(_t)&&_t.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let xt=__rest$r(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$2({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1Q(this,arguments,void 0,function*({privateKey:_t}){if(!isOkpPrivateJwk$2(_t))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKey:_t}){if(!isOkpPublicJwk$2(_t))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Convert$1.base64Url(_t.x).toUint8Array()})}static sign(e){return __awaiter$1Q(this,arguments,void 0,function*({key:_t,data:At}){const xt=yield Ki.privateKeyToBytes({privateKey:_t});return ed25519.sign(At,xt)})}static validatePublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKeyBytes:_t}){try{ed25519.ExtendedPoint.fromHex(_t).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1Q(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=yield Ki.publicKeyToBytes({publicKey:_t});return ed25519.verify(At,xt,kt)})}};var __awaiter$1P=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let EdDsaAlgorithm$3=class extends CryptoAlgorithm$2{computePublicKey(e){return __awaiter$1P(this,arguments,void 0,function*({key:_t}){if(!isOkpPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(_t.crv){case"Ed25519":{const At=yield Ed25519$2.computePublicKey({key:_t});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}generateKey(e){return __awaiter$1P(this,arguments,void 0,function*({algorithm:_t}){switch(_t){case"Ed25519":{const At=yield Ed25519$2.generateKey();return At.alg="EdDSA",At}}})}getPublicKey(e){return __awaiter$1P(this,arguments,void 0,function*({key:_t}){if(!isOkpPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(_t.crv){case"Ed25519":{const At=yield Ed25519$2.getPublicKey({key:_t});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}sign(e){return __awaiter$1P(this,arguments,void 0,function*({key:_t,data:At}){if(!isOkpPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(_t.crv){case"Ed25519":return yield Ed25519$2.sign({key:_t,data:At});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}verify(e){return __awaiter$1P(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){if(!isOkpPublicJwk$2(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(_t.crv){case"Ed25519":return yield Ed25519$2.verify({key:_t,signature:At,data:xt});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}};var __awaiter$1O=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const supportedAlgorithms$4={Ed25519:{implementation:EdDsaAlgorithm$3,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$3,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$3,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$2,names:["SHA-256"]}};let LocalKeyManager$3=class{constructor(e){var _t;this._algorithmInstances=new Map,this._keyStore=(_t=e==null?void 0:e.keyStore)!==null&&_t!==void 0?_t:new MemoryStore$1}digest(e){return __awaiter$1O(this,arguments,void 0,function*({algorithm:_t,data:At}){return yield this.getAlgorithm({algorithm:_t}).digest({algorithm:_t,data:At})})}exportKey(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:_t}){return yield this.getPrivateKey({keyUri:_t})})}generateKey(e){return __awaiter$1O(this,arguments,void 0,function*({algorithm:_t}){const xt=yield this.getAlgorithm({algorithm:_t}).generateKey({algorithm:_t});if((xt==null?void 0:xt.kid)===void 0)throw new Error("Generated key is missing a required property: kid");const kt=`${KEY_URI_PREFIX_JWK$2}${xt.kid}`;return yield this._keyStore.set(kt,xt),kt})}getKeyUri(e){return __awaiter$1O(this,arguments,void 0,function*({key:_t}){const At=yield computeJwkThumbprint$2({jwk:_t});return`${KEY_URI_PREFIX_JWK$2}${At}`})}getPublicKey(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:_t}){const At=yield this.getPrivateKey({keyUri:_t}),xt=this.getAlgorithmName({key:At});return yield this.getAlgorithm({algorithm:xt}).getPublicKey({key:At})})}importKey(e){return __awaiter$1O(this,arguments,void 0,function*({key:_t}){var At;if(!isPrivateJwk$2(_t))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const xt=structuredClone(_t);(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$2({jwk:xt}));const kt=yield this.getKeyUri({key:xt});return yield this._keyStore.set(kt,xt),kt})}sign(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:_t,data:At}){const xt=yield this.getPrivateKey({keyUri:_t}),kt=this.getAlgorithmName({key:xt});return this.getAlgorithm({algorithm:kt}).sign({data:At,key:xt})})}verify(e){return __awaiter$1O(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=this.getAlgorithmName({key:_t});return this.getAlgorithm({algorithm:kt}).verify({key:_t,signature:At,data:xt})})}getAlgorithm({algorithm:e}){var _t;const At=(_t=supportedAlgorithms$4[e])===null||_t===void 0?void 0:_t.implementation;if(!At)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(At)||this._algorithmInstances.set(At,new At),this._algorithmInstances.get(At)}getAlgorithmName({key:e}){const _t=e.alg,At=e.crv;for(const xt in supportedAlgorithms$4){const kt=supportedAlgorithms$4[xt];if(_t&&kt.names.includes(_t))return xt;if(At&&kt.names.includes(At))return xt}throw new Error(`Unable to determine algorithm based on provided input: alg=${_t}, crv=${At}`)}getPrivateKey(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:_t}){const At=yield this._keyStore.get(_t);if(!At)throw new Error(`Key not found: ${_t}`);return At})}};function getJoseSignatureAlgorithmFromPublicKey$2($t){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if($t.alg&&Object.values(e).includes($t.alg))return $t.alg;if($t.crv&&Object.keys(e).includes($t.crv))return e[$t.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${$t.alg}, crv=${$t.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}var __awaiter$1N=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$q=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let X25519$2=class lo{static bytesToPrivateKey(e){return __awaiter$1N(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=x25519.getPublicKey(_t),xt={kty:"OKP",crv:"X25519",d:Convert$1.uint8Array(_t).toBase64Url(),x:Convert$1.uint8Array(At).toBase64Url()};return xt.kid=yield computeJwkThumbprint$2({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1N(this,arguments,void 0,function*({publicKeyBytes:_t}){const At={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(_t).toBase64Url()};return At.kid=yield computeJwkThumbprint$2({jwk:At}),At})}static computePublicKey(e){return __awaiter$1N(this,arguments,void 0,function*({key:_t}){const At=yield lo.privateKeyToBytes({privateKey:_t}),xt=x25519.getPublicKey(At),kt={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(xt).toBase64Url()};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static generateKey(){return __awaiter$1N(this,void 0,void 0,function*(){const e=x25519.utils.randomPrivateKey(),_t=yield lo.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$2({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1N(this,arguments,void 0,function*({key:_t}){var At;if(!(isOkpPrivateJwk$2(_t)&&_t.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let xt=__rest$q(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$2({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1N(this,arguments,void 0,function*({privateKey:_t}){if(!isOkpPrivateJwk$2(_t))throw new Error("X25519: The provided key is not a valid OKP private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1N(this,arguments,void 0,function*({publicKey:_t}){if(!isOkpPublicJwk$2(_t))throw new Error("X25519: The provided key is not a valid OKP public key.");return Convert$1.base64Url(_t.x).toUint8Array()})}static sharedSecret(e){return __awaiter$1N(this,arguments,void 0,function*({privateKeyA:_t,publicKeyB:At}){if("x"in _t&&"x"in At&&_t.x===At.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const xt=yield lo.privateKeyToBytes({privateKey:_t}),kt=yield lo.publicKeyToBytes({publicKey:At});return x25519.getSharedSecret(xt,kt)})}};const u8to16$1=($t,e)=>$t[e++]&255|($t[e++]&255)<<8;let Poly1305$1=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes$2(e),bytes$2(e,32);const _t=u8to16$1(e,0),At=u8to16$1(e,2),xt=u8to16$1(e,4),kt=u8to16$1(e,6),Bt=u8to16$1(e,8),Nt=u8to16$1(e,10),Ut=u8to16$1(e,12),Lt=u8to16$1(e,14);this.r[0]=_t&8191,this.r[1]=(_t>>>13|At<<3)&8191,this.r[2]=(At>>>10|xt<<6)&7939,this.r[3]=(xt>>>7|kt<<9)&8191,this.r[4]=(kt>>>4|Bt<<12)&255,this.r[5]=Bt>>>1&8190,this.r[6]=(Bt>>>14|Nt<<2)&8191,this.r[7]=(Nt>>>11|Ut<<5)&8065,this.r[8]=(Ut>>>8|Lt<<8)&8191,this.r[9]=Lt>>>5&127;for(let jt=0;jt<8;jt++)this.pad[jt]=u8to16$1(e,16+2*jt)}process(e,_t,At=!1){const xt=At?0:2048,{h:kt,r:Bt}=this,Nt=Bt[0],Ut=Bt[1],Lt=Bt[2],jt=Bt[3],Kt=Bt[4],qt=Bt[5],zt=Bt[6],Vt=Bt[7],Ht=Bt[8],Wt=Bt[9],Qt=u8to16$1(e,_t+0),Xt=u8to16$1(e,_t+2),Jt=u8to16$1(e,_t+4),tr=u8to16$1(e,_t+6),dr=u8to16$1(e,_t+8),vr=u8to16$1(e,_t+10),$r=u8to16$1(e,_t+12),Ir=u8to16$1(e,_t+14);let Rr=kt[0]+(Qt&8191),Nr=kt[1]+((Qt>>>13|Xt<<3)&8191),kr=kt[2]+((Xt>>>10|Jt<<6)&8191),lr=kt[3]+((Jt>>>7|tr<<9)&8191),ir=kt[4]+((tr>>>4|dr<<12)&8191),er=kt[5]+(dr>>>1&8191),rr=kt[6]+((dr>>>14|vr<<2)&8191),yr=kt[7]+((vr>>>11|$r<<5)&8191),fr=kt[8]+(($r>>>8|Ir<<8)&8191),gr=kt[9]+(Ir>>>5|xt),ar=0,nr=ar+Rr*Nt+Nr*(5*Wt)+kr*(5*Ht)+lr*(5*Vt)+ir*(5*zt);ar=nr>>>13,nr&=8191,nr+=er*(5*qt)+rr*(5*Kt)+yr*(5*jt)+fr*(5*Lt)+gr*(5*Ut),ar+=nr>>>13,nr&=8191;let ur=ar+Rr*Ut+Nr*Nt+kr*(5*Wt)+lr*(5*Ht)+ir*(5*Vt);ar=ur>>>13,ur&=8191,ur+=er*(5*zt)+rr*(5*qt)+yr*(5*Kt)+fr*(5*jt)+gr*(5*Lt),ar+=ur>>>13,ur&=8191;let pr=ar+Rr*Lt+Nr*Ut+kr*Nt+lr*(5*Wt)+ir*(5*Ht);ar=pr>>>13,pr&=8191,pr+=er*(5*Vt)+rr*(5*zt)+yr*(5*qt)+fr*(5*Kt)+gr*(5*jt),ar+=pr>>>13,pr&=8191;let br=ar+Rr*jt+Nr*Lt+kr*Ut+lr*Nt+ir*(5*Wt);ar=br>>>13,br&=8191,br+=er*(5*Ht)+rr*(5*Vt)+yr*(5*zt)+fr*(5*qt)+gr*(5*Kt),ar+=br>>>13,br&=8191;let Sr=ar+Rr*Kt+Nr*jt+kr*Lt+lr*Ut+ir*Nt;ar=Sr>>>13,Sr&=8191,Sr+=er*(5*Wt)+rr*(5*Ht)+yr*(5*Vt)+fr*(5*zt)+gr*(5*qt),ar+=Sr>>>13,Sr&=8191;let Pr=ar+Rr*qt+Nr*Kt+kr*jt+lr*Lt+ir*Ut;ar=Pr>>>13,Pr&=8191,Pr+=er*Nt+rr*(5*Wt)+yr*(5*Ht)+fr*(5*Vt)+gr*(5*zt),ar+=Pr>>>13,Pr&=8191;let Tr=ar+Rr*zt+Nr*qt+kr*Kt+lr*jt+ir*Lt;ar=Tr>>>13,Tr&=8191,Tr+=er*Ut+rr*Nt+yr*(5*Wt)+fr*(5*Ht)+gr*(5*Vt),ar+=Tr>>>13,Tr&=8191;let wr=ar+Rr*Vt+Nr*zt+kr*qt+lr*Kt+ir*jt;ar=wr>>>13,wr&=8191,wr+=er*Lt+rr*Ut+yr*Nt+fr*(5*Wt)+gr*(5*Ht),ar+=wr>>>13,wr&=8191;let Ar=ar+Rr*Ht+Nr*Vt+kr*zt+lr*qt+ir*Kt;ar=Ar>>>13,Ar&=8191,Ar+=er*jt+rr*Lt+yr*Ut+fr*Nt+gr*(5*Wt),ar+=Ar>>>13,Ar&=8191;let Mr=ar+Rr*Wt+Nr*Ht+kr*Vt+lr*zt+ir*qt;ar=Mr>>>13,Mr&=8191,Mr+=er*Kt+rr*jt+yr*Lt+fr*Ut+gr*Nt,ar+=Mr>>>13,Mr&=8191,ar=(ar<<2)+ar|0,ar=ar+nr|0,nr=ar&8191,ar=ar>>>13,ur+=ar,kt[0]=nr,kt[1]=ur,kt[2]=pr,kt[3]=br,kt[4]=Sr,kt[5]=Pr,kt[6]=Tr,kt[7]=wr,kt[8]=Ar,kt[9]=Mr}finalize(){const{h:e,pad:_t}=this,At=new Uint16Array(10);let xt=e[1]>>>13;e[1]&=8191;for(let Nt=2;Nt<10;Nt++)e[Nt]+=xt,xt=e[Nt]>>>13,e[Nt]&=8191;e[0]+=xt*5,xt=e[0]>>>13,e[0]&=8191,e[1]+=xt,xt=e[1]>>>13,e[1]&=8191,e[2]+=xt,At[0]=e[0]+5,xt=At[0]>>>13,At[0]&=8191;for(let Nt=1;Nt<10;Nt++)At[Nt]=e[Nt]+xt,xt=At[Nt]>>>13,At[Nt]&=8191;At[9]-=8192;let kt=(xt^1)-1;for(let Nt=0;Nt<10;Nt++)At[Nt]&=kt;kt=~kt;for(let Nt=0;Nt<10;Nt++)e[Nt]=e[Nt]&kt|At[Nt];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let Bt=e[0]+_t[0];e[0]=Bt&65535;for(let Nt=1;Nt<8;Nt++)Bt=(e[Nt]+_t[Nt]|0)+(Bt>>>16)|0,e[Nt]=Bt&65535}update(e){exists$2(this);const{buffer:_t,blockLen:At}=this;e=toBytes$2(e);const xt=e.length;for(let kt=0;kt<xt;){const Bt=Math.min(At-this.pos,xt-kt);if(Bt===At){for(;At<=xt-kt;kt+=At)this.process(e,kt);continue}_t.set(e.subarray(kt,kt+Bt),this.pos),this.pos+=Bt,kt+=Bt,this.pos===At&&(this.process(_t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists$2(this),output$2(e,this),this.finished=!0;const{buffer:_t,h:At}=this;let{pos:xt}=this;if(xt){for(_t[xt++]=1;xt<16;xt++)_t[xt]=0;this.process(_t,0,!0)}this.finalize();let kt=0;for(let Bt=0;Bt<8;Bt++)e[kt++]=At[Bt]>>>0,e[kt++]=At[Bt]>>>8;return e}digest(){const{buffer:e,outputLen:_t}=this;this.digestInto(e);const At=e.slice(0,_t);return this.destroy(),At}};function wrapConstructorWithKey$1($t){const e=(At,xt)=>$t(xt).update(toBytes$2(At)).digest(),_t=$t(new Uint8Array(32));return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=At=>$t(At),e}const poly1305=wrapConstructorWithKey$1($t=>new Poly1305$1($t)),_utf8ToBytes=$t=>Uint8Array.from($t.split("").map(e=>e.charCodeAt(0))),sigma16$1=_utf8ToBytes("expand 16-byte k"),sigma32$1=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32$1(sigma16$1),sigma32_32=u32$1(sigma32$1);sigma32_32.slice();function rotl$1($t,e){return $t<<e|$t>>>32-e}function isAligned32($t){return $t.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher($t,e,_t,At,xt,kt,Bt,Nt){const Ut=xt.length,Lt=new Uint8Array(BLOCK_LEN),jt=u32$1(Lt),Kt=isAligned32(xt)&&isAligned32(kt),qt=Kt?u32$1(xt):U32_EMPTY,zt=Kt?u32$1(kt):U32_EMPTY;for(let Vt=0;Vt<Ut;Bt++){if($t(e,_t,At,jt,Bt,Nt),Bt>=MAX_COUNTER)throw new Error("arx: counter overflow");const Ht=Math.min(BLOCK_LEN,Ut-Vt);if(Kt&&Ht===BLOCK_LEN){const Wt=Vt/4;if(Vt%4!==0)throw new Error("arx: invalid block position");for(let Qt=0,Xt;Qt<BLOCK_LEN32;Qt++)Xt=Wt+Qt,zt[Xt]=qt[Xt]^jt[Qt];Vt+=BLOCK_LEN;continue}for(let Wt=0,Qt;Wt<Ht;Wt++)Qt=Vt+Wt,kt[Qt]=xt[Qt]^Lt[Wt];Vt+=Ht}}function createCipher($t,e){const{allowShortKeys:_t,extendNonceFn:At,counterLength:xt,counterRight:kt,rounds:Bt}=checkOpts$1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof $t!="function")throw new Error("core must be a function");return number$1(xt),number$1(Bt),bool(kt),bool(_t),(Nt,Ut,Lt,jt,Kt=0)=>{bytes$2(Nt),bytes$2(Ut),bytes$2(Lt);const qt=Lt.length;if(jt||(jt=new Uint8Array(qt)),bytes$2(jt),number$1(Kt),Kt<0||Kt>=MAX_COUNTER)throw new Error("arx: counter overflow");if(jt.length<qt)throw new Error(`arx: output (${jt.length}) is shorter than data (${qt})`);const zt=[];let Vt=Nt.length,Ht,Wt;if(Vt===32)Ht=Nt.slice(),zt.push(Ht),Wt=sigma32_32;else if(Vt===16&&_t)Ht=new Uint8Array(32),Ht.set(Nt),Ht.set(Nt,16),Wt=sigma16_32,zt.push(Ht);else throw new Error(`arx: invalid 32-byte key, got length=${Vt}`);isAligned32(Ut)||(Ut=Ut.slice(),zt.push(Ut));const Qt=u32$1(Ht);if(At){if(Ut.length!==24)throw new Error("arx: extended nonce must be 24 bytes");At(Wt,Qt,u32$1(Ut.subarray(0,16)),Qt),Ut=Ut.subarray(16)}const Xt=16-xt;if(Xt!==Ut.length)throw new Error(`arx: nonce must be ${Xt} or 16 bytes`);if(Xt!==12){const tr=new Uint8Array(12);tr.set(Ut,kt?0:12-Ut.length),Ut=tr,zt.push(Ut)}const Jt=u32$1(Ut);for(runCipher($t,Wt,Qt,Jt,Lt,jt,Kt,Bt);zt.length>0;)zt.pop().fill(0);return jt}}function chachaCore($t,e,_t,At,xt,kt=20){let Bt=$t[0],Nt=$t[1],Ut=$t[2],Lt=$t[3],jt=e[0],Kt=e[1],qt=e[2],zt=e[3],Vt=e[4],Ht=e[5],Wt=e[6],Qt=e[7],Xt=xt,Jt=_t[0],tr=_t[1],dr=_t[2],vr=Bt,$r=Nt,Ir=Ut,Rr=Lt,Nr=jt,kr=Kt,lr=qt,ir=zt,er=Vt,rr=Ht,yr=Wt,fr=Qt,gr=Xt,ar=Jt,nr=tr,ur=dr;for(let br=0;br<kt;br+=2)vr=vr+Nr|0,gr=rotl$1(gr^vr,16),er=er+gr|0,Nr=rotl$1(Nr^er,12),vr=vr+Nr|0,gr=rotl$1(gr^vr,8),er=er+gr|0,Nr=rotl$1(Nr^er,7),$r=$r+kr|0,ar=rotl$1(ar^$r,16),rr=rr+ar|0,kr=rotl$1(kr^rr,12),$r=$r+kr|0,ar=rotl$1(ar^$r,8),rr=rr+ar|0,kr=rotl$1(kr^rr,7),Ir=Ir+lr|0,nr=rotl$1(nr^Ir,16),yr=yr+nr|0,lr=rotl$1(lr^yr,12),Ir=Ir+lr|0,nr=rotl$1(nr^Ir,8),yr=yr+nr|0,lr=rotl$1(lr^yr,7),Rr=Rr+ir|0,ur=rotl$1(ur^Rr,16),fr=fr+ur|0,ir=rotl$1(ir^fr,12),Rr=Rr+ir|0,ur=rotl$1(ur^Rr,8),fr=fr+ur|0,ir=rotl$1(ir^fr,7),vr=vr+kr|0,ur=rotl$1(ur^vr,16),yr=yr+ur|0,kr=rotl$1(kr^yr,12),vr=vr+kr|0,ur=rotl$1(ur^vr,8),yr=yr+ur|0,kr=rotl$1(kr^yr,7),$r=$r+lr|0,gr=rotl$1(gr^$r,16),fr=fr+gr|0,lr=rotl$1(lr^fr,12),$r=$r+lr|0,gr=rotl$1(gr^$r,8),fr=fr+gr|0,lr=rotl$1(lr^fr,7),Ir=Ir+ir|0,ar=rotl$1(ar^Ir,16),er=er+ar|0,ir=rotl$1(ir^er,12),Ir=Ir+ir|0,ar=rotl$1(ar^Ir,8),er=er+ar|0,ir=rotl$1(ir^er,7),Rr=Rr+Nr|0,nr=rotl$1(nr^Rr,16),rr=rr+nr|0,Nr=rotl$1(Nr^rr,12),Rr=Rr+Nr|0,nr=rotl$1(nr^Rr,8),rr=rr+nr|0,Nr=rotl$1(Nr^rr,7);let pr=0;At[pr++]=Bt+vr|0,At[pr++]=Nt+$r|0,At[pr++]=Ut+Ir|0,At[pr++]=Lt+Rr|0,At[pr++]=jt+Nr|0,At[pr++]=Kt+kr|0,At[pr++]=qt+lr|0,At[pr++]=zt+ir|0,At[pr++]=Vt+er|0,At[pr++]=Ht+rr|0,At[pr++]=Wt+yr|0,At[pr++]=Qt+fr|0,At[pr++]=Xt+gr|0,At[pr++]=Jt+ar|0,At[pr++]=tr+nr|0,At[pr++]=dr+ur|0}function hchacha($t,e,_t,At){let xt=$t[0],kt=$t[1],Bt=$t[2],Nt=$t[3],Ut=e[0],Lt=e[1],jt=e[2],Kt=e[3],qt=e[4],zt=e[5],Vt=e[6],Ht=e[7],Wt=_t[0],Qt=_t[1],Xt=_t[2],Jt=_t[3];for(let dr=0;dr<20;dr+=2)xt=xt+Ut|0,Wt=rotl$1(Wt^xt,16),qt=qt+Wt|0,Ut=rotl$1(Ut^qt,12),xt=xt+Ut|0,Wt=rotl$1(Wt^xt,8),qt=qt+Wt|0,Ut=rotl$1(Ut^qt,7),kt=kt+Lt|0,Qt=rotl$1(Qt^kt,16),zt=zt+Qt|0,Lt=rotl$1(Lt^zt,12),kt=kt+Lt|0,Qt=rotl$1(Qt^kt,8),zt=zt+Qt|0,Lt=rotl$1(Lt^zt,7),Bt=Bt+jt|0,Xt=rotl$1(Xt^Bt,16),Vt=Vt+Xt|0,jt=rotl$1(jt^Vt,12),Bt=Bt+jt|0,Xt=rotl$1(Xt^Bt,8),Vt=Vt+Xt|0,jt=rotl$1(jt^Vt,7),Nt=Nt+Kt|0,Jt=rotl$1(Jt^Nt,16),Ht=Ht+Jt|0,Kt=rotl$1(Kt^Ht,12),Nt=Nt+Kt|0,Jt=rotl$1(Jt^Nt,8),Ht=Ht+Jt|0,Kt=rotl$1(Kt^Ht,7),xt=xt+Lt|0,Jt=rotl$1(Jt^xt,16),Vt=Vt+Jt|0,Lt=rotl$1(Lt^Vt,12),xt=xt+Lt|0,Jt=rotl$1(Jt^xt,8),Vt=Vt+Jt|0,Lt=rotl$1(Lt^Vt,7),kt=kt+jt|0,Wt=rotl$1(Wt^kt,16),Ht=Ht+Wt|0,jt=rotl$1(jt^Ht,12),kt=kt+jt|0,Wt=rotl$1(Wt^kt,8),Ht=Ht+Wt|0,jt=rotl$1(jt^Ht,7),Bt=Bt+Kt|0,Qt=rotl$1(Qt^Bt,16),qt=qt+Qt|0,Kt=rotl$1(Kt^qt,12),Bt=Bt+Kt|0,Qt=rotl$1(Qt^Bt,8),qt=qt+Qt|0,Kt=rotl$1(Kt^qt,7),Nt=Nt+Ut|0,Xt=rotl$1(Xt^Nt,16),zt=zt+Xt|0,Ut=rotl$1(Ut^zt,12),Nt=Nt+Ut|0,Xt=rotl$1(Xt^Nt,8),zt=zt+Xt|0,Ut=rotl$1(Ut^zt,7);let tr=0;At[tr++]=xt,At[tr++]=kt,At[tr++]=Bt,At[tr++]=Nt,At[tr++]=Wt,At[tr++]=Qt,At[tr++]=Xt,At[tr++]=Jt}const xchacha20=createCipher(chachaCore,{counterRight:!1,counterLength:8,extendNonceFn:hchacha,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=($t,e)=>{$t.update(e);const _t=e.length%16;_t&&$t.update(ZEROS16.subarray(_t))},ZEROS32=new Uint8Array(32);function computeTag($t,e,_t,At,xt){const kt=$t(e,_t,ZEROS32),Bt=poly1305.create(kt);xt&&updatePadded(Bt,xt),updatePadded(Bt,At);const Nt=new Uint8Array(16),Ut=createView$1(Nt);setBigUint64$1(Ut,0,BigInt(xt?xt.length:0),!0),setBigUint64$1(Ut,8,BigInt(At.length),!0),Bt.update(Nt);const Lt=Bt.digest();return kt.fill(0),Lt}const _poly1305_aead=$t=>(e,_t,At)=>(bytes$2(e,32),bytes$2(_t),{encrypt:(kt,Bt)=>{const Nt=kt.length,Ut=Nt+16;Bt?bytes$2(Bt,Ut):Bt=new Uint8Array(Ut),$t(e,_t,kt,Bt,1);const Lt=computeTag($t,e,_t,Bt.subarray(0,-16),At);return Bt.set(Lt,Nt),Bt},decrypt:(kt,Bt)=>{const Nt=kt.length,Ut=Nt-16;if(Nt<16)throw new Error("encrypted data must be at least 16 bytes");Bt?bytes$2(Bt,Ut):Bt=new Uint8Array(Ut);const Lt=kt.subarray(0,-16),jt=kt.subarray(-16),Kt=computeTag($t,e,_t,Lt,At);if(!equalBytes$1(jt,Kt))throw new Error("invalid tag");return $t(e,_t,Lt,Bt,1),Bt}}),xchacha20poly1305=wrapCipher({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead(xchacha20));function isArrayBufferSlice($t){return $t.byteOffset!==0||$t.byteLength!==$t.buffer.byteLength}function isAsyncIterable$5($t){return typeof $t!="object"||$t===null?!1:typeof $t[Symbol.asyncIterator]=="function"}function universalTypeOf($t){const _t=Object.prototype.toString.call($t).match(/\s([a-zA-Z0-9]+)/),[At,xt]=_t;return xt}var __awaiter$1M=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$6=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}};const textEncoder=new TextEncoder,textDecoder=new TextDecoder;class Convert{constructor(e,_t){this.data=e,this.format=_t}static arrayBuffer(e){return new Convert(e,"ArrayBuffer")}static asyncIterable(e){if(!isAsyncIterable$5(e))throw new TypeError("Input must be of type AsyncIterable.");return new Convert(e,"AsyncIterable")}static base32Z(e){return new Convert(e,"Base32Z")}static base58Btc(e){return new Convert(e,"Base58Btc")}static base64Url(e){return new Convert(e,"Base64Url")}static bufferSource(e){return new Convert(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new Convert(e,"Hex")}static multibase(e){return new Convert(e,"Multibase")}static object(e){return new Convert(e,"Object")}static string(e){return new Convert(e,"String")}static uint8Array(e){return new Convert(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return base58btc$1.baseDecode(this.data).buffer;case"Base64Url":return base64url$3.baseDecode(this.data).buffer;case"BufferSource":{if(universalTypeOf(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return isArrayBufferSlice(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return __awaiter$1M(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return base32z$1.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base58btc$1.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return base58btc$1.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base64url$3.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return base64url$3.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),_t=textEncoder.encode(e);return base64url$3.baseEncode(_t)}case"String":{const e=textEncoder.encode(this.data);return base64url$3.baseEncode(e)}case"Uint8Array":return base64url$3.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){var e,_t,At,xt;return __awaiter$1M(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const Ut=[];try{for(var kt=!0,Bt=__asyncValues$6(this.data),Nt;Nt=yield Bt.next(),e=Nt.done,!e;kt=!0){xt=Nt.value,kt=!1;const jt=xt;Ut.push(jt)}}catch(jt){_t={error:jt}}finally{try{!kt&&!e&&(At=Bt.return)&&(yield At.call(Bt))}finally{if(_t)throw _t.error}}return new Blob(Ut)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(_t,At)=>At.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const _t=this.toUint8Array();return Convert.uint8Array(_t).toHex()}case"Base64Url":{const _t=this.toUint8Array();return Convert.uint8Array(_t).toHex()}case"Uint8Array":{let _t="";for(let At=0;At<this.data.length;At++)_t+=e[this.data[At]];return _t}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=base64url$3.baseDecode(this.data),_t=textDecoder.decode(e);return JSON.parse(_t)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=textDecoder.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return __awaiter$1M(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return textDecoder.decode(this.data);case"Base64Url":{const e=base64url$3.baseDecode(this.data);return textDecoder.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return textDecoder.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){var e,_t,At,xt;return __awaiter$1M(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{let Ut="";try{for(var kt=!0,Bt=__asyncValues$6(this.data),Nt;Nt=yield Bt.next(),e=Nt.done,!e;kt=!0){xt=Nt.value,kt=!1;const Lt=xt;typeof Lt=="string"?Ut+=Lt:Ut+=textDecoder.decode(Lt,{stream:!0})}}catch(Lt){_t={error:Lt}}finally{try{!kt&&!e&&(At=Bt.return)&&(yield At.call(Bt))}finally{if(_t)throw _t.error}}return Ut+=textDecoder.decode(void 0,{stream:!1}),Ut}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return base32z$1.baseDecode(this.data);case"Base58Btc":return base58btc$1.baseDecode(this.data);case"Base64Url":return base64url$3.baseDecode(this.data);case"BufferSource":{const e=universalTypeOf(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let _t=0;_t<this.data.length;_t+=2){const At=parseInt(this.data.substring(_t,_t+2),16);if(isNaN(At))throw new TypeError("Input is not a valid hexadecimal string.");e[_t/2]=At}return e}case"Object":{const e=JSON.stringify(this.data);return textEncoder.encode(e)}case"String":return textEncoder.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return __awaiter$1M(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}}class Multicodec{static addPrefix(e){var _t;let{code:At,data:xt,name:kt}=e;if(!(kt?!At:At))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(At=Multicodec.codeToName.has(At)?At:Multicodec.nameToCode.get(kt),At===void 0)throw new Error(`Unsupported multicodec: ${(_t=e.name)!==null&&_t!==void 0?_t:e.code}`);const Bt=encodingLength$8(At),Nt=new Uint8Array(Bt+xt.byteLength);return Nt.set(xt,Bt),encodeTo$3(At,Nt),Nt}static getCodeFromData(e){const{prefixedData:_t}=e,[At,xt]=decode$n(_t);return At}static getCodeFromName(e){const{name:_t}=e,At=Multicodec.nameToCode.get(_t);if(At===void 0)throw new Error(`Unsupported multicodec: ${_t}`);return At}static getNameFromCode(e){const{code:_t}=e,At=Multicodec.codeToName.get(_t);if(At===void 0)throw new Error(`Unsupported multicodec: ${_t}`);return At}static registerCodec(e){Multicodec.codeToName.set(e.code,e.name),Multicodec.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:_t}=e,[At,xt]=decode$n(_t),kt=Multicodec.codeToName.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return{code:At,data:_t.slice(xt),name:kt}}}Multicodec.codeToName=new Map;Multicodec.nameToCode=new Map;Multicodec.registerCodec({code:237,name:"ed25519-pub"});Multicodec.registerCodec({code:4864,name:"ed25519-priv"});Multicodec.registerCodec({code:236,name:"x25519-pub"});Multicodec.registerCodec({code:4866,name:"x25519-priv"});Multicodec.registerCodec({code:231,name:"secp256k1-pub"});Multicodec.registerCodec({code:4865,name:"secp256k1-priv"});function isEmptyObject($t){return typeof $t!="object"||$t===null||Object.getOwnPropertySymbols($t).length>0?!1:Object.keys($t).length===0}function removeUndefinedProperties($t){Object.keys($t).forEach(e=>{$t[e]===void 0?delete $t[e]:typeof $t[e]=="object"&&removeUndefinedProperties($t[e])})}var Level=browserLevel.BrowserLevel,__awaiter$1L=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class LevelStore{constructor({db:e,location:_t="DATASTORE"}={}){this.store=e??new Level(_t)}clear(){return __awaiter$1L(this,void 0,void 0,function*(){yield this.store.clear()})}close(){return __awaiter$1L(this,void 0,void 0,function*(){yield this.store.close()})}delete(e){return __awaiter$1L(this,void 0,void 0,function*(){yield this.store.del(e)})}get(e){return __awaiter$1L(this,void 0,void 0,function*(){try{return yield this.store.get(e)}catch(_t){if(_t.notFound)return;throw _t}})}set(e,_t){return __awaiter$1L(this,void 0,void 0,function*(){yield this.store.put(e,_t)})}}class MemoryStore{constructor(){this.store=new Map}clear(){return __awaiter$1L(this,void 0,void 0,function*(){this.store.clear()})}close(){return __awaiter$1L(this,void 0,void 0,function*(){})}delete(e){return __awaiter$1L(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return __awaiter$1L(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return __awaiter$1L(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return __awaiter$1L(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,_t){return __awaiter$1L(this,void 0,void 0,function*(){this.store.set(e,_t)})}}var __awaiter$1K=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__await$3=function($t){return this instanceof __await$3?(this.v=$t,this):new __await$3($t)},__asyncGenerator$3=function($t,e,_t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var At=_t.apply($t,e||[]),xt,kt=[];return xt={},Bt("next"),Bt("throw"),Bt("return"),xt[Symbol.asyncIterator]=function(){return this},xt;function Bt(qt){At[qt]&&(xt[qt]=function(zt){return new Promise(function(Vt,Ht){kt.push([qt,zt,Vt,Ht])>1||Nt(qt,zt)})})}function Nt(qt,zt){try{Ut(At[qt](zt))}catch(Vt){Kt(kt[0][3],Vt)}}function Ut(qt){qt.value instanceof __await$3?Promise.resolve(qt.value.v).then(Lt,jt):Kt(kt[0][2],qt)}function Lt(qt){Nt("next",qt)}function jt(qt){Nt("throw",qt)}function Kt(qt,zt){qt(zt),kt.shift(),kt.length&&Nt(kt[0][0],kt[0][1])}};class Stream{static asAsyncIterator(e){return __asyncGenerator$3(this,arguments,function*(){const At=e.getReader();try{for(;;){const{done:xt,value:kt}=yield __await$3(At.read());if(xt)break;yield yield __await$3(kt)}}finally{At.releaseLock()}})}static consumeToArrayBuffer({readableStream:e}){return __awaiter$1K(this,void 0,void 0,function*(){const _t=Stream.asAsyncIterator(e);return yield Convert.asyncIterable(_t).toArrayBufferAsync()})}static consumeToBlob({readableStream:e}){return __awaiter$1K(this,void 0,void 0,function*(){const _t=Stream.asAsyncIterator(e);return yield Convert.asyncIterable(_t).toBlobAsync()})}static consumeToBytes({readableStream:e}){return __awaiter$1K(this,void 0,void 0,function*(){const _t=Stream.asAsyncIterator(e);return yield Convert.asyncIterable(_t).toUint8ArrayAsync()})}static consumeToJson({readableStream:e}){return __awaiter$1K(this,void 0,void 0,function*(){const _t=Stream.asAsyncIterator(e);return yield Convert.asyncIterable(_t).toObjectAsync()})}static consumeToText({readableStream:e}){return __awaiter$1K(this,void 0,void 0,function*(){const _t=Stream.asAsyncIterator(e);return yield Convert.asyncIterable(_t).toStringAsync()})}static generateByteStream({streamLength:e,chunkLength:_t,fillValue:At}){let xt=e??1/0,kt;function Bt(){const Nt=Math.min(xt,_t??1/0);xt-=Nt;let Ut;if(typeof At=="number")Ut=new Uint8Array(Nt).fill(At);else if(Array.isArray(At)){Ut=new Uint8Array(Nt);const[Lt,jt]=At,Kt=jt-Lt+1;for(let qt=0;qt<Nt;qt++)Ut[qt]=Math.floor(Math.random()*Kt)+Lt}else Ut=new Uint8Array(Nt);kt.enqueue(Ut),xt<=0&&kt.close()}return new ReadableStream({start(Nt){kt=Nt,Bt()},pull(){Bt()}})}static isReadable({readableStream:e}){if(!Stream.isReadableStream(e)||e.locked)return!1;try{return e.getReader().releaseLock(),!0}catch{return!1}}static isReadableStream(e){return typeof e=="object"&&e!==null&&"getReader"in e&&typeof e.getReader=="function"}static isStream(e){return Stream.isReadableStream(e)||Stream.isWritableStream(e)||Stream.isTransformStream(e)}static isTransformStream(e){return typeof e=="object"&&e!==null&&"readable"in e&&typeof e.readable=="object"&&"writable"in e&&typeof e.writable=="object"}static isWritableStream(e){return typeof e=="object"&&e!==null&&"getWriter"in e&&typeof e.getWriter=="function"&&"abort"in e&&typeof e.abort=="function"}}var __awaiter$1J=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class NodeStream{static consumeToArrayBuffer({readable:e}){return __awaiter$1J(this,void 0,void 0,function*(){return yield Convert.asyncIterable(e).toArrayBufferAsync()})}static consumeToBlob({readable:e}){return __awaiter$1J(this,void 0,void 0,function*(){return yield Convert.asyncIterable(e).toBlobAsync()})}static consumeToBytes({readable:e}){return __awaiter$1J(this,void 0,void 0,function*(){return yield Convert.asyncIterable(e).toUint8ArrayAsync()})}static consumeToJson({readable:e}){return __awaiter$1J(this,void 0,void 0,function*(){return yield Convert.asyncIterable(e).toObjectAsync()})}static consumeToText({readable:e}){return __awaiter$1J(this,void 0,void 0,function*(){return yield Convert.asyncIterable(e).toStringAsync()})}static fromWebReadable({readableStream:e,readableOptions:_t}){if(!Stream.isReadableStream(e))throw new TypeError("NodeStream.fromWebReadable: 'readableStream' is not a Web ReadableStream.");const At=e.getReader();let xt=!1;const kt=new browserExports.Readable(Object.assign(Object.assign({},_t),{read:function(){At.read().then(({done:Bt,value:Nt})=>{if(Bt)this.push(null);else if(!this.push(Nt))return}).catch(Bt=>{this.destroy(Bt)})},destroy:function(Bt,Nt){function Ut(){Nt(Bt)}if(!xt){At.cancel(Bt).then(Ut).catch(Ut);return}Ut()}}));return At.closed.then(()=>{xt=!0}).catch(Bt=>{xt=!0,kt.destroy(Bt)}),kt}static isDestroyed({stream:e}){if(!NodeStream.isStream(e))throw new TypeError("NodeStream.isDestroyed: 'stream' is not a Node stream.");const _t="_writableState"in e?e._writableState:void 0,At=e._readableState,xt=_t||At;return!!(e.destroyed||xt.destroyed)}static isReadable({readable:e}){return NodeStream.isReadableStream(e)?e.readable&&typeof e._readableState.ended=="boolean"&&!e._readableState.ended&&typeof e._readableState.endEmitted=="boolean"&&!e._readableState.endEmitted&&!e.destroyed&&!e.isPaused():!1}static isReadableStream(e){return typeof e=="object"&&e!==null&&"pipe"in e&&typeof e.pipe=="function"&&"on"in e&&typeof e.on=="function"&&!("_writableState"in e)&&"_readableState"in e}static isStream(e){return typeof e=="object"&&e!==null&&("_readableState"in e||"_writableState"in e)}static toWebReadable({readable:e}){if(!NodeStream.isReadableStream(e))throw new TypeError("NodeStream.toWebReadable: 'readable' is not a Node Readable stream.");if(NodeStream.isDestroyed({stream:e})){const _t=new ReadableStream;return _t.cancel(),_t}return new ReadableStream({start(_t){e.on("data",At=>{_t.enqueue(At)}),e.on("end",()=>{_t.close()}),e.on("error",At=>{_t.error(At)})},cancel(){e.destroy()}})}}function extractDidFragment$2($t){if(typeof $t=="string"&&$t.length!==0)return $t.split("#").pop()}function getVerificationMethods$2({didDocument:$t}){var e,_t;if(!$t)throw new TypeError("Required parameter missing: 'didDocument'");const At=[];return At.push(...(_t=(e=$t.verificationMethod)===null||e===void 0?void 0:e.filter(isDidVerificationMethod$2))!==null&&_t!==void 0?_t:[]),Object.keys(DidVerificationRelationship$2).forEach(xt=>{var kt,Bt;At.push(...(Bt=(kt=$t[xt])===null||kt===void 0?void 0:kt.filter(isDidVerificationMethod$2))!==null&&Bt!==void 0?Bt:[])}),At}function getVerificationMethodTypes$2({didDocument:$t}){const _t=getVerificationMethods$2({didDocument:$t}).map(At=>At.type);return[...new Set(_t)]}function getVerificationRelationshipsById$2({didDocument:$t,methodId:e}){const _t=[];return Object.keys(DidVerificationRelationship$2).forEach(At=>{if(Array.isArray($t[At])){const xt=$t[At],kt=extractDidFragment$2(e);xt.some(Nt=>{const Ut=extractDidFragment$2(Nt)===kt,Lt=isDidVerificationMethod$2(Nt)&&extractDidFragment$2(Nt.id)===kt;return Ut||Lt})&&_t.push(At)}}),_t}function isDidVerificationMethod$2($t){return!(!$t||typeof $t!="object"||$t===null||!("id"in $t&&"type"in $t&&"controller"in $t)||typeof $t.id!="string"||typeof $t.type!="string"||typeof $t.controller!="string")}function keyBytesToMultibaseId$2({keyBytes:$t,multicodecCode:e,multicodecName:_t}){const At=Multicodec.addPrefix({code:e,data:$t,name:_t}),xt=Convert.uint8Array(At).toBase58Btc();return Convert.base58Btc(xt).toMultibase()}function multibaseIdToKeyBytes$2({multibaseKeyId:$t}){try{const e=Convert.multibase($t).toBase58Btc(),_t=Convert.base58Btc(e).toUint8Array(),{code:At,data:xt,name:kt}=Multicodec.removePrefix({prefixedData:_t});return{keyBytes:xt,multicodecCode:At,multicodecName:kt}}catch{throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid multibase identifier: ${$t}`)}}var __awaiter$1I=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let BearerDid$2=class Ho{constructor({uri:e,document:_t,metadata:At,keyManager:xt}){this.uri=e,this.document=_t,this.metadata=At,this.keyManager=xt}export(){return __awaiter$1I(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const _t=[];for(let At of this.document.verificationMethod){if(!At.publicKeyJwk)throw new Error(`Verification method '${At.id}' does not contain a public key in JWK format`);const xt=yield this.keyManager.getKeyUri({key:At.publicKeyJwk}),kt=yield this.keyManager.exportKey({keyUri:xt});_t.push(Object.assign({},kt))}e.privateKeys=_t}return e})}getSigner(e){return __awaiter$1I(this,void 0,void 0,function*(){var _t;const At=(_t=this.document.verificationMethod)===null||_t===void 0?void 0:_t.find(Ut=>{var Lt,jt;return extractDidFragment$2(Ut.id)===((Lt=extractDidFragment$2(e==null?void 0:e.methodId))!==null&&Lt!==void 0?Lt:extractDidFragment$2((jt=this.document.assertionMethod)===null||jt===void 0?void 0:jt[0]))});if(!(At&&At.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");const xt=yield this.keyManager.getKeyUri({key:At.publicKeyJwk}),kt=yield this.keyManager.getPublicKey({keyUri:xt}),Bt=this.keyManager;return{algorithm:getJoseSignatureAlgorithmFromPublicKey$2(kt),keyId:At.id,sign(Ut){return __awaiter$1I(this,arguments,void 0,function*({data:Lt}){return yield Bt.sign({data:Lt,keyUri:xt})})},verify(Ut){return __awaiter$1I(this,arguments,void 0,function*({data:Lt,signature:jt}){return yield Bt.verify({data:Lt,key:kt,signature:jt})})}}})}static import(e){return __awaiter$1I(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$3}){var xt;const kt=getVerificationMethods$2({didDocument:_t.document});if(kt.length===0)throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let Nt of(xt=_t.privateKeys)!==null&&xt!==void 0?xt:[])yield At.importKey({key:Nt});for(let Nt of kt){if(!Nt.publicKeyJwk)throw new Error(`Verification method '${Nt.id}' does not contain a public key in JWK format`);const Ut=yield At.getKeyUri({key:Nt.publicKeyJwk});yield At.getPublicKey({keyUri:Ut})}return new Ho({uri:_t.uri,document:_t.document,metadata:_t.metadata,keyManager:At})})}};/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const alphabet$1="0123456789abcdef",encodeLookup=[];for(let $t=0;$t<256;$t++)encodeLookup[$t]=alphabet$1[$t>>4&15]+alphabet$1[$t&15];const arr2hex=$t=>{const e=$t.length;let _t="",At=0;for(;At<e;)_t+=encodeLookup[$t[At++]];return _t},concat=($t,e=0)=>{const _t=$t.length||0;if(!e){let Bt=_t;for(;Bt--;)e+=$t[Bt].length}const At=new Uint8Array(e);let xt=e,kt=_t;for(;kt--;)xt-=$t[kt].length,At.set($t[kt],xt);return At};var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;const decoder=new TextDecoder,arr2text=($t,e)=>decoder.decode($t),encoder=new TextEncoder,text2arr=$t=>encoder.encode($t),scope=typeof window<"u"?window:self,crypto$1=scope.crypto||scope.msCrypto||{};crypto$1.subtle||crypto$1.webkitSubtle;function digitCount($t){const e=$t<0?1:0;return $t=Math.abs(Number($t||1)),Math.floor(Math.log10($t))+1+e}function getType($t){return ArrayBuffer.isView($t)?"arraybufferview":Array.isArray($t)?"array":$t instanceof Number?"number":$t instanceof Boolean?"boolean":$t instanceof Set?"set":$t instanceof Map?"map":$t instanceof String?"string":$t instanceof ArrayBuffer?"arraybuffer":typeof $t}function encode$5($t,e,_t){const At=[];let xt=null;return encode$5._encode(At,$t),xt=concat(At),encode$5.bytes=xt.length,ArrayBuffer.isView(e)?(e.set(xt,_t),e):xt}encode$5.bytes=-1;encode$5._floatConversionDetected=!1;encode$5._encode=function($t,e){if(e!=null)switch(getType(e)){case"object":encode$5.dict($t,e);break;case"map":encode$5.dictMap($t,e);break;case"array":encode$5.list($t,e);break;case"set":encode$5.listSet($t,e);break;case"string":encode$5.string($t,e);break;case"number":encode$5.number($t,e);break;case"boolean":encode$5.number($t,e);break;case"arraybufferview":encode$5.buffer($t,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));break;case"arraybuffer":encode$5.buffer($t,new Uint8Array(e));break}};const buffE=new Uint8Array([101]),buffD=new Uint8Array([100]),buffL=new Uint8Array([108]);encode$5.buffer=function($t,e){$t.push(text2arr(e.length+":"),e)};encode$5.string=function($t,e){$t.push(text2arr(text2arr(e).byteLength+":"+e))};encode$5.number=function($t,e){if(Number.isInteger(e))return $t.push(text2arr("i"+BigInt(e)+"e"));const _t=2147483648,At=e/_t<<0,xt=e%_t<<0,kt=At*_t+xt;$t.push(text2arr("i"+kt+"e")),kt!==e&&!encode$5._floatConversionDetected&&(encode$5._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+e+'":','Bencoding only defines support for integers, value was converted to "'+kt+'"'),console.trace())};encode$5.dict=function($t,e){$t.push(buffD);let _t=0,At;const xt=Object.keys(e).sort(),kt=xt.length;for(;_t<kt;_t++)At=xt[_t],e[At]!=null&&(encode$5.string($t,At),encode$5._encode($t,e[At]));$t.push(buffE)};encode$5.dictMap=function($t,e){$t.push(buffD);const _t=Array.from(e.keys()).sort();for(const At of _t)e.get(At)!=null&&(ArrayBuffer.isView(At)?encode$5._encode($t,At):encode$5.string($t,String(At)),encode$5._encode($t,e.get(At)));$t.push(buffE)};encode$5.list=function($t,e){let _t=0;const At=e.length;for($t.push(buffL);_t<At;_t++)e[_t]!=null&&encode$5._encode($t,e[_t]);$t.push(buffE)};encode$5.listSet=function($t,e){$t.push(buffL);for(const _t of e)_t!=null&&encode$5._encode($t,_t);$t.push(buffE)};const INTEGER_START=105,STRING_DELIM=58,DICTIONARY_START=100,LIST_START=108,END_OF_TYPE=101;function getIntFromBuffer($t,e,_t){let At=0,xt=1;for(let kt=e;kt<_t;kt++){const Bt=$t[kt];if(Bt<58&&Bt>=48){At=At*10+(Bt-48);continue}if(!(kt===e&&Bt===43)){if(kt===e&&Bt===45){xt=-1;continue}if(Bt===46)break;throw new Error("not a number: buffer["+kt+"] = "+Bt)}}return At*xt}function decode$4($t,e,_t,At){return $t==null||$t.length===0?null:(typeof e!="number"&&At==null&&(At=e,e=void 0),typeof _t!="number"&&At==null&&(At=_t,_t=void 0),decode$4.position=0,decode$4.encoding=At||null,decode$4.data=ArrayBuffer.isView($t)?new Uint8Array($t.slice(e,_t)):text2arr($t),decode$4.bytes=decode$4.data.length,decode$4.next())}decode$4.bytes=0;decode$4.position=0;decode$4.data=null;decode$4.encoding=null;decode$4.next=function(){switch(decode$4.data[decode$4.position]){case DICTIONARY_START:return decode$4.dictionary();case LIST_START:return decode$4.list();case INTEGER_START:return decode$4.integer();default:return decode$4.buffer()}};decode$4.find=function($t){let e=decode$4.position;const _t=decode$4.data.length,At=decode$4.data;for(;e<_t;){if(At[e]===$t)return e;e++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode($t)+'" [0x'+$t.toString(16)+"]")};decode$4.dictionary=function(){decode$4.position++;const $t={};for(;decode$4.data[decode$4.position]!==END_OF_TYPE;){const e=decode$4.buffer();let _t=arr2text(e);_t.includes("")&&(_t=arr2hex(e)),$t[_t]=decode$4.next()}return decode$4.position++,$t};decode$4.list=function(){decode$4.position++;const $t=[];for(;decode$4.data[decode$4.position]!==END_OF_TYPE;)$t.push(decode$4.next());return decode$4.position++,$t};decode$4.integer=function(){const $t=decode$4.find(END_OF_TYPE),e=getIntFromBuffer(decode$4.data,decode$4.position+1,$t);return decode$4.position+=$t+1-decode$4.position,e};decode$4.buffer=function(){let $t=decode$4.find(STRING_DELIM);const e=getIntFromBuffer(decode$4.data,decode$4.position,$t),_t=++$t+e;return decode$4.position=_t,decode$4.encoding?arr2text(decode$4.data.slice($t,_t)):decode$4.data.slice($t,_t)};function listLength($t){let e=2;for(const _t of $t)e+=encodingLength$3(_t);return e}function mapLength($t){let e=2;for(const[_t,At]of $t){const xt=text2arr(_t).byteLength;e+=digitCount(xt)+1+xt,e+=encodingLength$3(At)}return e}function objectLength($t){let e=2;const _t=Object.keys($t);for(let At=0;At<_t.length;At++){const xt=text2arr(_t[At]).byteLength;e+=digitCount(xt)+1+xt,e+=encodingLength$3($t[_t[At]])}return e}function stringLength($t){const e=text2arr($t).byteLength;return digitCount(e)+1+e}function arrayBufferLength($t){const e=$t.byteLength-$t.byteOffset;return digitCount(e)+1+e}function encodingLength$3($t){if($t==null)return 0;const _t=getType($t);switch(_t){case"arraybufferview":return arrayBufferLength($t);case"string":return stringLength($t);case"array":case"set":return listLength($t);case"number":return 1+digitCount(Math.floor($t))+1;case"bigint":return 1+$t.toString().length+1;case"object":return objectLength($t);case"map":return mapLength($t);default:throw new TypeError(`Unsupported value of type "${_t}"`)}}const encodingLength$2=encodingLength$3,bencode={encode:encode$5,decode:decode$4,byteLength:encodingLength$3,encodingLength:encodingLength$2},v4Regex=/^(\d{1,3}\.){3,3}\d{1,3}$/,v4Size=4,v6Regex=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,v6Size=16,v4={name:"v4",size:v4Size,isFormat:$t=>v4Regex.test($t),encode($t,e,_t){_t=~~_t,e=e||new Uint8Array(_t+v4Size);const At=$t.length;let xt=0;for(let kt=0;kt<At;){const Bt=$t.charCodeAt(kt++);Bt===46?(e[_t++]=xt,xt=0):xt=xt*10+(Bt-48)}return e[_t]=xt,e},decode($t,e){return e=~~e,`${$t[e++]}.${$t[e++]}.${$t[e++]}.${$t[e]}`}},v6={name:"v6",size:v6Size,isFormat:$t=>$t.length>0&&v6Regex.test($t),encode($t,e,_t){_t=~~_t;let At=_t+v6Size,xt=-1,kt=0,Bt=0,Nt=!0,Ut=!1;e=e||new Uint8Array(_t+v6Size);for(let Lt=0;Lt<$t.length;Lt++){let jt=$t.charCodeAt(Lt);jt===58?(Nt?xt!==-1?(_t<At&&(e[_t]=0),_t<At-1&&(e[_t+1]=0),_t+=2):_t<At&&(xt=_t):(Ut===!0?(_t<At&&(e[_t]=Bt),_t++):(_t<At&&(e[_t]=kt>>8),_t<At-1&&(e[_t+1]=kt&255),_t+=2),kt=0,Bt=0),Nt=!0,Ut=!1):jt===46?(_t<At&&(e[_t]=Bt),_t++,Bt=0,kt=0,Nt=!1,Ut=!0):(Nt=!1,jt>=97?jt-=87:jt>=65?jt-=55:(jt-=48,Bt=Bt*10+jt),kt=(kt<<4)+jt)}if(Nt===!1)Ut===!0?(_t<At&&(e[_t]=Bt),_t++):(_t<At&&(e[_t]=kt>>8),_t<At-1&&(e[_t+1]=kt&255),_t+=2);else if(xt===0)_t<At&&(e[_t]=0),_t<At-1&&(e[_t+1]=0),_t+=2;else if(xt!==-1){_t+=2;for(let Lt=Math.min(_t-1,At-1);Lt>=xt+2;Lt--)e[Lt]=e[Lt-2];e[xt]=0,e[xt+1]=0,xt=_t}if(xt!==_t&&xt!==-1)for(_t>At-2&&(_t=At-2);At>xt;)e[--At]=_t<At&&_t>xt?e[--_t]:0;else for(;_t<At;)e[_t++]=0;return e},decode($t,e){e=~~e;let _t="";for(let At=0;At<v6Size;At+=2)At!==0&&(_t+=":"),_t+=($t[e+At]<<8|$t[e+At+1]).toString(16);return _t.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};function sizeOf($t){if(v4.isFormat($t))return v4.size;if(v6.isFormat($t))return v6.size;throw Error(`Invalid ip address: ${$t}`)}function familyOf($t){return sizeOf($t)===v4.size?1:2}function encode$4($t,e,_t){_t=~~_t;const At=sizeOf($t);return typeof e=="function"&&(e=e(_t+At)),At===v4.size?v4.encode($t,e,_t):v6.encode($t,e,_t)}function decode$3($t,e,_t){if(e=~~e,_t=_t||$t.length-e,_t===v4.size)return v4.decode($t,e,_t);if(_t===v6.size)return v6.decode($t,e,_t);throw Error(`Invalid buffer size needs to be ${v4.size} for v4 or ${v6.size} for v6.`)}function toString$4($t){switch($t){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+$t}function toType($t){switch($t.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":return 255;case"*":return 255}return $t.toUpperCase().startsWith("UNKNOWN_")?parseInt($t.slice(8)):0}function toString$3($t){switch($t){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+$t}function toString$2($t){switch($t){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+$t}function toString$1($t){switch($t){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+$t}function toClass($t){switch($t.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}function toString($t){switch($t){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return $t<0?null:`OPTION_${$t}`}function toCode($t){if(typeof $t=="number")return $t;if(!$t)return-1;switch($t.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const e=$t.match(/_(\d+)$/);return e?parseInt(e[1],10):-1}const SURROGATE_A=55296,SURROGATE_B=56320;function encodingLength$1($t){let e=0;const _t=$t.length;for(let At=0;At<_t;At+=1){const xt=$t.charCodeAt(At);if(xt<=127)e+=1;else if(xt<=2047)e+=2;else if((xt&63488)!==SURROGATE_A)e+=3;else{const kt=At+1;kt===_t||xt>=SURROGATE_B||($t.charCodeAt(kt)&64512)!==SURROGATE_B?e+=3:(At=kt,e+=4)}}return e}function encode$3($t,e,_t){const At=$t.length;_t==null&&(_t=0),e===void 0&&(e=new Uint8Array(encodingLength$1($t)+_t));let xt=_t;for(let kt=0;kt<At;kt+=1){let Bt=$t.charCodeAt(kt);if(Bt<=127)e[xt++]=Bt;else if(Bt<=2047)e[xt++]=192|(Bt&1984)>>6,e[xt++]=128|Bt&63;else if((Bt&63488)!==SURROGATE_A)e[xt++]=224|(Bt&61440)>>12,e[xt++]=128|(Bt&4032)>>6,e[xt++]=128|Bt&63;else{const Nt=kt+1;if(Nt===At||Bt>=SURROGATE_B)e[xt++]=239,e[xt++]=191,e[xt++]=189;else{const Ut=$t.charCodeAt(Nt);(Ut&64512)!==SURROGATE_B?(e[xt++]=239,e[xt++]=191,e[xt++]=189):(kt=Nt,Bt=65536|(Bt&1023)<<10|Ut&1023,e[xt++]=240|(Bt&1835008)>>18,e[xt++]=128|(Bt&258048)>>12,e[xt++]=128|(Bt&4032)>>6,e[xt++]=128|Bt&63)}}}return encode$3.bytes=xt-_t,e}encode$3.bytes=0;function decode$2($t,e,_t){let At="";e==null&&(e=0),_t==null&&(_t=$t.length);for(let xt=e;xt<_t;){const kt=$t[xt++];let Bt;if(kt<=128)Bt=kt;else if(kt>191&&kt<224)Bt=(kt&31)<<6|$t[xt++]&63;else if(kt>239&&kt<365){Bt=((kt&7)<<18|($t[xt++]&63)<<12|($t[xt++]&63)<<6|$t[xt++]&63)-65536;const Nt=SURROGATE_A|Bt>>10&1023;At+=String.fromCharCode(Nt),Bt=SURROGATE_B|Bt&1023}else Bt=(kt&15)<<12|($t[xt++]&63)<<6|$t[xt++]&63;At+=String.fromCharCode(Bt)}return decode$2.bytes=_t-e,At}decode$2.bytes=0;const isU8Arr=$t=>$t instanceof Uint8Array;function bytelength($t){return typeof $t=="string"?encodingLength$1($t):$t.byteLength}function from($t){return $t instanceof Uint8Array?$t:Array.isArray($t)?new Uint8Array($t):encode$3($t)}function write($t,e,_t){if(typeof e!="string")throw new Error("unknown input type");return encode$3(e,$t,_t),encode$3.bytes}const hexNum={},numHex=new Array(255);for(let $t=0;$t<=15;$t+=1){const e=$t.toString(16),_t=e.toUpperCase();for(let At=0;At<=15;At+=1){const xt=At.toString(16),kt=xt.toUpperCase(),Bt=$t<<4|At,Nt=`${e}${xt}`;numHex[Bt]=Nt,hexNum[Nt]=Bt,hexNum[`${_t}${xt}`]=Bt,hexNum[`${e}${kt}`]=Bt,hexNum[`${_t}${kt}`]=Bt}}function toHex($t,e,_t){let At="";for(let xt=e;xt<_t;){const kt=$t[xt++];At+=numHex[kt]}return At}function hexLength($t){return $t.length>>>1}function writeHex($t,e,_t,At){let xt=0;for(;_t<At;){const kt=e.substr(xt,2),Bt=hexNum[kt];if(Bt===void 0)return;$t[_t++]=Bt,xt+=2}return $t}const P_24=Math.pow(2,24),P_16=Math.pow(2,16),P_8=Math.pow(2,8),readUInt32BE=($t,e)=>$t[e]*P_24+$t[e+1]*P_16+$t[e+2]*P_8+$t[e+3],readUInt16BE=($t,e)=>$t[e]<<8|$t[e+1],writeUInt32BE=($t,e,_t)=>(e=+e,$t[_t+3]=e,e=e>>>8,$t[_t+2]=e,e=e>>>8,$t[_t+1]=e,e=e>>>8,$t[_t]=e,_t+4),writeUInt16BE=($t,e,_t)=>($t[_t]=e>>8,$t[_t+1]=e&255,_t+2);function copy($t,e,_t,At,xt){return _t<0&&(At-=_t,_t=0),At<0&&(At=0),xt<0?new Uint8Array(0):_t>=e.length||At>=xt?0:_copyActual($t,e,_t,At,xt)}function _copyActual($t,e,_t,At,xt){xt-At>e.length-_t&&(xt=At+e.length-_t);let kt=xt-At;const Bt=$t.length-At;return kt>Bt&&(kt=Bt),(At!==0||xt<$t.length)&&($t=new Uint8Array($t.buffer,$t.byteOffset+At,kt)),e.set($t,_t),kt}const QUERY_FLAG=0,RESPONSE_FLAG=32768,FLUSH_MASK=32768,NOT_FLUSH_MASK=~FLUSH_MASK,QU_MASK=32768,NOT_QU_MASK=~QU_MASK;function codec({bytes:$t=0,encode:e,decode:_t,encodingLength:At}){return e.bytes=$t,_t.bytes=$t,{encode:e,decode:_t,encodingLength:At||(()=>$t)}}const name$1=codec({encode($t,e,_t){e||(e=new Uint8Array(name$1.encodingLength($t))),_t||(_t=0);const At=_t,xt=$t.replace(/^\.|\.$/gm,"");if(xt.length){const kt=xt.split(".");for(let Bt=0;Bt<kt.length;Bt++){const Nt=write(e,kt[Bt],_t+1);e[_t]=Nt,_t+=Nt+1}}return e[_t++]=0,name$1.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=[];let At=e,xt=0,kt=0,Bt=!1;for(;;){if(e>=$t.length)throw new Error("Cannot decode name (buffer overflow)");const Nt=$t[e++];if(kt+=Bt?0:1,Nt===0)break;if(Nt&192)if((Nt&192)===192){if(e+1>$t.length)throw new Error("Cannot decode name (buffer overflow)");const Ut=readUInt16BE($t,e-1)-49152;if(Ut>=At)throw new Error("Cannot decode name (bad pointer)");e=Ut,At=Ut,kt+=Bt?0:1,Bt=!0}else throw new Error("Cannot decode name (bad label)");else{if(e+Nt>$t.length)throw new Error("Cannot decode name (buffer overflow)");if(xt+=Nt+1,xt>254)throw new Error("Cannot decode name (name too long)");_t.push(decode$2($t,e,e+Nt)),e+=Nt,kt+=Bt?0:Nt}}return name$1.decode.bytes=kt,_t.length===0?".":_t.join(".")},encodingLength($t){return $t==="."||$t===".."?1:bytelength($t.replace(/^\.|\.$/gm,""))+2}}),string=codec({encode($t,e,_t){e||(e=new Uint8Array(string.encodingLength($t))),_t||(_t=0);const At=write(e,$t,_t+1);return e[_t]=At,string.encode.bytes=At+1,e},decode($t,e){e||(e=0);const _t=$t[e],At=decode$2($t,e+1,e+1+_t);return string.decode.bytes=_t+1,At},encodingLength($t){return bytelength($t)+1}}),header=codec({bytes:12,encode($t,e,_t){e||(e=new Uint8Array(header.encodingLength($t))),_t||(_t=0);const At=($t.flags||0)&32767,xt=$t.type==="response"?RESPONSE_FLAG:QUERY_FLAG;return writeUInt16BE(e,$t.id||0,_t),writeUInt16BE(e,At|xt,_t+2),writeUInt16BE(e,$t.questions.length,_t+4),writeUInt16BE(e,$t.answers.length,_t+6),writeUInt16BE(e,$t.authorities.length,_t+8),writeUInt16BE(e,$t.additionals.length,_t+10),e},decode($t,e){if(e||(e=0),$t.length<12)throw new Error("Header must be 12 bytes");const _t=readUInt16BE($t,e+2);return{id:readUInt16BE($t,e),type:_t&RESPONSE_FLAG?"response":"query",flags:_t&32767,flag_qr:(_t>>15&1)===1,opcode:toString$2(_t>>11&15),flag_aa:(_t>>10&1)===1,flag_tc:(_t>>9&1)===1,flag_rd:(_t>>8&1)===1,flag_ra:(_t>>7&1)===1,flag_z:(_t>>6&1)===1,flag_ad:(_t>>5&1)===1,flag_cd:(_t>>4&1)===1,rcode:toString$3(_t&15),questions:new Array(readUInt16BE($t,e+4)),answers:new Array(readUInt16BE($t,e+6)),authorities:new Array(readUInt16BE($t,e+8)),additionals:new Array(readUInt16BE($t,e+10))}},encodingLength(){return 12}}),runknown=codec({encode($t,e,_t){e||(e=new Uint8Array(runknown.encodingLength($t))),_t||(_t=0);const At=$t.length;return writeUInt16BE(e,At,_t),copy($t,e,_t+2,0,At),runknown.encode.bytes=At+2,e},decode($t,e){e||(e=0);const _t=readUInt16BE($t,e),At=$t.slice(e+2,e+2+_t);return runknown.decode.bytes=_t+2,At},encodingLength($t){return $t.length+2}}),rns=codec({encode($t,e,_t){return e||(e=new Uint8Array(rns.encodingLength($t))),_t||(_t=0),name$1.encode($t,e,_t+2),writeUInt16BE(e,name$1.encode.bytes,_t),rns.encode.bytes=name$1.encode.bytes+2,e},decode($t,e){e||(e=0);const _t=readUInt16BE($t,e),At=name$1.decode($t,e+2);return rns.decode.bytes=_t+2,At},encodingLength($t){return name$1.encodingLength($t)+2}}),rsoa=codec({encode($t,e,_t){e||(e=new Uint8Array(rsoa.encodingLength($t))),_t||(_t=0);const At=_t;return _t+=2,name$1.encode($t.mname,e,_t),_t+=name$1.encode.bytes,name$1.encode($t.rname,e,_t),_t+=name$1.encode.bytes,writeUInt32BE(e,$t.serial||0,_t),_t+=4,writeUInt32BE(e,$t.refresh||0,_t),_t+=4,writeUInt32BE(e,$t.retry||0,_t),_t+=4,writeUInt32BE(e,$t.expire||0,_t),_t+=4,writeUInt32BE(e,$t.minimum||0,_t),_t+=4,writeUInt16BE(e,_t-At-2,At),rsoa.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=e,At={};return e+=2,At.mname=name$1.decode($t,e),e+=name$1.decode.bytes,At.rname=name$1.decode($t,e),e+=name$1.decode.bytes,At.serial=readUInt32BE($t,e),e+=4,At.refresh=readUInt32BE($t,e),e+=4,At.retry=readUInt32BE($t,e),e+=4,At.expire=readUInt32BE($t,e),e+=4,At.minimum=readUInt32BE($t,e),e+=4,rsoa.decode.bytes=e-_t,At},encodingLength($t){return 22+name$1.encodingLength($t.mname)+name$1.encodingLength($t.rname)}}),rtxt=codec({encode($t,e,_t){Array.isArray($t)||($t=[$t]);for(let xt=0;xt<$t.length;xt++)if(typeof $t[xt]=="string"&&($t[xt]=from($t[xt])),!isU8Arr($t[xt]))throw new Error("Must be a Buffer");e||(e=new Uint8Array(rtxt.encodingLength($t))),_t||(_t=0);const At=_t;return _t+=2,$t.forEach(function(xt){e[_t++]=xt.length,copy(xt,e,_t,0,xt.length),_t+=xt.length}),writeUInt16BE(e,_t-At-2,At),rtxt.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=e;let At=readUInt16BE($t,e);e+=2;const xt=[];for(;At>0;){const kt=$t[e++];if(--At,At<kt)throw new Error("Buffer overflow");xt.push($t.slice(e,e+kt)),e+=kt,At-=kt}return rtxt.decode.bytes=e-_t,xt},encodingLength($t){Array.isArray($t)||($t=[$t]);let e=2;return $t.forEach(function(_t){typeof _t=="string"?e+=bytelength(_t)+1:e+=_t.length+1}),e}}),rnull=codec({encode($t,e,_t){e||(e=new Uint8Array(rnull.encodingLength($t))),_t||(_t=0),typeof $t=="string"&&($t=from($t)),$t||($t=new Uint8Array(0));const At=_t;_t+=2;const xt=$t.length;return copy($t,e,_t,0,xt),_t+=xt,writeUInt16BE(e,_t-At-2,At),rnull.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=e,At=readUInt16BE($t,e);e+=2;const xt=$t.slice(e,e+At);return e+=At,rnull.decode.bytes=e-_t,xt},encodingLength($t){return $t?(isU8Arr($t)?$t.length:bytelength($t))+2:2}}),rhinfo=codec({encode($t,e,_t){e||(e=new Uint8Array(rhinfo.encodingLength($t))),_t||(_t=0);const At=_t;return _t+=2,string.encode($t.cpu,e,_t),_t+=string.encode.bytes,string.encode($t.os,e,_t),_t+=string.encode.bytes,writeUInt16BE(e,_t-At-2,At),rhinfo.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=e,At={};return e+=2,At.cpu=string.decode($t,e),e+=string.decode.bytes,At.os=string.decode($t,e),e+=string.decode.bytes,rhinfo.decode.bytes=e-_t,At},encodingLength($t){return string.encodingLength($t.cpu)+string.encodingLength($t.os)+2}}),rptr=codec({encode($t,e,_t){return e||(e=new Uint8Array(rptr.encodingLength($t))),_t||(_t=0),name$1.encode($t,e,_t+2),writeUInt16BE(e,name$1.encode.bytes,_t),rptr.encode.bytes=name$1.encode.bytes+2,e},decode($t,e){e||(e=0);const _t=name$1.decode($t,e+2);return rptr.decode.bytes=name$1.decode.bytes+2,_t},encodingLength($t){return name$1.encodingLength($t)+2}}),rsrv=codec({encode($t,e,_t){e||(e=new Uint8Array(rsrv.encodingLength($t))),_t||(_t=0),writeUInt16BE(e,$t.priority||0,_t+2),writeUInt16BE(e,$t.weight||0,_t+4),writeUInt16BE(e,$t.port||0,_t+6),name$1.encode($t.target,e,_t+8);const At=name$1.encode.bytes+6;return writeUInt16BE(e,At,_t),rsrv.encode.bytes=At+2,e},decode($t,e){e||(e=0);const _t=readUInt16BE($t,e),At={};return At.priority=readUInt16BE($t,e+2),At.weight=readUInt16BE($t,e+4),At.port=readUInt16BE($t,e+6),At.target=name$1.decode($t,e+8),rsrv.decode.bytes=_t+2,At},encodingLength($t){return 8+name$1.encodingLength($t.target)}}),rcaa=codec({encode($t,e,_t){const At=rcaa.encodingLength($t);return e||(e=new Uint8Array(rcaa.encodingLength($t))),_t||(_t=0),$t.issuerCritical&&($t.flags=rcaa.ISSUER_CRITICAL),writeUInt16BE(e,At-2,_t),_t+=2,e[_t]=$t.flags||0,_t+=1,string.encode($t.tag,e,_t),_t+=string.encode.bytes,write(e,$t.value,_t),_t+=bytelength($t.value),rcaa.encode.bytes=At,e},decode($t,e){e||(e=0);const _t=readUInt16BE($t,e);e+=2;const At=e,xt={};return xt.flags=$t[e],e+=1,xt.tag=string.decode($t,e),e+=string.decode.bytes,xt.value=decode$2($t,e,At+_t),xt.issuerCritical=!!(xt.flags&rcaa.ISSUER_CRITICAL),rcaa.decode.bytes=_t+2,xt},encodingLength($t){return string.encodingLength($t.tag)+string.encodingLength($t.value)+2}});rcaa.ISSUER_CRITICAL=128;const rmx=codec({encode($t,e,_t){e||(e=new Uint8Array(rmx.encodingLength($t))),_t||(_t=0);const At=_t;return _t+=2,writeUInt16BE(e,$t.preference||0,_t),_t+=2,name$1.encode($t.exchange,e,_t),_t+=name$1.encode.bytes,writeUInt16BE(e,_t-At-2,At),rmx.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=e,At={};return e+=2,At.preference=readUInt16BE($t,e),e+=2,At.exchange=name$1.decode($t,e),e+=name$1.decode.bytes,rmx.decode.bytes=e-_t,At},encodingLength($t){return 4+name$1.encodingLength($t.exchange)}}),ra=codec({encode($t,e,_t){return e||(e=new Uint8Array(ra.encodingLength($t))),_t||(_t=0),writeUInt16BE(e,4,_t),_t+=2,v4.encode($t,e,_t),e},decode($t,e){return e||(e=0),e+=2,v4.decode($t,e)},bytes:6}),raaaa=codec({encode($t,e,_t){return e||(e=new Uint8Array(raaaa.encodingLength($t))),_t||(_t=0),writeUInt16BE(e,16,_t),_t+=2,v6.encode($t,e,_t),raaaa.encode.bytes=18,e},decode($t,e){e||(e=0),e+=2;const _t=v6.decode($t,e);return raaaa.decode.bytes=18,_t},bytes:18}),alloc=$t=>new Uint8Array($t),roption=codec({encode($t,e,_t){e||(e=new Uint8Array(roption.encodingLength($t))),_t||(_t=0);const At=_t,xt=toCode($t.code);if(writeUInt16BE(e,xt,_t),_t+=2,$t.data)writeUInt16BE(e,$t.data.length,_t),_t+=2,copy($t.data,e,_t),_t+=$t.data.length;else switch(xt){case 8:{const kt=$t.sourcePrefixLength||0,Bt=$t.family||familyOf($t.ip),Nt=encode$4($t.ip,alloc),Ut=Math.ceil(kt/8);writeUInt16BE(e,Ut+4,_t),_t+=2,writeUInt16BE(e,Bt,_t),_t+=2,e[_t++]=kt,e[_t++]=$t.scopePrefixLength||0,copy(Nt,e,_t,0,Ut),_t+=Ut}break;case 11:$t.timeout?(writeUInt16BE(e,2,_t),_t+=2,writeUInt16BE(e,$t.timeout,_t),_t+=2):(writeUInt16BE(e,0,_t),_t+=2);break;case 12:{const kt=$t.length||0;writeUInt16BE(e,kt,_t),_t+=2,e.fill(0,_t,_t+kt),_t+=kt}break;case 14:{const kt=$t.tags.length*2;writeUInt16BE(e,kt,_t),_t+=2;for(const Bt of $t.tags)writeUInt16BE(e,Bt,_t),_t+=2}break;default:throw new Error(`Unknown roption code: ${$t.code}`)}return roption.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t={};_t.code=readUInt16BE($t,e),_t.type=toString(_t.code),e+=2;const At=readUInt16BE($t,e);switch(e+=2,_t.data=$t.slice(e,e+At),_t.code){case 8:_t.family=readUInt16BE($t,e),e+=2,_t.sourcePrefixLength=$t[e++],_t.scopePrefixLength=$t[e++];{const xt=new Uint8Array(_t.family===1?4:16);copy($t,xt,0,e,e+At-4),_t.ip=decode$3(xt)}break;case 11:At>0&&(_t.timeout=readUInt16BE($t,e),e+=2);break;case 14:_t.tags=[];for(let xt=0;xt<At;xt+=2)_t.tags.push(readUInt16BE($t,e)),e+=2}return roption.decode.bytes=At+4,_t},encodingLength($t){if($t.data)return $t.data.length+4;switch(toCode($t.code)){case 8:{const _t=$t.sourcePrefixLength||0;return Math.ceil(_t/8)+8}case 11:return typeof $t.timeout=="number"?6:4;case 12:return $t.length+4;case 14:return 4+$t.tags.length*2}throw new Error(`Unknown roption code: ${$t.code}`)}}),ropt=codec({encode($t,e,_t){e||(e=new Uint8Array(ropt.encodingLength($t))),_t||(_t=0);const At=_t,xt=encodingLengthList($t,roption);return writeUInt16BE(e,xt,_t),_t=encodeList($t,roption,e,_t+2),ropt.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t=e,At=[];let xt=readUInt16BE($t,e);e+=2;let kt=0;for(;xt>0;)At[kt++]=roption.decode($t,e),e+=roption.decode.bytes,xt-=roption.decode.bytes;return ropt.decode.bytes=e-_t,At},encodingLength($t){return 2+encodingLengthList($t||[],roption)}}),rdnskey=codec({encode($t,e,_t){e||(e=new Uint8Array(rdnskey.encodingLength($t))),_t||(_t=0);const At=_t,xt=$t.key;if(!isU8Arr(xt))throw new Error("Key must be a Buffer");return _t+=2,writeUInt16BE(e,$t.flags,_t),_t+=2,e[_t]=rdnskey.PROTOCOL_DNSSEC,_t+=1,e[_t]=$t.algorithm,_t+=1,copy(xt,e,_t,0,xt.length),_t+=xt.length,rdnskey.encode.bytes=_t-At,writeUInt16BE(e,rdnskey.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={},xt=readUInt16BE($t,e);if(e+=2,At.flags=readUInt16BE($t,e),e+=2,$t[e]!==rdnskey.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return e+=1,At.algorithm=$t[e],e+=1,At.key=$t.slice(e,_t+xt+2),e+=At.key.length,rdnskey.decode.bytes=e-_t,At},encodingLength($t){return 6+bytelength($t.key)}});rdnskey.PROTOCOL_DNSSEC=3;rdnskey.ZONE_KEY=128;rdnskey.SECURE_ENTRYPOINT=32768;const rrrsig=codec({encode($t,e,_t){e||(e=new Uint8Array(rrrsig.encodingLength($t))),_t||(_t=0);const At=_t,xt=$t.signature;if(!isU8Arr(xt))throw new Error("Signature must be a Buffer");return _t+=2,writeUInt16BE(e,toType($t.typeCovered),_t),_t+=2,e[_t]=$t.algorithm,_t+=1,e[_t]=$t.labels,_t+=1,writeUInt32BE(e,$t.originalTTL,_t),_t+=4,writeUInt32BE(e,$t.expiration,_t),_t+=4,writeUInt32BE(e,$t.inception,_t),_t+=4,writeUInt16BE(e,$t.keyTag,_t),_t+=2,name$1.encode($t.signersName,e,_t),_t+=name$1.encode.bytes,copy(xt,e,_t,0,xt.length),_t+=xt.length,rrrsig.encode.bytes=_t-At,writeUInt16BE(e,rrrsig.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={},xt=readUInt16BE($t,e);return e+=2,At.typeCovered=toString$4(readUInt16BE($t,e)),e+=2,At.algorithm=$t[e],e+=1,At.labels=$t[e],e+=1,At.originalTTL=readUInt32BE($t,e),e+=4,At.expiration=readUInt32BE($t,e),e+=4,At.inception=readUInt32BE($t,e),e+=4,At.keyTag=readUInt16BE($t,e),e+=2,At.signersName=name$1.decode($t,e),e+=name$1.decode.bytes,At.signature=$t.slice(e,_t+xt+2),e+=At.signature.length,rrrsig.decode.bytes=e-_t,At},encodingLength($t){return 20+name$1.encodingLength($t.signersName)+bytelength($t.signature)}}),rrp=codec({encode($t,e,_t){e||(e=new Uint8Array(rrp.encodingLength($t))),_t||(_t=0);const At=_t;return _t+=2,name$1.encode($t.mbox||".",e,_t),_t+=name$1.encode.bytes,name$1.encode($t.txt||".",e,_t),_t+=name$1.encode.bytes,rrp.encode.bytes=_t-At,writeUInt16BE(e,rrp.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={};return e+=2,At.mbox=name$1.decode($t,e)||".",e+=name$1.decode.bytes,At.txt=name$1.decode($t,e)||".",e+=name$1.decode.bytes,rrp.decode.bytes=e-_t,At},encodingLength($t){return 2+name$1.encodingLength($t.mbox||".")+name$1.encodingLength($t.txt||".")}}),typebitmap=codec({encode($t,e,_t){e||(e=new Uint8Array(typebitmap.encodingLength($t))),_t||(_t=0);const At=_t,xt=[];for(let kt=0;kt<$t.length;kt++){const Bt=toType($t[kt]);xt[Bt>>8]===void 0&&(xt[Bt>>8]=[]),xt[Bt>>8][Bt>>3&31]|=1<<7-(Bt&7)}for(let kt=0;kt<xt.length;kt++)if(xt[kt]!==void 0){const Bt=from(xt[kt]);e[_t]=kt,_t+=1,e[_t]=Bt.length,_t+=1,copy(Bt,e,_t,0,Bt.length),_t+=Bt.length}return typebitmap.encode.bytes=_t-At,e},decode($t,e,_t){e||(e=0);const At=e,xt=[];for(;e-At<_t;){const kt=$t[e];e+=1;const Bt=$t[e];e+=1;for(let Nt=0;Nt<Bt;Nt++){const Ut=$t[e+Nt];for(let Lt=0;Lt<8;Lt++)if(Ut&1<<7-Lt){const jt=toString$4(kt<<8|Nt<<3|Lt);xt.push(jt)}}e+=Bt}return typebitmap.decode.bytes=e-At,xt},encodingLength($t){const e=[];for(let At=0;At<$t.length;At++){const xt=toType($t[At]);e[xt>>8]=Math.max(e[xt>>8]||0,xt&255)}let _t=0;for(let At=0;At<e.length;At++)e[At]!==void 0&&(_t+=2+Math.ceil((e[At]+1)/8));return _t}}),rnsec=codec({encode($t,e,_t){e||(e=new Uint8Array(rnsec.encodingLength($t))),_t||(_t=0);const At=_t;return _t+=2,name$1.encode($t.nextDomain,e,_t),_t+=name$1.encode.bytes,typebitmap.encode($t.rrtypes,e,_t),_t+=typebitmap.encode.bytes,rnsec.encode.bytes=_t-At,writeUInt16BE(e,rnsec.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={},xt=readUInt16BE($t,e);return e+=2,At.nextDomain=name$1.decode($t,e),e+=name$1.decode.bytes,At.rrtypes=typebitmap.decode($t,e,xt-(e-_t)),e+=typebitmap.decode.bytes,rnsec.decode.bytes=e-_t,At},encodingLength($t){return 2+name$1.encodingLength($t.nextDomain)+typebitmap.encodingLength($t.rrtypes)}}),rnsec3=codec({encode($t,e,_t){e||(e=new Uint8Array(rnsec3.encodingLength($t))),_t||(_t=0);const At=_t,xt=$t.salt;if(!isU8Arr(xt))throw new Error("salt must be a Buffer");const kt=$t.nextDomain;if(!isU8Arr(kt))throw new Error("nextDomain must be a Buffer");return _t+=2,e[_t]=$t.algorithm,_t+=1,e[_t]=$t.flags,_t+=1,writeUInt16BE(e,$t.iterations,_t),_t+=2,e[_t]=xt.length,_t+=1,copy(xt,e,_t,0,xt.length),_t+=xt.length,e[_t]=kt.length,_t+=1,copy(kt,e,_t,0,kt.length),_t+=kt.length,typebitmap.encode($t.rrtypes,e,_t),_t+=typebitmap.encode.bytes,rnsec3.encode.bytes=_t-At,writeUInt16BE(e,rnsec3.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={},xt=readUInt16BE($t,e);e+=2,At.algorithm=$t[e],e+=1,At.flags=$t[e],e+=1,At.iterations=readUInt16BE($t,e),e+=2;const kt=$t[e];e+=1,At.salt=$t.slice(e,e+kt),e+=kt;const Bt=$t[e];return e+=1,At.nextDomain=$t.slice(e,e+Bt),e+=Bt,At.rrtypes=typebitmap.decode($t,e,xt-(e-_t)),e+=typebitmap.decode.bytes,rnsec3.decode.bytes=e-_t,At},encodingLength($t){return 8+$t.salt.length+$t.nextDomain.length+typebitmap.encodingLength($t.rrtypes)}}),rds=codec({encode($t,e,_t){e||(e=new Uint8Array(rds.encodingLength($t))),_t||(_t=0);const At=_t,xt=$t.digest;if(!isU8Arr(xt))throw new Error("Digest must be a Buffer");return _t+=2,writeUInt16BE(e,$t.keyTag,_t),_t+=2,e[_t]=$t.algorithm,_t+=1,e[_t]=$t.digestType,_t+=1,copy(xt,e,_t,0,xt.length),_t+=xt.length,rds.encode.bytes=_t-At,writeUInt16BE(e,rds.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={},xt=readUInt16BE($t,e);return e+=2,At.keyTag=readUInt16BE($t,e),e+=2,At.algorithm=$t[e],e+=1,At.digestType=$t[e],e+=1,At.digest=$t.slice(e,_t+xt+2),e+=At.digest.length,rds.decode.bytes=e-_t,At},encodingLength($t){return 6+bytelength($t.digest)}}),rsshfp=codec({encode($t,e,_t){e||(e=new Uint8Array(rsshfp.encodingLength($t))),_t||(_t=0);const At=_t;_t+=2,e[_t]=$t.algorithm,_t+=1,e[_t]=$t.hash,_t+=1;const xt=hexLength($t.fingerprint),kt=getFingerprintLengthForHashType($t.hash);if(xt!==kt)throw new Error(`Invalid length of fingerprint "${$t.fingerprint}" for hashType=${$t.hash}: ${xt} != ${kt}`);return writeHex(e,$t.fingerprint,_t,_t+=xt),rsshfp.encode.bytes=_t-At,writeUInt16BE(e,rsshfp.encode.bytes-2,At),e},decode($t,e){e||(e=0);const _t=e,At={};e+=2,At.algorithm=$t[e],e+=1,At.hash=$t[e],e+=1;const xt=getFingerprintLengthForHashType(At.hash);return At.fingerprint=toHex($t,e,e+xt),e+=xt,rsshfp.decode.bytes=e-_t,At},encodingLength($t){return 4+hexLength($t.fingerprint)}});function getFingerprintLengthForHashType($t){if($t===1)return 20;if($t===2)return 32;throw new Error(`Invalid hashType=${$t}, supported=1,2`)}rsshfp.getFingerprintLengthForHashType=getFingerprintLengthForHashType;function renc($t){switch($t.toUpperCase()){case"A":return ra;case"PTR":return rptr;case"CNAME":return rptr;case"DNAME":return rptr;case"TXT":return rtxt;case"NULL":return rnull;case"AAAA":return raaaa;case"SRV":return rsrv;case"HINFO":return rhinfo;case"CAA":return rcaa;case"NS":return rns;case"SOA":return rsoa;case"MX":return rmx;case"OPT":return ropt;case"DNSKEY":return rdnskey;case"RRSIG":return rrrsig;case"RP":return rrp;case"NSEC":return rnsec;case"NSEC3":return rnsec3;case"SSHFP":return rsshfp;case"DS":return rds}return runknown}const answer=codec({encode($t,e,_t){e||(e=new Uint8Array(answer.encodingLength($t))),_t||(_t=0);const At=_t;if(name$1.encode($t.name,e,_t),_t+=name$1.encode.bytes,writeUInt16BE(e,toType($t.type),_t),$t.type.toUpperCase()==="OPT"){if($t.name!==".")throw new Error("OPT name must be root.");writeUInt16BE(e,$t.udpPayloadSize||4096,_t+2),e[_t+4]=$t.extendedRcode||0,e[_t+5]=$t.ednsVersion||0,writeUInt16BE(e,$t.flags||0,_t+6),_t+=8,ropt.encode($t.options||[],e,_t),_t+=ropt.encode.bytes}else{let xt=toClass($t.class===void 0?"IN":$t.class);$t.flush&&(xt|=FLUSH_MASK),writeUInt16BE(e,xt,_t+2),writeUInt32BE(e,$t.ttl||0,_t+4),_t+=8;const kt=renc($t.type);kt.encode($t.data,e,_t),_t+=kt.encode.bytes}return answer.encode.bytes=_t-At,e},decode($t,e){e||(e=0);const _t={},At=e;if(_t.name=name$1.decode($t,e),e+=name$1.decode.bytes,_t.type=toString$4(readUInt16BE($t,e)),_t.type==="OPT")_t.udpPayloadSize=readUInt16BE($t,e+2),_t.extendedRcode=$t[e+4],_t.ednsVersion=$t[e+5],_t.flags=readUInt16BE($t,e+6),_t.flag_do=(_t.flags>>15&1)===1,_t.options=ropt.decode($t,e+8),e+=8+ropt.decode.bytes;else{const xt=readUInt16BE($t,e+2);_t.ttl=readUInt32BE($t,e+4),_t.class=toString$1(xt&NOT_FLUSH_MASK),_t.flush=!!(xt&FLUSH_MASK);const kt=renc(_t.type);_t.data=kt.decode($t,e+8),e+=8+kt.decode.bytes}return answer.decode.bytes=e-At,_t},encodingLength($t){const e=$t.data!==null&&$t.data!==void 0?$t.data:$t.options;return name$1.encodingLength($t.name)+8+renc($t.type).encodingLength(e)}}),question=codec({encode($t,e,_t){e||(e=new Uint8Array(question.encodingLength($t))),_t||(_t=0);const At=_t;return name$1.encode($t.name,e,_t),_t+=name$1.encode.bytes,writeUInt16BE(e,toType($t.type),_t),_t+=2,writeUInt16BE(e,toClass($t.class===void 0?"IN":$t.class),_t),_t+=2,question.encode.bytes=_t-At,$t},decode($t,e){e||(e=0);const _t=e,At={};return At.name=name$1.decode($t,e),e+=name$1.decode.bytes,At.type=toString$4(readUInt16BE($t,e)),e+=2,At.class=toString$1(readUInt16BE($t,e)),e+=2,!!(At.class&QU_MASK)&&(At.class&=NOT_QU_MASK),question.decode.bytes=e-_t,At},encodingLength($t){return name$1.encodingLength($t.name)+4}}),AUTHORITATIVE_ANSWER=1024,packet={encode:function($t,e,_t){const At=!e;At&&(e=new Uint8Array(encodingLength($t))),_t||(_t=0);const xt=_t;return $t.questions||($t.questions=[]),$t.answers||($t.answers=[]),$t.authorities||($t.authorities=[]),$t.additionals||($t.additionals=[]),header.encode($t,e,_t),_t+=header.encode.bytes,_t=encodeList($t.questions,question,e,_t),_t=encodeList($t.answers,answer,e,_t),_t=encodeList($t.authorities,answer,e,_t),_t=encodeList($t.additionals,answer,e,_t),packet.encode.bytes=_t-xt,At&&encode$2.bytes!==e.length?e.slice(0,encode$2.bytes):e},decode:function($t,e){e||(e=0);const _t=e,At=header.decode($t,e);return e+=header.decode.bytes,e=decodeList(At.questions,question,$t,e),e=decodeList(At.answers,answer,$t,e),e=decodeList(At.authorities,answer,$t,e),e=decodeList(At.additionals,answer,$t,e),packet.decode.bytes=e-_t,At},encodingLength:function($t){return header.encodingLength($t)+encodingLengthList($t.questions||[],question)+encodingLengthList($t.answers||[],answer)+encodingLengthList($t.authorities||[],answer)+encodingLengthList($t.additionals||[],answer)}};packet.encode.bytes=0;packet.decode.bytes=0;const encode$2=packet.encode,decode$1=packet.decode,encodingLength=packet.encodingLength;function encodingLengthList($t,e){let _t=0;for(let At=0;At<$t.length;At++)_t+=e.encodingLength($t[At]);return _t}function encodeList($t,e,_t,At){for(let xt=0;xt<$t.length;xt++)e.encode($t[xt],_t,At),At+=e.encode.bytes;return At}function decodeList($t,e,_t,At){for(let xt=0;xt<$t.length;xt++)$t[xt]=e.decode(_t,At),At+=e.decode.bytes;return At}var __awaiter$1H=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidMethod$2=class{static getSigningMethod(e){return __awaiter$1H(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,_t){return __awaiter$1H(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}};var __awaiter$1G=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$p=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const DEFAULT_GATEWAY_URI$5="https://diddht.tbddev.org",DID_DHT_SPECIFICATION_VERSION$2=0,DNS_RECORD_TTL$2=7200,PROPERTY_SEPARATOR$2=";",VALUE_SEPARATOR$2=",";var DidDhtRegisteredDidType$2;(function($t){$t[$t.Discoverable=0]="Discoverable",$t[$t.Organization=1]="Organization",$t[$t.Government=2]="Government",$t[$t.Corporation=3]="Corporation",$t[$t.LocalBusiness=4]="LocalBusiness",$t[$t.SoftwarePackage=5]="SoftwarePackage",$t[$t.WebApp=6]="WebApp",$t[$t.FinancialInstitution=7]="FinancialInstitution"})(DidDhtRegisteredDidType$2||(DidDhtRegisteredDidType$2={}));var DidDhtRegisteredKeyType$2;(function($t){$t[$t.Ed25519=0]="Ed25519",$t[$t.secp256k1=1]="secp256k1",$t[$t.secp256r1=2]="secp256r1",$t[$t.X25519=3]="X25519"})(DidDhtRegisteredKeyType$2||(DidDhtRegisteredKeyType$2={}));var DidDhtVerificationRelationship$2;(function($t){$t.authentication="auth",$t.assertionMethod="asm",$t.capabilityDelegation="del",$t.capabilityInvocation="inv",$t.keyAgreement="agm"})(DidDhtVerificationRelationship$2||(DidDhtVerificationRelationship$2={}));const AlgorithmToKeyTypeMap$8={Ed25519:DidDhtRegisteredKeyType$2.Ed25519,ES256K:DidDhtRegisteredKeyType$2.secp256k1,ES256:DidDhtRegisteredKeyType$2.secp256r1,"P-256":DidDhtRegisteredKeyType$2.secp256r1,secp256k1:DidDhtRegisteredKeyType$2.secp256k1,secp256r1:DidDhtRegisteredKeyType$2.secp256r1,X25519:DidDhtRegisteredKeyType$2.X25519},KeyTypeToDefaultAlgorithmMap$2={[DidDhtRegisteredKeyType$2.Ed25519]:"EdDSA",[DidDhtRegisteredKeyType$2.secp256k1]:"ES256K",[DidDhtRegisteredKeyType$2.secp256r1]:"ES256",[DidDhtRegisteredKeyType$2.X25519]:"ECDH-ES+A256KW"};let DidDht$2=class Ro extends DidMethod$2{static create(){return __awaiter$1G(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:_t={}}={}){var At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt;if(!((At=_t.verificationMethods)===null||At===void 0)&&At.some(dr=>!(dr.algorithm in AlgorithmToKeyTypeMap$8)))throw new Error("One or more verification method algorithms are not supported");const Vt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt.filter(dr=>"id"in dr).map(dr=>dr.id);if(Vt&&Vt.length!==new Set(Vt).size)throw new Error("One or more verification method IDs are not unique");if(!((kt=_t.services)===null||kt===void 0)&&kt.some(dr=>!dr.id||!dr.type||!dr.serviceEndpoint))throw new Error("One or more services are missing required properties");const Ht=yield e.generateKey({algorithm:"Ed25519"}),Wt=yield e.getPublicKey({keyUri:Ht}),Qt=yield DidDhtUtils$2.identityKeyToIdentifier({identityKey:Wt}),Xt=Object.assign(Object.assign({id:Qt},_t.alsoKnownAs&&{alsoKnownAs:_t.alsoKnownAs}),_t.controllers&&{controller:_t.controllers}),Jt=[...(Bt=_t.verificationMethods)!==null&&Bt!==void 0?Bt:[]];Jt!=null&&Jt.some(dr=>{var vr;return((vr=dr.id)===null||vr===void 0?void 0:vr.split("#").pop())==="0"})||Jt.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const dr of Jt){const vr=dr.id&&dr.id.split("#").pop()==="0"?Ht:yield e.generateKey({algorithm:dr.algorithm}),$r=yield e.getPublicKey({keyUri:vr});let Ir=(Ut=(Nt=dr.id)!==null&&Nt!==void 0?Nt:$r.kid)!==null&&Ut!==void 0?Ut:yield computeJwkThumbprint$2({jwk:$r});Ir=`${Qt}#${extractDidFragment$2(Ir)}`,(Lt=Xt.verificationMethod)!==null&&Lt!==void 0||(Xt.verificationMethod=[]),Xt.verificationMethod.push({id:Ir,type:"JsonWebKey",controller:(jt=dr.controller)!==null&&jt!==void 0?jt:Qt,publicKeyJwk:$r});for(const Rr of(Kt=dr.purposes)!==null&&Kt!==void 0?Kt:[])Xt[Rr]||(Xt[Rr]=[]),Xt[Rr].push(Ir)}(qt=_t.services)===null||qt===void 0||qt.forEach(dr=>{var vr;(vr=Xt.service)!==null&&vr!==void 0||(Xt.service=[]),dr.id=`${Qt}#${dr.id.split("#").pop()}`,Xt.service.push(dr)});const tr=new BearerDid$2({uri:Qt,document:Xt,metadata:Object.assign({published:!1},_t.types&&{types:_t.types}),keyManager:e});if(!((zt=_t.publish)!==null&&zt!==void 0)||zt){const dr=yield Ro.publish({did:tr,gatewayUri:_t.gatewayUri});tr.metadata=dr.didDocumentMetadata}return tr})}static import(e){return __awaiter$1G(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$3}){var xt;const kt=Did$2.parse(_t.uri);if((kt==null?void 0:kt.method)!==Ro.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");const Bt=yield BearerDid$2.import({portableDid:_t,keyManager:At});if(!(!((xt=Bt.document.verificationMethod)===null||xt===void 0)&&xt.some(Nt=>{var Ut;return((Ut=Nt.id)===null||Ut===void 0?void 0:Ut.split("#").pop())==="0"})))throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"DID document must contain an Identity Key");return Bt})}static getSigningMethod(e){return __awaiter$1G(this,arguments,void 0,function*({didDocument:_t,methodId:At="#0"}){var xt;const kt=Did$2.parse(_t.id);if(kt&&kt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${kt.method}`);const Bt=(xt=_t.verificationMethod)===null||xt===void 0?void 0:xt.find(Nt=>{var Ut,Lt;return extractDidFragment$2(Nt.id)===((Ut=extractDidFragment$2(At))!==null&&Ut!==void 0?Ut:extractDidFragment$2((Lt=_t.assertionMethod)===null||Lt===void 0?void 0:Lt[0]))});if(!(Bt&&Bt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static publish(e){return __awaiter$1G(this,arguments,void 0,function*({did:_t,gatewayUri:At=DEFAULT_GATEWAY_URI$5}){return yield DidDhtDocument$2.put({did:_t,gatewayUri:At})})}static resolve(e){return __awaiter$1G(this,arguments,void 0,function*(_t,At={}){var xt;const kt=(xt=At==null?void 0:At.gatewayUri)!==null&&xt!==void 0?xt:DEFAULT_GATEWAY_URI$5;try{yield DidDhtUtils$2.identifierToIdentityKey({didUri:_t});const{didDocument:Bt,didDocumentMetadata:Nt}=yield DidDhtDocument$2.get({didUri:_t,gatewayUri:kt});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:Bt,didDocumentMetadata:Nt})}catch(Bt){if(!(Bt instanceof DidError$2))throw new Error(Bt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:Object.assign({error:Bt.code},Bt.message&&{errorMessage:Bt.message})})}})}};DidDht$2.methodName="dht";let DidDhtDocument$2=class zi{static get(e){return __awaiter$1G(this,arguments,void 0,function*({didUri:_t,gatewayUri:At}){const xt=DidDhtUtils$2.identifierToIdentityKeyBytes({didUri:_t}),kt=yield zi.pkarrGet({gatewayUri:At,publicKeyBytes:xt}),Bt=yield DidDhtUtils$2.parseBep44GetMessage({bep44Message:kt}),Nt=yield zi.fromDnsPacket({didUri:_t,dnsPacket:Bt});return Nt.didDocumentMetadata.versionId=kt.seq.toString(),Nt})}static put(e){return __awaiter$1G(this,arguments,void 0,function*({did:_t,gatewayUri:At}){const xt=yield zi.toDnsPacket({didDocument:_t.document,didMetadata:_t.metadata,authoritativeGatewayUris:[At]}),kt=yield DidDhtUtils$2.createBep44PutMessage({dnsPacket:xt,publicKeyBytes:DidDhtUtils$2.identifierToIdentityKeyBytes({didUri:_t.uri}),signer:yield _t.getSigner({methodId:"0"})}),Bt=yield zi.pkarrPut({gatewayUri:At,bep44Message:kt});return{didDocument:_t.document,didDocumentMetadata:Object.assign(Object.assign({},_t.metadata),{published:Bt,versionId:kt.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return __awaiter$1G(this,arguments,void 0,function*({gatewayUri:_t,publicKeyBytes:At}){const xt=Convert.uint8Array(At).toBase32Z(),kt=new URL(xt,_t).href;let Bt;try{if(Bt=yield fetch(kt,{method:"GET"}),!Bt.ok)throw new DidError$2(DidErrorCode$2.NotFound,`Pkarr record not found for: ${xt}`)}catch(Lt){throw Lt instanceof DidError$2?Lt:new DidError$2(DidErrorCode$2.InternalError,`Failed to fetch Pkarr record: ${Lt.message}`)}const Nt=yield Bt.arrayBuffer();if(!Nt)throw new DidError$2(DidErrorCode$2.NotFound,`Pkarr record not found for: ${xt}`);if(Nt.byteLength<72)throw new DidError$2(DidErrorCode$2.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${Nt.byteLength}`);if(Nt.byteLength>1072)throw new DidError$2(DidErrorCode$2.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${Nt.byteLength}`);return{k:At,seq:Number(new DataView(Nt).getBigUint64(64)),sig:new Uint8Array(Nt,0,64),v:new Uint8Array(Nt,72)}})}static pkarrPut(e){return __awaiter$1G(this,arguments,void 0,function*({gatewayUri:_t,bep44Message:At}){const xt=Convert.uint8Array(At.k).toBase32Z(),kt=new URL(xt,_t).href,Bt=new Uint8Array(At.v.length+72);Bt.set(At.sig,0),new DataView(Bt.buffer).setBigUint64(At.sig.length,BigInt(At.seq)),Bt.set(At.v,At.sig.length+8);let Nt;try{Nt=yield fetch(kt,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:Bt})}catch(Ut){throw new DidError$2(DidErrorCode$2.InternalError,`Failed to put Pkarr record for identifier ${xt}: ${Ut.message}`)}return Nt.ok})}static fromDnsPacket(e){return __awaiter$1G(this,arguments,void 0,function*({didUri:_t,dnsPacket:At}){var xt,kt,Bt;const Nt={id:_t},Ut={published:!0},Lt=new Map;for(const jt of(xt=At==null?void 0:At.answers)!==null&&xt!==void 0?xt:[]){if(jt.type!=="TXT")continue;const Kt=jt.name.split(".")[0].substring(1);switch(!0){case Kt.startsWith("aka"):{const qt=DidDhtUtils$2.parseTxtDataToString(jt.data);Nt.alsoKnownAs=qt.split(VALUE_SEPARATOR$2);break}case Kt.startsWith("cnt"):{const qt=DidDhtUtils$2.parseTxtDataToString(jt.data);Nt.controller=qt.includes(VALUE_SEPARATOR$2)?qt.split(VALUE_SEPARATOR$2):qt;break}case Kt.startsWith("k"):{const{id:qt,t:zt,k:Vt,c:Ht,a:Wt}=DidDhtUtils$2.parseTxtDataToObject(jt.data),Qt=Convert.base64Url(Vt).toUint8Array(),Xt=DidDhtRegisteredKeyType$2[Number(zt)];let Jt=yield DidDhtUtils$2.keyConverter(Xt).bytesToPublicKey({publicKeyBytes:Qt});Jt.alg=Wt||KeyTypeToDefaultAlgorithmMap$2[Number(zt)];const tr=Kt==="k0"?"0":qt!==void 0?qt:yield computeJwkThumbprint$2({jwk:Jt});(kt=Nt.verificationMethod)!==null&&kt!==void 0||(Nt.verificationMethod=[]);const dr=`${_t}#${tr}`;Nt.verificationMethod.push({id:dr,type:"JsonWebKey",controller:Ht??_t,publicKeyJwk:Jt}),Lt.set(Kt,dr);break}case Kt.startsWith("s"):{const qt=DidDhtUtils$2.parseTxtDataToObject(jt.data),{id:zt,t:Vt,se:Ht}=qt,Wt=__rest$p(qt,["id","t","se"]),Qt=Ht.includes(VALUE_SEPARATOR$2)?Ht.split(VALUE_SEPARATOR$2):[Ht],Xt=Object.fromEntries(Object.entries(Wt).map(([Jt,tr])=>[Jt,tr.includes(VALUE_SEPARATOR$2)?tr.split(VALUE_SEPARATOR$2):tr]));(Bt=Nt.service)!==null&&Bt!==void 0||(Nt.service=[]),Nt.service.push(Object.assign(Object.assign({},Xt),{id:`${_t}#${zt}`,type:Vt,serviceEndpoint:Qt}));break}case Kt.startsWith("typ"):{const{id:qt}=DidDhtUtils$2.parseTxtDataToObject(jt.data);Ut.types=qt.split(VALUE_SEPARATOR$2).map(zt=>Number(zt));break}case Kt.startsWith("did"):{const qt=Xt=>Xt.split(VALUE_SEPARATOR$2).map(Jt=>Lt.get(Jt)).filter(Jt=>typeof Jt=="string"),{auth:zt,asm:Vt,del:Ht,inv:Wt,agm:Qt}=DidDhtUtils$2.parseTxtDataToObject(jt.data);zt&&(Nt.authentication=qt(zt)),Vt&&(Nt.assertionMethod=qt(Vt)),Ht&&(Nt.capabilityDelegation=qt(Ht)),Wt&&(Nt.capabilityInvocation=qt(Wt)),Qt&&(Nt.keyAgreement=qt(Qt));break}}}return{didDocument:Nt,didDocumentMetadata:Ut,didResolutionMetadata:{}}})}static toDnsPacket(e){return __awaiter$1G(this,arguments,void 0,function*({didDocument:_t,didMetadata:At,authoritativeGatewayUris:xt,previousDidProof:kt}){var Bt,Nt,Ut,Lt,jt;const Kt=[],qt=[],zt=new Map,Vt=[],Ht=[];if(kt!==void 0){const{signature:Xt,previousDid:Jt}=kt;yield DidDhtUtils$2.validatePreviousDidProof({newDid:_t.id,previousDidProof:kt}),Kt.push({type:"TXT",name:"_prv._did.",ttl:DNS_RECORD_TTL$2,data:`id=${Jt};s=${Xt}`})}if(_t.alsoKnownAs&&Kt.push({type:"TXT",name:"_aka._did.",ttl:DNS_RECORD_TTL$2,data:_t.alsoKnownAs.join(VALUE_SEPARATOR$2)}),_t.controller){const Xt=Array.isArray(_t.controller)?_t.controller.join(VALUE_SEPARATOR$2):_t.controller;Kt.push({type:"TXT",name:"_cnt._did.",ttl:DNS_RECORD_TTL$2,data:Xt})}for(const[Xt,Jt]of(Nt=(Bt=_t.verificationMethod)===null||Bt===void 0?void 0:Bt.entries())!==null&&Nt!==void 0?Nt:[]){const tr=`k${Xt}`;Ht.push(tr);let dr=Jt.id.split("#").pop();zt.set(dr,tr);const vr=Jt.publicKeyJwk;if(!(vr!=null&&vr.crv&&vr.crv in AlgorithmToKeyTypeMap$8))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Verification method '${Jt.id}' contains an unsupported key type: ${(Ut=vr==null?void 0:vr.crv)!==null&&Ut!==void 0?Ut:"undefined"}`);const $r=DidDhtRegisteredKeyType$2[vr.crv],Ir=yield DidDhtUtils$2.keyConverter(vr.crv).publicKeyToBytes({publicKey:vr}),Rr=Convert.uint8Array(Ir).toBase64Url(),Nr=[`t=${$r}`,`k=${Rr}`];dr!=="0"&&(yield computeJwkThumbprint$2({jwk:vr}))!==dr&&Nr.unshift(`id=${dr}`),vr.alg!==KeyTypeToDefaultAlgorithmMap$2[$r]&&Nr.push(`a=${vr.alg}`),Jt.controller!==_t.id&&Nr.push(`c=${Jt.controller}`),Kt.push({type:"TXT",name:`_${tr}._did.`,ttl:DNS_RECORD_TTL$2,data:Nr.join(PROPERTY_SEPARATOR$2)})}(Lt=_t.service)===null||Lt===void 0||Lt.forEach((Xt,Jt)=>{const tr=`s${Jt}`;Vt.push(tr);let{id:dr,type:vr,serviceEndpoint:$r}=Xt,Ir=__rest$p(Xt,["id","type","serviceEndpoint"]);dr=extractDidFragment$2(dr),$r=Array.isArray($r)?$r.join(","):$r;const Nr=Object.entries(Object.assign({id:dr,t:vr,se:$r},Ir)).map(([lr,ir])=>`${lr}=${ir}`).join(PROPERTY_SEPARATOR$2),kr=DidDhtUtils$2.chunkDataIfNeeded(Nr);Kt.push({type:"TXT",name:`_${tr}._did.`,ttl:DNS_RECORD_TTL$2,data:kr})});const Wt=[`v=${DID_DHT_SPECIFICATION_VERSION$2}`];if(Ht.length&&Wt.push(`vm=${Ht.join(VALUE_SEPARATOR$2)}`),Object.keys(DidVerificationRelationship$2).forEach(Xt=>{var Jt;const tr=(Jt=_t[Xt])===null||Jt===void 0?void 0:Jt.map(dr=>zt.get(dr.split("#").pop()));if(tr){const dr=DidDhtVerificationRelationship$2[Xt];Wt.push(`${dr}=${tr.join(VALUE_SEPARATOR$2)}`)}}),Vt.length&&Wt.push(`svc=${Vt.join(VALUE_SEPARATOR$2)}`),!((jt=At.types)===null||jt===void 0)&&jt.length){const Jt=At.types.map(tr=>typeof tr=="string"?DidDhtRegisteredDidType$2[tr]:tr);Kt.push({type:"TXT",name:"_typ._did.",ttl:DNS_RECORD_TTL$2,data:`id=${Jt.join(VALUE_SEPARATOR$2)}`})}Kt.push({type:"TXT",name:"_did."+zi.getUniqueDidSuffix(_t.id)+".",ttl:DNS_RECORD_TTL$2,data:Wt.join(PROPERTY_SEPARATOR$2)});for(const Xt of xt||[])qt.push({type:"NS",name:"_did."+zi.getUniqueDidSuffix(_t.id)+".",ttl:DNS_RECORD_TTL$2,data:Xt+"."});return{id:0,type:"response",flags:AUTHORITATIVE_ANSWER,answers:[...Kt,...qt]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}},DidDhtUtils$2=class Eo{static createBep44PutMessage(e){return __awaiter$1G(this,arguments,void 0,function*({dnsPacket:_t,publicKeyBytes:At,signer:xt}){const kt=Math.ceil(Date.now()/1e3),Bt=encode$2(_t),Nt=bencode.encode({seq:kt,v:Bt}).subarray(1,-1);if(Nt.length>1e3)throw new DidError$2(DidErrorCode$2.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${Nt.length} bytes`);const Ut=yield xt.sign({data:Nt});return{k:At,seq:kt,sig:Ut,v:Bt}})}static identifierToIdentityKey(e){return __awaiter$1G(this,arguments,void 0,function*({didUri:_t}){let At=Eo.identifierToIdentityKeyBytes({didUri:_t});return yield Ed25519$2.bytesToPublicKey({publicKeyBytes:At})})}static identifierToIdentityKeyBytes({didUri:e}){const _t=Did$2.parse(e);if(!_t)throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid DID URI: ${e}`);if(_t.method!==DidDht$2.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${_t.method}`);let At;try{At=Convert.base32Z(_t.id).toUint8Array()}catch{throw new DidError$2(DidErrorCode$2.InvalidPublicKey,"Failed to decode method-specific identifier")}if(At.length!==32)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyLength,`Invalid public key length: ${At.length}`);return At}static identityKeyToIdentifier(e){return __awaiter$1G(this,arguments,void 0,function*({identityKey:_t}){const At=yield Ed25519$2.publicKeyToBytes({publicKey:_t}),xt=Convert.uint8Array(At).toBase32Z();return`did:${DidDht$2.methodName}:${xt}`})}static keyConverter(e){const At={Ed25519:Ed25519$2,"P-256":{publicKeyToBytes:xt=>__awaiter$1G(this,[xt],void 0,function*({publicKey:kt}){const Bt=yield Secp256r1$2.publicKeyToBytes({publicKey:kt});return yield Secp256r1$2.compressPublicKey({publicKeyBytes:Bt})}),bytesToPublicKey:Secp256r1$2.bytesToPublicKey,privateKeyToBytes:Secp256r1$2.privateKeyToBytes,bytesToPrivateKey:Secp256r1$2.bytesToPrivateKey},secp256k1:{publicKeyToBytes:xt=>__awaiter$1G(this,[xt],void 0,function*({publicKey:kt}){const Bt=yield Secp256k1$2.publicKeyToBytes({publicKey:kt});return yield Secp256k1$2.compressPublicKey({publicKeyBytes:Bt})}),bytesToPublicKey:Secp256k1$2.bytesToPublicKey,privateKeyToBytes:Secp256k1$2.privateKeyToBytes,bytesToPrivateKey:Secp256k1$2.bytesToPrivateKey},X25519:X25519$2}[e];if(!At)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static parseBep44GetMessage(e){return __awaiter$1G(this,arguments,void 0,function*({bep44Message:_t}){const At=yield Ed25519$2.bytesToPublicKey({publicKeyBytes:_t.k}),xt=bencode.encode({seq:_t.seq,v:_t.v}).subarray(1,-1);if(!(yield Ed25519$2.verify({key:At,signature:_t.sig,data:xt})))throw new DidError$2(DidErrorCode$2.InvalidSignature,"Invalid signature for DHT BEP44 message");return decode$1(_t.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(PROPERTY_SEPARATOR$2).reduce((_t,At)=>{const[xt,kt]=At.split("=");return _t[xt]=kt,_t},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return Convert.uint8Array(e).toString();if(Array.isArray(e))return e.map(_t=>this.parseTxtDataToString(_t)).join("");throw new DidError$2(DidErrorCode$2.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return __awaiter$1G(this,arguments,void 0,function*({newDid:_t,previousDidProof:At}){const xt=yield Eo.identifierToIdentityKey({didUri:At.previousDid}),kt=Eo.identifierToIdentityKeyBytes({didUri:_t}),Bt=Convert.base64Url(At.signature).toUint8Array();if(!(yield Ed25519$2.verify({key:xt,data:kt,signature:Bt})))throw new DidError$2(DidErrorCode$2.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const _t=[];for(let At=0;At<e.length;At+=255)_t.push(e.slice(At,At+255));return _t}};const ErrorCode={DeltaExceedsMaximumSize:"DeltaExceedsMaximumSize",DidDocumentPublicKeyIdDuplicated:"DidDocumentPublicKeyIdDuplicated",DidDocumentPublicKeyMissingOrIncorrectType:"DidDocumentPublicKeyMissingOrIncorrectType",DidDocumentServiceIdDuplicated:"DidDocumentServiceIdDuplicated",DidSuffixIncorrectLength:"DidSuffixIncorrectLength",EncodedStringIncorrectEncoding:"EncodedStringIncorrectEncoding",IdNotUsingBase64UrlCharacterSet:"IdNotUsingBase64UrlCharacterSet",IdTooLong:"IdTooLong",JwkEs256kMissingOrInvalidCrv:"JwkEs256kMissingOrInvalidCrv",JwkEs256kMissingOrInvalidKty:"JwkEs256kMissingOrInvalidKty",JwkEs256kHasIncorrectLengthOfX:"JwkEs256kHasIncorrectLengthOfX",JwkEs256kHasIncorrectLengthOfY:"JwkEs256kHasIncorrectLengthOfY",JwkEs256kHasIncorrectLengthOfD:"JwkEs256kHasIncorrectLengthOfD",MultihashStringNotAMultihash:"MultihashStringNotAMultihash",MultihashUnsupportedHashAlgorithm:"MultihashUnsupportedHashAlgorithm",PublicKeyJwkEs256kHasUnexpectedProperty:"PublicKeyJwkEs256kHasUnexpectedProperty",PublicKeyPurposeDuplicated:"PublicKeyPurposeDuplicated",ServiceEndpointCannotBeAnArray:"ServiceEndpointCannotBeAnArray",ServiceEndpointStringNotValidUri:"ServiceEndpointStringNotValidUri",ServiceTypeTooLong:"ServiceTypeTooLong"};class IonError extends Error{constructor(e,_t){super(`${e}: ${_t}`),this.code=e,Object.setPrototypeOf(this,new.target.prototype)}}class Encoder{static encode(e){return base64url$1.baseEncode(e)}static decodeAsBytes(e,_t){if(!Encoder.isBase64UrlString(e))throw new IonError(ErrorCode.EncodedStringIncorrectEncoding,`Given ${_t} must be base64url string.`);return base64url$1.baseDecode(e)}static decodeAsString(e,_t){const At=Encoder.decodeAsBytes(e,_t);return Encoder.bytesToString(At)}static isBase64UrlString(e){return/^[A-Za-z0-9_-]+$/.test(e)}static stringToBytes(e){return new TextEncoder().encode(e)}static bytesToString(e){return new TextDecoder().decode(e)}}var OperationKeyType;(function($t){$t.Public="public",$t.Private="private"})(OperationKeyType||(OperationKeyType={}));const OperationKeyType$1=OperationKeyType;class InputValidator{static validateEs256kOperationKey(e,_t){const At=new Set(["kty","crv","x","y"]);_t===OperationKeyType$1.Private&&At.add("d");for(const xt in e)if(!At.has(xt))throw new IonError(ErrorCode.PublicKeyJwkEs256kHasUnexpectedProperty,`SECP256K1 JWK key has unexpected property '${xt}'.`);if(e.crv!=="secp256k1")throw new IonError(ErrorCode.JwkEs256kMissingOrInvalidCrv,`SECP256K1 JWK 'crv' property must be 'secp256k1' but got '${e.crv}.'`);if(e.kty!=="EC")throw new IonError(ErrorCode.JwkEs256kMissingOrInvalidKty,`SECP256K1 JWK 'kty' property must be 'EC' but got '${e.kty}.'`);if(e.x.length!==43)throw new IonError(ErrorCode.JwkEs256kHasIncorrectLengthOfX,"SECP256K1 JWK 'x' property must be 43 bytes.");if(e.y.length!==43)throw new IonError(ErrorCode.JwkEs256kHasIncorrectLengthOfY,"SECP256K1 JWK 'y' property must be 43 bytes.");if(_t===OperationKeyType$1.Private&&(e.d===void 0||e.d.length!==43))throw new IonError(ErrorCode.JwkEs256kHasIncorrectLengthOfD,"SECP256K1 JWK 'd' property must be 43 bytes.")}static validateId(e){if(e.length>50)throw new IonError(ErrorCode.IdTooLong,`Key ID length ${e.length} exceed max allowed length of 50.`);if(!Encoder.isBase64UrlString(e))throw new IonError(ErrorCode.IdNotUsingBase64UrlCharacterSet,`Key ID '${e}' is not a Base64URL string.`)}static validatePublicKeyPurposes(e){if(e===void 0)return;const _t=new Set;for(const At of e){if(_t.has(At))throw new IonError(ErrorCode.PublicKeyPurposeDuplicated,`Public key purpose '${At}' already specified.`);_t.add(At)}}}class IonSdkConfig{}IonSdkConfig.hashAlgorithmInMultihashCode=18;IonSdkConfig.maxCanonicalizedDeltaSizeInBytes=1e3;var canonicalize$2=function $t(e){if(typeof e=="number"&&isNaN(e))throw new Error("NaN is not allowed");if(typeof e=="number"&&!isFinite(e))throw new Error("Infinity is not allowed");return e===null||typeof e!="object"?JSON.stringify(e):e.toJSON instanceof Function?$t(e.toJSON()):Array.isArray(e)?`[${e.reduce((xt,kt,Bt)=>`${xt}${Bt===0?"":","}${$t(kt===void 0||typeof kt=="symbol"?null:kt)}`,"")}]`:`{${Object.keys(e).sort().reduce((At,xt)=>{if(e[xt]===void 0||typeof e[xt]=="symbol")return At;const kt=At.length===0?"":",";return`${At}${kt}${$t(xt)}:${$t(e[xt])}`},"")}}`};const canonicalize$3=getDefaultExportFromCjs(canonicalize$2);class JsonCanonicalizer{static canonicalizeAsBytes(e){const _t=JsonCanonicalizer.removeAllUndefinedProperties(e),At=canonicalize$3(_t);return Encoder.stringToBytes(At)}static removeAllUndefinedProperties(e){for(const _t in e)typeof e[_t]=="object"?JsonCanonicalizer.removeAllUndefinedProperties(e[_t]):e[_t]===void 0&&delete e[_t];return e}}var __awaiter$1F=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Multihash{static hash(e,_t){return __awaiter$1F(this,void 0,void 0,function*(){let At;switch(_t){case 18:At=(yield sha256$4.digest(e)).bytes;break;default:throw new IonError(ErrorCode.MultihashUnsupportedHashAlgorithm,`Hash algorithm defined in multihash code ${_t} is not supported.`)}return At})}static hashAsNonMultihashBytes(e,_t){return __awaiter$1F(this,void 0,void 0,function*(){let At;switch(_t){case 18:At=yield sha256$4.encode(e);break;default:throw new IonError(ErrorCode.MultihashUnsupportedHashAlgorithm,`Hash algorithm defined in multihash code ${_t} is not supported.`)}return At})}static canonicalizeThenHashThenEncode(e,_t){return __awaiter$1F(this,void 0,void 0,function*(){const At=JsonCanonicalizer.canonicalizeAsBytes(e);return yield Multihash.hashThenEncode(At,_t)})}static canonicalizeThenDoubleHashThenEncode(e,_t){return __awaiter$1F(this,void 0,void 0,function*(){const At=JsonCanonicalizer.canonicalizeAsBytes(e),xt=yield Multihash.hashAsNonMultihashBytes(At,_t);return yield Multihash.hashThenEncode(xt,_t)})}static hashThenEncode(e,_t){return __awaiter$1F(this,void 0,void 0,function*(){const At=yield Multihash.hash(e,_t);return Encoder.encode(At)})}static validateEncodedHashComputedUsingSupportedHashAlgorithm(e,_t){let At;const xt=Encoder.decodeAsBytes(e,_t);try{At=decode$c(xt)}catch{throw new IonError(ErrorCode.MultihashStringNotAMultihash,`Given ${_t} string '${e}' is not a multihash after decoding.`)}const kt=IonSdkConfig.hashAlgorithmInMultihashCode;if(kt!==At.code)throw new IonError(ErrorCode.MultihashUnsupportedHashAlgorithm,`Given ${_t} uses unsupported multihash algorithm with code ${At.code}, should use ${kt} or change IonSdkConfig to desired hashing algorithm.`)}}var OperationType;(function($t){$t.Create="create",$t.Update="update",$t.Deactivate="deactivate",$t.Recover="recover"})(OperationType||(OperationType={}));const OperationType$1=OperationType;var PatchAction;(function($t){$t.Replace="replace",$t.AddPublicKeys="add-public-keys",$t.RemovePublicKeys="remove-public-keys",$t.AddServices="add-services",$t.RemoveServices="remove-services"})(PatchAction||(PatchAction={}));const PatchAction$1=PatchAction;var __awaiter$1E=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class IonRequest{static createCreateRequest(e){return __awaiter$1E(this,void 0,void 0,function*(){const _t=e.recoveryKey,At=e.updateKey,xt=e.document.publicKeys,kt=e.document.services;InputValidator.validateEs256kOperationKey(_t,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(At,OperationKeyType$1.Public),IonRequest.validateDidDocumentKeys(xt),IonRequest.validateServices(kt);const Bt=IonSdkConfig.hashAlgorithmInMultihashCode,Nt=[{action:PatchAction$1.Replace,document:e.document}],Ut={updateCommitment:yield Multihash.canonicalizeThenDoubleHashThenEncode(At,Bt),patches:Nt};IonRequest.validateDeltaSize(Ut);const jt={deltaHash:yield Multihash.canonicalizeThenHashThenEncode(Ut,Bt),recoveryCommitment:yield Multihash.canonicalizeThenDoubleHashThenEncode(_t,Bt)};return{type:OperationType$1.Create,suffixData:jt,delta:Ut}})}static createDeactivateRequest(e){return __awaiter$1E(this,void 0,void 0,function*(){IonRequest.validateDidSuffix(e.didSuffix),InputValidator.validateEs256kOperationKey(e.recoveryPublicKey,OperationKeyType$1.Public);const _t=IonSdkConfig.hashAlgorithmInMultihashCode,At=yield Multihash.canonicalizeThenHashThenEncode(e.recoveryPublicKey,_t),xt={didSuffix:e.didSuffix,recoveryKey:e.recoveryPublicKey},kt=yield e.signer.sign({alg:"ES256K"},xt);return{type:OperationType$1.Deactivate,didSuffix:e.didSuffix,revealValue:At,signedData:kt}})}static createRecoverRequest(e){return __awaiter$1E(this,void 0,void 0,function*(){IonRequest.validateDidSuffix(e.didSuffix),InputValidator.validateEs256kOperationKey(e.recoveryPublicKey,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(e.nextRecoveryPublicKey,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(e.nextUpdatePublicKey,OperationKeyType$1.Public),IonRequest.validateDidDocumentKeys(e.document.publicKeys),IonRequest.validateServices(e.document.services);const _t=IonSdkConfig.hashAlgorithmInMultihashCode,At=yield Multihash.canonicalizeThenHashThenEncode(e.recoveryPublicKey,_t),xt=[{action:PatchAction$1.Replace,document:e.document}],kt=yield Multihash.canonicalizeThenDoubleHashThenEncode(e.nextUpdatePublicKey,_t),Bt={patches:xt,updateCommitment:kt},Nt=yield Multihash.canonicalizeThenHashThenEncode(Bt,_t),Lt={recoveryCommitment:yield Multihash.canonicalizeThenDoubleHashThenEncode(e.nextRecoveryPublicKey,_t),recoveryKey:e.recoveryPublicKey,deltaHash:Nt},jt=yield e.signer.sign({alg:"ES256K"},Lt);return{type:OperationType$1.Recover,didSuffix:e.didSuffix,revealValue:At,delta:Bt,signedData:jt}})}static createUpdateRequest(e){return __awaiter$1E(this,void 0,void 0,function*(){if(IonRequest.validateDidSuffix(e.didSuffix),InputValidator.validateEs256kOperationKey(e.updatePublicKey,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(e.nextUpdatePublicKey,OperationKeyType$1.Public),IonRequest.validateServices(e.servicesToAdd),IonRequest.validateDidDocumentKeys(e.publicKeysToAdd),e.idsOfServicesToRemove!==void 0)for(const Vt of e.idsOfServicesToRemove)InputValidator.validateId(Vt);if(e.idsOfPublicKeysToRemove!==void 0)for(const Vt of e.idsOfPublicKeysToRemove)InputValidator.validateId(Vt);const _t=[],At=e.servicesToAdd;if(At!==void 0&&At.length>0){const Vt={action:PatchAction$1.AddServices,services:At};_t.push(Vt)}const xt=e.idsOfServicesToRemove;if(xt!==void 0&&xt.length>0){const Vt={action:PatchAction$1.RemoveServices,ids:xt};_t.push(Vt)}const kt=e.publicKeysToAdd;if(kt!==void 0&&kt.length>0){const Vt={action:PatchAction$1.AddPublicKeys,publicKeys:kt};_t.push(Vt)}const Bt=e.idsOfPublicKeysToRemove;if(Bt!==void 0&&Bt.length>0){const Vt={action:PatchAction$1.RemovePublicKeys,ids:Bt};_t.push(Vt)}const Nt=IonSdkConfig.hashAlgorithmInMultihashCode,Ut=yield Multihash.canonicalizeThenHashThenEncode(e.updatePublicKey,Nt),Lt=yield Multihash.canonicalizeThenDoubleHashThenEncode(e.nextUpdatePublicKey,Nt),jt={patches:_t,updateCommitment:Lt},Kt=yield Multihash.canonicalizeThenHashThenEncode(jt,Nt),qt={updateKey:e.updatePublicKey,deltaHash:Kt},zt=yield e.signer.sign({alg:"ES256K"},qt);return{type:OperationType$1.Update,didSuffix:e.didSuffix,revealValue:Ut,delta:jt,signedData:zt}})}static validateDidSuffix(e){Multihash.validateEncodedHashComputedUsingSupportedHashAlgorithm(e,"didSuffix")}static validateDidDocumentKeys(e){if(e===void 0)return;const _t=new Set;for(const At of e){if(Array.isArray(At.publicKeyJwk))throw new IonError(ErrorCode.DidDocumentPublicKeyMissingOrIncorrectType,"DID Document key 'publicKeyJwk' property is not a non-array object.");if(InputValidator.validateId(At.id),_t.has(At.id))throw new IonError(ErrorCode.DidDocumentPublicKeyIdDuplicated,`DID Document key with ID '${At.id}' already exists.`);_t.add(At.id),InputValidator.validatePublicKeyPurposes(At.purposes)}}static validateServices(e){if(e!==void 0&&e.length!==0){const _t=new Set;for(const At of e){if(IonRequest.validateService(At),_t.has(At.id))throw new IonError(ErrorCode.DidDocumentServiceIdDuplicated,"Service id has to be unique");_t.add(At.id)}}}static validateService(e){InputValidator.validateId(e.id);const _t=30;if(e.type.length>_t){const At=`Service endpoint type length ${e.type.length} exceeds max allowed length of ${_t}.`;throw new IonError(ErrorCode.ServiceTypeTooLong,At)}if(Array.isArray(e.serviceEndpoint)){const At="Service endpoint value cannot be an array.";throw new IonError(ErrorCode.ServiceEndpointCannotBeAnArray,At)}if(typeof e.serviceEndpoint=="string"&&uri_allExports.parse(e.serviceEndpoint).error!==void 0)throw new IonError(ErrorCode.ServiceEndpointStringNotValidUri,`Service endpoint string '${e.serviceEndpoint}' is not a URI.`)}static validateDeltaSize(e){const _t=JsonCanonicalizer.canonicalizeAsBytes(e);if(_t.length>IonSdkConfig.maxCanonicalizedDeltaSizeInBytes){const At=`Delta of ${_t.length} bytes exceeded limit of ${IonSdkConfig.maxCanonicalizedDeltaSizeInBytes} bytes.`;throw new IonError(ErrorCode.DeltaExceedsMaximumSize,At)}}}var __awaiter$1D=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class IonDid{static createLongFormDid(e){return __awaiter$1D(this,void 0,void 0,function*(){const _t=yield IonRequest.createCreateRequest(e),At=yield IonDid.computeDidUniqueSuffix(_t.suffixData);let xt;IonSdkConfig.network===void 0||IonSdkConfig.network==="mainnet"?xt=`did:ion:${At}`:xt=`did:ion:${IonSdkConfig.network}:${At}`;const kt={suffixData:_t.suffixData,delta:_t.delta},Bt=JsonCanonicalizer.canonicalizeAsBytes(kt),Nt=Encoder.encode(Bt);return`${xt}:${Nt}`})}static computeDidUniqueSuffix(e){return __awaiter$1D(this,void 0,void 0,function*(){const _t=JsonCanonicalizer.canonicalizeAsBytes(e),At=yield Multihash.hash(_t,IonSdkConfig.hashAlgorithmInMultihashCode);return Encoder.encode(At)})}}var IonNetwork;(function($t){$t.Mainnet="mainnet",$t.Testnet="test"})(IonNetwork||(IonNetwork={}));var IonPublicKeyPurpose;(function($t){$t.Authentication="authentication",$t.AssertionMethod="assertionMethod",$t.CapabilityInvocation="capabilityInvocation",$t.CapabilityDelegation="capabilityDelegation",$t.KeyAgreement="keyAgreement"})(IonPublicKeyPurpose||(IonPublicKeyPurpose={}));var __awaiter$1C=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidIonRegisteredKeyType$2;(function($t){$t.Ed25519="Ed25519",$t.secp256k1="secp256k1",$t.secp256r1="secp256r1",$t.X25519="X25519"})(DidIonRegisteredKeyType$2||(DidIonRegisteredKeyType$2={}));const AlgorithmToKeyTypeMap$7={Ed25519:DidIonRegisteredKeyType$2.Ed25519,ES256K:DidIonRegisteredKeyType$2.secp256k1,ES256:DidIonRegisteredKeyType$2.secp256r1,"P-256":DidIonRegisteredKeyType$2.secp256r1,secp256k1:DidIonRegisteredKeyType$2.secp256k1,secp256r1:DidIonRegisteredKeyType$2.secp256r1},DEFAULT_GATEWAY_URI$4="https://ion.tbd.engineering";let DidIon$2=class uo extends DidMethod$2{static create(){return __awaiter$1C(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:_t={}}={}){var At,xt,kt,Bt,Nt,Ut,Lt;if(!((At=_t.verificationMethods)===null||At===void 0)&&At.some(dr=>!(dr.algorithm in AlgorithmToKeyTypeMap$7)))throw new Error("One or more verification method algorithms are not supported");const jt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt.filter(dr=>"id"in dr).map(dr=>dr.id);if(jt&&jt.length!==new Set(jt).size)throw new Error("One or more verification method IDs are not unique");if(!((kt=_t.services)===null||kt===void 0)&&kt.some(dr=>!dr.id||!dr.type||!dr.serviceEndpoint))throw new Error("One or more services are missing required properties");const Kt={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},qt=[];for(const dr of(Bt=_t.verificationMethods)!==null&&Bt!==void 0?Bt:[Kt]){const vr=yield e.generateKey({algorithm:dr.algorithm}),$r=yield e.getPublicKey({keyUri:vr});qt.push({id:dr.id,publicKeyJwk:$r,purposes:(Nt=dr.purposes)!==null&&Nt!==void 0?Nt:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const zt=yield e.generateKey({algorithm:DidIonRegisteredKeyType$2.secp256k1}),Vt=yield e.getPublicKey({keyUri:zt}),Ht=yield e.generateKey({algorithm:DidIonRegisteredKeyType$2.secp256k1}),Wt=yield e.getPublicKey({keyUri:Ht}),Qt=yield DidIonUtils$2.computeLongFormDidUri({recoveryKey:Vt,updateKey:Wt,services:(Ut=_t.services)!==null&&Ut!==void 0?Ut:[],verificationMethods:qt}),{didDocument:Xt,didResolutionMetadata:Jt}=yield uo.resolve(Qt,{gatewayUri:_t.gatewayUri});if(Xt===null)throw new Error(`Unable to resolve DID during creation: ${Jt==null?void 0:Jt.error}`);const tr=new BearerDid$2({uri:Qt,document:Xt,metadata:{published:!1,canonicalId:Qt.split(":",3).join(":"),recoveryKey:Vt,updateKey:Wt},keyManager:e});if(!((Lt=_t.publish)!==null&&Lt!==void 0)||Lt){const dr=yield uo.publish({did:tr,gatewayUri:_t.gatewayUri});tr.metadata=dr.didDocumentMetadata}return tr})}static getSigningMethod(e){return __awaiter$1C(this,arguments,void 0,function*({didDocument:_t,methodId:At}){var xt;const kt=Did$2.parse(_t.id);if(kt&&kt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${kt.method}`);const Bt=(xt=_t.verificationMethod)===null||xt===void 0?void 0:xt.find(Nt=>{var Ut;return Nt.id===(At??((Ut=_t.assertionMethod)===null||Ut===void 0?void 0:Ut[0]))});if(!(Bt&&Bt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static import(e){return __awaiter$1C(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$3}){const xt=Did$2.parse(_t.uri);if((xt==null?void 0:xt.method)!==uo.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");return yield BearerDid$2.import({portableDid:_t,keyManager:At})})}static publish(e){return __awaiter$1C(this,arguments,void 0,function*({did:_t,gatewayUri:At=DEFAULT_GATEWAY_URI$4}){var xt,kt,Bt;const Nt=(kt=(xt=_t.document.verificationMethod)===null||xt===void 0?void 0:xt.map(jt=>({id:jt.id,publicKeyJwk:jt.publicKeyJwk,purposes:getVerificationRelationshipsById$2({didDocument:_t.document,methodId:jt.id})})))!==null&&kt!==void 0?kt:[],Ut=yield DidIonUtils$2.createIonDocument({services:(Bt=_t.document.service)!==null&&Bt!==void 0?Bt:[],verificationMethods:Nt}),Lt=yield DidIonUtils$2.constructCreateRequest({ionDocument:Ut,recoveryKey:_t.metadata.recoveryKey,updateKey:_t.metadata.updateKey});try{const jt=DidIonUtils$2.appendPathToUrl({baseUrl:At,path:"/operations"}),Kt=yield fetch(jt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(Lt)});return{didDocument:_t.document,didDocumentMetadata:Object.assign(Object.assign({},_t.metadata),{published:Kt.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:DidErrorCode$2.InternalError,errorMessage:`Failed to publish DID document for: ${_t.uri}`}}}})}static resolve(e){return __awaiter$1C(this,arguments,void 0,function*(_t,At={}){var xt,kt;const Bt=Did$2.parse(_t);if(!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"invalidDid"}});if(Bt.method!==uo.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"methodNotSupported"}});const Nt=(xt=At==null?void 0:At.gatewayUri)!==null&&xt!==void 0?xt:DEFAULT_GATEWAY_URI$4;try{const Ut=DidIonUtils$2.appendPathToUrl({baseUrl:Nt,path:`/identifiers/${_t}`}),Lt=yield fetch(Ut);if(!Lt.ok)throw new DidError$2(DidErrorCode$2.NotFound,`Unable to find DID document for: ${_t}`);const{didDocument:jt,didDocumentMetadata:Kt}=yield Lt.json();return Object.assign(Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),jt&&{didDocument:jt}),{didDocumentMetadata:Object.assign({published:(kt=Kt==null?void 0:Kt.method)===null||kt===void 0?void 0:kt.published},Kt)})}catch(Ut){if(!(Ut instanceof DidError$2))throw new Error(Ut);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:Object.assign({error:Ut.code},Ut.message&&{errorMessage:Ut.message})})}})}};DidIon$2.methodName="ion";let DidIonUtils$2=class Hi{static appendPathToUrl({baseUrl:e,path:_t}){const At=new URL(e);return At.pathname=At.pathname.endsWith("/")?At.pathname:At.pathname+"/",At.pathname+=_t.startsWith("/")?_t.substring(1):_t,At.toString()}static computeLongFormDidUri(e){return __awaiter$1C(this,arguments,void 0,function*({recoveryKey:_t,updateKey:At,services:xt,verificationMethods:kt}){const Bt=yield Hi.createIonDocument({services:xt,verificationMethods:kt}),Nt=Hi.normalizeJwk(_t),Ut=Hi.normalizeJwk(At);return yield IonDid.createLongFormDid({document:Bt,recoveryKey:Nt,updateKey:Ut})})}static constructCreateRequest(e){return __awaiter$1C(this,arguments,void 0,function*({ionDocument:_t,recoveryKey:At,updateKey:xt}){return yield IonRequest.createCreateRequest({document:_t,recoveryKey:Hi.normalizeJwk(At),updateKey:Hi.normalizeJwk(xt)})})}static createIonDocument(e){return __awaiter$1C(this,arguments,void 0,function*({services:_t,verificationMethods:At}){var xt,kt;const Bt=[];for(const Lt of At){let jt=(kt=(xt=Lt.id)!==null&&xt!==void 0?xt:Lt.publicKeyJwk.kid)!==null&&kt!==void 0?kt:yield computeJwkThumbprint$2({jwk:Lt.publicKeyJwk});jt=`${jt.split("#").pop()}`;const Kt={id:jt,publicKeyJwk:Hi.normalizeJwk(Lt.publicKeyJwk),purposes:Lt.purposes,type:"JsonWebKey2020"};Bt.push(Kt)}const Nt=_t.map(Lt=>Object.assign(Object.assign({},Lt),{id:`${Lt.id.split("#").pop()}`}));return{publicKeys:Bt,services:Nt}})}static normalizeJwk(e){const _t=e.kty;let At;if(_t==="EC")At={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(_t==="oct")At={k:e.k,kty:e.kty};else if(_t==="OKP")At={crv:e.crv,kty:e.kty,x:e.x};else if(_t==="RSA")At={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${_t}`);return At}};var __awaiter$1B=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidJwk$2=class fo extends DidMethod$2{static create(){return __awaiter$1B(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:_t={}}={}){var At,xt,kt,Bt;if(_t.algorithm&&_t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(_t.verificationMethods&&_t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Nt=(Bt=(At=_t.algorithm)!==null&&At!==void 0?At:(kt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt[0])===null||kt===void 0?void 0:kt.algorithm)!==null&&Bt!==void 0?Bt:"Ed25519",Ut=yield e.generateKey({algorithm:Nt}),Lt=yield e.getPublicKey({keyUri:Ut}),jt=Convert.object(Lt).toBase64Url(),Kt=`did:${fo.methodName}:${jt}`,zt=(yield fo.resolve(Kt)).didDocument;return new BearerDid$2({uri:Kt,document:zt,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$1B(this,arguments,void 0,function*({didDocument:_t}){var At;const xt=Did$2.parse(_t.id);if(xt&&xt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${xt.method}`);const[kt]=(At=_t.verificationMethod)!==null&&At!==void 0?At:[];if(!(kt&&kt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return kt})}static import(e){return __awaiter$1B(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$3}){const xt=Did$2.parse(_t.uri);if((xt==null?void 0:xt.method)!==fo.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");const kt=yield BearerDid$2.import({portableDid:_t,keyManager:At});if(kt.document.verificationMethod.length!==1)throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"DID document must contain exactly one verification method");return kt})}static resolve(e,_t){return __awaiter$1B(this,void 0,void 0,function*(){const At=Did$2.parse(e);let xt;try{xt=Convert.base64Url(At.id).toObject()}catch{}if(!At||!xt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"invalidDid"}});if(At.method!==fo.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"methodNotSupported"}});const kt={"@context":["https://www.w3.org/ns/did/v1"],id:At.uri},Bt=`${kt.id}#0`;switch(kt.verificationMethod=[{id:Bt,type:"JsonWebKey",controller:kt.id,publicKeyJwk:xt}],kt.authentication=[Bt],kt.assertionMethod=[Bt],kt.capabilityInvocation=[Bt],kt.capabilityDelegation=[Bt],kt.keyAgreement=[Bt],xt.use){case"sig":{delete kt.keyAgreement;break}case"enc":{delete kt.authentication,delete kt.assertionMethod,delete kt.capabilityInvocation,delete kt.capabilityDelegation;break}}return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:kt})})}};DidJwk$2.methodName="jwk";var __awaiter$1A=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidKeyRegisteredKeyType$2;(function($t){$t.Ed25519="Ed25519",$t.secp256k1="secp256k1",$t.secp256r1="secp256r1",$t.X25519="X25519"})(DidKeyRegisteredKeyType$2||(DidKeyRegisteredKeyType$2={}));const DidKeyVerificationMethodType$2={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},AlgorithmToKeyTypeMap$6={Ed25519:DidKeyRegisteredKeyType$2.Ed25519,ES256K:DidKeyRegisteredKeyType$2.secp256k1,ES256:DidKeyRegisteredKeyType$2.secp256r1,"P-256":DidKeyRegisteredKeyType$2.secp256r1,secp256k1:DidKeyRegisteredKeyType$2.secp256k1,secp256r1:DidKeyRegisteredKeyType$2.secp256r1,X25519:DidKeyRegisteredKeyType$2.X25519};let DidKey$2=class Ri extends DidMethod$2{static create(){return __awaiter$1A(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:_t={}}={}){var At,xt,kt,Bt;if(_t.algorithm&&_t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(_t.verificationMethods&&_t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Nt=(Bt=(At=_t.algorithm)!==null&&At!==void 0?At:(kt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt[0])===null||kt===void 0?void 0:kt.algorithm)!==null&&Bt!==void 0?Bt:"Ed25519",Ut=yield e.generateKey({algorithm:Nt}),Lt=yield e.getPublicKey({keyUri:Ut}),jt=yield DidKeyUtils$2.publicKeyToMultibaseId({publicKey:Lt}),Kt=`did:${Ri.methodName}:${jt}`,zt=(yield Ri.resolve(Kt,_t)).didDocument;return new BearerDid$2({uri:Kt,document:zt,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$1A(this,arguments,void 0,function*({didDocument:_t}){var At;const xt=Did$2.parse(_t.id);if(xt&&xt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${xt.method}`);const[kt]=_t.assertionMethod||[],Bt=(At=_t.verificationMethod)===null||At===void 0?void 0:At.find(Nt=>Nt.id===kt);if(!(Bt&&Bt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static import(e){return __awaiter$1A(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$3}){const xt=Did$2.parse(_t.uri);if((xt==null?void 0:xt.method)!==Ri.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");const kt=yield BearerDid$2.import({portableDid:_t,keyManager:At});if(kt.document.verificationMethod.length!==1)throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"DID document must contain exactly one verification method");return kt})}static resolve(e,_t){return __awaiter$1A(this,void 0,void 0,function*(){try{const At=yield Ri.createDocument({didUri:e,options:_t});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:At})}catch(At){if(!(At instanceof DidError$2))throw new Error(At);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:Object.assign({error:At.code},At.message&&{errorMessage:At.message})})}})}static createDocument(e){return __awaiter$1A(this,arguments,void 0,function*({didUri:_t,options:At={}}){const{defaultContext:xt="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:kt=!1,enableExperimentalPublicKeyTypes:Bt=!1,publicKeyFormat:Nt="JsonWebKey2020"}=At,Ut={id:""},Lt=Did$2.parse(_t);if(!Lt)throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid DID URI: ${_t}`);const jt=Lt.id;if(Lt.method!==Ri.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${Lt.method}`);if(!Ri.validateIdentifier(Lt))throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid DID URI: ${_t}`);const Kt=yield Ri.createSignatureMethod({didUri:_t,multibaseValue:jt,options:{enableExperimentalPublicKeyTypes:Bt,publicKeyFormat:Nt}});if(Ut.id=Lt.uri,Ut.verificationMethod=[Kt],Ut.authentication=[Kt.id],Ut.assertionMethod=[Kt.id],Ut.capabilityInvocation=[Kt.id],Ut.capabilityDelegation=[Kt.id],kt===!0){const Vt=Nt==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",Ht=yield this.createEncryptionMethod({didUri:_t,multibaseValue:jt,options:{enableExperimentalPublicKeyTypes:Bt,publicKeyFormat:Vt}});Ut.verificationMethod.push(Ht),Ut.keyAgreement=[Ht.id]}const qt=[xt];return getVerificationMethodTypes$2({didDocument:Ut}).forEach(Vt=>{const Ht=DidKeyVerificationMethodType$2[Vt];qt.push(Ht)}),Ut["@context"]=qt,Ut})}static createEncryptionMethod(e){return __awaiter$1A(this,arguments,void 0,function*({didUri:_t,multibaseValue:At,options:xt}){const{enableExperimentalPublicKeyTypes:kt,publicKeyFormat:Bt}=xt,Nt={id:"",type:"",controller:""},{keyBytes:Ut,multicodecCode:Lt}=yield Ri.deriveEncryptionKey({multibaseValue:At}),jt=Ut.byteLength,Kt=DidKeyUtils$2.MULTICODEC_PUBLIC_KEY_LENGTH[Lt];if(jt!==Kt)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyLength,`Expected ${jt} bytes. Actual: ${Kt}`);const qt=keyBytesToMultibaseId$2({keyBytes:Ut,multicodecCode:Lt});Nt.id=`${_t}#${qt}`;try{new URL(Nt.id)}catch{throw new DidError$2(DidErrorCode$2.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(Bt in DidKeyVerificationMethodType$2))throw new DidError$2(DidErrorCode$2.UnsupportedPublicKeyType,`Unsupported format: ${Bt}`);if(kt===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(Bt))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Specified '${Bt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Nt.type=Bt,Nt.controller=_t,Bt==="X25519KeyAgreementKey2020"&&(Nt.publicKeyMultibase=qt),Bt==="JsonWebKey2020"){const{crv:Vt}=yield DidKeyUtils$2.multicodecToJwk({code:Lt});Nt.publicKeyJwk=yield DidKeyUtils$2.keyConverter(Vt).bytesToPublicKey({publicKeyBytes:Ut})}return Nt})}static createSignatureMethod(e){return __awaiter$1A(this,arguments,void 0,function*({didUri:_t,multibaseValue:At,options:xt}){const{enableExperimentalPublicKeyTypes:kt,publicKeyFormat:Bt}=xt,Nt={id:"",type:"",controller:""},{keyBytes:Ut,multicodecCode:Lt,multicodecName:jt}=multibaseIdToKeyBytes$2({multibaseKeyId:At}),Kt=Ut.byteLength,qt=DidKeyUtils$2.MULTICODEC_PUBLIC_KEY_LENGTH[Lt];if(Kt!==qt)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyLength,`Expected ${Kt} bytes. Actual: ${qt}`);let zt=!1;switch(jt){case"secp256k1-pub":zt=yield Secp256k1$2.validatePublicKey({publicKeyBytes:Ut});break;case"ed25519-pub":zt=yield Ed25519$2.validatePublicKey({publicKeyBytes:Ut});break;case"x25519-pub":zt=!0;break}if(!zt)throw new DidError$2(DidErrorCode$2.InvalidPublicKey,"Invalid public key detected.");Nt.id=`${_t}#${At}`;try{new URL(Nt.id)}catch{throw new DidError$2(DidErrorCode$2.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(Bt in DidKeyVerificationMethodType$2))throw new DidError$2(DidErrorCode$2.UnsupportedPublicKeyType,`Unsupported format: ${Bt}`);if(kt===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(Bt))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Specified '${Bt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Nt.type=Bt,Nt.controller=_t,Bt==="Ed25519VerificationKey2020"&&(Nt.publicKeyMultibase=At),Bt==="JsonWebKey2020"){const{crv:Ht}=yield DidKeyUtils$2.multicodecToJwk({code:Lt});Nt.publicKeyJwk=yield DidKeyUtils$2.keyConverter(Ht).bytesToPublicKey({publicKeyBytes:Ut})}return Nt})}static deriveEncryptionKey(e){return __awaiter$1A(this,arguments,void 0,function*({multibaseValue:_t}){let At={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:xt,multicodecCode:kt}=multibaseIdToKeyBytes$2({multibaseKeyId:_t});if(kt===237){const Bt=yield DidKeyUtils$2.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:xt}),Nt=yield Ed25519$2.convertPublicKeyToX25519({publicKey:Bt});At={keyBytes:yield DidKeyUtils$2.keyConverter("Ed25519").publicKeyToBytes({publicKey:Nt}),multicodecCode:236}}return At})}static validateIdentifier(e){const{method:_t,id:At}=e,[xt]=e.uri.split(":",1);return xt==="did"&&_t==="key"&&Number("1")>0&&universalTypeOf(At)==="String"&&At.startsWith("z")}};DidKey$2.methodName="key";let DidKeyUtils$2=class ro{static jwkToMulticodec(e){return __awaiter$1A(this,arguments,void 0,function*({jwk:_t}){const At=[];_t.crv&&(At.push(_t.crv),_t.d?At.push("private"):At.push("public"));const xt=At.join(":"),kt=ro.JWK_TO_MULTICODEC[xt];if(kt===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${xt}'`);return{code:Multicodec.getCodeFromName({name:kt}),name:kt}})}static keyCompressor(e){const At={"P-256":Secp256r1$2.compressPublicKey,secp256k1:Secp256k1$2.compressPublicKey}[e];if(!At)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static keyConverter(e){const At={Ed25519:Ed25519$2,"P-256":Secp256r1$2,secp256k1:Secp256k1$2,X25519:X25519$2}[e];if(!At)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static multicodecToJwk(e){return __awaiter$1A(this,arguments,void 0,function*({code:_t,name:At}){if(!(At?!_t:_t))throw new Error("Either 'name' or 'code' must be defined, but not both.");At=At===void 0?Multicodec.getNameFromCode({code:_t}):At;const xt=At,kt=ro.MULTICODEC_TO_JWK[xt];if(kt===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},kt)})}static publicKeyToMultibaseId(e){return __awaiter$1A(this,arguments,void 0,function*({publicKey:_t}){var At;if(!(_t!=null&&_t.crv&&_t.crv in AlgorithmToKeyTypeMap$6))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(At=_t==null?void 0:_t.crv)!==null&&At!==void 0?At:"undefined"}`);let xt=yield ro.keyConverter(_t.crv).publicKeyToBytes({publicKey:_t});/^(secp256k1|P-256|P-384|P-521)$/.test(_t.crv)&&(xt=yield ro.keyCompressor(_t.crv)({publicKeyBytes:xt}));const{name:kt}=yield ro.jwkToMulticodec({jwk:_t});return keyBytesToMultibaseId$2({keyBytes:xt,multicodecName:kt})})}};DidKeyUtils$2.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};DidKeyUtils$2.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};DidKeyUtils$2.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var __awaiter$1z=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidWeb$2=class Vo extends DidMethod$2{static resolve(e,_t){return __awaiter$1z(this,void 0,void 0,function*(){const At=Did$2.parse(e);if(!At)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"invalidDid"}});if(At.method!==Vo.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"methodNotSupported"}});let xt=`https://${At.id.replace(/:/g,"/")}`;xt=decodeURIComponent(xt);const kt=At.id.includes(":")?`${xt}/did.json`:`${xt}/.well-known/did.json`;try{const Bt=yield fetch(kt);if(!Bt.ok)throw new Error("HTTP error status code returned");const Nt=yield Bt.json();return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:Nt})}catch{return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"notFound"}})}})}};DidWeb$2.methodName="web";var s=1e3,m=s*60,h=m*60,d=h*24,w=d*7,y=d*365.25,ms=function($t,e){e=e||{};var _t=typeof $t;if(_t==="string"&&$t.length>0)return parse($t);if(_t==="number"&&isFinite($t))return e.long?fmtLong($t):fmtShort($t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify($t))};function parse($t){if($t=String($t),!($t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec($t);if(e){var _t=parseFloat(e[1]),At=(e[2]||"ms").toLowerCase();switch(At){case"years":case"year":case"yrs":case"yr":case"y":return _t*y;case"weeks":case"week":case"w":return _t*w;case"days":case"day":case"d":return _t*d;case"hours":case"hour":case"hrs":case"hr":case"h":return _t*h;case"minutes":case"minute":case"mins":case"min":case"m":return _t*m;case"seconds":case"second":case"secs":case"sec":case"s":return _t*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _t;default:return}}}}function fmtShort($t){var e=Math.abs($t);return e>=d?Math.round($t/d)+"d":e>=h?Math.round($t/h)+"h":e>=m?Math.round($t/m)+"m":e>=s?Math.round($t/s)+"s":$t+"ms"}function fmtLong($t){var e=Math.abs($t);return e>=d?plural($t,e,d,"day"):e>=h?plural($t,e,h,"hour"):e>=m?plural($t,e,m,"minute"):e>=s?plural($t,e,s,"second"):$t+" ms"}function plural($t,e,_t,At){var xt=e>=_t*1.5;return Math.round($t/_t)+" "+At+(xt?"s":"")}const ms$1=getDefaultExportFromCjs(ms);var __awaiter$1y=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidResolverCacheLevel$1=class{constructor({db:e,location:_t="DATA/DID_RESOLVERCACHE",ttl:At="15m"}={}){this.cache=e??new Level$1(_t),this.ttl=ms$1(At)}get(e){return __awaiter$1y(this,void 0,void 0,function*(){try{const _t=yield this.cache.get(e),At=JSON.parse(_t);if(Date.now()>=At.ttlMillis){this.cache.nextTick(()=>this.cache.del(e));return}else return At.value}catch(_t){if(_t.notFound)return;throw _t}})}set(e,_t){const At={ttlMillis:Date.now()+this.ttl,value:_t},xt=JSON.stringify(At);return this.cache.put(e,xt)}delete(e){return this.cache.del(e)}clear(){return this.cache.clear()}close(){return this.cache.close()}};const DidResolverCacheNoop$2={get:function($t){return null},set:function($t,e){return null},delete:function($t){return null},clear:function(){return null},close:function(){return null}};var __awaiter$1x=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let UniversalResolver$2=class{constructor({cache:e,didResolvers:_t}){this.didResolvers=new Map,this.cache=e||DidResolverCacheNoop$2;for(const At of _t)this.didResolvers.set(At.methodName,At)}resolve(e,_t){return __awaiter$1x(this,void 0,void 0,function*(){const At=Did$2.parse(e);if(!At)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:DidErrorCode$2.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const xt=this.didResolvers.get(At.method);if(!xt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:DidErrorCode$2.MethodNotSupported,errorMessage:`Method not supported: ${At.method}`}});const kt=yield this.cache.get(At.uri);if(kt)return kt;{const Bt=yield xt.resolve(At.uri,_t);return Bt.didResolutionMetadata.error||(yield this.cache.set(At.uri,Bt)),Bt}})}dereference(e,_t){return __awaiter$1x(this,void 0,void 0,function*(){const At=Did$2.parse(e);if(!At)return{dereferencingMetadata:{error:DidErrorCode$2.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:xt,didResolutionMetadata:kt,didDocumentMetadata:Bt}=yield this.resolve(At.uri);if(!xt)return{dereferencingMetadata:{error:kt.error},contentStream:null,contentMetadata:{}};if(!At.fragment||At.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:xt,contentMetadata:Bt};const{service:Nt=[],verificationMethod:Ut=[]}=xt,Lt=new Set([e,At.fragment,`#${At.fragment}`]);let jt;for(let Kt of Ut)if(Lt.has(Kt.id)){jt=Kt;break}for(let Kt of Nt)if(Lt.has(Kt.id)){jt=Kt;break}return jt?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:jt,contentMetadata:kt}:{dereferencingMetadata:{error:DidErrorCode$2.NotFound},contentStream:null,contentMetadata:{}}})}};var __awaiter$1w=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Dwn{constructor(e){this.didResolver=e.didResolver,this.tenantGate=e.tenantGate,this.eventStream=e.eventStream,this.messageStore=e.messageStore,this.dataStore=e.dataStore,this.resumableTaskStore=e.resumableTaskStore,this.eventLog=e.eventLog,this.eventStream=e.eventStream,this.storageController=new StorageController({messageStore:this.messageStore,dataStore:this.dataStore,eventLog:this.eventLog,eventStream:this.eventStream}),this.resumableTaskManager=new ResumableTaskManager(e.resumableTaskStore,this.storageController),this.methodHandlers={[DwnInterfaceName.Messages+DwnMethodName.Query]:new MessagesQueryHandler(this.didResolver,this.messageStore,this.eventLog),[DwnInterfaceName.Messages+DwnMethodName.Read]:new MessagesReadHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Messages+DwnMethodName.Subscribe]:new MessagesSubscribeHandler(this.didResolver,this.messageStore,this.eventStream),[DwnInterfaceName.Protocols+DwnMethodName.Configure]:new ProtocolsConfigureHandler(this.didResolver,this.messageStore,this.eventLog,this.eventStream),[DwnInterfaceName.Protocols+DwnMethodName.Query]:new ProtocolsQueryHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Records+DwnMethodName.Delete]:new RecordsDeleteHandler(this.didResolver,this.messageStore,this.resumableTaskManager),[DwnInterfaceName.Records+DwnMethodName.Query]:new RecordsQueryHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Records+DwnMethodName.Read]:new RecordsReadHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Records+DwnMethodName.Subscribe]:new RecordsSubscribeHandler(this.didResolver,this.messageStore,this.eventStream),[DwnInterfaceName.Records+DwnMethodName.Write]:new RecordsWriteHandler(this.didResolver,this.messageStore,this.dataStore,this.eventLog,this.eventStream)}}static create(e){var _t,At;return __awaiter$1w(this,void 0,void 0,function*(){(_t=e.didResolver)!==null&&_t!==void 0||(e.didResolver=new UniversalResolver$2({didResolvers:[DidDht$2,DidJwk$2,DidKey$2],cache:new DidResolverCacheLevel$1({location:"RESOLVERCACHE"})})),(At=e.tenantGate)!==null&&At!==void 0||(e.tenantGate=new AllowAllTenantGate);const xt=new Dwn(e);return yield xt.open(),xt})}open(){var e;return __awaiter$1w(this,void 0,void 0,function*(){yield this.messageStore.open(),yield this.dataStore.open(),yield this.resumableTaskStore.open(),yield this.eventLog.open(),yield(e=this.eventStream)===null||e===void 0?void 0:e.open(),yield this.resumableTaskManager.resumeTasksAndWaitForCompletion()})}close(){var e;return __awaiter$1w(this,void 0,void 0,function*(){yield(e=this.eventStream)===null||e===void 0?void 0:e.close(),yield this.messageStore.close(),yield this.dataStore.close(),yield this.resumableTaskStore.close(),yield this.eventLog.close()})}processMessage(e,_t,At={}){var xt;return __awaiter$1w(this,void 0,void 0,function*(){const kt=(xt=yield this.validateTenant(e))!==null&&xt!==void 0?xt:yield this.validateMessageIntegrity(_t);if(kt!==void 0)return kt;const{dataStream:Bt,subscriptionHandler:Nt}=At,Ut=_t.descriptor.interface+_t.descriptor.method;return yield this.methodHandlers[Ut].handle({tenant:e,message:_t,dataStream:Bt,subscriptionHandler:Nt})})}validateTenant(e){var _t;return __awaiter$1w(this,void 0,void 0,function*(){const At=yield this.tenantGate.isActiveTenant(e);if(!At.isActiveTenant)return{status:{code:401,detail:(_t=At.detail)!==null&&_t!==void 0?_t:`DID ${e} is not an active tenant.`}}})}validateMessageIntegrity(e){var _t,At;return __awaiter$1w(this,void 0,void 0,function*(){const xt=(_t=e==null?void 0:e.descriptor)===null||_t===void 0?void 0:_t.interface,kt=(At=e==null?void 0:e.descriptor)===null||At===void 0?void 0:At.method;if(xt===void 0||kt===void 0)return{status:{code:400,detail:`Both interface and method must be present, interface: ${xt}, method: ${kt}`}};try{Message.validateJsonSchema(e)}catch(Bt){return messageReplyFromError(Bt,400)}})}}var __awaiter$1v=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function promisifySignal($t){return new Promise((e,_t)=>{if($t.aborted){_t($t.reason);return}$t.addEventListener("abort",()=>{_t($t.reason)})})}function executeUnlessAborted($t,e){return __awaiter$1v(this,void 0,void 0,function*(){return e?Promise.race([$t,promisifySignal(e)]):$t})}var __awaiter$1u=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__await$2=function($t){return this instanceof __await$2?(this.v=$t,this):new __await$2($t)},__asyncValues$5=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}},__asyncGenerator$2=function($t,e,_t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var At=_t.apply($t,e||[]),xt,kt=[];return xt={},Bt("next"),Bt("throw"),Bt("return"),xt[Symbol.asyncIterator]=function(){return this},xt;function Bt(qt){At[qt]&&(xt[qt]=function(zt){return new Promise(function(Vt,Ht){kt.push([qt,zt,Vt,Ht])>1||Nt(qt,zt)})})}function Nt(qt,zt){try{Ut(At[qt](zt))}catch(Vt){Kt(kt[0][3],Vt)}}function Ut(qt){qt.value instanceof __await$2?Promise.resolve(qt.value.v).then(Lt,jt):Kt(kt[0][2],qt)}function Lt(qt){Nt("next",qt)}function jt(qt){Nt("throw",qt)}function Kt(qt,zt){qt(zt),kt.shift(),kt.length&&Nt(kt[0][0],kt[0][1])}};function createLevelDatabase($t,e){return __awaiter$1u(this,void 0,void 0,function*(){return new Level($t,Object.assign(Object.assign({},e),{keyEncoding:"utf8"}))})}class LevelWrapper{constructor(e,_t){this.config=Object.assign({createLevelDatabase},e),this.db=_t}open(){return __awaiter$1u(this,void 0,void 0,function*(){switch(yield this.createLevelDatabase(),this.db.status){case"open":return;case"opening":return new Promise(e=>{this.db.once("open",e)});case"closing":return new Promise((e,_t)=>{const At=()=>{this.db.open().then(e).catch(_t)};this.db.once("closed",At)});case"closed":return this.db.open()}})}close(){return __awaiter$1u(this,void 0,void 0,function*(){if(this.db)switch(this.db.status){case"open":return this.db.close();case"opening":return new Promise((e,_t)=>{const At=()=>{this.db.close().then(e).catch(_t)};this.db.once("open",At)});case"closing":return new Promise(e=>{this.db.once("closed",e)});case"closed":return}})}partition(e){return __awaiter$1u(this,void 0,void 0,function*(){return yield this.createLevelDatabase(),new LevelWrapper(this.config,this.db.sublevel(e,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding}))})}get(e,_t){var At;return __awaiter$1u(this,void 0,void 0,function*(){(At=_t==null?void 0:_t.signal)===null||At===void 0||At.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),_t==null?void 0:_t.signal);try{return yield executeUnlessAborted(this.db.get(String(e)),_t==null?void 0:_t.signal)}catch(xt){if(xt.code==="LEVEL_NOT_FOUND")return;throw xt}})}has(e,_t){return __awaiter$1u(this,void 0,void 0,function*(){return!!(yield this.get(e,_t))})}keys(e){var _t,At;return __asyncGenerator$2(this,arguments,function*(){var kt,Bt,Nt,Ut;(_t=e==null?void 0:e.signal)===null||_t===void 0||_t.throwIfAborted(),yield __await$2(executeUnlessAborted(this.createLevelDatabase(),e==null?void 0:e.signal));try{for(var Lt=!0,jt=__asyncValues$5(this.db.keys()),Kt;Kt=yield __await$2(jt.next()),kt=Kt.done,!kt;Lt=!0){Ut=Kt.value,Lt=!1;const qt=Ut;(At=e==null?void 0:e.signal)===null||At===void 0||At.throwIfAborted(),yield yield __await$2(qt)}}catch(qt){Bt={error:qt}}finally{try{!Lt&&!kt&&(Nt=jt.return)&&(yield __await$2(Nt.call(jt)))}finally{if(Bt)throw Bt.error}}})}iterator(e,_t){var At,xt;return __asyncGenerator$2(this,arguments,function*(){var Bt,Nt,Ut,Lt;(At=_t==null?void 0:_t.signal)===null||At===void 0||At.throwIfAborted(),yield __await$2(executeUnlessAborted(this.createLevelDatabase(),_t==null?void 0:_t.signal));try{for(var jt=!0,Kt=__asyncValues$5(this.db.iterator(e)),qt;qt=yield __await$2(Kt.next()),Bt=qt.done,!Bt;jt=!0){Lt=qt.value,jt=!1;const zt=Lt;(xt=_t==null?void 0:_t.signal)===null||xt===void 0||xt.throwIfAborted(),yield yield __await$2(zt)}}catch(zt){Nt={error:zt}}finally{try{!jt&&!Bt&&(Ut=Kt.return)&&(yield __await$2(Ut.call(Kt)))}finally{if(Nt)throw Nt.error}}})}put(e,_t,At){var xt;return __awaiter$1u(this,void 0,void 0,function*(){return(xt=At==null?void 0:At.signal)===null||xt===void 0||xt.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),At==null?void 0:At.signal),executeUnlessAborted(this.db.put(String(e),_t),At==null?void 0:At.signal)})}delete(e,_t){var At;return __awaiter$1u(this,void 0,void 0,function*(){return(At=_t==null?void 0:_t.signal)===null||At===void 0||At.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),_t==null?void 0:_t.signal),executeUnlessAborted(this.db.del(String(e)),_t==null?void 0:_t.signal)})}isEmpty(e){var _t,At,xt,kt;return __awaiter$1u(this,void 0,void 0,function*(){try{for(var Bt=!0,Nt=__asyncValues$5(this.keys(e)),Ut;Ut=yield Nt.next(),_t=Ut.done,!_t;Bt=!0){kt=Ut.value,Bt=!1;const Lt=kt;return!1}}catch(Lt){At={error:Lt}}finally{try{!Bt&&!_t&&(xt=Nt.return)&&(yield xt.call(Nt))}finally{if(At)throw At.error}}return!0})}clear(){return __awaiter$1u(this,void 0,void 0,function*(){yield this.createLevelDatabase(),yield this.db.clear(),yield this.compactUnderlyingStorage()})}batch(e,_t){var At;return __awaiter$1u(this,void 0,void 0,function*(){return(At=_t==null?void 0:_t.signal)===null||At===void 0||At.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),_t==null?void 0:_t.signal),executeUnlessAborted(this.db.batch(e),_t==null?void 0:_t.signal)})}createPartitionOperation(e,_t){return Object.assign(Object.assign({},_t),{sublevel:this.db.sublevel(e,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding})})}compactUnderlyingStorage(e){var _t,At,xt;return __awaiter$1u(this,void 0,void 0,function*(){(_t=e==null?void 0:e.signal)===null||_t===void 0||_t.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),e==null?void 0:e.signal);const kt=this.sublevelRange;if(!kt)return;const Bt=this.root;if(Bt.db.supports.additionalMethods.compactRange)return executeUnlessAborted((xt=(At=Bt.db).compactRange)===null||xt===void 0?void 0:xt.call(At,...kt),e==null?void 0:e.signal)})}get sublevelRange(){const e=this.db.prefix;if(!e)return;const _t=e.slice(0,-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);return[e,_t]}get root(){let e=this.db;for(const _t=e.db;_t&&_t!==e;)e=_t;return new LevelWrapper(this.config,e)}createLevelDatabase(){var e;return __awaiter$1u(this,void 0,void 0,function*(){(e=this.db)!==null&&e!==void 0||(this.db=yield this.config.createLevelDatabase(this.config.location,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding}))})}}var __awaiter$1t=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$4=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}},__await$1=function($t){return this instanceof __await$1?(this.v=$t,this):new __await$1($t)},__asyncGenerator$1=function($t,e,_t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var At=_t.apply($t,e||[]),xt,kt=[];return xt={},Bt("next"),Bt("throw"),Bt("return"),xt[Symbol.asyncIterator]=function(){return this},xt;function Bt(qt){At[qt]&&(xt[qt]=function(zt){return new Promise(function(Vt,Ht){kt.push([qt,zt,Vt,Ht])>1||Nt(qt,zt)})})}function Nt(qt,zt){try{Ut(At[qt](zt))}catch(Vt){Kt(kt[0][3],Vt)}}function Ut(qt){qt.value instanceof __await$1?Promise.resolve(qt.value.v).then(Lt,jt):Kt(kt[0][2],qt)}function Lt(qt){Nt("next",qt)}function jt(qt){Nt("throw",qt)}function Kt(qt,zt){qt(zt),kt.shift(),kt.length&&Nt(kt[0][0],kt[0][1])}};class BlockstoreLevel{constructor(e,_t){this.config=Object.assign({createLevelDatabase},e),this.db=_t??new LevelWrapper(Object.assign(Object.assign({},this.config),{valueEncoding:"binary"}))}open(){return __awaiter$1t(this,void 0,void 0,function*(){return this.db.open()})}close(){return __awaiter$1t(this,void 0,void 0,function*(){return this.db.close()})}partition(e){return __awaiter$1t(this,void 0,void 0,function*(){const _t=yield this.db.partition(e);return new BlockstoreLevel(Object.assign(Object.assign({},this.config),{location:""}),_t)})}put(e,_t,At){return __awaiter$1t(this,void 0,void 0,function*(){return yield this.db.put(String(e),_t,At),CID.parse(e.toString())})}get(e,_t){return __awaiter$1t(this,void 0,void 0,function*(){return yield this.db.get(String(e),_t)})}has(e,_t){return __awaiter$1t(this,void 0,void 0,function*(){return this.db.has(String(e),_t)})}delete(e,_t){return __awaiter$1t(this,void 0,void 0,function*(){return this.db.delete(String(e),_t)})}isEmpty(e){return __awaiter$1t(this,void 0,void 0,function*(){return this.db.isEmpty(e)})}putMany(e,_t){return __asyncGenerator$1(this,arguments,function*(){var xt,kt,Bt,Nt;try{for(var Ut=!0,Lt=__asyncValues$4(e),jt;jt=yield __await$1(Lt.next()),xt=jt.done,!xt;Ut=!0){Nt=jt.value,Ut=!1;const Kt=Nt;yield __await$1(this.put(Kt.cid,Kt.block,_t)),yield yield __await$1(Kt.cid)}}catch(Kt){kt={error:Kt}}finally{try{!Ut&&!xt&&(Bt=Lt.return)&&(yield __await$1(Bt.call(Lt)))}finally{if(kt)throw kt.error}}})}getMany(e,_t){return __asyncGenerator$1(this,arguments,function*(){var xt,kt,Bt,Nt;try{for(var Ut=!0,Lt=__asyncValues$4(e),jt;jt=yield __await$1(Lt.next()),xt=jt.done,!xt;Ut=!0){Nt=jt.value,Ut=!1;const Kt=Nt;yield yield __await$1({cid:Kt,block:yield __await$1(this.get(Kt,_t))})}}catch(Kt){kt={error:Kt}}finally{try{!Ut&&!xt&&(Bt=Lt.return)&&(yield __await$1(Bt.call(Lt)))}finally{if(kt)throw kt.error}}})}getAll(e){return __asyncGenerator$1(this,arguments,function*(){var At,xt,kt,Bt;const Nt=this.db.iterator({keys:!0,keyEncoding:"buffer"},e);try{for(var Ut=!0,Lt=__asyncValues$4(Nt),jt;jt=yield __await$1(Lt.next()),At=jt.done,!At;Ut=!0){Bt=jt.value,Ut=!1;const[Kt,qt]=Bt;yield yield __await$1({cid:CID.decode(Kt),block:qt})}}catch(Kt){xt={error:Kt}}finally{try{!Ut&&!At&&(kt=Lt.return)&&(yield __await$1(kt.call(Lt)))}finally{if(xt)throw xt.error}}})}deleteMany(e,_t){return __asyncGenerator$1(this,arguments,function*(){var xt,kt,Bt,Nt;try{for(var Ut=!0,Lt=__asyncValues$4(e),jt;jt=yield __await$1(Lt.next()),xt=jt.done,!xt;Ut=!0){Nt=jt.value,Ut=!1;const Kt=Nt;yield __await$1(this.delete(Kt,_t)),yield yield __await$1(Kt)}}catch(Kt){kt={error:Kt}}finally{try{!Ut&&!xt&&(Bt=Lt.return)&&(yield __await$1(Bt.call(Lt)))}finally{if(kt)throw kt.error}}})}clear(){return __awaiter$1t(this,void 0,void 0,function*(){return this.db.clear()})}}function isAsyncIterable$4($t){return $t[Symbol.asyncIterator]!=null}function last($t){if(isAsyncIterable$4($t))return(async()=>{let _t;for await(const At of $t)_t=At;return _t})();let e;for(const _t of $t)e=_t;return e}const code=0,name="identity",encode$1=coerce$3,digest=$t=>create$2(code,encode$1($t)),identity={code,name,encode:encode$1,digest},resolve$3=async($t,e,_t,At,xt,kt,Bt,Nt)=>{const Ut=await Bt.get($t,Nt),Lt=decode$b(Ut);let jt=Lt,Kt=_t;for(;At.length>0;){const qt=At[0];if(qt in jt){At.shift(),Kt=`${Kt}/${qt}`;const zt=CID.asCID(jt[qt]);if(zt!=null)return{entry:{type:"object",name:e,path:_t,cid:$t,node:Ut,depth:kt,size:BigInt(Ut.length),content:async function*(){yield Lt}},next:{cid:zt,name:qt,path:Kt,toResolve:At}};jt=jt[qt]}else throw errCode$1(new Error(`No property named ${qt} found in cbor node ${$t}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:_t,cid:$t,node:Ut,depth:kt,size:BigInt(Ut.length),content:async function*(){yield Lt}}}};function extractDataFromBlock($t,e,_t,At){const xt=BigInt($t.length),kt=BigInt(e+xt);return _t>=kt||At<e?new Uint8Array(0):(At>=e&&At<kt&&($t=$t.subarray(0,Number(At-e))),_t>=e&&_t<kt&&($t=$t.subarray(Number(_t-e))),$t)}const validateOffsetAndLength=($t,e=0,_t=$t)=>{const At=BigInt($t),xt=BigInt(e??0);let kt=BigInt(_t);if(kt!==At&&(kt=xt+kt),kt>At&&(kt=At),xt<0n)throw errCode$1(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(xt>At)throw errCode$1(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(kt<0n)throw errCode$1(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(kt>At)throw errCode$1(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:xt,end:kt}},rawContent$1=$t=>{async function*e(_t={}){var Bt;const{start:At,end:xt}=validateOffsetAndLength($t.length,_t.offset,_t.length),kt=extractDataFromBlock($t,0n,At,xt);(Bt=_t.onProgress)==null||Bt.call(_t,new CustomProgressEvent("unixfs:exporter:progress:identity",{bytesRead:BigInt(kt.byteLength),totalBytes:xt-At,fileSize:BigInt($t.byteLength)})),yield kt}return e},resolve$2=async($t,e,_t,At,xt,kt,Bt,Nt)=>{if(At.length>0)throw errCode$1(new Error(`No link named ${_t} found in raw node ${$t}`),"ERR_NOT_FOUND");const Ut=decode$m($t.multihash.bytes);return{entry:{type:"identity",name:e,path:_t,cid:$t,content:rawContent$1(Ut.digest),depth:kt,size:BigInt(Ut.digest.length),node:Ut.digest}}},rawContent=$t=>{async function*e(_t={}){var Bt;const{start:At,end:xt}=validateOffsetAndLength($t.length,_t.offset,_t.length),kt=extractDataFromBlock($t,0n,At,xt);(Bt=_t.onProgress)==null||Bt.call(_t,new CustomProgressEvent("unixfs:exporter:progress:raw",{bytesRead:BigInt(kt.byteLength),totalBytes:xt-At,fileSize:BigInt($t.byteLength)})),yield kt}return e},resolve$1=async($t,e,_t,At,xt,kt,Bt,Nt)=>{if(At.length>0)throw errCode$1(new Error(`No link named ${_t} found in raw node ${$t}`),"ERR_NOT_FOUND");const Ut=await Bt.get($t,Nt);return{entry:{type:"raw",name:e,path:_t,cid:$t,content:rawContent(Ut),depth:kt,size:BigInt(Ut.length),node:Ut}}},hashFn=async function($t){return(await murmur3128.encode($t)).slice(0,8).reverse()},addLinksToHamtBucket=async($t,e,_t)=>{await Promise.all($t.map(async At=>{if(At.Name==null)throw new Error("Unexpected Link without a Name");if(At.Name.length===2){const xt=parseInt(At.Name,16);e._putObjectAt(xt,new Bucket({hash:_t._options.hash,bits:_t._options.bits},e,xt));return}await _t.put(At.Name.substring(2),!0)}))},toPrefix=$t=>$t.toString(16).toUpperCase().padStart(2,"0").substring(0,2),toBucketPath=$t=>{let e=$t.bucket;const _t=[];for(;e._parent!=null;)_t.push(e),e=e._parent;return _t.push(e),_t.reverse()},findShardCid=async($t,e,_t,At,xt)=>{if(At==null){const jt=createHAMT({hashFn});At={rootBucket:jt,hamtDepth:1,lastBucket:jt}}await addLinksToHamtBucket($t.Links,At.lastBucket,At.rootBucket);const kt=await At.rootBucket._findNewBucketAndPos(e);let Bt=toPrefix(kt.pos);const Nt=toBucketPath(kt);Nt.length>At.hamtDepth&&(At.lastBucket=Nt[At.hamtDepth],Bt=toPrefix(At.lastBucket._posAtParent));const Ut=$t.Links.find(jt=>{if(jt.Name==null)return!1;const Kt=jt.Name.substring(0,2),qt=jt.Name.substring(2);return!(Kt!==Bt||qt!==""&&qt!==e)});if(Ut==null)return;if(Ut.Name!=null&&Ut.Name.substring(2)===e)return Ut.Hash;At.hamtDepth++;const Lt=await _t.get(Ut.Hash,xt);return $t=decode$a(Lt),findShardCid($t,e,_t,At,xt)};function peekable($t){const[e,_t]=$t[Symbol.asyncIterator]!=null?[$t[Symbol.asyncIterator](),Symbol.asyncIterator]:[$t[Symbol.iterator](),Symbol.iterator],At=[];return{peek:()=>e.next(),push:xt=>{At.push(xt)},next:()=>At.length>0?{done:!1,value:At.shift()}:e.next(),[_t](){return this}}}function isAsyncIterable$3($t){return $t[Symbol.asyncIterator]!=null}function filter($t,e){let _t=0;if(isAsyncIterable$3($t))return async function*(){for await(const Ut of $t)await e(Ut,_t++)&&(yield Ut)}();const At=peekable($t),{value:xt,done:kt}=At.next();if(kt===!0)return function*(){}();const Bt=e(xt,_t++);if(typeof Bt.then=="function")return async function*(){await Bt&&(yield xt);for await(const Ut of At)await e(Ut,_t++)&&(yield Ut)}();const Nt=e;return function*(){Bt===!0&&(yield xt);for(const Ut of At)Nt(Ut,_t++)&&(yield Ut)}()}function isAsyncIterable$2($t){return $t[Symbol.asyncIterator]!=null}function map($t,e){let _t=0;if(isAsyncIterable$2($t))return async function*(){for await(const Ut of $t)yield e(Ut,_t++)}();const At=peekable($t),{value:xt,done:kt}=At.next();if(kt===!0)return function*(){}();const Bt=e(xt,_t++);if(typeof Bt.then=="function")return async function*(){yield await Bt;for await(const Ut of At)yield e(Ut,_t++)}();const Nt=e;return function*(){yield Bt;for(const Ut of At)yield Nt(Ut,_t++)}()}function pDefer(){const $t={};return $t.promise=new Promise((e,_t)=>{$t.resolve=e,$t.reject=_t}),$t}const CustomEvent=globalThis.CustomEvent??Event;async function*parallel($t,e={}){let _t=e.concurrency??1/0;_t<1&&(_t=1/0);const At=e.ordered==null?!1:e.ordered,xt=new EventTarget,kt=[];let Bt=pDefer(),Nt=pDefer(),Ut=!1,Lt,jt=!1;xt.addEventListener("task-complete",()=>{Nt.resolve()}),Promise.resolve().then(async()=>{try{for await(const Vt of $t){if(kt.length===_t&&(Bt=pDefer(),await Bt.promise),jt)break;const Ht={done:!1};kt.push(Ht),Vt().then(Wt=>{Ht.done=!0,Ht.ok=!0,Ht.value=Wt,xt.dispatchEvent(new CustomEvent("task-complete"))},Wt=>{Ht.done=!0,Ht.err=Wt,xt.dispatchEvent(new CustomEvent("task-complete"))})}Ut=!0,xt.dispatchEvent(new CustomEvent("task-complete"))}catch(Vt){Lt=Vt,xt.dispatchEvent(new CustomEvent("task-complete"))}});function Kt(){var Vt;return At?(Vt=kt[0])==null?void 0:Vt.done:!!kt.find(Ht=>Ht.done)}function*qt(){for(;kt.length>0&&kt[0].done;){const Vt=kt[0];if(kt.shift(),Vt.ok)yield Vt.value;else throw jt=!0,Bt.resolve(),Vt.err;Bt.resolve()}}function*zt(){for(;Kt();)for(let Vt=0;Vt<kt.length;Vt++)if(kt[Vt].done){const Ht=kt[Vt];if(kt.splice(Vt,1),Vt--,Ht.ok)yield Ht.value;else throw jt=!0,Bt.resolve(),Ht.err;Bt.resolve()}}for(;;){if(Kt()||(Nt=pDefer(),await Nt.promise),Lt!=null)throw Lt;if(At?yield*qt():yield*zt(),Ut&&kt.length===0)break}}class FixedFIFO{constructor(e){sn(this,"buffer");sn(this,"mask");sn(this,"top");sn(this,"btm");sn(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{constructor(e={}){sn(this,"size");sn(this,"hwm");sn(this,"head");sn(this,"tail");this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const _t=this.head;this.head=_t.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const _t=this.tail.next;this.tail.next=null,this.tail=_t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let AbortError$2=class extends Error{constructor(_t,At){super(_t??"The operation was aborted");sn(this,"type");sn(this,"code");this.type="aborted",this.code=At??"ABORT_ERR"}};function pushable($t={}){return _pushable(_t=>{const At=_t.shift();if(At==null)return{done:!0};if(At.error!=null)throw At.error;return{done:At.done===!0,value:At.value}},$t)}function _pushable($t,e){e=e??{};let _t=e.onEnd,At=new FIFO,xt,kt,Bt,Nt=pDefer();const Ut=async()=>{try{return At.isEmpty()?Bt?{done:!0}:await new Promise((Wt,Qt)=>{kt=Xt=>{kt=null,At.push(Xt);try{Wt($t(At))}catch(Jt){Qt(Jt)}return xt}}):$t(At)}finally{At.isEmpty()&&queueMicrotask(()=>{Nt.resolve(),Nt=pDefer()})}},Lt=Wt=>kt!=null?kt(Wt):(At.push(Wt),xt),jt=Wt=>(At=new FIFO,kt!=null?kt({error:Wt}):(At.push({error:Wt}),xt)),Kt=Wt=>{if(Bt)return xt;if((e==null?void 0:e.objectMode)!==!0&&(Wt==null?void 0:Wt.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return Lt({done:!1,value:Wt})},qt=Wt=>Bt?xt:(Bt=!0,Wt!=null?jt(Wt):Lt({done:!0})),zt=()=>(At=new FIFO,qt(),{done:!0}),Vt=Wt=>(qt(Wt),{done:!0});if(xt={[Symbol.asyncIterator](){return this},next:Ut,return:zt,throw:Vt,push:Kt,end:qt,get readableLength(){return At.size},onEmpty:async Wt=>{const Qt=Wt==null?void 0:Wt.signal;if(Qt==null||Qt.throwIfAborted(),At.isEmpty())return;let Xt,Jt;Qt!=null&&(Xt=new Promise((tr,dr)=>{Jt=()=>{dr(new AbortError$2)},Qt.addEventListener("abort",Jt)}));try{await Promise.race([Nt.promise,Xt])}finally{Jt!=null&&Qt!=null&&(Qt==null||Qt.removeEventListener("abort",Jt))}}},_t==null)return xt;const Ht=xt;return xt={[Symbol.asyncIterator](){return this},next(){return Ht.next()},throw(Wt){return Ht.throw(Wt),_t!=null&&(_t(Wt),_t=void 0),{done:!0}},return(){return Ht.return(),_t!=null&&(_t(),_t=void 0),{done:!0}},push:Kt,end(Wt){return Ht.end(Wt),_t!=null&&(_t(Wt),_t=void 0),xt},get readableLength(){return Ht.readableLength},onEmpty:Wt=>Ht.onEmpty(Wt)},xt}function isAsyncIterable$1($t){return $t[Symbol.asyncIterator]!=null}function merge(...$t){const e=[];for(const _t of $t)isAsyncIterable$1(_t)||e.push(_t);return e.length===$t.length?function*(){for(const _t of e)yield*_t}():async function*(){const _t=pushable({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all($t.map(async At=>{for await(const xt of At)_t.push(xt)})),_t.end()}catch(At){_t.end(At)}}),yield*_t}()}function pipe($t,...e){if($t==null)throw new Error("Empty pipeline");if(isDuplex($t)){const At=$t;$t=()=>At.source}else if(isIterable($t)||isAsyncIterable($t)){const At=$t;$t=()=>At}const _t=[$t,...e];if(_t.length>1&&isDuplex(_t[_t.length-1])&&(_t[_t.length-1]=_t[_t.length-1].sink),_t.length>2)for(let At=1;At<_t.length-1;At++)isDuplex(_t[At])&&(_t[At]=duplexPipelineFn(_t[At]));return rawPipe(..._t)}const rawPipe=(...$t)=>{let e;for(;$t.length>0;)e=$t.shift()(e);return e},isAsyncIterable=$t=>($t==null?void 0:$t[Symbol.asyncIterator])!=null,isIterable=$t=>($t==null?void 0:$t[Symbol.iterator])!=null,isDuplex=$t=>$t==null?!1:$t.sink!=null&&$t.source!=null,duplexPipelineFn=$t=>e=>{const _t=$t.sink(e);if((_t==null?void 0:_t.then)!=null){const At=pushable({objectMode:!0});_t.then(()=>{At.end()},Bt=>{At.end(Bt)});let xt;const kt=$t.source;if(isAsyncIterable(kt))xt=async function*(){yield*kt,At.end()};else if(isIterable(kt))xt=function*(){yield*kt,At.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge(At,xt())}return $t.source},directoryContent=($t,e,_t,At,xt,kt,Bt)=>{async function*Nt(Ut={}){var qt;const Lt=Ut.offset??0,jt=Ut.length??e.Links.length,Kt=e.Links.slice(Lt,jt);(qt=Ut.onProgress)==null||qt.call(Ut,new CustomProgressEvent("unixfs:exporter:walk:directory",{cid:$t})),yield*pipe(Kt,zt=>map(zt,Vt=>async()=>{const Ht=Vt.Name??"",Wt=`${At}/${Ht}`;return(await xt(Vt.Hash,Ht,Wt,[],kt+1,Bt,Ut)).entry}),zt=>parallel(zt,{ordered:!0}),zt=>filter(zt,Vt=>Vt!=null))}return Nt};var eventemitter3={exports:{}};(function($t){var e=Object.prototype.hasOwnProperty,_t="~";function At(){}Object.create&&(At.prototype=Object.create(null),new At().__proto__||(_t=!1));function xt(Ut,Lt,jt){this.fn=Ut,this.context=Lt,this.once=jt||!1}function kt(Ut,Lt,jt,Kt,qt){if(typeof jt!="function")throw new TypeError("The listener must be a function");var zt=new xt(jt,Kt||Ut,qt),Vt=_t?_t+Lt:Lt;return Ut._events[Vt]?Ut._events[Vt].fn?Ut._events[Vt]=[Ut._events[Vt],zt]:Ut._events[Vt].push(zt):(Ut._events[Vt]=zt,Ut._eventsCount++),Ut}function Bt(Ut,Lt){--Ut._eventsCount===0?Ut._events=new At:delete Ut._events[Lt]}function Nt(){this._events=new At,this._eventsCount=0}Nt.prototype.eventNames=function(){var Lt=[],jt,Kt;if(this._eventsCount===0)return Lt;for(Kt in jt=this._events)e.call(jt,Kt)&&Lt.push(_t?Kt.slice(1):Kt);return Object.getOwnPropertySymbols?Lt.concat(Object.getOwnPropertySymbols(jt)):Lt},Nt.prototype.listeners=function(Lt){var jt=_t?_t+Lt:Lt,Kt=this._events[jt];if(!Kt)return[];if(Kt.fn)return[Kt.fn];for(var qt=0,zt=Kt.length,Vt=new Array(zt);qt<zt;qt++)Vt[qt]=Kt[qt].fn;return Vt},Nt.prototype.listenerCount=function(Lt){var jt=_t?_t+Lt:Lt,Kt=this._events[jt];return Kt?Kt.fn?1:Kt.length:0},Nt.prototype.emit=function(Lt,jt,Kt,qt,zt,Vt){var Ht=_t?_t+Lt:Lt;if(!this._events[Ht])return!1;var Wt=this._events[Ht],Qt=arguments.length,Xt,Jt;if(Wt.fn){switch(Wt.once&&this.removeListener(Lt,Wt.fn,void 0,!0),Qt){case 1:return Wt.fn.call(Wt.context),!0;case 2:return Wt.fn.call(Wt.context,jt),!0;case 3:return Wt.fn.call(Wt.context,jt,Kt),!0;case 4:return Wt.fn.call(Wt.context,jt,Kt,qt),!0;case 5:return Wt.fn.call(Wt.context,jt,Kt,qt,zt),!0;case 6:return Wt.fn.call(Wt.context,jt,Kt,qt,zt,Vt),!0}for(Jt=1,Xt=new Array(Qt-1);Jt<Qt;Jt++)Xt[Jt-1]=arguments[Jt];Wt.fn.apply(Wt.context,Xt)}else{var tr=Wt.length,dr;for(Jt=0;Jt<tr;Jt++)switch(Wt[Jt].once&&this.removeListener(Lt,Wt[Jt].fn,void 0,!0),Qt){case 1:Wt[Jt].fn.call(Wt[Jt].context);break;case 2:Wt[Jt].fn.call(Wt[Jt].context,jt);break;case 3:Wt[Jt].fn.call(Wt[Jt].context,jt,Kt);break;case 4:Wt[Jt].fn.call(Wt[Jt].context,jt,Kt,qt);break;default:if(!Xt)for(dr=1,Xt=new Array(Qt-1);dr<Qt;dr++)Xt[dr-1]=arguments[dr];Wt[Jt].fn.apply(Wt[Jt].context,Xt)}}return!0},Nt.prototype.on=function(Lt,jt,Kt){return kt(this,Lt,jt,Kt,!1)},Nt.prototype.once=function(Lt,jt,Kt){return kt(this,Lt,jt,Kt,!0)},Nt.prototype.removeListener=function(Lt,jt,Kt,qt){var zt=_t?_t+Lt:Lt;if(!this._events[zt])return this;if(!jt)return Bt(this,zt),this;var Vt=this._events[zt];if(Vt.fn)Vt.fn===jt&&(!qt||Vt.once)&&(!Kt||Vt.context===Kt)&&Bt(this,zt);else{for(var Ht=0,Wt=[],Qt=Vt.length;Ht<Qt;Ht++)(Vt[Ht].fn!==jt||qt&&!Vt[Ht].once||Kt&&Vt[Ht].context!==Kt)&&Wt.push(Vt[Ht]);Wt.length?this._events[zt]=Wt.length===1?Wt[0]:Wt:Bt(this,zt)}return this},Nt.prototype.removeAllListeners=function(Lt){var jt;return Lt?(jt=_t?_t+Lt:Lt,this._events[jt]&&Bt(this,jt)):(this._events=new At,this._eventsCount=0),this},Nt.prototype.off=Nt.prototype.removeListener,Nt.prototype.addListener=Nt.prototype.on,Nt.prefixed=_t,Nt.EventEmitter=Nt,$t.exports=Nt})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}let AbortError$1=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException=$t=>globalThis.DOMException===void 0?new AbortError$1($t):new DOMException($t),getAbortedReason=$t=>{const e=$t.reason===void 0?getDOMException("This operation was aborted."):$t.reason;return e instanceof Error?e:getDOMException(e)};function pTimeout($t,e,_t,At){let xt;const kt=new Promise((Bt,Nt)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){Bt($t);return}if(At={customTimers:{setTimeout,clearTimeout},...At},At.signal){const{signal:Ut}=At;Ut.aborted&&Nt(getAbortedReason(Ut)),Ut.addEventListener("abort",()=>{Nt(getAbortedReason(Ut))})}xt=At.customTimers.setTimeout.call(void 0,()=>{const Ut=`Promise timed out after ${e} milliseconds`,Lt=_t instanceof Error?_t:new TimeoutError(Ut);typeof $t.cancel=="function"&&$t.cancel(),Nt(Lt)},e),(async()=>{try{Bt(await $t)}catch(Ut){Nt(Ut)}finally{At.customTimers.clearTimeout.call(void 0,xt)}})()});return kt.clear=()=>{clearTimeout(xt),xt=void 0},kt}function lowerBound($t,e,_t){let At=0,xt=$t.length;for(;xt>0;){const kt=Math.trunc(xt/2);let Bt=At+kt;_t($t[Bt],e)<=0?(At=++Bt,xt-=kt+1):xt=kt}return At}var __classPrivateFieldGet$1=function($t,e,_t,At){if(_t==="a"&&!At)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?$t!==e||!At:!e.has($t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return _t==="m"?At:_t==="a"?At.call($t):At?At.value:e.get($t)},_PriorityQueue_queue;class PriorityQueue{constructor(){_PriorityQueue_queue.set(this,[])}enqueue(e,_t){_t={priority:0,..._t};const At={priority:_t.priority,run:e};if(this.size&&__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f")[this.size-1].priority>=_t.priority){__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").push(At);return}const xt=lowerBound(__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f"),At,(kt,Bt)=>Bt.priority-kt.priority);__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").splice(xt,0,At)}dequeue(){const e=__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").shift();return e==null?void 0:e.run}filter(e){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").filter(_t=>_t.priority===e.priority).map(_t=>_t.run)}get size(){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").length}}_PriorityQueue_queue=new WeakMap;var __classPrivateFieldSet=function($t,e,_t,At,xt){if(At==="m")throw new TypeError("Private method is not writable");if(At==="a"&&!xt)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?$t!==e||!xt:!e.has($t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return At==="a"?xt.call($t,_t):xt?xt.value=_t:e.set($t,_t),_t},__classPrivateFieldGet=function($t,e,_t,At){if(_t==="a"&&!At)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?$t!==e||!At:!e.has($t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return _t==="m"?At:_t==="a"?At.call($t):At?At.value:e.get($t)},_PQueue_instances,_PQueue_carryoverConcurrencyCount,_PQueue_isIntervalIgnored,_PQueue_intervalCount,_PQueue_intervalCap,_PQueue_interval,_PQueue_intervalEnd,_PQueue_intervalId,_PQueue_timeoutId,_PQueue_queue,_PQueue_queueClass,_PQueue_pending,_PQueue_concurrency,_PQueue_isPaused,_PQueue_throwOnTimeout,_PQueue_doesIntervalAllowAnother_get,_PQueue_doesConcurrentAllowAnother_get,_PQueue_next,_PQueue_onResumeInterval,_PQueue_isIntervalPaused_get,_PQueue_tryToStartAnother,_PQueue_initializeIntervalIfNeeded,_PQueue_onInterval,_PQueue_processQueue,_PQueue_throwOnAbort,_PQueue_onEvent;class AbortError extends Error{}class PQueue extends EventEmitter{constructor(e){var _t,At,xt,kt;if(super(),_PQueue_instances.add(this),_PQueue_carryoverConcurrencyCount.set(this,void 0),_PQueue_isIntervalIgnored.set(this,void 0),_PQueue_intervalCount.set(this,0),_PQueue_intervalCap.set(this,void 0),_PQueue_interval.set(this,void 0),_PQueue_intervalEnd.set(this,0),_PQueue_intervalId.set(this,void 0),_PQueue_timeoutId.set(this,void 0),_PQueue_queue.set(this,void 0),_PQueue_queueClass.set(this,void 0),_PQueue_pending.set(this,0),_PQueue_concurrency.set(this,void 0),_PQueue_isPaused.set(this,void 0),_PQueue_throwOnTimeout.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(At=(_t=e.intervalCap)===null||_t===void 0?void 0:_t.toString())!==null&&At!==void 0?At:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(kt=(xt=e.interval)===null||xt===void 0?void 0:xt.toString())!==null&&kt!==void 0?kt:""}\` (${typeof e.interval})`);__classPrivateFieldSet(this,_PQueue_carryoverConcurrencyCount,e.carryoverConcurrencyCount,"f"),__classPrivateFieldSet(this,_PQueue_isIntervalIgnored,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),__classPrivateFieldSet(this,_PQueue_intervalCap,e.intervalCap,"f"),__classPrivateFieldSet(this,_PQueue_interval,e.interval,"f"),__classPrivateFieldSet(this,_PQueue_queue,new e.queueClass,"f"),__classPrivateFieldSet(this,_PQueue_queueClass,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,__classPrivateFieldSet(this,_PQueue_throwOnTimeout,e.throwOnTimeout===!0,"f"),__classPrivateFieldSet(this,_PQueue_isPaused,e.autoStart===!1,"f")}get concurrency(){return __classPrivateFieldGet(this,_PQueue_concurrency,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);__classPrivateFieldSet(this,_PQueue_concurrency,e,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)}async add(e,_t={}){return _t={timeout:this.timeout,throwOnTimeout:__classPrivateFieldGet(this,_PQueue_throwOnTimeout,"f"),..._t},new Promise((At,xt)=>{__classPrivateFieldGet(this,_PQueue_queue,"f").enqueue(async()=>{var kt,Bt,Nt;__classPrivateFieldSet(this,_PQueue_pending,(Bt=__classPrivateFieldGet(this,_PQueue_pending,"f"),Bt++,Bt),"f"),__classPrivateFieldSet(this,_PQueue_intervalCount,(Nt=__classPrivateFieldGet(this,_PQueue_intervalCount,"f"),Nt++,Nt),"f");try{if(!((kt=_t.signal)===null||kt===void 0)&&kt.aborted)throw new AbortError("The task was aborted.");let Ut=e({signal:_t.signal});_t.timeout&&(Ut=pTimeout(Promise.resolve(Ut),_t.timeout)),_t.signal&&(Ut=Promise.race([Ut,__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_throwOnAbort).call(this,_t.signal)]));const Lt=await Ut;At(Lt),this.emit("completed",Lt)}catch(Ut){if(Ut instanceof TimeoutError&&!_t.throwOnTimeout){At();return}xt(Ut),this.emit("error",Ut)}finally{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_next).call(this)}},_t),this.emit("add"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this)})}async addAll(e,_t){return Promise.all(e.map(async At=>this.add(At,_t)))}start(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")?(__classPrivateFieldSet(this,_PQueue_isPaused,!1,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this),this):this}pause(){__classPrivateFieldSet(this,_PQueue_isPaused,!0,"f")}clear(){__classPrivateFieldSet(this,_PQueue_queue,new(__classPrivateFieldGet(this,_PQueue_queueClass,"f")),"f")}async onEmpty(){__classPrivateFieldGet(this,_PQueue_queue,"f").size!==0&&await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"empty")}async onSizeLessThan(e){__classPrivateFieldGet(this,_PQueue_queue,"f").size<e||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"next",()=>__classPrivateFieldGet(this,_PQueue_queue,"f").size<e)}async onIdle(){__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_queue,"f").size===0||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"idle")}get size(){return __classPrivateFieldGet(this,_PQueue_queue,"f").size}sizeBy(e){return __classPrivateFieldGet(this,_PQueue_queue,"f").filter(e).length}get pending(){return __classPrivateFieldGet(this,_PQueue_pending,"f")}get isPaused(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")}}_PQueue_carryoverConcurrencyCount=new WeakMap,_PQueue_isIntervalIgnored=new WeakMap,_PQueue_intervalCount=new WeakMap,_PQueue_intervalCap=new WeakMap,_PQueue_interval=new WeakMap,_PQueue_intervalEnd=new WeakMap,_PQueue_intervalId=new WeakMap,_PQueue_timeoutId=new WeakMap,_PQueue_queue=new WeakMap,_PQueue_queueClass=new WeakMap,_PQueue_pending=new WeakMap,_PQueue_concurrency=new WeakMap,_PQueue_isPaused=new WeakMap,_PQueue_throwOnTimeout=new WeakMap,_PQueue_instances=new WeakSet,_PQueue_doesIntervalAllowAnother_get=function $t(){return __classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalCount,"f")<__classPrivateFieldGet(this,_PQueue_intervalCap,"f")},_PQueue_doesConcurrentAllowAnother_get=function $t(){return __classPrivateFieldGet(this,_PQueue_pending,"f")<__classPrivateFieldGet(this,_PQueue_concurrency,"f")},_PQueue_next=function $t(){var e;__classPrivateFieldSet(this,_PQueue_pending,(e=__classPrivateFieldGet(this,_PQueue_pending,"f"),e--,e),"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("next")},_PQueue_onResumeInterval=function $t(){__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),__classPrivateFieldSet(this,_PQueue_timeoutId,void 0,"f")},_PQueue_isIntervalPaused_get=function $t(){const e=Date.now();if(__classPrivateFieldGet(this,_PQueue_intervalId,"f")===void 0){const _t=__classPrivateFieldGet(this,_PQueue_intervalEnd,"f")-e;if(_t<0)__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f");else return __classPrivateFieldGet(this,_PQueue_timeoutId,"f")===void 0&&__classPrivateFieldSet(this,_PQueue_timeoutId,setTimeout(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onResumeInterval).call(this)},_t),"f"),!0}return!1},_PQueue_tryToStartAnother=function $t(){if(__classPrivateFieldGet(this,_PQueue_queue,"f").size===0)return __classPrivateFieldGet(this,_PQueue_intervalId,"f")&&clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f"),this.emit("empty"),__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&this.emit("idle"),!1;if(!__classPrivateFieldGet(this,_PQueue_isPaused,"f")){const e=!__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_isIntervalPaused_get);if(__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesIntervalAllowAnother_get)&&__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesConcurrentAllowAnother_get)){const _t=__classPrivateFieldGet(this,_PQueue_queue,"f").dequeue();return _t?(this.emit("active"),_t(),e&&__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),!0):!1}}return!1},_PQueue_initializeIntervalIfNeeded=function $t(){__classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalId,"f")!==void 0||(__classPrivateFieldSet(this,_PQueue_intervalId,setInterval(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this)},__classPrivateFieldGet(this,_PQueue_interval,"f")),"f"),__classPrivateFieldSet(this,_PQueue_intervalEnd,Date.now()+__classPrivateFieldGet(this,_PQueue_interval,"f"),"f"))},_PQueue_onInterval=function $t(){__classPrivateFieldGet(this,_PQueue_intervalCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_intervalId,"f")&&(clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f")),__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)},_PQueue_processQueue=function $t(){for(;__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this););},_PQueue_throwOnAbort=async function $t(e){return new Promise((_t,At)=>{e.addEventListener("abort",()=>{At(new AbortError("The task was aborted."))},{once:!0})})},_PQueue_onEvent=async function $t(e,_t){return new Promise(At=>{const xt=()=>{_t&&!_t()||(this.off(e,xt),At())};this.on(e,xt)})};async function walkDAG($t,e,_t,At,xt,kt,Bt){if(e instanceof Uint8Array){const Lt=extractDataFromBlock(e,At,xt,kt);_t.push(Lt);return}if(e.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let Nt;try{Nt=UnixFS.unmarshal(e.Data)}catch(Lt){throw errCode$1(Lt,"ERR_NOT_UNIXFS")}if(Nt.data!=null){const Lt=Nt.data,jt=extractDataFromBlock(Lt,At,xt,kt);_t.push(jt),At+=BigInt(jt.byteLength)}const Ut=[];if(e.Links.length!==Nt.blockSizes.length)throw errCode$1(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let Lt=0;Lt<e.Links.length;Lt++){const jt=e.Links[Lt],Kt=At,qt=Kt+Nt.blockSizes[Lt];if((xt>=Kt&&xt<qt||kt>=Kt&&kt<=qt||xt<Kt&&kt>qt)&&Ut.push({link:jt,blockStart:At}),At=qt,At>kt)break}await pipe(Ut,Lt=>map(Lt,jt=>async()=>{const Kt=await $t.get(jt.link.Hash,Bt);return{...jt,block:Kt}}),Lt=>parallel(Lt,{ordered:!0}),async Lt=>{for await(const{link:jt,block:Kt,blockStart:qt}of Lt){let zt;switch(jt.Hash.code){case code$4:zt=decode$a(Kt);break;case code$3:zt=Kt;break;default:_t.end(errCode$1(new Error(`Unsupported codec: ${jt.Hash.code}`),"ERR_NOT_UNIXFS"));return}const Vt=new PQueue({concurrency:1});Vt.on("error",Ht=>{_t.end(Ht)}),Vt.add(async()=>{var Ht;(Ht=Bt.onProgress)==null||Ht.call(Bt,new CustomProgressEvent("unixfs:exporter:walk:file",{cid:jt.Hash})),await walkDAG($t,zt,_t,qt,xt,kt,Bt)}),await Vt.onIdle()}}),At>=kt&&_t.end()}const fileContent=($t,e,_t,At,xt,kt,Bt)=>{async function*Nt(Ut={}){var Ht,Wt;const Lt=_t.fileSize();if(Lt===void 0)throw new Error("File was a directory");const{start:jt,end:Kt}=validateOffsetAndLength(Lt,Ut.offset,Ut.length);if(Kt===0n)return;let qt=0n;const zt=Kt-jt,Vt=pushable();(Ht=Ut.onProgress)==null||Ht.call(Ut,new CustomProgressEvent("unixfs:exporter:walk:file",{cid:$t})),walkDAG(Bt,e,Vt,0n,jt,Kt,Ut).catch(Qt=>{Vt.end(Qt)});for await(const Qt of Vt)if(Qt!=null){if(qt+=BigInt(Qt.byteLength),qt>zt)throw Vt.end(),errCode$1(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");qt===zt&&Vt.end(),(Wt=Ut.onProgress)==null||Wt.call(Ut,new CustomProgressEvent("unixfs:exporter:progress:unixfs:file",{bytesRead:qt,totalBytes:zt,fileSize:Lt})),yield Qt}if(qt<zt)throw errCode$1(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}return Nt},hamtShardedDirectoryContent=($t,e,_t,At,xt,kt,Bt)=>{function Nt(Ut={}){var Lt;return(Lt=Ut.onProgress)==null||Lt.call(Ut,new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:$t})),listDirectory(e,At,xt,kt,Bt,Ut)}return Nt};async function*listDirectory($t,e,_t,At,xt,kt){const Bt=$t.Links,Nt=pipe(Bt,Ut=>map(Ut,Lt=>async()=>{var Kt;const jt=Lt.Name!=null?Lt.Name.substring(2):null;if(jt!=null&&jt!==""){const qt=await _t(Lt.Hash,jt,`${e}/${jt}`,[],At+1,xt,kt);return{entries:qt.entry==null?[]:[qt.entry]}}else{const qt=await xt.get(Lt.Hash,kt);return $t=decode$a(qt),(Kt=kt.onProgress)==null||Kt.call(kt,new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:Lt.Hash})),{entries:listDirectory($t,e,_t,At,xt,kt)}}}),Ut=>parallel(Ut,{ordered:!0}));for await(const{entries:Ut}of Nt)yield*Ut}const findLinkCid=($t,e)=>{const _t=$t.Links.find(At=>At.Name===e);return _t==null?void 0:_t.Hash},contentExporters={raw:fileContent,file:fileContent,directory:directoryContent,"hamt-sharded-directory":hamtShardedDirectoryContent,metadata:($t,e,_t,At,xt,kt,Bt)=>()=>[],symlink:($t,e,_t,At,xt,kt,Bt)=>()=>[]},unixFsResolver=async($t,e,_t,At,xt,kt,Bt,Nt)=>{const Ut=await Bt.get($t,Nt),Lt=decode$a(Ut);let jt,Kt;if(e==null&&(e=$t.toString()),Lt.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{jt=UnixFS.unmarshal(Lt.Data)}catch(zt){throw errCode$1(zt,"ERR_NOT_UNIXFS")}if(_t==null&&(_t=e),At.length>0){let zt;if((jt==null?void 0:jt.type)==="hamt-sharded-directory"?zt=await findShardCid(Lt,At[0],Bt):zt=findLinkCid(Lt,At[0]),zt==null)throw errCode$1(new Error("file does not exist"),"ERR_NOT_FOUND");const Vt=At.shift(),Ht=`${_t}/${Vt}`;Kt={cid:zt,toResolve:At,name:Vt??"",path:Ht}}const qt=contentExporters[jt.type]($t,Lt,jt,_t,xt,kt,Bt);if(qt==null)throw errCode$1(new Error("could not find content exporter"),"ERR_NOT_FOUND");return jt.isDirectory()?{entry:{type:"directory",name:e,path:_t,cid:$t,content:qt,unixfs:jt,depth:kt,node:Lt,size:jt.fileSize()},next:Kt}:{entry:{type:"file",name:e,path:_t,cid:$t,content:qt,unixfs:jt,depth:kt,node:Lt,size:jt.fileSize()},next:Kt}},resolvers={[code$4]:unixFsResolver,[code$3]:resolve$1,[code$5]:resolve$3,[identity.code]:resolve$2},resolve=async($t,e,_t,At,xt,kt,Bt)=>{const Nt=resolvers[$t.code];if(Nt==null)throw errCode$1(new Error(`No resolver for code ${$t.code}`),"ERR_NO_RESOLVER");return Nt($t,e,_t,At,resolve,xt,kt,Bt)},toPathComponents=($t="")=>($t.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),cidAndRest=$t=>{if($t instanceof Uint8Array)return{cid:CID.decode($t),toResolve:[]};const e=CID.asCID($t);if(e!=null)return{cid:e,toResolve:[]};if(typeof $t=="string"){$t.indexOf("/ipfs/")===0&&($t=$t.substring(6));const _t=toPathComponents($t);return{cid:CID.parse(_t[0]),toResolve:_t.slice(1)}}throw errCode$1(new Error(`Unknown path type ${$t}`),"ERR_BAD_PATH")};async function*walkPath($t,e,_t={}){let{cid:At,toResolve:xt}=cidAndRest($t),kt=At.toString(),Bt=kt;const Nt=xt.length;for(;;){const Ut=await resolve(At,kt,Bt,xt,Nt,e,_t);if(Ut.entry==null&&Ut.next==null)throw errCode$1(new Error(`Could not resolve ${$t}`),"ERR_NOT_FOUND");if(Ut.entry!=null&&(yield Ut.entry),Ut.next==null)return;xt=Ut.next.toResolve,At=Ut.next.cid,kt=Ut.next.name,Bt=Ut.next.path}}async function exporter($t,e,_t={}){const At=await last(walkPath($t,e,_t));if(At==null)throw errCode$1(new Error(`Could not resolve ${$t}`),"ERR_NOT_FOUND");return At}var __awaiter$1s=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$3=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}};class DataStoreLevel{constructor(e={}){this.config=Object.assign({blockstoreLocation:"DATASTORE",createLevelDatabase},e),this.blockstore=new BlockstoreLevel({location:this.config.blockstoreLocation,createLevelDatabase:this.config.createLevelDatabase})}open(){return __awaiter$1s(this,void 0,void 0,function*(){yield this.blockstore.open()})}close(){return __awaiter$1s(this,void 0,void 0,function*(){yield this.blockstore.close()})}put(e,_t,At,xt){var kt,Bt,Nt,Ut,Lt,jt;return __awaiter$1s(this,void 0,void 0,function*(){const Kt=yield this.getBlockstoreForStoringData(e,_t,At),qt=importer([{content:xt}],Kt,{cidVersion:1});let zt;try{for(var Vt=!0,Ht=__asyncValues$3(qt),Wt;Wt=yield Ht.next(),kt=Wt.done,!kt;Vt=!0)Ut=Wt.value,Vt=!1,zt=Ut}catch(Qt){Bt={error:Qt}}finally{try{!Vt&&!kt&&(Nt=Ht.return)&&(yield Nt.call(Ht))}finally{if(Bt)throw Bt.error}}return{dataSize:Number((jt=(Lt=zt.unixfs)===null||Lt===void 0?void 0:Lt.fileSize())!==null&&jt!==void 0?jt:zt.size)}})}get(e,_t,At){return __awaiter$1s(this,void 0,void 0,function*(){const xt=yield this.getBlockstoreForStoringData(e,_t,At);if(!(yield xt.has(At)))return;const Bt=yield exporter(At,xt),Nt=Bt.content(),Ut=new browserExports$1.Readable({read(){return __awaiter$1s(this,void 0,void 0,function*(){const jt=yield Nt.next();jt.done?this.push(null):this.push(jt.value)})}});let Lt=Bt.size;return(Bt.type==="file"||Bt.type==="directory")&&(Lt=Bt.unixfs.fileSize()),{dataSize:Number(Lt),dataStream:Ut}})}delete(e,_t,At){return __awaiter$1s(this,void 0,void 0,function*(){yield(yield this.getBlockstoreForStoringData(e,_t,At)).clear()})}clear(){return __awaiter$1s(this,void 0,void 0,function*(){yield this.blockstore.clear()})}getBlockstoreForStoringData(e,_t,At){return __awaiter$1s(this,void 0,void 0,function*(){return yield(yield(yield(yield this.blockstore.partition("data")).partition(e)).partition(_t)).partition(At)})}}var __awaiter$1r=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$2=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}},__await=function($t){return this instanceof __await?(this.v=$t,this):new __await($t)},__asyncGenerator=function($t,e,_t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var At=_t.apply($t,e||[]),xt,kt=[];return xt={},Bt("next"),Bt("throw"),Bt("return"),xt[Symbol.asyncIterator]=function(){return this},xt;function Bt(qt){At[qt]&&(xt[qt]=function(zt){return new Promise(function(Vt,Ht){kt.push([qt,zt,Vt,Ht])>1||Nt(qt,zt)})})}function Nt(qt,zt){try{Ut(At[qt](zt))}catch(Vt){Kt(kt[0][3],Vt)}}function Ut(qt){qt.value instanceof __await?Promise.resolve(qt.value.v).then(Lt,jt):Kt(kt[0][2],qt)}function Lt(qt){Nt("next",qt)}function jt(qt){Nt("throw",qt)}function Kt(qt,zt){qt(zt),kt.shift(),kt.length&&Nt(kt[0][0],kt[0][1])}};const INDEX_SUBLEVEL_NAME="index";class IndexLevel{constructor(e){this.config=Object.assign({createLevelDatabase},e),this.db=new LevelWrapper({location:this.config.location,createLevelDatabase:this.config.createLevelDatabase,keyEncoding:"utf8"})}open(){return __awaiter$1r(this,void 0,void 0,function*(){yield this.db.open()})}close(){return __awaiter$1r(this,void 0,void 0,function*(){yield this.db.close()})}clear(){return __awaiter$1r(this,void 0,void 0,function*(){yield this.db.clear()})}put(e,_t,At,xt){return __awaiter$1r(this,void 0,void 0,function*(){if(isEmptyObject$1(At))throw new DwnError(DwnErrorCode.IndexMissingIndexableProperty,"Index must include at least one valid indexable property");const kt={messageCid:_t,indexes:At},Bt=[];for(const jt in At){const Kt=At[jt];if(Array.isArray(Kt))for(const qt of Kt){const zt=this.createPutIndexedItemOperation(e,kt,jt,qt);Bt.push(zt)}else{const qt=this.createPutIndexedItemOperation(e,kt,jt,Kt);Bt.push(qt)}}const Nt=this.createOperationForIndexesLookupPartition(e,{type:"put",key:_t,value:JSON.stringify(At)});Bt.push(Nt);const Ut=yield Promise.all(Bt);yield(yield this.db.partition(e)).batch(Ut,xt)})}delete(e,_t,At){return __awaiter$1r(this,void 0,void 0,function*(){const xt=[],kt=yield this.getIndexes(e,_t);if(kt===void 0)return;const Bt=this.createOperationForIndexesLookupPartition(e,{type:"del",key:_t});xt.push(Bt);for(const Lt in kt){const jt=kt[Lt];if(Array.isArray(jt))for(const Kt of jt){const qt=this.createDeleteIndexedItemOperation(e,_t,Lt,Kt);xt.push(qt)}else{const Kt=this.createDeleteIndexedItemOperation(e,_t,Lt,jt);xt.push(Kt)}}const Nt=yield Promise.all(xt);yield(yield this.db.partition(e)).batch(Nt,At)})}createPutIndexedItemOperation(e,_t,At,xt){return __awaiter$1r(this,void 0,void 0,function*(){const{messageCid:kt}=_t,Bt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(xt),kt);return this.createOperationForIndexPartition(e,At,{type:"put",key:Bt,value:JSON.stringify(_t)})})}createDeleteIndexedItemOperation(e,_t,At,xt){return __awaiter$1r(this,void 0,void 0,function*(){const kt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(xt),_t);return this.createOperationForIndexPartition(e,At,{type:"del",key:kt})})}createOperationForIndexPartition(e,_t,At){return __awaiter$1r(this,void 0,void 0,function*(){const xt=yield this.db.partition(e),kt=IndexLevel.getIndexPartitionName(_t);return xt.createPartitionOperation(kt,At)})}createOperationForIndexesLookupPartition(e,_t){return __awaiter$1r(this,void 0,void 0,function*(){return(yield this.db.partition(e)).createPartitionOperation(INDEX_SUBLEVEL_NAME,_t)})}static getIndexPartitionName(e){return`__${e}__`}getIndexPartition(e,_t){return __awaiter$1r(this,void 0,void 0,function*(){const At=IndexLevel.getIndexPartitionName(_t);return(yield this.db.partition(e)).partition(At)})}getIndexesLookupPartition(e){return __awaiter$1r(this,void 0,void 0,function*(){return(yield this.db.partition(e)).partition(INDEX_SUBLEVEL_NAME)})}query(e,_t,At,xt){return __awaiter$1r(this,void 0,void 0,function*(){return IndexLevel.shouldQueryWithInMemoryPaging(_t,At)?this.queryWithInMemoryPaging(e,_t,At,xt):this.queryWithIteratorPaging(e,_t,At,xt)})}queryWithIteratorPaging(e,_t,At,xt){var kt,Bt,Nt,Ut;return __awaiter$1r(this,void 0,void 0,function*(){const{cursor:Lt,limit:jt}=At,Kt=Lt?this.createStartingKeyFromCursor(Lt):"",qt=[];try{for(var zt=!0,Vt=__asyncValues$2(this.getIndexIterator(e,Kt,At,xt)),Ht;Ht=yield Vt.next(),kt=Ht.done,!kt;zt=!0){Ut=Ht.value,zt=!1;const Wt=Ut;if(jt!==void 0&&jt===qt.length)break;const{indexes:Qt}=Wt;FilterUtility.matchAnyFilter(Qt,_t)&&qt.push(Wt)}}catch(Wt){Bt={error:Wt}}finally{try{!zt&&!kt&&(Nt=Vt.return)&&(yield Nt.call(Vt))}finally{if(Bt)throw Bt.error}}return qt})}getIndexIterator(e,_t,At,xt){return __asyncGenerator(this,arguments,function*(){var Bt,Nt,Ut,Lt;const{sortProperty:jt,sortDirection:Kt=SortDirection.Ascending,cursor:qt}=At,zt={gt:_t};Kt===SortDirection.Descending&&(zt.reverse=!0,qt!==void 0&&(zt.lt=_t,delete zt.gt));const Vt=yield __await(this.getIndexPartition(e,jt));try{for(var Ht=!0,Wt=__asyncValues$2(Vt.iterator(zt,xt)),Qt;Qt=yield __await(Wt.next()),Bt=Qt.done,!Bt;Ht=!0){Lt=Qt.value,Ht=!1;const[Xt,Jt]=Lt,{indexes:tr,messageCid:dr}=JSON.parse(Jt);yield yield __await({indexes:tr,messageCid:dr})}}catch(Xt){Nt={error:Xt}}finally{try{!Ht&&!Bt&&(Ut=Wt.return)&&(yield __await(Ut.call(Wt)))}finally{if(Nt)throw Nt.error}}})}createStartingKeyFromCursor(e){const{messageCid:_t,value:At}=e;return IndexLevel.keySegmentJoin(IndexLevel.encodeValue(At),_t)}static createCursorFromLastArrayItem(e,_t){if(e.length>0)return this.createCursorFromItem(e.at(-1),_t)}static createCursorFromItem(e,_t){const{messageCid:At,indexes:xt}=e,kt=xt[_t];if(kt===void 0)throw new DwnError(DwnErrorCode.IndexInvalidCursorSortProperty,`the sort property '${_t}' is not defined within the given item.`);if(typeof kt=="boolean"||Array.isArray(kt))throw new DwnError(DwnErrorCode.IndexInvalidCursorValueType,`only string or number values are supported for cursors, a(n) ${typeof kt} was given.`);return{messageCid:At,value:kt}}queryWithInMemoryPaging(e,_t,At,xt){return __awaiter$1r(this,void 0,void 0,function*(){const{sortProperty:kt,sortDirection:Bt=SortDirection.Ascending,cursor:Nt,limit:Ut}=At,Lt=Nt?this.createStartingKeyFromCursor(Nt):void 0,jt=new Map;_t.length===0&&(_t=[{}]);try{yield Promise.all(_t.map(Vt=>this.executeSingleFilterQuery(e,Vt,kt,jt,xt)))}catch(Vt){if(Vt.code===DwnErrorCode.IndexInvalidSortPropertyInMemory)return[]}const Kt=[...jt.values()].sort((Vt,Ht)=>this.sortItems(Vt,Ht,kt,Bt)),qt=Lt!==void 0?this.findCursorStartingIndex(Kt,Bt,kt,Lt):0;if(qt<0)return[];const zt=Ut!==void 0?qt+Ut:void 0;return Kt.slice(qt,zt)})}executeSingleFilterQuery(e,_t,At,xt,kt){return __awaiter$1r(this,void 0,void 0,function*(){const Bt=[];if(isEmptyObject$1(_t)){const Ut=this.getAllItems(e,At);Bt.push(Ut)}const Nt=FilterSelector.reduceFilter(_t);for(const Ut in Nt){const Lt=Nt[Ut];if(FilterUtility.isEqualFilter(Lt)){const jt=this.filterExactMatches(e,Ut,Lt,kt);Bt.push(jt)}else if(FilterUtility.isOneOfFilter(Lt))for(const jt of new Set(Lt)){const Kt=this.filterExactMatches(e,Ut,jt,kt);Bt.push(Kt)}else if(FilterUtility.isRangeFilter(Lt)){const jt=this.filterRangeMatches(e,Ut,Lt,kt);Bt.push(jt)}}for(const Ut of Bt){const Lt=yield Ut;for(const jt of Lt)if(!(xt.has(jt.messageCid)||!FilterUtility.matchFilter(jt.indexes,_t))){if(jt.indexes[At]===void 0)throw new DwnError(DwnErrorCode.IndexInvalidSortPropertyInMemory,`invalid sort property ${At}`);xt.set(jt.messageCid,jt)}}})}getAllItems(e,_t){var At,xt,kt,Bt;return __awaiter$1r(this,void 0,void 0,function*(){const Nt=yield this.getIndexPartition(e,_t),Ut=[];try{for(var Lt=!0,jt=__asyncValues$2(Nt.iterator()),Kt;Kt=yield jt.next(),At=Kt.done,!At;Lt=!0){Bt=Kt.value,Lt=!1;const[qt,zt]=Bt;Ut.push(JSON.parse(zt))}}catch(qt){xt={error:qt}}finally{try{!Lt&&!At&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(xt)throw xt.error}}return Ut})}filterExactMatches(e,_t,At,xt){var kt,Bt,Nt,Ut;return __awaiter$1r(this,void 0,void 0,function*(){const Lt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(At)),jt={gt:Lt},Kt=yield this.getIndexPartition(e,_t),qt=[];try{for(var zt=!0,Vt=__asyncValues$2(Kt.iterator(jt,xt)),Ht;Ht=yield Vt.next(),kt=Ht.done,!kt;zt=!0){Ut=Ht.value,zt=!1;const[Wt,Qt]=Ut;if(!Wt.startsWith(Lt))break;qt.push(JSON.parse(Qt))}}catch(Wt){Bt={error:Wt}}finally{try{!zt&&!kt&&(Nt=Vt.return)&&(yield Nt.call(Vt))}finally{if(Bt)throw Bt.error}}return qt})}filterRangeMatches(e,_t,At,xt){var kt,Bt,Nt,Ut;return __awaiter$1r(this,void 0,void 0,function*(){const Lt={};for(const Ht in At){const Wt=Ht;Lt[Wt]=IndexLevel.encodeValue(At[Wt])}Lt.gt===void 0&&Lt.gte===void 0&&(Lt.reverse=!0);const jt=[],Kt=yield this.getIndexPartition(e,_t);try{for(var qt=!0,zt=__asyncValues$2(Kt.iterator(Lt,xt)),Vt;Vt=yield zt.next(),kt=Vt.done,!kt;qt=!0){Ut=Vt.value,qt=!1;const[Ht,Wt]=Ut;"gt"in At&&this.extractIndexValueFromKey(Ht)===IndexLevel.encodeValue(At.gt)||jt.push(JSON.parse(Wt))}}catch(Ht){Bt={error:Ht}}finally{try{!qt&&!kt&&(Nt=zt.return)&&(yield Nt.call(zt))}finally{if(Bt)throw Bt.error}}if("lte"in At)for(const Ht of yield this.filterExactMatches(e,_t,At.lte,xt))jt.push(Ht);return jt})}sortItems(e,_t,At,xt){const kt=e.indexes[At],Bt=_t.indexes[At],Nt=IndexLevel.encodeValue(kt)+e.messageCid,Ut=IndexLevel.encodeValue(Bt)+_t.messageCid;return xt===SortDirection.Ascending?lexicographicalCompare(Nt,Ut):lexicographicalCompare(Ut,Nt)}findCursorStartingIndex(e,_t,At,xt){const kt=Bt=>{const{messageCid:Nt,indexes:Ut}=Bt,Lt=Ut[At],jt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(Lt),Nt);return _t===SortDirection.Ascending?jt>xt:jt<xt};return e.findIndex(kt)}getIndexes(e,_t){return __awaiter$1r(this,void 0,void 0,function*(){const xt=yield(yield this.getIndexesLookupPartition(e)).get(_t);if(xt!==void 0)return JSON.parse(xt)})}extractIndexValueFromKey(e){const[_t]=e.split(IndexLevel.delimiter);return _t}static keySegmentJoin(...e){return e.join(IndexLevel.delimiter)}static encodeNumberValue(e){const _t=Number.MAX_SAFE_INTEGER,At="!",xt=String(Number.MAX_SAFE_INTEGER).length,kt=e<0?At:"",Bt=e<0?_t:0;return kt+String(e+Bt).padStart(xt,"0")}static encodeValue(e){switch(typeof e){case"number":return this.encodeNumberValue(e);default:return JSON.stringify(e)}}static shouldQueryWithInMemoryPaging(e,_t){for(const At of e)if(!IndexLevel.isFilterConcise(At,_t))return!1;return!0}static isFilterConcise(e,_t){return e.recordId!==void 0?!0:_t.cursor!==void 0?!1:e.protocolPath!==void 0||e.contextId!==void 0||e.parentId!==void 0||e.schema!==void 0}}IndexLevel.delimiter="\0";function assertError($t){if(!isError($t))throw new Error("Parameter was not an error")}function isError($t){return objectToString($t)==="[object Error]"||$t instanceof Error}function objectToString($t){return Object.prototype.toString.call($t)}function parseArguments($t){let e,_t="";if($t.length===0)e={};else if(isError($t[0]))e={cause:$t[0]},_t=$t.slice(1).join(" ")||"";else if($t[0]&&typeof $t[0]=="object")e=Object.assign({},$t[0]),_t=$t.slice(1).join(" ")||"";else if(typeof $t[0]=="string")e={},_t=_t=$t.join(" ")||"";else throw new Error("Invalid arguments passed to Layerr");return{options:e,shortMessage:_t}}class Layerr extends Error{constructor(e,_t){const At=[...arguments],{options:xt,shortMessage:kt}=parseArguments(At);let Bt=kt;if(xt.cause&&(Bt=`${Bt}: ${xt.cause.message}`),super(Bt),this.message=Bt,xt.name&&typeof xt.name=="string"?this.name=xt.name:this.name="Layerr",xt.cause&&Object.defineProperty(this,"_cause",{value:xt.cause}),Object.defineProperty(this,"_info",{value:{}}),xt.info&&typeof xt.info=="object"&&Object.assign(this._info,xt.info),Error.captureStackTrace){const Nt=xt.constructorOpt||this.constructor;Error.captureStackTrace(this,Nt)}}static cause(e){return assertError(e),e._cause&&isError(e._cause)?e._cause:null}static fullStack(e){assertError(e);const _t=Layerr.cause(e);return _t?`${e.stack}
caused by: ${Layerr.fullStack(_t)}`:e.stack}static info(e){assertError(e);const _t={},At=Layerr.cause(e);return At&&Object.assign(_t,Layerr.info(At)),e._info&&Object.assign(_t,e._info),_t}cause(){return Layerr.cause(this)}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}const ENCODING="0123456789ABCDEFGHJKMNPQRSTVWXYZ",ENCODING_LEN=32,TIME_MAX=0xffffffffffff,TIME_LEN=10,RANDOM_LEN=16,ERROR_INFO=Object.freeze({source:"ulid"});function detectPRNG($t){const e=detectRoot(),_t=e&&(e.crypto||e.msCrypto)||null;if(typeof(_t==null?void 0:_t.getRandomValues)=="function")return()=>{const At=new Uint8Array(1);return _t.getRandomValues(At),At[0]/255};if(typeof(_t==null?void 0:_t.randomBytes)=="function")return()=>_t.randomBytes(1).readUInt8()/255;throw new Layerr({info:{code:"PRNG_DETECT",...ERROR_INFO}},"Failed to find a reliable PRNG")}function detectRoot(){return inWebWorker()?self:typeof window<"u"?window:typeof globalThis<"u"||typeof globalThis<"u"?globalThis:null}function encodeRandom($t,e){let _t="";for(;$t>0;$t--)_t=randomChar(e)+_t;return _t}function encodeTime($t,e){if(isNaN($t))throw new Layerr({info:{code:"ENC_TIME_NAN",...ERROR_INFO}},`Time must be a number: ${$t}`);if($t>TIME_MAX)throw new Layerr({info:{code:"ENC_TIME_SIZE_EXCEED",...ERROR_INFO}},`Cannot encode a time larger than ${TIME_MAX}: ${$t}`);if($t<0)throw new Layerr({info:{code:"ENC_TIME_NEG",...ERROR_INFO}},`Time must be positive: ${$t}`);if(Number.isInteger($t)===!1)throw new Layerr({info:{code:"ENC_TIME_TYPE",...ERROR_INFO}},`Time must be an integer: ${$t}`);let _t,At="";for(let xt=e;xt>0;xt--)_t=$t%ENCODING_LEN,At=ENCODING.charAt(_t)+At,$t=($t-_t)/ENCODING_LEN;return At}function incrementBase32($t){let e,_t=$t.length,At,xt,kt=$t;const Bt=ENCODING_LEN-1;for(;!e&&_t-->=0;){if(At=kt[_t],xt=ENCODING.indexOf(At),xt===-1)throw new Layerr({info:{code:"B32_INC_ENC",...ERROR_INFO}},"Incorrectly encoded string");if(xt===Bt){kt=replaceCharAt(kt,_t,ENCODING[0]);continue}e=replaceCharAt(kt,_t,ENCODING[xt+1])}if(typeof e=="string")return e;throw new Layerr({info:{code:"B32_INC_INVALID",...ERROR_INFO}},"Failed incrementing string")}function inWebWorker(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function monotonicFactory($t){const e=detectPRNG();let _t=0,At;return function(kt){const Bt=isNaN(kt)?Date.now():kt;if(Bt<=_t){const Ut=At=incrementBase32(At);return encodeTime(_t,TIME_LEN)+Ut}_t=Bt;const Nt=At=encodeRandom(RANDOM_LEN,e);return encodeTime(Bt,TIME_LEN)+Nt}}function randomChar($t){let e=Math.floor($t()*ENCODING_LEN);return e===ENCODING_LEN&&(e=ENCODING_LEN-1),ENCODING.charAt(e)}function replaceCharAt($t,e,_t){return e>$t.length-1?$t:$t.substr(0,e)+_t+$t.substr(e+1)}var __awaiter$1q=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class EventLogLevel{constructor(e){this.index=new IndexLevel(Object.assign({location:"EVENTLOG",createLevelDatabase},e)),this.ulidFactory=monotonicFactory()}open(){return __awaiter$1q(this,void 0,void 0,function*(){return this.index.open()})}close(){return __awaiter$1q(this,void 0,void 0,function*(){return this.index.close()})}clear(){return __awaiter$1q(this,void 0,void 0,function*(){return this.index.clear()})}append(e,_t,At){return __awaiter$1q(this,void 0,void 0,function*(){const xt=this.ulidFactory();yield this.index.put(e,_t,Object.assign(Object.assign({},At),{watermark:xt}))})}queryEvents(e,_t,At){return __awaiter$1q(this,void 0,void 0,function*(){const xt=yield this.index.query(e,_t,{sortProperty:"watermark",cursor:At});return{events:xt.map(({messageCid:kt})=>kt),cursor:IndexLevel.createCursorFromLastArrayItem(xt,"watermark")}})}getEvents(e,_t){return __awaiter$1q(this,void 0,void 0,function*(){return this.queryEvents(e,[],_t)})}deleteEventsByCid(e,_t){return __awaiter$1q(this,void 0,void 0,function*(){const At=[];for(const xt of _t)At.push(this.index.delete(e,xt));yield Promise.all(At)})}}function readonly({enumerable:$t=!0,configurable:e=!1}={}){return{enumerable:$t,configurable:e,writable:!1}}function*linksWithin($t,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[_t,At]of e.entries()){const xt=[...$t,_t],kt=CID.asCID(At);kt?yield[xt.join("/"),kt]:typeof At=="object"&&(yield*links(At,xt))}else{const _t=CID.asCID(e);_t?yield[$t.join("/"),_t]:yield*links(e,$t)}}function*links($t,e){if($t==null||$t instanceof Uint8Array)return;const _t=CID.asCID($t);_t&&(yield[e.join("/"),_t]);for(const[At,xt]of Object.entries($t)){const kt=[...e,At];yield*linksWithin(kt,xt)}}function*treeWithin($t,e){if(Array.isArray(e))for(const[_t,At]of e.entries()){const xt=[...$t,_t];yield xt.join("/"),typeof At=="object"&&!CID.asCID(At)&&(yield*tree(At,xt))}else yield*tree(e,$t)}function*tree($t,e){if(!($t==null||typeof $t!="object"))for(const[_t,At]of Object.entries($t)){const xt=[...e,_t];yield xt.join("/"),At!=null&&!(At instanceof Uint8Array)&&typeof At=="object"&&!CID.asCID(At)&&(yield*treeWithin(xt,At))}}function get($t,e){let _t=$t;for(const[At,xt]of e.entries()){if(_t=_t[xt],_t==null)throw new Error(`Object has no property at ${e.slice(0,At+1).map(Bt=>`[${JSON.stringify(Bt)}]`).join("")}`);const kt=CID.asCID(_t);if(kt)return{value:kt,remaining:e.slice(At+1).join("/")}}return{value:_t}}class Block{constructor({cid:e,bytes:_t,value:At}){if(!e||!_t||typeof At>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=_t,this.value=At,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return get(this.value,e.split("/").filter(Boolean))}}async function encode({value:$t,codec:e,hasher:_t}){if(typeof $t>"u")throw new Error('Missing required argument "value"');if(!e||!_t)throw new Error("Missing required argument: codec or hasher");const At=e.encode($t),xt=await _t.digest(At),kt=CID.create(1,e.code,xt);return new Block({value:$t,bytes:At,cid:kt})}async function decode({bytes:$t,codec:e,hasher:_t}){if(!$t)throw new Error('Missing required argument "bytes"');if(!e||!_t)throw new Error("Missing required argument: codec or hasher");const At=e.decode($t),xt=await _t.digest($t),kt=CID.create(1,e.code,xt);return new Block({value:At,bytes:$t,cid:kt})}var __awaiter$1p=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class MessageStoreLevel{constructor(e={}){this.config=Object.assign({blockstoreLocation:"MESSAGESTORE",indexLocation:"INDEX",createLevelDatabase},e),this.blockstore=new BlockstoreLevel({location:this.config.blockstoreLocation,createLevelDatabase:this.config.createLevelDatabase}),this.index=new IndexLevel({location:this.config.indexLocation,createLevelDatabase:this.config.createLevelDatabase})}open(){return __awaiter$1p(this,void 0,void 0,function*(){yield this.blockstore.open(),yield this.index.open()})}close(){return __awaiter$1p(this,void 0,void 0,function*(){yield this.blockstore.close(),yield this.index.close()})}get(e,_t,At){var xt;return __awaiter$1p(this,void 0,void 0,function*(){(xt=At==null?void 0:At.signal)===null||xt===void 0||xt.throwIfAborted();const kt=yield executeUnlessAborted(this.blockstore.partition(e),At==null?void 0:At.signal),Bt=CID.parse(_t),Nt=yield kt.get(Bt,At);return Nt?(yield executeUnlessAborted(decode({bytes:Nt,codec:cbor,hasher:sha256$7}),At==null?void 0:At.signal)).value:void 0})}query(e,_t,At,xt,kt){var Bt;return __awaiter$1p(this,void 0,void 0,function*(){(Bt=kt==null?void 0:kt.signal)===null||Bt===void 0||Bt.throwIfAborted();const Nt=MessageStoreLevel.buildQueryOptions(At,xt),Ut=yield this.index.query(e,_t,Nt,kt);let Lt;(xt==null?void 0:xt.limit)!==void 0&&xt.limit<Ut.length&&(Ut.splice(-1),Lt=IndexLevel.createCursorFromLastArrayItem(Ut,Nt.sortProperty));const jt=[];for(let Kt=0;Kt<Ut.length;Kt++){const{messageCid:qt}=Ut[Kt],zt=yield this.get(e,qt,kt);zt&&jt.push(zt)}return{messages:jt,cursor:Lt}})}static buildQueryOptions(e={},_t={}){let{limit:At,cursor:xt}=_t;const{dateCreated:kt,datePublished:Bt,messageTimestamp:Nt}=e;let Ut=SortDirection.Ascending,Lt="messageTimestamp";return kt!==void 0?Lt="dateCreated":Bt!==void 0?Lt="datePublished":Nt!==void 0&&(Lt="messageTimestamp"),e[Lt]!==void 0&&(Ut=e[Lt]),At!==void 0&&At>0&&(At=At+1),{sortDirection:Ut,sortProperty:Lt,limit:At,cursor:xt}}delete(e,_t,At){var xt;return __awaiter$1p(this,void 0,void 0,function*(){(xt=At==null?void 0:At.signal)===null||xt===void 0||xt.throwIfAborted();const kt=yield executeUnlessAborted(this.blockstore.partition(e),At==null?void 0:At.signal),Bt=CID.parse(_t);yield kt.delete(Bt,At),yield this.index.delete(e,_t,At)})}put(e,_t,At,xt){var kt;return __awaiter$1p(this,void 0,void 0,function*(){(kt=xt==null?void 0:xt.signal)===null||kt===void 0||kt.throwIfAborted();const Bt=yield executeUnlessAborted(this.blockstore.partition(e),xt==null?void 0:xt.signal),Nt=yield executeUnlessAborted(encode({value:_t,codec:cbor,hasher:sha256$7}),xt==null?void 0:xt.signal),Ut=Cid.parseCid(yield Message.getCid(_t));yield Bt.put(Ut,Nt.bytes,xt);const Lt=Ut.toString();yield this.index.put(e,Lt,At,xt)})}clear(){return __awaiter$1p(this,void 0,void 0,function*(){yield this.blockstore.clear(),yield this.index.clear()})}}var __awaiter$1o=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues$1=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}};class ResumableTaskStoreLevel{constructor(e){this.config=Object.assign({location:"RESUMABLE-TASK-STORE",createLevelDatabase},e),this.db=new LevelWrapper({location:this.config.location,createLevelDatabase:this.config.createLevelDatabase,keyEncoding:"utf8"})}open(){return __awaiter$1o(this,void 0,void 0,function*(){yield this.db.open()})}close(){return __awaiter$1o(this,void 0,void 0,function*(){yield this.db.close()})}register(e,_t){return __awaiter$1o(this,void 0,void 0,function*(){const At=yield Cid.computeCid(e),xt={id:At,timeout:Date.now()+_t*1e3,retryCount:0,task:e};return yield this.db.put(At,JSON.stringify(xt)),xt})}grab(e){var _t,At,xt,kt;return __awaiter$1o(this,void 0,void 0,function*(){const Bt=[];try{for(var Nt=!0,Ut=__asyncValues$1(this.db.iterator()),Lt;Lt=yield Ut.next(),_t=Lt.done,!_t;Nt=!0){kt=Lt.value,Nt=!1;const[jt,Kt]=kt,qt=JSON.parse(Kt);if(Date.now()>=qt.timeout&&(qt.timeout=Date.now()+ResumableTaskStoreLevel.taskTimeoutInSeconds*1e3,qt.retryCount++,yield this.db.put(qt.id,JSON.stringify(qt)),Bt.push(qt)),Bt.length>=e)break}}catch(jt){At={error:jt}}finally{try{!Nt&&!_t&&(xt=Ut.return)&&(yield xt.call(Ut))}finally{if(At)throw At.error}}return Bt})}read(e){return __awaiter$1o(this,void 0,void 0,function*(){const _t=yield this.db.get(e);if(_t)return JSON.parse(_t)})}extend(e,_t){return __awaiter$1o(this,void 0,void 0,function*(){const At=yield this.db.get(e);if(At){const xt=JSON.parse(At);xt.timeout=Date.now()+_t*1e3,yield this.db.put(xt.id,JSON.stringify(xt))}})}delete(e){return __awaiter$1o(this,void 0,void 0,function*(){return this.db.delete(e)})}clear(){return __awaiter$1o(this,void 0,void 0,function*(){yield this.db.clear()})}}ResumableTaskStoreLevel.taskTimeoutInSeconds=60;var DwnInterface;(function($t){$t.MessagesQuery="MessagesQuery",$t.MessagesRead="MessagesRead",$t.MessagesSubscribe="MessagesSubscribe",$t.ProtocolsConfigure="ProtocolsConfigure",$t.ProtocolsQuery="ProtocolsQuery",$t.RecordsDelete="RecordsDelete",$t.RecordsQuery="RecordsQuery",$t.RecordsRead="RecordsRead",$t.RecordsSubscribe="RecordsSubscribe",$t.RecordsWrite="RecordsWrite"})(DwnInterface||(DwnInterface={}));const dwnMessageConstructors={[DwnInterface.MessagesQuery]:MessagesQuery,[DwnInterface.MessagesRead]:MessagesRead,[DwnInterface.MessagesSubscribe]:MessagesSubscribe,[DwnInterface.ProtocolsConfigure]:ProtocolsConfigure,[DwnInterface.ProtocolsQuery]:ProtocolsQuery,[DwnInterface.RecordsDelete]:RecordsDelete,[DwnInterface.RecordsQuery]:RecordsQuery,[DwnInterface.RecordsRead]:RecordsRead,[DwnInterface.RecordsSubscribe]:RecordsSubscribe,[DwnInterface.RecordsWrite]:RecordsWrite};var DidVerificationRelationship$1;(function($t){$t.authentication="authentication",$t.assertionMethod="assertionMethod",$t.keyAgreement="keyAgreement",$t.capabilityInvocation="capabilityInvocation",$t.capabilityDelegation="capabilityDelegation"})(DidVerificationRelationship$1||(DidVerificationRelationship$1={}));const EMPTY_DID_RESOLUTION_RESULT$1={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};let Did$1=class Wo{constructor({method:e,id:_t,path:At,query:xt,fragment:kt,params:Bt}){this.uri=`did:${e}:${_t}`,this.method=e,this.id=_t,this.path=At,this.query=xt,this.fragment=kt,this.params=Bt}static parse(e){if(!e)return null;const _t=Wo.DID_URI_PATTERN.exec(e);if(!_t||!_t.groups)return null;const{method:At,id:xt,path:kt,query:Bt,fragment:Nt}=_t.groups,Ut={uri:`did:${At}:${xt}`,method:At,id:xt};if(kt&&(Ut.path=kt),Bt&&(Ut.query=Bt.slice(1)),Nt&&(Ut.fragment=Nt.slice(1)),Bt){const Lt={},jt=Bt.slice(1).split("&");for(const Kt of jt){const[qt,zt]=Kt.split("=");Lt[qt]=zt}Ut.params=Lt}return Ut}};Did$1.METHOD_PATTERN="([a-z0-9]+)";Did$1.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Did$1.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Did$1.PCT_ENCODED_PATTERN})`;Did$1.METHOD_ID_PATTERN=`((?:${Did$1.ID_CHAR_PATTERN}*:)*(${Did$1.ID_CHAR_PATTERN}+))`;Did$1.PATH_PATTERN="(/[^#?]*)?";Did$1.QUERY_PATTERN="([?][^#]*)?";Did$1.FRAGMENT_PATTERN="(#.*)?";Did$1.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Did$1.METHOD_PATTERN}):(?<id>${Did$1.METHOD_ID_PATTERN})(?<path>${Did$1.PATH_PATTERN})(?<query>${Did$1.QUERY_PATTERN})(?<fragment>${Did$1.FRAGMENT_PATTERN})$`);let DidError$1=class Jo extends Error{constructor(e,_t){super(`${e}: ${_t}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jo)}};var DidErrorCode$1;(function($t){$t.InvalidDid="invalidDid",$t.MethodNotSupported="methodNotSupported",$t.InternalError="internalError",$t.InvalidDidDocument="invalidDidDocument",$t.InvalidDidDocumentLength="invalidDidDocumentLength",$t.InvalidDidUrl="invalidDidUrl",$t.InvalidPreviousDidProof="invalidPreviousDidProof",$t.InvalidPublicKey="invalidPublicKey",$t.InvalidPublicKeyLength="invalidPublicKeyLength",$t.InvalidPublicKeyType="invalidPublicKeyType",$t.InvalidSignature="invalidSignature",$t.NotFound="notFound",$t.RepresentationNotSupported="representationNotSupported",$t.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(DidErrorCode$1||(DidErrorCode$1={}));var __awaiter$1n=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let Sha256$1=class{static digest(e){return __awaiter$1n(this,arguments,void 0,function*({data:_t}){return sha256$5(_t)})}},CryptoAlgorithm$1=class{};var __awaiter$1m=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let Sha2Algorithm$1=class extends CryptoAlgorithm$1{digest(e){return __awaiter$1m(this,arguments,void 0,function*({algorithm:_t,data:At}){switch(_t){case"SHA-256":return yield Sha256$1.digest({data:At})}})}};function canonicalize$1($t){const e=At=>{if(At!==null&&typeof At=="object"&&!Array.isArray(At)){const xt=Object.keys(At).sort(),kt={};for(const Bt of xt)kt[Bt]=e(At[Bt]);return kt}return At},_t=e($t);return JSON.stringify(_t)}var __awaiter$1l=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const KEY_URI_PREFIX_JWK$1="urn:jwk:";function computeJwkThumbprint$1($t){return __awaiter$1l(this,arguments,void 0,function*({jwk:e}){const _t=e.kty;let At;if(_t==="EC")At={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(_t==="oct")At={k:e.k,kty:e.kty};else if(_t==="OKP")At={crv:e.crv,kty:e.kty,x:e.x};else if(_t==="RSA")At={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${_t}`);removeUndefinedProperties$1(At);const xt=canonicalize$1(At),kt=Convert$1.string(xt).toUint8Array(),Bt=yield Sha256$1.digest({data:kt});return Convert$1.uint8Array(Bt).toBase64Url()})}function isEcPrivateJwk$1($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t&&"d"in $t)||$t.kty!=="EC"||typeof $t.d!="string"||typeof $t.x!="string")}function isEcPublicJwk$1($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t)||"d"in $t||$t.kty!=="EC"||typeof $t.x!="string")}function isOctPrivateJwk($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"k"in $t)||$t.kty!=="oct"||typeof $t.k!="string")}function isOkpPrivateJwk$1($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t&&"d"in $t)||$t.kty!=="OKP"||typeof $t.d!="string"||typeof $t.x!="string")}function isOkpPublicJwk$1($t){return!(!$t||typeof $t!="object"||"d"in $t||!("kty"in $t&&"crv"in $t&&"x"in $t)||$t.kty!=="OKP"||typeof $t.x!="string")}function isPrivateJwk$1($t){if(!$t||typeof $t!="object")return!1;switch($t.kty){case"EC":case"OKP":case"RSA":return"d"in $t;case"oct":return"k"in $t;default:return!1}}var __awaiter$1k=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$o=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Secp256k1$1=class Ai{static adjustSignatureToLowS(e){return __awaiter$1k(this,arguments,void 0,function*({signature:_t}){const At=secp256k1.Signature.fromCompact(_t);return At.hasHighS()?At.normalizeS().toCompactRawBytes():_t})}static bytesToPrivateKey(e){return __awaiter$1k(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=yield Ai.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"secp256k1",d:Convert$1.uint8Array(_t).toBase64Url(),x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$1({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1k(this,arguments,void 0,function*({publicKeyBytes:_t}){const At=yield Ai.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"secp256k1",x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$1({jwk:xt}),xt})}static compressPublicKey(e){return __awaiter$1k(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256k1.ProjectivePoint.fromHex(_t).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$1k(this,arguments,void 0,function*({key:_t}){const At=yield Ai.privateKeyToBytes({privateKey:_t}),xt=yield Ai.getCurvePoint({keyBytes:At}),kt={kty:"EC",crv:"secp256k1",x:Convert$1.uint8Array(xt.x).toBase64Url(),y:Convert$1.uint8Array(xt.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static convertDerToCompactSignature(e){return __awaiter$1k(this,arguments,void 0,function*({derSignature:_t}){return secp256k1.Signature.fromDER(_t).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$1k(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256k1.ProjectivePoint.fromHex(_t).toRawBytes(!1)})}static generateKey(){return __awaiter$1k(this,void 0,void 0,function*(){const e=secp256k1.utils.randomPrivateKey(),_t=yield Ai.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$1({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1k(this,arguments,void 0,function*({key:_t}){var At;if(!(isEcPrivateJwk$1(_t)&&_t.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let xt=__rest$o(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$1({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1k(this,arguments,void 0,function*({privateKey:_t}){if(!isEcPrivateJwk$1(_t))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1k(this,arguments,void 0,function*({publicKey:_t}){if(!(isEcPublicJwk$1(_t)&&_t.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const At=new Uint8Array([4]),xt=Convert$1.base64Url(_t.x).toUint8Array(),kt=Convert$1.base64Url(_t.y).toUint8Array();return new Uint8Array([...At,...xt,...kt])})}static sharedSecret(e){return __awaiter$1k(this,arguments,void 0,function*({privateKeyA:_t,publicKeyB:At}){if("x"in _t&&"x"in At&&_t.x===At.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const xt=yield Ai.privateKeyToBytes({privateKey:_t}),kt=yield Ai.publicKeyToBytes({publicKey:At});return secp256k1.getSharedSecret(xt,kt,!0).slice(1)})}static sign(e){return __awaiter$1k(this,arguments,void 0,function*({data:_t,key:At}){const xt=yield Ai.privateKeyToBytes({privateKey:At}),kt=sha256$5(_t);return secp256k1.sign(kt,xt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$1k(this,arguments,void 0,function*({privateKeyBytes:_t}){return secp256k1.utils.isValidPrivateKey(_t)})}static validatePublicKey(e){return __awaiter$1k(this,arguments,void 0,function*({publicKeyBytes:_t}){try{secp256k1.ProjectivePoint.fromHex(_t).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1k(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=yield Ai.publicKeyToBytes({publicKey:_t}),Bt=sha256$5(xt);return secp256k1.verify(At,Bt,kt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$1k(this,arguments,void 0,function*({keyBytes:_t}){_t.byteLength===32&&(_t=secp256k1.getPublicKey(_t));const At=secp256k1.ProjectivePoint.fromHex(_t),xt=numberToBytesBE(At.x,32),kt=numberToBytesBE(At.y,32);return{x:xt,y:kt}})}};var __awaiter$1j=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$n=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Secp256r1$1=class Di{static adjustSignatureToLowS(e){return __awaiter$1j(this,arguments,void 0,function*({signature:_t}){const At=secp256r1.Signature.fromCompact(_t);return At.hasHighS()?At.normalizeS().toCompactRawBytes():_t})}static bytesToPrivateKey(e){return __awaiter$1j(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=yield Di.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"P-256",d:Convert$1.uint8Array(_t).toBase64Url(),x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$1({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1j(this,arguments,void 0,function*({publicKeyBytes:_t}){const At=yield Di.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"P-256",x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint$1({jwk:xt}),xt})}static compressPublicKey(e){return __awaiter$1j(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256r1.ProjectivePoint.fromHex(_t).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$1j(this,arguments,void 0,function*({key:_t}){const At=yield Di.privateKeyToBytes({privateKey:_t}),xt=yield Di.getCurvePoint({keyBytes:At}),kt={kty:"EC",crv:"P-256",x:Convert$1.uint8Array(xt.x).toBase64Url(),y:Convert$1.uint8Array(xt.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static convertDerToCompactSignature(e){return __awaiter$1j(this,arguments,void 0,function*({derSignature:_t}){return secp256r1.Signature.fromDER(_t).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$1j(this,arguments,void 0,function*({publicKeyBytes:_t}){return secp256r1.ProjectivePoint.fromHex(_t).toRawBytes(!1)})}static generateKey(){return __awaiter$1j(this,void 0,void 0,function*(){const e=secp256r1.utils.randomPrivateKey(),_t=yield Di.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$1({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1j(this,arguments,void 0,function*({key:_t}){var At;if(!(isEcPrivateJwk$1(_t)&&_t.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let xt=__rest$n(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$1({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1j(this,arguments,void 0,function*({privateKey:_t}){if(!isEcPrivateJwk$1(_t))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1j(this,arguments,void 0,function*({publicKey:_t}){if(!(isEcPublicJwk$1(_t)&&_t.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const At=new Uint8Array([4]),xt=Convert$1.base64Url(_t.x).toUint8Array(),kt=Convert$1.base64Url(_t.y).toUint8Array();return new Uint8Array([...At,...xt,...kt])})}static sharedSecret(e){return __awaiter$1j(this,arguments,void 0,function*({privateKeyA:_t,publicKeyB:At}){if("x"in _t&&"x"in At&&_t.x===At.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const xt=yield Di.privateKeyToBytes({privateKey:_t}),kt=yield Di.publicKeyToBytes({publicKey:At});return secp256r1.getSharedSecret(xt,kt,!0).slice(1)})}static sign(e){return __awaiter$1j(this,arguments,void 0,function*({data:_t,key:At}){const xt=yield Di.privateKeyToBytes({privateKey:At}),kt=sha256$5(_t);return secp256r1.sign(kt,xt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$1j(this,arguments,void 0,function*({privateKeyBytes:_t}){return secp256r1.utils.isValidPrivateKey(_t)})}static validatePublicKey(e){return __awaiter$1j(this,arguments,void 0,function*({publicKeyBytes:_t}){try{secp256r1.ProjectivePoint.fromHex(_t).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1j(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=yield Di.publicKeyToBytes({publicKey:_t}),Bt=sha256$5(xt);return secp256r1.verify(At,Bt,kt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$1j(this,arguments,void 0,function*({keyBytes:_t}){_t.byteLength===32&&(_t=secp256r1.getPublicKey(_t));const At=secp256r1.ProjectivePoint.fromHex(_t),xt=numberToBytesBE(At.x,32),kt=numberToBytesBE(At.y,32);return{x:xt,y:kt}})}};var __awaiter$1i=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let EcdsaAlgorithm$2=class extends CryptoAlgorithm$1{computePublicKey(e){return __awaiter$1i(this,arguments,void 0,function*({key:_t}){if(!isEcPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(_t.crv){case"secp256k1":{const At=yield Secp256k1$1.computePublicKey({key:_t});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$1.computePublicKey({key:_t});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}generateKey(e){return __awaiter$1i(this,arguments,void 0,function*({algorithm:_t}){switch(_t){case"ES256K":case"secp256k1":{const At=yield Secp256k1$1.generateKey();return At.alg="ES256K",At}case"ES256":case"secp256r1":{const At=yield Secp256r1$1.generateKey();return At.alg="ES256",At}}})}getPublicKey(e){return __awaiter$1i(this,arguments,void 0,function*({key:_t}){if(!isEcPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(_t.crv){case"secp256k1":{const At=yield Secp256k1$1.getPublicKey({key:_t});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$1.getPublicKey({key:_t});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}sign(e){return __awaiter$1i(this,arguments,void 0,function*({key:_t,data:At}){if(!isEcPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(_t.crv){case"secp256k1":return yield Secp256k1$1.sign({key:_t,data:At});case"P-256":return yield Secp256r1$1.sign({key:_t,data:At});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}verify(e){return __awaiter$1i(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){if(!isEcPublicJwk$1(_t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(_t.crv){case"secp256k1":return yield Secp256k1$1.verify({key:_t,signature:At,data:xt});case"P-256":return yield Secp256r1$1.verify({key:_t,signature:At,data:xt});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}};var __awaiter$1h=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$m=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let Ed25519$1=class Gi{static bytesToPrivateKey(e){return __awaiter$1h(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=ed25519.getPublicKey(_t),xt={crv:"Ed25519",d:Convert$1.uint8Array(_t).toBase64Url(),kty:"OKP",x:Convert$1.uint8Array(At).toBase64Url()};return xt.kid=yield computeJwkThumbprint$1({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1h(this,arguments,void 0,function*({publicKeyBytes:_t}){const At={kty:"OKP",crv:"Ed25519",x:Convert$1.uint8Array(_t).toBase64Url()};return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static computePublicKey(e){return __awaiter$1h(this,arguments,void 0,function*({key:_t}){const At=yield Gi.privateKeyToBytes({privateKey:_t}),xt=ed25519.getPublicKey(At),kt={kty:"OKP",crv:"Ed25519",x:Convert$1.uint8Array(xt).toBase64Url()};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static convertPrivateKeyToX25519(e){return __awaiter$1h(this,arguments,void 0,function*({privateKey:_t}){const At=yield Gi.privateKeyToBytes({privateKey:_t}),xt=edwardsToMontgomeryPriv(At),kt=x25519.getPublicKey(xt),Bt={kty:"OKP",crv:"X25519",d:Convert$1.uint8Array(xt).toBase64Url(),x:Convert$1.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static convertPublicKeyToX25519(e){return __awaiter$1h(this,arguments,void 0,function*({publicKey:_t}){const At=yield Gi.publicKeyToBytes({publicKey:_t});if(!(yield Gi.validatePublicKey({publicKeyBytes:At})))throw new Error("Ed25519: Invalid public key.");const kt=edwardsToMontgomeryPub(At),Bt={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static generateKey(){return __awaiter$1h(this,void 0,void 0,function*(){const e=ed25519.utils.randomPrivateKey(),_t=yield Gi.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$1({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1h(this,arguments,void 0,function*({key:_t}){var At;if(!(isOkpPrivateJwk$1(_t)&&_t.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let xt=__rest$m(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$1({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1h(this,arguments,void 0,function*({privateKey:_t}){if(!isOkpPrivateJwk$1(_t))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1h(this,arguments,void 0,function*({publicKey:_t}){if(!isOkpPublicJwk$1(_t))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Convert$1.base64Url(_t.x).toUint8Array()})}static sign(e){return __awaiter$1h(this,arguments,void 0,function*({key:_t,data:At}){const xt=yield Gi.privateKeyToBytes({privateKey:_t});return ed25519.sign(At,xt)})}static validatePublicKey(e){return __awaiter$1h(this,arguments,void 0,function*({publicKeyBytes:_t}){try{ed25519.ExtendedPoint.fromHex(_t).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1h(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=yield Gi.publicKeyToBytes({publicKey:_t});return ed25519.verify(At,xt,kt)})}};var __awaiter$1g=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let EdDsaAlgorithm$2=class extends CryptoAlgorithm$1{computePublicKey(e){return __awaiter$1g(this,arguments,void 0,function*({key:_t}){if(!isOkpPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(_t.crv){case"Ed25519":{const At=yield Ed25519$1.computePublicKey({key:_t});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}generateKey(e){return __awaiter$1g(this,arguments,void 0,function*({algorithm:_t}){switch(_t){case"Ed25519":{const At=yield Ed25519$1.generateKey();return At.alg="EdDSA",At}}})}getPublicKey(e){return __awaiter$1g(this,arguments,void 0,function*({key:_t}){if(!isOkpPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(_t.crv){case"Ed25519":{const At=yield Ed25519$1.getPublicKey({key:_t});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}sign(e){return __awaiter$1g(this,arguments,void 0,function*({key:_t,data:At}){if(!isOkpPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(_t.crv){case"Ed25519":return yield Ed25519$1.sign({key:_t,data:At});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}verify(e){return __awaiter$1g(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){if(!isOkpPublicJwk$1(_t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(_t.crv){case"Ed25519":return yield Ed25519$1.verify({key:_t,signature:At,data:xt});default:throw new Error(`Unsupported curve: ${_t.crv}`)}})}};var __awaiter$1f=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const supportedAlgorithms$3={Ed25519:{implementation:EdDsaAlgorithm$2,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$2,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$2,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$1,names:["SHA-256"]}};let LocalKeyManager$2=class{constructor(e){var _t;this._algorithmInstances=new Map,this._keyStore=(_t=e==null?void 0:e.keyStore)!==null&&_t!==void 0?_t:new MemoryStore$1}digest(e){return __awaiter$1f(this,arguments,void 0,function*({algorithm:_t,data:At}){return yield this.getAlgorithm({algorithm:_t}).digest({algorithm:_t,data:At})})}exportKey(e){return __awaiter$1f(this,arguments,void 0,function*({keyUri:_t}){return yield this.getPrivateKey({keyUri:_t})})}generateKey(e){return __awaiter$1f(this,arguments,void 0,function*({algorithm:_t}){const xt=yield this.getAlgorithm({algorithm:_t}).generateKey({algorithm:_t});if((xt==null?void 0:xt.kid)===void 0)throw new Error("Generated key is missing a required property: kid");const kt=`${KEY_URI_PREFIX_JWK$1}${xt.kid}`;return yield this._keyStore.set(kt,xt),kt})}getKeyUri(e){return __awaiter$1f(this,arguments,void 0,function*({key:_t}){const At=yield computeJwkThumbprint$1({jwk:_t});return`${KEY_URI_PREFIX_JWK$1}${At}`})}getPublicKey(e){return __awaiter$1f(this,arguments,void 0,function*({keyUri:_t}){const At=yield this.getPrivateKey({keyUri:_t}),xt=this.getAlgorithmName({key:At});return yield this.getAlgorithm({algorithm:xt}).getPublicKey({key:At})})}importKey(e){return __awaiter$1f(this,arguments,void 0,function*({key:_t}){var At;if(!isPrivateJwk$1(_t))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const xt=structuredClone(_t);(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$1({jwk:xt}));const kt=yield this.getKeyUri({key:xt});return yield this._keyStore.set(kt,xt),kt})}sign(e){return __awaiter$1f(this,arguments,void 0,function*({keyUri:_t,data:At}){const xt=yield this.getPrivateKey({keyUri:_t}),kt=this.getAlgorithmName({key:xt});return this.getAlgorithm({algorithm:kt}).sign({data:At,key:xt})})}verify(e){return __awaiter$1f(this,arguments,void 0,function*({key:_t,signature:At,data:xt}){const kt=this.getAlgorithmName({key:_t});return this.getAlgorithm({algorithm:kt}).verify({key:_t,signature:At,data:xt})})}getAlgorithm({algorithm:e}){var _t;const At=(_t=supportedAlgorithms$3[e])===null||_t===void 0?void 0:_t.implementation;if(!At)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(At)||this._algorithmInstances.set(At,new At),this._algorithmInstances.get(At)}getAlgorithmName({key:e}){const _t=e.alg,At=e.crv;for(const xt in supportedAlgorithms$3){const kt=supportedAlgorithms$3[xt];if(_t&&kt.names.includes(_t))return xt;if(At&&kt.names.includes(At))return xt}throw new Error(`Unable to determine algorithm based on provided input: alg=${_t}, crv=${At}`)}getPrivateKey(e){return __awaiter$1f(this,arguments,void 0,function*({keyUri:_t}){const At=yield this._keyStore.get(_t);if(!At)throw new Error(`Key not found: ${_t}`);return At})}};function getJoseSignatureAlgorithmFromPublicKey$1($t){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if($t.alg&&Object.values(e).includes($t.alg))return $t.alg;if($t.crv&&Object.keys(e).includes($t.crv))return e[$t.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${$t.alg}, crv=${$t.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}function randomBytes($t){return randomBytes$6($t)}function randomUuid(){return crypto$7.randomUUID()}function randomPin({length:$t}){if(3>$t||$t>10)throw new Error("randomPin() can securely generate a PIN between 3 to 10 digits.");const e=Math.pow(10,$t)-1;let _t;if($t<=6){const At=Math.pow(10,$t);do{const xt=randomBytes(Math.ceil($t/2));_t=new DataView(xt.buffer).getUint16(0,!1)%At}while(_t>e)}else{const At=Math.pow(10,10);do{const xt=randomBytes(4);_t=new DataView(xt.buffer).getUint32(0,!1)%At}while(_t>e)}return _t.toString().padStart($t,"0")}const CryptoUtils={randomPin,randomUuid,randomBytes,getJoseSignatureAlgorithmFromPublicKey:getJoseSignatureAlgorithmFromPublicKey$1};var __awaiter$1e=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$l=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const AES_GCM_IV_LENGTH=96,AES_KEY_LENGTHS$1=[128,192,256],AES_GCM_TAG_LENGTHS=[96,104,112,120,128];class AesGcm{static bytesToPrivateKey(e){return __awaiter$1e(this,arguments,void 0,function*({privateKeyBytes:_t}){const At={k:Convert$1.uint8Array(_t).toBase64Url(),kty:"oct"};return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static decrypt(e){return __awaiter$1e(this,arguments,void 0,function*({key:_t,data:At,iv:xt,additionalData:kt,tagLength:Bt}){if(xt.byteLength!==AES_GCM_IV_LENGTH/8)throw new TypeError(`The initialization vector must be ${AES_GCM_IV_LENGTH} bits in length`);if(Bt&&!AES_GCM_TAG_LENGTHS.includes(Bt))throw new RangeError(`The tag length is invalid: Must be ${AES_GCM_TAG_LENGTHS.join(", ")} bits`);const Nt=getWebcryptoSubtle(),Ut=yield Nt.importKey("jwk",_t,{name:"AES-GCM"},!0,["decrypt"]),Lt=Object.assign(Object.assign({name:"AES-GCM",iv:xt},Bt&&{tagLength:Bt}),kt&&{additionalData:kt}),jt=yield Nt.decrypt(Lt,Ut,At);return new Uint8Array(jt)})}static encrypt(e){return __awaiter$1e(this,arguments,void 0,function*({data:_t,iv:At,key:xt,additionalData:kt,tagLength:Bt}){if(At.byteLength!==AES_GCM_IV_LENGTH/8)throw new TypeError(`The initialization vector must be ${AES_GCM_IV_LENGTH} bits in length`);if(Bt&&!AES_GCM_TAG_LENGTHS.includes(Bt))throw new RangeError(`The tag length is invalid: Must be ${AES_GCM_TAG_LENGTHS.join(", ")} bits`);const Nt=getWebcryptoSubtle(),Ut=yield Nt.importKey("jwk",xt,{name:"AES-GCM"},!0,["encrypt"]),Lt=Object.assign(Object.assign({name:"AES-GCM",iv:At},Bt&&{tagLength:Bt}),kt&&{additionalData:kt}),jt=yield Nt.encrypt(Lt,Ut,_t);return new Uint8Array(jt)})}static generateKey(e){return __awaiter$1e(this,arguments,void 0,function*({length:_t}){if(!AES_KEY_LENGTHS$1.includes(_t))throw new RangeError(`The key length is invalid: Must be ${AES_KEY_LENGTHS$1.join(", ")} bits`);const At=getWebcryptoSubtle(),xt=yield At.generateKey({name:"AES-GCM",length:_t},!0,["encrypt"]),kt=yield At.exportKey("jwk",xt),Bt=__rest$l(kt,["ext","key_ops"]);return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static privateKeyToBytes(e){return __awaiter$1e(this,arguments,void 0,function*({privateKey:_t}){if(!isOctPrivateJwk(_t))throw new Error("AesGcm: The provided key is not a valid oct private key.");return Convert$1.base64Url(_t.k).toUint8Array()})}}var __awaiter$1d=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let AesGcmAlgorithm$1=class extends CryptoAlgorithm$1{decrypt(e){return __awaiter$1d(this,void 0,void 0,function*(){return AesGcm.decrypt(e)})}encrypt(e){return __awaiter$1d(this,void 0,void 0,function*(){return AesGcm.encrypt(e)})}generateKey(e){return __awaiter$1d(this,arguments,void 0,function*({algorithm:_t}){const At={A128GCM:128,A192GCM:192,A256GCM:256}[_t],xt=yield AesGcm.generateKey({length:At});return xt.alg=_t,xt})}};var __awaiter$1c=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$k=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};let X25519$1=class ho{static bytesToPrivateKey(e){return __awaiter$1c(this,arguments,void 0,function*({privateKeyBytes:_t}){const At=x25519.getPublicKey(_t),xt={kty:"OKP",crv:"X25519",d:Convert$1.uint8Array(_t).toBase64Url(),x:Convert$1.uint8Array(At).toBase64Url()};return xt.kid=yield computeJwkThumbprint$1({jwk:xt}),xt})}static bytesToPublicKey(e){return __awaiter$1c(this,arguments,void 0,function*({publicKeyBytes:_t}){const At={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(_t).toBase64Url()};return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static computePublicKey(e){return __awaiter$1c(this,arguments,void 0,function*({key:_t}){const At=yield ho.privateKeyToBytes({privateKey:_t}),xt=x25519.getPublicKey(At),kt={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(xt).toBase64Url()};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static generateKey(){return __awaiter$1c(this,void 0,void 0,function*(){const e=x25519.utils.randomPrivateKey(),_t=yield ho.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint$1({jwk:_t}),_t})}static getPublicKey(e){return __awaiter$1c(this,arguments,void 0,function*({key:_t}){var At;if(!(isOkpPrivateJwk$1(_t)&&_t.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let xt=__rest$k(_t,["d"]);return(At=xt.kid)!==null&&At!==void 0||(xt.kid=yield computeJwkThumbprint$1({jwk:xt})),xt})}static privateKeyToBytes(e){return __awaiter$1c(this,arguments,void 0,function*({privateKey:_t}){if(!isOkpPrivateJwk$1(_t))throw new Error("X25519: The provided key is not a valid OKP private key.");return Convert$1.base64Url(_t.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1c(this,arguments,void 0,function*({publicKey:_t}){if(!isOkpPublicJwk$1(_t))throw new Error("X25519: The provided key is not a valid OKP public key.");return Convert$1.base64Url(_t.x).toUint8Array()})}static sharedSecret(e){return __awaiter$1c(this,arguments,void 0,function*({privateKeyA:_t,publicKeyB:At}){if("x"in _t&&"x"in At&&_t.x===At.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const xt=yield ho.privateKeyToBytes({privateKey:_t}),kt=yield ho.publicKeyToBytes({publicKey:At});return x25519.getSharedSecret(xt,kt)})}};function extractDidFragment$1($t){if(typeof $t=="string"&&$t.length!==0)return $t.split("#").pop()}function getVerificationMethods$1({didDocument:$t}){var e,_t;if(!$t)throw new TypeError("Required parameter missing: 'didDocument'");const At=[];return At.push(...(_t=(e=$t.verificationMethod)===null||e===void 0?void 0:e.filter(isDidVerificationMethod$1))!==null&&_t!==void 0?_t:[]),Object.keys(DidVerificationRelationship$1).forEach(xt=>{var kt,Bt;At.push(...(Bt=(kt=$t[xt])===null||kt===void 0?void 0:kt.filter(isDidVerificationMethod$1))!==null&&Bt!==void 0?Bt:[])}),At}function getVerificationMethodTypes$1({didDocument:$t}){const _t=getVerificationMethods$1({didDocument:$t}).map(At=>At.type);return[...new Set(_t)]}function getVerificationRelationshipsById$1({didDocument:$t,methodId:e}){const _t=[];return Object.keys(DidVerificationRelationship$1).forEach(At=>{if(Array.isArray($t[At])){const xt=$t[At],kt=extractDidFragment$1(e);xt.some(Nt=>{const Ut=extractDidFragment$1(Nt)===kt,Lt=isDidVerificationMethod$1(Nt)&&extractDidFragment$1(Nt.id)===kt;return Ut||Lt})&&_t.push(At)}}),_t}function isDidService($t){return!$t||typeof $t!="object"||$t===null?!1:"id"in $t&&"type"in $t&&"serviceEndpoint"in $t}function isDwnDidService($t){if(!isDidService($t)||$t.type!=="DecentralizedWebNode"||!("enc"in $t&&"sig"in $t))return!1;const e=_t=>typeof _t=="string"||Array.isArray(_t)&&_t.every(At=>typeof At=="string");return e($t.enc)&&e($t.sig)}function isDidVerificationMethod$1($t){return!(!$t||typeof $t!="object"||$t===null||!("id"in $t&&"type"in $t&&"controller"in $t)||typeof $t.id!="string"||typeof $t.type!="string"||typeof $t.controller!="string")}function keyBytesToMultibaseId$1({keyBytes:$t,multicodecCode:e,multicodecName:_t}){const At=Multicodec.addPrefix({code:e,data:$t,name:_t}),xt=Convert.uint8Array(At).toBase58Btc();return Convert.base58Btc(xt).toMultibase()}function multibaseIdToKeyBytes$1({multibaseKeyId:$t}){try{const e=Convert.multibase($t).toBase58Btc(),_t=Convert.base58Btc(e).toUint8Array(),{code:At,data:xt,name:kt}=Multicodec.removePrefix({prefixedData:_t});return{keyBytes:xt,multicodecCode:At,multicodecName:kt}}catch{throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid multibase identifier: ${$t}`)}}var __awaiter$1b=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let BearerDid$1=class Yo{constructor({uri:e,document:_t,metadata:At,keyManager:xt}){this.uri=e,this.document=_t,this.metadata=At,this.keyManager=xt}export(){return __awaiter$1b(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const _t=[];for(let At of this.document.verificationMethod){if(!At.publicKeyJwk)throw new Error(`Verification method '${At.id}' does not contain a public key in JWK format`);const xt=yield this.keyManager.getKeyUri({key:At.publicKeyJwk}),kt=yield this.keyManager.exportKey({keyUri:xt});_t.push(Object.assign({},kt))}e.privateKeys=_t}return e})}getSigner(e){return __awaiter$1b(this,void 0,void 0,function*(){var _t;const At=(_t=this.document.verificationMethod)===null||_t===void 0?void 0:_t.find(Ut=>{var Lt,jt;return extractDidFragment$1(Ut.id)===((Lt=extractDidFragment$1(e==null?void 0:e.methodId))!==null&&Lt!==void 0?Lt:extractDidFragment$1((jt=this.document.assertionMethod)===null||jt===void 0?void 0:jt[0]))});if(!(At&&At.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");const xt=yield this.keyManager.getKeyUri({key:At.publicKeyJwk}),kt=yield this.keyManager.getPublicKey({keyUri:xt}),Bt=this.keyManager;return{algorithm:CryptoUtils.getJoseSignatureAlgorithmFromPublicKey(kt),keyId:At.id,sign(Ut){return __awaiter$1b(this,arguments,void 0,function*({data:Lt}){return yield Bt.sign({data:Lt,keyUri:xt})})},verify(Ut){return __awaiter$1b(this,arguments,void 0,function*({data:Lt,signature:jt}){return yield Bt.verify({data:Lt,key:kt,signature:jt})})}}})}static import(e){return __awaiter$1b(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$2}){var xt;const kt=getVerificationMethods$1({didDocument:_t.document});if(kt.length===0)throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let Nt of(xt=_t.privateKeys)!==null&&xt!==void 0?xt:[])yield At.importKey({key:Nt});for(let Nt of kt){if(!Nt.publicKeyJwk)throw new Error(`Verification method '${Nt.id}' does not contain a public key in JWK format`);const Ut=yield At.getKeyUri({key:Nt.publicKeyJwk});yield At.getPublicKey({keyUri:Ut})}return new Yo({uri:_t.uri,document:_t.document,metadata:_t.metadata,keyManager:At})})}};var __awaiter$1a=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidMethod$1=class{static getSigningMethod(e){return __awaiter$1a(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,_t){return __awaiter$1a(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}};var __awaiter$19=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$j=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const DEFAULT_GATEWAY_URI$3="https://diddht.tbddev.org",DID_DHT_SPECIFICATION_VERSION$1=0,DNS_RECORD_TTL$1=7200,PROPERTY_SEPARATOR$1=";",VALUE_SEPARATOR$1=",";var DidDhtRegisteredDidType$1;(function($t){$t[$t.Discoverable=0]="Discoverable",$t[$t.Organization=1]="Organization",$t[$t.Government=2]="Government",$t[$t.Corporation=3]="Corporation",$t[$t.LocalBusiness=4]="LocalBusiness",$t[$t.SoftwarePackage=5]="SoftwarePackage",$t[$t.WebApp=6]="WebApp",$t[$t.FinancialInstitution=7]="FinancialInstitution"})(DidDhtRegisteredDidType$1||(DidDhtRegisteredDidType$1={}));var DidDhtRegisteredKeyType$1;(function($t){$t[$t.Ed25519=0]="Ed25519",$t[$t.secp256k1=1]="secp256k1",$t[$t.secp256r1=2]="secp256r1",$t[$t.X25519=3]="X25519"})(DidDhtRegisteredKeyType$1||(DidDhtRegisteredKeyType$1={}));var DidDhtVerificationRelationship$1;(function($t){$t.authentication="auth",$t.assertionMethod="asm",$t.capabilityDelegation="del",$t.capabilityInvocation="inv",$t.keyAgreement="agm"})(DidDhtVerificationRelationship$1||(DidDhtVerificationRelationship$1={}));const AlgorithmToKeyTypeMap$5={Ed25519:DidDhtRegisteredKeyType$1.Ed25519,ES256K:DidDhtRegisteredKeyType$1.secp256k1,ES256:DidDhtRegisteredKeyType$1.secp256r1,"P-256":DidDhtRegisteredKeyType$1.secp256r1,secp256k1:DidDhtRegisteredKeyType$1.secp256k1,secp256r1:DidDhtRegisteredKeyType$1.secp256r1,X25519:DidDhtRegisteredKeyType$1.X25519},KeyTypeToDefaultAlgorithmMap$1={[DidDhtRegisteredKeyType$1.Ed25519]:"EdDSA",[DidDhtRegisteredKeyType$1.secp256k1]:"ES256K",[DidDhtRegisteredKeyType$1.secp256r1]:"ES256",[DidDhtRegisteredKeyType$1.X25519]:"ECDH-ES+A256KW"};let DidDht$1=class Co extends DidMethod$1{static create(){return __awaiter$19(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$2,options:_t={}}={}){var At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt;if(!((At=_t.verificationMethods)===null||At===void 0)&&At.some(dr=>!(dr.algorithm in AlgorithmToKeyTypeMap$5)))throw new Error("One or more verification method algorithms are not supported");const Vt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt.filter(dr=>"id"in dr).map(dr=>dr.id);if(Vt&&Vt.length!==new Set(Vt).size)throw new Error("One or more verification method IDs are not unique");if(!((kt=_t.services)===null||kt===void 0)&&kt.some(dr=>!dr.id||!dr.type||!dr.serviceEndpoint))throw new Error("One or more services are missing required properties");const Ht=yield e.generateKey({algorithm:"Ed25519"}),Wt=yield e.getPublicKey({keyUri:Ht}),Qt=yield DidDhtUtils$1.identityKeyToIdentifier({identityKey:Wt}),Xt=Object.assign(Object.assign({id:Qt},_t.alsoKnownAs&&{alsoKnownAs:_t.alsoKnownAs}),_t.controllers&&{controller:_t.controllers}),Jt=[...(Bt=_t.verificationMethods)!==null&&Bt!==void 0?Bt:[]];Jt!=null&&Jt.some(dr=>{var vr;return((vr=dr.id)===null||vr===void 0?void 0:vr.split("#").pop())==="0"})||Jt.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const dr of Jt){const vr=dr.id&&dr.id.split("#").pop()==="0"?Ht:yield e.generateKey({algorithm:dr.algorithm}),$r=yield e.getPublicKey({keyUri:vr});let Ir=(Ut=(Nt=dr.id)!==null&&Nt!==void 0?Nt:$r.kid)!==null&&Ut!==void 0?Ut:yield computeJwkThumbprint$1({jwk:$r});Ir=`${Qt}#${extractDidFragment$1(Ir)}`,(Lt=Xt.verificationMethod)!==null&&Lt!==void 0||(Xt.verificationMethod=[]),Xt.verificationMethod.push({id:Ir,type:"JsonWebKey",controller:(jt=dr.controller)!==null&&jt!==void 0?jt:Qt,publicKeyJwk:$r});for(const Rr of(Kt=dr.purposes)!==null&&Kt!==void 0?Kt:[])Xt[Rr]||(Xt[Rr]=[]),Xt[Rr].push(Ir)}(qt=_t.services)===null||qt===void 0||qt.forEach(dr=>{var vr;(vr=Xt.service)!==null&&vr!==void 0||(Xt.service=[]),dr.id=`${Qt}#${dr.id.split("#").pop()}`,Xt.service.push(dr)});const tr=new BearerDid$1({uri:Qt,document:Xt,metadata:Object.assign({published:!1},_t.types&&{types:_t.types}),keyManager:e});if(!((zt=_t.publish)!==null&&zt!==void 0)||zt){const dr=yield Co.publish({did:tr,gatewayUri:_t.gatewayUri});tr.metadata=dr.didDocumentMetadata}return tr})}static import(e){return __awaiter$19(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$2}){var xt;const kt=Did$1.parse(_t.uri);if((kt==null?void 0:kt.method)!==Co.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");const Bt=yield BearerDid$1.import({portableDid:_t,keyManager:At});if(!(!((xt=Bt.document.verificationMethod)===null||xt===void 0)&&xt.some(Nt=>{var Ut;return((Ut=Nt.id)===null||Ut===void 0?void 0:Ut.split("#").pop())==="0"})))throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"DID document must contain an Identity Key");return Bt})}static getSigningMethod(e){return __awaiter$19(this,arguments,void 0,function*({didDocument:_t,methodId:At="#0"}){var xt;const kt=Did$1.parse(_t.id);if(kt&&kt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${kt.method}`);const Bt=(xt=_t.verificationMethod)===null||xt===void 0?void 0:xt.find(Nt=>{var Ut,Lt;return extractDidFragment$1(Nt.id)===((Ut=extractDidFragment$1(At))!==null&&Ut!==void 0?Ut:extractDidFragment$1((Lt=_t.assertionMethod)===null||Lt===void 0?void 0:Lt[0]))});if(!(Bt&&Bt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static publish(e){return __awaiter$19(this,arguments,void 0,function*({did:_t,gatewayUri:At=DEFAULT_GATEWAY_URI$3}){return yield DidDhtDocument$1.put({did:_t,gatewayUri:At})})}static resolve(e){return __awaiter$19(this,arguments,void 0,function*(_t,At={}){var xt;const kt=(xt=At==null?void 0:At.gatewayUri)!==null&&xt!==void 0?xt:DEFAULT_GATEWAY_URI$3;try{yield DidDhtUtils$1.identifierToIdentityKey({didUri:_t});const{didDocument:Bt,didDocumentMetadata:Nt}=yield DidDhtDocument$1.get({didUri:_t,gatewayUri:kt});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:Bt,didDocumentMetadata:Nt})}catch(Bt){if(!(Bt instanceof DidError$1))throw new Error(Bt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:Object.assign({error:Bt.code},Bt.message&&{errorMessage:Bt.message})})}})}};DidDht$1.methodName="dht";let DidDhtDocument$1=class Vi{static get(e){return __awaiter$19(this,arguments,void 0,function*({didUri:_t,gatewayUri:At}){const xt=DidDhtUtils$1.identifierToIdentityKeyBytes({didUri:_t}),kt=yield Vi.pkarrGet({gatewayUri:At,publicKeyBytes:xt}),Bt=yield DidDhtUtils$1.parseBep44GetMessage({bep44Message:kt}),Nt=yield Vi.fromDnsPacket({didUri:_t,dnsPacket:Bt});return Nt.didDocumentMetadata.versionId=kt.seq.toString(),Nt})}static put(e){return __awaiter$19(this,arguments,void 0,function*({did:_t,gatewayUri:At}){const xt=yield Vi.toDnsPacket({didDocument:_t.document,didMetadata:_t.metadata,authoritativeGatewayUris:[At]}),kt=yield DidDhtUtils$1.createBep44PutMessage({dnsPacket:xt,publicKeyBytes:DidDhtUtils$1.identifierToIdentityKeyBytes({didUri:_t.uri}),signer:yield _t.getSigner({methodId:"0"})}),Bt=yield Vi.pkarrPut({gatewayUri:At,bep44Message:kt});return{didDocument:_t.document,didDocumentMetadata:Object.assign(Object.assign({},_t.metadata),{published:Bt,versionId:kt.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return __awaiter$19(this,arguments,void 0,function*({gatewayUri:_t,publicKeyBytes:At}){const xt=Convert.uint8Array(At).toBase32Z(),kt=new URL(xt,_t).href;let Bt;try{if(Bt=yield fetch(kt,{method:"GET"}),!Bt.ok)throw new DidError$1(DidErrorCode$1.NotFound,`Pkarr record not found for: ${xt}`)}catch(Lt){throw Lt instanceof DidError$1?Lt:new DidError$1(DidErrorCode$1.InternalError,`Failed to fetch Pkarr record: ${Lt.message}`)}const Nt=yield Bt.arrayBuffer();if(!Nt)throw new DidError$1(DidErrorCode$1.NotFound,`Pkarr record not found for: ${xt}`);if(Nt.byteLength<72)throw new DidError$1(DidErrorCode$1.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${Nt.byteLength}`);if(Nt.byteLength>1072)throw new DidError$1(DidErrorCode$1.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${Nt.byteLength}`);return{k:At,seq:Number(new DataView(Nt).getBigUint64(64)),sig:new Uint8Array(Nt,0,64),v:new Uint8Array(Nt,72)}})}static pkarrPut(e){return __awaiter$19(this,arguments,void 0,function*({gatewayUri:_t,bep44Message:At}){const xt=Convert.uint8Array(At.k).toBase32Z(),kt=new URL(xt,_t).href,Bt=new Uint8Array(At.v.length+72);Bt.set(At.sig,0),new DataView(Bt.buffer).setBigUint64(At.sig.length,BigInt(At.seq)),Bt.set(At.v,At.sig.length+8);let Nt;try{Nt=yield fetch(kt,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:Bt})}catch(Ut){throw new DidError$1(DidErrorCode$1.InternalError,`Failed to put Pkarr record for identifier ${xt}: ${Ut.message}`)}return Nt.ok})}static fromDnsPacket(e){return __awaiter$19(this,arguments,void 0,function*({didUri:_t,dnsPacket:At}){var xt,kt,Bt;const Nt={id:_t},Ut={published:!0},Lt=new Map;for(const jt of(xt=At==null?void 0:At.answers)!==null&&xt!==void 0?xt:[]){if(jt.type!=="TXT")continue;const Kt=jt.name.split(".")[0].substring(1);switch(!0){case Kt.startsWith("aka"):{const qt=DidDhtUtils$1.parseTxtDataToString(jt.data);Nt.alsoKnownAs=qt.split(VALUE_SEPARATOR$1);break}case Kt.startsWith("cnt"):{const qt=DidDhtUtils$1.parseTxtDataToString(jt.data);Nt.controller=qt.includes(VALUE_SEPARATOR$1)?qt.split(VALUE_SEPARATOR$1):qt;break}case Kt.startsWith("k"):{const{id:qt,t:zt,k:Vt,c:Ht,a:Wt}=DidDhtUtils$1.parseTxtDataToObject(jt.data),Qt=Convert.base64Url(Vt).toUint8Array(),Xt=DidDhtRegisteredKeyType$1[Number(zt)];let Jt=yield DidDhtUtils$1.keyConverter(Xt).bytesToPublicKey({publicKeyBytes:Qt});Jt.alg=Wt||KeyTypeToDefaultAlgorithmMap$1[Number(zt)];const tr=Kt==="k0"?"0":qt!==void 0?qt:yield computeJwkThumbprint$1({jwk:Jt});(kt=Nt.verificationMethod)!==null&&kt!==void 0||(Nt.verificationMethod=[]);const dr=`${_t}#${tr}`;Nt.verificationMethod.push({id:dr,type:"JsonWebKey",controller:Ht??_t,publicKeyJwk:Jt}),Lt.set(Kt,dr);break}case Kt.startsWith("s"):{const qt=DidDhtUtils$1.parseTxtDataToObject(jt.data),{id:zt,t:Vt,se:Ht}=qt,Wt=__rest$j(qt,["id","t","se"]),Qt=Ht.includes(VALUE_SEPARATOR$1)?Ht.split(VALUE_SEPARATOR$1):[Ht],Xt=Object.fromEntries(Object.entries(Wt).map(([Jt,tr])=>[Jt,tr.includes(VALUE_SEPARATOR$1)?tr.split(VALUE_SEPARATOR$1):tr]));(Bt=Nt.service)!==null&&Bt!==void 0||(Nt.service=[]),Nt.service.push(Object.assign(Object.assign({},Xt),{id:`${_t}#${zt}`,type:Vt,serviceEndpoint:Qt}));break}case Kt.startsWith("typ"):{const{id:qt}=DidDhtUtils$1.parseTxtDataToObject(jt.data);Ut.types=qt.split(VALUE_SEPARATOR$1).map(zt=>Number(zt));break}case Kt.startsWith("did"):{const qt=Xt=>Xt.split(VALUE_SEPARATOR$1).map(Jt=>Lt.get(Jt)).filter(Jt=>typeof Jt=="string"),{auth:zt,asm:Vt,del:Ht,inv:Wt,agm:Qt}=DidDhtUtils$1.parseTxtDataToObject(jt.data);zt&&(Nt.authentication=qt(zt)),Vt&&(Nt.assertionMethod=qt(Vt)),Ht&&(Nt.capabilityDelegation=qt(Ht)),Wt&&(Nt.capabilityInvocation=qt(Wt)),Qt&&(Nt.keyAgreement=qt(Qt));break}}}return{didDocument:Nt,didDocumentMetadata:Ut,didResolutionMetadata:{}}})}static toDnsPacket(e){return __awaiter$19(this,arguments,void 0,function*({didDocument:_t,didMetadata:At,authoritativeGatewayUris:xt,previousDidProof:kt}){var Bt,Nt,Ut,Lt,jt;const Kt=[],qt=[],zt=new Map,Vt=[],Ht=[];if(kt!==void 0){const{signature:Xt,previousDid:Jt}=kt;yield DidDhtUtils$1.validatePreviousDidProof({newDid:_t.id,previousDidProof:kt}),Kt.push({type:"TXT",name:"_prv._did.",ttl:DNS_RECORD_TTL$1,data:`id=${Jt};s=${Xt}`})}if(_t.alsoKnownAs&&Kt.push({type:"TXT",name:"_aka._did.",ttl:DNS_RECORD_TTL$1,data:_t.alsoKnownAs.join(VALUE_SEPARATOR$1)}),_t.controller){const Xt=Array.isArray(_t.controller)?_t.controller.join(VALUE_SEPARATOR$1):_t.controller;Kt.push({type:"TXT",name:"_cnt._did.",ttl:DNS_RECORD_TTL$1,data:Xt})}for(const[Xt,Jt]of(Nt=(Bt=_t.verificationMethod)===null||Bt===void 0?void 0:Bt.entries())!==null&&Nt!==void 0?Nt:[]){const tr=`k${Xt}`;Ht.push(tr);let dr=Jt.id.split("#").pop();zt.set(dr,tr);const vr=Jt.publicKeyJwk;if(!(vr!=null&&vr.crv&&vr.crv in AlgorithmToKeyTypeMap$5))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Verification method '${Jt.id}' contains an unsupported key type: ${(Ut=vr==null?void 0:vr.crv)!==null&&Ut!==void 0?Ut:"undefined"}`);const $r=DidDhtRegisteredKeyType$1[vr.crv],Ir=yield DidDhtUtils$1.keyConverter(vr.crv).publicKeyToBytes({publicKey:vr}),Rr=Convert.uint8Array(Ir).toBase64Url(),Nr=[`t=${$r}`,`k=${Rr}`];dr!=="0"&&(yield computeJwkThumbprint$1({jwk:vr}))!==dr&&Nr.unshift(`id=${dr}`),vr.alg!==KeyTypeToDefaultAlgorithmMap$1[$r]&&Nr.push(`a=${vr.alg}`),Jt.controller!==_t.id&&Nr.push(`c=${Jt.controller}`),Kt.push({type:"TXT",name:`_${tr}._did.`,ttl:DNS_RECORD_TTL$1,data:Nr.join(PROPERTY_SEPARATOR$1)})}(Lt=_t.service)===null||Lt===void 0||Lt.forEach((Xt,Jt)=>{const tr=`s${Jt}`;Vt.push(tr);let{id:dr,type:vr,serviceEndpoint:$r}=Xt,Ir=__rest$j(Xt,["id","type","serviceEndpoint"]);dr=extractDidFragment$1(dr),$r=Array.isArray($r)?$r.join(","):$r;const Nr=Object.entries(Object.assign({id:dr,t:vr,se:$r},Ir)).map(([lr,ir])=>`${lr}=${ir}`).join(PROPERTY_SEPARATOR$1),kr=DidDhtUtils$1.chunkDataIfNeeded(Nr);Kt.push({type:"TXT",name:`_${tr}._did.`,ttl:DNS_RECORD_TTL$1,data:kr})});const Wt=[`v=${DID_DHT_SPECIFICATION_VERSION$1}`];if(Ht.length&&Wt.push(`vm=${Ht.join(VALUE_SEPARATOR$1)}`),Object.keys(DidVerificationRelationship$1).forEach(Xt=>{var Jt;const tr=(Jt=_t[Xt])===null||Jt===void 0?void 0:Jt.map(dr=>zt.get(dr.split("#").pop()));if(tr){const dr=DidDhtVerificationRelationship$1[Xt];Wt.push(`${dr}=${tr.join(VALUE_SEPARATOR$1)}`)}}),Vt.length&&Wt.push(`svc=${Vt.join(VALUE_SEPARATOR$1)}`),!((jt=At.types)===null||jt===void 0)&&jt.length){const Jt=At.types.map(tr=>typeof tr=="string"?DidDhtRegisteredDidType$1[tr]:tr);Kt.push({type:"TXT",name:"_typ._did.",ttl:DNS_RECORD_TTL$1,data:`id=${Jt.join(VALUE_SEPARATOR$1)}`})}Kt.push({type:"TXT",name:"_did."+Vi.getUniqueDidSuffix(_t.id)+".",ttl:DNS_RECORD_TTL$1,data:Wt.join(PROPERTY_SEPARATOR$1)});for(const Xt of xt||[])qt.push({type:"NS",name:"_did."+Vi.getUniqueDidSuffix(_t.id)+".",ttl:DNS_RECORD_TTL$1,data:Xt+"."});return{id:0,type:"response",flags:AUTHORITATIVE_ANSWER,answers:[...Kt,...qt]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}},DidDhtUtils$1=class To{static createBep44PutMessage(e){return __awaiter$19(this,arguments,void 0,function*({dnsPacket:_t,publicKeyBytes:At,signer:xt}){const kt=Math.ceil(Date.now()/1e3),Bt=encode$2(_t),Nt=bencode.encode({seq:kt,v:Bt}).subarray(1,-1);if(Nt.length>1e3)throw new DidError$1(DidErrorCode$1.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${Nt.length} bytes`);const Ut=yield xt.sign({data:Nt});return{k:At,seq:kt,sig:Ut,v:Bt}})}static identifierToIdentityKey(e){return __awaiter$19(this,arguments,void 0,function*({didUri:_t}){let At=To.identifierToIdentityKeyBytes({didUri:_t});return yield Ed25519$1.bytesToPublicKey({publicKeyBytes:At})})}static identifierToIdentityKeyBytes({didUri:e}){const _t=Did$1.parse(e);if(!_t)throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid DID URI: ${e}`);if(_t.method!==DidDht$1.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${_t.method}`);let At;try{At=Convert.base32Z(_t.id).toUint8Array()}catch{throw new DidError$1(DidErrorCode$1.InvalidPublicKey,"Failed to decode method-specific identifier")}if(At.length!==32)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyLength,`Invalid public key length: ${At.length}`);return At}static identityKeyToIdentifier(e){return __awaiter$19(this,arguments,void 0,function*({identityKey:_t}){const At=yield Ed25519$1.publicKeyToBytes({publicKey:_t}),xt=Convert.uint8Array(At).toBase32Z();return`did:${DidDht$1.methodName}:${xt}`})}static keyConverter(e){const At={Ed25519:Ed25519$1,"P-256":{publicKeyToBytes:xt=>__awaiter$19(this,[xt],void 0,function*({publicKey:kt}){const Bt=yield Secp256r1$1.publicKeyToBytes({publicKey:kt});return yield Secp256r1$1.compressPublicKey({publicKeyBytes:Bt})}),bytesToPublicKey:Secp256r1$1.bytesToPublicKey,privateKeyToBytes:Secp256r1$1.privateKeyToBytes,bytesToPrivateKey:Secp256r1$1.bytesToPrivateKey},secp256k1:{publicKeyToBytes:xt=>__awaiter$19(this,[xt],void 0,function*({publicKey:kt}){const Bt=yield Secp256k1$1.publicKeyToBytes({publicKey:kt});return yield Secp256k1$1.compressPublicKey({publicKeyBytes:Bt})}),bytesToPublicKey:Secp256k1$1.bytesToPublicKey,privateKeyToBytes:Secp256k1$1.privateKeyToBytes,bytesToPrivateKey:Secp256k1$1.bytesToPrivateKey},X25519:X25519$1}[e];if(!At)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static parseBep44GetMessage(e){return __awaiter$19(this,arguments,void 0,function*({bep44Message:_t}){const At=yield Ed25519$1.bytesToPublicKey({publicKeyBytes:_t.k}),xt=bencode.encode({seq:_t.seq,v:_t.v}).subarray(1,-1);if(!(yield Ed25519$1.verify({key:At,signature:_t.sig,data:xt})))throw new DidError$1(DidErrorCode$1.InvalidSignature,"Invalid signature for DHT BEP44 message");return decode$1(_t.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(PROPERTY_SEPARATOR$1).reduce((_t,At)=>{const[xt,kt]=At.split("=");return _t[xt]=kt,_t},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return Convert.uint8Array(e).toString();if(Array.isArray(e))return e.map(_t=>this.parseTxtDataToString(_t)).join("");throw new DidError$1(DidErrorCode$1.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return __awaiter$19(this,arguments,void 0,function*({newDid:_t,previousDidProof:At}){const xt=yield To.identifierToIdentityKey({didUri:At.previousDid}),kt=To.identifierToIdentityKeyBytes({didUri:_t}),Bt=Convert.base64Url(At.signature).toUint8Array();if(!(yield Ed25519$1.verify({key:xt,data:kt,signature:Bt})))throw new DidError$1(DidErrorCode$1.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const _t=[];for(let At=0;At<e.length;At+=255)_t.push(e.slice(At,At+255));return _t}};var __awaiter$18=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidIonRegisteredKeyType$1;(function($t){$t.Ed25519="Ed25519",$t.secp256k1="secp256k1",$t.secp256r1="secp256r1",$t.X25519="X25519"})(DidIonRegisteredKeyType$1||(DidIonRegisteredKeyType$1={}));const AlgorithmToKeyTypeMap$4={Ed25519:DidIonRegisteredKeyType$1.Ed25519,ES256K:DidIonRegisteredKeyType$1.secp256k1,ES256:DidIonRegisteredKeyType$1.secp256r1,"P-256":DidIonRegisteredKeyType$1.secp256r1,secp256k1:DidIonRegisteredKeyType$1.secp256k1,secp256r1:DidIonRegisteredKeyType$1.secp256r1},DEFAULT_GATEWAY_URI$2="https://ion.tbd.engineering";let DidIon$1=class po extends DidMethod$1{static create(){return __awaiter$18(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$2,options:_t={}}={}){var At,xt,kt,Bt,Nt,Ut,Lt;if(!((At=_t.verificationMethods)===null||At===void 0)&&At.some(dr=>!(dr.algorithm in AlgorithmToKeyTypeMap$4)))throw new Error("One or more verification method algorithms are not supported");const jt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt.filter(dr=>"id"in dr).map(dr=>dr.id);if(jt&&jt.length!==new Set(jt).size)throw new Error("One or more verification method IDs are not unique");if(!((kt=_t.services)===null||kt===void 0)&&kt.some(dr=>!dr.id||!dr.type||!dr.serviceEndpoint))throw new Error("One or more services are missing required properties");const Kt={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},qt=[];for(const dr of(Bt=_t.verificationMethods)!==null&&Bt!==void 0?Bt:[Kt]){const vr=yield e.generateKey({algorithm:dr.algorithm}),$r=yield e.getPublicKey({keyUri:vr});qt.push({id:dr.id,publicKeyJwk:$r,purposes:(Nt=dr.purposes)!==null&&Nt!==void 0?Nt:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const zt=yield e.generateKey({algorithm:DidIonRegisteredKeyType$1.secp256k1}),Vt=yield e.getPublicKey({keyUri:zt}),Ht=yield e.generateKey({algorithm:DidIonRegisteredKeyType$1.secp256k1}),Wt=yield e.getPublicKey({keyUri:Ht}),Qt=yield DidIonUtils$1.computeLongFormDidUri({recoveryKey:Vt,updateKey:Wt,services:(Ut=_t.services)!==null&&Ut!==void 0?Ut:[],verificationMethods:qt}),{didDocument:Xt,didResolutionMetadata:Jt}=yield po.resolve(Qt,{gatewayUri:_t.gatewayUri});if(Xt===null)throw new Error(`Unable to resolve DID during creation: ${Jt==null?void 0:Jt.error}`);const tr=new BearerDid$1({uri:Qt,document:Xt,metadata:{published:!1,canonicalId:Qt.split(":",3).join(":"),recoveryKey:Vt,updateKey:Wt},keyManager:e});if(!((Lt=_t.publish)!==null&&Lt!==void 0)||Lt){const dr=yield po.publish({did:tr,gatewayUri:_t.gatewayUri});tr.metadata=dr.didDocumentMetadata}return tr})}static getSigningMethod(e){return __awaiter$18(this,arguments,void 0,function*({didDocument:_t,methodId:At}){var xt;const kt=Did$1.parse(_t.id);if(kt&&kt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${kt.method}`);const Bt=(xt=_t.verificationMethod)===null||xt===void 0?void 0:xt.find(Nt=>{var Ut;return Nt.id===(At??((Ut=_t.assertionMethod)===null||Ut===void 0?void 0:Ut[0]))});if(!(Bt&&Bt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static import(e){return __awaiter$18(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$2}){const xt=Did$1.parse(_t.uri);if((xt==null?void 0:xt.method)!==po.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");return yield BearerDid$1.import({portableDid:_t,keyManager:At})})}static publish(e){return __awaiter$18(this,arguments,void 0,function*({did:_t,gatewayUri:At=DEFAULT_GATEWAY_URI$2}){var xt,kt,Bt;const Nt=(kt=(xt=_t.document.verificationMethod)===null||xt===void 0?void 0:xt.map(jt=>({id:jt.id,publicKeyJwk:jt.publicKeyJwk,purposes:getVerificationRelationshipsById$1({didDocument:_t.document,methodId:jt.id})})))!==null&&kt!==void 0?kt:[],Ut=yield DidIonUtils$1.createIonDocument({services:(Bt=_t.document.service)!==null&&Bt!==void 0?Bt:[],verificationMethods:Nt}),Lt=yield DidIonUtils$1.constructCreateRequest({ionDocument:Ut,recoveryKey:_t.metadata.recoveryKey,updateKey:_t.metadata.updateKey});try{const jt=DidIonUtils$1.appendPathToUrl({baseUrl:At,path:"/operations"}),Kt=yield fetch(jt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(Lt)});return{didDocument:_t.document,didDocumentMetadata:Object.assign(Object.assign({},_t.metadata),{published:Kt.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:DidErrorCode$1.InternalError,errorMessage:`Failed to publish DID document for: ${_t.uri}`}}}})}static resolve(e){return __awaiter$18(this,arguments,void 0,function*(_t,At={}){var xt,kt;const Bt=Did$1.parse(_t);if(!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"invalidDid"}});if(Bt.method!==po.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"methodNotSupported"}});const Nt=(xt=At==null?void 0:At.gatewayUri)!==null&&xt!==void 0?xt:DEFAULT_GATEWAY_URI$2;try{const Ut=DidIonUtils$1.appendPathToUrl({baseUrl:Nt,path:`/identifiers/${_t}`}),Lt=yield fetch(Ut);if(!Lt.ok)throw new DidError$1(DidErrorCode$1.NotFound,`Unable to find DID document for: ${_t}`);const{didDocument:jt,didDocumentMetadata:Kt}=yield Lt.json();return Object.assign(Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),jt&&{didDocument:jt}),{didDocumentMetadata:Object.assign({published:(kt=Kt==null?void 0:Kt.method)===null||kt===void 0?void 0:kt.published},Kt)})}catch(Ut){if(!(Ut instanceof DidError$1))throw new Error(Ut);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:Object.assign({error:Ut.code},Ut.message&&{errorMessage:Ut.message})})}})}};DidIon$1.methodName="ion";let DidIonUtils$1=class Wi{static appendPathToUrl({baseUrl:e,path:_t}){const At=new URL(e);return At.pathname=At.pathname.endsWith("/")?At.pathname:At.pathname+"/",At.pathname+=_t.startsWith("/")?_t.substring(1):_t,At.toString()}static computeLongFormDidUri(e){return __awaiter$18(this,arguments,void 0,function*({recoveryKey:_t,updateKey:At,services:xt,verificationMethods:kt}){const Bt=yield Wi.createIonDocument({services:xt,verificationMethods:kt}),Nt=Wi.normalizeJwk(_t),Ut=Wi.normalizeJwk(At);return yield IonDid.createLongFormDid({document:Bt,recoveryKey:Nt,updateKey:Ut})})}static constructCreateRequest(e){return __awaiter$18(this,arguments,void 0,function*({ionDocument:_t,recoveryKey:At,updateKey:xt}){return yield IonRequest.createCreateRequest({document:_t,recoveryKey:Wi.normalizeJwk(At),updateKey:Wi.normalizeJwk(xt)})})}static createIonDocument(e){return __awaiter$18(this,arguments,void 0,function*({services:_t,verificationMethods:At}){var xt,kt;const Bt=[];for(const Lt of At){let jt=(kt=(xt=Lt.id)!==null&&xt!==void 0?xt:Lt.publicKeyJwk.kid)!==null&&kt!==void 0?kt:yield computeJwkThumbprint$1({jwk:Lt.publicKeyJwk});jt=`${jt.split("#").pop()}`;const Kt={id:jt,publicKeyJwk:Wi.normalizeJwk(Lt.publicKeyJwk),purposes:Lt.purposes,type:"JsonWebKey2020"};Bt.push(Kt)}const Nt=_t.map(Lt=>Object.assign(Object.assign({},Lt),{id:`${Lt.id.split("#").pop()}`}));return{publicKeys:Bt,services:Nt}})}static normalizeJwk(e){const _t=e.kty;let At;if(_t==="EC")At={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(_t==="oct")At={k:e.k,kty:e.kty};else if(_t==="OKP")At={crv:e.crv,kty:e.kty,x:e.x};else if(_t==="RSA")At={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${_t}`);return At}};var __awaiter$17=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidJwk$1=class yo extends DidMethod$1{static create(){return __awaiter$17(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$2,options:_t={}}={}){var At,xt,kt,Bt;if(_t.algorithm&&_t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(_t.verificationMethods&&_t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Nt=(Bt=(At=_t.algorithm)!==null&&At!==void 0?At:(kt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt[0])===null||kt===void 0?void 0:kt.algorithm)!==null&&Bt!==void 0?Bt:"Ed25519",Ut=yield e.generateKey({algorithm:Nt}),Lt=yield e.getPublicKey({keyUri:Ut}),jt=Convert.object(Lt).toBase64Url(),Kt=`did:${yo.methodName}:${jt}`,zt=(yield yo.resolve(Kt)).didDocument;return new BearerDid$1({uri:Kt,document:zt,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$17(this,arguments,void 0,function*({didDocument:_t}){var At;const xt=Did$1.parse(_t.id);if(xt&&xt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${xt.method}`);const[kt]=(At=_t.verificationMethod)!==null&&At!==void 0?At:[];if(!(kt&&kt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return kt})}static import(e){return __awaiter$17(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$2}){const xt=Did$1.parse(_t.uri);if((xt==null?void 0:xt.method)!==yo.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");const kt=yield BearerDid$1.import({portableDid:_t,keyManager:At});if(kt.document.verificationMethod.length!==1)throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"DID document must contain exactly one verification method");return kt})}static resolve(e,_t){return __awaiter$17(this,void 0,void 0,function*(){const At=Did$1.parse(e);let xt;try{xt=Convert.base64Url(At.id).toObject()}catch{}if(!At||!xt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"invalidDid"}});if(At.method!==yo.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"methodNotSupported"}});const kt={"@context":["https://www.w3.org/ns/did/v1"],id:At.uri},Bt=`${kt.id}#0`;switch(kt.verificationMethod=[{id:Bt,type:"JsonWebKey",controller:kt.id,publicKeyJwk:xt}],kt.authentication=[Bt],kt.assertionMethod=[Bt],kt.capabilityInvocation=[Bt],kt.capabilityDelegation=[Bt],kt.keyAgreement=[Bt],xt.use){case"sig":{delete kt.keyAgreement;break}case"enc":{delete kt.authentication,delete kt.assertionMethod,delete kt.capabilityInvocation,delete kt.capabilityDelegation;break}}return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:kt})})}};DidJwk$1.methodName="jwk";var __awaiter$16=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidKeyRegisteredKeyType$1;(function($t){$t.Ed25519="Ed25519",$t.secp256k1="secp256k1",$t.secp256r1="secp256r1",$t.X25519="X25519"})(DidKeyRegisteredKeyType$1||(DidKeyRegisteredKeyType$1={}));const DidKeyVerificationMethodType$1={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},AlgorithmToKeyTypeMap$3={Ed25519:DidKeyRegisteredKeyType$1.Ed25519,ES256K:DidKeyRegisteredKeyType$1.secp256k1,ES256:DidKeyRegisteredKeyType$1.secp256r1,"P-256":DidKeyRegisteredKeyType$1.secp256r1,secp256k1:DidKeyRegisteredKeyType$1.secp256k1,secp256r1:DidKeyRegisteredKeyType$1.secp256r1,X25519:DidKeyRegisteredKeyType$1.X25519};let DidKey$1=class Ci extends DidMethod$1{static create(){return __awaiter$16(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$2,options:_t={}}={}){var At,xt,kt,Bt;if(_t.algorithm&&_t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(_t.verificationMethods&&_t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Nt=(Bt=(At=_t.algorithm)!==null&&At!==void 0?At:(kt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt[0])===null||kt===void 0?void 0:kt.algorithm)!==null&&Bt!==void 0?Bt:"Ed25519",Ut=yield e.generateKey({algorithm:Nt}),Lt=yield e.getPublicKey({keyUri:Ut}),jt=yield DidKeyUtils$1.publicKeyToMultibaseId({publicKey:Lt}),Kt=`did:${Ci.methodName}:${jt}`,zt=(yield Ci.resolve(Kt,_t)).didDocument;return new BearerDid$1({uri:Kt,document:zt,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$16(this,arguments,void 0,function*({didDocument:_t}){var At;const xt=Did$1.parse(_t.id);if(xt&&xt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${xt.method}`);const[kt]=_t.assertionMethod||[],Bt=(At=_t.verificationMethod)===null||At===void 0?void 0:At.find(Nt=>Nt.id===kt);if(!(Bt&&Bt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static import(e){return __awaiter$16(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager$2}){const xt=Did$1.parse(_t.uri);if((xt==null?void 0:xt.method)!==Ci.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");const kt=yield BearerDid$1.import({portableDid:_t,keyManager:At});if(kt.document.verificationMethod.length!==1)throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"DID document must contain exactly one verification method");return kt})}static resolve(e,_t){return __awaiter$16(this,void 0,void 0,function*(){try{const At=yield Ci.createDocument({didUri:e,options:_t});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:At})}catch(At){if(!(At instanceof DidError$1))throw new Error(At);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:Object.assign({error:At.code},At.message&&{errorMessage:At.message})})}})}static createDocument(e){return __awaiter$16(this,arguments,void 0,function*({didUri:_t,options:At={}}){const{defaultContext:xt="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:kt=!1,enableExperimentalPublicKeyTypes:Bt=!1,publicKeyFormat:Nt="JsonWebKey2020"}=At,Ut={id:""},Lt=Did$1.parse(_t);if(!Lt)throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid DID URI: ${_t}`);const jt=Lt.id;if(Lt.method!==Ci.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${Lt.method}`);if(!Ci.validateIdentifier(Lt))throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid DID URI: ${_t}`);const Kt=yield Ci.createSignatureMethod({didUri:_t,multibaseValue:jt,options:{enableExperimentalPublicKeyTypes:Bt,publicKeyFormat:Nt}});if(Ut.id=Lt.uri,Ut.verificationMethod=[Kt],Ut.authentication=[Kt.id],Ut.assertionMethod=[Kt.id],Ut.capabilityInvocation=[Kt.id],Ut.capabilityDelegation=[Kt.id],kt===!0){const Vt=Nt==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",Ht=yield this.createEncryptionMethod({didUri:_t,multibaseValue:jt,options:{enableExperimentalPublicKeyTypes:Bt,publicKeyFormat:Vt}});Ut.verificationMethod.push(Ht),Ut.keyAgreement=[Ht.id]}const qt=[xt];return getVerificationMethodTypes$1({didDocument:Ut}).forEach(Vt=>{const Ht=DidKeyVerificationMethodType$1[Vt];qt.push(Ht)}),Ut["@context"]=qt,Ut})}static createEncryptionMethod(e){return __awaiter$16(this,arguments,void 0,function*({didUri:_t,multibaseValue:At,options:xt}){const{enableExperimentalPublicKeyTypes:kt,publicKeyFormat:Bt}=xt,Nt={id:"",type:"",controller:""},{keyBytes:Ut,multicodecCode:Lt}=yield Ci.deriveEncryptionKey({multibaseValue:At}),jt=Ut.byteLength,Kt=DidKeyUtils$1.MULTICODEC_PUBLIC_KEY_LENGTH[Lt];if(jt!==Kt)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyLength,`Expected ${jt} bytes. Actual: ${Kt}`);const qt=keyBytesToMultibaseId$1({keyBytes:Ut,multicodecCode:Lt});Nt.id=`${_t}#${qt}`;try{new URL(Nt.id)}catch{throw new DidError$1(DidErrorCode$1.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(Bt in DidKeyVerificationMethodType$1))throw new DidError$1(DidErrorCode$1.UnsupportedPublicKeyType,`Unsupported format: ${Bt}`);if(kt===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(Bt))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Specified '${Bt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Nt.type=Bt,Nt.controller=_t,Bt==="X25519KeyAgreementKey2020"&&(Nt.publicKeyMultibase=qt),Bt==="JsonWebKey2020"){const{crv:Vt}=yield DidKeyUtils$1.multicodecToJwk({code:Lt});Nt.publicKeyJwk=yield DidKeyUtils$1.keyConverter(Vt).bytesToPublicKey({publicKeyBytes:Ut})}return Nt})}static createSignatureMethod(e){return __awaiter$16(this,arguments,void 0,function*({didUri:_t,multibaseValue:At,options:xt}){const{enableExperimentalPublicKeyTypes:kt,publicKeyFormat:Bt}=xt,Nt={id:"",type:"",controller:""},{keyBytes:Ut,multicodecCode:Lt,multicodecName:jt}=multibaseIdToKeyBytes$1({multibaseKeyId:At}),Kt=Ut.byteLength,qt=DidKeyUtils$1.MULTICODEC_PUBLIC_KEY_LENGTH[Lt];if(Kt!==qt)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyLength,`Expected ${Kt} bytes. Actual: ${qt}`);let zt=!1;switch(jt){case"secp256k1-pub":zt=yield Secp256k1$1.validatePublicKey({publicKeyBytes:Ut});break;case"ed25519-pub":zt=yield Ed25519$1.validatePublicKey({publicKeyBytes:Ut});break;case"x25519-pub":zt=!0;break}if(!zt)throw new DidError$1(DidErrorCode$1.InvalidPublicKey,"Invalid public key detected.");Nt.id=`${_t}#${At}`;try{new URL(Nt.id)}catch{throw new DidError$1(DidErrorCode$1.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(Bt in DidKeyVerificationMethodType$1))throw new DidError$1(DidErrorCode$1.UnsupportedPublicKeyType,`Unsupported format: ${Bt}`);if(kt===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(Bt))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Specified '${Bt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Nt.type=Bt,Nt.controller=_t,Bt==="Ed25519VerificationKey2020"&&(Nt.publicKeyMultibase=At),Bt==="JsonWebKey2020"){const{crv:Ht}=yield DidKeyUtils$1.multicodecToJwk({code:Lt});Nt.publicKeyJwk=yield DidKeyUtils$1.keyConverter(Ht).bytesToPublicKey({publicKeyBytes:Ut})}return Nt})}static deriveEncryptionKey(e){return __awaiter$16(this,arguments,void 0,function*({multibaseValue:_t}){let At={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:xt,multicodecCode:kt}=multibaseIdToKeyBytes$1({multibaseKeyId:_t});if(kt===237){const Bt=yield DidKeyUtils$1.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:xt}),Nt=yield Ed25519$1.convertPublicKeyToX25519({publicKey:Bt});At={keyBytes:yield DidKeyUtils$1.keyConverter("Ed25519").publicKeyToBytes({publicKey:Nt}),multicodecCode:236}}return At})}static validateIdentifier(e){const{method:_t,id:At}=e,[xt]=e.uri.split(":",1);return xt==="did"&&_t==="key"&&Number("1")>0&&universalTypeOf(At)==="String"&&At.startsWith("z")}};DidKey$1.methodName="key";let DidKeyUtils$1=class no{static jwkToMulticodec(e){return __awaiter$16(this,arguments,void 0,function*({jwk:_t}){const At=[];_t.crv&&(At.push(_t.crv),_t.d?At.push("private"):At.push("public"));const xt=At.join(":"),kt=no.JWK_TO_MULTICODEC[xt];if(kt===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${xt}'`);return{code:Multicodec.getCodeFromName({name:kt}),name:kt}})}static keyCompressor(e){const At={"P-256":Secp256r1$1.compressPublicKey,secp256k1:Secp256k1$1.compressPublicKey}[e];if(!At)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static keyConverter(e){const At={Ed25519:Ed25519$1,"P-256":Secp256r1$1,secp256k1:Secp256k1$1,X25519:X25519$1}[e];if(!At)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static multicodecToJwk(e){return __awaiter$16(this,arguments,void 0,function*({code:_t,name:At}){if(!(At?!_t:_t))throw new Error("Either 'name' or 'code' must be defined, but not both.");At=At===void 0?Multicodec.getNameFromCode({code:_t}):At;const xt=At,kt=no.MULTICODEC_TO_JWK[xt];if(kt===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},kt)})}static publicKeyToMultibaseId(e){return __awaiter$16(this,arguments,void 0,function*({publicKey:_t}){var At;if(!(_t!=null&&_t.crv&&_t.crv in AlgorithmToKeyTypeMap$3))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(At=_t==null?void 0:_t.crv)!==null&&At!==void 0?At:"undefined"}`);let xt=yield no.keyConverter(_t.crv).publicKeyToBytes({publicKey:_t});/^(secp256k1|P-256|P-384|P-521)$/.test(_t.crv)&&(xt=yield no.keyCompressor(_t.crv)({publicKeyBytes:xt}));const{name:kt}=yield no.jwkToMulticodec({jwk:_t});return keyBytesToMultibaseId$1({keyBytes:xt,multicodecName:kt})})}};DidKeyUtils$1.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};DidKeyUtils$1.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};DidKeyUtils$1.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var __awaiter$15=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let DidWeb$1=class Zo extends DidMethod$1{static resolve(e,_t){return __awaiter$15(this,void 0,void 0,function*(){const At=Did$1.parse(e);if(!At)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"invalidDid"}});if(At.method!==Zo.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"methodNotSupported"}});let xt=`https://${At.id.replace(/:/g,"/")}`;xt=decodeURIComponent(xt);const kt=At.id.includes(":")?`${xt}/did.json`:`${xt}/.well-known/did.json`;try{const Bt=yield fetch(kt);if(!Bt.ok)throw new Error("HTTP error status code returned");const Nt=yield Bt.json();return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:Nt})}catch{return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"notFound"}})}})}};DidWeb$1.methodName="web";var __awaiter$14=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DidResolverCacheLevel{constructor({db:e,location:_t="DATA/DID_RESOLVERCACHE",ttl:At="15m"}={}){this.cache=e??new Level$1(_t),this.ttl=ms$1(At)}get(e){return __awaiter$14(this,void 0,void 0,function*(){try{const _t=yield this.cache.get(e),At=JSON.parse(_t);if(Date.now()>=At.ttlMillis){this.cache.nextTick(()=>this.cache.del(e));return}else return At.value}catch(_t){if(_t.notFound)return;throw _t}})}set(e,_t){const At={ttlMillis:Date.now()+this.ttl,value:_t},xt=JSON.stringify(At);return this.cache.put(e,xt)}delete(e){return this.cache.del(e)}clear(){return this.cache.clear()}close(){return this.cache.close()}}const DidResolverCacheNoop$1={get:function($t){return null},set:function($t,e){return null},delete:function($t){return null},clear:function(){return null},close:function(){return null}};var __awaiter$13=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let UniversalResolver$1=class{constructor({cache:e,didResolvers:_t}){this.didResolvers=new Map,this.cache=e||DidResolverCacheNoop$1;for(const At of _t)this.didResolvers.set(At.methodName,At)}resolve(e,_t){return __awaiter$13(this,void 0,void 0,function*(){const At=Did$1.parse(e);if(!At)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:DidErrorCode$1.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const xt=this.didResolvers.get(At.method);if(!xt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:DidErrorCode$1.MethodNotSupported,errorMessage:`Method not supported: ${At.method}`}});const kt=yield this.cache.get(At.uri);if(kt)return kt;{const Bt=yield xt.resolve(At.uri,_t);return Bt.didResolutionMetadata.error||(yield this.cache.set(At.uri,Bt)),Bt}})}dereference(e,_t){return __awaiter$13(this,void 0,void 0,function*(){const At=Did$1.parse(e);if(!At)return{dereferencingMetadata:{error:DidErrorCode$1.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:xt,didResolutionMetadata:kt,didDocumentMetadata:Bt}=yield this.resolve(At.uri);if(!xt)return{dereferencingMetadata:{error:kt.error},contentStream:null,contentMetadata:{}};if(!At.fragment||At.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:xt,contentMetadata:Bt};const{service:Nt=[],verificationMethod:Ut=[]}=xt,Lt=new Set([e,At.fragment,`#${At.fragment}`]);let jt;for(let Kt of Ut)if(Lt.has(Kt.id)){jt=Kt;break}for(let Kt of Nt)if(Lt.has(Kt.id)){jt=Kt;break}return jt?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:jt,contentMetadata:kt}:{dereferencingMetadata:{error:DidErrorCode$1.NotFound},contentStream:null,contentMetadata:{}}})}};var __awaiter$12=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class AgentDidResolverCache extends DidResolverCacheLevel{constructor({agent:e,db:_t,location:At,ttl:xt}){super({db:_t,location:At,ttl:xt}),this._resolving=new Map,this._agent=e}get agent(){if(!this._agent)throw new Error("Agent not initialized");return this._agent}set agent(e){this._agent=e}get(e){return __awaiter$12(this,void 0,void 0,function*(){try{const _t=yield this.cache.get(e),At=JSON.parse(_t);if(!this._resolving.has(e)&&Date.now()>=At.ttlMillis)if(this._resolving.set(e,!0),this.agent.agentDid.uri===e||typeof(yield this.agent.identity.get({didUri:e}))<"u")try{const xt=yield this.agent.did.resolve(e);xt.didResolutionMetadata.error||this.set(e,xt)}finally{this._resolving.delete(e)}else this._resolving.delete(e),this.cache.nextTick(()=>this.cache.del(e));return At.value}catch(_t){if(_t.notFound)return;throw _t}})}}var __awaiter$11=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class BearerIdentity{constructor({did:e,metadata:_t}){this.did=e,this.metadata=_t}export(){return __awaiter$11(this,void 0,void 0,function*(){return{portableDid:yield this.did.export(),metadata:this.metadata}})}}var __awaiter$10=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Hkdf{static deriveKeyBytes({baseKeyBytes:e,length:_t,hash:At,salt:xt,info:kt=new Uint8Array}){return __awaiter$10(this,void 0,void 0,function*(){const Nt=yield getWebcryptoSubtle().importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]);xt=typeof xt=="string"?Convert.string(xt).toUint8Array():xt,kt=typeof kt=="string"?Convert.string(kt).toUint8Array():kt;const Ut=yield crypto.subtle.deriveBits({name:"HKDF",hash:At,salt:xt,info:kt},Nt,_t);return new Uint8Array(Ut)})}}var __awaiter$$=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$i=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class HkdfAlgorithm extends CryptoAlgorithm$1{deriveKeyBytes(e){var{algorithm:_t}=e,At=__rest$i(e,["algorithm"]);return __awaiter$$(this,void 0,void 0,function*(){const xt={"HKDF-256":"SHA-256","HKDF-384":"SHA-384","HKDF-512":"SHA-512"}[_t];return yield Hkdf.deriveKeyBytes(Object.assign(Object.assign({},At),{hash:xt}))})}}class CryptoError extends Error{constructor(e,_t){super(_t),this.code=e,this.name="CryptoError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,CryptoError)}}var CryptoErrorCode;(function($t){$t.AlgorithmNotSupported="algorithmNotSupported",$t.EncodingError="encodingError",$t.InvalidJwe="invalidJwe",$t.InvalidJwk="invalidJwk",$t.OperationNotSupported="operationNotSupported"})(CryptoErrorCode||(CryptoErrorCode={}));var __awaiter$_=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let EcdsaAlgorithm$1=class extends CryptoAlgorithm$1{bytesToPrivateKey({algorithm:e,privateKeyBytes:_t}){return __awaiter$_(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const At=yield Secp256k1$1.bytesToPrivateKey({privateKeyBytes:_t});return At.alg="EdDSA",At}case"ES256":case"secp256r1":{const At=yield Secp256r1$1.bytesToPrivateKey({privateKeyBytes:_t});return At.alg="EdDSA",At}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:_t}){return __awaiter$_(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const At=yield Secp256k1$1.bytesToPublicKey({publicKeyBytes:_t});return At.alg="EdDSA",At}case"ES256":case"secp256r1":{const At=yield Secp256r1$1.bytesToPublicKey({publicKeyBytes:_t});return At.alg="EdDSA",At}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return __awaiter$_(this,void 0,void 0,function*(){if(!isEcPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const _t=yield Secp256k1$1.computePublicKey({key:e});return _t.alg="ES256K",_t}case"P-256":{const _t=yield Secp256r1$1.computePublicKey({key:e});return _t.alg="ES256",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$_(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const _t=yield Secp256k1$1.generateKey();return _t.alg="ES256K",_t}case"ES256":case"secp256r1":{const _t=yield Secp256r1$1.generateKey();return _t.alg="ES256",_t}}})}getPublicKey({key:e}){return __awaiter$_(this,void 0,void 0,function*(){if(!isEcPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const _t=yield Secp256k1$1.getPublicKey({key:e});return _t.alg="ES256K",_t}case"P-256":{const _t=yield Secp256r1$1.getPublicKey({key:e});return _t.alg="ES256",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return __awaiter$_(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Secp256k1$1.privateKeyToBytes({privateKey:e});case"P-256":return yield Secp256r1$1.privateKeyToBytes({privateKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return __awaiter$_(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Secp256k1$1.publicKeyToBytes({publicKey:e});case"P-256":return yield Secp256r1$1.publicKeyToBytes({publicKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:_t}){return __awaiter$_(this,void 0,void 0,function*(){if(!isEcPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield Secp256k1$1.sign({key:e,data:_t});case"P-256":return yield Secp256r1$1.sign({key:e,data:_t});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:_t,data:At}){return __awaiter$_(this,void 0,void 0,function*(){if(!isEcPublicJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield Secp256k1$1.verify({key:e,signature:_t,data:At});case"P-256":return yield Secp256r1$1.verify({key:e,signature:_t,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}};var __awaiter$Z=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};let EdDsaAlgorithm$1=class extends CryptoAlgorithm$1{bytesToPrivateKey({algorithm:e,privateKeyBytes:_t}){return __awaiter$Z(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const At=yield Ed25519$1.bytesToPrivateKey({privateKeyBytes:_t});return At.alg="EdDSA",At}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:_t}){return __awaiter$Z(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const At=yield Ed25519$1.bytesToPublicKey({publicKeyBytes:_t});return At.alg="EdDSA",At}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return __awaiter$Z(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const _t=yield Ed25519$1.computePublicKey({key:e});return _t.alg="EdDSA",_t}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$Z(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const _t=yield Ed25519$1.generateKey();return _t.alg="EdDSA",_t}}})}getPublicKey({key:e}){return __awaiter$Z(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const _t=yield Ed25519$1.getPublicKey({key:e});return _t.alg="EdDSA",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return __awaiter$Z(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield Ed25519$1.privateKeyToBytes({privateKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return __awaiter$Z(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield Ed25519$1.publicKeyToBytes({publicKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:_t}){return __awaiter$Z(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield Ed25519$1.sign({key:e,data:_t});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}verify({key:e,signature:_t,data:At}){return __awaiter$Z(this,void 0,void 0,function*(){if(!isOkpPublicJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield Ed25519$1.verify({key:e,signature:_t,data:At});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}};var __awaiter$Y=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$h=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const AES_KEY_LENGTHS=[128,192,256];class AesKw{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$Y(this,void 0,void 0,function*(){const _t={k:Convert.uint8Array(e).toBase64Url(),kty:"oct"};_t.kid=yield computeJwkThumbprint$1({jwk:_t});const At=e.length*8;return _t.alg={128:"A128KW",192:"A192KW",256:"A256KW"}[At],_t})}static generateKey({length:e}){return __awaiter$Y(this,void 0,void 0,function*(){if(!AES_KEY_LENGTHS.includes(e))throw new RangeError(`The key length is invalid: Must be ${AES_KEY_LENGTHS.join(", ")} bits`);const _t=getWebcryptoSubtle(),At=yield _t.generateKey({name:"AES-KW",length:e},!0,["wrapKey","unwrapKey"]),xt=yield _t.exportKey("jwk",At),kt=__rest$h(xt,["ext","key_ops"]);return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static privateKeyToBytes({privateKey:e}){return __awaiter$Y(this,void 0,void 0,function*(){if(!isOctPrivateJwk(e))throw new Error("AesKw: The provided key is not a valid oct private key.");return Convert.base64Url(e.k).toUint8Array()})}static unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:_t,decryptionKey:At}){return __awaiter$Y(this,void 0,void 0,function*(){if(!("alg"in At&&At.alg))throw new CryptoError(CryptoErrorCode.InvalidJwk,"The decryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(At.alg))throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'decryptionKey' algorithm is not supported: ${At.alg}`);const xt=getWebcryptoSubtle(),kt=yield xt.importKey("jwk",At,{name:"AES-KW"},!0,["unwrapKey"]),Bt={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[_t];if(!Bt)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'wrappedKeyAlgorithm' is not supported: ${_t}`);const Nt=yield xt.unwrapKey("raw",e.buffer,kt,"AES-KW",{name:Bt},!0,["unwrapKey"]),Ut=yield xt.exportKey("jwk",Nt),jt=__rest$h(Ut,["ext","key_ops"]);return jt.kid=yield computeJwkThumbprint$1({jwk:jt}),jt})}static wrapKey({unwrappedKey:e,encryptionKey:_t}){return __awaiter$Y(this,void 0,void 0,function*(){if(!("alg"in _t&&_t.alg))throw new CryptoError(CryptoErrorCode.InvalidJwk,"The encryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(_t.alg))throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'encryptionKey' algorithm is not supported: ${_t.alg}`);if(!("alg"in e&&e.alg))throw new CryptoError(CryptoErrorCode.InvalidJwk,"The private key to wrap is missing the 'alg' property.");const At=getWebcryptoSubtle(),xt=yield At.importKey("jwk",_t,{name:"AES-KW"},!0,["wrapKey"]),kt={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[e.alg];if(!kt)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'unwrappedKey' algorithm is not supported: ${e.alg}`);const Bt=yield At.importKey("jwk",e,{name:kt},!0,["unwrapKey"]),Nt=yield At.wrapKey("raw",Bt,xt,"AES-KW");return new Uint8Array(Nt)})}}var __awaiter$X=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class AesKwAlgorithm extends CryptoAlgorithm$1{bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$X(this,void 0,void 0,function*(){const _t=yield AesKw.bytesToPrivateKey({privateKeyBytes:e});return _t.alg={16:"A128KW",24:"A192KW",32:"A256KW"}[e.length],_t})}generateKey({algorithm:e}){return __awaiter$X(this,void 0,void 0,function*(){const _t={A128KW:128,A192KW:192,A256KW:256}[e],At=yield AesKw.generateKey({length:_t});return At.alg=e,At})}privateKeyToBytes({privateKey:e}){return __awaiter$X(this,void 0,void 0,function*(){return yield AesKw.privateKeyToBytes({privateKey:e})})}unwrapKey(e){return __awaiter$X(this,void 0,void 0,function*(){return yield AesKw.unwrapKey(e)})}wrapKey(e){return __awaiter$X(this,void 0,void 0,function*(){return AesKw.wrapKey(e)})}}var __awaiter$W=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Pbkdf2{static deriveKeyBytes({baseKeyBytes:e,hash:_t,salt:At,iterations:xt,length:kt}){return __awaiter$W(this,void 0,void 0,function*(){const Bt=getWebcryptoSubtle(),Nt=yield Bt.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]),Ut=yield Bt.deriveBits({name:"PBKDF2",hash:_t,salt:At,iterations:xt},Nt,kt);return new Uint8Array(Ut)})}}var __awaiter$V=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$g=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Pbkdf2Algorithm extends CryptoAlgorithm$1{deriveKeyBytes(e){var{algorithm:_t}=e,At=__rest$g(e,["algorithm"]);return __awaiter$V(this,void 0,void 0,function*(){const[,xt]=_t.split(/[-+]/),kt={HS256:"SHA-256",HS384:"SHA-384",HS512:"SHA-512"}[xt];return yield Pbkdf2.deriveKeyBytes(Object.assign(Object.assign({},At),{hash:kt}))})}}var __awaiter$U=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class AesGcmAlgorithm extends CryptoAlgorithm$1{bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$U(this,void 0,void 0,function*(){const _t=yield AesGcm.bytesToPrivateKey({privateKeyBytes:e});return _t.alg={16:"A128GCM",24:"A192GCM",32:"A256GCM"}[e.length],_t})}decrypt(e){return __awaiter$U(this,void 0,void 0,function*(){return AesGcm.decrypt(e)})}encrypt(e){return __awaiter$U(this,void 0,void 0,function*(){return AesGcm.encrypt(e)})}generateKey({algorithm:e}){return __awaiter$U(this,void 0,void 0,function*(){const _t={A128GCM:128,A192GCM:192,A256GCM:256}[e],At=yield AesGcm.generateKey({length:_t});return At.alg=e,At})}privateKeyToBytes({privateKey:e}){return __awaiter$U(this,void 0,void 0,function*(){return yield AesGcm.privateKeyToBytes({privateKey:e})})}}var __awaiter$T=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const supportedAlgorithms$2={"AES-GCM":{implementation:AesGcmAlgorithm,names:["A128GCM","A192GCM","A256GCM"],operations:["bytesToPrivateKey","decrypt","encrypt","generateKey"]},"AES-KW":{implementation:AesKwAlgorithm,names:["A128KW","A192KW","A256KW"],operations:["bytesToPrivateKey","generateKey","privateKeyToBytes","wrapKey","unwrapKey"]},Ed25519:{implementation:EdDsaAlgorithm$1,names:["Ed25519"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},HKDF:{implementation:HkdfAlgorithm,names:["HKDF-256","HKDF-384","HKDF-512"],operations:["deriveKey","deriveKeyBytes"]},PBKDF2:{implementation:Pbkdf2Algorithm,names:["PBES2-HS256+A128KW","PBES2-HS384+A192KW","PBES2-HS512+A256KW"],operations:["deriveKey","deriveKeyBytes"]},secp256k1:{implementation:EcdsaAlgorithm$1,names:["ES256K","secp256k1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},secp256r1:{implementation:EcdsaAlgorithm$1,names:["ES256","secp256r1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},"SHA-256":{implementation:Sha2Algorithm$1,names:["SHA-256"],operations:["digest"]}};class AgentCryptoApi{constructor(){this._algorithmInstances=new Map}bytesToPrivateKey({algorithm:e,privateKeyBytes:_t}){return __awaiter$T(this,void 0,void 0,function*(){const At=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:At}).bytesToPrivateKey({algorithm:e,privateKeyBytes:_t})})}bytesToPublicKey({algorithm:e,publicKeyBytes:_t}){return __awaiter$T(this,void 0,void 0,function*(){const At=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:At}).bytesToPublicKey({algorithm:e,publicKeyBytes:_t})})}decrypt(e){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:_t}).decrypt(e)})}deriveKey(e){var _t,At;return __awaiter$T(this,void 0,void 0,function*(){const xt=this.getAlgorithmName({algorithm:e.algorithm}),kt=this.getAlgorithm({algorithm:xt});let Bt;switch(e.algorithm){case"HKDF-256":case"HKDF-384":case"HKDF-512":{Bt=e.derivedKeyAlgorithm;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{Bt=e.algorithm.split(/[-+]/)[2];break}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The specified "algorithm" is not supported: ${e.algorithm}`)}const Nt=+((At=(_t=Bt.match(/\d+/))===null||_t===void 0?void 0:_t[0])!==null&&At!==void 0?At:-1);if(Nt===-1)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The derived key algorithm" is not supported: ${Bt}`);const Ut=yield kt.deriveKeyBytes(Object.assign(Object.assign({},e),{length:Nt}));return yield this.bytesToPrivateKey({algorithm:Bt,privateKeyBytes:Ut})})}deriveKeyBytes(e){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({algorithm:e.algorithm});return yield this.getAlgorithm({algorithm:_t}).deriveKeyBytes(e)})}digest({algorithm:e,data:_t}){return __awaiter$T(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:_t})})}encrypt(e){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:_t}).encrypt(e)})}generateKey(e){var _t;return __awaiter$T(this,void 0,void 0,function*(){const At=this.getAlgorithmName({algorithm:e.algorithm}),kt=yield this.getAlgorithm({algorithm:At}).generateKey({algorithm:e.algorithm});return(_t=kt.kid)!==null&&_t!==void 0||(kt.kid=yield computeJwkThumbprint$1({jwk:kt})),kt})}getKeyUri(e){return __awaiter$T(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}getPublicKey({key:e}){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:_t}).getPublicKey({key:e})})}privateKeyToBytes({privateKey:e}){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:_t}).privateKeyToBytes({privateKey:e})})}publicKeyToBytes({publicKey:e}){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:_t}).publicKeyToBytes({publicKey:e})})}sign({key:e,data:_t}){return __awaiter$T(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:At}).sign({data:_t,key:e})})}unwrapKey(e){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e.decryptionKey});return yield this.getAlgorithm({algorithm:_t}).unwrapKey(e)})}verify({key:e,signature:_t,data:At}){return __awaiter$T(this,void 0,void 0,function*(){const xt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:xt}).verify({key:e,signature:_t,data:At})})}wrapKey(e){return __awaiter$T(this,void 0,void 0,function*(){const _t=this.getAlgorithmName({key:e.encryptionKey});return yield this.getAlgorithm({algorithm:_t}).wrapKey(e)})}getAlgorithm({algorithm:e}){var _t;const At=(_t=supportedAlgorithms$2[e])===null||_t===void 0?void 0:_t.implementation;if(!At)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(At)||this._algorithmInstances.set(At,new At),this._algorithmInstances.get(At)}getAlgorithmName({algorithm:e,key:_t}){var At;const xt=(At=_t==null?void 0:_t.alg)!==null&&At!==void 0?At:e,kt=_t==null?void 0:_t.crv;for(const Bt of Object.keys(supportedAlgorithms$2)){const Nt=supportedAlgorithms$2[Bt].names;if(xt&&Nt.includes(xt))return Bt;if(kt&&Nt.includes(kt))return Bt}throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${xt}, crv=${kt}. Please check the documentation for the list of supported algorithms.`)}}const IdentityProtocolDefinition={protocol:"http://identity.foundation/protocols/web5/identity-store",published:!1,types:{portableDid:{schema:"https://identity.foundation/schemas/web5/portable-did",dataFormats:["application/json"]},identityMetadata:{schema:"https://identity.foundation/schemas/web5/identity-metadata",dataFormats:["application/json"]}},structure:{portableDid:{},identityMetadata:{}}},JwkProtocolDefinition={protocol:"http://identity.foundation/protocols/web5/jwk-store",published:!1,types:{privateJwk:{schema:"https://identity.foundation/schemas/web5/private-jwk",dataFormats:["application/json"]}},structure:{privateJwk:{}}};function isPortableDid($t){return!(!$t||typeof $t!="object"||$t===null)&&"uri"in $t&&"document"in $t&&"metadata"in $t&&(!("keyManager"in $t)||$t.keyManager===void 0)}var __awaiter$S=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$f=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const TENANT_SEPARATOR="^";class DeterministicKeyGenerator extends LocalKeyManager$2{constructor(){super(),this._predefinedKeys=new Map,this._keyGenerator=this._predefinedKeys.keys()}addPredefinedKeys({privateKeys:e}){var _t;return __awaiter$S(this,void 0,void 0,function*(){const At={};for(const xt of e){(_t=xt.kid)!==null&&_t!==void 0||(xt.kid=yield computeJwkThumbprint$1({jwk:xt}));const kt=yield this.getKeyUri({key:xt});At[kt]=xt}this._predefinedKeys=new Map(Object.entries(At)),this._keyGenerator=this._predefinedKeys.keys()})}exportKey({keyUri:e}){return __awaiter$S(this,void 0,void 0,function*(){const _t=this._predefinedKeys.get(e);if(!_t)throw new Error(`DeterministicKeyGenerator.exportKey: Key not found: ${e}`);return _t})}generateKey(e){return __awaiter$S(this,void 0,void 0,function*(){const{value:_t,done:At}=this._keyGenerator.next();if(At)throw new Error("Ran out of predefined keys");return _t})}getPublicKey({keyUri:e}){return __awaiter$S(this,void 0,void 0,function*(){const _t=this._predefinedKeys.get(e);if(!_t)throw new Error(`DeterministicKeyGenerator.getPublicKey: Key not found: ${e}`);return __rest$f(_t,["d"])})}sign({keyUri:e,data:_t}){return __awaiter$S(this,void 0,void 0,function*(){const At=this._predefinedKeys.get(e);if(!At)throw new Error(`DeterministicKeyGenerator.sign: Key not found: ${e}`);return yield Ed25519$1.sign({data:_t,key:At})})}}function getDataStoreTenant({agent:$t,tenant:e,didUri:_t}){return __awaiter$S(this,void 0,void 0,function*(){if(e)return e;if($t.agentDid)return $t.agentDid.uri;if(!_t)throw new Error("Failed to determine tenant DID: 'agent.agentDid', 'tenant', and 'didUri' are undefined");return _t})}var __awaiter$R=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DwnDataStore{constructor(){this.name="DwnDataStore",this._cache=new TtlCache({ttl:ms$1("15 minutes"),max:100}),this._index=new TtlCache({ttl:ms$1("21 days"),max:1e3}),this._protocolInitializedCache=new TtlCache({ttl:ms$1("21 days"),max:1e3}),this._recordProperties={dataFormat:"application/json"}}delete({id:e,agent:_t,tenant:At}){return __awaiter$R(this,void 0,void 0,function*(){const xt=yield getDataStoreTenant({agent:_t,tenant:At,didUri:e});let kt=yield this.lookupRecordId({id:e,tenantDid:xt,agent:_t});if(!kt)return!1;const{reply:{status:Bt}}=yield _t.dwn.processRequest({author:xt,target:xt,messageType:DwnInterface.RecordsDelete,messageParams:{recordId:kt}});if(Bt.code===202)return this._index.delete(`${xt}${TENANT_SEPARATOR}${e}`),this._cache.delete(kt),!0;throw new Error(`${this.name}: Failed to delete '${e}' from store: (${Bt.code}) ${Bt.detail}`)})}get({id:e,agent:_t,tenant:At,useCache:xt=!1}){return __awaiter$R(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant({agent:_t,tenant:At,didUri:e});let Bt=yield this.lookupRecordId({id:e,tenantDid:kt,agent:_t});if(Bt)return yield this.getRecord({recordId:Bt,tenantDid:kt,agent:_t,useCache:xt})})}list({agent:e,tenant:_t}){return __awaiter$R(this,void 0,void 0,function*(){const At=yield getDataStoreTenant({tenant:_t,agent:e});return yield this.getAllRecords({agent:e,tenantDid:At})})}set({id:e,data:_t,tenant:At,agent:xt,preventDuplicates:kt=!0,useCache:Bt=!1}){return __awaiter$R(this,void 0,void 0,function*(){const Nt=yield getDataStoreTenant({agent:xt,tenant:At,didUri:e});if(yield this.initialize({tenant:Nt,agent:xt}),kt&&(yield this.lookupRecordId({id:e,tenantDid:Nt,agent:xt})))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const Ut=Convert.object(_t).toUint8Array(),{message:Lt,reply:{status:jt}}=yield xt.dwn.processRequest({author:Nt,target:Nt,messageType:DwnInterface.RecordsWrite,messageParams:Object.assign({},this._recordProperties),dataStream:new Blob([Ut],{type:"application/json"})});if(!(Lt&&jt.code===202))throw new Error(`${this.name}: Failed to write data to store for ${e}: ${jt.detail}`);this._index.set(`${Nt}${TENANT_SEPARATOR}${e}`,Lt.recordId),Bt&&this._cache.set(Lt.recordId,_t)})}initialize({tenant:e,agent:_t}){return __awaiter$R(this,void 0,void 0,function*(){const At=yield getDataStoreTenant({agent:_t,tenant:e});if(this._protocolInitializedCache.has(At))return;const{reply:{status:xt,entries:kt}}=yield _t.dwn.processRequest({author:At,target:At,messageType:DwnInterface.ProtocolsQuery,messageParams:{filter:{protocol:this._recordProtocolDefinition.protocol}}});if(xt.code!==200)throw new Error(`Failed to query for protocols: ${xt.code} - ${xt.detail}`);(kt==null?void 0:kt.length)===0&&(yield this.installProtocol(At,_t)),this._protocolInitializedCache.set(At,!0)})}getAllRecords(e){return __awaiter$R(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DwnDataStore must implement getAllRecords()")})}getRecord({recordId:e,tenantDid:_t,agent:At,useCache:xt}){var kt;return __awaiter$R(this,void 0,void 0,function*(){if(xt){const Ut=this._cache.get(e);if(Ut)return Ut}const{reply:Bt}=yield At.dwn.processRequest({author:_t,target:_t,messageType:DwnInterface.RecordsRead,messageParams:{filter:{recordId:e}}});if(!(!((kt=Bt.record)===null||kt===void 0)&&kt.data))throw new Error(`${this.name}: Failed to read data from DWN for: ${e}`);const Nt=yield NodeStream.consumeToJson({readable:Bt.record.data});return xt&&this._cache.set(e,Nt),Nt})}installProtocol(e,_t){return __awaiter$R(this,void 0,void 0,function*(){const{reply:{status:At}}=yield _t.dwn.processRequest({author:e,target:e,messageType:DwnInterface.ProtocolsConfigure,messageParams:{definition:this._recordProtocolDefinition}});if(At.code!==202)throw new Error(`Failed to install protocol: ${At.code} - ${At.detail}`)})}lookupRecordId({id:e,tenantDid:_t,agent:At}){return __awaiter$R(this,void 0,void 0,function*(){let xt=this._index.get(`${_t}${TENANT_SEPARATOR}${e}`,{updateAgeOnGet:!0});return xt||(yield this.getAllRecords({agent:At,tenantDid:_t}),xt=this._index.get(`${_t}${TENANT_SEPARATOR}${e}`)),xt})}}class InMemoryDataStore{constructor(){this.name="InMemoryDataStore",this.store=new Map}delete({id:e,agent:_t,tenant:At}){return __awaiter$R(this,void 0,void 0,function*(){const xt=yield getDataStoreTenant({agent:_t,tenant:At,didUri:e});return this.store.has(`${xt}${TENANT_SEPARATOR}${e}`)?(this.store.delete(`${xt}${TENANT_SEPARATOR}${e}`),!0):!1})}get({id:e,agent:_t,tenant:At}){return __awaiter$R(this,void 0,void 0,function*(){const xt=yield getDataStoreTenant({agent:_t,tenant:At,didUri:e});return this.store.get(`${xt}${TENANT_SEPARATOR}${e}`)})}list({agent:e,tenant:_t}){return __awaiter$R(this,void 0,void 0,function*(){const At=yield getDataStoreTenant({tenant:_t,agent:e}),xt=[];for(const[kt,Bt]of this.store.entries())kt.startsWith(`${At}${TENANT_SEPARATOR}`)&&xt.push(Bt);return xt})}set({id:e,data:_t,tenant:At,agent:xt,preventDuplicates:kt}){return __awaiter$R(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant({agent:xt,tenant:At,didUri:e});if(kt&&this.store.has(`${Bt}${TENANT_SEPARATOR}${e}`))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const Nt=structuredClone(_t);this.store.set(`${Bt}${TENANT_SEPARATOR}${e}`,Nt)})}}var __awaiter$Q=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DwnDidStore extends DwnDataStore{constructor(){super(...arguments),this.name="DwnDidStore",this._recordProtocolDefinition=IdentityProtocolDefinition,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"portableDid",schema:this._recordProtocolDefinition.types.portableDid.schema}}delete(e){const _t=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.delete.call(this,e)})}get(e){const _t=Object.create(null,{get:{get:()=>super.get}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.get.call(this,e)})}list(e){const _t=Object.create(null,{list:{get:()=>super.list}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.list.call(this,e)})}set(e){const _t=Object.create(null,{set:{get:()=>super.set}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.set.call(this,e)})}getAllRecords({agent:e,tenantDid:_t}){var At;return __awaiter$Q(this,void 0,void 0,function*(){this._index.clear();const{reply:xt}=yield e.dwn.processRequest({author:_t,target:_t,messageType:DwnInterface.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let kt=[];for(const Bt of(At=xt.entries)!==null&&At!==void 0?At:[]){if(!Bt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Nt=Convert.base64Url(Bt.encodedData).toObject();if(isPortableDid(Nt)){const Ut=`${_t}${TENANT_SEPARATOR}${Nt.uri}`;this._index.set(Ut,Bt.recordId),this._cache.set(Bt.recordId,Nt),kt.push(Nt)}}return kt})}}class InMemoryDidStore extends InMemoryDataStore{constructor(){super(...arguments),this.name="InMemoryDidStore"}delete(e){const _t=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.delete.call(this,e)})}get(e){const _t=Object.create(null,{get:{get:()=>super.get}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.get.call(this,e)})}list(e){const _t=Object.create(null,{list:{get:()=>super.list}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.list.call(this,e)})}set(e){const _t=Object.create(null,{set:{get:()=>super.set}});return __awaiter$Q(this,void 0,void 0,function*(){return yield _t.set.call(this,e)})}}var __awaiter$P=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidInterface;(function($t){$t.Create="Create",$t.Resolve="Resolve"})(DidInterface||(DidInterface={}));function isDidRequest($t,e){return $t.messageType===e}class AgentDidApi extends UniversalResolver$1{constructor({agent:e,didMethods:_t,resolverCache:At,store:xt}){if(!_t)throw new TypeError("AgentDidApi: Required parameter missing: 'didMethods'");super({didResolvers:_t,cache:At??new AgentDidResolverCache({agent:e,location:"DATA/AGENT/DID_CACHE"})}),this._didMethods=new Map,this._agent=e,this._store=xt??new InMemoryDidStore;for(const kt of _t)this._didMethods.set(kt.methodName,kt)}get agent(){if(this._agent===void 0)throw new Error("AgentDidApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,"agent"in this.cache&&(this.cache.agent=e)}create({method:e,tenant:_t,options:At,store:xt}){return __awaiter$P(this,void 0,void 0,function*(){const Bt=yield this.getMethod(e).create({keyManager:this.agent.keyManager,options:At});if(xt??!0){const{uri:Nt,document:Ut,metadata:Lt}=Bt,jt={uri:Nt,document:Ut,metadata:Lt};yield this._store.set({id:jt.uri,data:jt,agent:this.agent,tenant:_t??jt.uri,preventDuplicates:!1,useCache:!0})}return Bt})}export({didUri:e,tenant:_t}){return __awaiter$P(this,void 0,void 0,function*(){const At=yield this.get({didUri:e,tenant:_t});if(!At)throw new Error(`AgentDidApi: Failed to export due to DID not found: ${e}`);return yield At.export()})}get({didUri:e,tenant:_t}){return __awaiter$P(this,void 0,void 0,function*(){const At=yield this._store.get({id:e,agent:this.agent,tenant:_t,useCache:!0});return At?yield BearerDid$1.import({portableDid:At,keyManager:this.agent.keyManager}):void 0})}getSigningMethod({didUri:e,methodId:_t}){return __awaiter$P(this,void 0,void 0,function*(){const At=Did$1.parse(e);if(!At)throw new Error(`Invalid DID URI: ${e}`);const xt=this.getMethod(At.method),{didDocument:kt,didResolutionMetadata:Bt}=yield this.resolve(e);if(!kt)throw new Error(`DID resolution failed for '${e}': ${JSON.stringify(Bt)}`);return yield xt.getSigningMethod({didDocument:kt,methodId:_t})})}import({portableDid:e,tenant:_t}){return __awaiter$P(this,void 0,void 0,function*(){const At=yield BearerDid$1.import({keyManager:this.agent.keyManager,portableDid:e}),{uri:xt,document:kt,metadata:Bt}=At,Nt={uri:xt,document:kt,metadata:Bt};return yield this._store.set({id:Nt.uri,data:Nt,agent:this.agent,tenant:_t??Nt.uri,preventDuplicates:!0,useCache:!0}),At})}delete({didUri:e,tenant:_t,deleteKey:At=!0}){return __awaiter$P(this,void 0,void 0,function*(){const xt=yield this._store.get({id:e,agent:this.agent,tenant:_t,useCache:!1});if(!xt)throw new Error("AgentDidApi: Could not delete, DID not found");yield this._store.delete({id:e,agent:this.agent,tenant:_t}),At&&(yield this.deleteKeys({portableDid:xt}))})}deleteKeys({portableDid:e}){return __awaiter$P(this,void 0,void 0,function*(){for(const _t of e.document.verificationMethod||[]){if(!_t.publicKeyJwk)continue;const At=yield this.agent.keyManager.getKeyUri({key:_t.publicKeyJwk});yield this.agent.keyManager.deleteKey({keyUri:At})}})}processRequest(e){var _t;return __awaiter$P(this,void 0,void 0,function*(){if(isDidRequest(e,DidInterface.Create))try{const At=yield this.create(Object.assign({},e.messageParams));return{result:{uri:At.uri,document:At.document,metadata:At.metadata},ok:!0,status:{code:201,message:"Created"}}}catch(At){return{ok:!1,status:{code:500,message:(_t=At.message)!==null&&_t!==void 0?_t:"Unknown error occurred"}}}if(isDidRequest(e,DidInterface.Resolve)){const{didUri:At,options:xt}=e.messageParams;return{result:yield this.resolve(At,xt),ok:!0,status:{code:200,message:"OK"}}}throw new Error(`AgentDidApi: Unsupported request type: ${e.messageType}`)})}getMethod(e){const _t=this._didMethods.get(e);if(_t===void 0)throw new Error(`DID Method not supported: ${e}`);return _t}}var lib={};Object.defineProperty(lib,"__esModule",{value:!0});var ReadableWebToNodeStream_1=lib.ReadableWebToNodeStream=void 0;const readable_stream_1=readableBrowserExports$1;class ReadableWebToNodeStream extends readable_stream_1.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}async _read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read();const e=await this.pendingRead;delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}ReadableWebToNodeStream_1=lib.ReadableWebToNodeStream=ReadableWebToNodeStream;var __awaiter$O=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function blobToIsomorphicNodeReadable($t){return webReadableToIsomorphicNodeReadable($t.stream())}function getDwnServiceEndpointUrls($t,e){return __awaiter$O(this,void 0,void 0,function*(){const _t=yield e.dereference(`${$t}#dwn`);if(_t.dereferencingMetadata.error)throw new Error(`Failed to dereference '${$t}#dwn': ${_t.dereferencingMetadata.error}`);if(isDwnDidService(_t.contentStream)){const{serviceEndpoint:At}=_t.contentStream,xt=typeof At=="string"?[At]:Array.isArray(At)&&At.every(kt=>typeof kt=="string")?At:[];if(xt.length>0)return xt}return[]})}function getRecordAuthor($t){return Message.getAuthor($t)}function isRecordsWrite($t){return!$t||typeof $t!="object"||$t===null?!1:"message"in $t&&typeof $t.message=="object"&&$t.message!==null&&"descriptor"in $t.message&&typeof $t.message.descriptor=="object"&&$t.message.descriptor!==null&&"interface"in $t.message.descriptor&&$t.message.descriptor.interface===DwnInterfaceName.Records&&"method"in $t.message.descriptor&&$t.message.descriptor.method===DwnMethodName.Write}function getRecordMessageCid($t){return Message.getCid($t)}function getPaginationCursor($t,e){return __awaiter$O(this,void 0,void 0,function*(){const _t=e===DateSort.CreatedAscending||e===DateSort.CreatedDescending?$t.descriptor.dateCreated:$t.descriptor.datePublished;if(_t===void 0)throw new Error("The dateCreated or datePublished property is missing from the record descriptor.");return{messageCid:yield getRecordMessageCid($t),value:_t}})}function webReadableToIsomorphicNodeReadable($t){return new ReadableWebToNodeStream_1($t)}function pollWithTtl($t,e=3e3,_t=3e5,At){const xt=Date.now()+_t;let kt=null,Bt=!0;return new Promise((Nt,Ut)=>{function Lt(){return __awaiter$O(this,void 0,void 0,function*(){if(!Bt)return;const jt=xt-Date.now();if(jt<=0){Bt=!1,console.log("Polling stopped: TTL reached"),Nt(null);return}console.log(`Polling... (Remaining time: ${Math.ceil(jt/1e3)}s)`);try{const Kt=yield $t();if(Kt.ok){Bt=!1,kt!==null&&clearTimeout(kt),console.log("Polling stopped: Success condition met"),Nt(Kt);return}}catch(Kt){console.error("Error fetching data:",Kt),Ut(Kt)}Bt&&(kt=setTimeout(Lt,e))})}Lt()})}function concatenateUrl($t,e){return $t.endsWith("/")&&($t=$t.slice(0,-1)),e.startsWith("/")&&(e=e.slice(1)),`${$t}/${e}`}var __awaiter$N=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function isDwnRequest($t,e){return $t.messageType===e}function isDwnMessage($t,e){return e.descriptor.interface+e.descriptor.method===$t}function isRecordsType($t){return $t===DwnInterface.RecordsDelete||$t===DwnInterface.RecordsQuery||$t===DwnInterface.RecordsRead||$t===DwnInterface.RecordsSubscribe||$t===DwnInterface.RecordsWrite}function isRecordPermissionScope($t){return $t.interface===DwnInterfaceName.Records}class AgentDwnApi{constructor({agent:e,dwn:_t}){this._agent=e,this._dwn=_t}get agent(){if(this._agent===void 0)throw new Error("AgentDwnApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}get node(){return this._dwn}static createDwn({dataPath:e,dataStore:_t,didResolver:At,eventLog:xt,eventStream:kt,messageStore:Bt,tenantGate:Nt,resumableTaskStore:Ut}){return __awaiter$N(this,void 0,void 0,function*(){return _t??(_t=new DataStoreLevel({blockstoreLocation:`${e}/DWN_DATASTORE`})),At??(At=new UniversalResolver$1({didResolvers:[DidDht$1,DidJwk$1],cache:new DidResolverCacheLevel({location:`${e}/DID_RESOLVERCACHE`})})),xt??(xt=new EventLogLevel({location:`${e}/DWN_EVENTLOG`})),Bt??(Bt=new MessageStoreLevel({blockstoreLocation:`${e}/DWN_MESSAGESTORE`,indexLocation:`${e}/DWN_MESSAGEINDEX`})),Ut??(Ut=new ResumableTaskStoreLevel({location:`${e}/DWN_RESUMABLETASKSTORE`})),yield Dwn.create({dataStore:_t,didResolver:At,eventLog:xt,eventStream:kt,messageStore:Bt,tenantGate:Nt,resumableTaskStore:Ut})})}processRequest(e){return __awaiter$N(this,void 0,void 0,function*(){const{message:_t,dataStream:At}=yield this.constructDwnMessage({request:e}),{subscriptionHandler:xt}=e;return{reply:e.store!==!1?yield this._dwn.processMessage(e.target,_t,{dataStream:At,subscriptionHandler:xt}):{status:{code:202,detail:"Accepted"}},message:_t,messageCid:yield Message.getCid(_t)}})}sendRequest(e){return __awaiter$N(this,void 0,void 0,function*(){const _t=yield getDwnServiceEndpointUrls(e.target,this.agent.did);if(_t.length===0)throw new Error(`AgentDwnApi: DID Service is missing or malformed: ${e.target}#dwn`);let At,xt,kt,Bt;if("messageCid"in e)({message:xt,data:kt}=yield this.getDwnMessage({author:e.author,messageCid:e.messageCid,messageType:e.messageType})),At=e.messageCid;else{if({message:xt}=yield this.constructDwnMessage({request:e}),e.dataStream&&!(e.dataStream instanceof Blob))throw new Error("AgentDwnApi: DataStream must be provided as a Blob");kt=e.dataStream,Bt=e.subscriptionHandler}const Nt=yield this.sendDwnRpcRequest({targetDid:e.target,dwnEndpointUrls:_t,message:xt,data:kt,subscriptionHandler:Bt});return At??(At=yield Message.getCid(xt)),{reply:Nt,message:xt,messageCid:At}})}sendDwnRpcRequest({targetDid:e,dwnEndpointUrls:_t,message:At,data:xt,subscriptionHandler:kt}){return __awaiter$N(this,void 0,void 0,function*(){const Bt=[];if(At.descriptor.method===DwnMethodName.Subscribe&&kt===void 0)throw new Error("AgentDwnApi: Subscription handler is required for subscription requests.");for(let Nt of _t)try{if(kt!==void 0){if(!(yield this.agent.rpc.getServerInfo(Nt)).webSocketSupport){Bt.push({url:Nt,message:"WebSocket support is not enabled on the server."});continue}const jt=new URL(Nt);jt.protocol=jt.protocol==="http:"?"ws:":"wss:",Nt=jt.toString()}return yield this.agent.rpc.sendDwnRequest({dwnUrl:Nt,targetDid:e,message:At,data:xt,subscriptionHandler:kt})}catch(Ut){Bt.push({url:Nt,message:Ut instanceof Error?Ut.message:"Unknown error"})}throw new Error(`Failed to send DWN RPC request: ${JSON.stringify(Bt)}`)})}constructDwnMessage({request:e}){var _t;return __awaiter$N(this,void 0,void 0,function*(){if(e.granteeDid&&!this.hasGrantParams(e.messageParams))throw new Error("AgentDwnApi: Requested to sign with a permission but no grant messageParams were provided in the request");const At=e.rawMessage;let xt;if(isDwnRequest(e,DwnInterface.RecordsWrite)){const Nt=e.messageParams;if(e.dataStream&&!(Nt!=null&&Nt.data)){const{dataStream:Ut}=e;let Lt;if(Ut instanceof Blob)Lt=blobToIsomorphicNodeReadable(Ut),xt=blobToIsomorphicNodeReadable(Ut);else if(Ut instanceof ReadableStream){const[jt,Kt]=Ut.tee();Lt=webReadableToIsomorphicNodeReadable(jt),xt=webReadableToIsomorphicNodeReadable(Kt)}At||(Nt.dataCid=yield Cid.computeDagPbCidFromStream(Lt),(_t=Nt.dataSize)!==null&&_t!==void 0||(Nt.dataSize=Lt.bytesRead))}}let kt;const Bt=dwnMessageConstructors[e.messageType];if(At){if(kt=yield Bt.parse(At),isRecordsWrite(kt)&&e.signAsOwner){const Nt=yield this.getSigner(e.author);yield kt.signAsOwner(Nt)}else if(e.granteeDid&&isRecordsWrite(kt)&&e.signAsOwnerDelegate){const Nt=yield this.getSigner(e.granteeDid),Ut=e.messageParams;yield kt.signAsOwnerDelegate(Nt,Ut.delegatedGrant)}}else{const Nt=e.granteeDid?yield this.getSigner(e.granteeDid):yield this.getSigner(e.author);kt=yield Bt.create(Object.assign(Object.assign({},e.messageParams),{signer:Nt}))}return{message:kt.message,dataStream:xt}})}hasGrantParams(e){return e!==void 0&&("permissionGrantId"in e&&e.permissionGrantId!==void 0||"delegatedGrant"in e&&e.delegatedGrant!==void 0)}getSigner(e){return __awaiter$N(this,void 0,void 0,function*(){if(e===this.agent.agentDid.uri){const _t=yield this.agent.agentDid.getSigner();return{algorithm:_t.algorithm,keyId:_t.keyId,sign:At=>__awaiter$N(this,void 0,void 0,function*(){return yield _t.sign({data:At})})}}else try{const _t=yield this.agent.did.getSigningMethod({didUri:e});if(!_t.publicKeyJwk)throw new Error(`Verification method '${_t.id}' does not contain a public key in JWK format`);const At=yield this.agent.keyManager.getKeyUri({key:_t.publicKeyJwk}),xt=yield this.agent.keyManager.getPublicKey({keyUri:At}),kt=this.agent.keyManager;return{algorithm:CryptoUtils.getJoseSignatureAlgorithmFromPublicKey(xt),keyId:_t.id,sign:Bt=>__awaiter$N(this,void 0,void 0,function*(){return yield kt.sign({data:Bt,keyUri:At})})}}catch(_t){throw new Error(`AgentDwnApi: Unable to get signer for author '${e}': ${_t.message}`)}})}getDwnMessage({author:e,messageCid:_t}){return __awaiter$N(this,void 0,void 0,function*(){const At=yield this.getSigner(e),xt=yield dwnMessageConstructors[DwnInterface.MessagesRead].create({messageCid:_t,signer:At}),kt=yield this._dwn.processMessage(e,xt.message);if(kt.status.code!==200)throw new Error(`AgentDwnApi: Failed to read message, response status: ${kt.status.code} - ${kt.status.detail}`);const Bt=kt.entry;let Ut={message:Bt.message};if(isRecordsWrite(Bt)&&Bt.data){const Lt=yield NodeStream.consumeToBytes({readable:Bt.data});Ut.data=new Blob([Lt],{type:Bt.message.descriptor.dataFormat})}return Ut})}}var __awaiter$M=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DwnRegistrar{static registerTenant(e,_t){return __awaiter$M(this,void 0,void 0,function*(){const At=concatenateUrl(e,"registration"),xt=concatenateUrl(At,"terms-of-service"),kt=concatenateUrl(At,"proof-of-work"),Bt=yield fetch(xt,{method:"GET"});if(Bt.status!==200){const Ht=Bt.status,Wt=Bt.statusText,Qt=yield Bt.text();throw new Error(`Failed fetching terms-of-service: ${Ht} ${Wt}: ${Qt}`)}const Nt=yield Bt.text(),Ut=yield fetch(kt,{method:"GET"}),{challengeNonce:Lt,maximumAllowedHashValue:jt}=yield Ut.json(),Kt={did:_t,termsOfServiceHash:yield DwnRegistrar.hashAsHexString(Nt)},qt=yield DwnRegistrar.findQualifiedResponseNonce({challengeNonce:Lt,maximumAllowedHashValue:jt,requestData:JSON.stringify(Kt)}),Vt=yield fetch(At,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({registrationData:Kt,proofOfWork:{challengeNonce:Lt,responseNonce:qt}})});if(Vt.status!==200){const Ht=Vt.status,Wt=Vt.statusText,Qt=yield Vt.text();throw new Error(`Registration failed: ${Ht} ${Wt}: ${Qt}`)}})}static hashAsHexString(e){return __awaiter$M(this,void 0,void 0,function*(){const _t=yield Sha256$1.digest({data:Convert.string(e).toUint8Array()});return Convert.uint8Array(_t).toHex()})}static findQualifiedResponseNonce(e){return __awaiter$M(this,void 0,void 0,function*(){const _t=Date.now(),{maximumAllowedHashValue:At,challengeNonce:xt,requestData:kt}=e,Bt=BigInt(`0x${At}`);let Nt=1,Ut,Lt=!1;do{Ut=yield this.generateNonce();const jt=yield DwnRegistrar.hashAsHexString(xt+Ut+kt);Lt=BigInt(`0x${jt}`)<=Bt,Nt++}while(!Lt);return console.log(`iterations: ${Nt}, time lapsed: ${Date.now()-_t} ms`),Ut})}static generateNonce(){return __awaiter$M(this,void 0,void 0,function*(){const e=CryptoUtils.randomBytes(32);return Convert.uint8Array(e).toHex().toUpperCase()})}}const Rho=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id=Uint8Array.from({length:16},($t,e)=>e),Pi=Id.map($t=>(9*$t+5)%16);let idxL=[Id],idxR=[Pi];for(let $t=0;$t<4;$t++)for(let e of[idxL,idxR])e.push(e[$t].map(_t=>Rho[_t]));const shifts=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map($t=>new Uint8Array($t)),shiftsL=idxL.map(($t,e)=>$t.map(_t=>shifts[e][_t])),shiftsR=idxR.map(($t,e)=>$t.map(_t=>shifts[e][_t])),Kl=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Kr=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),rotl=($t,e)=>$t<<e|$t>>>32-e;function f($t,e,_t,At){return $t===0?e^_t^At:$t===1?e&_t|~e&At:$t===2?(e|~_t)^At:$t===3?e&At|_t&~At:e^(_t|~At)}const BUF=new Uint32Array(16);class RIPEMD160 extends SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:_t,h2:At,h3:xt,h4:kt}=this;return[e,_t,At,xt,kt]}set(e,_t,At,xt,kt){this.h0=e|0,this.h1=_t|0,this.h2=At|0,this.h3=xt|0,this.h4=kt|0}process(e,_t){for(let zt=0;zt<16;zt++,_t+=4)BUF[zt]=e.getUint32(_t,!0);let At=this.h0|0,xt=At,kt=this.h1|0,Bt=kt,Nt=this.h2|0,Ut=Nt,Lt=this.h3|0,jt=Lt,Kt=this.h4|0,qt=Kt;for(let zt=0;zt<5;zt++){const Vt=4-zt,Ht=Kl[zt],Wt=Kr[zt],Qt=idxL[zt],Xt=idxR[zt],Jt=shiftsL[zt],tr=shiftsR[zt];for(let dr=0;dr<16;dr++){const vr=rotl(At+f(zt,kt,Nt,Lt)+BUF[Qt[dr]]+Ht,Jt[dr])+Kt|0;At=Kt,Kt=Lt,Lt=rotl(Nt,10)|0,Nt=kt,kt=vr}for(let dr=0;dr<16;dr++){const vr=rotl(xt+f(Vt,Bt,Ut,jt)+BUF[Xt[dr]]+Wt,tr[dr])+qt|0;xt=qt,qt=jt,jt=rotl(Ut,10)|0,Ut=Bt,Bt=vr}}this.set(this.h1+Nt+jt|0,this.h2+Lt+qt|0,this.h3+Kt+xt|0,this.h4+At+Bt|0,this.h0+kt+Ut|0)}roundClean(){BUF.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const ripemd160=wrapConstructor(()=>new RIPEMD160);/*! micro-ed25519-hdkey - MIT License (c) 2022 Paul Miller (paulmillr.com) */const MASTER_SECRET=utf8ToBytes$2("ed25519 seed"),HARDENED_OFFSET=2147483648,ZERO=new Uint8Array([0]);function ensureBytes$1($t,...e){return typeof $t=="string"&&($t=hexToBytes$1($t)),bytes$1($t,...e),$t}const hash160=$t=>ripemd160(sha256($t)),fromU32=$t=>createView($t).getUint32(0,!1),toU32=$t=>{if(!Number.isSafeInteger($t)||$t<0||$t>2**32-1)throw new Error(`Invalid number=${$t}. Should be from 0 to 2 ** 32 - 1`);const e=new Uint8Array(4);return createView(e).setUint32(0,$t,!1),e};class HDKey{get publicKeyRaw(){return ed25519.getPublicKey(this.privateKey)}get publicKey(){return concatBytes$1(ZERO,this.publicKeyRaw)}get pubHash(){return hash160(this.publicKey)}get fingerprint(){return fromU32(this.pubHash)}get fingerprintHex(){return bytesToHex$1(toU32(this.fingerprint))}get parentFingerprintHex(){return bytesToHex$1(toU32(this.parentFingerprint))}static fromMasterSeed(e){if(e=ensureBytes$1(e),8*e.length<128||8*e.length>512)throw new Error(`HDKey: wrong seed length=${e.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const _t=hmac(sha512,MASTER_SECRET,e);return new HDKey({privateKey:_t.slice(0,32),chainCode:_t.slice(32)})}constructor(e){if(this.depth=0,this.index=0,this.parentFingerprint=0,!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(bytes$1(e.privateKey,32),bytes$1(e.chainCode,32),this.depth=e.depth||0,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");this.chainCode=e.chainCode,this.privateKey=e.privateKey}derive(e,_t=!1){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const At=e.replace(/^[mM]'?\//,"").split("/");let xt=this;for(const kt of At){const Bt=/^(\d+)('?)$/.exec(kt);if(!Bt||Bt.length!==3)throw new Error(`Invalid child index: ${kt}`);let Nt=+Bt[1];if(!Number.isSafeInteger(Nt)||Nt>=HARDENED_OFFSET)throw new Error("Invalid index");(_t||Bt[2]==="'")&&(Nt+=HARDENED_OFFSET),xt=xt.deriveChild(Nt)}return xt}deriveChild(e){if(e<HARDENED_OFFSET)throw new Error(`Non-hardened child derivation not possible for Ed25519 (index=${e})`);const _t=concatBytes$1(ZERO,this.privateKey,toU32(e)),At=hmac(sha512,this.chainCode,_t);return new HDKey({chainCode:At.slice(32),depth:this.depth+1,parentFingerprint:this.fingerprint,index:e,privateKey:At.slice(0,32)})}sign(e){return ed25519.sign(e,this.privateKey)}verify(e,_t){return _t=ensureBytes$1(_t,64),ed25519.verify(_t,e,this.publicKeyRaw)}}const wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);function pbkdf2Init($t,e,_t,At){hash($t);const xt=checkOpts({dkLen:32,asyncTick:10},At),{c:kt,dkLen:Bt,asyncTick:Nt}=xt;if(number(kt),number(Bt),number(Nt),kt<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const Ut=toBytes$1(e),Lt=toBytes$1(_t),jt=new Uint8Array(Bt),Kt=hmac.create($t,Ut),qt=Kt._cloneInto().update(Lt);return{c:kt,dkLen:Bt,asyncTick:Nt,DK:jt,PRF:Kt,PRFSalt:qt}}function pbkdf2Output($t,e,_t,At,xt){return $t.destroy(),e.destroy(),At&&At.destroy(),xt.fill(0),_t}async function pbkdf2Async($t,e,_t,At){const{c:xt,dkLen:kt,asyncTick:Bt,DK:Nt,PRF:Ut,PRFSalt:Lt}=pbkdf2Init($t,e,_t,At);let jt;const Kt=new Uint8Array(4),qt=createView(Kt),zt=new Uint8Array(Ut.outputLen);for(let Vt=1,Ht=0;Ht<kt;Vt++,Ht+=Ut.outputLen){const Wt=Nt.subarray(Ht,Ht+Ut.outputLen);qt.setInt32(0,Vt,!1),(jt=Lt._cloneInto(jt)).update(Kt).digestInto(zt),Wt.set(zt.subarray(0,Wt.length)),await asyncLoop(xt-1,Bt,()=>{Ut._cloneInto(jt).update(zt).digestInto(zt);for(let Qt=0;Qt<Wt.length;Qt++)Wt[Qt]^=zt[Qt]})}return pbkdf2Output(Ut,Lt,Nt,jt,zt)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$2($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}function chain(...$t){const e=kt=>kt,_t=(kt,Bt)=>Nt=>kt(Bt(Nt)),At=$t.map(kt=>kt.encode).reduceRight(_t,e),xt=$t.map(kt=>kt.decode).reduce(_t,e);return{encode:At,decode:xt}}function alphabet($t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(_t=>{if(_t<0||_t>=$t.length)throw new Error(`Digit index outside alphabet: ${_t} (alphabet: ${$t.length})`);return $t[_t]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(_t=>{if(typeof _t!="string")throw new Error(`alphabet.decode: not string element=${_t}`);const At=$t.indexOf(_t);if(At===-1)throw new Error(`Unknown letter: "${_t}". Allowed: ${$t}`);return At})}}}function join($t=""){if(typeof $t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let _t of e)if(typeof _t!="string")throw new Error(`join.encode: non-string input=${_t}`);return e.join($t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split($t)}}}function padding($t,e="="){if(typeof e!="string")throw new Error("padding chr should be string");return{encode(_t){if(!Array.isArray(_t)||_t.length&&typeof _t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let At of _t)if(typeof At!="string")throw new Error(`padding.encode: non-string input=${At}`);for(;_t.length*$t%8;)_t.push(e);return _t},decode(_t){if(!Array.isArray(_t)||_t.length&&typeof _t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let xt of _t)if(typeof xt!="string")throw new Error(`padding.decode: non-string input=${xt}`);let At=_t.length;if(At*$t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;At>0&&_t[At-1]===e;At--)if(!((At-1)*$t%8))throw new Error("Invalid padding: string has too much padding");return _t.slice(0,At)}}}function convertRadix($t,e,_t){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(_t<2)throw new Error(`convertRadix: wrong to=${_t}, base cannot be less than 2`);if(!Array.isArray($t))throw new Error("convertRadix: data should be array");if(!$t.length)return[];let At=0;const xt=[],kt=Array.from($t);for(kt.forEach(Bt=>{if(Bt<0||Bt>=e)throw new Error(`Wrong integer: ${Bt}`)});;){let Bt=0,Nt=!0;for(let Ut=At;Ut<kt.length;Ut++){const Lt=kt[Ut],jt=e*Bt+Lt;if(!Number.isSafeInteger(jt)||e*Bt/e!==Bt||jt-Lt!==e*Bt)throw new Error("convertRadix: carry overflow");Bt=jt%_t;const Kt=Math.floor(jt/_t);if(kt[Ut]=Kt,!Number.isSafeInteger(Kt)||Kt*_t+Bt!==jt)throw new Error("convertRadix: carry overflow");if(Nt)Kt?Nt=!1:At=Ut;else continue}if(xt.push(Bt),Nt)break}for(let Bt=0;Bt<$t.length-1&&$t[Bt]===0;Bt++)xt.push(0);return xt.reverse()}const gcd=($t,e)=>e?gcd(e,$t%e):$t,radix2carry=($t,e)=>$t+(e-gcd($t,e));function convertRadix2($t,e,_t,At){if(!Array.isArray($t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(_t<=0||_t>32)throw new Error(`convertRadix2: wrong to=${_t}`);if(radix2carry(e,_t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${_t} carryBits=${radix2carry(e,_t)}`);let xt=0,kt=0;const Bt=2**_t-1,Nt=[];for(const Ut of $t){if(Ut>=2**e)throw new Error(`convertRadix2: invalid data word=${Ut} from=${e}`);if(xt=xt<<e|Ut,kt+e>32)throw new Error(`convertRadix2: carry overflow pos=${kt} from=${e}`);for(kt+=e;kt>=_t;kt-=_t)Nt.push((xt>>kt-_t&Bt)>>>0);xt&=2**kt-1}if(xt=xt<<_t-kt&Bt,!At&&kt>=e)throw new Error("Excess padding");if(!At&&xt)throw new Error(`Non-zero padding: ${xt}`);return At&&kt>0&&Nt.push(xt>>>0),Nt}function radix($t){return{encode:e=>{if(!isBytes$2(e))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,$t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(convertRadix(e,$t,2**8))}}}function radix2($t,e=!1){if($t<=0||$t>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,$t)>32||radix2carry($t,8)>32)throw new Error("radix2: carry overflow");return{encode:_t=>{if(!isBytes$2(_t))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(_t),8,$t,!e)},decode:_t=>{if(!Array.isArray(_t)||_t.length&&typeof _t[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(convertRadix2(_t,$t,8,e))}}}function checksum($t,e){if(typeof e!="function")throw new Error("checksum fn should be function");return{encode(_t){if(!isBytes$2(_t))throw new Error("checksum.encode: input should be Uint8Array");const At=e(_t).slice(0,$t),xt=new Uint8Array(_t.length+$t);return xt.set(_t),xt.set(At,_t.length),xt},decode(_t){if(!isBytes$2(_t))throw new Error("checksum.decode: input should be Uint8Array");const At=_t.slice(0,-$t),xt=e(At).slice(0,$t),kt=_t.slice(-$t);for(let Bt=0;Bt<$t;Bt++)if(xt[Bt]!==kt[Bt])throw new Error("Invalid checksum");return At}}}const utils={alphabet,chain,checksum,convertRadix,convertRadix2,radix,radix2,join,padding};/*! scure-bip39 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const isJapanese=$t=>$t[0]==="";function nfkd($t){if(typeof $t!="string")throw new TypeError(`Invalid mnemonic type: ${typeof $t}`);return $t.normalize("NFKD")}function normalize($t){const e=nfkd($t),_t=e.split(" ");if(![12,15,18,21,24].includes(_t.length))throw new Error("Invalid mnemonic");return{nfkd:e,words:_t}}function assertEntropy($t){bytes$1($t,16,20,24,28,32)}function generateMnemonic($t,e=128){if(number(e),e%32!==0||e>256)throw new TypeError("Invalid entropy");return entropyToMnemonic(randomBytes$1(e/8),$t)}const calcChecksum=$t=>{const e=8-$t.length/4;return new Uint8Array([sha256($t)[0]>>e<<e])};function getCoder($t){if(!Array.isArray($t)||$t.length!==2048||typeof $t[0]!="string")throw new Error("Wordlist: expected array of 2048 strings");return $t.forEach(e=>{if(typeof e!="string")throw new Error(`Wordlist: non-string element: ${e}`)}),utils.chain(utils.checksum(1,calcChecksum),utils.radix2(11,!0),utils.alphabet($t))}function mnemonicToEntropy($t,e){const{words:_t}=normalize($t),At=getCoder(e).decode(_t);return assertEntropy(At),At}function entropyToMnemonic($t,e){return assertEntropy($t),getCoder(e).encode($t).join(isJapanese(e)?"":" ")}function validateMnemonic($t,e){try{mnemonicToEntropy($t,e)}catch{return!1}return!0}const salt=$t=>nfkd(`mnemonic${$t}`);function mnemonicToSeed($t,e=""){return pbkdf2Async(sha512,normalize($t).nfkd,salt(e),{c:2048,dkLen:64})}var __awaiter$L=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DwnKeyStore extends DwnDataStore{constructor(){super(...arguments),this.name="DwnKeyStore",this._recordProtocolDefinition=JwkProtocolDefinition,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"privateJwk",schema:this._recordProtocolDefinition.types.privateJwk.schema}}delete(e){const _t=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.delete.call(this,e)})}get(e){const _t=Object.create(null,{get:{get:()=>super.get}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.get.call(this,e)})}set(e){const _t=Object.create(null,{set:{get:()=>super.set}});return __awaiter$L(this,void 0,void 0,function*(){yield _t.set.call(this,e)})}list(e){const _t=Object.create(null,{list:{get:()=>super.list}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.list.call(this,e)})}getAllRecords({agent:e,tenantDid:_t}){var At;return __awaiter$L(this,void 0,void 0,function*(){this._index.clear();const{reply:xt}=yield e.dwn.processRequest({author:_t,target:_t,messageType:DwnInterface.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let kt=[];for(const Bt of(At=xt.entries)!==null&&At!==void 0?At:[]){if(!Bt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Nt=Convert.base64Url(Bt.encodedData).toObject();if(isPrivateJwk$1(Nt)){const Ut=`${_t}${TENANT_SEPARATOR}${KEY_URI_PREFIX_JWK$1}${Nt.kid}`;this._index.set(Ut,Bt.recordId),this._cache.set(Bt.recordId,Nt),kt.push(Nt)}}return kt})}}class InMemoryKeyStore extends InMemoryDataStore{constructor(){super(...arguments),this.name="InMemoryKeyStore"}delete(e){const _t=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.delete.call(this,e)})}get(e){const _t=Object.create(null,{get:{get:()=>super.get}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.get.call(this,e)})}list(e){const _t=Object.create(null,{list:{get:()=>super.list}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.list.call(this,e)})}set(e){const _t=Object.create(null,{set:{get:()=>super.set}});return __awaiter$L(this,void 0,void 0,function*(){return yield _t.set.call(this,e)})}}var __awaiter$K=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$e=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const supportedAlgorithms$1={"AES-GCM":{implementation:AesGcmAlgorithm$1,names:["A128GCM","A192GCM","A256GCM"]},"AES-KW":{implementation:AesKwAlgorithm,names:["A128KW","A192KW","A256KW"]},Ed25519:{implementation:EdDsaAlgorithm$2,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$2,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$2,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$1,names:["SHA-256"]}};let LocalKeyManager$1=class{constructor({agent:e,keyStore:_t}={}){this._algorithmInstances=new Map,this._agent=e,this._keyStore=_t??new InMemoryKeyStore}get agent(){if(this._agent===void 0)throw new Error("LocalKeyManager: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}decrypt(e){var{keyUri:_t}=e,At=__rest$e(e,["keyUri"]);return __awaiter$K(this,void 0,void 0,function*(){const xt=yield this.getPrivateKey({keyUri:_t}),kt=this.getAlgorithmName({key:xt});return yield this.getAlgorithm({algorithm:kt}).decrypt(Object.assign({key:xt},At))})}digest(e){throw new Error("Method not implemented.")}encrypt(e){var{keyUri:_t}=e,At=__rest$e(e,["keyUri"]);return __awaiter$K(this,void 0,void 0,function*(){const xt=yield this.getPrivateKey({keyUri:_t}),kt=this.getAlgorithmName({key:xt});return yield this.getAlgorithm({algorithm:kt}).encrypt(Object.assign({key:xt},At))})}exportKey({keyUri:e}){return __awaiter$K(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){var _t;return __awaiter$K(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:{alg:e}}),kt=yield this.getAlgorithm({algorithm:At}).generateKey({algorithm:e});(_t=kt.kid)!==null&&_t!==void 0||(kt.kid=yield computeJwkThumbprint$1({jwk:kt}));const Bt=yield this.getKeyUri({key:kt});return yield this._keyStore.set({id:Bt,data:kt,agent:this.agent,preventDuplicates:!1,useCache:!0}),Bt})}getKeyUri({key:e}){return __awaiter$K(this,void 0,void 0,function*(){const _t=yield computeJwkThumbprint$1({jwk:e});return`${KEY_URI_PREFIX_JWK$1}${_t}`})}getPublicKey({keyUri:e}){return __awaiter$K(this,void 0,void 0,function*(){const _t=yield this.getPrivateKey({keyUri:e}),At=this.getAlgorithmName({key:_t});return yield this.getAlgorithm({algorithm:At}).getPublicKey({key:_t})})}importKey({key:e}){var _t;return __awaiter$K(this,void 0,void 0,function*(){if(!isPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const At=structuredClone(e);(_t=At.kid)!==null&&_t!==void 0||(At.kid=yield computeJwkThumbprint$1({jwk:At}));const xt=yield this.getKeyUri({key:At});return yield this._keyStore.set({id:xt,data:At,agent:this.agent,preventDuplicates:!0,useCache:!0}),xt})}sign({keyUri:e,data:_t}){return __awaiter$K(this,void 0,void 0,function*(){const At=yield this.getPrivateKey({keyUri:e}),xt=this.getAlgorithmName({key:At});return this.getAlgorithm({algorithm:xt}).sign({data:_t,key:At})})}unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:_t,decryptionKeyUri:At}){return __awaiter$K(this,void 0,void 0,function*(){const xt=yield this.getPrivateKey({keyUri:At}),kt=this.getAlgorithmName({key:xt});return yield this.getAlgorithm({algorithm:kt}).unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:_t,decryptionKey:xt})})}verify({key:e,signature:_t,data:At}){return __awaiter$K(this,void 0,void 0,function*(){const xt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:xt}).verify({key:e,signature:_t,data:At})})}wrapKey({unwrappedKey:e,encryptionKeyUri:_t}){return __awaiter$K(this,void 0,void 0,function*(){const At=yield this.getPrivateKey({keyUri:_t}),xt=this.getAlgorithmName({key:At});return yield this.getAlgorithm({algorithm:xt}).wrapKey({unwrappedKey:e,encryptionKey:At})})}deleteKey({keyUri:e}){return __awaiter$K(this,void 0,void 0,function*(){if(!(yield this._keyStore.get({id:e,agent:this.agent,useCache:!0})))throw new Error(`Key not found: ${e}`);yield this._keyStore.delete({id:e,agent:this.agent})})}getAlgorithm({algorithm:e}){var _t;const At=(_t=supportedAlgorithms$1[e])===null||_t===void 0?void 0:_t.implementation;if(!At)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(At)||this._algorithmInstances.set(At,new At),this._algorithmInstances.get(At)}getAlgorithmName({key:e}){const _t=e.alg,At=e.crv;for(const xt of Object.keys(supportedAlgorithms$1)){const kt=supportedAlgorithms$1[xt].names;if(_t&&kt.includes(_t))return xt;if(At&&kt.includes(At))return xt}throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${_t}, crv=${At}. Please check the documentation for the list of supported algorithms.`)}getPrivateKey({keyUri:e}){return __awaiter$K(this,void 0,void 0,function*(){const _t=yield this._keyStore.get({id:e,agent:this.agent,useCache:!0});if(!_t)throw new Error(`Key not found: ${e}`);return _t})}};var __awaiter$J=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function isValidJweHeader($t){return typeof $t=="object"&&$t!==null&&"alg"in $t&&$t.alg!==void 0&&"enc"in $t&&$t.enc!==void 0}class JweKeyManagement{static decrypt({key:e,encryptedKey:_t,joseHeader:At,crypto:xt}){return __awaiter$J(this,void 0,void 0,function*(){switch(At.alg){case"dir":{if(_t!==void 0)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');return e}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof At.p2c!="number")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof At.p2s!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');if(_t===void 0)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE "encrypted_key" is required when using "PBES2" (Key Encryption Mode).');let kt;try{kt=new Uint8Array([...Convert.string(At.alg).toUint8Array(),0,...Convert.base64Url(At.p2s).toUint8Array()])}catch{throw new CryptoError(CryptoErrorCode.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const Bt=yield xt.deriveKey({algorithm:At.alg,baseKeyBytes:e,iterations:At.p2c,salt:kt});if(!(Bt.alg&&["A128KW","A192KW","A256KW"].includes(Bt.alg)))throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Unsupported Key Encryption Algorithm (alg) value: ${Bt.alg}`);return yield xt.unwrapKey({decryptionKey:Bt,wrappedKeyBytes:_t,wrappedKeyAlgorithm:At.enc})}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${At.alg}`)}})}static encrypt({key:e,joseHeader:_t,crypto:At}){return __awaiter$J(this,void 0,void 0,function*(){let xt,kt;switch(_t.alg){case"dir":{if(kt!==void 0)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');xt=e;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof _t.p2c!="number")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof _t.p2s!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');xt=yield At.generateKey({algorithm:_t.enc});let Bt;try{Bt=new Uint8Array([...Convert.string(_t.alg).toUint8Array(),0,...Convert.base64Url(_t.p2s).toUint8Array()])}catch{throw new CryptoError(CryptoErrorCode.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const Nt=yield At.deriveKey({algorithm:_t.alg,baseKeyBytes:e,iterations:_t.p2c,salt:Bt});kt=yield At.wrapKey({encryptionKey:Nt,unwrappedKey:xt});break}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${_t.alg}`)}return{cek:xt,encryptedKey:kt}})}}function isCipher($t){return $t!==null&&typeof $t=="object"&&"encrypt"in $t&&typeof $t.encrypt=="function"&&"decrypt"in $t&&typeof $t.decrypt=="function"}function hasDuplicateProperties(...$t){const e=new Set,_t=$t.filter(Boolean);for(const At of _t)for(const xt in At){if(e.has(xt))return!0;e.add(xt)}return!1}var __awaiter$I=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function decodeHeaderParam($t,e){if(e!==void 0)try{if(typeof e!="string")throw new Error;return Convert.base64Url(e).toUint8Array()}catch{throw new CryptoError(CryptoErrorCode.InvalidJwe,`Failed to decode the JWE Header parameter '${$t}' from Base64 URL format to Uint8Array. Ensure the value is properly encoded in Base64 URL format without padding.`)}}class FlattenedJwe{constructor(e){this.ciphertext="",Object.assign(this,e)}static decrypt({jwe:e,key:_t,keyManager:At=new LocalKeyManager$2,crypto:xt=new AgentCryptoApi,options:kt={}}){var Bt,Nt;return __awaiter$I(this,void 0,void 0,function*(){if(!isCipher(xt))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!isCipher(At))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!e.protected&&!e.header&&!e.unprotected)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protected", "header", or "unprotected"');if(typeof e.ciphertext!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,"JWE Ciphertext is missing or not a string.");let Ut;if(e.protected)try{Ut=Convert.base64Url(e.protected).toObject()}catch{throw new Error("JWE Protected Header is invalid")}if(hasDuplicateProperties(Ut,e.header,e.unprotected))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "header", "protected", and "unprotected" objects.');const Lt=Object.assign(Object.assign(Object.assign({},Ut),e.header),e.unprotected);if(!isValidJweHeader(Lt))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');if(Array.isArray(kt.allowedAlgValues)&&!kt.allowedAlgValues.includes(Lt.alg))throw new Error(`"alg" (Algorithm) Header Parameter value not allowed: ${Lt.alg}`);if(Array.isArray(kt.allowedEncValues)&&!kt.allowedEncValues.includes(Lt.enc))throw new Error(`"enc" (Encryption Algorithm) Header Parameter value not allowed: ${Lt.enc}`);let jt;try{const Wt=e.encrypted_key?Convert.base64Url(e.encrypted_key).toUint8Array():void 0;jt=yield JweKeyManagement.decrypt({key:_t,encryptedKey:Wt,joseHeader:Lt,keyManager:At,crypto:xt})}catch(Wt){if(Wt instanceof CryptoError&&(Wt.code===CryptoErrorCode.InvalidJwe||Wt.code===CryptoErrorCode.AlgorithmNotSupported))throw Wt;jt=typeof _t=="string"?yield At.generateKey({algorithm:Lt.enc}):yield xt.generateKey({algorithm:Lt.enc})}const Kt=decodeHeaderParam("iv",e.iv),qt=decodeHeaderParam("tag",e.tag),zt=qt!==void 0?new Uint8Array([...Convert.base64Url(e.ciphertext).toUint8Array(),...qt??[]]):Convert.base64Url(e.ciphertext).toUint8Array(),Vt=e.aad!==void 0?new Uint8Array([...Convert.string((Bt=e.protected)!==null&&Bt!==void 0?Bt:"").toUint8Array(),...Convert.string(".").toUint8Array(),...Convert.string(e.aad).toUint8Array()]):Convert.string((Nt=e.protected)!==null&&Nt!==void 0?Nt:"").toUint8Array();return{plaintext:typeof jt=="string"?yield At.decrypt({keyUri:jt,data:zt,iv:Kt,additionalData:Vt}):yield xt.decrypt({key:jt,data:zt,iv:Kt,additionalData:Vt}),protectedHeader:Ut,additionalAuthenticatedData:decodeHeaderParam("aad",e.aad),sharedUnprotectedHeader:e.unprotected,unprotectedHeader:e.header}})}static encrypt({key:e,plaintext:_t,additionalAuthenticatedData:At,protectedHeader:xt,sharedUnprotectedHeader:kt,unprotectedHeader:Bt,keyManager:Nt=new LocalKeyManager$2,crypto:Ut=new AgentCryptoApi}){return __awaiter$I(this,void 0,void 0,function*(){if(!isCipher(Ut))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!isCipher(Nt))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!xt&&!kt&&!Bt)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protectedHeader", "sharedUnprotectedHeader", or "unprotectedHeader"');if(!(_t instanceof Uint8Array))throw new CryptoError(CryptoErrorCode.InvalidJwe,"Plaintext is missing or not a byte array.");if(hasDuplicateProperties(xt,kt,Bt))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "protectedHeader", "sharedUnprotectedHeader", and "unprotectedHeader" objects.');const Lt=Object.assign(Object.assign(Object.assign({},xt),kt),Bt);if(!isValidJweHeader(Lt))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');const{cek:jt,encryptedKey:Kt}=yield JweKeyManagement.encrypt({key:e,joseHeader:Lt,keyManager:Nt,crypto:Ut});let qt;switch(Lt.enc){case"A128GCM":case"A192GCM":case"A256GCM":qt=CryptoUtils.randomBytes(12);break;default:qt=new Uint8Array(0)}const zt=xt?Convert.object(xt).toBase64Url():"";let Vt,Ht;At?(Ht=Convert.uint8Array(At).toBase64Url(),Vt=Convert.string(zt+"."+Ht).toUint8Array()):Vt=Convert.string(zt).toUint8Array();const Wt=typeof jt=="string"?yield Nt.encrypt({keyUri:jt,data:_t,iv:qt,additionalData:Vt}):yield Ut.encrypt({key:jt,data:_t,iv:qt,additionalData:Vt}),Qt=Wt.slice(0,-16),Xt=Wt.slice(-16),Jt=new FlattenedJwe({ciphertext:Convert.uint8Array(Qt).toBase64Url()});return Kt&&(Jt.encrypted_key=Convert.uint8Array(Kt).toBase64Url()),xt&&(Jt.protected=zt),kt&&(Jt.unprotected=kt),Bt&&(Jt.header=Bt),qt&&(Jt.iv=Convert.uint8Array(qt).toBase64Url()),Ht&&(Jt.aad=Ht),Xt&&(Jt.tag=Convert.uint8Array(Xt).toBase64Url()),Jt})}}var __awaiter$H=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class CompactJwe{static decrypt({jwe:e,key:_t,keyManager:At=new LocalKeyManager$2,crypto:xt=new AgentCryptoApi,options:kt={}}){return __awaiter$H(this,void 0,void 0,function*(){if(typeof e!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,"Invalid JWE format. JWE must be a string.");const{0:Bt,1:Nt,2:Ut,3:Lt,4:jt,length:Kt}=e.split(".");if(Kt!==5)throw new CryptoError(CryptoErrorCode.InvalidJwe,"Invalid JWE format. JWE must have 5 parts.");const qt=yield FlattenedJwe.decrypt({jwe:{ciphertext:Lt,encrypted_key:Nt||void 0,iv:Ut||void 0,protected:Bt,tag:jt||void 0},key:_t,keyManager:At,crypto:xt,options:kt});if(!isValidJweHeader(qt.protectedHeader))throw new CryptoError(CryptoErrorCode.InvalidJwe,"Decrypt operation failed due to missing or malformed JWE Protected Header");return{plaintext:qt.plaintext,protectedHeader:qt.protectedHeader}})}static encrypt({plaintext:e,protectedHeader:_t,key:At,keyManager:xt=new LocalKeyManager$2,crypto:kt=new AgentCryptoApi,options:Bt={}}){return __awaiter$H(this,void 0,void 0,function*(){const Nt=yield FlattenedJwe.encrypt({plaintext:e,protectedHeader:_t,key:At,keyManager:xt,crypto:kt,options:Bt});return[Nt.protected,Nt.encrypted_key,Nt.iv,Nt.ciphertext,Nt.tag].join(".")})}}var __awaiter$G=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function isEmptyString($t){return typeof $t!="string"||$t.trim().length===0}function isIdentityVaultBackup($t){return typeof $t=="object"&&$t!==null&&"dateCreated"in $t&&typeof $t.dateCreated=="string"&&"size"in $t&&typeof $t.size=="number"&&"data"in $t&&typeof $t.data=="string"}function isIdentityVaultStatus($t){return typeof $t=="object"&&$t!==null&&"initialized"in $t&&typeof $t.initialized=="boolean"&&"lastBackup"in $t&&"lastRestore"in $t}class HdIdentityVault{constructor({keyDerivationWorkFactor:e,store:_t}={}){this.crypto=new AgentCryptoApi,this._keyDerivationWorkFactor=e??21e4,this._store=_t??new MemoryStore}backup(){return __awaiter$G(this,void 0,void 0,function*(){if(this.isLocked()||(yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the backup operation because the identity vault has not been initialized and unlocked. Please ensure the vault is properly initialized with a secure password before attempting to backup its contents.");const e={did:yield this.getStoredDid(),contentEncryptionKey:yield this.getStoredContentEncryptionKey(),status:yield this.getStatus()},_t=Convert.object(e).toBase64Url(),At={data:_t,dateCreated:new Date().toISOString(),size:_t.length};return yield this.setStatus({lastBackup:At.dateCreated}),At})}changePassword({oldPassword:e,newPassword:_t}){return __awaiter$G(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the change password operation because the identity vault has not been initialized. Please ensure the vault is properly initialized with a secure password before trying again.");yield this.lock();const At=yield this.getStoredContentEncryptionKey();let xt,kt;try{let Nt;({plaintext:Nt,protectedHeader:xt}=yield CompactJwe.decrypt({jwe:At,key:Convert.string(e).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1})),kt=Convert.uint8Array(Nt).toObject()}catch{throw new Error("HdIdentityVault: Unable to change the vault password due to an incorrectly entered old password.")}const Bt=yield CompactJwe.encrypt({key:Convert.string(_t).toUint8Array(),protectedHeader:xt,plaintext:Convert.object(kt).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1});yield this._store.set("contentEncryptionKey",Bt),this._contentEncryptionKey=kt})}getDid(){return __awaiter$G(this,void 0,void 0,function*(){if(this.isLocked())throw new Error("HdIdentityVault: Vault has not been initialized and unlocked.");const e=yield this.getStoredDid(),{plaintext:_t}=yield CompactJwe.decrypt({jwe:e,key:this._contentEncryptionKey,crypto:this.crypto,keyManager:new LocalKeyManager$1}),At=Convert.uint8Array(_t).toObject();if(!isPortableDid(At))throw new Error("HdIdentityVault: Unable to decode malformed DID in identity vault");return yield BearerDid$1.import({portableDid:At})})}getStatus(){return __awaiter$G(this,void 0,void 0,function*(){const e=yield this._store.get("vaultStatus");if(!e)return{initialized:!1,lastBackup:null,lastRestore:null};const _t=Convert.string(e).toObject();if(!isIdentityVaultStatus(_t))throw new Error("HdIdentityVault: Invalid IdentityVaultStatus object in store");return _t})}initialize({password:e,recoveryPhrase:_t,dwnEndpoints:At}){return __awaiter$G(this,void 0,void 0,function*(){if(yield this.isInitialized())throw new Error("HdIdentityVault: Vault has already been initialized.");if(isEmptyString(e))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(_t&&isEmptyString(_t))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(_t??(_t=generateMnemonic(wordlist,128)),!validateMnemonic(_t,wordlist))throw new Error("HdIdentityVault: The provided recovery phrase is invalid. Please ensure that the recovery phrase is a correctly formatted series of 12 words.");const xt=yield mnemonicToSeed(_t),kt=HDKey.fromMasterSeed(xt),Bt=kt.derive("m/44'/0'/0'/0'/0'"),Nt=yield this.crypto.deriveKey({algorithm:"HKDF-512",baseKeyBytes:Bt.privateKey,salt:"",info:"vault_cek",derivedKeyAlgorithm:"A256GCM"}),Ut=yield this.crypto.deriveKeyBytes({algorithm:"HKDF-512",baseKeyBytes:Bt.publicKey,salt:"",info:"vault_unlock_salt",length:256}),Lt={alg:"PBES2-HS512+A256KW",enc:"A256GCM",cty:"text/plain",p2c:this._keyDerivationWorkFactor,p2s:Convert.uint8Array(Ut).toBase64Url()},jt=yield CompactJwe.encrypt({key:Convert.string(e).toUint8Array(),protectedHeader:Lt,plaintext:Convert.object(Nt).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1});yield this._store.set("contentEncryptionKey",jt);const Kt=kt.derive("m/44'/0'/1708523827'/0'/0'"),qt=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:Kt.privateKey});let zt=kt.derive("m/44'/0'/1708523827'/0'/1'");const Vt=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:zt.privateKey}),Ht=new DeterministicKeyGenerator;yield Ht.addPredefinedKeys({privateKeys:[qt,Vt]});const Wt={verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]}]};At&&At.length&&(Wt.services=[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:At,enc:"#enc",sig:"#sig"}]);const Xt=yield(yield DidDht$1.create({keyManager:Ht,options:Wt})).export(),Jt={alg:"dir",enc:"A256GCM",cty:"json"},tr=yield CompactJwe.encrypt({key:Nt,plaintext:Convert.object(Xt).toUint8Array(),protectedHeader:Jt,crypto:this.crypto,keyManager:new LocalKeyManager$1});return yield this._store.set("did",tr),this._contentEncryptionKey=Nt,yield this.setStatus({initialized:!0}),_t})}isInitialized(){return __awaiter$G(this,void 0,void 0,function*(){return this.getStatus().then(({initialized:e})=>e)})}isLocked(){return!this._contentEncryptionKey}lock(){return __awaiter$G(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Lock operation failed. Vault has not been initialized.");this._contentEncryptionKey&&(this._contentEncryptionKey.k=""),this._contentEncryptionKey=void 0})}restore({backup:e,password:_t}){return __awaiter$G(this,void 0,void 0,function*(){if(!isIdentityVaultBackup(e))throw new Error("HdIdentityVault: Restore operation failed due to invalid backup object.");let At,xt,kt;try{kt=yield this.getStoredDid(),xt=yield this.getStoredContentEncryptionKey(),At=yield this.getStatus()}catch{throw new Error("HdIdentityVault: The restore operation cannot proceed because the existing vault contents are missing or inaccessible. If the problem persists consider re-initializing the vault and retrying the restore.")}try{const Bt=Convert.base64Url(e.data).toObject();yield this._store.set("did",Bt.did),yield this._store.set("contentEncryptionKey",Bt.contentEncryptionKey),yield this.setStatus(Bt.status),yield this.unlock({password:_t})}catch{throw yield this.setStatus(At),yield this._store.set("contentEncryptionKey",xt),yield this._store.set("did",kt),new Error("HdIdentityVault: Restore operation failed due to invalid backup data or an incorrect password. Please verify the password is correct for the provided backup and try again.")}yield this.setStatus({lastRestore:new Date().toISOString()})})}unlock({password:e}){return __awaiter$G(this,void 0,void 0,function*(){yield this.lock();const _t=yield this.getStoredContentEncryptionKey();try{const{plaintext:At}=yield CompactJwe.decrypt({jwe:_t,key:Convert.string(e).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1}),xt=Convert.uint8Array(At).toObject();this._contentEncryptionKey=xt}catch{throw new Error("HdIdentityVault: Unable to unlock the vault due to an incorrect password.")}})}getStoredDid(){return __awaiter$G(this,void 0,void 0,function*(){const e=yield this._store.get("did");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the DID record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}getStoredContentEncryptionKey(){return __awaiter$G(this,void 0,void 0,function*(){const e=yield this._store.get("contentEncryptionKey");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the Content Encryption Key record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}setStatus({initialized:e,lastBackup:_t,lastRestore:At}){return __awaiter$G(this,void 0,void 0,function*(){let xt=yield this.getStatus();return xt.initialized=e??xt.initialized,xt.lastBackup=_t??xt.lastBackup,xt.lastRestore=At??xt.lastRestore,yield this._store.set("vaultStatus",JSON.stringify(xt)),!0})}}var __awaiter$F=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function isIdentityMetadata($t){return!(!$t||typeof $t!="object"||$t===null)&&"name"in $t}class DwnIdentityStore extends DwnDataStore{constructor(){super(...arguments),this.name="DwnIdentityStore",this._recordProtocolDefinition=IdentityProtocolDefinition,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"identityMetadata",schema:this._recordProtocolDefinition.types.identityMetadata.schema}}delete(e){const _t=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.delete.call(this,e)})}get(e){const _t=Object.create(null,{get:{get:()=>super.get}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.get.call(this,e)})}set(e){const _t=Object.create(null,{set:{get:()=>super.set}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.set.call(this,e)})}list(e){const _t=Object.create(null,{list:{get:()=>super.list}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.list.call(this,e)})}getAllRecords({agent:e,tenantDid:_t}){var At;return __awaiter$F(this,void 0,void 0,function*(){this._index.clear();const{reply:xt}=yield e.dwn.processRequest({author:_t,target:_t,messageType:DwnInterface.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let kt=[];for(const Bt of(At=xt.entries)!==null&&At!==void 0?At:[]){if(!Bt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Nt=Convert.base64Url(Bt.encodedData).toObject();if(isIdentityMetadata(Nt)){const Ut=`${_t}${TENANT_SEPARATOR}${Nt.uri}`;this._index.set(Ut,Bt.recordId),this._cache.set(Bt.recordId,Nt),kt.push(Nt)}}return kt})}}class InMemoryIdentityStore extends InMemoryDataStore{constructor(){super(...arguments),this.name="InMemoryIdentityStore"}delete(e){const _t=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.delete.call(this,e)})}get(e){const _t=Object.create(null,{get:{get:()=>super.get}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.get.call(this,e)})}list(e){const _t=Object.create(null,{list:{get:()=>super.list}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.list.call(this,e)})}set(e){const _t=Object.create(null,{set:{get:()=>super.set}});return __awaiter$F(this,void 0,void 0,function*(){return yield _t.set.call(this,e)})}}var __awaiter$E=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class AgentIdentityApi{constructor({agent:e,store:_t}={}){this._agent=e,this._store=_t??new InMemoryIdentityStore}get agent(){if(this._agent===void 0)throw new Error("AgentIdentityApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}create({metadata:e,didMethod:_t="dht",didOptions:At,store:xt,tenant:kt}){return __awaiter$E(this,void 0,void 0,function*(){const Bt=yield this.agent.did.create({method:_t,options:At,store:xt,tenant:kt}),Nt=new BearerIdentity({did:Bt,metadata:Object.assign(Object.assign({},e),{uri:Bt.uri,tenant:kt??Bt.uri})});return(xt??!0)&&(yield this._store.set({id:Nt.did.uri,data:Nt.metadata,agent:this.agent,tenant:Nt.metadata.tenant,preventDuplicates:!1,useCache:!0})),Nt})}export({didUri:e,tenant:_t}){return __awaiter$E(this,void 0,void 0,function*(){const At=yield this.get({didUri:e,tenant:_t});if(!At)throw new Error(`AgentIdentityApi: Failed to export due to Identity not found: ${e}`);return yield At.export()})}get({didUri:e,tenant:_t}){return __awaiter$E(this,void 0,void 0,function*(){const At=yield this._store.get({id:e,agent:this.agent,tenant:_t,useCache:!0});if(!At)return;const xt=yield this.agent.did.get({didUri:e,tenant:At.tenant});if(!xt)throw new Error(`AgentIdentityApi: Identity is present in the store but DID is missing: ${e}`);return new BearerIdentity({did:xt,metadata:At})})}import({portableIdentity:e}){return __awaiter$E(this,void 0,void 0,function*(){const _t=yield this.agent.did.import({portableDid:e.portableDid,tenant:e.metadata.tenant});if(!_t)throw new Error(`AgentIdentityApi: Failed to import Identity: ${e.metadata.uri}`);const At=new BearerIdentity({did:_t,metadata:e.metadata});return yield this._store.set({id:At.did.uri,data:At.metadata,agent:this.agent,tenant:At.metadata.tenant,preventDuplicates:!0,useCache:!0}),At})}list({tenant:e}={}){return __awaiter$E(this,void 0,void 0,function*(){const _t=yield this._store.list({agent:this.agent,tenant:e});return(yield Promise.all(_t.map(xt=>__awaiter$E(this,void 0,void 0,function*(){return this.get({didUri:xt.uri,tenant:xt.tenant})})))).filter(xt=>typeof xt<"u")})}manage({portableIdentity:e}){return __awaiter$E(this,void 0,void 0,function*(){const _t=yield this.agent.did.get({didUri:e.metadata.uri,tenant:e.metadata.tenant});if(!_t)throw new Error(`AgentIdentityApi: Failed to manage Identity: ${e.metadata.uri}`);const At=new BearerIdentity({did:_t,metadata:e.metadata});return yield this._store.set({id:At.did.uri,data:At.metadata,agent:this.agent,preventDuplicates:!0,useCache:!0}),At})}delete({didUri:e,tenant:_t}){return __awaiter$E(this,void 0,void 0,function*(){if(!(yield this._store.get({id:e,agent:this.agent,tenant:_t,useCache:!0})))throw new Error(`AgentIdentityApi: Failed to purge due to Identity not found: ${e}`);yield this._store.delete({id:e,agent:this.agent,tenant:_t})})}connectedIdentity({connectedDid:e}={}){return __awaiter$E(this,void 0,void 0,function*(){const _t=yield this.list();if(!(_t.length<1))return e?_t.find(At=>At.metadata.connectedDid===e):_t.find(At=>At.metadata.connectedDid!==void 0)})}}var __awaiter$D=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$d=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class AgentPermissionsApi{get agent(){if(!this._agent)throw new Error("AgentPermissionsApi: Agent is not set");return this._agent}set agent(e){this._agent=e}constructor({agent:e}={}){this._cachedPermissions=new TtlCache({ttl:60*1e3}),this._agent=e}getPermissionForRequest({connectedDid:e,delegateDid:_t,delegate:At,messageType:xt,protocol:kt,cached:Bt=!1}){return __awaiter$D(this,void 0,void 0,function*(){const Nt=[e,_t,xt,kt].join("~"),Ut=Bt?this._cachedPermissions.get(Nt):void 0;if(Ut)return Ut;const Lt=yield this.fetchGrants({author:_t,target:_t,grantor:e,grantee:_t}),jt=yield AgentPermissionsApi.matchGrantFromArray(e,_t,{messageType:xt,protocol:kt},Lt,At);if(!jt)throw new Error(`CachedPermissions: No permissions found for ${xt}: ${kt}`);return this._cachedPermissions.set(Nt,jt),jt})}fetchGrants({author:e,target:_t,grantee:At,grantor:xt,protocol:kt,remote:Bt=!1}){return __awaiter$D(this,void 0,void 0,function*(){const Nt=kt?{protocol:kt}:void 0,Ut={author:e,target:_t,messageType:DwnInterface.RecordsQuery,messageParams:{filter:{author:xt,recipient:At,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,tags:Nt}}},{reply:Lt}=Bt?yield this.agent.sendDwnRequest(Ut):yield this.agent.processDwnRequest(Ut);if(Lt.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch grants: ${Lt.status.detail}`);const jt=[];for(const Kt of Lt.entries){const qt=yield PermissionGrant$1.parse(Kt);jt.push({grant:qt,message:Kt})}return jt})}fetchRequests({author:e,target:_t,protocol:At,remote:xt=!1}){return __awaiter$D(this,void 0,void 0,function*(){const kt=At?{protocol:At}:void 0,Bt={author:e,target:_t,messageType:DwnInterface.RecordsQuery,messageParams:{filter:{protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,tags:kt}}},{reply:Nt}=xt?yield this.agent.sendDwnRequest(Bt):yield this.agent.processDwnRequest(Bt);if(Nt.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch requests: ${Nt.status.detail}`);const Ut=[];for(const Lt of Nt.entries){const jt=yield PermissionRequest$1.parse(Lt);Ut.push({request:jt,message:Lt})}return Ut})}isGrantRevoked({author:e,target:_t,grantRecordId:At,remote:xt=!1}){return __awaiter$D(this,void 0,void 0,function*(){const kt={author:e,target:_t,messageType:DwnInterface.RecordsRead,messageParams:{filter:{parentId:At,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath}}},{reply:Bt}=xt?yield this.agent.sendDwnRequest(kt):yield this.agent.processDwnRequest(kt);if(Bt.status.code===404)return!1;if(Bt.status.code===200)return!0;throw new Error(`PermissionsApi: Failed to check if grant is revoked: ${Bt.status.detail}`)})}createGrant(e){return __awaiter$D(this,void 0,void 0,function*(){const{author:_t,store:At=!1,delegated:xt=!1}=e,kt=__rest$d(e,["author","store","delegated"]);let Bt;PermissionsProtocol.hasProtocolScope(kt.scope)&&(Bt={protocol:kt.scope.protocol});const Nt={dateExpires:kt.dateExpires,requestId:kt.requestId,description:kt.description,delegated:xt,scope:kt.scope},Ut=Convert.object(Nt).toUint8Array(),Lt={recipient:kt.grantedTo,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,dataFormat:"application/json",tags:Bt},{reply:jt,message:Kt}=yield this.agent.processDwnRequest({store:At,author:_t,target:_t,messageType:DwnInterface.RecordsWrite,messageParams:Lt,dataStream:new Blob([Ut])});if(jt.status.code!==202)throw new Error(`PermissionsApi: Failed to create grant: ${jt.status.detail}`);const qt=Object.assign(Object.assign({},Kt),{encodedData:Convert.uint8Array(Ut).toBase64Url()});return{grant:yield PermissionGrant$1.parse(qt),message:qt}})}createRequest(e){return __awaiter$D(this,void 0,void 0,function*(){const{author:_t,store:At=!1,delegated:xt=!1}=e,kt=__rest$d(e,["author","store","delegated"]);let Bt;PermissionsProtocol.hasProtocolScope(kt.scope)&&(Bt={protocol:kt.scope.protocol});const Nt={description:kt.description,delegated:xt,scope:kt.scope},Ut=Convert.object(Nt).toUint8Array(),Lt={protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,dataFormat:"application/json",tags:Bt},{reply:jt,message:Kt}=yield this.agent.processDwnRequest({store:At,author:_t,target:_t,messageType:DwnInterface.RecordsWrite,messageParams:Lt,dataStream:new Blob([Ut])});if(jt.status.code!==202)throw new Error(`PermissionsApi: Failed to create request: ${jt.status.detail}`);const qt=Object.assign(Object.assign({},Kt),{encodedData:Convert.uint8Array(Ut).toBase64Url()});return{request:yield PermissionRequest$1.parse(qt),message:qt}})}createRevocation(e){return __awaiter$D(this,void 0,void 0,function*(){const{author:_t,store:At=!1,grant:xt,description:kt}=e,Bt={description:kt},Nt=Convert.object(Bt).toUint8Array();let Ut;PermissionsProtocol.hasProtocolScope(xt.scope)&&(Ut={protocol:xt.scope.protocol});const Lt={parentContextId:xt.id,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath,dataFormat:"application/json",tags:Ut},{reply:jt,message:Kt}=yield this.agent.processDwnRequest({store:At,author:_t,target:_t,messageType:DwnInterface.RecordsWrite,messageParams:Lt,dataStream:new Blob([Nt])});if(jt.status.code!==202)throw new Error(`PermissionsApi: Failed to create revocation: ${jt.status.detail}`);return{message:Object.assign(Object.assign({},Kt),{encodedData:Convert.uint8Array(Nt).toBase64Url()})}})}clear(){return __awaiter$D(this,void 0,void 0,function*(){this._cachedPermissions.clear()})}static matchGrantFromArray(e,_t,At,xt,kt=!1){return __awaiter$D(this,void 0,void 0,function*(){for(const Bt of xt){const{grant:Nt,message:Ut}=Bt;if(kt===!0&&Nt.delegated!==!0)continue;const{messageType:Lt,protocol:jt,protocolPath:Kt,contextId:qt}=At;if(this.matchScopeFromGrant(e,_t,Lt,Nt,jt,Kt,qt))return{grant:Nt,message:Ut}}})}static matchScopeFromGrant(e,_t,At,xt,kt,Bt,Nt){if(xt.grantee!==_t||xt.grantor!==e)return!1;const Ut=xt.scope;if(Ut.interface+Ut.method===At)if(isRecordsType(At)){const jt=Ut;if(jt.protocol!==kt)return!1;if(this.isUnrestrictedProtocolScope(jt)||jt.protocolPath!==void 0&&jt.protocolPath===Bt||jt.contextId!==void 0&&(Nt!=null&&Nt.startsWith(jt.contextId)))return!0}else{const jt=Ut;return jt.protocol===void 0?!0:jt.protocol!==kt?!1:this.isUnrestrictedProtocolScope(jt)}return!1}static isUnrestrictedProtocolScope(e){return e.contextId===void 0&&e.protocolPath===void 0}}var JsonRpcErrorCodes;(function($t){$t[$t.InvalidRequest=-32600]="InvalidRequest",$t[$t.MethodNotFound=-32601]="MethodNotFound",$t[$t.InvalidParams=-32602]="InvalidParams",$t[$t.InternalError=-32603]="InternalError",$t[$t.ParseError=-32700]="ParseError",$t[$t.TransportError=-32300]="TransportError",$t[$t.BadRequest=-50400]="BadRequest",$t[$t.Unauthorized=-50401]="Unauthorized",$t[$t.Forbidden=-50403]="Forbidden",$t[$t.Conflict=-50409]="Conflict"})(JsonRpcErrorCodes||(JsonRpcErrorCodes={}));const createJsonRpcRequest=($t,e,_t)=>({jsonrpc:"2.0",id:$t,method:e,params:_t}),createJsonRpcSubscriptionRequest=($t,e,_t,At)=>({jsonrpc:"2.0",id:$t,method:`rpc.subscribe.${e}`,params:At,subscription:{id:_t}});function parseJson($t){try{return JSON.parse($t)}catch{return null}}var __awaiter$C=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DwnServerInfoCacheMemory{constructor({ttl:e="15m"}={}){this.cache=new TtlCache({ttl:ms$1(e)})}get(e){return __awaiter$C(this,void 0,void 0,function*(){return this.cache.get(e)})}set(e,_t){return __awaiter$C(this,void 0,void 0,function*(){this.cache.set(e,_t)})}delete(e){return __awaiter$C(this,void 0,void 0,function*(){this.cache.delete(e)})}clear(){return __awaiter$C(this,void 0,void 0,function*(){this.cache.clear()})}close(){return __awaiter$C(this,void 0,void 0,function*(){})}}var __awaiter$B=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class HttpDwnRpcClient{constructor(e){this.serverInfoCache=e??new DwnServerInfoCacheMemory}get transportProtocols(){return["http:","https:"]}sendDwnRequest(e){return __awaiter$B(this,void 0,void 0,function*(){const _t=CryptoUtils.randomUuid(),At=createJsonRpcRequest(_t,"dwn.processMessage",{target:e.targetDid,message:e.message}),xt={method:"POST",headers:{"dwn-request":JSON.stringify(At)}};e.data&&(xt.headers["content-type"]="application/octet-stream",xt.body=e.data);const kt=yield fetch(e.dwnUrl,xt);let Bt,Nt;const{headers:Ut}=kt;if(Ut.has("dwn-response")){const jt=parseJson(Ut.get("dwn-response"));if(jt==null)throw new Error(`failed to parse json rpc response. dwn url: ${e.dwnUrl}`);Nt=kt.body,Bt=jt}else{const jt=yield kt.text();Bt=JSON.parse(jt)}if(Bt.error){const{code:jt,message:Kt}=Bt.error;throw new Error(`(${jt}) - ${Kt}`)}const{reply:Lt}=Bt.result;return Nt&&Lt.record?Lt.record.data=Nt:Nt&&Lt.entry&&(Lt.entry.data=Nt),Lt})}getServerInfo(e){return __awaiter$B(this,void 0,void 0,function*(){const _t=yield this.serverInfoCache.get(e);if(_t)return _t;const At=new URL(e);At.pathname.endsWith("/")?At.pathname+="info":At.pathname+="/info";try{const xt=yield fetch(At.toString());if(xt.ok){const kt=yield xt.json(),Bt={registrationRequirements:kt.registrationRequirements,maxFileSize:kt.maxFileSize,webSocketSupport:kt.webSocketSupport};return this.serverInfoCache.set(e,Bt),Bt}else throw new Error(`HTTP (${xt.status}) - ${xt.statusText}`)}catch(xt){throw new Error(`Error encountered while processing response from ${At.toString()}: ${xt.message}`)}})}}var ws=null;typeof WebSocket<"u"?ws=WebSocket:typeof MozWebSocket<"u"?ws=MozWebSocket:typeof globalThis<"u"?ws=globalThis.WebSocket||globalThis.MozWebSocket:typeof window<"u"?ws=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ws=self.WebSocket||self.MozWebSocket);const IsomorphicWebSocket=ws;var __awaiter$A=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const CONNECT_TIMEOUT=3e3,RESPONSE_TIMEOUT=3e4;class JsonRpcSocket{constructor(e,_t){this.socket=e,this.responseTimeout=_t,this.messageHandlers=new Map}static connect(e,_t={}){return __awaiter$A(this,void 0,void 0,function*(){const{connectTimeout:At=CONNECT_TIMEOUT,responseTimeout:xt=RESPONSE_TIMEOUT,onclose:kt,onerror:Bt}=_t,Nt=new IsomorphicWebSocket(e);return kt?Nt.onclose=kt:Nt.onclose=()=>{console.info(`JSON RPC Socket close ${e}`)},Bt?Nt.onerror=Bt:Nt.onerror=Ut=>{console.error(`JSON RPC Socket error ${e}`,Ut)},new Promise((Ut,Lt)=>{Nt.addEventListener("open",()=>{const jt=new JsonRpcSocket(Nt,xt);Nt.addEventListener("message",Kt=>{const qt=parseJson(Kt.data),zt=jt.messageHandlers.get(qt.id);zt&&zt(Kt)}),Ut(jt)}),Nt.addEventListener("error",jt=>{Lt(jt)}),setTimeout(()=>Lt,At)})})}close(){this.socket.close()}request(e){return __awaiter$A(this,void 0,void 0,function*(){return new Promise((_t,At)=>{var xt;(xt=e.id)!==null&&xt!==void 0||(e.id=CryptoUtils.randomUuid());const kt=Bt=>{const Nt=parseJson(Bt.data);if(Nt.id===e.id)return this.messageHandlers.delete(e.id),_t(Nt)};this.messageHandlers.set(e.id,kt),this.send(e),setTimeout(()=>{this.messageHandlers.delete(e.id),At(new Error("request timed out"))},this.responseTimeout)})})}subscribe(e,_t){return __awaiter$A(this,void 0,void 0,function*(){if(!e.method.startsWith("rpc.subscribe."))throw new Error("subscribe rpc requests must include the `rpc.subscribe` prefix");if(!e.subscription)throw new Error("subscribe rpc requests must include subscribe options");const At=e.subscription.id,xt=Nt=>{const Ut=parseJson(Nt.data.toString());Ut.id===At&&(Ut.error!==void 0&&(this.messageHandlers.delete(At),this.closeSubscription(At)),_t(Ut))};this.messageHandlers.set(At,xt);const kt=yield this.request(e);return kt.error?(this.messageHandlers.delete(At),{response:kt}):{response:kt,close:()=>__awaiter$A(this,void 0,void 0,function*(){this.messageHandlers.delete(At),yield this.closeSubscription(At)})}})}closeSubscription(e){const _t=CryptoUtils.randomUuid(),At=createJsonRpcSubscriptionRequest(_t,"close",e,{});return this.request(At)}send(e){this.socket.send(JSON.stringify(e))}}var __awaiter$z=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class WebSocketDwnRpcClient{get transportProtocols(){return["ws:","wss:"]}sendDwnRequest(e,_t){return __awaiter$z(this,void 0,void 0,function*(){const At=new URL(e.dwnUrl);if(At.protocol!=="ws:"&&At.protocol!=="wss:")throw new Error(`Invalid websocket protocol ${At.protocol}`);if(!WebSocketDwnRpcClient.connections.has(At.host))try{const Lt=yield JsonRpcSocket.connect(At.toString(),_t),jt=new Map;WebSocketDwnRpcClient.connections.set(At.host,{socket:Lt,subscriptions:jt})}catch(Lt){throw new Error(`Error connecting to ${At.host}: ${Lt.message}`)}const kt=WebSocketDwnRpcClient.connections.get(At.host),{targetDid:Bt,message:Nt,subscriptionHandler:Ut}=e;return Ut?WebSocketDwnRpcClient.subscriptionRequest(kt,Bt,Nt,Ut):WebSocketDwnRpcClient.processMessage(kt,Bt,Nt)})}static processMessage(e,_t,At){return __awaiter$z(this,void 0,void 0,function*(){const xt=CryptoUtils.randomUuid(),kt=createJsonRpcRequest(xt,"dwn.processMessage",{target:_t,message:At}),{socket:Bt}=e,Nt=yield Bt.request(kt),{error:Ut,result:Lt}=Nt;if(Ut!==void 0)throw new Error(`error sending DWN request: ${Ut.message}`);return Lt.reply})}static subscriptionRequest(e,_t,At,xt){return __awaiter$z(this,void 0,void 0,function*(){const kt=CryptoUtils.randomUuid(),Bt=CryptoUtils.randomUuid(),Nt=createJsonRpcSubscriptionRequest(kt,"dwn.processMessage",Bt,{target:_t,message:At}),{socket:Ut,subscriptions:Lt}=e,{response:jt,close:Kt}=yield Ut.subscribe(Nt,Ht=>{const{result:Wt,error:Qt}=Ht;if(Qt){const Jt=Lt.get(Bt);Jt&&Jt.close(),Lt.delete(Bt);return}const{event:Xt}=Wt;xt(Xt)}),{error:qt,result:zt}=jt;if(qt)throw new Error(`could not subscribe via jsonrpc socket: ${qt.message}`);const{reply:Vt}=zt;return Vt.subscription&&Kt&&(Lt.set(Bt,Object.assign(Object.assign({},Vt.subscription),{close:Kt})),Vt.subscription.close=Kt),Vt})}}WebSocketDwnRpcClient.connections=new Map;var __awaiter$y=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidRpcMethod;(function($t){$t.Create="did.create",$t.Resolve="did.resolve"})(DidRpcMethod||(DidRpcMethod={}));class Web5RpcClient{constructor(e=[]){this.transportClients=new Map,e=[new HttpWeb5RpcClient,new WebSocketWeb5RpcClient,...e];for(let _t of e)for(let At of _t.transportProtocols)this.transportClients.set(At,_t)}get transportProtocols(){return Array.from(this.transportClients.keys())}sendDidRequest(e){return __awaiter$y(this,void 0,void 0,function*(){const _t=new URL(e.url),At=this.transportClients.get(_t.protocol);if(!At){const xt=new Error(`no ${_t.protocol} transport client available`);throw xt.name="NO_TRANSPORT_CLIENT",xt}return At.sendDidRequest(e)})}sendDwnRequest(e){const _t=new URL(e.dwnUrl),At=this.transportClients.get(_t.protocol);if(!At){const xt=new Error(`no ${_t.protocol} transport client available`);throw xt.name="NO_TRANSPORT_CLIENT",xt}return At.sendDwnRequest(e)}getServerInfo(e){return __awaiter$y(this,void 0,void 0,function*(){const _t=new URL(e),At=this.transportClients.get(_t.protocol);if(!At){const xt=new Error(`no ${_t.protocol} transport client available`);throw xt.name="NO_TRANSPORT_CLIENT",xt}return At.getServerInfo(e)})}}class HttpWeb5RpcClient extends HttpDwnRpcClient{sendDidRequest(e){return __awaiter$y(this,void 0,void 0,function*(){const _t=CryptoUtils.randomUuid(),At=createJsonRpcRequest(_t,e.method,{data:e.data}),xt=new Request(e.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(At)});let kt;try{const Bt=yield fetch(xt);if(Bt.ok){if(kt=yield Bt.json(),kt.error){const{code:Nt,message:Ut}=kt.error;throw new Error(`JSON RPC (${Nt}) - ${Ut}`)}}else throw new Error(`HTTP (${Bt.status}) - ${Bt.statusText}`)}catch(Bt){throw new Error(`Error encountered while processing response from ${e.url}: ${Bt.message}`)}return kt.result})}}class WebSocketWeb5RpcClient extends WebSocketDwnRpcClient{sendDidRequest(e){return __awaiter$y(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}getServerInfo(e){return __awaiter$y(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}}var __awaiter$x=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class AgentSyncApi{constructor({agent:e,syncEngine:_t}){this._syncEngine=_t,this._agent=e}get agent(){if(this._agent===void 0)throw new Error("AgentSyncApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._syncEngine.agent=e}registerIdentity(e){return __awaiter$x(this,void 0,void 0,function*(){yield this._syncEngine.registerIdentity(e)})}unregisterIdentity(e){return __awaiter$x(this,void 0,void 0,function*(){yield this._syncEngine.unregisterIdentity(e)})}getIdentityOptions(e){return __awaiter$x(this,void 0,void 0,function*(){return yield this._syncEngine.getIdentityOptions(e)})}updateIdentityOptions(e){return __awaiter$x(this,void 0,void 0,function*(){yield this._syncEngine.updateIdentityOptions(e)})}sync(e){return this._syncEngine.sync(e)}startSync(e){return this._syncEngine.startSync(e)}stopSync(e){return this._syncEngine.stopSync(e)}}var __awaiter$w=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__asyncValues=function($t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=$t[Symbol.asyncIterator],_t;return e?e.call($t):($t=typeof __values=="function"?__values($t):$t[Symbol.iterator](),_t={},At("next"),At("throw"),At("return"),_t[Symbol.asyncIterator]=function(){return this},_t);function At(kt){_t[kt]=$t[kt]&&function(Bt){return new Promise(function(Nt,Ut){Bt=$t[kt](Bt),xt(Nt,Ut,Bt.done,Bt.value)})}}function xt(kt,Bt,Nt,Ut){Promise.resolve(Ut).then(function(Lt){kt({value:Lt,done:Nt})},Bt)}};class SyncEngineLevel{constructor({agent:e,dataPath:_t,db:At}){this._syncLock=!1,this._agent=e,this._permissionsApi=new AgentPermissionsApi({agent:e}),this._db=At||new Level(_t??"DATA/AGENT/SYNC_STORE"),this._ulidFactory=monotonicFactory()}get agent(){if(this._agent===void 0)throw new Error("SyncEngineLevel: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._permissionsApi=new AgentPermissionsApi({agent:e})}clear(){return __awaiter$w(this,void 0,void 0,function*(){yield this._permissionsApi.clear(),yield this._db.clear()})}close(){return __awaiter$w(this,void 0,void 0,function*(){yield this._db.close()})}pull(){var e;return __awaiter$w(this,void 0,void 0,function*(){const _t=yield this.getSyncPeerState({syncDirection:"pull"});yield this.enqueueOperations({syncDirection:"pull",syncPeerState:_t});const At=this.getPullQueue(),xt=yield At.iterator().all(),kt=[],Bt=new Set;for(let Nt of xt){const[Ut]=Nt,{did:Lt,dwnUrl:jt,messageCid:Kt,delegateDid:qt,protocol:zt}=SyncEngineLevel.parseSyncMessageParamsKey(Ut);if(Bt.has(jt))continue;if(yield this.messageExists(Lt,Kt)){kt.push({type:"del",key:Ut});continue}let Ht,Wt;if(qt)try{Ht=(yield this._permissionsApi.getPermissionForRequest({connectedDid:Lt,messageType:DwnInterface.MessagesRead,delegateDid:qt,protocol:zt,cached:!0})).grant.id,Wt=qt}catch($r){console.error("SyncEngineLevel: pull - Error fetching MessagesRead permission grant for delegate DID",$r);continue}const Qt=yield this.agent.processDwnRequest({store:!1,author:Lt,target:Lt,messageType:DwnInterface.MessagesRead,granteeDid:Wt,messageParams:{messageCid:Kt,permissionGrantId:Ht}});let Xt;try{Xt=yield this.agent.rpc.sendDwnRequest({dwnUrl:jt,targetDid:Lt,message:Qt.message})}catch{Bt.add(jt);continue}if(Xt.status.code!==200||!(!((e=Xt.entry)===null||e===void 0)&&e.message)){yield this.addMessage(Lt,Kt),kt.push({type:"del",key:Ut});continue}const Jt=Xt.entry,tr=Jt.message,dr=isRecordsWrite(Jt)&&Jt.data?NodeStream.fromWebReadable({readableStream:Jt.data}):void 0,vr=yield this.agent.dwn.node.processMessage(Lt,tr,{dataStream:dr});SyncEngineLevel.syncMessageReplyIsSuccessful(vr)&&(yield this.addMessage(Lt,Kt),kt.push({type:"del",key:Ut}))}yield At.batch(kt)})}push(){return __awaiter$w(this,void 0,void 0,function*(){const e=yield this.getSyncPeerState({syncDirection:"push"});yield this.enqueueOperations({syncDirection:"push",syncPeerState:e});const _t=this.getPushQueue(),At=yield _t.iterator().all(),xt=[],kt=new Set;for(let Bt of At){const[Nt]=Bt,{did:Ut,delegateDid:Lt,protocol:jt,dwnUrl:Kt,messageCid:qt}=SyncEngineLevel.parseSyncMessageParamsKey(Nt);if(kt.has(Kt))continue;const zt=yield this.getDwnMessage({author:Ut,messageCid:qt,delegateDid:Lt,protocol:jt});if(!zt){xt.push({type:"del",key:Nt}),yield this.addMessage(Ut,qt);continue}try{const Vt=yield this.agent.rpc.sendDwnRequest({dwnUrl:Kt,targetDid:Ut,data:zt.data,message:zt.message});SyncEngineLevel.syncMessageReplyIsSuccessful(Vt)&&(yield this.addMessage(Ut,qt),xt.push({type:"del",key:Nt}))}catch{kt.add(Kt)}}yield _t.batch(xt)})}registerIdentity({did:e,options:_t}){return __awaiter$w(this,void 0,void 0,function*(){const At=this._db.sublevel("registeredIdentities");if(yield this.getIdentityOptions(e))throw new Error(`SyncEngineLevel: Identity with DID ${e} is already registered.`);_t??(_t={protocols:[]}),yield At.put(e,JSON.stringify(_t))})}unregisterIdentity(e){return __awaiter$w(this,void 0,void 0,function*(){const _t=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield _t.del(e)})}getIdentityOptions(e){return __awaiter$w(this,void 0,void 0,function*(){const _t=this._db.sublevel("registeredIdentities");try{const At=yield _t.get(e);if(At)return JSON.parse(At)}catch(At){const xt=At;if(xt.code==="LEVEL_NOT_FOUND")return;throw new Error(`SyncEngineLevel: Error reading level: ${xt.code}.`)}})}updateIdentityOptions({did:e,options:_t}){return __awaiter$w(this,void 0,void 0,function*(){const At=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield At.put(e,JSON.stringify(_t))})}sync(e){return __awaiter$w(this,void 0,void 0,function*(){if(this._syncLock)throw new Error("SyncEngineLevel: Sync operation is already in progress.");this._syncLock=!0;try{(!e||e==="push")&&(yield this.push()),(!e||e==="pull")&&(yield this.pull())}finally{this._syncLock=!1}})}startSync({interval:e}){return __awaiter$w(this,void 0,void 0,function*(){const _t=ms$1(e),At=()=>__awaiter$w(this,void 0,void 0,function*(){this._syncLock||(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0,yield this.sync(),this._syncIntervalId||(this._syncIntervalId=setInterval(At,_t)))});this._syncIntervalId&&clearInterval(this._syncIntervalId),this._syncIntervalId=setInterval(At,_t),this._syncLock||(yield this.sync())})}stopSync(e=2e3){return __awaiter$w(this,void 0,void 0,function*(){let _t=0;for(;this._syncLock;){if(_t>=e)throw new Error(`SyncEngineLevel: Existing sync operation did not complete within ${e} milliseconds.`);_t+=100,yield new Promise(At=>setTimeout(At,e<100?e:100))}this._syncIntervalId&&(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0)})}static syncMessageReplyIsSuccessful(e){var _t,At;return e.status.code===202||e.status.code===204||e.status.code===409||((_t=e.entry)===null||_t===void 0?void 0:_t.message.descriptor.interface)===DwnInterfaceName.Records&&((At=e.entry)===null||At===void 0?void 0:At.message.descriptor.method)===DwnMethodName.Delete&&e.status.code===404}enqueueOperations({syncDirection:e,syncPeerState:_t}){return __awaiter$w(this,void 0,void 0,function*(){for(let At of _t){const xt=yield this.getDwnEventLog({did:At.did,delegateDid:At.delegateDid,dwnUrl:At.dwnUrl,cursor:At.cursor,protocol:At.protocol,syncDirection:e}),kt=[];for(let Bt of xt){const Nt=this._ulidFactory(),Ut=SyncEngineLevel.generateSyncMessageParamsKey(Object.assign(Object.assign({},At),{watermark:Nt,messageCid:Bt}));kt.push({type:"put",key:Ut,value:""})}kt.length>0&&(yield(e==="pull"?this.getPullQueue():this.getPushQueue()).batch(kt))}})}static generateSyncMessageParamsKey({did:e,delegateDid:_t,dwnUrl:At,protocol:xt,watermark:kt,messageCid:Bt}){return[e,_t,At,xt,kt,Bt].join("~")}static parseSyncMessageParamsKey(e){const[_t,At,xt,kt,Bt,Nt]=e.split("~");return{did:_t,delegateDid:At===""?void 0:At,dwnUrl:xt,watermark:Bt,messageCid:Nt,protocol:kt===""?void 0:kt}}getDwnEventLog({did:e,delegateDid:_t,dwnUrl:At,syncDirection:xt,cursor:kt,protocol:Bt}){var Nt;return __awaiter$w(this,void 0,void 0,function*(){let Ut={},Lt;if(_t)try{Lt=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:DwnInterface.MessagesQuery,delegateDid:_t,protocol:Bt,cached:!0})).grant.id}catch(Kt){return console.error("SyncEngineLevel: Error fetching MessagesQuery permission grant for delegate DID",Kt),[]}if(xt==="pull"){const Kt=Bt?[{protocol:Bt}]:[],qt=yield this.agent.dwn.processRequest({store:!1,target:e,author:e,messageType:DwnInterface.MessagesQuery,granteeDid:_t,messageParams:{filters:Kt,cursor:kt,permissionGrantId:Lt}});try{Ut=yield this.agent.rpc.sendDwnRequest({dwnUrl:At,targetDid:e,message:qt.message})}catch{}}else if(xt==="push"){const Kt=Bt?[{protocol:Bt}]:[];Ut=(yield this.agent.dwn.processRequest({author:e,target:e,messageType:DwnInterface.MessagesQuery,granteeDid:_t,messageParams:{filters:Kt,cursor:kt,permissionGrantId:Lt}})).reply}const jt=(Nt=Ut.entries)!==null&&Nt!==void 0?Nt:[];return Ut.cursor&&this.setCursor(e,At,xt,Ut.cursor,Bt),jt})}getDwnMessage({author:e,delegateDid:_t,protocol:At,messageCid:xt}){return __awaiter$w(this,void 0,void 0,function*(){let kt;if(_t)try{kt=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:DwnInterface.MessagesRead,delegateDid:_t,protocol:At,cached:!0})).grant.id}catch(Lt){console.error("SyncEngineLevel: push - Error fetching MessagesRead permission grant for delegate DID",Lt);return}let{reply:Bt}=yield this.agent.dwn.processRequest({author:e,target:e,messageType:DwnInterface.MessagesRead,granteeDid:_t,messageParams:{messageCid:xt,permissionGrantId:kt}});if(Bt.status.code!==200||!Bt.entry)return;const Nt=Bt.entry;let Ut={message:Nt.message};if(isRecordsWrite(Nt)&&Nt.data){const Lt=yield NodeStream.consumeToBytes({readable:Nt.data});Ut.data=new Blob([Lt],{type:Nt.message.descriptor.dataFormat})}return Ut})}getSyncPeerState({syncDirection:e}){var _t,At,xt,kt;return __awaiter$w(this,void 0,void 0,function*(){const Bt=[];try{for(var Nt=!0,Ut=__asyncValues(this._db.sublevel("registeredIdentities").iterator()),Lt;Lt=yield Ut.next(),_t=Lt.done,!_t;Nt=!0){kt=Lt.value,Nt=!1;const[jt,Kt]=kt,{protocols:qt,delegateDid:zt}=yield new Promise(Ht=>{try{const{protocols:Wt,delegateDid:Qt}=JSON.parse(Kt);Ht({protocols:Wt,delegateDid:Qt})}catch{Ht({protocols:[]})}}),Vt=yield getDwnServiceEndpointUrls(jt,this.agent.did);if(Vt.length!==0)for(let Ht of Vt)if(qt.length===0){const Wt=yield this.getCursor(jt,Ht,e);Bt.push({did:jt,delegateDid:zt,dwnUrl:Ht,cursor:Wt})}else for(const Wt of qt){const Qt=yield this.getCursor(jt,Ht,e,Wt);Bt.push({did:jt,delegateDid:zt,dwnUrl:Ht,cursor:Qt,protocol:Wt})}}}catch(jt){At={error:jt}}finally{try{!Nt&&!_t&&(xt=Ut.return)&&(yield xt.call(Ut))}finally{if(At)throw At.error}}return Bt})}getCursor(e,_t,At,xt){return __awaiter$w(this,void 0,void 0,function*(){const kt=xt?`${e}~${_t}~${At}-${xt}`:`${e}~${_t}~${At}`,Bt=this.getCursorStore();try{const Nt=yield Bt.get(kt);if(Nt)return JSON.parse(Nt)}catch(Nt){if(Nt.notFound)return}})}setCursor(e,_t,At,xt,kt){return __awaiter$w(this,void 0,void 0,function*(){const Bt=kt?`${e}~${_t}~${At}-${kt}`:`${e}~${_t}~${At}`;yield this.getCursorStore().put(Bt,JSON.stringify(xt))})}messageExists(e,_t){return __awaiter$w(this,void 0,void 0,function*(){const At=this.getMessageStore(e);try{return yield At.get(_t),!0}catch(xt){if(xt.notFound)return!1;throw xt}})}addMessage(e,_t){return __awaiter$w(this,void 0,void 0,function*(){return yield this.getMessageStore(e).put(_t,"")})}getMessageStore(e){return this._db.sublevel("history").sublevel(e).sublevel("messages")}getCursorStore(){return this._db.sublevel("cursors")}getPushQueue(){return this._db.sublevel("pushQueue")}getPullQueue(){return this._db.sublevel("pullQueue")}}var __awaiter$v=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$c=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};function buildOidcUrl({baseURL:$t,endpoint:e,authParam:_t,tokenParam:At}){switch(e){case"pushedAuthorizationRequest":return concatenateUrl($t,"par");case"authorize":if(!_t)throw new Error("authParam must be providied when building a token URL");return concatenateUrl($t,`authorize/${_t}.jwt`);case"callback":return concatenateUrl($t,"callback");case"token":if(!At)throw new Error("tokenParam must be providied when building a token URL");return concatenateUrl($t,`token/${At}.jwt`);default:throw new Error(`No matches for endpoint specified: ${e}`)}}function generateCodeChallenge(){return __awaiter$v(this,void 0,void 0,function*(){const $t=CryptoUtils.randomBytes(32),e=yield Sha256$1.digest({data:$t}),_t=Convert.uint8Array(e).toBase64Url();return{codeChallengeBytes:e,codeChallengeBase64Url:_t}})}function createAuthRequest($t){return __awaiter$v(this,void 0,void 0,function*(){const e=CryptoUtils.randomBytes(16),_t=CryptoUtils.randomBytes(16);return Object.assign(Object.assign({},$t),{nonce:Convert.uint8Array(_t).toBase64Url(),response_type:"id_token",response_mode:"direct_post",state:Convert.uint8Array(e).toBase64Url(),client_metadata:{subject_syntax_types_supported:["did:dht","did:jwk"]}})})}function encryptAuthRequest({jwt:$t,encryptionKey:e}){return __awaiter$v(this,void 0,void 0,function*(){const _t={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT"},At=CryptoUtils.randomBytes(24),xt=Convert.object(_t).toUint8Array(),kt=Convert.string($t).toUint8Array(),Nt=xchacha20poly1305(e,At,xt).encrypt(kt),Ut=Nt.subarray(0,-16),Lt=Nt.subarray(-16);return[Convert.object(_t).toBase64Url(),"",Convert.uint8Array(At).toBase64Url(),Convert.uint8Array(Ut).toBase64Url(),Convert.uint8Array(Lt).toBase64Url()].join(".")})}function createResponseObject($t){return __awaiter$v(this,void 0,void 0,function*(){const e=Math.floor(Date.now()/1e3);return Object.assign(Object.assign({},$t),{iat:e,exp:e+600})})}function signJwt({did:$t,data:e}){return __awaiter$v(this,void 0,void 0,function*(){const _t=Convert.object({alg:"EdDSA",kid:$t.document.verificationMethod[0].id,typ:"JWT"}).toBase64Url(),At=Convert.object(e).toBase64Url(),kt=yield(yield $t.getSigner()).sign({data:Convert.string(`${_t}.${At}`).toUint8Array()}),Bt=Convert.uint8Array(kt).toBase64Url();return`${_t}.${At}.${Bt}`})}function verifyJwt({jwt:$t}){var e,_t;return __awaiter$v(this,void 0,void 0,function*(){const[At,xt,kt]=$t.split("."),Bt=Convert.base64Url(At).toObject();if(!Bt.kid)throw new Error("OIDC: Object could not be verified due to missing 'kid' header value.");const{didDocument:Nt}=yield DidJwk$1.resolve(Bt.kid.split("#")[0]);if(!Nt)throw new Error("OIDC: Object could not be verified due to Client DID resolution issue.");const{publicKeyJwk:Ut}=(_t=(e=Nt.verificationMethod)===null||e===void 0?void 0:e.find(qt=>qt.id===Bt.kid))!==null&&_t!==void 0?_t:{};if(!Ut)throw new Error("OIDC: Object could not be verified due to missing public key in DID document.");if(!(yield new EdDsaAlgorithm$2().verify({key:Ut,signature:Convert.base64Url(kt).toUint8Array(),data:Convert.string(`${At}.${xt}`).toUint8Array()})))throw new Error("OIDC: Object failed verification due to invalid signature.");return Convert.base64Url(xt).toObject()})}const getAuthRequest=($t,e)=>__awaiter$v(void 0,void 0,void 0,function*(){const At=yield(yield fetch($t)).text(),xt=decryptAuthRequest({jwe:At,encryption_key:e});return yield verifyJwt({jwt:xt})});function decryptAuthRequest({jwe:$t,encryption_key:e}){const[_t,,At,xt,kt]=$t.split("."),Bt=Convert.base64Url(e).toUint8Array(),Ut=Convert.base64Url(_t).toUint8Array(),Lt=Convert.base64Url(At).toUint8Array(),jt=Convert.base64Url(xt).toUint8Array(),Kt=Convert.base64Url(kt).toUint8Array(),qt=new Uint8Array([...jt,...Kt]),Vt=xchacha20poly1305(Bt,Lt,Ut).decrypt(qt);return Convert.uint8Array(Vt).toString()}function decryptAuthResponse($t,e,_t){return __awaiter$v(this,void 0,void 0,function*(){const[At,,xt,kt,Bt]=e.split("."),Nt=Convert.base64Url(At).toObject(),Ut=yield DidJwk$1.resolve(Nt.kid.split("#")[0]),Lt=yield Oidc.deriveSharedKey($t,Ut.didDocument),jt=Object.assign(Object.assign({},Nt),{pin:_t}),Kt=Convert.object(jt).toUint8Array(),qt=Convert.base64Url(xt).toUint8Array(),zt=Convert.base64Url(kt).toUint8Array(),Vt=Convert.base64Url(Bt).toUint8Array(),Ht=new Uint8Array([...zt,...Vt]),Qt=xchacha20poly1305(Lt,qt,Kt).decrypt(Ht);return Convert.uint8Array(Qt).toString()})}function deriveSharedKey($t,e){var _t,At;return __awaiter$v(this,void 0,void 0,function*(){const xt=yield $t.export(),kt=(_t=e.verificationMethod)===null||_t===void 0?void 0:_t[0].publicKeyJwk,Bt=(At=xt.privateKeys)===null||At===void 0?void 0:At[0];kt.alg="EdDSA";const Nt=yield Ed25519$1.convertPublicKeyToX25519({publicKey:kt}),Ut=yield Ed25519$1.convertPrivateKeyToX25519({privateKey:Bt}),Lt=yield X25519$1.sharedSecret({privateKeyA:Ut,publicKeyB:Nt}),jt=yield crypto.subtle.importKey("raw",Lt,{name:"HKDF"},!1,["deriveBits"]),Kt=yield crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",info:new Uint8Array,salt:new Uint8Array},jt,256);return new Uint8Array(Kt)})}function encryptAuthResponse({jwt:$t,encryptionKey:e,delegateDidKeyId:_t,randomPin:At}){const xt={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT",kid:_t},kt=CryptoUtils.randomBytes(24),Bt=Convert.object(Object.assign(Object.assign({},xt),{pin:At})).toUint8Array(),Nt=Convert.string($t).toUint8Array(),Lt=xchacha20poly1305(e,kt,Bt).encrypt(Nt),jt=Lt.subarray(0,-16),Kt=Lt.subarray(-16);return[Convert.object(xt).toBase64Url(),"",Convert.uint8Array(kt).toBase64Url(),Convert.uint8Array(jt).toBase64Url(),Convert.uint8Array(Kt).toBase64Url()].join(".")}function shouldUseDelegatePermission($t){return isRecordPermissionScope($t)?!0:$t.interface===DwnInterfaceName.Protocols&&$t.method===DwnMethodName.Configure}function createPermissionGrants($t,e,_t,At){return __awaiter$v(this,void 0,void 0,function*(){const xt=new AgentPermissionsApi({agent:_t}),Bt=(yield Promise.all(At.map(Ut=>{const Lt=shouldUseDelegatePermission(Ut);return xt.createGrant({delegated:Lt,store:!0,grantedTo:e.uri,scope:Ut,dateExpires:"2040-06-25T16:09:16.693356Z",author:$t})}))).map(Ut=>__awaiter$v(this,void 0,void 0,function*(){const Lt=Ut.message,{encodedData:jt}=Lt,Kt=__rest$c(Lt,["encodedData"]),qt=Convert.base64Url(jt).toUint8Array(),{reply:zt}=yield _t.sendDwnRequest({author:$t,target:$t,messageType:DwnInterface.RecordsWrite,dataStream:new Blob([qt]),rawMessage:Kt});if(zt.status.code!==202&&zt.status.code!==409)throw new Error(`Could not send the message. Error details: ${zt.status.detail}`);return Ut.message}));return yield Promise.all(Bt)})}function prepareProtocol($t,e,_t){return __awaiter$v(this,void 0,void 0,function*(){const At=yield e.processDwnRequest({author:$t,messageType:DwnInterface.ProtocolsQuery,target:$t,messageParams:{filter:{protocol:_t.protocol}}});if(At.reply.status.code!==200)throw new Error(`Could not fetch protocol: ${At.reply.status.detail}`);if(At.reply.entries===void 0||At.reply.entries.length===0){const{reply:xt,message:kt}=yield e.sendDwnRequest({author:$t,target:$t,messageType:DwnInterface.ProtocolsConfigure,messageParams:{definition:_t}});if(xt.status.code!==202&&xt.status.code!==409)throw new Error(`Could not send protocol: ${xt.status.detail}`);yield e.processDwnRequest({author:$t,target:$t,messageType:DwnInterface.ProtocolsConfigure,rawMessage:kt})}else{const xt=At.reply.entries[0],{reply:kt}=yield e.sendDwnRequest({author:$t,target:$t,messageType:DwnInterface.ProtocolsConfigure,rawMessage:xt});if(kt.status.code!==202&&kt.status.code!==409)throw new Error(`Could not send protocol: ${kt.status.detail}`)}})}function submitAuthResponse($t,e,_t,At){return __awaiter$v(this,void 0,void 0,function*(){const xt=yield DidJwk$1.create(),kt=yield xt.export(),Bt=e.permissionRequests.map(Vt=>__awaiter$v(this,void 0,void 0,function*(){const{protocolDefinition:Ht,permissionScopes:Wt}=Vt;if(!Wt.every(Jt=>"protocol"in Jt&&Jt.protocol===Ht.protocol))throw new Error("All permission scopes must match the protocol uri they are provided with.");return yield prepareProtocol($t,At,Ht),yield Oidc.createPermissionGrants($t,xt,At,Wt)})),Nt=(yield Promise.all(Bt)).flat(),Ut=yield Oidc.createResponseObject({iss:$t,sub:xt.uri,aud:e.client_id,nonce:e.nonce,delegateGrants:Nt,delegatePortableDid:kt}),Lt=yield Oidc.signJwt({did:xt,data:Ut}),jt=yield DidJwk$1.resolve(e.client_id),Kt=yield Oidc.deriveSharedKey(xt,jt==null?void 0:jt.didDocument),qt=Oidc.encryptAuthResponse({jwt:Lt,encryptionKey:Kt,delegateDidKeyId:xt.document.verificationMethod[0].id,randomPin:_t}),zt=new URLSearchParams({id_token:qt,state:e.state}).toString();yield fetch(e.redirect_uri,{body:zt,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})})}const Oidc={createAuthRequest,encryptAuthRequest,getAuthRequest,decryptAuthRequest,createPermissionGrants,createResponseObject,encryptAuthResponse,decryptAuthResponse,deriveSharedKey,signJwt,verifyJwt,buildOidcUrl,generateCodeChallenge,submitAuthResponse};var __awaiter$u=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};function initClient({connectServerUrl:$t,walletUri:e,permissionRequests:_t,onWalletUriReady:At,validatePin:xt}){return __awaiter$u(this,void 0,void 0,function*(){const kt=yield DidJwk$1.create(),Bt=CryptoUtils.randomBytes(32),Nt=Oidc.buildOidcUrl({baseURL:$t,endpoint:"callback"}),Ut=yield Oidc.createAuthRequest({client_id:kt.uri,scope:"openid did:jwk",permissionRequests:_t,redirect_uri:Nt}),Lt=yield Oidc.signJwt({did:kt,data:Ut});if(!Lt)throw new Error("Unable to sign requestObject");const jt=yield Oidc.encryptAuthRequest({jwt:Lt,encryptionKey:Bt}),Kt=new URLSearchParams({request:jt}),qt=Oidc.buildOidcUrl({baseURL:$t,endpoint:"pushedAuthorizationRequest"}),zt=yield fetch(qt,{body:Kt,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!zt.ok)throw new Error(`${zt.status}: ${zt.statusText}`);const Vt=yield zt.json(),Ht=new URL(e);Ht.searchParams.set("request_uri",Vt.request_uri),Ht.searchParams.set("encryption_key",Convert.uint8Array(Bt).toBase64Url()),At(Ht.toString());const Wt=Oidc.buildOidcUrl({baseURL:$t,endpoint:"token",tokenParam:Ut.state}),Qt=yield pollWithTtl(()=>fetch(Wt));if(Qt){const Xt=yield Qt==null?void 0:Qt.text(),Jt=yield xt(),tr=yield Oidc.decryptAuthResponse(kt,Xt,Jt),dr=yield Oidc.verifyJwt({jwt:tr});return{delegateGrants:dr.delegateGrants,delegatePortableDid:dr.delegatePortableDid,connectedDid:dr.iss}}})}function createPermissionRequestForProtocol({definition:$t,permissions:e}){const _t=[];_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Protocols,method:DwnMethodName.Query}),_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Read},{protocol:$t.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Query},{protocol:$t.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Subscribe});for(const At of e)switch(At){case"write":_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Write});break;case"read":_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Read});break;case"delete":_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Delete});break;case"query":_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Query});break;case"subscribe":_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Subscribe});break;case"configure":_t.push({protocol:$t.protocol,interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure});break}return{protocolDefinition:$t,permissionScopes:_t}}const WalletConnect={initClient,createPermissionRequestForProtocol};var __awaiter$t=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$b=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class DidApi{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid}create(e){return __awaiter$t(this,void 0,void 0,function*(){const _t=yield this.agent.processDidRequest({messageType:DidInterface.Create,messageParams:Object.assign({},e)}),{result:At}=_t,xt=__rest$b(_t,["result"]);return Object.assign({did:At},xt)})}resolve(e,_t){return __awaiter$t(this,void 0,void 0,function*(){const{result:At}=yield this.agent.processDidRequest({messageParams:{didUri:e,options:_t},messageType:DidInterface.Resolve});return At})}}function dataToBlob($t,e){let _t;const At=universalTypeOf($t);if(e==="text/plain"||At==="String")_t=new Blob([$t],{type:"text/plain"});else if(e==="application/json"||At==="Object"){const xt=Convert.object($t).toUint8Array();_t=new Blob([xt],{type:"application/json"})}else if(At==="Uint8Array"||At==="ArrayBuffer")_t=new Blob([$t],{type:"application/octet-stream"});else if(At==="Blob")_t=$t;else throw new Error("data type not supported.");return e=e||_t.type||"application/octet-stream",{dataBlob:_t,dataFormat:e}}class SendCache{static check(e,_t){let At=SendCache.cache.get(e);return At?At.has(_t):!1}static set(e,_t){let At=SendCache.cache.get(e)||new Set;if(SendCache.cache.delete(e),SendCache.cache.set(e,At),this.cache.size>SendCache.sendCacheLimit){const xt=SendCache.cache.keys().next().value;SendCache.cache.delete(xt)}if(At.delete(_t),At.add(_t),At.size>SendCache.sendCacheLimit){const xt=At.keys().next().value;At.delete(xt)}}}SendCache.cache=new Map;SendCache.sendCacheLimit=100;var __awaiter$s=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$a=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Record{get _recordsWriteDescriptor(){if(isDwnMessage(DwnInterface.RecordsWrite,this.rawMessage))return this._descriptor}get _immutableProperties(){return this._recordsWriteDescriptor||this._initialWrite.descriptor}get id(){return this._recordId}get contextId(){return this.deleted?this._initialWrite.contextId:this._contextId}get dateCreated(){return this._immutableProperties.dateCreated}get parentId(){return this._immutableProperties.parentId}get protocol(){return this._immutableProperties.protocol}get protocolPath(){return this._immutableProperties.protocolPath}get recipient(){return this._immutableProperties.recipient}get schema(){return this._immutableProperties.schema}get dataFormat(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataFormat}get dataCid(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataCid}get dataSize(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataSize}get datePublished(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.datePublished}get published(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.published}get tags(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.tags}get author(){return this._author}get creator(){return this._creator}get dateModified(){return this._descriptor.messageTimestamp}get encryption(){return this._encryption}get authorization(){return this._authorization}get attestation(){return this._attestation}get protocolRole(){return this._protocolRole}get deleted(){return isDwnMessage(DwnInterface.RecordsDelete,this.rawMessage)}get initialWrite(){return this._initialWrite}get rawMessage(){const e=this._descriptor.interface+this._descriptor.method;let _t;return e===DwnInterface.RecordsWrite?_t=JSON.parse(JSON.stringify({contextId:this._contextId,recordId:this._recordId,descriptor:this._descriptor,attestation:this._attestation,authorization:this._authorization,encryption:this._encryption})):_t=JSON.parse(JSON.stringify({descriptor:this._descriptor,authorization:this._authorization})),removeUndefinedProperties(_t),_t}constructor(e,_t,At){this._agent=e,this._author=_t.author,this._creator=_t.initialWrite?getRecordAuthor(_t.initialWrite):_t.author,this._connectedDid=_t.connectedDid,this._delegateDid=_t.delegateDid,this._permissionsApi=At??new AgentPermissionsApi({agent:e}),this._remoteOrigin=_t.remoteOrigin,this._attestation=_t.attestation,this._authorization=_t.authorization,this._contextId=_t.contextId,this._descriptor=_t.descriptor,this._encryption=_t.encryption,this._initialWrite=_t.initialWrite,this._recordId=this.isRecordsDeleteDescriptor(_t.descriptor)?_t.descriptor.recordId:_t.recordId,this._protocolRole=_t.protocolRole,_t.encodedData&&(this._encodedData=typeof _t.encodedData=="string"?new Blob([Convert.base64Url(_t.encodedData).toUint8Array()],{type:this.dataFormat}):_t.encodedData),_t.data&&(this._readableStream=Stream.isReadableStream(_t.data)?NodeStream.fromWebReadable({readableStream:_t.data}):_t.data)}get data(){const e=this;return{blob(){return __awaiter$s(this,void 0,void 0,function*(){return new Blob([yield NodeStream.consumeToBytes({readable:yield this.stream()})],{type:e.dataFormat})})},bytes(){return __awaiter$s(this,void 0,void 0,function*(){return yield NodeStream.consumeToBytes({readable:yield this.stream()})})},json(){return __awaiter$s(this,void 0,void 0,function*(){return yield NodeStream.consumeToJson({readable:yield this.stream()})})},text(){return __awaiter$s(this,void 0,void 0,function*(){return yield NodeStream.consumeToText({readable:yield this.stream()})})},stream(){return __awaiter$s(this,void 0,void 0,function*(){if(e._encodedData?e._readableStream=NodeStream.fromWebReadable({readableStream:e._encodedData.stream()}):NodeStream.isReadable({readable:e._readableStream})||(e._readableStream=e._remoteOrigin?yield e.readRecordData({target:e._remoteOrigin,isRemote:!0}):yield e.readRecordData({target:e._connectedDid,isRemote:!1})),!e._readableStream)throw new Error("Record data is not available.");return e._readableStream})},then(At,xt){return this.stream().then(At,xt)},catch(At){return this.stream().catch(At)}}}store(e=!1){return __awaiter$s(this,void 0,void 0,function*(){return this.processRecord({signAsOwner:e,store:!0})})}import(e=!0){return __awaiter$s(this,void 0,void 0,function*(){return this.processRecord({store:e,signAsOwner:!0})})}send(e){return __awaiter$s(this,void 0,void 0,function*(){const _t=this._initialWrite;if(e??(e=this._connectedDid),_t&&!Record._sendCache.check(this._recordId,e)){const kt=Object.assign({},_t);removeUndefinedProperties(kt),yield this._agent.sendDwnRequest({messageType:DwnInterface.RecordsWrite,author:this._connectedDid,target:e,rawMessage:kt}),Record._sendCache.set(this._recordId,e)}let At;this.deleted?At={messageType:DwnInterface.RecordsDelete,author:this._connectedDid,target:e,rawMessage:Object.assign({},this.rawMessage)}:At={messageType:DwnInterface.RecordsWrite,author:this._connectedDid,target:e,dataStream:yield this.data.blob(),rawMessage:Object.assign({},this.rawMessage)};const{reply:xt}=yield this._agent.sendDwnRequest(At);return xt})}toJSON(){return{attestation:this.attestation,author:this.author,authorization:this.authorization,contextId:this.contextId,dataCid:this.dataCid,dataFormat:this.dataFormat,dataSize:this.dataSize,dateCreated:this.dateCreated,messageTimestamp:this.dateModified,datePublished:this.datePublished,encryption:this.encryption,parentId:this.parentId,protocol:this.protocol,protocolPath:this.protocolPath,protocolRole:this.protocolRole,published:this.published,recipient:this.recipient,recordId:this.id,schema:this.schema,tags:this.tags}}toString(){let e=`Record: {
`;return e+=`  ID: ${this.id}
`,e+=this.contextId?`  Context ID: ${this.contextId}
`:"",e+=this.protocol?`  Protocol: ${this.protocol}
`:"",e+=this.schema?`  Schema: ${this.schema}
`:"",this.deleted||(e+=`  Data CID: ${this.dataCid}
`,e+=`  Data Format: ${this.dataFormat}
`,e+=`  Data Size: ${this.dataSize}
`),e+=`  Deleted: ${this.deleted}
`,e+=`  Created: ${this.dateCreated}
`,e+=`  Modified: ${this.dateModified}
`,e+="}",e}paginationCursor(e){return __awaiter$s(this,void 0,void 0,function*(){return isDwnMessage(DwnInterface.RecordsWrite,this.rawMessage)?getPaginationCursor(this.rawMessage,e):void 0})}update(e){var{dateModified:_t,data:At}=e,xt=__rest$a(e,["dateModified","data"]);return __awaiter$s(this,void 0,void 0,function*(){if(this.deleted)throw new Error("Record: Cannot revive a deleted record.");const kt=this._recordsWriteDescriptor,{parentId:Bt}=kt,Nt=__rest$a(kt,["parentId"]),Ut=Bt?this._contextId.split("/").slice(0,-1).join("/"):void 0;let Lt=Object.assign(Object.assign(Object.assign({},Nt),xt),{parentContextId:Ut,messageTimestamp:_t,recordId:this._recordId});(isEmptyObject(Lt.tags)||Lt.tags===null)&&delete Lt.tags;let jt;At!==void 0&&(delete Lt.dataCid,delete Lt.dataSize,{dataBlob:jt}=dataToBlob(At,Lt.dataFormat));const Kt=new Set(["data","dataCid","dataFormat","dataSize","datePublished","messageTimestamp","published","tags"]);Record.verifyPermittedMutation(Object.keys(xt),Kt),xt.published===!1&&Lt.datePublished!==void 0&&delete Lt.datePublished;const qt={author:this._connectedDid,dataStream:jt,messageParams:Object.assign({},Lt),messageType:DwnInterface.RecordsWrite,target:this._connectedDid};if(this._delegateDid){const{message:Qt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:qt.messageType});qt.messageParams.delegatedGrant=Qt,qt.granteeDid=this._delegateDid}const zt=yield this._agent.processDwnRequest(qt),{message:Vt,reply:{status:Ht}}=zt,Wt=Vt;return 200<=Ht.code&&Ht.code<=299&&(this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),this._authorization=Wt.authorization,this._protocolRole=xt.protocolRole,Kt.forEach(Qt=>{this._descriptor[Qt]=Wt.descriptor[Qt]}),At!==void 0&&(this._encodedData=jt)),{status:Ht}})}delete(e){return __awaiter$s(this,void 0,void 0,function*(){const{store:_t=!0,signAsOwner:At,dateModified:xt,prune:kt=!1}=e||{},Bt=At&&this._delegateDid===void 0,Nt=At&&this._delegateDid!==void 0;if(this.deleted&&!this._initialWrite)throw new Error("Record: Record is in an invalid state, initial write is missing.");this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),yield this.processInitialWriteIfNeeded({store:_t,signAsOwner:At});let Ut={messageType:DwnInterface.RecordsDelete,author:this._connectedDid,target:this._connectedDid,signAsOwner:Bt,signAsOwnerDelegate:Nt,store:_t};if(this.deleted?Ut.rawMessage=this.rawMessage:Ut.messageParams={prune:kt,recordId:this._recordId,messageTimestamp:xt},this._delegateDid){const{message:qt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:Ut.messageType});Ut.messageParams=Object.assign(Object.assign({},Ut.messageParams),{delegatedGrant:qt}),Ut.granteeDid=this._delegateDid}const Lt=yield this._agent.processDwnRequest(Ut),{message:jt,reply:{status:Kt}}=Lt;return Kt.code!==202?{status:Kt}:(this._author=getRecordAuthor(jt),this._descriptor=jt.descriptor,this._authorization=jt.authorization,this._encodedData=void 0,this._encryption=void 0,this._attestation=void 0,this._contextId=void 0,{status:Kt})})}processInitialWriteIfNeeded({store:e,signAsOwner:_t}){return __awaiter$s(this,void 0,void 0,function*(){if(this.initialWrite&&(_t&&!this._initialWriteSigned||e&&!this._initialWriteStored)){const At=_t&&this._delegateDid===void 0,xt=_t&&this._delegateDid!==void 0,kt={messageType:DwnInterface.RecordsWrite,rawMessage:this.initialWrite,author:this._connectedDid,target:this._connectedDid,signAsOwner:At,signAsOwnerDelegate:xt,store:e};if(this._delegateDid){const{message:jt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:kt.messageType});kt.messageParams=Object.assign(Object.assign({},kt.messageParams),{delegatedGrant:jt}),kt.granteeDid=this._delegateDid}const Bt=yield this._agent.processDwnRequest(kt),{message:Nt,reply:{status:Ut}}=Bt,Lt=Nt;200<=Ut.code&&Ut.code<=299&&(e&&(this._initialWriteStored=!0),_t&&(this._initialWriteSigned=!0,this.initialWrite.authorization=Lt.authorization))}})}processRecord({store:e,signAsOwner:_t}){return __awaiter$s(this,void 0,void 0,function*(){const At=_t&&this._delegateDid===void 0,xt=_t&&this._delegateDid!==void 0;yield this.processInitialWriteIfNeeded({store:e,signAsOwner:_t});let kt;if(this.deleted?kt={messageType:DwnInterface.RecordsDelete,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,signAsOwner:At,signAsOwnerDelegate:xt,store:e}:kt={messageType:DwnInterface.RecordsWrite,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,dataStream:yield this.data.blob(),signAsOwner:At,signAsOwnerDelegate:xt,store:e},this._delegateDid){const{message:jt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:kt.messageType});kt.messageParams=Object.assign(Object.assign({},kt.messageParams),{delegatedGrant:jt}),kt.granteeDid=this._delegateDid}const Bt=yield this._agent.processDwnRequest(kt),{message:Nt,reply:{status:Ut}}=Bt,Lt=Nt;return 200<=Ut.code&&Ut.code<=299&&_t&&(this._authorization=Lt.authorization),{status:Ut}})}readRecordData({target:e,isRemote:_t}){return __awaiter$s(this,void 0,void 0,function*(){const At={author:this._connectedDid,messageParams:{filter:{recordId:this.id}},messageType:DwnInterface.RecordsRead,target:e};if(this._delegateDid)try{const{message:kt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{delegatedGrant:kt}),At.granteeDid=this._delegateDid}catch{At.author=this._delegateDid}const xt=_t?this._agent.sendDwnRequest(At):this._agent.processDwnRequest(At);try{const{reply:{status:kt,record:Bt}}=yield xt;if(kt.code!==200)throw new Error(`${kt.code}: ${kt.detail}`);const Nt=Bt.data;return Stream.isReadableStream(Nt)?NodeStream.fromWebReadable({readableStream:Nt}):Nt}catch(kt){throw new Error(`Error encountered while attempting to read data: ${kt.message}`)}})}static verifyPermittedMutation(e,_t){for(const At of e)if(!_t.has(At))throw new Error(`${At} is an immutable property. Its value cannot be changed.`)}isRecordsDeleteDescriptor(e){return e.interface+e.method===DwnInterface.RecordsDelete}}Record._sendCache=SendCache;var __awaiter$r=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Protocol{constructor(e,_t,At){this._agent=e,this._metadata=At,this._protocolsConfigureMessage=_t}get definition(){return this._protocolsConfigureMessage.descriptor.definition}toJSON(){return this._protocolsConfigureMessage}send(e){return __awaiter$r(this,void 0,void 0,function*(){const{reply:_t}=yield this._agent.sendDwnRequest({author:this._metadata.author,messageCid:this._metadata.messageCid,messageType:DwnInterface.ProtocolsConfigure,target:e});return{status:_t.status}})}}var __awaiter$q=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$9=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class PermissionGrantRevocation{constructor(e,_t){this._permissions=e,this._connectedDid=_t.connectedDid,this._message=_t.message}get author(){return getRecordAuthor(this._message)}static parse({connectedDid:e,agent:_t,message:At}){return __awaiter$q(this,void 0,void 0,function*(){const xt=new AgentPermissionsApi({agent:_t});return new PermissionGrantRevocation(xt,{connectedDid:e,message:At})})}get agent(){return this._permissions.agent}get rawMessage(){return this._message}send(e){return __awaiter$q(this,void 0,void 0,function*(){e??(e=this._connectedDid);const _t=this._message,{encodedData:At}=_t,xt=__rest$9(_t,["encodedData"]),kt=new Blob([Convert.base64Url(At).toUint8Array()]),Bt={messageType:DwnInterface.RecordsWrite,author:this._connectedDid,target:e,dataStream:kt,rawMessage:xt},{reply:Nt}=yield this.agent.sendDwnRequest(Bt);return Nt})}store(e){return __awaiter$q(this,void 0,void 0,function*(){const _t=this.rawMessage,{encodedData:At}=_t,xt=__rest$9(_t,["encodedData"]),kt=new Blob([Convert.base64Url(At).toUint8Array()]),{reply:Bt,message:Nt}=yield this.agent.processDwnRequest({author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface.RecordsWrite,signAsOwner:e,rawMessage:xt,dataStream:kt});return this._message=Object.assign(Object.assign({},Nt),{encodedData:At}),{status:Bt.status}})}}var __awaiter$p=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$8=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class PermissionGrant{constructor({api:e,connectedDid:_t,message:At,grant:xt}){this._permissions=e,this._connectedDid=_t,this._message=At,this._grant=xt}static parse(e){return __awaiter$p(this,void 0,void 0,function*(){const _t=yield PermissionGrant$1.parse(e.message),At=new AgentPermissionsApi({agent:e.agent});return new PermissionGrant(Object.assign(Object.assign({},e),{grant:_t,api:At}))})}get agent(){return this._permissions.agent}get id(){return this._grant.id}get grantor(){return this._grant.grantor}get grantee(){return this._grant.grantee}get dateGranted(){return this._grant.dateGranted}get description(){return this._grant.description}get requestId(){return this._grant.requestId}get dateExpires(){return this._grant.dateExpires}get delegated(){return this._grant.delegated}get scope(){return this._grant.scope}get conditions(){return this._grant.conditions}get rawMessage(){return this._message}send(e){return __awaiter$p(this,void 0,void 0,function*(){e??(e=this._connectedDid);const _t=this._message,{encodedData:At}=_t,xt=__rest$8(_t,["encodedData"]),kt=new Blob([Convert.base64Url(At).toUint8Array()]),Bt={messageType:DwnInterface.RecordsWrite,author:this._connectedDid,target:e,dataStream:kt,rawMessage:xt},{reply:Nt}=yield this.agent.sendDwnRequest(Bt);return Nt})}store(e=!1){return __awaiter$p(this,void 0,void 0,function*(){const _t=this.rawMessage,{encodedData:At}=_t,xt=__rest$8(_t,["encodedData"]),kt=new Blob([Convert.base64Url(At).toUint8Array()]),{reply:Bt,message:Nt}=yield this.agent.processDwnRequest({store:!0,author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface.RecordsWrite,signAsOwner:e,rawMessage:xt,dataStream:kt});return this._message=Object.assign(Object.assign({},Nt),{encodedData:At}),{status:Bt.status}})}import(e=!1){return __awaiter$p(this,void 0,void 0,function*(){const _t=this.rawMessage,{encodedData:At}=_t,xt=__rest$8(_t,["encodedData"]),kt=new Blob([Convert.base64Url(At).toUint8Array()]),{reply:Bt,message:Nt}=yield this.agent.processDwnRequest({store:e,author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface.RecordsWrite,signAsOwner:!0,rawMessage:xt,dataStream:kt});return this._message=Object.assign(Object.assign({},Nt),{encodedData:At}),{status:Bt.status}})}revoke(e=!0){return __awaiter$p(this,void 0,void 0,function*(){const _t=yield this._permissions.createRevocation({store:e,author:this._connectedDid,grant:this._grant});return PermissionGrantRevocation.parse({connectedDid:this._connectedDid,agent:this.agent,message:_t.message})})}isRevoked(e=!1){return this._permissions.isGrantRevoked({author:this._connectedDid,target:this.grantor,grantRecordId:this.id,remote:e})}toJSON(){return{id:this.id,grantor:this.grantor,grantee:this.grantee,dateGranted:this.dateGranted,description:this.description,requestId:this.requestId,dateExpires:this.dateExpires,delegated:this.delegated,scope:this.scope,conditions:this.conditions}}}var __awaiter$o=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$7=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class PermissionRequest{constructor({api:e,connectedDid:_t,message:At,request:xt}){this._permissions=e,this._connectedDid=_t,this._request=xt,this._message=At}static parse({connectedDid:e,agent:_t,message:At}){return __awaiter$o(this,void 0,void 0,function*(){const xt=yield PermissionRequest$1.parse(At),kt=new AgentPermissionsApi({agent:_t});return new PermissionRequest({api:kt,connectedDid:e,message:At,request:xt})})}get agent(){return this._permissions.agent}get id(){return this._request.id}get requester(){return this._request.requester}get description(){return this._request.description}get delegated(){return this._request.delegated}get scope(){return this._request.scope}get conditions(){return this._request.conditions}get rawMessage(){return this._message}send(e){return __awaiter$o(this,void 0,void 0,function*(){e??(e=this._connectedDid);const _t=this._message,{encodedData:At}=_t,xt=__rest$7(_t,["encodedData"]),kt=new Blob([Convert.base64Url(At).toUint8Array()]),Bt={messageType:DwnInterface.RecordsWrite,author:this._connectedDid,target:e,dataStream:kt,rawMessage:xt},{reply:Nt}=yield this.agent.sendDwnRequest(Bt);return Nt})}store(){return __awaiter$o(this,void 0,void 0,function*(){const e=this.rawMessage,{encodedData:_t}=e,At=__rest$7(e,["encodedData"]),xt=new Blob([Convert.base64Url(_t).toUint8Array()]),{reply:kt,message:Bt}=yield this.agent.processDwnRequest({author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface.RecordsWrite,rawMessage:At,dataStream:xt});return this._message=Object.assign(Object.assign({},Bt),{encodedData:_t}),{status:kt.status}})}grant(e,_t=!0){return __awaiter$o(this,void 0,void 0,function*(){const{message:At}=yield this._permissions.createGrant({requestId:this.id,grantedTo:this.requester,scope:this.scope,delegated:this.delegated,author:this._connectedDid,store:_t,dateExpires:e});return PermissionGrant.parse({connectedDid:this._connectedDid,agent:this.agent,message:At})})}toJSON(){return this._request}}var __awaiter$n=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class SubscriptionUtil{static recordSubscriptionHandler({agent:e,connectedDid:_t,request:At,delegateDid:xt,permissionsApi:kt}){const{subscriptionHandler:Bt,from:Nt}=At;return Ut=>__awaiter$n(this,void 0,void 0,function*(){const{message:Lt,initialWrite:jt}=Ut,qt={author:getRecordAuthor(Lt),connectedDid:_t,remoteOrigin:Nt,initialWrite:jt},zt=new Record(e,Object.assign(Object.assign(Object.assign({},Lt),qt),{delegateDid:xt}),kt);Bt(zt)})}}var __awaiter$m=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$6=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class DwnApi{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid,this.delegateDid=e.delegateDid,this.permissionsApi=new AgentPermissionsApi({agent:this.agent})}get permissions(){return{request:e=>__awaiter$m(this,void 0,void 0,function*(){var _t,At;const{message:xt}=yield this.permissionsApi.createRequest(Object.assign(Object.assign({},e),{author:(_t=this.delegateDid)!==null&&_t!==void 0?_t:this.connectedDid})),kt={connectedDid:(At=this.delegateDid)!==null&&At!==void 0?At:this.connectedDid,agent:this.agent,message:xt};return yield PermissionRequest.parse(kt)}),grant:e=>__awaiter$m(this,void 0,void 0,function*(){var _t,At;const{message:xt}=yield this.permissionsApi.createGrant(Object.assign(Object.assign({},e),{author:(_t=this.delegateDid)!==null&&_t!==void 0?_t:this.connectedDid})),kt={connectedDid:(At=this.delegateDid)!==null&&At!==void 0?At:this.connectedDid,agent:this.agent,message:xt};return yield PermissionGrant.parse(kt)}),queryRequests:(e={})=>__awaiter$m(this,void 0,void 0,function*(){var _t,At,xt;const{from:kt}=e,Bt=__rest$6(e,["from"]),Nt=yield this.permissionsApi.fetchRequests(Object.assign(Object.assign({},Bt),{author:(_t=this.delegateDid)!==null&&_t!==void 0?_t:this.connectedDid,target:(At=kt??this.delegateDid)!==null&&At!==void 0?At:this.connectedDid,remote:kt!==void 0})),Ut=[];for(const Lt of Nt){const jt={connectedDid:(xt=this.delegateDid)!==null&&xt!==void 0?xt:this.connectedDid,agent:this.agent,message:Lt.message};Ut.push(yield PermissionRequest.parse(jt))}return Ut}),queryGrants:(e={})=>__awaiter$m(this,void 0,void 0,function*(){var _t,At,xt;const{checkRevoked:kt,from:Bt}=e,Nt=__rest$6(e,["checkRevoked","from"]),Ut=Bt!==void 0,Lt=(_t=this.delegateDid)!==null&&_t!==void 0?_t:this.connectedDid,jt=(At=Bt??this.delegateDid)!==null&&At!==void 0?At:this.connectedDid,Kt=yield this.permissionsApi.fetchGrants(Object.assign(Object.assign({},Nt),{author:Lt,target:jt,remote:Ut})),qt=[];for(const zt of Kt){const Vt={connectedDid:(xt=this.delegateDid)!==null&&xt!==void 0?xt:this.connectedDid,agent:this.agent,message:zt.message};if(kt){const Ht=zt.grant.id;if(yield this.permissionsApi.isGrantRevoked({author:Lt,target:jt,grantRecordId:Ht,remote:Ut}))continue}qt.push(yield PermissionGrant.parse(Vt))}return qt})}}get protocols(){return{configure:e=>__awaiter$m(this,void 0,void 0,function*(){const _t={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface.ProtocolsConfigure,target:this.connectedDid};if(this.delegateDid){const{message:Ut}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.definition.protocol,delegate:!0,cached:!0,messageType:_t.messageType});_t.messageParams=Object.assign(Object.assign({},_t.messageParams),{delegatedGrant:Ut}),_t.granteeDid=this.delegateDid}const At=yield this.agent.processDwnRequest(_t),{message:xt,messageCid:kt,reply:{status:Bt}}=At,Nt={status:Bt};if(Bt.code<300){const Ut={author:this.connectedDid,messageCid:kt};Nt.protocol=new Protocol(this.agent,xt,Ut)}return Nt}),query:e=>__awaiter$m(this,void 0,void 0,function*(){const _t={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface.ProtocolsQuery,target:e.from||this.connectedDid};if(this.delegateDid)try{const{grant:{id:Ut}}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.filter.protocol,cached:!0,messageType:_t.messageType});_t.messageParams=Object.assign(Object.assign({},_t.messageParams),{permissionGrantId:Ut}),_t.granteeDid=this.delegateDid}catch{_t.author=this.delegateDid}let At;e.from?At=yield this.agent.sendDwnRequest(_t):At=yield this.agent.processDwnRequest(_t);const xt=At.reply,{entries:kt=[],status:Bt}=xt;return{protocols:kt.map(Ut=>{const Lt={author:this.connectedDid};return new Protocol(this.agent,Ut,Lt)}),status:Bt}})}}get records(){return{create:e=>__awaiter$m(this,void 0,void 0,function*(){return this.records.write(e)}),createFrom:e=>__awaiter$m(this,void 0,void 0,function*(){var _t;const At=e.record.toJSON(),{author:xt}=At,kt=__rest$6(At,["author"]);return e.data!==void 0&&(delete kt.dataCid,delete kt.dataSize),((_t=e.message)===null||_t===void 0?void 0:_t.published)===!1&&kt.datePublished!==void 0&&(delete kt.datePublished,delete kt.published),(!isEmptyObject(e.message)||e.author&&e.author!==xt)&&delete kt.recordId,this.records.write({data:e.data,message:Object.assign(Object.assign({},kt),e.message)})}),delete:e=>__awaiter$m(this,void 0,void 0,function*(){const _t={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface.RecordsDelete,target:e.from||this.connectedDid};if(this.delegateDid){const{message:kt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:_t.messageType});_t.messageParams=Object.assign(Object.assign({},_t.messageParams),{delegatedGrant:kt}),_t.granteeDid=this.delegateDid}let At;e.from?At=yield this.agent.sendDwnRequest(_t):At=yield this.agent.processDwnRequest(_t);const{reply:{status:xt}}=At;return{status:xt}}),query:e=>__awaiter$m(this,void 0,void 0,function*(){const _t={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface.RecordsQuery,target:e.from||this.connectedDid};if(this.delegateDid)try{const{message:Lt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:_t.messageType});_t.messageParams=Object.assign(Object.assign({},_t.messageParams),{delegatedGrant:Lt}),_t.granteeDid=this.delegateDid}catch{_t.author=this.delegateDid}let At;e.from?At=yield this.agent.sendDwnRequest(_t):At=yield this.agent.processDwnRequest(_t);const xt=At.reply,{entries:kt=[],status:Bt,cursor:Nt}=xt;return{records:kt.map(Lt=>{const jt=Object.assign({author:getRecordAuthor(Lt),connectedDid:this.connectedDid,remoteOrigin:e.from,delegateDid:this.delegateDid},Lt);return new Record(this.agent,jt,this.permissionsApi)}),status:Bt,cursor:Nt}}),read:e=>__awaiter$m(this,void 0,void 0,function*(){const _t={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface.RecordsRead,target:e.from||this.connectedDid};if(this.delegateDid)try{const{message:Nt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:_t.messageType});_t.messageParams=Object.assign(Object.assign({},_t.messageParams),{delegatedGrant:Nt}),_t.granteeDid=this.delegateDid}catch{_t.author=this.delegateDid}let At;e.from?At=yield this.agent.sendDwnRequest(_t):At=yield this.agent.processDwnRequest(_t);const{reply:{record:xt,status:kt}}=At;let Bt;if(200<=kt.code&&kt.code<=299){const Nt=Object.assign({author:getRecordAuthor(xt),connectedDid:this.connectedDid,remoteOrigin:e.from,delegateDid:this.delegateDid},xt);Bt=new Record(this.agent,Nt,this.permissionsApi)}return{record:Bt,status:kt}}),subscribe:e=>__awaiter$m(this,void 0,void 0,function*(){const _t={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface.RecordsSubscribe,target:e.from||this.connectedDid,subscriptionHandler:SubscriptionUtil.recordSubscriptionHandler({agent:this.agent,connectedDid:this.connectedDid,delegateDid:this.delegateDid,permissionsApi:this.permissionsApi,request:e})};if(this.delegateDid)try{const{message:Nt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:_t.messageType});_t.messageParams=Object.assign(Object.assign({},_t.messageParams),{delegatedGrant:Nt}),_t.granteeDid=this.delegateDid}catch{_t.author=this.delegateDid}let At;e.from?At=yield this.agent.sendDwnRequest(_t):At=yield this.agent.processDwnRequest(_t);const xt=At.reply,{status:kt,subscription:Bt}=xt;return{status:kt,subscription:Bt}}),write:e=>__awaiter$m(this,void 0,void 0,function*(){var _t;const{dataBlob:At,dataFormat:xt}=dataToBlob(e.data,(_t=e.message)===null||_t===void 0?void 0:_t.dataFormat),kt={store:e.store,messageType:DwnInterface.RecordsWrite,messageParams:Object.assign(Object.assign({},e.message),{dataFormat:xt}),author:this.connectedDid,target:this.connectedDid,dataStream:At};if(this.delegateDid){const{message:jt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.protocol,delegate:!0,cached:!0,messageType:kt.messageType});kt.messageParams=Object.assign(Object.assign({},kt.messageParams),{delegatedGrant:jt}),kt.granteeDid=this.delegateDid}const Bt=yield this.agent.processDwnRequest(kt),{message:Nt,reply:{status:Ut}}=Bt;let Lt;if(200<=Ut.code&&Ut.code<=299){const jt=Object.assign({author:this.connectedDid,connectedDid:this.connectedDid,encodedData:At,delegateDid:this.delegateDid},Nt);Lt=new Record(this.agent,jt,this.permissionsApi)}return{record:Lt,status:Ut}})}}}var __awaiter$l=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class VcApi{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid}create(){return __awaiter$l(this,void 0,void 0,function*(){throw new Error("Not implemented.")})}}var DidVerificationRelationship;(function($t){$t.authentication="authentication",$t.assertionMethod="assertionMethod",$t.keyAgreement="keyAgreement",$t.capabilityInvocation="capabilityInvocation",$t.capabilityDelegation="capabilityDelegation"})(DidVerificationRelationship||(DidVerificationRelationship={}));const EMPTY_DID_RESOLUTION_RESULT={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};class Did{constructor({method:e,id:_t,path:At,query:xt,fragment:kt,params:Bt}){this.uri=`did:${e}:${_t}`,this.method=e,this.id=_t,this.path=At,this.query=xt,this.fragment=kt,this.params=Bt}static parse(e){if(!e)return null;const _t=Did.DID_URI_PATTERN.exec(e);if(!_t||!_t.groups)return null;const{method:At,id:xt,path:kt,query:Bt,fragment:Nt}=_t.groups,Ut={uri:`did:${At}:${xt}`,method:At,id:xt};if(kt&&(Ut.path=kt),Bt&&(Ut.query=Bt.slice(1)),Nt&&(Ut.fragment=Nt.slice(1)),Bt){const Lt={},jt=Bt.slice(1).split("&");for(const Kt of jt){const[qt,zt]=Kt.split("=");Lt[qt]=zt}Ut.params=Lt}return Ut}}Did.METHOD_PATTERN="([a-z0-9]+)";Did.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Did.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Did.PCT_ENCODED_PATTERN})`;Did.METHOD_ID_PATTERN=`((?:${Did.ID_CHAR_PATTERN}*:)*(${Did.ID_CHAR_PATTERN}+))`;Did.PATH_PATTERN="(/[^#?]*)?";Did.QUERY_PATTERN="([?][^#]*)?";Did.FRAGMENT_PATTERN="(#.*)?";Did.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Did.METHOD_PATTERN}):(?<id>${Did.METHOD_ID_PATTERN})(?<path>${Did.PATH_PATTERN})(?<query>${Did.QUERY_PATTERN})(?<fragment>${Did.FRAGMENT_PATTERN})$`);class DidError extends Error{constructor(e,_t){super(`${e}: ${_t}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,DidError)}}var DidErrorCode;(function($t){$t.InvalidDid="invalidDid",$t.MethodNotSupported="methodNotSupported",$t.InternalError="internalError",$t.InvalidDidDocument="invalidDidDocument",$t.InvalidDidDocumentLength="invalidDidDocumentLength",$t.InvalidDidUrl="invalidDidUrl",$t.InvalidPreviousDidProof="invalidPreviousDidProof",$t.InvalidPublicKey="invalidPublicKey",$t.InvalidPublicKeyLength="invalidPublicKeyLength",$t.InvalidPublicKeyType="invalidPublicKeyType",$t.InvalidSignature="invalidSignature",$t.NotFound="notFound",$t.RepresentationNotSupported="representationNotSupported",$t.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(DidErrorCode||(DidErrorCode={}));var __awaiter$k=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Sha256{static digest({data:e}){return __awaiter$k(this,void 0,void 0,function*(){return sha256(e)})}}class CryptoAlgorithm{}var __awaiter$j=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Sha2Algorithm extends CryptoAlgorithm{digest({algorithm:e,data:_t}){return __awaiter$j(this,void 0,void 0,function*(){switch(e){case"SHA-256":return yield Sha256.digest({data:_t})}})}}function canonicalize($t){const e=At=>{if(At!==null&&typeof At=="object"&&!Array.isArray(At)){const xt=Object.keys(At).sort(),kt={};for(const Bt of xt)kt[Bt]=e(At[Bt]);return kt}return At},_t=e($t);return JSON.stringify(_t)}var __awaiter$i=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const KEY_URI_PREFIX_JWK="urn:jwk:";function computeJwkThumbprint({jwk:$t}){return __awaiter$i(this,void 0,void 0,function*(){const e=$t.kty;let _t;if(e==="EC")_t={crv:$t.crv,kty:$t.kty,x:$t.x,y:$t.y};else if(e==="oct")_t={k:$t.k,kty:$t.kty};else if(e==="OKP")_t={crv:$t.crv,kty:$t.kty,x:$t.x};else if(e==="RSA")_t={e:$t.e,kty:$t.kty,n:$t.n};else throw new Error(`Unsupported key type: ${e}`);removeUndefinedProperties(_t);const At=canonicalize(_t),xt=Convert.string(At).toUint8Array(),kt=yield Sha256.digest({data:xt});return Convert.uint8Array(kt).toBase64Url()})}function isEcPrivateJwk($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t&&"d"in $t)||$t.kty!=="EC"||typeof $t.d!="string"||typeof $t.x!="string")}function isEcPublicJwk($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t)||"d"in $t||$t.kty!=="EC"||typeof $t.x!="string")}function isOkpPrivateJwk($t){return!(!$t||typeof $t!="object"||!("kty"in $t&&"crv"in $t&&"x"in $t&&"d"in $t)||$t.kty!=="OKP"||typeof $t.d!="string"||typeof $t.x!="string")}function isOkpPublicJwk($t){return!(!$t||typeof $t!="object"||"d"in $t||!("kty"in $t&&"crv"in $t&&"x"in $t)||$t.kty!=="OKP"||typeof $t.x!="string")}function isPrivateJwk($t){if(!$t||typeof $t!="object")return!1;switch($t.kty){case"EC":case"OKP":case"RSA":return"d"in $t;case"oct":return"k"in $t;default:return!1}}var __awaiter$h=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$5=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Secp256k1{static adjustSignatureToLowS({signature:e}){return __awaiter$h(this,void 0,void 0,function*(){const _t=secp256k1.Signature.fromCompact(e);return _t.hasHighS()?_t.normalizeS().toCompactRawBytes():e})}static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){const _t=yield Secp256k1.getCurvePoint({keyBytes:e}),At={kty:"EC",crv:"secp256k1",d:Convert.uint8Array(e).toBase64Url(),x:Convert.uint8Array(_t.x).toBase64Url(),y:Convert.uint8Array(_t.y).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){const _t=yield Secp256k1.getCurvePoint({keyBytes:e}),At={kty:"EC",crv:"secp256k1",x:Convert.uint8Array(_t.x).toBase64Url(),y:Convert.uint8Array(_t.y).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static compressPublicKey({publicKeyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){return secp256k1.ProjectivePoint.fromHex(e).toRawBytes(!0)})}static computePublicKey({key:e}){return __awaiter$h(this,void 0,void 0,function*(){const _t=yield Secp256k1.privateKeyToBytes({privateKey:e}),At=yield Secp256k1.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"secp256k1",x:Convert.uint8Array(At.x).toBase64Url(),y:Convert.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint({jwk:xt}),xt})}static convertDerToCompactSignature({derSignature:e}){return __awaiter$h(this,void 0,void 0,function*(){return secp256k1.Signature.fromDER(e).toCompactRawBytes()})}static decompressPublicKey({publicKeyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){return secp256k1.ProjectivePoint.fromHex(e).toRawBytes(!1)})}static generateKey(){return __awaiter$h(this,void 0,void 0,function*(){const e=secp256k1.utils.randomPrivateKey(),_t=yield Secp256k1.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint({jwk:_t}),_t})}static getPublicKey({key:e}){var _t;return __awaiter$h(this,void 0,void 0,function*(){if(!(isEcPrivateJwk(e)&&e.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let At=__rest$5(e,["d"]);return(_t=At.kid)!==null&&_t!==void 0||(At.kid=yield computeJwkThumbprint({jwk:At})),At})}static privateKeyToBytes({privateKey:e}){return __awaiter$h(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Convert.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$h(this,void 0,void 0,function*(){if(!(isEcPublicJwk(e)&&e.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const _t=new Uint8Array([4]),At=Convert.base64Url(e.x).toUint8Array(),xt=Convert.base64Url(e.y).toUint8Array();return new Uint8Array([..._t,...At,...xt])})}static sharedSecret({privateKeyA:e,publicKeyB:_t}){return __awaiter$h(this,void 0,void 0,function*(){if("x"in e&&"x"in _t&&e.x===_t.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const At=yield Secp256k1.privateKeyToBytes({privateKey:e}),xt=yield Secp256k1.publicKeyToBytes({publicKey:_t});return secp256k1.getSharedSecret(At,xt,!0).slice(1)})}static sign({data:e,key:_t}){return __awaiter$h(this,void 0,void 0,function*(){const At=yield Secp256k1.privateKeyToBytes({privateKey:_t}),xt=sha256(e);return secp256k1.sign(xt,At).toCompactRawBytes()})}static validatePrivateKey({privateKeyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){return secp256k1.utils.isValidPrivateKey(e)})}static validatePublicKey({publicKeyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){try{secp256k1.ProjectivePoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:_t,data:At}){return __awaiter$h(this,void 0,void 0,function*(){const xt=yield Secp256k1.publicKeyToBytes({publicKey:e}),kt=sha256(At);return secp256k1.verify(_t,kt,xt,{lowS:!1})})}static getCurvePoint({keyBytes:e}){return __awaiter$h(this,void 0,void 0,function*(){e.byteLength===32&&(e=secp256k1.getPublicKey(e));const _t=secp256k1.ProjectivePoint.fromHex(e),At=numberToBytesBE(_t.x,32),xt=numberToBytesBE(_t.y,32);return{x:At,y:xt}})}}var __awaiter$g=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$4=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Secp256r1{static adjustSignatureToLowS({signature:e}){return __awaiter$g(this,void 0,void 0,function*(){const _t=secp256r1.Signature.fromCompact(e);return _t.hasHighS()?_t.normalizeS().toCompactRawBytes():e})}static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){const _t=yield Secp256r1.getCurvePoint({keyBytes:e}),At={kty:"EC",crv:"P-256",d:Convert.uint8Array(e).toBase64Url(),x:Convert.uint8Array(_t.x).toBase64Url(),y:Convert.uint8Array(_t.y).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){const _t=yield Secp256r1.getCurvePoint({keyBytes:e}),At={kty:"EC",crv:"P-256",x:Convert.uint8Array(_t.x).toBase64Url(),y:Convert.uint8Array(_t.y).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static compressPublicKey({publicKeyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){return secp256r1.ProjectivePoint.fromHex(e).toRawBytes(!0)})}static computePublicKey({key:e}){return __awaiter$g(this,void 0,void 0,function*(){const _t=yield Secp256r1.privateKeyToBytes({privateKey:e}),At=yield Secp256r1.getCurvePoint({keyBytes:_t}),xt={kty:"EC",crv:"P-256",x:Convert.uint8Array(At.x).toBase64Url(),y:Convert.uint8Array(At.y).toBase64Url()};return xt.kid=yield computeJwkThumbprint({jwk:xt}),xt})}static convertDerToCompactSignature({derSignature:e}){return __awaiter$g(this,void 0,void 0,function*(){return secp256r1.Signature.fromDER(e).toCompactRawBytes()})}static decompressPublicKey({publicKeyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){return secp256r1.ProjectivePoint.fromHex(e).toRawBytes(!1)})}static generateKey(){return __awaiter$g(this,void 0,void 0,function*(){const e=secp256r1.utils.randomPrivateKey(),_t=yield Secp256r1.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint({jwk:_t}),_t})}static getPublicKey({key:e}){var _t;return __awaiter$g(this,void 0,void 0,function*(){if(!(isEcPrivateJwk(e)&&e.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let At=__rest$4(e,["d"]);return(_t=At.kid)!==null&&_t!==void 0||(At.kid=yield computeJwkThumbprint({jwk:At})),At})}static privateKeyToBytes({privateKey:e}){return __awaiter$g(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Convert.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$g(this,void 0,void 0,function*(){if(!(isEcPublicJwk(e)&&e.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const _t=new Uint8Array([4]),At=Convert.base64Url(e.x).toUint8Array(),xt=Convert.base64Url(e.y).toUint8Array();return new Uint8Array([..._t,...At,...xt])})}static sharedSecret({privateKeyA:e,publicKeyB:_t}){return __awaiter$g(this,void 0,void 0,function*(){if("x"in e&&"x"in _t&&e.x===_t.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const At=yield Secp256r1.privateKeyToBytes({privateKey:e}),xt=yield Secp256r1.publicKeyToBytes({publicKey:_t});return secp256r1.getSharedSecret(At,xt,!0).slice(1)})}static sign({data:e,key:_t}){return __awaiter$g(this,void 0,void 0,function*(){const At=yield Secp256r1.privateKeyToBytes({privateKey:_t}),xt=sha256(e);return secp256r1.sign(xt,At).toCompactRawBytes()})}static validatePrivateKey({privateKeyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){return secp256r1.utils.isValidPrivateKey(e)})}static validatePublicKey({publicKeyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){try{secp256r1.ProjectivePoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:_t,data:At}){return __awaiter$g(this,void 0,void 0,function*(){const xt=yield Secp256r1.publicKeyToBytes({publicKey:e}),kt=sha256(At);return secp256r1.verify(_t,kt,xt,{lowS:!1})})}static getCurvePoint({keyBytes:e}){return __awaiter$g(this,void 0,void 0,function*(){e.byteLength===32&&(e=secp256r1.getPublicKey(e));const _t=secp256r1.ProjectivePoint.fromHex(e),At=numberToBytesBE(_t.x,32),xt=numberToBytesBE(_t.y,32);return{x:At,y:xt}})}}var __awaiter$f=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class EcdsaAlgorithm extends CryptoAlgorithm{computePublicKey({key:e}){return __awaiter$f(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const _t=yield Secp256k1.computePublicKey({key:e});return _t.alg="ES256K",_t}case"P-256":{const _t=yield Secp256r1.computePublicKey({key:e});return _t.alg="ES256",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$f(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const _t=yield Secp256k1.generateKey();return _t.alg="ES256K",_t}case"ES256":case"secp256r1":{const _t=yield Secp256r1.generateKey();return _t.alg="ES256",_t}}})}getPublicKey({key:e}){return __awaiter$f(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const _t=yield Secp256k1.getPublicKey({key:e});return _t.alg="ES256K",_t}case"P-256":{const _t=yield Secp256r1.getPublicKey({key:e});return _t.alg="ES256",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}sign({key:e,data:_t}){return __awaiter$f(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield Secp256k1.sign({key:e,data:_t});case"P-256":return yield Secp256r1.sign({key:e,data:_t});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:_t,data:At}){return __awaiter$f(this,void 0,void 0,function*(){if(!isEcPublicJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield Secp256k1.verify({key:e,signature:_t,data:At});case"P-256":return yield Secp256r1.verify({key:e,signature:_t,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}}var __awaiter$e=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$3=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Ed25519{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){const _t=ed25519.getPublicKey(e),At={crv:"Ed25519",d:Convert.uint8Array(e).toBase64Url(),kty:"OKP",x:Convert.uint8Array(_t).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){const _t={kty:"OKP",crv:"Ed25519",x:Convert.uint8Array(e).toBase64Url()};return _t.kid=yield computeJwkThumbprint({jwk:_t}),_t})}static computePublicKey({key:e}){return __awaiter$e(this,void 0,void 0,function*(){const _t=yield Ed25519.privateKeyToBytes({privateKey:e}),At=ed25519.getPublicKey(_t),xt={kty:"OKP",crv:"Ed25519",x:Convert.uint8Array(At).toBase64Url()};return xt.kid=yield computeJwkThumbprint({jwk:xt}),xt})}static convertPrivateKeyToX25519({privateKey:e}){return __awaiter$e(this,void 0,void 0,function*(){const _t=yield Ed25519.privateKeyToBytes({privateKey:e}),At=edwardsToMontgomeryPriv(_t),xt=x25519.getPublicKey(At),kt={kty:"OKP",crv:"X25519",d:Convert.uint8Array(At).toBase64Url(),x:Convert.uint8Array(xt).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static convertPublicKeyToX25519({publicKey:e}){return __awaiter$e(this,void 0,void 0,function*(){const _t=yield Ed25519.publicKeyToBytes({publicKey:e});if(!(yield Ed25519.validatePublicKey({publicKeyBytes:_t})))throw new Error("Ed25519: Invalid public key.");const xt=edwardsToMontgomeryPub(_t),kt={kty:"OKP",crv:"X25519",x:Convert.uint8Array(xt).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static generateKey(){return __awaiter$e(this,void 0,void 0,function*(){const e=ed25519.utils.randomPrivateKey(),_t=yield Ed25519.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint({jwk:_t}),_t})}static getPublicKey({key:e}){var _t;return __awaiter$e(this,void 0,void 0,function*(){if(!(isOkpPrivateJwk(e)&&e.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let At=__rest$3(e,["d"]);return(_t=At.kid)!==null&&_t!==void 0||(At.kid=yield computeJwkThumbprint({jwk:At})),At})}static privateKeyToBytes({privateKey:e}){return __awaiter$e(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Convert.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$e(this,void 0,void 0,function*(){if(!isOkpPublicJwk(e))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Convert.base64Url(e.x).toUint8Array()})}static sign({key:e,data:_t}){return __awaiter$e(this,void 0,void 0,function*(){const At=yield Ed25519.privateKeyToBytes({privateKey:e});return ed25519.sign(_t,At)})}static validatePublicKey({publicKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){try{ed25519.ExtendedPoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:_t,data:At}){return __awaiter$e(this,void 0,void 0,function*(){const xt=yield Ed25519.publicKeyToBytes({publicKey:e});return ed25519.verify(_t,At,xt)})}}var __awaiter$d=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class EdDsaAlgorithm extends CryptoAlgorithm{computePublicKey({key:e}){return __awaiter$d(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const _t=yield Ed25519.computePublicKey({key:e});return _t.alg="EdDSA",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$d(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const _t=yield Ed25519.generateKey();return _t.alg="EdDSA",_t}}})}getPublicKey({key:e}){return __awaiter$d(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const _t=yield Ed25519.getPublicKey({key:e});return _t.alg="EdDSA",_t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}sign({key:e,data:_t}){return __awaiter$d(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield Ed25519.sign({key:e,data:_t});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:_t,data:At}){return __awaiter$d(this,void 0,void 0,function*(){if(!isOkpPublicJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield Ed25519.verify({key:e,signature:_t,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}}var __awaiter$c=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};const supportedAlgorithms={Ed25519:{implementation:EdDsaAlgorithm,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm,names:["SHA-256"]}};class LocalKeyManager{constructor(e){var _t;this._algorithmInstances=new Map,this._keyStore=(_t=e==null?void 0:e.keyStore)!==null&&_t!==void 0?_t:new MemoryStore}digest({algorithm:e,data:_t}){return __awaiter$c(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:_t})})}exportKey({keyUri:e}){return __awaiter$c(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){return __awaiter$c(this,void 0,void 0,function*(){const At=yield this.getAlgorithm({algorithm:e}).generateKey({algorithm:e});if((At==null?void 0:At.kid)===void 0)throw new Error("Generated key is missing a required property: kid");const xt=`${KEY_URI_PREFIX_JWK}${At.kid}`;return yield this._keyStore.set(xt,At),xt})}getKeyUri({key:e}){return __awaiter$c(this,void 0,void 0,function*(){const _t=yield computeJwkThumbprint({jwk:e});return`${KEY_URI_PREFIX_JWK}${_t}`})}getPublicKey({keyUri:e}){return __awaiter$c(this,void 0,void 0,function*(){const _t=yield this.getPrivateKey({keyUri:e}),At=this.getAlgorithmName({key:_t});return yield this.getAlgorithm({algorithm:At}).getPublicKey({key:_t})})}importKey({key:e}){var _t;return __awaiter$c(this,void 0,void 0,function*(){if(!isPrivateJwk(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const At=structuredClone(e);(_t=At.kid)!==null&&_t!==void 0||(At.kid=yield computeJwkThumbprint({jwk:At}));const xt=yield this.getKeyUri({key:At});return yield this._keyStore.set(xt,At),xt})}sign({keyUri:e,data:_t}){return __awaiter$c(this,void 0,void 0,function*(){const At=yield this.getPrivateKey({keyUri:e}),xt=this.getAlgorithmName({key:At});return this.getAlgorithm({algorithm:xt}).sign({data:_t,key:At})})}verify({key:e,signature:_t,data:At}){return __awaiter$c(this,void 0,void 0,function*(){const xt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:xt}).verify({key:e,signature:_t,data:At})})}getAlgorithm({algorithm:e}){var _t;const At=(_t=supportedAlgorithms[e])===null||_t===void 0?void 0:_t.implementation;if(!At)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(At)||this._algorithmInstances.set(At,new At),this._algorithmInstances.get(At)}getAlgorithmName({key:e}){const _t=e.alg,At=e.crv;for(const xt in supportedAlgorithms){const kt=supportedAlgorithms[xt];if(_t&&kt.names.includes(_t))return xt;if(At&&kt.names.includes(At))return xt}throw new Error(`Unable to determine algorithm based on provided input: alg=${_t}, crv=${At}`)}getPrivateKey({keyUri:e}){return __awaiter$c(this,void 0,void 0,function*(){const _t=yield this._keyStore.get(e);if(!_t)throw new Error(`Key not found: ${e}`);return _t})}}function getJoseSignatureAlgorithmFromPublicKey($t){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if($t.alg&&Object.values(e).includes($t.alg))return $t.alg;if($t.crv&&Object.keys(e).includes($t.crv))return e[$t.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${$t.alg}, crv=${$t.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=$t=>new Uint32Array($t.buffer,$t.byteOffset,Math.floor($t.byteLength/4));function isBytes$1($t){return $t instanceof Uint8Array||$t!=null&&typeof $t=="object"&&$t.constructor.name==="Uint8Array"}const isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes($t){if(typeof $t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof $t}`);return new Uint8Array(new TextEncoder().encode($t))}function toBytes($t){if(typeof $t=="string")$t=utf8ToBytes($t);else if(isBytes$1($t))$t=$t.slice();else throw new Error(`expected Uint8Array, got ${typeof $t}`);return $t}function ensureBytes($t,e){if(!isBytes$1($t))throw new Error("Uint8Array expected");if($t.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function isBytes($t){return $t!=null&&typeof $t=="object"&&($t instanceof Uint8Array||$t.constructor.name==="Uint8Array")}function bytes($t,...e){if(!isBytes($t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes($t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${$t.length}`)}function exists($t,e=!0){if($t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&$t.finished)throw new Error("Hash#digest() has already been called")}function output($t,e){bytes($t);const _t=e.outputLen;if($t.length<_t)throw new Error(`digestInto() expects output buffer of length at least ${_t}`)}var __awaiter$b=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$2=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class X25519{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$b(this,void 0,void 0,function*(){const _t=x25519.getPublicKey(e),At={kty:"OKP",crv:"X25519",d:Convert.uint8Array(e).toBase64Url(),x:Convert.uint8Array(_t).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$b(this,void 0,void 0,function*(){const _t={kty:"OKP",crv:"X25519",x:Convert.uint8Array(e).toBase64Url()};return _t.kid=yield computeJwkThumbprint({jwk:_t}),_t})}static computePublicKey({key:e}){return __awaiter$b(this,void 0,void 0,function*(){const _t=yield X25519.privateKeyToBytes({privateKey:e}),At=x25519.getPublicKey(_t),xt={kty:"OKP",crv:"X25519",x:Convert.uint8Array(At).toBase64Url()};return xt.kid=yield computeJwkThumbprint({jwk:xt}),xt})}static generateKey(){return __awaiter$b(this,void 0,void 0,function*(){const e=x25519.utils.randomPrivateKey(),_t=yield X25519.bytesToPrivateKey({privateKeyBytes:e});return _t.kid=yield computeJwkThumbprint({jwk:_t}),_t})}static getPublicKey({key:e}){var _t;return __awaiter$b(this,void 0,void 0,function*(){if(!(isOkpPrivateJwk(e)&&e.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let At=__rest$2(e,["d"]);return(_t=At.kid)!==null&&_t!==void 0||(At.kid=yield computeJwkThumbprint({jwk:At})),At})}static privateKeyToBytes({privateKey:e}){return __awaiter$b(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new Error("X25519: The provided key is not a valid OKP private key.");return Convert.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$b(this,void 0,void 0,function*(){if(!isOkpPublicJwk(e))throw new Error("X25519: The provided key is not a valid OKP public key.");return Convert.base64Url(e.x).toUint8Array()})}static sharedSecret({privateKeyA:e,publicKeyB:_t}){return __awaiter$b(this,void 0,void 0,function*(){if("x"in e&&"x"in _t&&e.x===_t.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const At=yield X25519.privateKeyToBytes({privateKey:e}),xt=yield X25519.publicKeyToBytes({publicKey:_t});return x25519.getSharedSecret(At,xt)})}}const u8to16=($t,e)=>$t[e++]&255|($t[e++]&255)<<8;class Poly1305{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes(e),ensureBytes(e,32);const _t=u8to16(e,0),At=u8to16(e,2),xt=u8to16(e,4),kt=u8to16(e,6),Bt=u8to16(e,8),Nt=u8to16(e,10),Ut=u8to16(e,12),Lt=u8to16(e,14);this.r[0]=_t&8191,this.r[1]=(_t>>>13|At<<3)&8191,this.r[2]=(At>>>10|xt<<6)&7939,this.r[3]=(xt>>>7|kt<<9)&8191,this.r[4]=(kt>>>4|Bt<<12)&255,this.r[5]=Bt>>>1&8190,this.r[6]=(Bt>>>14|Nt<<2)&8191,this.r[7]=(Nt>>>11|Ut<<5)&8065,this.r[8]=(Ut>>>8|Lt<<8)&8191,this.r[9]=Lt>>>5&127;for(let jt=0;jt<8;jt++)this.pad[jt]=u8to16(e,16+2*jt)}process(e,_t,At=!1){const xt=At?0:2048,{h:kt,r:Bt}=this,Nt=Bt[0],Ut=Bt[1],Lt=Bt[2],jt=Bt[3],Kt=Bt[4],qt=Bt[5],zt=Bt[6],Vt=Bt[7],Ht=Bt[8],Wt=Bt[9],Qt=u8to16(e,_t+0),Xt=u8to16(e,_t+2),Jt=u8to16(e,_t+4),tr=u8to16(e,_t+6),dr=u8to16(e,_t+8),vr=u8to16(e,_t+10),$r=u8to16(e,_t+12),Ir=u8to16(e,_t+14);let Rr=kt[0]+(Qt&8191),Nr=kt[1]+((Qt>>>13|Xt<<3)&8191),kr=kt[2]+((Xt>>>10|Jt<<6)&8191),lr=kt[3]+((Jt>>>7|tr<<9)&8191),ir=kt[4]+((tr>>>4|dr<<12)&8191),er=kt[5]+(dr>>>1&8191),rr=kt[6]+((dr>>>14|vr<<2)&8191),yr=kt[7]+((vr>>>11|$r<<5)&8191),fr=kt[8]+(($r>>>8|Ir<<8)&8191),gr=kt[9]+(Ir>>>5|xt),ar=0,nr=ar+Rr*Nt+Nr*(5*Wt)+kr*(5*Ht)+lr*(5*Vt)+ir*(5*zt);ar=nr>>>13,nr&=8191,nr+=er*(5*qt)+rr*(5*Kt)+yr*(5*jt)+fr*(5*Lt)+gr*(5*Ut),ar+=nr>>>13,nr&=8191;let ur=ar+Rr*Ut+Nr*Nt+kr*(5*Wt)+lr*(5*Ht)+ir*(5*Vt);ar=ur>>>13,ur&=8191,ur+=er*(5*zt)+rr*(5*qt)+yr*(5*Kt)+fr*(5*jt)+gr*(5*Lt),ar+=ur>>>13,ur&=8191;let pr=ar+Rr*Lt+Nr*Ut+kr*Nt+lr*(5*Wt)+ir*(5*Ht);ar=pr>>>13,pr&=8191,pr+=er*(5*Vt)+rr*(5*zt)+yr*(5*qt)+fr*(5*Kt)+gr*(5*jt),ar+=pr>>>13,pr&=8191;let br=ar+Rr*jt+Nr*Lt+kr*Ut+lr*Nt+ir*(5*Wt);ar=br>>>13,br&=8191,br+=er*(5*Ht)+rr*(5*Vt)+yr*(5*zt)+fr*(5*qt)+gr*(5*Kt),ar+=br>>>13,br&=8191;let Sr=ar+Rr*Kt+Nr*jt+kr*Lt+lr*Ut+ir*Nt;ar=Sr>>>13,Sr&=8191,Sr+=er*(5*Wt)+rr*(5*Ht)+yr*(5*Vt)+fr*(5*zt)+gr*(5*qt),ar+=Sr>>>13,Sr&=8191;let Pr=ar+Rr*qt+Nr*Kt+kr*jt+lr*Lt+ir*Ut;ar=Pr>>>13,Pr&=8191,Pr+=er*Nt+rr*(5*Wt)+yr*(5*Ht)+fr*(5*Vt)+gr*(5*zt),ar+=Pr>>>13,Pr&=8191;let Tr=ar+Rr*zt+Nr*qt+kr*Kt+lr*jt+ir*Lt;ar=Tr>>>13,Tr&=8191,Tr+=er*Ut+rr*Nt+yr*(5*Wt)+fr*(5*Ht)+gr*(5*Vt),ar+=Tr>>>13,Tr&=8191;let wr=ar+Rr*Vt+Nr*zt+kr*qt+lr*Kt+ir*jt;ar=wr>>>13,wr&=8191,wr+=er*Lt+rr*Ut+yr*Nt+fr*(5*Wt)+gr*(5*Ht),ar+=wr>>>13,wr&=8191;let Ar=ar+Rr*Ht+Nr*Vt+kr*zt+lr*qt+ir*Kt;ar=Ar>>>13,Ar&=8191,Ar+=er*jt+rr*Lt+yr*Ut+fr*Nt+gr*(5*Wt),ar+=Ar>>>13,Ar&=8191;let Mr=ar+Rr*Wt+Nr*Ht+kr*Vt+lr*zt+ir*qt;ar=Mr>>>13,Mr&=8191,Mr+=er*Kt+rr*jt+yr*Lt+fr*Ut+gr*Nt,ar+=Mr>>>13,Mr&=8191,ar=(ar<<2)+ar|0,ar=ar+nr|0,nr=ar&8191,ar=ar>>>13,ur+=ar,kt[0]=nr,kt[1]=ur,kt[2]=pr,kt[3]=br,kt[4]=Sr,kt[5]=Pr,kt[6]=Tr,kt[7]=wr,kt[8]=Ar,kt[9]=Mr}finalize(){const{h:e,pad:_t}=this,At=new Uint16Array(10);let xt=e[1]>>>13;e[1]&=8191;for(let Nt=2;Nt<10;Nt++)e[Nt]+=xt,xt=e[Nt]>>>13,e[Nt]&=8191;e[0]+=xt*5,xt=e[0]>>>13,e[0]&=8191,e[1]+=xt,xt=e[1]>>>13,e[1]&=8191,e[2]+=xt,At[0]=e[0]+5,xt=At[0]>>>13,At[0]&=8191;for(let Nt=1;Nt<10;Nt++)At[Nt]=e[Nt]+xt,xt=At[Nt]>>>13,At[Nt]&=8191;At[9]-=8192;let kt=(xt^1)-1;for(let Nt=0;Nt<10;Nt++)At[Nt]&=kt;kt=~kt;for(let Nt=0;Nt<10;Nt++)e[Nt]=e[Nt]&kt|At[Nt];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let Bt=e[0]+_t[0];e[0]=Bt&65535;for(let Nt=1;Nt<8;Nt++)Bt=(e[Nt]+_t[Nt]|0)+(Bt>>>16)|0,e[Nt]=Bt&65535}update(e){exists(this);const{buffer:_t,blockLen:At}=this;e=toBytes(e);const xt=e.length;for(let kt=0;kt<xt;){const Bt=Math.min(At-this.pos,xt-kt);if(Bt===At){for(;At<=xt-kt;kt+=At)this.process(e,kt);continue}_t.set(e.subarray(kt,kt+Bt),this.pos),this.pos+=Bt,kt+=Bt,this.pos===At&&(this.process(_t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists(this),output(e,this),this.finished=!0;const{buffer:_t,h:At}=this;let{pos:xt}=this;if(xt){for(_t[xt++]=1;xt<16;xt++)_t[xt]=0;this.process(_t,0,!0)}this.finalize();let kt=0;for(let Bt=0;Bt<8;Bt++)e[kt++]=At[Bt]>>>0,e[kt++]=At[Bt]>>>8;return e}digest(){const{buffer:e,outputLen:_t}=this;this.digestInto(e);const At=e.slice(0,_t);return this.destroy(),At}}function wrapConstructorWithKey($t){const e=(At,xt)=>$t(xt).update(toBytes(At)).digest(),_t=$t(new Uint8Array(32));return e.outputLen=_t.outputLen,e.blockLen=_t.blockLen,e.create=At=>$t(At),e}wrapConstructorWithKey($t=>new Poly1305($t));const sigma16=utf8ToBytes("expand 16-byte k"),sigma32=utf8ToBytes("expand 32-byte k");u32(sigma16);u32(sigma32);function extractDidFragment($t){if(typeof $t=="string"&&$t.length!==0)return $t.split("#").pop()}function getVerificationMethods({didDocument:$t}){var e,_t;if(!$t)throw new TypeError("Required parameter missing: 'didDocument'");const At=[];return At.push(...(_t=(e=$t.verificationMethod)===null||e===void 0?void 0:e.filter(isDidVerificationMethod))!==null&&_t!==void 0?_t:[]),Object.keys(DidVerificationRelationship).forEach(xt=>{var kt,Bt;At.push(...(Bt=(kt=$t[xt])===null||kt===void 0?void 0:kt.filter(isDidVerificationMethod))!==null&&Bt!==void 0?Bt:[])}),At}function getVerificationMethodTypes({didDocument:$t}){const _t=getVerificationMethods({didDocument:$t}).map(At=>At.type);return[...new Set(_t)]}function getVerificationRelationshipsById({didDocument:$t,methodId:e}){const _t=[];return Object.keys(DidVerificationRelationship).forEach(At=>{if(Array.isArray($t[At])){const xt=$t[At],kt=extractDidFragment(e);xt.some(Nt=>{const Ut=extractDidFragment(Nt)===kt,Lt=isDidVerificationMethod(Nt)&&extractDidFragment(Nt.id)===kt;return Ut||Lt})&&_t.push(At)}}),_t}function isDidVerificationMethod($t){return!(!$t||typeof $t!="object"||$t===null||!("id"in $t&&"type"in $t&&"controller"in $t)||typeof $t.id!="string"||typeof $t.type!="string"||typeof $t.controller!="string")}function keyBytesToMultibaseId({keyBytes:$t,multicodecCode:e,multicodecName:_t}){const At=Multicodec.addPrefix({code:e,data:$t,name:_t}),xt=Convert.uint8Array(At).toBase58Btc();return Convert.base58Btc(xt).toMultibase()}function multibaseIdToKeyBytes({multibaseKeyId:$t}){try{const e=Convert.multibase($t).toBase58Btc(),_t=Convert.base58Btc(e).toUint8Array(),{code:At,data:xt,name:kt}=Multicodec.removePrefix({prefixedData:_t});return{keyBytes:xt,multicodecCode:At,multicodecName:kt}}catch{throw new DidError(DidErrorCode.InvalidDid,`Invalid multibase identifier: ${$t}`)}}var __awaiter$a=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class BearerDid{constructor({uri:e,document:_t,metadata:At,keyManager:xt}){this.uri=e,this.document=_t,this.metadata=At,this.keyManager=xt}export(){return __awaiter$a(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const _t=[];for(let At of this.document.verificationMethod){if(!At.publicKeyJwk)throw new Error(`Verification method '${At.id}' does not contain a public key in JWK format`);const xt=yield this.keyManager.getKeyUri({key:At.publicKeyJwk}),kt=yield this.keyManager.exportKey({keyUri:xt});_t.push(Object.assign({},kt))}e.privateKeys=_t}return e})}getSigner(e){return __awaiter$a(this,void 0,void 0,function*(){var _t;const At=(_t=this.document.verificationMethod)===null||_t===void 0?void 0:_t.find(Ut=>{var Lt,jt;return extractDidFragment(Ut.id)===((Lt=extractDidFragment(e==null?void 0:e.methodId))!==null&&Lt!==void 0?Lt:extractDidFragment((jt=this.document.assertionMethod)===null||jt===void 0?void 0:jt[0]))});if(!(At&&At.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");const xt=yield this.keyManager.getKeyUri({key:At.publicKeyJwk}),kt=yield this.keyManager.getPublicKey({keyUri:xt}),Bt=this.keyManager;return{algorithm:getJoseSignatureAlgorithmFromPublicKey(kt),keyId:At.id,sign(Ut){return __awaiter$a(this,arguments,void 0,function*({data:Lt}){return yield Bt.sign({data:Lt,keyUri:xt})})},verify(Ut){return __awaiter$a(this,arguments,void 0,function*({data:Lt,signature:jt}){return yield Bt.verify({data:Lt,key:kt,signature:jt})})}}})}static import(e){return __awaiter$a(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager}){var xt;const kt=getVerificationMethods({didDocument:_t.document});if(kt.length===0)throw new DidError(DidErrorCode.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let Nt of(xt=_t.privateKeys)!==null&&xt!==void 0?xt:[])yield At.importKey({key:Nt});for(let Nt of kt){if(!Nt.publicKeyJwk)throw new Error(`Verification method '${Nt.id}' does not contain a public key in JWK format`);const Ut=yield At.getKeyUri({key:Nt.publicKeyJwk});yield At.getPublicKey({keyUri:Ut})}return new BearerDid({uri:_t.uri,document:_t.document,metadata:_t.metadata,keyManager:At})})}}var __awaiter$9=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DidMethod{static getSigningMethod(e){return __awaiter$9(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,_t){return __awaiter$9(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}}var __awaiter$8=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest$1=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};const DEFAULT_GATEWAY_URI$1="https://diddht.tbddev.org",DID_DHT_SPECIFICATION_VERSION=0,DNS_RECORD_TTL=7200,PROPERTY_SEPARATOR=";",VALUE_SEPARATOR=",";var DidDhtRegisteredDidType;(function($t){$t[$t.Discoverable=0]="Discoverable",$t[$t.Organization=1]="Organization",$t[$t.Government=2]="Government",$t[$t.Corporation=3]="Corporation",$t[$t.LocalBusiness=4]="LocalBusiness",$t[$t.SoftwarePackage=5]="SoftwarePackage",$t[$t.WebApp=6]="WebApp",$t[$t.FinancialInstitution=7]="FinancialInstitution"})(DidDhtRegisteredDidType||(DidDhtRegisteredDidType={}));var DidDhtRegisteredKeyType;(function($t){$t[$t.Ed25519=0]="Ed25519",$t[$t.secp256k1=1]="secp256k1",$t[$t.secp256r1=2]="secp256r1",$t[$t.X25519=3]="X25519"})(DidDhtRegisteredKeyType||(DidDhtRegisteredKeyType={}));var DidDhtVerificationRelationship;(function($t){$t.authentication="auth",$t.assertionMethod="asm",$t.capabilityDelegation="del",$t.capabilityInvocation="inv",$t.keyAgreement="agm"})(DidDhtVerificationRelationship||(DidDhtVerificationRelationship={}));const AlgorithmToKeyTypeMap$2={Ed25519:DidDhtRegisteredKeyType.Ed25519,ES256K:DidDhtRegisteredKeyType.secp256k1,ES256:DidDhtRegisteredKeyType.secp256r1,"P-256":DidDhtRegisteredKeyType.secp256r1,secp256k1:DidDhtRegisteredKeyType.secp256k1,secp256r1:DidDhtRegisteredKeyType.secp256r1,X25519:DidDhtRegisteredKeyType.X25519},KeyTypeToDefaultAlgorithmMap={[DidDhtRegisteredKeyType.Ed25519]:"Ed25519",[DidDhtRegisteredKeyType.secp256k1]:"ES256K",[DidDhtRegisteredKeyType.secp256r1]:"ES256",[DidDhtRegisteredKeyType.X25519]:"ECDH-ES+A256KW"};class DidDht extends DidMethod{static create(){return __awaiter$8(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:_t={}}={}){var At,xt,kt,Bt,Nt,Ut,Lt,jt,Kt,qt,zt;if(!((At=_t.verificationMethods)===null||At===void 0)&&At.some(dr=>!(dr.algorithm in AlgorithmToKeyTypeMap$2)))throw new Error("One or more verification method algorithms are not supported");const Vt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt.filter(dr=>"id"in dr).map(dr=>dr.id);if(Vt&&Vt.length!==new Set(Vt).size)throw new Error("One or more verification method IDs are not unique");if(!((kt=_t.services)===null||kt===void 0)&&kt.some(dr=>!dr.id||!dr.type||!dr.serviceEndpoint))throw new Error("One or more services are missing required properties");const Ht=yield e.generateKey({algorithm:"Ed25519"}),Wt=yield e.getPublicKey({keyUri:Ht}),Qt=yield DidDhtUtils.identityKeyToIdentifier({identityKey:Wt}),Xt=Object.assign(Object.assign({id:Qt},_t.alsoKnownAs&&{alsoKnownAs:_t.alsoKnownAs}),_t.controllers&&{controller:_t.controllers}),Jt=[...(Bt=_t.verificationMethods)!==null&&Bt!==void 0?Bt:[]];Jt!=null&&Jt.some(dr=>{var vr;return((vr=dr.id)===null||vr===void 0?void 0:vr.split("#").pop())==="0"})||Jt.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const dr of Jt){const vr=dr.id&&dr.id.split("#").pop()==="0"?Ht:yield e.generateKey({algorithm:dr.algorithm}),$r=yield e.getPublicKey({keyUri:vr});let Ir=(Ut=(Nt=dr.id)!==null&&Nt!==void 0?Nt:$r.kid)!==null&&Ut!==void 0?Ut:yield computeJwkThumbprint({jwk:$r});Ir=`${Qt}#${extractDidFragment(Ir)}`,(Lt=Xt.verificationMethod)!==null&&Lt!==void 0||(Xt.verificationMethod=[]),Xt.verificationMethod.push({id:Ir,type:"JsonWebKey",controller:(jt=dr.controller)!==null&&jt!==void 0?jt:Qt,publicKeyJwk:$r});for(const Rr of(Kt=dr.purposes)!==null&&Kt!==void 0?Kt:[])Xt[Rr]||(Xt[Rr]=[]),Xt[Rr].push(Ir)}(qt=_t.services)===null||qt===void 0||qt.forEach(dr=>{var vr;(vr=Xt.service)!==null&&vr!==void 0||(Xt.service=[]),dr.id=`${Qt}#${dr.id.split("#").pop()}`,Xt.service.push(dr)});const tr=new BearerDid({uri:Qt,document:Xt,metadata:Object.assign({published:!1},_t.types&&{types:_t.types}),keyManager:e});if(!((zt=_t.publish)!==null&&zt!==void 0)||zt){const dr=yield DidDht.publish({did:tr,gatewayUri:_t.gatewayUri});tr.metadata=dr.didDocumentMetadata}return tr})}static import(e){return __awaiter$8(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager}){var xt;const kt=Did.parse(_t.uri);if((kt==null?void 0:kt.method)!==DidDht.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");const Bt=yield BearerDid.import({portableDid:_t,keyManager:At});if(!(!((xt=Bt.document.verificationMethod)===null||xt===void 0)&&xt.some(Nt=>{var Ut;return((Ut=Nt.id)===null||Ut===void 0?void 0:Ut.split("#").pop())==="0"})))throw new DidError(DidErrorCode.InvalidDidDocument,"DID document must contain an Identity Key");return Bt})}static getSigningMethod(e){return __awaiter$8(this,arguments,void 0,function*({didDocument:_t,methodId:At="#0"}){var xt;const kt=Did.parse(_t.id);if(kt&&kt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${kt.method}`);const Bt=(xt=_t.verificationMethod)===null||xt===void 0?void 0:xt.find(Nt=>{var Ut,Lt;return extractDidFragment(Nt.id)===((Ut=extractDidFragment(At))!==null&&Ut!==void 0?Ut:extractDidFragment((Lt=_t.assertionMethod)===null||Lt===void 0?void 0:Lt[0]))});if(!(Bt&&Bt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static publish(e){return __awaiter$8(this,arguments,void 0,function*({did:_t,gatewayUri:At=DEFAULT_GATEWAY_URI$1}){return yield DidDhtDocument.put({did:_t,gatewayUri:At})})}static resolve(e){return __awaiter$8(this,arguments,void 0,function*(_t,At={}){var xt;const kt=(xt=At==null?void 0:At.gatewayUri)!==null&&xt!==void 0?xt:DEFAULT_GATEWAY_URI$1;try{yield DidDhtUtils.identifierToIdentityKey({didUri:_t});const{didDocument:Bt,didDocumentMetadata:Nt}=yield DidDhtDocument.get({didUri:_t,gatewayUri:kt});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:Bt,didDocumentMetadata:Nt})}catch(Bt){if(!(Bt instanceof DidError))throw new Error(Bt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:Object.assign({error:Bt.code},Bt.message&&{errorMessage:Bt.message})})}})}}DidDht.methodName="dht";class DidDhtDocument{static get(e){return __awaiter$8(this,arguments,void 0,function*({didUri:_t,gatewayUri:At}){const xt=DidDhtUtils.identifierToIdentityKeyBytes({didUri:_t}),kt=yield DidDhtDocument.pkarrGet({gatewayUri:At,publicKeyBytes:xt}),Bt=yield DidDhtUtils.parseBep44GetMessage({bep44Message:kt}),Nt=yield DidDhtDocument.fromDnsPacket({didUri:_t,dnsPacket:Bt});return Nt.didDocumentMetadata.versionId=kt.seq.toString(),Nt})}static put(e){return __awaiter$8(this,arguments,void 0,function*({did:_t,gatewayUri:At}){const xt=yield DidDhtDocument.toDnsPacket({didDocument:_t.document,didMetadata:_t.metadata,authoritativeGatewayUris:[At]}),kt=yield DidDhtUtils.createBep44PutMessage({dnsPacket:xt,publicKeyBytes:DidDhtUtils.identifierToIdentityKeyBytes({didUri:_t.uri}),signer:yield _t.getSigner({methodId:"0"})}),Bt=yield DidDhtDocument.pkarrPut({gatewayUri:At,bep44Message:kt});return{didDocument:_t.document,didDocumentMetadata:Object.assign(Object.assign({},_t.metadata),{published:Bt,versionId:kt.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return __awaiter$8(this,arguments,void 0,function*({gatewayUri:_t,publicKeyBytes:At}){const xt=Convert.uint8Array(At).toBase32Z(),kt=new URL(xt,_t).href;let Bt;try{if(Bt=yield fetch(kt,{method:"GET"}),!Bt.ok)throw new DidError(DidErrorCode.NotFound,`Pkarr record not found for: ${xt}`)}catch(Lt){throw Lt instanceof DidError?Lt:new DidError(DidErrorCode.InternalError,`Failed to fetch Pkarr record: ${Lt.message}`)}const Nt=yield Bt.arrayBuffer();if(!Nt)throw new DidError(DidErrorCode.NotFound,`Pkarr record not found for: ${xt}`);if(Nt.byteLength<72)throw new DidError(DidErrorCode.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${Nt.byteLength}`);if(Nt.byteLength>1072)throw new DidError(DidErrorCode.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${Nt.byteLength}`);return{k:At,seq:Number(new DataView(Nt).getBigUint64(64)),sig:new Uint8Array(Nt,0,64),v:new Uint8Array(Nt,72)}})}static pkarrPut(e){return __awaiter$8(this,arguments,void 0,function*({gatewayUri:_t,bep44Message:At}){const xt=Convert.uint8Array(At.k).toBase32Z(),kt=new URL(xt,_t).href,Bt=new Uint8Array(At.v.length+72);Bt.set(At.sig,0),new DataView(Bt.buffer).setBigUint64(At.sig.length,BigInt(At.seq)),Bt.set(At.v,At.sig.length+8);let Nt;try{Nt=yield fetch(kt,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:Bt})}catch(Ut){throw new DidError(DidErrorCode.InternalError,`Failed to put Pkarr record for identifier ${xt}: ${Ut.message}`)}return Nt.ok})}static fromDnsPacket(e){return __awaiter$8(this,arguments,void 0,function*({didUri:_t,dnsPacket:At}){var xt,kt,Bt;const Nt={id:_t},Ut={published:!0},Lt=new Map;for(const jt of(xt=At==null?void 0:At.answers)!==null&&xt!==void 0?xt:[]){if(jt.type!=="TXT")continue;const Kt=jt.name.split(".")[0].substring(1);switch(!0){case Kt.startsWith("aka"):{const qt=DidDhtUtils.parseTxtDataToString(jt.data);Nt.alsoKnownAs=qt.split(VALUE_SEPARATOR);break}case Kt.startsWith("cnt"):{const qt=DidDhtUtils.parseTxtDataToString(jt.data);Nt.controller=qt.includes(VALUE_SEPARATOR)?qt.split(VALUE_SEPARATOR):qt;break}case Kt.startsWith("k"):{const{id:qt,t:zt,k:Vt,c:Ht,a:Wt}=DidDhtUtils.parseTxtDataToObject(jt.data),Qt=Convert.base64Url(Vt).toUint8Array(),Xt=DidDhtRegisteredKeyType[Number(zt)];let Jt=yield DidDhtUtils.keyConverter(Xt).bytesToPublicKey({publicKeyBytes:Qt});Jt.alg=Wt||KeyTypeToDefaultAlgorithmMap[Number(zt)];const tr=Kt==="k0"?"0":qt!==void 0?qt:yield computeJwkThumbprint({jwk:Jt});(kt=Nt.verificationMethod)!==null&&kt!==void 0||(Nt.verificationMethod=[]);const dr=`${_t}#${tr}`;Nt.verificationMethod.push({id:dr,type:"JsonWebKey",controller:Ht??_t,publicKeyJwk:Jt}),Lt.set(Kt,dr);break}case Kt.startsWith("s"):{const qt=DidDhtUtils.parseTxtDataToObject(jt.data),{id:zt,t:Vt,se:Ht}=qt,Wt=__rest$1(qt,["id","t","se"]),Qt=Ht.includes(VALUE_SEPARATOR)?Ht.split(VALUE_SEPARATOR):[Ht],Xt=Object.fromEntries(Object.entries(Wt).map(([Jt,tr])=>[Jt,tr.includes(VALUE_SEPARATOR)?tr.split(VALUE_SEPARATOR):tr]));(Bt=Nt.service)!==null&&Bt!==void 0||(Nt.service=[]),Nt.service.push(Object.assign(Object.assign({},Xt),{id:`${_t}#${zt}`,type:Vt,serviceEndpoint:Qt}));break}case Kt.startsWith("typ"):{const{id:qt}=DidDhtUtils.parseTxtDataToObject(jt.data);Ut.types=qt.split(VALUE_SEPARATOR).map(zt=>Number(zt));break}case Kt.startsWith("did"):{const qt=Xt=>Xt.split(VALUE_SEPARATOR).map(Jt=>Lt.get(Jt)).filter(Jt=>typeof Jt=="string"),{auth:zt,asm:Vt,del:Ht,inv:Wt,agm:Qt}=DidDhtUtils.parseTxtDataToObject(jt.data);zt&&(Nt.authentication=qt(zt)),Vt&&(Nt.assertionMethod=qt(Vt)),Ht&&(Nt.capabilityDelegation=qt(Ht)),Wt&&(Nt.capabilityInvocation=qt(Wt)),Qt&&(Nt.keyAgreement=qt(Qt));break}}}return{didDocument:Nt,didDocumentMetadata:Ut,didResolutionMetadata:{}}})}static toDnsPacket(e){return __awaiter$8(this,arguments,void 0,function*({didDocument:_t,didMetadata:At,authoritativeGatewayUris:xt,previousDidProof:kt}){var Bt,Nt,Ut,Lt,jt;const Kt=[],qt=[],zt=new Map,Vt=[],Ht=[];if(kt!==void 0){const{signature:Xt,previousDid:Jt}=kt;yield DidDhtUtils.validatePreviousDidProof({newDid:_t.id,previousDidProof:kt}),Kt.push({type:"TXT",name:"_prv._did.",ttl:DNS_RECORD_TTL,data:`id=${Jt};s=${Xt}`})}if(_t.alsoKnownAs&&Kt.push({type:"TXT",name:"_aka._did.",ttl:DNS_RECORD_TTL,data:_t.alsoKnownAs.join(VALUE_SEPARATOR)}),_t.controller){const Xt=Array.isArray(_t.controller)?_t.controller.join(VALUE_SEPARATOR):_t.controller;Kt.push({type:"TXT",name:"_cnt._did.",ttl:DNS_RECORD_TTL,data:Xt})}for(const[Xt,Jt]of(Nt=(Bt=_t.verificationMethod)===null||Bt===void 0?void 0:Bt.entries())!==null&&Nt!==void 0?Nt:[]){const tr=`k${Xt}`;Ht.push(tr);let dr=Jt.id.split("#").pop();zt.set(dr,tr);const vr=Jt.publicKeyJwk;if(!(vr!=null&&vr.crv&&vr.crv in AlgorithmToKeyTypeMap$2))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Verification method '${Jt.id}' contains an unsupported key type: ${(Ut=vr==null?void 0:vr.crv)!==null&&Ut!==void 0?Ut:"undefined"}`);const $r=DidDhtRegisteredKeyType[vr.crv],Ir=yield DidDhtUtils.keyConverter(vr.crv).publicKeyToBytes({publicKey:vr}),Rr=Convert.uint8Array(Ir).toBase64Url(),Nr=[`t=${$r}`,`k=${Rr}`];dr!=="0"&&(yield computeJwkThumbprint({jwk:vr}))!==dr&&Nr.unshift(`id=${dr}`),vr.alg!==KeyTypeToDefaultAlgorithmMap[$r]&&Nr.push(`a=${vr.alg}`),Jt.controller!==_t.id&&Nr.push(`c=${Jt.controller}`),Kt.push({type:"TXT",name:`_${tr}._did.`,ttl:DNS_RECORD_TTL,data:Nr.join(PROPERTY_SEPARATOR)})}(Lt=_t.service)===null||Lt===void 0||Lt.forEach((Xt,Jt)=>{const tr=`s${Jt}`;Vt.push(tr);let{id:dr,type:vr,serviceEndpoint:$r}=Xt,Ir=__rest$1(Xt,["id","type","serviceEndpoint"]);dr=extractDidFragment(dr),$r=Array.isArray($r)?$r.join(","):$r;const Nr=Object.entries(Object.assign({id:dr,t:vr,se:$r},Ir)).map(([lr,ir])=>`${lr}=${ir}`).join(PROPERTY_SEPARATOR),kr=DidDhtUtils.chunkDataIfNeeded(Nr);Kt.push({type:"TXT",name:`_${tr}._did.`,ttl:DNS_RECORD_TTL,data:kr})});const Wt=[`v=${DID_DHT_SPECIFICATION_VERSION}`];if(Ht.length&&Wt.push(`vm=${Ht.join(VALUE_SEPARATOR)}`),Object.keys(DidVerificationRelationship).forEach(Xt=>{var Jt;const tr=(Jt=_t[Xt])===null||Jt===void 0?void 0:Jt.map(dr=>zt.get(dr.split("#").pop()));if(tr){const dr=DidDhtVerificationRelationship[Xt];Wt.push(`${dr}=${tr.join(VALUE_SEPARATOR)}`)}}),Vt.length&&Wt.push(`svc=${Vt.join(VALUE_SEPARATOR)}`),!((jt=At.types)===null||jt===void 0)&&jt.length){const Jt=At.types.map(tr=>typeof tr=="string"?DidDhtRegisteredDidType[tr]:tr);Kt.push({type:"TXT",name:"_typ._did.",ttl:DNS_RECORD_TTL,data:`id=${Jt.join(VALUE_SEPARATOR)}`})}Kt.push({type:"TXT",name:"_did."+DidDhtDocument.getUniqueDidSuffix(_t.id)+".",ttl:DNS_RECORD_TTL,data:Wt.join(PROPERTY_SEPARATOR)});for(const Xt of xt||[])qt.push({type:"NS",name:"_did."+DidDhtDocument.getUniqueDidSuffix(_t.id)+".",ttl:DNS_RECORD_TTL,data:Xt+"."});return{id:0,type:"response",flags:AUTHORITATIVE_ANSWER,answers:[...Kt,...qt]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}}class DidDhtUtils{static createBep44PutMessage(e){return __awaiter$8(this,arguments,void 0,function*({dnsPacket:_t,publicKeyBytes:At,signer:xt}){const kt=Math.ceil(Date.now()/1e3),Bt=encode$2(_t),Nt=bencode.encode({seq:kt,v:Bt}).subarray(1,-1);if(Nt.length>1e3)throw new DidError(DidErrorCode.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${Nt.length} bytes`);const Ut=yield xt.sign({data:Nt});return{k:At,seq:kt,sig:Ut,v:Bt}})}static identifierToIdentityKey(e){return __awaiter$8(this,arguments,void 0,function*({didUri:_t}){let At=DidDhtUtils.identifierToIdentityKeyBytes({didUri:_t});return yield Ed25519.bytesToPublicKey({publicKeyBytes:At})})}static identifierToIdentityKeyBytes({didUri:e}){const _t=Did.parse(e);if(!_t)throw new DidError(DidErrorCode.InvalidDid,`Invalid DID URI: ${e}`);if(_t.method!==DidDht.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${_t.method}`);let At;try{At=Convert.base32Z(_t.id).toUint8Array()}catch{throw new DidError(DidErrorCode.InvalidPublicKey,"Failed to decode method-specific identifier")}if(At.length!==32)throw new DidError(DidErrorCode.InvalidPublicKeyLength,`Invalid public key length: ${At.length}`);return At}static identityKeyToIdentifier(e){return __awaiter$8(this,arguments,void 0,function*({identityKey:_t}){const At=yield Ed25519.publicKeyToBytes({publicKey:_t}),xt=Convert.uint8Array(At).toBase32Z();return`did:${DidDht.methodName}:${xt}`})}static keyConverter(e){const At={Ed25519,"P-256":{publicKeyToBytes:xt=>__awaiter$8(this,[xt],void 0,function*({publicKey:kt}){const Bt=yield Secp256r1.publicKeyToBytes({publicKey:kt});return yield Secp256r1.compressPublicKey({publicKeyBytes:Bt})}),bytesToPublicKey:Secp256r1.bytesToPublicKey,privateKeyToBytes:Secp256r1.privateKeyToBytes,bytesToPrivateKey:Secp256r1.bytesToPrivateKey},secp256k1:{publicKeyToBytes:xt=>__awaiter$8(this,[xt],void 0,function*({publicKey:kt}){const Bt=yield Secp256k1.publicKeyToBytes({publicKey:kt});return yield Secp256k1.compressPublicKey({publicKeyBytes:Bt})}),bytesToPublicKey:Secp256k1.bytesToPublicKey,privateKeyToBytes:Secp256k1.privateKeyToBytes,bytesToPrivateKey:Secp256k1.bytesToPrivateKey},X25519}[e];if(!At)throw new DidError(DidErrorCode.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static parseBep44GetMessage(e){return __awaiter$8(this,arguments,void 0,function*({bep44Message:_t}){const At=yield Ed25519.bytesToPublicKey({publicKeyBytes:_t.k}),xt=bencode.encode({seq:_t.seq,v:_t.v}).subarray(1,-1);if(!(yield Ed25519.verify({key:At,signature:_t.sig,data:xt})))throw new DidError(DidErrorCode.InvalidSignature,"Invalid signature for DHT BEP44 message");return decode$1(_t.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(PROPERTY_SEPARATOR).reduce((_t,At)=>{const[xt,kt]=At.split("=");return _t[xt]=kt,_t},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return Convert.uint8Array(e).toString();if(Array.isArray(e))return e.map(_t=>this.parseTxtDataToString(_t)).join("");throw new DidError(DidErrorCode.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return __awaiter$8(this,arguments,void 0,function*({newDid:_t,previousDidProof:At}){const xt=yield DidDhtUtils.identifierToIdentityKey({didUri:At.previousDid}),kt=DidDhtUtils.identifierToIdentityKeyBytes({didUri:_t}),Bt=Convert.base64Url(At.signature).toUint8Array();if(!(yield Ed25519.verify({key:xt,data:kt,signature:Bt})))throw new DidError(DidErrorCode.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const _t=[];for(let At=0;At<e.length;At+=255)_t.push(e.slice(At,At+255));return _t}}var __awaiter$7=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidIonRegisteredKeyType;(function($t){$t.Ed25519="Ed25519",$t.secp256k1="secp256k1",$t.secp256r1="secp256r1",$t.X25519="X25519"})(DidIonRegisteredKeyType||(DidIonRegisteredKeyType={}));const AlgorithmToKeyTypeMap$1={Ed25519:DidIonRegisteredKeyType.Ed25519,ES256K:DidIonRegisteredKeyType.secp256k1,ES256:DidIonRegisteredKeyType.secp256r1,"P-256":DidIonRegisteredKeyType.secp256r1,secp256k1:DidIonRegisteredKeyType.secp256k1,secp256r1:DidIonRegisteredKeyType.secp256r1},DEFAULT_GATEWAY_URI="https://ion.tbd.engineering";class DidIon extends DidMethod{static create(){return __awaiter$7(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:_t={}}={}){var At,xt,kt,Bt,Nt,Ut,Lt;if(!((At=_t.verificationMethods)===null||At===void 0)&&At.some(dr=>!(dr.algorithm in AlgorithmToKeyTypeMap$1)))throw new Error("One or more verification method algorithms are not supported");const jt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt.filter(dr=>"id"in dr).map(dr=>dr.id);if(jt&&jt.length!==new Set(jt).size)throw new Error("One or more verification method IDs are not unique");if(!((kt=_t.services)===null||kt===void 0)&&kt.some(dr=>!dr.id||!dr.type||!dr.serviceEndpoint))throw new Error("One or more services are missing required properties");const Kt={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},qt=[];for(const dr of(Bt=_t.verificationMethods)!==null&&Bt!==void 0?Bt:[Kt]){const vr=yield e.generateKey({algorithm:dr.algorithm}),$r=yield e.getPublicKey({keyUri:vr});qt.push({id:dr.id,publicKeyJwk:$r,purposes:(Nt=dr.purposes)!==null&&Nt!==void 0?Nt:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const zt=yield e.generateKey({algorithm:DidIonRegisteredKeyType.secp256k1}),Vt=yield e.getPublicKey({keyUri:zt}),Ht=yield e.generateKey({algorithm:DidIonRegisteredKeyType.secp256k1}),Wt=yield e.getPublicKey({keyUri:Ht}),Qt=yield DidIonUtils.computeLongFormDidUri({recoveryKey:Vt,updateKey:Wt,services:(Ut=_t.services)!==null&&Ut!==void 0?Ut:[],verificationMethods:qt}),{didDocument:Xt,didResolutionMetadata:Jt}=yield DidIon.resolve(Qt,{gatewayUri:_t.gatewayUri});if(Xt===null)throw new Error(`Unable to resolve DID during creation: ${Jt==null?void 0:Jt.error}`);const tr=new BearerDid({uri:Qt,document:Xt,metadata:{published:!1,canonicalId:Qt.split(":",3).join(":"),recoveryKey:Vt,updateKey:Wt},keyManager:e});if(!((Lt=_t.publish)!==null&&Lt!==void 0)||Lt){const dr=yield DidIon.publish({did:tr,gatewayUri:_t.gatewayUri});tr.metadata=dr.didDocumentMetadata}return tr})}static getSigningMethod(e){return __awaiter$7(this,arguments,void 0,function*({didDocument:_t,methodId:At}){var xt;const kt=Did.parse(_t.id);if(kt&&kt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${kt.method}`);const Bt=(xt=_t.verificationMethod)===null||xt===void 0?void 0:xt.find(Nt=>{var Ut;return Nt.id===(At??((Ut=_t.assertionMethod)===null||Ut===void 0?void 0:Ut[0]))});if(!(Bt&&Bt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static import(e){return __awaiter$7(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager}){const xt=Did.parse(_t.uri);if((xt==null?void 0:xt.method)!==DidIon.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");return yield BearerDid.import({portableDid:_t,keyManager:At})})}static publish(e){return __awaiter$7(this,arguments,void 0,function*({did:_t,gatewayUri:At=DEFAULT_GATEWAY_URI}){var xt,kt,Bt;const Nt=(kt=(xt=_t.document.verificationMethod)===null||xt===void 0?void 0:xt.map(jt=>({id:jt.id,publicKeyJwk:jt.publicKeyJwk,purposes:getVerificationRelationshipsById({didDocument:_t.document,methodId:jt.id})})))!==null&&kt!==void 0?kt:[],Ut=yield DidIonUtils.createIonDocument({services:(Bt=_t.document.service)!==null&&Bt!==void 0?Bt:[],verificationMethods:Nt}),Lt=yield DidIonUtils.constructCreateRequest({ionDocument:Ut,recoveryKey:_t.metadata.recoveryKey,updateKey:_t.metadata.updateKey});try{const jt=DidIonUtils.appendPathToUrl({baseUrl:At,path:"/operations"}),Kt=yield fetch(jt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(Lt)});return{didDocument:_t.document,didDocumentMetadata:Object.assign(Object.assign({},_t.metadata),{published:Kt.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:DidErrorCode.InternalError,errorMessage:`Failed to publish DID document for: ${_t.uri}`}}}})}static resolve(e){return __awaiter$7(this,arguments,void 0,function*(_t,At={}){var xt,kt;const Bt=Did.parse(_t);if(!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"invalidDid"}});if(Bt.method!==DidIon.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"methodNotSupported"}});const Nt=(xt=At==null?void 0:At.gatewayUri)!==null&&xt!==void 0?xt:DEFAULT_GATEWAY_URI;try{const Ut=DidIonUtils.appendPathToUrl({baseUrl:Nt,path:`/identifiers/${_t}`}),Lt=yield fetch(Ut);if(!Lt.ok)throw new DidError(DidErrorCode.NotFound,`Unable to find DID document for: ${_t}`);const{didDocument:jt,didDocumentMetadata:Kt}=yield Lt.json();return Object.assign(Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),jt&&{didDocument:jt}),{didDocumentMetadata:Object.assign({published:(kt=Kt==null?void 0:Kt.method)===null||kt===void 0?void 0:kt.published},Kt)})}catch(Ut){if(!(Ut instanceof DidError))throw new Error(Ut);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:Object.assign({error:Ut.code},Ut.message&&{errorMessage:Ut.message})})}})}}DidIon.methodName="ion";class DidIonUtils{static appendPathToUrl({baseUrl:e,path:_t}){const At=new URL(e);return At.pathname=At.pathname.endsWith("/")?At.pathname:At.pathname+"/",At.pathname+=_t.startsWith("/")?_t.substring(1):_t,At.toString()}static computeLongFormDidUri(e){return __awaiter$7(this,arguments,void 0,function*({recoveryKey:_t,updateKey:At,services:xt,verificationMethods:kt}){const Bt=yield DidIonUtils.createIonDocument({services:xt,verificationMethods:kt}),Nt=DidIonUtils.normalizeJwk(_t),Ut=DidIonUtils.normalizeJwk(At);return yield IonDid.createLongFormDid({document:Bt,recoveryKey:Nt,updateKey:Ut})})}static constructCreateRequest(e){return __awaiter$7(this,arguments,void 0,function*({ionDocument:_t,recoveryKey:At,updateKey:xt}){return yield IonRequest.createCreateRequest({document:_t,recoveryKey:DidIonUtils.normalizeJwk(At),updateKey:DidIonUtils.normalizeJwk(xt)})})}static createIonDocument(e){return __awaiter$7(this,arguments,void 0,function*({services:_t,verificationMethods:At}){var xt,kt;const Bt=[];for(const Lt of At){let jt=(kt=(xt=Lt.id)!==null&&xt!==void 0?xt:Lt.publicKeyJwk.kid)!==null&&kt!==void 0?kt:yield computeJwkThumbprint({jwk:Lt.publicKeyJwk});jt=`${jt.split("#").pop()}`;const Kt={id:jt,publicKeyJwk:DidIonUtils.normalizeJwk(Lt.publicKeyJwk),purposes:Lt.purposes,type:"JsonWebKey2020"};Bt.push(Kt)}const Nt=_t.map(Lt=>Object.assign(Object.assign({},Lt),{id:`${Lt.id.split("#").pop()}`}));return{publicKeys:Bt,services:Nt}})}static normalizeJwk(e){const _t=e.kty;let At;if(_t==="EC")At={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(_t==="oct")At={k:e.k,kty:e.kty};else if(_t==="OKP")At={crv:e.crv,kty:e.kty,x:e.x};else if(_t==="RSA")At={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${_t}`);return At}}var __awaiter$6=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DidJwk extends DidMethod{static create(){return __awaiter$6(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:_t={}}={}){var At,xt,kt,Bt;if(_t.algorithm&&_t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(_t.verificationMethods&&_t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Nt=(Bt=(At=_t.algorithm)!==null&&At!==void 0?At:(kt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt[0])===null||kt===void 0?void 0:kt.algorithm)!==null&&Bt!==void 0?Bt:"Ed25519",Ut=yield e.generateKey({algorithm:Nt}),Lt=yield e.getPublicKey({keyUri:Ut}),jt=Convert.object(Lt).toBase64Url(),Kt=`did:${DidJwk.methodName}:${jt}`,zt=(yield DidJwk.resolve(Kt)).didDocument;return new BearerDid({uri:Kt,document:zt,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$6(this,arguments,void 0,function*({didDocument:_t}){var At;const xt=Did.parse(_t.id);if(xt&&xt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${xt.method}`);const[kt]=(At=_t.verificationMethod)!==null&&At!==void 0?At:[];if(!(kt&&kt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return kt})}static import(e){return __awaiter$6(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager}){const xt=Did.parse(_t.uri);if((xt==null?void 0:xt.method)!==DidJwk.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");const kt=yield BearerDid.import({portableDid:_t,keyManager:At});if(kt.document.verificationMethod.length!==1)throw new DidError(DidErrorCode.InvalidDidDocument,"DID document must contain exactly one verification method");return kt})}static resolve(e,_t){return __awaiter$6(this,void 0,void 0,function*(){const At=Did.parse(e);let xt;try{xt=Convert.base64Url(At.id).toObject()}catch{}if(!At||!xt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"invalidDid"}});if(At.method!==DidJwk.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"methodNotSupported"}});const kt={"@context":["https://www.w3.org/ns/did/v1"],id:At.uri},Bt=`${kt.id}#0`;switch(kt.verificationMethod=[{id:Bt,type:"JsonWebKey",controller:kt.id,publicKeyJwk:xt}],kt.authentication=[Bt],kt.assertionMethod=[Bt],kt.capabilityInvocation=[Bt],kt.capabilityDelegation=[Bt],kt.keyAgreement=[Bt],xt.use){case"sig":{delete kt.keyAgreement;break}case"enc":{delete kt.authentication,delete kt.assertionMethod,delete kt.capabilityInvocation,delete kt.capabilityDelegation;break}}return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:kt})})}}DidJwk.methodName="jwk";var __awaiter$5=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},DidKeyRegisteredKeyType;(function($t){$t.Ed25519="Ed25519",$t.secp256k1="secp256k1",$t.secp256r1="secp256r1",$t.X25519="X25519"})(DidKeyRegisteredKeyType||(DidKeyRegisteredKeyType={}));const DidKeyVerificationMethodType={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},AlgorithmToKeyTypeMap={Ed25519:DidKeyRegisteredKeyType.Ed25519,ES256K:DidKeyRegisteredKeyType.secp256k1,ES256:DidKeyRegisteredKeyType.secp256r1,"P-256":DidKeyRegisteredKeyType.secp256r1,secp256k1:DidKeyRegisteredKeyType.secp256k1,secp256r1:DidKeyRegisteredKeyType.secp256r1,X25519:DidKeyRegisteredKeyType.X25519};class DidKey extends DidMethod{static create(){return __awaiter$5(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:_t={}}={}){var At,xt,kt,Bt;if(_t.algorithm&&_t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(_t.verificationMethods&&_t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Nt=(Bt=(At=_t.algorithm)!==null&&At!==void 0?At:(kt=(xt=_t.verificationMethods)===null||xt===void 0?void 0:xt[0])===null||kt===void 0?void 0:kt.algorithm)!==null&&Bt!==void 0?Bt:"Ed25519",Ut=yield e.generateKey({algorithm:Nt}),Lt=yield e.getPublicKey({keyUri:Ut}),jt=yield DidKeyUtils.publicKeyToMultibaseId({publicKey:Lt}),Kt=`did:${DidKey.methodName}:${jt}`,zt=(yield DidKey.resolve(Kt,_t)).didDocument;return new BearerDid({uri:Kt,document:zt,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$5(this,arguments,void 0,function*({didDocument:_t}){var At;const xt=Did.parse(_t.id);if(xt&&xt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${xt.method}`);const[kt]=_t.assertionMethod||[],Bt=(At=_t.verificationMethod)===null||At===void 0?void 0:At.find(Nt=>Nt.id===kt);if(!(Bt&&Bt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Bt})}static import(e){return __awaiter$5(this,arguments,void 0,function*({portableDid:_t,keyManager:At=new LocalKeyManager}){const xt=Did.parse(_t.uri);if((xt==null?void 0:xt.method)!==DidKey.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");const kt=yield BearerDid.import({portableDid:_t,keyManager:At});if(kt.document.verificationMethod.length!==1)throw new DidError(DidErrorCode.InvalidDidDocument,"DID document must contain exactly one verification method");return kt})}static resolve(e,_t){return __awaiter$5(this,void 0,void 0,function*(){try{const At=yield DidKey.createDocument({didUri:e,options:_t});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:At})}catch(At){if(!(At instanceof DidError))throw new Error(At);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:Object.assign({error:At.code},At.message&&{errorMessage:At.message})})}})}static createDocument(e){return __awaiter$5(this,arguments,void 0,function*({didUri:_t,options:At={}}){const{defaultContext:xt="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:kt=!1,enableExperimentalPublicKeyTypes:Bt=!1,publicKeyFormat:Nt="JsonWebKey2020"}=At,Ut={id:""},Lt=Did.parse(_t);if(!Lt)throw new DidError(DidErrorCode.InvalidDid,`Invalid DID URI: ${_t}`);const jt=Lt.id;if(Lt.method!==DidKey.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${Lt.method}`);if(!DidKey.validateIdentifier(Lt))throw new DidError(DidErrorCode.InvalidDid,`Invalid DID URI: ${_t}`);const Kt=yield DidKey.createSignatureMethod({didUri:_t,multibaseValue:jt,options:{enableExperimentalPublicKeyTypes:Bt,publicKeyFormat:Nt}});if(Ut.id=Lt.uri,Ut.verificationMethod=[Kt],Ut.authentication=[Kt.id],Ut.assertionMethod=[Kt.id],Ut.capabilityInvocation=[Kt.id],Ut.capabilityDelegation=[Kt.id],kt===!0){const Vt=Nt==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",Ht=yield this.createEncryptionMethod({didUri:_t,multibaseValue:jt,options:{enableExperimentalPublicKeyTypes:Bt,publicKeyFormat:Vt}});Ut.verificationMethod.push(Ht),Ut.keyAgreement=[Ht.id]}const qt=[xt];return getVerificationMethodTypes({didDocument:Ut}).forEach(Vt=>{const Ht=DidKeyVerificationMethodType[Vt];qt.push(Ht)}),Ut["@context"]=qt,Ut})}static createEncryptionMethod(e){return __awaiter$5(this,arguments,void 0,function*({didUri:_t,multibaseValue:At,options:xt}){const{enableExperimentalPublicKeyTypes:kt,publicKeyFormat:Bt}=xt,Nt={id:"",type:"",controller:""},{keyBytes:Ut,multicodecCode:Lt}=yield DidKey.deriveEncryptionKey({multibaseValue:At}),jt=Ut.byteLength,Kt=DidKeyUtils.MULTICODEC_PUBLIC_KEY_LENGTH[Lt];if(jt!==Kt)throw new DidError(DidErrorCode.InvalidPublicKeyLength,`Expected ${jt} bytes. Actual: ${Kt}`);const qt=keyBytesToMultibaseId({keyBytes:Ut,multicodecCode:Lt});Nt.id=`${_t}#${qt}`;try{new URL(Nt.id)}catch{throw new DidError(DidErrorCode.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(Bt in DidKeyVerificationMethodType))throw new DidError(DidErrorCode.UnsupportedPublicKeyType,`Unsupported format: ${Bt}`);if(kt===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(Bt))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Specified '${Bt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Nt.type=Bt,Nt.controller=_t,Bt==="X25519KeyAgreementKey2020"&&(Nt.publicKeyMultibase=qt),Bt==="JsonWebKey2020"){const{crv:Vt}=yield DidKeyUtils.multicodecToJwk({code:Lt});Nt.publicKeyJwk=yield DidKeyUtils.keyConverter(Vt).bytesToPublicKey({publicKeyBytes:Ut})}return Nt})}static createSignatureMethod(e){return __awaiter$5(this,arguments,void 0,function*({didUri:_t,multibaseValue:At,options:xt}){const{enableExperimentalPublicKeyTypes:kt,publicKeyFormat:Bt}=xt,Nt={id:"",type:"",controller:""},{keyBytes:Ut,multicodecCode:Lt,multicodecName:jt}=multibaseIdToKeyBytes({multibaseKeyId:At}),Kt=Ut.byteLength,qt=DidKeyUtils.MULTICODEC_PUBLIC_KEY_LENGTH[Lt];if(Kt!==qt)throw new DidError(DidErrorCode.InvalidPublicKeyLength,`Expected ${Kt} bytes. Actual: ${qt}`);let zt=!1;switch(jt){case"secp256k1-pub":zt=yield Secp256k1.validatePublicKey({publicKeyBytes:Ut});break;case"ed25519-pub":zt=yield Ed25519.validatePublicKey({publicKeyBytes:Ut});break;case"x25519-pub":zt=!0;break}if(!zt)throw new DidError(DidErrorCode.InvalidPublicKey,"Invalid public key detected.");Nt.id=`${_t}#${At}`;try{new URL(Nt.id)}catch{throw new DidError(DidErrorCode.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(Bt in DidKeyVerificationMethodType))throw new DidError(DidErrorCode.UnsupportedPublicKeyType,`Unsupported format: ${Bt}`);if(kt===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(Bt))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Specified '${Bt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Nt.type=Bt,Nt.controller=_t,Bt==="Ed25519VerificationKey2020"&&(Nt.publicKeyMultibase=At),Bt==="JsonWebKey2020"){const{crv:Ht}=yield DidKeyUtils.multicodecToJwk({code:Lt});Nt.publicKeyJwk=yield DidKeyUtils.keyConverter(Ht).bytesToPublicKey({publicKeyBytes:Ut})}return Nt})}static deriveEncryptionKey(e){return __awaiter$5(this,arguments,void 0,function*({multibaseValue:_t}){let At={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:xt,multicodecCode:kt}=multibaseIdToKeyBytes({multibaseKeyId:_t});if(kt===237){const Bt=yield DidKeyUtils.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:xt}),Nt=yield Ed25519.convertPublicKeyToX25519({publicKey:Bt});At={keyBytes:yield DidKeyUtils.keyConverter("Ed25519").publicKeyToBytes({publicKey:Nt}),multicodecCode:236}}return At})}static validateIdentifier(e){const{method:_t,id:At}=e,[xt]=e.uri.split(":",1);return xt==="did"&&_t==="key"&&Number("1")>0&&universalTypeOf(At)==="String"&&At.startsWith("z")}}DidKey.methodName="key";class DidKeyUtils{static jwkToMulticodec(e){return __awaiter$5(this,arguments,void 0,function*({jwk:_t}){const At=[];_t.crv&&(At.push(_t.crv),_t.d?At.push("private"):At.push("public"));const xt=At.join(":"),kt=DidKeyUtils.JWK_TO_MULTICODEC[xt];if(kt===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${xt}'`);return{code:Multicodec.getCodeFromName({name:kt}),name:kt}})}static keyCompressor(e){const At={"P-256":Secp256r1.compressPublicKey,secp256k1:Secp256k1.compressPublicKey}[e];if(!At)throw new DidError(DidErrorCode.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static keyConverter(e){const At={Ed25519,"P-256":Secp256r1,secp256k1:Secp256k1,X25519}[e];if(!At)throw new DidError(DidErrorCode.InvalidPublicKeyType,`Unsupported curve: ${e}`);return At}static multicodecToJwk(e){return __awaiter$5(this,arguments,void 0,function*({code:_t,name:At}){if(!(At?!_t:_t))throw new Error("Either 'name' or 'code' must be defined, but not both.");At=At===void 0?Multicodec.getNameFromCode({code:_t}):At;const xt=At,kt=DidKeyUtils.MULTICODEC_TO_JWK[xt];if(kt===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},kt)})}static publicKeyToMultibaseId(e){return __awaiter$5(this,arguments,void 0,function*({publicKey:_t}){var At;if(!(_t!=null&&_t.crv&&_t.crv in AlgorithmToKeyTypeMap))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(At=_t==null?void 0:_t.crv)!==null&&At!==void 0?At:"undefined"}`);let xt=yield DidKeyUtils.keyConverter(_t.crv).publicKeyToBytes({publicKey:_t});/^(secp256k1|P-256|P-384|P-521)$/.test(_t.crv)&&(xt=yield DidKeyUtils.keyCompressor(_t.crv)({publicKeyBytes:xt}));const{name:kt}=yield DidKeyUtils.jwkToMulticodec({jwk:_t});return keyBytesToMultibaseId({keyBytes:xt,multicodecName:kt})})}}DidKeyUtils.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};DidKeyUtils.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};DidKeyUtils.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var __awaiter$4=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class DidWeb extends DidMethod{static resolve(e,_t){return __awaiter$4(this,void 0,void 0,function*(){const At=Did.parse(e);if(!At)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"invalidDid"}});if(At.method!==DidWeb.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"methodNotSupported"}});let xt=`https://${At.id.replace(/:/g,"/")}`;xt=decodeURIComponent(xt);const kt=At.id.includes(":")?`${xt}/did.json`:`${xt}/.well-known/did.json`;try{const Bt=yield fetch(kt);if(!Bt.ok)throw new Error("HTTP error status code returned");const Nt=yield Bt.json();return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:Nt})}catch{return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"notFound"}})}})}}DidWeb.methodName="web";const DidResolverCacheNoop={get:function($t){return null},set:function($t,e){return null},delete:function($t){return null},clear:function(){return null},close:function(){return null}};var __awaiter$3=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class UniversalResolver{constructor({cache:e,didResolvers:_t}){this.didResolvers=new Map,this.cache=e||DidResolverCacheNoop;for(const At of _t)this.didResolvers.set(At.methodName,At)}resolve(e,_t){return __awaiter$3(this,void 0,void 0,function*(){const At=Did.parse(e);if(!At)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:DidErrorCode.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const xt=this.didResolvers.get(At.method);if(!xt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:DidErrorCode.MethodNotSupported,errorMessage:`Method not supported: ${At.method}`}});const kt=yield this.cache.get(At.uri);if(kt)return kt;{const Bt=yield xt.resolve(At.uri,_t);return Bt.didResolutionMetadata.error||(yield this.cache.set(At.uri,Bt)),Bt}})}dereference(e,_t){return __awaiter$3(this,void 0,void 0,function*(){const At=Did.parse(e);if(!At)return{dereferencingMetadata:{error:DidErrorCode.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:xt,didResolutionMetadata:kt,didDocumentMetadata:Bt}=yield this.resolve(At.uri);if(!xt)return{dereferencingMetadata:{error:kt.error},contentStream:null,contentMetadata:{}};if(!At.fragment||At.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:xt,contentMetadata:Bt};const{service:Nt=[],verificationMethod:Ut=[]}=xt,Lt=new Set([e,At.fragment,`#${At.fragment}`]);let jt;for(let Kt of Ut)if(Lt.has(Kt.id)){jt=Kt;break}for(let Kt of Nt)if(Lt.has(Kt.id)){jt=Kt;break}return jt?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:jt,contentMetadata:kt}:{dereferencingMetadata:{error:DidErrorCode.NotFound},contentStream:null,contentMetadata:{}}})}}var __awaiter$2=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})};class Web5UserAgent{constructor(e){this._agentDid=e.agentDid,this.crypto=e.cryptoApi,this.did=e.didApi,this.dwn=e.dwnApi,this.identity=e.identityApi,this.keyManager=e.keyManager,this.permissions=e.permissionsApi,this.rpc=e.rpcClient,this.sync=e.syncApi,this.vault=e.agentVault,this.did.agent=this,this.dwn.agent=this,this.identity.agent=this,this.keyManager.agent=this,this.permissions.agent=this,this.sync.agent=this}get agentDid(){if(this._agentDid===void 0)throw new Error('Web5UserAgent: The "agentDid" property is not set. Ensure the agent is properly initialized and a DID is assigned.');return this._agentDid}set agentDid(e){this._agentDid=e}static create({dataPath:e="DATA/AGENT",agentDid:_t,agentVault:At,cryptoApi:xt,didApi:kt,dwnApi:Bt,identityApi:Nt,keyManager:Ut,permissionsApi:Lt,rpcClient:jt,syncApi:Kt}={}){return __awaiter$2(this,void 0,void 0,function*(){return At??(At=new HdIdentityVault({keyDerivationWorkFactor:21e4,store:new LevelStore({location:`${e}/VAULT_STORE`})})),xt??(xt=new AgentCryptoApi),kt??(kt=new AgentDidApi({didMethods:[DidDht,DidJwk],resolverCache:new AgentDidResolverCache({location:`${e}/DID_RESOLVERCACHE`}),store:new DwnDidStore})),Bt??(Bt=new AgentDwnApi({dwn:yield AgentDwnApi.createDwn({dataPath:e,didResolver:kt})})),Nt??(Nt=new AgentIdentityApi({store:new DwnIdentityStore})),Ut??(Ut=new LocalKeyManager$1({keyStore:new DwnKeyStore})),Lt??(Lt=new AgentPermissionsApi),jt??(jt=new Web5RpcClient),Kt??(Kt=new AgentSyncApi({syncEngine:new SyncEngineLevel({dataPath:e})})),new Web5UserAgent({agentDid:_t,agentVault:At,cryptoApi:xt,didApi:kt,dwnApi:Bt,keyManager:Ut,permissionsApi:Lt,identityApi:Nt,rpcClient:jt,syncApi:Kt})})}firstLaunch(){return __awaiter$2(this,void 0,void 0,function*(){return(yield this.vault.isInitialized())===!1})}initialize({password:e,recoveryPhrase:_t,dwnEndpoints:At}){return __awaiter$2(this,void 0,void 0,function*(){return _t=yield this.vault.initialize({password:e,recoveryPhrase:_t,dwnEndpoints:At}),_t})}processDidRequest(e){return __awaiter$2(this,void 0,void 0,function*(){return this.did.processRequest(e)})}processDwnRequest(e){return __awaiter$2(this,void 0,void 0,function*(){return this.dwn.processRequest(e)})}processVcRequest(e){return __awaiter$2(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDidRequest(e){return __awaiter$2(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDwnRequest(e){return __awaiter$2(this,void 0,void 0,function*(){return this.dwn.sendRequest(e)})}sendVcRequest(e){return __awaiter$2(this,void 0,void 0,function*(){throw new Error("Not implemented")})}start({password:e}){return __awaiter$2(this,void 0,void 0,function*(){this.vault.isLocked()&&(yield this.vault.unlock({password:e})),this.agentDid=yield this.vault.getDid()})}}var __awaiter$1=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,e||[])).next())})},__rest=function($t,e){var _t={};for(var At in $t)Object.prototype.hasOwnProperty.call($t,At)&&e.indexOf(At)<0&&(_t[At]=$t[At]);if($t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,At=Object.getOwnPropertySymbols($t);xt<At.length;xt++)e.indexOf(At[xt])<0&&Object.prototype.propertyIsEnumerable.call($t,At[xt])&&(_t[At[xt]]=$t[At[xt]]);return _t};class Web5{constructor({agent:e,connectedDid:_t,delegateDid:At}){this.agent=e,this.did=new DidApi({agent:e,connectedDid:_t}),this.dwn=new DwnApi({agent:e,connectedDid:_t,delegateDid:At}),this.vc=new VcApi({agent:e,connectedDid:_t})}static connect({agent:e,agentVault:_t,connectedDid:At,password:xt,recoveryPhrase:kt,sync:Bt,techPreview:Nt,didCreateOptions:Ut,registration:Lt,walletConnectOptions:jt}={}){var Kt,qt,zt;return __awaiter$1(this,void 0,void 0,function*(){let Vt;if(e===void 0){let Wt=!1;const Qt=yield Web5UserAgent.create({agentVault:_t});e=Qt,xt===void 0&&(xt="insecure-static-phrase",console.warn("%cSECURITY WARNING:%c You have not set a password, which defaults to a static, guessable value. This significantly compromises the security of your data. Please configure a secure, unique password.","font-weight: bold; color: red;","font-weight: normal; color: inherit;"));const Xt=(qt=(Kt=Nt==null?void 0:Nt.dwnEndpoints)!==null&&Kt!==void 0?Kt:Ut==null?void 0:Ut.dwnEndpoints)!==null&&qt!==void 0?qt:["https://dwn.tbddev.org/beta"];(yield Qt.firstLaunch())&&(kt=yield Qt.initialize({password:xt,recoveryPhrase:kt,dwnEndpoints:Xt})),yield Qt.start({password:xt});const Jt=yield Qt.identity.connectedIdentity();let tr,dr=[];if(Jt)tr=Jt;else if(jt){if(Bt==="off")throw new Error("Sync must not be disabled when using WalletConnect");Wt=!0;try{const{permissionRequests:vr}=jt,$r=__rest(jt,["permissionRequests"]),Ir=vr.map(({protocolDefinition:lr,permissions:ir})=>WalletConnect.createPermissionRequestForProtocol({definition:lr,permissions:ir??["read","write","delete","query","subscribe"]})),{delegatePortableDid:Rr,connectedDid:Nr,delegateGrants:kr}=yield WalletConnect.initClient(Object.assign(Object.assign({},$r),{permissionRequests:Ir}));tr=yield Qt.identity.import({portableIdentity:{portableDid:Rr,metadata:{connectedDid:Nr,name:"Default",tenant:Rr.uri,uri:Rr.uri}}}),yield Qt.identity.manage({portableIdentity:yield tr.export()}),dr=yield this.processConnectedGrants({agent:e,delegateDid:Rr.uri,grants:kr})}catch(vr){throw yield this.cleanUpIdentity({identity:tr,userAgent:Qt}),new Error(`Failed to connect to wallet: ${vr.message}`)}}else{const vr=yield Qt.identity.list();vr.length===0?(Wt=!0,tr=yield Qt.identity.create({didMethod:"dht",metadata:{name:"Default"},didOptions:{services:[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:Xt,enc:"#enc",sig:"#sig"}],verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]},{algorithm:"secp256k1",id:"enc",purposes:["keyAgreement"]}]}}),yield Qt.identity.manage({portableIdentity:yield tr.export()})):tr=vr[0]}if(At=(zt=tr.metadata.connectedDid)!==null&&zt!==void 0?zt:tr.did.uri,Vt=tr.metadata.connectedDid?tr.did.uri:void 0,Lt!==void 0)try{for(const vr of Xt)(yield Qt.rpc.getServerInfo(vr)).registrationRequirements.length!==0&&(yield DwnRegistrar.registerTenant(vr,e.agentDid.uri),yield DwnRegistrar.registerTenant(vr,At));Lt.onSuccess()}catch(vr){Lt.onFailure(vr)}Bt!=="off"&&(Wt&&(yield Qt.sync.registerIdentity({did:At,options:{delegateDid:Vt,protocols:dr}}),jt!==void 0&&(yield Qt.sync.sync("pull"))),Bt??(Bt="2m"),Qt.sync.startSync({interval:Bt}).catch(vr=>{console.error(`Sync failed: ${vr}`)}))}return{web5:new Web5({agent:e,connectedDid:At,delegateDid:Vt}),did:At,delegateDid:Vt,recoveryPhrase:kt}})}static cleanUpIdentity({identity:e,userAgent:_t}){return __awaiter$1(this,void 0,void 0,function*(){try{yield _t.did.delete({didUri:e.did.uri,tenant:e.metadata.tenant,deleteKey:!0})}catch(At){console.error(`Failed to delete DID ${e.did.uri}: ${At.message}`)}try{yield _t.identity.delete({didUri:e.did.uri})}catch(At){console.error(`Failed to delete Identity ${e.metadata.name}: ${At.message}`)}})}static processConnectedGrants({grants:e,agent:_t,delegateDid:At}){return __awaiter$1(this,void 0,void 0,function*(){const xt=new Set;for(const kt of e){const Bt=yield PermissionGrant.parse({connectedDid:At,agent:_t,message:kt}),{status:Nt}=yield Bt.store(!0);if(Nt.code!==202)throw new Error(`AgentDwnApi: Failed to process connected grant: ${Nt.detail}`);const Ut=Bt.scope.protocol;Ut&&xt.add(Ut)}return[...xt]})}}var __awaiter=function($t,e,_t,At){function xt(kt){return kt instanceof _t?kt:new _t(function(Bt){Bt(kt)})}return new(_t||(_t=Promise))(function(kt,Bt){function Nt(jt){try{Lt(At.next(jt))}catch(Kt){Bt(Kt)}}function Ut(jt){try{Lt(At.throw(jt))}catch(Kt){Bt(Kt)}}function Lt(jt){jt.done?kt(jt.value):xt(jt.value).then(Nt,Ut)}Lt((At=At.apply($t,[])).next())})};const DidResolver=new UniversalResolver({didResolvers:[DidDht,DidWeb]}),didUrlRegex=/^https?:\/\/dweb\/([^/]+)\/?(.*)?$/,httpToHttpsRegex=/^http:/,trailingSlashRegex=/\/$/;function importMetaIfSupported(){try{return new Function("return import.meta")()}catch{return}}function getDwnEndpoints($t){var e,_t;return __awaiter(this,void 0,void 0,function*(){const{didDocument:At}=yield DidResolver.resolve($t);let xt=(_t=(e=At==null?void 0:At.service)===null||e===void 0?void 0:e.find(kt=>kt.type==="DecentralizedWebNode"))===null||_t===void 0?void 0:_t.serviceEndpoint;return(Array.isArray(xt)?xt:[xt]).filter(kt=>kt.startsWith("http"))})}function handleEvent($t,e,_t,At){return __awaiter(this,void 0,void 0,function*(){const xt=$t.request.url.replace(httpToHttpsRegex,"https:").replace(trailingSlashRegex,""),kt=yield caches.open("drl"),Bt=yield kt.match(xt);if(Bt){if(!navigator.onLine)return Bt;const Nt=yield At==null?void 0:At.onCacheCheck($t,xt);if(Nt){const Ut=Bt.headers.get("dwn-cache-time");if(Ut&&Date.now()<Number(Ut)+(Number(Nt.ttl)||0))return Bt}}try{if(_t)return yield fetchResource($t,e,xt,_t,kt,At);{const Nt=yield DidResolver.resolve(e);return new Response(JSON.stringify(Nt),{status:200,headers:{"Content-Type":"application/json"}})}}catch(Nt){return Nt instanceof Response?Nt:(console.log(`Error in DID URL fetch: ${Nt}`),new Response("DID URL fetch error",{status:500}))}})}function fetchResource($t,e,_t,At,xt,kt){return __awaiter(this,void 0,void 0,function*(){const Bt=yield getDwnEndpoints(e);if(!(Bt!=null&&Bt.length))throw new Response("DWeb Node resolution failed: no valid endpoints found.",{status:530});for(const Nt of Bt)try{const Ut=`${Nt.replace(trailingSlashRegex,"")}/${e}/${At}`,Lt=yield fetch(Ut,{headers:$t.request.headers});return Lt.ok?((yield kt==null?void 0:kt.onCacheCheck($t,_t))&&cacheResponse(_t,Ut,Lt,xt),Lt):(console.log(`DWN endpoint error: ${Lt.status}`),new Response("DWeb Node request failed",{status:Lt.status}))}catch(Ut){return console.log(`DWN endpoint error: ${Ut}`),new Response("DWeb Node request failed: "+Ut,{status:500})}})}function cacheResponse($t,e,_t,At){return __awaiter(this,void 0,void 0,function*(){const xt=_t.clone(),kt=new Headers(xt.headers);kt.append("dwn-cache-time",Date.now().toString()),kt.append("dwn-composed-url",e);const Bt=new Response(xt.body,{headers:kt});At.put($t,Bt)})}function installWorker($t={}){var e,_t,At;return __awaiter(this,void 0,void 0,function*(){const xt=self;try{if(typeof ServiceWorkerGlobalScope<"u"&&xt instanceof ServiceWorkerGlobalScope)xt.skipWaiting(),xt.addEventListener("activate",kt=>{kt.waitUntil(xt.clients.claim())}),xt.addEventListener("fetch",kt=>{const Bt=kt.request.url.match(didUrlRegex);Bt&&kt.respondWith(handleEvent(kt,Bt[1],Bt[2],$t))});else if(!((e=globalThis==null?void 0:globalThis.navigator)===null||e===void 0)&&e.serviceWorker){if(!(yield navigator.serviceWorker.getRegistration("/"))){const Bt=$t.path||(globalThis.document?(_t=document==null?void 0:document.currentScript)===null||_t===void 0?void 0:_t.src:(At=importMetaIfSupported())===null||At===void 0?void 0:At.url);Bt&&navigator.serviceWorker.register(Bt,{type:"module"}).catch(Nt=>{console.error("DWeb networking feature installation failed: ",Nt)})}}else throw new Error("DWeb networking features are not available for install in this environment")}catch(kt){console.error("Error in installing networking features:",kt)}})}const loaderStyles=`
  .drl-loading-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    flex-wrap: wrap;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: #fff;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    z-index: 1000000;
  }

  .drl-loading-overlay > div {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .drl-loading-spinner {
    display: flex;
    align-items: center;
    justify-content: center;
  }

    .drl-loading-spinner div {
      position: relative;
      width: 2em;
      height: 2em;
      margin: 0.1em 0.25em 0 0;
    }
    .drl-loading-spinner div::after,
    .drl-loading-spinner div::before {
      content: '';  
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 0.1em solid #FFF;
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      animation: drl-loading-spinner 2s linear infinite;
    }
    .drl-loading-spinner div::after {
      animation-delay: 1s;
    }

  .drl-loading-overlay span {
    --text-opacity: 2;
    display: flex;
    align-items: center;
    margin: 2em auto 0;
    padding: 0.2em 0.75em 0.25em;
    text-align: center;
    border-radius: 5em;
    background: rgba(255 255 255 / 8%);
    opacity: 0.8;
    transition: opacity 0.3s ease;
    cursor: pointer;
  }

    .drl-loading-overlay span:focus {
      opacity: 1;
    }

    .drl-loading-overlay span:hover {
      opacity: 1;
    }

    .drl-loading-overlay span::before {
      content: " ";
      margin: 0 0.4em 0 0;
      color: red;
      font-size: 65%;
      font-weight: bold;
    }

    .drl-loading-overlay span::after {
      content: "stop";
      display: block;
      font-size: 60%;
      line-height: 0;
      color: rgba(255 255 255 / 60%);
    }

    .drl-loading-overlay.new-tab-overlay span::after {
      content: "close";
    }
  
  @keyframes drl-loading-spinner {
    0% {
      transform: scale(0);
      opacity: 1;
    }
    100% {
      transform: scale(1);
      opacity: 0;
    }
  }
`,tabContent=`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading DRL...</title>
  <style>
    html, body {
      background-color: #151518;
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    ${loaderStyles}
  </style>
</head>
<body>
  <div class="drl-loading-overlay new-tab-overlay">
    <div class="drl-loading-spinner">
      <div></div>
      Loading DRL
    </div>
    <span onclick="window.close()" tabindex="0"></span>
  </div>
</body>
</html>
`;let elementsInjected=!1;function injectElements(){if(elementsInjected)return;const $t=document.createElement("style");$t.innerHTML=`
    ${loaderStyles}

    .drl-loading-overlay {
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    :root[drl-link-loading] .drl-loading-overlay {
      opacity: 1;
      pointer-events: all;
    }
  `,document.head.append($t);let e=document.createElement("div");e.classList.add("drl-loading-overlay"),e.innerHTML=`
    <div class="drl-loading-spinner">
      <div></div>
      Loading DRL
    </div> 
    <span tabindex="0"></span>
  `,e.lastElementChild.addEventListener("click",cancelNavigation),document.body.prepend(e),elementsInjected=!0}function cancelNavigation(){document.documentElement.removeAttribute("drl-link-loading"),activeNavigation=null}let activeNavigation,linkFeaturesActive=!1;function addLinkFeatures(){linkFeaturesActive||(document.addEventListener("click",$t=>__awaiter(this,void 0,void 0,function*(){let e=$t.target.closest("a");if(e){let _t=e.href;const At=_t.match(didUrlRegex);if(At){let xt=At[1],kt=At[2];const Bt=e.target==="_blank";$t.preventDefault();try{let Nt;Bt?(Nt=window.open("","_blank"),Nt.document.write(tabContent)):(activeNavigation=kt,setTimeout(()=>document.documentElement.setAttribute("drl-link-loading",""),50));const Ut=yield getDwnEndpoints(xt);if(!Ut.length)throw null;let Lt=`${Ut[0].replace(trailingSlashRegex,"")}/${xt}/${kt}`;Bt?Nt.closed||(Nt.location.href=Lt):activeNavigation===kt&&(window.location.href=Lt)}catch{throw activeNavigation===kt&&cancelNavigation(),new Error(`DID endpoint resolution failed for the DRL: ${_t}`)}}}})),document.addEventListener("pointercancel",resetContextMenuTarget),document.addEventListener("pointerdown",$t=>__awaiter(this,void 0,void 0,function*(){var e;const _t=$t.composedPath()[0];if($t.pointerType==="mouse"&&$t.button===2||$t.pointerType==="touch"&&$t.isPrimary){if(resetContextMenuTarget(),_t&&(!((e=_t==null?void 0:_t.src)===null||e===void 0)&&e.match(didUrlRegex))){contextMenuTarget=_t,_t.__src__=_t.src;const At=_t.src.replace(httpToHttpsRegex,"https:").replace(trailingSlashRegex,""),Bt=(yield(yield caches.open("drl")).match(At)).headers.get("dwn-composed-url");Bt&&(_t.src=Bt),_t.addEventListener("pointerup",resetContextMenuTarget,{once:!0})}}else _t===contextMenuTarget&&resetContextMenuTarget()})),linkFeaturesActive=!0)}let contextMenuTarget;function resetContextMenuTarget($t){return __awaiter(this,void 0,void 0,function*(){($t==null?void 0:$t.type)==="pointerup"&&(yield new Promise(e=>requestAnimationFrame(e))),contextMenuTarget&&(contextMenuTarget.src=contextMenuTarget.__src__,delete contextMenuTarget.__src__,contextMenuTarget=null)})}function activatePolyfills($t={}){$t.serviceWorker!==!1&&installWorker($t),typeof window<"u"&&typeof window.document<"u"&&($t.injectStyles!==!1&&(document.readyState!=="loading"?injectElements():document.addEventListener("DOMContentLoaded",injectElements,{once:!0})),$t.links!==!1&&addLinkFeatures())}export{BearerDid$2 as B,DwnRegistrar as D,Oidc as O,Web5UserAgent as W,DidJwk$2 as a,DidDht$2 as b,Web5 as c,buffer$2 as d,activatePolyfills as e};
