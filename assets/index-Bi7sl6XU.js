(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const V2=globalThis,L5=V2.ShadowRoot&&(V2.ShadyCSS===void 0||V2.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,K5=Symbol(),N6=new WeakMap;let z5=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==K5)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(L5&&e===void 0){const n=t!==void 0&&t.length===1;n&&(e=N6.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&N6.set(t,e))}return e}toString(){return this.cssText}};const BG=r=>new z5(typeof r=="string"?r:r+"",void 0,K5),Ye=(r,...e)=>{const t=r.length===1?r[0]:e.reduce((n,i,o)=>n+(s=>{if(s._$cssResult$===!0)return s.cssText;if(typeof s=="number")return s;throw Error("Value passed to 'css' function must be a 'css' function result: "+s+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+r[o+1],r[0]);return new z5(t,r,K5)},mL=(r,e)=>{if(L5)r.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const n=document.createElement("style"),i=V2.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=t.cssText,r.appendChild(n)}},U6=L5?r=>r:r=>r instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return BG(t)})(r):r;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:jG,defineProperty:NG,getOwnPropertyDescriptor:UG,getOwnPropertyNames:LG,getOwnPropertySymbols:KG,getPrototypeOf:zG}=Object,bx=globalThis,L6=bx.trustedTypes,FG=L6?L6.emptyScript:"",qG=bx.reactiveElementPolyfillSupport,Db=(r,e)=>r,kg={toAttribute(r,e){switch(e){case Boolean:r=r?FG:null;break;case Object:case Array:r=r==null?r:JSON.stringify(r)}return r},fromAttribute(r,e){let t=r;switch(e){case Boolean:t=r!==null;break;case Number:t=r===null?null:Number(r);break;case Object:case Array:try{t=JSON.parse(r)}catch{t=null}}return t}},F5=(r,e)=>!jG(r,e),K6={attribute:!0,type:String,converter:kg,reflect:!1,hasChanged:F5};Symbol.metadata??=Symbol("metadata"),bx.litPropertyMetadata??=new WeakMap;let Mm=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=K6){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(e,n,t);i!==void 0&&NG(this.prototype,e,i)}}static getPropertyDescriptor(e,t,n){const{get:i,set:o}=UG(this.prototype,e)??{get(){return this[t]},set(s){this[t]=s}};return{get(){return i?.call(this)},set(s){const a=i?.call(this);o.call(this,s),this.requestUpdate(e,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??K6}static _$Ei(){if(this.hasOwnProperty(Db("elementProperties")))return;const e=zG(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Db("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Db("properties"))){const t=this.properties,n=[...LG(t),...KG(t)];for(const i of n)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[n,i]of t)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[t,n]of this.elementProperties){const i=this._$Eu(t,n);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const i of n)t.unshift(U6(i))}else e!==void 0&&t.push(U6(e));return t}static _$Eu(e,t){const n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return mL(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EC(e,t){const n=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,n);if(i!==void 0&&n.reflect===!0){const o=(n.converter?.toAttribute!==void 0?n.converter:kg).toAttribute(t,n.type);this._$Em=e,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,t){const n=this.constructor,i=n._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const o=n.getPropertyOptions(i),s=typeof o.converter=="function"?{fromAttribute:o.converter}:o.converter?.fromAttribute!==void 0?o.converter:kg;this._$Em=i,this[i]=s.fromAttribute(t,o.type),this._$Em=null}}requestUpdate(e,t,n){if(e!==void 0){if(n??=this.constructor.getPropertyOptions(e),!(n.hasChanged??F5)(this[e],t))return;this.P(e,t,n)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(e,t,n){this._$AL.has(e)||this._$AL.set(e,t),n.reflect===!0&&this._$Em!==e&&(this._$Ej??=new Set).add(e)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,o]of this._$Ep)this[i]=o;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,o]of n)o.wrapped!==!0||this._$AL.has(i)||this[i]===void 0||this.P(i,this[i],o)}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(n=>n.hostUpdate?.()),this.update(t)):this._$EU()}catch(n){throw e=!1,this._$EU(),n}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&=this._$Ej.forEach(t=>this._$EC(t,this[t])),this._$EU()}updated(e){}firstUpdated(e){}};Mm.elementStyles=[],Mm.shadowRootOptions={mode:"open"},Mm[Db("elementProperties")]=new Map,Mm[Db("finalized")]=new Map,qG?.({ReactiveElement:Mm}),(bx.reactiveElementVersions??=[]).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const q5=globalThis,UE=q5.trustedTypes,z6=UE?UE.createPolicy("lit-html",{createHTML:r=>r}):void 0,gL="$lit$",Gf=`lit$${Math.random().toFixed(9).slice(2)}$`,vL="?"+Gf,VG=`<${vL}>`,xy=document,fw=()=>xy.createComment(""),hw=r=>r===null||typeof r!="object"&&typeof r!="function",V5=Array.isArray,WG=r=>V5(r)||typeof r?.[Symbol.iterator]=="function",hT=`[ 	
\f\r]`,r0=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,F6=/-->/g,q6=/>/g,Jh=RegExp(`>|${hT}(?:([^\\s"'>=/]+)(${hT}*=${hT}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),V6=/'/g,W6=/"/g,bL=/^(?:script|style|textarea|title)$/i,HG=r=>(e,...t)=>({_$litType$:r,strings:e,values:t}),Ie=HG(1),ic=Symbol.for("lit-noChange"),Ot=Symbol.for("lit-nothing"),H6=new WeakMap,zp=xy.createTreeWalker(xy,129);function wL(r,e){if(!V5(r)||!r.hasOwnProperty("raw"))throw Error("invalid template strings array");return z6!==void 0?z6.createHTML(e):e}const GG=(r,e)=>{const t=r.length-1,n=[];let i,o=e===2?"<svg>":e===3?"<math>":"",s=r0;for(let a=0;a<t;a++){const l=r[a];let d,c,u=-1,f=0;for(;f<l.length&&(s.lastIndex=f,c=s.exec(l),c!==null);)f=s.lastIndex,s===r0?c[1]==="!--"?s=F6:c[1]!==void 0?s=q6:c[2]!==void 0?(bL.test(c[2])&&(i=RegExp("</"+c[2],"g")),s=Jh):c[3]!==void 0&&(s=Jh):s===Jh?c[0]===">"?(s=i??r0,u=-1):c[1]===void 0?u=-2:(u=s.lastIndex-c[2].length,d=c[1],s=c[3]===void 0?Jh:c[3]==='"'?W6:V6):s===W6||s===V6?s=Jh:s===F6||s===q6?s=r0:(s=Jh,i=void 0);const h=s===Jh&&r[a+1].startsWith("/>")?" ":"";o+=s===r0?l+VG:u>=0?(n.push(d),l.slice(0,u)+gL+l.slice(u)+Gf+h):l+Gf+(u===-2?a:h)}return[wL(r,o+(r[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),n]};let sP=class _L{constructor({strings:e,_$litType$:t},n){let i;this.parts=[];let o=0,s=0;const a=e.length-1,l=this.parts,[d,c]=GG(e,t);if(this.el=_L.createElement(d,n),zp.currentNode=this.el.content,t===2||t===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=zp.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(gL)){const f=c[s++],h=i.getAttribute(u).split(Gf),p=/([.?@])?(.*)/.exec(f);l.push({type:1,index:o,name:p[2],strings:h,ctor:p[1]==="."?ZG:p[1]==="?"?JG:p[1]==="@"?XG:wx}),i.removeAttribute(u)}else u.startsWith(Gf)&&(l.push({type:6,index:o}),i.removeAttribute(u));if(bL.test(i.tagName)){const u=i.textContent.split(Gf),f=u.length-1;if(f>0){i.textContent=UE?UE.emptyScript:"";for(let h=0;h<f;h++)i.append(u[h],fw()),zp.nextNode(),l.push({type:2,index:++o});i.append(u[f],fw())}}}else if(i.nodeType===8)if(i.data===vL)l.push({type:2,index:o});else{let u=-1;for(;(u=i.data.indexOf(Gf,u+1))!==-1;)l.push({type:7,index:o}),u+=Gf.length-1}o++}}static createElement(e,t){const n=xy.createElement("template");return n.innerHTML=e,n}};function Pg(r,e,t=r,n){if(e===ic)return e;let i=n!==void 0?t.o?.[n]:t.l;const o=hw(e)?void 0:e._$litDirective$;return i?.constructor!==o&&(i?._$AO?.(!1),o===void 0?i=void 0:(i=new o(r),i._$AT(r,t,n)),n!==void 0?(t.o??=[])[n]=i:t.l=i),i!==void 0&&(e=Pg(r,i._$AS(r,e.values),i,n)),e}let YG=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,i=(e?.creationScope??xy).importNode(t,!0);zp.currentNode=i;let o=zp.nextNode(),s=0,a=0,l=n[0];for(;l!==void 0;){if(s===l.index){let d;l.type===2?d=new W5(o,o.nextSibling,this,e):l.type===1?d=new l.ctor(o,l.name,l.strings,this,e):l.type===6&&(d=new QG(o,this,e)),this._$AV.push(d),l=n[++a]}s!==l?.index&&(o=zp.nextNode(),s++)}return zp.currentNode=xy,i}p(e){let t=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}},W5=class EL{get _$AU(){return this._$AM?._$AU??this.v}constructor(e,t,n,i){this.type=2,this._$AH=Ot,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=i,this.v=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Pg(this,e,t),hw(e)?e===Ot||e==null||e===""?(this._$AH!==Ot&&this._$AR(),this._$AH=Ot):e!==this._$AH&&e!==ic&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):WG(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ot&&hw(this._$AH)?this._$AA.nextSibling.data=e:this.T(xy.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:n}=e,i=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=sP.createElement(wL(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===i)this._$AH.p(t);else{const o=new YG(i,this),s=o.u(this.options);o.p(t),this.T(s),this._$AH=o}}_$AC(e){let t=H6.get(e.strings);return t===void 0&&H6.set(e.strings,t=new sP(e)),t}k(e){V5(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,i=0;for(const o of e)i===t.length?t.push(n=new EL(this.O(fw()),this.O(fw()),this,this.options)):n=t[i],n._$AI(o),i++;i<t.length&&(this._$AR(n&&n._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){this._$AM===void 0&&(this.v=e,this._$AP?.(e))}},wx=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,i,o){this.type=1,this._$AH=Ot,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=o,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Ot}_$AI(e,t=this,n,i){const o=this.strings;let s=!1;if(o===void 0)e=Pg(this,e,t,0),s=!hw(e)||e!==this._$AH&&e!==ic,s&&(this._$AH=e);else{const a=e;let l,d;for(e=o[0],l=0;l<o.length-1;l++)d=Pg(this,a[n+l],t,l),d===ic&&(d=this._$AH[l]),s||=!hw(d)||d!==this._$AH[l],d===Ot?e=Ot:e!==Ot&&(e+=(d??"")+o[l+1]),this._$AH[l]=d}s&&!i&&this.j(e)}j(e){e===Ot?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},ZG=class extends wx{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ot?void 0:e}},JG=class extends wx{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ot)}},XG=class extends wx{constructor(e,t,n,i,o){super(e,t,n,i,o),this.type=5}_$AI(e,t=this){if((e=Pg(this,e,t,0)??Ot)===ic)return;const n=this._$AH,i=e===Ot&&n!==Ot||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,o=e!==Ot&&(n===Ot||i);i&&this.element.removeEventListener(this.name,this,n),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}},QG=class{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Pg(this,e)}};const eY=q5.litHtmlPolyfillSupport;eY?.(sP,W5),(q5.litHtmlVersions??=[]).push("3.2.0");const AL=(r,e,t)=>{const n=t?.renderBefore??e;let i=n._$litPart$;if(i===void 0){const o=t?.renderBefore??null;n._$litPart$=i=new W5(e.insertBefore(fw(),o),o,void 0,t??{})}return i._$AI(r),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let hi=class extends Mm{constructor(){super(...arguments),this.renderOptions={host:this},this.o=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this.o=AL(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this.o?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this.o?.setConnected(!1)}render(){return ic}};hi._$litElement$=!0,hi.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:hi});const tY=globalThis.litElementPolyfillSupport;tY?.({LitElement:hi});(globalThis.litElementVersions??=[]).push("4.1.0");const rY="modulepreload",nY=function(r){return"/"+r},G6={},xL=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=o?.nonce||o?.getAttribute("nonce");i=Promise.all(t.map(a=>{if(a=nY(a),a in G6)return;G6[a]=!0;const l=a.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${d}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":rY,l||(c.as="script",c.crossOrigin=""),c.href=a,s&&c.setAttribute("nonce",s),document.head.appendChild(c),l)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}return i.then(()=>e()).catch(o=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o})};function iY(r={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:i,onRegisteredSW:o,onRegisterError:s}=r;let a,l;const d=async(u=!0)=>{await l};async function c(){if("serviceWorker"in navigator){if(a=await xL(async()=>{const{Workbox:u}=await import("./workbox-window.prod.es5-D5gOYdM7.js");return{Workbox:u}},[]).then(({Workbox:u})=>new u("/sw.js",{scope:"/",type:"classic"})).catch(u=>{s?.(u)}),!a)return;a.addEventListener("activated",u=>{(u.isUpdate||u.isExternal)&&window.location.reload()}),a.addEventListener("installed",u=>{u.isUpdate||n?.()}),a.register({immediate:e}).then(u=>{o?o("/sw.js",u):i?.(u)}).catch(u=>{s?.(u)})}}return l=c(),d}class oY extends hi{static get properties(){return{_period:{type:Number,state:!1},_swActivated:{type:Boolean,state:!1},_offlineReady:{type:Boolean,state:!0},_needRefresh:{type:Boolean,state:!0},_updateServiceWorker:{type:Function,state:!1}}}constructor(){super(),this._offlineReady=!1,this._needRefresh=!1,this._swActivated=!1,this._period=60*60*1e3,this._updateServiceWorker=void 0}firstUpdated(){this._updateServiceWorker=iY({immediate:!0,onNeedRefresh:()=>this._needRefresh=!0,onRegisteredSW:this._onRegisteredSW})}render(){const e=[];this._offlineReady?e.push("show"):this._needRefresh&&e.push("show","refresh");const t=this._offlineReady?"App ready to work offline":this._needRefresh?"New content available, click on reload button to update":"";return Ie`
            <div
                id="pwa-toast"
                role="alert"
                aria-labelledby="toast-message"
                class=${e.join(" ")}
            >
                <div class="message">
                    <span id="toast-message">${t}</span>
                </div>
                <div class="buttons">
                    <button id="pwa-refresh" type="button" @click=${this._refreshApp}>
                        Reload
                    </button>
                    <button id="pwa-close" type="button" @click=${this._closeBadge}>
                        Close
                    </button>
                </div>
            </div>
    `}_refreshApp(){this._updateServiceWorker&&this._needRefresh&&this._updateServiceWorker()}_closeBadge(){this._offlineReady=!1,this._needRefresh=!1}_onRegisteredSW(e,t){this._period<=0||(t?.active?.state==="activated"?(this._swActivated=!0,this._registerPeriodicSync(e,t)):t?.installing&&t.installing.addEventListener("statechange",n=>{const i=n.target;this._swActivated=i.state==="activated",this._swActivated&&this._registerPeriodicSync(e,t)}))}_registerPeriodicSync(e,t){this._period<=0||setInterval(async()=>{if("onLine"in navigator&&!navigator.onLine)return;(await fetch(e,{cache:"no-store",headers:{cache:"no-store","cache-control":"no-cache"}}))?.status===200&&await t.update()},this._period)}static styles=Ye`
    :host {
      max-width: 0;
      margin: 0;
      padding: 0;
    }

    #pwa-toast {
        visibility: hidden;
        position: fixed;
        right: 0;
        bottom: 0;
        margin: 16px;
        padding: 12px;
        border: 1px solid #8885;
        border-radius: 4px;
        z-index: 1;
        text-align: left;
        box-shadow: 3px 4px 5px 0 #8885;
        display: grid;
    }
    #pwa-toast .message {
        margin-bottom: 8px;
    }
    #pwa-toast .buttons {
        display: flex;
    }
    #pwa-toast button {
        border: 1px solid #8885;
        outline: none;
        margin-right: 5px;
        border-radius: 2px;
        padding: 3px 10px;
    }
    #pwa-toast.show {
        visibility: visible;
    }
    button#pwa-refresh {
        display: none;
    }
    #pwa-toast.show.refresh button#pwa-refresh {
        display: block;
    }
  `}window.customElements.define("pwa-badge",oY);var sY=Ye`
  :host {
    display: inline-block;

    --size: 3rem;
  }

  .avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: var(--size);
    height: var(--size);
    background-color: var(--sl-color-neutral-400);
    font-family: var(--sl-font-sans);
    font-size: calc(var(--size) * 0.5);
    font-weight: var(--sl-font-weight-normal);
    color: var(--sl-color-neutral-0);
    user-select: none;
    -webkit-user-select: none;
    vertical-align: middle;
  }

  .avatar--circle,
  .avatar--circle .avatar__image {
    border-radius: var(--sl-border-radius-circle);
  }

  .avatar--rounded,
  .avatar--rounded .avatar__image {
    border-radius: var(--sl-border-radius-medium);
  }

  .avatar--square {
    border-radius: 0;
  }

  .avatar__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .avatar__initials {
    line-height: 1;
    text-transform: uppercase;
  }

  .avatar__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    overflow: hidden;
  }
`,aP="";function Y6(r){aP=r}function aY(r=""){if(!aP){const e=[...document.getElementsByTagName("script")],t=e.find(n=>n.hasAttribute("data-shoelace"));if(t)Y6(t.getAttribute("data-shoelace"));else{const n=e.find(o=>/shoelace(\.min)?\.js($|\?)/.test(o.src)||/shoelace-autoloader(\.min)?\.js($|\?)/.test(o.src));let i="";n&&(i=n.getAttribute("src")),Y6(i.split("/").slice(0,-1).join("/"))}}return aP.replace(/\/$/,"")+(r?`/${r.replace(/^\//,"")}`:"")}var cY={name:"default",resolver:r=>aY(`assets/icons/${r}.svg`)},lY=cY,Z6={caret:`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  `,check:`
    <svg part="checked-icon" class="checkbox__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g stroke="currentColor">
          <g transform="translate(3.428571, 3.428571)">
            <path d="M0,5.71428571 L3.42857143,9.14285714"></path>
            <path d="M9.14285714,0 L3.42857143,9.14285714"></path>
          </g>
        </g>
      </g>
    </svg>
  `,"chevron-down":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
    </svg>
  `,"chevron-left":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
    </svg>
  `,"chevron-right":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
    </svg>
  `,copy:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/>
    </svg>
  `,eye:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
      <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
      <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
    </svg>
  `,"eye-slash":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
      <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
      <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
      <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
    </svg>
  `,eyedropper:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eyedropper" viewBox="0 0 16 16">
      <path d="M13.354.646a1.207 1.207 0 0 0-1.708 0L8.5 3.793l-.646-.647a.5.5 0 1 0-.708.708L8.293 5l-7.147 7.146A.5.5 0 0 0 1 12.5v1.793l-.854.853a.5.5 0 1 0 .708.707L1.707 15H3.5a.5.5 0 0 0 .354-.146L11 7.707l1.146 1.147a.5.5 0 0 0 .708-.708l-.647-.646 3.147-3.146a1.207 1.207 0 0 0 0-1.708l-2-2zM2 12.707l7-7L10.293 7l-7 7H2v-1.293z"></path>
    </svg>
  `,"grip-vertical":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-grip-vertical" viewBox="0 0 16 16">
      <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
    </svg>
  `,indeterminate:`
    <svg part="indeterminate-icon" class="checkbox__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g stroke="currentColor" stroke-width="2">
          <g transform="translate(2.285714, 6.857143)">
            <path d="M10.2857143,1.14285714 L1.14285714,1.14285714"></path>
          </g>
        </g>
      </g>
    </svg>
  `,"person-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
      <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
    </svg>
  `,"play-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
      <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"></path>
    </svg>
  `,"pause-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-fill" viewBox="0 0 16 16">
      <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"></path>
    </svg>
  `,radio:`
    <svg part="checked-icon" class="radio__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g fill="currentColor">
          <circle cx="8" cy="8" r="3.42857143"></circle>
        </g>
      </g>
    </svg>
  `,"star-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
    </svg>
  `,"x-lg":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
    </svg>
  `,"x-circle-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path>
    </svg>
  `},dY={name:"system",resolver:r=>r in Z6?`data:image/svg+xml,${encodeURIComponent(Z6[r])}`:""},uY=dY,fY=[lY,uY],cP=[];function hY(r){cP.push(r)}function pY(r){cP=cP.filter(e=>e!==r)}function J6(r){return fY.find(e=>e.name===r)}var yY=Ye`
  :host {
    display: inline-block;
    width: 1em;
    height: 1em;
    box-sizing: content-box !important;
  }

  svg {
    display: block;
    height: 100%;
    width: 100%;
  }
`,SL=Object.defineProperty,mY=Object.defineProperties,gY=Object.getOwnPropertyDescriptor,vY=Object.getOwnPropertyDescriptors,X6=Object.getOwnPropertySymbols,bY=Object.prototype.hasOwnProperty,wY=Object.prototype.propertyIsEnumerable,pT=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Q6=(r,e,t)=>e in r?SL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Fu=(r,e)=>{for(var t in e||(e={}))bY.call(e,t)&&Q6(r,t,e[t]);if(X6)for(var t of X6(e))wY.call(e,t)&&Q6(r,t,e[t]);return r},c_=(r,e)=>mY(r,vY(e)),oe=(r,e,t,n)=>{for(var i=n>1?void 0:n?gY(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&SL(e,t,i),i},_Y=function(r,e){this[0]=r,this[1]=e},EY=r=>{var e=r[pT("asyncIterator")],t=!1,n,i={};return e==null?(e=r[pT("iterator")](),n=o=>i[o]=s=>e[o](s)):(e=e.call(r),n=o=>i[o]=s=>{if(t){if(t=!1,o==="throw")throw s;return s}return t=!0,{done:!1,value:new _Y(new Promise(a=>{var l=e[o](s);if(!(l instanceof Object))throw TypeError("Object expected");a(l)}),1)}}),i[pT("iterator")]=()=>i,n("next"),"throw"in e?n("throw"):i.throw=o=>{throw o},"return"in e&&n("return"),i};function Ut(r,e){const t=Fu({waitUntilFirstUpdate:!1},e);return(n,i)=>{const{update:o}=n,s=Array.isArray(r)?r:[r];n.update=function(a){s.forEach(l=>{const d=l;if(a.has(d)){const c=a.get(d),u=this[d];c!==u&&(!t.waitUntilFirstUpdate||this.hasUpdated)&&this[i](c,u)}}),o.call(this,a)}}}var Tr=Ye`
  :host {
    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  [hidden] {
    display: none !important;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const AY={attribute:!0,type:String,converter:kg,reflect:!1,hasChanged:F5},xY=(r=AY,e,t)=>{const{kind:n,metadata:i}=t;let o=globalThis.litPropertyMetadata.get(i);if(o===void 0&&globalThis.litPropertyMetadata.set(i,o=new Map),o.set(t.name,r),n==="accessor"){const{name:s}=t;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(s,l,r)},init(a){return a!==void 0&&this.P(s,void 0,r),a}}}if(n==="setter"){const{name:s}=t;return function(a){const l=this[s];e.call(this,a),this.requestUpdate(s,l,r)}}throw Error("Unsupported decorator location: "+n)};function he(r){return(e,t)=>typeof t=="object"?xY(r,e,t):((n,i,o)=>{const s=i.hasOwnProperty(o);return i.constructor.createProperty(o,s?{...n,wrapped:!0}:n),s?Object.getOwnPropertyDescriptor(i,o):void 0})(r,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ii(r){return he({...r,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function SY(r){return(e,t)=>{const n=typeof e=="function"?e:e[t];Object.assign(n,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const TY=(r,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(r,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Dt(r,e){return(t,n,i)=>{const o=s=>s.renderRoot?.querySelector(r)??null;return TY(t,n,{get(){return o(this)}})}}var pr=class extends hi{constructor(){super(),Object.entries(this.constructor.dependencies).forEach(([r,e])=>{this.constructor.define(r,e)})}emit(r,e){const t=new CustomEvent(r,Fu({bubbles:!0,cancelable:!1,composed:!0,detail:{}},e));return this.dispatchEvent(t),t}static define(r,e=this,t={}){const n=customElements.get(r);if(!n){try{customElements.define(r,e,t)}catch{customElements.define(r,class extends e{},t)}return}let i=" (unknown version)",o=i;"version"in e&&e.version&&(i=" v"+e.version),"version"in n&&n.version&&(o=" v"+n.version),!(i&&o&&i===o)&&console.warn(`Attempted to register <${r}>${i}, but <${r}>${o} has already been registered.`)}};pr.version="2.16.0";pr.dependencies={};oe([he()],pr.prototype,"dir",2);oe([he()],pr.prototype,"lang",2);/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const $Y=(r,e)=>r?._$litType$!==void 0,TL=r=>r.strings===void 0,kY={},PY=(r,e=kY)=>r._$AH=e;var n0=Symbol(),m1=Symbol(),yT,mT=new Map,Bi=class extends pr{constructor(){super(...arguments),this.initialRender=!1,this.svg=null,this.label="",this.library="default"}async resolveIcon(r,e){var t;let n;if(e?.spriteSheet){this.svg=Ie`<svg part="svg">
        <use part="use" href="${r}"></use>
      </svg>`,await this.updateComplete;const i=this.shadowRoot.querySelector("[part='svg']");return typeof e.mutator=="function"&&e.mutator(i),this.svg}try{if(n=await fetch(r,{mode:"cors"}),!n.ok)return n.status===410?n0:m1}catch{return m1}try{const i=document.createElement("div");i.innerHTML=await n.text();const o=i.firstElementChild;if(((t=o?.tagName)==null?void 0:t.toLowerCase())!=="svg")return n0;yT||(yT=new DOMParser);const a=yT.parseFromString(o.outerHTML,"text/html").body.querySelector("svg");return a?(a.part.add("svg"),document.adoptNode(a)):n0}catch{return n0}}connectedCallback(){super.connectedCallback(),hY(this)}firstUpdated(){this.initialRender=!0,this.setIcon()}disconnectedCallback(){super.disconnectedCallback(),pY(this)}getIconSource(){const r=J6(this.library);return this.name&&r?{url:r.resolver(this.name),fromLibrary:!0}:{url:this.src,fromLibrary:!1}}handleLabelChange(){typeof this.label=="string"&&this.label.length>0?(this.setAttribute("role","img"),this.setAttribute("aria-label",this.label),this.removeAttribute("aria-hidden")):(this.removeAttribute("role"),this.removeAttribute("aria-label"),this.setAttribute("aria-hidden","true"))}async setIcon(){var r;const{url:e,fromLibrary:t}=this.getIconSource(),n=t?J6(this.library):void 0;if(!e){this.svg=null;return}let i=mT.get(e);if(i||(i=this.resolveIcon(e,n),mT.set(e,i)),!this.initialRender)return;const o=await i;if(o===m1&&mT.delete(e),e===this.getIconSource().url){if($Y(o)){this.svg=o;return}switch(o){case m1:case n0:this.svg=null,this.emit("sl-error");break;default:this.svg=o.cloneNode(!0),(r=n?.mutator)==null||r.call(n,this.svg),this.emit("sl-load")}}}render(){return this.svg}};Bi.styles=[Tr,yY];oe([ii()],Bi.prototype,"svg",2);oe([he({reflect:!0})],Bi.prototype,"name",2);oe([he()],Bi.prototype,"src",2);oe([he()],Bi.prototype,"label",2);oe([he({reflect:!0})],Bi.prototype,"library",2);oe([Ut("label")],Bi.prototype,"handleLabelChange",1);oe([Ut(["name","src","library"])],Bi.prototype,"setIcon",1);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xd={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},_x=r=>(...e)=>({_$litDirective$:r,values:e});let Ex=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this.t=e,this._$AM=t,this.i=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const br=_x(class extends Ex{constructor(r){if(super(r),r.type!==Xd.ATTRIBUTE||r.name!=="class"||r.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(r){return" "+Object.keys(r).filter(e=>r[e]).join(" ")+" "}update(r,[e]){if(this.st===void 0){this.st=new Set,r.strings!==void 0&&(this.nt=new Set(r.strings.join(" ").split(/\s/).filter(n=>n!=="")));for(const n in e)e[n]&&!this.nt?.has(n)&&this.st.add(n);return this.render(e)}const t=r.element.classList;for(const n of this.st)n in e||(t.remove(n),this.st.delete(n));for(const n in e){const i=!!e[n];i===this.st.has(n)||this.nt?.has(n)||(i?(t.add(n),this.st.add(n)):(t.remove(n),this.st.delete(n)))}return ic}});var sd=class extends pr{constructor(){super(...arguments),this.hasError=!1,this.image="",this.label="",this.initials="",this.loading="eager",this.shape="circle"}handleImageChange(){this.hasError=!1}handleImageLoadError(){this.hasError=!0,this.emit("sl-error")}render(){const r=Ie`
      <img
        part="image"
        class="avatar__image"
        src="${this.image}"
        loading="${this.loading}"
        alt=""
        @error="${this.handleImageLoadError}"
      />
    `;let e=Ie``;return this.initials?e=Ie`<div part="initials" class="avatar__initials">${this.initials}</div>`:e=Ie`
        <div part="icon" class="avatar__icon" aria-hidden="true">
          <slot name="icon">
            <sl-icon name="person-fill" library="system"></sl-icon>
          </slot>
        </div>
      `,Ie`
      <div
        part="base"
        class=${br({avatar:!0,"avatar--circle":this.shape==="circle","avatar--rounded":this.shape==="rounded","avatar--square":this.shape==="square"})}
        role="img"
        aria-label=${this.label}
      >
        ${this.image&&!this.hasError?r:e}
      </div>
    `}};sd.styles=[Tr,sY];sd.dependencies={"sl-icon":Bi};oe([ii()],sd.prototype,"hasError",2);oe([he()],sd.prototype,"image",2);oe([he()],sd.prototype,"label",2);oe([he()],sd.prototype,"initials",2);oe([he()],sd.prototype,"loading",2);oe([he({reflect:!0})],sd.prototype,"shape",2);oe([Ut("image")],sd.prototype,"handleImageChange",1);sd.define("sl-avatar");var IY=Ye`
  :host {
    --track-width: 2px;
    --track-color: rgb(128 128 128 / 25%);
    --indicator-color: var(--sl-color-primary-600);
    --speed: 2s;

    display: inline-flex;
    width: 1em;
    height: 1em;
    flex: none;
  }

  .spinner {
    flex: 1 1 auto;
    height: 100%;
    width: 100%;
  }

  .spinner__track,
  .spinner__indicator {
    fill: none;
    stroke-width: var(--track-width);
    r: calc(0.5em - var(--track-width) / 2);
    cx: 0.5em;
    cy: 0.5em;
    transform-origin: 50% 50%;
  }

  .spinner__track {
    stroke: var(--track-color);
    transform-origin: 0% 0%;
  }

  .spinner__indicator {
    stroke: var(--indicator-color);
    stroke-linecap: round;
    stroke-dasharray: 150% 75%;
    animation: spin var(--speed) linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
      stroke-dasharray: 0.05em, 3em;
    }

    50% {
      transform: rotate(450deg);
      stroke-dasharray: 1.375em, 1.375em;
    }

    100% {
      transform: rotate(1080deg);
      stroke-dasharray: 0.05em, 3em;
    }
  }
`;const lP=new Set,Hm=new Map;let Tp,H5="ltr",G5="en";const $L=typeof MutationObserver<"u"&&typeof document<"u"&&typeof document.documentElement<"u";if($L){const r=new MutationObserver(PL);H5=document.documentElement.dir||"ltr",G5=document.documentElement.lang||navigator.language,r.observe(document.documentElement,{attributes:!0,attributeFilter:["dir","lang"]})}function kL(...r){r.map(e=>{const t=e.$code.toLowerCase();Hm.has(t)?Hm.set(t,Object.assign(Object.assign({},Hm.get(t)),e)):Hm.set(t,e),Tp||(Tp=e)}),PL()}function PL(){$L&&(H5=document.documentElement.dir||"ltr",G5=document.documentElement.lang||navigator.language),[...lP.keys()].map(r=>{typeof r.requestUpdate=="function"&&r.requestUpdate()})}let OY=class{constructor(e){this.host=e,this.host.addController(this)}hostConnected(){lP.add(this.host)}hostDisconnected(){lP.delete(this.host)}dir(){return`${this.host.dir||H5}`.toLowerCase()}lang(){return`${this.host.lang||G5}`.toLowerCase()}getTranslationData(e){var t,n;const i=new Intl.Locale(e.replace(/_/g,"-")),o=i?.language.toLowerCase(),s=(n=(t=i?.region)===null||t===void 0?void 0:t.toLowerCase())!==null&&n!==void 0?n:"",a=Hm.get(`${o}-${s}`),l=Hm.get(o);return{locale:i,language:o,region:s,primary:a,secondary:l}}exists(e,t){var n;const{primary:i,secondary:o}=this.getTranslationData((n=t.lang)!==null&&n!==void 0?n:this.lang());return t=Object.assign({includeFallback:!1},t),!!(i&&i[e]||o&&o[e]||t.includeFallback&&Tp&&Tp[e])}term(e,...t){const{primary:n,secondary:i}=this.getTranslationData(this.lang());let o;if(n&&n[e])o=n[e];else if(i&&i[e])o=i[e];else if(Tp&&Tp[e])o=Tp[e];else return console.error(`No translation found for: ${String(e)}`),String(e);return typeof o=="function"?o(...t):o}date(e,t){return e=new Date(e),new Intl.DateTimeFormat(this.lang(),t).format(e)}number(e,t){return e=Number(e),isNaN(e)?"":new Intl.NumberFormat(this.lang(),t).format(e)}relativeTime(e,t,n){return new Intl.RelativeTimeFormat(this.lang(),n).format(e,t)}};var IL={$code:"en",$name:"English",$dir:"ltr",carousel:"Carousel",clearEntry:"Clear entry",close:"Close",copied:"Copied",copy:"Copy",currentValue:"Current value",error:"Error",goToSlide:(r,e)=>`Go to slide ${r} of ${e}`,hidePassword:"Hide password",loading:"Loading",nextSlide:"Next slide",numOptionsSelected:r=>r===0?"No options selected":r===1?"1 option selected":`${r} options selected`,previousSlide:"Previous slide",progress:"Progress",remove:"Remove",resize:"Resize",scrollToEnd:"Scroll to end",scrollToStart:"Scroll to start",selectAColorFromTheScreen:"Select a color from the screen",showPassword:"Show password",slideNum:r=>`Slide ${r}`,toggleColorFormat:"Toggle color format"};kL(IL);var CY=IL,js=class extends OY{};kL(CY);var Ax=class extends pr{constructor(){super(...arguments),this.localize=new js(this)}render(){return Ie`
      <svg part="base" class="spinner" role="progressbar" aria-label=${this.localize.term("loading")}>
        <circle class="spinner__track"></circle>
        <circle class="spinner__indicator"></circle>
      </svg>
    `}};Ax.styles=[Tr,IY];var i0=new WeakMap,o0=new WeakMap,s0=new WeakMap,gT=new WeakSet,g1=new WeakMap,bv=class{constructor(r,e){this.handleFormData=t=>{const n=this.options.disabled(this.host),i=this.options.name(this.host),o=this.options.value(this.host),s=this.host.tagName.toLowerCase()==="sl-button";this.host.isConnected&&!n&&!s&&typeof i=="string"&&i.length>0&&typeof o<"u"&&(Array.isArray(o)?o.forEach(a=>{t.formData.append(i,a.toString())}):t.formData.append(i,o.toString()))},this.handleFormSubmit=t=>{var n;const i=this.options.disabled(this.host),o=this.options.reportValidity;this.form&&!this.form.noValidate&&((n=i0.get(this.form))==null||n.forEach(s=>{this.setUserInteracted(s,!0)})),this.form&&!this.form.noValidate&&!i&&!o(this.host)&&(t.preventDefault(),t.stopImmediatePropagation())},this.handleFormReset=()=>{this.options.setValue(this.host,this.options.defaultValue(this.host)),this.setUserInteracted(this.host,!1),g1.set(this.host,[])},this.handleInteraction=t=>{const n=g1.get(this.host);n.includes(t.type)||n.push(t.type),n.length===this.options.assumeInteractionOn.length&&this.setUserInteracted(this.host,!0)},this.checkFormValidity=()=>{if(this.form&&!this.form.noValidate){const t=this.form.querySelectorAll("*");for(const n of t)if(typeof n.checkValidity=="function"&&!n.checkValidity())return!1}return!0},this.reportFormValidity=()=>{if(this.form&&!this.form.noValidate){const t=this.form.querySelectorAll("*");for(const n of t)if(typeof n.reportValidity=="function"&&!n.reportValidity())return!1}return!0},(this.host=r).addController(this),this.options=Fu({form:t=>{const n=t.form;if(n){const o=t.getRootNode().querySelector(`#${n}`);if(o)return o}return t.closest("form")},name:t=>t.name,value:t=>t.value,defaultValue:t=>t.defaultValue,disabled:t=>{var n;return(n=t.disabled)!=null?n:!1},reportValidity:t=>typeof t.reportValidity=="function"?t.reportValidity():!0,checkValidity:t=>typeof t.checkValidity=="function"?t.checkValidity():!0,setValue:(t,n)=>t.value=n,assumeInteractionOn:["sl-input"]},e)}hostConnected(){const r=this.options.form(this.host);r&&this.attachForm(r),g1.set(this.host,[]),this.options.assumeInteractionOn.forEach(e=>{this.host.addEventListener(e,this.handleInteraction)})}hostDisconnected(){this.detachForm(),g1.delete(this.host),this.options.assumeInteractionOn.forEach(r=>{this.host.removeEventListener(r,this.handleInteraction)})}hostUpdated(){const r=this.options.form(this.host);r||this.detachForm(),r&&this.form!==r&&(this.detachForm(),this.attachForm(r)),this.host.hasUpdated&&this.setValidity(this.host.validity.valid)}attachForm(r){r?(this.form=r,i0.has(this.form)?i0.get(this.form).add(this.host):i0.set(this.form,new Set([this.host])),this.form.addEventListener("formdata",this.handleFormData),this.form.addEventListener("submit",this.handleFormSubmit),this.form.addEventListener("reset",this.handleFormReset),o0.has(this.form)||(o0.set(this.form,this.form.reportValidity),this.form.reportValidity=()=>this.reportFormValidity()),s0.has(this.form)||(s0.set(this.form,this.form.checkValidity),this.form.checkValidity=()=>this.checkFormValidity())):this.form=void 0}detachForm(){if(!this.form)return;const r=i0.get(this.form);r&&(r.delete(this.host),r.size<=0&&(this.form.removeEventListener("formdata",this.handleFormData),this.form.removeEventListener("submit",this.handleFormSubmit),this.form.removeEventListener("reset",this.handleFormReset),o0.has(this.form)&&(this.form.reportValidity=o0.get(this.form),o0.delete(this.form)),s0.has(this.form)&&(this.form.checkValidity=s0.get(this.form),s0.delete(this.form)),this.form=void 0))}setUserInteracted(r,e){e?gT.add(r):gT.delete(r),r.requestUpdate()}doAction(r,e){if(this.form){const t=document.createElement("button");t.type=r,t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.clipPath="inset(50%)",t.style.overflow="hidden",t.style.whiteSpace="nowrap",e&&(t.name=e.name,t.value=e.value,["formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(n=>{e.hasAttribute(n)&&t.setAttribute(n,e.getAttribute(n))})),this.form.append(t),t.click(),t.remove()}}getForm(){var r;return(r=this.form)!=null?r:null}reset(r){this.doAction("reset",r)}submit(r){this.doAction("submit",r)}setValidity(r){const e=this.host,t=!!gT.has(e),n=!!e.required;e.toggleAttribute("data-required",n),e.toggleAttribute("data-optional",!n),e.toggleAttribute("data-invalid",!r),e.toggleAttribute("data-valid",r),e.toggleAttribute("data-user-invalid",!r&&t),e.toggleAttribute("data-user-valid",r&&t)}updateValidity(){const r=this.host;this.setValidity(r.validity.valid)}emitInvalidEvent(r){const e=new CustomEvent("sl-invalid",{bubbles:!1,composed:!1,cancelable:!0,detail:{}});r||e.preventDefault(),this.host.dispatchEvent(e)||r?.preventDefault()}},xx=Object.freeze({badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:!0,valueMissing:!1}),RY=Object.freeze(c_(Fu({},xx),{valid:!1,valueMissing:!0})),DY=Object.freeze(c_(Fu({},xx),{valid:!1,customError:!0})),OL=Ye`
  :host {
    display: inline-block;
    position: relative;
    width: auto;
    cursor: pointer;
  }

  .button {
    display: inline-flex;
    align-items: stretch;
    justify-content: center;
    width: 100%;
    border-style: solid;
    border-width: var(--sl-input-border-width);
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-font-weight-semibold);
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0;
    transition:
      var(--sl-transition-x-fast) background-color,
      var(--sl-transition-x-fast) color,
      var(--sl-transition-x-fast) border,
      var(--sl-transition-x-fast) box-shadow;
    cursor: inherit;
  }

  .button::-moz-focus-inner {
    border: 0;
  }

  .button:focus {
    outline: none;
  }

  .button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* When disabled, prevent mouse events from bubbling up from children */
  .button--disabled * {
    pointer-events: none;
  }

  .button__prefix,
  .button__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  .button__label {
    display: inline-block;
  }

  .button__label::slotted(sl-icon) {
    vertical-align: -2px;
  }

  /*
   * Standard buttons
   */

  /* Default */
  .button--standard.button--default {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--standard.button--default:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-50);
    border-color: var(--sl-color-primary-300);
    color: var(--sl-color-primary-700);
  }

  .button--standard.button--default:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-100);
    border-color: var(--sl-color-primary-400);
    color: var(--sl-color-primary-700);
  }

  /* Primary */
  .button--standard.button--primary {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--standard.button--success {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:hover:not(.button--disabled) {
    background-color: var(--sl-color-success-500);
    border-color: var(--sl-color-success-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:active:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--standard.button--neutral {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:hover:not(.button--disabled) {
    background-color: var(--sl-color-neutral-500);
    border-color: var(--sl-color-neutral-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:active:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--standard.button--warning {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }
  .button--standard.button--warning:hover:not(.button--disabled) {
    background-color: var(--sl-color-warning-500);
    border-color: var(--sl-color-warning-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--warning:active:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--standard.button--danger {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:hover:not(.button--disabled) {
    background-color: var(--sl-color-danger-500);
    border-color: var(--sl-color-danger-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:active:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  /*
   * Outline buttons
   */

  .button--outline {
    background: none;
    border: solid 1px;
  }

  /* Default */
  .button--outline.button--default {
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--outline.button--default:hover:not(.button--disabled),
  .button--outline.button--default.button--checked:not(.button--disabled) {
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--default:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Primary */
  .button--outline.button--primary {
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-primary-600);
  }

  .button--outline.button--primary:hover:not(.button--disabled),
  .button--outline.button--primary.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--primary:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--outline.button--success {
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-success-600);
  }

  .button--outline.button--success:hover:not(.button--disabled),
  .button--outline.button--success.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--success:active:not(.button--disabled) {
    border-color: var(--sl-color-success-700);
    background-color: var(--sl-color-success-700);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--outline.button--neutral {
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-600);
  }

  .button--outline.button--neutral:hover:not(.button--disabled),
  .button--outline.button--neutral.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--neutral:active:not(.button--disabled) {
    border-color: var(--sl-color-neutral-700);
    background-color: var(--sl-color-neutral-700);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--outline.button--warning {
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-warning-600);
  }

  .button--outline.button--warning:hover:not(.button--disabled),
  .button--outline.button--warning.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--warning:active:not(.button--disabled) {
    border-color: var(--sl-color-warning-700);
    background-color: var(--sl-color-warning-700);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--outline.button--danger {
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-danger-600);
  }

  .button--outline.button--danger:hover:not(.button--disabled),
  .button--outline.button--danger.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--danger:active:not(.button--disabled) {
    border-color: var(--sl-color-danger-700);
    background-color: var(--sl-color-danger-700);
    color: var(--sl-color-neutral-0);
  }

  @media (forced-colors: active) {
    .button.button--outline.button--checked:not(.button--disabled) {
      outline: solid 2px transparent;
    }
  }

  /*
   * Text buttons
   */

  .button--text {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-600);
  }

  .button--text:hover:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:focus-visible:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:active:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-700);
  }

  /*
   * Size modifiers
   */

  .button--small {
    height: auto;
    min-height: var(--sl-input-height-small);
    font-size: var(--sl-button-font-size-small);
    line-height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-small);
  }

  .button--medium {
    height: auto;
    min-height: var(--sl-input-height-medium);
    font-size: var(--sl-button-font-size-medium);
    line-height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-medium);
  }

  .button--large {
    height: auto;
    min-height: var(--sl-input-height-large);
    font-size: var(--sl-button-font-size-large);
    line-height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-large);
  }

  /*
   * Pill modifier
   */

  .button--pill.button--small {
    border-radius: var(--sl-input-height-small);
  }

  .button--pill.button--medium {
    border-radius: var(--sl-input-height-medium);
  }

  .button--pill.button--large {
    border-radius: var(--sl-input-height-large);
  }

  /*
   * Circle modifier
   */

  .button--circle {
    padding-left: 0;
    padding-right: 0;
  }

  .button--circle.button--small {
    width: var(--sl-input-height-small);
    border-radius: 50%;
  }

  .button--circle.button--medium {
    width: var(--sl-input-height-medium);
    border-radius: 50%;
  }

  .button--circle.button--large {
    width: var(--sl-input-height-large);
    border-radius: 50%;
  }

  .button--circle .button__prefix,
  .button--circle .button__suffix,
  .button--circle .button__caret {
    display: none;
  }

  /*
   * Caret modifier
   */

  .button--caret .button__suffix {
    display: none;
  }

  .button--caret .button__caret {
    height: auto;
  }

  /*
   * Loading modifier
   */

  .button--loading {
    position: relative;
    cursor: wait;
  }

  .button--loading .button__prefix,
  .button--loading .button__label,
  .button--loading .button__suffix,
  .button--loading .button__caret {
    visibility: hidden;
  }

  .button--loading sl-spinner {
    --indicator-color: currentColor;
    position: absolute;
    font-size: 1em;
    height: 1em;
    width: 1em;
    top: calc(50% - 0.5em);
    left: calc(50% - 0.5em);
  }

  /*
   * Badges
   */

  .button ::slotted(sl-badge) {
    position: absolute;
    top: 0;
    right: 0;
    translate: 50% -50%;
    pointer-events: none;
  }

  .button--rtl ::slotted(sl-badge) {
    right: auto;
    left: 0;
    translate: -50% -50%;
  }

  /*
   * Button spacing
   */

  .button--has-label.button--small .button__label {
    padding: 0 var(--sl-spacing-small);
  }

  .button--has-label.button--medium .button__label {
    padding: 0 var(--sl-spacing-medium);
  }

  .button--has-label.button--large .button__label {
    padding: 0 var(--sl-spacing-large);
  }

  .button--has-prefix.button--small {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--small .button__label {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--medium {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--medium .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-suffix.button--small,
  .button--caret.button--small {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--small .button__label,
  .button--caret.button--small .button__label {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--medium,
  .button--caret.button--medium {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--medium .button__label,
  .button--caret.button--medium .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large,
  .button--caret.button--large {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large .button__label,
  .button--caret.button--large .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  /*
   * Button groups support a variety of button types (e.g. buttons with tooltips, buttons as dropdown triggers, etc.).
   * This means buttons aren't always direct descendants of the button group, thus we can't target them with the
   * ::slotted selector. To work around this, the button group component does some magic to add these special classes to
   * buttons and we style them here instead.
   */

  :host([data-sl-button-group__button--first]:not([data-sl-button-group__button--last])) .button {
    border-start-end-radius: 0;
    border-end-end-radius: 0;
  }

  :host([data-sl-button-group__button--inner]) .button {
    border-radius: 0;
  }

  :host([data-sl-button-group__button--last]:not([data-sl-button-group__button--first])) .button {
    border-start-start-radius: 0;
    border-end-start-radius: 0;
  }

  /* All except the first */
  :host([data-sl-button-group__button]:not([data-sl-button-group__button--first])) {
    margin-inline-start: calc(-1 * var(--sl-input-border-width));
  }

  /* Add a visual separator between solid buttons */
  :host(
      [data-sl-button-group__button]:not(
          [data-sl-button-group__button--first],
          [data-sl-button-group__button--radio],
          [variant='default']
        ):not(:hover)
    )
    .button:after {
    content: '';
    position: absolute;
    top: 0;
    inset-inline-start: 0;
    bottom: 0;
    border-left: solid 1px rgb(128 128 128 / 33%);
    mix-blend-mode: multiply;
  }

  /* Bump hovered, focused, and checked buttons up so their focus ring isn't clipped */
  :host([data-sl-button-group__button--hover]) {
    z-index: 1;
  }

  /* Focus and checked are always on top */
  :host([data-sl-button-group__button--focus]),
  :host([data-sl-button-group__button][checked]) {
    z-index: 2;
  }
`,fc=class{constructor(r,...e){this.slotNames=[],this.handleSlotChange=t=>{const n=t.target;(this.slotNames.includes("[default]")&&!n.name||n.name&&this.slotNames.includes(n.name))&&this.host.requestUpdate()},(this.host=r).addController(this),this.slotNames=e}hasDefaultSlot(){return[...this.host.childNodes].some(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent.trim()!=="")return!0;if(r.nodeType===r.ELEMENT_NODE){const e=r;if(e.tagName.toLowerCase()==="sl-visually-hidden")return!1;if(!e.hasAttribute("slot"))return!0}return!1})}hasNamedSlot(r){return this.host.querySelector(`:scope > [slot="${r}"]`)!==null}test(r){return r==="[default]"?this.hasDefaultSlot():this.hasNamedSlot(r)}hostConnected(){this.host.shadowRoot.addEventListener("slotchange",this.handleSlotChange)}hostDisconnected(){this.host.shadowRoot.removeEventListener("slotchange",this.handleSlotChange)}};function MY(r){if(!r)return"";const e=r.assignedNodes({flatten:!0});let t="";return[...e].forEach(n=>{n.nodeType===Node.TEXT_NODE&&(t+=n.textContent)}),t}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const CL=Symbol.for(""),BY=r=>{if(r?.r===CL)return r?._$litStatic$},LE=(r,...e)=>({_$litStatic$:e.reduce((t,n,i)=>t+(o=>{if(o._$litStatic$!==void 0)return o._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${o}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(n)+r[i+1],r[0]),r:CL}),e3=new Map,jY=r=>(e,...t)=>{const n=t.length;let i,o;const s=[],a=[];let l,d=0,c=!1;for(;d<n;){for(l=e[d];d<n&&(o=t[d],(i=BY(o))!==void 0);)l+=i+e[++d],c=!0;d!==n&&a.push(o),s.push(l),d++}if(d===n&&s.push(e[n]),c){const u=s.join("$$lit$$");(e=e3.get(u))===void 0&&(s.raw=s,e3.set(u,e=s)),t=a}return r(e,...t)},Mb=jY(Ie);/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ft=r=>r??Ot;var Br=class extends pr{constructor(){super(...arguments),this.formControlController=new bv(this,{assumeInteractionOn:["click"]}),this.hasSlotController=new fc(this,"[default]","prefix","suffix"),this.localize=new js(this),this.hasFocus=!1,this.invalid=!1,this.title="",this.variant="default",this.size="medium",this.caret=!1,this.disabled=!1,this.loading=!1,this.outline=!1,this.pill=!1,this.circle=!1,this.type="button",this.name="",this.value="",this.href="",this.rel="noreferrer noopener"}get validity(){return this.isButton()?this.button.validity:xx}get validationMessage(){return this.isButton()?this.button.validationMessage:""}firstUpdated(){this.isButton()&&this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(){this.type==="submit"&&this.formControlController.submit(this),this.type==="reset"&&this.formControlController.reset(this)}handleInvalid(r){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(r)}isButton(){return!this.href}isLink(){return!!this.href}handleDisabledChange(){this.isButton()&&this.formControlController.setValidity(this.disabled)}click(){this.button.click()}focus(r){this.button.focus(r)}blur(){this.button.blur()}checkValidity(){return this.isButton()?this.button.checkValidity():!0}getForm(){return this.formControlController.getForm()}reportValidity(){return this.isButton()?this.button.reportValidity():!0}setCustomValidity(r){this.isButton()&&(this.button.setCustomValidity(r),this.formControlController.updateValidity())}render(){const r=this.isLink(),e=r?LE`a`:LE`button`;return Mb`
      <${e}
        part="base"
        class=${br({button:!0,"button--default":this.variant==="default","button--primary":this.variant==="primary","button--success":this.variant==="success","button--neutral":this.variant==="neutral","button--warning":this.variant==="warning","button--danger":this.variant==="danger","button--text":this.variant==="text","button--small":this.size==="small","button--medium":this.size==="medium","button--large":this.size==="large","button--caret":this.caret,"button--circle":this.circle,"button--disabled":this.disabled,"button--focused":this.hasFocus,"button--loading":this.loading,"button--standard":!this.outline,"button--outline":this.outline,"button--pill":this.pill,"button--rtl":this.localize.dir()==="rtl","button--has-label":this.hasSlotController.test("[default]"),"button--has-prefix":this.hasSlotController.test("prefix"),"button--has-suffix":this.hasSlotController.test("suffix")})}
        ?disabled=${ft(r?void 0:this.disabled)}
        type=${ft(r?void 0:this.type)}
        title=${this.title}
        name=${ft(r?void 0:this.name)}
        value=${ft(r?void 0:this.value)}
        href=${ft(r?this.href:void 0)}
        target=${ft(r?this.target:void 0)}
        download=${ft(r?this.download:void 0)}
        rel=${ft(r?this.rel:void 0)}
        role=${ft(r?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @invalid=${this.isButton()?this.handleInvalid:null}
        @click=${this.handleClick}
      >
        <slot name="prefix" part="prefix" class="button__prefix"></slot>
        <slot part="label" class="button__label"></slot>
        <slot name="suffix" part="suffix" class="button__suffix"></slot>
        ${this.caret?Mb` <sl-icon part="caret" class="button__caret" library="system" name="caret"></sl-icon> `:""}
        ${this.loading?Mb`<sl-spinner part="spinner"></sl-spinner>`:""}
      </${e}>
    `}};Br.styles=[Tr,OL];Br.dependencies={"sl-icon":Bi,"sl-spinner":Ax};oe([Dt(".button")],Br.prototype,"button",2);oe([ii()],Br.prototype,"hasFocus",2);oe([ii()],Br.prototype,"invalid",2);oe([he()],Br.prototype,"title",2);oe([he({reflect:!0})],Br.prototype,"variant",2);oe([he({reflect:!0})],Br.prototype,"size",2);oe([he({type:Boolean,reflect:!0})],Br.prototype,"caret",2);oe([he({type:Boolean,reflect:!0})],Br.prototype,"disabled",2);oe([he({type:Boolean,reflect:!0})],Br.prototype,"loading",2);oe([he({type:Boolean,reflect:!0})],Br.prototype,"outline",2);oe([he({type:Boolean,reflect:!0})],Br.prototype,"pill",2);oe([he({type:Boolean,reflect:!0})],Br.prototype,"circle",2);oe([he()],Br.prototype,"type",2);oe([he()],Br.prototype,"name",2);oe([he()],Br.prototype,"value",2);oe([he()],Br.prototype,"href",2);oe([he()],Br.prototype,"target",2);oe([he()],Br.prototype,"rel",2);oe([he()],Br.prototype,"download",2);oe([he()],Br.prototype,"form",2);oe([he({attribute:"formaction"})],Br.prototype,"formAction",2);oe([he({attribute:"formenctype"})],Br.prototype,"formEnctype",2);oe([he({attribute:"formmethod"})],Br.prototype,"formMethod",2);oe([he({attribute:"formnovalidate",type:Boolean})],Br.prototype,"formNoValidate",2);oe([he({attribute:"formtarget"})],Br.prototype,"formTarget",2);oe([Ut("disabled",{waitUntilFirstUpdate:!0})],Br.prototype,"handleDisabledChange",1);Br.define("sl-button");var NY=Ye`
  :host {
    display: inline-block;
  }

  .button-group {
    display: flex;
    flex-wrap: nowrap;
  }
`,wv=class extends pr{constructor(){super(...arguments),this.disableRole=!1,this.label=""}handleFocus(r){const e=a0(r.target);e?.toggleAttribute("data-sl-button-group__button--focus",!0)}handleBlur(r){const e=a0(r.target);e?.toggleAttribute("data-sl-button-group__button--focus",!1)}handleMouseOver(r){const e=a0(r.target);e?.toggleAttribute("data-sl-button-group__button--hover",!0)}handleMouseOut(r){const e=a0(r.target);e?.toggleAttribute("data-sl-button-group__button--hover",!1)}handleSlotChange(){const r=[...this.defaultSlot.assignedElements({flatten:!0})];r.forEach(e=>{const t=r.indexOf(e),n=a0(e);n&&(n.toggleAttribute("data-sl-button-group__button",!0),n.toggleAttribute("data-sl-button-group__button--first",t===0),n.toggleAttribute("data-sl-button-group__button--inner",t>0&&t<r.length-1),n.toggleAttribute("data-sl-button-group__button--last",t===r.length-1),n.toggleAttribute("data-sl-button-group__button--radio",n.tagName.toLowerCase()==="sl-radio-button"))})}render(){return Ie`
      <div
        part="base"
        class="button-group"
        role="${this.disableRole?"presentation":"group"}"
        aria-label=${this.label}
        @focusout=${this.handleBlur}
        @focusin=${this.handleFocus}
        @mouseover=${this.handleMouseOver}
        @mouseout=${this.handleMouseOut}
      >
        <slot @slotchange=${this.handleSlotChange}></slot>
      </div>
    `}};wv.styles=[Tr,NY];oe([Dt("slot")],wv.prototype,"defaultSlot",2);oe([ii()],wv.prototype,"disableRole",2);oe([he()],wv.prototype,"label",2);function a0(r){var e;const t="sl-button, sl-radio-button";return(e=r.closest(t))!=null?e:r.querySelector(t)}wv.define("sl-button-group");var UY=Ye`
  :host {
    display: inline-flex;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: max(12px, 0.75em);
    font-weight: var(--sl-font-weight-semibold);
    letter-spacing: var(--sl-letter-spacing-normal);
    line-height: 1;
    border-radius: var(--sl-border-radius-small);
    border: solid 1px var(--sl-color-neutral-0);
    white-space: nowrap;
    padding: 0.35em 0.6em;
    user-select: none;
    -webkit-user-select: none;
    cursor: inherit;
  }

  /* Variant modifiers */
  .badge--primary {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--success {
    background-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--neutral {
    background-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--warning {
    background-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  .badge--danger {
    background-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  /* Pill modifier */
  .badge--pill {
    border-radius: var(--sl-border-radius-pill);
  }

  /* Pulse modifier */
  .badge--pulse {
    animation: pulse 1.5s infinite;
  }

  .badge--pulse.badge--primary {
    --pulse-color: var(--sl-color-primary-600);
  }

  .badge--pulse.badge--success {
    --pulse-color: var(--sl-color-success-600);
  }

  .badge--pulse.badge--neutral {
    --pulse-color: var(--sl-color-neutral-600);
  }

  .badge--pulse.badge--warning {
    --pulse-color: var(--sl-color-warning-600);
  }

  .badge--pulse.badge--danger {
    --pulse-color: var(--sl-color-danger-600);
  }

  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 var(--pulse-color);
    }
    70% {
      box-shadow: 0 0 0 0.5rem transparent;
    }
    100% {
      box-shadow: 0 0 0 0 transparent;
    }
  }
`,l_=class extends pr{constructor(){super(...arguments),this.variant="primary",this.pill=!1,this.pulse=!1}render(){return Ie`
      <span
        part="base"
        class=${br({badge:!0,"badge--primary":this.variant==="primary","badge--success":this.variant==="success","badge--neutral":this.variant==="neutral","badge--warning":this.variant==="warning","badge--danger":this.variant==="danger","badge--pill":this.pill,"badge--pulse":this.pulse})}
        role="status"
      >
        <slot></slot>
      </span>
    `}};l_.styles=[Tr,UY];oe([he({reflect:!0})],l_.prototype,"variant",2);oe([he({type:Boolean,reflect:!0})],l_.prototype,"pill",2);oe([he({type:Boolean,reflect:!0})],l_.prototype,"pulse",2);l_.define("sl-badge");var LY=Ye`
  :host {
    --border-color: var(--sl-color-neutral-200);
    --border-radius: var(--sl-border-radius-medium);
    --border-width: 1px;
    --padding: var(--sl-spacing-large);

    display: inline-block;
  }

  .card {
    display: flex;
    flex-direction: column;
    background-color: var(--sl-panel-background-color);
    box-shadow: var(--sl-shadow-x-small);
    border: solid var(--border-width) var(--border-color);
    border-radius: var(--border-radius);
  }

  .card__image {
    display: flex;
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
    margin: calc(-1 * var(--border-width));
    overflow: hidden;
  }

  .card__image::slotted(img) {
    display: block;
    width: 100%;
  }

  .card:not(.card--has-image) .card__image {
    display: none;
  }

  .card__header {
    display: block;
    border-bottom: solid var(--border-width) var(--border-color);
    padding: calc(var(--padding) / 2) var(--padding);
  }

  .card:not(.card--has-header) .card__header {
    display: none;
  }

  .card:not(.card--has-image) .card__header {
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
  }

  .card__body {
    display: block;
    padding: var(--padding);
  }

  .card--has-footer .card__footer {
    display: block;
    border-top: solid var(--border-width) var(--border-color);
    padding: var(--padding);
  }

  .card:not(.card--has-footer) .card__footer {
    display: none;
  }
`,RL=class extends pr{constructor(){super(...arguments),this.hasSlotController=new fc(this,"footer","header","image")}render(){return Ie`
      <div
        part="base"
        class=${br({card:!0,"card--has-footer":this.hasSlotController.test("footer"),"card--has-image":this.hasSlotController.test("image"),"card--has-header":this.hasSlotController.test("header")})}
      >
        <slot name="image" part="image" class="card__image"></slot>
        <slot name="header" part="header" class="card__header"></slot>
        <slot part="body" class="card__body"></slot>
        <slot name="footer" part="footer" class="card__footer"></slot>
      </div>
    `}};RL.styles=[Tr,LY];RL.define("sl-card");var KY=Ye`
  :host {
    --max-width: 20rem;
    --hide-delay: 0ms;
    --show-delay: 150ms;

    display: contents;
  }

  .tooltip {
    --arrow-size: var(--sl-tooltip-arrow-size);
    --arrow-color: var(--sl-tooltip-background-color);
  }

  .tooltip::part(popup) {
    z-index: var(--sl-z-index-tooltip);
  }

  .tooltip[placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  .tooltip[placement^='bottom']::part(popup) {
    transform-origin: top;
  }

  .tooltip[placement^='left']::part(popup) {
    transform-origin: right;
  }

  .tooltip[placement^='right']::part(popup) {
    transform-origin: left;
  }

  .tooltip__body {
    display: block;
    width: max-content;
    max-width: var(--max-width);
    border-radius: var(--sl-tooltip-border-radius);
    background-color: var(--sl-tooltip-background-color);
    font-family: var(--sl-tooltip-font-family);
    font-size: var(--sl-tooltip-font-size);
    font-weight: var(--sl-tooltip-font-weight);
    line-height: var(--sl-tooltip-line-height);
    text-align: start;
    white-space: normal;
    color: var(--sl-tooltip-color);
    padding: var(--sl-tooltip-padding);
    pointer-events: none;
    user-select: none;
    -webkit-user-select: none;
  }
`,zY=Ye`
  :host {
    --arrow-color: var(--sl-color-neutral-1000);
    --arrow-size: 6px;

    /*
     * These properties are computed to account for the arrow's dimensions after being rotated 45. The constant
     * 0.7071 is derived from sin(45), which is the diagonal size of the arrow's container after rotating.
     */
    --arrow-size-diagonal: calc(var(--arrow-size) * 0.7071);
    --arrow-padding-offset: calc(var(--arrow-size-diagonal) - var(--arrow-size));

    display: contents;
  }

  .popup {
    position: absolute;
    isolation: isolate;
    max-width: var(--auto-size-available-width, none);
    max-height: var(--auto-size-available-height, none);
  }

  .popup--fixed {
    position: fixed;
  }

  .popup:not(.popup--active) {
    display: none;
  }

  .popup__arrow {
    position: absolute;
    width: calc(var(--arrow-size-diagonal) * 2);
    height: calc(var(--arrow-size-diagonal) * 2);
    rotate: 45deg;
    background: var(--arrow-color);
    z-index: -1;
  }

  /* Hover bridge */
  .popup-hover-bridge:not(.popup-hover-bridge--visible) {
    display: none;
  }

  .popup-hover-bridge {
    position: fixed;
    z-index: calc(var(--sl-z-index-dropdown) - 1);
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    clip-path: polygon(
      var(--hover-bridge-top-left-x, 0) var(--hover-bridge-top-left-y, 0),
      var(--hover-bridge-top-right-x, 0) var(--hover-bridge-top-right-y, 0),
      var(--hover-bridge-bottom-right-x, 0) var(--hover-bridge-bottom-right-y, 0),
      var(--hover-bridge-bottom-left-x, 0) var(--hover-bridge-bottom-left-y, 0)
    );
  }
`;const Nl=Math.min,ua=Math.max,KE=Math.round,v1=Math.floor,wh=r=>({x:r,y:r}),FY={left:"right",right:"left",bottom:"top",top:"bottom"},qY={start:"end",end:"start"};function dP(r,e,t){return ua(r,Nl(e,t))}function _v(r,e){return typeof r=="function"?r(e):r}function _h(r){return r.split("-")[0]}function Ev(r){return r.split("-")[1]}function DL(r){return r==="x"?"y":"x"}function Y5(r){return r==="y"?"height":"width"}function Sy(r){return["top","bottom"].includes(_h(r))?"y":"x"}function Z5(r){return DL(Sy(r))}function VY(r,e,t){t===void 0&&(t=!1);const n=Ev(r),i=Z5(r),o=Y5(i);let s=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=zE(s)),[s,zE(s)]}function WY(r){const e=zE(r);return[uP(r),e,uP(e)]}function uP(r){return r.replace(/start|end/g,e=>qY[e])}function HY(r,e,t){const n=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(r){case"top":case"bottom":return t?e?i:n:e?n:i;case"left":case"right":return e?o:s;default:return[]}}function GY(r,e,t,n){const i=Ev(r);let o=HY(_h(r),t==="start",n);return i&&(o=o.map(s=>s+"-"+i),e&&(o=o.concat(o.map(uP)))),o}function zE(r){return r.replace(/left|right|bottom|top/g,e=>FY[e])}function YY(r){return{top:0,right:0,bottom:0,left:0,...r}}function ML(r){return typeof r!="number"?YY(r):{top:r,right:r,bottom:r,left:r}}function FE(r){const{x:e,y:t,width:n,height:i}=r;return{width:n,height:i,top:t,left:e,right:e+n,bottom:t+i,x:e,y:t}}function t3(r,e,t){let{reference:n,floating:i}=r;const o=Sy(e),s=Z5(e),a=Y5(s),l=_h(e),d=o==="y",c=n.x+n.width/2-i.width/2,u=n.y+n.height/2-i.height/2,f=n[a]/2-i[a]/2;let h;switch(l){case"top":h={x:c,y:n.y-i.height};break;case"bottom":h={x:c,y:n.y+n.height};break;case"right":h={x:n.x+n.width,y:u};break;case"left":h={x:n.x-i.width,y:u};break;default:h={x:n.x,y:n.y}}switch(Ev(e)){case"start":h[s]-=f*(t&&d?-1:1);break;case"end":h[s]+=f*(t&&d?-1:1);break}return h}const ZY=async(r,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:o=[],platform:s}=t,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let d=await s.getElementRects({reference:r,floating:e,strategy:i}),{x:c,y:u}=t3(d,n,l),f=n,h={},p=0;for(let y=0;y<a.length;y++){const{name:g,fn:w}=a[y],{x:v,y:m,data:b,reset:_}=await w({x:c,y:u,initialPlacement:n,placement:f,strategy:i,middlewareData:h,rects:d,platform:s,elements:{reference:r,floating:e}});c=v??c,u=m??u,h={...h,[g]:{...h[g],...b}},_&&p<=50&&(p++,typeof _=="object"&&(_.placement&&(f=_.placement),_.rects&&(d=_.rects===!0?await s.getElementRects({reference:r,floating:e,strategy:i}):_.rects),{x:c,y:u}=t3(d,f,l)),y=-1)}return{x:c,y:u,placement:f,strategy:i,middlewareData:h}};async function J5(r,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:o,rects:s,elements:a,strategy:l}=r,{boundary:d="clippingAncestors",rootBoundary:c="viewport",elementContext:u="floating",altBoundary:f=!1,padding:h=0}=_v(e,r),p=ML(h),g=a[f?u==="floating"?"reference":"floating":u],w=FE(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(g)))==null||t?g:g.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:d,rootBoundary:c,strategy:l})),v=u==="floating"?{x:n,y:i,width:s.floating.width,height:s.floating.height}:s.reference,m=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),b=await(o.isElement==null?void 0:o.isElement(m))?await(o.getScale==null?void 0:o.getScale(m))||{x:1,y:1}:{x:1,y:1},_=FE(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:m,strategy:l}):v);return{top:(w.top-_.top+p.top)/b.y,bottom:(_.bottom-w.bottom+p.bottom)/b.y,left:(w.left-_.left+p.left)/b.x,right:(_.right-w.right+p.right)/b.x}}const JY=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=e,{element:d,padding:c=0}=_v(r,e)||{};if(d==null)return{};const u=ML(c),f={x:t,y:n},h=Z5(i),p=Y5(h),y=await s.getDimensions(d),g=h==="y",w=g?"top":"left",v=g?"bottom":"right",m=g?"clientHeight":"clientWidth",b=o.reference[p]+o.reference[h]-f[h]-o.floating[p],_=f[h]-o.reference[h],E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(d));let S=E?E[m]:0;(!S||!await(s.isElement==null?void 0:s.isElement(E)))&&(S=a.floating[m]||o.floating[p]);const T=b/2-_/2,O=S/2-y[p]/2-1,M=Nl(u[w],O),Q=Nl(u[v],O),W=M,U=S-y[p]-Q,ee=S/2-y[p]/2+T,R=dP(W,ee,U),z=!l.arrow&&Ev(i)!=null&&ee!==R&&o.reference[p]/2-(ee<W?M:Q)-y[p]/2<0,K=z?ee<W?ee-W:ee-U:0;return{[h]:f[h]+K,data:{[h]:R,centerOffset:ee-R-K,...z&&{alignmentOffset:K}},reset:z}}}),XY=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:d}=e,{mainAxis:c=!0,crossAxis:u=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:y=!0,...g}=_v(r,e);if((t=o.arrow)!=null&&t.alignmentOffset)return{};const w=_h(i),v=Sy(a),m=_h(a)===a,b=await(l.isRTL==null?void 0:l.isRTL(d.floating)),_=f||(m||!y?[zE(a)]:WY(a)),E=p!=="none";!f&&E&&_.push(...GY(a,y,p,b));const S=[a,..._],T=await J5(e,g),O=[];let M=((n=o.flip)==null?void 0:n.overflows)||[];if(c&&O.push(T[w]),u){const ee=VY(i,s,b);O.push(T[ee[0]],T[ee[1]])}if(M=[...M,{placement:i,overflows:O}],!O.every(ee=>ee<=0)){var Q,W;const ee=(((Q=o.flip)==null?void 0:Q.index)||0)+1,R=S[ee];if(R)return{data:{index:ee,overflows:M},reset:{placement:R}};let z=(W=M.filter(K=>K.overflows[0]<=0).sort((K,Y)=>K.overflows[1]-Y.overflows[1])[0])==null?void 0:W.placement;if(!z)switch(h){case"bestFit":{var U;const K=(U=M.filter(Y=>{if(E){const I=Sy(Y.placement);return I===v||I==="y"}return!0}).map(Y=>[Y.placement,Y.overflows.filter(I=>I>0).reduce((I,D)=>I+D,0)]).sort((Y,I)=>Y[1]-I[1])[0])==null?void 0:U[0];K&&(z=K);break}case"initialPlacement":z=a;break}if(i!==z)return{reset:{placement:z}}}return{}}}};async function QY(r,e){const{placement:t,platform:n,elements:i}=r,o=await(n.isRTL==null?void 0:n.isRTL(i.floating)),s=_h(t),a=Ev(t),l=Sy(t)==="y",d=["left","top"].includes(s)?-1:1,c=o&&l?-1:1,u=_v(e,r);let{mainAxis:f,crossAxis:h,alignmentAxis:p}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return a&&typeof p=="number"&&(h=a==="end"?p*-1:p),l?{x:h*c,y:f*d}:{x:f*d,y:h*c}}const eZ=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:i,y:o,placement:s,middlewareData:a}=e,l=await QY(e,r);return s===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},tZ=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:g=>{let{x:w,y:v}=g;return{x:w,y:v}}},...l}=_v(r,e),d={x:t,y:n},c=await J5(e,l),u=Sy(_h(i)),f=DL(u);let h=d[f],p=d[u];if(o){const g=f==="y"?"top":"left",w=f==="y"?"bottom":"right",v=h+c[g],m=h-c[w];h=dP(v,h,m)}if(s){const g=u==="y"?"top":"left",w=u==="y"?"bottom":"right",v=p+c[g],m=p-c[w];p=dP(v,p,m)}const y=a.fn({...e,[f]:h,[u]:p});return{...y,data:{x:y.x-t,y:y.y-n}}}}},rZ=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){const{placement:t,rects:n,platform:i,elements:o}=e,{apply:s=()=>{},...a}=_v(r,e),l=await J5(e,a),d=_h(t),c=Ev(t),u=Sy(t)==="y",{width:f,height:h}=n.floating;let p,y;d==="top"||d==="bottom"?(p=d,y=c===(await(i.isRTL==null?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(y=d,p=c==="end"?"top":"bottom");const g=h-l.top-l.bottom,w=f-l.left-l.right,v=Nl(h-l[p],g),m=Nl(f-l[y],w),b=!e.middlewareData.shift;let _=v,E=m;if(u?E=c||b?Nl(m,w):w:_=c||b?Nl(v,g):g,b&&!c){const T=ua(l.left,0),O=ua(l.right,0),M=ua(l.top,0),Q=ua(l.bottom,0);u?E=f-2*(T!==0||O!==0?T+O:ua(l.left,l.right)):_=h-2*(M!==0||Q!==0?M+Q:ua(l.top,l.bottom))}await s({...e,availableWidth:E,availableHeight:_});const S=await i.getDimensions(o.floating);return f!==S.width||h!==S.height?{reset:{rects:!0}}:{}}}};function Av(r){return BL(r)?(r.nodeName||"").toLowerCase():"#document"}function wa(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function qu(r){var e;return(e=(BL(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function BL(r){return r instanceof Node||r instanceof wa(r).Node}function Vc(r){return r instanceof Element||r instanceof wa(r).Element}function Jl(r){return r instanceof HTMLElement||r instanceof wa(r).HTMLElement}function r3(r){return typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof wa(r).ShadowRoot}function d_(r){const{overflow:e,overflowX:t,overflowY:n,display:i}=Wc(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(i)}function nZ(r){return["table","td","th"].includes(Av(r))}function Sx(r){return[":popover-open",":modal"].some(e=>{try{return r.matches(e)}catch{return!1}})}function X5(r){const e=Q5(),t=Vc(r)?Wc(r):r;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function iZ(r){let e=Eh(r);for(;Jl(e)&&!Ig(e);){if(X5(e))return e;if(Sx(e))return null;e=Eh(e)}return null}function Q5(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Ig(r){return["html","body","#document"].includes(Av(r))}function Wc(r){return wa(r).getComputedStyle(r)}function Tx(r){return Vc(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Eh(r){if(Av(r)==="html")return r;const e=r.assignedSlot||r.parentNode||r3(r)&&r.host||qu(r);return r3(e)?e.host:e}function jL(r){const e=Eh(r);return Ig(e)?r.ownerDocument?r.ownerDocument.body:r.body:Jl(e)&&d_(e)?e:jL(e)}function pw(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=jL(r),o=i===((n=r.ownerDocument)==null?void 0:n.body),s=wa(i);if(o){const a=fP(s);return e.concat(s,s.visualViewport||[],d_(i)?i:[],a&&t?pw(a):[])}return e.concat(i,pw(i,[],t))}function fP(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function NL(r){const e=Wc(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=Jl(r),o=i?r.offsetWidth:t,s=i?r.offsetHeight:n,a=KE(t)!==o||KE(n)!==s;return a&&(t=o,n=s),{width:t,height:n,$:a}}function eO(r){return Vc(r)?r:r.contextElement}function rg(r){const e=eO(r);if(!Jl(e))return wh(1);const t=e.getBoundingClientRect(),{width:n,height:i,$:o}=NL(e);let s=(o?KE(t.width):t.width)/n,a=(o?KE(t.height):t.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const oZ=wh(0);function UL(r){const e=wa(r);return!Q5()||!e.visualViewport?oZ:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function sZ(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==wa(r)?!1:e}function Ty(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=r.getBoundingClientRect(),o=eO(r);let s=wh(1);e&&(n?Vc(n)&&(s=rg(n)):s=rg(r));const a=sZ(o,t,n)?UL(o):wh(0);let l=(i.left+a.x)/s.x,d=(i.top+a.y)/s.y,c=i.width/s.x,u=i.height/s.y;if(o){const f=wa(o),h=n&&Vc(n)?wa(n):n;let p=f,y=fP(p);for(;y&&n&&h!==p;){const g=rg(y),w=y.getBoundingClientRect(),v=Wc(y),m=w.left+(y.clientLeft+parseFloat(v.paddingLeft))*g.x,b=w.top+(y.clientTop+parseFloat(v.paddingTop))*g.y;l*=g.x,d*=g.y,c*=g.x,u*=g.y,l+=m,d+=b,p=wa(y),y=fP(p)}}return FE({width:c,height:u,x:l,y:d})}function aZ(r){let{elements:e,rect:t,offsetParent:n,strategy:i}=r;const o=i==="fixed",s=qu(n),a=e?Sx(e.floating):!1;if(n===s||a&&o)return t;let l={scrollLeft:0,scrollTop:0},d=wh(1);const c=wh(0),u=Jl(n);if((u||!u&&!o)&&((Av(n)!=="body"||d_(s))&&(l=Tx(n)),Jl(n))){const f=Ty(n);d=rg(n),c.x=f.x+n.clientLeft,c.y=f.y+n.clientTop}return{width:t.width*d.x,height:t.height*d.y,x:t.x*d.x-l.scrollLeft*d.x+c.x,y:t.y*d.y-l.scrollTop*d.y+c.y}}function cZ(r){return Array.from(r.getClientRects())}function LL(r){return Ty(qu(r)).left+Tx(r).scrollLeft}function lZ(r){const e=qu(r),t=Tx(r),n=r.ownerDocument.body,i=ua(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),o=ua(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let s=-t.scrollLeft+LL(r);const a=-t.scrollTop;return Wc(n).direction==="rtl"&&(s+=ua(e.clientWidth,n.clientWidth)-i),{width:i,height:o,x:s,y:a}}function dZ(r,e){const t=wa(r),n=qu(r),i=t.visualViewport;let o=n.clientWidth,s=n.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const d=Q5();(!d||d&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function uZ(r,e){const t=Ty(r,!0,e==="fixed"),n=t.top+r.clientTop,i=t.left+r.clientLeft,o=Jl(r)?rg(r):wh(1),s=r.clientWidth*o.x,a=r.clientHeight*o.y,l=i*o.x,d=n*o.y;return{width:s,height:a,x:l,y:d}}function n3(r,e,t){let n;if(e==="viewport")n=dZ(r,t);else if(e==="document")n=lZ(qu(r));else if(Vc(e))n=uZ(e,t);else{const i=UL(r);n={...e,x:e.x-i.x,y:e.y-i.y}}return FE(n)}function KL(r,e){const t=Eh(r);return t===e||!Vc(t)||Ig(t)?!1:Wc(t).position==="fixed"||KL(t,e)}function fZ(r,e){const t=e.get(r);if(t)return t;let n=pw(r,[],!1).filter(a=>Vc(a)&&Av(a)!=="body"),i=null;const o=Wc(r).position==="fixed";let s=o?Eh(r):r;for(;Vc(s)&&!Ig(s);){const a=Wc(s),l=X5(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||d_(s)&&!l&&KL(r,s))?n=n.filter(c=>c!==s):i=a,s=Eh(s)}return e.set(r,n),n}function hZ(r){let{element:e,boundary:t,rootBoundary:n,strategy:i}=r;const s=[...t==="clippingAncestors"?Sx(e)?[]:fZ(e,this._c):[].concat(t),n],a=s[0],l=s.reduce((d,c)=>{const u=n3(e,c,i);return d.top=ua(u.top,d.top),d.right=Nl(u.right,d.right),d.bottom=Nl(u.bottom,d.bottom),d.left=ua(u.left,d.left),d},n3(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function pZ(r){const{width:e,height:t}=NL(r);return{width:e,height:t}}function yZ(r,e,t){const n=Jl(e),i=qu(e),o=t==="fixed",s=Ty(r,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=wh(0);if(n||!n&&!o)if((Av(e)!=="body"||d_(i))&&(a=Tx(e)),n){const u=Ty(e,!0,o,e);l.x=u.x+e.clientLeft,l.y=u.y+e.clientTop}else i&&(l.x=LL(i));const d=s.left+a.scrollLeft-l.x,c=s.top+a.scrollTop-l.y;return{x:d,y:c,width:s.width,height:s.height}}function vT(r){return Wc(r).position==="static"}function i3(r,e){return!Jl(r)||Wc(r).position==="fixed"?null:e?e(r):r.offsetParent}function zL(r,e){const t=wa(r);if(Sx(r))return t;if(!Jl(r)){let i=Eh(r);for(;i&&!Ig(i);){if(Vc(i)&&!vT(i))return i;i=Eh(i)}return t}let n=i3(r,e);for(;n&&nZ(n)&&vT(n);)n=i3(n,e);return n&&Ig(n)&&vT(n)&&!X5(n)?t:n||iZ(r)||t}const mZ=async function(r){const e=this.getOffsetParent||zL,t=this.getDimensions,n=await t(r.floating);return{reference:yZ(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function gZ(r){return Wc(r).direction==="rtl"}const W2={convertOffsetParentRelativeRectToViewportRelativeRect:aZ,getDocumentElement:qu,getClippingRect:hZ,getOffsetParent:zL,getElementRects:mZ,getClientRects:cZ,getDimensions:pZ,getScale:rg,isElement:Vc,isRTL:gZ};function vZ(r,e){let t=null,n;const i=qu(r);function o(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:d,top:c,width:u,height:f}=r.getBoundingClientRect();if(a||e(),!u||!f)return;const h=v1(c),p=v1(i.clientWidth-(d+u)),y=v1(i.clientHeight-(c+f)),g=v1(d),v={rootMargin:-h+"px "+-p+"px "+-y+"px "+-g+"px",threshold:ua(0,Nl(1,l))||1};let m=!0;function b(_){const E=_[0].intersectionRatio;if(E!==l){if(!m)return s();E?s(!1,E):n=setTimeout(()=>{s(!1,1e-7)},1e3)}m=!1}try{t=new IntersectionObserver(b,{...v,root:i.ownerDocument})}catch{t=new IntersectionObserver(b,v)}t.observe(r)}return s(!0),o}function bZ(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,d=eO(r),c=i||o?[...d?pw(d):[],...pw(e)]:[];c.forEach(w=>{i&&w.addEventListener("scroll",t,{passive:!0}),o&&w.addEventListener("resize",t)});const u=d&&a?vZ(d,t):null;let f=-1,h=null;s&&(h=new ResizeObserver(w=>{let[v]=w;v&&v.target===d&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var m;(m=h)==null||m.observe(e)})),t()}),d&&!l&&h.observe(d),h.observe(e));let p,y=l?Ty(r):null;l&&g();function g(){const w=Ty(r);y&&(w.x!==y.x||w.y!==y.y||w.width!==y.width||w.height!==y.height)&&t(),y=w,p=requestAnimationFrame(g)}return t(),()=>{var w;c.forEach(v=>{i&&v.removeEventListener("scroll",t),o&&v.removeEventListener("resize",t)}),u?.(),(w=h)==null||w.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const wZ=eZ,_Z=tZ,EZ=XY,o3=rZ,AZ=JY,xZ=(r,e,t)=>{const n=new Map,i={platform:W2,...t},o={...i.platform,_c:n};return ZY(r,e,{...i,platform:o})};function SZ(r){return TZ(r)}function bT(r){return r.assignedSlot?r.assignedSlot:r.parentNode instanceof ShadowRoot?r.parentNode.host:r.parentNode}function TZ(r){for(let e=r;e;e=bT(e))if(e instanceof Element&&getComputedStyle(e).display==="none")return null;for(let e=bT(r);e;e=bT(e)){if(!(e instanceof Element))continue;const t=getComputedStyle(e);if(t.display!=="contents"&&(t.position!=="static"||t.filter!=="none"||e.tagName==="BODY"))return e}return null}function $Z(r){return r!==null&&typeof r=="object"&&"getBoundingClientRect"in r&&("contextElement"in r?r instanceof Element:!0)}var jr=class extends pr{constructor(){super(...arguments),this.active=!1,this.placement="top",this.strategy="absolute",this.distance=0,this.skidding=0,this.arrow=!1,this.arrowPlacement="anchor",this.arrowPadding=10,this.flip=!1,this.flipFallbackPlacements="",this.flipFallbackStrategy="best-fit",this.flipPadding=0,this.shift=!1,this.shiftPadding=0,this.autoSizePadding=0,this.hoverBridge=!1,this.updateHoverBridge=()=>{if(this.hoverBridge&&this.anchorEl){const r=this.anchorEl.getBoundingClientRect(),e=this.popup.getBoundingClientRect(),t=this.placement.includes("top")||this.placement.includes("bottom");let n=0,i=0,o=0,s=0,a=0,l=0,d=0,c=0;t?r.top<e.top?(n=r.left,i=r.bottom,o=r.right,s=r.bottom,a=e.left,l=e.top,d=e.right,c=e.top):(n=e.left,i=e.bottom,o=e.right,s=e.bottom,a=r.left,l=r.top,d=r.right,c=r.top):r.left<e.left?(n=r.right,i=r.top,o=e.left,s=e.top,a=r.right,l=r.bottom,d=e.left,c=e.bottom):(n=e.right,i=e.top,o=r.left,s=r.top,a=e.right,l=e.bottom,d=r.left,c=r.bottom),this.style.setProperty("--hover-bridge-top-left-x",`${n}px`),this.style.setProperty("--hover-bridge-top-left-y",`${i}px`),this.style.setProperty("--hover-bridge-top-right-x",`${o}px`),this.style.setProperty("--hover-bridge-top-right-y",`${s}px`),this.style.setProperty("--hover-bridge-bottom-left-x",`${a}px`),this.style.setProperty("--hover-bridge-bottom-left-y",`${l}px`),this.style.setProperty("--hover-bridge-bottom-right-x",`${d}px`),this.style.setProperty("--hover-bridge-bottom-right-y",`${c}px`)}}}async connectedCallback(){super.connectedCallback(),await this.updateComplete,this.start()}disconnectedCallback(){super.disconnectedCallback(),this.stop()}async updated(r){super.updated(r),r.has("active")&&(this.active?this.start():this.stop()),r.has("anchor")&&this.handleAnchorChange(),this.active&&(await this.updateComplete,this.reposition())}async handleAnchorChange(){if(await this.stop(),this.anchor&&typeof this.anchor=="string"){const r=this.getRootNode();this.anchorEl=r.getElementById(this.anchor)}else this.anchor instanceof Element||$Z(this.anchor)?this.anchorEl=this.anchor:this.anchorEl=this.querySelector('[slot="anchor"]');this.anchorEl instanceof HTMLSlotElement&&(this.anchorEl=this.anchorEl.assignedElements({flatten:!0})[0]),this.anchorEl&&this.start()}start(){this.anchorEl&&(this.cleanup=bZ(this.anchorEl,this.popup,()=>{this.reposition()}))}async stop(){return new Promise(r=>{this.cleanup?(this.cleanup(),this.cleanup=void 0,this.removeAttribute("data-current-placement"),this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height"),requestAnimationFrame(()=>r())):r()})}reposition(){if(!this.active||!this.anchorEl)return;const r=[wZ({mainAxis:this.distance,crossAxis:this.skidding})];this.sync?r.push(o3({apply:({rects:t})=>{const n=this.sync==="width"||this.sync==="both",i=this.sync==="height"||this.sync==="both";this.popup.style.width=n?`${t.reference.width}px`:"",this.popup.style.height=i?`${t.reference.height}px`:""}})):(this.popup.style.width="",this.popup.style.height=""),this.flip&&r.push(EZ({boundary:this.flipBoundary,fallbackPlacements:this.flipFallbackPlacements,fallbackStrategy:this.flipFallbackStrategy==="best-fit"?"bestFit":"initialPlacement",padding:this.flipPadding})),this.shift&&r.push(_Z({boundary:this.shiftBoundary,padding:this.shiftPadding})),this.autoSize?r.push(o3({boundary:this.autoSizeBoundary,padding:this.autoSizePadding,apply:({availableWidth:t,availableHeight:n})=>{this.autoSize==="vertical"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-height",`${n}px`):this.style.removeProperty("--auto-size-available-height"),this.autoSize==="horizontal"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-width",`${t}px`):this.style.removeProperty("--auto-size-available-width")}})):(this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height")),this.arrow&&r.push(AZ({element:this.arrowEl,padding:this.arrowPadding}));const e=this.strategy==="absolute"?t=>W2.getOffsetParent(t,SZ):W2.getOffsetParent;xZ(this.anchorEl,this.popup,{placement:this.placement,middleware:r,strategy:this.strategy,platform:c_(Fu({},W2),{getOffsetParent:e})}).then(({x:t,y:n,middlewareData:i,placement:o})=>{const s=this.matches(":dir(rtl)"),a={top:"bottom",right:"left",bottom:"top",left:"right"}[o.split("-")[0]];if(this.setAttribute("data-current-placement",o),Object.assign(this.popup.style,{left:`${t}px`,top:`${n}px`}),this.arrow){const l=i.arrow.x,d=i.arrow.y;let c="",u="",f="",h="";if(this.arrowPlacement==="start"){const p=typeof l=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";c=typeof d=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"",u=s?p:"",h=s?"":p}else if(this.arrowPlacement==="end"){const p=typeof l=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";u=s?"":p,h=s?p:"",f=typeof d=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:""}else this.arrowPlacement==="center"?(h=typeof l=="number"?"calc(50% - var(--arrow-size-diagonal))":"",c=typeof d=="number"?"calc(50% - var(--arrow-size-diagonal))":""):(h=typeof l=="number"?`${l}px`:"",c=typeof d=="number"?`${d}px`:"");Object.assign(this.arrowEl.style,{top:c,right:u,bottom:f,left:h,[a]:"calc(var(--arrow-size-diagonal) * -1)"})}}),requestAnimationFrame(()=>this.updateHoverBridge()),this.emit("sl-reposition")}render(){return Ie`
      <slot name="anchor" @slotchange=${this.handleAnchorChange}></slot>

      <span
        part="hover-bridge"
        class=${br({"popup-hover-bridge":!0,"popup-hover-bridge--visible":this.hoverBridge&&this.active})}
      ></span>

      <div
        part="popup"
        class=${br({popup:!0,"popup--active":this.active,"popup--fixed":this.strategy==="fixed","popup--has-arrow":this.arrow})}
      >
        <slot></slot>
        ${this.arrow?Ie`<div part="arrow" class="popup__arrow" role="presentation"></div>`:""}
      </div>
    `}};jr.styles=[Tr,zY];oe([Dt(".popup")],jr.prototype,"popup",2);oe([Dt(".popup__arrow")],jr.prototype,"arrowEl",2);oe([he()],jr.prototype,"anchor",2);oe([he({type:Boolean,reflect:!0})],jr.prototype,"active",2);oe([he({reflect:!0})],jr.prototype,"placement",2);oe([he({reflect:!0})],jr.prototype,"strategy",2);oe([he({type:Number})],jr.prototype,"distance",2);oe([he({type:Number})],jr.prototype,"skidding",2);oe([he({type:Boolean})],jr.prototype,"arrow",2);oe([he({attribute:"arrow-placement"})],jr.prototype,"arrowPlacement",2);oe([he({attribute:"arrow-padding",type:Number})],jr.prototype,"arrowPadding",2);oe([he({type:Boolean})],jr.prototype,"flip",2);oe([he({attribute:"flip-fallback-placements",converter:{fromAttribute:r=>r.split(" ").map(e=>e.trim()).filter(e=>e!==""),toAttribute:r=>r.join(" ")}})],jr.prototype,"flipFallbackPlacements",2);oe([he({attribute:"flip-fallback-strategy"})],jr.prototype,"flipFallbackStrategy",2);oe([he({type:Object})],jr.prototype,"flipBoundary",2);oe([he({attribute:"flip-padding",type:Number})],jr.prototype,"flipPadding",2);oe([he({type:Boolean})],jr.prototype,"shift",2);oe([he({type:Object})],jr.prototype,"shiftBoundary",2);oe([he({attribute:"shift-padding",type:Number})],jr.prototype,"shiftPadding",2);oe([he({attribute:"auto-size"})],jr.prototype,"autoSize",2);oe([he()],jr.prototype,"sync",2);oe([he({type:Object})],jr.prototype,"autoSizeBoundary",2);oe([he({attribute:"auto-size-padding",type:Number})],jr.prototype,"autoSizePadding",2);oe([he({attribute:"hover-bridge",type:Boolean})],jr.prototype,"hoverBridge",2);var FL=new Map,kZ=new WeakMap;function PZ(r){return r??{keyframes:[],options:{duration:0}}}function s3(r,e){return e.toLowerCase()==="rtl"?{keyframes:r.rtlKeyframes||r.keyframes,options:r.options}:r}function ln(r,e){FL.set(r,PZ(e))}function ni(r,e,t){const n=kZ.get(r);if(n?.[e])return s3(n[e],t.dir);const i=FL.get(e);return i?s3(i,t.dir):{keyframes:[],options:{duration:0}}}function Ea(r,e){return new Promise(t=>{function n(i){i.target===r&&(r.removeEventListener(e,n),t())}r.addEventListener(e,n)})}function $i(r,e,t){return new Promise(n=>{if(t?.duration===1/0)throw new Error("Promise-based animations must be finite.");const i=r.animate(e,c_(Fu({},t),{duration:hP()?0:t.duration}));i.addEventListener("cancel",n,{once:!0}),i.addEventListener("finish",n,{once:!0})})}function a3(r){return r=r.toString().toLowerCase(),r.indexOf("ms")>-1?parseFloat(r):r.indexOf("s")>-1?parseFloat(r)*1e3:parseFloat(r)}function hP(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}function Go(r){return Promise.all(r.getAnimations().map(e=>new Promise(t=>{e.cancel(),requestAnimationFrame(t)})))}function c3(r,e){return r.map(t=>c_(Fu({},t),{height:t.height==="auto"?`${e}px`:t.height}))}var ji=class extends pr{constructor(){super(),this.localize=new js(this),this.content="",this.placement="top",this.disabled=!1,this.distance=8,this.open=!1,this.skidding=0,this.trigger="hover focus",this.hoist=!1,this.handleBlur=()=>{this.hasTrigger("focus")&&this.hide()},this.handleClick=()=>{this.hasTrigger("click")&&(this.open?this.hide():this.show())},this.handleFocus=()=>{this.hasTrigger("focus")&&this.show()},this.handleDocumentKeyDown=r=>{r.key==="Escape"&&(r.stopPropagation(),this.hide())},this.handleMouseOver=()=>{if(this.hasTrigger("hover")){const r=a3(getComputedStyle(this).getPropertyValue("--show-delay"));clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>this.show(),r)}},this.handleMouseOut=()=>{if(this.hasTrigger("hover")){const r=a3(getComputedStyle(this).getPropertyValue("--hide-delay"));clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>this.hide(),r)}},this.addEventListener("blur",this.handleBlur,!0),this.addEventListener("focus",this.handleFocus,!0),this.addEventListener("click",this.handleClick),this.addEventListener("mouseover",this.handleMouseOver),this.addEventListener("mouseout",this.handleMouseOut)}disconnectedCallback(){var r;(r=this.closeWatcher)==null||r.destroy(),document.removeEventListener("keydown",this.handleDocumentKeyDown)}firstUpdated(){this.body.hidden=!this.open,this.open&&(this.popup.active=!0,this.popup.reposition())}hasTrigger(r){return this.trigger.split(" ").includes(r)}async handleOpenChange(){var r,e;if(this.open){if(this.disabled)return;this.emit("sl-show"),"CloseWatcher"in window?((r=this.closeWatcher)==null||r.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>{this.hide()}):document.addEventListener("keydown",this.handleDocumentKeyDown),await Go(this.body),this.body.hidden=!1,this.popup.active=!0;const{keyframes:t,options:n}=ni(this,"tooltip.show",{dir:this.localize.dir()});await $i(this.popup.popup,t,n),this.popup.reposition(),this.emit("sl-after-show")}else{this.emit("sl-hide"),(e=this.closeWatcher)==null||e.destroy(),document.removeEventListener("keydown",this.handleDocumentKeyDown),await Go(this.body);const{keyframes:t,options:n}=ni(this,"tooltip.hide",{dir:this.localize.dir()});await $i(this.popup.popup,t,n),this.popup.active=!1,this.body.hidden=!0,this.emit("sl-after-hide")}}async handleOptionsChange(){this.hasUpdated&&(await this.updateComplete,this.popup.reposition())}handleDisabledChange(){this.disabled&&this.open&&this.hide()}async show(){if(!this.open)return this.open=!0,Ea(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,Ea(this,"sl-after-hide")}render(){return Ie`
      <sl-popup
        part="base"
        exportparts="
          popup:base__popup,
          arrow:base__arrow
        "
        class=${br({tooltip:!0,"tooltip--open":this.open})}
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        strategy=${this.hoist?"fixed":"absolute"}
        flip
        shift
        arrow
        hover-bridge
      >
        ${""}
        <slot slot="anchor" aria-describedby="tooltip"></slot>

        ${""}
        <div part="body" id="tooltip" class="tooltip__body" role="tooltip" aria-live=${this.open?"polite":"off"}>
          <slot name="content">${this.content}</slot>
        </div>
      </sl-popup>
    `}};ji.styles=[Tr,KY];ji.dependencies={"sl-popup":jr};oe([Dt("slot:not([name])")],ji.prototype,"defaultSlot",2);oe([Dt(".tooltip__body")],ji.prototype,"body",2);oe([Dt("sl-popup")],ji.prototype,"popup",2);oe([he()],ji.prototype,"content",2);oe([he()],ji.prototype,"placement",2);oe([he({type:Boolean,reflect:!0})],ji.prototype,"disabled",2);oe([he({type:Number})],ji.prototype,"distance",2);oe([he({type:Boolean,reflect:!0})],ji.prototype,"open",2);oe([he({type:Number})],ji.prototype,"skidding",2);oe([he()],ji.prototype,"trigger",2);oe([he({type:Boolean})],ji.prototype,"hoist",2);oe([Ut("open",{waitUntilFirstUpdate:!0})],ji.prototype,"handleOpenChange",1);oe([Ut(["content","distance","hoist","placement","skidding"])],ji.prototype,"handleOptionsChange",1);oe([Ut("disabled")],ji.prototype,"handleDisabledChange",1);ln("tooltip.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:150,easing:"ease"}});ln("tooltip.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:150,easing:"ease"}});var IZ=Ye`
  :host {
    --error-color: var(--sl-color-danger-600);
    --success-color: var(--sl-color-success-600);

    display: inline-block;
  }

  .copy-button__button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-medium);
    font-size: inherit;
    color: inherit;
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-x-fast) color;
  }

  .copy-button--success .copy-button__button {
    color: var(--success-color);
  }

  .copy-button--error .copy-button__button {
    color: var(--error-color);
  }

  .copy-button__button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .copy-button__button[disabled] {
    opacity: 0.5;
    cursor: not-allowed !important;
  }

  slot {
    display: inline-flex;
  }
`,Ni=class extends pr{constructor(){super(...arguments),this.localize=new js(this),this.isCopying=!1,this.status="rest",this.value="",this.from="",this.disabled=!1,this.copyLabel="",this.successLabel="",this.errorLabel="",this.feedbackDuration=1e3,this.tooltipPlacement="top",this.hoist=!1}async handleCopy(){if(this.disabled||this.isCopying)return;this.isCopying=!0;let r=this.value;if(this.from){const e=this.getRootNode(),t=this.from.includes("."),n=this.from.includes("[")&&this.from.includes("]");let i=this.from,o="";t?[i,o]=this.from.trim().split("."):n&&([i,o]=this.from.trim().replace(/\]$/,"").split("["));const s="getElementById"in e?e.getElementById(i):null;s?n?r=s.getAttribute(o)||"":t?r=s[o]||"":r=s.textContent||"":(this.showStatus("error"),this.emit("sl-error"))}if(!r)this.showStatus("error"),this.emit("sl-error");else try{await navigator.clipboard.writeText(r),this.showStatus("success"),this.emit("sl-copy",{detail:{value:r}})}catch{this.showStatus("error"),this.emit("sl-error")}}async showStatus(r){const e=this.copyLabel||this.localize.term("copy"),t=this.successLabel||this.localize.term("copied"),n=this.errorLabel||this.localize.term("error"),i=r==="success"?this.successIcon:this.errorIcon,o=ni(this,"copy.in",{dir:"ltr"}),s=ni(this,"copy.out",{dir:"ltr"});this.tooltip.content=r==="success"?t:n,await this.copyIcon.animate(s.keyframes,s.options).finished,this.copyIcon.hidden=!0,this.status=r,i.hidden=!1,await i.animate(o.keyframes,o.options).finished,setTimeout(async()=>{await i.animate(s.keyframes,s.options).finished,i.hidden=!0,this.status="rest",this.copyIcon.hidden=!1,await this.copyIcon.animate(o.keyframes,o.options).finished,this.tooltip.content=e,this.isCopying=!1},this.feedbackDuration)}render(){const r=this.copyLabel||this.localize.term("copy");return Ie`
      <sl-tooltip
        class=${br({"copy-button":!0,"copy-button--success":this.status==="success","copy-button--error":this.status==="error"})}
        content=${r}
        placement=${this.tooltipPlacement}
        ?disabled=${this.disabled}
        ?hoist=${this.hoist}
        exportparts="
          base:tooltip__base,
          base__popup:tooltip__base__popup,
          base__arrow:tooltip__base__arrow,
          body:tooltip__body
        "
      >
        <button
          class="copy-button__button"
          part="button"
          type="button"
          ?disabled=${this.disabled}
          @click=${this.handleCopy}
        >
          <slot part="copy-icon" name="copy-icon">
            <sl-icon library="system" name="copy"></sl-icon>
          </slot>
          <slot part="success-icon" name="success-icon" hidden>
            <sl-icon library="system" name="check"></sl-icon>
          </slot>
          <slot part="error-icon" name="error-icon" hidden>
            <sl-icon library="system" name="x-lg"></sl-icon>
          </slot>
        </button>
      </sl-tooltip>
    `}};Ni.styles=[Tr,IZ];Ni.dependencies={"sl-icon":Bi,"sl-tooltip":ji};oe([Dt('slot[name="copy-icon"]')],Ni.prototype,"copyIcon",2);oe([Dt('slot[name="success-icon"]')],Ni.prototype,"successIcon",2);oe([Dt('slot[name="error-icon"]')],Ni.prototype,"errorIcon",2);oe([Dt("sl-tooltip")],Ni.prototype,"tooltip",2);oe([ii()],Ni.prototype,"isCopying",2);oe([ii()],Ni.prototype,"status",2);oe([he()],Ni.prototype,"value",2);oe([he()],Ni.prototype,"from",2);oe([he({type:Boolean,reflect:!0})],Ni.prototype,"disabled",2);oe([he({attribute:"copy-label"})],Ni.prototype,"copyLabel",2);oe([he({attribute:"success-label"})],Ni.prototype,"successLabel",2);oe([he({attribute:"error-label"})],Ni.prototype,"errorLabel",2);oe([he({attribute:"feedback-duration",type:Number})],Ni.prototype,"feedbackDuration",2);oe([he({attribute:"tooltip-placement"})],Ni.prototype,"tooltipPlacement",2);oe([he({type:Boolean})],Ni.prototype,"hoist",2);ln("copy.in",{keyframes:[{scale:".25",opacity:".25"},{scale:"1",opacity:"1"}],options:{duration:100}});ln("copy.out",{keyframes:[{scale:"1",opacity:"1"},{scale:".25",opacity:"0"}],options:{duration:100}});Ni.define("sl-copy-button");var OZ=Ye`
  :host {
    display: inline-block;
  }

  .checkbox {
    position: relative;
    display: inline-flex;
    align-items: flex-start;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    color: var(--sl-input-label-color);
    vertical-align: middle;
    cursor: pointer;
  }

  .checkbox--small {
    --toggle-size: var(--sl-toggle-size-small);
    font-size: var(--sl-input-font-size-small);
  }

  .checkbox--medium {
    --toggle-size: var(--sl-toggle-size-medium);
    font-size: var(--sl-input-font-size-medium);
  }

  .checkbox--large {
    --toggle-size: var(--sl-toggle-size-large);
    font-size: var(--sl-input-font-size-large);
  }

  .checkbox__control {
    flex: 0 0 auto;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--toggle-size);
    height: var(--toggle-size);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
    border-radius: 2px;
    background-color: var(--sl-input-background-color);
    color: var(--sl-color-neutral-0);
    transition:
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) background-color,
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) box-shadow;
  }

  .checkbox__input {
    position: absolute;
    opacity: 0;
    padding: 0;
    margin: 0;
    pointer-events: none;
  }

  .checkbox__checked-icon,
  .checkbox__indeterminate-icon {
    display: inline-flex;
    width: var(--toggle-size);
    height: var(--toggle-size);
  }

  /* Hover */
  .checkbox:not(.checkbox--checked):not(.checkbox--disabled) .checkbox__control:hover {
    border-color: var(--sl-input-border-color-hover);
    background-color: var(--sl-input-background-color-hover);
  }

  /* Focus */
  .checkbox:not(.checkbox--checked):not(.checkbox--disabled) .checkbox__input:focus-visible ~ .checkbox__control {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Checked/indeterminate */
  .checkbox--checked .checkbox__control,
  .checkbox--indeterminate .checkbox__control {
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
  }

  /* Checked/indeterminate + hover */
  .checkbox.checkbox--checked:not(.checkbox--disabled) .checkbox__control:hover,
  .checkbox.checkbox--indeterminate:not(.checkbox--disabled) .checkbox__control:hover {
    border-color: var(--sl-color-primary-500);
    background-color: var(--sl-color-primary-500);
  }

  /* Checked/indeterminate + focus */
  .checkbox.checkbox--checked:not(.checkbox--disabled) .checkbox__input:focus-visible ~ .checkbox__control,
  .checkbox.checkbox--indeterminate:not(.checkbox--disabled) .checkbox__input:focus-visible ~ .checkbox__control {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Disabled */
  .checkbox--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .checkbox__label {
    display: inline-block;
    color: var(--sl-input-label-color);
    line-height: var(--toggle-size);
    margin-inline-start: 0.5em;
    user-select: none;
    -webkit-user-select: none;
  }

  :host([required]) .checkbox__label::after {
    content: var(--sl-input-required-content);
    color: var(--sl-input-required-content-color);
    margin-inline-start: var(--sl-input-required-content-offset);
  }
`,$x=(r="value")=>(e,t)=>{const n=e.constructor,i=n.prototype.attributeChangedCallback;n.prototype.attributeChangedCallback=function(o,s,a){var l;const d=n.getPropertyOptions(r),c=typeof d.attribute=="string"?d.attribute:r;if(o===c){const u=d.converter||kg,h=(typeof u=="function"?u:(l=u?.fromAttribute)!=null?l:kg.fromAttribute)(a,d.type);this[r]!==h&&(this[t]=h)}i.call(this,o,s,a)}},u_=Ye`
  .form-control .form-control__label {
    display: none;
  }

  .form-control .form-control__help-text {
    display: none;
  }

  /* Label */
  .form-control--has-label .form-control__label {
    display: inline-block;
    color: var(--sl-input-label-color);
    margin-bottom: var(--sl-spacing-3x-small);
  }

  .form-control--has-label.form-control--small .form-control__label {
    font-size: var(--sl-input-label-font-size-small);
  }

  .form-control--has-label.form-control--medium .form-control__label {
    font-size: var(--sl-input-label-font-size-medium);
  }

  .form-control--has-label.form-control--large .form-control__label {
    font-size: var(--sl-input-label-font-size-large);
  }

  :host([required]) .form-control--has-label .form-control__label::after {
    content: var(--sl-input-required-content);
    margin-inline-start: var(--sl-input-required-content-offset);
    color: var(--sl-input-required-content-color);
  }

  /* Help text */
  .form-control--has-help-text .form-control__help-text {
    display: block;
    color: var(--sl-input-help-text-color);
    margin-top: var(--sl-spacing-3x-small);
  }

  .form-control--has-help-text.form-control--small .form-control__help-text {
    font-size: var(--sl-input-help-text-font-size-small);
  }

  .form-control--has-help-text.form-control--medium .form-control__help-text {
    font-size: var(--sl-input-help-text-font-size-medium);
  }

  .form-control--has-help-text.form-control--large .form-control__help-text {
    font-size: var(--sl-input-help-text-font-size-large);
  }

  .form-control--has-help-text.form-control--radio-group .form-control__help-text {
    margin-top: var(--sl-spacing-2x-small);
  }
`;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const yw=_x(class extends Ex{constructor(r){if(super(r),r.type!==Xd.PROPERTY&&r.type!==Xd.ATTRIBUTE&&r.type!==Xd.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!TL(r))throw Error("`live` bindings can only contain a single expression")}render(r){return r}update(r,[e]){if(e===ic||e===Ot)return e;const t=r.element,n=r.name;if(r.type===Xd.PROPERTY){if(e===t[n])return ic}else if(r.type===Xd.BOOLEAN_ATTRIBUTE){if(!!e===t.hasAttribute(n))return ic}else if(r.type===Xd.ATTRIBUTE&&t.getAttribute(n)===e+"")return ic;return PY(r),e}});var Ui=class extends pr{constructor(){super(...arguments),this.formControlController=new bv(this,{value:r=>r.checked?r.value||"on":void 0,defaultValue:r=>r.defaultChecked,setValue:(r,e)=>r.checked=e}),this.hasSlotController=new fc(this,"help-text"),this.hasFocus=!1,this.title="",this.name="",this.size="medium",this.disabled=!1,this.checked=!1,this.indeterminate=!1,this.defaultChecked=!1,this.form="",this.required=!1,this.helpText=""}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.formControlController.updateValidity()}handleClick(){this.checked=!this.checked,this.indeterminate=!1,this.emit("sl-change")}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleInput(){this.emit("sl-input")}handleInvalid(r){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(r)}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}handleStateChange(){this.input.checked=this.checked,this.input.indeterminate=this.indeterminate,this.formControlController.updateValidity()}click(){this.input.click()}focus(r){this.input.focus(r)}blur(){this.input.blur()}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(r){this.input.setCustomValidity(r),this.formControlController.updateValidity()}render(){const r=this.hasSlotController.test("help-text"),e=this.helpText?!0:!!r;return Ie`
      <div
        class=${br({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-help-text":e})}
      >
        <label
          part="base"
          class=${br({checkbox:!0,"checkbox--checked":this.checked,"checkbox--disabled":this.disabled,"checkbox--focused":this.hasFocus,"checkbox--indeterminate":this.indeterminate,"checkbox--small":this.size==="small","checkbox--medium":this.size==="medium","checkbox--large":this.size==="large"})}
        >
          <input
            class="checkbox__input"
            type="checkbox"
            title=${this.title}
            name=${this.name}
            value=${ft(this.value)}
            .indeterminate=${yw(this.indeterminate)}
            .checked=${yw(this.checked)}
            .disabled=${this.disabled}
            .required=${this.required}
            aria-checked=${this.checked?"true":"false"}
            aria-describedby="help-text"
            @click=${this.handleClick}
            @input=${this.handleInput}
            @invalid=${this.handleInvalid}
            @blur=${this.handleBlur}
            @focus=${this.handleFocus}
          />

          <span
            part="control${this.checked?" control--checked":""}${this.indeterminate?" control--indeterminate":""}"
            class="checkbox__control"
          >
            ${this.checked?Ie`
                  <sl-icon part="checked-icon" class="checkbox__checked-icon" library="system" name="check"></sl-icon>
                `:""}
            ${!this.checked&&this.indeterminate?Ie`
                  <sl-icon
                    part="indeterminate-icon"
                    class="checkbox__indeterminate-icon"
                    library="system"
                    name="indeterminate"
                  ></sl-icon>
                `:""}
          </span>

          <div part="label" class="checkbox__label">
            <slot></slot>
          </div>
        </label>

        <div
          aria-hidden=${e?"false":"true"}
          class="form-control__help-text"
          id="help-text"
          part="form-control-help-text"
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Ui.styles=[Tr,u_,OZ];Ui.dependencies={"sl-icon":Bi};oe([Dt('input[type="checkbox"]')],Ui.prototype,"input",2);oe([ii()],Ui.prototype,"hasFocus",2);oe([he()],Ui.prototype,"title",2);oe([he()],Ui.prototype,"name",2);oe([he()],Ui.prototype,"value",2);oe([he({reflect:!0})],Ui.prototype,"size",2);oe([he({type:Boolean,reflect:!0})],Ui.prototype,"disabled",2);oe([he({type:Boolean,reflect:!0})],Ui.prototype,"checked",2);oe([he({type:Boolean,reflect:!0})],Ui.prototype,"indeterminate",2);oe([$x("checked")],Ui.prototype,"defaultChecked",2);oe([he({reflect:!0})],Ui.prototype,"form",2);oe([he({type:Boolean,reflect:!0})],Ui.prototype,"required",2);oe([he({attribute:"help-text"})],Ui.prototype,"helpText",2);oe([Ut("disabled",{waitUntilFirstUpdate:!0})],Ui.prototype,"handleDisabledChange",1);oe([Ut(["checked","indeterminate"],{waitUntilFirstUpdate:!0})],Ui.prototype,"handleStateChange",1);Ui.define("sl-checkbox");var CZ=Ye`
  :host {
    display: block;
    position: relative;
    background: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-radius: var(--sl-border-radius-medium);
    padding: var(--sl-spacing-x-small) 0;
    overflow: auto;
    overscroll-behavior: none;
  }

  ::slotted(sl-divider) {
    --spacing: var(--sl-spacing-x-small);
  }
`,tO=class extends pr{connectedCallback(){super.connectedCallback(),this.setAttribute("role","menu")}handleClick(r){const e=["menuitem","menuitemcheckbox"],t=r.composedPath(),n=t.find(a=>{var l;return e.includes(((l=a?.getAttribute)==null?void 0:l.call(a,"role"))||"")});if(!n||t.find(a=>{var l;return((l=a?.getAttribute)==null?void 0:l.call(a,"role"))==="menu"})!==this)return;const s=n;s.type==="checkbox"&&(s.checked=!s.checked),this.emit("sl-select",{detail:{item:s}})}handleKeyDown(r){if(r.key==="Enter"||r.key===" "){const e=this.getCurrentItem();r.preventDefault(),r.stopPropagation(),e?.click()}else if(["ArrowDown","ArrowUp","Home","End"].includes(r.key)){const e=this.getAllItems(),t=this.getCurrentItem();let n=t?e.indexOf(t):0;e.length>0&&(r.preventDefault(),r.stopPropagation(),r.key==="ArrowDown"?n++:r.key==="ArrowUp"?n--:r.key==="Home"?n=0:r.key==="End"&&(n=e.length-1),n<0&&(n=e.length-1),n>e.length-1&&(n=0),this.setCurrentItem(e[n]),e[n].focus())}}handleMouseDown(r){const e=r.target;this.isMenuItem(e)&&this.setCurrentItem(e)}handleSlotChange(){const r=this.getAllItems();r.length>0&&this.setCurrentItem(r[0])}isMenuItem(r){var e;return r.tagName.toLowerCase()==="sl-menu-item"||["menuitem","menuitemcheckbox","menuitemradio"].includes((e=r.getAttribute("role"))!=null?e:"")}getAllItems(){return[...this.defaultSlot.assignedElements({flatten:!0})].filter(r=>!(r.inert||!this.isMenuItem(r)))}getCurrentItem(){return this.getAllItems().find(r=>r.getAttribute("tabindex")==="0")}setCurrentItem(r){this.getAllItems().forEach(t=>{t.setAttribute("tabindex",t===r?"0":"-1")})}render(){return Ie`
      <slot
        @slotchange=${this.handleSlotChange}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleMouseDown}
      ></slot>
    `}};tO.styles=[Tr,CZ];oe([Dt("slot")],tO.prototype,"defaultSlot",2);tO.define("sl-menu");var RZ=Ye`
  :host {
    --submenu-offset: -2px;

    display: block;
  }

  :host([inert]) {
    display: none;
  }

  .menu-item {
    position: relative;
    display: flex;
    align-items: stretch;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-letter-spacing-normal);
    color: var(--sl-color-neutral-700);
    padding: var(--sl-spacing-2x-small) var(--sl-spacing-2x-small);
    transition: var(--sl-transition-fast) fill;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    cursor: pointer;
  }

  .menu-item.menu-item--disabled {
    outline: none;
    opacity: 0.5;
    cursor: not-allowed;
  }

  .menu-item.menu-item--loading {
    outline: none;
    cursor: wait;
  }

  .menu-item.menu-item--loading *:not(sl-spinner) {
    opacity: 0.5;
  }

  .menu-item--loading sl-spinner {
    --indicator-color: currentColor;
    --track-width: 1px;
    position: absolute;
    font-size: 0.75em;
    top: calc(50% - 0.5em);
    left: 0.65rem;
    opacity: 1;
  }

  .menu-item .menu-item__label {
    flex: 1 1 auto;
    display: inline-block;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .menu-item .menu-item__prefix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .menu-item .menu-item__prefix::slotted(*) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .menu-item .menu-item__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .menu-item .menu-item__suffix::slotted(*) {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  /* Safe triangle */
  .menu-item--submenu-expanded::after {
    content: '';
    position: fixed;
    z-index: calc(var(--sl-z-index-dropdown) - 1);
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    clip-path: polygon(
      var(--safe-triangle-cursor-x, 0) var(--safe-triangle-cursor-y, 0),
      var(--safe-triangle-submenu-start-x, 0) var(--safe-triangle-submenu-start-y, 0),
      var(--safe-triangle-submenu-end-x, 0) var(--safe-triangle-submenu-end-y, 0)
    );
  }

  :host(:focus-visible) {
    outline: none;
  }

  :host(:hover:not([aria-disabled='true'], :focus-visible)) .menu-item,
  .menu-item--submenu-expanded {
    background-color: var(--sl-color-neutral-100);
    color: var(--sl-color-neutral-1000);
  }

  :host(:focus-visible) .menu-item {
    outline: none;
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
    opacity: 1;
  }

  .menu-item .menu-item__check,
  .menu-item .menu-item__chevron {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5em;
    visibility: hidden;
  }

  .menu-item--checked .menu-item__check,
  .menu-item--has-submenu .menu-item__chevron {
    visibility: visible;
  }

  /* Add elevation and z-index to submenus */
  sl-popup::part(popup) {
    box-shadow: var(--sl-shadow-large);
    z-index: var(--sl-z-index-dropdown);
    margin-left: var(--submenu-offset);
  }

  .menu-item--rtl sl-popup::part(popup) {
    margin-left: calc(-1 * var(--submenu-offset));
  }

  @media (forced-colors: active) {
    :host(:hover:not([aria-disabled='true'])) .menu-item,
    :host(:focus-visible) .menu-item {
      outline: dashed 1px SelectedItem;
      outline-offset: -1px;
    }
  }

  ::slotted(sl-menu) {
    max-width: var(--auto-size-available-width) !important;
    max-height: var(--auto-size-available-height) !important;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Bb=(r,e)=>{const t=r._$AN;if(t===void 0)return!1;for(const n of t)n._$AO?.(e,!1),Bb(n,e);return!0},qE=r=>{let e,t;do{if((e=r._$AM)===void 0)break;t=e._$AN,t.delete(r),r=e}while(t?.size===0)},qL=r=>{for(let e;e=r._$AM;r=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(r))break;t.add(r),BZ(e)}};function DZ(r){this._$AN!==void 0?(qE(this),this._$AM=r,qL(this)):this._$AM=r}function MZ(r,e=!1,t=0){const n=this._$AH,i=this._$AN;if(i!==void 0&&i.size!==0)if(e)if(Array.isArray(n))for(let o=t;o<n.length;o++)Bb(n[o],!1),qE(n[o]);else n!=null&&(Bb(n,!1),qE(n));else Bb(this,r)}const BZ=r=>{r.type==Xd.CHILD&&(r._$AP??=MZ,r._$AQ??=DZ)};class jZ extends Ex{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,n){super._$AT(e,t,n),qL(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(Bb(this,e),qE(this))}setValue(e){if(TL(this.t))this.t._$AI(e,this);else{const t=[...this.t._$AH];t[this.i]=e,this.t._$AI(t,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const NZ=()=>new UZ;let UZ=class{};const wT=new WeakMap,LZ=_x(class extends jZ{render(r){return Ot}update(r,[e]){const t=e!==this.Y;return t&&this.Y!==void 0&&this.rt(void 0),(t||this.lt!==this.ct)&&(this.Y=e,this.ht=r.options?.host,this.rt(this.ct=r.element)),Ot}rt(r){if(this.isConnected||(r=void 0),typeof this.Y=="function"){const e=this.ht??globalThis;let t=wT.get(e);t===void 0&&(t=new WeakMap,wT.set(e,t)),t.get(this.Y)!==void 0&&this.Y.call(this.ht,void 0),t.set(this.Y,r),r!==void 0&&this.Y.call(this.ht,r)}else this.Y.value=r}get lt(){return typeof this.Y=="function"?wT.get(this.ht??globalThis)?.get(this.Y):this.Y?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var KZ=class{constructor(r,e){this.popupRef=NZ(),this.enableSubmenuTimer=-1,this.isConnected=!1,this.isPopupConnected=!1,this.skidding=0,this.submenuOpenDelay=100,this.handleMouseMove=t=>{this.host.style.setProperty("--safe-triangle-cursor-x",`${t.clientX}px`),this.host.style.setProperty("--safe-triangle-cursor-y",`${t.clientY}px`)},this.handleMouseOver=()=>{this.hasSlotController.test("submenu")&&this.enableSubmenu()},this.handleKeyDown=t=>{switch(t.key){case"Escape":case"Tab":this.disableSubmenu();break;case"ArrowLeft":t.target!==this.host&&(t.preventDefault(),t.stopPropagation(),this.host.focus(),this.disableSubmenu());break;case"ArrowRight":case"Enter":case" ":this.handleSubmenuEntry(t);break}},this.handleClick=t=>{var n;t.target===this.host?(t.preventDefault(),t.stopPropagation()):t.target instanceof Element&&(t.target.tagName==="sl-menu-item"||(n=t.target.role)!=null&&n.startsWith("menuitem"))&&this.disableSubmenu()},this.handleFocusOut=t=>{t.relatedTarget&&t.relatedTarget instanceof Element&&this.host.contains(t.relatedTarget)||this.disableSubmenu()},this.handlePopupMouseover=t=>{t.stopPropagation()},this.handlePopupReposition=()=>{const t=this.host.renderRoot.querySelector("slot[name='submenu']"),n=t?.assignedElements({flatten:!0}).filter(d=>d.localName==="sl-menu")[0],i=this.host.matches(":dir(rtl)");if(!n)return;const{left:o,top:s,width:a,height:l}=n.getBoundingClientRect();this.host.style.setProperty("--safe-triangle-submenu-start-x",`${i?o+a:o}px`),this.host.style.setProperty("--safe-triangle-submenu-start-y",`${s}px`),this.host.style.setProperty("--safe-triangle-submenu-end-x",`${i?o+a:o}px`),this.host.style.setProperty("--safe-triangle-submenu-end-y",`${s+l}px`)},(this.host=r).addController(this),this.hasSlotController=e}hostConnected(){this.hasSlotController.test("submenu")&&!this.host.disabled&&this.addListeners()}hostDisconnected(){this.removeListeners()}hostUpdated(){this.hasSlotController.test("submenu")&&!this.host.disabled?(this.addListeners(),this.updateSkidding()):this.removeListeners()}addListeners(){this.isConnected||(this.host.addEventListener("mousemove",this.handleMouseMove),this.host.addEventListener("mouseover",this.handleMouseOver),this.host.addEventListener("keydown",this.handleKeyDown),this.host.addEventListener("click",this.handleClick),this.host.addEventListener("focusout",this.handleFocusOut),this.isConnected=!0),this.isPopupConnected||this.popupRef.value&&(this.popupRef.value.addEventListener("mouseover",this.handlePopupMouseover),this.popupRef.value.addEventListener("sl-reposition",this.handlePopupReposition),this.isPopupConnected=!0)}removeListeners(){this.isConnected&&(this.host.removeEventListener("mousemove",this.handleMouseMove),this.host.removeEventListener("mouseover",this.handleMouseOver),this.host.removeEventListener("keydown",this.handleKeyDown),this.host.removeEventListener("click",this.handleClick),this.host.removeEventListener("focusout",this.handleFocusOut),this.isConnected=!1),this.isPopupConnected&&this.popupRef.value&&(this.popupRef.value.removeEventListener("mouseover",this.handlePopupMouseover),this.popupRef.value.removeEventListener("sl-reposition",this.handlePopupReposition),this.isPopupConnected=!1)}handleSubmenuEntry(r){const e=this.host.renderRoot.querySelector("slot[name='submenu']");if(!e){console.error("Cannot activate a submenu if no corresponding menuitem can be found.",this);return}let t=null;for(const n of e.assignedElements())if(t=n.querySelectorAll("sl-menu-item, [role^='menuitem']"),t.length!==0)break;if(!(!t||t.length===0)){t[0].setAttribute("tabindex","0");for(let n=1;n!==t.length;++n)t[n].setAttribute("tabindex","-1");this.popupRef.value&&(r.preventDefault(),r.stopPropagation(),this.popupRef.value.active?t[0]instanceof HTMLElement&&t[0].focus():(this.enableSubmenu(!1),this.host.updateComplete.then(()=>{t[0]instanceof HTMLElement&&t[0].focus()}),this.host.requestUpdate()))}}setSubmenuState(r){this.popupRef.value&&this.popupRef.value.active!==r&&(this.popupRef.value.active=r,this.host.requestUpdate())}enableSubmenu(r=!0){r?(window.clearTimeout(this.enableSubmenuTimer),this.enableSubmenuTimer=window.setTimeout(()=>{this.setSubmenuState(!0)},this.submenuOpenDelay)):this.setSubmenuState(!0)}disableSubmenu(){window.clearTimeout(this.enableSubmenuTimer),this.setSubmenuState(!1)}updateSkidding(){var r;if(!((r=this.host.parentElement)!=null&&r.computedStyleMap))return;const e=this.host.parentElement.computedStyleMap(),n=["padding-top","border-top-width","margin-top"].reduce((i,o)=>{var s;const a=(s=e.get(o))!=null?s:new CSSUnitValue(0,"px"),d=(a instanceof CSSUnitValue?a:new CSSUnitValue(0,"px")).to("px");return i-d.value},0);this.skidding=n}isExpanded(){return this.popupRef.value?this.popupRef.value.active:!1}renderSubmenu(){const r=this.host.matches(":dir(rtl)");return this.isConnected?Ie`
      <sl-popup
        ${LZ(this.popupRef)}
        placement=${r?"left-start":"right-start"}
        anchor="anchor"
        flip
        flip-fallback-strategy="best-fit"
        skidding="${this.skidding}"
        strategy="fixed"
        auto-size="vertical"
        auto-size-padding="10"
      >
        <slot name="submenu"></slot>
      </sl-popup>
    `:Ie` <slot name="submenu" hidden></slot> `}},xa=class extends pr{constructor(){super(...arguments),this.type="normal",this.checked=!1,this.value="",this.loading=!1,this.disabled=!1,this.hasSlotController=new fc(this,"submenu"),this.submenuController=new KZ(this,this.hasSlotController),this.handleHostClick=r=>{this.disabled&&(r.preventDefault(),r.stopImmediatePropagation())},this.handleMouseOver=r=>{this.focus(),r.stopPropagation()}}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.handleHostClick),this.addEventListener("mouseover",this.handleMouseOver)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.handleHostClick),this.removeEventListener("mouseover",this.handleMouseOver)}handleDefaultSlotChange(){const r=this.getTextLabel();if(typeof this.cachedTextLabel>"u"){this.cachedTextLabel=r;return}r!==this.cachedTextLabel&&(this.cachedTextLabel=r,this.emit("slotchange",{bubbles:!0,composed:!1,cancelable:!1}))}handleCheckedChange(){if(this.checked&&this.type!=="checkbox"){this.checked=!1,console.error('The checked attribute can only be used on menu items with type="checkbox"',this);return}this.type==="checkbox"?this.setAttribute("aria-checked",this.checked?"true":"false"):this.removeAttribute("aria-checked")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleTypeChange(){this.type==="checkbox"?(this.setAttribute("role","menuitemcheckbox"),this.setAttribute("aria-checked",this.checked?"true":"false")):(this.setAttribute("role","menuitem"),this.removeAttribute("aria-checked"))}getTextLabel(){return MY(this.defaultSlot)}isSubmenu(){return this.hasSlotController.test("submenu")}render(){const r=this.matches(":dir(rtl)"),e=this.submenuController.isExpanded();return Ie`
      <div
        id="anchor"
        part="base"
        class=${br({"menu-item":!0,"menu-item--rtl":r,"menu-item--checked":this.checked,"menu-item--disabled":this.disabled,"menu-item--loading":this.loading,"menu-item--has-submenu":this.isSubmenu(),"menu-item--submenu-expanded":e})}
        ?aria-haspopup="${this.isSubmenu()}"
        ?aria-expanded="${!!e}"
      >
        <span part="checked-icon" class="menu-item__check">
          <sl-icon name="check" library="system" aria-hidden="true"></sl-icon>
        </span>

        <slot name="prefix" part="prefix" class="menu-item__prefix"></slot>

        <slot part="label" class="menu-item__label" @slotchange=${this.handleDefaultSlotChange}></slot>

        <slot name="suffix" part="suffix" class="menu-item__suffix"></slot>

        <span part="submenu-icon" class="menu-item__chevron">
          <sl-icon name=${r?"chevron-left":"chevron-right"} library="system" aria-hidden="true"></sl-icon>
        </span>

        ${this.submenuController.renderSubmenu()}
        ${this.loading?Ie` <sl-spinner part="spinner" exportparts="base:spinner__base"></sl-spinner> `:""}
      </div>
    `}};xa.styles=[Tr,RZ];xa.dependencies={"sl-icon":Bi,"sl-popup":jr,"sl-spinner":Ax};oe([Dt("slot:not([name])")],xa.prototype,"defaultSlot",2);oe([Dt(".menu-item")],xa.prototype,"menuItem",2);oe([he()],xa.prototype,"type",2);oe([he({type:Boolean,reflect:!0})],xa.prototype,"checked",2);oe([he()],xa.prototype,"value",2);oe([he({type:Boolean,reflect:!0})],xa.prototype,"loading",2);oe([he({type:Boolean,reflect:!0})],xa.prototype,"disabled",2);oe([Ut("checked")],xa.prototype,"handleCheckedChange",1);oe([Ut("disabled")],xa.prototype,"handleDisabledChange",1);oe([Ut("type")],xa.prototype,"handleTypeChange",1);xa.define("sl-menu-item");var zZ=Ye`
  :host {
    display: inline-block;
  }

  .dropdown::part(popup) {
    z-index: var(--sl-z-index-dropdown);
  }

  .dropdown[data-current-placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  .dropdown[data-current-placement^='bottom']::part(popup) {
    transform-origin: top;
  }

  .dropdown[data-current-placement^='left']::part(popup) {
    transform-origin: right;
  }

  .dropdown[data-current-placement^='right']::part(popup) {
    transform-origin: left;
  }

  .dropdown__trigger {
    display: block;
  }

  .dropdown__panel {
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    box-shadow: var(--sl-shadow-large);
    border-radius: var(--sl-border-radius-medium);
    pointer-events: none;
  }

  .dropdown--open .dropdown__panel {
    display: block;
    pointer-events: all;
  }

  /* When users slot a menu, make sure it conforms to the popup's auto-size */
  ::slotted(sl-menu) {
    max-width: var(--auto-size-available-width) !important;
    max-height: var(--auto-size-available-height) !important;
  }
`,l3=new WeakMap;function VL(r){let e=l3.get(r);return e||(e=window.getComputedStyle(r,null),l3.set(r,e)),e}function FZ(r){if(typeof r.checkVisibility=="function")return r.checkVisibility({checkOpacity:!1,checkVisibilityCSS:!0});const e=VL(r);return e.visibility!=="hidden"&&e.display!=="none"}function qZ(r){const e=VL(r),{overflowY:t,overflowX:n}=e;return t==="scroll"||n==="scroll"?!0:t!=="auto"||n!=="auto"?!1:r.scrollHeight>r.clientHeight&&t==="auto"||r.scrollWidth>r.clientWidth&&n==="auto"}function VZ(r){const e=r.tagName.toLowerCase(),t=Number(r.getAttribute("tabindex"));return r.hasAttribute("tabindex")&&(isNaN(t)||t<=-1)||r.hasAttribute("disabled")||r.closest("[inert]")||e==="input"&&r.getAttribute("type")==="radio"&&!r.hasAttribute("checked")||!FZ(r)?!1:(e==="audio"||e==="video")&&r.hasAttribute("controls")||r.hasAttribute("tabindex")||r.hasAttribute("contenteditable")&&r.getAttribute("contenteditable")!=="false"||["button","input","select","textarea","a","audio","video","summary","iframe"].includes(e)?!0:qZ(r)}function WZ(r){var e,t;const n=pP(r),i=(e=n[0])!=null?e:null,o=(t=n[n.length-1])!=null?t:null;return{start:i,end:o}}function HZ(r,e){var t;return((t=r.getRootNode({composed:!0}))==null?void 0:t.host)!==e}function pP(r){const e=new WeakMap,t=[];function n(i){if(i instanceof Element){if(i.hasAttribute("inert")||i.closest("[inert]")||e.has(i))return;e.set(i,!0),!t.includes(i)&&VZ(i)&&t.push(i),i instanceof HTMLSlotElement&&HZ(i,r)&&i.assignedElements({flatten:!0}).forEach(o=>{n(o)}),i.shadowRoot!==null&&i.shadowRoot.mode==="open"&&n(i.shadowRoot)}for(const o of i.children)n(o)}return n(r),t.sort((i,o)=>{const s=Number(i.getAttribute("tabindex"))||0;return(Number(o.getAttribute("tabindex"))||0)-s})}var Zo=class extends pr{constructor(){super(...arguments),this.localize=new js(this),this.open=!1,this.placement="bottom-start",this.disabled=!1,this.stayOpenOnSelect=!1,this.distance=0,this.skidding=0,this.hoist=!1,this.sync=void 0,this.handleKeyDown=r=>{this.open&&r.key==="Escape"&&(r.stopPropagation(),this.hide(),this.focusOnTrigger())},this.handleDocumentKeyDown=r=>{var e;if(r.key==="Escape"&&this.open&&!this.closeWatcher){r.stopPropagation(),this.focusOnTrigger(),this.hide();return}if(r.key==="Tab"){if(this.open&&((e=document.activeElement)==null?void 0:e.tagName.toLowerCase())==="sl-menu-item"){r.preventDefault(),this.hide(),this.focusOnTrigger();return}setTimeout(()=>{var t,n,i;const o=((t=this.containingElement)==null?void 0:t.getRootNode())instanceof ShadowRoot?(i=(n=document.activeElement)==null?void 0:n.shadowRoot)==null?void 0:i.activeElement:document.activeElement;(!this.containingElement||o?.closest(this.containingElement.tagName.toLowerCase())!==this.containingElement)&&this.hide()})}},this.handleDocumentMouseDown=r=>{const e=r.composedPath();this.containingElement&&!e.includes(this.containingElement)&&this.hide()},this.handlePanelSelect=r=>{const e=r.target;!this.stayOpenOnSelect&&e.tagName.toLowerCase()==="sl-menu"&&(this.hide(),this.focusOnTrigger())}}connectedCallback(){super.connectedCallback(),this.containingElement||(this.containingElement=this)}firstUpdated(){this.panel.hidden=!this.open,this.open&&(this.addOpenListeners(),this.popup.active=!0)}disconnectedCallback(){super.disconnectedCallback(),this.removeOpenListeners(),this.hide()}focusOnTrigger(){const r=this.trigger.assignedElements({flatten:!0})[0];typeof r?.focus=="function"&&r.focus()}getMenu(){return this.panel.assignedElements({flatten:!0}).find(r=>r.tagName.toLowerCase()==="sl-menu")}handleTriggerClick(){this.open?this.hide():(this.show(),this.focusOnTrigger())}async handleTriggerKeyDown(r){if([" ","Enter"].includes(r.key)){r.preventDefault(),this.handleTriggerClick();return}const e=this.getMenu();if(e){const t=e.getAllItems(),n=t[0],i=t[t.length-1];["ArrowDown","ArrowUp","Home","End"].includes(r.key)&&(r.preventDefault(),this.open||(this.show(),await this.updateComplete),t.length>0&&this.updateComplete.then(()=>{(r.key==="ArrowDown"||r.key==="Home")&&(e.setCurrentItem(n),n.focus()),(r.key==="ArrowUp"||r.key==="End")&&(e.setCurrentItem(i),i.focus())}))}}handleTriggerKeyUp(r){r.key===" "&&r.preventDefault()}handleTriggerSlotChange(){this.updateAccessibleTrigger()}updateAccessibleTrigger(){const e=this.trigger.assignedElements({flatten:!0}).find(n=>WZ(n).start);let t;if(e){switch(e.tagName.toLowerCase()){case"sl-button":case"sl-icon-button":t=e.button;break;default:t=e}t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded",this.open?"true":"false")}}async show(){if(!this.open)return this.open=!0,Ea(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,Ea(this,"sl-after-hide")}reposition(){this.popup.reposition()}addOpenListeners(){var r;this.panel.addEventListener("sl-select",this.handlePanelSelect),"CloseWatcher"in window?((r=this.closeWatcher)==null||r.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>{this.hide(),this.focusOnTrigger()}):this.panel.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("mousedown",this.handleDocumentMouseDown)}removeOpenListeners(){var r;this.panel&&(this.panel.removeEventListener("sl-select",this.handlePanelSelect),this.panel.removeEventListener("keydown",this.handleKeyDown)),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("mousedown",this.handleDocumentMouseDown),(r=this.closeWatcher)==null||r.destroy()}async handleOpenChange(){if(this.disabled){this.open=!1;return}if(this.updateAccessibleTrigger(),this.open){this.emit("sl-show"),this.addOpenListeners(),await Go(this),this.panel.hidden=!1,this.popup.active=!0;const{keyframes:r,options:e}=ni(this,"dropdown.show",{dir:this.localize.dir()});await $i(this.popup.popup,r,e),this.emit("sl-after-show")}else{this.emit("sl-hide"),this.removeOpenListeners(),await Go(this);const{keyframes:r,options:e}=ni(this,"dropdown.hide",{dir:this.localize.dir()});await $i(this.popup.popup,r,e),this.panel.hidden=!0,this.popup.active=!1,this.emit("sl-after-hide")}}render(){return Ie`
      <sl-popup
        part="base"
        exportparts="popup:base__popup"
        id="dropdown"
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        strategy=${this.hoist?"fixed":"absolute"}
        flip
        shift
        auto-size="vertical"
        auto-size-padding="10"
        sync=${ft(this.sync?this.sync:void 0)}
        class=${br({dropdown:!0,"dropdown--open":this.open})}
      >
        <slot
          name="trigger"
          slot="anchor"
          part="trigger"
          class="dropdown__trigger"
          @click=${this.handleTriggerClick}
          @keydown=${this.handleTriggerKeyDown}
          @keyup=${this.handleTriggerKeyUp}
          @slotchange=${this.handleTriggerSlotChange}
        ></slot>

        <div aria-hidden=${this.open?"false":"true"} aria-labelledby="dropdown">
          <slot part="panel" class="dropdown__panel"></slot>
        </div>
      </sl-popup>
    `}};Zo.styles=[Tr,zZ];Zo.dependencies={"sl-popup":jr};oe([Dt(".dropdown")],Zo.prototype,"popup",2);oe([Dt(".dropdown__trigger")],Zo.prototype,"trigger",2);oe([Dt(".dropdown__panel")],Zo.prototype,"panel",2);oe([he({type:Boolean,reflect:!0})],Zo.prototype,"open",2);oe([he({reflect:!0})],Zo.prototype,"placement",2);oe([he({type:Boolean,reflect:!0})],Zo.prototype,"disabled",2);oe([he({attribute:"stay-open-on-select",type:Boolean,reflect:!0})],Zo.prototype,"stayOpenOnSelect",2);oe([he({attribute:!1})],Zo.prototype,"containingElement",2);oe([he({type:Number})],Zo.prototype,"distance",2);oe([he({type:Number})],Zo.prototype,"skidding",2);oe([he({type:Boolean})],Zo.prototype,"hoist",2);oe([he({reflect:!0})],Zo.prototype,"sync",2);oe([Ut("open",{waitUntilFirstUpdate:!0})],Zo.prototype,"handleOpenChange",1);ln("dropdown.show",{keyframes:[{opacity:0,scale:.9},{opacity:1,scale:1}],options:{duration:100,easing:"ease"}});ln("dropdown.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.9}],options:{duration:100,easing:"ease"}});Zo.define("sl-dropdown");Bi.define("sl-icon");var GZ=Ye`
  :host {
    display: inline-block;
    color: var(--sl-color-neutral-600);
  }

  .icon-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-medium);
    font-size: inherit;
    color: inherit;
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-x-fast) color;
    -webkit-appearance: none;
  }

  .icon-button:hover:not(.icon-button--disabled),
  .icon-button:focus-visible:not(.icon-button--disabled) {
    color: var(--sl-color-primary-600);
  }

  .icon-button:active:not(.icon-button--disabled) {
    color: var(--sl-color-primary-700);
  }

  .icon-button:focus {
    outline: none;
  }

  .icon-button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .icon-button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .icon-button__icon {
    pointer-events: none;
  }
`,Li=class extends pr{constructor(){super(...arguments),this.hasFocus=!1,this.label="",this.disabled=!1}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(r){this.disabled&&(r.preventDefault(),r.stopPropagation())}click(){this.button.click()}focus(r){this.button.focus(r)}blur(){this.button.blur()}render(){const r=!!this.href,e=r?LE`a`:LE`button`;return Mb`
      <${e}
        part="base"
        class=${br({"icon-button":!0,"icon-button--disabled":!r&&this.disabled,"icon-button--focused":this.hasFocus})}
        ?disabled=${ft(r?void 0:this.disabled)}
        type=${ft(r?void 0:"button")}
        href=${ft(r?this.href:void 0)}
        target=${ft(r?this.target:void 0)}
        download=${ft(r?this.download:void 0)}
        rel=${ft(r&&this.target?"noreferrer noopener":void 0)}
        role=${ft(r?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        aria-label="${this.label}"
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @click=${this.handleClick}
      >
        <sl-icon
          class="icon-button__icon"
          name=${ft(this.name)}
          library=${ft(this.library)}
          src=${ft(this.src)}
          aria-hidden="true"
        ></sl-icon>
      </${e}>
    `}};Li.styles=[Tr,GZ];Li.dependencies={"sl-icon":Bi};oe([Dt(".icon-button")],Li.prototype,"button",2);oe([ii()],Li.prototype,"hasFocus",2);oe([he()],Li.prototype,"name",2);oe([he()],Li.prototype,"library",2);oe([he()],Li.prototype,"src",2);oe([he()],Li.prototype,"href",2);oe([he()],Li.prototype,"target",2);oe([he()],Li.prototype,"download",2);oe([he()],Li.prototype,"label",2);oe([he({type:Boolean,reflect:!0})],Li.prototype,"disabled",2);Li.define("sl-icon-button");var YZ=Ye`
  ${OL}

  .button__prefix,
  .button__suffix,
  .button__label {
    display: inline-flex;
    position: relative;
    align-items: center;
  }

  /* We use a hidden input so constraint validation errors work, since they don't appear to show when used with buttons.
    We can't actually hide it, though, otherwise the messages will be suppressed by the browser. */
  .hidden-input {
    all: unset;
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    outline: dotted 1px red;
    opacity: 0;
    z-index: -1;
  }
`,Xc=class extends pr{constructor(){super(...arguments),this.hasSlotController=new fc(this,"[default]","prefix","suffix"),this.hasFocus=!1,this.checked=!1,this.disabled=!1,this.size="medium",this.pill=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","presentation")}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleClick(r){if(this.disabled){r.preventDefault(),r.stopPropagation();return}this.checked=!0}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}focus(r){this.input.focus(r)}blur(){this.input.blur()}render(){return Mb`
      <div part="base" role="presentation">
        <button
          part="${`button${this.checked?" button--checked":""}`}"
          role="radio"
          aria-checked="${this.checked}"
          class=${br({button:!0,"button--default":!0,"button--small":this.size==="small","button--medium":this.size==="medium","button--large":this.size==="large","button--checked":this.checked,"button--disabled":this.disabled,"button--focused":this.hasFocus,"button--outline":!0,"button--pill":this.pill,"button--has-label":this.hasSlotController.test("[default]"),"button--has-prefix":this.hasSlotController.test("prefix"),"button--has-suffix":this.hasSlotController.test("suffix")})}
          aria-disabled=${this.disabled}
          type="button"
          value=${ft(this.value)}
          @blur=${this.handleBlur}
          @focus=${this.handleFocus}
          @click=${this.handleClick}
        >
          <slot name="prefix" part="prefix" class="button__prefix"></slot>
          <slot part="label" class="button__label"></slot>
          <slot name="suffix" part="suffix" class="button__suffix"></slot>
        </button>
      </div>
    `}};Xc.styles=[Tr,YZ];oe([Dt(".button")],Xc.prototype,"input",2);oe([Dt(".hidden-input")],Xc.prototype,"hiddenInput",2);oe([ii()],Xc.prototype,"hasFocus",2);oe([he({type:Boolean,reflect:!0})],Xc.prototype,"checked",2);oe([he()],Xc.prototype,"value",2);oe([he({type:Boolean,reflect:!0})],Xc.prototype,"disabled",2);oe([he({reflect:!0})],Xc.prototype,"size",2);oe([he({type:Boolean,reflect:!0})],Xc.prototype,"pill",2);oe([Ut("disabled",{waitUntilFirstUpdate:!0})],Xc.prototype,"handleDisabledChange",1);Xc.define("sl-radio-button");var ZZ=Ye`
  :host {
    display: block;
  }

  .form-control {
    position: relative;
    border: none;
    padding: 0;
    margin: 0;
  }

  .form-control__label {
    padding: 0;
  }

  .radio-group--required .radio-group__label::after {
    content: var(--sl-input-required-content);
    margin-inline-start: var(--sl-input-required-content-offset);
  }

  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
`,_o=class extends pr{constructor(){super(...arguments),this.formControlController=new bv(this),this.hasSlotController=new fc(this,"help-text","label"),this.customValidityMessage="",this.hasButtonGroup=!1,this.errorMessage="",this.defaultValue="",this.label="",this.helpText="",this.name="option",this.value="",this.size="medium",this.form="",this.required=!1}get validity(){const r=this.required&&!this.value;return this.customValidityMessage!==""?DY:r?RY:xx}get validationMessage(){const r=this.required&&!this.value;return this.customValidityMessage!==""?this.customValidityMessage:r?this.validationInput.validationMessage:""}connectedCallback(){super.connectedCallback(),this.defaultValue=this.value}firstUpdated(){this.formControlController.updateValidity()}getAllRadios(){return[...this.querySelectorAll("sl-radio, sl-radio-button")]}handleRadioClick(r){const e=r.target.closest("sl-radio, sl-radio-button"),t=this.getAllRadios(),n=this.value;!e||e.disabled||(this.value=e.value,t.forEach(i=>i.checked=i===e),this.value!==n&&(this.emit("sl-change"),this.emit("sl-input")))}handleKeyDown(r){var e;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(r.key))return;const t=this.getAllRadios().filter(a=>!a.disabled),n=(e=t.find(a=>a.checked))!=null?e:t[0],i=r.key===" "?0:["ArrowUp","ArrowLeft"].includes(r.key)?-1:1,o=this.value;let s=t.indexOf(n)+i;s<0&&(s=t.length-1),s>t.length-1&&(s=0),this.getAllRadios().forEach(a=>{a.checked=!1,this.hasButtonGroup||a.setAttribute("tabindex","-1")}),this.value=t[s].value,t[s].checked=!0,this.hasButtonGroup?t[s].shadowRoot.querySelector("button").focus():(t[s].setAttribute("tabindex","0"),t[s].focus()),this.value!==o&&(this.emit("sl-change"),this.emit("sl-input")),r.preventDefault()}handleLabelClick(){const r=this.getAllRadios(),t=r.find(n=>n.checked)||r[0];t&&t.focus()}handleInvalid(r){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(r)}async syncRadioElements(){var r,e;const t=this.getAllRadios();if(await Promise.all(t.map(async n=>{await n.updateComplete,n.checked=n.value===this.value,n.size=this.size})),this.hasButtonGroup=t.some(n=>n.tagName.toLowerCase()==="sl-radio-button"),t.length>0&&!t.some(n=>n.checked))if(this.hasButtonGroup){const n=(r=t[0].shadowRoot)==null?void 0:r.querySelector("button");n&&n.setAttribute("tabindex","0")}else t[0].setAttribute("tabindex","0");if(this.hasButtonGroup){const n=(e=this.shadowRoot)==null?void 0:e.querySelector("sl-button-group");n&&(n.disableRole=!0)}}syncRadios(){if(customElements.get("sl-radio")&&customElements.get("sl-radio-button")){this.syncRadioElements();return}customElements.get("sl-radio")?this.syncRadioElements():customElements.whenDefined("sl-radio").then(()=>this.syncRadios()),customElements.get("sl-radio-button")?this.syncRadioElements():customElements.whenDefined("sl-radio-button").then(()=>this.syncRadios())}updateCheckedRadio(){this.getAllRadios().forEach(e=>e.checked=e.value===this.value),this.formControlController.setValidity(this.validity.valid)}handleSizeChange(){this.syncRadios()}handleValueChange(){this.hasUpdated&&this.updateCheckedRadio()}checkValidity(){const r=this.required&&!this.value,e=this.customValidityMessage!=="";return r||e?(this.formControlController.emitInvalidEvent(),!1):!0}getForm(){return this.formControlController.getForm()}reportValidity(){const r=this.validity.valid;return this.errorMessage=this.customValidityMessage||r?"":this.validationInput.validationMessage,this.formControlController.setValidity(r),this.validationInput.hidden=!0,clearTimeout(this.validationTimeout),r||(this.validationInput.hidden=!1,this.validationInput.reportValidity(),this.validationTimeout=setTimeout(()=>this.validationInput.hidden=!0,1e4)),r}setCustomValidity(r=""){this.customValidityMessage=r,this.errorMessage=r,this.validationInput.setCustomValidity(r),this.formControlController.updateValidity()}render(){const r=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!r,n=this.helpText?!0:!!e,i=Ie`
      <slot @slotchange=${this.syncRadios} @click=${this.handleRadioClick} @keydown=${this.handleKeyDown}></slot>
    `;return Ie`
      <fieldset
        part="form-control"
        class=${br({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--radio-group":!0,"form-control--has-label":t,"form-control--has-help-text":n})}
        role="radiogroup"
        aria-labelledby="label"
        aria-describedby="help-text"
        aria-errormessage="error-message"
      >
        <label
          part="form-control-label"
          id="label"
          class="form-control__label"
          aria-hidden=${t?"false":"true"}
          @click=${this.handleLabelClick}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div class="visually-hidden">
            <div id="error-message" aria-live="assertive">${this.errorMessage}</div>
            <label class="radio-group__validation">
              <input
                type="text"
                class="radio-group__validation-input"
                ?required=${this.required}
                tabindex="-1"
                hidden
                @invalid=${this.handleInvalid}
              />
            </label>
          </div>

          ${this.hasButtonGroup?Ie`
                <sl-button-group part="button-group" exportparts="base:button-group__base" role="presentation">
                  ${i}
                </sl-button-group>
              `:i}
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </fieldset>
    `}};_o.styles=[Tr,u_,ZZ];_o.dependencies={"sl-button-group":wv};oe([Dt("slot:not([name])")],_o.prototype,"defaultSlot",2);oe([Dt(".radio-group__validation-input")],_o.prototype,"validationInput",2);oe([ii()],_o.prototype,"hasButtonGroup",2);oe([ii()],_o.prototype,"errorMessage",2);oe([ii()],_o.prototype,"defaultValue",2);oe([he()],_o.prototype,"label",2);oe([he({attribute:"help-text"})],_o.prototype,"helpText",2);oe([he()],_o.prototype,"name",2);oe([he({reflect:!0})],_o.prototype,"value",2);oe([he({reflect:!0})],_o.prototype,"size",2);oe([he({reflect:!0})],_o.prototype,"form",2);oe([he({type:Boolean,reflect:!0})],_o.prototype,"required",2);oe([Ut("size",{waitUntilFirstUpdate:!0})],_o.prototype,"handleSizeChange",1);oe([Ut("value")],_o.prototype,"handleValueChange",1);_o.define("sl-radio-group");var JZ=Ye`
  :host {
    display: block;
  }

  .input {
    flex: 1 1 auto;
    display: inline-flex;
    align-items: stretch;
    justify-content: start;
    position: relative;
    width: 100%;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    letter-spacing: var(--sl-input-letter-spacing);
    vertical-align: middle;
    overflow: hidden;
    cursor: text;
    transition:
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) border,
      var(--sl-transition-fast) box-shadow,
      var(--sl-transition-fast) background-color;
  }

  /* Standard inputs */
  .input--standard {
    background-color: var(--sl-input-background-color);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
  }

  .input--standard:hover:not(.input--disabled) {
    background-color: var(--sl-input-background-color-hover);
    border-color: var(--sl-input-border-color-hover);
  }

  .input--standard.input--focused:not(.input--disabled) {
    background-color: var(--sl-input-background-color-focus);
    border-color: var(--sl-input-border-color-focus);
    box-shadow: 0 0 0 var(--sl-focus-ring-width) var(--sl-input-focus-ring-color);
  }

  .input--standard.input--focused:not(.input--disabled) .input__control {
    color: var(--sl-input-color-focus);
  }

  .input--standard.input--disabled {
    background-color: var(--sl-input-background-color-disabled);
    border-color: var(--sl-input-border-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .input--standard.input--disabled .input__control {
    color: var(--sl-input-color-disabled);
  }

  .input--standard.input--disabled .input__control::placeholder {
    color: var(--sl-input-placeholder-color-disabled);
  }

  /* Filled inputs */
  .input--filled {
    border: none;
    background-color: var(--sl-input-filled-background-color);
    color: var(--sl-input-color);
  }

  .input--filled:hover:not(.input--disabled) {
    background-color: var(--sl-input-filled-background-color-hover);
  }

  .input--filled.input--focused:not(.input--disabled) {
    background-color: var(--sl-input-filled-background-color-focus);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .input--filled.input--disabled {
    background-color: var(--sl-input-filled-background-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .input__control {
    flex: 1 1 auto;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    min-width: 0;
    height: 100%;
    color: var(--sl-input-color);
    border: none;
    background: inherit;
    box-shadow: none;
    padding: 0;
    margin: 0;
    cursor: inherit;
    -webkit-appearance: none;
  }

  .input__control::-webkit-search-decoration,
  .input__control::-webkit-search-cancel-button,
  .input__control::-webkit-search-results-button,
  .input__control::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }

  .input__control:-webkit-autofill,
  .input__control:-webkit-autofill:hover,
  .input__control:-webkit-autofill:focus,
  .input__control:-webkit-autofill:active {
    box-shadow: 0 0 0 var(--sl-input-height-large) var(--sl-input-background-color-hover) inset !important;
    -webkit-text-fill-color: var(--sl-color-primary-500);
    caret-color: var(--sl-input-color);
  }

  .input--filled .input__control:-webkit-autofill,
  .input--filled .input__control:-webkit-autofill:hover,
  .input--filled .input__control:-webkit-autofill:focus,
  .input--filled .input__control:-webkit-autofill:active {
    box-shadow: 0 0 0 var(--sl-input-height-large) var(--sl-input-filled-background-color) inset !important;
  }

  .input__control::placeholder {
    color: var(--sl-input-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }

  .input:hover:not(.input--disabled) .input__control {
    color: var(--sl-input-color-hover);
  }

  .input__control:focus {
    outline: none;
  }

  .input__prefix,
  .input__suffix {
    display: inline-flex;
    flex: 0 0 auto;
    align-items: center;
    cursor: default;
  }

  .input__prefix ::slotted(sl-icon),
  .input__suffix ::slotted(sl-icon) {
    color: var(--sl-input-icon-color);
  }

  /*
   * Size modifiers
   */

  .input--small {
    border-radius: var(--sl-input-border-radius-small);
    font-size: var(--sl-input-font-size-small);
    height: var(--sl-input-height-small);
  }

  .input--small .input__control {
    height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    padding: 0 var(--sl-input-spacing-small);
  }

  .input--small .input__clear,
  .input--small .input__password-toggle {
    width: calc(1em + var(--sl-input-spacing-small) * 2);
  }

  .input--small .input__prefix ::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-small);
  }

  .input--small .input__suffix ::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-small);
  }

  .input--medium {
    border-radius: var(--sl-input-border-radius-medium);
    font-size: var(--sl-input-font-size-medium);
    height: var(--sl-input-height-medium);
  }

  .input--medium .input__control {
    height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    padding: 0 var(--sl-input-spacing-medium);
  }

  .input--medium .input__clear,
  .input--medium .input__password-toggle {
    width: calc(1em + var(--sl-input-spacing-medium) * 2);
  }

  .input--medium .input__prefix ::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-medium);
  }

  .input--medium .input__suffix ::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-medium);
  }

  .input--large {
    border-radius: var(--sl-input-border-radius-large);
    font-size: var(--sl-input-font-size-large);
    height: var(--sl-input-height-large);
  }

  .input--large .input__control {
    height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    padding: 0 var(--sl-input-spacing-large);
  }

  .input--large .input__clear,
  .input--large .input__password-toggle {
    width: calc(1em + var(--sl-input-spacing-large) * 2);
  }

  .input--large .input__prefix ::slotted(*) {
    margin-inline-start: var(--sl-input-spacing-large);
  }

  .input--large .input__suffix ::slotted(*) {
    margin-inline-end: var(--sl-input-spacing-large);
  }

  /*
   * Pill modifier
   */

  .input--pill.input--small {
    border-radius: var(--sl-input-height-small);
  }

  .input--pill.input--medium {
    border-radius: var(--sl-input-height-medium);
  }

  .input--pill.input--large {
    border-radius: var(--sl-input-height-large);
  }

  /*
   * Clearable + Password Toggle
   */

  .input__clear,
  .input__password-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: inherit;
    color: var(--sl-input-icon-color);
    border: none;
    background: none;
    padding: 0;
    transition: var(--sl-transition-fast) color;
    cursor: pointer;
  }

  .input__clear:hover,
  .input__password-toggle:hover {
    color: var(--sl-input-icon-color-hover);
  }

  .input__clear:focus,
  .input__password-toggle:focus {
    outline: none;
  }

  /* Don't show the browser's password toggle in Edge */
  ::-ms-reveal {
    display: none;
  }

  /* Hide the built-in number spinner */
  .input--no-spin-buttons input[type='number']::-webkit-outer-spin-button,
  .input--no-spin-buttons input[type='number']::-webkit-inner-spin-button {
    -webkit-appearance: none;
    display: none;
  }

  .input--no-spin-buttons input[type='number'] {
    -moz-appearance: textfield;
  }
`,Ht=class extends pr{constructor(){super(...arguments),this.formControlController=new bv(this,{assumeInteractionOn:["sl-blur","sl-input"]}),this.hasSlotController=new fc(this,"help-text","label"),this.localize=new js(this),this.hasFocus=!1,this.title="",this.__numberInput=Object.assign(document.createElement("input"),{type:"number"}),this.__dateInput=Object.assign(document.createElement("input"),{type:"date"}),this.type="text",this.name="",this.value="",this.defaultValue="",this.size="medium",this.filled=!1,this.pill=!1,this.label="",this.helpText="",this.clearable=!1,this.disabled=!1,this.placeholder="",this.readonly=!1,this.passwordToggle=!1,this.passwordVisible=!1,this.noSpinButtons=!1,this.form="",this.required=!1,this.spellcheck=!0}get valueAsDate(){var r;return this.__dateInput.type=this.type,this.__dateInput.value=this.value,((r=this.input)==null?void 0:r.valueAsDate)||this.__dateInput.valueAsDate}set valueAsDate(r){this.__dateInput.type=this.type,this.__dateInput.valueAsDate=r,this.value=this.__dateInput.value}get valueAsNumber(){var r;return this.__numberInput.value=this.value,((r=this.input)==null?void 0:r.valueAsNumber)||this.__numberInput.valueAsNumber}set valueAsNumber(r){this.__numberInput.valueAsNumber=r,this.value=this.__numberInput.value}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleChange(){this.value=this.input.value,this.emit("sl-change")}handleClearClick(r){r.preventDefault(),this.value!==""&&(this.value="",this.emit("sl-clear"),this.emit("sl-input"),this.emit("sl-change")),this.input.focus()}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleInput(){this.value=this.input.value,this.formControlController.updateValidity(),this.emit("sl-input")}handleInvalid(r){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(r)}handleKeyDown(r){const e=r.metaKey||r.ctrlKey||r.shiftKey||r.altKey;r.key==="Enter"&&!e&&setTimeout(()=>{!r.defaultPrevented&&!r.isComposing&&this.formControlController.submit()})}handlePasswordToggle(){this.passwordVisible=!this.passwordVisible}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}handleStepChange(){this.input.step=String(this.step),this.formControlController.updateValidity()}async handleValueChange(){await this.updateComplete,this.formControlController.updateValidity()}focus(r){this.input.focus(r)}blur(){this.input.blur()}select(){this.input.select()}setSelectionRange(r,e,t="none"){this.input.setSelectionRange(r,e,t)}setRangeText(r,e,t,n="preserve"){const i=e??this.input.selectionStart,o=t??this.input.selectionEnd;this.input.setRangeText(r,i,o,n),this.value!==this.input.value&&(this.value=this.input.value)}showPicker(){"showPicker"in HTMLInputElement.prototype&&this.input.showPicker()}stepUp(){this.input.stepUp(),this.value!==this.input.value&&(this.value=this.input.value)}stepDown(){this.input.stepDown(),this.value!==this.input.value&&(this.value=this.input.value)}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(r){this.input.setCustomValidity(r),this.formControlController.updateValidity()}render(){const r=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!r,n=this.helpText?!0:!!e,o=this.clearable&&!this.disabled&&!this.readonly&&(typeof this.value=="number"||this.value.length>0);return Ie`
      <div
        part="form-control"
        class=${br({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-label":t,"form-control--has-help-text":n})}
      >
        <label
          part="form-control-label"
          class="form-control__label"
          for="input"
          aria-hidden=${t?"false":"true"}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div
            part="base"
            class=${br({input:!0,"input--small":this.size==="small","input--medium":this.size==="medium","input--large":this.size==="large","input--pill":this.pill,"input--standard":!this.filled,"input--filled":this.filled,"input--disabled":this.disabled,"input--focused":this.hasFocus,"input--empty":!this.value,"input--no-spin-buttons":this.noSpinButtons})}
          >
            <span part="prefix" class="input__prefix">
              <slot name="prefix"></slot>
            </span>

            <input
              part="input"
              id="input"
              class="input__control"
              type=${this.type==="password"&&this.passwordVisible?"text":this.type}
              title=${this.title}
              name=${ft(this.name)}
              ?disabled=${this.disabled}
              ?readonly=${this.readonly}
              ?required=${this.required}
              placeholder=${ft(this.placeholder)}
              minlength=${ft(this.minlength)}
              maxlength=${ft(this.maxlength)}
              min=${ft(this.min)}
              max=${ft(this.max)}
              step=${ft(this.step)}
              .value=${yw(this.value)}
              autocapitalize=${ft(this.autocapitalize)}
              autocomplete=${ft(this.autocomplete)}
              autocorrect=${ft(this.autocorrect)}
              ?autofocus=${this.autofocus}
              spellcheck=${this.spellcheck}
              pattern=${ft(this.pattern)}
              enterkeyhint=${ft(this.enterkeyhint)}
              inputmode=${ft(this.inputmode)}
              aria-describedby="help-text"
              @change=${this.handleChange}
              @input=${this.handleInput}
              @invalid=${this.handleInvalid}
              @keydown=${this.handleKeyDown}
              @focus=${this.handleFocus}
              @blur=${this.handleBlur}
            />

            ${o?Ie`
                  <button
                    part="clear-button"
                    class="input__clear"
                    type="button"
                    aria-label=${this.localize.term("clearEntry")}
                    @click=${this.handleClearClick}
                    tabindex="-1"
                  >
                    <slot name="clear-icon">
                      <sl-icon name="x-circle-fill" library="system"></sl-icon>
                    </slot>
                  </button>
                `:""}
            ${this.passwordToggle&&!this.disabled?Ie`
                  <button
                    part="password-toggle-button"
                    class="input__password-toggle"
                    type="button"
                    aria-label=${this.localize.term(this.passwordVisible?"hidePassword":"showPassword")}
                    @click=${this.handlePasswordToggle}
                    tabindex="-1"
                  >
                    ${this.passwordVisible?Ie`
                          <slot name="show-password-icon">
                            <sl-icon name="eye-slash" library="system"></sl-icon>
                          </slot>
                        `:Ie`
                          <slot name="hide-password-icon">
                            <sl-icon name="eye" library="system"></sl-icon>
                          </slot>
                        `}
                  </button>
                `:""}

            <span part="suffix" class="input__suffix">
              <slot name="suffix"></slot>
            </span>
          </div>
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Ht.styles=[Tr,u_,JZ];Ht.dependencies={"sl-icon":Bi};oe([Dt(".input__control")],Ht.prototype,"input",2);oe([ii()],Ht.prototype,"hasFocus",2);oe([he()],Ht.prototype,"title",2);oe([he({reflect:!0})],Ht.prototype,"type",2);oe([he()],Ht.prototype,"name",2);oe([he()],Ht.prototype,"value",2);oe([$x()],Ht.prototype,"defaultValue",2);oe([he({reflect:!0})],Ht.prototype,"size",2);oe([he({type:Boolean,reflect:!0})],Ht.prototype,"filled",2);oe([he({type:Boolean,reflect:!0})],Ht.prototype,"pill",2);oe([he()],Ht.prototype,"label",2);oe([he({attribute:"help-text"})],Ht.prototype,"helpText",2);oe([he({type:Boolean})],Ht.prototype,"clearable",2);oe([he({type:Boolean,reflect:!0})],Ht.prototype,"disabled",2);oe([he()],Ht.prototype,"placeholder",2);oe([he({type:Boolean,reflect:!0})],Ht.prototype,"readonly",2);oe([he({attribute:"password-toggle",type:Boolean})],Ht.prototype,"passwordToggle",2);oe([he({attribute:"password-visible",type:Boolean})],Ht.prototype,"passwordVisible",2);oe([he({attribute:"no-spin-buttons",type:Boolean})],Ht.prototype,"noSpinButtons",2);oe([he({reflect:!0})],Ht.prototype,"form",2);oe([he({type:Boolean,reflect:!0})],Ht.prototype,"required",2);oe([he()],Ht.prototype,"pattern",2);oe([he({type:Number})],Ht.prototype,"minlength",2);oe([he({type:Number})],Ht.prototype,"maxlength",2);oe([he()],Ht.prototype,"min",2);oe([he()],Ht.prototype,"max",2);oe([he()],Ht.prototype,"step",2);oe([he()],Ht.prototype,"autocapitalize",2);oe([he()],Ht.prototype,"autocorrect",2);oe([he()],Ht.prototype,"autocomplete",2);oe([he({type:Boolean})],Ht.prototype,"autofocus",2);oe([he()],Ht.prototype,"enterkeyhint",2);oe([he({type:Boolean,converter:{fromAttribute:r=>!(!r||r==="false"),toAttribute:r=>r?"true":"false"}})],Ht.prototype,"spellcheck",2);oe([he()],Ht.prototype,"inputmode",2);oe([Ut("disabled",{waitUntilFirstUpdate:!0})],Ht.prototype,"handleDisabledChange",1);oe([Ut("step",{waitUntilFirstUpdate:!0})],Ht.prototype,"handleStepChange",1);oe([Ut("value",{waitUntilFirstUpdate:!0})],Ht.prototype,"handleValueChange",1);Ht.define("sl-input");var XZ=Ye`
  :host {
    display: inline-block;
  }

  .tab {
    display: inline-flex;
    align-items: center;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-semibold);
    border-radius: var(--sl-border-radius-medium);
    color: var(--sl-color-neutral-600);
    padding: var(--sl-spacing-medium) var(--sl-spacing-large);
    white-space: nowrap;
    user-select: none;
    -webkit-user-select: none;
    cursor: pointer;
    transition:
      var(--transition-speed) box-shadow,
      var(--transition-speed) color;
  }

  .tab:hover:not(.tab--disabled) {
    color: var(--sl-color-primary-600);
  }

  :host(:focus) {
    outline: transparent;
  }

  :host(:focus-visible):not([disabled]) {
    color: var(--sl-color-primary-600);
  }

  :host(:focus-visible) {
    outline: var(--sl-focus-ring);
    outline-offset: calc(-1 * var(--sl-focus-ring-width) - var(--sl-focus-ring-offset));
  }

  .tab.tab--active:not(.tab--disabled) {
    color: var(--sl-color-primary-600);
  }

  .tab.tab--closable {
    padding-inline-end: var(--sl-spacing-small);
  }

  .tab.tab--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .tab__close-button {
    font-size: var(--sl-font-size-small);
    margin-inline-start: var(--sl-spacing-small);
  }

  .tab__close-button::part(base) {
    padding: var(--sl-spacing-3x-small);
  }

  @media (forced-colors: active) {
    .tab.tab--active:not(.tab--disabled) {
      outline: solid 1px transparent;
      outline-offset: -3px;
    }
  }
`,QZ=0,Qc=class extends pr{constructor(){super(...arguments),this.localize=new js(this),this.attrId=++QZ,this.componentId=`sl-tab-${this.attrId}`,this.panel="",this.active=!1,this.closable=!1,this.disabled=!1,this.tabIndex=0}connectedCallback(){super.connectedCallback(),this.setAttribute("role","tab")}handleCloseClick(r){r.stopPropagation(),this.emit("sl-close")}handleActiveChange(){this.setAttribute("aria-selected",this.active?"true":"false")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false"),this.disabled&&!this.active?this.tabIndex=-1:this.tabIndex=0}render(){return this.id=this.id.length>0?this.id:this.componentId,Ie`
      <div
        part="base"
        class=${br({tab:!0,"tab--active":this.active,"tab--closable":this.closable,"tab--disabled":this.disabled})}
      >
        <slot></slot>
        ${this.closable?Ie`
              <sl-icon-button
                part="close-button"
                exportparts="base:close-button__base"
                name="x-lg"
                library="system"
                label=${this.localize.term("close")}
                class="tab__close-button"
                @click=${this.handleCloseClick}
                tabindex="-1"
              ></sl-icon-button>
            `:""}
      </div>
    `}};Qc.styles=[Tr,XZ];Qc.dependencies={"sl-icon-button":Li};oe([Dt(".tab")],Qc.prototype,"tab",2);oe([he({reflect:!0})],Qc.prototype,"panel",2);oe([he({type:Boolean,reflect:!0})],Qc.prototype,"active",2);oe([he({type:Boolean,reflect:!0})],Qc.prototype,"closable",2);oe([he({type:Boolean,reflect:!0})],Qc.prototype,"disabled",2);oe([he({type:Number,reflect:!0})],Qc.prototype,"tabIndex",2);oe([Ut("active")],Qc.prototype,"handleActiveChange",1);oe([Ut("disabled")],Qc.prototype,"handleDisabledChange",1);Qc.define("sl-tab");var eJ=Ye`
  :host {
    --padding: 0;

    display: none;
  }

  :host([active]) {
    display: block;
  }

  .tab-panel {
    display: block;
    padding: var(--padding);
  }
`,tJ=0,f_=class extends pr{constructor(){super(...arguments),this.attrId=++tJ,this.componentId=`sl-tab-panel-${this.attrId}`,this.name="",this.active=!1}connectedCallback(){super.connectedCallback(),this.id=this.id.length>0?this.id:this.componentId,this.setAttribute("role","tabpanel")}handleActiveChange(){this.setAttribute("aria-hidden",this.active?"false":"true")}render(){return Ie`
      <slot
        part="base"
        class=${br({"tab-panel":!0,"tab-panel--active":this.active})}
      ></slot>
    `}};f_.styles=[Tr,eJ];oe([he({reflect:!0})],f_.prototype,"name",2);oe([he({type:Boolean,reflect:!0})],f_.prototype,"active",2);oe([Ut("active")],f_.prototype,"handleActiveChange",1);f_.define("sl-tab-panel");var rJ=Ye`
  :host {
    --indicator-color: var(--sl-color-primary-600);
    --track-color: var(--sl-color-neutral-200);
    --track-width: 2px;

    display: block;
  }

  .tab-group {
    display: flex;
    border-radius: 0;
  }

  .tab-group__tabs {
    display: flex;
    position: relative;
  }

  .tab-group__indicator {
    position: absolute;
    transition:
      var(--sl-transition-fast) translate ease,
      var(--sl-transition-fast) width ease;
  }

  .tab-group--has-scroll-controls .tab-group__nav-container {
    position: relative;
    padding: 0 var(--sl-spacing-x-large);
  }

  .tab-group__body {
    display: block;
    overflow: auto;
  }

  .tab-group__scroll-button {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    bottom: 0;
    width: var(--sl-spacing-x-large);
  }

  .tab-group__scroll-button--start {
    left: 0;
  }

  .tab-group__scroll-button--end {
    right: 0;
  }

  .tab-group--rtl .tab-group__scroll-button--start {
    left: auto;
    right: 0;
  }

  .tab-group--rtl .tab-group__scroll-button--end {
    left: 0;
    right: auto;
  }

  /*
   * Top
   */

  .tab-group--top {
    flex-direction: column;
  }

  .tab-group--top .tab-group__nav-container {
    order: 1;
  }

  .tab-group--top .tab-group__nav {
    display: flex;
    overflow-x: auto;

    /* Hide scrollbar in Firefox */
    scrollbar-width: none;
  }

  /* Hide scrollbar in Chrome/Safari */
  .tab-group--top .tab-group__nav::-webkit-scrollbar {
    width: 0;
    height: 0;
  }

  .tab-group--top .tab-group__tabs {
    flex: 1 1 auto;
    position: relative;
    flex-direction: row;
    border-bottom: solid var(--track-width) var(--track-color);
  }

  .tab-group--top .tab-group__indicator {
    bottom: calc(-1 * var(--track-width));
    border-bottom: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--top .tab-group__body {
    order: 2;
  }

  .tab-group--top ::slotted(sl-tab-panel) {
    --padding: var(--sl-spacing-medium) 0;
  }

  /*
   * Bottom
   */

  .tab-group--bottom {
    flex-direction: column;
  }

  .tab-group--bottom .tab-group__nav-container {
    order: 2;
  }

  .tab-group--bottom .tab-group__nav {
    display: flex;
    overflow-x: auto;

    /* Hide scrollbar in Firefox */
    scrollbar-width: none;
  }

  /* Hide scrollbar in Chrome/Safari */
  .tab-group--bottom .tab-group__nav::-webkit-scrollbar {
    width: 0;
    height: 0;
  }

  .tab-group--bottom .tab-group__tabs {
    flex: 1 1 auto;
    position: relative;
    flex-direction: row;
    border-top: solid var(--track-width) var(--track-color);
  }

  .tab-group--bottom .tab-group__indicator {
    top: calc(-1 * var(--track-width));
    border-top: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--bottom .tab-group__body {
    order: 1;
  }

  .tab-group--bottom ::slotted(sl-tab-panel) {
    --padding: var(--sl-spacing-medium) 0;
  }

  /*
   * Start
   */

  .tab-group--start {
    flex-direction: row;
  }

  .tab-group--start .tab-group__nav-container {
    order: 1;
  }

  .tab-group--start .tab-group__tabs {
    flex: 0 0 auto;
    flex-direction: column;
    border-inline-end: solid var(--track-width) var(--track-color);
  }

  .tab-group--start .tab-group__indicator {
    right: calc(-1 * var(--track-width));
    border-right: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--start.tab-group--rtl .tab-group__indicator {
    right: auto;
    left: calc(-1 * var(--track-width));
  }

  .tab-group--start .tab-group__body {
    flex: 1 1 auto;
    order: 2;
  }

  .tab-group--start ::slotted(sl-tab-panel) {
    --padding: 0 var(--sl-spacing-medium);
  }

  /*
   * End
   */

  .tab-group--end {
    flex-direction: row;
  }

  .tab-group--end .tab-group__nav-container {
    order: 2;
  }

  .tab-group--end .tab-group__tabs {
    flex: 0 0 auto;
    flex-direction: column;
    border-left: solid var(--track-width) var(--track-color);
  }

  .tab-group--end .tab-group__indicator {
    left: calc(-1 * var(--track-width));
    border-inline-start: solid var(--track-width) var(--indicator-color);
  }

  .tab-group--end.tab-group--rtl .tab-group__indicator {
    right: calc(-1 * var(--track-width));
    left: auto;
  }

  .tab-group--end .tab-group__body {
    flex: 1 1 auto;
    order: 1;
  }

  .tab-group--end ::slotted(sl-tab-panel) {
    --padding: 0 var(--sl-spacing-medium);
  }
`;function nJ(r,e){return{top:Math.round(r.getBoundingClientRect().top-e.getBoundingClientRect().top),left:Math.round(r.getBoundingClientRect().left-e.getBoundingClientRect().left)}}var yP=new Set;function iJ(){const r=document.documentElement.clientWidth;return Math.abs(window.innerWidth-r)}function oJ(){const r=Number(getComputedStyle(document.body).paddingRight.replace(/px/,""));return isNaN(r)||!r?0:r}function jb(r){if(yP.add(r),!document.documentElement.classList.contains("sl-scroll-lock")){const e=iJ()+oJ();let t=getComputedStyle(document.documentElement).scrollbarGutter;(!t||t==="auto")&&(t="stable"),e<2&&(t=""),document.documentElement.style.setProperty("--sl-scroll-lock-gutter",t),document.documentElement.classList.add("sl-scroll-lock"),document.documentElement.style.setProperty("--sl-scroll-lock-size",`${e}px`)}}function Nb(r){yP.delete(r),yP.size===0&&(document.documentElement.classList.remove("sl-scroll-lock"),document.documentElement.style.removeProperty("--sl-scroll-lock-size"))}function d3(r,e,t="vertical",n="smooth"){const i=nJ(r,e),o=i.top+e.scrollTop,s=i.left+e.scrollLeft,a=e.scrollLeft,l=e.scrollLeft+e.offsetWidth,d=e.scrollTop,c=e.scrollTop+e.offsetHeight;(t==="horizontal"||t==="both")&&(s<a?e.scrollTo({left:s,behavior:n}):s+r.clientWidth>l&&e.scrollTo({left:s-e.offsetWidth+r.clientWidth,behavior:n})),(t==="vertical"||t==="both")&&(o<d?e.scrollTo({top:o,behavior:n}):o+r.clientHeight>c&&e.scrollTo({top:o-e.offsetHeight+r.clientHeight,behavior:n}))}var Sa=class extends pr{constructor(){super(...arguments),this.localize=new js(this),this.tabs=[],this.focusableTabs=[],this.panels=[],this.hasScrollControls=!1,this.placement="top",this.activation="auto",this.noScrollControls=!1}connectedCallback(){const r=Promise.all([customElements.whenDefined("sl-tab"),customElements.whenDefined("sl-tab-panel")]);super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>{this.repositionIndicator(),this.updateScrollControls()}),this.mutationObserver=new MutationObserver(e=>{e.some(t=>!["aria-labelledby","aria-controls"].includes(t.attributeName))&&setTimeout(()=>this.setAriaLabels()),e.some(t=>t.attributeName==="disabled")&&this.syncTabsAndPanels()}),this.updateComplete.then(()=>{this.syncTabsAndPanels(),this.mutationObserver.observe(this,{attributes:!0,childList:!0,subtree:!0}),this.resizeObserver.observe(this.nav),r.then(()=>{new IntersectionObserver((t,n)=>{var i;t[0].intersectionRatio>0&&(this.setAriaLabels(),this.setActiveTab((i=this.getActiveTab())!=null?i:this.tabs[0],{emitEvents:!1}),n.unobserve(t[0].target))}).observe(this.tabGroup)})})}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver.disconnect(),this.resizeObserver.unobserve(this.nav)}getAllTabs(){return this.shadowRoot.querySelector('slot[name="nav"]').assignedElements()}getAllPanels(){return[...this.body.assignedElements()].filter(r=>r.tagName.toLowerCase()==="sl-tab-panel")}getActiveTab(){return this.tabs.find(r=>r.active)}handleClick(r){const t=r.target.closest("sl-tab");t?.closest("sl-tab-group")===this&&t!==null&&this.setActiveTab(t,{scrollBehavior:"smooth"})}handleKeyDown(r){const t=r.target.closest("sl-tab");if(t?.closest("sl-tab-group")===this&&(["Enter"," "].includes(r.key)&&t!==null&&(this.setActiveTab(t,{scrollBehavior:"smooth"}),r.preventDefault()),["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(r.key))){const i=this.tabs.find(a=>a.matches(":focus")),o=this.matches(":dir(rtl)");let s=null;if(i?.tagName.toLowerCase()==="sl-tab"){if(r.key==="Home")s=this.focusableTabs[0];else if(r.key==="End")s=this.focusableTabs[this.focusableTabs.length-1];else if(["top","bottom"].includes(this.placement)&&r.key===(o?"ArrowRight":"ArrowLeft")||["start","end"].includes(this.placement)&&r.key==="ArrowUp"){const a=this.tabs.findIndex(l=>l===i);s=this.findNextFocusableTab(a,"backward")}else if(["top","bottom"].includes(this.placement)&&r.key===(o?"ArrowLeft":"ArrowRight")||["start","end"].includes(this.placement)&&r.key==="ArrowDown"){const a=this.tabs.findIndex(l=>l===i);s=this.findNextFocusableTab(a,"forward")}if(!s)return;s.tabIndex=0,s.focus({preventScroll:!0}),this.activation==="auto"?this.setActiveTab(s,{scrollBehavior:"smooth"}):this.tabs.forEach(a=>{a.tabIndex=a===s?0:-1}),["top","bottom"].includes(this.placement)&&d3(s,this.nav,"horizontal"),r.preventDefault()}}}handleScrollToStart(){this.nav.scroll({left:this.localize.dir()==="rtl"?this.nav.scrollLeft+this.nav.clientWidth:this.nav.scrollLeft-this.nav.clientWidth,behavior:"smooth"})}handleScrollToEnd(){this.nav.scroll({left:this.localize.dir()==="rtl"?this.nav.scrollLeft-this.nav.clientWidth:this.nav.scrollLeft+this.nav.clientWidth,behavior:"smooth"})}setActiveTab(r,e){if(e=Fu({emitEvents:!0,scrollBehavior:"auto"},e),r!==this.activeTab&&!r.disabled){const t=this.activeTab;this.activeTab=r,this.tabs.forEach(n=>{n.active=n===this.activeTab,n.tabIndex=n===this.activeTab?0:-1}),this.panels.forEach(n=>{var i;return n.active=n.name===((i=this.activeTab)==null?void 0:i.panel)}),this.syncIndicator(),["top","bottom"].includes(this.placement)&&d3(this.activeTab,this.nav,"horizontal",e.scrollBehavior),e.emitEvents&&(t&&this.emit("sl-tab-hide",{detail:{name:t.panel}}),this.emit("sl-tab-show",{detail:{name:this.activeTab.panel}}))}}setAriaLabels(){this.tabs.forEach(r=>{const e=this.panels.find(t=>t.name===r.panel);e&&(r.setAttribute("aria-controls",e.getAttribute("id")),e.setAttribute("aria-labelledby",r.getAttribute("id")))})}repositionIndicator(){const r=this.getActiveTab();if(!r)return;const e=r.clientWidth,t=r.clientHeight,n=this.matches(":dir(rtl)"),i=this.getAllTabs(),s=i.slice(0,i.indexOf(r)).reduce((a,l)=>({left:a.left+l.clientWidth,top:a.top+l.clientHeight}),{left:0,top:0});switch(this.placement){case"top":case"bottom":this.indicator.style.width=`${e}px`,this.indicator.style.height="auto",this.indicator.style.translate=n?`${-1*s.left}px`:`${s.left}px`;break;case"start":case"end":this.indicator.style.width="auto",this.indicator.style.height=`${t}px`,this.indicator.style.translate=`0 ${s.top}px`;break}}syncTabsAndPanels(){this.tabs=this.getAllTabs(),this.focusableTabs=this.tabs.filter(r=>!r.disabled),this.panels=this.getAllPanels(),this.syncIndicator(),this.updateComplete.then(()=>this.updateScrollControls())}findNextFocusableTab(r,e){let t=null;const n=e==="forward"?1:-1;let i=r+n;for(;r<this.tabs.length;){if(t=this.tabs[i]||null,t===null){e==="forward"?t=this.focusableTabs[0]:t=this.focusableTabs[this.focusableTabs.length-1];break}if(!t.disabled)break;i+=n}return t}updateScrollControls(){this.noScrollControls?this.hasScrollControls=!1:this.hasScrollControls=["top","bottom"].includes(this.placement)&&this.nav.scrollWidth>this.nav.clientWidth+1}syncIndicator(){this.getActiveTab()?(this.indicator.style.display="block",this.repositionIndicator()):this.indicator.style.display="none"}show(r){const e=this.tabs.find(t=>t.panel===r);e&&this.setActiveTab(e,{scrollBehavior:"smooth"})}render(){const r=this.matches(":dir(rtl)");return Ie`
      <div
        part="base"
        class=${br({"tab-group":!0,"tab-group--top":this.placement==="top","tab-group--bottom":this.placement==="bottom","tab-group--start":this.placement==="start","tab-group--end":this.placement==="end","tab-group--rtl":this.localize.dir()==="rtl","tab-group--has-scroll-controls":this.hasScrollControls})}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
      >
        <div class="tab-group__nav-container" part="nav">
          ${this.hasScrollControls?Ie`
                <sl-icon-button
                  part="scroll-button scroll-button--start"
                  exportparts="base:scroll-button__base"
                  class="tab-group__scroll-button tab-group__scroll-button--start"
                  name=${r?"chevron-right":"chevron-left"}
                  library="system"
                  label=${this.localize.term("scrollToStart")}
                  @click=${this.handleScrollToStart}
                ></sl-icon-button>
              `:""}

          <div class="tab-group__nav">
            <div part="tabs" class="tab-group__tabs" role="tablist">
              <div part="active-tab-indicator" class="tab-group__indicator"></div>
              <slot name="nav" @slotchange=${this.syncTabsAndPanels}></slot>
            </div>
          </div>

          ${this.hasScrollControls?Ie`
                <sl-icon-button
                  part="scroll-button scroll-button--end"
                  exportparts="base:scroll-button__base"
                  class="tab-group__scroll-button tab-group__scroll-button--end"
                  name=${r?"chevron-left":"chevron-right"}
                  library="system"
                  label=${this.localize.term("scrollToEnd")}
                  @click=${this.handleScrollToEnd}
                ></sl-icon-button>
              `:""}
        </div>

        <slot part="body" class="tab-group__body" @slotchange=${this.syncTabsAndPanels}></slot>
      </div>
    `}};Sa.styles=[Tr,rJ];Sa.dependencies={"sl-icon-button":Li};oe([Dt(".tab-group")],Sa.prototype,"tabGroup",2);oe([Dt(".tab-group__body")],Sa.prototype,"body",2);oe([Dt(".tab-group__nav")],Sa.prototype,"nav",2);oe([Dt(".tab-group__indicator")],Sa.prototype,"indicator",2);oe([ii()],Sa.prototype,"hasScrollControls",2);oe([he()],Sa.prototype,"placement",2);oe([he()],Sa.prototype,"activation",2);oe([he({attribute:"no-scroll-controls",type:Boolean})],Sa.prototype,"noScrollControls",2);oe([Ut("noScrollControls",{waitUntilFirstUpdate:!0})],Sa.prototype,"updateScrollControls",1);oe([Ut("placement",{waitUntilFirstUpdate:!0})],Sa.prototype,"syncIndicator",1);Sa.define("sl-tab-group");var sJ=Ye`
  :host {
    display: block;
  }

  .textarea {
    display: flex;
    align-items: center;
    position: relative;
    width: 100%;
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-input-font-weight);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-input-letter-spacing);
    vertical-align: middle;
    transition:
      var(--sl-transition-fast) color,
      var(--sl-transition-fast) border,
      var(--sl-transition-fast) box-shadow,
      var(--sl-transition-fast) background-color;
    cursor: text;
  }

  /* Standard textareas */
  .textarea--standard {
    background-color: var(--sl-input-background-color);
    border: solid var(--sl-input-border-width) var(--sl-input-border-color);
  }

  .textarea--standard:hover:not(.textarea--disabled) {
    background-color: var(--sl-input-background-color-hover);
    border-color: var(--sl-input-border-color-hover);
  }
  .textarea--standard:hover:not(.textarea--disabled) .textarea__control {
    color: var(--sl-input-color-hover);
  }

  .textarea--standard.textarea--focused:not(.textarea--disabled) {
    background-color: var(--sl-input-background-color-focus);
    border-color: var(--sl-input-border-color-focus);
    color: var(--sl-input-color-focus);
    box-shadow: 0 0 0 var(--sl-focus-ring-width) var(--sl-input-focus-ring-color);
  }

  .textarea--standard.textarea--focused:not(.textarea--disabled) .textarea__control {
    color: var(--sl-input-color-focus);
  }

  .textarea--standard.textarea--disabled {
    background-color: var(--sl-input-background-color-disabled);
    border-color: var(--sl-input-border-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .textarea--standard.textarea--disabled .textarea__control {
    color: var(--sl-input-color-disabled);
  }

  .textarea--standard.textarea--disabled .textarea__control::placeholder {
    color: var(--sl-input-placeholder-color-disabled);
  }

  /* Filled textareas */
  .textarea--filled {
    border: none;
    background-color: var(--sl-input-filled-background-color);
    color: var(--sl-input-color);
  }

  .textarea--filled:hover:not(.textarea--disabled) {
    background-color: var(--sl-input-filled-background-color-hover);
  }

  .textarea--filled.textarea--focused:not(.textarea--disabled) {
    background-color: var(--sl-input-filled-background-color-focus);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .textarea--filled.textarea--disabled {
    background-color: var(--sl-input-filled-background-color-disabled);
    opacity: 0.5;
    cursor: not-allowed;
  }

  .textarea__control {
    flex: 1 1 auto;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    line-height: 1.4;
    color: var(--sl-input-color);
    border: none;
    background: none;
    box-shadow: none;
    cursor: inherit;
    -webkit-appearance: none;
  }

  .textarea__control::-webkit-search-decoration,
  .textarea__control::-webkit-search-cancel-button,
  .textarea__control::-webkit-search-results-button,
  .textarea__control::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }

  .textarea__control::placeholder {
    color: var(--sl-input-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }

  .textarea__control:focus {
    outline: none;
  }

  /*
   * Size modifiers
   */

  .textarea--small {
    border-radius: var(--sl-input-border-radius-small);
    font-size: var(--sl-input-font-size-small);
  }

  .textarea--small .textarea__control {
    padding: 0.5em var(--sl-input-spacing-small);
  }

  .textarea--medium {
    border-radius: var(--sl-input-border-radius-medium);
    font-size: var(--sl-input-font-size-medium);
  }

  .textarea--medium .textarea__control {
    padding: 0.5em var(--sl-input-spacing-medium);
  }

  .textarea--large {
    border-radius: var(--sl-input-border-radius-large);
    font-size: var(--sl-input-font-size-large);
  }

  .textarea--large .textarea__control {
    padding: 0.5em var(--sl-input-spacing-large);
  }

  /*
   * Resize types
   */

  .textarea--resize-none .textarea__control {
    resize: none;
  }

  .textarea--resize-vertical .textarea__control {
    resize: vertical;
  }

  .textarea--resize-auto .textarea__control {
    height: auto;
    resize: none;
    overflow-y: hidden;
  }
`,$r=class extends pr{constructor(){super(...arguments),this.formControlController=new bv(this,{assumeInteractionOn:["sl-blur","sl-input"]}),this.hasSlotController=new fc(this,"help-text","label"),this.hasFocus=!1,this.title="",this.name="",this.value="",this.size="medium",this.filled=!1,this.label="",this.helpText="",this.placeholder="",this.rows=4,this.resize="vertical",this.disabled=!1,this.readonly=!1,this.form="",this.required=!1,this.spellcheck=!0,this.defaultValue=""}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>this.setTextareaHeight()),this.updateComplete.then(()=>{this.setTextareaHeight(),this.resizeObserver.observe(this.input)})}firstUpdated(){this.formControlController.updateValidity()}disconnectedCallback(){super.disconnectedCallback(),this.input&&this.resizeObserver.unobserve(this.input)}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleChange(){this.value=this.input.value,this.setTextareaHeight(),this.emit("sl-change")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleInput(){this.value=this.input.value,this.emit("sl-input")}handleInvalid(r){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(r)}setTextareaHeight(){this.resize==="auto"?(this.input.style.height="auto",this.input.style.height=`${this.input.scrollHeight}px`):this.input.style.height=void 0}handleDisabledChange(){this.formControlController.setValidity(this.disabled)}handleRowsChange(){this.setTextareaHeight()}async handleValueChange(){await this.updateComplete,this.formControlController.updateValidity(),this.setTextareaHeight()}focus(r){this.input.focus(r)}blur(){this.input.blur()}select(){this.input.select()}scrollPosition(r){if(r){typeof r.top=="number"&&(this.input.scrollTop=r.top),typeof r.left=="number"&&(this.input.scrollLeft=r.left);return}return{top:this.input.scrollTop,left:this.input.scrollTop}}setSelectionRange(r,e,t="none"){this.input.setSelectionRange(r,e,t)}setRangeText(r,e,t,n="preserve"){const i=e??this.input.selectionStart,o=t??this.input.selectionEnd;this.input.setRangeText(r,i,o,n),this.value!==this.input.value&&(this.value=this.input.value,this.setTextareaHeight())}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(r){this.input.setCustomValidity(r),this.formControlController.updateValidity()}render(){const r=this.hasSlotController.test("label"),e=this.hasSlotController.test("help-text"),t=this.label?!0:!!r,n=this.helpText?!0:!!e;return Ie`
      <div
        part="form-control"
        class=${br({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-label":t,"form-control--has-help-text":n})}
      >
        <label
          part="form-control-label"
          class="form-control__label"
          for="input"
          aria-hidden=${t?"false":"true"}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <div
            part="base"
            class=${br({textarea:!0,"textarea--small":this.size==="small","textarea--medium":this.size==="medium","textarea--large":this.size==="large","textarea--standard":!this.filled,"textarea--filled":this.filled,"textarea--disabled":this.disabled,"textarea--focused":this.hasFocus,"textarea--empty":!this.value,"textarea--resize-none":this.resize==="none","textarea--resize-vertical":this.resize==="vertical","textarea--resize-auto":this.resize==="auto"})}
          >
            <textarea
              part="textarea"
              id="input"
              class="textarea__control"
              title=${this.title}
              name=${ft(this.name)}
              .value=${yw(this.value)}
              ?disabled=${this.disabled}
              ?readonly=${this.readonly}
              ?required=${this.required}
              placeholder=${ft(this.placeholder)}
              rows=${ft(this.rows)}
              minlength=${ft(this.minlength)}
              maxlength=${ft(this.maxlength)}
              autocapitalize=${ft(this.autocapitalize)}
              autocorrect=${ft(this.autocorrect)}
              ?autofocus=${this.autofocus}
              spellcheck=${ft(this.spellcheck)}
              enterkeyhint=${ft(this.enterkeyhint)}
              inputmode=${ft(this.inputmode)}
              aria-describedby="help-text"
              @change=${this.handleChange}
              @input=${this.handleInput}
              @invalid=${this.handleInvalid}
              @focus=${this.handleFocus}
              @blur=${this.handleBlur}
            ></textarea>
          </div>
        </div>

        <div
          part="form-control-help-text"
          id="help-text"
          class="form-control__help-text"
          aria-hidden=${n?"false":"true"}
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};$r.styles=[Tr,u_,sJ];oe([Dt(".textarea__control")],$r.prototype,"input",2);oe([ii()],$r.prototype,"hasFocus",2);oe([he()],$r.prototype,"title",2);oe([he()],$r.prototype,"name",2);oe([he()],$r.prototype,"value",2);oe([he({reflect:!0})],$r.prototype,"size",2);oe([he({type:Boolean,reflect:!0})],$r.prototype,"filled",2);oe([he()],$r.prototype,"label",2);oe([he({attribute:"help-text"})],$r.prototype,"helpText",2);oe([he()],$r.prototype,"placeholder",2);oe([he({type:Number})],$r.prototype,"rows",2);oe([he()],$r.prototype,"resize",2);oe([he({type:Boolean,reflect:!0})],$r.prototype,"disabled",2);oe([he({type:Boolean,reflect:!0})],$r.prototype,"readonly",2);oe([he({reflect:!0})],$r.prototype,"form",2);oe([he({type:Boolean,reflect:!0})],$r.prototype,"required",2);oe([he({type:Number})],$r.prototype,"minlength",2);oe([he({type:Number})],$r.prototype,"maxlength",2);oe([he()],$r.prototype,"autocapitalize",2);oe([he()],$r.prototype,"autocorrect",2);oe([he()],$r.prototype,"autocomplete",2);oe([he({type:Boolean})],$r.prototype,"autofocus",2);oe([he()],$r.prototype,"enterkeyhint",2);oe([he({type:Boolean,converter:{fromAttribute:r=>!(!r||r==="false"),toAttribute:r=>r?"true":"false"}})],$r.prototype,"spellcheck",2);oe([he()],$r.prototype,"inputmode",2);oe([$x()],$r.prototype,"defaultValue",2);oe([Ut("disabled",{waitUntilFirstUpdate:!0})],$r.prototype,"handleDisabledChange",1);oe([Ut("rows",{waitUntilFirstUpdate:!0})],$r.prototype,"handleRowsChange",1);oe([Ut("value",{waitUntilFirstUpdate:!0})],$r.prototype,"handleValueChange",1);$r.define("sl-textarea");function VE(r,e,t){const n=i=>Object.is(i,-0)?0:i;return r<e?n(e):r>t?n(t):n(r)}var aJ=class{constructor(r,e){this.timerId=0,this.activeInteractions=0,this.paused=!1,this.stopped=!0,this.pause=()=>{this.activeInteractions++||(this.paused=!0,this.host.requestUpdate())},this.resume=()=>{--this.activeInteractions||(this.paused=!1,this.host.requestUpdate())},r.addController(this),this.host=r,this.tickCallback=e}hostConnected(){this.host.addEventListener("mouseenter",this.pause),this.host.addEventListener("mouseleave",this.resume),this.host.addEventListener("focusin",this.pause),this.host.addEventListener("focusout",this.resume),this.host.addEventListener("touchstart",this.pause,{passive:!0}),this.host.addEventListener("touchend",this.resume)}hostDisconnected(){this.stop(),this.host.removeEventListener("mouseenter",this.pause),this.host.removeEventListener("mouseleave",this.resume),this.host.removeEventListener("focusin",this.pause),this.host.removeEventListener("focusout",this.resume),this.host.removeEventListener("touchstart",this.pause),this.host.removeEventListener("touchend",this.resume)}start(r){this.stop(),this.stopped=!1,this.timerId=window.setInterval(()=>{this.paused||this.tickCallback()},r)}stop(){clearInterval(this.timerId),this.stopped=!0,this.host.requestUpdate()}},cJ=Ye`
  :host {
    --slide-gap: var(--sl-spacing-medium, 1rem);
    --aspect-ratio: 16 / 9;
    --scroll-hint: 0px;

    display: flex;
  }

  .carousel {
    display: grid;
    grid-template-columns: min-content 1fr min-content;
    grid-template-rows: 1fr min-content;
    grid-template-areas:
      '. slides .'
      '. pagination .';
    gap: var(--sl-spacing-medium);
    align-items: center;
    min-height: 100%;
    min-width: 100%;
    position: relative;
  }

  .carousel__pagination {
    grid-area: pagination;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--sl-spacing-small);
  }

  .carousel__slides {
    grid-area: slides;

    display: grid;
    height: 100%;
    width: 100%;
    align-items: center;
    justify-items: center;
    overflow: auto;
    overscroll-behavior-x: contain;
    scrollbar-width: none;
    aspect-ratio: calc(var(--aspect-ratio) * var(--slides-per-page));
    border-radius: var(--sl-border-radius-small);

    --slide-size: calc((100% - (var(--slides-per-page) - 1) * var(--slide-gap)) / var(--slides-per-page));
  }

  @media (prefers-reduced-motion) {
    :where(.carousel__slides) {
      scroll-behavior: auto;
    }
  }

  .carousel__slides--horizontal {
    grid-auto-flow: column;
    grid-auto-columns: var(--slide-size);
    grid-auto-rows: 100%;
    column-gap: var(--slide-gap);
    scroll-snap-type: x mandatory;
    scroll-padding-inline: var(--scroll-hint);
    padding-inline: var(--scroll-hint);
    overflow-y: hidden;
  }

  .carousel__slides--vertical {
    grid-auto-flow: row;
    grid-auto-columns: 100%;
    grid-auto-rows: var(--slide-size);
    row-gap: var(--slide-gap);
    scroll-snap-type: y mandatory;
    scroll-padding-block: var(--scroll-hint);
    padding-block: var(--scroll-hint);
    overflow-x: hidden;
  }

  .carousel__slides--dragging {
  }

  :host([vertical]) ::slotted(sl-carousel-item) {
    height: 100%;
  }

  .carousel__slides::-webkit-scrollbar {
    display: none;
  }

  .carousel__navigation {
    grid-area: navigation;
    display: contents;
    font-size: var(--sl-font-size-x-large);
  }

  .carousel__navigation-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    background: none;
    border: none;
    border-radius: var(--sl-border-radius-small);
    font-size: inherit;
    color: var(--sl-color-neutral-600);
    padding: var(--sl-spacing-x-small);
    cursor: pointer;
    transition: var(--sl-transition-medium) color;
    appearance: none;
  }

  .carousel__navigation-button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .carousel__navigation-button--disabled::part(base) {
    pointer-events: none;
  }

  .carousel__navigation-button--previous {
    grid-column: 1;
    grid-row: 1;
  }

  .carousel__navigation-button--next {
    grid-column: 3;
    grid-row: 1;
  }

  .carousel__pagination-item {
    display: block;
    cursor: pointer;
    background: none;
    border: 0;
    border-radius: var(--sl-border-radius-circle);
    width: var(--sl-spacing-small);
    height: var(--sl-spacing-small);
    background-color: var(--sl-color-neutral-300);
    padding: 0;
    margin: 0;
  }

  .carousel__pagination-item--active {
    background-color: var(--sl-color-neutral-700);
    transform: scale(1.2);
  }

  /* Focus styles */
  .carousel__slides:focus-visible,
  .carousel__navigation-button:focus-visible,
  .carousel__pagination-item:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*lJ(r,e){if(r!==void 0){let t=0;for(const n of r)yield e(n,t++)}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*dJ(r,e,t=1){const n=e===void 0?0:r;e??=r;for(let i=n;t>0?i<e:e<i;i+=t)yield i}var uJ=(r,e)=>{let t=0;return function(...n){window.clearTimeout(t),t=window.setTimeout(()=>{r.call(this,...n)},e)}},u3=(r,e,t)=>{const n=r[e];r[e]=function(...i){n.call(this,...i),t.call(this,n,...i)}},fJ="onscrollend"in window;if(!fJ){const r=new Set,e=new WeakMap,t=i=>{for(const o of i.changedTouches)r.add(o.identifier)},n=i=>{for(const o of i.changedTouches)r.delete(o.identifier)};document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",n,!0),document.addEventListener("touchcancel",n,!0),u3(EventTarget.prototype,"addEventListener",function(i,o){if(o!=="scrollend")return;const s=uJ(()=>{r.size?s():this.dispatchEvent(new Event("scrollend"))},100);i.call(this,"scroll",s,{passive:!0}),e.set(this,s)}),u3(EventTarget.prototype,"removeEventListener",function(i,o){if(o!=="scrollend")return;const s=e.get(this);s&&i.call(this,"scroll",s,{passive:!0})})}var Rn=class extends pr{constructor(){super(...arguments),this.loop=!1,this.navigation=!1,this.pagination=!1,this.autoplay=!1,this.autoplayInterval=3e3,this.slidesPerPage=1,this.slidesPerMove=1,this.orientation="horizontal",this.mouseDragging=!1,this.activeSlide=0,this.scrolling=!1,this.dragging=!1,this.autoplayController=new aJ(this,()=>this.next()),this.localize=new js(this),this.handleMouseDrag=r=>{this.dragging||(this.scrollContainer.style.setProperty("scroll-snap-type","none"),this.dragging=!0),this.scrollContainer.scrollBy({left:-r.movementX,top:-r.movementY,behavior:"instant"})},this.handleMouseDragEnd=()=>{const r=this.scrollContainer;document.removeEventListener("pointermove",this.handleMouseDrag,{capture:!0});const e=r.scrollLeft,t=r.scrollTop;r.style.removeProperty("scroll-snap-type"),r.style.setProperty("overflow","hidden");const n=r.scrollLeft,i=r.scrollTop;r.style.removeProperty("overflow"),r.style.setProperty("scroll-snap-type","none"),r.scrollTo({left:e,top:t,behavior:"instant"}),requestAnimationFrame(async()=>{(e!==n||t!==i)&&(r.scrollTo({left:n,top:i,behavior:hP()?"auto":"smooth"}),await Ea(r,"scrollend")),r.style.removeProperty("scroll-snap-type"),this.dragging=!1,this.handleScrollEnd()})},this.handleSlotChange=r=>{r.some(t=>[...t.addedNodes,...t.removedNodes].some(n=>this.isCarouselItem(n)&&!n.hasAttribute("data-clone")))&&this.initializeSlides(),this.requestUpdate()}}connectedCallback(){super.connectedCallback(),this.setAttribute("role","region"),this.setAttribute("aria-label",this.localize.term("carousel"))}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver.disconnect()}firstUpdated(){this.initializeSlides(),this.mutationObserver=new MutationObserver(this.handleSlotChange),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}willUpdate(r){(r.has("slidesPerMove")||r.has("slidesPerPage"))&&(this.slidesPerMove=Math.min(this.slidesPerMove,this.slidesPerPage))}getPageCount(){const r=this.getSlides().length,{slidesPerPage:e,slidesPerMove:t,loop:n}=this,i=n?r/t:(r-e)/t+1;return Math.ceil(i)}getCurrentPage(){return Math.ceil(this.activeSlide/this.slidesPerMove)}canScrollNext(){return this.loop||this.getCurrentPage()<this.getPageCount()-1}canScrollPrev(){return this.loop||this.getCurrentPage()>0}getSlides({excludeClones:r=!0}={}){return[...this.children].filter(e=>this.isCarouselItem(e)&&(!r||!e.hasAttribute("data-clone")))}handleKeyDown(r){if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(r.key)){const e=r.target,t=this.matches(":dir(rtl)"),n=e.closest('[part~="pagination-item"]')!==null,i=r.key==="ArrowDown"||!t&&r.key==="ArrowRight"||t&&r.key==="ArrowLeft",o=r.key==="ArrowUp"||!t&&r.key==="ArrowLeft"||t&&r.key==="ArrowRight";r.preventDefault(),o&&this.previous(),i&&this.next(),r.key==="Home"&&this.goToSlide(0),r.key==="End"&&this.goToSlide(this.getSlides().length-1),n&&this.updateComplete.then(()=>{var s;const a=(s=this.shadowRoot)==null?void 0:s.querySelector('[part~="pagination-item--active"]');a&&a.focus()})}}handleMouseDragStart(r){this.mouseDragging&&r.button===0&&(r.preventDefault(),document.addEventListener("pointermove",this.handleMouseDrag,{capture:!0,passive:!0}),document.addEventListener("pointerup",this.handleMouseDragEnd,{capture:!0,once:!0}))}handleScroll(){this.scrolling=!0}synchronizeSlides(){const r=new IntersectionObserver(e=>{r.disconnect();for(const n of e){const i=n.target;i.toggleAttribute("inert",!n.isIntersecting),i.classList.toggle("--in-view",n.isIntersecting),i.setAttribute("aria-hidden",n.isIntersecting?"false":"true")}const t=e.find(n=>n.isIntersecting);if(t)if(this.loop&&t.target.hasAttribute("data-clone")){const n=Number(t.target.getAttribute("data-clone"));this.goToSlide(n,"instant")}else{const i=this.getSlides().indexOf(t.target);this.activeSlide=Math.ceil(i/this.slidesPerMove)*this.slidesPerMove}},{root:this.scrollContainer,threshold:.6});this.getSlides({excludeClones:!1}).forEach(e=>{r.observe(e)})}handleScrollEnd(){!this.scrolling||this.dragging||(this.synchronizeSlides(),this.scrolling=!1)}isCarouselItem(r){return r instanceof Element&&r.tagName.toLowerCase()==="sl-carousel-item"}initializeSlides(){this.getSlides({excludeClones:!1}).forEach((r,e)=>{r.classList.remove("--in-view"),r.classList.remove("--is-active"),r.setAttribute("aria-label",this.localize.term("slideNum",e+1)),r.hasAttribute("data-clone")&&r.remove()}),this.updateSlidesSnap(),this.loop&&this.createClones(),this.synchronizeSlides(),this.goToSlide(this.activeSlide,"auto")}createClones(){const r=this.getSlides(),e=this.slidesPerPage,t=r.slice(-e),n=r.slice(0,e);t.reverse().forEach((i,o)=>{const s=i.cloneNode(!0);s.setAttribute("data-clone",String(r.length-o-1)),this.prepend(s)}),n.forEach((i,o)=>{const s=i.cloneNode(!0);s.setAttribute("data-clone",String(o)),this.append(s)})}handelSlideChange(){const r=this.getSlides();r.forEach((e,t)=>{e.classList.toggle("--is-active",t===this.activeSlide)}),this.hasUpdated&&this.emit("sl-slide-change",{detail:{index:this.activeSlide,slide:r[this.activeSlide]}})}updateSlidesSnap(){const r=this.getSlides(),e=this.slidesPerMove;r.forEach((t,n)=>{(n+e)%e===0?t.style.removeProperty("scroll-snap-align"):t.style.setProperty("scroll-snap-align","none")})}handleAutoplayChange(){this.autoplayController.stop(),this.autoplay&&this.autoplayController.start(this.autoplayInterval)}previous(r="smooth"){this.goToSlide(this.activeSlide-this.slidesPerMove,r)}next(r="smooth"){this.goToSlide(this.activeSlide+this.slidesPerMove,r)}goToSlide(r,e="smooth"){const{slidesPerPage:t,loop:n}=this,i=this.getSlides(),o=this.getSlides({excludeClones:!1});if(!i.length)return;const s=n?(r+i.length)%i.length:VE(r,0,i.length-1);this.activeSlide=s;const a=VE(r+(n?t:0),0,o.length-1),l=o[a];this.scrollToSlide(l,hP()?"auto":e)}scrollToSlide(r,e="smooth"){const t=this.scrollContainer,n=t.getBoundingClientRect(),i=r.getBoundingClientRect(),o=i.left-n.left,s=i.top-n.top;t.scrollTo({left:o+t.scrollLeft,top:s+t.scrollTop,behavior:e})}render(){const{slidesPerMove:r,scrolling:e}=this,t=this.getPageCount(),n=this.getCurrentPage(),i=this.canScrollPrev(),o=this.canScrollNext(),s=this.matches(":dir(ltr)");return Ie`
      <div part="base" class="carousel">
        <div
          id="scroll-container"
          part="scroll-container"
          class="${br({carousel__slides:!0,"carousel__slides--horizontal":this.orientation==="horizontal","carousel__slides--vertical":this.orientation==="vertical","carousel__slides--dragging":this.dragging})}"
          style="--slides-per-page: ${this.slidesPerPage};"
          aria-busy="${e?"true":"false"}"
          aria-atomic="true"
          tabindex="0"
          @keydown=${this.handleKeyDown}
          @mousedown="${this.handleMouseDragStart}"
          @scroll="${this.handleScroll}"
          @scrollend=${this.handleScrollEnd}
        >
          <slot></slot>
        </div>

        ${this.navigation?Ie`
              <div part="navigation" class="carousel__navigation">
                <button
                  part="navigation-button navigation-button--previous"
                  class="${br({"carousel__navigation-button":!0,"carousel__navigation-button--previous":!0,"carousel__navigation-button--disabled":!i})}"
                  aria-label="${this.localize.term("previousSlide")}"
                  aria-controls="scroll-container"
                  aria-disabled="${i?"false":"true"}"
                  @click=${i?()=>this.previous():null}
                >
                  <slot name="previous-icon">
                    <sl-icon library="system" name="${s?"chevron-left":"chevron-right"}"></sl-icon>
                  </slot>
                </button>

                <button
                  part="navigation-button navigation-button--next"
                  class=${br({"carousel__navigation-button":!0,"carousel__navigation-button--next":!0,"carousel__navigation-button--disabled":!o})}
                  aria-label="${this.localize.term("nextSlide")}"
                  aria-controls="scroll-container"
                  aria-disabled="${o?"false":"true"}"
                  @click=${o?()=>this.next():null}
                >
                  <slot name="next-icon">
                    <sl-icon library="system" name="${s?"chevron-right":"chevron-left"}"></sl-icon>
                  </slot>
                </button>
              </div>
            `:""}
        ${this.pagination?Ie`
              <div part="pagination" role="tablist" class="carousel__pagination" aria-controls="scroll-container">
                ${lJ(dJ(t),a=>{const l=a===n;return Ie`
                    <button
                      part="pagination-item ${l?"pagination-item--active":""}"
                      class="${br({"carousel__pagination-item":!0,"carousel__pagination-item--active":l})}"
                      role="tab"
                      aria-selected="${l?"true":"false"}"
                      aria-label="${this.localize.term("goToSlide",a+1,t)}"
                      tabindex=${l?"0":"-1"}
                      @click=${()=>this.goToSlide(a*r)}
                      @keydown=${this.handleKeyDown}
                    ></button>
                  `})}
              </div>
            `:""}
      </div>
    `}};Rn.styles=[Tr,cJ];Rn.dependencies={"sl-icon":Bi};oe([he({type:Boolean,reflect:!0})],Rn.prototype,"loop",2);oe([he({type:Boolean,reflect:!0})],Rn.prototype,"navigation",2);oe([he({type:Boolean,reflect:!0})],Rn.prototype,"pagination",2);oe([he({type:Boolean,reflect:!0})],Rn.prototype,"autoplay",2);oe([he({type:Number,attribute:"autoplay-interval"})],Rn.prototype,"autoplayInterval",2);oe([he({type:Number,attribute:"slides-per-page"})],Rn.prototype,"slidesPerPage",2);oe([he({type:Number,attribute:"slides-per-move"})],Rn.prototype,"slidesPerMove",2);oe([he()],Rn.prototype,"orientation",2);oe([he({type:Boolean,reflect:!0,attribute:"mouse-dragging"})],Rn.prototype,"mouseDragging",2);oe([Dt(".carousel__slides")],Rn.prototype,"scrollContainer",2);oe([Dt(".carousel__pagination")],Rn.prototype,"paginationContainer",2);oe([ii()],Rn.prototype,"activeSlide",2);oe([ii()],Rn.prototype,"scrolling",2);oe([ii()],Rn.prototype,"dragging",2);oe([SY({passive:!0})],Rn.prototype,"handleScroll",1);oe([Ut("loop",{waitUntilFirstUpdate:!0}),Ut("slidesPerPage",{waitUntilFirstUpdate:!0})],Rn.prototype,"initializeSlides",1);oe([Ut("activeSlide")],Rn.prototype,"handelSlideChange",1);oe([Ut("slidesPerMove")],Rn.prototype,"updateSlidesSnap",1);oe([Ut("autoplay")],Rn.prototype,"handleAutoplayChange",1);Rn.define("sl-carousel");var hJ=Ye`
  :host {
    display: block;
  }

  .details {
    border: solid 1px var(--sl-color-neutral-200);
    border-radius: var(--sl-border-radius-medium);
    background-color: var(--sl-color-neutral-0);
    overflow-anchor: none;
  }

  .details--disabled {
    opacity: 0.5;
  }

  .details__header {
    display: flex;
    align-items: center;
    border-radius: inherit;
    padding: var(--sl-spacing-medium);
    user-select: none;
    -webkit-user-select: none;
    cursor: pointer;
  }

  .details__header::-webkit-details-marker {
    display: none;
  }

  .details__header:focus {
    outline: none;
  }

  .details__header:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: calc(1px + var(--sl-focus-ring-offset));
  }

  .details--disabled .details__header {
    cursor: not-allowed;
  }

  .details--disabled .details__header:focus-visible {
    outline: none;
    box-shadow: none;
  }

  .details__summary {
    flex: 1 1 auto;
    display: flex;
    align-items: center;
  }

  .details__summary-icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    transition: var(--sl-transition-medium) rotate ease;
  }

  .details--open .details__summary-icon {
    rotate: 90deg;
  }

  .details--open.details--rtl .details__summary-icon {
    rotate: -90deg;
  }

  .details--open slot[name='expand-icon'],
  .details:not(.details--open) slot[name='collapse-icon'] {
    display: none;
  }

  .details__body {
    overflow: hidden;
  }

  .details__content {
    display: block;
    padding: var(--sl-spacing-medium);
  }
`,el=class extends pr{constructor(){super(...arguments),this.localize=new js(this),this.open=!1,this.disabled=!1}firstUpdated(){this.body.style.height=this.open?"auto":"0",this.open&&(this.details.open=!0),this.detailsObserver=new MutationObserver(r=>{for(const e of r)e.type==="attributes"&&e.attributeName==="open"&&(this.details.open?this.show():this.hide())}),this.detailsObserver.observe(this.details,{attributes:!0})}disconnectedCallback(){super.disconnectedCallback(),this.detailsObserver.disconnect()}handleSummaryClick(r){r.preventDefault(),this.disabled||(this.open?this.hide():this.show(),this.header.focus())}handleSummaryKeyDown(r){(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),this.open?this.hide():this.show()),(r.key==="ArrowUp"||r.key==="ArrowLeft")&&(r.preventDefault(),this.hide()),(r.key==="ArrowDown"||r.key==="ArrowRight")&&(r.preventDefault(),this.show())}async handleOpenChange(){if(this.open){if(this.details.open=!0,this.emit("sl-show",{cancelable:!0}).defaultPrevented){this.open=!1,this.details.open=!1;return}await Go(this.body);const{keyframes:e,options:t}=ni(this,"details.show",{dir:this.localize.dir()});await $i(this.body,c3(e,this.body.scrollHeight),t),this.body.style.height="auto",this.emit("sl-after-show")}else{if(this.emit("sl-hide",{cancelable:!0}).defaultPrevented){this.details.open=!0,this.open=!0;return}await Go(this.body);const{keyframes:e,options:t}=ni(this,"details.hide",{dir:this.localize.dir()});await $i(this.body,c3(e,this.body.scrollHeight),t),this.body.style.height="auto",this.details.open=!1,this.emit("sl-after-hide")}}async show(){if(!(this.open||this.disabled))return this.open=!0,Ea(this,"sl-after-show")}async hide(){if(!(!this.open||this.disabled))return this.open=!1,Ea(this,"sl-after-hide")}render(){const r=this.matches(":dir(rtl)");return Ie`
      <details
        part="base"
        class=${br({details:!0,"details--open":this.open,"details--disabled":this.disabled,"details--rtl":r})}
      >
        <summary
          part="header"
          id="header"
          class="details__header"
          role="button"
          aria-expanded=${this.open?"true":"false"}
          aria-controls="content"
          aria-disabled=${this.disabled?"true":"false"}
          tabindex=${this.disabled?"-1":"0"}
          @click=${this.handleSummaryClick}
          @keydown=${this.handleSummaryKeyDown}
        >
          <slot name="summary" part="summary" class="details__summary">${this.summary}</slot>

          <span part="summary-icon" class="details__summary-icon">
            <slot name="expand-icon">
              <sl-icon library="system" name=${r?"chevron-left":"chevron-right"}></sl-icon>
            </slot>
            <slot name="collapse-icon">
              <sl-icon library="system" name=${r?"chevron-left":"chevron-right"}></sl-icon>
            </slot>
          </span>
        </summary>

        <div class="details__body" role="region" aria-labelledby="header">
          <slot part="content" id="content" class="details__content"></slot>
        </div>
      </details>
    `}};el.styles=[Tr,hJ];el.dependencies={"sl-icon":Bi};oe([Dt(".details")],el.prototype,"details",2);oe([Dt(".details__header")],el.prototype,"header",2);oe([Dt(".details__body")],el.prototype,"body",2);oe([Dt(".details__expand-icon-slot")],el.prototype,"expandIconSlot",2);oe([he({type:Boolean,reflect:!0})],el.prototype,"open",2);oe([he()],el.prototype,"summary",2);oe([he({type:Boolean,reflect:!0})],el.prototype,"disabled",2);oe([Ut("open",{waitUntilFirstUpdate:!0})],el.prototype,"handleOpenChange",1);ln("details.show",{keyframes:[{height:"0",opacity:"0"},{height:"auto",opacity:"1"}],options:{duration:250,easing:"linear"}});ln("details.hide",{keyframes:[{height:"auto",opacity:"1"},{height:"0",opacity:"0"}],options:{duration:250,easing:"linear"}});el.define("sl-details");var pJ=Ye`
  :host {
    --size: 25rem;
    --header-spacing: var(--sl-spacing-large);
    --body-spacing: var(--sl-spacing-large);
    --footer-spacing: var(--sl-spacing-large);

    display: contents;
  }

  .drawer {
    top: 0;
    inset-inline-start: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
  }

  .drawer--contained {
    position: absolute;
    z-index: initial;
  }

  .drawer--fixed {
    position: fixed;
    z-index: var(--sl-z-index-drawer);
  }

  .drawer__panel {
    position: absolute;
    display: flex;
    flex-direction: column;
    z-index: 2;
    max-width: 100%;
    max-height: 100%;
    background-color: var(--sl-panel-background-color);
    box-shadow: var(--sl-shadow-x-large);
    overflow: auto;
    pointer-events: all;
  }

  .drawer__panel:focus {
    outline: none;
  }

  .drawer--top .drawer__panel {
    top: 0;
    inset-inline-end: auto;
    bottom: auto;
    inset-inline-start: 0;
    width: 100%;
    height: var(--size);
  }

  .drawer--end .drawer__panel {
    top: 0;
    inset-inline-end: 0;
    bottom: auto;
    inset-inline-start: auto;
    width: var(--size);
    height: 100%;
  }

  .drawer--bottom .drawer__panel {
    top: auto;
    inset-inline-end: auto;
    bottom: 0;
    inset-inline-start: 0;
    width: 100%;
    height: var(--size);
  }

  .drawer--start .drawer__panel {
    top: 0;
    inset-inline-end: auto;
    bottom: auto;
    inset-inline-start: 0;
    width: var(--size);
    height: 100%;
  }

  .drawer__header {
    display: flex;
  }

  .drawer__title {
    flex: 1 1 auto;
    font: inherit;
    font-size: var(--sl-font-size-large);
    line-height: var(--sl-line-height-dense);
    padding: var(--header-spacing);
    margin: 0;
  }

  .drawer__header-actions {
    flex-shrink: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: end;
    gap: var(--sl-spacing-2x-small);
    padding: 0 var(--header-spacing);
  }

  .drawer__header-actions sl-icon-button,
  .drawer__header-actions ::slotted(sl-icon-button) {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
  }

  .drawer__body {
    flex: 1 1 auto;
    display: block;
    padding: var(--body-spacing);
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .drawer__footer {
    text-align: right;
    padding: var(--footer-spacing);
  }

  .drawer__footer ::slotted(sl-button:not(:last-of-type)) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .drawer:not(.drawer--has-footer) .drawer__footer {
    display: none;
  }

  .drawer__overlay {
    display: block;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: var(--sl-overlay-background-color);
    pointer-events: all;
  }

  .drawer--contained .drawer__overlay {
    display: none;
  }

  @media (forced-colors: active) {
    .drawer__panel {
      border: solid 1px var(--sl-color-neutral-0);
    }
  }
`;function*rO(r=document.activeElement){r!=null&&(yield r,"shadowRoot"in r&&r.shadowRoot&&r.shadowRoot.mode!=="closed"&&(yield*EY(rO(r.shadowRoot.activeElement))))}function yJ(){return[...rO()].pop()}var c0=[],WL=class{constructor(r){this.tabDirection="forward",this.handleFocusIn=()=>{this.isActive()&&this.checkFocus()},this.handleKeyDown=e=>{var t;if(e.key!=="Tab"||this.isExternalActivated||!this.isActive())return;const n=yJ();if(this.previousFocus=n,this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;e.shiftKey?this.tabDirection="backward":this.tabDirection="forward";const i=pP(this.element);let o=i.findIndex(a=>a===n);this.previousFocus=this.currentFocus;const s=this.tabDirection==="forward"?1:-1;for(;;){o+s>=i.length?o=0:o+s<0?o=i.length-1:o+=s,this.previousFocus=this.currentFocus;const a=i[o];if(this.tabDirection==="backward"&&this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus)||a&&this.possiblyHasTabbableChildren(a))return;e.preventDefault(),this.currentFocus=a,(t=this.currentFocus)==null||t.focus({preventScroll:!1});const l=[...rO()];if(l.includes(this.currentFocus)||!l.includes(this.previousFocus))break}setTimeout(()=>this.checkFocus())},this.handleKeyUp=()=>{this.tabDirection="forward"},this.element=r,this.elementsWithTabbableControls=["iframe"]}activate(){c0.push(this.element),document.addEventListener("focusin",this.handleFocusIn),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}deactivate(){c0=c0.filter(r=>r!==this.element),this.currentFocus=null,document.removeEventListener("focusin",this.handleFocusIn),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}isActive(){return c0[c0.length-1]===this.element}activateExternal(){this.isExternalActivated=!0}deactivateExternal(){this.isExternalActivated=!1}checkFocus(){if(this.isActive()&&!this.isExternalActivated){const r=pP(this.element);if(!this.element.matches(":focus-within")){const e=r[0],t=r[r.length-1],n=this.tabDirection==="forward"?e:t;typeof n?.focus=="function"&&(this.currentFocus=n,n.focus({preventScroll:!1}))}}}possiblyHasTabbableChildren(r){return this.elementsWithTabbableControls.includes(r.tagName.toLowerCase())||r.hasAttribute("controls")}};function f3(r){return r.charAt(0).toUpperCase()+r.slice(1)}var Ta=class extends pr{constructor(){super(...arguments),this.hasSlotController=new fc(this,"footer"),this.localize=new js(this),this.modal=new WL(this),this.open=!1,this.label="",this.placement="end",this.contained=!1,this.noHeader=!1,this.handleDocumentKeyDown=r=>{this.contained||r.key==="Escape"&&this.modal.isActive()&&this.open&&(r.stopImmediatePropagation(),this.requestClose("keyboard"))}}firstUpdated(){this.drawer.hidden=!this.open,this.open&&(this.addOpenListeners(),this.contained||(this.modal.activate(),jb(this)))}disconnectedCallback(){var r;super.disconnectedCallback(),Nb(this),(r=this.closeWatcher)==null||r.destroy()}requestClose(r){if(this.emit("sl-request-close",{cancelable:!0,detail:{source:r}}).defaultPrevented){const t=ni(this,"drawer.denyClose",{dir:this.localize.dir()});$i(this.panel,t.keyframes,t.options);return}this.hide()}addOpenListeners(){var r;"CloseWatcher"in window?((r=this.closeWatcher)==null||r.destroy(),this.contained||(this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>this.requestClose("keyboard"))):document.addEventListener("keydown",this.handleDocumentKeyDown)}removeOpenListeners(){var r;document.removeEventListener("keydown",this.handleDocumentKeyDown),(r=this.closeWatcher)==null||r.destroy()}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.addOpenListeners(),this.originalTrigger=document.activeElement,this.contained||(this.modal.activate(),jb(this));const r=this.querySelector("[autofocus]");r&&r.removeAttribute("autofocus"),await Promise.all([Go(this.drawer),Go(this.overlay)]),this.drawer.hidden=!1,requestAnimationFrame(()=>{this.emit("sl-initial-focus",{cancelable:!0}).defaultPrevented||(r?r.focus({preventScroll:!0}):this.panel.focus({preventScroll:!0})),r&&r.setAttribute("autofocus","")});const e=ni(this,`drawer.show${f3(this.placement)}`,{dir:this.localize.dir()}),t=ni(this,"drawer.overlay.show",{dir:this.localize.dir()});await Promise.all([$i(this.panel,e.keyframes,e.options),$i(this.overlay,t.keyframes,t.options)]),this.emit("sl-after-show")}else{this.emit("sl-hide"),this.removeOpenListeners(),this.contained||(this.modal.deactivate(),Nb(this)),await Promise.all([Go(this.drawer),Go(this.overlay)]);const r=ni(this,`drawer.hide${f3(this.placement)}`,{dir:this.localize.dir()}),e=ni(this,"drawer.overlay.hide",{dir:this.localize.dir()});await Promise.all([$i(this.overlay,e.keyframes,e.options).then(()=>{this.overlay.hidden=!0}),$i(this.panel,r.keyframes,r.options).then(()=>{this.panel.hidden=!0})]),this.drawer.hidden=!0,this.overlay.hidden=!1,this.panel.hidden=!1;const t=this.originalTrigger;typeof t?.focus=="function"&&setTimeout(()=>t.focus()),this.emit("sl-after-hide")}}handleNoModalChange(){this.open&&!this.contained&&(this.modal.activate(),jb(this)),this.open&&this.contained&&(this.modal.deactivate(),Nb(this))}async show(){if(!this.open)return this.open=!0,Ea(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,Ea(this,"sl-after-hide")}render(){return Ie`
      <div
        part="base"
        class=${br({drawer:!0,"drawer--open":this.open,"drawer--top":this.placement==="top","drawer--end":this.placement==="end","drawer--bottom":this.placement==="bottom","drawer--start":this.placement==="start","drawer--contained":this.contained,"drawer--fixed":!this.contained,"drawer--rtl":this.localize.dir()==="rtl","drawer--has-footer":this.hasSlotController.test("footer")})}
      >
        <div part="overlay" class="drawer__overlay" @click=${()=>this.requestClose("overlay")} tabindex="-1"></div>

        <div
          part="panel"
          class="drawer__panel"
          role="dialog"
          aria-modal="true"
          aria-hidden=${this.open?"false":"true"}
          aria-label=${ft(this.noHeader?this.label:void 0)}
          aria-labelledby=${ft(this.noHeader?void 0:"title")}
          tabindex="0"
        >
          ${this.noHeader?"":Ie`
                <header part="header" class="drawer__header">
                  <h2 part="title" class="drawer__title" id="title">
                    <!-- If there's no label, use an invisible character to prevent the header from collapsing -->
                    <slot name="label"> ${this.label.length>0?this.label:"\uFEFF"} </slot>
                  </h2>
                  <div part="header-actions" class="drawer__header-actions">
                    <slot name="header-actions"></slot>
                    <sl-icon-button
                      part="close-button"
                      exportparts="base:close-button__base"
                      class="drawer__close"
                      name="x-lg"
                      label=${this.localize.term("close")}
                      library="system"
                      @click=${()=>this.requestClose("close-button")}
                    ></sl-icon-button>
                  </div>
                </header>
              `}

          <slot part="body" class="drawer__body"></slot>

          <footer part="footer" class="drawer__footer">
            <slot name="footer"></slot>
          </footer>
        </div>
      </div>
    `}};Ta.styles=[Tr,pJ];Ta.dependencies={"sl-icon-button":Li};oe([Dt(".drawer")],Ta.prototype,"drawer",2);oe([Dt(".drawer__panel")],Ta.prototype,"panel",2);oe([Dt(".drawer__overlay")],Ta.prototype,"overlay",2);oe([he({type:Boolean,reflect:!0})],Ta.prototype,"open",2);oe([he({reflect:!0})],Ta.prototype,"label",2);oe([he({reflect:!0})],Ta.prototype,"placement",2);oe([he({type:Boolean,reflect:!0})],Ta.prototype,"contained",2);oe([he({attribute:"no-header",type:Boolean,reflect:!0})],Ta.prototype,"noHeader",2);oe([Ut("open",{waitUntilFirstUpdate:!0})],Ta.prototype,"handleOpenChange",1);oe([Ut("contained",{waitUntilFirstUpdate:!0})],Ta.prototype,"handleNoModalChange",1);ln("drawer.showTop",{keyframes:[{opacity:0,translate:"0 -100%"},{opacity:1,translate:"0 0"}],options:{duration:250,easing:"ease"}});ln("drawer.hideTop",{keyframes:[{opacity:1,translate:"0 0"},{opacity:0,translate:"0 -100%"}],options:{duration:250,easing:"ease"}});ln("drawer.showEnd",{keyframes:[{opacity:0,translate:"100%"},{opacity:1,translate:"0"}],rtlKeyframes:[{opacity:0,translate:"-100%"},{opacity:1,translate:"0"}],options:{duration:250,easing:"ease"}});ln("drawer.hideEnd",{keyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"100%"}],rtlKeyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"-100%"}],options:{duration:250,easing:"ease"}});ln("drawer.showBottom",{keyframes:[{opacity:0,translate:"0 100%"},{opacity:1,translate:"0 0"}],options:{duration:250,easing:"ease"}});ln("drawer.hideBottom",{keyframes:[{opacity:1,translate:"0 0"},{opacity:0,translate:"0 100%"}],options:{duration:250,easing:"ease"}});ln("drawer.showStart",{keyframes:[{opacity:0,translate:"-100%"},{opacity:1,translate:"0"}],rtlKeyframes:[{opacity:0,translate:"100%"},{opacity:1,translate:"0"}],options:{duration:250,easing:"ease"}});ln("drawer.hideStart",{keyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"-100%"}],rtlKeyframes:[{opacity:1,translate:"0"},{opacity:0,translate:"100%"}],options:{duration:250,easing:"ease"}});ln("drawer.denyClose",{keyframes:[{scale:1},{scale:1.01},{scale:1}],options:{duration:250}});ln("drawer.overlay.show",{keyframes:[{opacity:0},{opacity:1}],options:{duration:250}});ln("drawer.overlay.hide",{keyframes:[{opacity:1},{opacity:0}],options:{duration:250}});Ta.define("sl-drawer");var mJ=Ye`
  :host {
    --width: 31rem;
    --header-spacing: var(--sl-spacing-large);
    --body-spacing: var(--sl-spacing-large);
    --footer-spacing: var(--sl-spacing-large);

    display: contents;
  }

  .dialog {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: var(--sl-z-index-dialog);
  }

  .dialog__panel {
    display: flex;
    flex-direction: column;
    z-index: 2;
    width: var(--width);
    max-width: calc(100% - var(--sl-spacing-2x-large));
    max-height: calc(100% - var(--sl-spacing-2x-large));
    background-color: var(--sl-panel-background-color);
    border-radius: var(--sl-border-radius-medium);
    box-shadow: var(--sl-shadow-x-large);
  }

  .dialog__panel:focus {
    outline: none;
  }

  /* Ensure there's enough vertical padding for phones that don't update vh when chrome appears (e.g. iPhone) */
  @media screen and (max-width: 420px) {
    .dialog__panel {
      max-height: 80vh;
    }
  }

  .dialog--open .dialog__panel {
    display: flex;
    opacity: 1;
  }

  .dialog__header {
    flex: 0 0 auto;
    display: flex;
  }

  .dialog__title {
    flex: 1 1 auto;
    font: inherit;
    font-size: var(--sl-font-size-large);
    line-height: var(--sl-line-height-dense);
    padding: var(--header-spacing);
    margin: 0;
  }

  .dialog__header-actions {
    flex-shrink: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: end;
    gap: var(--sl-spacing-2x-small);
    padding: 0 var(--header-spacing);
  }

  .dialog__header-actions sl-icon-button,
  .dialog__header-actions ::slotted(sl-icon-button) {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
  }

  .dialog__body {
    flex: 1 1 auto;
    display: block;
    padding: var(--body-spacing);
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .dialog__footer {
    flex: 0 0 auto;
    text-align: right;
    padding: var(--footer-spacing);
  }

  .dialog__footer ::slotted(sl-button:not(:first-of-type)) {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  .dialog:not(.dialog--has-footer) .dialog__footer {
    display: none;
  }

  .dialog__overlay {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: var(--sl-overlay-background-color);
  }

  @media (forced-colors: active) {
    .dialog__panel {
      border: solid 1px var(--sl-color-neutral-0);
    }
  }
`,ad=class extends pr{constructor(){super(...arguments),this.hasSlotController=new fc(this,"footer"),this.localize=new js(this),this.modal=new WL(this),this.open=!1,this.label="",this.noHeader=!1,this.handleDocumentKeyDown=r=>{r.key==="Escape"&&this.modal.isActive()&&this.open&&(r.stopPropagation(),this.requestClose("keyboard"))}}firstUpdated(){this.dialog.hidden=!this.open,this.open&&(this.addOpenListeners(),this.modal.activate(),jb(this))}disconnectedCallback(){var r;super.disconnectedCallback(),this.modal.deactivate(),Nb(this),(r=this.closeWatcher)==null||r.destroy()}requestClose(r){if(this.emit("sl-request-close",{cancelable:!0,detail:{source:r}}).defaultPrevented){const t=ni(this,"dialog.denyClose",{dir:this.localize.dir()});$i(this.panel,t.keyframes,t.options);return}this.hide()}addOpenListeners(){var r;"CloseWatcher"in window?((r=this.closeWatcher)==null||r.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>this.requestClose("keyboard")):document.addEventListener("keydown",this.handleDocumentKeyDown)}removeOpenListeners(){var r;(r=this.closeWatcher)==null||r.destroy(),document.removeEventListener("keydown",this.handleDocumentKeyDown)}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.addOpenListeners(),this.originalTrigger=document.activeElement,this.modal.activate(),jb(this);const r=this.querySelector("[autofocus]");r&&r.removeAttribute("autofocus"),await Promise.all([Go(this.dialog),Go(this.overlay)]),this.dialog.hidden=!1,requestAnimationFrame(()=>{this.emit("sl-initial-focus",{cancelable:!0}).defaultPrevented||(r?r.focus({preventScroll:!0}):this.panel.focus({preventScroll:!0})),r&&r.setAttribute("autofocus","")});const e=ni(this,"dialog.show",{dir:this.localize.dir()}),t=ni(this,"dialog.overlay.show",{dir:this.localize.dir()});await Promise.all([$i(this.panel,e.keyframes,e.options),$i(this.overlay,t.keyframes,t.options)]),this.emit("sl-after-show")}else{this.emit("sl-hide"),this.removeOpenListeners(),this.modal.deactivate(),await Promise.all([Go(this.dialog),Go(this.overlay)]);const r=ni(this,"dialog.hide",{dir:this.localize.dir()}),e=ni(this,"dialog.overlay.hide",{dir:this.localize.dir()});await Promise.all([$i(this.overlay,e.keyframes,e.options).then(()=>{this.overlay.hidden=!0}),$i(this.panel,r.keyframes,r.options).then(()=>{this.panel.hidden=!0})]),this.dialog.hidden=!0,this.overlay.hidden=!1,this.panel.hidden=!1,Nb(this);const t=this.originalTrigger;typeof t?.focus=="function"&&setTimeout(()=>t.focus()),this.emit("sl-after-hide")}}async show(){if(!this.open)return this.open=!0,Ea(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,Ea(this,"sl-after-hide")}render(){return Ie`
      <div
        part="base"
        class=${br({dialog:!0,"dialog--open":this.open,"dialog--has-footer":this.hasSlotController.test("footer")})}
      >
        <div part="overlay" class="dialog__overlay" @click=${()=>this.requestClose("overlay")} tabindex="-1"></div>

        <div
          part="panel"
          class="dialog__panel"
          role="dialog"
          aria-modal="true"
          aria-hidden=${this.open?"false":"true"}
          aria-label=${ft(this.noHeader?this.label:void 0)}
          aria-labelledby=${ft(this.noHeader?void 0:"title")}
          tabindex="-1"
        >
          ${this.noHeader?"":Ie`
                <header part="header" class="dialog__header">
                  <h2 part="title" class="dialog__title" id="title">
                    <slot name="label"> ${this.label.length>0?this.label:"\uFEFF"} </slot>
                  </h2>
                  <div part="header-actions" class="dialog__header-actions">
                    <slot name="header-actions"></slot>
                    <sl-icon-button
                      part="close-button"
                      exportparts="base:close-button__base"
                      class="dialog__close"
                      name="x-lg"
                      label=${this.localize.term("close")}
                      library="system"
                      @click="${()=>this.requestClose("close-button")}"
                    ></sl-icon-button>
                  </div>
                </header>
              `}
          ${""}
          <div part="body" class="dialog__body" tabindex="-1"><slot></slot></div>

          <footer part="footer" class="dialog__footer">
            <slot name="footer"></slot>
          </footer>
        </div>
      </div>
    `}};ad.styles=[Tr,mJ];ad.dependencies={"sl-icon-button":Li};oe([Dt(".dialog")],ad.prototype,"dialog",2);oe([Dt(".dialog__panel")],ad.prototype,"panel",2);oe([Dt(".dialog__overlay")],ad.prototype,"overlay",2);oe([he({type:Boolean,reflect:!0})],ad.prototype,"open",2);oe([he({reflect:!0})],ad.prototype,"label",2);oe([he({attribute:"no-header",type:Boolean,reflect:!0})],ad.prototype,"noHeader",2);oe([Ut("open",{waitUntilFirstUpdate:!0})],ad.prototype,"handleOpenChange",1);ln("dialog.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:250,easing:"ease"}});ln("dialog.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:250,easing:"ease"}});ln("dialog.denyClose",{keyframes:[{scale:1},{scale:1.02},{scale:1}],options:{duration:250}});ln("dialog.overlay.show",{keyframes:[{opacity:0},{opacity:1}],options:{duration:250}});ln("dialog.overlay.hide",{keyframes:[{opacity:1},{opacity:0}],options:{duration:250}});ad.define("sl-dialog");var gJ=Ye`
  :host {
    display: contents;

    /* For better DX, we'll reset the margin here so the base part can inherit it */
    margin: 0;
  }

  .alert {
    position: relative;
    display: flex;
    align-items: stretch;
    background-color: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-top-width: calc(var(--sl-panel-border-width) * 3);
    border-radius: var(--sl-border-radius-medium);
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-small);
    font-weight: var(--sl-font-weight-normal);
    line-height: 1.6;
    color: var(--sl-color-neutral-700);
    margin: inherit;
  }

  .alert:not(.alert--has-icon) .alert__icon,
  .alert:not(.alert--closable) .alert__close-button {
    display: none;
  }

  .alert__icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-large);
    padding-inline-start: var(--sl-spacing-large);
  }

  .alert--primary {
    border-top-color: var(--sl-color-primary-600);
  }

  .alert--primary .alert__icon {
    color: var(--sl-color-primary-600);
  }

  .alert--success {
    border-top-color: var(--sl-color-success-600);
  }

  .alert--success .alert__icon {
    color: var(--sl-color-success-600);
  }

  .alert--neutral {
    border-top-color: var(--sl-color-neutral-600);
  }

  .alert--neutral .alert__icon {
    color: var(--sl-color-neutral-600);
  }

  .alert--warning {
    border-top-color: var(--sl-color-warning-600);
  }

  .alert--warning .alert__icon {
    color: var(--sl-color-warning-600);
  }

  .alert--danger {
    border-top-color: var(--sl-color-danger-600);
  }

  .alert--danger .alert__icon {
    color: var(--sl-color-danger-600);
  }

  .alert__message {
    flex: 1 1 auto;
    display: block;
    padding: var(--sl-spacing-large);
    overflow: hidden;
  }

  .alert__close-button {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    font-size: var(--sl-font-size-medium);
    padding-inline-end: var(--sl-spacing-medium);
  }
`,pm=Object.assign(document.createElement("div"),{className:"sl-toast-stack"}),cd=class extends pr{constructor(){super(...arguments),this.hasSlotController=new fc(this,"icon","suffix"),this.localize=new js(this),this.open=!1,this.closable=!1,this.variant="primary",this.duration=1/0}firstUpdated(){this.base.hidden=!this.open}restartAutoHide(){clearTimeout(this.autoHideTimeout),this.open&&this.duration<1/0&&(this.autoHideTimeout=window.setTimeout(()=>this.hide(),this.duration))}handleCloseClick(){this.hide()}handleMouseMove(){this.restartAutoHide()}async handleOpenChange(){if(this.open){this.emit("sl-show"),this.duration<1/0&&this.restartAutoHide(),await Go(this.base),this.base.hidden=!1;const{keyframes:r,options:e}=ni(this,"alert.show",{dir:this.localize.dir()});await $i(this.base,r,e),this.emit("sl-after-show")}else{this.emit("sl-hide"),clearTimeout(this.autoHideTimeout),await Go(this.base);const{keyframes:r,options:e}=ni(this,"alert.hide",{dir:this.localize.dir()});await $i(this.base,r,e),this.base.hidden=!0,this.emit("sl-after-hide")}}handleDurationChange(){this.restartAutoHide()}async show(){if(!this.open)return this.open=!0,Ea(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,Ea(this,"sl-after-hide")}async toast(){return new Promise(r=>{pm.parentElement===null&&document.body.append(pm),pm.appendChild(this),requestAnimationFrame(()=>{this.clientWidth,this.show()}),this.addEventListener("sl-after-hide",()=>{pm.removeChild(this),r(),pm.querySelector("sl-alert")===null&&pm.remove()},{once:!0})})}render(){return Ie`
      <div
        part="base"
        class=${br({alert:!0,"alert--open":this.open,"alert--closable":this.closable,"alert--has-icon":this.hasSlotController.test("icon"),"alert--primary":this.variant==="primary","alert--success":this.variant==="success","alert--neutral":this.variant==="neutral","alert--warning":this.variant==="warning","alert--danger":this.variant==="danger"})}
        role="alert"
        aria-hidden=${this.open?"false":"true"}
        @mousemove=${this.handleMouseMove}
      >
        <div part="icon" class="alert__icon">
          <slot name="icon"></slot>
        </div>

        <div part="message" class="alert__message" aria-live="polite">
          <slot></slot>
        </div>

        ${this.closable?Ie`
              <sl-icon-button
                part="close-button"
                exportparts="base:close-button__base"
                class="alert__close-button"
                name="x-lg"
                library="system"
                label=${this.localize.term("close")}
                @click=${this.handleCloseClick}
              ></sl-icon-button>
            `:""}
      </div>
    `}};cd.styles=[Tr,gJ];cd.dependencies={"sl-icon-button":Li};oe([Dt('[part~="base"]')],cd.prototype,"base",2);oe([he({type:Boolean,reflect:!0})],cd.prototype,"open",2);oe([he({type:Boolean,reflect:!0})],cd.prototype,"closable",2);oe([he({reflect:!0})],cd.prototype,"variant",2);oe([he({type:Number})],cd.prototype,"duration",2);oe([Ut("open",{waitUntilFirstUpdate:!0})],cd.prototype,"handleOpenChange",1);oe([Ut("duration")],cd.prototype,"handleDurationChange",1);ln("alert.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:250,easing:"ease"}});ln("alert.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:250,easing:"ease"}});cd.define("sl-alert");var vJ=Ye`
  :host {
    --border-radius: var(--sl-border-radius-pill);
    --color: var(--sl-color-neutral-200);
    --sheen-color: var(--sl-color-neutral-300);

    display: block;
    position: relative;
  }

  .skeleton {
    display: flex;
    width: 100%;
    height: 100%;
    min-height: 1rem;
  }

  .skeleton__indicator {
    flex: 1 1 auto;
    background: var(--color);
    border-radius: var(--border-radius);
  }

  .skeleton--sheen .skeleton__indicator {
    background: linear-gradient(270deg, var(--sheen-color), var(--color), var(--color), var(--sheen-color));
    background-size: 400% 100%;
    animation: sheen 8s ease-in-out infinite;
  }

  .skeleton--pulse .skeleton__indicator {
    animation: pulse 2s ease-in-out 0.5s infinite;
  }

  /* Forced colors mode */
  @media (forced-colors: active) {
    :host {
      --color: GrayText;
    }
  }

  @keyframes sheen {
    0% {
      background-position: 200% 0;
    }
    to {
      background-position: -200% 0;
    }
  }

  @keyframes pulse {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0.4;
    }
    100% {
      opacity: 1;
    }
  }
`,nO=class extends pr{constructor(){super(...arguments),this.effect="none"}render(){return Ie`
      <div
        part="base"
        class=${br({skeleton:!0,"skeleton--pulse":this.effect==="pulse","skeleton--sheen":this.effect==="sheen"})}
      >
        <div part="indicator" class="skeleton__indicator"></div>
      </div>
    `}};nO.styles=[Tr,vJ];oe([he()],nO.prototype,"effect",2);nO.define("sl-skeleton");jr.define("sl-popup");ji.define("sl-tooltip");Ax.define("sl-spinner");var bJ=Ye`
  :host {
    --divider-width: 4px;
    --divider-hit-area: 12px;
    --min: 0%;
    --max: 100%;

    display: grid;
  }

  .start,
  .end {
    overflow: hidden;
  }

  .divider {
    flex: 0 0 var(--divider-width);
    display: flex;
    position: relative;
    align-items: center;
    justify-content: center;
    background-color: var(--sl-color-neutral-200);
    color: var(--sl-color-neutral-900);
    z-index: 1;
  }

  .divider:focus {
    outline: none;
  }

  :host(:not([disabled])) .divider:focus-visible {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  :host([disabled]) .divider {
    cursor: not-allowed;
  }

  /* Horizontal */
  :host(:not([vertical], [disabled])) .divider {
    cursor: col-resize;
  }

  :host(:not([vertical])) .divider::after {
    display: flex;
    content: '';
    position: absolute;
    height: 100%;
    left: calc(var(--divider-hit-area) / -2 + var(--divider-width) / 2);
    width: var(--divider-hit-area);
  }

  /* Vertical */
  :host([vertical]) {
    flex-direction: column;
  }

  :host([vertical]:not([disabled])) .divider {
    cursor: row-resize;
  }

  :host([vertical]) .divider::after {
    content: '';
    position: absolute;
    width: 100%;
    top: calc(var(--divider-hit-area) / -2 + var(--divider-width) / 2);
    height: var(--divider-hit-area);
  }

  @media (forced-colors: active) {
    .divider {
      outline: solid 1px transparent;
    }
  }
`;function wJ(r,e){function t(i){const o=r.getBoundingClientRect(),s=r.ownerDocument.defaultView,a=o.left+s.scrollX,l=o.top+s.scrollY,d=i.pageX-a,c=i.pageY-l;e?.onMove&&e.onMove(d,c)}function n(){document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",n),e?.onStop&&e.onStop()}document.addEventListener("pointermove",t,{passive:!0}),document.addEventListener("pointerup",n),e?.initialEvent instanceof PointerEvent&&t(e.initialEvent)}var $a=class extends pr{constructor(){super(...arguments),this.localize=new js(this),this.position=50,this.vertical=!1,this.disabled=!1,this.snapThreshold=12}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(r=>this.handleResize(r)),this.updateComplete.then(()=>this.resizeObserver.observe(this)),this.detectSize(),this.cachedPositionInPixels=this.percentageToPixels(this.position)}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver.unobserve(this)}detectSize(){const{width:r,height:e}=this.getBoundingClientRect();this.size=this.vertical?e:r}percentageToPixels(r){return this.size*(r/100)}pixelsToPercentage(r){return r/this.size*100}handleDrag(r){const e=this.matches(":dir(rtl)");this.disabled||(r.cancelable&&r.preventDefault(),wJ(this,{onMove:(t,n)=>{let i=this.vertical?n:t;this.primary==="end"&&(i=this.size-i),this.snap&&this.snap.split(" ").forEach(s=>{let a;s.endsWith("%")?a=this.size*(parseFloat(s)/100):a=parseFloat(s),e&&!this.vertical&&(a=this.size-a),i>=a-this.snapThreshold&&i<=a+this.snapThreshold&&(i=a)}),this.position=VE(this.pixelsToPercentage(i),0,100)},initialEvent:r}))}handleKeyDown(r){if(!this.disabled&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(r.key)){let e=this.position;const t=(r.shiftKey?10:1)*(this.primary==="end"?-1:1);r.preventDefault(),(r.key==="ArrowLeft"&&!this.vertical||r.key==="ArrowUp"&&this.vertical)&&(e-=t),(r.key==="ArrowRight"&&!this.vertical||r.key==="ArrowDown"&&this.vertical)&&(e+=t),r.key==="Home"&&(e=this.primary==="end"?100:0),r.key==="End"&&(e=this.primary==="end"?0:100),this.position=VE(e,0,100)}}handleResize(r){const{width:e,height:t}=r[0].contentRect;this.size=this.vertical?t:e,(isNaN(this.cachedPositionInPixels)||this.position===1/0)&&(this.cachedPositionInPixels=Number(this.getAttribute("position-in-pixels")),this.positionInPixels=Number(this.getAttribute("position-in-pixels")),this.position=this.pixelsToPercentage(this.positionInPixels)),this.primary&&(this.position=this.pixelsToPercentage(this.cachedPositionInPixels))}handlePositionChange(){this.cachedPositionInPixels=this.percentageToPixels(this.position),this.positionInPixels=this.percentageToPixels(this.position),this.emit("sl-reposition")}handlePositionInPixelsChange(){this.position=this.pixelsToPercentage(this.positionInPixels)}handleVerticalChange(){this.detectSize()}render(){const r=this.vertical?"gridTemplateRows":"gridTemplateColumns",e=this.vertical?"gridTemplateColumns":"gridTemplateRows",t=this.matches(":dir(rtl)"),n=`
      clamp(
        0%,
        clamp(
          var(--min),
          ${this.position}% - var(--divider-width) / 2,
          var(--max)
        ),
        calc(100% - var(--divider-width))
      )
    `,i="auto";return this.primary==="end"?t&&!this.vertical?this.style[r]=`${n} var(--divider-width) ${i}`:this.style[r]=`${i} var(--divider-width) ${n}`:t&&!this.vertical?this.style[r]=`${i} var(--divider-width) ${n}`:this.style[r]=`${n} var(--divider-width) ${i}`,this.style[e]="",Ie`
      <slot name="start" part="panel start" class="start"></slot>

      <div
        part="divider"
        class="divider"
        tabindex=${ft(this.disabled?void 0:"0")}
        role="separator"
        aria-valuenow=${this.position}
        aria-valuemin="0"
        aria-valuemax="100"
        aria-label=${this.localize.term("resize")}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleDrag}
        @touchstart=${this.handleDrag}
      >
        <slot name="divider"></slot>
      </div>

      <slot name="end" part="panel end" class="end"></slot>
    `}};$a.styles=[Tr,bJ];oe([Dt(".divider")],$a.prototype,"divider",2);oe([he({type:Number,reflect:!0})],$a.prototype,"position",2);oe([he({attribute:"position-in-pixels",type:Number})],$a.prototype,"positionInPixels",2);oe([he({type:Boolean,reflect:!0})],$a.prototype,"vertical",2);oe([he({type:Boolean,reflect:!0})],$a.prototype,"disabled",2);oe([he()],$a.prototype,"primary",2);oe([he()],$a.prototype,"snap",2);oe([he({type:Number,attribute:"snap-threshold"})],$a.prototype,"snapThreshold",2);oe([Ut("position")],$a.prototype,"handlePositionChange",1);oe([Ut("positionInPixels")],$a.prototype,"handlePositionInPixelsChange",1);oe([Ut("vertical")],$a.prototype,"handleVerticalChange",1);$a.define("sl-split-panel");var _J=Ye`
  :host {
    display: inline-block;
  }

  :host([size='small']) {
    --height: var(--sl-toggle-size-small);
    --thumb-size: calc(var(--sl-toggle-size-small) + 4px);
    --width: calc(var(--height) * 2);

    font-size: var(--sl-input-font-size-small);
  }

  :host([size='medium']) {
    --height: var(--sl-toggle-size-medium);
    --thumb-size: calc(var(--sl-toggle-size-medium) + 4px);
    --width: calc(var(--height) * 2);

    font-size: var(--sl-input-font-size-medium);
  }

  :host([size='large']) {
    --height: var(--sl-toggle-size-large);
    --thumb-size: calc(var(--sl-toggle-size-large) + 4px);
    --width: calc(var(--height) * 2);

    font-size: var(--sl-input-font-size-large);
  }

  .switch {
    position: relative;
    display: inline-flex;
    align-items: center;
    font-family: var(--sl-input-font-family);
    font-size: inherit;
    font-weight: var(--sl-input-font-weight);
    color: var(--sl-input-label-color);
    vertical-align: middle;
    cursor: pointer;
  }

  .switch__control {
    flex: 0 0 auto;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--width);
    height: var(--height);
    background-color: var(--sl-color-neutral-400);
    border: solid var(--sl-input-border-width) var(--sl-color-neutral-400);
    border-radius: var(--height);
    transition:
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) background-color;
  }

  .switch__control .switch__thumb {
    width: var(--thumb-size);
    height: var(--thumb-size);
    background-color: var(--sl-color-neutral-0);
    border-radius: 50%;
    border: solid var(--sl-input-border-width) var(--sl-color-neutral-400);
    translate: calc((var(--width) - var(--height)) / -2);
    transition:
      var(--sl-transition-fast) translate ease,
      var(--sl-transition-fast) background-color,
      var(--sl-transition-fast) border-color,
      var(--sl-transition-fast) box-shadow;
  }

  .switch__input {
    position: absolute;
    opacity: 0;
    padding: 0;
    margin: 0;
    pointer-events: none;
  }

  /* Hover */
  .switch:not(.switch--checked):not(.switch--disabled) .switch__control:hover {
    background-color: var(--sl-color-neutral-400);
    border-color: var(--sl-color-neutral-400);
  }

  .switch:not(.switch--checked):not(.switch--disabled) .switch__control:hover .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-neutral-400);
  }

  /* Focus */
  .switch:not(.switch--checked):not(.switch--disabled) .switch__input:focus-visible ~ .switch__control {
    background-color: var(--sl-color-neutral-400);
    border-color: var(--sl-color-neutral-400);
  }

  .switch:not(.switch--checked):not(.switch--disabled) .switch__input:focus-visible ~ .switch__control .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Checked */
  .switch--checked .switch__control {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
  }

  .switch--checked .switch__control .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    translate: calc((var(--width) - var(--height)) / 2);
  }

  /* Checked + hover */
  .switch.switch--checked:not(.switch--disabled) .switch__control:hover {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
  }

  .switch.switch--checked:not(.switch--disabled) .switch__control:hover .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
  }

  /* Checked + focus */
  .switch.switch--checked:not(.switch--disabled) .switch__input:focus-visible ~ .switch__control {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
  }

  .switch.switch--checked:not(.switch--disabled) .switch__input:focus-visible ~ .switch__control .switch__thumb {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-color-primary-600);
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  /* Disabled */
  .switch--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .switch__label {
    display: inline-block;
    line-height: var(--height);
    margin-inline-start: 0.5em;
    user-select: none;
    -webkit-user-select: none;
  }

  :host([required]) .switch__label::after {
    content: var(--sl-input-required-content);
    color: var(--sl-input-required-content-color);
    margin-inline-start: var(--sl-input-required-content-offset);
  }

  @media (forced-colors: active) {
    .switch.switch--checked:not(.switch--disabled) .switch__control:hover .switch__thumb,
    .switch--checked .switch__control .switch__thumb {
      background-color: ButtonText;
    }
  }
`,Jo=class extends pr{constructor(){super(...arguments),this.formControlController=new bv(this,{value:r=>r.checked?r.value||"on":void 0,defaultValue:r=>r.defaultChecked,setValue:(r,e)=>r.checked=e}),this.hasSlotController=new fc(this,"help-text"),this.hasFocus=!1,this.title="",this.name="",this.size="medium",this.disabled=!1,this.checked=!1,this.defaultChecked=!1,this.form="",this.required=!1,this.helpText=""}get validity(){return this.input.validity}get validationMessage(){return this.input.validationMessage}firstUpdated(){this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleInput(){this.emit("sl-input")}handleInvalid(r){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(r)}handleClick(){this.checked=!this.checked,this.emit("sl-change")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleKeyDown(r){r.key==="ArrowLeft"&&(r.preventDefault(),this.checked=!1,this.emit("sl-change"),this.emit("sl-input")),r.key==="ArrowRight"&&(r.preventDefault(),this.checked=!0,this.emit("sl-change"),this.emit("sl-input"))}handleCheckedChange(){this.input.checked=this.checked,this.formControlController.updateValidity()}handleDisabledChange(){this.formControlController.setValidity(!0)}click(){this.input.click()}focus(r){this.input.focus(r)}blur(){this.input.blur()}checkValidity(){return this.input.checkValidity()}getForm(){return this.formControlController.getForm()}reportValidity(){return this.input.reportValidity()}setCustomValidity(r){this.input.setCustomValidity(r),this.formControlController.updateValidity()}render(){const r=this.hasSlotController.test("help-text"),e=this.helpText?!0:!!r;return Ie`
      <div
        class=${br({"form-control":!0,"form-control--small":this.size==="small","form-control--medium":this.size==="medium","form-control--large":this.size==="large","form-control--has-help-text":e})}
      >
        <label
          part="base"
          class=${br({switch:!0,"switch--checked":this.checked,"switch--disabled":this.disabled,"switch--focused":this.hasFocus,"switch--small":this.size==="small","switch--medium":this.size==="medium","switch--large":this.size==="large"})}
        >
          <input
            class="switch__input"
            type="checkbox"
            title=${this.title}
            name=${this.name}
            value=${ft(this.value)}
            .checked=${yw(this.checked)}
            .disabled=${this.disabled}
            .required=${this.required}
            role="switch"
            aria-checked=${this.checked?"true":"false"}
            aria-describedby="help-text"
            @click=${this.handleClick}
            @input=${this.handleInput}
            @invalid=${this.handleInvalid}
            @blur=${this.handleBlur}
            @focus=${this.handleFocus}
            @keydown=${this.handleKeyDown}
          />

          <span part="control" class="switch__control">
            <span part="thumb" class="switch__thumb"></span>
          </span>

          <div part="label" class="switch__label">
            <slot></slot>
          </div>
        </label>

        <div
          aria-hidden=${e?"false":"true"}
          class="form-control__help-text"
          id="help-text"
          part="form-control-help-text"
        >
          <slot name="help-text">${this.helpText}</slot>
        </div>
      </div>
    `}};Jo.styles=[Tr,u_,_J];oe([Dt('input[type="checkbox"]')],Jo.prototype,"input",2);oe([ii()],Jo.prototype,"hasFocus",2);oe([he()],Jo.prototype,"title",2);oe([he()],Jo.prototype,"name",2);oe([he()],Jo.prototype,"value",2);oe([he({reflect:!0})],Jo.prototype,"size",2);oe([he({type:Boolean,reflect:!0})],Jo.prototype,"disabled",2);oe([he({type:Boolean,reflect:!0})],Jo.prototype,"checked",2);oe([$x("checked")],Jo.prototype,"defaultChecked",2);oe([he({reflect:!0})],Jo.prototype,"form",2);oe([he({type:Boolean,reflect:!0})],Jo.prototype,"required",2);oe([he({attribute:"help-text"})],Jo.prototype,"helpText",2);oe([Ut("checked",{waitUntilFirstUpdate:!0})],Jo.prototype,"handleCheckedChange",1);oe([Ut("disabled",{waitUntilFirstUpdate:!0})],Jo.prototype,"handleDisabledChange",1);Jo.define("sl-switch");var EJ=Ye`
  :host {
    display: inline-block;
  }
`;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const HL="important",AJ=" !"+HL,xJ=_x(class extends Ex{constructor(r){if(super(r),r.type!==Xd.ATTRIBUTE||r.name!=="style"||r.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(r){return Object.keys(r).reduce((e,t)=>{const n=r[t];return n==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(r,[e]){const{style:t}=r.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const n of this.ft)e[n]==null&&(this.ft.delete(n),n.includes("-")?t.removeProperty(n):t[n]=null);for(const n in e){const i=e[n];if(i!=null){this.ft.add(n);const o=typeof i=="string"&&i.endsWith(AJ);n.includes("-")||o?t.setProperty(n,o?i.slice(0,-11):i,o?HL:""):t[n]=i}}return ic}});let GL=null,YL=class{};YL.render=function(r,e){GL(r,e)};self.QrCreator=YL;(function(r){function e(a,l,d,c){var u={},f=r(d,l);f.u(a),f.J(),c=c||0;var h=f.h(),p=f.h()+2*c;return u.text=a,u.level=l,u.version=d,u.O=p,u.a=function(y,g){return y-=c,g-=c,0>y||y>=h||0>g||g>=h?!1:f.a(y,g)},u}function t(a,l,d,c,u,f,h,p,y,g){function w(v,m,b,_,E,S,T){v?(a.lineTo(m+S,b+T),a.arcTo(m,b,_,E,f)):a.lineTo(m,b)}h?a.moveTo(l+f,d):a.moveTo(l,d),w(p,c,d,c,u,-f,0),w(y,c,u,l,u,0,-f),w(g,l,u,l,d,f,0),w(h,l,d,c,d,0,f)}function n(a,l,d,c,u,f,h,p,y,g){function w(v,m,b,_){a.moveTo(v+b,m),a.lineTo(v,m),a.lineTo(v,m+_),a.arcTo(v,m,v+b,m,f)}h&&w(l,d,f,f),p&&w(c,d,-f,f),y&&w(c,u,-f,-f),g&&w(l,u,f,-f)}function i(a,l){var d=l.fill;if(typeof d=="string")a.fillStyle=d;else{var c=d.type,u=d.colorStops;if(d=d.position.map(h=>Math.round(h*l.size)),c==="linear-gradient")var f=a.createLinearGradient.apply(a,d);else if(c==="radial-gradient")f=a.createRadialGradient.apply(a,d);else throw Error("Unsupported fill");u.forEach(([h,p])=>{f.addColorStop(h,p)}),a.fillStyle=f}}function o(a,l){e:{var d=l.text,c=l.v,u=l.N,f=l.K,h=l.P;for(u=Math.max(1,u||1),f=Math.min(40,f||40);u<=f;u+=1)try{var p=e(d,c,u,h);break e}catch{}p=void 0}if(!p)return null;for(d=a.getContext("2d"),l.background&&(d.fillStyle=l.background,d.fillRect(l.left,l.top,l.size,l.size)),c=p.O,f=l.size/c,d.beginPath(),h=0;h<c;h+=1)for(u=0;u<c;u+=1){var y=d,g=l.left+u*f,w=l.top+h*f,v=h,m=u,b=p.a,_=g+f,E=w+f,S=v-1,T=v+1,O=m-1,M=m+1,Q=Math.floor(Math.min(.5,Math.max(0,l.R))*f),W=b(v,m),U=b(S,O),ee=b(S,m);S=b(S,M);var R=b(v,M);M=b(T,M),m=b(T,m),T=b(T,O),v=b(v,O),g=Math.round(g),w=Math.round(w),_=Math.round(_),E=Math.round(E),W?t(y,g,w,_,E,Q,!ee&&!v,!ee&&!R,!m&&!R,!m&&!v):n(y,g,w,_,E,Q,ee&&v&&U,ee&&R&&S,m&&R&&M,m&&v&&T)}return i(d,l),d.fill(),a}var s={minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:200,fill:"#000",background:null,text:"no text",radius:.5,quiet:0};GL=function(a,l){var d={};Object.assign(d,s,a),d.N=d.minVersion,d.K=d.maxVersion,d.v=d.ecLevel,d.left=d.left,d.top=d.top,d.size=d.size,d.fill=d.fill,d.background=d.background,d.text=d.text,d.R=d.radius,d.P=d.quiet,l instanceof HTMLCanvasElement?((l.width!==d.size||l.height!==d.size)&&(l.width=d.size,l.height=d.size),l.getContext("2d").clearRect(0,0,l.width,l.height),o(l,d)):(a=document.createElement("canvas"),a.width=d.size,a.height=d.size,d=o(a,d),l.appendChild(d))}})(function(){function r(l){var d=t.s(l);return{S:function(){return 4},b:function(){return d.length},write:function(c){for(var u=0;u<d.length;u+=1)c.put(d[u],8)}}}function e(){var l=[],d=0,c={B:function(){return l},c:function(u){return(l[Math.floor(u/8)]>>>7-u%8&1)==1},put:function(u,f){for(var h=0;h<f;h+=1)c.m((u>>>f-h-1&1)==1)},f:function(){return d},m:function(u){var f=Math.floor(d/8);l.length<=f&&l.push(0),u&&(l[f]|=128>>>d%8),d+=1}};return c}function t(l,d){function c(v,m){for(var b=-1;7>=b;b+=1)if(!(-1>=v+b||p<=v+b))for(var _=-1;7>=_;_+=1)-1>=m+_||p<=m+_||(h[v+b][m+_]=0<=b&&6>=b&&(_==0||_==6)||0<=_&&6>=_&&(b==0||b==6)||2<=b&&4>=b&&2<=_&&4>=_)}function u(v,m){for(var b=p=4*l+17,_=Array(b),E=0;E<b;E+=1){_[E]=Array(b);for(var S=0;S<b;S+=1)_[E][S]=null}for(h=_,c(0,0),c(p-7,0),c(0,p-7),b=o.G(l),_=0;_<b.length;_+=1)for(E=0;E<b.length;E+=1){S=b[_];var T=b[E];if(h[S][T]==null)for(var O=-2;2>=O;O+=1)for(var M=-2;2>=M;M+=1)h[S+O][T+M]=O==-2||O==2||M==-2||M==2||O==0&&M==0}for(b=8;b<p-8;b+=1)h[b][6]==null&&(h[b][6]=b%2==0);for(b=8;b<p-8;b+=1)h[6][b]==null&&(h[6][b]=b%2==0);for(b=o.w(f<<3|m),_=0;15>_;_+=1)E=!v&&(b>>_&1)==1,h[6>_?_:8>_?_+1:p-15+_][8]=E,h[8][8>_?p-_-1:9>_?15-_:14-_]=E;if(h[p-8][8]=!v,7<=l){for(b=o.A(l),_=0;18>_;_+=1)E=!v&&(b>>_&1)==1,h[Math.floor(_/3)][_%3+p-8-3]=E;for(_=0;18>_;_+=1)E=!v&&(b>>_&1)==1,h[_%3+p-8-3][Math.floor(_/3)]=E}if(y==null){for(v=a.I(l,f),b=e(),_=0;_<g.length;_+=1)E=g[_],b.put(4,4),b.put(E.b(),o.f(4,l)),E.write(b);for(_=E=0;_<v.length;_+=1)E+=v[_].j;if(b.f()>8*E)throw Error("code length overflow. ("+b.f()+">"+8*E+")");for(b.f()+4<=8*E&&b.put(0,4);b.f()%8!=0;)b.m(!1);for(;!(b.f()>=8*E)&&(b.put(236,8),!(b.f()>=8*E));)b.put(17,8);var Q=0;for(E=_=0,S=Array(v.length),T=Array(v.length),O=0;O<v.length;O+=1){var W=v[O].j,U=v[O].o-W;for(_=Math.max(_,W),E=Math.max(E,U),S[O]=Array(W),M=0;M<S[O].length;M+=1)S[O][M]=255&b.B()[M+Q];for(Q+=W,M=o.C(U),W=n(S[O],M.b()-1).l(M),T[O]=Array(M.b()-1),M=0;M<T[O].length;M+=1)U=M+W.b()-T[O].length,T[O][M]=0<=U?W.c(U):0}for(M=b=0;M<v.length;M+=1)b+=v[M].o;for(b=Array(b),M=Q=0;M<_;M+=1)for(O=0;O<v.length;O+=1)M<S[O].length&&(b[Q]=S[O][M],Q+=1);for(M=0;M<E;M+=1)for(O=0;O<v.length;O+=1)M<T[O].length&&(b[Q]=T[O][M],Q+=1);y=b}for(v=y,b=-1,_=p-1,E=7,S=0,m=o.F(m),T=p-1;0<T;T-=2)for(T==6&&--T;;){for(O=0;2>O;O+=1)h[_][T-O]==null&&(M=!1,S<v.length&&(M=(v[S]>>>E&1)==1),m(_,T-O)&&(M=!M),h[_][T-O]=M,--E,E==-1&&(S+=1,E=7));if(_+=b,0>_||p<=_){_-=b,b=-b;break}}}var f=i[d],h=null,p=0,y=null,g=[],w={u:function(v){v=r(v),g.push(v),y=null},a:function(v,m){if(0>v||p<=v||0>m||p<=m)throw Error(v+","+m);return h[v][m]},h:function(){return p},J:function(){for(var v=0,m=0,b=0;8>b;b+=1){u(!0,b);var _=o.D(w);(b==0||v>_)&&(v=_,m=b)}u(!1,m)}};return w}function n(l,d){if(typeof l.length>"u")throw Error(l.length+"/"+d);var c=function(){for(var f=0;f<l.length&&l[f]==0;)f+=1;for(var h=Array(l.length-f+d),p=0;p<l.length-f;p+=1)h[p]=l[p+f];return h}(),u={c:function(f){return c[f]},b:function(){return c.length},multiply:function(f){for(var h=Array(u.b()+f.b()-1),p=0;p<u.b();p+=1)for(var y=0;y<f.b();y+=1)h[p+y]^=s.i(s.g(u.c(p))+s.g(f.c(y)));return n(h,0)},l:function(f){if(0>u.b()-f.b())return u;for(var h=s.g(u.c(0))-s.g(f.c(0)),p=Array(u.b()),y=0;y<u.b();y+=1)p[y]=u.c(y);for(y=0;y<f.b();y+=1)p[y]^=s.i(s.g(f.c(y))+h);return n(p,0).l(f)}};return u}t.s=function(l){for(var d=[],c=0;c<l.length;c++){var u=l.charCodeAt(c);128>u?d.push(u):2048>u?d.push(192|u>>6,128|u&63):55296>u||57344<=u?d.push(224|u>>12,128|u>>6&63,128|u&63):(c++,u=65536+((u&1023)<<10|l.charCodeAt(c)&1023),d.push(240|u>>18,128|u>>12&63,128|u>>6&63,128|u&63))}return d};var i={L:1,M:0,Q:3,H:2},o=function(){function l(u){for(var f=0;u!=0;)f+=1,u>>>=1;return f}var d=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],c={w:function(u){for(var f=u<<10;0<=l(f)-l(1335);)f^=1335<<l(f)-l(1335);return(u<<10|f)^21522},A:function(u){for(var f=u<<12;0<=l(f)-l(7973);)f^=7973<<l(f)-l(7973);return u<<12|f},G:function(u){return d[u-1]},F:function(u){switch(u){case 0:return function(f,h){return(f+h)%2==0};case 1:return function(f){return f%2==0};case 2:return function(f,h){return h%3==0};case 3:return function(f,h){return(f+h)%3==0};case 4:return function(f,h){return(Math.floor(f/2)+Math.floor(h/3))%2==0};case 5:return function(f,h){return f*h%2+f*h%3==0};case 6:return function(f,h){return(f*h%2+f*h%3)%2==0};case 7:return function(f,h){return(f*h%3+(f+h)%2)%2==0};default:throw Error("bad maskPattern:"+u)}},C:function(u){for(var f=n([1],0),h=0;h<u;h+=1)f=f.multiply(n([1,s.i(h)],0));return f},f:function(u,f){if(u!=4||1>f||40<f)throw Error("mode: "+u+"; type: "+f);return 10>f?8:16},D:function(u){for(var f=u.h(),h=0,p=0;p<f;p+=1)for(var y=0;y<f;y+=1){for(var g=0,w=u.a(p,y),v=-1;1>=v;v+=1)if(!(0>p+v||f<=p+v))for(var m=-1;1>=m;m+=1)0>y+m||f<=y+m||(v!=0||m!=0)&&w==u.a(p+v,y+m)&&(g+=1);5<g&&(h+=3+g-5)}for(p=0;p<f-1;p+=1)for(y=0;y<f-1;y+=1)g=0,u.a(p,y)&&(g+=1),u.a(p+1,y)&&(g+=1),u.a(p,y+1)&&(g+=1),u.a(p+1,y+1)&&(g+=1),(g==0||g==4)&&(h+=3);for(p=0;p<f;p+=1)for(y=0;y<f-6;y+=1)u.a(p,y)&&!u.a(p,y+1)&&u.a(p,y+2)&&u.a(p,y+3)&&u.a(p,y+4)&&!u.a(p,y+5)&&u.a(p,y+6)&&(h+=40);for(y=0;y<f;y+=1)for(p=0;p<f-6;p+=1)u.a(p,y)&&!u.a(p+1,y)&&u.a(p+2,y)&&u.a(p+3,y)&&u.a(p+4,y)&&!u.a(p+5,y)&&u.a(p+6,y)&&(h+=40);for(y=g=0;y<f;y+=1)for(p=0;p<f;p+=1)u.a(p,y)&&(g+=1);return h+=Math.abs(100*g/f/f-50)/5*10}};return c}(),s=function(){for(var l=Array(256),d=Array(256),c=0;8>c;c+=1)l[c]=1<<c;for(c=8;256>c;c+=1)l[c]=l[c-4]^l[c-5]^l[c-6]^l[c-8];for(c=0;255>c;c+=1)d[l[c]]=c;return{g:function(u){if(1>u)throw Error("glog("+u+")");return d[u]},i:function(u){for(;0>u;)u+=255;for(;256<=u;)u-=255;return l[u]}}}(),a=function(){function l(u,f){switch(f){case i.L:return d[4*(u-1)];case i.M:return d[4*(u-1)+1];case i.Q:return d[4*(u-1)+2];case i.H:return d[4*(u-1)+3]}}var d=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],c={I:function(u,f){var h=l(u,f);if(typeof h>"u")throw Error("bad rs block @ typeNumber:"+u+"/errorCorrectLevel:"+f);u=h.length/3,f=[];for(var p=0;p<u;p+=1)for(var y=h[3*p],g=h[3*p+1],w=h[3*p+2],v=0;v<y;v+=1){var m=w,b={};b.o=g,b.j=m,f.push(b)}return f}};return c}();return t}());const SJ=QrCreator;var tl=class extends pr{constructor(){super(...arguments),this.value="",this.label="",this.size=128,this.fill="black",this.background="white",this.radius=0,this.errorCorrection="H"}firstUpdated(){this.generate()}generate(){this.hasUpdated&&SJ.render({text:this.value,radius:this.radius,ecLevel:this.errorCorrection,fill:this.fill,background:this.background,size:this.size*2},this.canvas)}render(){var r;return Ie`
      <canvas
        part="base"
        class="qr-code"
        role="img"
        aria-label=${((r=this.label)==null?void 0:r.length)>0?this.label:this.value}
        style=${xJ({width:`${this.size}px`,height:`${this.size}px`})}
      ></canvas>
    `}};tl.styles=[Tr,EJ];oe([Dt("canvas")],tl.prototype,"canvas",2);oe([he()],tl.prototype,"value",2);oe([he()],tl.prototype,"label",2);oe([he({type:Number})],tl.prototype,"size",2);oe([he()],tl.prototype,"fill",2);oe([he()],tl.prototype,"background",2);oe([he({type:Number})],tl.prototype,"radius",2);oe([he({attribute:"error-correction"})],tl.prototype,"errorCorrection",2);oe([Ut(["background","errorCorrection","fill","radius","size","value"])],tl.prototype,"generate",1);tl.define("sl-qr-code");var db=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function Vu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function kx(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var TJ=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,$J=TJ,kJ=$J,PJ=typeof self=="object"&&self&&self.Object===Object&&self,IJ=kJ||PJ||Function("return this")(),OJ=IJ,CJ=OJ,RJ=CJ.Symbol,ZL=RJ,h3=ZL,JL=Object.prototype,DJ=JL.hasOwnProperty,MJ=JL.toString,l0=h3?h3.toStringTag:void 0;function BJ(r){var e=DJ.call(r,l0),t=r[l0];try{r[l0]=void 0;var n=!0}catch{}var i=MJ.call(r);return n&&(e?r[l0]=t:delete r[l0]),i}var jJ=BJ,NJ=Object.prototype,UJ=NJ.toString;function LJ(r){return UJ.call(r)}var KJ=LJ,p3=ZL,zJ=jJ,FJ=KJ,qJ="[object Null]",VJ="[object Undefined]",y3=p3?p3.toStringTag:void 0;function WJ(r){return r==null?r===void 0?VJ:qJ:y3&&y3 in Object(r)?zJ(r):FJ(r)}var HJ=WJ;function GJ(r,e){return function(t){return r(e(t))}}var YJ=GJ,ZJ=YJ,JJ=ZJ(Object.getPrototypeOf,Object),XJ=JJ;function QJ(r){return r!=null&&typeof r=="object"}var eX=QJ,tX=HJ,rX=XJ,nX=eX,iX="[object Object]",oX=Function.prototype,sX=Object.prototype,XL=oX.toString,aX=sX.hasOwnProperty,cX=XL.call(Object);function lX(r){if(!nX(r)||tX(r)!=iX)return!1;var e=rX(r);if(e===null)return!0;var t=aX.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&XL.call(t)==cX}var dX=lX;const uX=Vu(dX);function fX(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,l=r.charAt(0),d=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,g=0,w=0,v=p.length;w!==v&&p[w]===0;)w++,y++;for(var m=(v-w)*c+1>>>0,b=new Uint8Array(m);w!==v;){for(var _=p[w],E=0,S=m-1;(_!==0||E<g)&&S!==-1;S--,E++)_+=256*b[S]>>>0,b[S]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");g=E,w++}for(var T=m-g;T!==m&&b[T]===0;)T++;for(var O=l.repeat(y);T<m;++T)O+=r.charAt(b[T]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var g=0,w=0;p[y]===l;)g++,y++;for(var v=(p.length-y)*d+1>>>0,m=new Uint8Array(v);p[y];){var b=t[p.charCodeAt(y)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<w)&&E!==-1;E--,_++)b+=a*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");w=_,y++}if(p[y]!==" "){for(var S=v-w;S!==v&&m[S]===0;)S++;for(var T=new Uint8Array(g+(v-S)),O=g;S!==v;)T[O++]=m[S++];return T}}}function h(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:h}}var hX=fX,pX=hX;const yX=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},xv=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let mX=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},gX=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return QL(this,e)}},vX=class{constructor(e){this.decoders=e}or(e){return QL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const QL=(r,e)=>new vX({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let bX=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new mX(e,t,n),this.decoder=new gX(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const eK=({name:r,prefix:e,encode:t,decode:n})=>new bX(r,e,t,n),tK=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=pX(t,e);return eK({prefix:r,name:e,encode:n,decode:o=>xv(i(o))})},wX=(r,e,t,n)=>{const i={};for(let c=0;c<e.length;++c)i[e[c]]=c;let o=r.length;for(;r[o-1]==="=";)--o;const s=new Uint8Array(o*t/8|0);let a=0,l=0,d=0;for(let c=0;c<o;++c){const u=i[r[c]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|u,a+=t,a>=8&&(a-=8,s[d++]=255&l>>a)}if(a>=t||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s},_X=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let o="",s=0,a=0;for(let l=0;l<r.length;++l)for(a=a<<8|r[l],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o},ka=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>eK({prefix:e,name:r,encode(i){return _X(i,n,t)},decode(i){return wX(i,n,t,r)}});ka({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ka({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const ra=ka({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ka({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const _T=new TextEncoder,EX=new TextDecoder;let vt=class mP{static base64UrlToBytes(e){return ra.baseDecode(e)}static base64UrlToObject(e){const t=ra.baseDecode(e);return mP.bytesToObject(t)}static bytesToBase64Url(e){return ra.baseEncode(e)}static bytesToString(e){return EX.decode(e)}static bytesToObject(e){const t=mP.bytesToString(e);return JSON.parse(t)}static objectToBytes(e){const t=JSON.stringify(e);return _T.encode(t)}static stringToBase64Url(e){const t=_T.encode(e);return ra.baseEncode(t)}static stringToBytes(e){return _T.encode(e)}};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Qi=2n**255n-19n,ng=2n**252n+27742317777372353535851937790883648493n,gP=0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,vP=0x6666666666666666666666666666666666666666666666666666666666666658n,b1={a:-1n,d:37095705934669439343138083508754565189542113879843219016388785533085940283555n,p:Qi,n:ng,h:8,Gx:gP,Gy:vP},fs=(r="")=>{throw new Error(r)},rK=r=>typeof r=="string",Px=(r,e)=>!(r instanceof Uint8Array)||typeof e=="number"&&e>0&&r.length!==e?fs("Uint8Array expected"):r,Og=r=>new Uint8Array(r),Cg=(r,e)=>Px(rK(r)?oO(r):Og(r),e),gt=(r,e=Qi)=>{let t=r%e;return t>=0n?t:e+t},m3=r=>r instanceof Ah?r:fs("Point expected");let g3,Ah=class Bm{constructor(e,t,n,i){this.ex=e,this.ey=t,this.ez=n,this.et=i}static fromAffine(e){return new Bm(e.x,e.y,1n,gt(e.x*e.y))}static fromHex(e,t=!0){const{d:n}=b1;e=Cg(e,32);const i=e.slice();i[31]=e[31]&-129;const o=sO(i);o===0n||(t&&!(0n<o&&o<Qi)&&fs("bad y coord 1"),!t&&!(0n<o&&o<2n**256n)&&fs("bad y coord 2"));const s=gt(o*o),a=gt(s-1n),l=gt(n*s+1n);let{isValid:d,value:c}=xX(a,l);d||fs("bad y coordinate 3");const u=(c&1n)===1n;return(e[31]&128)!==0!==u&&(c=gt(-c)),new Bm(c,o,1n,gt(c*o))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(e){const{ex:t,ey:n,ez:i}=this,{ex:o,ey:s,ez:a}=m3(e),l=gt(t*a),d=gt(o*i),c=gt(n*a),u=gt(s*i);return l===d&&c===u}is0(){return this.equals(H2)}negate(){return new Bm(gt(-this.ex),this.ey,this.ez,gt(-this.et))}double(){const{ex:e,ey:t,ez:n}=this,{a:i}=b1,o=gt(e*e),s=gt(t*t),a=gt(2n*gt(n*n)),l=gt(i*o),d=e+t,c=gt(gt(d*d)-o-s),u=l+s,f=u-a,h=l-s,p=gt(c*f),y=gt(u*h),g=gt(c*h),w=gt(f*u);return new Bm(p,y,w,g)}add(e){const{ex:t,ey:n,ez:i,et:o}=this,{ex:s,ey:a,ez:l,et:d}=m3(e),{a:c,d:u}=b1,f=gt(t*s),h=gt(n*a),p=gt(o*u*d),y=gt(i*l),g=gt((t+n)*(s+a)-f-h),w=gt(y-p),v=gt(y+p),m=gt(h-c*f),b=gt(g*w),_=gt(v*m),E=gt(g*m),S=gt(w*v);return new Bm(b,_,S,E)}mul(e,t=!0){if(e===0n)return t===!0?fs("cannot multiply by 0"):H2;if(typeof e=="bigint"&&0n<e&&e<ng||fs("invalid scalar, must be < L"),!t&&this.is0()||e===1n)return this;if(this.equals(xh))return DX(e).p;let n=H2,i=xh;for(let o=this;e>0n;o=o.double(),e>>=1n)e&1n?n=n.add(o):t&&(i=i.add(o));return n}multiply(e){return this.mul(e)}clearCofactor(){return this.mul(BigInt(b1.h),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let e=this.mul(ng/2n,!1).double();return ng%2n&&(e=e.add(this)),e.is0()}toAffine(){const{ex:e,ey:t,ez:n}=this;if(this.is0())return{x:0n,y:0n};const i=oK(n);return gt(n*i)!==1n&&fs("invalid inverse"),{x:gt(e*i),y:gt(t*i)}}toRawBytes(){const{x:e,y:t}=this.toAffine(),n=iK(t);return n[31]|=e&1n?128:0,n}toHex(){return iO(this.toRawBytes())}};Ah.BASE=new Ah(gP,vP,1n,gt(gP*vP));Ah.ZERO=new Ah(0n,1n,1n,0n);const{BASE:xh,ZERO:H2}=Ah,nK=(r,e)=>r.toString(16).padStart(e,"0"),iO=r=>Array.from(r).map(e=>nK(e,2)).join(""),oO=r=>{const e=r.length;(!rK(r)||e%2)&&fs("hex invalid 1");const t=Og(e/2);for(let n=0;n<t.length;n++){const i=n*2,o=r.slice(i,i+2),s=Number.parseInt(o,16);(Number.isNaN(s)||s<0)&&fs("hex invalid 2"),t[n]=s}return t},iK=r=>oO(nK(r,32*2)).reverse(),sO=r=>BigInt("0x"+iO(Og(Px(r)).reverse())),mw=(...r)=>{const e=Og(r.reduce((n,i)=>n+Px(i).length,0));let t=0;return r.forEach(n=>{e.set(n,t),t+=n.length}),e},oK=(r,e=Qi)=>{(r===0n||e<=0n)&&fs("no inverse n="+r+" mod="+e);let t=gt(r,e),n=e,i=0n,o=1n;for(;t!==0n;){const s=n/t,a=n%t,l=i-o*s;n=t,t=a,i=o,o=l}return n===1n?gt(i,e):fs("no inverse")},cl=(r,e)=>{let t=r;for(;e-- >0n;)t*=t,t%=Qi;return t},AX=r=>{const t=r*r%Qi*r%Qi,n=cl(t,2n)*t%Qi,i=cl(n,1n)*r%Qi,o=cl(i,5n)*i%Qi,s=cl(o,10n)*o%Qi,a=cl(s,20n)*s%Qi,l=cl(a,40n)*a%Qi,d=cl(l,80n)*l%Qi,c=cl(d,80n)*l%Qi,u=cl(c,10n)*o%Qi;return{pow_p_5_8:cl(u,2n)*r%Qi,b2:t}},v3=19681161376707505956807079304988542015446066515923890162744021073123829784752n,xX=(r,e)=>{const t=gt(e*e*e),n=gt(t*t*e),i=AX(r*n).pow_p_5_8;let o=gt(r*t*i);const s=gt(e*o*o),a=o,l=gt(o*v3),d=s===r,c=s===gt(-r),u=s===gt(-r*v3);return d&&(o=a),(c||u)&&(o=l),(gt(o)&1n)===1n&&(o=gt(-o)),{isValid:d||c,value:o}},WE=r=>gt(sO(r),ng);let Ub;const aO=(...r)=>lO.sha512Async(...r),SX=(...r)=>typeof Ub=="function"?Ub(...r):fs("etc.sha512Sync not set"),sK=r=>{const e=r.slice(0,32);e[0]&=248,e[31]&=127,e[31]|=64;const t=r.slice(32,64),n=WE(e),i=xh.mul(n),o=i.toRawBytes();return{head:e,prefix:t,scalar:n,point:i,pointBytes:o}},cO=r=>aO(Cg(r,32)).then(sK),TX=r=>sK(SX(Cg(r,32))),$X=r=>cO(r).then(e=>e.pointBytes);function aK(r,e){return aO(e.hashable).then(e.finish)}const kX=(r,e,t)=>{const{pointBytes:n,scalar:i}=r,o=WE(e),s=xh.mul(o).toRawBytes();return{hashable:mw(s,n,t),finish:d=>{const c=gt(o+WE(d)*i,ng);return Px(mw(s,iK(c)),64)}}},PX=async(r,e)=>{const t=Cg(r),n=await cO(e),i=await aO(n.prefix,t);return aK(!0,kX(n,i,t))},IX=(r,e,t)=>{e=Cg(e),r=Cg(r,64);const n=Ah.fromHex(t,!1),i=Ah.fromHex(r.slice(0,32),!1),o=sO(r.slice(32,64)),s=xh.mul(o,!1);return{hashable:mw(i.toRawBytes(),n.toRawBytes(),e),finish:d=>{const c=WE(d);return i.add(n.mul(c,!1)).add(s.negate()).clearCofactor().is0()}}},OX=async(r,e,t)=>aK(!0,IX(r,e,t)),b3=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,lO={bytesToHex:iO,hexToBytes:oO,concatBytes:mw,mod:gt,invert:oK,randomBytes:r=>{const e=b3();return e||fs("crypto.getRandomValues must be defined"),e.getRandomValues(Og(r))},sha512Async:async(...r)=>{const e=b3();e||fs("crypto.subtle or etc.sha512Async must be defined");const t=mw(...r);return Og(await e.subtle.digest("SHA-512",t.buffer))},sha512Sync:void 0};Object.defineProperties(lO,{sha512Sync:{configurable:!1,get(){return Ub},set(r){Ub||(Ub=r)}}});const CX={getExtendedPublicKeyAsync:cO,getExtendedPublicKey:TX,randomPrivateKey:()=>lO.randomBytes(32),precompute(r=8,e=xh){return e.multiply(3n),e}},$p=8,RX=()=>{const r=[],e=256/$p+1;let t=xh,n=t;for(let i=0;i<e;i++){n=t,r.push(n);for(let o=1;o<2**($p-1);o++)n=n.add(t),r.push(n);t=n.double()}return r},DX=r=>{const e=g3||(g3=RX()),t=(c,u)=>{let f=u.negate();return c?f:u};let n=H2,i=xh;const o=1+256/$p,s=2**($p-1),a=BigInt(2**$p-1),l=2**$p,d=BigInt($p);for(let c=0;c<o;c++){const u=c*s;let f=Number(r&a);r>>=d,f>s&&(f-=l,r+=1n);const h=u,p=u+Math.abs(f)-1,y=c%2!==0,g=f<0;f===0?i=i.add(t(y,e[h])):n=n.add(t(g,e[p]))}return{p:n,f:i}};class Ae extends Error{constructor(e,t){super(`${e}: ${t}`),this.code=e,this.name="DwnError"}}var we;(function(r){r.AuthenticateJwsMissing="AuthenticateJwsMissing",r.AuthenticateDescriptorCidMismatch="AuthenticateDescriptorCidMismatch",r.AuthenticationMoreThanOneSignatureNotSupported="AuthenticationMoreThanOneSignatureNotSupported",r.AuthorizationNotGrantedToAuthor="AuthorizationNotGrantedToAuthor",r.ComputeCidCodecNotSupported="ComputeCidCodecNotSupported",r.ComputeCidMultihashNotSupported="ComputeCidMultihashNotSupported",r.Ed25519InvalidJwk="Ed25519InvalidJwk",r.EventEmitterStreamNotOpenError="EventEmitterStreamNotOpenError",r.MessagesGrantAuthorizationMismatchedProtocol="EventsGrantAuthorizationMismatchedProtocol",r.MessagesSubscribeAuthorizationFailed="MessagesSubscribeAuthorizationFailed",r.MessagesSubscribeEventStreamUnimplemented="MessagesSubscribeEventStreamUnimplemented",r.GeneralJwsVerifierGetPublicKeyNotFound="GeneralJwsVerifierGetPublicKeyNotFound",r.GeneralJwsVerifierInvalidSignature="GeneralJwsVerifierInvalidSignature",r.GrantAuthorizationGrantExpired="GrantAuthorizationGrantExpired",r.GrantAuthorizationGrantMissing="GrantAuthorizationGrantMissing",r.GrantAuthorizationGrantRevoked="GrantAuthorizationGrantRevoked",r.GrantAuthorizationInterfaceMismatch="GrantAuthorizationInterfaceMismatch",r.GrantAuthorizationMethodMismatch="GrantAuthorizationMethodMismatch",r.GrantAuthorizationNotGrantedForTenant="GrantAuthorizationNotGrantedForTenant",r.GrantAuthorizationNotGrantedToAuthor="GrantAuthorizationNotGrantedToAuthor",r.GrantAuthorizationGrantNotYetActive="GrantAuthorizationGrantNotYetActive",r.HdKeyDerivationPathInvalid="HdKeyDerivationPathInvalid",r.JwsVerifySignatureUnsupportedCrv="JwsVerifySignatureUnsupportedCrv",r.IndexInvalidCursorValueType="IndexInvalidCursorValueType",r.IndexInvalidCursorSortProperty="IndexInvalidCursorSortProperty",r.IndexInvalidSortPropertyInMemory="IndexInvalidSortPropertyInMemory",r.IndexMissingIndexableProperty="IndexMissingIndexableProperty",r.JwsDecodePlainObjectPayloadInvalid="JwsDecodePlainObjectPayloadInvalid",r.MessagesReadInvalidCid="MessagesReadInvalidCid",r.MessagesReadAuthorizationFailed="MessagesReadAuthorizationFailed",r.MessageGetInvalidCid="MessageGetInvalidCid",r.MessagesQueryAuthorizationFailed="MessagesQueryAuthorizationFailed",r.MessagesReadVerifyScopeFailed="MessagesReadVerifyScopeFailed",r.ParseCidCodecNotSupported="ParseCidCodecNotSupported",r.ParseCidMultihashNotSupported="ParseCidMultihashNotSupported",r.PermissionsProtocolCreateGrantRecordsScopeMissingProtocol="PermissionsProtocolCreateGrantRecordsScopeMissingProtocol",r.PermissionsProtocolCreateRequestRecordsScopeMissingProtocol="PermissionsProtocolCreateRequestRecordsScopeMissingProtocol",r.PermissionsProtocolGetScopeInvalidProtocol="PermissionsProtocolGetScopeInvalidProtocol",r.PermissionsProtocolValidateSchemaUnexpectedRecord="PermissionsProtocolValidateSchemaUnexpectedRecord",r.PermissionsProtocolValidateScopeContextIdProhibitedProperties="PermissionsProtocolValidateScopeContextIdProhibitedProperties",r.PermissionsProtocolValidateScopeProtocolMismatch="PermissionsProtocolValidateScopeProtocolMismatch",r.PermissionsProtocolValidateScopeMissingProtocolTag="PermissionsProtocolValidateScopeMissingProtocolTag",r.PermissionsProtocolValidateRevocationProtocolTagMismatch="PermissionsProtocolValidateRevocationProtocolTagMismatch",r.PrivateKeySignerUnableToDeduceAlgorithm="PrivateKeySignerUnableToDeduceAlgorithm",r.PrivateKeySignerUnableToDeduceKeyId="PrivateKeySignerUnableToDeduceKeyId",r.PrivateKeySignerUnsupportedCurve="PrivateKeySignerUnsupportedCurve",r.ProtocolAuthorizationActionNotAllowed="ProtocolAuthorizationActionNotAllowed",r.ProtocolAuthorizationActionRulesNotFound="ProtocolAuthorizationActionRulesNotFound",r.ProtocolAuthorizationIncorrectDataFormat="ProtocolAuthorizationIncorrectDataFormat",r.ProtocolAuthorizationIncorrectContextId="ProtocolAuthorizationIncorrectContextId",r.ProtocolAuthorizationIncorrectProtocolPath="ProtocolAuthorizationIncorrectProtocolPath",r.ProtocolAuthorizationDuplicateRoleRecipient="ProtocolAuthorizationDuplicateRoleRecipient",r.ProtocolAuthorizationInvalidSchema="ProtocolAuthorizationInvalidSchema",r.ProtocolAuthorizationInvalidType="ProtocolAuthorizationInvalidType",r.ProtocolAuthorizationMatchingRoleRecordNotFound="ProtocolAuthorizationMatchingRoleRecordNotFound",r.ProtocolAuthorizationMaxSizeInvalid="ProtocolAuthorizationMaxSizeInvalid",r.ProtocolAuthorizationMinSizeInvalid="ProtocolAuthorizationMinSizeInvalid",r.ProtocolAuthorizationMissingContextId="ProtocolAuthorizationMissingContextId",r.ProtocolAuthorizationMissingRuleSet="ProtocolAuthorizationMissingRuleSet",r.ProtocolAuthorizationParentlessIncorrectProtocolPath="ProtocolAuthorizationParentlessIncorrectProtocolPath",r.ProtocolAuthorizationNotARole="ProtocolAuthorizationNotARole",r.ProtocolAuthorizationParentNotFoundConstructingRecordChain="ProtocolAuthorizationParentNotFoundConstructingRecordChain",r.ProtocolAuthorizationProtocolNotFound="ProtocolAuthorizationProtocolNotFound",r.ProtocolAuthorizationRoleMissingRecipient="ProtocolAuthorizationRoleMissingRecipient",r.ProtocolAuthorizationTagsInvalidSchema="ProtocolAuthorizationTagsInvalidSchema",r.ProtocolsConfigureAuthorizationFailed="ProtocolsConfigureAuthorizationFailed",r.ProtocolsConfigureDuplicateActorInRuleSet="ProtocolsConfigureDuplicateActorInRuleSet",r.ProtocolsConfigureDuplicateRoleInRuleSet="ProtocolsConfigureDuplicateRoleInRuleSet",r.ProtocolsConfigureInvalidSize="ProtocolsConfigureInvalidSize",r.ProtocolsConfigureInvalidActionMissingOf="ProtocolsConfigureInvalidActionMissingOf",r.ProtocolsConfigureInvalidActionOfNotAllowed="ProtocolsConfigureInvalidActionOfNotAllowed",r.ProtocolsConfigureInvalidActionDeleteWithoutCreate="ProtocolsConfigureInvalidActionDeleteWithoutCreate",r.ProtocolsConfigureInvalidActionUpdateWithoutCreate="ProtocolsConfigureInvalidActionUpdateWithoutCreate",r.ProtocolsConfigureInvalidRecipientOfAction="ProtocolsConfigureInvalidRecipientOfAction",r.ProtocolsConfigureInvalidRuleSetRecordType="ProtocolsConfigureInvalidRuleSetRecordType",r.ProtocolsConfigureInvalidTagSchema="ProtocolsConfigureInvalidTagSchema",r.ProtocolsConfigureRecordNestingDepthExceeded="ProtocolsConfigureRecordNestingDepthExceeded",r.ProtocolsConfigureRoleDoesNotExistAtGivenPath="ProtocolsConfigureRoleDoesNotExistAtGivenPath",r.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch="ProtocolsGrantAuthorizationQueryProtocolScopeMismatch",r.ProtocolsGrantAuthorizationScopeProtocolMismatch="ProtocolsGrantAuthorizationScopeProtocolMismatch",r.ProtocolsQueryUnauthorized="ProtocolsQueryUnauthorized",r.RecordsAuthorDelegatedGrantAndIdExistenceMismatch="RecordsAuthorDelegatedGrantAndIdExistenceMismatch",r.RecordsAuthorDelegatedGrantCidMismatch="RecordsAuthorDelegatedGrantCidMismatch",r.RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch="RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch",r.RecordsAuthorDelegatedGrantNotADelegatedGrant="RecordsAuthorDelegatedGrantNotADelegatedGrant",r.RecordsDecryptNoMatchingKeyEncryptedFound="RecordsDecryptNoMatchingKeyEncryptedFound",r.RecordsDeleteAuthorizationFailed="RecordsDeleteAuthorizationFailed",r.RecordsQueryCreateFilterPublishedSortInvalid="RecordsQueryCreateFilterPublishedSortInvalid",r.RecordsQueryParseFilterPublishedSortInvalid="RecordsQueryParseFilterPublishedSortInvalid",r.RecordsGrantAuthorizationConditionPublicationProhibited="RecordsGrantAuthorizationConditionPublicationProhibited",r.RecordsGrantAuthorizationConditionPublicationRequired="RecordsGrantAuthorizationConditionPublicationRequired",r.RecordsGrantAuthorizationDeleteProtocolScopeMismatch="RecordsGrantAuthorizationDeleteProtocolScopeMismatch",r.RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch="RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch",r.RecordsGrantAuthorizationScopeContextIdMismatch="RecordsGrantAuthorizationScopeContextIdMismatch",r.RecordsGrantAuthorizationScopeProtocolMismatch="RecordsGrantAuthorizationScopeProtocolMismatch",r.RecordsGrantAuthorizationScopeProtocolPathMismatch="RecordsGrantAuthorizationScopeProtocolPathMismatch",r.RecordsDerivePrivateKeyUnSupportedCurve="RecordsDerivePrivateKeyUnSupportedCurve",r.RecordsInvalidAncestorKeyDerivationSegment="RecordsInvalidAncestorKeyDerivationSegment",r.RecordsOwnerDelegatedGrantAndIdExistenceMismatch="RecordsOwnerDelegatedGrantAndIdExistenceMismatch",r.RecordsOwnerDelegatedGrantCidMismatch="RecordsOwnerDelegatedGrantCidMismatch",r.RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch="RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch",r.RecordsOwnerDelegatedGrantNotADelegatedGrant="RecordsOwnerDelegatedGrantNotADelegatedGrant",r.RecordsProtocolContextDerivationSchemeMissingContextId="RecordsProtocolContextDerivationSchemeMissingContextId",r.RecordsProtocolPathDerivationSchemeMissingProtocol="RecordsProtocolPathDerivationSchemeMissingProtocol",r.RecordsQueryFilterMissingRequiredProperties="RecordsQueryFilterMissingRequiredProperties",r.RecordsReadReturnedMultiple="RecordsReadReturnedMultiple",r.RecordsReadAuthorizationFailed="RecordsReadAuthorizationFailed",r.RecordsSubscribeEventStreamUnimplemented="RecordsSubscribeEventStreamUnimplemented",r.RecordsSubscribeFilterMissingRequiredProperties="RecordsSubscribeFilterMissingRequiredProperties",r.RecordsSchemasDerivationSchemeMissingSchema="RecordsSchemasDerivationSchemeMissingSchema",r.RecordsWriteAttestationIntegrityMoreThanOneSignature="RecordsWriteAttestationIntegrityMoreThanOneSignature",r.RecordsWriteAttestationIntegrityDescriptorCidMismatch="RecordsWriteAttestationIntegrityDescriptorCidMismatch",r.RecordsWriteAttestationIntegrityInvalidPayloadProperty="RecordsWriteAttestationIntegrityInvalidPayloadProperty",r.RecordsWriteAuthorizationFailed="RecordsWriteAuthorizationFailed",r.RecordsWriteCreateMissingSigner="RecordsWriteCreateMissingSigner",r.RecordsWriteCreateDataAndDataCidMutuallyExclusive="RecordsWriteCreateDataAndDataCidMutuallyExclusive",r.RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive="RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive",r.RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive="RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive",r.RecordsWriteDataCidMismatch="RecordsWriteDataCidMismatch",r.RecordsWriteDataSizeMismatch="RecordsWriteDataSizeMismatch",r.RecordsWriteGetEntryIdUndefinedAuthor="RecordsWriteGetEntryIdUndefinedAuthor",r.RecordsWriteGetNewestWriteRecordNotFound="RecordsWriteGetNewestWriteRecordNotFound",r.RecordsWriteGetInitialWriteNotFound="RecordsWriteGetInitialWriteNotFound",r.RecordsWriteImmutablePropertyChanged="RecordsWriteImmutablePropertyChanged",r.RecordsWriteMissingSigner="RecordsWriteMissingSigner",r.RecordsWriteMissingDataInPrevious="RecordsWriteMissingDataInPrevious",r.RecordsWriteMissingEncodedDataInPrevious="RecordsWriteMissingEncodedDataInPrevious",r.RecordsWriteMissingProtocol="RecordsWriteMissingProtocol",r.RecordsWriteMissingSchema="RecordsWriteMissingSchema",r.RecordsWriteNotAllowedAfterDelete="RecordsWriteNotAllowedAfterDelete",r.RecordsWriteOwnerAndTenantMismatch="RecordsWriteOwnerAndTenantMismatch",r.RecordsWriteSignAsOwnerDelegateUnknownAuthor="RecordsWriteSignAsOwnerDelegateUnknownAuthor",r.RecordsWriteSignAsOwnerUnknownAuthor="RecordsWriteSignAsOwnerUnknownAuthor",r.RecordsWriteValidateIntegrityAttestationMismatch="RecordsWriteValidateIntegrityAttestationMismatch",r.RecordsWriteValidateIntegrityContextIdMismatch="RecordsWriteValidateIntegrityContextIdMismatch",r.RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload="RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload",r.RecordsWriteValidateIntegrityDateCreatedMismatch="RecordsWriteValidateIntegrityDateCreatedMismatch",r.RecordsWriteValidateIntegrityEncryptionCidMismatch="RecordsWriteValidateIntegrityEncryptionCidMismatch",r.RecordsWriteValidateIntegrityRecordIdUnauthorized="RecordsWriteValidateIntegrityRecordIdUnauthorized",r.SchemaValidatorAdditionalPropertyNotAllowed="SchemaValidatorAdditionalPropertyNotAllowed",r.SchemaValidatorFailure="SchemaValidatorFailure",r.SchemaValidatorSchemaNotFound="SchemaValidatorSchemaNotFound",r.SchemaValidatorUnevaluatedPropertyNotAllowed="SchemaValidatorUnevaluatedPropertyNotAllowed",r.Secp256k1KeyNotValid="Secp256k1KeyNotValid",r.Secp256r1KeyNotValid="Secp256r1KeyNotValid",r.TimestampInvalid="TimestampInvalid",r.UrlProtocolNotNormalized="UrlProtocolNotNormalized",r.UrlProtocolNotNormalizable="UrlProtocolNotNormalizable",r.UrlSchemaNotNormalized="UrlSchemaNotNormalized"})(we||(we={}));var w1=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function w3(r){if(r.kty!=="OKP"||r.crv!=="Ed25519")throw new Ae(we.Ed25519InvalidJwk,"invalid jwk. kty MUST be OKP. crv MUST be Ed25519")}function _3(r){return{alg:"EdDSA",kty:"OKP",crv:"Ed25519",x:vt.bytesToBase64Url(r)}}const MX={sign:(r,e)=>w1(void 0,void 0,void 0,function*(){w3(e);const t=vt.base64UrlToBytes(e.d);return PX(r,t)}),verify:(r,e,t)=>w1(void 0,void 0,void 0,function*(){w3(t);const n=vt.base64UrlToBytes(t.x);return OX(e,r,n)}),generateKeyPair:()=>w1(void 0,void 0,void 0,function*(){const r=CX.randomPrivateKey(),e=yield $X(r),t=vt.bytesToBase64Url(r),n=_3(e),i=Object.assign(Object.assign({},n),{d:t});return{publicJwk:n,privateJwk:i}}),publicKeyToJwk:r=>w1(void 0,void 0,void 0,function*(){return _3(r)})};/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const dO=2n**256n,dh=dO-0x1000003d1n,li=dO-0x14551231950b75fc4402da1732fc9bebfn,cK=0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,lK=0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n,dK={p:dh,n:li,a:0n,b:7n,Gx:cK,Gy:lK},Yo=32,E3=r=>Ve(Ve(r*r)*r+dK.b),an=(r="")=>{throw new Error(r)},Ix=r=>typeof r=="bigint",uK=r=>typeof r=="string",ET=r=>Ix(r)&&0n<r&&r<dh,gw=r=>Ix(r)&&0n<r&&r<li,fK=(r,e)=>!(r instanceof Uint8Array)||typeof e=="number"&&e>0&&r.length!==e?an("Uint8Array expected"):r,Rl=r=>new Uint8Array(r),Tu=(r,e)=>fK(uK(r)?h_(r):Rl(r),e),Ve=(r,e=dh)=>{let t=r%e;return t>=0n?t:e+t},A3=r=>r instanceof ki?r:an("Point expected");let x3;class ki{constructor(e,t,n){this.px=e,this.py=t,this.pz=n}static fromAffine(e){return new ki(e.x,e.y,1n)}static fromHex(e){e=Tu(e);let t;const n=e[0],i=e.subarray(1),o=HE(i,0,Yo),s=e.length;if(s===33&&[2,3].includes(n)){ET(o)||an("Point hex invalid: x not FE");let a=BX(E3(o));const l=(a&1n)===1n;(n&1)===1!==l&&(a=Ve(-a)),t=new ki(o,a,1n)}return s===65&&n===4&&(t=new ki(o,HE(i,Yo,2*Yo),1n)),t?t.ok():an("Point is not on curve")}static fromPrivateKey(e){return yu.mul(GE(e))}get x(){return this.aff().x}get y(){return this.aff().y}equals(e){const{px:t,py:n,pz:i}=this,{px:o,py:s,pz:a}=A3(e),l=Ve(t*a),d=Ve(o*i),c=Ve(n*a),u=Ve(s*i);return l===d&&c===u}negate(){return new ki(this.px,Ve(-this.py),this.pz)}double(){return this.add(this)}add(e){const{px:t,py:n,pz:i}=this,{px:o,py:s,pz:a}=A3(e),{a:l,b:d}=dK;let c=0n,u=0n,f=0n;const h=Ve(d*3n);let p=Ve(t*o),y=Ve(n*s),g=Ve(i*a),w=Ve(t+n),v=Ve(o+s);w=Ve(w*v),v=Ve(p+y),w=Ve(w-v),v=Ve(t+i);let m=Ve(o+a);return v=Ve(v*m),m=Ve(p+g),v=Ve(v-m),m=Ve(n+i),c=Ve(s+a),m=Ve(m*c),c=Ve(y+g),m=Ve(m-c),f=Ve(l*v),c=Ve(h*g),f=Ve(c+f),c=Ve(y-f),f=Ve(y+f),u=Ve(c*f),y=Ve(p+p),y=Ve(y+p),g=Ve(l*g),v=Ve(h*v),y=Ve(y+g),g=Ve(p-g),g=Ve(l*g),v=Ve(v+g),p=Ve(y*v),u=Ve(u+p),p=Ve(m*v),c=Ve(w*c),c=Ve(c-p),p=Ve(w*y),f=Ve(m*f),f=Ve(f+p),new ki(c,u,f)}mul(e,t=!0){if(!t&&e===0n)return G2;if(gw(e)||an("invalid scalar"),this.equals(yu))return FX(e).p;let n=G2,i=yu;for(let o=this;e>0n;o=o.double(),e>>=1n)e&1n?n=n.add(o):t&&(i=i.add(o));return n}mulAddQUns(e,t,n){return this.mul(t,!1).add(e.mul(n,!1)).ok()}toAffine(){const{px:e,py:t,pz:n}=this;if(this.equals(G2))return{x:0n,y:0n};if(n===1n)return{x:e,y:t};const i=y_(n);return Ve(n*i)!==1n&&an("invalid inverse"),{x:Ve(e*i),y:Ve(t*i)}}assertValidity(){const{x:e,y:t}=this.aff();return(!ET(e)||!ET(t))&&an("Point invalid: x or y"),Ve(t*t)===E3(e)?this:an("Point invalid: not on curve")}multiply(e){return this.mul(e)}aff(){return this.toAffine()}ok(){return this.assertValidity()}toHex(e=!0){const{x:t,y:n}=this.aff();return(e?(n&1n)===0n?"02":"03":"04")+Lb(t)+(e?"":Lb(n))}toRawBytes(e=!0){return h_(this.toHex(e))}}ki.BASE=new ki(cK,lK,1n);ki.ZERO=new ki(0n,1n,0n);const{BASE:yu,ZERO:G2}=ki,hK=(r,e)=>r.toString(16).padStart(e,"0"),uO=r=>Array.from(r).map(e=>hK(e,2)).join(""),h_=r=>{const e=r.length;(!uK(r)||e%2)&&an("hex invalid 1");const t=Rl(e/2);for(let n=0;n<t.length;n++){const i=n*2,o=r.slice(i,i+2),s=Number.parseInt(o,16);(Number.isNaN(s)||s<0)&&an("hex invalid 2"),t[n]=s}return t},p_=r=>BigInt("0x"+(uO(r)||"0")),HE=(r,e,t)=>p_(r.slice(e,t)),Ox=r=>Ix(r)&&r>=0n&&r<dO?h_(hK(r,2*Yo)):an("bigint expected"),Lb=r=>uO(Ox(r)),bP=(...r)=>{const e=Rl(r.reduce((n,i)=>n+fK(i).length,0));let t=0;return r.forEach(n=>{e.set(n,t),t+=n.length}),e},y_=(r,e=dh)=>{(r===0n||e<=0n)&&an("no inverse n="+r+" mod="+e);let t=Ve(r,e),n=e,i=0n,o=1n;for(;t!==0n;){const s=n/t,a=n%t,l=i-o*s;n=t,t=a,i=o,o=l}return n===1n?Ve(i,e):an("no inverse")},BX=r=>{let e=1n;for(let t=r,n=(dh+1n)/4n;n>0n;n>>=1n)n&1n&&(e=e*t%dh),t=t*t%dh;return Ve(e*e)===r?e:an("sqrt invalid")},GE=r=>(Ix(r)||(r=p_(Tu(r,Yo))),gw(r)?r:an("private key out of range")),fO=r=>r>li>>1n;function AT(r,e=!0){return ki.fromPrivateKey(r).toRawBytes(e)}class Rg{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){return e=Tu(e,64),new Rg(HE(e,0,Yo),HE(e,Yo,2*Yo))}assertValidity(){return gw(this.r)&&gw(this.s)?this:an()}addRecoveryBit(e){return new Rg(this.r,this.s,e)}hasHighS(){return fO(this.s)}recoverPublicKey(e){const{r:t,s:n,recovery:i}=this;[0,1,2,3].includes(i)||an("recovery id invalid");const o=hO(Tu(e,32)),s=i===2||i===3?t+li:t;s>=dh&&an("q.x invalid");const a=i&1?"03":"02",l=ki.fromHex(a+Lb(s)),d=y_(s,li),c=Ve(-o*d,li),u=Ve(n*d,li);return yu.mulAddQUns(l,c,u)}toCompactRawBytes(){return h_(this.toCompactHex())}toCompactHex(){return Lb(this.r)+Lb(this.s)}}const pK=r=>{const e=r.length*8-256,t=p_(r);return e>0?t>>BigInt(e):t},hO=r=>Ve(pK(r),li),S3=r=>Ox(r),T3=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;let Y2;const yK={lowS:!0},jX={lowS:!0};function NX(r,e,t=yK){["der","recovered","canonical"].some(u=>u in t)&&an("sign() legacy options not supported");let{lowS:n}=t;n==null&&(n=!0);const i=hO(Tu(r)),o=S3(i),s=GE(e),a=[S3(s),o];let l=t.extraEntropy;if(l){l===!0&&(l=Dg.randomBytes(Yo));const u=Tu(l);u.length!==Yo&&an(),a.push(u)}const d=i,c=u=>{const f=pK(u);if(!gw(f))return;const h=y_(f,li),p=yu.mul(f).aff(),y=Ve(p.x,li);if(y===0n)return;const g=Ve(h*Ve(d+Ve(s*y,li),li),li);if(g===0n)return;let w=g,v=(p.x===y?0:2)|Number(p.y&1n);return n&&fO(g)&&(w=Ve(-g,li),v^=1),new Rg(y,w,v)};return{seed:bP(...a),k2sig:c}}function UX(r){let e=Rl(Yo),t=Rl(Yo),n=0;const i=()=>{e.fill(1),t.fill(0),n=0},o="drbg: tried 1000 values";{const s=(...d)=>Dg.hmacSha256Async(t,e,...d),a=async(d=Rl())=>{t=await s(Rl([0]),d),e=await s(),d.length!==0&&(t=await s(Rl([1]),d),e=await s())},l=async()=>(n++>=1e3&&an(o),e=await s(),e);return async(d,c)=>{i(),await a(d);let u;for(;!(u=c(await l()));)await a();return i(),u}}}async function LX(r,e,t=yK){const{seed:n,k2sig:i}=NX(r,e,t);return UX()(n,i)}function KX(r,e,t,n=jX){let{lowS:i}=n;i==null&&(i=!0),"strict"in n&&an("verify() legacy options not supported");let o,s,a;const l=r&&typeof r=="object"&&"r"in r;!l&&Tu(r).length!==2*Yo&&an("signature must be 64 bytes");try{o=l?new Rg(r.r,r.s).assertValidity():Rg.fromCompact(r),s=hO(Tu(e,Yo)),a=t instanceof ki?t.ok():ki.fromHex(t)}catch{return!1}if(!o)return!1;const{r:d,s:c}=o;if(i&&fO(c))return!1;let u;try{const h=y_(c,li),p=Ve(s*h,li),y=Ve(d*h,li);u=yu.mulAddQUns(a,p,y).aff()}catch{return!1}return u?Ve(u.x,li)===d:!1}function mK(r){r=Tu(r);const e=Yo+8;(r.length<e||r.length>1024)&&an("expected proper params");const t=Ve(p_(r),li-1n)+1n;return Ox(t)}const Dg={hexToBytes:h_,bytesToHex:uO,concatBytes:bP,bytesToNumberBE:p_,numberToBytesBE:Ox,mod:Ve,invert:y_,hmacSha256Async:async(r,...e)=>{const t=T3();if(!t)return an("etc.hmacSha256Async not set");const n=t.subtle,i=await n.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return Rl(await n.sign("HMAC",i,bP(...e)))},hmacSha256Sync:Y2,hashToPrivateKey:mK,randomBytes:r=>{const e=T3();return e||an("crypto.getRandomValues must be defined"),e.getRandomValues(Rl(r))}},$3={normPrivateKeyToScalar:GE,isValidPrivateKey:r=>{try{return!!GE(r)}catch{return!1}},randomPrivateKey:()=>mK(Dg.randomBytes(Yo+8)),precompute(r=8,e=yu){return e.multiply(3n),e}};Object.defineProperties(Dg,{hmacSha256Sync:{configurable:!1,get(){return Y2},set(r){Y2||(Y2=r)}}});const kp=8,zX=()=>{const r=[],e=256/kp+1;let t=yu,n=t;for(let i=0;i<e;i++){n=t,r.push(n);for(let o=1;o<2**(kp-1);o++)n=n.add(t),r.push(n);t=n.double()}return r},FX=r=>{const e=x3||(x3=zX()),t=(c,u)=>{let f=u.negate();return c?f:u};let n=G2,i=yu;const o=1+256/kp,s=2**(kp-1),a=BigInt(2**kp-1),l=2**kp,d=BigInt(kp);for(let c=0;c<o;c++){const u=c*s;let f=Number(r&a);r>>=d,f>s&&(f-=l,r+=1n);const h=u,p=u+Math.abs(f)-1,y=c%2!==0,g=f<0;f===0?i=i.add(t(y,e[h])):n=n.add(t(g,e[p]))}return{p:n,f:i}};var qX=gK,k3=128,VX=127,WX=~VX,HX=Math.pow(2,31);function gK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=HX;)e[t++]=r&255|k3,r/=128;for(;r&WX;)e[t++]=r&255|k3,r>>>=7;return e[t]=r|0,gK.bytes=t-n+1,e}var GX=wP,YX=128,P3=127;function wP(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw wP.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&P3)<<i:(s&P3)*Math.pow(2,i),i+=7}while(s>=YX);return wP.bytes=o-n,t}var ZX=Math.pow(2,7),JX=Math.pow(2,14),XX=Math.pow(2,21),QX=Math.pow(2,28),eQ=Math.pow(2,35),tQ=Math.pow(2,42),rQ=Math.pow(2,49),nQ=Math.pow(2,56),iQ=Math.pow(2,63),oQ=function(r){return r<ZX?1:r<JX?2:r<XX?3:r<QX?4:r<eQ?5:r<tQ?6:r<rQ?7:r<nQ?8:r<iQ?9:10},sQ={encode:qX,decode:GX,encodingLength:oQ},YE=sQ;const vw=(r,e=0)=>[YE.decode(r,e),YE.decode.bytes],bw=(r,e,t=0)=>(YE.encode(r,e,t),e),ww=r=>YE.encodingLength(r),ZE=(r,e)=>{const t=e.byteLength,n=ww(r),i=n+ww(t),o=new Uint8Array(i+t);return bw(r,o,0),bw(t,o,n),o.set(e,i),new pO(r,t,e,o)},vK=r=>{const e=xv(r),[t,n]=vw(e),[i,o]=vw(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new pO(t,i,s,e)},aQ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&yX(r.bytes,t.bytes)}};let pO=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};const cQ=({name:r,code:e,encode:t})=>new lQ(r,e,t);let lQ=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ZE(this.code,t):t.then(n=>ZE(this.code,n))}else throw Error("Unknown type, must be binary type")}};const dQ=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Xl=cQ({name:"sha2-256",code:18,encode:dQ("SHA-256")});var tf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},uQ=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let Lc=class Mf{static validateKey(e){if(e.kty!=="EC"||e.crv!=="secp256k1")throw new Ae(we.Secp256k1KeyNotValid,"Invalid SECP256K1 JWK: `kty` MUST be `EC`. `crv` MUST be `secp256k1`")}static publicKeyToJwk(e){return tf(this,void 0,void 0,function*(){let t;e.byteLength===33?t=ki.fromHex(e).toRawBytes(!1):t=e;const n=vt.bytesToBase64Url(t.subarray(1,33)),i=vt.bytesToBase64Url(t.subarray(33,65));return{alg:"ES256K",kty:"EC",crv:"secp256k1",x:n,y:i}})}static privateKeyToJwk(e){return tf(this,void 0,void 0,function*(){const t=yield Mf.getPublicKey(e),n=yield Mf.publicKeyToJwk(t);return n.d=vt.bytesToBase64Url(e),n})}static publicJwkToBytes(e){const t=vt.base64UrlToBytes(e.x),n=vt.base64UrlToBytes(e.y);return ki.fromAffine({x:Dg.bytesToNumberBE(t),y:Dg.bytesToNumberBE(n)}).toRawBytes(!0)}static privateJwkToBytes(e){return vt.base64UrlToBytes(e.d)}static sign(e,t){return tf(this,void 0,void 0,function*(){Mf.validateKey(t);const n=yield Xl.encode(e),i=Mf.privateJwkToBytes(t);return(yield LX(n,i)).toCompactRawBytes()})}static verify(e,t,n){return tf(this,void 0,void 0,function*(){Mf.validateKey(n);const i=Mf.publicJwkToBytes(n),o=yield Xl.encode(e);return KX(t,o,i)})}static generateKeyPair(){return tf(this,void 0,void 0,function*(){const e=$3.randomPrivateKey(),t=AT(e,!1),n=vt.bytesToBase64Url(e),i=yield Mf.publicKeyToJwk(t),o=Object.assign(Object.assign({},i),{d:n});return{publicJwk:i,privateJwk:o}})}static generateKeyPairRaw(){return tf(this,void 0,void 0,function*(){const e=$3.randomPrivateKey();return{publicKey:AT(e,!0),privateKey:e}})}static getPublicKey(e){return tf(this,void 0,void 0,function*(){return AT(e,!0)})}static getPublicJwk(e){return tf(this,void 0,void 0,function*(){return uQ(e,["d"])})}};function I3(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function fQ(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function m_(r,...e){if(!fQ(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function hQ(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");I3(r.outputLen),I3(r.blockLen)}function JE(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function pQ(r,e){m_(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const Z2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function yQ(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}const mQ=r=>new Uint8Array(r.buffer,r.byteOffset,r.byteLength),gQ=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),J2=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ec=(r,e)=>r<<32-e|r>>>e,vQ=(r,e)=>r<<e|r>>>32-e>>>0,bK=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,yO=r=>r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255,bQ=bK?r=>r:r=>yO(r);function wQ(r){for(let e=0;e<r.length;e++)r[e]=yO(r[e])}const _Q=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function EQ(r){m_(r);let e="";for(let t=0;t<r.length;t++)e+=_Q[r[t]];return e}const Ad={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function O3(r){if(r>=Ad._0&&r<=Ad._9)return r-Ad._0;if(r>=Ad._A&&r<=Ad._F)return r-(Ad._A-10);if(r>=Ad._a&&r<=Ad._f)return r-(Ad._a-10)}function AQ(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,o=0;i<t;i++,o+=2){const s=O3(r.charCodeAt(o)),a=O3(r.charCodeAt(o+1));if(s===void 0||a===void 0){const l=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}n[i]=s*16+a}return n}const wK=async()=>{};async function xQ(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const o=Date.now()-n;o>=0&&o<e||(await wK(),n+=o)}}function _K(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Sv(r){return typeof r=="string"&&(r=_K(r)),m_(r),r}function EK(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];m_(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const o=r[n];t.set(o,i),i+=o.length}return t}let mO=class{clone(){return this._cloneInto()}};const SQ={}.toString;function TQ(r,e){if(e!==void 0&&SQ.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(r,e)}function gO(r){const e=n=>r().update(Sv(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function $Q(r){const e=(n,i)=>r(i).update(Sv(n)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}function kQ(r){const e=(n,i)=>r(i).update(Sv(n)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}function vO(r=32){if(Z2&&typeof Z2.getRandomValues=="function")return Z2.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}const PQ=Object.freeze(Object.defineProperty({__proto__:null,Hash:mO,asyncLoop:xQ,byteSwap:yO,byteSwap32:wQ,byteSwapIfBE:bQ,bytesToHex:EQ,checkOpts:TQ,concatBytes:EK,createView:J2,hexToBytes:AQ,isBytes:yQ,isLE:bK,nextTick:wK,randomBytes:vO,rotl:vQ,rotr:Ec,toBytes:Sv,u32:gQ,u8:mQ,utf8ToBytes:_K,wrapConstructor:gO,wrapConstructorWithOpts:$Q,wrapXOFConstructorWithOpts:kQ},Symbol.toStringTag,{value:"Module"}));function IQ(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),l=n?4:0,d=n?0:4;r.setUint32(e+l,s,n),r.setUint32(e+d,a,n)}const OQ=(r,e,t)=>r&e^~r&t,CQ=(r,e,t)=>r&e^r&t^e&t;let RQ=class extends mO{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=J2(this.buffer)}update(e){JE(this);const{view:t,buffer:n,blockLen:i}=this;e=Sv(e);const o=e.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const l=J2(e);for(;i<=o-s;s+=i)this.process(l,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){JE(this),pQ(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:o}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let u=s;u<i;u++)t[u]=0;IQ(n,i-8,BigInt(this.length*8),o),this.process(n,0);const a=J2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=l/4,c=this.get();if(d>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<d;u++)a.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};const DQ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rf=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),nf=new Uint32Array(64);let AK=class extends RQ{constructor(){super(64,32,8,!1),this.A=rf[0]|0,this.B=rf[1]|0,this.C=rf[2]|0,this.D=rf[3]|0,this.E=rf[4]|0,this.F=rf[5]|0,this.G=rf[6]|0,this.H=rf[7]|0}get(){const{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:l}=this;return[e,t,n,i,o,s,a,l]}set(e,t,n,i,o,s,a,l){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=l|0}process(e,t){for(let u=0;u<16;u++,t+=4)nf[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const f=nf[u-15],h=nf[u-2],p=Ec(f,7)^Ec(f,18)^f>>>3,y=Ec(h,17)^Ec(h,19)^h>>>10;nf[u]=y+nf[u-7]+p+nf[u-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:d,H:c}=this;for(let u=0;u<64;u++){const f=Ec(a,6)^Ec(a,11)^Ec(a,25),h=c+f+OQ(a,l,d)+DQ[u]+nf[u]|0,y=(Ec(n,2)^Ec(n,13)^Ec(n,22))+CQ(n,i,o)|0;c=d,d=l,l=a,a=s+h|0,s=o,o=i,i=n,n=h+y|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,d=d+this.G|0,c=c+this.H|0,this.set(n,i,o,s,a,l,d,c)}roundClean(){nf.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},MQ=class extends AK{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const lc=gO(()=>new AK),BQ=gO(()=>new MQ),jQ=Object.freeze(Object.defineProperty({__proto__:null,sha224:BQ,sha256:lc},Symbol.toStringTag,{value:"Module"}));let bO=class extends mO{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,hQ(e);const n=Sv(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(n.length>i?e.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=e.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(e){return JE(this),this.iHash.update(e),this}digestInto(e){JE(this),m_(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=o,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const wO=(r,e,t)=>new bO(r,e).update(t).digest();wO.create=(r,e)=>new bO(r,e);const NQ=Object.freeze(Object.defineProperty({__proto__:null,HMAC:bO,hmac:wO},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xK=BigInt(0),Cx=BigInt(1),UQ=BigInt(2);function $y(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function g_(r){if(!$y(r))throw new Error("Uint8Array expected")}const LQ=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Mg(r){g_(r);let e="";for(let t=0;t<r.length;t++)e+=LQ[r[t]];return e}function SK(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function _O(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}const xd={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function C3(r){if(r>=xd._0&&r<=xd._9)return r-xd._0;if(r>=xd._A&&r<=xd._F)return r-(xd._A-10);if(r>=xd._a&&r<=xd._f)return r-(xd._a-10)}function Bg(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,o=0;i<t;i++,o+=2){const s=C3(r.charCodeAt(o)),a=C3(r.charCodeAt(o+1));if(s===void 0||a===void 0){const l=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}n[i]=s*16+a}return n}function iy(r){return _O(Mg(r))}function EO(r){return g_(r),_O(Mg(Uint8Array.from(r).reverse()))}function jg(r,e){return Bg(r.toString(16).padStart(e*2,"0"))}function AO(r,e){return jg(r,e).reverse()}function KQ(r){return Bg(SK(r))}function Pc(r,e,t){let n;if(typeof e=="string")try{n=Bg(e)}catch(o){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${o}`)}else if($y(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(`${r} expected ${t} bytes, got ${i}`);return n}function _w(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];g_(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const o=r[n];t.set(o,i),i+=o.length}return t}function zQ(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}function FQ(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function qQ(r){let e;for(e=0;r>xK;r>>=Cx,e+=1);return e}function VQ(r,e){return r>>BigInt(e)&Cx}function WQ(r,e,t){return r|(t?Cx:xK)<<BigInt(e)}const xO=r=>(UQ<<BigInt(r-1))-Cx,xT=r=>new Uint8Array(r),R3=r=>Uint8Array.from(r);function TK(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=xT(r),i=xT(r),o=0;const s=()=>{n.fill(1),i.fill(0),o=0},a=(...u)=>t(i,n,...u),l=(u=xT())=>{i=a(R3([0]),u),n=a(),u.length!==0&&(i=a(R3([1]),u),n=a())},d=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){n=a();const h=n.slice();f.push(h),u+=n.length}return _w(...f)};return(u,f)=>{s(),l(u);let h;for(;!(h=f(d()));)l();return s(),h}}const HQ={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||$y(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function v_(r,e,t={}){const n=(i,o,s)=>{const a=HQ[o];if(typeof a!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=r[i];if(!(s&&l===void 0)&&!a(l,r))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${o}`)};for(const[i,o]of Object.entries(e))n(i,o,!1);for(const[i,o]of Object.entries(t))n(i,o,!0);return r}const GQ=Object.freeze(Object.defineProperty({__proto__:null,abytes:g_,bitGet:VQ,bitLen:qQ,bitMask:xO,bitSet:WQ,bytesToHex:Mg,bytesToNumberBE:iy,bytesToNumberLE:EO,concatBytes:_w,createHmacDrbg:TK,ensureBytes:Pc,equalBytes:zQ,hexToBytes:Bg,hexToNumber:_O,isBytes:$y,numberToBytesBE:jg,numberToBytesLE:AO,numberToHexUnpadded:SK,numberToVarBytesBE:KQ,utf8ToBytes:FQ,validateObject:v_},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yo=BigInt(0),Vn=BigInt(1),Pp=BigInt(2),YQ=BigInt(3),_P=BigInt(4),D3=BigInt(5),M3=BigInt(8);BigInt(9);BigInt(16);function Za(r,e){const t=r%e;return t>=yo?t:e+t}function ZQ(r,e,t){if(t<=yo||e<yo)throw new Error("Expected power/modulo > 0");if(t===Vn)return yo;let n=Vn;for(;e>yo;)e&Vn&&(n=n*r%t),r=r*r%t,e>>=Vn;return n}function EP(r,e){if(r===yo||e<=yo)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=Za(r,e),n=e,i=yo,o=Vn;for(;t!==yo;){const a=n/t,l=n%t,d=i-o*a;n=t,t=l,i=o,o=d}if(n!==Vn)throw new Error("invert: does not exist");return Za(i,e)}function JQ(r){const e=(r-Vn)/Pp;let t,n,i;for(t=r-Vn,n=0;t%Pp===yo;t/=Pp,n++);for(i=Pp;i<r&&ZQ(i,e,r)!==r-Vn;i++);if(n===1){const s=(r+Vn)/_P;return function(l,d){const c=l.pow(d,s);if(!l.eql(l.sqr(c),d))throw new Error("Cannot find square root");return c}}const o=(t+Vn)/Pp;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let d=n,c=a.pow(a.mul(a.ONE,i),t),u=a.pow(l,o),f=a.pow(l,t);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let y=a.sqr(f);h<d&&!a.eql(y,a.ONE);h++)y=a.sqr(y);const p=a.pow(c,Vn<<BigInt(d-h-1));c=a.sqr(p),u=a.mul(u,p),f=a.mul(f,c),d=h}return u}}function XQ(r){if(r%_P===YQ){const e=(r+Vn)/_P;return function(n,i){const o=n.pow(i,e);if(!n.eql(n.sqr(o),i))throw new Error("Cannot find square root");return o}}if(r%M3===D3){const e=(r-D3)/M3;return function(n,i){const o=n.mul(i,Pp),s=n.pow(o,e),a=n.mul(i,s),l=n.mul(n.mul(a,Pp),s),d=n.mul(a,n.sub(l,n.ONE));if(!n.eql(n.sqr(d),i))throw new Error("Cannot find square root");return d}}return JQ(r)}const QQ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function eee(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=QQ.reduce((n,i)=>(n[i]="function",n),e);return v_(r,t)}function tee(r,e,t){if(t<yo)throw new Error("Expected power > 0");if(t===yo)return r.ONE;if(t===Vn)return e;let n=r.ONE,i=e;for(;t>yo;)t&Vn&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Vn;return n}function ree(r,e){const t=new Array(e.length),n=e.reduce((o,s,a)=>r.is0(s)?o:(t[a]=o,r.mul(o,s)),r.ONE),i=r.inv(n);return e.reduceRight((o,s,a)=>r.is0(s)?o:(t[a]=r.mul(o,t[a]),r.mul(o,s)),i),t}function $K(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function nee(r,e,t=!1,n={}){if(r<=yo)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:i,nByteLength:o}=$K(r,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=XQ(r),a=Object.freeze({ORDER:r,BITS:i,BYTES:o,MASK:xO(i),ZERO:yo,ONE:Vn,create:l=>Za(l,r),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return yo<=l&&l<r},is0:l=>l===yo,isOdd:l=>(l&Vn)===Vn,neg:l=>Za(-l,r),eql:(l,d)=>l===d,sqr:l=>Za(l*l,r),add:(l,d)=>Za(l+d,r),sub:(l,d)=>Za(l-d,r),mul:(l,d)=>Za(l*d,r),pow:(l,d)=>tee(a,l,d),div:(l,d)=>Za(l*EP(d,r),r),sqrN:l=>l*l,addN:(l,d)=>l+d,subN:(l,d)=>l-d,mulN:(l,d)=>l*d,inv:l=>EP(l,r),sqrt:n.sqrt||(l=>s(a,l)),invertBatch:l=>ree(a,l),cmov:(l,d,c)=>c?d:l,toBytes:l=>t?AO(l,o):jg(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return t?EO(l):iy(l)}});return Object.freeze(a)}function kK(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function PK(r){const e=kK(r);return e+Math.ceil(e/2)}function iee(r,e,t=!1){const n=r.length,i=kK(e),o=PK(e);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const s=t?iy(r):EO(r),a=Za(s,e-Vn)+Vn;return t?AO(a,i):jg(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const oee=BigInt(0),ST=BigInt(1);function see(r,e){const t=(i,o)=>{const s=o.negate();return i?s:o},n=i=>{const o=Math.ceil(e/i)+1,s=2**(i-1);return{windows:o,windowSize:s}};return{constTimeNegate:t,unsafeLadder(i,o){let s=r.ZERO,a=i;for(;o>oee;)o&ST&&(s=s.add(a)),a=a.double(),o>>=ST;return s},precomputeWindow(i,o){const{windows:s,windowSize:a}=n(o),l=[];let d=i,c=d;for(let u=0;u<s;u++){c=d,l.push(c);for(let f=1;f<a;f++)c=c.add(d),l.push(c);d=c.double()}return l},wNAF(i,o,s){const{windows:a,windowSize:l}=n(i);let d=r.ZERO,c=r.BASE;const u=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const y=p*l;let g=Number(s&u);s>>=h,g>l&&(g-=f,s+=ST);const w=y,v=y+Math.abs(g)-1,m=p%2!==0,b=g<0;g===0?c=c.add(t(m,o[w])):d=d.add(t(b,o[v]))}return{p:d,f:c}},wNAFCached(i,o,s,a){const l=i._WINDOW_SIZE||1;let d=o.get(i);return d||(d=this.precomputeWindow(i,l),l!==1&&o.set(i,a(d))),this.wNAF(l,d,s)}}}function IK(r){return eee(r.Fp),v_(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$K(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function aee(r){const e=IK(r);v_(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:cee,hexToBytes:lee}=GQ,Fp={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(r){const{Err:e}=Fp;if(r.length<2||r[0]!==2)throw new e("Invalid signature integer tag");const t=r[1],n=r.subarray(2,t+2);if(!t||n.length!==t)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:cee(n),l:r.subarray(t+2)}},toSig(r){const{Err:e}=Fp,t=typeof r=="string"?lee(r):r;g_(t);let n=t.length;if(n<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:i,l:o}=Fp._parseInt(t.subarray(2)),{d:s,l:a}=Fp._parseInt(o);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(r){const e=d=>Number.parseInt(d[0],16)&8?"00"+d:d,t=d=>{const c=d.toString(16);return c.length&1?`0${c}`:c},n=e(t(r.s)),i=e(t(r.r)),o=n.length/2,s=i.length/2,a=t(o),l=t(s);return`30${t(s+o+4)}02${l}${i}02${a}${n}`}},ou=BigInt(0),Wa=BigInt(1);BigInt(2);const B3=BigInt(3);BigInt(4);function dee(r){const e=aee(r),{Fp:t}=e,n=e.toBytes||((p,y,g)=>{const w=y.toAffine();return _w(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),i=e.fromBytes||(p=>{const y=p.subarray(1),g=t.fromBytes(y.subarray(0,t.BYTES)),w=t.fromBytes(y.subarray(t.BYTES,2*t.BYTES));return{x:g,y:w}});function o(p){const{a:y,b:g}=e,w=t.sqr(p),v=t.mul(w,p);return t.add(t.add(v,t.mul(p,y)),g)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function s(p){return typeof p=="bigint"&&ou<p&&p<e.n}function a(p){if(!s(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:y,nByteLength:g,wrapPrivateKey:w,n:v}=e;if(y&&typeof p!="bigint"){if($y(p)&&(p=Mg(p)),typeof p!="string"||!y.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let m;try{m=typeof p=="bigint"?p:iy(Pc("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return w&&(m=Za(m,v)),a(m),m}const d=new Map;function c(p){if(!(p instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(y,g,w){if(this.px=y,this.py=g,this.pz=w,y==null||!t.isValid(y))throw new Error("x required");if(g==null||!t.isValid(g))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required")}static fromAffine(y){const{x:g,y:w}=y||{};if(!y||!t.isValid(g)||!t.isValid(w))throw new Error("invalid affine point");if(y instanceof u)throw new Error("projective point not allowed");const v=m=>t.eql(m,t.ZERO);return v(g)&&v(w)?u.ZERO:new u(g,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const g=t.invertBatch(y.map(w=>w.pz));return y.map((w,v)=>w.toAffine(g[v])).map(u.fromAffine)}static fromHex(y){const g=u.fromAffine(i(Pc("pointHex",y)));return g.assertValidity(),g}static fromPrivateKey(y){return u.BASE.multiply(l(y))}_setWindowSize(y){this._WINDOW_SIZE=y,d.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:y,y:g}=this.toAffine();if(!t.isValid(y)||!t.isValid(g))throw new Error("bad point: x or y not FE");const w=t.sqr(g),v=o(y);if(!t.eql(w,v))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y}=this.toAffine();if(t.isOdd)return!t.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){c(y);const{px:g,py:w,pz:v}=this,{px:m,py:b,pz:_}=y,E=t.eql(t.mul(g,_),t.mul(m,v)),S=t.eql(t.mul(w,_),t.mul(b,v));return E&&S}negate(){return new u(this.px,t.neg(this.py),this.pz)}double(){const{a:y,b:g}=e,w=t.mul(g,B3),{px:v,py:m,pz:b}=this;let _=t.ZERO,E=t.ZERO,S=t.ZERO,T=t.mul(v,v),O=t.mul(m,m),M=t.mul(b,b),Q=t.mul(v,m);return Q=t.add(Q,Q),S=t.mul(v,b),S=t.add(S,S),_=t.mul(y,S),E=t.mul(w,M),E=t.add(_,E),_=t.sub(O,E),E=t.add(O,E),E=t.mul(_,E),_=t.mul(Q,_),S=t.mul(w,S),M=t.mul(y,M),Q=t.sub(T,M),Q=t.mul(y,Q),Q=t.add(Q,S),S=t.add(T,T),T=t.add(S,T),T=t.add(T,M),T=t.mul(T,Q),E=t.add(E,T),M=t.mul(m,b),M=t.add(M,M),T=t.mul(M,Q),_=t.sub(_,T),S=t.mul(M,O),S=t.add(S,S),S=t.add(S,S),new u(_,E,S)}add(y){c(y);const{px:g,py:w,pz:v}=this,{px:m,py:b,pz:_}=y;let E=t.ZERO,S=t.ZERO,T=t.ZERO;const O=e.a,M=t.mul(e.b,B3);let Q=t.mul(g,m),W=t.mul(w,b),U=t.mul(v,_),ee=t.add(g,w),R=t.add(m,b);ee=t.mul(ee,R),R=t.add(Q,W),ee=t.sub(ee,R),R=t.add(g,v);let z=t.add(m,_);return R=t.mul(R,z),z=t.add(Q,U),R=t.sub(R,z),z=t.add(w,v),E=t.add(b,_),z=t.mul(z,E),E=t.add(W,U),z=t.sub(z,E),T=t.mul(O,R),E=t.mul(M,U),T=t.add(E,T),E=t.sub(W,T),T=t.add(W,T),S=t.mul(E,T),W=t.add(Q,Q),W=t.add(W,Q),U=t.mul(O,U),R=t.mul(M,R),W=t.add(W,U),U=t.sub(Q,U),U=t.mul(O,U),R=t.add(R,U),Q=t.mul(W,R),S=t.add(S,Q),Q=t.mul(z,R),E=t.mul(ee,E),E=t.sub(E,Q),Q=t.mul(ee,W),T=t.mul(z,T),T=t.add(T,Q),new u(E,S,T)}subtract(y){return this.add(y.negate())}is0(){return this.equals(u.ZERO)}wNAF(y){return h.wNAFCached(this,d,y,g=>{const w=t.invertBatch(g.map(v=>v.pz));return g.map((v,m)=>v.toAffine(w[m])).map(u.fromAffine)})}multiplyUnsafe(y){const g=u.ZERO;if(y===ou)return g;if(a(y),y===Wa)return this;const{endo:w}=e;if(!w)return h.unsafeLadder(this,y);let{k1neg:v,k1:m,k2neg:b,k2:_}=w.splitScalar(y),E=g,S=g,T=this;for(;m>ou||_>ou;)m&Wa&&(E=E.add(T)),_&Wa&&(S=S.add(T)),T=T.double(),m>>=Wa,_>>=Wa;return v&&(E=E.negate()),b&&(S=S.negate()),S=new u(t.mul(S.px,w.beta),S.py,S.pz),E.add(S)}multiply(y){a(y);let g=y,w,v;const{endo:m}=e;if(m){const{k1neg:b,k1:_,k2neg:E,k2:S}=m.splitScalar(g);let{p:T,f:O}=this.wNAF(_),{p:M,f:Q}=this.wNAF(S);T=h.constTimeNegate(b,T),M=h.constTimeNegate(E,M),M=new u(t.mul(M.px,m.beta),M.py,M.pz),w=T.add(M),v=O.add(Q)}else{const{p:b,f:_}=this.wNAF(g);w=b,v=_}return u.normalizeZ([w,v])[0]}multiplyAndAddUnsafe(y,g,w){const v=u.BASE,m=(_,E)=>E===ou||E===Wa||!_.equals(v)?_.multiplyUnsafe(E):_.multiply(E),b=m(this,g).add(m(y,w));return b.is0()?void 0:b}toAffine(y){const{px:g,py:w,pz:v}=this,m=this.is0();y==null&&(y=m?t.ONE:t.inv(v));const b=t.mul(g,y),_=t.mul(w,y),E=t.mul(v,y);if(m)return{x:t.ZERO,y:t.ZERO};if(!t.eql(E,t.ONE))throw new Error("invZ was invalid");return{x:b,y:_}}isTorsionFree(){const{h:y,isTorsionFree:g}=e;if(y===Wa)return!0;if(g)return g(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:g}=e;return y===Wa?this:g?g(u,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return this.assertValidity(),n(u,this,y)}toHex(y=!0){return Mg(this.toRawBytes(y))}}u.BASE=new u(e.Gx,e.Gy,t.ONE),u.ZERO=new u(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,h=see(u,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:s}}function uee(r){const e=IK(r);return v_(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function fee(r){const e=uee(r),{Fp:t,n}=e,i=t.BYTES+1,o=2*t.BYTES+1;function s(R){return ou<R&&R<t.ORDER}function a(R){return Za(R,n)}function l(R){return EP(R,n)}const{ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:f}=dee({...e,toBytes(R,z,K){const Y=z.toAffine(),I=t.toBytes(Y.x),D=_w;return K?D(Uint8Array.from([z.hasEvenY()?2:3]),I):D(Uint8Array.from([4]),I,t.toBytes(Y.y))},fromBytes(R){const z=R.length,K=R[0],Y=R.subarray(1);if(z===i&&(K===2||K===3)){const I=iy(Y);if(!s(I))throw new Error("Point is not on curve");const D=u(I);let N;try{N=t.sqrt(D)}catch(j){const G=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+G)}const V=(N&Wa)===Wa;return(K&1)===1!==V&&(N=t.neg(N)),{x:I,y:N}}else if(z===o&&K===4){const I=t.fromBytes(Y.subarray(0,t.BYTES)),D=t.fromBytes(Y.subarray(t.BYTES,2*t.BYTES));return{x:I,y:D}}else throw new Error(`Point of length ${z} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}}),h=R=>Mg(jg(R,e.nByteLength));function p(R){const z=n>>Wa;return R>z}function y(R){return p(R)?a(-R):R}const g=(R,z,K)=>iy(R.slice(z,K));class w{constructor(z,K,Y){this.r=z,this.s=K,this.recovery=Y,this.assertValidity()}static fromCompact(z){const K=e.nByteLength;return z=Pc("compactSignature",z,K*2),new w(g(z,0,K),g(z,K,2*K))}static fromDER(z){const{r:K,s:Y}=Fp.toSig(Pc("DER",z));return new w(K,Y)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(z){return new w(this.r,this.s,z)}recoverPublicKey(z){const{r:K,s:Y,recovery:I}=this,D=S(Pc("msgHash",z));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const N=I===2||I===3?K+e.n:K;if(N>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const V=I&1?"03":"02",J=d.fromHex(V+h(N)),j=l(N),G=a(-D*j),C=a(Y*j),F=d.BASE.multiplyAndAddUnsafe(J,G,C);if(!F)throw new Error("point at infinify");return F.assertValidity(),F}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Bg(this.toDERHex())}toDERHex(){return Fp.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Bg(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const v={isValidPrivateKey(R){try{return c(R),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const R=PK(e.n);return iee(e.randomBytes(R),e.n)},precompute(R=8,z=d.BASE){return z._setWindowSize(R),z.multiply(BigInt(3)),z}};function m(R,z=!0){return d.fromPrivateKey(R).toRawBytes(z)}function b(R){const z=$y(R),K=typeof R=="string",Y=(z||K)&&R.length;return z?Y===i||Y===o:K?Y===2*i||Y===2*o:R instanceof d}function _(R,z,K=!0){if(b(R))throw new Error("first arg must be private key");if(!b(z))throw new Error("second arg must be public key");return d.fromHex(z).multiply(c(R)).toRawBytes(K)}const E=e.bits2int||function(R){const z=iy(R),K=R.length*8-e.nBitLength;return K>0?z>>BigInt(K):z},S=e.bits2int_modN||function(R){return a(E(R))},T=xO(e.nBitLength);function O(R){if(typeof R!="bigint")throw new Error("bigint expected");if(!(ou<=R&&R<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return jg(R,e.nByteLength)}function M(R,z,K=Q){if(["recovered","canonical"].some(te=>te in K))throw new Error("sign() legacy options not supported");const{hash:Y,randomBytes:I}=e;let{lowS:D,prehash:N,extraEntropy:V}=K;D==null&&(D=!0),R=Pc("msgHash",R),N&&(R=Pc("prehashed msgHash",Y(R)));const J=S(R),j=c(z),G=[O(j),O(J)];if(V!=null&&V!==!1){const te=V===!0?I(t.BYTES):V;G.push(Pc("extraEntropy",te))}const C=_w(...G),F=J;function Z(te){const re=E(te);if(!f(re))return;const q=l(re),L=d.BASE.multiply(re).toAffine(),k=a(L.x);if(k===ou)return;const B=a(q*a(F+k*j));if(B===ou)return;let X=(L.x===k?0:2)|Number(L.y&Wa),ne=B;return D&&p(B)&&(ne=y(B),X^=1),new w(k,ne,X)}return{seed:C,k2sig:Z}}const Q={lowS:e.lowS,prehash:!1},W={lowS:e.lowS,prehash:!1};function U(R,z,K=Q){const{seed:Y,k2sig:I}=M(R,z,K),D=e;return TK(D.hash.outputLen,D.nByteLength,D.hmac)(Y,I)}d.BASE._setWindowSize(8);function ee(R,z,K,Y=W){const I=R;if(z=Pc("msgHash",z),K=Pc("publicKey",K),"strict"in Y)throw new Error("options.strict was renamed to lowS");const{lowS:D,prehash:N}=Y;let V,J;try{if(typeof I=="string"||$y(I))try{V=w.fromDER(I)}catch(L){if(!(L instanceof Fp.Err))throw L;V=w.fromCompact(I)}else if(typeof I=="object"&&typeof I.r=="bigint"&&typeof I.s=="bigint"){const{r:L,s:k}=I;V=new w(L,k)}else throw new Error("PARSE");J=d.fromHex(K)}catch(L){if(L.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(D&&V.hasHighS())return!1;N&&(z=e.hash(z));const{r:j,s:G}=V,C=S(z),F=l(G),Z=a(C*F),te=a(j*F),re=d.BASE.multiplyAndAddUnsafe(J,Z,te)?.toAffine();return re?a(re.x)===j:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:_,sign:U,verify:ee,ProjectivePoint:d,Signature:w,utils:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hee(r){return{hash:r,hmac:(e,...t)=>wO(r,e,EK(...t)),randomBytes:vO}}function pee(r,e){const t=n=>fee({...r,...hee(n)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const OK=nee(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),yee=OK.create(BigInt("-3")),mee=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Bf=pee({a:yee,b:mee,Fp:OK,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},lc),gee=Bf;function vee(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function of(r=0){return new Uint8Array(r)}function ky(r=0){return new Uint8Array(r)}function AP(r,e){e==null&&(e=r.reduce((i,o)=>i+o.length,0));const t=ky(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const bee=new Uint8Array(0);function wee(r){const e=r.match(/../g);return e!=null?new Uint8Array(e.map(t=>parseInt(t,16))):bee}function _ee(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function SO(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Eee(r){return new TextEncoder().encode(r)}function Aee(r){return new TextDecoder().decode(r)}function xee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,l=r.charAt(0),d=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,g=0,w=0,v=p.length;w!==v&&p[w]===0;)w++,y++;for(var m=(v-w)*c+1>>>0,b=new Uint8Array(m);w!==v;){for(var _=p[w],E=0,S=m-1;(_!==0||E<g)&&S!==-1;S--,E++)_+=256*b[S]>>>0,b[S]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");g=E,w++}for(var T=m-g;T!==m&&b[T]===0;)T++;for(var O=l.repeat(y);T<m;++T)O+=r.charAt(b[T]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var g=0,w=0;p[y]===l;)g++,y++;for(var v=(p.length-y)*d+1>>>0,m=new Uint8Array(v);p[y];){var b=t[p.charCodeAt(y)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<w)&&E!==-1;E--,_++)b+=a*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");w=_,y++}if(p[y]!==" "){for(var S=v-w;S!==v&&m[S]===0;)S++;for(var T=new Uint8Array(g+(v-S)),O=g;S!==v;)T[O++]=m[S++];return T}}}function h(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:h}}var See=xee,Tee=See;let $ee=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},kee=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return CK(this,e)}},Pee=class{decoders;constructor(e){this.decoders=e}or(e){return CK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function CK(r,e){return new Pee({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}let Iee=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new $ee(e,t,n),this.decoder=new kee(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Rx({name:r,prefix:e,encode:t,decode:n}){return new Iee(r,e,t,n)}function b_({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=Tee(t,r);return Rx({prefix:e,name:r,encode:n,decode:o=>SO(i(o))})}function Oee(r,e,t,n){const i={};for(let c=0;c<e.length;++c)i[e[c]]=c;let o=r.length;for(;r[o-1]==="=";)--o;const s=new Uint8Array(o*t/8|0);let a=0,l=0,d=0;for(let c=0;c<o;++c){const u=i[r[c]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|u,a+=t,a>=8&&(a-=8,s[d++]=255&l>>a)}if(a>=t||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s}function Cee(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let o="",s=0,a=0;for(let l=0;l<r.length;++l)for(a=a<<8|r[l],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s!==0&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o}function Eo({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return Rx({prefix:e,name:r,encode(i){return Cee(i,n,t)},decode(i){return Oee(i,n,t,r)}})}const Ree=b_({prefix:"9",name:"base10",alphabet:"0123456789"}),Dee=Object.freeze(Object.defineProperty({__proto__:null,base10:Ree},Symbol.toStringTag,{value:"Module"})),Mee=Eo({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Bee=Eo({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),jee=Object.freeze(Object.defineProperty({__proto__:null,base16:Mee,base16upper:Bee},Symbol.toStringTag,{value:"Module"})),Nee=Eo({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Uee=Object.freeze(Object.defineProperty({__proto__:null,base2:Nee},Symbol.toStringTag,{value:"Module"})),RK=Array.from(""),Lee=RK.reduce((r,e,t)=>(r[t]=e,r),[]),Kee=RK.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function zee(r){return r.reduce((e,t)=>(e+=Lee[t],e),"")}function Fee(r){const e=[];for(const t of r){const n=Kee[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const qee=Rx({prefix:"",name:"base256emoji",encode:zee,decode:Fee}),Vee=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:qee},Symbol.toStringTag,{value:"Module"})),Kb=Eo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Wee=Eo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Hee=Eo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Gee=Eo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Yee=Eo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Zee=Eo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Jee=Eo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xee=Eo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Qee=Eo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ete=Object.freeze(Object.defineProperty({__proto__:null,base32:Kb,base32hex:Yee,base32hexpad:Jee,base32hexpadupper:Xee,base32hexupper:Zee,base32pad:Hee,base32padupper:Gee,base32upper:Wee,base32z:Qee},Symbol.toStringTag,{value:"Module"})),tte=b_({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rte=b_({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),nte=Object.freeze(Object.defineProperty({__proto__:null,base36:tte,base36upper:rte},Symbol.toStringTag,{value:"Module"})),Qd=b_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ite=b_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ote=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Qd,base58flickr:ite},Symbol.toStringTag,{value:"Module"})),ste=Eo({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ate=Eo({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),cte=Eo({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),lte=Eo({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),dte=Object.freeze(Object.defineProperty({__proto__:null,base64:ste,base64pad:ate,base64url:cte,base64urlpad:lte},Symbol.toStringTag,{value:"Module"})),ute=Eo({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fte=Object.freeze(Object.defineProperty({__proto__:null,base8:ute},Symbol.toStringTag,{value:"Module"})),hte=Rx({prefix:"\0",name:"identity",encode:r=>Aee(r),decode:r=>Eee(r)}),pte=Object.freeze(Object.defineProperty({__proto__:null,identity:hte},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var yte=DK,j3=128,mte=127,gte=~mte,vte=Math.pow(2,31);function DK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=vte;)e[t++]=r&255|j3,r/=128;for(;r&gte;)e[t++]=r&255|j3,r>>>=7;return e[t]=r|0,DK.bytes=t-n+1,e}var bte=xP,wte=128,N3=127;function xP(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw xP.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&N3)<<i:(s&N3)*Math.pow(2,i),i+=7}while(s>=wte);return xP.bytes=o-n,t}var _te=Math.pow(2,7),Ete=Math.pow(2,14),Ate=Math.pow(2,21),xte=Math.pow(2,28),Ste=Math.pow(2,35),Tte=Math.pow(2,42),$te=Math.pow(2,49),kte=Math.pow(2,56),Pte=Math.pow(2,63),Ite=function(r){return r<_te?1:r<Ete?2:r<Ate?3:r<xte?4:r<Ste?5:r<Tte?6:r<$te?7:r<kte?8:r<Pte?9:10},Ote={encode:yte,decode:bte,encodingLength:Ite},XE=Ote;function SP(r,e=0){return[XE.decode(r,e),XE.decode.bytes]}function QE(r,e,t=0){return XE.encode(r,e,t),e}function eA(r){return XE.encodingLength(r)}function TP(r,e){const t=e.byteLength,n=eA(r),i=n+eA(t),o=new Uint8Array(i+t);return QE(r,o,0),QE(t,o,n),o.set(e,i),new TO(r,t,e,o)}function Cte(r){const e=SO(r),[t,n]=SP(e),[i,o]=SP(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new TO(t,i,s,e)}function Rte(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&_ee(r.bytes,t.bytes)}}let TO=class{code;size;digest;bytes;constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};function Dte({name:r,code:e,encode:t}){return new Mte(r,e,t)}let Mte=class{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?TP(this.code,t):t.then(n=>TP(this.code,n))}else throw Error("Unknown type, must be binary type")}};function U3(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return jte(t,$P(r),e??Qd.encoder);default:return Nte(t,$P(r),e??Kb.encoder)}}const L3=new WeakMap;function $P(r){const e=L3.get(r);if(e==null){const t=new Map;return L3.set(r,t),t}return e}let ub=class Po{code;version;multihash;bytes;"/";constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==d0)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ute)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Po.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=TP(e,t);return Po.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Po.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Rte(e.multihash,n.multihash)}toString(e){return U3(this,e)}toJSON(){return{"/":U3(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Po)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:o,bytes:s}=t;return new Po(n,i,o,s??K3(n,i,o.bytes))}else if(t[Lte]===!0){const{version:n,multihash:i,code:o}=t,s=Cte(i);return Po.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==d0)throw new Error(`Version 0 CID must use dag-pb (code: ${d0}) block encoding`);return new Po(e,t,n,n.bytes)}case 1:{const i=K3(e,t,n.bytes);return new Po(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Po.create(0,d0,e)}static createV1(e,t){return Po.create(1,e,t)}static decode(e){const[t,n]=Po.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Po.inspectBytes(e),n=t.size-t.multihashSize,i=SO(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=i.subarray(t.multihashSize-t.digestSize),s=new TO(t.multihashCode,t.digestSize,o,i);return[t.version===0?Po.createV0(s):Po.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[u,f]=SP(e.subarray(t));return t+=f,u};let i=n(),o=d0;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const s=t,a=n(),l=n(),d=t+l,c=d-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:d}}static parse(e,t){const[n,i]=Bte(e,t),o=Po.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return $P(o).set(n,e),o}};function Bte(r,e){switch(r[0]){case"Q":{const t=e??Qd;return[Qd.prefix,t.decode(`${Qd.prefix}${r}`)]}case Qd.prefix:{const t=e??Qd;return[Qd.prefix,t.decode(r)]}case Kb.prefix:{const t=e??Kb;return[Kb.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function jte(r,e,t){const{prefix:n}=t;if(n!==Qd.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const o=t.encode(r).slice(1);return e.set(n,o),o}else return i}function Nte(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const o=t.encode(r);return e.set(n,o),o}else return i}const d0=112,Ute=18;function K3(r,e,t){const n=eA(r),i=n+eA(e),o=new Uint8Array(i+t.byteLength);return QE(r,o,0),QE(e,o,n),o.set(t,i),o}const Lte=Symbol.for("@ipld/js-cid/CID"),z3={...pte,...Uee,...fte,...Dee,...jee,...ete,...nte,...ote,...dte,...Vee};function MK(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const F3=MK("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),TT=MK("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=ky(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),BK={utf8:F3,"utf-8":F3,hex:z3.base16,latin1:TT,ascii:TT,binary:TT,...z3};function $O(r,e="utf8"){const t=BK[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function Kte(r,e="utf8"){const t=BK[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var _1=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const zte={toString:Kte,fromString:$O};let E1=class mp{static validateKey(e){if(e.kty!=="EC"||e.crv!=="P-256")throw new Ae(we.Secp256r1KeyNotValid,"Invalid SECP256R1 JWK: `kty` MUST be `EC`. `crv` MUST be `P-256`")}static publicKeyToJwk(e){return _1(this,void 0,void 0,function*(){let t;e.byteLength===33?t=Bf.ProjectivePoint.fromHex(e).toRawBytes(!1):t=e;const n=vt.bytesToBase64Url(t.subarray(1,33)),i=vt.bytesToBase64Url(t.subarray(33,65));return{alg:"ES256",kty:"EC",crv:"P-256",x:n,y:i}})}static privateJwkToBytes(e){return vt.base64UrlToBytes(e.d)}static sign(e,t){return _1(this,void 0,void 0,function*(){mp.validateKey(t);const n=yield Xl.encode(e),i=mp.privateJwkToBytes(t);return Promise.resolve(Bf.sign(n,i).toCompactRawBytes())})}static verify(e,t,n){return _1(this,void 0,void 0,function*(){mp.validateKey(n);let i;t.length===64?i=Bf.Signature.fromCompact(t):i=Bf.Signature.fromDER(t);const o=yield Xl.encode(e),s=Bf.ProjectivePoint.fromAffine({x:mp.bytesToBigInt(vt.base64UrlToBytes(n.x)),y:mp.bytesToBigInt(vt.base64UrlToBytes(n.y))}).toRawBytes(!1);return Bf.verify(i,o,s)})}static generateKeyPair(){return _1(this,void 0,void 0,function*(){const e=Bf.utils.randomPrivateKey(),t=gee.getPublicKey(e,!1),n=vt.bytesToBase64Url(e),i=yield mp.publicKeyToJwk(t),o=Object.assign(Object.assign({},i),{d:n});return{publicJwk:i,privateJwk:o}})}static bytesToBigInt(e){return BigInt("0x"+zte.toString(e,"base16"))}};const tA={Ed25519:MX,secp256k1:{sign:Lc.sign,verify:Lc.verify,generateKeyPair:Lc.generateKeyPair,publicKeyToJwk:Lc.publicKeyToJwk},"P-256":{sign:E1.sign,verify:E1.verify,generateKeyPair:E1.generateKeyPair,publicKeyToJwk:E1.publicKeyToJwk}};var Fte=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class qte{constructor(e){var t,n;if(e.keyId===void 0&&e.privateJwk.kid===void 0)throw new Ae(we.PrivateKeySignerUnableToDeduceKeyId,"Unable to deduce the key ID");if(e.algorithm===void 0&&e.privateJwk.alg===void 0)throw new Ae(we.PrivateKeySignerUnableToDeduceAlgorithm,"Unable to deduce the signature algorithm");if(this.keyId=(t=e.keyId)!==null&&t!==void 0?t:e.privateJwk.kid,this.algorithm=(n=e.algorithm)!==null&&n!==void 0?n:e.privateJwk.alg,this.privateJwk=e.privateJwk,this.signatureAlgorithm=tA[e.privateJwk.crv],!this.signatureAlgorithm)throw new Ae(we.PrivateKeySignerUnsupportedCurve,`Unsupported crv ${e.privateJwk.crv}, crv must be one of ${Object.keys(tA)}`)}sign(e){return Fte(this,void 0,void 0,function*(){return yield this.signatureAlgorithm.sign(e,this.privateJwk)})}}var Vte=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class un{static getKid(e){const{kid:t}=vt.base64UrlToObject(e.protected);return t}static getSignerDid(e){const t=un.getKid(e);return un.extractDid(t)}static verifySignature(e,t,n){return Vte(this,void 0,void 0,function*(){const i=tA[n.crv];if(!i)throw new Ae(we.JwsVerifySignatureUnsupportedCrv,`unsupported crv. crv must be one of ${Object.keys(tA)}`);const o=vt.stringToBytes(`${t.protected}.${e}`),s=vt.base64UrlToBytes(t.signature);return yield i.verify(o,s,n)})}static decodePlainObjectPayload(e){let t;try{t=vt.base64UrlToObject(e.payload)}catch{throw new Ae(we.JwsDecodePlainObjectPayloadInvalid,"payload is not a JSON object")}if(!uX(t))throw new Ae(we.JwsDecodePlainObjectPayloadInvalid,"signed payload must be a plain object");return t}static extractDid(e){const[t]=e.split("#");return t}static createSigners(e){return e.map(n=>un.createSigner(n))}static createSigner(e){const t=e.keyPair.privateJwk,n=e.keyId;return new qte({privateJwk:t,keyId:n})}}const u0=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,jK=new Set,kP=typeof process=="object"&&process?process:{},NK=(r,e,t,n)=>{typeof kP.emitWarning=="function"?kP.emitWarning(r,e,t,n):console.error(`[${t}] ${e}: ${r}`)};let rA=globalThis.AbortController,q3=globalThis.AbortSignal;if(typeof rA>"u"){q3=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(n,i){this._onabort.push(i)}},rA=class{constructor(){e()}signal=new q3;abort(n){if(!this.signal.aborted){this.signal.reason=n,this.signal.aborted=!0;for(const i of this.signal._onabort)i(n);this.signal.onabort?.(n)}}};let r=kP.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{r&&(r=!1,NK("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Wte=r=>!jK.has(r),jf=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),UK=r=>jf(r)?r<=Math.pow(2,8)?Uint8Array:r<=Math.pow(2,16)?Uint16Array:r<=Math.pow(2,32)?Uint32Array:r<=Number.MAX_SAFE_INTEGER?X2:null:null;class X2 extends Array{constructor(e){super(e),this.fill(0)}}class Gm{heap;length;static#t=!1;static create(e){const t=UK(e);if(!t)return[];Gm.#t=!0;const n=new Gm(e,t);return Gm.#t=!1,n}constructor(e,t){if(!Gm.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class kO{#t;#i;#p;#y;#P;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#o;#m;#s;#n;#e;#d;#f;#l;#a;#g;#c;#E;#A;#v;#b;#S;#u;static unsafeExposeInternals(e){return{starts:e.#A,ttls:e.#v,sizes:e.#E,keyMap:e.#s,keyList:e.#n,valList:e.#e,next:e.#d,prev:e.#f,get head(){return e.#l},get tail(){return e.#a},free:e.#g,isBackgroundFetch:t=>e.#r(t),backgroundFetch:(t,n,i,o)=>e.#C(t,n,i,o),moveToTail:t=>e.#k(t),indexes:t=>e.#w(t),rindexes:t=>e.#_(t),isStale:t=>e.#h(t)}}get max(){return this.#t}get maxSize(){return this.#i}get calculatedSize(){return this.#m}get size(){return this.#o}get fetchMethod(){return this.#P}get dispose(){return this.#p}get disposeAfter(){return this.#y}constructor(e){const{max:t=0,ttl:n,ttlResolution:i=1,ttlAutopurge:o,updateAgeOnGet:s,updateAgeOnHas:a,allowStale:l,dispose:d,disposeAfter:c,noDisposeOnSet:u,noUpdateTTL:f,maxSize:h=0,maxEntrySize:p=0,sizeCalculation:y,fetchMethod:g,noDeleteOnFetchRejection:w,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:m,allowStaleOnFetchAbort:b,ignoreFetchAbort:_}=e;if(t!==0&&!jf(t))throw new TypeError("max option must be a nonnegative integer");const E=t?UK(t):Array;if(!E)throw new Error("invalid max value: "+t);if(this.#t=t,this.#i=h,this.maxEntrySize=p||this.#i,this.sizeCalculation=y,this.sizeCalculation){if(!this.#i&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(g!==void 0&&typeof g!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#P=g,this.#S=!!g,this.#s=new Map,this.#n=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#d=new E(t),this.#f=new E(t),this.#l=0,this.#a=0,this.#g=Gm.create(t),this.#o=0,this.#m=0,typeof d=="function"&&(this.#p=d),typeof c=="function"?(this.#y=c,this.#c=[]):(this.#y=void 0,this.#c=void 0),this.#b=!!this.#p,this.#u=!!this.#y,this.noDisposeOnSet=!!u,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!w,this.allowStaleOnFetchRejection=!!m,this.allowStaleOnFetchAbort=!!b,this.ignoreFetchAbort=!!_,this.maxEntrySize!==0){if(this.#i!==0&&!jf(this.#i))throw new TypeError("maxSize must be a positive integer if specified");if(!jf(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#N()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!s,this.updateAgeOnHas=!!a,this.ttlResolution=jf(i)||i===0?i:1,this.ttlAutopurge=!!o,this.ttl=n||0,this.ttl){if(!jf(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#R()}if(this.#t===0&&this.ttl===0&&this.#i===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#i){const S="LRU_CACHE_UNBOUNDED";Wte(S)&&(jK.add(S),NK("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",S,kO))}}getRemainingTTL(e){return this.#s.has(e)?1/0:0}#R(){const e=new X2(this.#t),t=new X2(this.#t);this.#v=e,this.#A=t,this.#D=(o,s,a=u0.now())=>{if(t[o]=s!==0?a:0,e[o]=s,s!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#h(o)&&this.delete(this.#n[o])},s+1);l.unref&&l.unref()}},this.#T=o=>{t[o]=e[o]!==0?u0.now():0},this.#x=(o,s)=>{if(e[s]){const a=e[s],l=t[s];o.ttl=a,o.start=l,o.now=n||i();const d=o.now-l;o.remainingTTL=a-d}};let n=0;const i=()=>{const o=u0.now();if(this.ttlResolution>0){n=o;const s=setTimeout(()=>n=0,this.ttlResolution);s.unref&&s.unref()}return o};this.getRemainingTTL=o=>{const s=this.#s.get(o);if(s===void 0)return 0;const a=e[s],l=t[s];if(a===0||l===0)return 1/0;const d=(n||i())-l;return a-d},this.#h=o=>e[o]!==0&&t[o]!==0&&(n||i())-t[o]>e[o]}#T=()=>{};#x=()=>{};#D=()=>{};#h=()=>!1;#N(){const e=new X2(this.#t);this.#m=0,this.#E=e,this.#$=t=>{this.#m-=e[t],e[t]=0},this.#M=(t,n,i,o)=>{if(this.#r(n))return 0;if(!jf(i))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(i=o(n,t),!jf(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i},this.#I=(t,n,i)=>{if(e[t]=n,this.#i){const o=this.#i-e[t];for(;this.#m>o;)this.#O(!0)}this.#m+=e[t],i&&(i.entrySize=n,i.totalCalculatedSize=this.#m)}}#$=e=>{};#I=(e,t,n)=>{};#M=(e,t,n,i)=>{if(n||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#w({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#a;!(!this.#B(t)||((e||!this.#h(t))&&(yield t),t===this.#l));)t=this.#f[t]}*#_({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#l;!(!this.#B(t)||((e||!this.#h(t))&&(yield t),t===this.#a));)t=this.#d[t]}#B(e){return e!==void 0&&this.#s.get(this.#n[e])===e}*entries(){for(const e of this.#w())this.#e[e]!==void 0&&this.#n[e]!==void 0&&!this.#r(this.#e[e])&&(yield[this.#n[e],this.#e[e]])}*rentries(){for(const e of this.#_())this.#e[e]!==void 0&&this.#n[e]!==void 0&&!this.#r(this.#e[e])&&(yield[this.#n[e],this.#e[e]])}*keys(){for(const e of this.#w()){const t=this.#n[e];t!==void 0&&!this.#r(this.#e[e])&&(yield t)}}*rkeys(){for(const e of this.#_()){const t=this.#n[e];t!==void 0&&!this.#r(this.#e[e])&&(yield t)}}*values(){for(const e of this.#w())this.#e[e]!==void 0&&!this.#r(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#_())this.#e[e]!==void 0&&!this.#r(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const n of this.#w()){const i=this.#e[n],o=this.#r(i)?i.__staleWhileFetching:i;if(o!==void 0&&e(o,this.#n[n],this))return this.get(this.#n[n],t)}}forEach(e,t=this){for(const n of this.#w()){const i=this.#e[n],o=this.#r(i)?i.__staleWhileFetching:i;o!==void 0&&e.call(t,o,this.#n[n],this)}}rforEach(e,t=this){for(const n of this.#_()){const i=this.#e[n],o=this.#r(i)?i.__staleWhileFetching:i;o!==void 0&&e.call(t,o,this.#n[n],this)}}purgeStale(){let e=!1;for(const t of this.#_({allowStale:!0}))this.#h(t)&&(this.delete(this.#n[t]),e=!0);return e}dump(){const e=[];for(const t of this.#w({allowStale:!0})){const n=this.#n[t],i=this.#e[t],o=this.#r(i)?i.__staleWhileFetching:i;if(o===void 0||n===void 0)continue;const s={value:o};if(this.#v&&this.#A){s.ttl=this.#v[t];const a=u0.now()-this.#A[t];s.start=Math.floor(Date.now()-a)}this.#E&&(s.size=this.#E[t]),e.unshift([n,s])}return e}load(e){this.clear();for(const[t,n]of e){if(n.start){const i=Date.now()-n.start;n.start=u0.now()-i}this.set(t,n.value,n)}}set(e,t,n={}){if(t===void 0)return this.delete(e),this;const{ttl:i=this.ttl,start:o,noDisposeOnSet:s=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:l}=n;let{noUpdateTTL:d=this.noUpdateTTL}=n;const c=this.#M(e,t,n.size||0,a);if(this.maxEntrySize&&c>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.delete(e),this;let u=this.#o===0?void 0:this.#s.get(e);if(u===void 0)u=this.#o===0?this.#a:this.#g.length!==0?this.#g.pop():this.#o===this.#t?this.#O(!1):this.#o,this.#n[u]=e,this.#e[u]=t,this.#s.set(e,u),this.#d[this.#a]=u,this.#f[u]=this.#a,this.#a=u,this.#o++,this.#I(u,c,l),l&&(l.set="add"),d=!1;else{this.#k(u);const f=this.#e[u];if(t!==f){if(this.#S&&this.#r(f)?f.__abortController.abort(new Error("replaced")):s||(this.#b&&this.#p?.(f,e,"set"),this.#u&&this.#c?.push([f,e,"set"])),this.#$(u),this.#I(u,c,l),this.#e[u]=t,l){l.set="replace";const h=f&&this.#r(f)?f.__staleWhileFetching:f;h!==void 0&&(l.oldValue=h)}}else l&&(l.set="update")}if(i!==0&&!this.#v&&this.#R(),this.#v&&(d||this.#D(u,i,o),l&&this.#x(l,u)),!s&&this.#u&&this.#c){const f=this.#c;let h;for(;h=f?.shift();)this.#y?.(...h)}return this}pop(){try{for(;this.#o;){const e=this.#e[this.#l];if(this.#O(!0),this.#r(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#u&&this.#c){const e=this.#c;let t;for(;t=e?.shift();)this.#y?.(...t)}}}#O(e){const t=this.#l,n=this.#n[t],i=this.#e[t];return this.#S&&this.#r(i)?i.__abortController.abort(new Error("evicted")):(this.#b||this.#u)&&(this.#b&&this.#p?.(i,n,"evict"),this.#u&&this.#c?.push([i,n,"evict"])),this.#$(t),e&&(this.#n[t]=void 0,this.#e[t]=void 0,this.#g.push(t)),this.#o===1?(this.#l=this.#a=0,this.#g.length=0):this.#l=this.#d[t],this.#s.delete(n),this.#o--,t}has(e,t={}){const{updateAgeOnHas:n=this.updateAgeOnHas,status:i}=t,o=this.#s.get(e);if(o!==void 0){const s=this.#e[o];if(this.#r(s)&&s.__staleWhileFetching===void 0)return!1;if(this.#h(o))i&&(i.has="stale",this.#x(i,o));else return n&&this.#T(o),i&&(i.has="hit",this.#x(i,o)),!0}else i&&(i.has="miss");return!1}peek(e,t={}){const{allowStale:n=this.allowStale}=t,i=this.#s.get(e);if(i!==void 0&&(n||!this.#h(i))){const o=this.#e[i];return this.#r(o)?o.__staleWhileFetching:o}}#C(e,t,n,i){const o=t===void 0?void 0:this.#e[t];if(this.#r(o))return o;const s=new rA,{signal:a}=n;a?.addEventListener("abort",()=>s.abort(a.reason),{signal:s.signal});const l={signal:s.signal,options:n,context:i},d=(y,g=!1)=>{const{aborted:w}=s.signal,v=n.ignoreFetchAbort&&y!==void 0;if(n.status&&(w&&!g?(n.status.fetchAborted=!0,n.status.fetchError=s.signal.reason,v&&(n.status.fetchAbortIgnored=!0)):n.status.fetchResolved=!0),w&&!v&&!g)return u(s.signal.reason);const m=h;return this.#e[t]===h&&(y===void 0?m.__staleWhileFetching?this.#e[t]=m.__staleWhileFetching:this.delete(e):(n.status&&(n.status.fetchUpdated=!0),this.set(e,y,l.options))),y},c=y=>(n.status&&(n.status.fetchRejected=!0,n.status.fetchError=y),u(y)),u=y=>{const{aborted:g}=s.signal,w=g&&n.allowStaleOnFetchAbort,v=w||n.allowStaleOnFetchRejection,m=v||n.noDeleteOnFetchRejection,b=h;if(this.#e[t]===h&&(!m||b.__staleWhileFetching===void 0?this.delete(e):w||(this.#e[t]=b.__staleWhileFetching)),v)return n.status&&b.__staleWhileFetching!==void 0&&(n.status.returnedStale=!0),b.__staleWhileFetching;if(b.__returned===b)throw y},f=(y,g)=>{const w=this.#P?.(e,o,l);w&&w instanceof Promise&&w.then(v=>y(v),g),s.signal.addEventListener("abort",()=>{(!n.ignoreFetchAbort||n.allowStaleOnFetchAbort)&&(y(),n.allowStaleOnFetchAbort&&(y=v=>d(v,!0)))})};n.status&&(n.status.fetchDispatched=!0);const h=new Promise(f).then(d,c),p=Object.assign(h,{__abortController:s,__staleWhileFetching:o,__returned:void 0});return t===void 0?(this.set(e,p,{...l.options,status:void 0}),t=this.#s.get(e)):this.#e[t]=p,p}#r(e){if(!this.#S)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof rA}async fetch(e,t={}){const{allowStale:n=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:h=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:y,forceRefresh:g=!1,status:w,signal:v}=t;if(!this.#S)return w&&(w.fetch="get"),this.get(e,{allowStale:n,updateAgeOnGet:i,noDeleteOnStaleGet:o,status:w});const m={allowStale:n,updateAgeOnGet:i,noDeleteOnStaleGet:o,ttl:s,noDisposeOnSet:a,size:l,sizeCalculation:d,noUpdateTTL:c,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:p,ignoreFetchAbort:h,status:w,signal:v};let b=this.#s.get(e);if(b===void 0){w&&(w.fetch="miss");const _=this.#C(e,b,m,y);return _.__returned=_}else{const _=this.#e[b];if(this.#r(_)){const M=n&&_.__staleWhileFetching!==void 0;return w&&(w.fetch="inflight",M&&(w.returnedStale=!0)),M?_.__staleWhileFetching:_.__returned=_}const E=this.#h(b);if(!g&&!E)return w&&(w.fetch="hit"),this.#k(b),i&&this.#T(b),w&&this.#x(w,b),_;const S=this.#C(e,b,m,y),O=S.__staleWhileFetching!==void 0&&n;return w&&(w.fetch=E?"stale":"refresh",O&&E&&(w.returnedStale=!0)),O?S.__staleWhileFetching:S.__returned=S}}get(e,t={}){const{allowStale:n=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:s}=t,a=this.#s.get(e);if(a!==void 0){const l=this.#e[a],d=this.#r(l);return s&&this.#x(s,a),this.#h(a)?(s&&(s.get="stale"),d?(s&&n&&l.__staleWhileFetching!==void 0&&(s.returnedStale=!0),n?l.__staleWhileFetching:void 0):(o||this.delete(e),s&&n&&(s.returnedStale=!0),n?l:void 0)):(s&&(s.get="hit"),d?l.__staleWhileFetching:(this.#k(a),i&&this.#T(a),l))}else s&&(s.get="miss")}#j(e,t){this.#f[t]=e,this.#d[e]=t}#k(e){e!==this.#a&&(e===this.#l?this.#l=this.#d[e]:this.#j(this.#f[e],this.#d[e]),this.#j(this.#a,e),this.#a=e)}delete(e){let t=!1;if(this.#o!==0){const n=this.#s.get(e);if(n!==void 0)if(t=!0,this.#o===1)this.clear();else{this.#$(n);const i=this.#e[n];this.#r(i)?i.__abortController.abort(new Error("deleted")):(this.#b||this.#u)&&(this.#b&&this.#p?.(i,e,"delete"),this.#u&&this.#c?.push([i,e,"delete"])),this.#s.delete(e),this.#n[n]=void 0,this.#e[n]=void 0,n===this.#a?this.#a=this.#f[n]:n===this.#l?this.#l=this.#d[n]:(this.#d[this.#f[n]]=this.#d[n],this.#f[this.#d[n]]=this.#f[n]),this.#o--,this.#g.push(n)}}if(this.#u&&this.#c?.length){const n=this.#c;let i;for(;i=n?.shift();)this.#y?.(...i)}return t}clear(){for(const e of this.#_({allowStale:!0})){const t=this.#e[e];if(this.#r(t))t.__abortController.abort(new Error("deleted"));else{const n=this.#n[e];this.#b&&this.#p?.(t,n,"delete"),this.#u&&this.#c?.push([t,n,"delete"])}}if(this.#s.clear(),this.#e.fill(void 0),this.#n.fill(void 0),this.#v&&this.#A&&(this.#v.fill(0),this.#A.fill(0)),this.#E&&this.#E.fill(0),this.#l=0,this.#a=0,this.#g.length=0,this.#m=0,this.#o=0,this.#u&&this.#c){const e=this.#c;let t;for(;t=e?.shift();)this.#y?.(...t)}}}var V3=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Hte{constructor(e){this.timeToLiveInSeconds=e,this.cache=new kO({max:1e5,ttl:e*1e3})}set(e,t){return V3(this,void 0,void 0,function*(){try{this.cache.set(e,t)}catch{}})}get(e){return V3(this,void 0,void 0,function*(){return this.cache.get(e)})}}const Gte=Ii,qp=new RegExp("^[A-Za-z0-9_-]+$","u");function Ir(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Ir.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)){for(const f in r)if(!(f==="payload"||f==="signatures"))return Ir.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:f},message:"must NOT have additional properties"}],!1;{if(r.payload!==void 0){let f=r.payload;const h=a;if(typeof f=="string"){if(!qp.test(f))return Ir.errors=[{instancePath:e+"/payload",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return Ir.errors=[{instancePath:e+"/payload",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=h===a}else var d=!0;if(d)if(r.signatures!==void 0){let f=r.signatures;const h=a;if(Array.isArray(f)){if(f.length<1)return Ir.errors=[{instancePath:e+"/signatures",schemaPath:"#/properties/signatures/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var c=!0;const y=f.length;for(let g=0;g<y;g++){let w=f[g];const v=a;if(w&&typeof w=="object"&&!Array.isArray(w)){if(w.protected!==void 0){let b=w.protected;const _=a;if(typeof b=="string"){if(!qp.test(b))return Ir.errors=[{instancePath:e+"/signatures/"+g+"/protected",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return Ir.errors=[{instancePath:e+"/signatures/"+g+"/protected",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=_===a}else var u=!0;if(u)if(w.signature!==void 0){let b=w.signature;const _=a;if(typeof b=="string"){if(!qp.test(b))return Ir.errors=[{instancePath:e+"/signatures/"+g+"/signature",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return Ir.errors=[{instancePath:e+"/signatures/"+g+"/signature",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=_===a}else var u=!0}else return Ir.errors=[{instancePath:e+"/signatures/"+g,schemaPath:"#/properties/signatures/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=v===a;if(!c)break}}}else return Ir.errors=[{instancePath:e+"/signatures",schemaPath:"#/properties/signatures/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var d=h===a}else var d=!0}}else return Ir.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Ir.errors=s,a===0}Ir.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function Ii(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Ii.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){const d=a;for(const c in r)if(c!=="signature")return Ii.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:c},message:"must NOT have additional properties"}],!1;d===a&&r.signature!==void 0&&(Ir(r.signature,{instancePath:e+"/signature",parentData:r,parentDataProperty:"signature",rootData:i,dynamicAnchors:o})||(s=s===null?Ir.errors:s.concat(Ir.errors),a=s.length))}else return Ii.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Ii.errors=s,a===0}Ii.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const Yte=Wn,sf={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-write-unidentified.json",type:"object",required:["descriptor"],properties:{recordId:{type:"string"},contextId:{type:"string",pattern:"^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"},attestation:{$ref:"https://identity.foundation/dwn/json-schemas/general-jws.json"},authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-owner.json"},encryption:{type:"object",properties:{algorithm:{type:"string",enum:["A256CTR"]},initializationVector:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},keyEncryption:{type:"array",minItems:1,items:{type:"object",properties:{rootKeyId:{type:"string"},derivationScheme:{type:"string",enum:["dataFormats","protocolContext","protocolPath","schemas"]},derivedPublicKey:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"},algorithm:{type:"string",enum:["ECIES-ES256K"]},encryptedKey:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},initializationVector:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},ephemeralPublicKey:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"},messageAuthenticationCode:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"}},additionalProperties:!1,required:["rootKeyId","derivationScheme","algorithm","encryptedKey","initializationVector","ephemeralPublicKey","messageAuthenticationCode"]}}},additionalProperties:!1,required:["algorithm","initializationVector","keyEncryption"]},descriptor:{type:"object",properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Write"],type:"string"},recipient:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},protocol:{type:"string"},protocolPath:{type:"string",pattern:"^[a-zA-Z]+(/[a-zA-Z]+)*$"},schema:{type:"string"},tags:{type:"object",minProperties:1,maxProperties:10,additionalProperties:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"array",minItems:1,maxItems:10,items:{type:"string"}},{type:"array",minItems:1,maxItems:10,items:{type:"number"}}]}},parentId:{type:"string"},dataCid:{type:"string"},dataSize:{type:"number"},dateCreated:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},published:{type:"boolean"},datePublished:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},dataFormat:{type:"string"}},additionalProperties:!1,required:["interface","method","dataCid","dataSize","dateCreated","messageTimestamp","dataFormat"],dependencies:{parentId:["protocol"]},allOf:[{$comment:"rule defining `published` and `datePublished` relationship",anyOf:[{properties:{published:{type:"boolean",enum:[!0]}},required:["published","datePublished"]},{properties:{published:{type:"boolean",enum:[!1]}},not:{required:["datePublished"]}},{allOf:[{not:{required:["published"]}},{not:{required:["datePublished"]}}]}]}]}},$comment:"rule defining `protocol` and `contextId` relationship",anyOf:[{properties:{descriptor:{type:"object",required:["protocol","protocolPath"]}},required:["contextId"]},{allOf:[{not:{required:["contextId"]}},{properties:{descriptor:{type:"object",not:{required:["protocol"]}}}},{properties:{descriptor:{type:"object",not:{required:["protocolPath"]}}}}]}]},Zte=new RegExp("^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$","u"),Yf=new RegExp("^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$","u"),Jte=new RegExp("^[a-zA-Z]+(/[a-zA-Z]+)*$","u"),ri=new RegExp("^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$","u"),ym={validate:Xa};function Dl(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Dl.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){const c=a;for(const u in r)if(!(u==="signature"||u==="authorDelegatedGrant"||u==="ownerSignature"||u==="ownerDelegatedGrant"))return Dl.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:u},message:"must NOT have additional properties"}],!1;if(c===a){let u;if(r.ownerSignature!==void 0&&r.signature===void 0&&(u="signature"))return Dl.errors=[{instancePath:e,schemaPath:"#/dependencies",keyword:"dependencies",params:{property:"ownerSignature",missingProperty:u,depsCount:1,deps:"signature"},message:"must have property signature when property ownerSignature is present"}],!1;if(r.signature!==void 0){const f=a;Ir(r.signature,{instancePath:e+"/signature",parentData:r,parentDataProperty:"signature",rootData:i,dynamicAnchors:o})||(s=s===null?Ir.errors:s.concat(Ir.errors),a=s.length);var d=f===a}else var d=!0;if(d){if(r.authorDelegatedGrant!==void 0){const f=a;ym.validate(r.authorDelegatedGrant,{instancePath:e+"/authorDelegatedGrant",parentData:r,parentDataProperty:"authorDelegatedGrant",rootData:i,dynamicAnchors:o})||(s=s===null?ym.validate.errors:s.concat(ym.validate.errors),a=s.length);var d=f===a}else var d=!0;if(d){if(r.ownerSignature!==void 0){const f=a;Ir(r.ownerSignature,{instancePath:e+"/ownerSignature",parentData:r,parentDataProperty:"ownerSignature",rootData:i,dynamicAnchors:o})||(s=s===null?Ir.errors:s.concat(Ir.errors),a=s.length);var d=f===a}else var d=!0;if(d)if(r.ownerDelegatedGrant!==void 0){const f=a;ym.validate(r.ownerDelegatedGrant,{instancePath:e+"/ownerDelegatedGrant",parentData:r,parentDataProperty:"ownerDelegatedGrant",rootData:i,dynamicAnchors:o})||(s=s===null?ym.validate.errors:s.concat(ym.validate.errors),a=s.length);var d=f===a}else var d=!0}}}}else return Dl.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Dl.errors=s,a===0}Dl.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const LK={$id:"https://identity.foundation/dwn/json-schemas/general-jwk.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",required:["kty"],properties:{alg:{type:"string"},kid:{type:"string"},kty:{enum:["EC","RSA","oct","OKP"]},crv:{type:"string"},use:{type:"string"},key_ops:{type:"string"},x5u:{type:"string"},x5c:{type:"string"},x5t:{type:"string"},"x5t#S256":{type:"string"}},oneOf:[{properties:{kty:{const:"EC"},crv:{type:"string"},x:{type:"string"},y:{type:"string"},d:{type:"string"}},required:["crv","x"]},{properties:{kty:{const:"OKP"},crv:{type:"string"},x:{type:"string"},d:{type:"string"}},required:["crv","x"]},{properties:{kty:{const:"RSA"},n:{type:"string"},e:{type:"string"},d:{type:"string"},p:{type:"string"},q:{type:"string"},dp:{type:"string"},dq:{type:"string"},qi:{type:"string"},oth:{type:"object"}},required:["n","e"]},{properties:{kty:{const:"oct"},k:{type:"string"}},required:["k"]}]};function Pr(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Pr.evaluated;l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0);const d=a,c=a;let u=!1,f=null;const h=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let ee;if(r.crv===void 0&&(ee="crv")||r.x===void 0&&(ee="x")){const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/required",keyword:"required",params:{missingProperty:ee},message:"must have required property '"+ee+"'"};s===null?s=[R]:s.push(R),a++}else{if(r.kty!==void 0){const R=a;if(r.kty!=="EC"){const z={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/kty/const",keyword:"const",params:{allowedValue:"EC"},message:"must be equal to constant"};s===null?s=[z]:s.push(z),a++}var p=R===a}else var p=!0;if(p){if(r.crv!==void 0){const R=a;if(typeof r.crv!="string"){const K={instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var p=R===a}else var p=!0;if(p){if(r.x!==void 0){const R=a;if(typeof r.x!="string"){const K={instancePath:e+"/x",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var p=R===a}else var p=!0;if(p){if(r.y!==void 0){const R=a;if(typeof r.y!="string"){const K={instancePath:e+"/y",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/y/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var p=R===a}else var p=!0;if(p)if(r.d!==void 0){const R=a;if(typeof r.d!="string"){const K={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var p=R===a}else var p=!0}}}}}var v=h===a;if(v){u=!0,f=0;var y={};y.kty=!0,y.crv=!0,y.x=!0,y.y=!0,y.d=!0}const g=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let ee;if(r.crv===void 0&&(ee="crv")||r.x===void 0&&(ee="x")){const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/required",keyword:"required",params:{missingProperty:ee},message:"must have required property '"+ee+"'"};s===null?s=[R]:s.push(R),a++}else{if(r.kty!==void 0){const R=a;if(r.kty!=="OKP"){const z={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/kty/const",keyword:"const",params:{allowedValue:"OKP"},message:"must be equal to constant"};s===null?s=[z]:s.push(z),a++}var w=R===a}else var w=!0;if(w){if(r.crv!==void 0){const R=a;if(typeof r.crv!="string"){const K={instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var w=R===a}else var w=!0;if(w){if(r.x!==void 0){const R=a;if(typeof r.x!="string"){const K={instancePath:e+"/x",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var w=R===a}else var w=!0;if(w)if(r.d!==void 0){const R=a;if(typeof r.d!="string"){const K={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[K]:s.push(K),a++}var w=R===a}else var w=!0}}}}var v=g===a;if(v&&u)u=!1,f=[f,1];else{v&&(u=!0,f=1,y!==!0&&(y=y||{},y.kty=!0,y.crv=!0,y.x=!0,y.d=!0));const ee=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let z;if(r.n===void 0&&(z="n")||r.e===void 0&&(z="e")){const K={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/required",keyword:"required",params:{missingProperty:z},message:"must have required property '"+z+"'"};s===null?s=[K]:s.push(K),a++}else{if(r.kty!==void 0){const K=a;if(r.kty!=="RSA"){const Y={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/kty/const",keyword:"const",params:{allowedValue:"RSA"},message:"must be equal to constant"};s===null?s=[Y]:s.push(Y),a++}var m=K===a}else var m=!0;if(m){if(r.n!==void 0){const K=a;if(typeof r.n!="string"){const I={instancePath:e+"/n",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/n/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.e!==void 0){const K=a;if(typeof r.e!="string"){const I={instancePath:e+"/e",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/e/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.d!==void 0){const K=a;if(typeof r.d!="string"){const I={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.p!==void 0){const K=a;if(typeof r.p!="string"){const I={instancePath:e+"/p",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/p/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.q!==void 0){const K=a;if(typeof r.q!="string"){const I={instancePath:e+"/q",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/q/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.dp!==void 0){const K=a;if(typeof r.dp!="string"){const I={instancePath:e+"/dp",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/dp/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.dq!==void 0){const K=a;if(typeof r.dq!="string"){const I={instancePath:e+"/dq",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/dq/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m){if(r.qi!==void 0){const K=a;if(typeof r.qi!="string"){const I={instancePath:e+"/qi",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/qi/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var m=K===a}else var m=!0;if(m)if(r.oth!==void 0){let K=r.oth;const Y=a;if(!(K&&typeof K=="object"&&!Array.isArray(K))){const D={instancePath:e+"/oth",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/oth/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[D]:s.push(D),a++}var m=Y===a}else var m=!0}}}}}}}}}}var v=ee===a;if(v&&u)u=!1,f=[f,2];else{v&&(u=!0,f=2,y!==!0&&(y=y||{},y.kty=!0,y.n=!0,y.e=!0,y.d=!0,y.p=!0,y.q=!0,y.dp=!0,y.dq=!0,y.qi=!0,y.oth=!0));const z=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let Y;if(r.k===void 0&&(Y="k")){const I={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/required",keyword:"required",params:{missingProperty:Y},message:"must have required property '"+Y+"'"};s===null?s=[I]:s.push(I),a++}else{if(r.kty!==void 0){const I=a;if(r.kty!=="oct"){const D={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/properties/kty/const",keyword:"const",params:{allowedValue:"oct"},message:"must be equal to constant"};s===null?s=[D]:s.push(D),a++}var b=I===a}else var b=!0;if(b)if(r.k!==void 0){const I=a;if(typeof r.k!="string"){const N={instancePath:e+"/k",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/properties/k/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[N]:s.push(N),a++}var b=I===a}else var b=!0}}var v=z===a;v&&u?(u=!1,f=[f,3]):v&&(u=!0,f=3,y!==!0&&(y=y||{},y.kty=!0,y.k=!0))}}if(u)a=c,s!==null&&(c?s.length=c:s=null);else{const ee={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf",keyword:"oneOf",params:{passingSchemas:f},message:"must match exactly one schema in oneOf"};return s===null?s=[ee]:s.push(ee),a++,Pr.errors=s,!1}if(a===d)if(r&&typeof r=="object"&&!Array.isArray(r)){let ee;if(r.kty===void 0&&(ee="kty"))return Pr.errors=[{instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/required",keyword:"required",params:{missingProperty:ee},message:"must have required property '"+ee+"'"}],!1;if(y!==!0&&(y=y||{},y.alg=!0,y.kid=!0,y.kty=!0,y.crv=!0,y.use=!0,y.key_ops=!0,y.x5u=!0,y.x5c=!0,y.x5t=!0,y["x5t#S256"]=!0),r.alg!==void 0){const R=a;if(typeof r.alg!="string")return Pr.errors=[{instancePath:e+"/alg",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/alg/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.kid!==void 0){const R=a;if(typeof r.kid!="string")return Pr.errors=[{instancePath:e+"/kid",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/kid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.kty!==void 0){let R=r.kty;const z=a;if(!(R==="EC"||R==="RSA"||R==="oct"||R==="OKP"))return Pr.errors=[{instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/kty/enum",keyword:"enum",params:{allowedValues:LK.properties.kty.enum},message:"must be equal to one of the allowed values"}],!1;var _=z===a}else var _=!0;if(_){if(r.crv!==void 0){const R=a;if(typeof r.crv!="string")return Pr.errors=[{instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.use!==void 0){const R=a;if(typeof r.use!="string")return Pr.errors=[{instancePath:e+"/use",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/use/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.key_ops!==void 0){const R=a;if(typeof r.key_ops!="string")return Pr.errors=[{instancePath:e+"/key_ops",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/key_ops/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.x5u!==void 0){const R=a;if(typeof r.x5u!="string")return Pr.errors=[{instancePath:e+"/x5u",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5u/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.x5c!==void 0){const R=a;if(typeof r.x5c!="string")return Pr.errors=[{instancePath:e+"/x5c",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5c/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_){if(r.x5t!==void 0){const R=a;if(typeof r.x5t!="string")return Pr.errors=[{instancePath:e+"/x5t",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5t/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0;if(_)if(r["x5t#S256"]!==void 0){const R=a;if(typeof r["x5t#S256"]!="string")return Pr.errors=[{instancePath:e+"/x5t#S256",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5t%23S256/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var _=R===a}else var _=!0}}}}}}}}}else return Pr.errors=[{instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var E=d===a;if(E){const ee=a,R=a,z=a;let K=!1;const Y=a,I=a;let D=!1;const N=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.d===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var S=N===a;if(D=D||S,D)a=I,s!==null&&(I?s.length=I:s=null);else{const ne={};s===null?s=[ne]:s.push(ne),a++}if(a===Y)if(r&&typeof r=="object"&&!Array.isArray(r)){if(r.kty!==void 0&&r.kty!=="EC"){const ne={};s===null?s=[ne]:s.push(ne),a++}}else{const ne={};s===null?s=[ne]:s.push(ne),a++}var W=Y===a;if(K=K||W,W){var T={};T.kty=!0}const V=a,J=a;let j=!1;const G=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.d===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var O=G===a;if(j=j||O,j)a=J,s!==null&&(J?s.length=J:s=null);else{const ne={};s===null?s=[ne]:s.push(ne),a++}if(a===V)if(r&&typeof r=="object"&&!Array.isArray(r)){if(r.kty!==void 0&&r.kty!=="OKP"){const ne={};s===null?s=[ne]:s.push(ne),a++}}else{const ne={};s===null?s=[ne]:s.push(ne),a++}var W=V===a;K=K||W,W&&T!==!0&&(T=T||{},T.kty=!0);const C=a,F=a;let Z=!1;const te=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.d===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=te===a;Z=Z||M;const re=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.p===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=re===a;Z=Z||M;const q=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.q===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=q===a;Z=Z||M;const L=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.dp===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=L===a;Z=Z||M;const k=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.dq===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=k===a;Z=Z||M;const B=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.qi===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=B===a;Z=Z||M;const X=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.oth===void 0){const ne={};s===null?s=[ne]:s.push(ne),a++}var M=X===a;if(Z=Z||M,Z)a=F,s!==null&&(F?s.length=F:s=null);else{const ne={};s===null?s=[ne]:s.push(ne),a++}if(a===C)if(r&&typeof r=="object"&&!Array.isArray(r)){if(r.kty!==void 0){const ne=a;if(r.kty!=="RSA"){const ae={};s===null?s=[ae]:s.push(ae),a++}var Q=ne===a}else var Q=!0;if(Q)if(r.oth!==void 0){let ne=r.oth;const ae=a;if(!(ne&&typeof ne=="object"&&!Array.isArray(ne))){const _e={};s===null?s=[_e]:s.push(_e),a++}var Q=ae===a}else var Q=!0}else{const ne={};s===null?s=[ne]:s.push(ne),a++}var W=C===a;if(K=K||W,W&&T!==!0&&(T=T||{},T.kty=!0,T.d=!0,T.p=!0,T.q=!0,T.dp=!0,T.dq=!0,T.qi=!0,T.oth=!0),K)a=z,s!==null&&(z?s.length=z:s=null);else{const ne={};s===null?s=[ne]:s.push(ne),a++}var U=R===a;if(U)return Pr.errors=[{instancePath:e,schemaPath:"#/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=ee,s!==null&&(ee?s.length=ee:s=null)}return Pr.errors=s,l.props=y,a===0}Pr.evaluated={dynamicProps:!0,dynamicItems:!1};const KK=Object.prototype.hasOwnProperty;function qe(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=qe.evaluated;l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0);const d=a;let c=!1;const u=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let N;if(r.contextId===void 0&&(N="contextId")){const V={instancePath:e,schemaPath:"#/anyOf/0/required",keyword:"required",params:{missingProperty:N},message:"must have required property '"+N+"'"};s===null?s=[V]:s.push(V),a++}else if(r.descriptor!==void 0){let V=r.descriptor;if(a===a)if(V&&typeof V=="object"&&!Array.isArray(V)){let j;if(V.protocol===void 0&&(j="protocol")||V.protocolPath===void 0&&(j="protocolPath")){const G={instancePath:e+"/descriptor",schemaPath:"#/anyOf/0/properties/descriptor/required",keyword:"required",params:{missingProperty:j},message:"must have required property '"+j+"'"};s===null?s=[G]:s.push(G),a++}}else{const j={instancePath:e+"/descriptor",schemaPath:"#/anyOf/0/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[j]:s.push(j),a++}}}var _=u===a;if(c=c||_,_){var f={};f.descriptor=!0}const h=a,p=a,y=a,g=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.contextId===void 0){const N={};s===null?s=[N]:s.push(N),a++}var w=g===a;if(w){const N={instancePath:e,schemaPath:"#/anyOf/1/allOf/0/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[N]:s.push(N),a++}else a=y,s!==null&&(y?s.length=y:s=null);var v=p===a;if(v){const N=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.descriptor!==void 0){let J=r.descriptor;if(!(J&&typeof J=="object"&&!Array.isArray(J))){const C={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/1/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[C]:s.push(C),a++}const j=a,G=a;if(J&&typeof J=="object"&&!Array.isArray(J)&&J.protocol===void 0){const C={};s===null?s=[C]:s.push(C),a++}var m=G===a;if(m){const C={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/1/properties/descriptor/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[C]:s.push(C),a++}else a=j,s!==null&&(j?s.length=j:s=null)}var v=N===a;if(v){const J=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.descriptor!==void 0){let G=r.descriptor;if(!(G&&typeof G=="object"&&!Array.isArray(G))){const Z={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/2/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[Z]:s.push(Z),a++}const C=a,F=a;if(G&&typeof G=="object"&&!Array.isArray(G)&&G.protocolPath===void 0){const Z={};s===null?s=[Z]:s.push(Z),a++}var b=F===a;if(b){const Z={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/2/properties/descriptor/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[Z]:s.push(Z),a++}else a=C,s!==null&&(C?s.length=C:s=null)}var v=J===a}}var _=h===a;if(c=c||_,_&&f!==!0&&(f=f||{},f.descriptor=!0),c)a=d,s!==null&&(d?s.length=d:s=null);else{const N={instancePath:e,schemaPath:"#/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return s===null?s=[N]:s.push(N),a++,qe.errors=s,!1}if(a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let N;if(r.descriptor===void 0&&(N="descriptor"))return qe.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:N},message:"must have required property '"+N+"'"}],!1;if(f!==!0&&(f=f||{},f.recordId=!0,f.contextId=!0,f.attestation=!0,f.authorization=!0,f.encryption=!0,f.descriptor=!0),r.recordId!==void 0){const V=a;if(typeof r.recordId!="string")return qe.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var E=V===a}else var E=!0;if(E){if(r.contextId!==void 0){let V=r.contextId;const J=a;if(a===J)if(typeof V=="string"){if(!Zte.test(V))return qe.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/pattern",keyword:"pattern",params:{pattern:"^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"},message:'must match pattern "^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"'}],!1}else return qe.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var E=J===a}else var E=!0;if(E){if(r.attestation!==void 0){const V=a;Ir(r.attestation,{instancePath:e+"/attestation",parentData:r,parentDataProperty:"attestation",rootData:i,dynamicAnchors:o})||(s=s===null?Ir.errors:s.concat(Ir.errors),a=s.length);var E=V===a}else var E=!0;if(E){if(r.authorization!==void 0){const V=a;Dl(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Dl.errors:s.concat(Dl.errors),a=s.length);var E=V===a}else var E=!0;if(E){if(r.encryption!==void 0){let V=r.encryption;const J=a;if(a===J)if(V&&typeof V=="object"&&!Array.isArray(V)){let G;if(V.algorithm===void 0&&(G="algorithm")||V.initializationVector===void 0&&(G="initializationVector")||V.keyEncryption===void 0&&(G="keyEncryption"))return qe.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/required",keyword:"required",params:{missingProperty:G},message:"must have required property '"+G+"'"}],!1;{const C=a;for(const F in V)if(!(F==="algorithm"||F==="initializationVector"||F==="keyEncryption"))return qe.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:F},message:"must NOT have additional properties"}],!1;if(C===a){if(V.algorithm!==void 0){let F=V.algorithm;const Z=a;if(typeof F!="string")return qe.errors=[{instancePath:e+"/encryption/algorithm",schemaPath:"#/properties/encryption/properties/algorithm/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(F!=="A256CTR")return qe.errors=[{instancePath:e+"/encryption/algorithm",schemaPath:"#/properties/encryption/properties/algorithm/enum",keyword:"enum",params:{allowedValues:sf.properties.encryption.properties.algorithm.enum},message:"must be equal to one of the allowed values"}],!1;var S=Z===a}else var S=!0;if(S){if(V.initializationVector!==void 0){let F=V.initializationVector;const Z=a;if(a===a)if(typeof F=="string"){if(!qp.test(F))return qe.errors=[{instancePath:e+"/encryption/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return qe.errors=[{instancePath:e+"/encryption/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var S=Z===a}else var S=!0;if(S)if(V.keyEncryption!==void 0){let F=V.keyEncryption;const Z=a;if(a===Z)if(Array.isArray(F)){if(F.length<1)return qe.errors=[{instancePath:e+"/encryption/keyEncryption",schemaPath:"#/properties/encryption/properties/keyEncryption/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var T=!0;const re=F.length;for(let q=0;q<re;q++){let L=F[q];const k=a;if(a===k)if(L&&typeof L=="object"&&!Array.isArray(L)){let X;if(L.rootKeyId===void 0&&(X="rootKeyId")||L.derivationScheme===void 0&&(X="derivationScheme")||L.algorithm===void 0&&(X="algorithm")||L.encryptedKey===void 0&&(X="encryptedKey")||L.initializationVector===void 0&&(X="initializationVector")||L.ephemeralPublicKey===void 0&&(X="ephemeralPublicKey")||L.messageAuthenticationCode===void 0&&(X="messageAuthenticationCode"))return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q,schemaPath:"#/properties/encryption/properties/keyEncryption/items/required",keyword:"required",params:{missingProperty:X},message:"must have required property '"+X+"'"}],!1;{const ne=a;for(const ae in L)if(!(ae==="rootKeyId"||ae==="derivationScheme"||ae==="derivedPublicKey"||ae==="algorithm"||ae==="encryptedKey"||ae==="initializationVector"||ae==="ephemeralPublicKey"||ae==="messageAuthenticationCode"))return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q,schemaPath:"#/properties/encryption/properties/keyEncryption/items/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ae},message:"must NOT have additional properties"}],!1;if(ne===a){if(L.rootKeyId!==void 0){const ae=a;if(typeof L.rootKeyId!="string")return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/rootKeyId",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/rootKeyId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var O=ae===a}else var O=!0;if(O){if(L.derivationScheme!==void 0){let ae=L.derivationScheme;const ye=a;if(typeof ae!="string")return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/derivationScheme",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/derivationScheme/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(ae==="dataFormats"||ae==="protocolContext"||ae==="protocolPath"||ae==="schemas"))return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/derivationScheme",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/derivationScheme/enum",keyword:"enum",params:{allowedValues:sf.properties.encryption.properties.keyEncryption.items.properties.derivationScheme.enum},message:"must be equal to one of the allowed values"}],!1;var O=ye===a}else var O=!0;if(O){if(L.derivedPublicKey!==void 0){const ae=a;Pr(L.derivedPublicKey,{instancePath:e+"/encryption/keyEncryption/"+q+"/derivedPublicKey",parentData:L,parentDataProperty:"derivedPublicKey",rootData:i,dynamicAnchors:o})||(s=s===null?Pr.errors:s.concat(Pr.errors),a=s.length);var O=ae===a}else var O=!0;if(O){if(L.algorithm!==void 0){let ae=L.algorithm;const ye=a;if(typeof ae!="string")return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/algorithm",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/algorithm/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(ae!=="ECIES-ES256K")return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/algorithm",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/algorithm/enum",keyword:"enum",params:{allowedValues:sf.properties.encryption.properties.keyEncryption.items.properties.algorithm.enum},message:"must be equal to one of the allowed values"}],!1;var O=ye===a}else var O=!0;if(O){if(L.encryptedKey!==void 0){let ae=L.encryptedKey;const ye=a;if(a===a)if(typeof ae=="string"){if(!qp.test(ae))return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/encryptedKey",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/encryptedKey",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var O=ye===a}else var O=!0;if(O){if(L.initializationVector!==void 0){let ae=L.initializationVector;const ye=a;if(a===a)if(typeof ae=="string"){if(!qp.test(ae))return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var O=ye===a}else var O=!0;if(O){if(L.ephemeralPublicKey!==void 0){const ae=a;Pr(L.ephemeralPublicKey,{instancePath:e+"/encryption/keyEncryption/"+q+"/ephemeralPublicKey",parentData:L,parentDataProperty:"ephemeralPublicKey",rootData:i,dynamicAnchors:o})||(s=s===null?Pr.errors:s.concat(Pr.errors),a=s.length);var O=ae===a}else var O=!0;if(O)if(L.messageAuthenticationCode!==void 0){let ae=L.messageAuthenticationCode;const ye=a;if(a===a)if(typeof ae=="string"){if(!qp.test(ae))return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/messageAuthenticationCode",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q+"/messageAuthenticationCode",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var O=ye===a}else var O=!0}}}}}}}}}else return qe.errors=[{instancePath:e+"/encryption/keyEncryption/"+q,schemaPath:"#/properties/encryption/properties/keyEncryption/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var T=k===a;if(!T)break}}}else return qe.errors=[{instancePath:e+"/encryption/keyEncryption",schemaPath:"#/properties/encryption/properties/keyEncryption/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var S=Z===a}else var S=!0}}}}else return qe.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var E=J===a}else var E=!0;if(E)if(r.descriptor!==void 0){let V=r.descriptor;const J=a,j=a;let G=!1;const C=a;if(V&&typeof V=="object"&&!Array.isArray(V)){let X;if(V.published===void 0&&(X="published")||V.datePublished===void 0&&(X="datePublished")){const ne={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/required",keyword:"required",params:{missingProperty:X},message:"must have required property '"+X+"'"};s===null?s=[ne]:s.push(ne),a++}else if(V.published!==void 0){let ne=V.published;if(typeof ne!="boolean"){const ae={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};s===null?s=[ae]:s.push(ae),a++}if(ne!==!0){const ae={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/properties/published/enum",keyword:"enum",params:{allowedValues:sf.properties.descriptor.allOf[0].anyOf[0].properties.published.enum},message:"must be equal to one of the allowed values"};s===null?s=[ae]:s.push(ae),a++}}}var R=C===a;if(G=G||R,R){var M={};M.published=!0}const F=a,Z=a,te=a;if(V&&typeof V=="object"&&!Array.isArray(V)&&V.datePublished===void 0){const X={};s===null?s=[X]:s.push(X),a++}var Q=te===a;if(Q){const X={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[X]:s.push(X),a++}else a=Z,s!==null&&(Z?s.length=Z:s=null);if(a===F&&V&&typeof V=="object"&&!Array.isArray(V)&&V.published!==void 0){let X=V.published;if(typeof X!="boolean"){const ne={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};s===null?s=[ne]:s.push(ne),a++}if(X!==!1){const ne={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/properties/published/enum",keyword:"enum",params:{allowedValues:sf.properties.descriptor.allOf[0].anyOf[1].properties.published.enum},message:"must be equal to one of the allowed values"};s===null?s=[ne]:s.push(ne),a++}}var R=F===a;G=G||R,R&&M!==!0&&(M=M||{},M.published=!0);const re=a,q=a,L=a,k=a;if(V&&typeof V=="object"&&!Array.isArray(V)&&V.published===void 0){const X={};s===null?s=[X]:s.push(X),a++}var W=k===a;if(W){const X={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/2/allOf/0/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[X]:s.push(X),a++}else a=L,s!==null&&(L?s.length=L:s=null);var U=q===a;if(U){const X=a,ne=a,ae=a;if(V&&typeof V=="object"&&!Array.isArray(V)&&V.datePublished===void 0){const _e={};s===null?s=[_e]:s.push(_e),a++}var ee=ae===a;if(ee){const _e={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/2/allOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[_e]:s.push(_e),a++}else a=ne,s!==null&&(ne?s.length=ne:s=null);var U=X===a}var R=re===a;if(G=G||R,G)a=j,s!==null&&(j?s.length=j:s=null);else{const X={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return s===null?s=[X]:s.push(X),a++,qe.errors=s,!1}if(a===J)if(V&&typeof V=="object"&&!Array.isArray(V)){let X;if(V.interface===void 0&&(X="interface")||V.method===void 0&&(X="method")||V.dataCid===void 0&&(X="dataCid")||V.dataSize===void 0&&(X="dataSize")||V.dateCreated===void 0&&(X="dateCreated")||V.messageTimestamp===void 0&&(X="messageTimestamp")||V.dataFormat===void 0&&(X="dataFormat"))return qe.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:X},message:"must have required property '"+X+"'"}],!1;{const ne=a;for(const ae in V)if(!KK.call(sf.properties.descriptor.properties,ae))return qe.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ae},message:"must NOT have additional properties"}],!1;if(ne===a){let ae;if(V.parentId!==void 0&&V.protocol===void 0&&(ae="protocol"))return qe.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/dependencies",keyword:"dependencies",params:{property:"parentId",missingProperty:ae,depsCount:1,deps:"protocol"},message:"must have property protocol when property parentId is present"}],!1;if(V.interface!==void 0){let ye=V.interface;const _e=a;if(typeof ye!="string")return qe.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(ye!=="Records")return qe.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:sf.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var z=_e===a}else var z=!0;if(z){if(V.method!==void 0){let ye=V.method;const _e=a;if(typeof ye!="string")return qe.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(ye!=="Write")return qe.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:sf.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var z=_e===a}else var z=!0;if(z){if(V.recipient!==void 0){let ye=V.recipient;const _e=a;if(a===a)if(typeof ye=="string"){if(!Yf.test(ye))return qe.errors=[{instancePath:e+"/descriptor/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return qe.errors=[{instancePath:e+"/descriptor/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=_e===a}else var z=!0;if(z){if(V.protocol!==void 0){const ye=a;if(typeof V.protocol!="string")return qe.errors=[{instancePath:e+"/descriptor/protocol",schemaPath:"#/properties/descriptor/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=ye===a}else var z=!0;if(z){if(V.protocolPath!==void 0){let ye=V.protocolPath;const _e=a;if(a===_e)if(typeof ye=="string"){if(!Jte.test(ye))return qe.errors=[{instancePath:e+"/descriptor/protocolPath",schemaPath:"#/properties/descriptor/properties/protocolPath/pattern",keyword:"pattern",params:{pattern:"^[a-zA-Z]+(/[a-zA-Z]+)*$"},message:'must match pattern "^[a-zA-Z]+(/[a-zA-Z]+)*$"'}],!1}else return qe.errors=[{instancePath:e+"/descriptor/protocolPath",schemaPath:"#/properties/descriptor/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=_e===a}else var z=!0;if(z){if(V.schema!==void 0){const ye=a;if(typeof V.schema!="string")return qe.errors=[{instancePath:e+"/descriptor/schema",schemaPath:"#/properties/descriptor/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=ye===a}else var z=!0;if(z){if(V.tags!==void 0){let ye=V.tags;const _e=a;if(a===_e)if(ye&&typeof ye=="object"&&!Array.isArray(ye)){if(Object.keys(ye).length>10)return qe.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/maxProperties",keyword:"maxProperties",params:{limit:10},message:"must NOT have more than 10 properties"}],!1;if(Object.keys(ye).length<1)return qe.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const Ce in ye){let Te=ye[Ce];const ze=a,ht=a;let ie=!1,ce=null;const H=a;if(typeof Te!="string"){const P={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[P]:s.push(P),a++}var K=H===a;K&&(ie=!0,ce=0);const $=a;if(!(typeof Te=="number"&&isFinite(Te))){const P={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/1/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[P]:s.push(P),a++}var K=$===a;if(K&&ie)ie=!1,ce=[ce,1];else{K&&(ie=!0,ce=1);const P=a;if(typeof Te!="boolean"){const fe={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};s===null?s=[fe]:s.push(fe),a++}var K=P===a;if(K&&ie)ie=!1,ce=[ce,2];else{K&&(ie=!0,ce=2);const fe=a;if(a===fe)if(Array.isArray(Te))if(Te.length>10){const Ee={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/maxItems",keyword:"maxItems",params:{limit:10},message:"must NOT have more than 10 items"};s===null?s=[Ee]:s.push(Ee),a++}else if(Te.length<1){const Ee={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};s===null?s=[Ee]:s.push(Ee),a++}else{var Y=!0;const Ee=Te.length;for(let pt=0;pt<Ee;pt++){const Ft=a;if(typeof Te[pt]!="string"){const Mt={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+pt,schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/items/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Mt]:s.push(Mt),a++}var Y=Ft===a;if(!Y)break}}else{const Ee={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/type",keyword:"type",params:{type:"array"},message:"must be array"};s===null?s=[Ee]:s.push(Ee),a++}var K=fe===a;if(K&&ie)ie=!1,ce=[ce,3];else{K&&(ie=!0,ce=3);const Ee=a;if(a===Ee)if(Array.isArray(Te))if(Te.length>10){const Ft={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/maxItems",keyword:"maxItems",params:{limit:10},message:"must NOT have more than 10 items"};s===null?s=[Ft]:s.push(Ft),a++}else if(Te.length<1){const Ft={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};s===null?s=[Ft]:s.push(Ft),a++}else{var I=!0;const Ft=Te.length;for(let ir=0;ir<Ft;ir++){let Mt=Te[ir];const Jt=a;if(!(typeof Mt=="number"&&isFinite(Mt))){const nl={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+ir,schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/items/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[nl]:s.push(nl),a++}var I=Jt===a;if(!I)break}}else{const Ft={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/type",keyword:"type",params:{type:"array"},message:"must be array"};s===null?s=[Ft]:s.push(Ft),a++}var K=Ee===a;K&&ie?(ie=!1,ce=[ce,4]):K&&(ie=!0,ce=4)}}}if(ie)a=ht,s!==null&&(ht?s.length=ht:s=null);else{const P={instancePath:e+"/descriptor/tags/"+Ce.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf",keyword:"oneOf",params:{passingSchemas:ce},message:"must match exactly one schema in oneOf"};return s===null?s=[P]:s.push(P),a++,qe.errors=s,!1}var D=ze===a;if(!D)break}}else return qe.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var z=_e===a}else var z=!0;if(z){if(V.parentId!==void 0){const ye=a;if(typeof V.parentId!="string")return qe.errors=[{instancePath:e+"/descriptor/parentId",schemaPath:"#/properties/descriptor/properties/parentId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=ye===a}else var z=!0;if(z){if(V.dataCid!==void 0){const ye=a;if(typeof V.dataCid!="string")return qe.errors=[{instancePath:e+"/descriptor/dataCid",schemaPath:"#/properties/descriptor/properties/dataCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=ye===a}else var z=!0;if(z){if(V.dataSize!==void 0){let ye=V.dataSize;const _e=a;if(!(typeof ye=="number"&&isFinite(ye)))return qe.errors=[{instancePath:e+"/descriptor/dataSize",schemaPath:"#/properties/descriptor/properties/dataSize/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var z=_e===a}else var z=!0;if(z){if(V.dateCreated!==void 0){let ye=V.dateCreated;const _e=a;if(a===a)if(typeof ye=="string"){if(!ri.test(ye))return qe.errors=[{instancePath:e+"/descriptor/dateCreated",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return qe.errors=[{instancePath:e+"/descriptor/dateCreated",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=_e===a}else var z=!0;if(z){if(V.messageTimestamp!==void 0){let ye=V.messageTimestamp;const _e=a;if(a===a)if(typeof ye=="string"){if(!ri.test(ye))return qe.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return qe.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=_e===a}else var z=!0;if(z){if(V.published!==void 0){const ye=a;if(typeof V.published!="boolean")return qe.errors=[{instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var z=ye===a}else var z=!0;if(z){if(V.datePublished!==void 0){let ye=V.datePublished;const _e=a;if(a===a)if(typeof ye=="string"){if(!ri.test(ye))return qe.errors=[{instancePath:e+"/descriptor/datePublished",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return qe.errors=[{instancePath:e+"/descriptor/datePublished",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=_e===a}else var z=!0;if(z)if(V.dataFormat!==void 0){const ye=a;if(typeof V.dataFormat!="string")return qe.errors=[{instancePath:e+"/descriptor/dataFormat",schemaPath:"#/properties/descriptor/properties/dataFormat/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var z=ye===a}else var z=!0}}}}}}}}}}}}}}}}else return qe.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var E=J===a}else var E=!0}}}}}else return qe.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return qe.errors=s,l.props=f,a===0}qe.evaluated={dynamicProps:!0,dynamicItems:!1};function Xa(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Xa.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),!qe(r,{instancePath:e,parentData:t,parentDataProperty:n,rootData:i,dynamicAnchors:o}))s=s===null?qe.errors:s.concat(qe.errors),a=s.length;else var d=qe.evaluated.props;if(a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let u;if(r.recordId===void 0&&(u="recordId")||r.authorization===void 0&&(u="authorization")||r.encodedData===void 0&&(u="encodedData"))return Xa.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:u},message:"must have required property '"+u+"'"}],!1;if(d!==!0&&(d=d||{},d.encodedData=!0),r.encodedData!==void 0){const f=a;if(typeof r.encodedData!="string")return Xa.errors=[{instancePath:e+"/encodedData",schemaPath:"#/properties/encodedData/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=f===a}else var c=!0;if(c&&d!==!0){for(const f in r)if(!d||!d[f])return Xa.errors=[{instancePath:e,schemaPath:"#/unevaluatedProperties",keyword:"unevaluatedProperties",params:{unevaluatedProperty:f},message:"must NOT have unevaluated properties"}],!1}}else return Xa.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Xa.errors=s,a===0}Xa.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function Wn(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Wn.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){const c=a;for(const u in r)if(!(u==="signature"||u==="authorDelegatedGrant"))return Wn.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:u},message:"must NOT have additional properties"}],!1;if(c===a){if(r.signature!==void 0){const u=a;Ir(r.signature,{instancePath:e+"/signature",parentData:r,parentDataProperty:"signature",rootData:i,dynamicAnchors:o})||(s=s===null?Ir.errors:s.concat(Ir.errors),a=s.length);var d=u===a}else var d=!0;if(d)if(r.authorDelegatedGrant!==void 0){const u=a;Xa(r.authorDelegatedGrant,{instancePath:e+"/authorDelegatedGrant",parentData:r,parentDataProperty:"authorDelegatedGrant",rootData:i,dynamicAnchors:o})||(s=s===null?Xa.errors:s.concat(Xa.errors),a=s.length);var d=u===a}else var d=!0}}else return Wn.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Wn.errors=s,a===0}Wn.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const Xte=Dl,Qte=mi,W3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-delete.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","recordId","prune"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Delete"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},recordId:{type:"string"},prune:{type:"boolean"}}}}};function mi(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=mi.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let u;if(r.authorization===void 0&&(u="authorization")||r.descriptor===void 0&&(u="descriptor"))return mi.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:u},message:"must have required property '"+u+"'"}],!1;{const f=a;for(const h in r)if(!(h==="authorization"||h==="descriptor"))return mi.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:h},message:"must NOT have additional properties"}],!1;if(f===a){if(r.authorization!==void 0){const h=a;Wn(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Wn.errors:s.concat(Wn.errors),a=s.length);var d=h===a}else var d=!0;if(d)if(r.descriptor!==void 0){let h=r.descriptor;const p=a;if(a===p)if(h&&typeof h=="object"&&!Array.isArray(h)){let g;if(h.interface===void 0&&(g="interface")||h.method===void 0&&(g="method")||h.messageTimestamp===void 0&&(g="messageTimestamp")||h.recordId===void 0&&(g="recordId")||h.prune===void 0&&(g="prune"))return mi.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"}],!1;{const w=a;for(const v in h)if(!(v==="interface"||v==="method"||v==="messageTimestamp"||v==="recordId"||v==="prune"))return mi.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:v},message:"must NOT have additional properties"}],!1;if(w===a){if(h.interface!==void 0){let v=h.interface;const m=a;if(typeof v!="string")return mi.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Records")return mi.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:W3.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.method!==void 0){let v=h.method;const m=a;if(typeof v!="string")return mi.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Delete")return mi.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:W3.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.messageTimestamp!==void 0){let v=h.messageTimestamp;const m=a;if(a===a)if(typeof v=="string"){if(!ri.test(v))return mi.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return mi.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=m===a}else var c=!0;if(c){if(h.recordId!==void 0){const v=a;if(typeof h.recordId!="string")return mi.errors=[{instancePath:e+"/descriptor/recordId",schemaPath:"#/properties/descriptor/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=v===a}else var c=!0;if(c)if(h.prune!==void 0){const v=a;if(typeof h.prune!="boolean")return mi.errors=[{instancePath:e+"/descriptor/prune",schemaPath:"#/properties/descriptor/properties/prune/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var c=v===a}else var c=!0}}}}}}else return mi.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=p===a}else var d=!0}}}else return mi.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return mi.errors=s,a===0}mi.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const ere=Ur,$T={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-query.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"},pagination:{type:"object",additionalProperties:!1,properties:{limit:{type:"number",minimum:1},cursor:{$ref:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json"}}},dateSort:{enum:["createdAscending","createdDescending","publishedAscending","publishedDescending"],type:"string"}}}}},PO={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json",type:"object",minProperties:1,additionalProperties:!1,required:["messageCid","value"],properties:{messageCid:{type:"string"},value:{type:["string","number"]}}},H3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-filter.json",type:"object",minProperties:1,additionalProperties:!1,properties:{protocol:{type:"string"},protocolPath:{type:"string"},author:{oneOf:[{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}]},attester:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},recipient:{oneOf:[{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}]},contextId:{type:"string"},schema:{type:"string"},tags:{type:"object",minProperties:1,additionalProperties:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"object",minProperties:1,additionalProperties:!1,properties:{startsWith:{type:"string"}}},{$ref:"https://identity.foundation/dwn/json-schemas/string-range-filter.json"},{$ref:"https://identity.foundation/dwn/json-schemas/number-range-filter.json"}]}},recordId:{type:"string"},parentId:{type:"string"},published:{type:"boolean"},dataFormat:{type:"string"},dataSize:{$ref:"https://identity.foundation/dwn/json-schemas/number-range-filter.json"},dataCid:{type:"string"},dateCreated:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}},datePublished:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}},dateUpdated:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}}},dependencies:{datePublished:{oneOf:[{properties:{published:{enum:[!0]}},required:["published"]},{not:{required:["published"]}}]}}};function He(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=He.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){if(Object.keys(r).length<1)return He.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const G=a;for(const C in r)if(!KK.call(H3.properties,C))return He.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:C},message:"must NOT have additional properties"}],!1;if(G===a){if(r.datePublished!==void 0){const C=a,F=a;let Z=!1,te=null;const re=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let B;if(r.published===void 0&&(B="published")){const X={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf/0/required",keyword:"required",params:{missingProperty:B},message:"must have required property '"+B+"'"};s===null?s=[X]:s.push(X),a++}else if(r.published!==void 0&&r.published!==!0){const X={instancePath:e+"/published",schemaPath:"#/dependencies/datePublished/oneOf/0/properties/published/enum",keyword:"enum",params:{allowedValues:H3.dependencies.datePublished.oneOf[0].properties.published.enum},message:"must be equal to one of the allowed values"};s===null?s=[X]:s.push(X),a++}}var u=re===a;if(u){Z=!0,te=0;var d={};d.published=!0}const q=a,L=a,k=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.published===void 0){const B={};s===null?s=[B]:s.push(B),a++}var c=k===a;if(c){const B={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[B]:s.push(B),a++}else a=L,s!==null&&(L?s.length=L:s=null);var u=q===a;if(u&&Z?(Z=!1,te=[te,1]):u&&(Z=!0,te=1),Z)a=F,s!==null&&(F?s.length=F:s=null);else{const B={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf",keyword:"oneOf",params:{passingSchemas:te},message:"must match exactly one schema in oneOf"};return s===null?s=[B]:s.push(B),a++,He.errors=s,!1}var f=C===a}else var f=!0;if(f){if(r.protocol!==void 0){const C=a;if(typeof r.protocol!="string")return He.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.protocolPath!==void 0){const C=a;if(typeof r.protocolPath!="string")return He.errors=[{instancePath:e+"/protocolPath",schemaPath:"#/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.author!==void 0){let C=r.author;const F=a,Z=a;let te=!1,re=null;const q=a;if(a===a)if(typeof C=="string"){if(!Yf.test(C)){const X={instancePath:e+"/author",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};s===null?s=[X]:s.push(X),a++}}else{const X={instancePath:e+"/author",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[X]:s.push(X),a++}var y=q===a;y&&(te=!0,re=0);const k=a;if(a===k)if(Array.isArray(C)){var p=!0;const X=C.length;for(let ne=0;ne<X;ne++){let ae=C[ne];const ye=a;if(a===a)if(typeof ae=="string"){if(!Yf.test(ae)){const Ce={instancePath:e+"/author/"+ne,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};s===null?s=[Ce]:s.push(Ce),a++}}else{const Ce={instancePath:e+"/author/"+ne,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Ce]:s.push(Ce),a++}var p=ye===a;if(!p)break}}else{const X={instancePath:e+"/author",schemaPath:"#/properties/author/oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};s===null?s=[X]:s.push(X),a++}var y=k===a;if(y&&te?(te=!1,re=[re,1]):y&&(te=!0,re=1),te)a=Z,s!==null&&(Z?s.length=Z:s=null);else{const X={instancePath:e+"/author",schemaPath:"#/properties/author/oneOf",keyword:"oneOf",params:{passingSchemas:re},message:"must match exactly one schema in oneOf"};return s===null?s=[X]:s.push(X),a++,He.errors=s,!1}var h=F===a}else var h=!0;if(h){if(r.attester!==void 0){let C=r.attester;const F=a;if(a===a)if(typeof C=="string"){if(!Yf.test(C))return He.errors=[{instancePath:e+"/attester",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return He.errors=[{instancePath:e+"/attester",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=F===a}else var h=!0;if(h){if(r.recipient!==void 0){let C=r.recipient;const F=a,Z=a;let te=!1,re=null;const q=a;if(a===a)if(typeof C=="string"){if(!Yf.test(C)){const X={instancePath:e+"/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};s===null?s=[X]:s.push(X),a++}}else{const X={instancePath:e+"/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[X]:s.push(X),a++}var w=q===a;w&&(te=!0,re=0);const k=a;if(a===k)if(Array.isArray(C)){var g=!0;const X=C.length;for(let ne=0;ne<X;ne++){let ae=C[ne];const ye=a;if(a===a)if(typeof ae=="string"){if(!Yf.test(ae)){const Ce={instancePath:e+"/recipient/"+ne,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};s===null?s=[Ce]:s.push(Ce),a++}}else{const Ce={instancePath:e+"/recipient/"+ne,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Ce]:s.push(Ce),a++}var g=ye===a;if(!g)break}}else{const X={instancePath:e+"/recipient",schemaPath:"#/properties/recipient/oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};s===null?s=[X]:s.push(X),a++}var w=k===a;if(w&&te?(te=!1,re=[re,1]):w&&(te=!0,re=1),te)a=Z,s!==null&&(Z?s.length=Z:s=null);else{const X={instancePath:e+"/recipient",schemaPath:"#/properties/recipient/oneOf",keyword:"oneOf",params:{passingSchemas:re},message:"must match exactly one schema in oneOf"};return s===null?s=[X]:s.push(X),a++,He.errors=s,!1}var h=F===a}else var h=!0;if(h){if(r.contextId!==void 0){const C=a;if(typeof r.contextId!="string")return He.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.schema!==void 0){const C=a;if(typeof r.schema!="string")return He.errors=[{instancePath:e+"/schema",schemaPath:"#/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.tags!==void 0){let C=r.tags;const F=a;if(a===F)if(C&&typeof C=="object"&&!Array.isArray(C)){if(Object.keys(C).length<1)return He.errors=[{instancePath:e+"/tags",schemaPath:"#/properties/tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const te in C){let re=C[te];const q=a,L=a;let k=!1,B=null;const X=a;if(typeof re!="string"){const ae={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var v=X===a;v&&(k=!0,B=0);const ne=a;if(!(typeof re=="number"&&isFinite(re))){const ae={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/1/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[ae]:s.push(ae),a++}var v=ne===a;if(v&&k)k=!1,B=[B,1];else{v&&(k=!0,B=1);const ae=a;if(typeof re!="boolean"){const _e={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};s===null?s=[_e]:s.push(_e),a++}var v=ae===a;if(v&&k)k=!1,B=[B,2];else{v&&(k=!0,B=2);const _e=a;if(a===_e)if(re&&typeof re=="object"&&!Array.isArray(re))if(Object.keys(re).length<1){const Ce={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};s===null?s=[Ce]:s.push(Ce),a++}else{const Ce=a;for(const Te in re)if(Te!=="startsWith"){const ze={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Te},message:"must NOT have additional properties"};s===null?s=[ze]:s.push(ze),a++;break}if(Ce===a&&re.startsWith!==void 0&&typeof re.startsWith!="string"){const Te={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/startsWith",schemaPath:"#/properties/tags/additionalProperties/oneOf/3/properties/startsWith/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Te]:s.push(Te),a++}}else{const Ce={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[Ce]:s.push(Ce),a++}var v=_e===a;if(v&&k)k=!1,B=[B,3];else{v&&(k=!0,B=3);const Ce=a;if(a===a)if(re&&typeof re=="object"&&!Array.isArray(re))if(Object.keys(re).length<1){const ht={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};s===null?s=[ht]:s.push(ht),a++}else{const ht=a;for(const ie in re)if(!(ie==="gt"||ie==="gte"||ie==="lt"||ie==="lte")){const ce={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ie},message:"must NOT have additional properties"};s===null?s=[ce]:s.push(ce),a++;break}if(ht===a){if(re.gt!==void 0){const ie=a,ce=a,H=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.gte===void 0){const $={};s===null?s=[$]:s.push($),a++}var m=H===a;if(m){const $={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[$]:s.push($),a++}else a=ce,s!==null&&(ce?s.length=ce:s=null);var b=ie===a}else var b=!0;if(b){if(re.gte!==void 0){const ie=a,ce=a,H=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.gt===void 0){const P={};s===null?s=[P]:s.push(P),a++}var _=H===a;if(_){const P={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[P]:s.push(P),a++}else a=ce,s!==null&&(ce?s.length=ce:s=null);var b=ie===a}else var b=!0;if(b){if(re.lt!==void 0){const ie=a,ce=a,H=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.lte===void 0){const P={};s===null?s=[P]:s.push(P),a++}var E=H===a;if(E){const P={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[P]:s.push(P),a++}else a=ce,s!==null&&(ce?s.length=ce:s=null);var b=ie===a}else var b=!0;if(b){if(re.lte!==void 0){const ie=a,ce=a,H=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.lt===void 0){const P={};s===null?s=[P]:s.push(P),a++}var S=H===a;if(S){const P={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[P]:s.push(P),a++}else a=ce,s!==null&&(ce?s.length=ce:s=null);var b=ie===a}else var b=!0;if(b){if(re.gt!==void 0){const ie=a;if(typeof re.gt!="string"){const ce={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/gt/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ce]:s.push(ce),a++}var T=ie===a}else var T=!0;if(T){if(re.gte!==void 0){const ie=a;if(typeof re.gte!="string"){const H={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/gte/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[H]:s.push(H),a++}var T=ie===a}else var T=!0;if(T){if(re.lt!==void 0){const ie=a;if(typeof re.lt!="string"){const H={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/lt/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[H]:s.push(H),a++}var T=ie===a}else var T=!0;if(T)if(re.lte!==void 0){const ie=a;if(typeof re.lte!="string"){const H={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/lte/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[H]:s.push(H),a++}var T=ie===a}else var T=!0}}}}}}}}else{const ht={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[ht]:s.push(ht),a++}var v=Ce===a;if(v&&k)k=!1,B=[B,4];else{v&&(k=!0,B=4);const ht=a;if(a===a)if(re&&typeof re=="object"&&!Array.isArray(re))if(Object.keys(re).length<1){const H={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};s===null?s=[H]:s.push(H),a++}else{const H=a;for(const $ in re)if(!($==="gt"||$==="gte"||$==="lt"||$==="lte")){const P={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:$},message:"must NOT have additional properties"};s===null?s=[P]:s.push(P),a++;break}if(H===a){if(re.gt!==void 0){const $=a,P=a,se=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.gte===void 0){const fe={};s===null?s=[fe]:s.push(fe),a++}var O=se===a;if(O){const fe={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[fe]:s.push(fe),a++}else a=P,s!==null&&(P?s.length=P:s=null);var M=$===a}else var M=!0;if(M){if(re.gte!==void 0){const $=a,P=a,se=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.gt===void 0){const ve={};s===null?s=[ve]:s.push(ve),a++}var Q=se===a;if(Q){const ve={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[ve]:s.push(ve),a++}else a=P,s!==null&&(P?s.length=P:s=null);var M=$===a}else var M=!0;if(M){if(re.lt!==void 0){const $=a,P=a,se=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.lte===void 0){const ve={};s===null?s=[ve]:s.push(ve),a++}var W=se===a;if(W){const ve={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[ve]:s.push(ve),a++}else a=P,s!==null&&(P?s.length=P:s=null);var M=$===a}else var M=!0;if(M){if(re.lte!==void 0){const $=a,P=a,se=a;if(re&&typeof re=="object"&&!Array.isArray(re)&&re.lt===void 0){const ve={};s===null?s=[ve]:s.push(ve),a++}var U=se===a;if(U){const ve={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"};s===null?s=[ve]:s.push(ve),a++}else a=P,s!==null&&(P?s.length=P:s=null);var M=$===a}else var M=!0;if(M){if(re.gt!==void 0){let $=re.gt;const P=a;if(!(typeof $=="number"&&isFinite($))){const se={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[se]:s.push(se),a++}var ee=P===a}else var ee=!0;if(ee){if(re.gte!==void 0){let $=re.gte;const P=a;if(!(typeof $=="number"&&isFinite($))){const fe={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[fe]:s.push(fe),a++}var ee=P===a}else var ee=!0;if(ee){if(re.lt!==void 0){let $=re.lt;const P=a;if(!(typeof $=="number"&&isFinite($))){const fe={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[fe]:s.push(fe),a++}var ee=P===a}else var ee=!0;if(ee)if(re.lte!==void 0){let $=re.lte;const P=a;if(!(typeof $=="number"&&isFinite($))){const fe={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1")+"/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"};s===null?s=[fe]:s.push(fe),a++}var ee=P===a}else var ee=!0}}}}}}}}else{const H={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[H]:s.push(H),a++}var v=ht===a;v&&k?(k=!1,B=[B,5]):v&&(k=!0,B=5)}}}}if(k)a=L,s!==null&&(L?s.length=L:s=null);else{const ae={instancePath:e+"/tags/"+te.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf",keyword:"oneOf",params:{passingSchemas:B},message:"must match exactly one schema in oneOf"};return s===null?s=[ae]:s.push(ae),a++,He.errors=s,!1}var R=q===a;if(!R)break}}else return He.errors=[{instancePath:e+"/tags",schemaPath:"#/properties/tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var h=F===a}else var h=!0;if(h){if(r.recordId!==void 0){const C=a;if(typeof r.recordId!="string")return He.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.parentId!==void 0){const C=a;if(typeof r.parentId!="string")return He.errors=[{instancePath:e+"/parentId",schemaPath:"#/properties/parentId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.published!==void 0){const C=a;if(typeof r.published!="boolean")return He.errors=[{instancePath:e+"/published",schemaPath:"#/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var h=C===a}else var h=!0;if(h){if(r.dataFormat!==void 0){const C=a;if(typeof r.dataFormat!="string")return He.errors=[{instancePath:e+"/dataFormat",schemaPath:"#/properties/dataFormat/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.dataSize!==void 0){let C=r.dataSize;const F=a;if(a===a)if(C&&typeof C=="object"&&!Array.isArray(C)){if(Object.keys(C).length<1)return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const re=a;for(const q in C)if(!(q==="gt"||q==="gte"||q==="lt"||q==="lte"))return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:q},message:"must NOT have additional properties"}],!1;if(re===a){if(C.gt!==void 0){const q=a,L=a,k=a;if(C&&typeof C=="object"&&!Array.isArray(C)&&C.gte===void 0){const B={};s===null?s=[B]:s.push(B),a++}var z=k===a;if(z)return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=L,s!==null&&(L?s.length=L:s=null);var K=q===a}else var K=!0;if(K){if(C.gte!==void 0){const q=a,L=a,k=a;if(C&&typeof C=="object"&&!Array.isArray(C)&&C.gt===void 0){const X={};s===null?s=[X]:s.push(X),a++}var Y=k===a;if(Y)return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=L,s!==null&&(L?s.length=L:s=null);var K=q===a}else var K=!0;if(K){if(C.lt!==void 0){const q=a,L=a,k=a;if(C&&typeof C=="object"&&!Array.isArray(C)&&C.lte===void 0){const X={};s===null?s=[X]:s.push(X),a++}var I=k===a;if(I)return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=L,s!==null&&(L?s.length=L:s=null);var K=q===a}else var K=!0;if(K){if(C.lte!==void 0){const q=a,L=a,k=a;if(C&&typeof C=="object"&&!Array.isArray(C)&&C.lt===void 0){const X={};s===null?s=[X]:s.push(X),a++}var D=k===a;if(D)return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=L,s!==null&&(L?s.length=L:s=null);var K=q===a}else var K=!0;if(K){if(C.gt!==void 0){let q=C.gt;const L=a;if(!(typeof q=="number"&&isFinite(q)))return He.errors=[{instancePath:e+"/dataSize/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var N=L===a}else var N=!0;if(N){if(C.gte!==void 0){let q=C.gte;const L=a;if(!(typeof q=="number"&&isFinite(q)))return He.errors=[{instancePath:e+"/dataSize/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var N=L===a}else var N=!0;if(N){if(C.lt!==void 0){let q=C.lt;const L=a;if(!(typeof q=="number"&&isFinite(q)))return He.errors=[{instancePath:e+"/dataSize/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var N=L===a}else var N=!0;if(N)if(C.lte!==void 0){let q=C.lte;const L=a;if(!(typeof q=="number"&&isFinite(q)))return He.errors=[{instancePath:e+"/dataSize/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var N=L===a}else var N=!0}}}}}}}}}else return He.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var h=F===a}else var h=!0;if(h){if(r.dataCid!==void 0){const C=a;if(typeof r.dataCid!="string")return He.errors=[{instancePath:e+"/dataCid",schemaPath:"#/properties/dataCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=C===a}else var h=!0;if(h){if(r.dateCreated!==void 0){let C=r.dateCreated;const F=a;if(a===F)if(C&&typeof C=="object"&&!Array.isArray(C)){if(Object.keys(C).length<1)return He.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const te=a;for(const re in C)if(!(re==="from"||re==="to"))return He.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:re},message:"must NOT have additional properties"}],!1;if(te===a){if(C.from!==void 0){let re=C.from;const q=a;if(a===a)if(typeof re=="string"){if(!ri.test(re))return He.errors=[{instancePath:e+"/dateCreated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return He.errors=[{instancePath:e+"/dateCreated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var V=q===a}else var V=!0;if(V)if(C.to!==void 0){let re=C.to;const q=a;if(a===a)if(typeof re=="string"){if(!ri.test(re))return He.errors=[{instancePath:e+"/dateCreated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return He.errors=[{instancePath:e+"/dateCreated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var V=q===a}else var V=!0}}}else return He.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var h=F===a}else var h=!0;if(h){if(r.datePublished!==void 0){let C=r.datePublished;const F=a;if(a===F)if(C&&typeof C=="object"&&!Array.isArray(C)){if(Object.keys(C).length<1)return He.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const te=a;for(const re in C)if(!(re==="from"||re==="to"))return He.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:re},message:"must NOT have additional properties"}],!1;if(te===a){if(C.from!==void 0){let re=C.from;const q=a;if(a===a)if(typeof re=="string"){if(!ri.test(re))return He.errors=[{instancePath:e+"/datePublished/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return He.errors=[{instancePath:e+"/datePublished/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var J=q===a}else var J=!0;if(J)if(C.to!==void 0){let re=C.to;const q=a;if(a===a)if(typeof re=="string"){if(!ri.test(re))return He.errors=[{instancePath:e+"/datePublished/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return He.errors=[{instancePath:e+"/datePublished/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var J=q===a}else var J=!0}}}else return He.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var h=F===a}else var h=!0;if(h)if(r.dateUpdated!==void 0){let C=r.dateUpdated;const F=a;if(a===F)if(C&&typeof C=="object"&&!Array.isArray(C)){if(Object.keys(C).length<1)return He.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const te=a;for(const re in C)if(!(re==="from"||re==="to"))return He.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:re},message:"must NOT have additional properties"}],!1;if(te===a){if(C.from!==void 0){let re=C.from;const q=a;if(a===a)if(typeof re=="string"){if(!ri.test(re))return He.errors=[{instancePath:e+"/dateUpdated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return He.errors=[{instancePath:e+"/dateUpdated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var j=q===a}else var j=!0;if(j)if(C.to!==void 0){let re=C.to;const q=a;if(a===a)if(typeof re=="string"){if(!ri.test(re))return He.errors=[{instancePath:e+"/dateUpdated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return He.errors=[{instancePath:e+"/dateUpdated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var j=q===a}else var j=!0}}}else return He.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var h=F===a}else var h=!0}}}}}}}}}}}}}}}}}}}else return He.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return He.errors=s,a===0}He.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function Ur(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Ur.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let h;if(r.descriptor===void 0&&(h="descriptor"))return Ur.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:h},message:"must have required property '"+h+"'"}],!1;{const p=a;for(const y in r)if(!(y==="authorization"||y==="descriptor"))return Ur.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:y},message:"must NOT have additional properties"}],!1;if(p===a){if(r.authorization!==void 0){const y=a;Wn(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Wn.errors:s.concat(Wn.errors),a=s.length);var d=y===a}else var d=!0;if(d)if(r.descriptor!==void 0){let y=r.descriptor;const g=a;if(a===g)if(y&&typeof y=="object"&&!Array.isArray(y)){let v;if(y.interface===void 0&&(v="interface")||y.method===void 0&&(v="method")||y.messageTimestamp===void 0&&(v="messageTimestamp")||y.filter===void 0&&(v="filter"))return Ur.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:v},message:"must have required property '"+v+"'"}],!1;{const m=a;for(const b in y)if(!(b==="interface"||b==="method"||b==="messageTimestamp"||b==="filter"||b==="pagination"||b==="dateSort"))return Ur.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:b},message:"must NOT have additional properties"}],!1;if(m===a){if(y.interface!==void 0){let b=y.interface;const _=a;if(typeof b!="string")return Ur.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(b!=="Records")return Ur.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:$T.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=_===a}else var c=!0;if(c){if(y.method!==void 0){let b=y.method;const _=a;if(typeof b!="string")return Ur.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(b!=="Query")return Ur.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:$T.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=_===a}else var c=!0;if(c){if(y.messageTimestamp!==void 0){let b=y.messageTimestamp;const _=a;if(a===a)if(typeof b=="string"){if(!ri.test(b))return Ur.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return Ur.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=_===a}else var c=!0;if(c){if(y.filter!==void 0){const b=a;He(y.filter,{instancePath:e+"/descriptor/filter",parentData:y,parentDataProperty:"filter",rootData:i,dynamicAnchors:o})||(s=s===null?He.errors:s.concat(He.errors),a=s.length);var c=b===a}else var c=!0;if(c){if(y.pagination!==void 0){let b=y.pagination;const _=a;if(a===_)if(b&&typeof b=="object"&&!Array.isArray(b)){const S=a;for(const T in b)if(!(T==="limit"||T==="cursor"))return Ur.errors=[{instancePath:e+"/descriptor/pagination",schemaPath:"#/properties/descriptor/properties/pagination/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:T},message:"must NOT have additional properties"}],!1;if(S===a){if(b.limit!==void 0){let T=b.limit;const O=a;if(a===O)if(typeof T=="number"&&isFinite(T)){if(T<1||isNaN(T))return Ur.errors=[{instancePath:e+"/descriptor/pagination/limit",schemaPath:"#/properties/descriptor/properties/pagination/properties/limit/minimum",keyword:"minimum",params:{comparison:">=",limit:1},message:"must be >= 1"}],!1}else return Ur.errors=[{instancePath:e+"/descriptor/pagination/limit",schemaPath:"#/properties/descriptor/properties/pagination/properties/limit/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var u=O===a}else var u=!0;if(u)if(b.cursor!==void 0){let T=b.cursor;const O=a;if(a===a)if(T&&typeof T=="object"&&!Array.isArray(T)){if(Object.keys(T).length<1)return Ur.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let W;if(T.messageCid===void 0&&(W="messageCid")||T.value===void 0&&(W="value"))return Ur.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/required",keyword:"required",params:{missingProperty:W},message:"must have required property '"+W+"'"}],!1;{const U=a;for(const ee in T)if(!(ee==="messageCid"||ee==="value"))return Ur.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ee},message:"must NOT have additional properties"}],!1;if(U===a){if(T.messageCid!==void 0){const ee=a;if(typeof T.messageCid!="string")return Ur.errors=[{instancePath:e+"/descriptor/pagination/cursor/messageCid",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var f=ee===a}else var f=!0;if(f)if(T.value!==void 0){let ee=T.value;const R=a;if(typeof ee!="string"&&!(typeof ee=="number"&&isFinite(ee)))return Ur.errors=[{instancePath:e+"/descriptor/pagination/cursor/value",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/value/type",keyword:"type",params:{type:PO.properties.value.type},message:"must be string,number"}],!1;var f=R===a}else var f=!0}}}}else return Ur.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var u=O===a}else var u=!0}}else return Ur.errors=[{instancePath:e+"/descriptor/pagination",schemaPath:"#/properties/descriptor/properties/pagination/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=_===a}else var c=!0;if(c)if(y.dateSort!==void 0){let b=y.dateSort;const _=a;if(typeof b!="string")return Ur.errors=[{instancePath:e+"/descriptor/dateSort",schemaPath:"#/properties/descriptor/properties/dateSort/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(b==="createdAscending"||b==="createdDescending"||b==="publishedAscending"||b==="publishedDescending"))return Ur.errors=[{instancePath:e+"/descriptor/dateSort",schemaPath:"#/properties/descriptor/properties/dateSort/enum",keyword:"enum",params:{allowedValues:$T.properties.descriptor.properties.dateSort.enum},message:"must be equal to one of the allowed values"}],!1;var c=_===a}else var c=!0}}}}}}}else return Ur.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=g===a}else var d=!0}}}else return Ur.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Ur.errors=s,a===0}Ur.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const tre=Oo,G3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-subscribe.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Subscribe"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"}}}}};function Oo(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Oo.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let u;if(r.descriptor===void 0&&(u="descriptor"))return Oo.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:u},message:"must have required property '"+u+"'"}],!1;{const f=a;for(const h in r)if(!(h==="authorization"||h==="descriptor"))return Oo.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:h},message:"must NOT have additional properties"}],!1;if(f===a){if(r.authorization!==void 0){const h=a;Wn(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Wn.errors:s.concat(Wn.errors),a=s.length);var d=h===a}else var d=!0;if(d)if(r.descriptor!==void 0){let h=r.descriptor;const p=a;if(a===p)if(h&&typeof h=="object"&&!Array.isArray(h)){let g;if(h.interface===void 0&&(g="interface")||h.method===void 0&&(g="method")||h.messageTimestamp===void 0&&(g="messageTimestamp")||h.filter===void 0&&(g="filter"))return Oo.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"}],!1;{const w=a;for(const v in h)if(!(v==="interface"||v==="method"||v==="messageTimestamp"||v==="filter"))return Oo.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:v},message:"must NOT have additional properties"}],!1;if(w===a){if(h.interface!==void 0){let v=h.interface;const m=a;if(typeof v!="string")return Oo.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Records")return Oo.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:G3.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.method!==void 0){let v=h.method;const m=a;if(typeof v!="string")return Oo.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Subscribe")return Oo.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:G3.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.messageTimestamp!==void 0){let v=h.messageTimestamp;const m=a;if(a===a)if(typeof v=="string"){if(!ri.test(v))return Oo.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return Oo.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=m===a}else var c=!0;if(c)if(h.filter!==void 0){const v=a;He(h.filter,{instancePath:e+"/descriptor/filter",parentData:h,parentDataProperty:"filter",rootData:i,dynamicAnchors:o})||(s=s===null?He.errors:s.concat(He.errors),a=s.length);var c=v===a}else var c=!0}}}}}else return Oo.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=p===a}else var d=!0}}}else return Oo.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Oo.errors=s,a===0}Oo.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const rre=Ip;function Ip(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Ip.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),!qe(r,{instancePath:e,parentData:t,parentDataProperty:n,rootData:i,dynamicAnchors:o}))s=s===null?qe.errors:s.concat(qe.errors),a=s.length;else var d=qe.evaluated.props;if(a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let c;if(r.recordId===void 0&&(c="recordId")||r.authorization===void 0&&(c="authorization"))return Ip.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;if(d!==!0){for(const u in r)if(!d||!d[u])return Ip.errors=[{instancePath:e,schemaPath:"#/unevaluatedProperties",keyword:"unevaluatedProperties",params:{unevaluatedProperty:u},message:"must NOT have unevaluated properties"}],!1}}else return Ip.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Ip.errors=s,a===0}Ip.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const nre=Xa,ire=qe,ore=zb;function zb(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=zb.evaluated;return l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)?(zb.errors=s,a===0):(zb.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}zb.evaluated={dynamicProps:!1,dynamicItems:!1};const sre=Zi;function Zi(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Zi.evaluated;l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0);const d=a;let c=!1,u=null;const f=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let _;if(r.crv===void 0&&(_="crv")||r.x===void 0&&(_="x")){const E={instancePath:e,schemaPath:"#/oneOf/0/required",keyword:"required",params:{missingProperty:_},message:"must have required property '"+_+"'"};s===null?s=[E]:s.push(E),a++}else{if(r.kty!==void 0){const E=a;if(r.kty!=="EC"){const S={instancePath:e+"/kty",schemaPath:"#/oneOf/0/properties/kty/const",keyword:"const",params:{allowedValue:"EC"},message:"must be equal to constant"};s===null?s=[S]:s.push(S),a++}var h=E===a}else var h=!0;if(h){if(r.crv!==void 0){const E=a;if(typeof r.crv!="string"){const T={instancePath:e+"/crv",schemaPath:"#/oneOf/0/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var h=E===a}else var h=!0;if(h){if(r.x!==void 0){const E=a;if(typeof r.x!="string"){const T={instancePath:e+"/x",schemaPath:"#/oneOf/0/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var h=E===a}else var h=!0;if(h){if(r.y!==void 0){const E=a;if(typeof r.y!="string"){const T={instancePath:e+"/y",schemaPath:"#/oneOf/0/properties/y/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var h=E===a}else var h=!0;if(h)if(r.d!==void 0){const E=a;if(typeof r.d!="string"){const T={instancePath:e+"/d",schemaPath:"#/oneOf/0/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var h=E===a}else var h=!0}}}}}var w=f===a;if(w){c=!0,u=0;var p={};p.kty=!0,p.crv=!0,p.x=!0,p.y=!0,p.d=!0}const y=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let _;if(r.crv===void 0&&(_="crv")||r.x===void 0&&(_="x")){const E={instancePath:e,schemaPath:"#/oneOf/1/required",keyword:"required",params:{missingProperty:_},message:"must have required property '"+_+"'"};s===null?s=[E]:s.push(E),a++}else{if(r.kty!==void 0){const E=a;if(r.kty!=="OKP"){const S={instancePath:e+"/kty",schemaPath:"#/oneOf/1/properties/kty/const",keyword:"const",params:{allowedValue:"OKP"},message:"must be equal to constant"};s===null?s=[S]:s.push(S),a++}var g=E===a}else var g=!0;if(g){if(r.crv!==void 0){const E=a;if(typeof r.crv!="string"){const T={instancePath:e+"/crv",schemaPath:"#/oneOf/1/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var g=E===a}else var g=!0;if(g){if(r.x!==void 0){const E=a;if(typeof r.x!="string"){const T={instancePath:e+"/x",schemaPath:"#/oneOf/1/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var g=E===a}else var g=!0;if(g)if(r.d!==void 0){const E=a;if(typeof r.d!="string"){const T={instancePath:e+"/d",schemaPath:"#/oneOf/1/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[T]:s.push(T),a++}var g=E===a}else var g=!0}}}}var w=y===a;if(w&&c)c=!1,u=[u,1];else{w&&(c=!0,u=1,p!==!0&&(p=p||{},p.kty=!0,p.crv=!0,p.x=!0,p.d=!0));const _=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let S;if(r.n===void 0&&(S="n")||r.e===void 0&&(S="e")){const T={instancePath:e,schemaPath:"#/oneOf/2/required",keyword:"required",params:{missingProperty:S},message:"must have required property '"+S+"'"};s===null?s=[T]:s.push(T),a++}else{if(r.kty!==void 0){const T=a;if(r.kty!=="RSA"){const O={instancePath:e+"/kty",schemaPath:"#/oneOf/2/properties/kty/const",keyword:"const",params:{allowedValue:"RSA"},message:"must be equal to constant"};s===null?s=[O]:s.push(O),a++}var v=T===a}else var v=!0;if(v){if(r.n!==void 0){const T=a;if(typeof r.n!="string"){const M={instancePath:e+"/n",schemaPath:"#/oneOf/2/properties/n/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.e!==void 0){const T=a;if(typeof r.e!="string"){const M={instancePath:e+"/e",schemaPath:"#/oneOf/2/properties/e/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.d!==void 0){const T=a;if(typeof r.d!="string"){const M={instancePath:e+"/d",schemaPath:"#/oneOf/2/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.p!==void 0){const T=a;if(typeof r.p!="string"){const M={instancePath:e+"/p",schemaPath:"#/oneOf/2/properties/p/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.q!==void 0){const T=a;if(typeof r.q!="string"){const M={instancePath:e+"/q",schemaPath:"#/oneOf/2/properties/q/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.dp!==void 0){const T=a;if(typeof r.dp!="string"){const M={instancePath:e+"/dp",schemaPath:"#/oneOf/2/properties/dp/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.dq!==void 0){const T=a;if(typeof r.dq!="string"){const M={instancePath:e+"/dq",schemaPath:"#/oneOf/2/properties/dq/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v){if(r.qi!==void 0){const T=a;if(typeof r.qi!="string"){const M={instancePath:e+"/qi",schemaPath:"#/oneOf/2/properties/qi/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[M]:s.push(M),a++}var v=T===a}else var v=!0;if(v)if(r.oth!==void 0){let T=r.oth;const O=a;if(!(T&&typeof T=="object"&&!Array.isArray(T))){const Q={instancePath:e+"/oth",schemaPath:"#/oneOf/2/properties/oth/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[Q]:s.push(Q),a++}var v=O===a}else var v=!0}}}}}}}}}}var w=_===a;if(w&&c)c=!1,u=[u,2];else{w&&(c=!0,u=2,p!==!0&&(p=p||{},p.kty=!0,p.n=!0,p.e=!0,p.d=!0,p.p=!0,p.q=!0,p.dp=!0,p.dq=!0,p.qi=!0,p.oth=!0));const S=a;if(r&&typeof r=="object"&&!Array.isArray(r)){let O;if(r.k===void 0&&(O="k")){const M={instancePath:e,schemaPath:"#/oneOf/3/required",keyword:"required",params:{missingProperty:O},message:"must have required property '"+O+"'"};s===null?s=[M]:s.push(M),a++}else{if(r.kty!==void 0){const M=a;if(r.kty!=="oct"){const Q={instancePath:e+"/kty",schemaPath:"#/oneOf/3/properties/kty/const",keyword:"const",params:{allowedValue:"oct"},message:"must be equal to constant"};s===null?s=[Q]:s.push(Q),a++}var m=M===a}else var m=!0;if(m)if(r.k!==void 0){const M=a;if(typeof r.k!="string"){const W={instancePath:e+"/k",schemaPath:"#/oneOf/3/properties/k/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[W]:s.push(W),a++}var m=M===a}else var m=!0}}var w=S===a;w&&c?(c=!1,u=[u,3]):w&&(c=!0,u=3,p!==!0&&(p=p||{},p.kty=!0,p.k=!0))}}if(c)a=d,s!==null&&(d?s.length=d:s=null);else{const _={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:u},message:"must match exactly one schema in oneOf"};return s===null?s=[_]:s.push(_),a++,Zi.errors=s,!1}if(a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let _;if(r.kty===void 0&&(_="kty"))return Zi.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:_},message:"must have required property '"+_+"'"}],!1;if(p!==!0&&(p=p||{},p.alg=!0,p.kid=!0,p.kty=!0,p.crv=!0,p.use=!0,p.key_ops=!0,p.x5u=!0,p.x5c=!0,p.x5t=!0,p["x5t#S256"]=!0),r.alg!==void 0){const E=a;if(typeof r.alg!="string")return Zi.errors=[{instancePath:e+"/alg",schemaPath:"#/properties/alg/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.kid!==void 0){const E=a;if(typeof r.kid!="string")return Zi.errors=[{instancePath:e+"/kid",schemaPath:"#/properties/kid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.kty!==void 0){let E=r.kty;const S=a;if(!(E==="EC"||E==="RSA"||E==="oct"||E==="OKP"))return Zi.errors=[{instancePath:e+"/kty",schemaPath:"#/properties/kty/enum",keyword:"enum",params:{allowedValues:LK.properties.kty.enum},message:"must be equal to one of the allowed values"}],!1;var b=S===a}else var b=!0;if(b){if(r.crv!==void 0){const E=a;if(typeof r.crv!="string")return Zi.errors=[{instancePath:e+"/crv",schemaPath:"#/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.use!==void 0){const E=a;if(typeof r.use!="string")return Zi.errors=[{instancePath:e+"/use",schemaPath:"#/properties/use/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.key_ops!==void 0){const E=a;if(typeof r.key_ops!="string")return Zi.errors=[{instancePath:e+"/key_ops",schemaPath:"#/properties/key_ops/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.x5u!==void 0){const E=a;if(typeof r.x5u!="string")return Zi.errors=[{instancePath:e+"/x5u",schemaPath:"#/properties/x5u/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.x5c!==void 0){const E=a;if(typeof r.x5c!="string")return Zi.errors=[{instancePath:e+"/x5c",schemaPath:"#/properties/x5c/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b){if(r.x5t!==void 0){const E=a;if(typeof r.x5t!="string")return Zi.errors=[{instancePath:e+"/x5t",schemaPath:"#/properties/x5t/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0;if(b)if(r["x5t#S256"]!==void 0){const E=a;if(typeof r["x5t#S256"]!="string")return Zi.errors=[{instancePath:e+"/x5t#S256",schemaPath:"#/properties/x5t%23S256/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var b=E===a}else var b=!0}}}}}}}}}else return Zi.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Zi.errors=s,l.props=p,a===0}Zi.evaluated={dynamicProps:!0,dynamicItems:!1};const are=Ir,cre=Tc,lre={$id:"https://identity.foundation/dwn/json-schemas/jwk-verification-method.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",additionalProperties:!1,required:["id","type","controller","publicKeyJwk"],properties:{id:{type:"string"},type:{enum:["JsonWebKey","JsonWebKey2020"]},controller:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},publicKeyJwk:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"}}};function Tc(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Tc.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let c;if(r.id===void 0&&(c="id")||r.type===void 0&&(c="type")||r.controller===void 0&&(c="controller")||r.publicKeyJwk===void 0&&(c="publicKeyJwk"))return Tc.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;{const u=a;for(const f in r)if(!(f==="id"||f==="type"||f==="controller"||f==="publicKeyJwk"))return Tc.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:f},message:"must NOT have additional properties"}],!1;if(u===a){if(r.id!==void 0){const f=a;if(typeof r.id!="string")return Tc.errors=[{instancePath:e+"/id",schemaPath:"#/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=f===a}else var d=!0;if(d){if(r.type!==void 0){let f=r.type;const h=a;if(!(f==="JsonWebKey"||f==="JsonWebKey2020"))return Tc.errors=[{instancePath:e+"/type",schemaPath:"#/properties/type/enum",keyword:"enum",params:{allowedValues:lre.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var d=h===a}else var d=!0;if(d){if(r.controller!==void 0){let f=r.controller;const h=a;if(a===a)if(typeof f=="string"){if(!Yf.test(f))return Tc.errors=[{instancePath:e+"/controller",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return Tc.errors=[{instancePath:e+"/controller",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=h===a}else var d=!0;if(d)if(r.publicKeyJwk!==void 0){const f=a;Pr(r.publicKeyJwk,{instancePath:e+"/publicKeyJwk",parentData:r,parentDataProperty:"publicKeyJwk",rootData:i,dynamicAnchors:o})||(s=s===null?Pr.errors:s.concat(Pr.errors),a=s.length);var d=f===a}else var d=!0}}}}}else return Tc.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Tc.errors=s,a===0}Tc.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const dre=dn,Y3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-filter.json",type:"object",additionalProperties:!1,minProperties:1,properties:{interface:{enum:["Protocols","Records"],type:"string"},method:{enum:["Configure","Delete","Write"],type:"string"},protocol:{type:"string"},messageTimestamp:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}}}};function dn(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=dn.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)){if(Object.keys(r).length<1)return dn.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const u in r)if(!(u==="interface"||u==="method"||u==="protocol"||u==="messageTimestamp"))return dn.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:u},message:"must NOT have additional properties"}],!1;{if(r.interface!==void 0){let u=r.interface;const f=a;if(typeof u!="string")return dn.errors=[{instancePath:e+"/interface",schemaPath:"#/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(u==="Protocols"||u==="Records"))return dn.errors=[{instancePath:e+"/interface",schemaPath:"#/properties/interface/enum",keyword:"enum",params:{allowedValues:Y3.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var d=f===a}else var d=!0;if(d){if(r.method!==void 0){let u=r.method;const f=a;if(typeof u!="string")return dn.errors=[{instancePath:e+"/method",schemaPath:"#/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(u==="Configure"||u==="Delete"||u==="Write"))return dn.errors=[{instancePath:e+"/method",schemaPath:"#/properties/method/enum",keyword:"enum",params:{allowedValues:Y3.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var d=f===a}else var d=!0;if(d){if(r.protocol!==void 0){const u=a;if(typeof r.protocol!="string")return dn.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d)if(r.messageTimestamp!==void 0){let u=r.messageTimestamp;const f=a;if(u&&typeof u=="object"&&!Array.isArray(u)){if(Object.keys(u).length<1)return dn.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const p in u)if(!(p==="from"||p==="to"))return dn.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:p},message:"must NOT have additional properties"}],!1;{if(u.from!==void 0){let p=u.from;const y=a;if(typeof p=="string"){if(!ri.test(p))return dn.errors=[{instancePath:e+"/messageTimestamp/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return dn.errors=[{instancePath:e+"/messageTimestamp/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=y===a}else var c=!0;if(c)if(u.to!==void 0){let p=u.to;const y=a;if(typeof p=="string"){if(!ri.test(p))return dn.errors=[{instancePath:e+"/messageTimestamp/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return dn.errors=[{instancePath:e+"/messageTimestamp/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=y===a}else var c=!0}}else return dn.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=f===a}else var d=!0}}}}else return dn.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return dn.errors=s,a===0}dn.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const ure=bn,Z3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-query.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filters"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filters:{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/messages-filter.json"}},cursor:{$ref:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json"}}}}};function bn(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=bn.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let h;if(r.authorization===void 0&&(h="authorization")||r.descriptor===void 0&&(h="descriptor"))return bn.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:h},message:"must have required property '"+h+"'"}],!1;{const p=a;for(const y in r)if(!(y==="authorization"||y==="descriptor"))return bn.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:y},message:"must NOT have additional properties"}],!1;if(p===a){if(r.authorization!==void 0){const y=a;Ii(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Ii.errors:s.concat(Ii.errors),a=s.length);var d=y===a}else var d=!0;if(d)if(r.descriptor!==void 0){let y=r.descriptor;const g=a;if(a===g)if(y&&typeof y=="object"&&!Array.isArray(y)){let v;if(y.interface===void 0&&(v="interface")||y.method===void 0&&(v="method")||y.messageTimestamp===void 0&&(v="messageTimestamp")||y.filters===void 0&&(v="filters"))return bn.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:v},message:"must have required property '"+v+"'"}],!1;{const m=a;for(const b in y)if(!(b==="interface"||b==="method"||b==="messageTimestamp"||b==="filters"||b==="cursor"))return bn.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:b},message:"must NOT have additional properties"}],!1;if(m===a){if(y.interface!==void 0){let b=y.interface;const _=a;if(typeof b!="string")return bn.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(b!=="Messages")return bn.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:Z3.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=_===a}else var c=!0;if(c){if(y.method!==void 0){let b=y.method;const _=a;if(typeof b!="string")return bn.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(b!=="Query")return bn.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:Z3.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=_===a}else var c=!0;if(c){if(y.messageTimestamp!==void 0){let b=y.messageTimestamp;const _=a;if(a===a)if(typeof b=="string"){if(!ri.test(b))return bn.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return bn.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=_===a}else var c=!0;if(c){if(y.filters!==void 0){let b=y.filters;const _=a;if(a===_)if(Array.isArray(b)){var u=!0;const S=b.length;for(let T=0;T<S;T++){const O=a;dn(b[T],{instancePath:e+"/descriptor/filters/"+T,parentData:b,parentDataProperty:T,rootData:i,dynamicAnchors:o})||(s=s===null?dn.errors:s.concat(dn.errors),a=s.length);var u=O===a;if(!u)break}}else return bn.errors=[{instancePath:e+"/descriptor/filters",schemaPath:"#/properties/descriptor/properties/filters/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var c=_===a}else var c=!0;if(c)if(y.cursor!==void 0){let b=y.cursor;const _=a;if(a===a)if(b&&typeof b=="object"&&!Array.isArray(b)){if(Object.keys(b).length<1)return bn.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let T;if(b.messageCid===void 0&&(T="messageCid")||b.value===void 0&&(T="value"))return bn.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/required",keyword:"required",params:{missingProperty:T},message:"must have required property '"+T+"'"}],!1;{const O=a;for(const M in b)if(!(M==="messageCid"||M==="value"))return bn.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:M},message:"must NOT have additional properties"}],!1;if(O===a){if(b.messageCid!==void 0){const M=a;if(typeof b.messageCid!="string")return bn.errors=[{instancePath:e+"/descriptor/cursor/messageCid",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var f=M===a}else var f=!0;if(f)if(b.value!==void 0){let M=b.value;const Q=a;if(typeof M!="string"&&!(typeof M=="number"&&isFinite(M)))return bn.errors=[{instancePath:e+"/descriptor/cursor/value",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/value/type",keyword:"type",params:{type:PO.properties.value.type},message:"must be string,number"}],!1;var f=Q===a}else var f=!0}}}}else return bn.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=_===a}else var c=!0}}}}}}else return bn.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=g===a}else var d=!0}}}else return bn.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return bn.errors=s,a===0}bn.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const fre=Ji,J3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-read.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Read"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},messageCid:{type:"string"}}}}};function Ji(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Ji.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let u;if(r.authorization===void 0&&(u="authorization")||r.descriptor===void 0&&(u="descriptor"))return Ji.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:u},message:"must have required property '"+u+"'"}],!1;{const f=a;for(const h in r)if(!(h==="authorization"||h==="descriptor"))return Ji.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:h},message:"must NOT have additional properties"}],!1;if(f===a){if(r.authorization!==void 0){const h=a;Ii(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Ii.errors:s.concat(Ii.errors),a=s.length);var d=h===a}else var d=!0;if(d)if(r.descriptor!==void 0){let h=r.descriptor;const p=a;if(a===p)if(h&&typeof h=="object"&&!Array.isArray(h)){let g;if(h.interface===void 0&&(g="interface")||h.method===void 0&&(g="method")||h.messageTimestamp===void 0&&(g="messageTimestamp"))return Ji.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"}],!1;{const w=a;for(const v in h)if(!(v==="interface"||v==="method"||v==="messageTimestamp"||v==="messageCid"))return Ji.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:v},message:"must NOT have additional properties"}],!1;if(w===a){if(h.interface!==void 0){let v=h.interface;const m=a;if(typeof v!="string")return Ji.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Messages")return Ji.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:J3.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.method!==void 0){let v=h.method;const m=a;if(typeof v!="string")return Ji.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Read")return Ji.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:J3.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.messageTimestamp!==void 0){let v=h.messageTimestamp;const m=a;if(a===a)if(typeof v=="string"){if(!ri.test(v))return Ji.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return Ji.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=m===a}else var c=!0;if(c)if(h.messageCid!==void 0){const v=a;if(typeof h.messageCid!="string")return Ji.errors=[{instancePath:e+"/descriptor/messageCid",schemaPath:"#/properties/descriptor/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=v===a}else var c=!0}}}}}else return Ji.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=p===a}else var d=!0}}}else return Ji.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Ji.errors=s,a===0}Ji.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const hre=Co,X3={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-subscribe.json",type:"object",additionalProperties:!1,required:["descriptor","authorization"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filters"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Subscribe"],type:"string"},messageTimestamp:{type:"string"},filters:{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/messages-filter.json"}}}}}};function Co(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Co.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let f;if(r.descriptor===void 0&&(f="descriptor")||r.authorization===void 0&&(f="authorization"))return Co.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:f},message:"must have required property '"+f+"'"}],!1;{const h=a;for(const p in r)if(!(p==="authorization"||p==="descriptor"))return Co.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:p},message:"must NOT have additional properties"}],!1;if(h===a){if(r.authorization!==void 0){const p=a;Ii(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Ii.errors:s.concat(Ii.errors),a=s.length);var d=p===a}else var d=!0;if(d)if(r.descriptor!==void 0){let p=r.descriptor;const y=a;if(a===y)if(p&&typeof p=="object"&&!Array.isArray(p)){let w;if(p.interface===void 0&&(w="interface")||p.method===void 0&&(w="method")||p.messageTimestamp===void 0&&(w="messageTimestamp")||p.filters===void 0&&(w="filters"))return Co.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:w},message:"must have required property '"+w+"'"}],!1;{const v=a;for(const m in p)if(!(m==="interface"||m==="method"||m==="messageTimestamp"||m==="filters"))return Co.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:m},message:"must NOT have additional properties"}],!1;if(v===a){if(p.interface!==void 0){let m=p.interface;const b=a;if(typeof m!="string")return Co.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(m!=="Messages")return Co.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:X3.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=b===a}else var c=!0;if(c){if(p.method!==void 0){let m=p.method;const b=a;if(typeof m!="string")return Co.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(m!=="Subscribe")return Co.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:X3.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=b===a}else var c=!0;if(c){if(p.messageTimestamp!==void 0){const m=a;if(typeof p.messageTimestamp!="string")return Co.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"#/properties/descriptor/properties/messageTimestamp/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=m===a}else var c=!0;if(c)if(p.filters!==void 0){let m=p.filters;const b=a;if(a===b)if(Array.isArray(m)){var u=!0;const E=m.length;for(let S=0;S<E;S++){const T=a;dn(m[S],{instancePath:e+"/descriptor/filters/"+S,parentData:m,parentDataProperty:S,rootData:i,dynamicAnchors:o})||(s=s===null?dn.errors:s.concat(dn.errors),a=s.length);var u=T===a;if(!u)break}}else return Co.errors=[{instancePath:e+"/descriptor/filters",schemaPath:"#/properties/descriptor/properties/filters/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var c=b===a}else var c=!0}}}}}else return Co.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=y===a}else var d=!0}}}else return Co.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Co.errors=s,a===0}Co.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const pre=ns;function ns(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=ns.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){if(Object.keys(r).length<1)return ns.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const y=a;for(const g in r)if(!(g==="gt"||g==="gte"||g==="lt"||g==="lte"))return ns.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:g},message:"must NOT have additional properties"}],!1;if(y===a){if(r.gt!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.gte===void 0){const m={};s===null?s=[m]:s.push(m),a++}var d=v===a;if(d)return ns.errors=[{instancePath:e,schemaPath:"#/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.gte!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.gt===void 0){const b={};s===null?s=[b]:s.push(b),a++}var u=v===a;if(u)return ns.errors=[{instancePath:e,schemaPath:"#/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.lt!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.lte===void 0){const b={};s===null?s=[b]:s.push(b),a++}var f=v===a;if(f)return ns.errors=[{instancePath:e,schemaPath:"#/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.lte!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.lt===void 0){const b={};s===null?s=[b]:s.push(b),a++}var h=v===a;if(h)return ns.errors=[{instancePath:e,schemaPath:"#/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.gt!==void 0){let g=r.gt;const w=a;if(!(typeof g=="number"&&isFinite(g)))return ns.errors=[{instancePath:e+"/gt",schemaPath:"#/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var p=w===a}else var p=!0;if(p){if(r.gte!==void 0){let g=r.gte;const w=a;if(!(typeof g=="number"&&isFinite(g)))return ns.errors=[{instancePath:e+"/gte",schemaPath:"#/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var p=w===a}else var p=!0;if(p){if(r.lt!==void 0){let g=r.lt;const w=a;if(!(typeof g=="number"&&isFinite(g)))return ns.errors=[{instancePath:e+"/lt",schemaPath:"#/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var p=w===a}else var p=!0;if(p)if(r.lte!==void 0){let g=r.lte;const w=a;if(!(typeof g=="number"&&isFinite(g)))return ns.errors=[{instancePath:e+"/lte",schemaPath:"#/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var p=w===a}else var p=!0}}}}}}}}}else return ns.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return ns.errors=s,a===0}ns.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const yre=wl;function wl(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=wl.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)){if(Object.keys(r).length<1)return wl.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let c;if(r.messageCid===void 0&&(c="messageCid")||r.value===void 0&&(c="value"))return wl.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;for(const u in r)if(!(u==="messageCid"||u==="value"))return wl.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:u},message:"must NOT have additional properties"}],!1;{if(r.messageCid!==void 0){const u=a;if(typeof r.messageCid!="string")return wl.errors=[{instancePath:e+"/messageCid",schemaPath:"#/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d)if(r.value!==void 0){let u=r.value;const f=a;if(typeof u!="string"&&!(typeof u=="number"&&isFinite(u)))return wl.errors=[{instancePath:e+"/value",schemaPath:"#/properties/value/type",keyword:"type",params:{type:PO.properties.value.type},message:"must be string,number"}],!1;var d=f===a}else var d=!0}}}else return wl.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return wl.errors=s,a===0}wl.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const mre=Ro,zK={type:"object",additionalProperties:!1,properties:{publication:{enum:["Required","Prohibited"],type:"string"}}};function oy(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=oy.evaluated;l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0);const d=a;let c=!1,u=null;const f=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let W;if(r.interface===void 0&&(W="interface")||r.method===void 0&&(W="method")){const U={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/required",keyword:"required",params:{missingProperty:W},message:"must have required property '"+W+"'"};s===null?s=[U]:s.push(U),a++}else{const U=a;for(const ee in r)if(!(ee==="interface"||ee==="method"||ee==="protocol")){const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ee},message:"must NOT have additional properties"};s===null?s=[R]:s.push(R),a++;break}if(U===a){if(r.interface!==void 0){const ee=a;if(r.interface!=="Messages"){const R={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};s===null?s=[R]:s.push(R),a++}var p=ee===a}else var p=!0;if(p){if(r.method!==void 0){const ee=a;if(r.method!=="Query"){const z={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};s===null?s=[z]:s.push(z),a++}var p=ee===a}else var p=!0;if(p)if(r.protocol!==void 0){const ee=a;if(typeof r.protocol!="string"){const z={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[z]:s.push(z),a++}var p=ee===a}else var p=!0}}}}else{const W={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[W]:s.push(W),a++}var m=f===a;if(m){c=!0,u=0;var y=!0}const g=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let W;if(r.interface===void 0&&(W="interface")||r.method===void 0&&(W="method")){const U={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/required",keyword:"required",params:{missingProperty:W},message:"must have required property '"+W+"'"};s===null?s=[U]:s.push(U),a++}else{const U=a;for(const ee in r)if(!(ee==="interface"||ee==="method"||ee==="protocol")){const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ee},message:"must NOT have additional properties"};s===null?s=[R]:s.push(R),a++;break}if(U===a){if(r.interface!==void 0){const ee=a;if(r.interface!=="Messages"){const R={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};s===null?s=[R]:s.push(R),a++}var v=ee===a}else var v=!0;if(v){if(r.method!==void 0){const ee=a;if(r.method!=="Read"){const z={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};s===null?s=[z]:s.push(z),a++}var v=ee===a}else var v=!0;if(v)if(r.protocol!==void 0){const ee=a;if(typeof r.protocol!="string"){const z={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[z]:s.push(z),a++}var v=ee===a}else var v=!0}}}}else{const W={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[W]:s.push(W),a++}var m=g===a;if(m&&c)c=!1,u=[u,1];else{m&&(c=!0,u=1,y!==!0&&(y=!0));const W=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let R;if(r.interface===void 0&&(R="interface")||r.method===void 0&&(R="method")){const z={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/required",keyword:"required",params:{missingProperty:R},message:"must have required property '"+R+"'"};s===null?s=[z]:s.push(z),a++}else{const z=a;for(const K in r)if(!(K==="interface"||K==="method"||K==="protocol")){const Y={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:K},message:"must NOT have additional properties"};s===null?s=[Y]:s.push(Y),a++;break}if(z===a){if(r.interface!==void 0){const K=a;if(r.interface!=="Messages"){const Y={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};s===null?s=[Y]:s.push(Y),a++}var b=K===a}else var b=!0;if(b){if(r.method!==void 0){const K=a;if(r.method!=="Subscribe"){const I={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};s===null?s=[I]:s.push(I),a++}var b=K===a}else var b=!0;if(b)if(r.protocol!==void 0){const K=a;if(typeof r.protocol!="string"){const I={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var b=K===a}else var b=!0}}}}else{const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[R]:s.push(R),a++}var m=W===a;if(m&&c)c=!1,u=[u,2];else{m&&(c=!0,u=2,y!==!0&&(y=!0));const R=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let Y;if(r.interface===void 0&&(Y="interface")||r.method===void 0&&(Y="method")){const I={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/required",keyword:"required",params:{missingProperty:Y},message:"must have required property '"+Y+"'"};s===null?s=[I]:s.push(I),a++}else{const I=a;for(const D in r)if(!(D==="interface"||D==="method"||D==="protocol")){const N={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:D},message:"must NOT have additional properties"};s===null?s=[N]:s.push(N),a++;break}if(I===a){if(r.interface!==void 0){const D=a;if(r.interface!=="Protocols"){const N={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};s===null?s=[N]:s.push(N),a++}var _=D===a}else var _=!0;if(_){if(r.method!==void 0){const D=a;if(r.method!=="Configure"){const V={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/method/const",keyword:"const",params:{allowedValue:"Configure"},message:"must be equal to constant"};s===null?s=[V]:s.push(V),a++}var _=D===a}else var _=!0;if(_)if(r.protocol!==void 0){const D=a;if(typeof r.protocol!="string"){const V={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[V]:s.push(V),a++}var _=D===a}else var _=!0}}}}else{const Y={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[Y]:s.push(Y),a++}var m=R===a;if(m&&c)c=!1,u=[u,3];else{m&&(c=!0,u=3,y!==!0&&(y=!0));const Y=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let N;if(r.interface===void 0&&(N="interface")||r.method===void 0&&(N="method")){const V={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/required",keyword:"required",params:{missingProperty:N},message:"must have required property '"+N+"'"};s===null?s=[V]:s.push(V),a++}else{const V=a;for(const J in r)if(!(J==="interface"||J==="method"||J==="protocol")){const j={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:J},message:"must NOT have additional properties"};s===null?s=[j]:s.push(j),a++;break}if(V===a){if(r.interface!==void 0){const J=a;if(r.interface!=="Protocols"){const j={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};s===null?s=[j]:s.push(j),a++}var E=J===a}else var E=!0;if(E){if(r.method!==void 0){const J=a;if(r.method!=="Query"){const G={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};s===null?s=[G]:s.push(G),a++}var E=J===a}else var E=!0;if(E)if(r.protocol!==void 0){const J=a;if(typeof r.protocol!="string"){const G={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[G]:s.push(G),a++}var E=J===a}else var E=!0}}}}else{const N={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[N]:s.push(N),a++}var m=Y===a;if(m&&c)c=!1,u=[u,4];else{m&&(c=!0,u=4,y!==!0&&(y=!0));const N=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let j;if(r.interface===void 0&&(j="interface")||r.method===void 0&&(j="method")){const G={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/required",keyword:"required",params:{missingProperty:j},message:"must have required property '"+j+"'"};s===null?s=[G]:s.push(G),a++}else{const G=a;for(const C in r)if(!(C==="interface"||C==="method"||C==="protocol"||C==="contextId"||C==="protocolPath")){const F={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:C},message:"must NOT have additional properties"};s===null?s=[F]:s.push(F),a++;break}if(G===a){if(r.interface!==void 0){const C=a;if(r.interface!=="Records"){const F={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[F]:s.push(F),a++}var S=C===a}else var S=!0;if(S){if(r.method!==void 0){const C=a;if(r.method!=="Read"){const Z={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0;if(S){if(r.protocol!==void 0){const C=a;if(typeof r.protocol!="string"){const Z={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0;if(S){if(r.contextId!==void 0){const C=a;if(typeof r.contextId!="string"){const Z={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0;if(S)if(r.protocolPath!==void 0){const C=a;if(typeof r.protocolPath!="string"){const Z={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0}}}}}}else{const j={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[j]:s.push(j),a++}var m=N===a;if(m&&c)c=!1,u=[u,5];else{m&&(c=!0,u=5,y!==!0&&(y=!0));const j=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let F;if(r.interface===void 0&&(F="interface")||r.method===void 0&&(F="method")){const Z={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/required",keyword:"required",params:{missingProperty:F},message:"must have required property '"+F+"'"};s===null?s=[Z]:s.push(Z),a++}else{const Z=a;for(const te in r)if(!(te==="interface"||te==="method"||te==="protocol"||te==="contextId"||te==="protocolPath")){const re={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:te},message:"must NOT have additional properties"};s===null?s=[re]:s.push(re),a++;break}if(Z===a){if(r.interface!==void 0){const te=a;if(r.interface!=="Records"){const re={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[re]:s.push(re),a++}var T=te===a}else var T=!0;if(T){if(r.method!==void 0){const te=a;if(r.method!=="Delete"){const q={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/method/const",keyword:"const",params:{allowedValue:"Delete"},message:"must be equal to constant"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0;if(T){if(r.protocol!==void 0){const te=a;if(typeof r.protocol!="string"){const q={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0;if(T){if(r.contextId!==void 0){const te=a;if(typeof r.contextId!="string"){const q={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0;if(T)if(r.protocolPath!==void 0){const te=a;if(typeof r.protocolPath!="string"){const q={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0}}}}}}else{const F={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[F]:s.push(F),a++}var m=j===a;if(m&&c)c=!1,u=[u,6];else{m&&(c=!0,u=6,y!==!0&&(y=!0));const F=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let re;if(r.interface===void 0&&(re="interface")||r.method===void 0&&(re="method")){const q={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/required",keyword:"required",params:{missingProperty:re},message:"must have required property '"+re+"'"};s===null?s=[q]:s.push(q),a++}else{const q=a;for(const L in r)if(!(L==="interface"||L==="method"||L==="protocol"||L==="contextId"||L==="protocolPath")){const k={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:L},message:"must NOT have additional properties"};s===null?s=[k]:s.push(k),a++;break}if(q===a){if(r.interface!==void 0){const L=a;if(r.interface!=="Records"){const k={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[k]:s.push(k),a++}var O=L===a}else var O=!0;if(O){if(r.method!==void 0){const L=a;if(r.method!=="Write"){const B={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/method/const",keyword:"const",params:{allowedValue:"Write"},message:"must be equal to constant"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0;if(O){if(r.protocol!==void 0){const L=a;if(typeof r.protocol!="string"){const B={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0;if(O){if(r.contextId!==void 0){const L=a;if(typeof r.contextId!="string"){const B={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0;if(O)if(r.protocolPath!==void 0){const L=a;if(typeof r.protocolPath!="string"){const B={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0}}}}}}else{const re={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[re]:s.push(re),a++}var m=F===a;if(m&&c)c=!1,u=[u,7];else{m&&(c=!0,u=7,y!==!0&&(y=!0));const re=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let k;if(r.interface===void 0&&(k="interface")||r.method===void 0&&(k="method")){const B={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/required",keyword:"required",params:{missingProperty:k},message:"must have required property '"+k+"'"};s===null?s=[B]:s.push(B),a++}else{const B=a;for(const X in r)if(!(X==="interface"||X==="method"||X==="protocol"||X==="contextId"||X==="protocolPath")){const ne={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:X},message:"must NOT have additional properties"};s===null?s=[ne]:s.push(ne),a++;break}if(B===a){if(r.interface!==void 0){const X=a;if(r.interface!=="Records"){const ne={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[ne]:s.push(ne),a++}var M=X===a}else var M=!0;if(M){if(r.method!==void 0){const X=a;if(r.method!=="Query"){const ae={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0;if(M){if(r.protocol!==void 0){const X=a;if(typeof r.protocol!="string"){const ae={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0;if(M){if(r.contextId!==void 0){const X=a;if(typeof r.contextId!="string"){const ae={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0;if(M)if(r.protocolPath!==void 0){const X=a;if(typeof r.protocolPath!="string"){const ae={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0}}}}}}else{const k={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[k]:s.push(k),a++}var m=re===a;if(m&&c)c=!1,u=[u,8];else{m&&(c=!0,u=8,y!==!0&&(y=!0));const k=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let ne;if(r.interface===void 0&&(ne="interface")||r.method===void 0&&(ne="method")){const ae={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/required",keyword:"required",params:{missingProperty:ne},message:"must have required property '"+ne+"'"};s===null?s=[ae]:s.push(ae),a++}else{const ae=a;for(const ye in r)if(!(ye==="interface"||ye==="method"||ye==="protocol"||ye==="contextId"||ye==="protocolPath")){const _e={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ye},message:"must NOT have additional properties"};s===null?s=[_e]:s.push(_e),a++;break}if(ae===a){if(r.interface!==void 0){const ye=a;if(r.interface!=="Records"){const _e={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[_e]:s.push(_e),a++}var Q=ye===a}else var Q=!0;if(Q){if(r.method!==void 0){const ye=a;if(r.method!=="Subscribe"){const $e={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0;if(Q){if(r.protocol!==void 0){const ye=a;if(typeof r.protocol!="string"){const $e={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0;if(Q){if(r.contextId!==void 0){const ye=a;if(typeof r.contextId!="string"){const $e={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0;if(Q)if(r.protocolPath!==void 0){const ye=a;if(typeof r.protocolPath!="string"){const $e={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0}}}}}}else{const ne={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[ne]:s.push(ne),a++}var m=k===a;m&&c?(c=!1,u=[u,9]):m&&(c=!0,u=9,y!==!0&&(y=!0))}}}}}}}}if(c)a=d,s!==null&&(d?s.length=d:s=null);else{const W={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:u},message:"must match exactly one schema in oneOf"};return s===null?s=[W]:s.push(W),a++,oy.errors=s,!1}return oy.errors=s,l.props=y,a===0}oy.evaluated={dynamicProps:!0,dynamicItems:!1};function Ro(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Ro.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let c;if(r.dateExpires===void 0&&(c="dateExpires")||r.scope===void 0&&(c="scope"))return Ro.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;{const u=a;for(const f in r)if(!(f==="description"||f==="dateExpires"||f==="requestId"||f==="delegated"||f==="scope"||f==="conditions"))return Ro.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:f},message:"must NOT have additional properties"}],!1;if(u===a){if(r.description!==void 0){const f=a;if(typeof r.description!="string")return Ro.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=f===a}else var d=!0;if(d){if(r.dateExpires!==void 0){let f=r.dateExpires;const h=a;if(a===a)if(typeof f=="string"){if(!ri.test(f))return Ro.errors=[{instancePath:e+"/dateExpires",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return Ro.errors=[{instancePath:e+"/dateExpires",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=h===a}else var d=!0;if(d){if(r.requestId!==void 0){const f=a;if(typeof r.requestId!="string")return Ro.errors=[{instancePath:e+"/requestId",schemaPath:"#/properties/requestId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=f===a}else var d=!0;if(d){if(r.delegated!==void 0){const f=a;if(typeof r.delegated!="boolean")return Ro.errors=[{instancePath:e+"/delegated",schemaPath:"#/properties/delegated/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var d=f===a}else var d=!0;if(d){if(r.scope!==void 0){const f=a;oy(r.scope,{instancePath:e+"/scope",parentData:r,parentDataProperty:"scope",rootData:i,dynamicAnchors:o})||(s=s===null?oy.errors:s.concat(oy.errors),a=s.length);var d=f===a}else var d=!0;if(d)if(r.conditions!==void 0){let f=r.conditions;const h=a;if(a===a)if(f&&typeof f=="object"&&!Array.isArray(f)){const g=a;for(const w in f)if(w!=="publication")return Ro.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:w},message:"must NOT have additional properties"}],!1;if(g===a&&f.publication!==void 0){let w=f.publication;if(typeof w!="string")return Ro.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(w==="Required"||w==="Prohibited"))return Ro.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/enum",keyword:"enum",params:{allowedValues:zK.properties.publication.enum},message:"must be equal to one of the allowed values"}],!1}}else return Ro.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=h===a}else var d=!0}}}}}}}else return Ro.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Ro.errors=s,a===0}Ro.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const gre=Xs;function sy(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=sy.evaluated;l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0);const d=a;let c=!1,u=null;const f=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let W;if(r.interface===void 0&&(W="interface")||r.method===void 0&&(W="method")){const U={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/required",keyword:"required",params:{missingProperty:W},message:"must have required property '"+W+"'"};s===null?s=[U]:s.push(U),a++}else{const U=a;for(const ee in r)if(!(ee==="interface"||ee==="method"||ee==="protocol")){const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ee},message:"must NOT have additional properties"};s===null?s=[R]:s.push(R),a++;break}if(U===a){if(r.interface!==void 0){const ee=a;if(r.interface!=="Messages"){const R={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};s===null?s=[R]:s.push(R),a++}var p=ee===a}else var p=!0;if(p){if(r.method!==void 0){const ee=a;if(r.method!=="Query"){const z={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};s===null?s=[z]:s.push(z),a++}var p=ee===a}else var p=!0;if(p)if(r.protocol!==void 0){const ee=a;if(typeof r.protocol!="string"){const z={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[z]:s.push(z),a++}var p=ee===a}else var p=!0}}}}else{const W={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[W]:s.push(W),a++}var m=f===a;if(m){c=!0,u=0;var y=!0}const g=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let W;if(r.interface===void 0&&(W="interface")||r.method===void 0&&(W="method")){const U={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/required",keyword:"required",params:{missingProperty:W},message:"must have required property '"+W+"'"};s===null?s=[U]:s.push(U),a++}else{const U=a;for(const ee in r)if(!(ee==="interface"||ee==="method"||ee==="protocol")){const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ee},message:"must NOT have additional properties"};s===null?s=[R]:s.push(R),a++;break}if(U===a){if(r.interface!==void 0){const ee=a;if(r.interface!=="Messages"){const R={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};s===null?s=[R]:s.push(R),a++}var v=ee===a}else var v=!0;if(v){if(r.method!==void 0){const ee=a;if(r.method!=="Read"){const z={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};s===null?s=[z]:s.push(z),a++}var v=ee===a}else var v=!0;if(v)if(r.protocol!==void 0){const ee=a;if(typeof r.protocol!="string"){const z={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[z]:s.push(z),a++}var v=ee===a}else var v=!0}}}}else{const W={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[W]:s.push(W),a++}var m=g===a;if(m&&c)c=!1,u=[u,1];else{m&&(c=!0,u=1,y!==!0&&(y=!0));const W=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let R;if(r.interface===void 0&&(R="interface")||r.method===void 0&&(R="method")){const z={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/required",keyword:"required",params:{missingProperty:R},message:"must have required property '"+R+"'"};s===null?s=[z]:s.push(z),a++}else{const z=a;for(const K in r)if(!(K==="interface"||K==="method"||K==="protocol")){const Y={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:K},message:"must NOT have additional properties"};s===null?s=[Y]:s.push(Y),a++;break}if(z===a){if(r.interface!==void 0){const K=a;if(r.interface!=="Messages"){const Y={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};s===null?s=[Y]:s.push(Y),a++}var b=K===a}else var b=!0;if(b){if(r.method!==void 0){const K=a;if(r.method!=="Subscribe"){const I={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};s===null?s=[I]:s.push(I),a++}var b=K===a}else var b=!0;if(b)if(r.protocol!==void 0){const K=a;if(typeof r.protocol!="string"){const I={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[I]:s.push(I),a++}var b=K===a}else var b=!0}}}}else{const R={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[R]:s.push(R),a++}var m=W===a;if(m&&c)c=!1,u=[u,2];else{m&&(c=!0,u=2,y!==!0&&(y=!0));const R=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let Y;if(r.interface===void 0&&(Y="interface")||r.method===void 0&&(Y="method")){const I={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/required",keyword:"required",params:{missingProperty:Y},message:"must have required property '"+Y+"'"};s===null?s=[I]:s.push(I),a++}else{const I=a;for(const D in r)if(!(D==="interface"||D==="method"||D==="protocol")){const N={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:D},message:"must NOT have additional properties"};s===null?s=[N]:s.push(N),a++;break}if(I===a){if(r.interface!==void 0){const D=a;if(r.interface!=="Protocols"){const N={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};s===null?s=[N]:s.push(N),a++}var _=D===a}else var _=!0;if(_){if(r.method!==void 0){const D=a;if(r.method!=="Configure"){const V={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/method/const",keyword:"const",params:{allowedValue:"Configure"},message:"must be equal to constant"};s===null?s=[V]:s.push(V),a++}var _=D===a}else var _=!0;if(_)if(r.protocol!==void 0){const D=a;if(typeof r.protocol!="string"){const V={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[V]:s.push(V),a++}var _=D===a}else var _=!0}}}}else{const Y={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[Y]:s.push(Y),a++}var m=R===a;if(m&&c)c=!1,u=[u,3];else{m&&(c=!0,u=3,y!==!0&&(y=!0));const Y=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let N;if(r.interface===void 0&&(N="interface")||r.method===void 0&&(N="method")){const V={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/required",keyword:"required",params:{missingProperty:N},message:"must have required property '"+N+"'"};s===null?s=[V]:s.push(V),a++}else{const V=a;for(const J in r)if(!(J==="interface"||J==="method"||J==="protocol")){const j={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:J},message:"must NOT have additional properties"};s===null?s=[j]:s.push(j),a++;break}if(V===a){if(r.interface!==void 0){const J=a;if(r.interface!=="Protocols"){const j={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};s===null?s=[j]:s.push(j),a++}var E=J===a}else var E=!0;if(E){if(r.method!==void 0){const J=a;if(r.method!=="Query"){const G={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};s===null?s=[G]:s.push(G),a++}var E=J===a}else var E=!0;if(E)if(r.protocol!==void 0){const J=a;if(typeof r.protocol!="string"){const G={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[G]:s.push(G),a++}var E=J===a}else var E=!0}}}}else{const N={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[N]:s.push(N),a++}var m=Y===a;if(m&&c)c=!1,u=[u,4];else{m&&(c=!0,u=4,y!==!0&&(y=!0));const N=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let j;if(r.interface===void 0&&(j="interface")||r.method===void 0&&(j="method")){const G={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/required",keyword:"required",params:{missingProperty:j},message:"must have required property '"+j+"'"};s===null?s=[G]:s.push(G),a++}else{const G=a;for(const C in r)if(!(C==="interface"||C==="method"||C==="protocol"||C==="contextId"||C==="protocolPath")){const F={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:C},message:"must NOT have additional properties"};s===null?s=[F]:s.push(F),a++;break}if(G===a){if(r.interface!==void 0){const C=a;if(r.interface!=="Records"){const F={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[F]:s.push(F),a++}var S=C===a}else var S=!0;if(S){if(r.method!==void 0){const C=a;if(r.method!=="Read"){const Z={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0;if(S){if(r.protocol!==void 0){const C=a;if(typeof r.protocol!="string"){const Z={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0;if(S){if(r.contextId!==void 0){const C=a;if(typeof r.contextId!="string"){const Z={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0;if(S)if(r.protocolPath!==void 0){const C=a;if(typeof r.protocolPath!="string"){const Z={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var S=C===a}else var S=!0}}}}}}else{const j={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[j]:s.push(j),a++}var m=N===a;if(m&&c)c=!1,u=[u,5];else{m&&(c=!0,u=5,y!==!0&&(y=!0));const j=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let F;if(r.interface===void 0&&(F="interface")||r.method===void 0&&(F="method")){const Z={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/required",keyword:"required",params:{missingProperty:F},message:"must have required property '"+F+"'"};s===null?s=[Z]:s.push(Z),a++}else{const Z=a;for(const te in r)if(!(te==="interface"||te==="method"||te==="protocol"||te==="contextId"||te==="protocolPath")){const re={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:te},message:"must NOT have additional properties"};s===null?s=[re]:s.push(re),a++;break}if(Z===a){if(r.interface!==void 0){const te=a;if(r.interface!=="Records"){const re={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[re]:s.push(re),a++}var T=te===a}else var T=!0;if(T){if(r.method!==void 0){const te=a;if(r.method!=="Delete"){const q={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/method/const",keyword:"const",params:{allowedValue:"Delete"},message:"must be equal to constant"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0;if(T){if(r.protocol!==void 0){const te=a;if(typeof r.protocol!="string"){const q={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0;if(T){if(r.contextId!==void 0){const te=a;if(typeof r.contextId!="string"){const q={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0;if(T)if(r.protocolPath!==void 0){const te=a;if(typeof r.protocolPath!="string"){const q={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[q]:s.push(q),a++}var T=te===a}else var T=!0}}}}}}else{const F={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[F]:s.push(F),a++}var m=j===a;if(m&&c)c=!1,u=[u,6];else{m&&(c=!0,u=6,y!==!0&&(y=!0));const F=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let re;if(r.interface===void 0&&(re="interface")||r.method===void 0&&(re="method")){const q={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/required",keyword:"required",params:{missingProperty:re},message:"must have required property '"+re+"'"};s===null?s=[q]:s.push(q),a++}else{const q=a;for(const L in r)if(!(L==="interface"||L==="method"||L==="protocol"||L==="contextId"||L==="protocolPath")){const k={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:L},message:"must NOT have additional properties"};s===null?s=[k]:s.push(k),a++;break}if(q===a){if(r.interface!==void 0){const L=a;if(r.interface!=="Records"){const k={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[k]:s.push(k),a++}var O=L===a}else var O=!0;if(O){if(r.method!==void 0){const L=a;if(r.method!=="Write"){const B={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/method/const",keyword:"const",params:{allowedValue:"Write"},message:"must be equal to constant"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0;if(O){if(r.protocol!==void 0){const L=a;if(typeof r.protocol!="string"){const B={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0;if(O){if(r.contextId!==void 0){const L=a;if(typeof r.contextId!="string"){const B={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0;if(O)if(r.protocolPath!==void 0){const L=a;if(typeof r.protocolPath!="string"){const B={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[B]:s.push(B),a++}var O=L===a}else var O=!0}}}}}}else{const re={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[re]:s.push(re),a++}var m=F===a;if(m&&c)c=!1,u=[u,7];else{m&&(c=!0,u=7,y!==!0&&(y=!0));const re=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let k;if(r.interface===void 0&&(k="interface")||r.method===void 0&&(k="method")){const B={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/required",keyword:"required",params:{missingProperty:k},message:"must have required property '"+k+"'"};s===null?s=[B]:s.push(B),a++}else{const B=a;for(const X in r)if(!(X==="interface"||X==="method"||X==="protocol"||X==="contextId"||X==="protocolPath")){const ne={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:X},message:"must NOT have additional properties"};s===null?s=[ne]:s.push(ne),a++;break}if(B===a){if(r.interface!==void 0){const X=a;if(r.interface!=="Records"){const ne={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[ne]:s.push(ne),a++}var M=X===a}else var M=!0;if(M){if(r.method!==void 0){const X=a;if(r.method!=="Query"){const ae={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0;if(M){if(r.protocol!==void 0){const X=a;if(typeof r.protocol!="string"){const ae={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0;if(M){if(r.contextId!==void 0){const X=a;if(typeof r.contextId!="string"){const ae={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0;if(M)if(r.protocolPath!==void 0){const X=a;if(typeof r.protocolPath!="string"){const ae={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ae]:s.push(ae),a++}var M=X===a}else var M=!0}}}}}}else{const k={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[k]:s.push(k),a++}var m=re===a;if(m&&c)c=!1,u=[u,8];else{m&&(c=!0,u=8,y!==!0&&(y=!0));const k=a;if(a===a)if(r&&typeof r=="object"&&!Array.isArray(r)){let ne;if(r.interface===void 0&&(ne="interface")||r.method===void 0&&(ne="method")){const ae={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/required",keyword:"required",params:{missingProperty:ne},message:"must have required property '"+ne+"'"};s===null?s=[ae]:s.push(ae),a++}else{const ae=a;for(const ye in r)if(!(ye==="interface"||ye==="method"||ye==="protocol"||ye==="contextId"||ye==="protocolPath")){const _e={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ye},message:"must NOT have additional properties"};s===null?s=[_e]:s.push(_e),a++;break}if(ae===a){if(r.interface!==void 0){const ye=a;if(r.interface!=="Records"){const _e={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};s===null?s=[_e]:s.push(_e),a++}var Q=ye===a}else var Q=!0;if(Q){if(r.method!==void 0){const ye=a;if(r.method!=="Subscribe"){const $e={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0;if(Q){if(r.protocol!==void 0){const ye=a;if(typeof r.protocol!="string"){const $e={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0;if(Q){if(r.contextId!==void 0){const ye=a;if(typeof r.contextId!="string"){const $e={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0;if(Q)if(r.protocolPath!==void 0){const ye=a;if(typeof r.protocolPath!="string"){const $e={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[$e]:s.push($e),a++}var Q=ye===a}else var Q=!0}}}}}}else{const ne={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};s===null?s=[ne]:s.push(ne),a++}var m=k===a;m&&c?(c=!1,u=[u,9]):m&&(c=!0,u=9,y!==!0&&(y=!0))}}}}}}}}if(c)a=d,s!==null&&(d?s.length=d:s=null);else{const W={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:u},message:"must match exactly one schema in oneOf"};return s===null?s=[W]:s.push(W),a++,sy.errors=s,!1}return sy.errors=s,l.props=y,a===0}sy.evaluated={dynamicProps:!0,dynamicItems:!1};function Xs(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Xs.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let c;if(r.delegated===void 0&&(c="delegated")||r.scope===void 0&&(c="scope"))return Xs.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;{const u=a;for(const f in r)if(!(f==="description"||f==="delegated"||f==="scope"||f==="conditions"))return Xs.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:f},message:"must NOT have additional properties"}],!1;if(u===a){if(r.description!==void 0){const f=a;if(typeof r.description!="string")return Xs.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=f===a}else var d=!0;if(d){if(r.delegated!==void 0){const f=a;if(typeof r.delegated!="boolean")return Xs.errors=[{instancePath:e+"/delegated",schemaPath:"#/properties/delegated/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var d=f===a}else var d=!0;if(d){if(r.scope!==void 0){const f=a;sy(r.scope,{instancePath:e+"/scope",parentData:r,parentDataProperty:"scope",rootData:i,dynamicAnchors:o})||(s=s===null?sy.errors:s.concat(sy.errors),a=s.length);var d=f===a}else var d=!0;if(d)if(r.conditions!==void 0){let f=r.conditions;const h=a;if(a===a)if(f&&typeof f=="object"&&!Array.isArray(f)){const g=a;for(const w in f)if(w!=="publication")return Xs.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:w},message:"must NOT have additional properties"}],!1;if(g===a&&f.publication!==void 0){let w=f.publication;if(typeof w!="string")return Xs.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(w==="Required"||w==="Prohibited"))return Xs.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/enum",keyword:"enum",params:{allowedValues:zK.properties.publication.enum},message:"must be equal to one of the allowed values"}],!1}}else return Xs.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=h===a}else var d=!0}}}}}else return Xs.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Xs.errors=s,a===0}Xs.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const vre=Op;function Op(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Op.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)){for(const d in r)if(d!=="description")return Op.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:d},message:"must NOT have additional properties"}],!1;if(r.description!==void 0&&typeof r.description!="string")return Op.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1}else return Op.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Op.errors=s,a===0}Op.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const bre=Fb;function Fb(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Fb.evaluated;return l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)?(Fb.errors=s,a===0):(Fb.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}Fb.evaluated={dynamicProps:!1,dynamicItems:!1};const wre=qb;function qb(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=qb.evaluated;return l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)?(qb.errors=s,a===0):(qb.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}qb.evaluated={dynamicProps:!1,dynamicItems:!1};const _re=Jn,Q3=new RegExp(".*","u"),mm={$id:"https://identity.foundation/dwn/json-schemas/protocol-rule-set.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",additionalProperties:!1,properties:{$encryption:{type:"object",additionalProperties:!1,properties:{rootKeyId:{type:"string"},publicKeyJwk:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"}},required:["rootKeyId","publicKeyJwk"]},$actions:{type:"array",minItems:1,items:{type:"object",oneOf:[{required:["who","can"],additionalProperties:!1,properties:{who:{type:"string",enum:["anyone","author","recipient"]},of:{type:"string"},can:{type:"array",minItems:1,items:{type:"string",enum:["co-delete","co-prune","co-update","create","delete","prune","read","update"]}}}},{required:["role","can"],properties:{role:{$comment:"Must be the protocol path of a role record type",type:"string"},can:{type:"array",minItems:1,items:{type:"string",enum:["co-delete","co-update","create","delete","query","subscribe","read","update"]}}}}]}},$role:{$comment:"When `true`, this turns a record into `role` that may be used within a context/sub-context",type:"boolean"},$size:{type:"object",additionalProperties:!1,properties:{min:{type:"number",minimum:0},max:{type:"number",minimum:0}}},$tags:{type:"object",minProperties:1,properties:{$requiredTags:{type:"array",items:{type:"string"}},$allowUndefinedTags:{type:"boolean"}},patternProperties:{"^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$":{type:"object",additionalProperties:!1,properties:{type:{enum:["string","number","integer","boolean","array"]},items:{type:"object",properties:{type:{enum:["string","number","integer"]}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$":{}}},contains:{type:"object",properties:{type:{enum:["string","number","integer"]}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$":{}}}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength|minItems|maxItems|uniqueItems|minContains|maxContains)$":{}}}}}},patternProperties:{"^[^$].*$":{$ref:"https://identity.foundation/dwn/json-schemas/protocol-rule-set.json"}}},eM=new RegExp("^[^$].*$","u"),Ere=new RegExp("^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$","u"),Are=new RegExp("^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength|minItems|maxItems|uniqueItems|minContains|maxContains)$","u"),tM=new RegExp("^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$","u"),kT={validate:sr};function sr(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=sr.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){const W=a;for(const U in r)if(!(U==="$encryption"||U==="$actions"||U==="$role"||U==="$size"||U==="$tags"||eM.test(U)))return sr.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:U},message:"must NOT have additional properties"}],!1;if(W===a){if(r.$encryption!==void 0){let U=r.$encryption;const ee=a;if(a===ee)if(U&&typeof U=="object"&&!Array.isArray(U)){let R;if(U.rootKeyId===void 0&&(R="rootKeyId")||U.publicKeyJwk===void 0&&(R="publicKeyJwk"))return sr.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/required",keyword:"required",params:{missingProperty:R},message:"must have required property '"+R+"'"}],!1;{const z=a;for(const K in U)if(!(K==="rootKeyId"||K==="publicKeyJwk"))return sr.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:K},message:"must NOT have additional properties"}],!1;if(z===a){if(U.rootKeyId!==void 0){const K=a;if(typeof U.rootKeyId!="string")return sr.errors=[{instancePath:e+"/$encryption/rootKeyId",schemaPath:"#/properties/%24encryption/properties/rootKeyId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=K===a}else var d=!0;if(d)if(U.publicKeyJwk!==void 0){const K=a;Pr(U.publicKeyJwk,{instancePath:e+"/$encryption/publicKeyJwk",parentData:U,parentDataProperty:"publicKeyJwk",rootData:i,dynamicAnchors:o})||(s=s===null?Pr.errors:s.concat(Pr.errors),a=s.length);var d=K===a}else var d=!0}}}else return sr.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=ee===a}else var c=!0;if(c){if(r.$actions!==void 0){let U=r.$actions;const ee=a;if(a===ee)if(Array.isArray(U)){if(U.length<1)return sr.errors=[{instancePath:e+"/$actions",schemaPath:"#/properties/%24actions/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var u=!0;const z=U.length;for(let K=0;K<z;K++){let Y=U[K];const I=a;if(!(Y&&typeof Y=="object"&&!Array.isArray(Y)))return sr.errors=[{instancePath:e+"/$actions/"+K,schemaPath:"#/properties/%24actions/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;const D=a;let N=!1,V=null;const J=a;if(Y&&typeof Y=="object"&&!Array.isArray(Y)){let C;if(Y.who===void 0&&(C="who")||Y.can===void 0&&(C="can")){const F={instancePath:e+"/$actions/"+K,schemaPath:"#/properties/%24actions/items/oneOf/0/required",keyword:"required",params:{missingProperty:C},message:"must have required property '"+C+"'"};s===null?s=[F]:s.push(F),a++}else{const F=a;for(const Z in Y)if(!(Z==="who"||Z==="of"||Z==="can")){const te={instancePath:e+"/$actions/"+K,schemaPath:"#/properties/%24actions/items/oneOf/0/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Z},message:"must NOT have additional properties"};s===null?s=[te]:s.push(te),a++;break}if(F===a){if(Y.who!==void 0){let Z=Y.who;const te=a;if(typeof Z!="string"){const re={instancePath:e+"/$actions/"+K+"/who",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/who/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[re]:s.push(re),a++}if(!(Z==="anyone"||Z==="author"||Z==="recipient")){const re={instancePath:e+"/$actions/"+K+"/who",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/who/enum",keyword:"enum",params:{allowedValues:mm.properties.$actions.items.oneOf[0].properties.who.enum},message:"must be equal to one of the allowed values"};s===null?s=[re]:s.push(re),a++}var f=te===a}else var f=!0;if(f){if(Y.of!==void 0){const Z=a;if(typeof Y.of!="string"){const re={instancePath:e+"/$actions/"+K+"/of",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/of/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[re]:s.push(re),a++}var f=Z===a}else var f=!0;if(f)if(Y.can!==void 0){let Z=Y.can;const te=a;if(a===te)if(Array.isArray(Z))if(Z.length<1){const q={instancePath:e+"/$actions/"+K+"/can",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};s===null?s=[q]:s.push(q),a++}else{var h=!0;const q=Z.length;for(let L=0;L<q;L++){let k=Z[L];const B=a;if(typeof k!="string"){const ne={instancePath:e+"/$actions/"+K+"/can/"+L,schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/items/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[ne]:s.push(ne),a++}if(!(k==="co-delete"||k==="co-prune"||k==="co-update"||k==="create"||k==="delete"||k==="prune"||k==="read"||k==="update")){const ne={instancePath:e+"/$actions/"+K+"/can/"+L,schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/items/enum",keyword:"enum",params:{allowedValues:mm.properties.$actions.items.oneOf[0].properties.can.items.enum},message:"must be equal to one of the allowed values"};s===null?s=[ne]:s.push(ne),a++}var h=B===a;if(!h)break}}else{const q={instancePath:e+"/$actions/"+K+"/can",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/type",keyword:"type",params:{type:"array"},message:"must be array"};s===null?s=[q]:s.push(q),a++}var f=te===a}else var f=!0}}}}var w=J===a;if(w){N=!0,V=0;var p=!0}const j=a;if(Y&&typeof Y=="object"&&!Array.isArray(Y)){let C;if(Y.role===void 0&&(C="role")||Y.can===void 0&&(C="can")){const F={instancePath:e+"/$actions/"+K,schemaPath:"#/properties/%24actions/items/oneOf/1/required",keyword:"required",params:{missingProperty:C},message:"must have required property '"+C+"'"};s===null?s=[F]:s.push(F),a++}else{if(Y.role!==void 0){const F=a;if(typeof Y.role!="string"){const Z={instancePath:e+"/$actions/"+K+"/role",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/role/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[Z]:s.push(Z),a++}var y=F===a}else var y=!0;if(y)if(Y.can!==void 0){let F=Y.can;const Z=a;if(a===Z)if(Array.isArray(F))if(F.length<1){const re={instancePath:e+"/$actions/"+K+"/can",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};s===null?s=[re]:s.push(re),a++}else{var g=!0;const re=F.length;for(let q=0;q<re;q++){let L=F[q];const k=a;if(typeof L!="string"){const X={instancePath:e+"/$actions/"+K+"/can/"+q,schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/items/type",keyword:"type",params:{type:"string"},message:"must be string"};s===null?s=[X]:s.push(X),a++}if(!(L==="co-delete"||L==="co-update"||L==="create"||L==="delete"||L==="query"||L==="subscribe"||L==="read"||L==="update")){const X={instancePath:e+"/$actions/"+K+"/can/"+q,schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/items/enum",keyword:"enum",params:{allowedValues:mm.properties.$actions.items.oneOf[1].properties.can.items.enum},message:"must be equal to one of the allowed values"};s===null?s=[X]:s.push(X),a++}var g=k===a;if(!g)break}}else{const re={instancePath:e+"/$actions/"+K+"/can",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/type",keyword:"type",params:{type:"array"},message:"must be array"};s===null?s=[re]:s.push(re),a++}var y=Z===a}else var y=!0}}var w=j===a;if(w&&N?(N=!1,V=[V,1]):w&&(N=!0,V=1,p!==!0&&(p=p||{},p.role=!0,p.can=!0)),N)a=D,s!==null&&(D?s.length=D:s=null);else{const C={instancePath:e+"/$actions/"+K,schemaPath:"#/properties/%24actions/items/oneOf",keyword:"oneOf",params:{passingSchemas:V},message:"must match exactly one schema in oneOf"};return s===null?s=[C]:s.push(C),a++,sr.errors=s,!1}var u=I===a;if(!u)break}}}else return sr.errors=[{instancePath:e+"/$actions",schemaPath:"#/properties/%24actions/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var c=ee===a}else var c=!0;if(c){if(r.$role!==void 0){const U=a;if(typeof r.$role!="boolean")return sr.errors=[{instancePath:e+"/$role",schemaPath:"#/properties/%24role/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var c=U===a}else var c=!0;if(c){if(r.$size!==void 0){let U=r.$size;const ee=a;if(a===ee)if(U&&typeof U=="object"&&!Array.isArray(U)){const z=a;for(const K in U)if(!(K==="min"||K==="max"))return sr.errors=[{instancePath:e+"/$size",schemaPath:"#/properties/%24size/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:K},message:"must NOT have additional properties"}],!1;if(z===a){if(U.min!==void 0){let K=U.min;const Y=a;if(a===Y)if(typeof K=="number"&&isFinite(K)){if(K<0||isNaN(K))return sr.errors=[{instancePath:e+"/$size/min",schemaPath:"#/properties/%24size/properties/min/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1}else return sr.errors=[{instancePath:e+"/$size/min",schemaPath:"#/properties/%24size/properties/min/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var v=Y===a}else var v=!0;if(v)if(U.max!==void 0){let K=U.max;const Y=a;if(a===Y)if(typeof K=="number"&&isFinite(K)){if(K<0||isNaN(K))return sr.errors=[{instancePath:e+"/$size/max",schemaPath:"#/properties/%24size/properties/max/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1}else return sr.errors=[{instancePath:e+"/$size/max",schemaPath:"#/properties/%24size/properties/max/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var v=Y===a}else var v=!0}}else return sr.errors=[{instancePath:e+"/$size",schemaPath:"#/properties/%24size/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=ee===a}else var c=!0;if(c){if(r.$tags!==void 0){let U=r.$tags;const ee=a;if(a===ee)if(U&&typeof U=="object"&&!Array.isArray(U)){if(Object.keys(U).length<1)return sr.errors=[{instancePath:e+"/$tags",schemaPath:"#/properties/%24tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;if(U.$requiredTags!==void 0){let z=U.$requiredTags;const K=a;if(a===K)if(Array.isArray(z)){var m=!0;const Y=z.length;for(let I=0;I<Y;I++){const D=a;if(typeof z[I]!="string")return sr.errors=[{instancePath:e+"/$tags/$requiredTags/"+I,schemaPath:"#/properties/%24tags/properties/%24requiredTags/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var m=D===a;if(!m)break}}else return sr.errors=[{instancePath:e+"/$tags/$requiredTags",schemaPath:"#/properties/%24tags/properties/%24requiredTags/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var b=K===a}else var b=!0;if(b){if(U.$allowUndefinedTags!==void 0){const z=a;if(typeof U.$allowUndefinedTags!="boolean")return sr.errors=[{instancePath:e+"/$tags/$allowUndefinedTags",schemaPath:"#/properties/%24tags/properties/%24allowUndefinedTags/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var b=z===a}else var b=!0;if(b){var _={};_.$requiredTags=!0,_.$allowUndefinedTags=!0;for(const z in U)if(Ere.test(z)){let K=U[z];if(a===a)if(K&&typeof K=="object"&&!Array.isArray(K)){const I=a;for(const D in K)if(!(D==="type"||D==="items"||D==="contains"||Are.test(D)))return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:D},message:"must NOT have additional properties"}],!1;if(I===a){if(K.type!==void 0){let D=K.type;const N=a;if(!(D==="string"||D==="number"||D==="integer"||D==="boolean"||D==="array"))return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1")+"/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/type/enum",keyword:"enum",params:{allowedValues:mm.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var E=N===a}else var E=!0;if(E){if(K.items!==void 0){let D=K.items;const N=a;if(a===N)if(D&&typeof D=="object"&&!Array.isArray(D)){if(D.type!==void 0){let J=D.type;const j=a;if(!(J==="string"||J==="number"||J==="integer"))return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1")+"/items/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/items/properties/type/enum",keyword:"enum",params:{allowedValues:mm.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.items.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var S=j===a}else var S=!0;if(S){var T={};T.type=!0;for(const J in D)tM.test(J)&&(T[J]=!0)}}else return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1")+"/items",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var E=N===a}else var E=!0;if(E)if(K.contains!==void 0){let D=K.contains;const N=a;if(a===N)if(D&&typeof D=="object"&&!Array.isArray(D)){if(D.type!==void 0){let J=D.type;const j=a;if(!(J==="string"||J==="number"||J==="integer"))return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1")+"/contains/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/contains/properties/type/enum",keyword:"enum",params:{allowedValues:mm.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.contains.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var O=j===a}else var O=!0;if(O){var M={};M.type=!0;for(const J in D)tM.test(J)&&(M[J]=!0)}}else return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1")+"/contains",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/contains/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var E=N===a}else var E=!0}}}else return sr.errors=[{instancePath:e+"/$tags/"+z.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;_[z]=!0}}}}else return sr.errors=[{instancePath:e+"/$tags",schemaPath:"#/properties/%24tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=ee===a}else var c=!0;if(c){var Q=!0;for(const U in r)if(eM.test(U)){const ee=a;kT.validate(r[U],{instancePath:e+"/"+U.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:r,parentDataProperty:U,rootData:i,dynamicAnchors:o})||(s=s===null?kT.validate.errors:s.concat(kT.validate.errors),a=s.length);var Q=ee===a;if(!Q)break}}}}}}}}else return sr.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return sr.errors=s,a===0}sr.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function Jn(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Jn.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let p;if(r.protocol===void 0&&(p="protocol")||r.published===void 0&&(p="published")||r.types===void 0&&(p="types")||r.structure===void 0&&(p="structure"))return Jn.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:p},message:"must have required property '"+p+"'"}],!1;{const y=a;for(const g in r)if(!(g==="protocol"||g==="published"||g==="types"||g==="structure"))return Jn.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:g},message:"must NOT have additional properties"}],!1;if(y===a){if(r.protocol!==void 0){const g=a;if(typeof r.protocol!="string")return Jn.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=g===a}else var d=!0;if(d){if(r.published!==void 0){const g=a;if(typeof r.published!="boolean")return Jn.errors=[{instancePath:e+"/published",schemaPath:"#/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var d=g===a}else var d=!0;if(d){if(r.types!==void 0){let g=r.types;const w=a;if(a===w)if(g&&typeof g=="object"&&!Array.isArray(g)){var c={};for(const m in g)if(Q3.test(m)){let b=g[m];if(a===a)if(b&&typeof b=="object"&&!Array.isArray(b)){const E=a;for(const S in b)if(!(S==="schema"||S==="dataFormats"))return Jn.errors=[{instancePath:e+"/types/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/types/patternProperties/.*/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:S},message:"must NOT have additional properties"}],!1;if(E===a){if(b.schema!==void 0){const S=a;if(typeof b.schema!="string")return Jn.errors=[{instancePath:e+"/types/"+m.replace(/~/g,"~0").replace(/\//g,"~1")+"/schema",schemaPath:"#/properties/types/patternProperties/.*/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=S===a}else var u=!0;if(u)if(b.dataFormats!==void 0){let S=b.dataFormats;const T=a;if(a===T)if(Array.isArray(S)){if(S.length<1)return Jn.errors=[{instancePath:e+"/types/"+m.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats",schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var f=!0;const M=S.length;for(let Q=0;Q<M;Q++){const W=a;if(typeof S[Q]!="string")return Jn.errors=[{instancePath:e+"/types/"+m.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats/"+Q,schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var f=W===a;if(!f)break}}}else return Jn.errors=[{instancePath:e+"/types/"+m.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats",schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var u=T===a}else var u=!0}}else return Jn.errors=[{instancePath:e+"/types/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/types/patternProperties/.*/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;c[m]=!0}}else return Jn.errors=[{instancePath:e+"/types",schemaPath:"#/properties/types/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=w===a}else var d=!0;if(d)if(r.structure!==void 0){let g=r.structure;const w=a;if(a===w)if(g&&typeof g=="object"&&!Array.isArray(g)){var h={};for(const m in g)Q3.test(m)&&(sr(g[m],{instancePath:e+"/structure/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:g,parentDataProperty:m,rootData:i,dynamicAnchors:o})||(s=s===null?sr.errors:s.concat(sr.errors),a=s.length),h[m]=!0)}else return Jn.errors=[{instancePath:e+"/structure",schemaPath:"#/properties/structure/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=w===a}else var d=!0}}}}}else return Jn.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Jn.errors=s,a===0}Jn.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const xre=sr,Sre=Do,rM={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/protocols-configure.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","definition"],properties:{interface:{enum:["Protocols"],type:"string"},method:{enum:["Configure"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},definition:{$ref:"https://identity.foundation/dwn/json-schemas/protocol-definition.json"}}}}};function Do(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Do.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let u;if(r.authorization===void 0&&(u="authorization")||r.descriptor===void 0&&(u="descriptor"))return Do.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:u},message:"must have required property '"+u+"'"}],!1;{const f=a;for(const h in r)if(!(h==="authorization"||h==="descriptor"))return Do.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:h},message:"must NOT have additional properties"}],!1;if(f===a){if(r.authorization!==void 0){const h=a;Wn(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Wn.errors:s.concat(Wn.errors),a=s.length);var d=h===a}else var d=!0;if(d)if(r.descriptor!==void 0){let h=r.descriptor;const p=a;if(a===p)if(h&&typeof h=="object"&&!Array.isArray(h)){let g;if(h.interface===void 0&&(g="interface")||h.method===void 0&&(g="method")||h.messageTimestamp===void 0&&(g="messageTimestamp")||h.definition===void 0&&(g="definition"))return Do.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"}],!1;{const w=a;for(const v in h)if(!(v==="interface"||v==="method"||v==="messageTimestamp"||v==="definition"))return Do.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:v},message:"must NOT have additional properties"}],!1;if(w===a){if(h.interface!==void 0){let v=h.interface;const m=a;if(typeof v!="string")return Do.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Protocols")return Do.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:rM.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.method!==void 0){let v=h.method;const m=a;if(typeof v!="string")return Do.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Configure")return Do.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:rM.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.messageTimestamp!==void 0){let v=h.messageTimestamp;const m=a;if(a===a)if(typeof v=="string"){if(!ri.test(v))return Do.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return Do.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=m===a}else var c=!0;if(c)if(h.definition!==void 0){const v=a;Jn(h.definition,{instancePath:e+"/descriptor/definition",parentData:h,parentDataProperty:"definition",rootData:i,dynamicAnchors:o})||(s=s===null?Jn.errors:s.concat(Jn.errors),a=s.length);var c=v===a}else var c=!0}}}}}else return Do.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=p===a}else var d=!0}}}else return Do.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Do.errors=s,a===0}Do.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const Tre=$n,nM={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/protocols-query.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp"],properties:{interface:{enum:["Protocols"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{type:"object",minProperties:1,additionalProperties:!1,properties:{protocol:{type:"string"},recipient:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}}}}}};function $n(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=$n.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let f;if(r.descriptor===void 0&&(f="descriptor"))return $n.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:f},message:"must have required property '"+f+"'"}],!1;{const h=a;for(const p in r)if(!(p==="authorization"||p==="descriptor"))return $n.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:p},message:"must NOT have additional properties"}],!1;if(h===a){if(r.authorization!==void 0){const p=a;Ii(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Ii.errors:s.concat(Ii.errors),a=s.length);var d=p===a}else var d=!0;if(d)if(r.descriptor!==void 0){let p=r.descriptor;const y=a;if(a===y)if(p&&typeof p=="object"&&!Array.isArray(p)){let w;if(p.interface===void 0&&(w="interface")||p.method===void 0&&(w="method")||p.messageTimestamp===void 0&&(w="messageTimestamp"))return $n.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:w},message:"must have required property '"+w+"'"}],!1;{const v=a;for(const m in p)if(!(m==="interface"||m==="method"||m==="messageTimestamp"||m==="filter"))return $n.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:m},message:"must NOT have additional properties"}],!1;if(v===a){if(p.interface!==void 0){let m=p.interface;const b=a;if(typeof m!="string")return $n.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(m!=="Protocols")return $n.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:nM.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=b===a}else var c=!0;if(c){if(p.method!==void 0){let m=p.method;const b=a;if(typeof m!="string")return $n.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(m!=="Query")return $n.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:nM.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=b===a}else var c=!0;if(c){if(p.messageTimestamp!==void 0){let m=p.messageTimestamp;const b=a;if(a===a)if(typeof m=="string"){if(!ri.test(m))return $n.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return $n.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=b===a}else var c=!0;if(c)if(p.filter!==void 0){let m=p.filter;const b=a;if(a===b)if(m&&typeof m=="object"&&!Array.isArray(m)){if(Object.keys(m).length<1)return $n.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const E=a;for(const S in m)if(!(S==="protocol"||S==="recipient"))return $n.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:S},message:"must NOT have additional properties"}],!1;if(E===a){if(m.protocol!==void 0){const S=a;if(typeof m.protocol!="string")return $n.errors=[{instancePath:e+"/descriptor/filter/protocol",schemaPath:"#/properties/descriptor/properties/filter/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=S===a}else var u=!0;if(u)if(m.recipient!==void 0){let S=m.recipient;const T=a;if(a===a)if(typeof S=="string"){if(!Yf.test(S))return $n.errors=[{instancePath:e+"/descriptor/filter/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return $n.errors=[{instancePath:e+"/descriptor/filter/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var u=T===a}else var u=!0}}}else return $n.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var c=b===a}else var c=!0}}}}}else return $n.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=y===a}else var d=!0}}}else return $n.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return $n.errors=s,a===0}$n.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const $re=Mo,iM={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-read.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Read"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"}}}}};function Mo(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=Mo.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){let u;if(r.descriptor===void 0&&(u="descriptor"))return Mo.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:u},message:"must have required property '"+u+"'"}],!1;{const f=a;for(const h in r)if(!(h==="authorization"||h==="descriptor"))return Mo.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:h},message:"must NOT have additional properties"}],!1;if(f===a){if(r.authorization!==void 0){const h=a;Wn(r.authorization,{instancePath:e+"/authorization",parentData:r,parentDataProperty:"authorization",rootData:i,dynamicAnchors:o})||(s=s===null?Wn.errors:s.concat(Wn.errors),a=s.length);var d=h===a}else var d=!0;if(d)if(r.descriptor!==void 0){let h=r.descriptor;const p=a;if(a===p)if(h&&typeof h=="object"&&!Array.isArray(h)){let g;if(h.interface===void 0&&(g="interface")||h.method===void 0&&(g="method")||h.messageTimestamp===void 0&&(g="messageTimestamp")||h.filter===void 0&&(g="filter"))return Mo.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:g},message:"must have required property '"+g+"'"}],!1;{const w=a;for(const v in h)if(!(v==="interface"||v==="method"||v==="messageTimestamp"||v==="filter"))return Mo.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:v},message:"must NOT have additional properties"}],!1;if(w===a){if(h.interface!==void 0){let v=h.interface;const m=a;if(typeof v!="string")return Mo.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Records")return Mo.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:iM.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.method!==void 0){let v=h.method;const m=a;if(typeof v!="string")return Mo.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(v!=="Read")return Mo.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:iM.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var c=m===a}else var c=!0;if(c){if(h.messageTimestamp!==void 0){let v=h.messageTimestamp;const m=a;if(a===a)if(typeof v=="string"){if(!ri.test(v))return Mo.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return Mo.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var c=m===a}else var c=!0;if(c)if(h.filter!==void 0){const v=a;He(h.filter,{instancePath:e+"/descriptor/filter",parentData:h,parentDataProperty:"filter",rootData:i,dynamicAnchors:o})||(s=s===null?He.errors:s.concat(He.errors),a=s.length);var c=v===a}else var c=!0}}}}}else return Mo.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var d=p===a}else var d=!0}}}else return Mo.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return Mo.errors=s,a===0}Mo.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const kre=He,Pre=Pr,Ire=$c;function $c(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=$c.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)){let c;if(r.descriptorCid===void 0&&(c="descriptorCid"))return $c.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;for(const u in r)if(!(u==="descriptorCid"||u==="delegatedGrantId"||u==="permissionGrantId"||u==="protocolRole"))return $c.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:u},message:"must NOT have additional properties"}],!1;{if(r.descriptorCid!==void 0){const u=a;if(typeof r.descriptorCid!="string")return $c.errors=[{instancePath:e+"/descriptorCid",schemaPath:"#/properties/descriptorCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.delegatedGrantId!==void 0){const u=a;if(typeof r.delegatedGrantId!="string")return $c.errors=[{instancePath:e+"/delegatedGrantId",schemaPath:"#/properties/delegatedGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.permissionGrantId!==void 0){const u=a;if(typeof r.permissionGrantId!="string")return $c.errors=[{instancePath:e+"/permissionGrantId",schemaPath:"#/properties/permissionGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d)if(r.protocolRole!==void 0){const u=a;if(typeof r.protocolRole!="string")return $c.errors=[{instancePath:e+"/protocolRole",schemaPath:"#/properties/protocolRole/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0}}}}else return $c.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return $c.errors=s,a===0}$c.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const Ore=is;function is(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=is.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),r&&typeof r=="object"&&!Array.isArray(r)){let c;if(r.descriptorCid===void 0&&(c="descriptorCid")||r.recordId===void 0&&(c="recordId"))return is.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:c},message:"must have required property '"+c+"'"}],!1;for(const u in r)if(!(u==="descriptorCid"||u==="recordId"||u==="contextId"||u==="attestationCid"||u==="encryptionCid"||u==="delegatedGrantId"||u==="permissionGrantId"||u==="protocolRole"))return is.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:u},message:"must NOT have additional properties"}],!1;{if(r.descriptorCid!==void 0){const u=a;if(typeof r.descriptorCid!="string")return is.errors=[{instancePath:e+"/descriptorCid",schemaPath:"#/properties/descriptorCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.recordId!==void 0){const u=a;if(typeof r.recordId!="string")return is.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.contextId!==void 0){const u=a;if(typeof r.contextId!="string")return is.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.attestationCid!==void 0){const u=a;if(typeof r.attestationCid!="string")return is.errors=[{instancePath:e+"/attestationCid",schemaPath:"#/properties/attestationCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.encryptionCid!==void 0){const u=a;if(typeof r.encryptionCid!="string")return is.errors=[{instancePath:e+"/encryptionCid",schemaPath:"#/properties/encryptionCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.delegatedGrantId!==void 0){const u=a;if(typeof r.delegatedGrantId!="string")return is.errors=[{instancePath:e+"/delegatedGrantId",schemaPath:"#/properties/delegatedGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d){if(r.permissionGrantId!==void 0){const u=a;if(typeof r.permissionGrantId!="string")return is.errors=[{instancePath:e+"/permissionGrantId",schemaPath:"#/properties/permissionGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0;if(d)if(r.protocolRole!==void 0){const u=a;if(typeof r.protocolRole!="string")return is.errors=[{instancePath:e+"/protocolRole",schemaPath:"#/properties/protocolRole/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var d=u===a}else var d=!0}}}}}}}}else return is.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return is.errors=s,a===0}is.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const Cre=os;function os(r,{instancePath:e="",parentData:t,parentDataProperty:n,rootData:i=r,dynamicAnchors:o={}}={}){let s=null,a=0;const l=os.evaluated;if(l.dynamicProps&&(l.props=void 0),l.dynamicItems&&(l.items=void 0),a===0)if(r&&typeof r=="object"&&!Array.isArray(r)){if(Object.keys(r).length<1)return os.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const y=a;for(const g in r)if(!(g==="gt"||g==="gte"||g==="lt"||g==="lte"))return os.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:g},message:"must NOT have additional properties"}],!1;if(y===a){if(r.gt!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.gte===void 0){const m={};s===null?s=[m]:s.push(m),a++}var d=v===a;if(d)return os.errors=[{instancePath:e,schemaPath:"#/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.gte!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.gt===void 0){const b={};s===null?s=[b]:s.push(b),a++}var u=v===a;if(u)return os.errors=[{instancePath:e,schemaPath:"#/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.lt!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.lte===void 0){const b={};s===null?s=[b]:s.push(b),a++}var f=v===a;if(f)return os.errors=[{instancePath:e,schemaPath:"#/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.lte!==void 0){const g=a,w=a,v=a;if(r&&typeof r=="object"&&!Array.isArray(r)&&r.lt===void 0){const b={};s===null?s=[b]:s.push(b),a++}var h=v===a;if(h)return os.errors=[{instancePath:e,schemaPath:"#/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;a=w,s!==null&&(w?s.length=w:s=null);var c=g===a}else var c=!0;if(c){if(r.gt!==void 0){const g=a;if(typeof r.gt!="string")return os.errors=[{instancePath:e+"/gt",schemaPath:"#/properties/gt/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var p=g===a}else var p=!0;if(p){if(r.gte!==void 0){const g=a;if(typeof r.gte!="string")return os.errors=[{instancePath:e+"/gte",schemaPath:"#/properties/gte/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var p=g===a}else var p=!0;if(p){if(r.lt!==void 0){const g=a;if(typeof r.lt!="string")return os.errors=[{instancePath:e+"/lt",schemaPath:"#/properties/lt/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var p=g===a}else var p=!0;if(p)if(r.lte!==void 0){const g=a;if(typeof r.lte!="string")return os.errors=[{instancePath:e+"/lte",schemaPath:"#/properties/lte/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var p=g===a}else var p=!0}}}}}}}}}else return os.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return os.errors=s,a===0}os.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const Rre=Object.freeze(Object.defineProperty({__proto__:null,Authorization:Gte,AuthorizationDelegatedGrant:Yte,AuthorizationOwner:Xte,Definitions:ore,GeneralJwk:sre,GeneralJws:are,GenericSignaturePayload:Ire,JwkVerificationMethod:cre,MessagesFilter:dre,MessagesQuery:ure,MessagesRead:fre,MessagesSubscribe:hre,NumberRangeFilter:pre,PaginationCursor:yre,PermissionGrantData:mre,PermissionRequestData:gre,PermissionRevocationData:vre,PermissionsDefinitions:bre,PermissionsScopes:wre,ProtocolDefinition:_re,ProtocolRuleSet:xre,ProtocolsConfigure:Sre,ProtocolsQuery:Tre,PublicJwk:Pre,RecordsDelete:Qte,RecordsFilter:kre,RecordsQuery:ere,RecordsRead:$re,RecordsSubscribe:tre,RecordsWrite:rre,RecordsWriteDataEncoded:nre,RecordsWriteSignaturePayload:Ore,RecordsWriteUnidentified:ire,StringRangeFilter:Cre},Symbol.toStringTag,{value:"Module"}));function ig(r,e){const t=Rre[r];if(!t)throw new Ae(we.SchemaValidatorSchemaNotFound,`schema for ${r} not found.`);if(t(e),!t.errors)return;const[n]=t.errors;let{instancePath:i,message:o,keyword:s}=n;if(i||(i=r),s==="additionalProperties"){const a=n.params.additionalProperty;throw new Ae(we.SchemaValidatorAdditionalPropertyNotAllowed,`${o}: ${i}: ${a}`)}if(s==="unevaluatedProperties"){const a=n.params.unevaluatedProperty;throw new Ae(we.SchemaValidatorUnevaluatedPropertyNotAllowed,`${o}: ${i}: ${a}`)}throw new Ae(we.SchemaValidatorFailure,`${i}: ${o}`)}var PT=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Bc{constructor(e){this.cache=e||new Hte(600)}static get singleton(){return Bc._singleton===void 0&&(Bc._singleton=new Bc),Bc._singleton}static verifySignatures(e,t){return PT(this,void 0,void 0,function*(){return yield Bc.singleton.verifySignatures(e,t)})}verifySignatures(e,t){return PT(this,void 0,void 0,function*(){const n=[];for(const i of e.signatures){let o;const s=un.getKid(i),a=`${i.protected}.${e.payload}.${i.signature}`,l=yield this.cache.get(a);if(l===void 0){const c=yield Bc.getPublicKey(s,t);o=yield un.verifySignature(e.payload,i,c),yield this.cache.set(a,o)}else o=l;const d=un.extractDid(s);if(o)n.push(d);else throw new Ae(we.GeneralJwsVerifierInvalidSignature,`Signature verification failed for ${d}`)}return{signers:n}})}static getPublicKey(e,t){return PT(this,void 0,void 0,function*(){const n=un.extractDid(e),{didDocument:i}=yield t.resolve(n),{verificationMethod:o=[]}=i||{};let s;for(const l of o)if(e.endsWith(l.id)){s=l;break}if(!s)throw new Ae(we.GeneralJwsVerifierGetPublicKeyNotFound,"public key needed to verify signature not found in DID Document");ig("JwkVerificationMethod",s);const{publicKeyJwk:a}=s;return a})}}const Dre=["string","number","bigint","symbol"],Mre=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Bre(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(Dre.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(jre(r))return"Buffer";const t=Nre(r);return t||"Object"}function jre(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function Nre(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(Mre.includes(e))return e}class ke{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}ke.uint=new ke(0,"uint",!0);ke.negint=new ke(1,"negint",!0);ke.bytes=new ke(2,"bytes",!0);ke.string=new ke(3,"string",!0);ke.array=new ke(4,"array",!1);ke.map=new ke(5,"map",!1);ke.tag=new ke(6,"tag",!1);ke.float=new ke(7,"float",!0);ke.false=new ke(7,"false",!0);ke.true=new ke(7,"true",!0);ke.null=new ke(7,"null",!0);ke.undefined=new ke(7,"undefined",!0);ke.break=new ke(7,"break",!0);class ct{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const Tv=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Ure=new TextDecoder,Lre=new TextEncoder;function nA(r){return Tv&&globalThis.Buffer.isBuffer(r)}function FK(r){return r instanceof Uint8Array?nA(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const Kre=Tv?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):sM(r,e,t):(r,e,t)=>t-e>64?Ure.decode(r.subarray(e,t)):sM(r,e,t),zre=Tv?r=>r.length>64?globalThis.Buffer.from(r):oM(r):r=>r.length>64?Lre.encode(r):oM(r),Sd=r=>Uint8Array.from(r),IO=Tv?(r,e,t)=>nA(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),Fre=Tv?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),FK(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let i of r)n+i.length>t.length&&(i=i.subarray(0,t.length-n)),t.set(i,n),n+=i.length;return t},qre=Tv?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function Vre(r,e){if(nA(r)&&nA(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function oM(r,e=1/0){let t;const n=r.length;let i=null;const o=[];for(let s=0;s<n;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function sM(r,e,t){const n=[];for(;e<t;){const i=r[e];let o=null,s=i>239?4:i>223?3:i>191?2:1;if(e+s<=t){let a,l,d,c;switch(s){case 1:i<128&&(o=i);break;case 2:a=r[e+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(o=c));break;case 3:a=r[e+1],l=r[e+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:a=r[e+1],l=r[e+2],d=r[e+3],(a&192)===128&&(l&192)===128&&(d&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|d&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),e+=s}return Wre(n)}const aM=4096;function Wre(r){const e=r.length;if(e<=aM)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=aM));return t}const Hre=256;class qK{constructor(e=Hre){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=qre(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=IO(n,0,this.cursor)}else t=Fre(this.chunks,this.cursor);return e&&this.reset(),t}}const fr="CBOR decode error:",VK="CBOR encode error:";function $v(r,e,t){if(r.length-e<t)throw new Error(`${fr} not enough data for type`)}const po=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Gy(r,e,t){$v(r,e,1);const n=r[e];if(t.strict===!0&&n<po[0])throw new Error(`${fr} integer encoded in more bytes than necessary (strict decode)`);return n}function Yy(r,e,t){$v(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<po[1])throw new Error(`${fr} integer encoded in more bytes than necessary (strict decode)`);return n}function Zy(r,e,t){$v(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<po[2])throw new Error(`${fr} integer encoded in more bytes than necessary (strict decode)`);return n}function Jy(r,e,t){$v(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],i=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(t.strict===!0&&o<po[3])throw new Error(`${fr} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(t.allowBigInt===!0)return o;throw new Error(`${fr} integers outside of the safe integer range are not supported`)}function Gre(r,e,t,n){return new ct(ke.uint,Gy(r,e+1,n),2)}function Yre(r,e,t,n){return new ct(ke.uint,Yy(r,e+1,n),3)}function Zre(r,e,t,n){return new ct(ke.uint,Zy(r,e+1,n),5)}function Jre(r,e,t,n){return new ct(ke.uint,Jy(r,e+1,n),9)}function Xy(r,e){return hc(r,0,e.value)}function hc(r,e,t){if(t<po[0]){const n=Number(t);r.push([e|n])}else if(t<po[1]){const n=Number(t);r.push([e|24,n])}else if(t<po[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<po[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<po[4]){const i=[e|27,0,0,0,0,0,0,0];let o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,r.push(i)}else throw new Error(`${fr} encountered BigInt larger than allowable range`)}}Xy.encodedSize=function(e){return hc.encodedSize(e.value)};hc.encodedSize=function(e){return e<po[0]?1:e<po[1]?2:e<po[2]?3:e<po[3]?5:9};Xy.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function Xre(r,e,t,n){return new ct(ke.negint,-1-Gy(r,e+1,n),2)}function Qre(r,e,t,n){return new ct(ke.negint,-1-Yy(r,e+1,n),3)}function ene(r,e,t,n){return new ct(ke.negint,-1-Zy(r,e+1,n),5)}const OO=BigInt(-1),WK=BigInt(1);function tne(r,e,t,n){const i=Jy(r,e+1,n);if(typeof i!="bigint"){const o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new ct(ke.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${fr} integers outside of the safe integer range are not supported`);return new ct(ke.negint,OO-BigInt(i),9)}function CO(r,e){const t=e.value,n=typeof t=="bigint"?t*OO-WK:t*-1-1;hc(r,e.type.majorEncoded,n)}CO.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*OO-WK:t*-1-1;return n<po[0]?1:n<po[1]?2:n<po[2]?3:n<po[3]?5:9};CO.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function w_(r,e,t,n){$v(r,e,t+n);const i=IO(r,e+t,e+t+n);return new ct(ke.bytes,i,t+n)}function rne(r,e,t,n){return w_(r,e,1,t)}function nne(r,e,t,n){return w_(r,e,2,Gy(r,e+1,n))}function ine(r,e,t,n){return w_(r,e,3,Yy(r,e+1,n))}function one(r,e,t,n){return w_(r,e,5,Zy(r,e+1,n))}function sne(r,e,t,n){const i=Jy(r,e+1,n);if(typeof i=="bigint")throw new Error(`${fr} 64-bit integer bytes lengths not supported`);return w_(r,e,9,i)}function iA(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===ke.string?zre(r.value):r.value),r.encodedBytes}function Dx(r,e){const t=iA(e);hc(r,e.type.majorEncoded,t.length),r.push(t)}Dx.encodedSize=function(e){const t=iA(e);return hc.encodedSize(t.length)+t.length};Dx.compareTokens=function(e,t){return ane(iA(e),iA(t))};function ane(r,e){return r.length<e.length?-1:r.length>e.length?1:Vre(r,e)}function __(r,e,t,n,i){const o=t+n;$v(r,e,o);const s=new ct(ke.string,Kre(r,e+t,e+o),o);return i.retainStringBytes===!0&&(s.byteValue=IO(r,e+t,e+o)),s}function cne(r,e,t,n){return __(r,e,1,t,n)}function lne(r,e,t,n){return __(r,e,2,Gy(r,e+1,n),n)}function dne(r,e,t,n){return __(r,e,3,Yy(r,e+1,n),n)}function une(r,e,t,n){return __(r,e,5,Zy(r,e+1,n),n)}function fne(r,e,t,n){const i=Jy(r,e+1,n);if(typeof i=="bigint")throw new Error(`${fr} 64-bit integer string lengths not supported`);return __(r,e,9,i,n)}const hne=Dx;function kv(r,e,t,n){return new ct(ke.array,n,t)}function pne(r,e,t,n){return kv(r,e,1,t)}function yne(r,e,t,n){return kv(r,e,2,Gy(r,e+1,n))}function mne(r,e,t,n){return kv(r,e,3,Yy(r,e+1,n))}function gne(r,e,t,n){return kv(r,e,5,Zy(r,e+1,n))}function vne(r,e,t,n){const i=Jy(r,e+1,n);if(typeof i=="bigint")throw new Error(`${fr} 64-bit integer array lengths not supported`);return kv(r,e,9,i)}function bne(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${fr} indefinite length items not allowed`);return kv(r,e,1,1/0)}function RO(r,e){hc(r,ke.array.majorEncoded,e.value)}RO.compareTokens=Xy.compareTokens;RO.encodedSize=function(e){return hc.encodedSize(e.value)};function Pv(r,e,t,n){return new ct(ke.map,n,t)}function wne(r,e,t,n){return Pv(r,e,1,t)}function _ne(r,e,t,n){return Pv(r,e,2,Gy(r,e+1,n))}function Ene(r,e,t,n){return Pv(r,e,3,Yy(r,e+1,n))}function Ane(r,e,t,n){return Pv(r,e,5,Zy(r,e+1,n))}function xne(r,e,t,n){const i=Jy(r,e+1,n);if(typeof i=="bigint")throw new Error(`${fr} 64-bit integer map lengths not supported`);return Pv(r,e,9,i)}function Sne(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${fr} indefinite length items not allowed`);return Pv(r,e,1,1/0)}function DO(r,e){hc(r,ke.map.majorEncoded,e.value)}DO.compareTokens=Xy.compareTokens;DO.encodedSize=function(e){return hc.encodedSize(e.value)};function Tne(r,e,t,n){return new ct(ke.tag,t,1)}function $ne(r,e,t,n){return new ct(ke.tag,Gy(r,e+1,n),2)}function kne(r,e,t,n){return new ct(ke.tag,Yy(r,e+1,n),3)}function Pne(r,e,t,n){return new ct(ke.tag,Zy(r,e+1,n),5)}function Ine(r,e,t,n){return new ct(ke.tag,Jy(r,e+1,n),9)}function MO(r,e){hc(r,ke.tag.majorEncoded,e.value)}MO.compareTokens=Xy.compareTokens;MO.encodedSize=function(e){return hc.encodedSize(e.value)};const One=20,Cne=21,Rne=22,Dne=23;function Mne(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${fr} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new ct(ke.null,null,1):new ct(ke.undefined,void 0,1)}function Bne(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${fr} indefinite length items not allowed`);return new ct(ke.break,void 0,1)}function BO(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${fr} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${fr} Infinity values are not supported`)}return new ct(ke.float,r,e)}function jne(r,e,t,n){return BO(NO(r,e+1),3,n)}function Nne(r,e,t,n){return BO(UO(r,e+1),5,n)}function Une(r,e,t,n){return BO(ZK(r,e+1),9,n)}function jO(r,e,t){const n=e.value;if(n===!1)r.push([ke.float.majorEncoded|One]);else if(n===!0)r.push([ke.float.majorEncoded|Cne]);else if(n===null)r.push([ke.float.majorEncoded|Rne]);else if(n===void 0)r.push([ke.float.majorEncoded|Dne]);else{let i,o=!1;(!t||t.float64!==!0)&&(GK(n),i=NO(kc,1),n===i||Number.isNaN(n)?(kc[0]=249,r.push(kc.slice(0,3)),o=!0):(YK(n),i=UO(kc,1),n===i&&(kc[0]=250,r.push(kc.slice(0,5)),o=!0))),o||(Lne(n),i=ZK(kc,1),kc[0]=251,r.push(kc.slice(0,9)))}}jO.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){GK(n);let i=NO(kc,1);if(n===i||Number.isNaN(n))return 3;if(YK(n),i=UO(kc,1),n===i)return 5}return 9};const HK=new ArrayBuffer(9),Ua=new DataView(HK,1),kc=new Uint8Array(HK,0);function GK(r){if(r===1/0)Ua.setUint16(0,31744,!1);else if(r===-1/0)Ua.setUint16(0,64512,!1);else if(Number.isNaN(r))Ua.setUint16(0,32256,!1);else{Ua.setFloat32(0,r);const e=Ua.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Ua.setUint16(0,31744,!1);else if(t===0)Ua.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const i=t-127;i<-24?Ua.setUint16(0,0):i<-14?Ua.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Ua.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function NO(r,e){if(r.length-e<2)throw new Error(`${fr} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,i=t&1023;let o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,t&32768?-o:o}function YK(r){Ua.setFloat32(0,r,!1)}function UO(r,e){if(r.length-e<4)throw new Error(`${fr} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function Lne(r){Ua.setFloat64(0,r,!1)}function ZK(r,e){if(r.length-e<8)throw new Error(`${fr} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}jO.compareTokens=Xy.compareTokens;function Ar(r,e,t){throw new Error(`${fr} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function Mx(r){return()=>{throw new Error(`${fr} ${r}`)}}const Ne=[];for(let r=0;r<=23;r++)Ne[r]=Ar;Ne[24]=Gre;Ne[25]=Yre;Ne[26]=Zre;Ne[27]=Jre;Ne[28]=Ar;Ne[29]=Ar;Ne[30]=Ar;Ne[31]=Ar;for(let r=32;r<=55;r++)Ne[r]=Ar;Ne[56]=Xre;Ne[57]=Qre;Ne[58]=ene;Ne[59]=tne;Ne[60]=Ar;Ne[61]=Ar;Ne[62]=Ar;Ne[63]=Ar;for(let r=64;r<=87;r++)Ne[r]=rne;Ne[88]=nne;Ne[89]=ine;Ne[90]=one;Ne[91]=sne;Ne[92]=Ar;Ne[93]=Ar;Ne[94]=Ar;Ne[95]=Mx("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)Ne[r]=cne;Ne[120]=lne;Ne[121]=dne;Ne[122]=une;Ne[123]=fne;Ne[124]=Ar;Ne[125]=Ar;Ne[126]=Ar;Ne[127]=Mx("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)Ne[r]=pne;Ne[152]=yne;Ne[153]=mne;Ne[154]=gne;Ne[155]=vne;Ne[156]=Ar;Ne[157]=Ar;Ne[158]=Ar;Ne[159]=bne;for(let r=160;r<=183;r++)Ne[r]=wne;Ne[184]=_ne;Ne[185]=Ene;Ne[186]=Ane;Ne[187]=xne;Ne[188]=Ar;Ne[189]=Ar;Ne[190]=Ar;Ne[191]=Sne;for(let r=192;r<=215;r++)Ne[r]=Tne;Ne[216]=$ne;Ne[217]=kne;Ne[218]=Pne;Ne[219]=Ine;Ne[220]=Ar;Ne[221]=Ar;Ne[222]=Ar;Ne[223]=Ar;for(let r=224;r<=243;r++)Ne[r]=Mx("simple values are not supported");Ne[244]=Ar;Ne[245]=Ar;Ne[246]=Ar;Ne[247]=Mne;Ne[248]=Mx("simple values are not supported");Ne[249]=jne;Ne[250]=Nne;Ne[251]=Une;Ne[252]=Ar;Ne[253]=Ar;Ne[254]=Ar;Ne[255]=Bne;const ld=[];for(let r=0;r<24;r++)ld[r]=new ct(ke.uint,r,1);for(let r=-1;r>=-24;r--)ld[31-r]=new ct(ke.negint,r,1);ld[64]=new ct(ke.bytes,new Uint8Array(0),1);ld[96]=new ct(ke.string,"",1);ld[128]=new ct(ke.array,0,1);ld[160]=new ct(ke.map,0,1);ld[244]=new ct(ke.false,!1,1);ld[245]=new ct(ke.true,!0,1);ld[246]=new ct(ke.null,null,1);function Kne(r){switch(r.type){case ke.false:return Sd([244]);case ke.true:return Sd([245]);case ke.null:return Sd([246]);case ke.bytes:return r.value.length?void 0:Sd([64]);case ke.string:return r.value===""?Sd([96]):void 0;case ke.array:return r.value===0?Sd([128]):void 0;case ke.map:return r.value===0?Sd([160]):void 0;case ke.uint:return r.value<24?Sd([Number(r.value)]):void 0;case ke.negint:if(r.value>=-24)return Sd([31-Number(r.value)])}}const zne={float64:!1,mapSorter:Vne,quickEncodeToken:Kne};function Fne(){const r=[];return r[ke.uint.major]=Xy,r[ke.negint.major]=CO,r[ke.bytes.major]=Dx,r[ke.string.major]=hne,r[ke.array.major]=RO,r[ke.map.major]=DO,r[ke.tag.major]=MO,r[ke.float.major]=jO,r}const JK=Fne(),IT=new qK;class oA{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${VK} object contains circular references`);return new oA(t,e)}}const af={null:new ct(ke.null,null),undefined:new ct(ke.undefined,void 0),true:new ct(ke.true,!0),false:new ct(ke.false,!1),emptyArray:new ct(ke.array,0),emptyMap:new ct(ke.map,0)},Sh={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new ct(ke.float,r):r>=0?new ct(ke.uint,r):new ct(ke.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new ct(ke.uint,r):new ct(ke.negint,r)},Uint8Array(r,e,t,n){return new ct(ke.bytes,r)},string(r,e,t,n){return new ct(ke.string,r)},boolean(r,e,t,n){return r?af.true:af.false},null(r,e,t,n){return af.null},undefined(r,e,t,n){return af.undefined},ArrayBuffer(r,e,t,n){return new ct(ke.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new ct(ke.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[af.emptyArray,new ct(ke.break)]:af.emptyArray;n=oA.createCheck(n,r);const i=[];let o=0;for(const s of r)i[o++]=Q2(s,t,n);return t.addBreakTokens?[new ct(ke.array,r.length),i,new ct(ke.break)]:[new ct(ke.array,r.length),i]},Object(r,e,t,n){const i=e!=="Object",o=i?r.keys():Object.keys(r),s=i?r.size:o.length;if(!s)return t.addBreakTokens===!0?[af.emptyMap,new ct(ke.break)]:af.emptyMap;n=oA.createCheck(n,r);const a=[];let l=0;for(const d of o)a[l++]=[Q2(d,t,n),Q2(i?r.get(d):r[d],t,n)];return qne(a,t),t.addBreakTokens?[new ct(ke.map,s),a,new ct(ke.break)]:[new ct(ke.map,s),a]}};Sh.Map=Sh.Object;Sh.Buffer=Sh.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Sh[`${r}Array`]=Sh.DataView;function Q2(r,e={},t){const n=Bre(r),i=e&&e.typeEncoders&&e.typeEncoders[n]||Sh[n];if(typeof i=="function"){const s=i(r,n,e,t);if(s!=null)return s}const o=Sh[n];if(!o)throw new Error(`${VK} unsupported type: ${n}`);return o(r,n,e,t)}function qne(r,e){e.mapSorter&&r.sort(e.mapSorter)}function Vne(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const i=t.type.major,o=JK[i].compareTokens(t,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function XK(r,e,t,n){if(Array.isArray(e))for(const i of e)XK(r,i,t,n);else t[e.type.major](r,e,n)}function Wne(r,e,t){const n=Q2(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const i=t.quickEncodeToken(n);if(i)return i;const o=e[n.type.major];if(o.encodedSize){const s=o.encodedSize(n,t),a=new qK(s);if(o(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return FK(a.chunks[0])}}return IT.reset(),XK(IT,n,e,t),IT.toBytes(!0)}function Hne(r,e){return e=Object.assign({},zne,e),Wne(r,JK,e)}const Gne={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Yne{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=ld[e];if(t===void 0){const n=Ne[e];if(!n)throw new Error(`${fr} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=n(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}}const Ew=Symbol.for("DONE"),Bx=Symbol.for("BREAK");function Zne(r,e,t){const n=[];for(let i=0;i<r.value;i++){const o=Aw(e,t);if(o===Bx){if(r.value===1/0)break;throw new Error(`${fr} got unexpected break to lengthed array`)}if(o===Ew)throw new Error(`${fr} found array but not enough entries (got ${i}, expected ${r.value})`);n[i]=o}return n}function Jne(r,e,t){const n=t.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<r.value;s++){const a=Aw(e,t);if(a===Bx){if(r.value===1/0)break;throw new Error(`${fr} got unexpected break to lengthed map`)}if(a===Ew)throw new Error(`${fr} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${fr} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&o.has(a)||!n&&a in i))throw new Error(`${fr} found repeat map key "${a}"`);const l=Aw(e,t);if(l===Ew)throw new Error(`${fr} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?o.set(a,l):i[a]=l}return n?o:i}function Aw(r,e){if(r.done())return Ew;const t=r.next();if(t.type===ke.break)return Bx;if(t.type.terminal)return t.value;if(t.type===ke.array)return Zne(t,r,e);if(t.type===ke.map)return Jne(t,r,e);if(t.type===ke.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=Aw(r,e);return e.tags[t.value](n)}throw new Error(`${fr} tag not supported (${t.value})`)}throw new Error("unsupported")}function Xne(r,e){if(!(r instanceof Uint8Array))throw new Error(`${fr} data to decode must be a Uint8Array`);e=Object.assign({},Gne,e);const t=e.tokenizer||new Yne(r,e),n=Aw(t,e);if(n===Ew)throw new Error(`${fr} did not find any content to decode`);if(n===Bx)throw new Error(`${fr} got unexpected break`);if(!t.done())throw new Error(`${fr} too many terminals, data makes no sense`);return n}function Qne(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,l=r.charAt(0),d=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,g=0,w=0,v=p.length;w!==v&&p[w]===0;)w++,y++;for(var m=(v-w)*c+1>>>0,b=new Uint8Array(m);w!==v;){for(var _=p[w],E=0,S=m-1;(_!==0||E<g)&&S!==-1;S--,E++)_+=256*b[S]>>>0,b[S]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");g=E,w++}for(var T=m-g;T!==m&&b[T]===0;)T++;for(var O=l.repeat(y);T<m;++T)O+=r.charAt(b[T]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var g=0,w=0;p[y]===l;)g++,y++;for(var v=(p.length-y)*d+1>>>0,m=new Uint8Array(v);p[y];){var b=t[p.charCodeAt(y)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<w)&&E!==-1;E--,_++)b+=a*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");w=_,y++}if(p[y]!==" "){for(var S=v-w;S!==v&&m[S]===0;)S++;for(var T=new Uint8Array(g+(v-S)),O=g;S!==v;)T[O++]=m[S++];return T}}}function h(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:h}}var eie=Qne,tie=eie;const rie=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},LO=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},nie=r=>new TextEncoder().encode(r),iie=r=>new TextDecoder().decode(r);let oie=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},sie=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return QK(this,e)}},aie=class{constructor(e){this.decoders=e}or(e){return QK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const QK=(r,e)=>new aie({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let cie=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new oie(e,t,n),this.decoder=new sie(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const jx=({name:r,prefix:e,encode:t,decode:n})=>new cie(r,e,t,n),E_=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:i}=tie(t,e);return jx({prefix:r,name:e,encode:n,decode:o=>LO(i(o))})},lie=(r,e,t,n)=>{const i={};for(let c=0;c<e.length;++c)i[e[c]]=c;let o=r.length;for(;r[o-1]==="=";)--o;const s=new Uint8Array(o*t/8|0);let a=0,l=0,d=0;for(let c=0;c<o;++c){const u=i[r[c]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|u,a+=t,a>=8&&(a-=8,s[d++]=255&l>>a)}if(a>=t||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s},die=(r,e,t)=>{const n=e[e.length-1]==="=",i=(1<<t)-1;let o="",s=0,a=0;for(let l=0;l<r.length;++l)for(a=a<<8|r[l],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o},Ao=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>jx({prefix:e,name:r,encode(i){return die(i,n,t)},decode(i){return lie(i,n,t,r)}}),Vb=Ao({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),uie=Ao({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fie=Ao({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),hie=Ao({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pie=Ao({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yie=Ao({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mie=Ao({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gie=Ao({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vie=Ao({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),bie=Object.freeze(Object.defineProperty({__proto__:null,base32:Vb,base32hex:pie,base32hexpad:mie,base32hexpadupper:gie,base32hexupper:yie,base32pad:fie,base32padupper:hie,base32upper:uie,base32z:vie},Symbol.toStringTag,{value:"Module"})),eu=E_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wie=E_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),_ie=Object.freeze(Object.defineProperty({__proto__:null,base58btc:eu,base58flickr:wie},Symbol.toStringTag,{value:"Module"}));var Eie=ez,cM=128,Aie=127,xie=~Aie,Sie=Math.pow(2,31);function ez(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Sie;)e[t++]=r&255|cM,r/=128;for(;r&xie;)e[t++]=r&255|cM,r>>>=7;return e[t]=r|0,ez.bytes=t-n+1,e}var Tie=PP,$ie=128,lM=127;function PP(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw PP.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&lM)<<i:(s&lM)*Math.pow(2,i),i+=7}while(s>=$ie);return PP.bytes=o-n,t}var kie=Math.pow(2,7),Pie=Math.pow(2,14),Iie=Math.pow(2,21),Oie=Math.pow(2,28),Cie=Math.pow(2,35),Rie=Math.pow(2,42),Die=Math.pow(2,49),Mie=Math.pow(2,56),Bie=Math.pow(2,63),jie=function(r){return r<kie?1:r<Pie?2:r<Iie?3:r<Oie?4:r<Cie?5:r<Rie?6:r<Die?7:r<Mie?8:r<Bie?9:10},Nie={encode:Eie,decode:Tie,encodingLength:jie},sA=Nie;const IP=(r,e=0)=>[sA.decode(r,e),sA.decode.bytes],aA=(r,e,t=0)=>(sA.encode(r,e,t),e),cA=r=>sA.encodingLength(r),OP=(r,e)=>{const t=e.byteLength,n=cA(r),i=n+cA(t),o=new Uint8Array(i+t);return aA(r,o,0),aA(t,o,n),o.set(e,i),new KO(r,t,e,o)},tz=r=>{const e=LO(r),[t,n]=IP(e),[i,o]=IP(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new KO(t,i,s,e)},Uie=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&rie(r.bytes,t.bytes)}};class KO{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}}const dM=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Kie(t,CP(r),e||eu.encoder);default:return zie(t,CP(r),e||Vb.encoder)}},uM=new WeakMap,CP=r=>{const e=uM.get(r);if(e==null){const t=new Map;return uM.set(r,t),t}return e};let rz=class Io{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==f0)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Fie)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Io.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=OP(e,t);return Io.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Io.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&Uie(e.multihash,n.multihash)}toString(e){return dM(this,e)}toJSON(){return{"/":dM(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Io)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:o,bytes:s}=t;return new Io(n,i,o,s||fM(n,i,o.bytes))}else if(t[qie]===!0){const{version:n,multihash:i,code:o}=t,s=tz(i);return Io.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==f0)throw new Error(`Version 0 CID must use dag-pb (code: ${f0}) block encoding`);return new Io(e,t,n,n.bytes)}case 1:{const i=fM(e,t,n.bytes);return new Io(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return Io.create(0,f0,e)}static createV1(e,t){return Io.create(1,e,t)}static decode(e){const[t,n]=Io.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Io.inspectBytes(e),n=t.size-t.multihashSize,i=LO(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=i.subarray(t.multihashSize-t.digestSize),s=new KO(t.multihashCode,t.digestSize,o,i);return[t.version===0?Io.createV0(s):Io.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[u,f]=IP(e.subarray(t));return t+=f,u};let i=n(),o=f0;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const s=t,a=n(),l=n(),d=t+l,c=d-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:d}}static parse(e,t){const[n,i]=Lie(e,t),o=Io.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return CP(o).set(n,e),o}};const Lie=(r,e)=>{switch(r[0]){case"Q":{const t=e||eu;return[eu.prefix,t.decode(`${eu.prefix}${r}`)]}case eu.prefix:{const t=e||eu;return[eu.prefix,t.decode(r)]}case Vb.prefix:{const t=e||Vb;return[Vb.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Kie=(r,e,t)=>{const{prefix:n}=t;if(n!==eu.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const o=t.encode(r).slice(1);return e.set(n,o),o}else return i},zie=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const o=t.encode(r);return e.set(n,o),o}else return i},f0=112,Fie=18,fM=(r,e,t)=>{const n=cA(r),i=n+cA(e),o=new Uint8Array(i+t.byteLength);return aA(r,o,0),aA(e,o,n),o.set(t,i),o},qie=Symbol.for("@ipld/js-cid/CID"),nz=42;function Vie(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=rz.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new ct(ke.tag,nz),new ct(ke.bytes,t)]}function Wie(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Hie(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Gie={float64:!0,typeEncoders:{Object:Vie,undefined:Wie,number:Hie}};function Yie(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return rz.decode(r.subarray(1))}const iz={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};iz.tags[nz]=Yie;const Zie="dag-cbor",Nx=113,Jie=r=>Hne(r,Gie),oz=r=>Xne(r,iz),RP=Object.freeze(Object.defineProperty({__proto__:null,code:Nx,decode:oz,encode:Jie,name:Zie},Symbol.toStringTag,{value:"Module"})),Qa=tK({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});tK({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const eE=ka({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ka({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ka({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ka({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ka({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ka({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ka({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ka({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const hM=ka({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),pM=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Qie(t,DP(r),e||Qa.encoder);default:return eoe(t,DP(r),e||eE.encoder)}},yM=new WeakMap,DP=r=>{const e=yM.get(r);if(e==null){const t=new Map;return yM.set(r,t),t}return e};class er{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==h0)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==toe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return er.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=ZE(e,t);return er.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return er.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&aQ(e.multihash,n.multihash)}toString(e){return pM(this,e)}toJSON(){return{"/":pM(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof er)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:o,bytes:s}=t;return new er(n,i,o,s||mM(n,i,o.bytes))}else if(t[roe]===!0){const{version:n,multihash:i,code:o}=t,s=vK(i);return er.create(n,o,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==h0)throw new Error(`Version 0 CID must use dag-pb (code: ${h0}) block encoding`);return new er(e,t,n,n.bytes)}case 1:{const i=mM(e,t,n.bytes);return new er(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return er.create(0,h0,e)}static createV1(e,t){return er.create(1,e,t)}static decode(e){const[t,n]=er.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=er.inspectBytes(e),n=t.size-t.multihashSize,i=xv(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=i.subarray(t.multihashSize-t.digestSize),s=new pO(t.multihashCode,t.digestSize,o,i);return[t.version===0?er.createV0(s):er.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[u,f]=vw(e.subarray(t));return t+=f,u};let i=n(),o=h0;if(i===18?(i=0,t=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const s=t,a=n(),l=n(),d=t+l,c=d-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:d}}static parse(e,t){const[n,i]=Xie(e,t),o=er.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return DP(o).set(n,e),o}}const Xie=(r,e)=>{switch(r[0]){case"Q":{const t=e||Qa;return[Qa.prefix,t.decode(`${Qa.prefix}${r}`)]}case Qa.prefix:{const t=e||Qa;return[Qa.prefix,t.decode(r)]}case eE.prefix:{const t=e||eE;return[eE.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Qie=(r,e,t)=>{const{prefix:n}=t;if(n!==Qa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const o=t.encode(r).slice(1);return e.set(n,o),o}else return i},eoe=(r,e,t)=>{const{prefix:n}=t,i=e.get(n);if(i==null){const o=t.encode(r);return e.set(n,o),o}else return i},h0=112,toe=18,mM=(r,e,t)=>{const n=ww(r),i=n+ww(e),o=new Uint8Array(i+t.byteLength);return bw(r,o,0),bw(e,o,n),o.set(t,i),o},roe=Symbol.for("@ipld/js-cid/CID");var cf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},A1=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}},gi=function(r){return this instanceof gi?(this.v=r,this):new gi(r)},x1=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){n[f]&&(i[f]=function(h){return new Promise(function(p,y){o.push([f,h,p,y])>1||a(f,h)})})}function a(f,h){try{l(n[f](h))}catch(p){u(o[0][3],p)}}function l(f){f.value instanceof gi?Promise.resolve(f.value.v).then(d,c):u(o[0][2],f)}function d(f){a("next",f)}function c(f){a("throw",f)}function u(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}};class gM{open(){return cf(this,void 0,void 0,function*(){})}close(){return cf(this,void 0,void 0,function*(){})}put(e,t,n){return cf(this,void 0,void 0,function*(){return e})}get(e,t){return cf(this,void 0,void 0,function*(){return new Uint8Array})}has(e,t){return cf(this,void 0,void 0,function*(){return!1})}delete(e,t){return cf(this,void 0,void 0,function*(){})}isEmpty(e){return cf(this,void 0,void 0,function*(){return!0})}putMany(e,t){return x1(this,arguments,function*(){var i,o,s,a;try{for(var l=!0,d=A1(e),c;c=yield gi(d.next()),i=c.done,!i;l=!0){a=c.value,l=!1;const u=a;yield gi(this.put(u.cid,u.block,t)),yield yield gi(u.cid)}}catch(u){o={error:u}}finally{try{!l&&!i&&(s=d.return)&&(yield gi(s.call(d)))}finally{if(o)throw o.error}}})}getMany(e,t){return x1(this,arguments,function*(){var i,o,s,a;try{for(var l=!0,d=A1(e),c;c=yield gi(d.next()),i=c.done,!i;l=!0){a=c.value,l=!1;const u=a;yield yield gi({cid:u,block:yield gi(this.get(u,t))})}}catch(u){o={error:u}}finally{try{!l&&!i&&(s=d.return)&&(yield gi(s.call(d)))}finally{if(o)throw o.error}}})}getAll(e){return x1(this,arguments,function*(){var n,i,o,s;const a=this.db.iterator({keys:!0,keyEncoding:"buffer"},e);try{for(var l=!0,d=A1(a),c;c=yield gi(d.next()),n=c.done,!n;l=!0){s=c.value,l=!1;const[u,f]=s;yield yield gi({cid:er.decode(u),block:f})}}catch(u){i={error:u}}finally{try{!l&&!n&&(o=d.return)&&(yield gi(o.call(d)))}finally{if(i)throw i.error}}})}deleteMany(e,t){return x1(this,arguments,function*(){var i,o,s,a;try{for(var l=!0,d=A1(e),c;c=yield gi(d.next()),i=c.done,!i;l=!0){a=c.value,l=!1;const u=a;yield gi(this.delete(u,t)),yield yield gi(u)}}catch(u){o={error:u}}finally{try{!l&&!i&&(s=d.return)&&(yield gi(s.call(d)))}finally{if(o)throw o.error}}})}clear(){return cf(this,void 0,void 0,function*(){})}}function vM(r,e){for(const t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function noe(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return vM(r,t)}catch{t.message=r.message,t.stack=r.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),vM(new i,t)}}var ioe=noe;const Zr=Vu(ioe);function ooe(r){return r[Symbol.asyncIterator]!=null}function sz(r,e=1){return e=Number(e),ooe(r)?async function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for await(const n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}():function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for(const n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}()}async function*az(r,e=1){for await(const t of sz(r,e)){const n=t.map(async i=>i().then(o=>({ok:!0,value:o}),o=>({ok:!1,err:o})));for(let i=0;i<n.length;i++){const o=await n[i];if(o.ok)yield o.value;else throw o.err}}}const cz=Symbol.for("@achingbrain/uint8arraylist");function bM(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function S1(r){return!!r?.[cz]}class ay{bufs;length;[cz]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(S1(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(S1(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=bM(this.bufs,e);return t.buf[t.index]}set(e,t){const n=bM(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(S1(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return AP(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:AP(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),o=new ay;return o.length=i,o.bufs=[...n],o}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let o=0;o<this.bufs.length;o++){const s=this.bufs[o],a=i,l=a+s.byteLength;if(i=l,e>=l)continue;const d=e>=a&&e<l,c=t>a&&t<=l;if(d&&c){if(e===a&&t===l){n.push(s);break}const u=e-a;n.push(s.subarray(u,u+(t-e)));break}if(d){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(c){if(t===l){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!S1(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const o=256,s=new Int32Array(o);for(let u=0;u<o;u++)s[u]=-1;for(let u=0;u<i;u++)s[n[u]]=u;const a=s,l=this.byteLength-n.byteLength,d=n.byteLength-1;let c;for(let u=t;u<=l;u+=c){c=0;for(let f=d;f>=0;f--){const h=this.get(u+f);if(n[f]!==h){c=Math.max(1,f-a[h]);break}}if(c===0)return u}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=ky(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=of(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=of(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=of(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=ky(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=of(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=of(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=of(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=of(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=of(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof ay)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!vee(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new ay;return n.bufs=e,t==null&&(t=e.reduce((i,o)=>i+o.byteLength,0)),n.length=t,n}}const soe=262144,aoe=(r={})=>{const e=r.chunkSize??soe;return async function*(n){let i=new ay,o=0,s=!1;for await(const a of n)for(i.append(a),o+=a.length;o>=e;)if(yield i.slice(0,e),s=!0,e===i.length)i=new ay,o=0;else{const l=new ay;l.append(i.sublist(e)),i=l,o-=e}(!s||o>0)&&(yield i.subarray(0,o))}},coe=new TextDecoder;function zO(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const i=r[e++];if(t+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[t,e]}function lA(r,e){let t;[t,e]=zO(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function lz(r,e){let t;return[t,e]=zO(r,e),[t&7,t>>3,e]}function loe(r){const e={},t=r.length;let n=0;for(;n<t;){let i,o;if([i,o,n]=lz(r,n),o===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=lA(r,n)}else if(o===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=lA(r,n),e.Name=coe.decode(s)}else if(o===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=zO(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function doe(r){const e=r.length;let t=0,n,i=!1,o;for(;t<e;){let a,l;if([a,l,t]=lz(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(l===1){if(o)throw new Error("protobuf: (PBNode) duplicate Data section");[o,t]=lA(r,t),n&&(i=!0)}else if(l===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let d;[d,t]=lA(r,t),n.push(loe(d))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${l}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const s={};return o&&(s.Data=o),s.Links=n||[],s}const dz=new TextEncoder,wM=2**32,uoe=2**31;function foe(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=Wb(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=dz.encode(r.Name);t-=n.length,e.set(n,t),t=Wb(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=Wb(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function hoe(r){const e=yoe(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=Wb(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){const o=foe(r.Links[i],t.subarray(0,n));n-=o,n=Wb(t,n,o)-1,t[n]=18}return t}function poe(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+og(t)}if(typeof r.Name=="string"){const t=dz.encode(r.Name).length;e+=1+t+og(t)}return typeof r.Tsize=="number"&&(e+=1+og(r.Tsize)),e}function yoe(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+og(t)}if(r.Links)for(const t of r.Links){const n=poe(t);e+=1+n+og(n)}return e}function Wb(r,e,t){e-=og(t);const n=e;for(;t>=uoe;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function og(r){return r%2===0&&r++,Math.floor((moe(r)+6)/7)}function moe(r){let e=0;return r>=wM&&(r=Math.floor(r/wM),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+goe[r]}const goe=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],voe=["Data","Links"],boe=["Hash","Name","Tsize"],MP=new TextEncoder;function uz(r,e){if(r===e)return 0;const t=r.Name?MP.encode(r.Name):[],n=e.Name?MP.encode(e.Name):[];let i=t.length,o=n.length;for(let s=0,a=Math.min(i,o);s<a;++s)if(t[s]!==n[s]){i=t[s],o=n[s];break}return i<o?-1:o<i?1:0}function _M(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function fz(r){if(typeof r.asCID=="object"){const t=ub.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=ub.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=ub.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=ub.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function Th(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=MP.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(fz),e.Links.sort(uz);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function hz(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!_M(r,voe))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!_M(t,boe))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&uz(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function woe(r,e=[]){return Th({Data:r,Links:e})}function _oe(r,e,t){return fz({Hash:t,Name:r,Tsize:e})}function Eoe(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const Aoe="dag-pb",FO=112;function $h(r){hz(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),hoe(e)}function A_(r){const e=Eoe(r),t=doe(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(i=>{const o={};try{o.Hash=ub.decode(i.Hash)}catch{}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(o.Name=i.Name),i.Tsize!==void 0&&(o.Tsize=i.Tsize),o})),n}const pz=Object.freeze(Object.defineProperty({__proto__:null,code:FO,createLink:_oe,createNode:woe,decode:A_,encode:$h,name:Aoe,prepare:Th,validate:hz},Symbol.toStringTag,{value:"Module"})),xoe=Math.pow(2,7),Soe=Math.pow(2,14),Toe=Math.pow(2,21),yz=Math.pow(2,28),mz=Math.pow(2,35),gz=Math.pow(2,42),vz=Math.pow(2,49),as=128,lf=127;function qO(r){if(r<xoe)return 1;if(r<Soe)return 2;if(r<Toe)return 3;if(r<yz)return 4;if(r<mz)return 5;if(r<gz)return 6;if(r<vz)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function $oe(r,e,t=0){switch(qO(r)){case 8:e[t++]=r&255|as,r/=128;case 7:e[t++]=r&255|as,r/=128;case 6:e[t++]=r&255|as,r/=128;case 5:e[t++]=r&255|as,r/=128;case 4:e[t++]=r&255|as,r>>>=7;case 3:e[t++]=r&255|as,r>>>=7;case 2:e[t++]=r&255|as,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function koe(r,e){let t=r[e],n=0;if(n+=t&lf,t<as||(t=r[e+1],n+=(t&lf)<<7,t<as)||(t=r[e+2],n+=(t&lf)<<14,t<as)||(t=r[e+3],n+=(t&lf)<<21,t<as)||(t=r[e+4],n+=(t&lf)*yz,t<as)||(t=r[e+5],n+=(t&lf)*mz,t<as)||(t=r[e+6],n+=(t&lf)*gz,t<as)||(t=r[e+7],n+=(t&lf)*vz,t<as))return n;throw new RangeError("Could not decode varint")}const VO=new Float32Array([-0]),oh=new Uint8Array(VO.buffer);function Poe(r,e,t){VO[0]=r,e[t]=oh[0],e[t+1]=oh[1],e[t+2]=oh[2],e[t+3]=oh[3]}function Ioe(r,e){return oh[0]=r[e],oh[1]=r[e+1],oh[2]=r[e+2],oh[3]=r[e+3],VO[0]}const WO=new Float64Array([-0]),Ko=new Uint8Array(WO.buffer);function Ooe(r,e,t){WO[0]=r,e[t]=Ko[0],e[t+1]=Ko[1],e[t+2]=Ko[2],e[t+3]=Ko[3],e[t+4]=Ko[4],e[t+5]=Ko[5],e[t+6]=Ko[6],e[t+7]=Ko[7]}function Coe(r,e){return Ko[0]=r[e],Ko[1]=r[e+1],Ko[2]=r[e+2],Ko[3]=r[e+3],Ko[4]=r[e+4],Ko[5]=r[e+5],Ko[6]=r[e+6],Ko[7]=r[e+7],WO[0]}const Roe=BigInt(Number.MAX_SAFE_INTEGER),Doe=BigInt(Number.MIN_SAFE_INTEGER);class qo{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return cy;if(e<Roe&&e>Doe)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>EM&&(i=0n,++n>EM&&(n=0n))),new qo(Number(i),Number(n))}static fromNumber(e){if(e===0)return cy;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new qo(n,i)}static from(e){return typeof e=="number"?qo.fromNumber(e):typeof e=="bigint"?qo.fromBigInt(e):typeof e=="string"?qo.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new qo(e.low>>>0,e.high>>>0):cy}}const cy=new qo(0,0);cy.toBigInt=function(){return 0n};cy.zzEncode=cy.zzDecode=function(){return this};cy.length=function(){return 1};const EM=4294967296n;function Moe(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function Boe(r,e,t){if(t-e<1)return"";let i;const o=[];let s=0,a;for(;e<t;)a=r[e++],a<128?o[s++]=a:a>191&&a<224?o[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,o[s++]=55296+(a>>10),o[s++]=56320+(a&1023)):o[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i!=null?(s>0&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))}function bz(r,e,t){const n=t;let i,o;for(let s=0;s<r.length;++s)i=r.charCodeAt(s),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((o=r.charCodeAt(s+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++s,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function vc(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function T1(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class joe{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,vc(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw vc(this,4);return T1(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw vc(this,4);return T1(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw vc(this,4);const e=Ioe(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw vc(this,4);const e=Coe(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw vc(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return Boe(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw vc(this,e);this.pos+=e}else do if(this.pos>=this.len)throw vc(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new qo(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw vc(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw vc(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw vc(this,8);const e=T1(this.buf,this.pos+=4),t=T1(this.buf,this.pos+=4);return new qo(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=koe(this.buf,this.pos);return this.pos+=qO(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function Noe(r){return new joe(r instanceof Uint8Array?r:r.subarray())}function HO(r,e,t){const n=Noe(r);return e.decode(n,void 0,t)}function Uoe(r){let n,i=8192;return function(s){if(s<1||s>4096)return ky(s);i+s>8192&&(n=ky(8192),i=0);const a=n.subarray(i,i+=s);return i&7&&(i=(i|7)+1),a}}class fb{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}}function OT(){}let Loe=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}};const Koe=Uoe();function zoe(r){return globalThis.Buffer!=null?ky(r):Koe(r)}class BP{len;head;tail;states;constructor(){this.len=0,this.head=new fb(OT,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new fb(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new qoe((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push($1,10,qo.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=qo.fromBigInt(e);return this._push($1,t.length(),t)}uint64Number(e){return this._push($oe,qO(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=qo.fromBigInt(e).zzEncode();return this._push($1,t.length(),t)}sint64Number(e){const t=qo.fromNumber(e).zzEncode();return this._push($1,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(CT,1,e?1:0)}fixed32(e){return this._push(p0,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=qo.fromBigInt(e);return this._push(p0,4,t.lo)._push(p0,4,t.hi)}fixed64Number(e){const t=qo.fromNumber(e);return this._push(p0,4,t.lo)._push(p0,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Poe,4,e)}double(e){return this._push(Ooe,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(CT,1,0):this.uint32(t)._push(Voe,t,e)}string(e){const t=Moe(e);return t!==0?this.uint32(t)._push(bz,t,e):this._push(CT,1,0)}fork(){return this.states=new Loe(this),this.head=this.tail=new fb(OT,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new fb(OT,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=zoe(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function CT(r,e,t){e[t]=r&255}function Foe(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class qoe extends fb{next;constructor(e,t){super(Foe,e,t),this.next=void 0}}function $1(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function p0(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Voe(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(BP.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(Woe,e,r),this},BP.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(Hoe,e,r),this});function Woe(r,e,t){e.set(r,t)}function Hoe(r,e,t){r.length<40?bz(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set($O(r),t)}function Goe(){return new BP}function GO(r,e){const t=Goe();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var dA;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(dA||(dA={}));function wz(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Yoe(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(o,s){const a=e(o);s.int32(a)},n=function(o){const s=o.int32();return e(s)};return wz("enum",dA.VARINT,t,n)}function YO(r,e){return wz("message",dA.LENGTH_DELIMITED,r,e)}var _l;(function(r){(function(n){n.Raw="Raw",n.Directory="Directory",n.File="File",n.Metadata="Metadata",n.Symlink="Symlink",n.HAMTShard="HAMTShard"})(r.DataType||(r.DataType={}));let e;(function(n){n[n.Raw=0]="Raw",n[n.Directory=1]="Directory",n[n.File=2]="File",n[n.Metadata=3]="Metadata",n[n.Symlink=4]="Symlink",n[n.HAMTShard=5]="HAMTShard"})(e||(e={})),function(n){n.codec=()=>Yoe(e)}(r.DataType||(r.DataType={}));let t;r.codec=()=>(t==null&&(t=YO((n,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),n.Type!=null&&(i.uint32(8),r.DataType.codec().encode(n.Type,i)),n.Data!=null&&(i.uint32(18),i.bytes(n.Data)),n.filesize!=null&&(i.uint32(24),i.uint64(n.filesize)),n.blocksizes!=null)for(const s of n.blocksizes)i.uint32(32),i.uint64(s);n.hashType!=null&&(i.uint32(40),i.uint64(n.hashType)),n.fanout!=null&&(i.uint32(48),i.uint64(n.fanout)),n.mode!=null&&(i.uint32(56),i.uint32(n.mode)),n.mtime!=null&&(i.uint32(66),uA.codec().encode(n.mtime,i)),o.lengthDelimited!==!1&&i.ldelim()},(n,i)=>{const o={blocksizes:[]},s=i==null?n.len:n.pos+i;for(;n.pos<s;){const a=n.uint32();switch(a>>>3){case 1:o.Type=r.DataType.codec().decode(n);break;case 2:o.Data=n.bytes();break;case 3:o.filesize=n.uint64();break;case 4:o.blocksizes.push(n.uint64());break;case 5:o.hashType=n.uint64();break;case 6:o.fanout=n.uint64();break;case 7:o.mode=n.uint32();break;case 8:o.mtime=uA.codec().decode(n,n.uint32());break;default:n.skipType(a&7);break}}return o})),t),r.encode=n=>GO(n,r.codec()),r.decode=n=>HO(n,r.codec())})(_l||(_l={}));var uA;(function(r){let e;r.codec=()=>(e==null&&(e=YO((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Seconds!=null&&(n.uint32(8),n.int64(t.Seconds)),t.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(t.FractionalNanoseconds)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const s=t.uint32();switch(s>>>3){case 1:i.Seconds=t.int64();break;case 2:i.FractionalNanoseconds=t.fixed32();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>GO(t,r.codec()),r.decode=t=>HO(t,r.codec())})(uA||(uA={}));var AM;(function(r){let e;r.codec=()=>(e==null&&(e=YO((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.MimeType!=null&&(n.uint32(10),n.string(t.MimeType)),i.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const s=t.uint32();switch(s>>>3){case 1:i.MimeType=t.string();break;default:t.skipType(s&7);break}}return i})),e),r.encode=t=>GO(t,r.codec()),r.decode=t=>HO(t,r.codec())})(AM||(AM={}));const xM={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},Zoe=["directory","hamt-sharded-directory"],SM=parseInt("0644",8),TM=parseInt("0755",8);class Hc{static unmarshal(e){const t=_l.decode(e),n=new Hc({type:xM[t.Type!=null?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:t.mtime!=null?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return n._originalMode=t.mode??0,n}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){const{type:t,data:n,blockSizes:i,hashType:o,fanout:s,mtime:a,mode:l}=e;if(t!=null&&!Object.values(xM).includes(t))throw Zr(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t??"file",this.data=n,this.hashType=o,this.fanout=s,this.blockSizes=i??[],this._originalMode=0,this.mode=l,this.mtime=a}set mode(e){e==null?this._mode=this.isDirectory()?TM:SM:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return Zoe.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=_l.DataType.Raw;break;case"directory":e=_l.DataType.Directory;break;case"file":e=_l.DataType.File;break;case"metadata":e=_l.DataType.Metadata;break;case"symlink":e=_l.DataType.Symlink;break;case"hamt-sharded-directory":e=_l.DataType.HAMTShard;break;default:throw Zr(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let t=this.data;(this.data==null||this.data.length===0)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===SM&&!this.isDirectory()&&(n=void 0),n===TM&&this.isDirectory()&&(n=void 0));let i;return this.mtime!=null&&(i={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),_l.encode({Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i})}}const Joe="raw",xw=85,Xoe=r=>xv(r),Qoe=r=>xv(r),ese=Object.freeze(Object.defineProperty({__proto__:null,code:xw,decode:Qoe,encode:Xoe,name:Joe},Symbol.toStringTag,{value:"Module"}));class dc extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}const Ng=async(r,e,t)=>{t.codec==null&&(t.codec=pz);const n=await Xl.digest(r),i=er.create(t.cidVersion,t.codec.code,n);return await e.put(i,r,t),i};function tse(r){return async function*(t,n){let i=0n;for await(let o of t.content)yield async()=>{let s;const a={codec:pz,cidVersion:r.cidVersion,onProgress:r.onProgress};r.rawLeaves?(a.codec=ese,a.cidVersion=1):(s=new Hc({type:r.leafType,data:o}),o=$h({Data:s.marshal(),Links:[]}));const l=await Ng(o,n,a);return i+=BigInt(o.byteLength),r.onProgress?.(new dc("unixfs:importer:progress:file:write",{bytesWritten:i,cid:l,path:t.path})),{cid:l,unixfs:s,size:BigInt(o.length),block:o}}}}const rse=async(r,e,t)=>{const n=new Hc({type:"directory",mtime:r.mtime,mode:r.mode}),i=$h(Th({Data:n.marshal()})),o=await Ng(i,e,t),s=r.path;return{cid:o,path:s,unixfs:n,size:BigInt(i.length),originalPath:r.originalPath,block:i}};async function*nse(r,e,t){let n=-1,i;for await(const o of az(t.bufferImporter(r,e),t.blockWriteConcurrency)){if(n++,n===0){i={...o,single:!0};continue}else n===1&&i!=null&&(yield{...i,block:void 0,single:void 0},i=void 0);yield{...o,block:void 0}}i!=null&&(yield i)}function $M(r){return r.single===!0}const ise=(r,e,t)=>async function(i){if(i.length===1&&$M(i[0])&&t.reduceSingleLeafToSelf){const c=i[0];let u=c.block;return $M(c)&&(r.mtime!==void 0||r.mode!==void 0)&&(c.unixfs=new Hc({type:"file",mtime:r.mtime,mode:r.mode,data:c.block}),u={Data:c.unixfs.marshal(),Links:[]},c.block=$h(Th(u)),c.cid=await Ng(c.block,e,{...t,cidVersion:t.cidVersion}),c.size=BigInt(c.block.length)),t.onProgress?.(new dc("unixfs:importer:progress:file:layout",{cid:c.cid,path:c.originalPath})),{cid:c.cid,path:r.path,unixfs:c.unixfs,size:c.size,originalPath:c.originalPath}}const o=new Hc({type:"file",mtime:r.mtime,mode:r.mode}),s=i.filter(c=>c.cid.code===xw&&c.size>0||c.unixfs!=null&&c.unixfs.data==null&&c.unixfs.fileSize()>0n?!0:!!c.unixfs?.data?.length).map(c=>c.cid.code===xw?(o.addBlockSize(c.size),{Name:"",Tsize:Number(c.size),Hash:c.cid}):(c.unixfs==null||c.unixfs.data==null?o.addBlockSize(c.unixfs?.fileSize()??0n):o.addBlockSize(BigInt(c.unixfs.data.length)),{Name:"",Tsize:Number(c.size),Hash:c.cid})),a={Data:o.marshal(),Links:s},l=$h(Th(a)),d=await Ng(l,e,t);return t.onProgress?.(new dc("unixfs:importer:progress:file:layout",{cid:d,path:r.originalPath})),{cid:d,path:r.path,unixfs:o,size:BigInt(l.length+a.Links.reduce((c,u)=>c+(u.Tsize??0),0)),originalPath:r.originalPath,block:l}},ose=async(r,e,t)=>t.layout(nse(r,e,t),ise(r,e,t));function sse(r){return Symbol.iterator in r}function ase(r){return Symbol.asyncIterator in r}function cse(r){try{if(r instanceof Uint8Array)return async function*(){yield r}();if(sse(r))return async function*(){yield*r}();if(ase(r))return r}catch{throw Zr(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw Zr(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function lse(r){return async function*(t,n){for await(const i of t){let o;if(i.path!=null&&(o=i.path,i.path=i.path.split("/").filter(s=>s!=null&&s!==".").join("/")),dse(i)){const s={path:i.path,mtime:i.mtime,mode:i.mode,content:async function*(){let a=0n;for await(const l of r.chunker(r.chunkValidator(cse(i.content)))){const d=BigInt(l.byteLength);a+=d,r.onProgress?.(new dc("unixfs:importer:progress:file:read",{bytesRead:a,chunkSize:d,path:i.path})),yield l}}(),originalPath:o};yield async()=>ose(s,n,r)}else if(i.path!=null){const s={path:i.path,mtime:i.mtime,mode:i.mode,originalPath:o};yield async()=>rse(s,n,r)}else throw new Error("Import candidate must have content or path or both")}}}function dse(r){return r.content!=null}function _z(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}const use=E_({prefix:"9",name:"base10",alphabet:"0123456789"}),fse=Object.freeze(Object.defineProperty({__proto__:null,base10:use},Symbol.toStringTag,{value:"Module"})),hse=Ao({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pse=Ao({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),yse=Object.freeze(Object.defineProperty({__proto__:null,base16:hse,base16upper:pse},Symbol.toStringTag,{value:"Module"})),mse=Ao({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),gse=Object.freeze(Object.defineProperty({__proto__:null,base2:mse},Symbol.toStringTag,{value:"Module"})),Ez=Array.from(""),vse=Ez.reduce((r,e,t)=>(r[t]=e,r),[]),bse=Ez.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function wse(r){return r.reduce((e,t)=>(e+=vse[t],e),"")}function _se(r){const e=[];for(const t of r){const n=bse[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const Ese=jx({prefix:"",name:"base256emoji",encode:wse,decode:_se}),Ase=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Ese},Symbol.toStringTag,{value:"Module"})),xse=E_({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Sse=E_({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Tse=Object.freeze(Object.defineProperty({__proto__:null,base36:xse,base36upper:Sse},Symbol.toStringTag,{value:"Module"})),$se=Ao({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),kse=Ao({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),jP=Ao({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Pse=Ao({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ise=Object.freeze(Object.defineProperty({__proto__:null,base64:$se,base64pad:kse,base64url:jP,base64urlpad:Pse},Symbol.toStringTag,{value:"Module"})),Ose=Ao({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Cse=Object.freeze(Object.defineProperty({__proto__:null,base8:Ose},Symbol.toStringTag,{value:"Module"})),Rse=jx({prefix:"\0",name:"identity",encode:r=>iie(r),decode:r=>nie(r)}),Dse=Object.freeze(Object.defineProperty({__proto__:null,identity:Rse},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Mse=({name:r,code:e,encode:t})=>new Bse(r,e,t);class Bse{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?OP(this.code,t):t.then(n=>OP(this.code,n))}else throw Error("Unknown type, must be binary type")}}const jse=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),kM=Mse({name:"sha2-256",code:18,encode:jse("SHA-256")}),PM={...Dse,...gse,...Cse,...fse,...yse,...bie,...Tse,..._ie,...Ise,...Ase};function Nse(r=0){return globalThis.Buffer?.allocUnsafe!=null?_z(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Az(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const IM=Az("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),RT=Az("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Nse(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Use={utf8:IM,"utf-8":IM,hex:PM.base16,latin1:RT,ascii:RT,binary:RT,...PM};function Lse(r,e="utf8"){const t=Use[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?_z(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}const Kse=()=>async function*(e){for await(const t of e){if(t.length===void 0)throw Zr(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof t=="string"||t instanceof String)yield Lse(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else if(t instanceof Uint8Array)yield t;else throw Zr(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}},zse=174;function Fse(r){const e=zse;return async function t(n,i){const o=[];for await(const s of sz(n,e))o.push(await i(s));return o.length>1?t(o,i):o[0]}}class Sw{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const NP=er.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),UP=er.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class ZO extends Sw{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(const[e,t]of this._children.entries())t.size!=null&&t.cid!=null&&(this.nodeSize+=e.length+(this.options.cidVersion===1?UP.bytes.byteLength:NP.bytes.byteLength));return this.nodeSize}async*flush(e){const t=[];for(const[l,d]of this._children.entries()){let c=d;if(d instanceof Sw)for await(const u of d.flush(e))c=u,yield u;c.size!=null&&c.cid!=null&&t.push({Name:l,Tsize:Number(c.size),Hash:c.cid})}const n=new Hc({type:"directory",mtime:this.mtime,mode:this.mode}),i={Data:n.marshal(),Links:t},o=$h(Th(i)),s=await Ng(o,e,this.options),a=o.length+i.Links.reduce((l,d)=>l+(d.Tsize==null?0:d.Tsize),0);this.cid=s,this.size=a,yield{cid:s,unixfs:n,path:this.path,size:BigInt(a)}}}var LP={exports:{}};(function(r,e){(function(t,n){var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function o(y){if(!Array.isArray(y)&&!ArrayBuffer.isView(y))return!1;for(var g=0;g<y.length;g++)if(!Number.isInteger(y[g])||y[g]<0||y[g]>255)return!1;return!0}function s(y,g){return(y&65535)*g+(((y>>>16)*g&65535)<<16)}function a(y,g){return y<<g|y>>>32-g}function l(y){return y^=y>>>16,y=s(y,2246822507),y^=y>>>13,y=s(y,3266489909),y^=y>>>16,y}function d(y,g){y=[y[0]>>>16,y[0]&65535,y[1]>>>16,y[1]&65535],g=[g[0]>>>16,g[0]&65535,g[1]>>>16,g[1]&65535];var w=[0,0,0,0];return w[3]+=y[3]+g[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=y[2]+g[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=y[1]+g[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=y[0]+g[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function c(y,g){y=[y[0]>>>16,y[0]&65535,y[1]>>>16,y[1]&65535],g=[g[0]>>>16,g[0]&65535,g[1]>>>16,g[1]&65535];var w=[0,0,0,0];return w[3]+=y[3]*g[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=y[2]*g[3],w[1]+=w[2]>>>16,w[2]&=65535,w[2]+=y[3]*g[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=y[1]*g[3],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=y[2]*g[2],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=y[3]*g[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=y[0]*g[3]+y[1]*g[2]+y[2]*g[1]+y[3]*g[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function u(y,g){return g%=64,g===32?[y[1],y[0]]:g<32?[y[0]<<g|y[1]>>>32-g,y[1]<<g|y[0]>>>32-g]:(g-=32,[y[1]<<g|y[0]>>>32-g,y[0]<<g|y[1]>>>32-g])}function f(y,g){return g%=64,g===0?y:g<32?[y[0]<<g|y[1]>>>32-g,y[1]<<g]:[y[1]<<g-32,0]}function h(y,g){return[y[0]^g[0],y[1]^g[1]]}function p(y){return y=h(y,[0,y[0]>>>1]),y=c(y,[4283543511,3981806797]),y=h(y,[0,y[0]>>>1]),y=c(y,[3301882366,444984403]),y=h(y,[0,y[0]>>>1]),y}i.x86.hash32=function(y,g){if(i.inputValidation&&!o(y))return n;g=g||0;for(var w=y.length%4,v=y.length-w,m=g,b=0,_=3432918353,E=461845907,S=0;S<v;S=S+4)b=y[S]|y[S+1]<<8|y[S+2]<<16|y[S+3]<<24,b=s(b,_),b=a(b,15),b=s(b,E),m^=b,m=a(m,13),m=s(m,5)+3864292196;switch(b=0,w){case 3:b^=y[S+2]<<16;case 2:b^=y[S+1]<<8;case 1:b^=y[S],b=s(b,_),b=a(b,15),b=s(b,E),m^=b}return m^=y.length,m=l(m),m>>>0},i.x86.hash128=function(y,g){if(i.inputValidation&&!o(y))return n;g=g||0;for(var w=y.length%16,v=y.length-w,m=g,b=g,_=g,E=g,S=0,T=0,O=0,M=0,Q=597399067,W=2869860233,U=951274213,ee=2716044179,R=0;R<v;R=R+16)S=y[R]|y[R+1]<<8|y[R+2]<<16|y[R+3]<<24,T=y[R+4]|y[R+5]<<8|y[R+6]<<16|y[R+7]<<24,O=y[R+8]|y[R+9]<<8|y[R+10]<<16|y[R+11]<<24,M=y[R+12]|y[R+13]<<8|y[R+14]<<16|y[R+15]<<24,S=s(S,Q),S=a(S,15),S=s(S,W),m^=S,m=a(m,19),m+=b,m=s(m,5)+1444728091,T=s(T,W),T=a(T,16),T=s(T,U),b^=T,b=a(b,17),b+=_,b=s(b,5)+197830471,O=s(O,U),O=a(O,17),O=s(O,ee),_^=O,_=a(_,15),_+=E,_=s(_,5)+2530024501,M=s(M,ee),M=a(M,18),M=s(M,Q),E^=M,E=a(E,13),E+=m,E=s(E,5)+850148119;switch(S=0,T=0,O=0,M=0,w){case 15:M^=y[R+14]<<16;case 14:M^=y[R+13]<<8;case 13:M^=y[R+12],M=s(M,ee),M=a(M,18),M=s(M,Q),E^=M;case 12:O^=y[R+11]<<24;case 11:O^=y[R+10]<<16;case 10:O^=y[R+9]<<8;case 9:O^=y[R+8],O=s(O,U),O=a(O,17),O=s(O,ee),_^=O;case 8:T^=y[R+7]<<24;case 7:T^=y[R+6]<<16;case 6:T^=y[R+5]<<8;case 5:T^=y[R+4],T=s(T,W),T=a(T,16),T=s(T,U),b^=T;case 4:S^=y[R+3]<<24;case 3:S^=y[R+2]<<16;case 2:S^=y[R+1]<<8;case 1:S^=y[R],S=s(S,Q),S=a(S,15),S=s(S,W),m^=S}return m^=y.length,b^=y.length,_^=y.length,E^=y.length,m+=b,m+=_,m+=E,b+=m,_+=m,E+=m,m=l(m),b=l(b),_=l(_),E=l(E),m+=b,m+=_,m+=E,b+=m,_+=m,E+=m,("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(_>>>0).toString(16)).slice(-8)+("00000000"+(E>>>0).toString(16)).slice(-8)},i.x64.hash128=function(y,g){if(i.inputValidation&&!o(y))return n;g=g||0;for(var w=y.length%16,v=y.length-w,m=[0,g],b=[0,g],_=[0,0],E=[0,0],S=[2277735313,289559509],T=[1291169091,658871167],O=0;O<v;O=O+16)_=[y[O+4]|y[O+5]<<8|y[O+6]<<16|y[O+7]<<24,y[O]|y[O+1]<<8|y[O+2]<<16|y[O+3]<<24],E=[y[O+12]|y[O+13]<<8|y[O+14]<<16|y[O+15]<<24,y[O+8]|y[O+9]<<8|y[O+10]<<16|y[O+11]<<24],_=c(_,S),_=u(_,31),_=c(_,T),m=h(m,_),m=u(m,27),m=d(m,b),m=d(c(m,[0,5]),[0,1390208809]),E=c(E,T),E=u(E,33),E=c(E,S),b=h(b,E),b=u(b,31),b=d(b,m),b=d(c(b,[0,5]),[0,944331445]);switch(_=[0,0],E=[0,0],w){case 15:E=h(E,f([0,y[O+14]],48));case 14:E=h(E,f([0,y[O+13]],40));case 13:E=h(E,f([0,y[O+12]],32));case 12:E=h(E,f([0,y[O+11]],24));case 11:E=h(E,f([0,y[O+10]],16));case 10:E=h(E,f([0,y[O+9]],8));case 9:E=h(E,[0,y[O+8]]),E=c(E,T),E=u(E,33),E=c(E,S),b=h(b,E);case 8:_=h(_,f([0,y[O+7]],56));case 7:_=h(_,f([0,y[O+6]],48));case 6:_=h(_,f([0,y[O+5]],40));case 5:_=h(_,f([0,y[O+4]],32));case 4:_=h(_,f([0,y[O+3]],24));case 3:_=h(_,f([0,y[O+2]],16));case 2:_=h(_,f([0,y[O+1]],8));case 1:_=h(_,[0,y[O]]),_=c(_,S),_=u(_,31),_=c(_,T),m=h(m,_)}return m=h(m,[0,y.length]),b=h(b,[0,y.length]),m=d(m,b),b=d(b,m),m=p(m),b=p(b),m=d(m,b),b=d(b,m),("00000000"+(m[0]>>>0).toString(16)).slice(-8)+("00000000"+(m[1]>>>0).toString(16)).slice(-8)+("00000000"+(b[0]>>>0).toString(16)).slice(-8)+("00000000"+(b[1]>>>0).toString(16)).slice(-8)},r.exports&&(e=r.exports=i),e.murmurHash3=i})()})(LP,LP.exports);var qse=LP.exports,Vse=qse;const Wse=Vu(Vse),xz=Dte({name:"murmur3-128",code:34,encode:r=>wee(Wse.x64.hash128(r))}),k1=7;var Hse=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let i=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):i=!0,this._setInternalPos(n,e,t,i),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,i=t;for(;n<this.length;){const o=this.get(n);i=e(i,o,n),n++}return i}find(e){let t=0,n,i;for(;t<this.length&&!n;)i=this.get(t),n=e(i),t++;return n?i:void 0}_internalPositionFor(e,t){const n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;const i=this._bitArrays[n],o=e-n*k1;if(!((i&1<<o)>0))return-1;const a=this._bitArrays.slice(0,n).reduce(Gse,0),l=~(4294967295<<o+1),d=Sz(i&l);return a+d-1}_bytePosFor(e,t){const n=Math.floor(e/k1),i=n+1;for(;!t&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*k1}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*k1)}_setInternalPos(e,t,n,i){const o=this._data,s=[t,n];if(i)this._sortData(),o[e]=s;else{if(o.length)if(o[o.length-1][0]>=t)o.push(s);else if(o[0][0]<=t)o.unshift(s);else{const a=Math.round(o.length/2);this._data=o.slice(0,a).concat(s).concat(o.slice(a))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(Yse),this._changedData=!1}bitField(){const e=[];let t=8,n=0,i=0,o;const s=this._bitArrays.slice();for(;s.length||n;){n===0&&(o=s.shift(),n=7);const l=Math.min(n,t),d=~(255<<l),c=o&d;i|=c<<8-t,o=o>>>l,n-=l,t-=l,(!t||!n&&!s.length)&&(e.push(i),i=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(Zse)}};function Gse(r,e){return r+Sz(e)}function Sz(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function Yse(r,e){return r[0]-e[0]}function Zse(r){return r[1]}const Jse=Vu(Hse);class la{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new Jse,this.key=null}async put(e,t){const n=await this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)}async get(e){const t=await this._findChild(e);if(t!=null)return t.value}async del(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof la?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof la?yield*t.eachLeafSeries():yield t}serialize(e,t){const n=[];return t(this._children.reduce((i,o,s)=>(o!=null&&(o instanceof la?i.push(o.serialize(e,t)):i.push(e(o,s))),i),n))}async asyncTransform(e,t){return Tz(this,e,t)}toJSON(){return this.serialize(Qse,eae)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof la)&&n!=null&&n.key===e)return n}async _findPlace(e){const t=this._options.hash(typeof e=="string"?$O(e):e),n=await t.take(this._options.bits),i=this._children.get(n);return i instanceof la?i._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:i}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){const n=new la(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);const i=await n._findPlace(t.existingChild.hash);return i.bucket._putAt(i,t.existingChild.key,t.existingChild.value),n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){const e=this._children.find(Xse);if(e!=null&&!(e instanceof la)){const t=e.hash;t.untake(this._options.bits);const n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function Xse(r){return!!r}function Qse(r,e){return r.key}function eae(r){return r}async function Tz(r,e,t){const n=[];for(const i of r._children.compactArray())if(i instanceof la)await Tz(i,e,t);else{const o=await e(i);n.push({bitField:r._children.bitField(),children:o})}return t(n)}const tae=[255,254,252,248,240,224,192,128],rae=[1,3,7,15,31,63,127,255];class nae{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const i=this._value[this._currentBytePos],o=this._currentBitPos+1,s=Math.min(o,t),a=iae(i,o-s,s);n=(n<<s)+a,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function iae(r,e,t){const n=oae(e,t);return(r&n)>>>e}function oae(r,e){return tae[r]&rae[Math.min(e+r-1,7)]}function sae(r){function e(t){return t instanceof OM?t:new OM(t,r)}return e}class OM{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const i=this._buffers[this._currentBufferIndex],o=Math.min(i.availableBits(),t),s=i.take(o);n=(n<<o)+s,t-=o,this._availableBits-=o,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),t);n.untake(i),t-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?AP([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new nae(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}function $z(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");const e={bits:r.bits??8,hash:sae(r.hashFn)};return new la(e)}async function aae(r){return(await xz.encode(r)).slice(0,8).reverse()}const kz=BigInt(34);class cae extends Sw{_bucket;constructor(e,t){super(e,t),this._bucket=$z({hashFn:aae,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=Iz(this._bucket,this,this.options),this.nodeSize)}async*flush(e){for await(const t of Pz(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*Pz(r,e,t,n){const i=r._children,o=[];let s=0n;for(let h=0;h<i.length;h++){const p=i.get(h);if(p==null)continue;const y=h.toString(16).toUpperCase().padStart(2,"0");if(p instanceof la){let g;for await(const w of Pz(p,e,null,n))g=w;if(g==null)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:y,Tsize:Number(g.size),Hash:g.cid}),s+=g.size}else if(lae(p.value)){const g=p.value;let w;for await(const m of g.flush(e))w=m,yield w;if(w==null)throw new Error("Did not flush dir");const v=y+p.key;o.push({Name:v,Tsize:Number(w.size),Hash:w.cid}),s+=w.size}else{const g=p.value;if(g.cid==null)continue;const w=y+p.key,v=g.size;o.push({Name:w,Tsize:Number(v),Hash:g.cid}),s+=BigInt(v??0)}}const a=Uint8Array.from(i.bitField().reverse()),l=new Hc({type:"hamt-sharded-directory",data:a,fanout:BigInt(r.tableSize()),hashType:kz,mtime:t?.mtime,mode:t?.mode}),d={Data:l.marshal(),Links:o},c=$h(Th(d)),u=await Ng(c,e,n),f=BigInt(c.byteLength)+s;yield{cid:u,unixfs:l,size:f}}function lae(r){return typeof r.flush=="function"}function Iz(r,e,t){const n=r._children,i=[];for(let l=0;l<n.length;l++){const d=n.get(l);if(d==null)continue;const c=l.toString(16).toUpperCase().padStart(2,"0");if(d instanceof la){const u=Iz(d,null,t);i.push({Name:c,Tsize:Number(u),Hash:t.cidVersion===0?NP:UP})}else if(typeof d.value.flush=="function"){const f=d.value.nodeSize();i.push({Name:c+d.key,Tsize:Number(f),Hash:t.cidVersion===0?NP:UP})}else{const u=d.value;if(u.cid==null)continue;const f=c+d.key,h=u.size;i.push({Name:f,Tsize:Number(h),Hash:u.cid})}}const o=Uint8Array.from(n.bitField().reverse()),s=new Hc({type:"hamt-sharded-directory",data:o,fanout:BigInt(r.tableSize()),hashType:kz,mtime:e?.mtime,mode:e?.mode});return $h(Th({Data:s.marshal(),Links:i})).length}async function Oz(r,e,t,n){let i=e;e instanceof ZO&&e.estimateNodeSize()>t&&(i=await dae(e,n));const o=i.parent;if(o!=null){if(i!==e){if(r!=null&&(r.parent=i),i.parentKey==null)throw new Error("No parent key found");await o.put(i.parentKey,i)}return Oz(i,o,t,n)}return i}async function dae(r,e){const t=new cae({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for await(const{key:n,child:i}of r.eachChildSeries())await t.put(n,i);return t}const uae=(r="")=>(r.trim().match(/([^\\/]|\\\/)+/g)??[]).filter(Boolean);async function fae(r,e,t){const n=uae(r.path??""),i=n.length-1;let o=e,s="";for(let a=0;a<n.length;a++){const l=n[a];s+=`${s!==""?"/":""}${l}`;const d=a===i;if(o.dirty=!0,o.cid=void 0,o.size=void 0,d)await o.put(l,r),e=await Oz(null,o,t.shardSplitThresholdBytes,t);else{let c=await o.get(l);(c==null||!(c instanceof Sw))&&(c=new ZO({root:!1,dir:!0,parent:o,parentKey:l,path:s,dirty:!0,flat:!0,mtime:c?.unixfs?.mtime,mode:c?.unixfs?.mode},t)),await o.put(l,c),o=c}}return e}async function*CM(r,e){if(!(r instanceof Sw)){r.unixfs?.isDirectory()===!0&&(yield r);return}yield*r.flush(e)}function hae(r){return async function*(t,n){let i=new ZO({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r),o,s=!1;for await(const a of t){if(a==null)continue;const l=`${a.originalPath??""}`.split("/")[0];l!=null&&l!==""&&(o==null?(o=l,s=!0):o!==l&&(s=!1)),i=await fae(a,i,r),(a.unixfs==null||!a.unixfs.isDirectory())&&(yield a)}if(r.wrapWithDirectory||s&&i.childCount()>1)yield*CM(i,n);else for await(const a of i.eachChildSeries())a!=null&&(yield*CM(a.child,n))}}async function*KP(r,e,t={}){let n;Symbol.asyncIterator in r||Symbol.iterator in r?n=r:n=[r];const i=t.wrapWithDirectory??!1,o=t.shardSplitThresholdBytes??262144,s=t.cidVersion??1,a=t.rawLeaves??!0,l=t.leafType??"file",d=t.fileImportConcurrency??50,c=t.blockWriteConcurrency??10,u=t.reduceSingleLeafToSelf??!0,f=t.chunker??aoe(),h=t.chunkValidator??Kse(),p=t.dagBuilder??lse({chunker:f,chunkValidator:h,wrapWithDirectory:i,layout:t.layout??Fse(),bufferImporter:t.bufferImporter??tse({cidVersion:s,rawLeaves:a,leafType:l,onProgress:t.onProgress}),blockWriteConcurrency:c,reduceSingleLeafToSelf:u,cidVersion:s,onProgress:t.onProgress}),y=t.treeBuilder??hae({wrapWithDirectory:i,shardSplitThresholdBytes:o,cidVersion:s,onProgress:t.onProgress});for await(const g of y(az(p(n,e),d),e))yield{cid:g.cid,path:g.path,unixfs:g.unixfs,size:g.size}}var DT=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},RM=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}};const DM={[Xl.code]:Xl},MM={[Nx]:RP};class _i{static computeCid(e,t=Nx,n=Xl.code){return DT(this,void 0,void 0,function*(){const i=MM[t];if(!i)throw new Ae(we.ComputeCidCodecNotSupported,`codec [${t}] not supported`);const o=DM[n];if(!o)throw new Ae(we.ComputeCidMultihashNotSupported,`multihash code [${n}] not supported`);const s=i.encode(e),a=yield o.digest(s);return(yield er.createV1(i.code,a)).toString()})}static parseCid(e){const t=er.parse(e).toV1();if(!MM[t.code])throw new Ae(we.ParseCidCodecNotSupported,`codec [${t.code}] not supported`);if(!DM[t.multihash.code])throw new Ae(we.ParseCidMultihashNotSupported,`multihash code [${t.multihash.code}] not supported`);return t}static computeDagPbCidFromBytes(e){var t,n,i,o;return DT(this,void 0,void 0,function*(){const s=KP([{content:e}],new gM,{cidVersion:1});let a;try{for(var l=!0,d=RM(s),c;c=yield d.next(),t=c.done,!t;l=!0)o=c.value,l=!1,a=o}catch(u){n={error:u}}finally{try{!l&&!t&&(i=d.return)&&(yield i.call(d))}finally{if(n)throw n.error}}return a?a.cid.toString():""})}static computeDagPbCidFromStream(e){var t,n,i,o;return DT(this,void 0,void 0,function*(){const s=KP([{content:e}],new gM,{cidVersion:1});let a;try{for(var l=!0,d=RM(s),c;c=yield d.next(),t=c.done,!t;l=!0)o=c.value,l=!1,a=o}catch(u){n={error:u}}finally{try{!l&&!t&&(i=d.return)&&(yield i.call(d))}finally{if(n)throw n.error}}return a?a.cid.toString():""})}}const pae={},yae=Object.freeze(Object.defineProperty({__proto__:null,default:pae},Symbol.toStringTag,{value:"Module"}));var Ym={},rl={};(function(r){/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.setBigUint64=r.Hash=r.equalBytes=r.ensureBytes=r.checkOpts=r.concatBytes=r.toBytes=r.bytesToUtf8=r.utf8ToBytes=r.asyncLoop=r.nextTick=r.hexToBytes=r.bytesToHex=r.isLE=r.createView=r.u32=r.u16=r.u8=void 0;const e=_=>_ instanceof Uint8Array,t=_=>new Uint8Array(_.buffer,_.byteOffset,_.byteLength);r.u8=t;const n=_=>new Uint16Array(_.buffer,_.byteOffset,Math.floor(_.byteLength/2));r.u16=n;const i=_=>new Uint32Array(_.buffer,_.byteOffset,Math.floor(_.byteLength/4));r.u32=i;const o=_=>new DataView(_.buffer,_.byteOffset,_.byteLength);if(r.createView=o,r.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!r.isLE)throw new Error("Non little-endian hardware is not supported");const s=Array.from({length:256},(_,E)=>E.toString(16).padStart(2,"0"));function a(_){if(!e(_))throw new Error("Uint8Array expected");let E="";for(let S=0;S<_.length;S++)E+=s[_[S]];return E}r.bytesToHex=a;function l(_){if(typeof _!="string")throw new Error("hex string expected, got "+typeof _);const E=_.length;if(E%2)throw new Error("padded hex string expected, got unpadded hex of length "+E);const S=new Uint8Array(E/2);for(let T=0;T<S.length;T++){const O=T*2,M=_.slice(O,O+2),Q=Number.parseInt(M,16);if(Number.isNaN(Q)||Q<0)throw new Error("Invalid byte sequence");S[T]=Q}return S}r.hexToBytes=l;const d=async()=>{};r.nextTick=d;async function c(_,E,S){let T=Date.now();for(let O=0;O<_;O++){S(O);const M=Date.now()-T;M>=0&&M<E||(await(0,r.nextTick)(),T+=M)}}r.asyncLoop=c;function u(_){if(typeof _!="string")throw new Error(`utf8ToBytes expected string, got ${typeof _}`);return new Uint8Array(new TextEncoder().encode(_))}r.utf8ToBytes=u;function f(_){return new TextDecoder().decode(_)}r.bytesToUtf8=f;function h(_){if(typeof _=="string"&&(_=u(_)),!e(_))throw new Error(`expected Uint8Array, got ${typeof _}`);return _}r.toBytes=h;function p(..._){const E=new Uint8Array(_.reduce((T,O)=>T+O.length,0));let S=0;return _.forEach(T=>{if(!e(T))throw new Error("Uint8Array expected");E.set(T,S),S+=T.length}),E}r.concatBytes=p;const y=_=>Object.prototype.toString.call(_)==="[object Object]"&&_.constructor===Object;function g(_,E){if(E!==void 0&&(typeof E!="object"||!y(E)))throw new Error("options must be object or undefined");return Object.assign(_,E)}r.checkOpts=g;function w(_,E){if(!(_ instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof E=="number"&&_.length!==E)throw new Error(`Uint8Array length ${E} expected`)}r.ensureBytes=w;function v(_,E){if(_.length!==E.length)throw new Error("equalBytes: Different size of Uint8Arrays");let S=!0;for(let T=0;T<_.length;T++)S&&(S=_[T]===E[T]);return S}r.equalBytes=v;class m{}r.Hash=m;function b(_,E,S,T){if(typeof _.setBigUint64=="function")return _.setBigUint64(E,S,T);const O=BigInt(32),M=BigInt(4294967295),Q=Number(S>>O&M),W=Number(S&M),U=T?4:0,ee=T?0:4;_.setUint32(E+U,Q,T),_.setUint32(E+ee,W,T)}r.setBigUint64=b})(rl);var Py={},ci={};Object.defineProperty(ci,"__esModule",{value:!0});ci.AEAD_TAG_LENGTH=ci.XCHACHA20_NONCE_LENGTH=ci.CURVE25519_PUBLIC_KEY_SIZE=ci.ETH_PUBLIC_KEY_SIZE=ci.UNCOMPRESSED_PUBLIC_KEY_SIZE=ci.COMPRESSED_PUBLIC_KEY_SIZE=ci.SECRET_KEY_LENGTH=void 0;ci.SECRET_KEY_LENGTH=32;ci.COMPRESSED_PUBLIC_KEY_SIZE=33;ci.UNCOMPRESSED_PUBLIC_KEY_SIZE=65;ci.ETH_PUBLIC_KEY_SIZE=64;ci.CURVE25519_PUBLIC_KEY_SIZE=32;ci.XCHACHA20_NONCE_LENGTH=24;ci.AEAD_TAG_LENGTH=16;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ephemeralKeySize=r.symmetricNonceLength=r.symmetricAlgorithm=r.isHkdfKeyCompressed=r.isEphemeralKeyCompressed=r.ellipticCurve=r.ECIES_CONFIG=void 0;var e=ci,t=function(){function d(){this.ellipticCurve="secp256k1",this.isEphemeralKeyCompressed=!1,this.isHkdfKeyCompressed=!1,this.symmetricAlgorithm="aes-256-gcm",this.symmetricNonceLength=16}return d}();r.ECIES_CONFIG=new t;var n=function(){return r.ECIES_CONFIG.ellipticCurve};r.ellipticCurve=n;var i=function(){return r.ECIES_CONFIG.isEphemeralKeyCompressed};r.isEphemeralKeyCompressed=i;var o=function(){return r.ECIES_CONFIG.isHkdfKeyCompressed};r.isHkdfKeyCompressed=o;var s=function(){return r.ECIES_CONFIG.symmetricAlgorithm};r.symmetricAlgorithm=s;var a=function(){return r.ECIES_CONFIG.symmetricNonceLength};r.symmetricNonceLength=a;var l=function(){var d={secp256k1:r.ECIES_CONFIG.isEphemeralKeyCompressed?e.COMPRESSED_PUBLIC_KEY_SIZE:e.UNCOMPRESSED_PUBLIC_KEY_SIZE,x25519:e.CURVE25519_PUBLIC_KEY_SIZE,ed25519:e.CURVE25519_PUBLIC_KEY_SIZE};if(r.ECIES_CONFIG.ellipticCurve in d)return d[r.ECIES_CONFIG.ellipticCurve];throw new Error("Not implemented")};r.ephemeralKeySize=l})(Py);var zP={},Ux={},Lx={},zo={},Iy={},Kx={};Object.defineProperty(Kx,"__esModule",{value:!0});Kx.crypto=void 0;Kx.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;Object.defineProperty(Iy,"__esModule",{value:!0});Iy.getWebcryptoSubtle=Iy.randomBytes=void 0;const Vp=Kx;function mae(r=32){if(Vp.crypto&&typeof Vp.crypto.getRandomValues=="function")return Vp.crypto.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}Iy.randomBytes=mae;function gae(){if(Vp.crypto&&typeof Vp.crypto.subtle=="object"&&Vp.crypto.subtle!=null)return Vp.crypto.subtle;throw new Error("crypto.subtle must be defined")}Iy.getWebcryptoSubtle=gae;var Cz={},rc={},mu={},ti={};Object.defineProperty(ti,"__esModule",{value:!0});ti.output=ti.exists=ti.hash=ti.bytes=ti.bool=ti.number=ti.isBytes=void 0;function fA(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}ti.number=fA;function Rz(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}ti.bool=Rz;function Dz(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}ti.isBytes=Dz;function JO(r,...e){if(!Dz(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}ti.bytes=JO;function Mz(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");fA(r.outputLen),fA(r.blockLen)}ti.hash=Mz;function Bz(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}ti.exists=Bz;function jz(r,e){JO(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}ti.output=jz;const vae={number:fA,bool:Rz,bytes:JO,hash:Mz,exists:Bz,output:jz};ti.default=vae;var Iv={},zx={};Object.defineProperty(zx,"__esModule",{value:!0});zx.crypto=void 0;zx.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(r){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.randomBytes=r.wrapXOFConstructorWithOpts=r.wrapConstructorWithOpts=r.wrapConstructor=r.checkOpts=r.Hash=r.concatBytes=r.toBytes=r.utf8ToBytes=r.asyncLoop=r.nextTick=r.hexToBytes=r.bytesToHex=r.byteSwap32=r.byteSwapIfBE=r.byteSwap=r.isLE=r.rotl=r.rotr=r.createView=r.u32=r.u8=r.isBytes=void 0;const e=zx,t=ti;function n(W){return W instanceof Uint8Array||W!=null&&typeof W=="object"&&W.constructor.name==="Uint8Array"}r.isBytes=n;const i=W=>new Uint8Array(W.buffer,W.byteOffset,W.byteLength);r.u8=i;const o=W=>new Uint32Array(W.buffer,W.byteOffset,Math.floor(W.byteLength/4));r.u32=o;const s=W=>new DataView(W.buffer,W.byteOffset,W.byteLength);r.createView=s;const a=(W,U)=>W<<32-U|W>>>U;r.rotr=a;const l=(W,U)=>W<<U|W>>>32-U>>>0;r.rotl=l,r.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const d=W=>W<<24&4278190080|W<<8&16711680|W>>>8&65280|W>>>24&255;r.byteSwap=d,r.byteSwapIfBE=r.isLE?W=>W:W=>(0,r.byteSwap)(W);function c(W){for(let U=0;U<W.length;U++)W[U]=(0,r.byteSwap)(W[U])}r.byteSwap32=c;const u=Array.from({length:256},(W,U)=>U.toString(16).padStart(2,"0"));function f(W){(0,t.bytes)(W);let U="";for(let ee=0;ee<W.length;ee++)U+=u[W[ee]];return U}r.bytesToHex=f;const h={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function p(W){if(W>=h._0&&W<=h._9)return W-h._0;if(W>=h._A&&W<=h._F)return W-(h._A-10);if(W>=h._a&&W<=h._f)return W-(h._a-10)}function y(W){if(typeof W!="string")throw new Error("hex string expected, got "+typeof W);const U=W.length,ee=U/2;if(U%2)throw new Error("padded hex string expected, got unpadded hex of length "+U);const R=new Uint8Array(ee);for(let z=0,K=0;z<ee;z++,K+=2){const Y=p(W.charCodeAt(K)),I=p(W.charCodeAt(K+1));if(Y===void 0||I===void 0){const D=W[K]+W[K+1];throw new Error('hex string expected, got non-hex character "'+D+'" at index '+K)}R[z]=Y*16+I}return R}r.hexToBytes=y;const g=async()=>{};r.nextTick=g;async function w(W,U,ee){let R=Date.now();for(let z=0;z<W;z++){ee(z);const K=Date.now()-R;K>=0&&K<U||(await(0,r.nextTick)(),R+=K)}}r.asyncLoop=w;function v(W){if(typeof W!="string")throw new Error(`utf8ToBytes expected string, got ${typeof W}`);return new Uint8Array(new TextEncoder().encode(W))}r.utf8ToBytes=v;function m(W){return typeof W=="string"&&(W=v(W)),(0,t.bytes)(W),W}r.toBytes=m;function b(...W){let U=0;for(let R=0;R<W.length;R++){const z=W[R];(0,t.bytes)(z),U+=z.length}const ee=new Uint8Array(U);for(let R=0,z=0;R<W.length;R++){const K=W[R];ee.set(K,z),z+=K.length}return ee}r.concatBytes=b;class _{clone(){return this._cloneInto()}}r.Hash=_;const E={}.toString;function S(W,U){if(U!==void 0&&E.call(U)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(W,U)}r.checkOpts=S;function T(W){const U=R=>W().update(m(R)).digest(),ee=W();return U.outputLen=ee.outputLen,U.blockLen=ee.blockLen,U.create=()=>W(),U}r.wrapConstructor=T;function O(W){const U=(R,z)=>W(z).update(m(R)).digest(),ee=W({});return U.outputLen=ee.outputLen,U.blockLen=ee.blockLen,U.create=R=>W(R),U}r.wrapConstructorWithOpts=O;function M(W){const U=(R,z)=>W(z).update(m(R)).digest(),ee=W({});return U.outputLen=ee.outputLen,U.blockLen=ee.blockLen,U.create=R=>W(R),U}r.wrapXOFConstructorWithOpts=M;function Q(W=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(W));throw new Error("crypto.getRandomValues must be defined")}r.randomBytes=Q})(Iv);Object.defineProperty(mu,"__esModule",{value:!0});mu.HashMD=mu.Maj=mu.Chi=void 0;const MT=ti,y0=Iv;function bae(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),l=n?4:0,d=n?0:4;r.setUint32(e+l,s,n),r.setUint32(e+d,a,n)}const wae=(r,e,t)=>r&e^~r&t;mu.Chi=wae;const _ae=(r,e,t)=>r&e^r&t^e&t;mu.Maj=_ae;class Eae extends y0.Hash{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,y0.createView)(this.buffer)}update(e){(0,MT.exists)(this);const{view:t,buffer:n,blockLen:i}=this;e=(0,y0.toBytes)(e);const o=e.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const l=(0,y0.createView)(e);for(;i<=o-s;s+=i)this.process(l,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,MT.exists)(this),(0,MT.output)(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:o}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let u=s;u<i;u++)t[u]=0;bae(n,i-8,BigInt(this.length*8),o),this.process(n,0);const a=(0,y0.createView)(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=l/4,c=this.get();if(d>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<d;u++)a.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}}mu.HashMD=Eae;var It={};Object.defineProperty(It,"__esModule",{value:!0});It.add5L=It.add5H=It.add4H=It.add4L=It.add3H=It.add3L=It.add=It.rotlBL=It.rotlBH=It.rotlSL=It.rotlSH=It.rotr32L=It.rotr32H=It.rotrBL=It.rotrBH=It.rotrSL=It.rotrSH=It.shrSL=It.shrSH=It.toBig=It.split=It.fromBig=void 0;const P1=BigInt(2**32-1),FP=BigInt(32);function XO(r,e=!1){return e?{h:Number(r&P1),l:Number(r>>FP&P1)}:{h:Number(r>>FP&P1)|0,l:Number(r&P1)|0}}It.fromBig=XO;function Nz(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:o,l:s}=XO(r[i],e);[t[i],n[i]]=[o,s]}return[t,n]}It.split=Nz;const Uz=(r,e)=>BigInt(r>>>0)<<FP|BigInt(e>>>0);It.toBig=Uz;const Lz=(r,e,t)=>r>>>t;It.shrSH=Lz;const Kz=(r,e,t)=>r<<32-t|e>>>t;It.shrSL=Kz;const zz=(r,e,t)=>r>>>t|e<<32-t;It.rotrSH=zz;const Fz=(r,e,t)=>r<<32-t|e>>>t;It.rotrSL=Fz;const qz=(r,e,t)=>r<<64-t|e>>>t-32;It.rotrBH=qz;const Vz=(r,e,t)=>r>>>t-32|e<<64-t;It.rotrBL=Vz;const Wz=(r,e)=>e;It.rotr32H=Wz;const Hz=(r,e)=>r;It.rotr32L=Hz;const Gz=(r,e,t)=>r<<t|e>>>32-t;It.rotlSH=Gz;const Yz=(r,e,t)=>e<<t|r>>>32-t;It.rotlSL=Yz;const Zz=(r,e,t)=>e<<t-32|r>>>64-t;It.rotlBH=Zz;const Jz=(r,e,t)=>r<<t-32|e>>>64-t;It.rotlBL=Jz;function Xz(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}It.add=Xz;const Qz=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0);It.add3L=Qz;const eF=(r,e,t,n)=>e+t+n+(r/2**32|0)|0;It.add3H=eF;const tF=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0);It.add4L=tF;const rF=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0;It.add4H=rF;const nF=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0);It.add5L=nF;const iF=(r,e,t,n,i,o)=>e+t+n+i+o+(r/2**32|0)|0;It.add5H=iF;const Aae={fromBig:XO,split:Nz,toBig:Uz,shrSH:Lz,shrSL:Kz,rotrSH:zz,rotrSL:Fz,rotrBH:qz,rotrBL:Vz,rotr32H:Wz,rotr32L:Hz,rotlSH:Gz,rotlSL:Yz,rotlBH:Zz,rotlBL:Jz,add:Xz,add3L:Qz,add3H:eF,add4L:tF,add4H:rF,add5H:iF,add5L:nF};It.default=Aae;Object.defineProperty(rc,"__esModule",{value:!0});rc.sha384=rc.sha512_256=rc.sha512_224=rc.sha512=rc.SHA512=void 0;const xae=mu,Vt=It,Fx=Iv,[Sae,Tae]=Vt.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),df=new Uint32Array(80),uf=new Uint32Array(80);let x_=class extends xae.HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:o,Cl:s,Dh:a,Dl:l,Eh:d,El:c,Fh:u,Fl:f,Gh:h,Gl:p,Hh:y,Hl:g}=this;return[e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g]}set(e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=o|0,this.Cl=s|0,this.Dh=a|0,this.Dl=l|0,this.Eh=d|0,this.El=c|0,this.Fh=u|0,this.Fl=f|0,this.Gh=h|0,this.Gl=p|0,this.Hh=y|0,this.Hl=g|0}process(e,t){for(let m=0;m<16;m++,t+=4)df[m]=e.getUint32(t),uf[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const b=df[m-15]|0,_=uf[m-15]|0,E=Vt.default.rotrSH(b,_,1)^Vt.default.rotrSH(b,_,8)^Vt.default.shrSH(b,_,7),S=Vt.default.rotrSL(b,_,1)^Vt.default.rotrSL(b,_,8)^Vt.default.shrSL(b,_,7),T=df[m-2]|0,O=uf[m-2]|0,M=Vt.default.rotrSH(T,O,19)^Vt.default.rotrBH(T,O,61)^Vt.default.shrSH(T,O,6),Q=Vt.default.rotrSL(T,O,19)^Vt.default.rotrBL(T,O,61)^Vt.default.shrSL(T,O,6),W=Vt.default.add4L(S,Q,uf[m-7],uf[m-16]),U=Vt.default.add4H(W,E,M,df[m-7],df[m-16]);df[m]=U|0,uf[m]=W|0}let{Ah:n,Al:i,Bh:o,Bl:s,Ch:a,Cl:l,Dh:d,Dl:c,Eh:u,El:f,Fh:h,Fl:p,Gh:y,Gl:g,Hh:w,Hl:v}=this;for(let m=0;m<80;m++){const b=Vt.default.rotrSH(u,f,14)^Vt.default.rotrSH(u,f,18)^Vt.default.rotrBH(u,f,41),_=Vt.default.rotrSL(u,f,14)^Vt.default.rotrSL(u,f,18)^Vt.default.rotrBL(u,f,41),E=u&h^~u&y,S=f&p^~f&g,T=Vt.default.add5L(v,_,S,Tae[m],uf[m]),O=Vt.default.add5H(T,w,b,E,Sae[m],df[m]),M=T|0,Q=Vt.default.rotrSH(n,i,28)^Vt.default.rotrBH(n,i,34)^Vt.default.rotrBH(n,i,39),W=Vt.default.rotrSL(n,i,28)^Vt.default.rotrBL(n,i,34)^Vt.default.rotrBL(n,i,39),U=n&o^n&a^o&a,ee=i&s^i&l^s&l;w=y|0,v=g|0,y=h|0,g=p|0,h=u|0,p=f|0,{h:u,l:f}=Vt.default.add(d|0,c|0,O|0,M|0),d=a|0,c=l|0,a=o|0,l=s|0,o=n|0,s=i|0;const R=Vt.default.add3L(M,W,ee);n=Vt.default.add3H(R,O,Q,U),i=R|0}({h:n,l:i}=Vt.default.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:o,l:s}=Vt.default.add(this.Bh|0,this.Bl|0,o|0,s|0),{h:a,l}=Vt.default.add(this.Ch|0,this.Cl|0,a|0,l|0),{h:d,l:c}=Vt.default.add(this.Dh|0,this.Dl|0,d|0,c|0),{h:u,l:f}=Vt.default.add(this.Eh|0,this.El|0,u|0,f|0),{h,l:p}=Vt.default.add(this.Fh|0,this.Fl|0,h|0,p|0),{h:y,l:g}=Vt.default.add(this.Gh|0,this.Gl|0,y|0,g|0),{h:w,l:v}=Vt.default.add(this.Hh|0,this.Hl|0,w|0,v|0),this.set(n,i,o,s,a,l,d,c,u,f,h,p,y,g,w,v)}roundClean(){df.fill(0),uf.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};rc.SHA512=x_;class $ae extends x_{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class kae extends x_{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Pae extends x_{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}rc.sha512=(0,Fx.wrapConstructor)(()=>new x_);rc.sha512_224=(0,Fx.wrapConstructor)(()=>new $ae);rc.sha512_256=(0,Fx.wrapConstructor)(()=>new kae);rc.sha384=(0,Fx.wrapConstructor)(()=>new Pae);const QO=kx(PQ);var eC={},S_={},Nr={},wr={};Object.defineProperty(wr,"__esModule",{value:!0});wr.bitMask=void 0;wr.isBytes=Vx;wr.abytes=Wx;wr.bytesToHex=tC;wr.numberToHexUnpadded=sF;wr.hexToNumber=rC;wr.hexToBytes=Hx;wr.bytesToNumberBE=Cae;wr.bytesToNumberLE=Rae;wr.numberToBytesBE=aF;wr.numberToBytesLE=Dae;wr.numberToVarBytesBE=Mae;wr.ensureBytes=Bae;wr.concatBytes=cF;wr.equalBytes=jae;wr.utf8ToBytes=Nae;wr.bitLen=Uae;wr.bitGet=Lae;wr.bitSet=Kae;wr.createHmacDrbg=Fae;wr.validateObject=Vae;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const oF=BigInt(0),qx=BigInt(1),Iae=BigInt(2);function Vx(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Wx(r){if(!Vx(r))throw new Error("Uint8Array expected")}const Oae=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function tC(r){Wx(r);let e="";for(let t=0;t<r.length;t++)e+=Oae[r[t]];return e}function sF(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function rC(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}const Td={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function BM(r){if(r>=Td._0&&r<=Td._9)return r-Td._0;if(r>=Td._A&&r<=Td._F)return r-(Td._A-10);if(r>=Td._a&&r<=Td._f)return r-(Td._a-10)}function Hx(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,o=0;i<t;i++,o+=2){const s=BM(r.charCodeAt(o)),a=BM(r.charCodeAt(o+1));if(s===void 0||a===void 0){const l=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}n[i]=s*16+a}return n}function Cae(r){return rC(tC(r))}function Rae(r){return Wx(r),rC(tC(Uint8Array.from(r).reverse()))}function aF(r,e){return Hx(r.toString(16).padStart(e*2,"0"))}function Dae(r,e){return aF(r,e).reverse()}function Mae(r){return Hx(sF(r))}function Bae(r,e,t){let n;if(typeof e=="string")try{n=Hx(e)}catch(o){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${o}`)}else if(Vx(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(`${r} expected ${t} bytes, got ${i}`);return n}function cF(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];Wx(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const o=r[n];t.set(o,i),i+=o.length}return t}function jae(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}function Nae(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Uae(r){let e;for(e=0;r>oF;r>>=qx,e+=1);return e}function Lae(r,e){return r>>BigInt(e)&qx}function Kae(r,e,t){return r|(t?qx:oF)<<BigInt(e)}const zae=r=>(Iae<<BigInt(r-1))-qx;wr.bitMask=zae;const BT=r=>new Uint8Array(r),jM=r=>Uint8Array.from(r);function Fae(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=BT(r),i=BT(r),o=0;const s=()=>{n.fill(1),i.fill(0),o=0},a=(...u)=>t(i,n,...u),l=(u=BT())=>{i=a(jM([0]),u),n=a(),u.length!==0&&(i=a(jM([1]),u),n=a())},d=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){n=a();const h=n.slice();f.push(h),u+=n.length}return cF(...f)};return(u,f)=>{s(),l(u);let h;for(;!(h=f(d()));)l();return s(),h}}const qae={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Vx(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Vae(r,e,t={}){const n=(i,o,s)=>{const a=qae[o];if(typeof a!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=r[i];if(!(s&&l===void 0)&&!a(l,r))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${o}`)};for(const[i,o]of Object.entries(e))n(i,o,!1);for(const[i,o]of Object.entries(t))n(i,o,!0);return r}Object.defineProperty(Nr,"__esModule",{value:!0});Nr.isNegativeLE=void 0;Nr.mod=da;Nr.pow=lF;Nr.pow2=Hae;Nr.invert=hA;Nr.tonelliShanks=dF;Nr.FpSqrt=uF;Nr.validateField=Zae;Nr.FpPow=fF;Nr.FpInvertBatch=hF;Nr.FpDiv=Jae;Nr.FpIsSquare=Xae;Nr.nLength=nC;Nr.Field=Qae;Nr.FpSqrtOdd=ece;Nr.FpSqrtEven=tce;Nr.hashToPrivateScalar=rce;Nr.getFieldBytesLength=iC;Nr.getMinHashLength=pF;Nr.mapHashToField=nce;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pa=wr,Oi=BigInt(0),cn=BigInt(1),Zf=BigInt(2),Wae=BigInt(3),qP=BigInt(4),NM=BigInt(5),UM=BigInt(8);BigInt(9);BigInt(16);function da(r,e){const t=r%e;return t>=Oi?t:e+t}function lF(r,e,t){if(t<=Oi||e<Oi)throw new Error("Expected power/modulo > 0");if(t===cn)return Oi;let n=cn;for(;e>Oi;)e&cn&&(n=n*r%t),r=r*r%t,e>>=cn;return n}function Hae(r,e,t){let n=r;for(;e-- >Oi;)n*=n,n%=t;return n}function hA(r,e){if(r===Oi||e<=Oi)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=da(r,e),n=e,i=Oi,o=cn;for(;t!==Oi;){const a=n/t,l=n%t,d=i-o*a;n=t,t=l,i=o,o=d}if(n!==cn)throw new Error("invert: does not exist");return da(i,e)}function dF(r){const e=(r-cn)/Zf;let t,n,i;for(t=r-cn,n=0;t%Zf===Oi;t/=Zf,n++);for(i=Zf;i<r&&lF(i,e,r)!==r-cn;i++);if(n===1){const s=(r+cn)/qP;return function(l,d){const c=l.pow(d,s);if(!l.eql(l.sqr(c),d))throw new Error("Cannot find square root");return c}}const o=(t+cn)/Zf;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let d=n,c=a.pow(a.mul(a.ONE,i),t),u=a.pow(l,o),f=a.pow(l,t);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let y=a.sqr(f);h<d&&!a.eql(y,a.ONE);h++)y=a.sqr(y);const p=a.pow(c,cn<<BigInt(d-h-1));c=a.sqr(p),u=a.mul(u,p),f=a.mul(f,c),d=h}return u}}function uF(r){if(r%qP===Wae){const e=(r+cn)/qP;return function(n,i){const o=n.pow(i,e);if(!n.eql(n.sqr(o),i))throw new Error("Cannot find square root");return o}}if(r%UM===NM){const e=(r-NM)/UM;return function(n,i){const o=n.mul(i,Zf),s=n.pow(o,e),a=n.mul(i,s),l=n.mul(n.mul(a,Zf),s),d=n.mul(a,n.sub(l,n.ONE));if(!n.eql(n.sqr(d),i))throw new Error("Cannot find square root");return d}}return dF(r)}const Gae=(r,e)=>(da(r,e)&cn)===cn;Nr.isNegativeLE=Gae;const Yae=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Zae(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Yae.reduce((n,i)=>(n[i]="function",n),e);return(0,pa.validateObject)(r,t)}function fF(r,e,t){if(t<Oi)throw new Error("Expected power > 0");if(t===Oi)return r.ONE;if(t===cn)return e;let n=r.ONE,i=e;for(;t>Oi;)t&cn&&(n=r.mul(n,i)),i=r.sqr(i),t>>=cn;return n}function hF(r,e){const t=new Array(e.length),n=e.reduce((o,s,a)=>r.is0(s)?o:(t[a]=o,r.mul(o,s)),r.ONE),i=r.inv(n);return e.reduceRight((o,s,a)=>r.is0(s)?o:(t[a]=r.mul(o,t[a]),r.mul(o,s)),i),t}function Jae(r,e,t){return r.mul(e,typeof t=="bigint"?hA(t,r.ORDER):r.inv(t))}function Xae(r){const e=(r.ORDER-cn)/Zf;return t=>{const n=r.pow(t,e);return r.eql(n,r.ZERO)||r.eql(n,r.ONE)}}function nC(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Qae(r,e,t=!1,n={}){if(r<=Oi)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:i,nByteLength:o}=nC(r,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=uF(r),a=Object.freeze({ORDER:r,BITS:i,BYTES:o,MASK:(0,pa.bitMask)(i),ZERO:Oi,ONE:cn,create:l=>da(l,r),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Oi<=l&&l<r},is0:l=>l===Oi,isOdd:l=>(l&cn)===cn,neg:l=>da(-l,r),eql:(l,d)=>l===d,sqr:l=>da(l*l,r),add:(l,d)=>da(l+d,r),sub:(l,d)=>da(l-d,r),mul:(l,d)=>da(l*d,r),pow:(l,d)=>fF(a,l,d),div:(l,d)=>da(l*hA(d,r),r),sqrN:l=>l*l,addN:(l,d)=>l+d,subN:(l,d)=>l-d,mulN:(l,d)=>l*d,inv:l=>hA(l,r),sqrt:n.sqrt||(l=>s(a,l)),invertBatch:l=>hF(a,l),cmov:(l,d,c)=>c?d:l,toBytes:l=>t?(0,pa.numberToBytesLE)(l,o):(0,pa.numberToBytesBE)(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return t?(0,pa.bytesToNumberLE)(l):(0,pa.bytesToNumberBE)(l)}});return Object.freeze(a)}function ece(r,e){if(!r.isOdd)throw new Error("Field doesn't have isOdd");const t=r.sqrt(e);return r.isOdd(t)?t:r.neg(t)}function tce(r,e){if(!r.isOdd)throw new Error("Field doesn't have isOdd");const t=r.sqrt(e);return r.isOdd(t)?r.neg(t):t}function rce(r,e,t=!1){r=(0,pa.ensureBytes)("privateHash",r);const n=r.length,i=nC(e).nByteLength+8;if(i<24||n<i||n>1024)throw new Error(`hashToPrivateScalar: expected ${i}-1024 bytes of input, got ${n}`);const o=t?(0,pa.bytesToNumberLE)(r):(0,pa.bytesToNumberBE)(r);return da(o,e-cn)+cn}function iC(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function pF(r){const e=iC(r);return e+Math.ceil(e/2)}function nce(r,e,t=!1){const n=r.length,i=iC(e),o=pF(e);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const s=t?(0,pa.bytesToNumberBE)(r):(0,pa.bytesToNumberLE)(r),a=da(s,e-cn)+cn;return t?(0,pa.numberToBytesLE)(a,i):(0,pa.numberToBytesBE)(a,i)}Object.defineProperty(S_,"__esModule",{value:!0});S_.wNAF=sce;S_.validateBasic=ace;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const LM=Nr,ice=wr,oce=BigInt(0),jT=BigInt(1);function sce(r,e){const t=(i,o)=>{const s=o.negate();return i?s:o},n=i=>{const o=Math.ceil(e/i)+1,s=2**(i-1);return{windows:o,windowSize:s}};return{constTimeNegate:t,unsafeLadder(i,o){let s=r.ZERO,a=i;for(;o>oce;)o&jT&&(s=s.add(a)),a=a.double(),o>>=jT;return s},precomputeWindow(i,o){const{windows:s,windowSize:a}=n(o),l=[];let d=i,c=d;for(let u=0;u<s;u++){c=d,l.push(c);for(let f=1;f<a;f++)c=c.add(d),l.push(c);d=c.double()}return l},wNAF(i,o,s){const{windows:a,windowSize:l}=n(i);let d=r.ZERO,c=r.BASE;const u=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const y=p*l;let g=Number(s&u);s>>=h,g>l&&(g-=f,s+=jT);const w=y,v=y+Math.abs(g)-1,m=p%2!==0,b=g<0;g===0?c=c.add(t(m,o[w])):d=d.add(t(b,o[v]))}return{p:d,f:c}},wNAFCached(i,o,s,a){const l=i._WINDOW_SIZE||1;let d=o.get(i);return d||(d=this.precomputeWindow(i,l),l!==1&&o.set(i,a(d))),this.wNAF(l,d,s)}}}function ace(r){return(0,LM.validateField)(r.Fp),(0,ice.validateObject)(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,LM.nLength)(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}Object.defineProperty(eC,"__esModule",{value:!0});eC.twistedEdwards=fce;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yF=S_,cce=Nr,Fd=wr,ff=wr,bc=BigInt(0),qs=BigInt(1),I1=BigInt(2),lce=BigInt(8),dce={zip215:!0};function uce(r){const e=(0,yF.validateBasic)(r);return Fd.validateObject(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function fce(r){const e=uce(r),{Fp:t,n,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:l}=e,d=I1<<BigInt(a*8)-qs,c=t.create,u=e.uvRatio||((Y,I)=>{try{return{isValid:!0,value:t.sqrt(Y*t.inv(I))}}catch{return{isValid:!1,value:bc}}}),f=e.adjustScalarBytes||(Y=>Y),h=e.domain||((Y,I,D)=>{if(I.length||D)throw new Error("Contexts/pre-hash are not supported");return Y}),p=Y=>typeof Y=="bigint"&&bc<Y,y=(Y,I)=>p(Y)&&p(I)&&Y<I,g=Y=>Y===bc||y(Y,d);function w(Y,I){if(y(Y,I))return Y;throw new Error(`Expected valid scalar < ${I}, got ${typeof Y} ${Y}`)}function v(Y){return Y===bc?Y:w(Y,n)}const m=new Map;function b(Y){if(!(Y instanceof _))throw new Error("ExtendedPoint expected")}class _{constructor(I,D,N,V){if(this.ex=I,this.ey=D,this.ez=N,this.et=V,!g(I))throw new Error("x required");if(!g(D))throw new Error("y required");if(!g(N))throw new Error("z required");if(!g(V))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(I){if(I instanceof _)throw new Error("extended point not allowed");const{x:D,y:N}=I||{};if(!g(D)||!g(N))throw new Error("invalid affine point");return new _(D,N,qs,c(D*N))}static normalizeZ(I){const D=t.invertBatch(I.map(N=>N.ez));return I.map((N,V)=>N.toAffine(D[V])).map(_.fromAffine)}_setWindowSize(I){this._WINDOW_SIZE=I,m.delete(this)}assertValidity(){const{a:I,d:D}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:N,ey:V,ez:J,et:j}=this,G=c(N*N),C=c(V*V),F=c(J*J),Z=c(F*F),te=c(G*I),re=c(F*c(te+C)),q=c(Z+c(D*c(G*C)));if(re!==q)throw new Error("bad point: equation left != right (1)");const L=c(N*V),k=c(J*j);if(L!==k)throw new Error("bad point: equation left != right (2)")}equals(I){b(I);const{ex:D,ey:N,ez:V}=this,{ex:J,ey:j,ez:G}=I,C=c(D*G),F=c(J*V),Z=c(N*G),te=c(j*V);return C===F&&Z===te}is0(){return this.equals(_.ZERO)}negate(){return new _(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){const{a:I}=e,{ex:D,ey:N,ez:V}=this,J=c(D*D),j=c(N*N),G=c(I1*c(V*V)),C=c(I*J),F=D+N,Z=c(c(F*F)-J-j),te=C+j,re=te-G,q=C-j,L=c(Z*re),k=c(te*q),B=c(Z*q),X=c(re*te);return new _(L,k,X,B)}add(I){b(I);const{a:D,d:N}=e,{ex:V,ey:J,ez:j,et:G}=this,{ex:C,ey:F,ez:Z,et:te}=I;if(D===BigInt(-1)){const Te=c((J-V)*(F+C)),ze=c((J+V)*(F-C)),ht=c(ze-Te);if(ht===bc)return this.double();const ie=c(j*I1*te),ce=c(G*I1*Z),H=ce+ie,$=ze+Te,P=ce-ie,se=c(H*ht),fe=c($*P),ve=c(H*P),Ee=c(ht*$);return new _(se,fe,Ee,ve)}const re=c(V*C),q=c(J*F),L=c(G*N*te),k=c(j*Z),B=c((V+J)*(C+F)-re-q),X=k-L,ne=k+L,ae=c(q-D*re),ye=c(B*X),_e=c(ne*ae),$e=c(B*ae),Ce=c(X*ne);return new _(ye,_e,Ce,$e)}subtract(I){return this.add(I.negate())}wNAF(I){return T.wNAFCached(this,m,I,_.normalizeZ)}multiply(I){const{p:D,f:N}=this.wNAF(w(I,n));return _.normalizeZ([D,N])[0]}multiplyUnsafe(I){let D=v(I);return D===bc?S:this.equals(S)||D===qs?this:this.equals(E)?this.wNAF(D).p:T.unsafeLadder(this,D)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return T.unsafeLadder(this,n).is0()}toAffine(I){const{ex:D,ey:N,ez:V}=this,J=this.is0();I==null&&(I=J?lce:t.inv(V));const j=c(D*I),G=c(N*I),C=c(V*I);if(J)return{x:bc,y:qs};if(C!==qs)throw new Error("invZ was invalid");return{x:j,y:G}}clearCofactor(){const{h:I}=e;return I===qs?this:this.multiplyUnsafe(I)}static fromHex(I,D=!1){const{d:N,a:V}=e,J=t.BYTES;I=(0,ff.ensureBytes)("pointHex",I,J);const j=I.slice(),G=I[J-1];j[J-1]=G&-129;const C=Fd.bytesToNumberLE(j);C===bc||(D?w(C,d):w(C,t.ORDER));const F=c(C*C),Z=c(F-qs),te=c(N*F-V);let{isValid:re,value:q}=u(Z,te);if(!re)throw new Error("Point.fromHex: invalid y coordinate");const L=(q&qs)===qs,k=(G&128)!==0;if(!D&&q===bc&&k)throw new Error("Point.fromHex: x=0 and x_0=1");return k!==L&&(q=c(-q)),_.fromAffine({x:q,y:C})}static fromPrivateKey(I){return Q(I).point}toRawBytes(){const{x:I,y:D}=this.toAffine(),N=Fd.numberToBytesLE(D,t.BYTES);return N[N.length-1]|=I&qs?128:0,N}toHex(){return Fd.bytesToHex(this.toRawBytes())}}_.BASE=new _(e.Gx,e.Gy,qs,c(e.Gx*e.Gy)),_.ZERO=new _(bc,qs,qs,bc);const{BASE:E,ZERO:S}=_,T=(0,yF.wNAF)(_,a*8);function O(Y){return(0,cce.mod)(Y,n)}function M(Y){return O(Fd.bytesToNumberLE(Y))}function Q(Y){const I=a;Y=(0,ff.ensureBytes)("private key",Y,I);const D=(0,ff.ensureBytes)("hashed private key",o(Y),2*I),N=f(D.slice(0,I)),V=D.slice(I,2*I),J=M(N),j=E.multiply(J),G=j.toRawBytes();return{head:N,prefix:V,scalar:J,point:j,pointBytes:G}}function W(Y){return Q(Y).pointBytes}function U(Y=new Uint8Array,...I){const D=Fd.concatBytes(...I);return M(o(h(D,(0,ff.ensureBytes)("context",Y),!!i)))}function ee(Y,I,D={}){Y=(0,ff.ensureBytes)("message",Y),i&&(Y=i(Y));const{prefix:N,scalar:V,pointBytes:J}=Q(I),j=U(D.context,N,Y),G=E.multiply(j).toRawBytes(),C=U(D.context,G,J,Y),F=O(j+C*V);v(F);const Z=Fd.concatBytes(G,Fd.numberToBytesLE(F,t.BYTES));return(0,ff.ensureBytes)("result",Z,a*2)}const R=dce;function z(Y,I,D,N=R){const{context:V,zip215:J}=N,j=t.BYTES;Y=(0,ff.ensureBytes)("signature",Y,2*j),I=(0,ff.ensureBytes)("message",I),i&&(I=i(I));const G=Fd.bytesToNumberLE(Y.slice(j,2*j));let C,F,Z;try{C=_.fromHex(D,J),F=_.fromHex(Y.slice(0,j),J),Z=E.multiplyUnsafe(G)}catch{return!1}if(!J&&C.isSmallOrder())return!1;const te=U(V,F.toRawBytes(),C.toRawBytes(),I);return F.add(C.multiplyUnsafe(te)).subtract(Z).clearCofactor().equals(_.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:W,sign:ee,verify:z,ExtendedPoint:_,utils:{getExtendedPublicKey:Q,randomPrivateKey:()=>s(t.BYTES),precompute(Y=8,I=_.BASE){return I._setWindowSize(Y),I.multiply(BigInt(3)),I}}}}var Uh={};Object.defineProperty(Uh,"__esModule",{value:!0});Uh.expand_message_xmd=mF;Uh.expand_message_xof=gF;Uh.hash_to_field=VP;Uh.isogenyMap=mce;Uh.createHasher=gce;const hce=Nr,Lo=wr,pce=Lo.bytesToNumberBE;function zf(r,e){if(r<0||r>=1<<8*e)throw new Error(`bad I2OSP call: value=${r} length=${e}`);const t=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)t[n]=r&255,r>>>=8;return new Uint8Array(t)}function yce(r,e){const t=new Uint8Array(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}function oC(r){if(!Number.isSafeInteger(r))throw new Error("number expected")}function mF(r,e,t,n){(0,Lo.abytes)(r),(0,Lo.abytes)(e),oC(t),e.length>255&&(e=n((0,Lo.concatBytes)((0,Lo.utf8ToBytes)("H2C-OVERSIZE-DST-"),e)));const{outputLen:i,blockLen:o}=n,s=Math.ceil(t/i);if(s>255)throw new Error("Invalid xmd length");const a=(0,Lo.concatBytes)(e,zf(e.length,1)),l=zf(0,o),d=zf(t,2),c=new Array(s),u=n((0,Lo.concatBytes)(l,r,d,zf(0,1),a));c[0]=n((0,Lo.concatBytes)(u,zf(1,1),a));for(let h=1;h<=s;h++){const p=[yce(u,c[h-1]),zf(h+1,1),a];c[h]=n((0,Lo.concatBytes)(...p))}return(0,Lo.concatBytes)(...c).slice(0,t)}function gF(r,e,t,n,i){if((0,Lo.abytes)(r),(0,Lo.abytes)(e),oC(t),e.length>255){const o=Math.ceil(2*n/8);e=i.create({dkLen:o}).update((0,Lo.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(e).digest()}if(t>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:t}).update(r).update(zf(t,2)).update(e).update(zf(e.length,1)).digest()}function VP(r,e,t){(0,Lo.validateObject)(t,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:n,k:i,m:o,hash:s,expand:a,DST:l}=t;(0,Lo.abytes)(r),oC(e);const d=typeof l=="string"?(0,Lo.utf8ToBytes)(l):l,c=n.toString(2).length,u=Math.ceil((c+i)/8),f=e*o*u;let h;if(a==="xmd")h=mF(r,d,f,s);else if(a==="xof")h=gF(r,d,f,i,s);else if(a==="_internal_pass")h=r;else throw new Error('expand must be "xmd" or "xof"');const p=new Array(e);for(let y=0;y<e;y++){const g=new Array(o);for(let w=0;w<o;w++){const v=u*(w+y*o),m=h.subarray(v,v+u);g[w]=(0,hce.mod)(pce(m),n)}p[y]=g}return p}function mce(r,e){const t=e.map(n=>Array.from(n).reverse());return(n,i)=>{const[o,s,a,l]=t.map(d=>d.reduce((c,u)=>r.add(r.mul(c,n),u)));return n=r.div(o,s),i=r.mul(i,r.div(a,l)),{x:n,y:i}}}function gce(r,e,t){if(typeof e!="function")throw new Error("mapToCurve() must be defined");return{hashToCurve(n,i){const o=VP(n,2,{...t,DST:t.DST,...i}),s=r.fromAffine(e(o[0])),a=r.fromAffine(e(o[1])),l=s.add(a).clearCofactor();return l.assertValidity(),l},encodeToCurve(n,i){const o=VP(n,1,{...t,DST:t.encodeDST,...i}),s=r.fromAffine(e(o[0])).clearCofactor();return s.assertValidity(),s},mapToCurve(n){if(!Array.isArray(n))throw new Error("mapToCurve: expected array of bigints");for(const o of n)if(typeof o!="bigint")throw new Error(`mapToCurve: expected array of bigints, got ${o} in array`);const i=r.fromAffine(e(n)).clearCofactor();return i.assertValidity(),i}}}var sC={};Object.defineProperty(sC,"__esModule",{value:!0});sC.montgomery=bce;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const KM=Nr,jm=wr,m0=BigInt(0),NT=BigInt(1);function vce(r){return(0,jm.validateObject)(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function bce(r){const e=vce(r),{P:t}=e,n=m=>(0,KM.mod)(m,t),i=e.montgomeryBits,o=Math.ceil(i/8),s=e.nByteLength,a=e.adjustScalarBytes||(m=>m),l=e.powPminus2||(m=>(0,KM.pow)(m,t-BigInt(2),t));function d(m,b,_){const E=n(m*(b-_));return b=n(b-E),_=n(_+E),[b,_]}function c(m){if(typeof m=="bigint"&&m0<=m&&m<t)return m;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const u=(e.a-BigInt(2))/BigInt(4);function f(m,b){const _=c(m),E=c(b),S=_;let T=NT,O=m0,M=_,Q=NT,W=m0,U;for(let R=BigInt(i-1);R>=m0;R--){const z=E>>R&NT;W^=z,U=d(W,T,M),T=U[0],M=U[1],U=d(W,O,Q),O=U[0],Q=U[1],W=z;const K=T+O,Y=n(K*K),I=T-O,D=n(I*I),N=Y-D,V=M+Q,J=M-Q,j=n(J*K),G=n(V*I),C=j+G,F=j-G;M=n(C*C),Q=n(S*n(F*F)),T=n(Y*D),O=n(N*(Y+n(u*N)))}U=d(W,T,M),T=U[0],M=U[1],U=d(W,O,Q),O=U[0],Q=U[1];const ee=l(O);return n(T*ee)}function h(m){return(0,jm.numberToBytesLE)(n(m),o)}function p(m){const b=(0,jm.ensureBytes)("u coordinate",m,o);return s===32&&(b[31]&=127),(0,jm.bytesToNumberLE)(b)}function y(m){const b=(0,jm.ensureBytes)("scalar",m),_=b.length;if(_!==o&&_!==s)throw new Error(`Expected ${o} or ${s} bytes, got ${_}`);return(0,jm.bytesToNumberLE)(a(b))}function g(m,b){const _=p(b),E=y(m),S=f(_,E);if(S===m0)throw new Error("Invalid private or public key received");return h(S)}const w=h(e.Gu);function v(m){return g(m,w)}return{scalarMult:g,scalarMultBase:v,getSharedSecret:(m,b)=>g(m,b),getPublicKey:m=>v(m),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.hash_to_ristretto255=r.hashToRistretto255=r.RistrettoPoint=r.encodeToCurve=r.hashToCurve=r.edwardsToMontgomery=r.x25519=r.ed25519ph=r.ed25519ctx=r.ed25519=r.ED25519_TORSION_SUBGROUP=void 0,r.edwardsToMontgomeryPub=E,r.edwardsToMontgomeryPriv=S;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=rc,t=QO,n=eC,i=Uh,o=Nr,s=sC,a=wr,l=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),d=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),c=BigInt(0),u=BigInt(1),f=BigInt(2),h=BigInt(3),p=BigInt(5),y=BigInt(8);function g(F){const Z=BigInt(10),te=BigInt(20),re=BigInt(40),q=BigInt(80),L=l,B=F*F%L*F%L,X=(0,o.pow2)(B,f,L)*B%L,ne=(0,o.pow2)(X,u,L)*F%L,ae=(0,o.pow2)(ne,p,L)*ne%L,ye=(0,o.pow2)(ae,Z,L)*ae%L,_e=(0,o.pow2)(ye,te,L)*ye%L,$e=(0,o.pow2)(_e,re,L)*_e%L,Ce=(0,o.pow2)($e,q,L)*$e%L,Te=(0,o.pow2)(Ce,q,L)*$e%L,ze=(0,o.pow2)(Te,Z,L)*ae%L;return{pow_p_5_8:(0,o.pow2)(ze,f,L)*F%L,b2:B}}function w(F){return F[0]&=248,F[31]&=127,F[31]|=64,F}function v(F,Z){const te=l,re=(0,o.mod)(Z*Z*Z,te),q=(0,o.mod)(re*re*Z,te),L=g(F*q).pow_p_5_8;let k=(0,o.mod)(F*re*L,te);const B=(0,o.mod)(Z*k*k,te),X=k,ne=(0,o.mod)(k*d,te),ae=B===F,ye=B===(0,o.mod)(-F,te),_e=B===(0,o.mod)(-F*d,te);return ae&&(k=X),(ye||_e)&&(k=ne),(0,o.isNegativeLE)(k,te)&&(k=(0,o.mod)(-k,te)),{isValid:ae||ye,value:k}}r.ED25519_TORSION_SUBGROUP=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];const m=(0,o.Field)(l,void 0,!0),b={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:m,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:y,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:e.sha512,randomBytes:t.randomBytes,adjustScalarBytes:w,uvRatio:v};r.ed25519=(0,n.twistedEdwards)(b);function _(F,Z,te){if(Z.length>255)throw new Error("Context is too big");return(0,t.concatBytes)((0,t.utf8ToBytes)("SigEd25519 no Ed25519 collisions"),new Uint8Array([te?1:0,Z.length]),Z,F)}r.ed25519ctx=(0,n.twistedEdwards)({...b,domain:_}),r.ed25519ph=(0,n.twistedEdwards)(Object.assign({},b,{domain:_,prehash:e.sha512})),r.x25519=(0,s.montgomery)({P:l,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:F=>{const Z=l,{pow_p_5_8:te,b2:re}=g(F);return(0,o.mod)((0,o.pow2)(te,h,Z)*re,Z)},adjustScalarBytes:w,randomBytes:t.randomBytes});function E(F){const{y:Z}=r.ed25519.ExtendedPoint.fromHex(F),te=BigInt(1);return m.toBytes(m.create((te+Z)*m.inv(te-Z)))}r.edwardsToMontgomery=E;function S(F){const Z=b.hash(F.subarray(0,32));return b.adjustScalarBytes(Z).subarray(0,32)}const T=(m.ORDER+h)/y,O=m.pow(f,T),M=m.sqrt(m.neg(m.ONE));function Q(F){const Z=(m.ORDER-p)/y,te=BigInt(486662);let re=m.sqr(F);re=m.mul(re,f);let q=m.add(re,m.ONE),L=m.neg(te),k=m.sqr(q),B=m.mul(k,q),X=m.mul(re,te);X=m.mul(X,L),X=m.add(X,k),X=m.mul(X,L);let ne=m.sqr(B);k=m.sqr(ne),ne=m.mul(ne,B),ne=m.mul(ne,X),k=m.mul(k,ne);let ae=m.pow(k,Z);ae=m.mul(ae,ne);let ye=m.mul(ae,M);k=m.sqr(ae),k=m.mul(k,B);let _e=m.eql(k,X),$e=m.cmov(ye,ae,_e),Ce=m.mul(L,re),Te=m.mul(ae,F);Te=m.mul(Te,O);let ze=m.mul(Te,M),ht=m.mul(X,re);k=m.sqr(Te),k=m.mul(k,B);let ie=m.eql(k,ht),ce=m.cmov(ze,Te,ie);k=m.sqr($e),k=m.mul(k,B);let H=m.eql(k,X),$=m.cmov(Ce,L,H),P=m.cmov(ce,$e,H),se=m.isOdd(P);return P=m.cmov(P,m.neg(P),H!==se),{xMn:$,xMd:q,yMn:P,yMd:u}}const W=(0,o.FpSqrtEven)(m,m.neg(BigInt(486664)));function U(F){const{xMn:Z,xMd:te,yMn:re,yMd:q}=Q(F);let L=m.mul(Z,q);L=m.mul(L,W);let k=m.mul(te,re),B=m.sub(Z,te),X=m.add(Z,te),ne=m.mul(k,X),ae=m.eql(ne,m.ZERO);L=m.cmov(L,m.ZERO,ae),k=m.cmov(k,m.ONE,ae),B=m.cmov(B,m.ONE,ae),X=m.cmov(X,m.ONE,ae);const ye=m.invertBatch([k,X]);return{x:m.mul(L,ye[0]),y:m.mul(B,ye[1])}}const ee=(0,i.createHasher)(r.ed25519.ExtendedPoint,F=>U(F[0]),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:m.ORDER,m:1,k:128,expand:"xmd",hash:e.sha512});r.hashToCurve=ee.hashToCurve,r.encodeToCurve=ee.encodeToCurve;function R(F){if(!(F instanceof G))throw new Error("RistrettoPoint expected")}const z=d,K=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Y=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),I=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),D=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),N=F=>v(u,F),V=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),J=F=>r.ed25519.CURVE.Fp.create((0,a.bytesToNumberLE)(F)&V);function j(F){const{d:Z}=r.ed25519.CURVE,te=r.ed25519.CURVE.Fp.ORDER,re=r.ed25519.CURVE.Fp.create,q=re(z*F*F),L=re((q+u)*I);let k=BigInt(-1);const B=re((k-Z*q)*re(q+Z));let{isValid:X,value:ne}=v(L,B),ae=re(ne*F);(0,o.isNegativeLE)(ae,te)||(ae=re(-ae)),X||(ne=ae),X||(k=q);const ye=re(k*(q-u)*D-B),_e=ne*ne,$e=re((ne+ne)*B),Ce=re(ye*K),Te=re(u-_e),ze=re(u+_e);return new r.ed25519.ExtendedPoint(re($e*ze),re(Te*Ce),re(Ce*ze),re($e*Te))}class G{constructor(Z){this.ep=Z}static fromAffine(Z){return new G(r.ed25519.ExtendedPoint.fromAffine(Z))}static hashToCurve(Z){Z=(0,a.ensureBytes)("ristrettoHash",Z,64);const te=J(Z.slice(0,32)),re=j(te),q=J(Z.slice(32,64)),L=j(q);return new G(re.add(L))}static fromHex(Z){Z=(0,a.ensureBytes)("ristrettoHex",Z,32);const{a:te,d:re}=r.ed25519.CURVE,q=r.ed25519.CURVE.Fp.ORDER,L=r.ed25519.CURVE.Fp.create,k="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",B=J(Z);if(!(0,a.equalBytes)((0,a.numberToBytesLE)(B,32),Z)||(0,o.isNegativeLE)(B,q))throw new Error(k);const X=L(B*B),ne=L(u+te*X),ae=L(u-te*X),ye=L(ne*ne),_e=L(ae*ae),$e=L(te*re*ye-_e),{isValid:Ce,value:Te}=N(L($e*_e)),ze=L(Te*ae),ht=L(Te*ze*$e);let ie=L((B+B)*ze);(0,o.isNegativeLE)(ie,q)&&(ie=L(-ie));const ce=L(ne*ht),H=L(ie*ce);if(!Ce||(0,o.isNegativeLE)(H,q)||ce===c)throw new Error(k);return new G(new r.ed25519.ExtendedPoint(ie,ce,u,H))}toRawBytes(){let{ex:Z,ey:te,ez:re,et:q}=this.ep;const L=r.ed25519.CURVE.Fp.ORDER,k=r.ed25519.CURVE.Fp.create,B=k(k(re+te)*k(re-te)),X=k(Z*te),ne=k(X*X),{value:ae}=N(k(B*ne)),ye=k(ae*B),_e=k(ae*X),$e=k(ye*_e*q);let Ce;if((0,o.isNegativeLE)(q*$e,L)){let ze=k(te*z),ht=k(Z*z);Z=ze,te=ht,Ce=k(ye*Y)}else Ce=_e;(0,o.isNegativeLE)(Z*$e,L)&&(te=k(-te));let Te=k((re-te)*Ce);return(0,o.isNegativeLE)(Te,L)&&(Te=k(-Te)),(0,a.numberToBytesLE)(Te,32)}toHex(){return(0,a.bytesToHex)(this.toRawBytes())}toString(){return this.toHex()}equals(Z){R(Z);const{ex:te,ey:re}=this.ep,{ex:q,ey:L}=Z.ep,k=r.ed25519.CURVE.Fp.create,B=k(te*L)===k(re*q),X=k(re*L)===k(te*q);return B||X}add(Z){return R(Z),new G(this.ep.add(Z.ep))}subtract(Z){return R(Z),new G(this.ep.subtract(Z.ep))}multiply(Z){return new G(this.ep.multiply(Z))}multiplyUnsafe(Z){return new G(this.ep.multiplyUnsafe(Z))}double(){return new G(this.ep.double())}negate(){return new G(this.ep.negate())}}r.RistrettoPoint=(G.BASE||(G.BASE=new G(r.ed25519.ExtendedPoint.BASE)),G.ZERO||(G.ZERO=new G(r.ed25519.ExtendedPoint.ZERO)),G);const C=(F,Z)=>{const te=Z.DST,re=typeof te=="string"?(0,t.utf8ToBytes)(te):te,q=(0,i.expand_message_xmd)(F,re,64,e.sha512);return G.hashToCurve(q)};r.hashToRistretto255=C,r.hash_to_ristretto255=r.hashToRistretto255})(Cz);var vF={};const wce=kx(jQ);var Gx={};const _ce=kx(NQ);var aC={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DER=void 0,r.weierstrassPoints=h,r.weierstrass=y,r.SWUFpSqrtRatio=g,r.mapToCurveSimpleSWU=w;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=S_,t=Nr,n=wr,i=wr;function o(v){const m=(0,e.validateBasic)(v);n.validateObject(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:b,Fp:_,a:E}=m;if(b){if(!_.eql(E,_.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof b!="object"||typeof b.beta!="bigint"||typeof b.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})}const{bytesToNumberBE:s,hexToBytes:a}=n;r.DER={Err:class extends Error{constructor(m=""){super(m)}},_parseInt(v){const{Err:m}=r.DER;if(v.length<2||v[0]!==2)throw new m("Invalid signature integer tag");const b=v[1],_=v.subarray(2,b+2);if(!b||_.length!==b)throw new m("Invalid signature integer: wrong length");if(_[0]&128)throw new m("Invalid signature integer: negative");if(_[0]===0&&!(_[1]&128))throw new m("Invalid signature integer: unnecessary leading zero");return{d:s(_),l:v.subarray(b+2)}},toSig(v){const{Err:m}=r.DER,b=typeof v=="string"?a(v):v;n.abytes(b);let _=b.length;if(_<2||b[0]!=48)throw new m("Invalid signature tag");if(b[1]!==_-2)throw new m("Invalid signature: incorrect length");const{d:E,l:S}=r.DER._parseInt(b.subarray(2)),{d:T,l:O}=r.DER._parseInt(S);if(O.length)throw new m("Invalid signature: left bytes after parsing");return{r:E,s:T}},hexFromSig(v){const m=Q=>Number.parseInt(Q[0],16)&8?"00"+Q:Q,b=Q=>{const W=Q.toString(16);return W.length&1?`0${W}`:W},_=m(b(v.s)),E=m(b(v.r)),S=_.length/2,T=E.length/2,O=b(S),M=b(T);return`30${b(T+S+4)}02${M}${E}02${O}${_}`}};const l=BigInt(0),d=BigInt(1),c=BigInt(2),u=BigInt(3),f=BigInt(4);function h(v){const m=o(v),{Fp:b}=m,_=m.toBytes||((z,K,Y)=>{const I=K.toAffine();return n.concatBytes(Uint8Array.from([4]),b.toBytes(I.x),b.toBytes(I.y))}),E=m.fromBytes||(z=>{const K=z.subarray(1),Y=b.fromBytes(K.subarray(0,b.BYTES)),I=b.fromBytes(K.subarray(b.BYTES,2*b.BYTES));return{x:Y,y:I}});function S(z){const{a:K,b:Y}=m,I=b.sqr(z),D=b.mul(I,z);return b.add(b.add(D,b.mul(z,K)),Y)}if(!b.eql(b.sqr(m.Gy),S(m.Gx)))throw new Error("bad generator point: equation left != right");function T(z){return typeof z=="bigint"&&l<z&&z<m.n}function O(z){if(!T(z))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function M(z){const{allowedPrivateKeyLengths:K,nByteLength:Y,wrapPrivateKey:I,n:D}=m;if(K&&typeof z!="bigint"){if(n.isBytes(z)&&(z=n.bytesToHex(z)),typeof z!="string"||!K.includes(z.length))throw new Error("Invalid key");z=z.padStart(Y*2,"0")}let N;try{N=typeof z=="bigint"?z:n.bytesToNumberBE((0,i.ensureBytes)("private key",z,Y))}catch{throw new Error(`private key must be ${Y} bytes, hex or bigint, not ${typeof z}`)}return I&&(N=t.mod(N,D)),O(N),N}const Q=new Map;function W(z){if(!(z instanceof U))throw new Error("ProjectivePoint expected")}class U{constructor(K,Y,I){if(this.px=K,this.py=Y,this.pz=I,K==null||!b.isValid(K))throw new Error("x required");if(Y==null||!b.isValid(Y))throw new Error("y required");if(I==null||!b.isValid(I))throw new Error("z required")}static fromAffine(K){const{x:Y,y:I}=K||{};if(!K||!b.isValid(Y)||!b.isValid(I))throw new Error("invalid affine point");if(K instanceof U)throw new Error("projective point not allowed");const D=N=>b.eql(N,b.ZERO);return D(Y)&&D(I)?U.ZERO:new U(Y,I,b.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(K){const Y=b.invertBatch(K.map(I=>I.pz));return K.map((I,D)=>I.toAffine(Y[D])).map(U.fromAffine)}static fromHex(K){const Y=U.fromAffine(E((0,i.ensureBytes)("pointHex",K)));return Y.assertValidity(),Y}static fromPrivateKey(K){return U.BASE.multiply(M(K))}_setWindowSize(K){this._WINDOW_SIZE=K,Q.delete(this)}assertValidity(){if(this.is0()){if(m.allowInfinityPoint&&!b.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:K,y:Y}=this.toAffine();if(!b.isValid(K)||!b.isValid(Y))throw new Error("bad point: x or y not FE");const I=b.sqr(Y),D=S(K);if(!b.eql(I,D))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:K}=this.toAffine();if(b.isOdd)return!b.isOdd(K);throw new Error("Field doesn't support isOdd")}equals(K){W(K);const{px:Y,py:I,pz:D}=this,{px:N,py:V,pz:J}=K,j=b.eql(b.mul(Y,J),b.mul(N,D)),G=b.eql(b.mul(I,J),b.mul(V,D));return j&&G}negate(){return new U(this.px,b.neg(this.py),this.pz)}double(){const{a:K,b:Y}=m,I=b.mul(Y,u),{px:D,py:N,pz:V}=this;let J=b.ZERO,j=b.ZERO,G=b.ZERO,C=b.mul(D,D),F=b.mul(N,N),Z=b.mul(V,V),te=b.mul(D,N);return te=b.add(te,te),G=b.mul(D,V),G=b.add(G,G),J=b.mul(K,G),j=b.mul(I,Z),j=b.add(J,j),J=b.sub(F,j),j=b.add(F,j),j=b.mul(J,j),J=b.mul(te,J),G=b.mul(I,G),Z=b.mul(K,Z),te=b.sub(C,Z),te=b.mul(K,te),te=b.add(te,G),G=b.add(C,C),C=b.add(G,C),C=b.add(C,Z),C=b.mul(C,te),j=b.add(j,C),Z=b.mul(N,V),Z=b.add(Z,Z),C=b.mul(Z,te),J=b.sub(J,C),G=b.mul(Z,F),G=b.add(G,G),G=b.add(G,G),new U(J,j,G)}add(K){W(K);const{px:Y,py:I,pz:D}=this,{px:N,py:V,pz:J}=K;let j=b.ZERO,G=b.ZERO,C=b.ZERO;const F=m.a,Z=b.mul(m.b,u);let te=b.mul(Y,N),re=b.mul(I,V),q=b.mul(D,J),L=b.add(Y,I),k=b.add(N,V);L=b.mul(L,k),k=b.add(te,re),L=b.sub(L,k),k=b.add(Y,D);let B=b.add(N,J);return k=b.mul(k,B),B=b.add(te,q),k=b.sub(k,B),B=b.add(I,D),j=b.add(V,J),B=b.mul(B,j),j=b.add(re,q),B=b.sub(B,j),C=b.mul(F,k),j=b.mul(Z,q),C=b.add(j,C),j=b.sub(re,C),C=b.add(re,C),G=b.mul(j,C),re=b.add(te,te),re=b.add(re,te),q=b.mul(F,q),k=b.mul(Z,k),re=b.add(re,q),q=b.sub(te,q),q=b.mul(F,q),k=b.add(k,q),te=b.mul(re,k),G=b.add(G,te),te=b.mul(B,k),j=b.mul(L,j),j=b.sub(j,te),te=b.mul(L,re),C=b.mul(B,C),C=b.add(C,te),new U(j,G,C)}subtract(K){return this.add(K.negate())}is0(){return this.equals(U.ZERO)}wNAF(K){return R.wNAFCached(this,Q,K,Y=>{const I=b.invertBatch(Y.map(D=>D.pz));return Y.map((D,N)=>D.toAffine(I[N])).map(U.fromAffine)})}multiplyUnsafe(K){const Y=U.ZERO;if(K===l)return Y;if(O(K),K===d)return this;const{endo:I}=m;if(!I)return R.unsafeLadder(this,K);let{k1neg:D,k1:N,k2neg:V,k2:J}=I.splitScalar(K),j=Y,G=Y,C=this;for(;N>l||J>l;)N&d&&(j=j.add(C)),J&d&&(G=G.add(C)),C=C.double(),N>>=d,J>>=d;return D&&(j=j.negate()),V&&(G=G.negate()),G=new U(b.mul(G.px,I.beta),G.py,G.pz),j.add(G)}multiply(K){O(K);let Y=K,I,D;const{endo:N}=m;if(N){const{k1neg:V,k1:J,k2neg:j,k2:G}=N.splitScalar(Y);let{p:C,f:F}=this.wNAF(J),{p:Z,f:te}=this.wNAF(G);C=R.constTimeNegate(V,C),Z=R.constTimeNegate(j,Z),Z=new U(b.mul(Z.px,N.beta),Z.py,Z.pz),I=C.add(Z),D=F.add(te)}else{const{p:V,f:J}=this.wNAF(Y);I=V,D=J}return U.normalizeZ([I,D])[0]}multiplyAndAddUnsafe(K,Y,I){const D=U.BASE,N=(J,j)=>j===l||j===d||!J.equals(D)?J.multiplyUnsafe(j):J.multiply(j),V=N(this,Y).add(N(K,I));return V.is0()?void 0:V}toAffine(K){const{px:Y,py:I,pz:D}=this,N=this.is0();K==null&&(K=N?b.ONE:b.inv(D));const V=b.mul(Y,K),J=b.mul(I,K),j=b.mul(D,K);if(N)return{x:b.ZERO,y:b.ZERO};if(!b.eql(j,b.ONE))throw new Error("invZ was invalid");return{x:V,y:J}}isTorsionFree(){const{h:K,isTorsionFree:Y}=m;if(K===d)return!0;if(Y)return Y(U,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:K,clearCofactor:Y}=m;return K===d?this:Y?Y(U,this):this.multiplyUnsafe(m.h)}toRawBytes(K=!0){return this.assertValidity(),_(U,this,K)}toHex(K=!0){return n.bytesToHex(this.toRawBytes(K))}}U.BASE=new U(m.Gx,m.Gy,b.ONE),U.ZERO=new U(b.ZERO,b.ONE,b.ZERO);const ee=m.nBitLength,R=(0,e.wNAF)(U,m.endo?Math.ceil(ee/2):ee);return{CURVE:m,ProjectivePoint:U,normPrivateKeyToScalar:M,weierstrassEquation:S,isWithinCurveOrder:T}}function p(v){const m=(0,e.validateBasic)(v);return n.validateObject(m,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...m})}function y(v){const m=p(v),{Fp:b,n:_}=m,E=b.BYTES+1,S=2*b.BYTES+1;function T(k){return l<k&&k<b.ORDER}function O(k){return t.mod(k,_)}function M(k){return t.invert(k,_)}const{ProjectivePoint:Q,normPrivateKeyToScalar:W,weierstrassEquation:U,isWithinCurveOrder:ee}=h({...m,toBytes(k,B,X){const ne=B.toAffine(),ae=b.toBytes(ne.x),ye=n.concatBytes;return X?ye(Uint8Array.from([B.hasEvenY()?2:3]),ae):ye(Uint8Array.from([4]),ae,b.toBytes(ne.y))},fromBytes(k){const B=k.length,X=k[0],ne=k.subarray(1);if(B===E&&(X===2||X===3)){const ae=n.bytesToNumberBE(ne);if(!T(ae))throw new Error("Point is not on curve");const ye=U(ae);let _e;try{_e=b.sqrt(ye)}catch(Te){const ze=Te instanceof Error?": "+Te.message:"";throw new Error("Point is not on curve"+ze)}const $e=(_e&d)===d;return(X&1)===1!==$e&&(_e=b.neg(_e)),{x:ae,y:_e}}else if(B===S&&X===4){const ae=b.fromBytes(ne.subarray(0,b.BYTES)),ye=b.fromBytes(ne.subarray(b.BYTES,2*b.BYTES));return{x:ae,y:ye}}else throw new Error(`Point of length ${B} was invalid. Expected ${E} compressed bytes or ${S} uncompressed bytes`)}}),R=k=>n.bytesToHex(n.numberToBytesBE(k,m.nByteLength));function z(k){const B=_>>d;return k>B}function K(k){return z(k)?O(-k):k}const Y=(k,B,X)=>n.bytesToNumberBE(k.slice(B,X));class I{constructor(B,X,ne){this.r=B,this.s=X,this.recovery=ne,this.assertValidity()}static fromCompact(B){const X=m.nByteLength;return B=(0,i.ensureBytes)("compactSignature",B,X*2),new I(Y(B,0,X),Y(B,X,2*X))}static fromDER(B){const{r:X,s:ne}=r.DER.toSig((0,i.ensureBytes)("DER",B));return new I(X,ne)}assertValidity(){if(!ee(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!ee(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(B){return new I(this.r,this.s,B)}recoverPublicKey(B){const{r:X,s:ne,recovery:ae}=this,ye=G((0,i.ensureBytes)("msgHash",B));if(ae==null||![0,1,2,3].includes(ae))throw new Error("recovery id invalid");const _e=ae===2||ae===3?X+m.n:X;if(_e>=b.ORDER)throw new Error("recovery id 2 or 3 invalid");const $e=ae&1?"03":"02",Ce=Q.fromHex($e+R(_e)),Te=M(_e),ze=O(-ye*Te),ht=O(ne*Te),ie=Q.BASE.multiplyAndAddUnsafe(Ce,ze,ht);if(!ie)throw new Error("point at infinify");return ie.assertValidity(),ie}hasHighS(){return z(this.s)}normalizeS(){return this.hasHighS()?new I(this.r,O(-this.s),this.recovery):this}toDERRawBytes(){return n.hexToBytes(this.toDERHex())}toDERHex(){return r.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return n.hexToBytes(this.toCompactHex())}toCompactHex(){return R(this.r)+R(this.s)}}const D={isValidPrivateKey(k){try{return W(k),!0}catch{return!1}},normPrivateKeyToScalar:W,randomPrivateKey:()=>{const k=t.getMinHashLength(m.n);return t.mapHashToField(m.randomBytes(k),m.n)},precompute(k=8,B=Q.BASE){return B._setWindowSize(k),B.multiply(BigInt(3)),B}};function N(k,B=!0){return Q.fromPrivateKey(k).toRawBytes(B)}function V(k){const B=n.isBytes(k),X=typeof k=="string",ne=(B||X)&&k.length;return B?ne===E||ne===S:X?ne===2*E||ne===2*S:k instanceof Q}function J(k,B,X=!0){if(V(k))throw new Error("first arg must be private key");if(!V(B))throw new Error("second arg must be public key");return Q.fromHex(B).multiply(W(k)).toRawBytes(X)}const j=m.bits2int||function(k){const B=n.bytesToNumberBE(k),X=k.length*8-m.nBitLength;return X>0?B>>BigInt(X):B},G=m.bits2int_modN||function(k){return O(j(k))},C=n.bitMask(m.nBitLength);function F(k){if(typeof k!="bigint")throw new Error("bigint expected");if(!(l<=k&&k<C))throw new Error(`bigint expected < 2^${m.nBitLength}`);return n.numberToBytesBE(k,m.nByteLength)}function Z(k,B,X=te){if(["recovered","canonical"].some(H=>H in X))throw new Error("sign() legacy options not supported");const{hash:ne,randomBytes:ae}=m;let{lowS:ye,prehash:_e,extraEntropy:$e}=X;ye==null&&(ye=!0),k=(0,i.ensureBytes)("msgHash",k),_e&&(k=(0,i.ensureBytes)("prehashed msgHash",ne(k)));const Ce=G(k),Te=W(B),ze=[F(Te),F(Ce)];if($e!=null&&$e!==!1){const H=$e===!0?ae(b.BYTES):$e;ze.push((0,i.ensureBytes)("extraEntropy",H))}const ht=n.concatBytes(...ze),ie=Ce;function ce(H){const $=j(H);if(!ee($))return;const P=M($),se=Q.BASE.multiply($).toAffine(),fe=O(se.x);if(fe===l)return;const ve=O(P*O(ie+fe*Te));if(ve===l)return;let Ee=(se.x===fe?0:2)|Number(se.y&d),pt=ve;return ye&&z(ve)&&(pt=K(ve),Ee^=1),new I(fe,pt,Ee)}return{seed:ht,k2sig:ce}}const te={lowS:m.lowS,prehash:!1},re={lowS:m.lowS,prehash:!1};function q(k,B,X=te){const{seed:ne,k2sig:ae}=Z(k,B,X),ye=m;return n.createHmacDrbg(ye.hash.outputLen,ye.nByteLength,ye.hmac)(ne,ae)}Q.BASE._setWindowSize(8);function L(k,B,X,ne=re){const ae=k;if(B=(0,i.ensureBytes)("msgHash",B),X=(0,i.ensureBytes)("publicKey",X),"strict"in ne)throw new Error("options.strict was renamed to lowS");const{lowS:ye,prehash:_e}=ne;let $e,Ce;try{if(typeof ae=="string"||n.isBytes(ae))try{$e=I.fromDER(ae)}catch(se){if(!(se instanceof r.DER.Err))throw se;$e=I.fromCompact(ae)}else if(typeof ae=="object"&&typeof ae.r=="bigint"&&typeof ae.s=="bigint"){const{r:se,s:fe}=ae;$e=new I(se,fe)}else throw new Error("PARSE");Ce=Q.fromHex(X)}catch(se){if(se.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(ye&&$e.hasHighS())return!1;_e&&(B=m.hash(B));const{r:Te,s:ze}=$e,ht=G(B),ie=M(ze),ce=O(ht*ie),H=O(Te*ie),$=Q.BASE.multiplyAndAddUnsafe(Ce,ce,H)?.toAffine();return $?O($.x)===Te:!1}return{CURVE:m,getPublicKey:N,getSharedSecret:J,sign:q,verify:L,ProjectivePoint:Q,Signature:I,utils:D}}function g(v,m){const b=v.ORDER;let _=l;for(let z=b-d;z%c===l;z/=c)_+=d;const E=_,S=c<<E-d-d,T=S*c,O=(b-d)/T,M=(O-d)/c,Q=T-d,W=S,U=v.pow(m,O),ee=v.pow(m,(O+d)/c);let R=(z,K)=>{let Y=U,I=v.pow(K,Q),D=v.sqr(I);D=v.mul(D,K);let N=v.mul(z,D);N=v.pow(N,M),N=v.mul(N,I),I=v.mul(N,K),D=v.mul(N,z);let V=v.mul(D,I);N=v.pow(V,W);let J=v.eql(N,v.ONE);I=v.mul(D,ee),N=v.mul(V,Y),D=v.cmov(I,D,J),V=v.cmov(N,V,J);for(let j=E;j>d;j--){let G=j-c;G=c<<G-d;let C=v.pow(V,G);const F=v.eql(C,v.ONE);I=v.mul(D,Y),Y=v.mul(Y,Y),C=v.mul(V,Y),D=v.cmov(I,D,F),V=v.cmov(C,V,F)}return{isValid:J,value:D}};if(v.ORDER%f===u){const z=(v.ORDER-u)/f,K=v.sqrt(v.neg(m));R=(Y,I)=>{let D=v.sqr(I);const N=v.mul(Y,I);D=v.mul(D,N);let V=v.pow(D,z);V=v.mul(V,N);const J=v.mul(V,K),j=v.mul(v.sqr(V),I),G=v.eql(j,Y);let C=v.cmov(J,V,G);return{isValid:G,value:C}}}return R}function w(v,m){if(t.validateField(v),!v.isValid(m.A)||!v.isValid(m.B)||!v.isValid(m.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const b=g(v,m.Z);if(!v.isOdd)throw new Error("Fp.isOdd is not implemented!");return _=>{let E,S,T,O,M,Q,W,U;E=v.sqr(_),E=v.mul(E,m.Z),S=v.sqr(E),S=v.add(S,E),T=v.add(S,v.ONE),T=v.mul(T,m.B),O=v.cmov(m.Z,v.neg(S),!v.eql(S,v.ZERO)),O=v.mul(O,m.A),S=v.sqr(T),Q=v.sqr(O),M=v.mul(Q,m.A),S=v.add(S,M),S=v.mul(S,T),Q=v.mul(Q,O),M=v.mul(Q,m.B),S=v.add(S,M),W=v.mul(E,T);const{isValid:ee,value:R}=b(S,Q);U=v.mul(E,_),U=v.mul(U,R),W=v.cmov(W,T,ee),U=v.cmov(U,R,ee);const z=v.isOdd(_)===v.isOdd(U);return U=v.cmov(v.neg(U),U,z),W=v.div(W,O),{x:W,y:U}}}})(aC);Object.defineProperty(Gx,"__esModule",{value:!0});Gx.getHash=bF;Gx.createCurve=xce;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ece=_ce,zM=QO,Ace=aC;function bF(r){return{hash:r,hmac:(e,...t)=>(0,Ece.hmac)(r,e,(0,zM.concatBytes)(...t)),randomBytes:zM.randomBytes}}function xce(r,e){const t=n=>(0,Ace.weierstrass)({...r,...bF(n)});return Object.freeze({...t(e),create:t})}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.encodeToCurve=r.hashToCurve=r.schnorr=r.secp256k1=void 0;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=wce,t=QO,n=Gx,i=Uh,o=Nr,s=wr,a=aC,l=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),d=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),c=BigInt(1),u=BigInt(2),f=(I,D)=>(I+D/u)/D;function h(I){const D=l,N=BigInt(3),V=BigInt(6),J=BigInt(11),j=BigInt(22),G=BigInt(23),C=BigInt(44),F=BigInt(88),Z=I*I*I%D,te=Z*Z*I%D,re=(0,o.pow2)(te,N,D)*te%D,q=(0,o.pow2)(re,N,D)*te%D,L=(0,o.pow2)(q,u,D)*Z%D,k=(0,o.pow2)(L,J,D)*L%D,B=(0,o.pow2)(k,j,D)*k%D,X=(0,o.pow2)(B,C,D)*B%D,ne=(0,o.pow2)(X,F,D)*X%D,ae=(0,o.pow2)(ne,C,D)*B%D,ye=(0,o.pow2)(ae,N,D)*te%D,_e=(0,o.pow2)(ye,G,D)*k%D,$e=(0,o.pow2)(_e,V,D)*Z%D,Ce=(0,o.pow2)($e,u,D);if(!p.eql(p.sqr(Ce),I))throw new Error("Cannot find square root");return Ce}const p=(0,o.Field)(l,void 0,void 0,{sqrt:h});r.secp256k1=(0,n.createCurve)({a:BigInt(0),b:BigInt(7),Fp:p,n:d,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:I=>{const D=d,N=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),V=-c*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),J=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),j=N,G=BigInt("0x100000000000000000000000000000000"),C=f(j*I,D),F=f(-V*I,D);let Z=(0,o.mod)(I-C*N-F*J,D),te=(0,o.mod)(-C*V-F*j,D);const re=Z>G,q=te>G;if(re&&(Z=D-Z),q&&(te=D-te),Z>G||te>G)throw new Error("splitScalar: Endomorphism failed, k="+I);return{k1neg:re,k1:Z,k2neg:q,k2:te}}}},e.sha256);const y=BigInt(0),g=I=>typeof I=="bigint"&&y<I&&I<l,w=I=>typeof I=="bigint"&&y<I&&I<d,v={};function m(I,...D){let N=v[I];if(N===void 0){const V=(0,e.sha256)(Uint8Array.from(I,J=>J.charCodeAt(0)));N=(0,s.concatBytes)(V,V),v[I]=N}return(0,e.sha256)((0,s.concatBytes)(N,...D))}const b=I=>I.toRawBytes(!0).slice(1),_=I=>(0,s.numberToBytesBE)(I,32),E=I=>(0,o.mod)(I,l),S=I=>(0,o.mod)(I,d),T=r.secp256k1.ProjectivePoint,O=(I,D,N)=>T.BASE.multiplyAndAddUnsafe(I,D,N);function M(I){let D=r.secp256k1.utils.normPrivateKeyToScalar(I),N=T.fromPrivateKey(D);return{scalar:N.hasEvenY()?D:S(-D),bytes:b(N)}}function Q(I){if(!g(I))throw new Error("bad x: need 0 < x < p");const D=E(I*I),N=E(D*I+BigInt(7));let V=h(N);V%u!==y&&(V=E(-V));const J=new T(I,V,c);return J.assertValidity(),J}function W(...I){return S((0,s.bytesToNumberBE)(m("BIP0340/challenge",...I)))}function U(I){return M(I).bytes}function ee(I,D,N=(0,t.randomBytes)(32)){const V=(0,s.ensureBytes)("message",I),{bytes:J,scalar:j}=M(D),G=(0,s.ensureBytes)("auxRand",N,32),C=_(j^(0,s.bytesToNumberBE)(m("BIP0340/aux",G))),F=m("BIP0340/nonce",C,J,V),Z=S((0,s.bytesToNumberBE)(F));if(Z===y)throw new Error("sign failed: k is zero");const{bytes:te,scalar:re}=M(Z),q=W(te,J,V),L=new Uint8Array(64);if(L.set(te,0),L.set(_(S(re+q*j)),32),!R(L,V,J))throw new Error("sign: Invalid signature produced");return L}function R(I,D,N){const V=(0,s.ensureBytes)("signature",I,64),J=(0,s.ensureBytes)("message",D),j=(0,s.ensureBytes)("publicKey",N,32);try{const G=Q((0,s.bytesToNumberBE)(j)),C=(0,s.bytesToNumberBE)(V.subarray(0,32));if(!g(C))return!1;const F=(0,s.bytesToNumberBE)(V.subarray(32,64));if(!w(F))return!1;const Z=W(_(C),b(G),J),te=O(G,F,S(-Z));return!(!te||!te.hasEvenY()||te.toAffine().x!==C)}catch{return!1}}r.schnorr={getPublicKey:U,sign:ee,verify:R,utils:{randomPrivateKey:r.secp256k1.utils.randomPrivateKey,lift_x:Q,pointToBytes:b,numberToBytesBE:s.numberToBytesBE,bytesToNumberBE:s.bytesToNumberBE,taggedHash:m,mod:o.mod}};const z=(0,i.isogenyMap)(p,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(I=>I.map(D=>BigInt(D)))),K=(0,a.mapToCurveSimpleSWU)(p,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:p.create(BigInt("-11"))}),Y=(0,i.createHasher)(r.secp256k1.ProjectivePoint,I=>{const{x:D,y:N}=K(p.create(I[0]));return z(D,N)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:p.ORDER,m:1,k:128,expand:"xmd",hash:e.sha256});r.hashToCurve=Y.hashToCurve,r.encodeToCurve=Y.encodeToCurve})(vF);var Oy={};Object.defineProperty(Oy,"__esModule",{value:!0});Oy.decodeHex=Oy.remove0x=void 0;var Sce=rl;function wF(r){return r.startsWith("0x")||r.startsWith("0X")?r.slice(2):r}Oy.remove0x=wF;function Tce(r){return(0,Sce.hexToBytes)(wF(r))}Oy.decodeHex=Tce;var gu={},_F={},Ug={},Vo={};Object.defineProperty(Vo,"__esModule",{value:!0});Vo.output=Vo.exists=Vo.hash=Vo.bytes=Vo.bool=Vo.number=void 0;function pA(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}Vo.number=pA;function EF(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}Vo.bool=EF;function cC(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}Vo.bytes=cC;function AF(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");pA(r.outputLen),pA(r.blockLen)}Vo.hash=AF;function xF(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}Vo.exists=xF;function SF(r,e){cC(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}Vo.output=SF;const $ce={number:pA,bool:EF,bytes:cC,hash:AF,exists:xF,output:SF};Vo.default=$ce;Object.defineProperty(Ug,"__esModule",{value:!0});Ug.poly1305=Ug.wrapConstructorWithKey=void 0;const tE=rl,UT=Vo,Ki=(r,e)=>r[e++]&255|(r[e++]&255)<<8;let kce=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,tE.toBytes)(e),(0,tE.ensureBytes)(e,32);const t=Ki(e,0),n=Ki(e,2),i=Ki(e,4),o=Ki(e,6),s=Ki(e,8),a=Ki(e,10),l=Ki(e,12),d=Ki(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|o<<9)&8191,this.r[4]=(o>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|l<<5)&8065,this.r[8]=(l>>>8|d<<8)&8191,this.r[9]=d>>>5&127;for(let c=0;c<8;c++)this.pad[c]=Ki(e,16+2*c)}process(e,t,n=!1){const i=n?0:2048,{h:o,r:s}=this,a=s[0],l=s[1],d=s[2],c=s[3],u=s[4],f=s[5],h=s[6],p=s[7],y=s[8],g=s[9],w=Ki(e,t+0),v=Ki(e,t+2),m=Ki(e,t+4),b=Ki(e,t+6),_=Ki(e,t+8),E=Ki(e,t+10),S=Ki(e,t+12),T=Ki(e,t+14);let O=o[0]+(w&8191),M=o[1]+((w>>>13|v<<3)&8191),Q=o[2]+((v>>>10|m<<6)&8191),W=o[3]+((m>>>7|b<<9)&8191),U=o[4]+((b>>>4|_<<12)&8191),ee=o[5]+(_>>>1&8191),R=o[6]+((_>>>14|E<<2)&8191),z=o[7]+((E>>>11|S<<5)&8191),K=o[8]+((S>>>8|T<<8)&8191),Y=o[9]+(T>>>5|i),I=0,D=I+O*a+M*(5*g)+Q*(5*y)+W*(5*p)+U*(5*h);I=D>>>13,D&=8191,D+=ee*(5*f)+R*(5*u)+z*(5*c)+K*(5*d)+Y*(5*l),I+=D>>>13,D&=8191;let N=I+O*l+M*a+Q*(5*g)+W*(5*y)+U*(5*p);I=N>>>13,N&=8191,N+=ee*(5*h)+R*(5*f)+z*(5*u)+K*(5*c)+Y*(5*d),I+=N>>>13,N&=8191;let V=I+O*d+M*l+Q*a+W*(5*g)+U*(5*y);I=V>>>13,V&=8191,V+=ee*(5*p)+R*(5*h)+z*(5*f)+K*(5*u)+Y*(5*c),I+=V>>>13,V&=8191;let J=I+O*c+M*d+Q*l+W*a+U*(5*g);I=J>>>13,J&=8191,J+=ee*(5*y)+R*(5*p)+z*(5*h)+K*(5*f)+Y*(5*u),I+=J>>>13,J&=8191;let j=I+O*u+M*c+Q*d+W*l+U*a;I=j>>>13,j&=8191,j+=ee*(5*g)+R*(5*y)+z*(5*p)+K*(5*h)+Y*(5*f),I+=j>>>13,j&=8191;let G=I+O*f+M*u+Q*c+W*d+U*l;I=G>>>13,G&=8191,G+=ee*a+R*(5*g)+z*(5*y)+K*(5*p)+Y*(5*h),I+=G>>>13,G&=8191;let C=I+O*h+M*f+Q*u+W*c+U*d;I=C>>>13,C&=8191,C+=ee*l+R*a+z*(5*g)+K*(5*y)+Y*(5*p),I+=C>>>13,C&=8191;let F=I+O*p+M*h+Q*f+W*u+U*c;I=F>>>13,F&=8191,F+=ee*d+R*l+z*a+K*(5*g)+Y*(5*y),I+=F>>>13,F&=8191;let Z=I+O*y+M*p+Q*h+W*f+U*u;I=Z>>>13,Z&=8191,Z+=ee*c+R*d+z*l+K*a+Y*(5*g),I+=Z>>>13,Z&=8191;let te=I+O*g+M*y+Q*p+W*h+U*f;I=te>>>13,te&=8191,te+=ee*u+R*c+z*d+K*l+Y*a,I+=te>>>13,te&=8191,I=(I<<2)+I|0,I=I+D|0,D=I&8191,I=I>>>13,N+=I,o[0]=D,o[1]=N,o[2]=V,o[3]=J,o[4]=j,o[5]=G,o[6]=C,o[7]=F,o[8]=Z,o[9]=te}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let o=(i^1)-1;for(let a=0;a<10;a++)n[a]&=o;o=~o;for(let a=0;a<10;a++)e[a]=e[a]&o|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535}update(e){UT.default.exists(this);const{buffer:t,blockLen:n}=this;e=(0,tE.toBytes)(e);const i=e.length;for(let o=0;o<i;){const s=Math.min(n-this.pos,i-o);if(s===n){for(;n<=i-o;o+=n)this.process(e,o);continue}t.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){UT.default.exists(this),UT.default.output(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let s=0;s<8;s++)e[o++]=n[s]>>>0,e[o++]=n[s]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}};function TF(r){const e=(n,i)=>r(i).update((0,tE.toBytes)(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}Ug.wrapConstructorWithKey=TF;Ug.poly1305=TF(r=>new kce(r));var Yx={};Object.defineProperty(Yx,"__esModule",{value:!0});Yx.salsaBasic=void 0;const ll=Vo,kl=rl,Pce=(0,kl.utf8ToBytes)("expand 16-byte k"),Ice=(0,kl.utf8ToBytes)("expand 32-byte k"),Oce=(0,kl.u32)(Pce),Cce=(0,kl.u32)(Ice),O1=r=>!(r.byteOffset%4),Rce=r=>{const{core:e,rounds:t,counterRight:n,counterLen:i,allow128bitKeys:o,extendNonceFn:s,blockLen:a}=(0,kl.checkOpts)({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},r);ll.default.number(i),ll.default.number(t),ll.default.number(a),ll.default.bool(n),ll.default.bool(o);const l=a/4;if(a%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(d,c,u,f,h=0)=>{if(ll.default.bytes(d),ll.default.bytes(c),ll.default.bytes(u),f||(f=new Uint8Array(u.length)),ll.default.bytes(f),ll.default.number(h),h<0||h>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(f.length<u.length)throw new Error(`Salsa/ChaCha: output (${f.length}) is shorter than data (${u.length})`);const p=[];let y,g;if(d.length===32)O1(d)?y=d:(y=d.slice(),p.push(y)),g=Cce;else if(d.length===16&&o)y=new Uint8Array(32),y.set(d),y.set(d,16),g=Oce,p.push(y);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${d.length}`);if(O1(c)||(c=c.slice(),p.push(c)),s){if(c.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");y=s(g,y,c.subarray(0,16),new Uint8Array(32)),p.push(y),c=c.subarray(16)}const w=16-i;if(c.length!==w)throw new Error(`Salsa/ChaCha: nonce must be ${w} or 16 bytes`);if(w!==12){const O=new Uint8Array(12);O.set(c,n?0:12-c.length),p.push(c=O)}const v=new Uint8Array(a),m=(0,kl.u32)(v),b=(0,kl.u32)(y),_=(0,kl.u32)(c),E=O1(u)&&(0,kl.u32)(u),S=O1(f)&&(0,kl.u32)(f);p.push(m);const T=u.length;for(let O=0,M=h;O<T;M++){if(e(g,b,_,m,M,t),M>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");const Q=Math.min(a,T-O);if(Q===a&&S&&E){const W=O/4;if(O%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let U=0;U<l;U++)S[W+U]=E[W+U]^m[U];O+=a;continue}for(let W=0;W<Q;W++)f[O+W]=u[O+W]^v[W];O+=Q}for(let O=0;O<p.length;O++)p[O].fill(0);return f}};Yx.salsaBasic=Rce;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.xchacha20poly1305=r.chacha20poly1305=r._poly1305_aead=r.chacha12=r.chacha8=r.xchacha20=r.chacha20=r.chacha20orig=r.hchacha=void 0;const e=rl,t=Ug,n=Yx,i=(u,f)=>u<<f|u>>>32-f;function o(u,f,h,p,y,g=20){let w=u[0],v=u[1],m=u[2],b=u[3],_=f[0],E=f[1],S=f[2],T=f[3],O=f[4],M=f[5],Q=f[6],W=f[7],U=y,ee=h[0],R=h[1],z=h[2],K=w,Y=v,I=m,D=b,N=_,V=E,J=S,j=T,G=O,C=M,F=Q,Z=W,te=U,re=ee,q=R,L=z;for(let B=0;B<g;B+=2)K=K+N|0,te=i(te^K,16),G=G+te|0,N=i(N^G,12),K=K+N|0,te=i(te^K,8),G=G+te|0,N=i(N^G,7),Y=Y+V|0,re=i(re^Y,16),C=C+re|0,V=i(V^C,12),Y=Y+V|0,re=i(re^Y,8),C=C+re|0,V=i(V^C,7),I=I+J|0,q=i(q^I,16),F=F+q|0,J=i(J^F,12),I=I+J|0,q=i(q^I,8),F=F+q|0,J=i(J^F,7),D=D+j|0,L=i(L^D,16),Z=Z+L|0,j=i(j^Z,12),D=D+j|0,L=i(L^D,8),Z=Z+L|0,j=i(j^Z,7),K=K+V|0,L=i(L^K,16),F=F+L|0,V=i(V^F,12),K=K+V|0,L=i(L^K,8),F=F+L|0,V=i(V^F,7),Y=Y+J|0,te=i(te^Y,16),Z=Z+te|0,J=i(J^Z,12),Y=Y+J|0,te=i(te^Y,8),Z=Z+te|0,J=i(J^Z,7),I=I+j|0,re=i(re^I,16),G=G+re|0,j=i(j^G,12),I=I+j|0,re=i(re^I,8),G=G+re|0,j=i(j^G,7),D=D+N|0,q=i(q^D,16),C=C+q|0,N=i(N^C,12),D=D+N|0,q=i(q^D,8),C=C+q|0,N=i(N^C,7);let k=0;p[k++]=w+K|0,p[k++]=v+Y|0,p[k++]=m+I|0,p[k++]=b+D|0,p[k++]=_+N|0,p[k++]=E+V|0,p[k++]=S+J|0,p[k++]=T+j|0,p[k++]=O+G|0,p[k++]=M+C|0,p[k++]=Q+F|0,p[k++]=W+Z|0,p[k++]=U+te|0,p[k++]=ee+re|0,p[k++]=R+q|0,p[k++]=z+L|0}function s(u,f,h,p){const y=(0,e.u32)(f),g=(0,e.u32)(h),w=(0,e.u32)(p);let v=u[0],m=u[1],b=u[2],_=u[3],E=y[0],S=y[1],T=y[2],O=y[3],M=y[4],Q=y[5],W=y[6],U=y[7],ee=g[0],R=g[1],z=g[2],K=g[3];for(let Y=0;Y<20;Y+=2)v=v+E|0,ee=i(ee^v,16),M=M+ee|0,E=i(E^M,12),v=v+E|0,ee=i(ee^v,8),M=M+ee|0,E=i(E^M,7),m=m+S|0,R=i(R^m,16),Q=Q+R|0,S=i(S^Q,12),m=m+S|0,R=i(R^m,8),Q=Q+R|0,S=i(S^Q,7),b=b+T|0,z=i(z^b,16),W=W+z|0,T=i(T^W,12),b=b+T|0,z=i(z^b,8),W=W+z|0,T=i(T^W,7),_=_+O|0,K=i(K^_,16),U=U+K|0,O=i(O^U,12),_=_+O|0,K=i(K^_,8),U=U+K|0,O=i(O^U,7),v=v+S|0,K=i(K^v,16),W=W+K|0,S=i(S^W,12),v=v+S|0,K=i(K^v,8),W=W+K|0,S=i(S^W,7),m=m+T|0,ee=i(ee^m,16),U=U+ee|0,T=i(T^U,12),m=m+T|0,ee=i(ee^m,8),U=U+ee|0,T=i(T^U,7),b=b+O|0,R=i(R^b,16),M=M+R|0,O=i(O^M,12),b=b+O|0,R=i(R^b,8),M=M+R|0,O=i(O^M,7),_=_+E|0,z=i(z^_,16),Q=Q+z|0,E=i(E^Q,12),_=_+E|0,z=i(z^_,8),Q=Q+z|0,E=i(E^Q,7);return w[0]=v,w[1]=m,w[2]=b,w[3]=_,w[4]=ee,w[5]=R,w[6]=z,w[7]=K,p}r.hchacha=s,r.chacha20orig=(0,n.salsaBasic)({core:o,counterRight:!1,counterLen:8}),r.chacha20=(0,n.salsaBasic)({core:o,counterRight:!1,counterLen:4,allow128bitKeys:!1}),r.xchacha20=(0,n.salsaBasic)({core:o,counterRight:!1,counterLen:8,extendNonceFn:s,allow128bitKeys:!1}),r.chacha8=(0,n.salsaBasic)({core:o,counterRight:!1,counterLen:4,rounds:8}),r.chacha12=(0,n.salsaBasic)({core:o,counterRight:!1,counterLen:4,rounds:12});const a=new Uint8Array(16),l=(u,f)=>{u.update(f);const h=f.length%16;h&&u.update(a.subarray(h))},d=(u,f,h,p,y)=>{const g=u(f,h,new Uint8Array(32)),w=t.poly1305.create(g);y&&l(w,y),l(w,p);const v=new Uint8Array(16),m=(0,e.createView)(v);(0,e.setBigUint64)(m,0,BigInt(y?y.length:0),!0),(0,e.setBigUint64)(m,8,BigInt(p.length),!0),w.update(v);const b=w.digest();return g.fill(0),b},c=u=>(f,h,p)=>((0,e.ensureBytes)(f,32),(0,e.ensureBytes)(h),{tagLength:16,encrypt:(g,w)=>{const v=g.length,m=v+16;w?(0,e.ensureBytes)(w,m):w=new Uint8Array(m),u(f,h,g,w,1);const b=d(u,f,h,w.subarray(0,-16),p);return w.set(b,v),w},decrypt:(g,w)=>{const v=g.length,m=v-16;if(v<16)throw new Error("encrypted data must be at least 16 bytes");w?(0,e.ensureBytes)(w,m):w=new Uint8Array(m);const b=g.subarray(0,-16),_=g.subarray(-16),E=d(u,f,h,b,p);if(!(0,e.equalBytes)(_,E))throw new Error("invalid tag");return u(f,h,b,w,1),w}});r._poly1305_aead=c,r.chacha20poly1305=(0,r._poly1305_aead)(r.chacha20),r.xchacha20poly1305=(0,r._poly1305_aead)(r.xchacha20)})(_F);var uh={},$F={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.hmac=r.HMAC=void 0;const e=ti,t=Iv;class n extends t.Hash{constructor(s,a){super(),this.finished=!1,this.destroyed=!1,(0,e.hash)(s);const l=(0,t.toBytes)(a);if(this.iHash=s.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,c=new Uint8Array(d);c.set(l.length>d?s.create().update(l).digest():l);for(let u=0;u<c.length;u++)c[u]^=54;this.iHash.update(c),this.oHash=s.create();for(let u=0;u<c.length;u++)c[u]^=106;this.oHash.update(c),c.fill(0)}update(s){return(0,e.exists)(this),this.iHash.update(s),this}digestInto(s){(0,e.exists)(this),(0,e.bytes)(s,this.outputLen),this.finished=!0,this.iHash.digestInto(s),this.oHash.update(s),this.oHash.digestInto(s),this.destroy()}digest(){const s=new Uint8Array(this.oHash.outputLen);return this.digestInto(s),s}_cloneInto(s){s||(s=Object.create(Object.getPrototypeOf(this),{}));const{oHash:a,iHash:l,finished:d,destroyed:c,blockLen:u,outputLen:f}=this;return s=s,s.finished=d,s.destroyed=c,s.blockLen=u,s.outputLen=f,s.oHash=a._cloneInto(s.oHash),s.iHash=l._cloneInto(s.iHash),s}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}r.HMAC=n;const i=(o,s,a)=>new n(o,s).update(a).digest();r.hmac=i,r.hmac.create=(o,s)=>new n(o,s)})($F);Object.defineProperty(uh,"__esModule",{value:!0});uh.hkdf=uh.expand=uh.extract=void 0;const WP=ti,FM=Iv,kF=$F;function PF(r,e,t){return(0,WP.hash)(r),t===void 0&&(t=new Uint8Array(r.outputLen)),(0,kF.hmac)(r,(0,FM.toBytes)(t),(0,FM.toBytes)(e))}uh.extract=PF;const LT=new Uint8Array([0]),qM=new Uint8Array;function IF(r,e,t,n=32){if((0,WP.hash)(r),(0,WP.number)(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/r.outputLen);t===void 0&&(t=qM);const o=new Uint8Array(i*r.outputLen),s=kF.hmac.create(r,e),a=s._cloneInto(),l=new Uint8Array(s.outputLen);for(let d=0;d<i;d++)LT[0]=d+1,a.update(d===0?qM:l).update(t).update(LT).digestInto(l),o.set(l,r.outputLen*d),s._cloneInto(a);return s.destroy(),a.destroy(),l.fill(0),LT.fill(0),o.slice(0,n)}uh.expand=IF;const Dce=(r,e,t,n,i)=>IF(r,PF(r,e,t),n,i);uh.hkdf=Dce;var Lg={};Object.defineProperty(Lg,"__esModule",{value:!0});Lg.sha224=Lg.sha256=void 0;const KT=mu,La=Iv,Mce=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),hf=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),pf=new Uint32Array(64);let OF=class extends KT.HashMD{constructor(){super(64,32,8,!1),this.A=hf[0]|0,this.B=hf[1]|0,this.C=hf[2]|0,this.D=hf[3]|0,this.E=hf[4]|0,this.F=hf[5]|0,this.G=hf[6]|0,this.H=hf[7]|0}get(){const{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:l}=this;return[e,t,n,i,o,s,a,l]}set(e,t,n,i,o,s,a,l){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=l|0}process(e,t){for(let u=0;u<16;u++,t+=4)pf[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const f=pf[u-15],h=pf[u-2],p=(0,La.rotr)(f,7)^(0,La.rotr)(f,18)^f>>>3,y=(0,La.rotr)(h,17)^(0,La.rotr)(h,19)^h>>>10;pf[u]=y+pf[u-7]+p+pf[u-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:d,H:c}=this;for(let u=0;u<64;u++){const f=(0,La.rotr)(a,6)^(0,La.rotr)(a,11)^(0,La.rotr)(a,25),h=c+f+(0,KT.Chi)(a,l,d)+Mce[u]+pf[u]|0,y=((0,La.rotr)(n,2)^(0,La.rotr)(n,13)^(0,La.rotr)(n,22))+(0,KT.Maj)(n,i,o)|0;c=d,d=l,l=a,a=s+h|0,s=o,o=i,i=n,n=h+y|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,d=d+this.G|0,c=c+this.H|0,this.set(n,i,o,s,a,l,d,c)}roundClean(){pf.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class Bce extends OF{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}Lg.sha256=(0,La.wrapConstructor)(()=>new OF);Lg.sha224=(0,La.wrapConstructor)(()=>new Bce);var Zx={};const lC=kx(yae);Object.defineProperty(Zx,"__esModule",{value:!0});Zx.aes256gcm=void 0;var VM=rl,WM=lC,zT=ci;function jce(r,e,t){var n=function(o){var s=(0,WM.createCipheriv)("aes-256-gcm",r,e);t&&s.setAAD(t);var a=s.update(o),l=s.final();return(0,VM.concatBytes)(a,l,s.getAuthTag())},i=function(o){var s=o.subarray(0,o.length-zT.AEAD_TAG_LENGTH),a=o.subarray(-zT.AEAD_TAG_LENGTH),l=(0,WM.createDecipheriv)("aes-256-gcm",r,e);t&&l.setAAD(t),l.setAuthTag(a);var d=l.update(s),c=l.final();return(0,VM.concatBytes)(d,c)};return{tagLength:zT.AEAD_TAG_LENGTH,encrypt:n,decrypt:i}}Zx.aes256gcm=jce;Object.defineProperty(gu,"__esModule",{value:!0});gu.deriveKey=gu.aesDecrypt=gu.aesEncrypt=void 0;var Nce=_F,CF=rl,Uce=Iy,Lce=uh,Kce=Lg,HM=Py,yA=ci,zce=Zx;function Fce(r,e){return RF(!0,r,e)}gu.aesEncrypt=Fce;function qce(r,e){return RF(!1,r,e)}gu.aesDecrypt=qce;function Vce(r){return(0,Lce.hkdf)(Kce.sha256,r,void 0,void 0,32)}gu.deriveKey=Vce;function RF(r,e,t){var n=(0,HM.symmetricAlgorithm)(),i=r?Wce:Hce;if(n==="aes-256-gcm")return i(zce.aes256gcm,e,t,(0,HM.symmetricNonceLength)());if(n==="xchacha20")return i(Nce.xchacha20poly1305,e,t,yA.XCHACHA20_NONCE_LENGTH);throw new Error("Not implemented")}function Wce(r,e,t,n){var i=(0,Uce.randomBytes)(n),o=r(e,i),s=o.encrypt(t),a=s.subarray(0,s.length-yA.AEAD_TAG_LENGTH),l=s.subarray(-yA.AEAD_TAG_LENGTH);return(0,CF.concatBytes)(i,l,a)}function Hce(r,e,t,n){var i=n+yA.AEAD_TAG_LENGTH,o=t.subarray(0,n),s=t.subarray(n,i),a=t.subarray(i),l=r(e,Uint8Array.from(o)),d=(0,CF.concatBytes)(a,s);return l.decrypt(d)}Object.defineProperty(zo,"__esModule",{value:!0});zo.hexToPublicKey=zo.convertPublicKeyFormat=zo.getSharedPoint=zo.getSharedKey=zo.getPublicKey=zo.isValidPrivateKey=zo.getValidSecret=void 0;var Gce=rl,Yce=Iy,GM=Cz,Zce=vF,FT=Py,DF=ci,Jce=Oy,Xce=gu;function Qce(){var r;do r=(0,Yce.randomBytes)(DF.SECRET_KEY_LENGTH);while(!MF(r));return r}zo.getValidSecret=Qce;function MF(r){return T_(function(e){return e.utils.isValidPrivateKey(r)},function(){return!0},function(){return!0})}zo.isValidPrivateKey=MF;function ele(r){return T_(function(e){return e.getPublicKey(r)},function(e){return e.getPublicKey(r)},function(e){return e.getPublicKey(r)})}zo.getPublicKey=ele;function tle(r,e){return(0,Xce.deriveKey)((0,Gce.concatBytes)(r,e))}zo.getSharedKey=tle;function rle(r,e,t){return T_(function(n){return n.getSharedSecret(r,e,t)},function(n){return n.getSharedSecret(r,e)},function(n){var i=n.utils.getExtendedPublicKey(r).scalar,o=n.ExtendedPoint.fromHex(e).multiply(i);return o.toRawBytes()})}zo.getSharedPoint=rle;function nle(r,e){return T_(function(t){return t.getSharedSecret(BigInt(1),r,e)},function(){return r},function(){return r})}zo.convertPublicKeyFormat=nle;function ile(r){var e=(0,Jce.decodeHex)(r);return T_(function(){if(e.length===DF.ETH_PUBLIC_KEY_SIZE){var t=new Uint8Array(1+e.length);return t.set([4]),t.set(e,1),t}return e},function(){return e},function(){return e})}zo.hexToPublicKey=ile;function T_(r,e,t){if((0,FT.ellipticCurve)()==="secp256k1")return r(Zce.secp256k1);if((0,FT.ellipticCurve)()==="x25519")return e(GM.x25519);if((0,FT.ellipticCurve)()==="ed25519")return t(GM.ed25519);throw new Error("Not implemented")}(function(r){var e=db&&db.__createBinding||(Object.create?function(n,i,o,s){s===void 0&&(s=o);var a=Object.getOwnPropertyDescriptor(i,o);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(n,s,a)}:function(n,i,o,s){s===void 0&&(s=o),n[s]=i[o]}),t=db&&db.__exportStar||function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&e(i,n,o)};Object.defineProperty(r,"__esModule",{value:!0}),t(zo,r),t(Oy,r),t(gu,r)})(Lx);var $_={};Object.defineProperty($_,"__esModule",{value:!0});$_.PublicKey=void 0;var qT=rl,ole=Py,C1=Lx,sle=function(){function r(e){this.data=(0,C1.convertPublicKeyFormat)(e,!0)}return r.fromHex=function(e){return new r((0,C1.hexToPublicKey)(e))},Object.defineProperty(r.prototype,"uncompressed",{get:function(){return Buffer.from((0,C1.convertPublicKeyFormat)(this.data,!1))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"compressed",{get:function(){return Buffer.from(this.data)},enumerable:!1,configurable:!0}),r.prototype.toHex=function(e){return e===void 0&&(e=!0),e?(0,qT.bytesToHex)(this.data):(0,qT.bytesToHex)(this.uncompressed)},r.prototype.decapsulate=function(e){var t,n;return(0,ole.isHkdfKeyCompressed)()?(t=this.data,n=e.multiply(this,!0)):(t=this.uncompressed,n=e.multiply(this,!1)),(0,C1.getSharedKey)(t,n)},r.prototype.equals=function(e){return(0,qT.equalBytes)(this.data,e.data)},r}();$_.PublicKey=sle;Object.defineProperty(Ux,"__esModule",{value:!0});Ux.PrivateKey=void 0;var YM=rl,ale=Py,gm=Lx,cle=$_,lle=function(){function r(e){var t=e===void 0?(0,gm.getValidSecret)():e;if(!(0,gm.isValidPrivateKey)(t))throw new Error("Invalid private key");this.data=t,this.publicKey=new cle.PublicKey((0,gm.getPublicKey)(t))}return r.fromHex=function(e){return new r((0,gm.decodeHex)(e))},Object.defineProperty(r.prototype,"secret",{get:function(){return Buffer.from(this.data)},enumerable:!1,configurable:!0}),r.prototype.toHex=function(){return(0,YM.bytesToHex)(this.data)},r.prototype.encapsulate=function(e){var t,n;return(0,ale.isHkdfKeyCompressed)()?(t=this.publicKey.compressed,n=this.multiply(e,!0)):(t=this.publicKey.uncompressed,n=this.multiply(e,!1)),(0,gm.getSharedKey)(t,n)},r.prototype.multiply=function(e,t){return t===void 0&&(t=!1),(0,gm.getSharedPoint)(this.data,e.compressed,t)},r.prototype.equals=function(e){return(0,YM.equalBytes)(this.data,e.data)},r}();Ux.PrivateKey=lle;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PublicKey=r.PrivateKey=void 0;var e=Ux;Object.defineProperty(r,"PrivateKey",{enumerable:!0,get:function(){return e.PrivateKey}});var t=$_;Object.defineProperty(r,"PublicKey",{enumerable:!0,get:function(){return t.PublicKey}})})(zP);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.PublicKey=r.PrivateKey=r.ECIES_CONFIG=r.decrypt=r.encrypt=void 0;var e=rl,t=Py,n=zP,i=Lx;function o(d,c){var u=new n.PrivateKey,f=d instanceof Uint8Array?new n.PublicKey(d):n.PublicKey.fromHex(d),h=u.encapsulate(f),p=(0,i.aesEncrypt)(h,c),y;return(0,t.isEphemeralKeyCompressed)()?y=u.publicKey.compressed:y=u.publicKey.uncompressed,Buffer.from((0,e.concatBytes)(y,p))}r.encrypt=o;function s(d,c){var u=d instanceof Uint8Array?new n.PrivateKey(d):n.PrivateKey.fromHex(d),f=(0,t.ephemeralKeySize)(),h=new n.PublicKey(c.subarray(0,f)),p=c.subarray(f),y=h.decapsulate(u);return Buffer.from((0,i.aesDecrypt)(y,p))}r.decrypt=s;var a=Py;Object.defineProperty(r,"ECIES_CONFIG",{enumerable:!0,get:function(){return a.ECIES_CONFIG}});var l=zP;Object.defineProperty(r,"PrivateKey",{enumerable:!0,get:function(){return l.PrivateKey}}),Object.defineProperty(r,"PublicKey",{enumerable:!0,get:function(){return l.PublicKey}}),r.utils={aesDecrypt:i.aesDecrypt,aesEncrypt:i.aesEncrypt,decodeHex:i.decodeHex,getValidSecret:i.getValidSecret,remove0x:i.remove0x}})(Ym);var BF={exports:{}},VT={exports:{}},Dn={},Jx={};Jx.byteLength=fle;Jx.toByteArray=ple;Jx.fromByteArray=gle;var Ml=[],Ka=[],dle=typeof Uint8Array<"u"?Uint8Array:Array,WT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var vm=0,ule=WT.length;vm<ule;++vm)Ml[vm]=WT[vm],Ka[WT.charCodeAt(vm)]=vm;Ka[45]=62;Ka[95]=63;function jF(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function fle(r){var e=jF(r),t=e[0],n=e[1];return(t+n)*3/4-n}function hle(r,e,t){return(e+t)*3/4-t}function ple(r){var e,t=jF(r),n=t[0],i=t[1],o=new dle(hle(r,n,i)),s=0,a=i>0?n-4:n,l;for(l=0;l<a;l+=4)e=Ka[r.charCodeAt(l)]<<18|Ka[r.charCodeAt(l+1)]<<12|Ka[r.charCodeAt(l+2)]<<6|Ka[r.charCodeAt(l+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return i===2&&(e=Ka[r.charCodeAt(l)]<<2|Ka[r.charCodeAt(l+1)]>>4,o[s++]=e&255),i===1&&(e=Ka[r.charCodeAt(l)]<<10|Ka[r.charCodeAt(l+1)]<<4|Ka[r.charCodeAt(l+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function yle(r){return Ml[r>>18&63]+Ml[r>>12&63]+Ml[r>>6&63]+Ml[r&63]}function mle(r,e,t){for(var n,i=[],o=e;o<t;o+=3)n=(r[o]<<16&16711680)+(r[o+1]<<8&65280)+(r[o+2]&255),i.push(yle(n));return i.join("")}function gle(r){for(var e,t=r.length,n=t%3,i=[],o=16383,s=0,a=t-n;s<a;s+=o)i.push(mle(r,s,s+o>a?a:s+o));return n===1?(e=r[t-1],i.push(Ml[e>>2]+Ml[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(Ml[e>>10]+Ml[e>>4&63]+Ml[e<<2&63]+"=")),i.join("")}var dC={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */dC.read=function(r,e,t,n,i){var o,s,a=i*8-n-1,l=(1<<a)-1,d=l>>1,c=-7,u=t?i-1:0,f=t?-1:1,h=r[e+u];for(u+=f,o=h&(1<<-c)-1,h>>=-c,c+=a;c>0;o=o*256+r[e+u],u+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=s*256+r[e+u],u+=f,c-=8);if(o===0)o=1-d;else{if(o===l)return s?NaN:(h?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-d}return(h?-1:1)*s*Math.pow(2,o-n)};dC.write=function(r,e,t,n,i,o){var s,a,l,d=o*8-i-1,c=(1<<d)-1,u=c>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+u>=1?e+=f/l:e+=f*Math.pow(2,1-u),e*l>=2&&(s++,l/=2),s+u>=c?(a=0,s=c):s+u>=1?(a=(e*l-1)*Math.pow(2,i),s=s+u):(a=e*Math.pow(2,u-1)*Math.pow(2,i),s=0));i>=8;r[t+h]=a&255,h+=p,a/=256,i-=8);for(s=s<<i|a,d+=i;d>0;r[t+h]=s&255,h+=p,s/=256,d-=8);r[t+h-p]|=y*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=Jx,t=dC,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=v,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{const H=new Uint8Array(1),$={foo:function(){return 42}};return Object.setPrototypeOf($,Uint8Array.prototype),Object.setPrototypeOf(H,$),H.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function s(H){if(H>i)throw new RangeError('The value "'+H+'" is invalid for option "size"');const $=new Uint8Array(H);return Object.setPrototypeOf($,a.prototype),$}function a(H,$,P){if(typeof H=="number"){if(typeof $=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return u(H)}return l(H,$,P)}a.poolSize=8192;function l(H,$,P){if(typeof H=="string")return f(H,$);if(ArrayBuffer.isView(H))return p(H);if(H==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof H);if(Te(H,ArrayBuffer)||H&&Te(H.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Te(H,SharedArrayBuffer)||H&&Te(H.buffer,SharedArrayBuffer)))return y(H,$,P);if(typeof H=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const se=H.valueOf&&H.valueOf();if(se!=null&&se!==H)return a.from(se,$,P);const fe=g(H);if(fe)return fe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof H[Symbol.toPrimitive]=="function")return a.from(H[Symbol.toPrimitive]("string"),$,P);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof H)}a.from=function(H,$,P){return l(H,$,P)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function d(H){if(typeof H!="number")throw new TypeError('"size" argument must be of type number');if(H<0)throw new RangeError('The value "'+H+'" is invalid for option "size"')}function c(H,$,P){return d(H),H<=0?s(H):$!==void 0?typeof P=="string"?s(H).fill($,P):s(H).fill($):s(H)}a.alloc=function(H,$,P){return c(H,$,P)};function u(H){return d(H),s(H<0?0:w(H)|0)}a.allocUnsafe=function(H){return u(H)},a.allocUnsafeSlow=function(H){return u(H)};function f(H,$){if((typeof $!="string"||$==="")&&($="utf8"),!a.isEncoding($))throw new TypeError("Unknown encoding: "+$);const P=m(H,$)|0;let se=s(P);const fe=se.write(H,$);return fe!==P&&(se=se.slice(0,fe)),se}function h(H){const $=H.length<0?0:w(H.length)|0,P=s($);for(let se=0;se<$;se+=1)P[se]=H[se]&255;return P}function p(H){if(Te(H,Uint8Array)){const $=new Uint8Array(H);return y($.buffer,$.byteOffset,$.byteLength)}return h(H)}function y(H,$,P){if($<0||H.byteLength<$)throw new RangeError('"offset" is outside of buffer bounds');if(H.byteLength<$+(P||0))throw new RangeError('"length" is outside of buffer bounds');let se;return $===void 0&&P===void 0?se=new Uint8Array(H):P===void 0?se=new Uint8Array(H,$):se=new Uint8Array(H,$,P),Object.setPrototypeOf(se,a.prototype),se}function g(H){if(a.isBuffer(H)){const $=w(H.length)|0,P=s($);return P.length===0||H.copy(P,0,0,$),P}if(H.length!==void 0)return typeof H.length!="number"||ze(H.length)?s(0):h(H);if(H.type==="Buffer"&&Array.isArray(H.data))return h(H.data)}function w(H){if(H>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return H|0}function v(H){return+H!=H&&(H=0),a.alloc(+H)}a.isBuffer=function($){return $!=null&&$._isBuffer===!0&&$!==a.prototype},a.compare=function($,P){if(Te($,Uint8Array)&&($=a.from($,$.offset,$.byteLength)),Te(P,Uint8Array)&&(P=a.from(P,P.offset,P.byteLength)),!a.isBuffer($)||!a.isBuffer(P))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if($===P)return 0;let se=$.length,fe=P.length;for(let ve=0,Ee=Math.min(se,fe);ve<Ee;++ve)if($[ve]!==P[ve]){se=$[ve],fe=P[ve];break}return se<fe?-1:fe<se?1:0},a.isEncoding=function($){switch(String($).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function($,P){if(!Array.isArray($))throw new TypeError('"list" argument must be an Array of Buffers');if($.length===0)return a.alloc(0);let se;if(P===void 0)for(P=0,se=0;se<$.length;++se)P+=$[se].length;const fe=a.allocUnsafe(P);let ve=0;for(se=0;se<$.length;++se){let Ee=$[se];if(Te(Ee,Uint8Array))ve+Ee.length>fe.length?(a.isBuffer(Ee)||(Ee=a.from(Ee)),Ee.copy(fe,ve)):Uint8Array.prototype.set.call(fe,Ee,ve);else if(a.isBuffer(Ee))Ee.copy(fe,ve);else throw new TypeError('"list" argument must be an Array of Buffers');ve+=Ee.length}return fe};function m(H,$){if(a.isBuffer(H))return H.length;if(ArrayBuffer.isView(H)||Te(H,ArrayBuffer))return H.byteLength;if(typeof H!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof H);const P=H.length,se=arguments.length>2&&arguments[2]===!0;if(!se&&P===0)return 0;let fe=!1;for(;;)switch($){case"ascii":case"latin1":case"binary":return P;case"utf8":case"utf-8":return ae(H).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P*2;case"hex":return P>>>1;case"base64":return $e(H).length;default:if(fe)return se?-1:ae(H).length;$=(""+$).toLowerCase(),fe=!0}}a.byteLength=m;function b(H,$,P){let se=!1;if(($===void 0||$<0)&&($=0),$>this.length||((P===void 0||P>this.length)&&(P=this.length),P<=0)||(P>>>=0,$>>>=0,P<=$))return"";for(H||(H="utf8");;)switch(H){case"hex":return I(this,$,P);case"utf8":case"utf-8":return ee(this,$,P);case"ascii":return K(this,$,P);case"latin1":case"binary":return Y(this,$,P);case"base64":return U(this,$,P);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,$,P);default:if(se)throw new TypeError("Unknown encoding: "+H);H=(H+"").toLowerCase(),se=!0}}a.prototype._isBuffer=!0;function _(H,$,P){const se=H[$];H[$]=H[P],H[P]=se}a.prototype.swap16=function(){const $=this.length;if($%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let P=0;P<$;P+=2)_(this,P,P+1);return this},a.prototype.swap32=function(){const $=this.length;if($%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let P=0;P<$;P+=4)_(this,P,P+3),_(this,P+1,P+2);return this},a.prototype.swap64=function(){const $=this.length;if($%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let P=0;P<$;P+=8)_(this,P,P+7),_(this,P+1,P+6),_(this,P+2,P+5),_(this,P+3,P+4);return this},a.prototype.toString=function(){const $=this.length;return $===0?"":arguments.length===0?ee(this,0,$):b.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function($){if(!a.isBuffer($))throw new TypeError("Argument must be a Buffer");return this===$?!0:a.compare(this,$)===0},a.prototype.inspect=function(){let $="";const P=r.INSPECT_MAX_BYTES;return $=this.toString("hex",0,P).replace(/(.{2})/g,"$1 ").trim(),this.length>P&&($+=" ... "),"<Buffer "+$+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function($,P,se,fe,ve){if(Te($,Uint8Array)&&($=a.from($,$.offset,$.byteLength)),!a.isBuffer($))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof $);if(P===void 0&&(P=0),se===void 0&&(se=$?$.length:0),fe===void 0&&(fe=0),ve===void 0&&(ve=this.length),P<0||se>$.length||fe<0||ve>this.length)throw new RangeError("out of range index");if(fe>=ve&&P>=se)return 0;if(fe>=ve)return-1;if(P>=se)return 1;if(P>>>=0,se>>>=0,fe>>>=0,ve>>>=0,this===$)return 0;let Ee=ve-fe,pt=se-P;const Ft=Math.min(Ee,pt),ir=this.slice(fe,ve),Mt=$.slice(P,se);for(let Jt=0;Jt<Ft;++Jt)if(ir[Jt]!==Mt[Jt]){Ee=ir[Jt],pt=Mt[Jt];break}return Ee<pt?-1:pt<Ee?1:0};function E(H,$,P,se,fe){if(H.length===0)return-1;if(typeof P=="string"?(se=P,P=0):P>2147483647?P=2147483647:P<-2147483648&&(P=-2147483648),P=+P,ze(P)&&(P=fe?0:H.length-1),P<0&&(P=H.length+P),P>=H.length){if(fe)return-1;P=H.length-1}else if(P<0)if(fe)P=0;else return-1;if(typeof $=="string"&&($=a.from($,se)),a.isBuffer($))return $.length===0?-1:S(H,$,P,se,fe);if(typeof $=="number")return $=$&255,typeof Uint8Array.prototype.indexOf=="function"?fe?Uint8Array.prototype.indexOf.call(H,$,P):Uint8Array.prototype.lastIndexOf.call(H,$,P):S(H,[$],P,se,fe);throw new TypeError("val must be string, number or Buffer")}function S(H,$,P,se,fe){let ve=1,Ee=H.length,pt=$.length;if(se!==void 0&&(se=String(se).toLowerCase(),se==="ucs2"||se==="ucs-2"||se==="utf16le"||se==="utf-16le")){if(H.length<2||$.length<2)return-1;ve=2,Ee/=2,pt/=2,P/=2}function Ft(Mt,Jt){return ve===1?Mt[Jt]:Mt.readUInt16BE(Jt*ve)}let ir;if(fe){let Mt=-1;for(ir=P;ir<Ee;ir++)if(Ft(H,ir)===Ft($,Mt===-1?0:ir-Mt)){if(Mt===-1&&(Mt=ir),ir-Mt+1===pt)return Mt*ve}else Mt!==-1&&(ir-=ir-Mt),Mt=-1}else for(P+pt>Ee&&(P=Ee-pt),ir=P;ir>=0;ir--){let Mt=!0;for(let Jt=0;Jt<pt;Jt++)if(Ft(H,ir+Jt)!==Ft($,Jt)){Mt=!1;break}if(Mt)return ir}return-1}a.prototype.includes=function($,P,se){return this.indexOf($,P,se)!==-1},a.prototype.indexOf=function($,P,se){return E(this,$,P,se,!0)},a.prototype.lastIndexOf=function($,P,se){return E(this,$,P,se,!1)};function T(H,$,P,se){P=Number(P)||0;const fe=H.length-P;se?(se=Number(se),se>fe&&(se=fe)):se=fe;const ve=$.length;se>ve/2&&(se=ve/2);let Ee;for(Ee=0;Ee<se;++Ee){const pt=parseInt($.substr(Ee*2,2),16);if(ze(pt))return Ee;H[P+Ee]=pt}return Ee}function O(H,$,P,se){return Ce(ae($,H.length-P),H,P,se)}function M(H,$,P,se){return Ce(ye($),H,P,se)}function Q(H,$,P,se){return Ce($e($),H,P,se)}function W(H,$,P,se){return Ce(_e($,H.length-P),H,P,se)}a.prototype.write=function($,P,se,fe){if(P===void 0)fe="utf8",se=this.length,P=0;else if(se===void 0&&typeof P=="string")fe=P,se=this.length,P=0;else if(isFinite(P))P=P>>>0,isFinite(se)?(se=se>>>0,fe===void 0&&(fe="utf8")):(fe=se,se=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ve=this.length-P;if((se===void 0||se>ve)&&(se=ve),$.length>0&&(se<0||P<0)||P>this.length)throw new RangeError("Attempt to write outside buffer bounds");fe||(fe="utf8");let Ee=!1;for(;;)switch(fe){case"hex":return T(this,$,P,se);case"utf8":case"utf-8":return O(this,$,P,se);case"ascii":case"latin1":case"binary":return M(this,$,P,se);case"base64":return Q(this,$,P,se);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,$,P,se);default:if(Ee)throw new TypeError("Unknown encoding: "+fe);fe=(""+fe).toLowerCase(),Ee=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function U(H,$,P){return $===0&&P===H.length?e.fromByteArray(H):e.fromByteArray(H.slice($,P))}function ee(H,$,P){P=Math.min(H.length,P);const se=[];let fe=$;for(;fe<P;){const ve=H[fe];let Ee=null,pt=ve>239?4:ve>223?3:ve>191?2:1;if(fe+pt<=P){let Ft,ir,Mt,Jt;switch(pt){case 1:ve<128&&(Ee=ve);break;case 2:Ft=H[fe+1],(Ft&192)===128&&(Jt=(ve&31)<<6|Ft&63,Jt>127&&(Ee=Jt));break;case 3:Ft=H[fe+1],ir=H[fe+2],(Ft&192)===128&&(ir&192)===128&&(Jt=(ve&15)<<12|(Ft&63)<<6|ir&63,Jt>2047&&(Jt<55296||Jt>57343)&&(Ee=Jt));break;case 4:Ft=H[fe+1],ir=H[fe+2],Mt=H[fe+3],(Ft&192)===128&&(ir&192)===128&&(Mt&192)===128&&(Jt=(ve&15)<<18|(Ft&63)<<12|(ir&63)<<6|Mt&63,Jt>65535&&Jt<1114112&&(Ee=Jt))}}Ee===null?(Ee=65533,pt=1):Ee>65535&&(Ee-=65536,se.push(Ee>>>10&1023|55296),Ee=56320|Ee&1023),se.push(Ee),fe+=pt}return z(se)}const R=4096;function z(H){const $=H.length;if($<=R)return String.fromCharCode.apply(String,H);let P="",se=0;for(;se<$;)P+=String.fromCharCode.apply(String,H.slice(se,se+=R));return P}function K(H,$,P){let se="";P=Math.min(H.length,P);for(let fe=$;fe<P;++fe)se+=String.fromCharCode(H[fe]&127);return se}function Y(H,$,P){let se="";P=Math.min(H.length,P);for(let fe=$;fe<P;++fe)se+=String.fromCharCode(H[fe]);return se}function I(H,$,P){const se=H.length;(!$||$<0)&&($=0),(!P||P<0||P>se)&&(P=se);let fe="";for(let ve=$;ve<P;++ve)fe+=ht[H[ve]];return fe}function D(H,$,P){const se=H.slice($,P);let fe="";for(let ve=0;ve<se.length-1;ve+=2)fe+=String.fromCharCode(se[ve]+se[ve+1]*256);return fe}a.prototype.slice=function($,P){const se=this.length;$=~~$,P=P===void 0?se:~~P,$<0?($+=se,$<0&&($=0)):$>se&&($=se),P<0?(P+=se,P<0&&(P=0)):P>se&&(P=se),P<$&&(P=$);const fe=this.subarray($,P);return Object.setPrototypeOf(fe,a.prototype),fe};function N(H,$,P){if(H%1!==0||H<0)throw new RangeError("offset is not uint");if(H+$>P)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function($,P,se){$=$>>>0,P=P>>>0,se||N($,P,this.length);let fe=this[$],ve=1,Ee=0;for(;++Ee<P&&(ve*=256);)fe+=this[$+Ee]*ve;return fe},a.prototype.readUintBE=a.prototype.readUIntBE=function($,P,se){$=$>>>0,P=P>>>0,se||N($,P,this.length);let fe=this[$+--P],ve=1;for(;P>0&&(ve*=256);)fe+=this[$+--P]*ve;return fe},a.prototype.readUint8=a.prototype.readUInt8=function($,P){return $=$>>>0,P||N($,1,this.length),this[$]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function($,P){return $=$>>>0,P||N($,2,this.length),this[$]|this[$+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function($,P){return $=$>>>0,P||N($,2,this.length),this[$]<<8|this[$+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function($,P){return $=$>>>0,P||N($,4,this.length),(this[$]|this[$+1]<<8|this[$+2]<<16)+this[$+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function($,P){return $=$>>>0,P||N($,4,this.length),this[$]*16777216+(this[$+1]<<16|this[$+2]<<8|this[$+3])},a.prototype.readBigUInt64LE=ie(function($){$=$>>>0,k($,"offset");const P=this[$],se=this[$+7];(P===void 0||se===void 0)&&B($,this.length-8);const fe=P+this[++$]*2**8+this[++$]*2**16+this[++$]*2**24,ve=this[++$]+this[++$]*2**8+this[++$]*2**16+se*2**24;return BigInt(fe)+(BigInt(ve)<<BigInt(32))}),a.prototype.readBigUInt64BE=ie(function($){$=$>>>0,k($,"offset");const P=this[$],se=this[$+7];(P===void 0||se===void 0)&&B($,this.length-8);const fe=P*2**24+this[++$]*2**16+this[++$]*2**8+this[++$],ve=this[++$]*2**24+this[++$]*2**16+this[++$]*2**8+se;return(BigInt(fe)<<BigInt(32))+BigInt(ve)}),a.prototype.readIntLE=function($,P,se){$=$>>>0,P=P>>>0,se||N($,P,this.length);let fe=this[$],ve=1,Ee=0;for(;++Ee<P&&(ve*=256);)fe+=this[$+Ee]*ve;return ve*=128,fe>=ve&&(fe-=Math.pow(2,8*P)),fe},a.prototype.readIntBE=function($,P,se){$=$>>>0,P=P>>>0,se||N($,P,this.length);let fe=P,ve=1,Ee=this[$+--fe];for(;fe>0&&(ve*=256);)Ee+=this[$+--fe]*ve;return ve*=128,Ee>=ve&&(Ee-=Math.pow(2,8*P)),Ee},a.prototype.readInt8=function($,P){return $=$>>>0,P||N($,1,this.length),this[$]&128?(255-this[$]+1)*-1:this[$]},a.prototype.readInt16LE=function($,P){$=$>>>0,P||N($,2,this.length);const se=this[$]|this[$+1]<<8;return se&32768?se|4294901760:se},a.prototype.readInt16BE=function($,P){$=$>>>0,P||N($,2,this.length);const se=this[$+1]|this[$]<<8;return se&32768?se|4294901760:se},a.prototype.readInt32LE=function($,P){return $=$>>>0,P||N($,4,this.length),this[$]|this[$+1]<<8|this[$+2]<<16|this[$+3]<<24},a.prototype.readInt32BE=function($,P){return $=$>>>0,P||N($,4,this.length),this[$]<<24|this[$+1]<<16|this[$+2]<<8|this[$+3]},a.prototype.readBigInt64LE=ie(function($){$=$>>>0,k($,"offset");const P=this[$],se=this[$+7];(P===void 0||se===void 0)&&B($,this.length-8);const fe=this[$+4]+this[$+5]*2**8+this[$+6]*2**16+(se<<24);return(BigInt(fe)<<BigInt(32))+BigInt(P+this[++$]*2**8+this[++$]*2**16+this[++$]*2**24)}),a.prototype.readBigInt64BE=ie(function($){$=$>>>0,k($,"offset");const P=this[$],se=this[$+7];(P===void 0||se===void 0)&&B($,this.length-8);const fe=(P<<24)+this[++$]*2**16+this[++$]*2**8+this[++$];return(BigInt(fe)<<BigInt(32))+BigInt(this[++$]*2**24+this[++$]*2**16+this[++$]*2**8+se)}),a.prototype.readFloatLE=function($,P){return $=$>>>0,P||N($,4,this.length),t.read(this,$,!0,23,4)},a.prototype.readFloatBE=function($,P){return $=$>>>0,P||N($,4,this.length),t.read(this,$,!1,23,4)},a.prototype.readDoubleLE=function($,P){return $=$>>>0,P||N($,8,this.length),t.read(this,$,!0,52,8)},a.prototype.readDoubleBE=function($,P){return $=$>>>0,P||N($,8,this.length),t.read(this,$,!1,52,8)};function V(H,$,P,se,fe,ve){if(!a.isBuffer(H))throw new TypeError('"buffer" argument must be a Buffer instance');if($>fe||$<ve)throw new RangeError('"value" argument is out of bounds');if(P+se>H.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function($,P,se,fe){if($=+$,P=P>>>0,se=se>>>0,!fe){const pt=Math.pow(2,8*se)-1;V(this,$,P,se,pt,0)}let ve=1,Ee=0;for(this[P]=$&255;++Ee<se&&(ve*=256);)this[P+Ee]=$/ve&255;return P+se},a.prototype.writeUintBE=a.prototype.writeUIntBE=function($,P,se,fe){if($=+$,P=P>>>0,se=se>>>0,!fe){const pt=Math.pow(2,8*se)-1;V(this,$,P,se,pt,0)}let ve=se-1,Ee=1;for(this[P+ve]=$&255;--ve>=0&&(Ee*=256);)this[P+ve]=$/Ee&255;return P+se},a.prototype.writeUint8=a.prototype.writeUInt8=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,1,255,0),this[P]=$&255,P+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,2,65535,0),this[P]=$&255,this[P+1]=$>>>8,P+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,2,65535,0),this[P]=$>>>8,this[P+1]=$&255,P+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,4,4294967295,0),this[P+3]=$>>>24,this[P+2]=$>>>16,this[P+1]=$>>>8,this[P]=$&255,P+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,4,4294967295,0),this[P]=$>>>24,this[P+1]=$>>>16,this[P+2]=$>>>8,this[P+3]=$&255,P+4};function J(H,$,P,se,fe){L($,se,fe,H,P,7);let ve=Number($&BigInt(4294967295));H[P++]=ve,ve=ve>>8,H[P++]=ve,ve=ve>>8,H[P++]=ve,ve=ve>>8,H[P++]=ve;let Ee=Number($>>BigInt(32)&BigInt(4294967295));return H[P++]=Ee,Ee=Ee>>8,H[P++]=Ee,Ee=Ee>>8,H[P++]=Ee,Ee=Ee>>8,H[P++]=Ee,P}function j(H,$,P,se,fe){L($,se,fe,H,P,7);let ve=Number($&BigInt(4294967295));H[P+7]=ve,ve=ve>>8,H[P+6]=ve,ve=ve>>8,H[P+5]=ve,ve=ve>>8,H[P+4]=ve;let Ee=Number($>>BigInt(32)&BigInt(4294967295));return H[P+3]=Ee,Ee=Ee>>8,H[P+2]=Ee,Ee=Ee>>8,H[P+1]=Ee,Ee=Ee>>8,H[P]=Ee,P+8}a.prototype.writeBigUInt64LE=ie(function($,P=0){return J(this,$,P,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=ie(function($,P=0){return j(this,$,P,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function($,P,se,fe){if($=+$,P=P>>>0,!fe){const Ft=Math.pow(2,8*se-1);V(this,$,P,se,Ft-1,-Ft)}let ve=0,Ee=1,pt=0;for(this[P]=$&255;++ve<se&&(Ee*=256);)$<0&&pt===0&&this[P+ve-1]!==0&&(pt=1),this[P+ve]=($/Ee>>0)-pt&255;return P+se},a.prototype.writeIntBE=function($,P,se,fe){if($=+$,P=P>>>0,!fe){const Ft=Math.pow(2,8*se-1);V(this,$,P,se,Ft-1,-Ft)}let ve=se-1,Ee=1,pt=0;for(this[P+ve]=$&255;--ve>=0&&(Ee*=256);)$<0&&pt===0&&this[P+ve+1]!==0&&(pt=1),this[P+ve]=($/Ee>>0)-pt&255;return P+se},a.prototype.writeInt8=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,1,127,-128),$<0&&($=255+$+1),this[P]=$&255,P+1},a.prototype.writeInt16LE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,2,32767,-32768),this[P]=$&255,this[P+1]=$>>>8,P+2},a.prototype.writeInt16BE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,2,32767,-32768),this[P]=$>>>8,this[P+1]=$&255,P+2},a.prototype.writeInt32LE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,4,2147483647,-2147483648),this[P]=$&255,this[P+1]=$>>>8,this[P+2]=$>>>16,this[P+3]=$>>>24,P+4},a.prototype.writeInt32BE=function($,P,se){return $=+$,P=P>>>0,se||V(this,$,P,4,2147483647,-2147483648),$<0&&($=4294967295+$+1),this[P]=$>>>24,this[P+1]=$>>>16,this[P+2]=$>>>8,this[P+3]=$&255,P+4},a.prototype.writeBigInt64LE=ie(function($,P=0){return J(this,$,P,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=ie(function($,P=0){return j(this,$,P,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function G(H,$,P,se,fe,ve){if(P+se>H.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("Index out of range")}function C(H,$,P,se,fe){return $=+$,P=P>>>0,fe||G(H,$,P,4),t.write(H,$,P,se,23,4),P+4}a.prototype.writeFloatLE=function($,P,se){return C(this,$,P,!0,se)},a.prototype.writeFloatBE=function($,P,se){return C(this,$,P,!1,se)};function F(H,$,P,se,fe){return $=+$,P=P>>>0,fe||G(H,$,P,8),t.write(H,$,P,se,52,8),P+8}a.prototype.writeDoubleLE=function($,P,se){return F(this,$,P,!0,se)},a.prototype.writeDoubleBE=function($,P,se){return F(this,$,P,!1,se)},a.prototype.copy=function($,P,se,fe){if(!a.isBuffer($))throw new TypeError("argument should be a Buffer");if(se||(se=0),!fe&&fe!==0&&(fe=this.length),P>=$.length&&(P=$.length),P||(P=0),fe>0&&fe<se&&(fe=se),fe===se||$.length===0||this.length===0)return 0;if(P<0)throw new RangeError("targetStart out of bounds");if(se<0||se>=this.length)throw new RangeError("Index out of range");if(fe<0)throw new RangeError("sourceEnd out of bounds");fe>this.length&&(fe=this.length),$.length-P<fe-se&&(fe=$.length-P+se);const ve=fe-se;return this===$&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(P,se,fe):Uint8Array.prototype.set.call($,this.subarray(se,fe),P),ve},a.prototype.fill=function($,P,se,fe){if(typeof $=="string"){if(typeof P=="string"?(fe=P,P=0,se=this.length):typeof se=="string"&&(fe=se,se=this.length),fe!==void 0&&typeof fe!="string")throw new TypeError("encoding must be a string");if(typeof fe=="string"&&!a.isEncoding(fe))throw new TypeError("Unknown encoding: "+fe);if($.length===1){const Ee=$.charCodeAt(0);(fe==="utf8"&&Ee<128||fe==="latin1")&&($=Ee)}}else typeof $=="number"?$=$&255:typeof $=="boolean"&&($=Number($));if(P<0||this.length<P||this.length<se)throw new RangeError("Out of range index");if(se<=P)return this;P=P>>>0,se=se===void 0?this.length:se>>>0,$||($=0);let ve;if(typeof $=="number")for(ve=P;ve<se;++ve)this[ve]=$;else{const Ee=a.isBuffer($)?$:a.from($,fe),pt=Ee.length;if(pt===0)throw new TypeError('The value "'+$+'" is invalid for argument "value"');for(ve=0;ve<se-P;++ve)this[ve+P]=Ee[ve%pt]}return this};const Z={};function te(H,$,P){Z[H]=class extends P{constructor(){super(),Object.defineProperty(this,"message",{value:$.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${H}]`,this.stack,delete this.name}get code(){return H}set code(fe){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:fe,writable:!0})}toString(){return`${this.name} [${H}]: ${this.message}`}}}te("ERR_BUFFER_OUT_OF_BOUNDS",function(H){return H?`${H} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),te("ERR_INVALID_ARG_TYPE",function(H,$){return`The "${H}" argument must be of type number. Received type ${typeof $}`},TypeError),te("ERR_OUT_OF_RANGE",function(H,$,P){let se=`The value of "${H}" is out of range.`,fe=P;return Number.isInteger(P)&&Math.abs(P)>2**32?fe=re(String(P)):typeof P=="bigint"&&(fe=String(P),(P>BigInt(2)**BigInt(32)||P<-(BigInt(2)**BigInt(32)))&&(fe=re(fe)),fe+="n"),se+=` It must be ${$}. Received ${fe}`,se},RangeError);function re(H){let $="",P=H.length;const se=H[0]==="-"?1:0;for(;P>=se+4;P-=3)$=`_${H.slice(P-3,P)}${$}`;return`${H.slice(0,P)}${$}`}function q(H,$,P){k($,"offset"),(H[$]===void 0||H[$+P]===void 0)&&B($,H.length-(P+1))}function L(H,$,P,se,fe,ve){if(H>P||H<$){const Ee=typeof $=="bigint"?"n":"";let pt;throw $===0||$===BigInt(0)?pt=`>= 0${Ee} and < 2${Ee} ** ${(ve+1)*8}${Ee}`:pt=`>= -(2${Ee} ** ${(ve+1)*8-1}${Ee}) and < 2 ** ${(ve+1)*8-1}${Ee}`,new Z.ERR_OUT_OF_RANGE("value",pt,H)}q(se,fe,ve)}function k(H,$){if(typeof H!="number")throw new Z.ERR_INVALID_ARG_TYPE($,"number",H)}function B(H,$,P){throw Math.floor(H)!==H?(k(H,P),new Z.ERR_OUT_OF_RANGE("offset","an integer",H)):$<0?new Z.ERR_BUFFER_OUT_OF_BOUNDS:new Z.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${$}`,H)}const X=/[^+/0-9A-Za-z-_]/g;function ne(H){if(H=H.split("=")[0],H=H.trim().replace(X,""),H.length<2)return"";for(;H.length%4!==0;)H=H+"=";return H}function ae(H,$){$=$||1/0;let P;const se=H.length;let fe=null;const ve=[];for(let Ee=0;Ee<se;++Ee){if(P=H.charCodeAt(Ee),P>55295&&P<57344){if(!fe){if(P>56319){($-=3)>-1&&ve.push(239,191,189);continue}else if(Ee+1===se){($-=3)>-1&&ve.push(239,191,189);continue}fe=P;continue}if(P<56320){($-=3)>-1&&ve.push(239,191,189),fe=P;continue}P=(fe-55296<<10|P-56320)+65536}else fe&&($-=3)>-1&&ve.push(239,191,189);if(fe=null,P<128){if(($-=1)<0)break;ve.push(P)}else if(P<2048){if(($-=2)<0)break;ve.push(P>>6|192,P&63|128)}else if(P<65536){if(($-=3)<0)break;ve.push(P>>12|224,P>>6&63|128,P&63|128)}else if(P<1114112){if(($-=4)<0)break;ve.push(P>>18|240,P>>12&63|128,P>>6&63|128,P&63|128)}else throw new Error("Invalid code point")}return ve}function ye(H){const $=[];for(let P=0;P<H.length;++P)$.push(H.charCodeAt(P)&255);return $}function _e(H,$){let P,se,fe;const ve=[];for(let Ee=0;Ee<H.length&&!(($-=2)<0);++Ee)P=H.charCodeAt(Ee),se=P>>8,fe=P%256,ve.push(fe),ve.push(se);return ve}function $e(H){return e.toByteArray(ne(H))}function Ce(H,$,P,se){let fe;for(fe=0;fe<se&&!(fe+P>=$.length||fe>=H.length);++fe)$[fe+P]=H[fe];return fe}function Te(H,$){return H instanceof $||H!=null&&H.constructor!=null&&H.constructor.name!=null&&H.constructor.name===$.name}function ze(H){return H!==H}const ht=function(){const H="0123456789abcdef",$=new Array(256);for(let P=0;P<16;++P){const se=P*16;for(let fe=0;fe<16;++fe)$[se+fe]=H[P]+H[fe]}return $}();function ie(H){return typeof BigInt>"u"?ce:H}function ce(){throw new Error("BigInt not supported")}})(Dn);var Mn={ArrayIsArray(r){return Array.isArray(r)},ArrayPrototypeIncludes(r,e){return r.includes(e)},ArrayPrototypeIndexOf(r,e){return r.indexOf(e)},ArrayPrototypeJoin(r,e){return r.join(e)},ArrayPrototypeMap(r,e){return r.map(e)},ArrayPrototypePop(r,e){return r.pop(e)},ArrayPrototypePush(r,e){return r.push(e)},ArrayPrototypeSlice(r,e,t){return r.slice(e,t)},Error,FunctionPrototypeCall(r,e,...t){return r.call(e,...t)},FunctionPrototypeSymbolHasInstance(r,e){return Function.prototype[Symbol.hasInstance].call(r,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(r,e){return Object.defineProperties(r,e)},ObjectDefineProperty(r,e,t){return Object.defineProperty(r,e,t)},ObjectGetOwnPropertyDescriptor(r,e){return Object.getOwnPropertyDescriptor(r,e)},ObjectKeys(r){return Object.keys(r)},ObjectSetPrototypeOf(r,e){return Object.setPrototypeOf(r,e)},Promise,PromisePrototypeCatch(r,e){return r.catch(e)},PromisePrototypeThen(r,e,t){return r.then(e,t)},PromiseReject(r){return Promise.reject(r)},PromiseResolve(r){return Promise.resolve(r)},ReflectApply:Reflect.apply,RegExpPrototypeTest(r,e){return r.test(e)},SafeSet:Set,String,StringPrototypeSlice(r,e,t){return r.slice(e,t)},StringPrototypeToLowerCase(r){return r.toLowerCase()},StringPrototypeToUpperCase(r){return r.toUpperCase()},StringPrototypeTrim(r){return r.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(r,e,t){return r.set(e,t)},Boolean,Uint8Array},NF={exports:{}},g0={exports:{}},ZM;function kh(){if(ZM)return g0.exports;ZM=1;const{AbortController:r,AbortSignal:e}=typeof self<"u"?self:typeof window<"u"?window:void 0;return g0.exports=r,g0.exports.AbortSignal=e,g0.exports.default=r,g0.exports}var uC={exports:{}},sg=typeof Reflect=="object"?Reflect:null,JM=sg&&typeof sg.apply=="function"?sg.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},rE;sg&&typeof sg.ownKeys=="function"?rE=sg.ownKeys:Object.getOwnPropertySymbols?rE=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:rE=function(e){return Object.getOwnPropertyNames(e)};function vle(r){console&&console.warn&&console.warn(r)}var UF=Number.isNaN||function(e){return e!==e};function Vr(){Vr.init.call(this)}uC.exports=Vr;uC.exports.once=Ele;Vr.EventEmitter=Vr;Vr.prototype._events=void 0;Vr.prototype._eventsCount=0;Vr.prototype._maxListeners=void 0;var XM=10;function Xx(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Vr,"defaultMaxListeners",{enumerable:!0,get:function(){return XM},set:function(r){if(typeof r!="number"||r<0||UF(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");XM=r}});Vr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Vr.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||UF(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function LF(r){return r._maxListeners===void 0?Vr.defaultMaxListeners:r._maxListeners}Vr.prototype.getMaxListeners=function(){return LF(this)};Vr.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(l===void 0)return!1;if(typeof l=="function")JM(l,this,t);else for(var d=l.length,c=VF(l,d),n=0;n<d;++n)JM(c[n],this,t);return!0};function KF(r,e,t,n){var i,o,s;if(Xx(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),s=o[e]),s===void 0)s=o[e]=t,++r._eventsCount;else if(typeof s=="function"?s=o[e]=n?[t,s]:[s,t]:n?s.unshift(t):s.push(t),i=LF(r),i>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=s.length,vle(a)}return r}Vr.prototype.addListener=function(e,t){return KF(this,e,t,!1)};Vr.prototype.on=Vr.prototype.addListener;Vr.prototype.prependListener=function(e,t){return KF(this,e,t,!0)};function ble(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zF(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=ble.bind(n);return i.listener=t,n.wrapFn=i,i}Vr.prototype.once=function(e,t){return Xx(t),this.on(e,zF(this,e,t)),this};Vr.prototype.prependOnceListener=function(e,t){return Xx(t),this.prependListener(e,zF(this,e,t)),this};Vr.prototype.removeListener=function(e,t){var n,i,o,s,a;if(Xx(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,o=s;break}if(o<0)return this;o===0?n.shift():wle(n,o),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Vr.prototype.off=Vr.prototype.removeListener;Vr.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function FF(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?_le(i):VF(i,i.length)}Vr.prototype.listeners=function(e){return FF(this,e,!0)};Vr.prototype.rawListeners=function(e){return FF(this,e,!1)};Vr.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):qF.call(r,e)};Vr.prototype.listenerCount=qF;function qF(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Vr.prototype.eventNames=function(){return this._eventsCount>0?rE(this._events):[]};function VF(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function wle(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function _le(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Ele(r,e){return new Promise(function(t,n){function i(s){r.removeListener(e,o),n(s)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}WF(r,e,o,{once:!0}),e!=="error"&&Ale(r,i,{once:!0})})}function Ale(r,e,t){typeof r.on=="function"&&WF(r,"error",e,t)}function WF(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(o){n.once&&r.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var dd=uC.exports;(function(r){const e=Dn,{kResistStopPropagation:t,SymbolDispose:n}=Mn,i=globalThis.AbortSignal||kh().AbortSignal,o=globalThis.AbortController||kh().AbortController,s=Object.getPrototypeOf(async function(){}).constructor,a=globalThis.Blob||e.Blob,l=typeof a<"u"?function(h){return h instanceof a}:function(h){return!1},d=(f,h)=>{if(f!==void 0&&(f===null||typeof f!="object"||!("aborted"in f)))throw new ERR_INVALID_ARG_TYPE(h,"AbortSignal",f)},c=(f,h)=>{if(typeof f!="function")throw new ERR_INVALID_ARG_TYPE(h,"Function",f)};class u extends Error{constructor(h){if(!Array.isArray(h))throw new TypeError(`Expected input to be an Array, got ${typeof h}`);let p="";for(let y=0;y<h.length;y++)p+=`    ${h[y].stack}
`;super(p),this.name="AggregateError",this.errors=h}}r.exports={AggregateError:u,kEmptyObject:Object.freeze({}),once(f){let h=!1;return function(...p){h||(h=!0,f.apply(this,p))}},createDeferredPromise:function(){let f,h;return{promise:new Promise((y,g)=>{f=y,h=g}),resolve:f,reject:h}},promisify(f){return new Promise((h,p)=>{f((y,...g)=>y?p(y):h(...g))})},debuglog(){return function(){}},format(f,...h){return f.replace(/%([sdifj])/g,function(...[p,y]){const g=h.shift();return y==="f"?g.toFixed(6):y==="j"?JSON.stringify(g):y==="s"&&typeof g=="object"?`${g.constructor!==Object?g.constructor.name:""} {}`.trim():g.toString()})},inspect(f){switch(typeof f){case"string":if(f.includes("'"))if(f.includes('"')){if(!f.includes("`")&&!f.includes("${"))return`\`${f}\``}else return`"${f}"`;return`'${f}'`;case"number":return isNaN(f)?"NaN":Object.is(f,-0)?String(f):f;case"bigint":return`${String(f)}n`;case"boolean":case"undefined":return String(f);case"object":return"{}"}},types:{isAsyncFunction(f){return f instanceof s},isArrayBufferView(f){return ArrayBuffer.isView(f)}},isBlob:l,deprecate(f,h){return f},addAbortListener:dd.addAbortListener||function(h,p){if(h===void 0)throw new ERR_INVALID_ARG_TYPE("signal","AbortSignal",h);d(h,"signal"),c(p,"listener");let y;return h.aborted?queueMicrotask(()=>p()):(h.addEventListener("abort",p,{__proto__:null,once:!0,[t]:!0}),y=()=>{h.removeEventListener("abort",p)}),{__proto__:null,[n](){var g;(g=y)===null||g===void 0||g()}}},AbortSignalAny:i.any||function(h){if(h.length===1)return h[0];const p=new o,y=()=>p.abort();return h.forEach(g=>{d(g,"signals"),g.addEventListener("abort",y,{once:!0})}),p.signal.addEventListener("abort",()=>{h.forEach(g=>g.removeEventListener("abort",y))},{once:!0}),p.signal}},r.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(NF);var ws=NF.exports,fC={};const{format:xle,inspect:mA,AggregateError:Sle}=ws,Tle=globalThis.AggregateError||Sle,$le=Symbol("kIsNodeError"),kle=["string","function","number","object","Function","Object","boolean","bigint","symbol"],Ple=/^([A-Z][a-z0-9]*)+$/,Ile="__node_internal_",Qx={};function ly(r,e){if(!r)throw new Qx.ERR_INTERNAL_ASSERTION(e)}function QM(r){let e="",t=r.length;const n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function Ole(r,e,t){if(typeof e=="function")return ly(e.length<=t.length,`Code: ${r}; The provided arguments length (${t.length}) does not match the required ones (${e.length}).`),e(...t);const n=(e.match(/%[dfijoOs]/g)||[]).length;return ly(n===t.length,`Code: ${r}; The provided arguments length (${t.length}) does not match the required ones (${n}).`),t.length===0?e:xle(e,...t)}function xo(r,e,t){t||(t=Error);class n extends t{constructor(...o){super(Ole(r,e,o))}toString(){return`${this.name} [${r}]: ${this.message}`}}Object.defineProperties(n.prototype,{name:{value:t.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${r}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),n.prototype.code=r,n.prototype[$le]=!0,Qx[r]=n}function e8(r){const e=Ile+r.name;return Object.defineProperty(r,"name",{value:e}),r}function Cle(r,e){if(r&&e&&r!==e){if(Array.isArray(e.errors))return e.errors.push(r),e;const t=new Tle([e,r],e.message);return t.code=e.code,t}return r||e}let Rle=class extends Error{constructor(e="The operation was aborted",t=void 0){if(t!==void 0&&typeof t!="object")throw new Qx.ERR_INVALID_ARG_TYPE("options","Object",t);super(e,t),this.code="ABORT_ERR",this.name="AbortError"}};xo("ERR_ASSERTION","%s",Error);xo("ERR_INVALID_ARG_TYPE",(r,e,t)=>{ly(typeof r=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let n="The ";r.endsWith(" argument")?n+=`${r} `:n+=`"${r}" ${r.includes(".")?"property":"argument"} `,n+="must be ";const i=[],o=[],s=[];for(const l of e)ly(typeof l=="string","All expected entries have to be of type string"),kle.includes(l)?i.push(l.toLowerCase()):Ple.test(l)?o.push(l):(ly(l!=="object",'The value "object" should be written as "Object"'),s.push(l));if(o.length>0){const l=i.indexOf("object");l!==-1&&(i.splice(i,l,1),o.push("Object"))}if(i.length>0){switch(i.length){case 1:n+=`of type ${i[0]}`;break;case 2:n+=`one of type ${i[0]} or ${i[1]}`;break;default:{const l=i.pop();n+=`one of type ${i.join(", ")}, or ${l}`}}(o.length>0||s.length>0)&&(n+=" or ")}if(o.length>0){switch(o.length){case 1:n+=`an instance of ${o[0]}`;break;case 2:n+=`an instance of ${o[0]} or ${o[1]}`;break;default:{const l=o.pop();n+=`an instance of ${o.join(", ")}, or ${l}`}}s.length>0&&(n+=" or ")}switch(s.length){case 0:break;case 1:s[0].toLowerCase()!==s[0]&&(n+="an "),n+=`${s[0]}`;break;case 2:n+=`one of ${s[0]} or ${s[1]}`;break;default:{const l=s.pop();n+=`one of ${s.join(", ")}, or ${l}`}}if(t==null)n+=`. Received ${t}`;else if(typeof t=="function"&&t.name)n+=`. Received function ${t.name}`;else if(typeof t=="object"){var a;if((a=t.constructor)!==null&&a!==void 0&&a.name)n+=`. Received an instance of ${t.constructor.name}`;else{const l=mA(t,{depth:-1});n+=`. Received ${l}`}}else{let l=mA(t,{colors:!1});l.length>25&&(l=`${l.slice(0,25)}...`),n+=`. Received type ${typeof t} (${l})`}return n},TypeError);xo("ERR_INVALID_ARG_VALUE",(r,e,t="is invalid")=>{let n=mA(e);return n.length>128&&(n=n.slice(0,128)+"..."),`The ${r.includes(".")?"property":"argument"} '${r}' ${t}. Received ${n}`},TypeError);xo("ERR_INVALID_RETURN_VALUE",(r,e,t)=>{var n;const i=t!=null&&(n=t.constructor)!==null&&n!==void 0&&n.name?`instance of ${t.constructor.name}`:`type ${typeof t}`;return`Expected ${r} to be returned from the "${e}" function but got ${i}.`},TypeError);xo("ERR_MISSING_ARGS",(...r)=>{ly(r.length>0,"At least one arg needs to be specified");let e;const t=r.length;switch(r=(Array.isArray(r)?r:[r]).map(n=>`"${n}"`).join(" or "),t){case 1:e+=`The ${r[0]} argument`;break;case 2:e+=`The ${r[0]} and ${r[1]} arguments`;break;default:{const n=r.pop();e+=`The ${r.join(", ")}, and ${n} arguments`}break}return`${e} must be specified`},TypeError);xo("ERR_OUT_OF_RANGE",(r,e,t)=>{ly(e,'Missing "range" argument');let n;return Number.isInteger(t)&&Math.abs(t)>2**32?n=QM(String(t)):typeof t=="bigint"?(n=String(t),(t>2n**32n||t<-(2n**32n))&&(n=QM(n)),n+="n"):n=mA(t),`The value of "${r}" is out of range. It must be ${e}. Received ${n}`},RangeError);xo("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);xo("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);xo("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);xo("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);xo("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);xo("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);xo("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);xo("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);xo("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);xo("ERR_STREAM_WRITE_AFTER_END","write after end",Error);xo("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var Ns={AbortError:Rle,aggregateTwoErrors:e8(Cle),hideStackFrames:e8,codes:Qx};const{ArrayIsArray:hC,ArrayPrototypeIncludes:HF,ArrayPrototypeJoin:GF,ArrayPrototypeMap:Dle,NumberIsInteger:pC,NumberIsNaN:Mle,NumberMAX_SAFE_INTEGER:Ble,NumberMIN_SAFE_INTEGER:jle,NumberParseInt:Nle,ObjectPrototypeHasOwnProperty:Ule,RegExpPrototypeExec:YF,String:Lle,StringPrototypeToUpperCase:Kle,StringPrototypeTrim:zle}=Mn,{hideStackFrames:pc,codes:{ERR_SOCKET_BAD_PORT:Fle,ERR_INVALID_ARG_TYPE:Xo,ERR_INVALID_ARG_VALUE:Ov,ERR_OUT_OF_RANGE:Cy,ERR_UNKNOWN_SIGNAL:t8}}=Ns,{normalizeEncoding:qle}=ws,{isAsyncFunction:Vle,isArrayBufferView:Wle}=ws.types,r8={};function Hle(r){return r===(r|0)}function Gle(r){return r===r>>>0}const Yle=/^[0-7]+$/,Zle="must be a 32-bit unsigned integer or an octal string";function Jle(r,e,t){if(typeof r>"u"&&(r=t),typeof r=="string"){if(YF(Yle,r)===null)throw new Ov(e,r,Zle);r=Nle(r,8)}return ZF(r,e),r}const Xle=pc((r,e,t=jle,n=Ble)=>{if(typeof r!="number")throw new Xo(e,"number",r);if(!pC(r))throw new Cy(e,"an integer",r);if(r<t||r>n)throw new Cy(e,`>= ${t} && <= ${n}`,r)}),Qle=pc((r,e,t=-2147483648,n=2147483647)=>{if(typeof r!="number")throw new Xo(e,"number",r);if(!pC(r))throw new Cy(e,"an integer",r);if(r<t||r>n)throw new Cy(e,`>= ${t} && <= ${n}`,r)}),ZF=pc((r,e,t=!1)=>{if(typeof r!="number")throw new Xo(e,"number",r);if(!pC(r))throw new Cy(e,"an integer",r);const n=t?1:0,i=4294967295;if(r<n||r>i)throw new Cy(e,`>= ${n} && <= ${i}`,r)});function yC(r,e){if(typeof r!="string")throw new Xo(e,"string",r)}function ede(r,e,t=void 0,n){if(typeof r!="number")throw new Xo(e,"number",r);if(t!=null&&r<t||n!=null&&r>n||(t!=null||n!=null)&&Mle(r))throw new Cy(e,`${t!=null?`>= ${t}`:""}${t!=null&&n!=null?" && ":""}${n!=null?`<= ${n}`:""}`,r)}const tde=pc((r,e,t)=>{if(!HF(t,r)){const i="must be one of: "+GF(Dle(t,o=>typeof o=="string"?`'${o}'`:Lle(o)),", ");throw new Ov(e,r,i)}});function JF(r,e){if(typeof r!="boolean")throw new Xo(e,"boolean",r)}function HT(r,e,t){return r==null||!Ule(r,e)?t:r[e]}const rde=pc((r,e,t=null)=>{const n=HT(t,"allowArray",!1),i=HT(t,"allowFunction",!1);if(!HT(t,"nullable",!1)&&r===null||!n&&hC(r)||typeof r!="object"&&(!i||typeof r!="function"))throw new Xo(e,"Object",r)}),nde=pc((r,e)=>{if(r!=null&&typeof r!="object"&&typeof r!="function")throw new Xo(e,"a dictionary",r)}),eS=pc((r,e,t=0)=>{if(!hC(r))throw new Xo(e,"Array",r);if(r.length<t){const n=`must be longer than ${t}`;throw new Ov(e,r,n)}});function ide(r,e){eS(r,e);for(let t=0;t<r.length;t++)yC(r[t],`${e}[${t}]`)}function ode(r,e){eS(r,e);for(let t=0;t<r.length;t++)JF(r[t],`${e}[${t}]`)}function sde(r,e){eS(r,e);for(let t=0;t<r.length;t++){const n=r[t],i=`${e}[${t}]`;if(n==null)throw new Xo(i,"AbortSignal",n);XF(n,i)}}function ade(r,e="signal"){if(yC(r,e),r8[r]===void 0)throw r8[Kle(r)]!==void 0?new t8(r+" (signals must use all capital letters)"):new t8(r)}const cde=pc((r,e="buffer")=>{if(!Wle(r))throw new Xo(e,["Buffer","TypedArray","DataView"],r)});function lde(r,e){const t=qle(e),n=r.length;if(t==="hex"&&n%2!==0)throw new Ov("encoding",e,`is invalid for data of length ${n}`)}function dde(r,e="Port",t=!0){if(typeof r!="number"&&typeof r!="string"||typeof r=="string"&&zle(r).length===0||+r!==+r>>>0||r>65535||r===0&&!t)throw new Fle(e,r,t);return r|0}const XF=pc((r,e)=>{if(r!==void 0&&(r===null||typeof r!="object"||!("aborted"in r)))throw new Xo(e,"AbortSignal",r)}),ude=pc((r,e)=>{if(typeof r!="function")throw new Xo(e,"Function",r)}),fde=pc((r,e)=>{if(typeof r!="function"||Vle(r))throw new Xo(e,"Function",r)}),hde=pc((r,e)=>{if(r!==void 0)throw new Xo(e,"undefined",r)});function pde(r,e,t){if(!HF(t,r))throw new Xo(e,`('${GF(t,"|")}')`,r)}const yde=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function n8(r,e){if(typeof r>"u"||!YF(yde,r))throw new Ov(e,r,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function mde(r){if(typeof r=="string")return n8(r,"hints"),r;if(hC(r)){const e=r.length;let t="";if(e===0)return t;for(let n=0;n<e;n++){const i=r[n];n8(i,"hints"),t+=i,n!==e-1&&(t+=", ")}return t}throw new Ov("hints",r,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var k_={isInt32:Hle,isUint32:Gle,parseFileMode:Jle,validateArray:eS,validateStringArray:ide,validateBooleanArray:ode,validateAbortSignalArray:sde,validateBoolean:JF,validateBuffer:cde,validateDictionary:nde,validateEncoding:lde,validateFunction:ude,validateInt32:Qle,validateInteger:Xle,validateNumber:ede,validateObject:rde,validateOneOf:tde,validatePlainFunction:fde,validatePort:dde,validateSignalName:ade,validateString:yC,validateUint32:ZF,validateUndefined:hde,validateUnion:pde,validateAbortSignal:XF,validateLinkHeaderValue:mde},mC={exports:{}},QF={exports:{}},Gn=QF.exports={},Tl,$l;function HP(){throw new Error("setTimeout has not been defined")}function GP(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Tl=setTimeout:Tl=HP}catch{Tl=HP}try{typeof clearTimeout=="function"?$l=clearTimeout:$l=GP}catch{$l=GP}})();function e9(r){if(Tl===setTimeout)return setTimeout(r,0);if((Tl===HP||!Tl)&&setTimeout)return Tl=setTimeout,setTimeout(r,0);try{return Tl(r,0)}catch{try{return Tl.call(null,r,0)}catch{return Tl.call(this,r,0)}}}function gde(r){if($l===clearTimeout)return clearTimeout(r);if(($l===GP||!$l)&&clearTimeout)return $l=clearTimeout,clearTimeout(r);try{return $l(r)}catch{try{return $l.call(null,r)}catch{return $l.call(this,r)}}}var hu=[],ag=!1,Wp,nE=-1;function vde(){!ag||!Wp||(ag=!1,Wp.length?hu=Wp.concat(hu):nE=-1,hu.length&&t9())}function t9(){if(!ag){var r=e9(vde);ag=!0;for(var e=hu.length;e;){for(Wp=hu,hu=[];++nE<e;)Wp&&Wp[nE].run();nE=-1,e=hu.length}Wp=null,ag=!1,gde(r)}}Gn.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];hu.push(new r9(r,e)),hu.length===1&&!ag&&e9(t9)};function r9(r,e){this.fun=r,this.array=e}r9.prototype.run=function(){this.fun.apply(null,this.array)};Gn.title="browser";Gn.browser=!0;Gn.env={};Gn.argv=[];Gn.version="";Gn.versions={};function Wu(){}Gn.on=Wu;Gn.addListener=Wu;Gn.once=Wu;Gn.off=Wu;Gn.removeListener=Wu;Gn.removeAllListeners=Wu;Gn.emit=Wu;Gn.prependListener=Wu;Gn.prependOnceListener=Wu;Gn.listeners=function(r){return[]};Gn.binding=function(r){throw new Error("process.binding is not supported")};Gn.cwd=function(){return"/"};Gn.chdir=function(r){throw new Error("process.chdir is not supported")};Gn.umask=function(){return 0};var Us=QF.exports;const{SymbolAsyncIterator:i8,SymbolIterator:o8,SymbolFor:Qy}=Mn,n9=Qy("nodejs.stream.destroyed"),i9=Qy("nodejs.stream.errored"),YP=Qy("nodejs.stream.readable"),ZP=Qy("nodejs.stream.writable"),o9=Qy("nodejs.stream.disturbed"),bde=Qy("nodejs.webstream.isClosedPromise"),wde=Qy("nodejs.webstream.controllerErrorFunction");function tS(r,e=!1){var t;return!!(r&&typeof r.pipe=="function"&&typeof r.on=="function"&&(!e||typeof r.pause=="function"&&typeof r.resume=="function")&&(!r._writableState||((t=r._readableState)===null||t===void 0?void 0:t.readable)!==!1)&&(!r._writableState||r._readableState))}function rS(r){var e;return!!(r&&typeof r.write=="function"&&typeof r.on=="function"&&(!r._readableState||((e=r._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function _de(r){return!!(r&&typeof r.pipe=="function"&&r._readableState&&typeof r.on=="function"&&typeof r.write=="function")}function ud(r){return r&&(r._readableState||r._writableState||typeof r.write=="function"&&typeof r.on=="function"||typeof r.pipe=="function"&&typeof r.on=="function")}function s9(r){return!!(r&&!ud(r)&&typeof r.pipeThrough=="function"&&typeof r.getReader=="function"&&typeof r.cancel=="function")}function a9(r){return!!(r&&!ud(r)&&typeof r.getWriter=="function"&&typeof r.abort=="function")}function c9(r){return!!(r&&!ud(r)&&typeof r.readable=="object"&&typeof r.writable=="object")}function Ede(r){return s9(r)||a9(r)||c9(r)}function Ade(r,e){return r==null?!1:e===!0?typeof r[i8]=="function":e===!1?typeof r[o8]=="function":typeof r[i8]=="function"||typeof r[o8]=="function"}function nS(r){if(!ud(r))return null;const e=r._writableState,t=r._readableState,n=e||t;return!!(r.destroyed||r[n9]||n!=null&&n.destroyed)}function l9(r){if(!rS(r))return null;if(r.writableEnded===!0)return!0;const e=r._writableState;return e!=null&&e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function xde(r,e){if(!rS(r))return null;if(r.writableFinished===!0)return!0;const t=r._writableState;return t!=null&&t.errored?!1:typeof t?.finished!="boolean"?null:!!(t.finished||e===!1&&t.ended===!0&&t.length===0)}function Sde(r){if(!tS(r))return null;if(r.readableEnded===!0)return!0;const e=r._readableState;return!e||e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function d9(r,e){if(!tS(r))return null;const t=r._readableState;return t!=null&&t.errored?!1:typeof t?.endEmitted!="boolean"?null:!!(t.endEmitted||e===!1&&t.ended===!0&&t.length===0)}function u9(r){return r&&r[YP]!=null?r[YP]:typeof r?.readable!="boolean"?null:nS(r)?!1:tS(r)&&r.readable&&!d9(r)}function f9(r){return r&&r[ZP]!=null?r[ZP]:typeof r?.writable!="boolean"?null:nS(r)?!1:rS(r)&&r.writable&&!l9(r)}function Tde(r,e){return ud(r)?nS(r)?!0:!(e?.readable!==!1&&u9(r)||e?.writable!==!1&&f9(r)):null}function $de(r){var e,t;return ud(r)?r.writableErrored?r.writableErrored:(e=(t=r._writableState)===null||t===void 0?void 0:t.errored)!==null&&e!==void 0?e:null:null}function kde(r){var e,t;return ud(r)?r.readableErrored?r.readableErrored:(e=(t=r._readableState)===null||t===void 0?void 0:t.errored)!==null&&e!==void 0?e:null:null}function Pde(r){if(!ud(r))return null;if(typeof r.closed=="boolean")return r.closed;const e=r._writableState,t=r._readableState;return typeof e?.closed=="boolean"||typeof t?.closed=="boolean"?e?.closed||t?.closed:typeof r._closed=="boolean"&&h9(r)?r._closed:null}function h9(r){return typeof r._closed=="boolean"&&typeof r._defaultKeepAlive=="boolean"&&typeof r._removedConnection=="boolean"&&typeof r._removedContLen=="boolean"}function p9(r){return typeof r._sent100=="boolean"&&h9(r)}function Ide(r){var e;return typeof r._consuming=="boolean"&&typeof r._dumped=="boolean"&&((e=r.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function Ode(r){if(!ud(r))return null;const e=r._writableState,t=r._readableState,n=e||t;return!n&&p9(r)||!!(n&&n.autoDestroy&&n.emitClose&&n.closed===!1)}function Cde(r){var e;return!!(r&&((e=r[o9])!==null&&e!==void 0?e:r.readableDidRead||r.readableAborted))}function Rde(r){var e,t,n,i,o,s,a,l,d,c;return!!(r&&((e=(t=(n=(i=(o=(s=r[i9])!==null&&s!==void 0?s:r.readableErrored)!==null&&o!==void 0?o:r.writableErrored)!==null&&i!==void 0?i:(a=r._readableState)===null||a===void 0?void 0:a.errorEmitted)!==null&&n!==void 0?n:(l=r._writableState)===null||l===void 0?void 0:l.errorEmitted)!==null&&t!==void 0?t:(d=r._readableState)===null||d===void 0?void 0:d.errored)!==null&&e!==void 0?e:!((c=r._writableState)===null||c===void 0)&&c.errored))}var Hu={isDestroyed:nS,kIsDestroyed:n9,isDisturbed:Cde,kIsDisturbed:o9,isErrored:Rde,kIsErrored:i9,isReadable:u9,kIsReadable:YP,kIsClosedPromise:bde,kControllerErrorFunction:wde,kIsWritable:ZP,isClosed:Pde,isDuplexNodeStream:_de,isFinished:Tde,isIterable:Ade,isReadableNodeStream:tS,isReadableStream:s9,isReadableEnded:Sde,isReadableFinished:d9,isReadableErrored:kde,isNodeStream:ud,isWebStream:Ede,isWritable:f9,isWritableNodeStream:rS,isWritableStream:a9,isWritableEnded:l9,isWritableFinished:xde,isWritableErrored:$de,isServerRequest:Ide,isServerResponse:p9,willEmitClose:Ode,isTransformStream:c9};const Ff=Us,{AbortError:y9,codes:Dde}=Ns,{ERR_INVALID_ARG_TYPE:Mde,ERR_STREAM_PREMATURE_CLOSE:s8}=Dde,{kEmptyObject:JP,once:XP}=ws,{validateAbortSignal:Bde,validateFunction:jde,validateObject:Nde,validateBoolean:Ude}=k_,{Promise:Lde,PromisePrototypeThen:Kde,SymbolDispose:m9}=Mn,{isClosed:zde,isReadable:a8,isReadableNodeStream:GT,isReadableStream:Fde,isReadableFinished:c8,isReadableErrored:l8,isWritable:d8,isWritableNodeStream:u8,isWritableStream:qde,isWritableFinished:f8,isWritableErrored:h8,isNodeStream:Vde,willEmitClose:Wde,kIsClosedPromise:Hde}=Hu;let cg;function Gde(r){return r.setHeader&&typeof r.abort=="function"}const QP=()=>{};function g9(r,e,t){var n,i;if(arguments.length===2?(t=e,e=JP):e==null?e=JP:Nde(e,"options"),jde(t,"callback"),Bde(e.signal,"options.signal"),t=XP(t),Fde(r)||qde(r))return Yde(r,e,t);if(!Vde(r))throw new Mde("stream",["ReadableStream","WritableStream","Stream"],r);const o=(n=e.readable)!==null&&n!==void 0?n:GT(r),s=(i=e.writable)!==null&&i!==void 0?i:u8(r),a=r._writableState,l=r._readableState,d=()=>{r.writable||f()};let c=Wde(r)&&GT(r)===o&&u8(r)===s,u=f8(r,!1);const f=()=>{u=!0,r.destroyed&&(c=!1),!(c&&(!r.readable||o))&&(!o||h)&&t.call(r)};let h=c8(r,!1);const p=()=>{h=!0,r.destroyed&&(c=!1),!(c&&(!r.writable||s))&&(!s||u)&&t.call(r)},y=_=>{t.call(r,_)};let g=zde(r);const w=()=>{g=!0;const _=h8(r)||l8(r);if(_&&typeof _!="boolean")return t.call(r,_);if(o&&!h&&GT(r,!0)&&!c8(r,!1))return t.call(r,new s8);if(s&&!u&&!f8(r,!1))return t.call(r,new s8);t.call(r)},v=()=>{g=!0;const _=h8(r)||l8(r);if(_&&typeof _!="boolean")return t.call(r,_);t.call(r)},m=()=>{r.req.on("finish",f)};Gde(r)?(r.on("complete",f),c||r.on("abort",w),r.req?m():r.on("request",m)):s&&!a&&(r.on("end",d),r.on("close",d)),!c&&typeof r.aborted=="boolean"&&r.on("aborted",w),r.on("end",p),r.on("finish",f),e.error!==!1&&r.on("error",y),r.on("close",w),g?Ff.nextTick(w):a!=null&&a.errorEmitted||l!=null&&l.errorEmitted?c||Ff.nextTick(v):(!o&&(!c||a8(r))&&(u||d8(r)===!1)||!s&&(!c||d8(r))&&(h||a8(r)===!1)||l&&r.req&&r.aborted)&&Ff.nextTick(v);const b=()=>{t=QP,r.removeListener("aborted",w),r.removeListener("complete",f),r.removeListener("abort",w),r.removeListener("request",m),r.req&&r.req.removeListener("finish",f),r.removeListener("end",d),r.removeListener("close",d),r.removeListener("finish",f),r.removeListener("end",p),r.removeListener("error",y),r.removeListener("close",w)};if(e.signal&&!g){const _=()=>{const E=t;b(),E.call(r,new y9(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)Ff.nextTick(_);else{cg=cg||ws.addAbortListener;const E=cg(e.signal,_),S=t;t=XP((...T)=>{E[m9](),S.apply(r,T)})}}return b}function Yde(r,e,t){let n=!1,i=QP;if(e.signal)if(i=()=>{n=!0,t.call(r,new y9(void 0,{cause:e.signal.reason}))},e.signal.aborted)Ff.nextTick(i);else{cg=cg||ws.addAbortListener;const s=cg(e.signal,i),a=t;t=XP((...l)=>{s[m9](),a.apply(r,l)})}const o=(...s)=>{n||Ff.nextTick(()=>t.apply(r,s))};return Kde(r[Hde].promise,o,o),QP}function Zde(r,e){var t;let n=!1;return e===null&&(e=JP),(t=e)!==null&&t!==void 0&&t.cleanup&&(Ude(e.cleanup,"cleanup"),n=e.cleanup),new Lde((i,o)=>{const s=g9(r,e,a=>{n&&s(),a?o(a):i()})})}mC.exports=g9;mC.exports.finished=Zde;var Lh=mC.exports;const Kl=Us,{aggregateTwoErrors:Jde,codes:{ERR_MULTIPLE_CALLBACK:Xde},AbortError:Qde}=Ns,{Symbol:v9}=Mn,{kIsDestroyed:eue,isDestroyed:tue,isFinished:rue,isServerRequest:nue}=Hu,b9=v9("kDestroy"),eI=v9("kConstruct");function w9(r,e,t){r&&(r.stack,e&&!e.errored&&(e.errored=r),t&&!t.errored&&(t.errored=r))}function iue(r,e){const t=this._readableState,n=this._writableState,i=n||t;return n!=null&&n.destroyed||t!=null&&t.destroyed?(typeof e=="function"&&e(),this):(w9(r,n,t),n&&(n.destroyed=!0),t&&(t.destroyed=!0),i.constructed?p8(this,r,e):this.once(b9,function(o){p8(this,Jde(o,r),e)}),this)}function p8(r,e,t){let n=!1;function i(o){if(n)return;n=!0;const s=r._readableState,a=r._writableState;w9(o,a,s),a&&(a.closed=!0),s&&(s.closed=!0),typeof t=="function"&&t(o),o?Kl.nextTick(oue,r,o):Kl.nextTick(_9,r)}try{r._destroy(e||null,i)}catch(o){i(o)}}function oue(r,e){tI(r,e),_9(r)}function _9(r){const e=r._readableState,t=r._writableState;t&&(t.closeEmitted=!0),e&&(e.closeEmitted=!0),(t!=null&&t.emitClose||e!=null&&e.emitClose)&&r.emit("close")}function tI(r,e){const t=r._readableState,n=r._writableState;n!=null&&n.errorEmitted||t!=null&&t.errorEmitted||(n&&(n.errorEmitted=!0),t&&(t.errorEmitted=!0),r.emit("error",e))}function sue(){const r=this._readableState,e=this._writableState;r&&(r.constructed=!0,r.closed=!1,r.closeEmitted=!1,r.destroyed=!1,r.errored=null,r.errorEmitted=!1,r.reading=!1,r.ended=r.readable===!1,r.endEmitted=r.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function rI(r,e,t){const n=r._readableState,i=r._writableState;if(i!=null&&i.destroyed||n!=null&&n.destroyed)return this;n!=null&&n.autoDestroy||i!=null&&i.autoDestroy?r.destroy(e):e&&(e.stack,i&&!i.errored&&(i.errored=e),n&&!n.errored&&(n.errored=e),t?Kl.nextTick(tI,r,e):tI(r,e))}function aue(r,e){if(typeof r._construct!="function")return;const t=r._readableState,n=r._writableState;t&&(t.constructed=!1),n&&(n.constructed=!1),r.once(eI,e),!(r.listenerCount(eI)>1)&&Kl.nextTick(cue,r)}function cue(r){let e=!1;function t(n){if(e){rI(r,n??new Xde);return}e=!0;const i=r._readableState,o=r._writableState,s=o||i;i&&(i.constructed=!0),o&&(o.constructed=!0),s.destroyed?r.emit(b9,n):n?rI(r,n,!0):Kl.nextTick(lue,r)}try{r._construct(n=>{Kl.nextTick(t,n)})}catch(n){Kl.nextTick(t,n)}}function lue(r){r.emit(eI)}function y8(r){return r?.setHeader&&typeof r.abort=="function"}function E9(r){r.emit("close")}function due(r,e){r.emit("error",e),Kl.nextTick(E9,r)}function uue(r,e){!r||tue(r)||(!e&&!rue(r)&&(e=new Qde),nue(r)?(r.socket=null,r.destroy(e)):y8(r)?r.abort():y8(r.req)?r.req.abort():typeof r.destroy=="function"?r.destroy(e):typeof r.close=="function"?r.close():e?Kl.nextTick(due,r,e):Kl.nextTick(E9,r),r.destroyed||(r[eue]=!0))}var Cv={construct:aue,destroyer:uue,destroy:iue,undestroy:sue,errorOrDestroy:rI};const{ArrayIsArray:fue,ObjectSetPrototypeOf:A9}=Mn,{EventEmitter:iS}=dd;function oS(r){iS.call(this,r)}A9(oS.prototype,iS.prototype);A9(oS,iS);oS.prototype.pipe=function(r,e){const t=this;function n(c){r.writable&&r.write(c)===!1&&t.pause&&t.pause()}t.on("data",n);function i(){t.readable&&t.resume&&t.resume()}r.on("drain",i),!r._isStdio&&(!e||e.end!==!1)&&(t.on("end",s),t.on("close",a));let o=!1;function s(){o||(o=!0,r.end())}function a(){o||(o=!0,typeof r.destroy=="function"&&r.destroy())}function l(c){d(),iS.listenerCount(this,"error")===0&&this.emit("error",c)}nI(t,"error",l),nI(r,"error",l);function d(){t.removeListener("data",n),r.removeListener("drain",i),t.removeListener("end",s),t.removeListener("close",a),t.removeListener("error",l),r.removeListener("error",l),t.removeListener("end",d),t.removeListener("close",d),r.removeListener("close",d)}return t.on("end",d),t.on("close",d),r.on("close",d),r.emit("pipe",t),r};function nI(r,e,t){if(typeof r.prependListener=="function")return r.prependListener(e,t);!r._events||!r._events[e]?r.on(e,t):fue(r._events[e])?r._events[e].unshift(t):r._events[e]=[t,r._events[e]]}var gC={Stream:oS,prependListener:nI},x9={exports:{}};(function(r){const{SymbolDispose:e}=Mn,{AbortError:t,codes:n}=Ns,{isNodeStream:i,isWebStream:o,kControllerErrorFunction:s}=Hu,a=Lh,{ERR_INVALID_ARG_TYPE:l}=n;let d;const c=(u,f)=>{if(typeof u!="object"||!("aborted"in u))throw new l(f,"AbortSignal",u)};r.exports.addAbortSignal=function(f,h){if(c(f,"signal"),!i(h)&&!o(h))throw new l("stream",["ReadableStream","WritableStream","Stream"],h);return r.exports.addAbortSignalNoValidate(f,h)},r.exports.addAbortSignalNoValidate=function(u,f){if(typeof u!="object"||!("aborted"in u))return f;const h=i(f)?()=>{f.destroy(new t(void 0,{cause:u.reason}))}:()=>{f[s](new t(void 0,{cause:u.reason}))};if(u.aborted)h();else{d=d||ws.addAbortListener;const p=d(u,h);a(f,p[e])}return f}})(x9);var sS=x9.exports;const{StringPrototypeSlice:m8,SymbolIterator:hue,TypedArrayPrototypeSet:R1,Uint8Array:pue}=Mn,{Buffer:YT}=Dn,{inspect:yue}=ws;var mue=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}unshift(e){const t={data:e,next:this.head};this.length===0&&(this.tail=t),this.head=t,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let t=this.head,n=""+t.data;for(;(t=t.next)!==null;)n+=e+t.data;return n}concat(e){if(this.length===0)return YT.alloc(0);const t=YT.allocUnsafe(e>>>0);let n=this.head,i=0;for(;n;)R1(t,n.data,i),i+=n.data.length,n=n.next;return t}consume(e,t){const n=this.head.data;if(e<n.length){const i=n.slice(0,e);return this.head.data=n.slice(e),i}return e===n.length?this.shift():t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[hue](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let t="",n=this.head,i=0;do{const o=n.data;if(e>o.length)t+=o,e-=o.length;else{e===o.length?(t+=o,++i,n.next?this.head=n.next:this.head=this.tail=null):(t+=m8(o,0,e),this.head=n,n.data=m8(o,e));break}++i}while((n=n.next)!==null);return this.length-=i,t}_getBuffer(e){const t=YT.allocUnsafe(e),n=e;let i=this.head,o=0;do{const s=i.data;if(e>s.length)R1(t,s,n-e),e-=s.length;else{e===s.length?(R1(t,s,n-e),++o,i.next?this.head=i.next:this.head=this.tail=null):(R1(t,new pue(s.buffer,s.byteOffset,e),n-e),this.head=i,i.data=s.slice(e));break}++o}while((i=i.next)!==null);return this.length-=o,t}[Symbol.for("nodejs.util.inspect.custom")](e,t){return yue(this,{...t,depth:0,customInspect:!1})}};const{MathFloor:gue,NumberIsInteger:vue}=Mn,{validateInteger:bue}=k_,{ERR_INVALID_ARG_VALUE:wue}=Ns.codes;let S9=16*1024,T9=16;function _ue(r,e,t){return r.highWaterMark!=null?r.highWaterMark:e?r[t]:null}function $9(r){return r?T9:S9}function Eue(r,e){bue(e,"value",0),r?T9=e:S9=e}function Aue(r,e,t,n){const i=_ue(e,n,t);if(i!=null){if(!vue(i)||i<0){const o=n?`options.${t}`:"options.highWaterMark";throw new wue(o,i)}return gue(i)}return $9(r.objectMode)}var aS={getHighWaterMark:Aue,getDefaultHighWaterMark:$9,setDefaultHighWaterMark:Eue},Tw={},iI={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(r,e){var t=Dn,n=t.Buffer;function i(s,a){for(var l in s)a[l]=s[l]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=t:(i(t,e),e.Buffer=o);function o(s,a,l){return n(s,a,l)}o.prototype=Object.create(n.prototype),i(n,o),o.from=function(s,a,l){if(typeof s=="number")throw new TypeError("Argument must not be a number");return n(s,a,l)},o.alloc=function(s,a,l){if(typeof s!="number")throw new TypeError("Argument must be a number");var d=n(s);return a!==void 0?typeof l=="string"?d.fill(a,l):d.fill(a):d.fill(0),d},o.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return n(s)},o.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(s)}})(iI,iI.exports);var xue=iI.exports,vC=xue.Buffer,g8=vC.isEncoding||function(r){switch(r=""+r,r&&r.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Sue(r){if(!r)return"utf8";for(var e;;)switch(r){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return r;default:if(e)return;r=(""+r).toLowerCase(),e=!0}}function Tue(r){var e=Sue(r);if(typeof e!="string"&&(vC.isEncoding===g8||!g8(r)))throw new Error("Unknown encoding: "+r);return e||r}Tw.StringDecoder=P_;function P_(r){this.encoding=Tue(r);var e;switch(this.encoding){case"utf16le":this.text=Cue,this.end=Rue,e=4;break;case"utf8":this.fillLast=Pue,e=4;break;case"base64":this.text=Due,this.end=Mue,e=3;break;default:this.write=Bue,this.end=jue;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=vC.allocUnsafe(e)}P_.prototype.write=function(r){if(r.length===0)return"";var e,t;if(this.lastNeed){if(e=this.fillLast(r),e===void 0)return"";t=this.lastNeed,this.lastNeed=0}else t=0;return t<r.length?e?e+this.text(r,t):this.text(r,t):e||""};P_.prototype.end=Oue;P_.prototype.text=Iue;P_.prototype.fillLast=function(r){if(this.lastNeed<=r.length)return r.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);r.copy(this.lastChar,this.lastTotal-this.lastNeed,0,r.length),this.lastNeed-=r.length};function ZT(r){return r<=127?0:r>>5===6?2:r>>4===14?3:r>>3===30?4:r>>6===2?-1:-2}function $ue(r,e,t){var n=e.length-1;if(n<t)return 0;var i=ZT(e[n]);return i>=0?(i>0&&(r.lastNeed=i-1),i):--n<t||i===-2?0:(i=ZT(e[n]),i>=0?(i>0&&(r.lastNeed=i-2),i):--n<t||i===-2?0:(i=ZT(e[n]),i>=0?(i>0&&(i===2?i=0:r.lastNeed=i-3),i):0))}function kue(r,e,t){if((e[0]&192)!==128)return r.lastNeed=0,"";if(r.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return r.lastNeed=1,"";if(r.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return r.lastNeed=2,""}}function Pue(r){var e=this.lastTotal-this.lastNeed,t=kue(this,r);if(t!==void 0)return t;if(this.lastNeed<=r.length)return r.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);r.copy(this.lastChar,e,0,r.length),this.lastNeed-=r.length}function Iue(r,e){var t=$ue(this,r,e);if(!this.lastNeed)return r.toString("utf8",e);this.lastTotal=t;var n=r.length-(t-this.lastNeed);return r.copy(this.lastChar,0,n),r.toString("utf8",e,n)}function Oue(r){var e=r&&r.length?this.write(r):"";return this.lastNeed?e+"":e}function Cue(r,e){if((r.length-e)%2===0){var t=r.toString("utf16le",e);if(t){var n=t.charCodeAt(t.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=r[r.length-2],this.lastChar[1]=r[r.length-1],t.slice(0,-1)}return t}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=r[r.length-1],r.toString("utf16le",e,r.length-1)}function Rue(r){var e=r&&r.length?this.write(r):"";if(this.lastNeed){var t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function Due(r,e){var t=(r.length-e)%3;return t===0?r.toString("base64",e):(this.lastNeed=3-t,this.lastTotal=3,t===1?this.lastChar[0]=r[r.length-1]:(this.lastChar[0]=r[r.length-2],this.lastChar[1]=r[r.length-1]),r.toString("base64",e,r.length-t))}function Mue(r){var e=r&&r.length?this.write(r):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function Bue(r){return r.toString(this.encoding)}function jue(r){return r&&r.length?this.write(r):""}const v8=Us,{PromisePrototypeThen:Nue,SymbolAsyncIterator:b8,SymbolIterator:w8}=Mn,{Buffer:Uue}=Dn,{ERR_INVALID_ARG_TYPE:Lue,ERR_STREAM_NULL_VALUES:Kue}=Ns.codes;function zue(r,e,t){let n;if(typeof e=="string"||e instanceof Uue)return new r({objectMode:!0,...t,read(){this.push(e),this.push(null)}});let i;if(e&&e[b8])i=!0,n=e[b8]();else if(e&&e[w8])i=!1,n=e[w8]();else throw new Lue("iterable",["Iterable"],e);const o=new r({objectMode:!0,highWaterMark:1,...t});let s=!1;o._read=function(){s||(s=!0,l())},o._destroy=function(d,c){Nue(a(d),()=>v8.nextTick(c,d),u=>v8.nextTick(c,u||d))};async function a(d){const c=d!=null,u=typeof n.throw=="function";if(c&&u){const{value:f,done:h}=await n.throw(d);if(await f,h)return}if(typeof n.return=="function"){const{value:f}=await n.return();await f}}async function l(){for(;;){try{const{value:d,done:c}=i?await n.next():n.next();if(c)o.push(null);else{const u=d&&typeof d.then=="function"?await d:d;if(u===null)throw s=!1,new Kue;if(o.push(u))continue;s=!1}}catch(d){o.destroy(d)}break}}return o}var k9=zue,JT,_8;function cS(){if(_8)return JT;_8=1;const r=Us,{ArrayPrototypeIndexOf:e,NumberIsInteger:t,NumberIsNaN:n,NumberParseInt:i,ObjectDefineProperties:o,ObjectKeys:s,ObjectSetPrototypeOf:a,Promise:l,SafeSet:d,SymbolAsyncDispose:c,SymbolAsyncIterator:u,Symbol:f}=Mn;JT=Te,Te.ReadableState=Ce;const{EventEmitter:h}=dd,{Stream:p,prependListener:y}=gC,{Buffer:g}=Dn,{addAbortSignal:w}=sS,v=Lh;let m=ws.debuglog("stream",le=>{m=le});const b=mue,_=Cv,{getHighWaterMark:E,getDefaultHighWaterMark:S}=aS,{aggregateTwoErrors:T,codes:{ERR_INVALID_ARG_TYPE:O,ERR_METHOD_NOT_IMPLEMENTED:M,ERR_OUT_OF_RANGE:Q,ERR_STREAM_PUSH_AFTER_EOF:W,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:U},AbortError:ee}=Ns,{validateObject:R}=k_,z=f("kPaused"),{StringDecoder:K}=Tw,Y=k9;a(Te.prototype,p.prototype),a(Te,p);const I=()=>{},{errorOrDestroy:D}=_,N=1,V=2,J=4,j=8,G=16,C=32,F=64,Z=128,te=256,re=512,q=1024,L=2048,k=4096,B=8192,X=16384,ne=32768,ae=65536,ye=1<<17,_e=1<<18;function $e(le){return{enumerable:!1,get(){return(this.state&le)!==0},set(ue){ue?this.state|=le:this.state&=~le}}}o(Ce.prototype,{objectMode:$e(N),ended:$e(V),endEmitted:$e(J),reading:$e(j),constructed:$e(G),sync:$e(C),needReadable:$e(F),emittedReadable:$e(Z),readableListening:$e(te),resumeScheduled:$e(re),errorEmitted:$e(q),emitClose:$e(L),autoDestroy:$e(k),destroyed:$e(B),closed:$e(X),closeEmitted:$e(ne),multiAwaitDrain:$e(ae),readingMore:$e(ye),dataEmitted:$e(_e)});function Ce(le,ue,Re){typeof Re!="boolean"&&(Re=ue instanceof $u()),this.state=L|k|G|C,le&&le.objectMode&&(this.state|=N),Re&&le&&le.readableObjectMode&&(this.state|=N),this.highWaterMark=le?E(this,le,"readableHighWaterMark",Re):S(!1),this.buffer=new b,this.length=0,this.pipes=[],this.flowing=null,this[z]=null,le&&le.emitClose===!1&&(this.state&=~L),le&&le.autoDestroy===!1&&(this.state&=~k),this.errored=null,this.defaultEncoding=le&&le.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,le&&le.encoding&&(this.decoder=new K(le.encoding),this.encoding=le.encoding)}function Te(le){if(!(this instanceof Te))return new Te(le);const ue=this instanceof $u();this._readableState=new Ce(le,this,ue),le&&(typeof le.read=="function"&&(this._read=le.read),typeof le.destroy=="function"&&(this._destroy=le.destroy),typeof le.construct=="function"&&(this._construct=le.construct),le.signal&&!ue&&w(le.signal,this)),p.call(this,le),_.construct(this,()=>{this._readableState.needReadable&&fe(this,this._readableState)})}Te.prototype.destroy=_.destroy,Te.prototype._undestroy=_.undestroy,Te.prototype._destroy=function(le,ue){ue(le)},Te.prototype[h.captureRejectionSymbol]=function(le){this.destroy(le)},Te.prototype[c]=function(){let le;return this.destroyed||(le=this.readableEnded?null:new ee,this.destroy(le)),new l((ue,Re)=>v(this,De=>De&&De!==le?Re(De):ue(null)))},Te.prototype.push=function(le,ue){return ze(this,le,ue,!1)},Te.prototype.unshift=function(le,ue){return ze(this,le,ue,!0)};function ze(le,ue,Re,De){m("readableAddChunk",ue);const Je=le._readableState;let yi;if(Je.state&N||(typeof ue=="string"?(Re=Re||Je.defaultEncoding,Je.encoding!==Re&&(De&&Je.encoding?ue=g.from(ue,Re).toString(Je.encoding):(ue=g.from(ue,Re),Re=""))):ue instanceof g?Re="":p._isUint8Array(ue)?(ue=p._uint8ArrayToBuffer(ue),Re=""):ue!=null&&(yi=new O("chunk",["string","Buffer","Uint8Array"],ue))),yi)D(le,yi);else if(ue===null)Je.state&=~j,$(le,Je);else if(Je.state&N||ue&&ue.length>0)if(De)if(Je.state&J)D(le,new U);else{if(Je.destroyed||Je.errored)return!1;ht(le,Je,ue,!0)}else if(Je.ended)D(le,new W);else{if(Je.destroyed||Je.errored)return!1;Je.state&=~j,Je.decoder&&!Re?(ue=Je.decoder.write(ue),Je.objectMode||ue.length!==0?ht(le,Je,ue,!1):fe(le,Je)):ht(le,Je,ue,!1)}else De||(Je.state&=~j,fe(le,Je));return!Je.ended&&(Je.length<Je.highWaterMark||Je.length===0)}function ht(le,ue,Re,De){ue.flowing&&ue.length===0&&!ue.sync&&le.listenerCount("data")>0?(ue.state&ae?ue.awaitDrainWriters.clear():ue.awaitDrainWriters=null,ue.dataEmitted=!0,le.emit("data",Re)):(ue.length+=ue.objectMode?1:Re.length,De?ue.buffer.unshift(Re):ue.buffer.push(Re),ue.state&F&&P(le)),fe(le,ue)}Te.prototype.isPaused=function(){const le=this._readableState;return le[z]===!0||le.flowing===!1},Te.prototype.setEncoding=function(le){const ue=new K(le);this._readableState.decoder=ue,this._readableState.encoding=this._readableState.decoder.encoding;const Re=this._readableState.buffer;let De="";for(const Je of Re)De+=ue.write(Je);return Re.clear(),De!==""&&Re.push(De),this._readableState.length=De.length,this};const ie=1073741824;function ce(le){if(le>ie)throw new Q("size","<= 1GiB",le);return le--,le|=le>>>1,le|=le>>>2,le|=le>>>4,le|=le>>>8,le|=le>>>16,le++,le}function H(le,ue){return le<=0||ue.length===0&&ue.ended?0:ue.state&N?1:n(le)?ue.flowing&&ue.length?ue.buffer.first().length:ue.length:le<=ue.length?le:ue.ended?ue.length:0}Te.prototype.read=function(le){m("read",le),le===void 0?le=NaN:t(le)||(le=i(le,10));const ue=this._readableState,Re=le;if(le>ue.highWaterMark&&(ue.highWaterMark=ce(le)),le!==0&&(ue.state&=~Z),le===0&&ue.needReadable&&((ue.highWaterMark!==0?ue.length>=ue.highWaterMark:ue.length>0)||ue.ended))return m("read: emitReadable",ue.length,ue.ended),ue.length===0&&ue.ended?zs(this):P(this),null;if(le=H(le,ue),le===0&&ue.ended)return ue.length===0&&zs(this),null;let De=(ue.state&F)!==0;if(m("need readable",De),(ue.length===0||ue.length-le<ue.highWaterMark)&&(De=!0,m("length less than watermark",De)),ue.ended||ue.reading||ue.destroyed||ue.errored||!ue.constructed)De=!1,m("reading, ended or constructing",De);else if(De){m("do read"),ue.state|=j|C,ue.length===0&&(ue.state|=F);try{this._read(ue.highWaterMark)}catch(yi){D(this,yi)}ue.state&=~C,ue.reading||(le=H(Re,ue))}let Je;return le>0?Je=il(le,ue):Je=null,Je===null?(ue.needReadable=ue.length<=ue.highWaterMark,le=0):(ue.length-=le,ue.multiAwaitDrain?ue.awaitDrainWriters.clear():ue.awaitDrainWriters=null),ue.length===0&&(ue.ended||(ue.needReadable=!0),Re!==le&&ue.ended&&zs(this)),Je!==null&&!ue.errorEmitted&&!ue.closeEmitted&&(ue.dataEmitted=!0,this.emit("data",Je)),Je};function $(le,ue){if(m("onEofChunk"),!ue.ended){if(ue.decoder){const Re=ue.decoder.end();Re&&Re.length&&(ue.buffer.push(Re),ue.length+=ue.objectMode?1:Re.length)}ue.ended=!0,ue.sync?P(le):(ue.needReadable=!1,ue.emittedReadable=!0,se(le))}}function P(le){const ue=le._readableState;m("emitReadable",ue.needReadable,ue.emittedReadable),ue.needReadable=!1,ue.emittedReadable||(m("emitReadable",ue.flowing),ue.emittedReadable=!0,r.nextTick(se,le))}function se(le){const ue=le._readableState;m("emitReadable_",ue.destroyed,ue.length,ue.ended),!ue.destroyed&&!ue.errored&&(ue.length||ue.ended)&&(le.emit("readable"),ue.emittedReadable=!1),ue.needReadable=!ue.flowing&&!ue.ended&&ue.length<=ue.highWaterMark,Jt(le)}function fe(le,ue){!ue.readingMore&&ue.constructed&&(ue.readingMore=!0,r.nextTick(ve,le,ue))}function ve(le,ue){for(;!ue.reading&&!ue.ended&&(ue.length<ue.highWaterMark||ue.flowing&&ue.length===0);){const Re=ue.length;if(m("maybeReadMore read 0"),le.read(0),Re===ue.length)break}ue.readingMore=!1}Te.prototype._read=function(le){throw new M("_read()")},Te.prototype.pipe=function(le,ue){const Re=this,De=this._readableState;De.pipes.length===1&&(De.multiAwaitDrain||(De.multiAwaitDrain=!0,De.awaitDrainWriters=new d(De.awaitDrainWriters?[De.awaitDrainWriters]:[]))),De.pipes.push(le),m("pipe count=%d opts=%j",De.pipes.length,ue);const yi=(!ue||ue.end!==!1)&&le!==r.stdout&&le!==r.stderr?pe:Wr;De.endEmitted?r.nextTick(yi):Re.once("end",yi),le.on("unpipe",Qo);function Qo(Bt,dr){m("onunpipe"),Bt===Re&&dr&&dr.hasUnpiped===!1&&(dr.hasUnpiped=!0,Se())}function pe(){m("onend"),le.end()}let de,me=!1;function Se(){m("cleanup"),le.removeListener("close",Xt),le.removeListener("finish",Or),de&&le.removeListener("drain",de),le.removeListener("error",nt),le.removeListener("unpipe",Qo),Re.removeListener("end",pe),Re.removeListener("end",Wr),Re.removeListener("data",rt),me=!0,de&&De.awaitDrainWriters&&(!le._writableState||le._writableState.needDrain)&&de()}function xe(){me||(De.pipes.length===1&&De.pipes[0]===le?(m("false write response, pause",0),De.awaitDrainWriters=le,De.multiAwaitDrain=!1):De.pipes.length>1&&De.pipes.includes(le)&&(m("false write response, pause",De.awaitDrainWriters.size),De.awaitDrainWriters.add(le)),Re.pause()),de||(de=Ee(Re,le),le.on("drain",de))}Re.on("data",rt);function rt(Bt){m("ondata");const dr=le.write(Bt);m("dest.write",dr),dr===!1&&xe()}function nt(Bt){if(m("onerror",Bt),Wr(),le.removeListener("error",nt),le.listenerCount("error")===0){const dr=le._writableState||le._readableState;dr&&!dr.errorEmitted?D(le,Bt):le.emit("error",Bt)}}y(le,"error",nt);function Xt(){le.removeListener("finish",Or),Wr()}le.once("close",Xt);function Or(){m("onfinish"),le.removeListener("close",Xt),Wr()}le.once("finish",Or);function Wr(){m("unpipe"),Re.unpipe(le)}return le.emit("pipe",Re),le.writableNeedDrain===!0?xe():De.flowing||(m("pipe resume"),Re.resume()),le};function Ee(le,ue){return function(){const De=le._readableState;De.awaitDrainWriters===ue?(m("pipeOnDrain",1),De.awaitDrainWriters=null):De.multiAwaitDrain&&(m("pipeOnDrain",De.awaitDrainWriters.size),De.awaitDrainWriters.delete(ue)),(!De.awaitDrainWriters||De.awaitDrainWriters.size===0)&&le.listenerCount("data")&&le.resume()}}Te.prototype.unpipe=function(le){const ue=this._readableState,Re={hasUnpiped:!1};if(ue.pipes.length===0)return this;if(!le){const Je=ue.pipes;ue.pipes=[],this.pause();for(let yi=0;yi<Je.length;yi++)Je[yi].emit("unpipe",this,{hasUnpiped:!1});return this}const De=e(ue.pipes,le);return De===-1?this:(ue.pipes.splice(De,1),ue.pipes.length===0&&this.pause(),le.emit("unpipe",this,Re),this)},Te.prototype.on=function(le,ue){const Re=p.prototype.on.call(this,le,ue),De=this._readableState;return le==="data"?(De.readableListening=this.listenerCount("readable")>0,De.flowing!==!1&&this.resume()):le==="readable"&&!De.endEmitted&&!De.readableListening&&(De.readableListening=De.needReadable=!0,De.flowing=!1,De.emittedReadable=!1,m("on readable",De.length,De.reading),De.length?P(this):De.reading||r.nextTick(Ft,this)),Re},Te.prototype.addListener=Te.prototype.on,Te.prototype.removeListener=function(le,ue){const Re=p.prototype.removeListener.call(this,le,ue);return le==="readable"&&r.nextTick(pt,this),Re},Te.prototype.off=Te.prototype.removeListener,Te.prototype.removeAllListeners=function(le){const ue=p.prototype.removeAllListeners.apply(this,arguments);return(le==="readable"||le===void 0)&&r.nextTick(pt,this),ue};function pt(le){const ue=le._readableState;ue.readableListening=le.listenerCount("readable")>0,ue.resumeScheduled&&ue[z]===!1?ue.flowing=!0:le.listenerCount("data")>0?le.resume():ue.readableListening||(ue.flowing=null)}function Ft(le){m("readable nexttick read 0"),le.read(0)}Te.prototype.resume=function(){const le=this._readableState;return le.flowing||(m("resume"),le.flowing=!le.readableListening,ir(this,le)),le[z]=!1,this};function ir(le,ue){ue.resumeScheduled||(ue.resumeScheduled=!0,r.nextTick(Mt,le,ue))}function Mt(le,ue){m("resume",ue.reading),ue.reading||le.read(0),ue.resumeScheduled=!1,le.emit("resume"),Jt(le),ue.flowing&&!ue.reading&&le.read(0)}Te.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[z]=!0,this};function Jt(le){const ue=le._readableState;for(m("flow",ue.flowing);ue.flowing&&le.read()!==null;);}Te.prototype.wrap=function(le){let ue=!1;le.on("data",De=>{!this.push(De)&&le.pause&&(ue=!0,le.pause())}),le.on("end",()=>{this.push(null)}),le.on("error",De=>{D(this,De)}),le.on("close",()=>{this.destroy()}),le.on("destroy",()=>{this.destroy()}),this._read=()=>{ue&&le.resume&&(ue=!1,le.resume())};const Re=s(le);for(let De=1;De<Re.length;De++){const Je=Re[De];this[Je]===void 0&&typeof le[Je]=="function"&&(this[Je]=le[Je].bind(le))}return this},Te.prototype[u]=function(){return Xu(this)},Te.prototype.iterator=function(le){return le!==void 0&&R(le,"options"),Xu(this,le)};function Xu(le,ue){typeof le.read!="function"&&(le=Te.wrap(le,{objectMode:!0}));const Re=nl(le,ue);return Re.stream=le,Re}async function*nl(le,ue){let Re=I;function De(Qo){this===le?(Re(),Re=I):Re=Qo}le.on("readable",De);let Je;const yi=v(le,{writable:!1},Qo=>{Je=Qo?T(Je,Qo):null,Re(),Re=I});try{for(;;){const Qo=le.destroyed?null:le.read();if(Qo!==null)yield Qo;else{if(Je)throw Je;if(Je===null)return;await new l(De)}}}catch(Qo){throw Je=T(Je,Qo),Je}finally{(Je||ue?.destroyOnReturn!==!1)&&(Je===void 0||le._readableState.autoDestroy)?_.destroyer(le,null):(le.off("readable",De),yi())}}o(Te.prototype,{readable:{__proto__:null,get(){const le=this._readableState;return!!le&&le.readable!==!1&&!le.destroyed&&!le.errorEmitted&&!le.endEmitted},set(le){this._readableState&&(this._readableState.readable=!!le)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(le){this._readableState&&(this._readableState.flowing=le)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(le){this._readableState&&(this._readableState.destroyed=le)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),o(Ce.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[z]!==!1},set(le){this[z]=!!le}}}),Te._fromList=il;function il(le,ue){if(ue.length===0)return null;let Re;return ue.objectMode?Re=ue.buffer.shift():!le||le>=ue.length?(ue.decoder?Re=ue.buffer.join(""):ue.buffer.length===1?Re=ue.buffer.first():Re=ue.buffer.concat(ue.length),ue.buffer.clear()):Re=ue.buffer.consume(le,ue.decoder),Re}function zs(le){const ue=le._readableState;m("endReadable",ue.endEmitted),ue.endEmitted||(ue.ended=!0,r.nextTick(Fs,ue,le))}function Fs(le,ue){if(m("endReadableNT",le.endEmitted,le.length),!le.errored&&!le.closeEmitted&&!le.endEmitted&&le.length===0){if(le.endEmitted=!0,ue.emit("end"),ue.writable&&ue.allowHalfOpen===!1)r.nextTick(Qu,ue);else if(le.autoDestroy){const Re=ue._writableState;(!Re||Re.autoDestroy&&(Re.finished||Re.writable===!1))&&ue.destroy()}}}function Qu(le){le.writable&&!le.writableEnded&&!le.destroyed&&le.end()}Te.from=function(le,ue){return Y(Te,le,ue)};let Xv;function Qv(){return Xv===void 0&&(Xv={}),Xv}return Te.fromWeb=function(le,ue){return Qv().newStreamReadableFromReadableStream(le,ue)},Te.toWeb=function(le,ue){return Qv().newReadableStreamFromStreamReadable(le,ue)},Te.wrap=function(le,ue){var Re,De;return new Te({objectMode:(Re=(De=le.readableObjectMode)!==null&&De!==void 0?De:le.objectMode)!==null&&Re!==void 0?Re:!0,...ue,destroy(Je,yi){_.destroyer(le,Je),yi(Je)}}).wrap(le)},JT}var XT,E8;function bC(){if(E8)return XT;E8=1;const r=Us,{ArrayPrototypeSlice:e,Error:t,FunctionPrototypeSymbolHasInstance:n,ObjectDefineProperty:i,ObjectDefineProperties:o,ObjectSetPrototypeOf:s,StringPrototypeToLowerCase:a,Symbol:l,SymbolHasInstance:d}=Mn;XT=R,R.WritableState=U;const{EventEmitter:c}=dd,u=gC.Stream,{Buffer:f}=Dn,h=Cv,{addAbortSignal:p}=sS,{getHighWaterMark:y,getDefaultHighWaterMark:g}=aS,{ERR_INVALID_ARG_TYPE:w,ERR_METHOD_NOT_IMPLEMENTED:v,ERR_MULTIPLE_CALLBACK:m,ERR_STREAM_CANNOT_PIPE:b,ERR_STREAM_DESTROYED:_,ERR_STREAM_ALREADY_FINISHED:E,ERR_STREAM_NULL_VALUES:S,ERR_STREAM_WRITE_AFTER_END:T,ERR_UNKNOWN_ENCODING:O}=Ns.codes,{errorOrDestroy:M}=h;s(R.prototype,u.prototype),s(R,u);function Q(){}const W=l("kOnFinished");function U(k,B,X){typeof X!="boolean"&&(X=B instanceof $u()),this.objectMode=!!(k&&k.objectMode),X&&(this.objectMode=this.objectMode||!!(k&&k.writableObjectMode)),this.highWaterMark=k?y(this,k,"writableHighWaterMark",X):g(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const ne=!!(k&&k.decodeStrings===!1);this.decodeStrings=!ne,this.defaultEncoding=k&&k.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=D.bind(void 0,B),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,ee(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!k||k.emitClose!==!1,this.autoDestroy=!k||k.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[W]=[]}function ee(k){k.buffered=[],k.bufferedIndex=0,k.allBuffers=!0,k.allNoop=!0}U.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},i(U.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function R(k){const B=this instanceof $u();if(!B&&!n(R,this))return new R(k);this._writableState=new U(k,this,B),k&&(typeof k.write=="function"&&(this._write=k.write),typeof k.writev=="function"&&(this._writev=k.writev),typeof k.destroy=="function"&&(this._destroy=k.destroy),typeof k.final=="function"&&(this._final=k.final),typeof k.construct=="function"&&(this._construct=k.construct),k.signal&&p(k.signal,this)),u.call(this,k),h.construct(this,()=>{const X=this._writableState;X.writing||j(this,X),Z(this,X)})}i(R,d,{__proto__:null,value:function(k){return n(this,k)?!0:this!==R?!1:k&&k._writableState instanceof U}}),R.prototype.pipe=function(){M(this,new b)};function z(k,B,X,ne){const ae=k._writableState;if(typeof X=="function")ne=X,X=ae.defaultEncoding;else{if(!X)X=ae.defaultEncoding;else if(X!=="buffer"&&!f.isEncoding(X))throw new O(X);typeof ne!="function"&&(ne=Q)}if(B===null)throw new S;if(!ae.objectMode)if(typeof B=="string")ae.decodeStrings!==!1&&(B=f.from(B,X),X="buffer");else if(B instanceof f)X="buffer";else if(u._isUint8Array(B))B=u._uint8ArrayToBuffer(B),X="buffer";else throw new w("chunk",["string","Buffer","Uint8Array"],B);let ye;return ae.ending?ye=new T:ae.destroyed&&(ye=new _("write")),ye?(r.nextTick(ne,ye),M(k,ye,!0),ye):(ae.pendingcb++,K(k,ae,B,X,ne))}R.prototype.write=function(k,B,X){return z(this,k,B,X)===!0},R.prototype.cork=function(){this._writableState.corked++},R.prototype.uncork=function(){const k=this._writableState;k.corked&&(k.corked--,k.writing||j(this,k))},R.prototype.setDefaultEncoding=function(B){if(typeof B=="string"&&(B=a(B)),!f.isEncoding(B))throw new O(B);return this._writableState.defaultEncoding=B,this};function K(k,B,X,ne,ae){const ye=B.objectMode?1:X.length;B.length+=ye;const _e=B.length<B.highWaterMark;return _e||(B.needDrain=!0),B.writing||B.corked||B.errored||!B.constructed?(B.buffered.push({chunk:X,encoding:ne,callback:ae}),B.allBuffers&&ne!=="buffer"&&(B.allBuffers=!1),B.allNoop&&ae!==Q&&(B.allNoop=!1)):(B.writelen=ye,B.writecb=ae,B.writing=!0,B.sync=!0,k._write(X,ne,B.onwrite),B.sync=!1),_e&&!B.errored&&!B.destroyed}function Y(k,B,X,ne,ae,ye,_e){B.writelen=ne,B.writecb=_e,B.writing=!0,B.sync=!0,B.destroyed?B.onwrite(new _("write")):X?k._writev(ae,B.onwrite):k._write(ae,ye,B.onwrite),B.sync=!1}function I(k,B,X,ne){--B.pendingcb,ne(X),J(B),M(k,X)}function D(k,B){const X=k._writableState,ne=X.sync,ae=X.writecb;if(typeof ae!="function"){M(k,new m);return}X.writing=!1,X.writecb=null,X.length-=X.writelen,X.writelen=0,B?(B.stack,X.errored||(X.errored=B),k._readableState&&!k._readableState.errored&&(k._readableState.errored=B),ne?r.nextTick(I,k,X,B,ae):I(k,X,B,ae)):(X.buffered.length>X.bufferedIndex&&j(k,X),ne?X.afterWriteTickInfo!==null&&X.afterWriteTickInfo.cb===ae?X.afterWriteTickInfo.count++:(X.afterWriteTickInfo={count:1,cb:ae,stream:k,state:X},r.nextTick(N,X.afterWriteTickInfo)):V(k,X,1,ae))}function N({stream:k,state:B,count:X,cb:ne}){return B.afterWriteTickInfo=null,V(k,B,X,ne)}function V(k,B,X,ne){for(!B.ending&&!k.destroyed&&B.length===0&&B.needDrain&&(B.needDrain=!1,k.emit("drain"));X-- >0;)B.pendingcb--,ne();B.destroyed&&J(B),Z(k,B)}function J(k){if(k.writing)return;for(let ae=k.bufferedIndex;ae<k.buffered.length;++ae){var B;const{chunk:ye,callback:_e}=k.buffered[ae],$e=k.objectMode?1:ye.length;k.length-=$e,_e((B=k.errored)!==null&&B!==void 0?B:new _("write"))}const X=k[W].splice(0);for(let ae=0;ae<X.length;ae++){var ne;X[ae]((ne=k.errored)!==null&&ne!==void 0?ne:new _("end"))}ee(k)}function j(k,B){if(B.corked||B.bufferProcessing||B.destroyed||!B.constructed)return;const{buffered:X,bufferedIndex:ne,objectMode:ae}=B,ye=X.length-ne;if(!ye)return;let _e=ne;if(B.bufferProcessing=!0,ye>1&&k._writev){B.pendingcb-=ye-1;const $e=B.allNoop?Q:Te=>{for(let ze=_e;ze<X.length;++ze)X[ze].callback(Te)},Ce=B.allNoop&&_e===0?X:e(X,_e);Ce.allBuffers=B.allBuffers,Y(k,B,!0,B.length,Ce,"",$e),ee(B)}else{do{const{chunk:$e,encoding:Ce,callback:Te}=X[_e];X[_e++]=null;const ze=ae?1:$e.length;Y(k,B,!1,ze,$e,Ce,Te)}while(_e<X.length&&!B.writing);_e===X.length?ee(B):_e>256?(X.splice(0,_e),B.bufferedIndex=0):B.bufferedIndex=_e}B.bufferProcessing=!1}R.prototype._write=function(k,B,X){if(this._writev)this._writev([{chunk:k,encoding:B}],X);else throw new v("_write()")},R.prototype._writev=null,R.prototype.end=function(k,B,X){const ne=this._writableState;typeof k=="function"?(X=k,k=null,B=null):typeof B=="function"&&(X=B,B=null);let ae;if(k!=null){const ye=z(this,k,B);ye instanceof t&&(ae=ye)}return ne.corked&&(ne.corked=1,this.uncork()),ae||(!ne.errored&&!ne.ending?(ne.ending=!0,Z(this,ne,!0),ne.ended=!0):ne.finished?ae=new E("end"):ne.destroyed&&(ae=new _("end"))),typeof X=="function"&&(ae||ne.finished?r.nextTick(X,ae):ne[W].push(X)),this};function G(k){return k.ending&&!k.destroyed&&k.constructed&&k.length===0&&!k.errored&&k.buffered.length===0&&!k.finished&&!k.writing&&!k.errorEmitted&&!k.closeEmitted}function C(k,B){let X=!1;function ne(ae){if(X){M(k,ae??m());return}if(X=!0,B.pendingcb--,ae){const ye=B[W].splice(0);for(let _e=0;_e<ye.length;_e++)ye[_e](ae);M(k,ae,B.sync)}else G(B)&&(B.prefinished=!0,k.emit("prefinish"),B.pendingcb++,r.nextTick(te,k,B))}B.sync=!0,B.pendingcb++;try{k._final(ne)}catch(ae){ne(ae)}B.sync=!1}function F(k,B){!B.prefinished&&!B.finalCalled&&(typeof k._final=="function"&&!B.destroyed?(B.finalCalled=!0,C(k,B)):(B.prefinished=!0,k.emit("prefinish")))}function Z(k,B,X){G(B)&&(F(k,B),B.pendingcb===0&&(X?(B.pendingcb++,r.nextTick((ne,ae)=>{G(ae)?te(ne,ae):ae.pendingcb--},k,B)):G(B)&&(B.pendingcb++,te(k,B))))}function te(k,B){B.pendingcb--,B.finished=!0;const X=B[W].splice(0);for(let ne=0;ne<X.length;ne++)X[ne]();if(k.emit("finish"),B.autoDestroy){const ne=k._readableState;(!ne||ne.autoDestroy&&(ne.endEmitted||ne.readable===!1))&&k.destroy()}}o(R.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(k){this._writableState&&(this._writableState.destroyed=k)}},writable:{__proto__:null,get(){const k=this._writableState;return!!k&&k.writable!==!1&&!k.destroyed&&!k.errored&&!k.ending&&!k.ended},set(k){this._writableState&&(this._writableState.writable=!!k)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const k=this._writableState;return k?!k.destroyed&&!k.ending&&k.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const re=h.destroy;R.prototype.destroy=function(k,B){const X=this._writableState;return!X.destroyed&&(X.bufferedIndex<X.buffered.length||X[W].length)&&r.nextTick(J,X),re.call(this,k,B),this},R.prototype._undestroy=h.undestroy,R.prototype._destroy=function(k,B){B(k)},R.prototype[c.captureRejectionSymbol]=function(k){this.destroy(k)};let q;function L(){return q===void 0&&(q={}),q}return R.fromWeb=function(k,B){return L().newStreamWritableFromWritableStream(k,B)},R.toWeb=function(k){return L().newWritableStreamFromStreamWritable(k)},XT}var QT,A8;function Fue(){if(A8)return QT;A8=1;const r=Us,e=Dn,{isReadable:t,isWritable:n,isIterable:i,isNodeStream:o,isReadableNodeStream:s,isWritableNodeStream:a,isDuplexNodeStream:l,isReadableStream:d,isWritableStream:c}=Hu,u=Lh,{AbortError:f,codes:{ERR_INVALID_ARG_TYPE:h,ERR_INVALID_RETURN_VALUE:p}}=Ns,{destroyer:y}=Cv,g=$u(),w=cS(),v=bC(),{createDeferredPromise:m}=ws,b=k9,_=globalThis.Blob||e.Blob,E=typeof _<"u"?function(U){return U instanceof _}:function(U){return!1},S=globalThis.AbortController||kh().AbortController,{FunctionPrototypeCall:T}=Mn;class O extends g{constructor(U){super(U),U?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),U?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}QT=function W(U,ee){if(l(U))return U;if(s(U))return Q({readable:U});if(a(U))return Q({writable:U});if(o(U))return Q({writable:!1,readable:!1});if(d(U))return Q({readable:w.fromWeb(U)});if(c(U))return Q({writable:v.fromWeb(U)});if(typeof U=="function"){const{value:z,write:K,final:Y,destroy:I}=M(U);if(i(z))return b(O,z,{objectMode:!0,write:K,final:Y,destroy:I});const D=z?.then;if(typeof D=="function"){let N;const V=T(D,z,J=>{if(J!=null)throw new p("nully","body",J)},J=>{y(N,J)});return N=new O({objectMode:!0,readable:!1,write:K,final(J){Y(async()=>{try{await V,r.nextTick(J,null)}catch(j){r.nextTick(J,j)}})},destroy:I})}throw new p("Iterable, AsyncIterable or AsyncFunction",ee,z)}if(E(U))return W(U.arrayBuffer());if(i(U))return b(O,U,{objectMode:!0,writable:!1});if(d(U?.readable)&&c(U?.writable))return O.fromWeb(U);if(typeof U?.writable=="object"||typeof U?.readable=="object"){const z=U!=null&&U.readable?s(U?.readable)?U?.readable:W(U.readable):void 0,K=U!=null&&U.writable?a(U?.writable)?U?.writable:W(U.writable):void 0;return Q({readable:z,writable:K})}const R=U?.then;if(typeof R=="function"){let z;return T(R,U,K=>{K!=null&&z.push(K),z.push(null)},K=>{y(z,K)}),z=new O({objectMode:!0,writable:!1,read(){}})}throw new h(ee,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],U)};function M(W){let{promise:U,resolve:ee}=m();const R=new S,z=R.signal;return{value:W(async function*(){for(;;){const Y=U;U=null;const{chunk:I,done:D,cb:N}=await Y;if(r.nextTick(N),D)return;if(z.aborted)throw new f(void 0,{cause:z.reason});({promise:U,resolve:ee}=m()),yield I}}(),{signal:z}),write(Y,I,D){const N=ee;ee=null,N({chunk:Y,done:!1,cb:D})},final(Y){const I=ee;ee=null,I({done:!0,cb:Y})},destroy(Y,I){R.abort(),I(Y)}}}function Q(W){const U=W.readable&&typeof W.readable.read!="function"?w.wrap(W.readable):W.readable,ee=W.writable;let R=!!t(U),z=!!n(ee),K,Y,I,D,N;function V(J){const j=D;D=null,j?j(J):J&&N.destroy(J)}return N=new O({readableObjectMode:!!(U!=null&&U.readableObjectMode),writableObjectMode:!!(ee!=null&&ee.writableObjectMode),readable:R,writable:z}),z&&(u(ee,J=>{z=!1,J&&y(U,J),V(J)}),N._write=function(J,j,G){ee.write(J,j)?G():K=G},N._final=function(J){ee.end(),Y=J},ee.on("drain",function(){if(K){const J=K;K=null,J()}}),ee.on("finish",function(){if(Y){const J=Y;Y=null,J()}})),R&&(u(U,J=>{R=!1,J&&y(U,J),V(J)}),U.on("readable",function(){if(I){const J=I;I=null,J()}}),U.on("end",function(){N.push(null)}),N._read=function(){for(;;){const J=U.read();if(J===null){I=N._read;return}if(!N.push(J))return}}),N._destroy=function(J,j){!J&&D!==null&&(J=new f),I=null,K=null,Y=null,D===null?j(J):(D=j,y(ee,J),y(U,J))},N}return QT}var e$,x8;function $u(){if(x8)return e$;x8=1;const{ObjectDefineProperties:r,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:t,ObjectSetPrototypeOf:n}=Mn;e$=s;const i=cS(),o=bC();n(s.prototype,i.prototype),n(s,i);{const c=t(o.prototype);for(let u=0;u<c.length;u++){const f=c[u];s.prototype[f]||(s.prototype[f]=o.prototype[f])}}function s(c){if(!(this instanceof s))return new s(c);i.call(this,c),o.call(this,c),c?(this.allowHalfOpen=c.allowHalfOpen!==!1,c.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),c.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}r(s.prototype,{writable:{__proto__:null,...e(o.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(o.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(o.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(o.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(o.prototype,"writableLength")},writableFinished:{__proto__:null,...e(o.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(o.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(o.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(o.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(c){this._readableState&&this._writableState&&(this._readableState.destroyed=c,this._writableState.destroyed=c)}}});let a;function l(){return a===void 0&&(a={}),a}s.fromWeb=function(c,u){return l().newStreamDuplexFromReadableWritablePair(c,u)},s.toWeb=function(c){return l().newReadableWritablePairFromDuplex(c)};let d;return s.from=function(c){return d||(d=Fue()),d(c,"body")},e$}const{ObjectSetPrototypeOf:P9,Symbol:que}=Mn;var I9=ku;const{ERR_METHOD_NOT_IMPLEMENTED:Vue}=Ns.codes,wC=$u(),{getHighWaterMark:Wue}=aS;P9(ku.prototype,wC.prototype);P9(ku,wC);const Hb=que("kCallback");function ku(r){if(!(this instanceof ku))return new ku(r);const e=r?Wue(this,r,"readableHighWaterMark",!0):null;e===0&&(r={...r,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:r.writableHighWaterMark||0}),wC.call(this,r),this._readableState.sync=!1,this[Hb]=null,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",Hue)}function oI(r){typeof this._flush=="function"&&!this.destroyed?this._flush((e,t)=>{if(e){r?r(e):this.destroy(e);return}t!=null&&this.push(t),this.push(null),r&&r()}):(this.push(null),r&&r())}function Hue(){this._final!==oI&&oI.call(this)}ku.prototype._final=oI;ku.prototype._transform=function(r,e,t){throw new Vue("_transform()")};ku.prototype._write=function(r,e,t){const n=this._readableState,i=this._writableState,o=n.length;this._transform(r,e,(s,a)=>{if(s){t(s);return}a!=null&&this.push(a),i.ended||o===n.length||n.length<n.highWaterMark?t():this[Hb]=t})};ku.prototype._read=function(){if(this[Hb]){const r=this[Hb];this[Hb]=null,r()}};const{ObjectSetPrototypeOf:O9}=Mn;var C9=Kg;const _C=I9;O9(Kg.prototype,_C.prototype);O9(Kg,_C);function Kg(r){if(!(this instanceof Kg))return new Kg(r);_C.call(this,r)}Kg.prototype._transform=function(r,e,t){t(null,r)};const hb=Us,{ArrayIsArray:Gue,Promise:Yue,SymbolAsyncIterator:Zue,SymbolDispose:Jue}=Mn,gA=Lh,{once:Xue}=ws,Que=Cv,S8=$u(),{aggregateTwoErrors:efe,codes:{ERR_INVALID_ARG_TYPE:sI,ERR_INVALID_RETURN_VALUE:t$,ERR_MISSING_ARGS:tfe,ERR_STREAM_DESTROYED:rfe,ERR_STREAM_PREMATURE_CLOSE:nfe},AbortError:ife}=Ns,{validateFunction:ofe,validateAbortSignal:sfe}=k_,{isIterable:gp,isReadable:r$,isReadableNodeStream:iE,isNodeStream:T8,isTransformStream:Nm,isWebStream:afe,isReadableStream:n$,isReadableFinished:cfe}=Hu,lfe=globalThis.AbortController||kh().AbortController;let i$,o$,s$;function $8(r,e,t){let n=!1;r.on("close",()=>{n=!0});const i=gA(r,{readable:e,writable:t},o=>{n=!o});return{destroy:o=>{n||(n=!0,Que.destroyer(r,o||new rfe("pipe")))},cleanup:i}}function dfe(r){return ofe(r[r.length-1],"streams[stream.length - 1]"),r.pop()}function a$(r){if(gp(r))return r;if(iE(r))return ufe(r);throw new sI("val",["Readable","Iterable","AsyncIterable"],r)}async function*ufe(r){o$||(o$=cS()),yield*o$.prototype[Zue].call(r)}async function D1(r,e,t,{end:n}){let i,o=null;const s=d=>{if(d&&(i=d),o){const c=o;o=null,c()}},a=()=>new Yue((d,c)=>{i?c(i):o=()=>{i?c(i):d()}});e.on("drain",s);const l=gA(e,{readable:!1},s);try{e.writableNeedDrain&&await a();for await(const d of r)e.write(d)||await a();n&&(e.end(),await a()),t()}catch(d){t(i!==d?efe(i,d):d)}finally{l(),e.off("drain",s)}}async function c$(r,e,t,{end:n}){Nm(e)&&(e=e.writable);const i=e.getWriter();try{for await(const o of r)await i.ready,i.write(o).catch(()=>{});await i.ready,n&&await i.close(),t()}catch(o){try{await i.abort(o),t(o)}catch(s){t(s)}}}function ffe(...r){return R9(r,Xue(dfe(r)))}function R9(r,e,t){if(r.length===1&&Gue(r[0])&&(r=r[0]),r.length<2)throw new tfe("streams");const n=new lfe,i=n.signal,o=t?.signal,s=[];sfe(o,"options.signal");function a(){p(new ife)}s$=s$||ws.addAbortListener;let l;o&&(l=s$(o,a));let d,c;const u=[];let f=0;function h(v){p(v,--f===0)}function p(v,m){var b;if(v&&(!d||d.code==="ERR_STREAM_PREMATURE_CLOSE")&&(d=v),!(!d&&!m)){for(;u.length;)u.shift()(d);(b=l)===null||b===void 0||b[Jue](),n.abort(),m&&(d||s.forEach(_=>_()),hb.nextTick(e,d,c))}}let y;for(let v=0;v<r.length;v++){const m=r[v],b=v<r.length-1,_=v>0,E=b||t?.end!==!1,S=v===r.length-1;if(T8(m)){let T=function(O){O&&O.name!=="AbortError"&&O.code!=="ERR_STREAM_PREMATURE_CLOSE"&&h(O)};if(E){const{destroy:O,cleanup:M}=$8(m,b,_);u.push(O),r$(m)&&S&&s.push(M)}m.on("error",T),r$(m)&&S&&s.push(()=>{m.removeListener("error",T)})}if(v===0)if(typeof m=="function"){if(y=m({signal:i}),!gp(y))throw new t$("Iterable, AsyncIterable or Stream","source",y)}else gp(m)||iE(m)||Nm(m)?y=m:y=S8.from(m);else if(typeof m=="function"){if(Nm(y)){var g;y=a$((g=y)===null||g===void 0?void 0:g.readable)}else y=a$(y);if(y=m(y,{signal:i}),b){if(!gp(y,!0))throw new t$("AsyncIterable",`transform[${v-1}]`,y)}else{var w;i$||(i$=C9);const T=new i$({objectMode:!0}),O=(w=y)===null||w===void 0?void 0:w.then;if(typeof O=="function")f++,O.call(y,W=>{c=W,W!=null&&T.write(W),E&&T.end(),hb.nextTick(h)},W=>{T.destroy(W),hb.nextTick(h,W)});else if(gp(y,!0))f++,D1(y,T,h,{end:E});else if(n$(y)||Nm(y)){const W=y.readable||y;f++,D1(W,T,h,{end:E})}else throw new t$("AsyncIterable or Promise","destination",y);y=T;const{destroy:M,cleanup:Q}=$8(y,!1,!0);u.push(M),S&&s.push(Q)}}else if(T8(m)){if(iE(y)){f+=2;const T=hfe(y,m,h,{end:E});r$(m)&&S&&s.push(T)}else if(Nm(y)||n$(y)){const T=y.readable||y;f++,D1(T,m,h,{end:E})}else if(gp(y))f++,D1(y,m,h,{end:E});else throw new sI("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],y);y=m}else if(afe(m)){if(iE(y))f++,c$(a$(y),m,h,{end:E});else if(n$(y)||gp(y))f++,c$(y,m,h,{end:E});else if(Nm(y))f++,c$(y.readable,m,h,{end:E});else throw new sI("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],y);y=m}else y=S8.from(m)}return(i!=null&&i.aborted||o!=null&&o.aborted)&&hb.nextTick(a),y}function hfe(r,e,t,{end:n}){let i=!1;if(e.on("close",()=>{i||t(new nfe)}),r.pipe(e,{end:!1}),n){let o=function(){i=!0,e.end()};cfe(r)?hb.nextTick(o):r.once("end",o)}else t();return gA(r,{readable:!0,writable:!1},o=>{const s=r._readableState;o&&o.code==="ERR_STREAM_PREMATURE_CLOSE"&&s&&s.ended&&!s.errored&&!s.errorEmitted?r.once("end",t).once("error",t):t(o)}),gA(e,{readable:!1,writable:!0},t)}var EC={pipelineImpl:R9,pipeline:ffe};const{pipeline:pfe}=EC,M1=$u(),{destroyer:yfe}=Cv,{isNodeStream:B1,isReadable:k8,isWritable:P8,isWebStream:l$,isTransformStream:Xh,isWritableStream:I8,isReadableStream:O8}=Hu,{AbortError:mfe,codes:{ERR_INVALID_ARG_VALUE:C8,ERR_MISSING_ARGS:gfe}}=Ns,vfe=Lh;var D9=function(...e){if(e.length===0)throw new gfe("streams");if(e.length===1)return M1.from(e[0]);const t=[...e];if(typeof e[0]=="function"&&(e[0]=M1.from(e[0])),typeof e[e.length-1]=="function"){const h=e.length-1;e[h]=M1.from(e[h])}for(let h=0;h<e.length;++h)if(!(!B1(e[h])&&!l$(e[h]))){if(h<e.length-1&&!(k8(e[h])||O8(e[h])||Xh(e[h])))throw new C8(`streams[${h}]`,t[h],"must be readable");if(h>0&&!(P8(e[h])||I8(e[h])||Xh(e[h])))throw new C8(`streams[${h}]`,t[h],"must be writable")}let n,i,o,s,a;function l(h){const p=s;s=null,p?p(h):h?a.destroy(h):!f&&!u&&a.destroy()}const d=e[0],c=pfe(e,l),u=!!(P8(d)||I8(d)||Xh(d)),f=!!(k8(c)||O8(c)||Xh(c));if(a=new M1({writableObjectMode:!!(d!=null&&d.writableObjectMode),readableObjectMode:!!(c!=null&&c.readableObjectMode),writable:u,readable:f}),u){if(B1(d))a._write=function(p,y,g){d.write(p,y)?g():n=g},a._final=function(p){d.end(),i=p},d.on("drain",function(){if(n){const p=n;n=null,p()}});else if(l$(d)){const y=(Xh(d)?d.writable:d).getWriter();a._write=async function(g,w,v){try{await y.ready,y.write(g).catch(()=>{}),v()}catch(m){v(m)}},a._final=async function(g){try{await y.ready,y.close().catch(()=>{}),i=g}catch(w){g(w)}}}const h=Xh(c)?c.readable:c;vfe(h,()=>{if(i){const p=i;i=null,p()}})}if(f){if(B1(c))c.on("readable",function(){if(o){const h=o;o=null,h()}}),c.on("end",function(){a.push(null)}),a._read=function(){for(;;){const h=c.read();if(h===null){o=a._read;return}if(!a.push(h))return}};else if(l$(c)){const p=(Xh(c)?c.readable:c).getReader();a._read=async function(){for(;;)try{const{value:y,done:g}=await p.read();if(!a.push(y))return;if(g){a.push(null);return}}catch{return}}}}return a._destroy=function(h,p){!h&&s!==null&&(h=new mfe),o=null,n=null,i=null,s===null?p(h):(s=p,B1(c)&&yfe(c,h))},a};const bfe=globalThis.AbortController||kh().AbortController,{codes:{ERR_INVALID_ARG_VALUE:wfe,ERR_INVALID_ARG_TYPE:I_,ERR_MISSING_ARGS:_fe,ERR_OUT_OF_RANGE:Efe},AbortError:Ql}=Ns,{validateAbortSignal:em,validateInteger:R8,validateObject:tm}=k_,Afe=Mn.Symbol("kWeak"),xfe=Mn.Symbol("kResistStopPropagation"),{finished:Sfe}=Lh,Tfe=D9,{addAbortSignalNoValidate:$fe}=sS,{isWritable:kfe,isNodeStream:Pfe}=Hu,{deprecate:Ife}=ws,{ArrayPrototypePush:Ofe,Boolean:Cfe,MathFloor:D8,Number:Rfe,NumberIsNaN:Dfe,Promise:M8,PromiseReject:B8,PromiseResolve:Mfe,PromisePrototypeThen:j8,Symbol:M9}=Mn,vA=M9("kEmpty"),N8=M9("kEof");function Bfe(r,e){if(e!=null&&tm(e,"options"),e?.signal!=null&&em(e.signal,"options.signal"),Pfe(r)&&!kfe(r))throw new wfe("stream",r,"must be writable");const t=Tfe(this,r);return e!=null&&e.signal&&$fe(e.signal,t),t}function lS(r,e){if(typeof r!="function")throw new I_("fn",["Function","AsyncFunction"],r);e!=null&&tm(e,"options"),e?.signal!=null&&em(e.signal,"options.signal");let t=1;e?.concurrency!=null&&(t=D8(e.concurrency));let n=t-1;return e?.highWaterMark!=null&&(n=D8(e.highWaterMark)),R8(t,"options.concurrency",1),R8(n,"options.highWaterMark",0),n+=t,async function*(){const o=ws.AbortSignalAny([e?.signal].filter(Cfe)),s=this,a=[],l={signal:o};let d,c,u=!1,f=0;function h(){u=!0,p()}function p(){f-=1,y()}function y(){c&&!u&&f<t&&a.length<n&&(c(),c=null)}async function g(){try{for await(let w of s){if(u)return;if(o.aborted)throw new Ql;try{if(w=r(w,l),w===vA)continue;w=Mfe(w)}catch(v){w=B8(v)}f+=1,j8(w,p,h),a.push(w),d&&(d(),d=null),!u&&(a.length>=n||f>=t)&&await new M8(v=>{c=v})}a.push(N8)}catch(w){const v=B8(w);j8(v,p,h),a.push(v)}finally{u=!0,d&&(d(),d=null)}}g();try{for(;;){for(;a.length>0;){const w=await a[0];if(w===N8)return;if(o.aborted)throw new Ql;w!==vA&&(yield w),a.shift(),y()}await new M8(w=>{d=w})}}finally{u=!0,c&&(c(),c=null)}}.call(this)}function jfe(r=void 0){return r!=null&&tm(r,"options"),r?.signal!=null&&em(r.signal,"options.signal"),async function*(){let t=0;for await(const i of this){var n;if(r!=null&&(n=r.signal)!==null&&n!==void 0&&n.aborted)throw new Ql({cause:r.signal.reason});yield[t++,i]}}.call(this)}async function B9(r,e=void 0){for await(const t of AC.call(this,r,e))return!0;return!1}async function Nfe(r,e=void 0){if(typeof r!="function")throw new I_("fn",["Function","AsyncFunction"],r);return!await B9.call(this,async(...t)=>!await r(...t),e)}async function Ufe(r,e){for await(const t of AC.call(this,r,e))return t}async function Lfe(r,e){if(typeof r!="function")throw new I_("fn",["Function","AsyncFunction"],r);async function t(n,i){return await r(n,i),vA}for await(const n of lS.call(this,t,e));}function AC(r,e){if(typeof r!="function")throw new I_("fn",["Function","AsyncFunction"],r);async function t(n,i){return await r(n,i)?n:vA}return lS.call(this,t,e)}let Kfe=class extends _fe{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function zfe(r,e,t){var n;if(typeof r!="function")throw new I_("reducer",["Function","AsyncFunction"],r);t!=null&&tm(t,"options"),t?.signal!=null&&em(t.signal,"options.signal");let i=arguments.length>1;if(t!=null&&(n=t.signal)!==null&&n!==void 0&&n.aborted){const d=new Ql(void 0,{cause:t.signal.reason});throw this.once("error",()=>{}),await Sfe(this.destroy(d)),d}const o=new bfe,s=o.signal;if(t!=null&&t.signal){const d={once:!0,[Afe]:this,[xfe]:!0};t.signal.addEventListener("abort",()=>o.abort(),d)}let a=!1;try{for await(const d of this){var l;if(a=!0,t!=null&&(l=t.signal)!==null&&l!==void 0&&l.aborted)throw new Ql;i?e=await r(e,d,{signal:s}):(e=d,i=!0)}if(!a&&!i)throw new Kfe}finally{o.abort()}return e}async function Ffe(r){r!=null&&tm(r,"options"),r?.signal!=null&&em(r.signal,"options.signal");const e=[];for await(const n of this){var t;if(r!=null&&(t=r.signal)!==null&&t!==void 0&&t.aborted)throw new Ql(void 0,{cause:r.signal.reason});Ofe(e,n)}return e}function qfe(r,e){const t=lS.call(this,r,e);return async function*(){for await(const i of t)yield*i}.call(this)}function j9(r){if(r=Rfe(r),Dfe(r))return 0;if(r<0)throw new Efe("number",">= 0",r);return r}function Vfe(r,e=void 0){return e!=null&&tm(e,"options"),e?.signal!=null&&em(e.signal,"options.signal"),r=j9(r),async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new Ql;for await(const o of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new Ql;r--<=0&&(yield o)}}.call(this)}function Wfe(r,e=void 0){return e!=null&&tm(e,"options"),e?.signal!=null&&em(e.signal,"options.signal"),r=j9(r),async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new Ql;for await(const o of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new Ql;if(r-- >0&&(yield o),r<=0)return}}.call(this)}fC.streamReturningOperators={asIndexedPairs:Ife(jfe,"readable.asIndexedPairs will be removed in a future version."),drop:Vfe,filter:AC,flatMap:qfe,map:lS,take:Wfe,compose:Bfe};fC.promiseReturningOperators={every:Nfe,forEach:Lfe,reduce:zfe,toArray:Ffe,some:B9,find:Ufe};var d$,U8;function N9(){if(U8)return d$;U8=1;const{ArrayPrototypePop:r,Promise:e}=Mn,{isIterable:t,isNodeStream:n,isWebStream:i}=Hu,{pipelineImpl:o}=EC,{finished:s}=Lh;U9();function a(...l){return new e((d,c)=>{let u,f;const h=l[l.length-1];if(h&&typeof h=="object"&&!n(h)&&!t(h)&&!i(h)){const p=r(l);u=p.signal,f=p.end}o(l,(p,y)=>{p?c(p):d(y)},{signal:u,end:f})})}return d$={finished:s,pipeline:a},d$}var L8;function U9(){if(L8)return VT.exports;L8=1;const{Buffer:r}=Dn,{ObjectDefineProperty:e,ObjectKeys:t,ReflectApply:n}=Mn,{promisify:{custom:i}}=ws,{streamReturningOperators:o,promiseReturningOperators:s}=fC,{codes:{ERR_ILLEGAL_CONSTRUCTOR:a}}=Ns,l=D9,{setDefaultHighWaterMark:d,getDefaultHighWaterMark:c}=aS,{pipeline:u}=EC,{destroyer:f}=Cv,h=Lh,p=N9(),y=Hu,g=VT.exports=gC.Stream;g.isDestroyed=y.isDestroyed,g.isDisturbed=y.isDisturbed,g.isErrored=y.isErrored,g.isReadable=y.isReadable,g.isWritable=y.isWritable,g.Readable=cS();for(const v of t(o)){let b=function(..._){if(new.target)throw a();return g.Readable.from(n(m,this,_))};const m=o[v];e(b,"name",{__proto__:null,value:m.name}),e(b,"length",{__proto__:null,value:m.length}),e(g.Readable.prototype,v,{__proto__:null,value:b,enumerable:!1,configurable:!0,writable:!0})}for(const v of t(s)){let b=function(..._){if(new.target)throw a();return n(m,this,_)};const m=s[v];e(b,"name",{__proto__:null,value:m.name}),e(b,"length",{__proto__:null,value:m.length}),e(g.Readable.prototype,v,{__proto__:null,value:b,enumerable:!1,configurable:!0,writable:!0})}g.Writable=bC(),g.Duplex=$u(),g.Transform=I9,g.PassThrough=C9,g.pipeline=u;const{addAbortSignal:w}=sS;return g.addAbortSignal=w,g.finished=h,g.destroy=f,g.compose=l,g.setDefaultHighWaterMark=d,g.getDefaultHighWaterMark=c,e(g,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return p}}),e(u,i,{__proto__:null,enumerable:!0,get(){return p.pipeline}}),e(h,i,{__proto__:null,enumerable:!0,get(){return p.finished}}),g.Stream=g,g._isUint8Array=function(m){return m instanceof Uint8Array},g._uint8ArrayToBuffer=function(m){return r.from(m.buffer,m.byteOffset,m.byteLength)},VT.exports}(function(r){const e=U9(),t=N9(),n=e.Readable.destroy;r.exports=e.Readable,r.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,r.exports._isUint8Array=e._isUint8Array,r.exports.isDisturbed=e.isDisturbed,r.exports.isErrored=e.isErrored,r.exports.isReadable=e.isReadable,r.exports.Readable=e.Readable,r.exports.Writable=e.Writable,r.exports.Duplex=e.Duplex,r.exports.Transform=e.Transform,r.exports.PassThrough=e.PassThrough,r.exports.addAbortSignal=e.addAbortSignal,r.exports.finished=e.finished,r.exports.destroy=e.destroy,r.exports.destroy=n,r.exports.pipeline=e.pipeline,r.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return t}}),r.exports.Stream=e.Stream,r.exports.default=r.exports})(BF);var $w=BF.exports,j1=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};Ym.ECIES_CONFIG.isEphemeralKeyCompressed=!0;class kw{static aes256CtrEncrypt(e,t,n){return j1(this,void 0,void 0,function*(){const i=(void 0)("aes-256-ctr",e,t),o=new $w.Readable({read(){}});return n.on("data",s=>{const a=i.update(s);o.push(a)}),n.on("end",()=>{const s=i.final();o.push(s),o.push(null)}),n.on("error",s=>{o.emit("error",s)}),o})}static aes256CtrDecrypt(e,t,n){return j1(this,void 0,void 0,function*(){const i=(void 0)("aes-256-ctr",e,t),o=new $w.Readable({read(){}});return n.on("data",s=>{const a=i.update(s);o.push(a)}),n.on("end",()=>{const s=i.final();o.push(s),o.push(null)}),n.on("error",s=>{o.emit("error",s)}),o})}static eciesSecp256k1Encrypt(e,t){return j1(this,void 0,void 0,function*(){const n=Buffer.from(e),i=Buffer.from(t),o=Ym.encrypt(n,i);let s=0,a=kw.isEphemeralKeyCompressed?33:65;const l=o.subarray(s,a);s=a,a+=Ym.ECIES_CONFIG.symmetricNonceLength;const d=o.subarray(s,a);s=a,a+=16;const c=o.subarray(s,a);return{ciphertext:o.subarray(a),ephemeralPublicKey:l,initializationVector:d,messageAuthenticationCode:c}})}static eciesSecp256k1Decrypt(e){return j1(this,void 0,void 0,function*(){const t=Buffer.from(e.privateKey),n=Buffer.concat([e.ephemeralPublicKey,e.initializationVector,e.messageAuthenticationCode,e.ciphertext]);return Ym.decrypt(t,n)})}static get isEphemeralKeyCompressed(){return Ym.ECIES_CONFIG.isEphemeralKeyCompressed}}var bA;(function(r){r.Aes256Ctr="A256CTR",r.EciesSecp256k1="ECIES-ES256K"})(bA||(bA={}));var K8=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Pw{constructor(e){this.jws=e}static create(e,t=[]){return K8(this,void 0,void 0,function*(){const n={payload:vt.bytesToBase64Url(e),signatures:[]},i=new Pw(n);for(const o of t)yield i.addSignature(o);return i})}addSignature(e){return K8(this,void 0,void 0,function*(){const t={kid:e.keyId,alg:e.algorithm},n=JSON.stringify(t),i=vt.stringToBase64Url(n),o=`${i}.${this.jws.payload}`,s=vt.stringToBytes(o),a=yield e.sign(s),l=vt.bytesToBase64Url(a);this.jws.signatures.push({protected:i,signature:l})})}getJws(){return this.jws}}const N1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function vu(){if(N1&&typeof N1.subtle=="object"&&N1.subtle!=null)return N1.subtle;throw new Error("crypto.subtle must be defined")}function u$(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function z8(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function L9(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function Ul(r,...e){if(!L9(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function F8(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Hfe(r,e){Ul(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const fh=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Gfe=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Yfe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Yfe)throw new Error("Non little-endian hardware is not supported");function Zfe(r){if(typeof r!="string")throw new Error(`string expected, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function aI(r){if(typeof r=="string")r=Zfe(r);else if(L9(r))r=r.slice();else throw new Error(`Uint8Array expected, got ${typeof r}`);return r}function Jfe(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Xfe(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const Qfe=(r,e)=>(Object.assign(e,r),e);function q8(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),l=4,d=0;r.setUint32(e+l,s,n),r.setUint32(e+d,a,n)}var U1=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},aa;(function(r){r.DataFormats="dataFormats",r.ProtocolContext="protocolContext",r.ProtocolPath="protocolPath",r.Schemas="schemas"})(aa||(aa={}));class Zm{static derivePrivateKey(e,t){var n;return U1(this,void 0,void 0,function*(){const i=Lc.privateJwkToBytes(e.derivedPrivateKey),o=(n=e.derivationPath)!==null&&n!==void 0?n:[],s=yield Zm.derivePrivateKeyBytes(i,t),a=yield Lc.privateKeyToJwk(s);return{rootKeyId:e.rootKeyId,derivationScheme:e.derivationScheme,derivationPath:[...o,...t],derivedPrivateKey:a}})}static derivePublicKey(e,t){return U1(this,void 0,void 0,function*(){const n=yield Zm.derivePrivateKey(e,t);return yield Lc.getPublicJwk(n.derivedPrivateKey)})}static derivePrivateKeyBytes(e,t){return U1(this,void 0,void 0,function*(){Zm.validateKeyDerivationPath(t);let n=e;for(const i of t){const o=vt.stringToBytes(i);n=yield Zm.deriveKeyUsingHkdf({hashAlgorithm:"SHA-256",initialKeyMaterial:n,info:o,keyLengthInBytes:32})}return n})}static deriveKeyUsingHkdf(e){return U1(this,void 0,void 0,function*(){const{hashAlgorithm:t,initialKeyMaterial:n,info:i,keyLengthInBytes:o}=e,a=yield vu().importKey("raw",n,{name:"HKDF"},!1,["deriveBits"]),l=yield crypto.subtle.deriveBits({name:"HKDF",hash:t,salt:new Uint8Array(0),info:i},a,o*8);return new Uint8Array(l)})}static validateKeyDerivationPath(e){if(e.includes(""))throw new Ae(we.HdKeyDerivationPathInvalid,`Invalid key derivation path: ${e}`)}}function cI(r,e){return r>e?1:r<e?-1:0}function lI(r){if(typeof r!="object")return!1;for(const e in r)return!1;return!0}function Cs(r){Object.keys(r).forEach(e=>{r[e]===void 0?delete r[e]:typeof r[e]=="object"&&Cs(r[e])})}var dl=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Oe{static getAuthor(e){if(e.authorization===void 0)return;let t;return e.authorization.authorDelegatedGrant!==void 0?t=Oe.getSigner(e.authorization.authorDelegatedGrant):t=Oe.getSigner(e),t}static validateJsonSchema(e){const t=e.descriptor.interface,n=e.descriptor.method,i=t+n;ig(i,e)}static getSigner(e){return e.authorization===void 0?void 0:un.getSignerDid(e.authorization.signature.signatures[0])}static getCid(e){return dl(this,void 0,void 0,function*(){const t=Object.assign({},e);return t.encodedData&&delete t.encodedData,yield _i.computeCid(t)})}static compareCid(e,t){return dl(this,void 0,void 0,function*(){const n=yield Oe.getCid(e),i=yield Oe.getCid(t);return cI(n,i)})}static createAuthorization(e){return dl(this,void 0,void 0,function*(){const{descriptor:t,signer:n,delegatedGrant:i,permissionGrantId:o,protocolRole:s}=e;let a;i!==void 0&&(a=yield Oe.getCid(i));const d={signature:yield Oe.createSignature(t,n,{delegatedGrantId:a,permissionGrantId:o,protocolRole:s})};return i!==void 0&&(d.authorDelegatedGrant=i),d})}static createSignature(e,t,n){return dl(this,void 0,void 0,function*(){const i=yield _i.computeCid(e),o=Object.assign({descriptorCid:i},n);Cs(o);const s=vt.objectToBytes(o);return(yield Pw.create(s,[t])).getJws()})}static getNewestMessage(e){return dl(this,void 0,void 0,function*(){let t;for(const n of e)(t===void 0||(yield Oe.isNewer(n,t)))&&(t=n);return t})}static getOldestMessage(e){return dl(this,void 0,void 0,function*(){let t;for(const n of e)(t===void 0||(yield Oe.isOlder(n,t)))&&(t=n);return t})}static isNewer(e,t){return dl(this,void 0,void 0,function*(){return(yield Oe.compareMessageTimestamp(e,t))>0})}static isOlder(e,t){return dl(this,void 0,void 0,function*(){return(yield Oe.compareMessageTimestamp(e,t))<0})}static isSignedByAuthorDelegate(e){var t;return((t=e.authorization)===null||t===void 0?void 0:t.authorDelegatedGrant)!==void 0}static isSignedByOwnerDelegate(e){var t;return((t=e.authorization)===null||t===void 0?void 0:t.ownerDelegatedGrant)!==void 0}static compareMessageTimestamp(e,t){return dl(this,void 0,void 0,function*(){return e.descriptor.messageTimestamp>t.descriptor.messageTimestamp?1:e.descriptor.messageTimestamp<t.descriptor.messageTimestamp?-1:Oe.compareCid(e,t)})}static validateSignatureStructure(e,t,n="GenericSignaturePayload"){return dl(this,void 0,void 0,function*(){if(e.signatures.length!==1)throw new Ae(we.AuthenticationMoreThanOneSignatureNotSupported,"expected no more than 1 signature for authorization purpose");const i=un.decodePlainObjectPayload(e);ig(n,i);const{descriptorCid:o}=i,s=yield _i.computeCid(t);if(o!==s)throw new Ae(we.AuthenticateDescriptorCidMismatch,`provided descriptorCid ${o} does not match expected CID ${s}`);return i})}}var ehe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let Rs=class K9{static parse(e){return ehe(this,void 0,void 0,function*(){return new K9(e)})}constructor(e){this.id=e.recordId,this.grantor=Oe.getSigner(e),this.grantee=e.descriptor.recipient,this.dateGranted=e.descriptor.dateCreated;const t=e.encodedData,n=vt.base64UrlToObject(t);this.dateExpires=n.dateExpires,this.delegated=n.delegated,this.description=n.description,this.requestId=n.requestId,this.scope=n.scope,this.conditions=n.conditions}};var Os;(function(r){r.CreatedAscending="createdAscending",r.CreatedDescending="createdDescending",r.PublishedAscending="publishedAscending",r.PublishedDescending="publishedDescending"})(Os||(Os={}));var the=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Wo{static matchAnyFilter(e,t){if(t.length===0)return!0;for(const n of t)if(this.matchFilter(e,n))return!0;return!1}static matchFilter(e,t){for(const n in t){const i=t[n],o=e[n];if(o===void 0||!(Array.isArray(o)?this.matchAnyIndexValue(i,o):this.matchIndexValue(i,o)))return!1}return!0}static matchAnyIndexValue(e,t){for(const n of t)if(this.matchIndexValue(e,n))return!0;return!1}static matchIndexValue(e,t){if(typeof e=="object"){if(Array.isArray(e)){if(this.matchOneOf(e,t))return!0}else if(this.matchRange(e,t))return!0}else if(t===e)return!0;return!1}static matchOneOf(e,t){for(const n of e)if(t===n)return!0;return!1}static matchRange(e,t){return!(e.lt!==void 0&&t>=e.lt||e.lte!==void 0&&t>e.lte||e.gt!==void 0&&t<=e.gt||e.gte!==void 0&&t<e.gte)}static isEqualFilter(e){return typeof e!="object"}static isRangeFilter(e){return typeof e=="object"&&!Array.isArray(e)?"gt"in e||"lt"in e||"lte"in e||"gte"in e:!1}static isOneOfFilter(e){return!!(typeof e=="object"&&Array.isArray(e))}static convertRangeCriterion(e){let t;return e.to!==void 0&&e.from!==void 0?t={gte:e.from,lt:e.to}:e.to!==void 0?t={lt:e.to}:e.from!==void 0&&(t={gte:e.from}),t}static constructPrefixFilterAsRangeFilter(e){return{gte:e,lt:e+""}}}class rhe{static reduceFilter(e){if(Object.keys(e).length<=1)return e;const{recordId:n,attester:i,parentId:o,recipient:s,contextId:a,author:l,protocolPath:d,schema:c,protocol:u}=e,f=the(e,["recordId","attester","parentId","recipient","contextId","author","protocolPath","schema","protocol"]);if(n!==void 0)return{recordId:n};if(i!==void 0)return{attester:i};if(o!==void 0)return{parentId:o};if(s!==void 0)return{recipient:s};if(a!==void 0)return{contextId:a};if(d!==void 0)return{protocolPath:d};if(c!==void 0)return{schema:c};if(u!==void 0)return{protocol:u};const p=Object.keys(f)[0],y={};return y[p]=e[p],y}}var Ge;(function(r){r.Messages="Messages",r.Protocols="Protocols",r.Records="Records"})(Ge||(Ge={}));var Le;(function(r){r.Configure="Configure",r.Query="Query",r.Read="Read",r.Write="Write",r.Delete="Delete",r.Subscribe="Subscribe"})(Le||(Le={}));function Kh(r){let e;try{e=Ph(r)}catch{e=void 0}if(r!==e)throw new Ae(we.UrlProtocolNotNormalized,`Protocol URI ${r} must be normalized.`)}function Ph(r){return z9(r)}function dS(r){let e;try{e=uS(r)}catch{e=void 0}if(r!==e)throw new Ae(we.UrlSchemaNotNormalized,`Schema URI ${r} must be normalized.`)}function uS(r){return z9(r)}function z9(r){let e;/^[^:]+:(\/{2})?[^\/].*/.test(r)?e=r:e=`http://${r}`;try{const t=new URL(e);return t.search="",t.hash="",nhe(t.href)}catch{throw new Ae(we.UrlProtocolNotNormalizable,"Could not normalize protocol URI")}}function nhe(r){return r.endsWith("/")?r.slice(0,-1):r}var f$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},ihe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class _t{static isRecordsWrite(e){return e.descriptor.interface===Ge.Records&&e.descriptor.method===Le.Write}static decrypt(e,t,n){return f$(this,void 0,void 0,function*(){const{encryption:i}=e,o=i.keyEncryption.find(y=>y.rootKeyId===t.rootKeyId&&y.derivationScheme===t.derivationScheme);if(o===void 0)throw new Ae(we.RecordsDecryptNoMatchingKeyEncryptedFound,`Unable to find a symmetric key encrypted using key         with ID '${t.rootKeyId}' and '${t.derivationScheme}' derivation scheme.`);const s=_t.constructKeyDerivationPath(o.derivationScheme,e),a=yield _t.derivePrivateKey(t,s),l=vt.base64UrlToBytes(o.encryptedKey),d=Lc.publicJwkToBytes(o.ephemeralPublicKey),c=vt.base64UrlToBytes(o.initializationVector),u=vt.base64UrlToBytes(o.messageAuthenticationCode),f=yield kw.eciesSecp256k1Decrypt({ciphertext:l,ephemeralPublicKey:d,initializationVector:c,messageAuthenticationCode:u,privateKey:a}),h=vt.base64UrlToBytes(i.initializationVector);return yield kw.aes256CtrDecrypt(f,h,n)})}static constructKeyDerivationPath(e,t){const n=t.descriptor,i=t.contextId;let o;return e===aa.DataFormats?o=_t.constructKeyDerivationPathUsingDataFormatsScheme(n.schema,n.dataFormat):e===aa.ProtocolPath?o=_t.constructKeyDerivationPathUsingProtocolPathScheme(n):e===aa.ProtocolContext?o=_t.constructKeyDerivationPathUsingProtocolContextScheme(i):o=_t.constructKeyDerivationPathUsingSchemasScheme(n.schema),o}static constructKeyDerivationPathUsingDataFormatsScheme(e,t){return e!==void 0?[aa.DataFormats,e,t]:[aa.DataFormats,t]}static constructKeyDerivationPathUsingProtocolPathScheme(e){if(e.protocol===void 0)throw new Ae(we.RecordsProtocolPathDerivationSchemeMissingProtocol,"Unable to construct key derivation path using `protocols` scheme because `protocol` is missing.");const t=e.protocolPath.split("/");return[aa.ProtocolPath,e.protocol,...t]}static constructKeyDerivationPathUsingProtocolContextScheme(e){if(e===void 0)throw new Ae(we.RecordsProtocolContextDerivationSchemeMissingContextId,"Unable to construct key derivation path using `protocolContext` scheme because `contextId` is missing.");const t=e.split("/")[0];return[aa.ProtocolContext,t]}static constructKeyDerivationPathUsingSchemasScheme(e){if(e===void 0)throw new Ae(we.RecordsSchemasDerivationSchemeMissingSchema,"Unable to construct key derivation path using `schemas` scheme because `schema` is missing.");return[aa.Schemas,e]}static derivePrivateKey(e,t){var n;return f$(this,void 0,void 0,function*(){if(e.derivedPrivateKey.crv!=="secp256k1")throw new Ae(we.RecordsDerivePrivateKeyUnSupportedCurve,`Curve ${e.derivedPrivateKey.crv} is not supported.`);const i=(n=e.derivationPath)!==null&&n!==void 0?n:[];_t.validateAncestorKeyAndDescentKeyDerivationPathsMatch(i,t);const o=t.slice(i.length),s=Lc.privateJwkToBytes(e.derivedPrivateKey);return yield Zm.derivePrivateKeyBytes(s,o)})}static validateAncestorKeyAndDescentKeyDerivationPathsMatch(e,t){for(let n=0;n<e.length;n++){const i=e[n],o=t[n];if(i!==o)throw new Ae(we.RecordsInvalidAncestorKeyDerivationSegment,`Ancestor key derivation segment '${i}' mismatches against the descendant key derivation segment '${o}'.`)}}static getParentContextFromOfContextId(e){if(e===void 0)return;const t=e.lastIndexOf("/");return t===-1?"":e.substring(0,t)}static normalizeFilter(e){let t;e.protocol===void 0?t=void 0:t=Ph(e.protocol);let n;e.schema===void 0?n=void 0:n=uS(e.schema);const i=Object.assign(Object.assign({},e),{protocol:t,schema:n});return Cs(i),i}static isStartsWithFilter(e){return typeof e=="object"&&"startsWith"in e&&typeof e.startsWith=="string"}static buildTagIndexes(e){const t={};for(const n in e){const i=e[n];t[`tag.${n}`]=i}return t}static convertTagsFilter(e){const t={};for(const n in e){const i=e[n];t[`tag.${n}`]=this.isStartsWithFilter(i)?Wo.constructPrefixFilterAsRangeFilter(i.startsWith):i}return t}static convertFilter(e,t){const{tags:n}=e,i=ihe(e,["tags"]);let o={};n!==void 0&&(o=Object.assign({},this.convertTagsFilter(n)));const s=Object.assign(Object.assign({},i),o),{dateCreated:a,datePublished:l,dateUpdated:d,contextId:c}=e,u=a?Wo.convertRangeCriterion(a):void 0;u&&(s.dateCreated=u);const f=l?Wo.convertRangeCriterion(l):void 0;f&&(s.published=!0,s.datePublished=f),s.published!==!0&&(t===Os.PublishedAscending||t===Os.PublishedDescending)&&(s.published=!0);const h=d?Wo.convertRangeCriterion(d):void 0;h&&(s.messageTimestamp=h,delete s.dateUpdated);const p=c?Wo.constructPrefixFilterAsRangeFilter(c):void 0;return p&&(s.contextId=p),Array.isArray(s.author)&&s.author.length===0&&delete s.author,Array.isArray(s.recipient)&&s.recipient.length===0&&delete s.recipient,s}static validateDelegatedGrantReferentialIntegrity(e,t,n){var i,o;return f$(this,void 0,void 0,function*(){const s=t?.delegatedGrantId!==void 0,a=((i=e.authorization)===null||i===void 0?void 0:i.authorDelegatedGrant)!==void 0;if(s!==a)throw new Ae(we.RecordsAuthorDelegatedGrantAndIdExistenceMismatch,`delegatedGrantId in message (author) signature and authorDelegatedGrant must both exist or be undefined.          delegatedGrantId in message (author) signature defined: ${s},          authorDelegatedGrant defined: ${a}`);if(a){const c=e.authorization.authorDelegatedGrant;if((yield Rs.parse(c)).delegated!==!0)throw new Ae(we.RecordsAuthorDelegatedGrantNotADelegatedGrant,"The owner delegated grant given is not a delegated grant.");const f=c.descriptor.recipient,h=Oe.getSigner(e);if(f!==h)throw new Ae(we.RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch,`grantedTo ${f} in author delegated grant must be the same as the signer ${h} of the message signature.`);const p=yield Oe.getCid(c);if(p!==t.delegatedGrantId)throw new Ae(we.RecordsAuthorDelegatedGrantCidMismatch,`CID of the author delegated grant ${p} must be the same as           the delegatedGrantId ${t.delegatedGrantId} in the message signature.`)}const l=n?.delegatedGrantId!==void 0,d=((o=e.authorization)===null||o===void 0?void 0:o.ownerDelegatedGrant)!==void 0;if(l!==d)throw new Ae(we.RecordsOwnerDelegatedGrantAndIdExistenceMismatch,`delegatedGrantId in owner signature and ownerDelegatedGrant must both exist or be undefined.          delegatedGrantId in owner signature defined: ${l},          ownerDelegatedGrant defined: ${d}`);if(d){const c=e.authorization.ownerDelegatedGrant;if((yield Rs.parse(c)).delegated!==!0)throw new Ae(we.RecordsOwnerDelegatedGrantNotADelegatedGrant,"The owner delegated grant given is not a delegated grant.");const f=c.descriptor.recipient,h=un.getSignerDid(e.authorization.ownerSignature.signatures[0]);if(f!==h)throw new Ae(we.RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch,`grantedTo ${f} in owner delegated grant must be the same as the signer ${h} of the owner signature.`);const p=yield Oe.getCid(c);if(p!==n.delegatedGrantId)throw new Ae(we.RecordsOwnerDelegatedGrantCidMismatch,`CID of the owner delegated grant ${p} must be the same as           the delegatedGrantId ${n.delegatedGrantId} in the owner signature.`)}})}static shouldProtocolAuthorize(e){return e.protocolRole!==void 0}static filterIncludesPublishedRecords(e){return e.datePublished!==void 0||e.published!==!1}static filterIncludesUnpublishedRecords(e){return e.datePublished===void 0&&e.published===void 0?!0:e.published===!1}static canPerformDeleteAgainstRecord(e,t){if(t===void 0)return!1;if(t.descriptor.method===Le.Delete){if(e.descriptor.prune!==!0)return!1;if(t.descriptor.prune===!0)return!1}return!0}static shouldBuildUnpublishedRecipientFilter(e,t){const{recipient:n}=e;return Array.isArray(n)?n.length===0||n.includes(t):n===void 0||n===t}static shouldBuildUnpublishedAuthorFilter(e,t){const{author:n}=e;return Array.isArray(n)?n.length===0||n.includes(t):n===void 0||n===t}}var h$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class oc{static performBaseValidation(e){return h$(this,void 0,void 0,function*(){const{incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}=e,a=t.descriptor;oc.verifyExpectedGrantorAndGrantee(n,i,o);const l=n;yield oc.verifyGrantActive(l,a.messageTimestamp,o,s),yield oc.verifyGrantScopeInterfaceAndMethod(a.interface,a.method,o)})}static verifyExpectedGrantorAndGrantee(e,t,n){const i=n.grantee;if(t!==i)throw new Ae(we.GrantAuthorizationNotGrantedToAuthor,`Permission grant is granted to ${i}, but need to be granted to ${t}`);const o=n.grantor;if(e!==o)throw new Ae(we.GrantAuthorizationNotGrantedForTenant,`Permission grant is granted by ${o}, but need to be granted by ${e}`)}static verifyGrantActive(e,t,n,i){return h$(this,void 0,void 0,function*(){if(t<n.dateGranted)throw new Ae(we.GrantAuthorizationGrantNotYetActive,"The message has a timestamp before the associated permission grant becomes active");if(t>=n.dateExpires)throw new Ae(we.GrantAuthorizationGrantExpired,"The message has timestamp after the expiry of the associated permission grant");const o={parentId:n.id,protocolPath:"grant/revocation",isLatestBaseState:!0},{messages:s}=yield i.query(e,[o]),a=yield Oe.getOldestMessage(s);if(a!==void 0&&a.descriptor.messageTimestamp<=t)throw new Ae(we.GrantAuthorizationGrantRevoked,`Permission grant with CID ${n.id} has been revoked`)})}static verifyGrantScopeInterfaceAndMethod(e,t,n){return h$(this,void 0,void 0,function*(){if(e!==n.scope.interface)throw new Ae(we.GrantAuthorizationInterfaceMismatch,`DWN Interface of incoming message is outside the scope of permission grant with ID ${n.id}`);if(t!==n.scope.method)throw new Ae(we.GrantAuthorizationMethodMismatch,`DWN Method of incoming message is outside the scope of permission grant with ID ${n.id}`)})}}var wA;(function(r){r.Required="Required",r.Prohibited="Prohibited"})(wA||(wA={}));var L1=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class sc{static authorizeWrite(e){return L1(this,void 0,void 0,function*(){const{recordsWriteMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}=e;yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}),sc.verifyScope(t,o.scope),sc.verifyConditions(t,o.conditions)})}static authorizeRead(e){return L1(this,void 0,void 0,function*(){const{recordsReadMessage:t,recordsWriteMessageToBeRead:n,expectedGrantor:i,expectedGrantee:o,permissionGrant:s,messageStore:a}=e;yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:i,expectedGrantee:o,permissionGrant:s,messageStore:a}),sc.verifyScope(n,s.scope)})}static authorizeQueryOrSubscribe(e){return L1(this,void 0,void 0,function*(){const{incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}=e;yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s});const l=o.scope.protocol,d=t.descriptor.filter.protocol;if(l!==void 0&&d!==l)throw new Ae(we.RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch,`Grant protocol scope ${l} does not match protocol in message ${d}`)})}static authorizeDelete(e){return L1(this,void 0,void 0,function*(){const{recordsDeleteMessage:t,recordsWriteToDelete:n,expectedGrantor:i,expectedGrantee:o,permissionGrant:s,messageStore:a}=e;yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:i,expectedGrantee:o,permissionGrant:s,messageStore:a});const d=s.scope.protocol,c=n.descriptor.protocol;if(d!==void 0&&c!==d)throw new Ae(we.RecordsGrantAuthorizationDeleteProtocolScopeMismatch,`Grant protocol scope ${d} does not match protocol in record to delete ${c}`)})}static verifyScope(e,t){if(t.protocol!==e.descriptor.protocol)throw new Ae(we.RecordsGrantAuthorizationScopeProtocolMismatch,"Grant scope specifies different protocol than what appears in the record");if(t.contextId!==void 0&&(e.contextId===void 0||!e.contextId.startsWith(t.contextId)))throw new Ae(we.RecordsGrantAuthorizationScopeContextIdMismatch,"Grant scope specifies different contextId than what appears in the record");if(t.protocolPath!==void 0&&t.protocolPath!==e.descriptor.protocolPath)throw new Ae(we.RecordsGrantAuthorizationScopeProtocolPathMismatch,"Grant scope specifies different protocolPath than what appears in the record")}static verifyConditions(e,t){if(t?.publication===wA.Required&&!e.descriptor.published)throw new Ae(we.RecordsGrantAuthorizationConditionPublicationRequired,"Permission grant requires message to be published");if(t?.publication===wA.Prohibited&&e.descriptor.published)throw new Ae(we.RecordsGrantAuthorizationConditionPublicationProhibited,"Permission grant prohibits message from being published")}}class x extends Array{constructor(e,t){if(super(e),this.sign=t,Object.setPrototypeOf(this,x.prototype),e>x.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded")}static BigInt(e){var t=Math.floor,n=Number.isFinite;if(typeof e=="number"){if(e===0)return x.__zero();if(x.__isOneDigitInt(e))return 0>e?x.__oneDigit(-e,!0):x.__oneDigit(e,!1);if(!n(e)||t(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return x.__fromDouble(e)}if(typeof e=="string"){const i=x.__fromString(e);if(i===null)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return i}if(typeof e=="boolean")return e===!0?x.__oneDigit(1,!1):x.__zero();if(typeof e=="object"){if(e.constructor===x)return e;const i=x.__toPrimitive(e);return x.BigInt(i)}throw new TypeError("Cannot convert "+e+" to a BigInt")}toDebugString(){const e=["BigInt["];for(const t of this)e.push((t&&(t>>>0).toString(16))+", ");return e.push("]"),e.join("")}toString(e=10){if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return this.length===0?"0":e&e-1?x.__toStringGeneric(this,e,!1):x.__toStringBasePowerOfTwo(this,e)}valueOf(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}static toNumber(e){const t=e.length;if(t===0)return 0;if(t===1){const g=e.__unsignedDigit(0);return e.sign?-g:g}const n=e.__digit(t-1),i=x.__clz30(n),o=30*t-i;if(1024<o)return e.sign?-1/0:1/0;let s=o-1,a=n,l=t-1;const d=i+3;let c=d===32?0:a<<d;c>>>=12;const u=d-12;let f=12<=d?0:a<<20+d,h=20+d;for(0<u&&0<l&&(l--,a=e.__digit(l),c|=a>>>30-u,f=a<<u+2,h=u+2);0<h&&0<l;)l--,a=e.__digit(l),f|=30<=h?a<<h-30:a>>>30-h,h-=30;const p=x.__decideRounding(e,h,l,a);if((p===1||p===0&&(1&f)==1)&&(f=f+1>>>0,f===0&&(c++,c>>>20!=0&&(c=0,s++,1023<s))))return e.sign?-1/0:1/0;const y=e.sign?-2147483648:0;return s=s+1023<<20,x.__kBitConversionInts[1]=y|s|c,x.__kBitConversionInts[0]=f,x.__kBitConversionDouble[0]}static unaryMinus(e){if(e.length===0)return e;const t=e.__copy();return t.sign=!e.sign,t}static bitwiseNot(e){return e.sign?x.__absoluteSubOne(e).__trim():x.__absoluteAddOne(e,!0)}static exponentiate(e,t){if(t.sign)throw new RangeError("Exponent must be positive");if(t.length===0)return x.__oneDigit(1,!1);if(e.length===0)return e;if(e.length===1&&e.__digit(0)===1)return e.sign&&!(1&t.__digit(0))?x.unaryMinus(e):e;if(1<t.length)throw new RangeError("BigInt too big");let n=t.__unsignedDigit(0);if(n===1)return e;if(n>=x.__kMaxLengthBits)throw new RangeError("BigInt too big");if(e.length===1&&e.__digit(0)===2){const s=1+(0|n/30),a=e.sign&&(1&n)!=0,l=new x(s,a);l.__initializeDigits();const d=1<<n%30;return l.__setDigit(s-1,d),l}let i=null,o=e;for(1&n&&(i=e),n>>=1;n!==0;n>>=1)o=x.multiply(o,o),1&n&&(i===null?i=o:i=x.multiply(i,o));return i}static multiply(e,t){if(e.length===0)return e;if(t.length===0)return t;let n=e.length+t.length;30<=e.__clzmsd()+t.__clzmsd()&&n--;const i=new x(n,e.sign!==t.sign);i.__initializeDigits();for(let o=0;o<e.length;o++)x.__multiplyAccumulate(t,e.__digit(o),i,o);return i.__trim()}static divide(e,t){if(t.length===0)throw new RangeError("Division by zero");if(0>x.__absoluteCompare(e,t))return x.__zero();const n=e.sign!==t.sign,i=t.__unsignedDigit(0);let o;if(t.length===1&&32767>=i){if(i===1)return n===e.sign?e:x.unaryMinus(e);o=x.__absoluteDivSmall(e,i,null)}else o=x.__absoluteDivLarge(e,t,!0,!1);return o.sign=n,o.__trim()}static remainder(e,t){if(t.length===0)throw new RangeError("Division by zero");if(0>x.__absoluteCompare(e,t))return e;const n=t.__unsignedDigit(0);if(t.length===1&&32767>=n){if(n===1)return x.__zero();const o=x.__absoluteModSmall(e,n);return o===0?x.__zero():x.__oneDigit(o,e.sign)}const i=x.__absoluteDivLarge(e,t,!1,!0);return i.sign=e.sign,i.__trim()}static add(e,t){const n=e.sign;return n===t.sign?x.__absoluteAdd(e,t,n):0<=x.__absoluteCompare(e,t)?x.__absoluteSub(e,t,n):x.__absoluteSub(t,e,!n)}static subtract(e,t){const n=e.sign;return n===t.sign?0<=x.__absoluteCompare(e,t)?x.__absoluteSub(e,t,n):x.__absoluteSub(t,e,!n):x.__absoluteAdd(e,t,n)}static leftShift(e,t){return t.length===0||e.length===0?e:t.sign?x.__rightShiftByAbsolute(e,t):x.__leftShiftByAbsolute(e,t)}static signedRightShift(e,t){return t.length===0||e.length===0?e:t.sign?x.__leftShiftByAbsolute(e,t):x.__rightShiftByAbsolute(e,t)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(e,t){return 0>x.__compareToBigInt(e,t)}static lessThanOrEqual(e,t){return 0>=x.__compareToBigInt(e,t)}static greaterThan(e,t){return 0<x.__compareToBigInt(e,t)}static greaterThanOrEqual(e,t){return 0<=x.__compareToBigInt(e,t)}static equal(e,t){if(e.sign!==t.sign||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e.__digit(n)!==t.__digit(n))return!1;return!0}static notEqual(e,t){return!x.equal(e,t)}static bitwiseAnd(e,t){var n=Math.max;if(!e.sign&&!t.sign)return x.__absoluteAnd(e,t).__trim();if(e.sign&&t.sign){const i=n(e.length,t.length)+1;let o=x.__absoluteSubOne(e,i);const s=x.__absoluteSubOne(t);return o=x.__absoluteOr(o,s,o),x.__absoluteAddOne(o,!0,o).__trim()}return e.sign&&([e,t]=[t,e]),x.__absoluteAndNot(e,x.__absoluteSubOne(t)).__trim()}static bitwiseXor(e,t){var n=Math.max;if(!e.sign&&!t.sign)return x.__absoluteXor(e,t).__trim();if(e.sign&&t.sign){const s=n(e.length,t.length),a=x.__absoluteSubOne(e,s),l=x.__absoluteSubOne(t);return x.__absoluteXor(a,l,a).__trim()}const i=n(e.length,t.length)+1;e.sign&&([e,t]=[t,e]);let o=x.__absoluteSubOne(t,i);return o=x.__absoluteXor(o,e,o),x.__absoluteAddOne(o,!0,o).__trim()}static bitwiseOr(e,t){var n=Math.max;const i=n(e.length,t.length);if(!e.sign&&!t.sign)return x.__absoluteOr(e,t).__trim();if(e.sign&&t.sign){let s=x.__absoluteSubOne(e,i);const a=x.__absoluteSubOne(t);return s=x.__absoluteAnd(s,a,s),x.__absoluteAddOne(s,!0,s).__trim()}e.sign&&([e,t]=[t,e]);let o=x.__absoluteSubOne(t,i);return o=x.__absoluteAndNot(o,e,o),x.__absoluteAddOne(o,!0,o).__trim()}static asIntN(e,t){var n=Math.floor;if(t.length===0)return t;if(e=n(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return x.__zero();if(e>=x.__kMaxLengthBits)return t;const i=0|(e+29)/30;if(t.length<i)return t;const o=t.__unsignedDigit(i-1),s=1<<(e-1)%30;if(t.length===i&&o<s)return t;if((o&s)!==s)return x.__truncateToNBits(e,t);if(!t.sign)return x.__truncateAndSubFromPowerOfTwo(e,t,!0);if(!(o&s-1)){for(let a=i-2;0<=a;a--)if(t.__digit(a)!==0)return x.__truncateAndSubFromPowerOfTwo(e,t,!1);return t.length===i&&o===s?t:x.__truncateToNBits(e,t)}return x.__truncateAndSubFromPowerOfTwo(e,t,!1)}static asUintN(e,t){var n=Math.floor;if(t.length===0)return t;if(e=n(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return x.__zero();if(t.sign){if(e>x.__kMaxLengthBits)throw new RangeError("BigInt too big");return x.__truncateAndSubFromPowerOfTwo(e,t,!1)}if(e>=x.__kMaxLengthBits)return t;const i=0|(e+29)/30;if(t.length<i)return t;const o=e%30;return t.length==i&&(o===0||!(t.__digit(i-1)>>>o))?t:x.__truncateToNBits(e,t)}static ADD(e,t){if(e=x.__toPrimitive(e),t=x.__toPrimitive(t),typeof e=="string")return typeof t!="string"&&(t=t.toString()),e+t;if(typeof t=="string")return e.toString()+t;if(e=x.__toNumeric(e),t=x.__toNumeric(t),x.__isBigInt(e)&&x.__isBigInt(t))return x.add(e,t);if(typeof e=="number"&&typeof t=="number")return e+t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(e,t){return x.__compare(e,t,0)}static LE(e,t){return x.__compare(e,t,1)}static GT(e,t){return x.__compare(e,t,2)}static GE(e,t){return x.__compare(e,t,3)}static EQ(e,t){for(;;){if(x.__isBigInt(e))return x.__isBigInt(t)?x.equal(e,t):x.EQ(t,e);if(typeof e=="number"){if(x.__isBigInt(t))return x.__equalToNumber(t,e);if(typeof t!="object")return e==t;t=x.__toPrimitive(t)}else if(typeof e=="string"){if(x.__isBigInt(t))return e=x.__fromString(e),e!==null&&x.equal(e,t);if(typeof t!="object")return e==t;t=x.__toPrimitive(t)}else if(typeof e=="boolean"){if(x.__isBigInt(t))return x.__equalToNumber(t,+e);if(typeof t!="object")return e==t;t=x.__toPrimitive(t)}else if(typeof e=="symbol"){if(x.__isBigInt(t))return!1;if(typeof t!="object")return e==t;t=x.__toPrimitive(t)}else if(typeof e=="object"){if(typeof t=="object"&&t.constructor!==x)return e==t;e=x.__toPrimitive(e)}else return e==t}}static NE(e,t){return!x.EQ(e,t)}static DataViewGetBigInt64(e,t,n=!1){return x.asIntN(64,x.DataViewGetBigUint64(e,t,n))}static DataViewGetBigUint64(e,t,n=!1){const[i,o]=n?[4,0]:[0,4],s=e.getUint32(t+i,n),a=e.getUint32(t+o,n),l=new x(3,!1);return l.__setDigit(0,1073741823&a),l.__setDigit(1,(268435455&s)<<2|a>>>30),l.__setDigit(2,s>>>28),l.__trim()}static DataViewSetBigInt64(e,t,n,i=!1){x.DataViewSetBigUint64(e,t,n,i)}static DataViewSetBigUint64(e,t,n,i=!1){n=x.asUintN(64,n);let o=0,s=0;if(0<n.length&&(s=n.__digit(0),1<n.length)){const d=n.__digit(1);s|=d<<30,o=d>>>2,2<n.length&&(o|=n.__digit(2)<<28)}const[a,l]=i?[4,0]:[0,4];e.setUint32(t+a,o,i),e.setUint32(t+l,s,i)}static __zero(){return new x(0,!1)}static __oneDigit(e,t){const n=new x(1,t);return n.__setDigit(0,e),n}__copy(){const e=new x(this.length,this.sign);for(let t=0;t<this.length;t++)e[t]=this[t];return e}__trim(){let e=this.length,t=this[e-1];for(;t===0;)e--,t=this[e-1],this.pop();return e===0&&(this.sign=!1),this}__initializeDigits(){for(let e=0;e<this.length;e++)this[e]=0}static __decideRounding(e,t,n,i){if(0<t)return-1;let o;if(0>t)o=-t-1;else{if(n===0)return-1;n--,i=e.__digit(n),o=29}let s=1<<o;if(!(i&s))return-1;if(s-=1,(i&s)!=0)return 1;for(;0<n;)if(n--,e.__digit(n)!==0)return 1;return 0}static __fromDouble(e){x.__kBitConversionDouble[0]=e;const t=2047&x.__kBitConversionInts[1]>>>20,n=t-1023,i=(0|n/30)+1,o=new x(i,0>e);let s=1048575&x.__kBitConversionInts[1]|1048576,a=x.__kBitConversionInts[0];const l=20,d=n%30;let c,u=0;if(d<20){const f=l-d;u=f+32,c=s>>>f,s=s<<32-f|a>>>f,a<<=32-f}else if(d===20)u=32,c=s,s=a,a=0;else{const f=d-l;u=32-f,c=s<<f|a>>>32-f,s=a<<f,a=0}o.__setDigit(i-1,c);for(let f=i-2;0<=f;f--)0<u?(u-=30,c=s>>>2,s=s<<30|a>>>2,a<<=30):c=0,o.__setDigit(f,c);return o.__trim()}static __isWhitespace(e){return 13>=e&&9<=e||(159>=e?e==32:131071>=e?e==160||e==5760:196607>=e?(e&=131071,10>=e||e==40||e==41||e==47||e==95||e==4096):e==65279)}static __fromString(e,t=0){let n=0;const i=e.length;let o=0;if(o===i)return x.__zero();let s=e.charCodeAt(o);for(;x.__isWhitespace(s);){if(++o===i)return x.__zero();s=e.charCodeAt(o)}if(s===43){if(++o===i)return null;s=e.charCodeAt(o),n=1}else if(s===45){if(++o===i)return null;s=e.charCodeAt(o),n=-1}if(t===0){if(t=10,s===48){if(++o===i)return x.__zero();if(s=e.charCodeAt(o),s===88||s===120){if(t=16,++o===i)return null;s=e.charCodeAt(o)}else if(s===79||s===111){if(t=8,++o===i)return null;s=e.charCodeAt(o)}else if(s===66||s===98){if(t=2,++o===i)return null;s=e.charCodeAt(o)}}}else if(t===16&&s===48){if(++o===i)return x.__zero();if(s=e.charCodeAt(o),s===88||s===120){if(++o===i)return null;s=e.charCodeAt(o)}}if(n!=0&&t!==10)return null;for(;s===48;){if(++o===i)return x.__zero();s=e.charCodeAt(o)}const a=i-o;let l=x.__kMaxBitsPerChar[t],d=x.__kBitsPerCharTableMultiplier-1;if(a>1073741824/l)return null;const c=l*a+d>>>x.__kBitsPerCharTableShift,u=new x(0|(c+29)/30,!1),f=10>t?t:10,h=10<t?t-10:0;if(t&t-1){u.__initializeDigits();let p=!1,y=0;do{let g=0,w=1;for(;;){let m;if(s-48>>>0<f)m=s-48;else if((32|s)-97>>>0<h)m=(32|s)-87;else{p=!0;break}const b=w*t;if(1073741823<b)break;if(w=b,g=g*t+m,y++,++o===i){p=!0;break}s=e.charCodeAt(o)}d=30*x.__kBitsPerCharTableMultiplier-1;const v=0|(l*y+d>>>x.__kBitsPerCharTableShift)/30;u.__inplaceMultiplyAdd(w,g,v)}while(!p)}else{l>>=x.__kBitsPerCharTableShift;const p=[],y=[];let g=!1;do{let w=0,v=0;for(;;){let m;if(s-48>>>0<f)m=s-48;else if((32|s)-97>>>0<h)m=(32|s)-87;else{g=!0;break}if(v+=l,w=w<<l|m,++o===i){g=!0;break}if(s=e.charCodeAt(o),30<v+l)break}p.push(w),y.push(v)}while(!g);x.__fillFromParts(u,p,y)}if(o!==i){if(!x.__isWhitespace(s))return null;for(o++;o<i;o++)if(s=e.charCodeAt(o),!x.__isWhitespace(s))return null}return u.sign=n==-1,u.__trim()}static __fillFromParts(e,t,n){let i=0,o=0,s=0;for(let a=t.length-1;0<=a;a--){const l=t[a],d=n[a];o|=l<<s,s+=d,s===30?(e.__setDigit(i++,o),s=0,o=0):30<s&&(e.__setDigit(i++,1073741823&o),s-=30,o=l>>>d-s)}if(o!==0){if(i>=e.length)throw new Error("implementation bug");e.__setDigit(i++,o)}for(;i<e.length;i++)e.__setDigit(i,0)}static __toStringBasePowerOfTwo(e,t){const n=e.length;let i=t-1;i=(85&i>>>1)+(85&i),i=(51&i>>>2)+(51&i),i=(15&i>>>4)+(15&i);const o=i,s=t-1,a=e.__digit(n-1),l=x.__clz30(a);let d=0|(30*n-l+o-1)/o;if(e.sign&&d++,268435456<d)throw new Error("string too long");const c=Array(d);let u=d-1,f=0,h=0;for(let y=0;y<n-1;y++){const g=e.__digit(y),w=(f|g<<h)&s;c[u--]=x.__kConversionChars[w];const v=o-h;for(f=g>>>v,h=30-v;h>=o;)c[u--]=x.__kConversionChars[f&s],f>>>=o,h-=o}const p=(f|a<<h)&s;for(c[u--]=x.__kConversionChars[p],f=a>>>o-h;f!==0;)c[u--]=x.__kConversionChars[f&s],f>>>=o;if(e.sign&&(c[u--]="-"),u!=-1)throw new Error("implementation bug");return c.join("")}static __toStringGeneric(e,t,n){const i=e.length;if(i===0)return"";if(i===1){let y=e.__unsignedDigit(0).toString(t);return n===!1&&e.sign&&(y="-"+y),y}const o=30*i-x.__clz30(e.__digit(i-1)),s=x.__kMaxBitsPerChar[t],a=s-1;let l=o*x.__kBitsPerCharTableMultiplier;l+=a-1,l=0|l/a;const d=l+1>>1,c=x.exponentiate(x.__oneDigit(t,!1),x.__oneDigit(d,!1));let u,f;const h=c.__unsignedDigit(0);if(c.length===1&&32767>=h){u=new x(e.length,!1),u.__initializeDigits();let y=0;for(let g=2*e.length-1;0<=g;g--){const w=y<<15|e.__halfDigit(g);u.__setHalfDigit(g,0|w/h),y=0|w%h}f=y.toString(t)}else{const y=x.__absoluteDivLarge(e,c,!0,!0);u=y.quotient;const g=y.remainder.__trim();f=x.__toStringGeneric(g,t,!0)}u.__trim();let p=x.__toStringGeneric(u,t,!0);for(;f.length<d;)f="0"+f;return n===!1&&e.sign&&(p="-"+p),p+f}static __unequalSign(e){return e?-1:1}static __absoluteGreater(e){return e?-1:1}static __absoluteLess(e){return e?1:-1}static __compareToBigInt(e,t){const n=e.sign;if(n!==t.sign)return x.__unequalSign(n);const i=x.__absoluteCompare(e,t);return 0<i?x.__absoluteGreater(n):0>i?x.__absoluteLess(n):0}static __compareToNumber(e,t){if(x.__isOneDigitInt(t)){const n=e.sign,i=0>t;if(n!==i)return x.__unequalSign(n);if(e.length===0){if(i)throw new Error("implementation bug");return t===0?0:-1}if(1<e.length)return x.__absoluteGreater(n);const o=Math.abs(t),s=e.__unsignedDigit(0);return s>o?x.__absoluteGreater(n):s<o?x.__absoluteLess(n):0}return x.__compareToDouble(e,t)}static __compareToDouble(e,t){if(t!==t)return t;if(t===1/0)return-1;if(t===-1/0)return 1;const n=e.sign;if(n!==0>t)return x.__unequalSign(n);if(t===0)throw new Error("implementation bug: should be handled elsewhere");if(e.length===0)return-1;x.__kBitConversionDouble[0]=t;const i=2047&x.__kBitConversionInts[1]>>>20;if(i==2047)throw new Error("implementation bug: handled elsewhere");const o=i-1023;if(0>o)return x.__absoluteGreater(n);const s=e.length;let a=e.__digit(s-1);const l=x.__clz30(a),d=30*s-l,c=o+1;if(d<c)return x.__absoluteLess(n);if(d>c)return x.__absoluteGreater(n);let u=1048576|1048575&x.__kBitConversionInts[1],f=x.__kBitConversionInts[0];const h=20,p=29-l;if(p!==(0|(d-1)%30))throw new Error("implementation bug");let y,g=0;if(20>p){const w=h-p;g=w+32,y=u>>>w,u=u<<32-w|f>>>w,f<<=32-w}else if(p===20)g=32,y=u,u=f,f=0;else{const w=p-h;g=32-w,y=u<<w|f>>>32-w,u=f<<w,f=0}if(a>>>=0,y>>>=0,a>y)return x.__absoluteGreater(n);if(a<y)return x.__absoluteLess(n);for(let w=s-2;0<=w;w--){0<g?(g-=30,y=u>>>2,u=u<<30|f>>>2,f<<=30):y=0;const v=e.__unsignedDigit(w);if(v>y)return x.__absoluteGreater(n);if(v<y)return x.__absoluteLess(n)}if(u!==0||f!==0){if(g===0)throw new Error("implementation bug");return x.__absoluteLess(n)}return 0}static __equalToNumber(e,t){var n=Math.abs;return x.__isOneDigitInt(t)?t===0?e.length===0:e.length===1&&e.sign===0>t&&e.__unsignedDigit(0)===n(t):x.__compareToDouble(e,t)===0}static __comparisonResultToBool(e,t){return t===0?0>e:t===1?0>=e:t===2?0<e:t===3?0<=e:void 0}static __compare(e,t,n){if(e=x.__toPrimitive(e),t=x.__toPrimitive(t),typeof e=="string"&&typeof t=="string")switch(n){case 0:return e<t;case 1:return e<=t;case 2:return e>t;case 3:return e>=t}if(x.__isBigInt(e)&&typeof t=="string")return t=x.__fromString(t),t!==null&&x.__comparisonResultToBool(x.__compareToBigInt(e,t),n);if(typeof e=="string"&&x.__isBigInt(t))return e=x.__fromString(e),e!==null&&x.__comparisonResultToBool(x.__compareToBigInt(e,t),n);if(e=x.__toNumeric(e),t=x.__toNumeric(t),x.__isBigInt(e)){if(x.__isBigInt(t))return x.__comparisonResultToBool(x.__compareToBigInt(e,t),n);if(typeof t!="number")throw new Error("implementation bug");return x.__comparisonResultToBool(x.__compareToNumber(e,t),n)}if(typeof e!="number")throw new Error("implementation bug");if(x.__isBigInt(t))return x.__comparisonResultToBool(x.__compareToNumber(t,e),2^n);if(typeof t!="number")throw new Error("implementation bug");return n===0?e<t:n===1?e<=t:n===2?e>t:n===3?e>=t:void 0}__clzmsd(){return x.__clz30(this.__digit(this.length-1))}static __absoluteAdd(e,t,n){if(e.length<t.length)return x.__absoluteAdd(t,e,n);if(e.length===0)return e;if(t.length===0)return e.sign===n?e:x.unaryMinus(e);let i=e.length;(e.__clzmsd()===0||t.length===e.length&&t.__clzmsd()===0)&&i++;const o=new x(i,n);let s=0,a=0;for(;a<t.length;a++){const l=e.__digit(a)+t.__digit(a)+s;s=l>>>30,o.__setDigit(a,1073741823&l)}for(;a<e.length;a++){const l=e.__digit(a)+s;s=l>>>30,o.__setDigit(a,1073741823&l)}return a<o.length&&o.__setDigit(a,s),o.__trim()}static __absoluteSub(e,t,n){if(e.length===0)return e;if(t.length===0)return e.sign===n?e:x.unaryMinus(e);const i=new x(e.length,n);let o=0,s=0;for(;s<t.length;s++){const a=e.__digit(s)-t.__digit(s)-o;o=1&a>>>30,i.__setDigit(s,1073741823&a)}for(;s<e.length;s++){const a=e.__digit(s)-o;o=1&a>>>30,i.__setDigit(s,1073741823&a)}return i.__trim()}static __absoluteAddOne(e,t,n=null){const i=e.length;n===null?n=new x(i,t):n.sign=t;let o=1;for(let s=0;s<i;s++){const a=e.__digit(s)+o;o=a>>>30,n.__setDigit(s,1073741823&a)}return o!=0&&n.__setDigitGrow(i,1),n}static __absoluteSubOne(e,t){const n=e.length;t=t||n;const i=new x(t,!1);let o=1;for(let s=0;s<n;s++){const a=e.__digit(s)-o;o=1&a>>>30,i.__setDigit(s,1073741823&a)}if(o!=0)throw new Error("implementation bug");for(let s=n;s<t;s++)i.__setDigit(s,0);return i}static __absoluteAnd(e,t,n=null){let i=e.length,o=t.length,s=o;if(i<o){s=i;const d=e,c=i;e=t,i=o,t=d,o=c}let a=s;n===null?n=new x(a,!1):a=n.length;let l=0;for(;l<s;l++)n.__setDigit(l,e.__digit(l)&t.__digit(l));for(;l<a;l++)n.__setDigit(l,0);return n}static __absoluteAndNot(e,t,n=null){const i=e.length,o=t.length;let s=o;i<o&&(s=i);let a=i;n===null?n=new x(a,!1):a=n.length;let l=0;for(;l<s;l++)n.__setDigit(l,e.__digit(l)&~t.__digit(l));for(;l<i;l++)n.__setDigit(l,e.__digit(l));for(;l<a;l++)n.__setDigit(l,0);return n}static __absoluteOr(e,t,n=null){let i=e.length,o=t.length,s=o;if(i<o){s=i;const d=e,c=i;e=t,i=o,t=d,o=c}let a=i;n===null?n=new x(a,!1):a=n.length;let l=0;for(;l<s;l++)n.__setDigit(l,e.__digit(l)|t.__digit(l));for(;l<i;l++)n.__setDigit(l,e.__digit(l));for(;l<a;l++)n.__setDigit(l,0);return n}static __absoluteXor(e,t,n=null){let i=e.length,o=t.length,s=o;if(i<o){s=i;const d=e,c=i;e=t,i=o,t=d,o=c}let a=i;n===null?n=new x(a,!1):a=n.length;let l=0;for(;l<s;l++)n.__setDigit(l,e.__digit(l)^t.__digit(l));for(;l<i;l++)n.__setDigit(l,e.__digit(l));for(;l<a;l++)n.__setDigit(l,0);return n}static __absoluteCompare(e,t){const n=e.length-t.length;if(n!=0)return n;let i=e.length-1;for(;0<=i&&e.__digit(i)===t.__digit(i);)i--;return 0>i?0:e.__unsignedDigit(i)>t.__unsignedDigit(i)?1:-1}static __multiplyAccumulate(e,t,n,i){if(t===0)return;const o=32767&t,s=t>>>15;let a=0,l=0;for(let d,c=0;c<e.length;c++,i++){d=n.__digit(i);const u=e.__digit(c),f=32767&u,h=u>>>15,p=x.__imul(f,o),y=x.__imul(f,s),g=x.__imul(h,o),w=x.__imul(h,s);d+=l+p+a,a=d>>>30,d&=1073741823,d+=((32767&y)<<15)+((32767&g)<<15),a+=d>>>30,l=w+(y>>>15)+(g>>>15),n.__setDigit(i,1073741823&d)}for(;a!=0||l!==0;i++){let d=n.__digit(i);d+=a+l,l=0,a=d>>>30,n.__setDigit(i,1073741823&d)}}static __internalMultiplyAdd(e,t,n,i,o){let s=n,a=0;for(let l=0;l<i;l++){const d=e.__digit(l),c=x.__imul(32767&d,t),u=x.__imul(d>>>15,t),f=c+((32767&u)<<15)+a+s;s=f>>>30,a=u>>>15,o.__setDigit(l,1073741823&f)}if(o.length>i)for(o.__setDigit(i++,s+a);i<o.length;)o.__setDigit(i++,0);else if(s+a!==0)throw new Error("implementation bug")}__inplaceMultiplyAdd(e,t,n){n>this.length&&(n=this.length);const i=32767&e,o=e>>>15;let s=0,a=t;for(let l=0;l<n;l++){const d=this.__digit(l),c=32767&d,u=d>>>15,f=x.__imul(c,i),h=x.__imul(c,o),p=x.__imul(u,i),y=x.__imul(u,o);let g=a+f+s;s=g>>>30,g&=1073741823,g+=((32767&h)<<15)+((32767&p)<<15),s+=g>>>30,a=y+(h>>>15)+(p>>>15),this.__setDigit(l,1073741823&g)}if(s!=0||a!==0)throw new Error("implementation bug")}static __absoluteDivSmall(e,t,n=null){n===null&&(n=new x(e.length,!1));let i=0;for(let o,s=2*e.length-1;0<=s;s-=2){o=(i<<15|e.__halfDigit(s))>>>0;const a=0|o/t;i=0|o%t,o=(i<<15|e.__halfDigit(s-1))>>>0;const l=0|o/t;i=0|o%t,n.__setDigit(s>>>1,a<<15|l)}return n}static __absoluteModSmall(e,t){let n=0;for(let i=2*e.length-1;0<=i;i--)n=0|((n<<15|e.__halfDigit(i))>>>0)%t;return n}static __absoluteDivLarge(e,t,n,i){const o=t.__halfDigitLength(),s=t.length,a=e.__halfDigitLength()-o;let l=null;n&&(l=new x(a+2>>>1,!1),l.__initializeDigits());const d=new x(o+2>>>1,!1);d.__initializeDigits();const c=x.__clz15(t.__halfDigit(o-1));0<c&&(t=x.__specialLeftShift(t,c,0));const u=x.__specialLeftShift(e,c,1),f=t.__halfDigit(o-1);let h=0;for(let p,y=a;0<=y;y--){p=32767;const g=u.__halfDigit(y+o);if(g!==f){const v=(g<<15|u.__halfDigit(y+o-1))>>>0;p=0|v/f;let m=0|v%f;const b=t.__halfDigit(o-2),_=u.__halfDigit(y+o-2);for(;x.__imul(p,b)>>>0>(m<<16|_)>>>0&&(p--,m+=f,!(32767<m)););}x.__internalMultiplyAdd(t,p,0,s,d);let w=u.__inplaceSub(d,y,o+1);w!==0&&(w=u.__inplaceAdd(t,y,o),u.__setHalfDigit(y+o,32767&u.__halfDigit(y+o)+w),p--),n&&(1&y?h=p<<15:l.__setDigit(y>>>1,h|p))}if(i)return u.__inplaceRightShift(c),n?{quotient:l,remainder:u}:u;if(n)return l;throw new Error("unreachable")}static __clz15(e){return x.__clz30(e)-15}__inplaceAdd(e,t,n){let i=0;for(let o=0;o<n;o++){const s=this.__halfDigit(t+o)+e.__halfDigit(o)+i;i=s>>>15,this.__setHalfDigit(t+o,32767&s)}return i}__inplaceSub(e,t,n){let i=0;if(1&t){t>>=1;let o=this.__digit(t),s=32767&o,a=0;for(;a<n-1>>>1;a++){const c=e.__digit(a),u=(o>>>15)-(32767&c)-i;i=1&u>>>15,this.__setDigit(t+a,(32767&u)<<15|32767&s),o=this.__digit(t+a+1),s=(32767&o)-(c>>>15)-i,i=1&s>>>15}const l=e.__digit(a),d=(o>>>15)-(32767&l)-i;if(i=1&d>>>15,this.__setDigit(t+a,(32767&d)<<15|32767&s),t+a+1>=this.length)throw new RangeError("out of bounds");!(1&n)&&(o=this.__digit(t+a+1),s=(32767&o)-(l>>>15)-i,i=1&s>>>15,this.__setDigit(t+e.length,1073709056&o|32767&s))}else{t>>=1;let o=0;for(;o<e.length-1;o++){const c=this.__digit(t+o),u=e.__digit(o),f=(32767&c)-(32767&u)-i;i=1&f>>>15;const h=(c>>>15)-(u>>>15)-i;i=1&h>>>15,this.__setDigit(t+o,(32767&h)<<15|32767&f)}const s=this.__digit(t+o),a=e.__digit(o),l=(32767&s)-(32767&a)-i;i=1&l>>>15;let d=0;!(1&n)&&(d=(s>>>15)-(a>>>15)-i,i=1&d>>>15),this.__setDigit(t+o,(32767&d)<<15|32767&l)}return i}__inplaceRightShift(e){if(e===0)return;let t=this.__digit(0)>>>e;const n=this.length-1;for(let i=0;i<n;i++){const o=this.__digit(i+1);this.__setDigit(i,1073741823&o<<30-e|t),t=o>>>e}this.__setDigit(n,t)}static __specialLeftShift(e,t,n){const i=e.length,o=new x(i+n,!1);if(t===0){for(let a=0;a<i;a++)o.__setDigit(a,e.__digit(a));return 0<n&&o.__setDigit(i,0),o}let s=0;for(let a=0;a<i;a++){const l=e.__digit(a);o.__setDigit(a,1073741823&l<<t|s),s=l>>>30-t}return 0<n&&o.__setDigit(i,s),o}static __leftShiftByAbsolute(e,t){const n=x.__toShiftAmount(t);if(0>n)throw new RangeError("BigInt too big");const i=0|n/30,o=n%30,s=e.length,a=o!==0&&e.__digit(s-1)>>>30-o!=0,l=s+i+(a?1:0),d=new x(l,e.sign);if(o===0){let c=0;for(;c<i;c++)d.__setDigit(c,0);for(;c<l;c++)d.__setDigit(c,e.__digit(c-i))}else{let c=0;for(let u=0;u<i;u++)d.__setDigit(u,0);for(let u=0;u<s;u++){const f=e.__digit(u);d.__setDigit(u+i,1073741823&f<<o|c),c=f>>>30-o}if(a)d.__setDigit(s+i,c);else if(c!==0)throw new Error("implementation bug")}return d.__trim()}static __rightShiftByAbsolute(e,t){const n=e.length,i=e.sign,o=x.__toShiftAmount(t);if(0>o)return x.__rightShiftByMaximum(i);const s=0|o/30,a=o%30;let l=n-s;if(0>=l)return x.__rightShiftByMaximum(i);let d=!1;if(i){if(e.__digit(s)&(1<<a)-1)d=!0;else for(let u=0;u<s;u++)if(e.__digit(u)!==0){d=!0;break}}d&&a===0&&!~e.__digit(n-1)&&l++;let c=new x(l,i);if(a===0){c.__setDigit(l-1,0);for(let u=s;u<n;u++)c.__setDigit(u-s,e.__digit(u))}else{let u=e.__digit(s)>>>a;const f=n-s-1;for(let h=0;h<f;h++){const p=e.__digit(h+s+1);c.__setDigit(h,1073741823&p<<30-a|u),u=p>>>a}c.__setDigit(f,u)}return d&&(c=x.__absoluteAddOne(c,!0,c)),c.__trim()}static __rightShiftByMaximum(e){return e?x.__oneDigit(1,!0):x.__zero()}static __toShiftAmount(e){if(1<e.length)return-1;const t=e.__unsignedDigit(0);return t>x.__kMaxLengthBits?-1:t}static __toPrimitive(e,t="default"){if(typeof e!="object"||e.constructor===x)return e;if(typeof Symbol<"u"&&typeof Symbol.toPrimitive=="symbol"){const o=e[Symbol.toPrimitive];if(o){const s=o(t);if(typeof s!="object")return s;throw new TypeError("Cannot convert object to primitive value")}}const n=e.valueOf;if(n){const o=n.call(e);if(typeof o!="object")return o}const i=e.toString;if(i){const o=i.call(e);if(typeof o!="object")return o}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(e){return x.__isBigInt(e)?e:+e}static __isBigInt(e){return typeof e=="object"&&e!==null&&e.constructor===x}static __truncateToNBits(e,t){const n=0|(e+29)/30,i=new x(n,t.sign),o=n-1;for(let a=0;a<o;a++)i.__setDigit(a,t.__digit(a));let s=t.__digit(o);if(e%30!=0){const a=32-e%30;s=s<<a>>>a}return i.__setDigit(o,s),i.__trim()}static __truncateAndSubFromPowerOfTwo(e,t,n){var i=Math.min;const o=0|(e+29)/30,s=new x(o,n);let a=0;const l=o-1;let d=0;for(const h=i(l,t.length);a<h;a++){const p=0-t.__digit(a)-d;d=1&p>>>30,s.__setDigit(a,1073741823&p)}for(;a<l;a++)s.__setDigit(a,0|1073741823&-d);let c=l<t.length?t.__digit(l):0;const u=e%30;let f;if(u==0)f=0-c-d,f&=1073741823;else{const h=32-u;c=c<<h>>>h;const p=1<<32-h;f=p-c-d,f&=p-1}return s.__setDigit(l,f),s.__trim()}__digit(e){return this[e]}__unsignedDigit(e){return this[e]>>>0}__setDigit(e,t){this[e]=0|t}__setDigitGrow(e,t){this[e]=0|t}__halfDigitLength(){const e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}__halfDigit(e){return 32767&this[e>>>1]>>>15*(1&e)}__setHalfDigit(e,t){const n=e>>>1,i=this.__digit(n),o=1&e?32767&i|t<<15:1073709056&i|32767&t;this.__setDigit(n,o)}static __digitPow(e,t){let n=1;for(;0<t;)1&t&&(n*=e),t>>>=1,e*=e;return n}static __isOneDigitInt(e){return(1073741823&e)===e}}x.__kMaxLength=33554432,x.__kMaxLengthBits=x.__kMaxLength<<5,x.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],x.__kBitsPerCharTableShift=5,x.__kBitsPerCharTableMultiplier=1<<x.__kBitsPerCharTableShift,x.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],x.__kBitConversionBuffer=new ArrayBuffer(8),x.__kBitConversionDouble=new Float64Array(x.__kBitConversionBuffer),x.__kBitConversionInts=new Int32Array(x.__kBitConversionBuffer),x.__clz30=Math.clz32?function(r){return Math.clz32(r)-2}:function(r){return r===0?30:0|29-(0|Math.log(r>>>0)/Math.LN2)},x.__imul=Math.imul||function(r,e){return 0|r*e};const dI={};function fd(r,e){Object.defineProperty(r.prototype,Symbol.toStringTag,{value:e,writable:!1,enumerable:!1,configurable:!0});for(const t of Object.getOwnPropertyNames(r)){const n=Object.getOwnPropertyDescriptor(r,t);n.configurable&&n.enumerable&&(n.enumerable=!1,Object.defineProperty(r,t,n))}for(const t of Object.getOwnPropertyNames(r.prototype)){const n=Object.getOwnPropertyDescriptor(r.prototype,t);n.configurable&&n.enumerable&&(n.enumerable=!1,Object.defineProperty(r.prototype,t,n))}Gr(e,r),Gr(`${e}.prototype`,r.prototype)}function Gr(r,e){const t=`%${r}%`;if(dI[t]!==void 0)throw new Error(`intrinsic ${r} already exists`);dI[t]=e}function Pe(r){return dI[r]}var V8,W8;const tt="slot-epochNanoSeconds",El="slot-timezone-identifier",Me="slot-year",Be="slot-month",je="slot-day",Et="slot-hour",At="slot-minute",xt="slot-second",St="slot-millisecond",Tt="slot-microsecond",$t="slot-nanosecond",be="slot-calendar",F9="slot-date-brand",q9="slot-year-month-brand",V9="slot-month-day-brand",Pi="slot-cached-instant",hr="slot-time-zone",to="slot-years",Qn="slot-months",No="slot-weeks",ro="slot-days",no="slot-hours",io="slot-minutes",oo="slot-seconds",so="slot-milliseconds",ao="slot-microseconds",co="slot-nanoseconds",Hr="slot-calendar-identifier",W9=new WeakMap,uI=Symbol.for("@@Temporal__GetSlots");(V8=globalThis)[uI]||(V8[uI]=function(e){return W9.get(e)});const xC=globalThis[uI],fI=Symbol.for("@@Temporal__CreateSlots");(W8=globalThis)[fI]||(W8[fI]=function(e){W9.set(e,Object.create(null))});const hd=globalThis[fI];function Hn(r,...e){if(!r||typeof r!="object")return!1;const t=xC(r);return!!t&&e.every(n=>n in t)}function A(r,e){const t=xC(r)?.[e];if(t===void 0)throw new TypeError(`Missing internal slot ${e}`);return t}function Pt(r,e,t){const n=xC(r);if(n===void 0)throw new TypeError("Missing slots for the given container");if(n[e])throw new TypeError(`${e} already has set`);n[e]=t}const H8=/\.[-A-Za-z_]|\.\.[-A-Za-z._]{1,12}|\.[-A-Za-z_][-A-Za-z._]{0,12}|[A-Za-z_][-A-Za-z._]{0,13}/,O_=new RegExp("(?:"+[`(?:${H8.source})(?:\\/(?:${H8.source}))*`,"Etc/GMT(?:0|[-+]\\d{1,2})","GMT[-+]?0","EST5EDT","CST6CDT","MST7MDT","PST8PDT",/(?:[+\u2212-][0-2][0-9](?::?[0-5][0-9](?::?[0-5][0-9](?:[.,]\d{1,9})?)?)?)/.source].join("|")+")"),H9=/(?:[+\u2212-]\d{6}|\d{4})/,_A=/(?:0[1-9]|1[0-2])/,hI=/(?:0[1-9]|[12]\d|3[01])/,ohe=new RegExp(`(${H9.source})(?:-(${_A.source})-(${hI.source})|(${_A.source})(${hI.source}))`),G9=/(\d{2})(?::(\d{2})(?::(\d{2})(?:[.,](\d{1,9}))?)?|(\d{2})(?:(\d{2})(?:[.,](\d{1,9}))?)?)?/,Y9=/([+\u2212-])([01][0-9]|2[0-3])(?::?([0-5][0-9])(?::?([0-5][0-9])(?:[.,](\d{1,9}))?)?)?/,Z9=new RegExp(`([zZ])|${Y9.source}?`),zh=/\[(!)?([a-z_][a-z0-9_-]*)=([A-Za-z0-9]+(?:-[A-Za-z0-9]+)*)\]/g,she=new RegExp([`^${ohe.source}`,`(?:(?:T|\\s+)${G9.source}(?:${Z9.source})?)?`,`(?:\\[!?(${O_.source})\\])?`,`((?:${zh.source})*)$`].join(""),"i"),ahe=new RegExp([`^T?${G9.source}`,`(?:${Z9.source})?`,`(?:\\[!?${O_.source}\\])?`,`((?:${zh.source})*)$`].join(""),"i"),che=new RegExp(`^(${H9.source})-?(${_A.source})(?:\\[!?${O_.source}\\])?((?:${zh.source})*)$`),lhe=new RegExp(`^(?:--)?(${_A.source})-?(${hI.source})(?:\\[!?${O_.source}\\])?((?:${zh.source})*)$`),p$=/(\d+)(?:[.,](\d{1,9}))?/,dhe=new RegExp(`(?:${p$.source}H)?(?:${p$.source}M)?(?:${p$.source}S)?`),uhe=new RegExp(`^([+-])?P${/(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?/.source}(?:T(?!$)${dhe.source})?$`,"i"),fhe=Array.prototype.includes,J9=Array.prototype.push,X9=globalThis.Intl.DateTimeFormat,hhe=Math.min,phe=Math.max,Rr=Math.abs,ms=Math.floor,zg=Math.sign,Hp=Math.trunc,fS=Number.isNaN,uo=Number.isFinite,yhe=Number,C_=String,mhe=Number.MAX_SAFE_INTEGER,Di=Object.create,ghe=Object.getOwnPropertyDescriptor,hS=Reflect.apply,vhe=Reflect.ownKeys,nn=x.BigInt(0),Rv=x.BigInt(1),zl=x.BigInt(60),Q9=x.BigInt(24),rr=x.BigInt(1e3),ba=x.BigInt(1e6),Fl=x.BigInt(1e9),bhe=x.BigInt(-1),e7=x.multiply(x.BigInt(3600),Fl),t7=x.multiply(zl,Fl),ed=x.multiply(e7,Q9),Iw=x.multiply(x.BigInt(-86400),x.BigInt(1e17)),Fg=x.multiply(x.BigInt(86400),x.BigInt(1e17)),EA=-271821,AA=275760,lg=x.multiply(x.BigInt(-388152),x.BigInt(1e13)),whe=x.multiply(ed,x.BigInt(3660)),r7=x.multiply(ed,x.BigInt(366)),n7=x.multiply(ed,x.BigInt(14)),_he=["iso8601","hebrew","islamic","islamic-umalqura","islamic-tbla","islamic-civil","islamic-rgsa","islamicc","persian","ethiopic","ethioaa","coptic","chinese","dangi","roc","indian","buddhist","japanese","gregory"];function na(r){return x.equal(r,nn)}function cr(r,e){const t=r[e];if(t!==void 0)return t}function We(r,e,t){const n=arguments.length>2?t:[];return hS(r,e,n)}function Mr(r){return typeof r=="object"&&r!==null||typeof r=="function"}function qg(r){if(typeof r=="bigint")throw new TypeError("Cannot convert BigInt to number");return yhe(r)}function En(r){const e=qg(r);if(fS(e)||e===0)return 0;if(!uo(e))return e;const t=ms(Rr(e));return t===0?0:zg(e)*t}function Ls(r){if(typeof r!="number"||fS(r)||!uo(r))return!1;const e=Rr(r);return ms(e)===e}function bo(r){if(typeof r=="symbol")throw new TypeError("Cannot convert a Symbol value to a String");return C_(r)}function Yt(r){const e=qg(r);if(e===0)return 0;if(fS(e)||!uo(e))throw new RangeError("invalid number value");const t=Hp(e);return t===0?0:t}function G8(r,e){const t=Yt(r);if(t<=0)throw e!==void 0?new RangeError(`property '${e}' cannot be a a number less than one`):new RangeError("Cannot convert a number less than one to a positive integer");return t}function Ln(r){const e=qg(r);if(!uo(e))throw new RangeError("infinity is out of range");if(!Ls(e))throw new RangeError(`unsupported fractional value ${r}`);return e===0?0:e}function gn(r,e){return{quotient:x.divide(r,e),remainder:x.remainder(r,e)}}function xA(r){return x.lessThan(r,nn)}function Y8(r){return na(r)?0:xA(r)?-1:1}function jc(r){return x.lessThan(r,nn)?x.multiply(r,bhe):r}const Z8=new Map([["year",Yt],["month",G8],["monthCode",bo],["day",G8],["hour",Yt],["minute",Yt],["second",Yt],["millisecond",Yt],["microsecond",Yt],["nanosecond",Yt],["years",Ln],["months",Ln],["weeks",Ln],["days",Ln],["hours",Ln],["minutes",Ln],["seconds",Ln],["milliseconds",Ln],["microseconds",Ln],["nanoseconds",Ln],["era",bo],["eraYear",En],["offset",bo]]),Ehe=new Map([["hour",0],["minute",0],["second",0],["millisecond",0],["microsecond",0],["nanosecond",0]]),R_=[["years","year","date"],["months","month","date"],["weeks","week","date"],["days","day","date"],["hours","hour","time"],["minutes","minute","time"],["seconds","second","time"],["milliseconds","millisecond","time"],["microseconds","microsecond","time"],["nanoseconds","nanosecond","time"]],SA=new Map(R_.map(r=>[r[0],r[1]])),Ahe=new Map(R_.map(([r,e])=>[e,r])),J8=R_.map(([,r])=>r),X8=Array.from(SA.keys()).sort(),Q8=new Map;function i7(r){let e=Q8.get(r);return e===void 0&&(e=new X9("en-us",{timeZone:C_(r),hour12:!1,era:"short",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),Q8.set(r,e)),e}function eB(r){if(r==null)throw new TypeError(`Expected object not ${r}`);return Object(r)}function dg(r,e,t,n){if(e==null)return;const i=vhe(e);for(const o of i)if(!t.some(s=>Object.is(s,o))&&Object.prototype.propertyIsEnumerable.call(e,o)){const s=e[o];if(n&&n.some(a=>Object.is(a,s)))continue;r[o]=s}}function kn(r){return Hn(r,tt)&&!Hn(r,hr,be)}function Qs(r){return Hn(r,El)}function Xr(r){return Hn(r,Hr)}function en(r){return Hn(r,to,Qn,ro,no,io,oo,so,ao,co)}function Nt(r){return Hn(r,F9)}function tn(r){return Hn(r,Et,At,xt,St,Tt,$t)&&!Hn(r,Me,Be,je)}function bt(r){return Hn(r,Me,Be,je,Et,At,xt,St,Tt,$t)}function Qt(r){return Hn(r,q9)}function Nn(r){return Hn(r,V9)}function Fe(r){return Hn(r,tt,hr,be)}function Dv(r){if(Hn(r,be)||Hn(r,hr))throw new TypeError("with() does not support a calendar or timeZone property");if(tn(r))throw new TypeError("with() does not accept Temporal.PlainTime, use withPlainTime() instead");if(r.calendar!==void 0)throw new TypeError("with() does not support a calendar property");if(r.timeZone!==void 0)throw new TypeError("with() does not support a timeZone property")}function xhe(r){const{ianaName:e,offset:t,z:n}=function(o){if(new RegExp(`^${O_.source}$`,"i").test(o))return{ianaName:o};try{const s=pd(o);if(s.z||s.offset||s.ianaName)return s}catch{}throw new RangeError(`Invalid time zone: ${o}`)}(r);return e?MC(e):n?"UTC":SS(Oh(t))}function SC(r,e){return e==="never"?"":TC(fi(r),e)}function TC(r,e){return e==="never"||e==="auto"&&r==="iso8601"?"":`[${e==="critical"?"!":""}u-ca=${r}]`}function pd(r){const e=she.exec(r);if(!e)throw new RangeError(`invalid ISO 8601 string: ${r}`);let t=e[1];if(t[0]===""&&(t=`-${t.slice(1)}`),t==="-000000")throw new RangeError(`invalid ISO 8601 string: ${r}`);const n=En(t),i=En(e[2]||e[4]),o=En(e[3]||e[5]),s=En(e[6]),a=e[6]!==void 0,l=En(e[7]||e[10]);let d=En(e[8]||e[11]);d===60&&(d=59);const c=(e[9]||e[12])+"000000000",u=En(c.slice(0,3)),f=En(c.slice(3,6)),h=En(c.slice(6,9));let p,y=!1;if(e[13])p=void 0,y=!0;else if(e[14]&&e[15]){const m=e[14]==="-"||e[14]===""?"-":"+",b=e[15]||"00",_=e[16]||"00",E=e[17]||"00";let S=e[18]||"0";if(p=`${m}${b}:${_}`,+S){for(;S.endsWith("0");)S=S.slice(0,-1);p+=`:${E}.${S}`}else+E&&(p+=`:${E}`);p==="-00:00"&&(p="+00:00")}const g=e[19],w=e[20];let v;for(const[,m,b,_]of w.matchAll(zh))if(b==="u-ca")v===void 0&&(v=_);else if(m==="!")throw new RangeError(`Unrecognized annotation: !${b}=${_}`);return NC(n,i,o,s,l,d,u,f,h),{year:n,month:i,day:o,hasTime:a,hour:s,minute:l,second:d,millisecond:u,microsecond:f,nanosecond:h,ianaName:g,offset:p,z:y,calendar:v}}function $C(r){const e=che.exec(r);let t,n,i,o;if(e){let s=e[1];if(s[0]===""&&(s=`-${s.slice(1)}`),s==="-000000")throw new RangeError(`invalid ISO 8601 string: ${r}`);t=En(s),n=En(e[2]);const a=e[3];for(const[,l,d,c]of a.matchAll(zh))if(d==="u-ca")i===void 0&&(i=c);else if(l==="!")throw new RangeError(`Unrecognized annotation: !${d}=${c}`);if(i!==void 0&&i!=="iso8601")throw new RangeError("YYYY-MM format is only valid with iso8601 calendar")}else{let s;if({year:t,month:n,calendar:i,day:o,z:s}=pd(r),s)throw new RangeError("Z designator not supported for PlainYearMonth")}return{year:t,month:n,calendar:i,referenceISODay:o}}function kC(r){const e=lhe.exec(r);let t,n,i,o;if(e){t=En(e[1]),n=En(e[2]);const s=e[3];for(const[,a,l,d]of s.matchAll(zh))if(l==="u-ca")i===void 0&&(i=d);else if(a==="!")throw new RangeError(`Unrecognized annotation: !${l}=${d}`);if(i!==void 0&&i!=="iso8601")throw new RangeError("MM-DD format is only valid with iso8601 calendar")}else{let s;if({month:t,day:n,calendar:i,year:o,z:s}=pd(r),s)throw new RangeError("Z designator not supported for PlainMonthDay")}return{month:t,day:n,calendar:i,referenceISOYear:o}}function She(r){let{year:e,month:t,day:n,hour:i,minute:o,second:s,millisecond:a,microsecond:l,nanosecond:d,offset:c,z:u}=function(y){const g=pd(y);if(!g.z&&!g.offset)throw new RangeError("Temporal.Instant requires a time zone offset");return g}(r);if(!u&&!c)throw new RangeError("Temporal.Instant requires a time zone offset");const f=u?0:Oh(c);({year:e,month:t,day:n,hour:i,minute:o,second:s,millisecond:a,microsecond:l,nanosecond:d}=BC(e,t,n,i,o,s,a,l,d-f));const h=Ch(e,t,n,i,o,s,a,l,d);if(h===null)throw new RangeError("DateTime outside of supported range");return h}function TA(r,e,t,n){let i=r,o=e,s=t;switch(n){case"reject":td(i,o,s);break;case"constrain":({year:i,month:o,day:s}=_7(i,o,s))}return{year:i,month:o,day:s}}function pS(r,e,t,n,i,o,s){let a=r,l=e,d=t,c=n,u=i,f=o;switch(s){case"reject":$S(a,l,d,c,u,f);break;case"constrain":({hour:a,minute:l,second:d,millisecond:c,microsecond:u,nanosecond:f}=function(p,y,g,w,v,m){const b=ps(p,0,23),_=ps(y,0,59),E=ps(g,0,59),S=ps(w,0,999),T=ps(v,0,999),O=ps(m,0,999);return{hour:b,minute:_,second:E,millisecond:S,microsecond:T,nanosecond:O}}(a,l,d,c,u,f))}return{hour:a,minute:l,second:d,millisecond:c,microsecond:u,nanosecond:f}}function rm(r){if(!Mr(r))return function(p){const y=uhe.exec(p);if(!y)throw new RangeError(`invalid duration: ${p}`);if(y.slice(2).every(K=>K===void 0))throw new RangeError(`invalid duration: ${p}`);const g=y[1]==="-"||y[1]===""?-1:1,w=y[2]===void 0?0:Yt(y[2])*g,v=y[3]===void 0?0:Yt(y[3])*g,m=y[4]===void 0?0:Yt(y[4])*g,b=y[5]===void 0?0:Yt(y[5])*g,_=y[6]===void 0?0:Yt(y[6])*g,E=y[7],S=y[8],T=y[9],O=y[10],M=y[11];let Q=0,W=0,U=0;if(E!==void 0){if(S??T??O??M)throw new RangeError("only the smallest unit can be fractional");U=3600*En((E+"000000000").slice(0,9))*g}else if(Q=S===void 0?0:Yt(S)*g,T!==void 0){if(O??M)throw new RangeError("only the smallest unit can be fractional");U=60*En((T+"000000000").slice(0,9))*g}else W=O===void 0?0:Yt(O)*g,M!==void 0&&(U=En((M+"000000000").slice(0,9))*g);const ee=U%1e3,R=Hp(U/1e3)%1e3,z=Hp(U/1e6)%1e3;return W+=Hp(U/1e9)%60,Q+=Hp(U/6e10),CA(w,v,m,b,_,Q,W,z,R,ee),{years:w,months:v,weeks:m,days:b,hours:_,minutes:Q,seconds:W,milliseconds:z,microseconds:R,nanoseconds:ee}}(bo(r));if(en(r))return{years:A(r,to),months:A(r,Qn),weeks:A(r,No),days:A(r,ro),hours:A(r,no),minutes:A(r,io),seconds:A(r,oo),milliseconds:A(r,so),microseconds:A(r,ao),nanoseconds:A(r,co)};const e={years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0,microseconds:0,nanoseconds:0};let t=function(p){if(!Mr(p))throw new TypeError("invalid duration-like");const y={years:void 0,months:void 0,weeks:void 0,days:void 0,hours:void 0,minutes:void 0,seconds:void 0,milliseconds:void 0,microseconds:void 0,nanoseconds:void 0};let g=!1;for(const w of X8){const v=p[w];v!==void 0&&(g=!0,y[w]=Ln(v))}if(!g)throw new TypeError("invalid duration-like");return y}(r);for(const h of X8){const p=t[h];p!==void 0&&(e[h]=p)}let{years:n,months:i,weeks:o,days:s,hours:a,minutes:l,seconds:d,milliseconds:c,microseconds:u,nanoseconds:f}=e;return CA(n,i,o,s,a,l,d,c,u,f),{years:n,months:i,weeks:o,days:s,hours:a,minutes:l,seconds:d,milliseconds:c,microseconds:u,nanoseconds:f}}function vn(r){return r===void 0?"constrain":Dh(r,"overflow",["constrain","reject"],"constrain")}function Vg(r){return r===void 0?"compatible":Dh(r,"disambiguation",["compatible","earlier","later","reject"],"compatible")}function Gc(r,e){return Dh(r,"roundingMode",["ceil","floor","expand","trunc","halfCeil","halfFloor","halfExpand","halfTrunc","halfEven"],e)}function $A(r,e){return r===void 0?e:Dh(r,"offset",["prefer","use","ignore","reject"],e)}function D_(r){return Dh(r,"calendarName",["auto","always","never","critical"],"auto")}function Mv(r){let e=r.roundingIncrement;if(e===void 0)return 1;if(e=qg(e),!uo(e))throw new RangeError("roundingIncrement must be finite");const t=Hp(e);if(t<1||t>1e9)throw new RangeError(`roundingIncrement must be at least 1 and at most 1e9, not ${e}`);return t}function Bv(r,e,t){const n=t?e:e-1;if(r>n)throw new RangeError(`roundingIncrement must be at least 1 and less than ${n}, not ${r}`);if(e%r!=0)throw new RangeError(`Rounding increment must divide evenly into ${e}`)}function M_(r){const e=r.fractionalSecondDigits;if(e===void 0)return"auto";if(typeof e!="number"){if(bo(e)!=="auto")throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`);return"auto"}const t=ms(e);if(!uo(t)||t<0||t>9)throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`);return t}function B_(r,e){switch(r){case"minute":return{precision:"minute",unit:"minute",increment:1};case"second":return{precision:0,unit:"second",increment:1};case"millisecond":return{precision:3,unit:"millisecond",increment:1};case"microsecond":return{precision:6,unit:"microsecond",increment:1};case"nanosecond":return{precision:9,unit:"nanosecond",increment:1}}switch(e){case"auto":return{precision:e,unit:"nanosecond",increment:1};case 0:return{precision:e,unit:"second",increment:1};case 1:case 2:case 3:return{precision:e,unit:"millisecond",increment:10**(3-e)};case 4:case 5:case 6:return{precision:e,unit:"microsecond",increment:10**(6-e)};case 7:case 8:case 9:return{precision:e,unit:"nanosecond",increment:10**(9-e)};default:throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`)}}const Ry=Symbol("~required~");function gs(r,e,t,n,i=[]){const o=[];for(const[,d,c]of R_)t!=="datetime"&&t!==c||o.push(d);o.push(...i);let s=n;s===Ry?s=void 0:s!==void 0&&o.push(s);const a=[...o];for(const d of o){const c=Ahe.get(d);c!==void 0&&a.push(c)}let l=Dh(r,e,a,s);if(l===void 0&&n===Ry)throw new RangeError(`${e} is required`);return SA.has(l)?SA.get(l):l}function oE(r){const e=r.relativeTo;if(e===void 0)return e;let t,n,i,o,s,a,l,d,c,u,f,h,p="option",y=!1;if(Mr(e)){if(Fe(e)||Nt(e))return e;if(bt(e))return Hg(e);u=L_(e);const g=Sn(u,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);g.push("timeZone","offset");const w=Ct(e,g,[]),v=Di(null);v.overflow="constrain",{year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c}=j_(u,w,v),h=w.offset,h===void 0&&(p="wall"),f=w.timeZone,f!==void 0&&(f=Ri(f))}else{let g,w;if({year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c,calendar:u,ianaName:g,offset:h,z:w}=pd(bo(e)),g)f=Ri(g),w?p="exact":h||(p="wall"),y=!0;else if(w)throw new RangeError("Z designator not supported for PlainDate relativeTo; either remove the Z or add a bracketed time zone");if(u||(u="iso8601"),!Ou(u))throw new RangeError(`invalid calendar identifier ${u}`);u=rd(u)}return f===void 0?Aa(t,n,i,u):ai(PA(t,n,i,o,s,a,l,d,c,p,p==="option"?Oh(h):0,f,"compatible","reject",y),f,u)}function pI(r,e,t,n,i,o,s,a,l,d){for(const[c,u]of[["years",r],["months",e],["weeks",t],["days",n],["hours",i],["minutes",o],["seconds",s],["milliseconds",a],["microseconds",l],["nanoseconds",d]])if(u!==0)return SA.get(c);return"nanosecond"}function Dy(r,e){return J8.indexOf(r)>J8.indexOf(e)?e:r}function Ct(r,e,t,{emptySourceErrorMessage:n}={emptySourceErrorMessage:"no supported properties found"}){const i=Di(null);let o=!1;e.sort();for(const s of e){let a=r[s];if(a!==void 0)o=!0,Z8.has(s)&&(a=Z8.get(s)(a)),i[s]=a;else if(t!=="partial"){if(fhe.call(t,s))throw new TypeError(`required property '${s}' missing or undefined`);a=Ehe.get(s),i[s]=a}}if(t==="partial"&&!o)throw new TypeError(n);return i}function kA(r,e="complete"){const t=["hour","microsecond","millisecond","minute","nanosecond","second"],n=Ct(r,t,"partial",{emptySourceErrorMessage:"invalid time-like"}),i={};for(const o of t){const s=ghe(n,o);s!==void 0?i[o]=s.value:e==="complete"&&(i[o]=0)}return i}function yr(r,e){let t=r;if(Mr(t)){if(Nt(t))return t;if(Fe(t)&&(vn(e),t=Ds(A(t,hr),A(t,Pi),A(t,be))),bt(t))return vn(e),Aa(A(t,Me),A(t,Be),A(t,je),A(t,be));const l=L_(t);return Pu(l,Ct(t,Sn(l,["day","month","monthCode","year"]),[]),e)}vn(e);let{year:n,month:i,day:o,calendar:s,z:a}=function(d){return pd(d)}(bo(t));if(a)throw new RangeError("Z designator not supported for PlainDate");if(s||(s="iso8601"),!Ou(s))throw new RangeError(`invalid calendar identifier ${s}`);return s=rd(s),Aa(n,i,o,s)}function j_(r,e,t){let{hour:n,minute:i,second:o,millisecond:s,microsecond:a,nanosecond:l}=kA(e);const d=vn(t),c=Pu(r,e,t),u=A(c,Me),f=A(c,Be),h=A(c,je);return{hour:n,minute:i,second:o,millisecond:s,microsecond:a,nanosecond:l}=pS(n,i,o,s,a,l,d),{year:u,month:f,day:h,hour:n,minute:i,second:o,millisecond:s,microsecond:a,nanosecond:l}}function Gp(r,e){let t,n,i,o,s,a,l,d,c,u;if(Mr(r)){if(bt(r))return r;if(Fe(r))return vn(e),Ds(A(r,hr),A(r,Pi),A(r,be));if(Nt(r))return vn(e),hs(A(r,Me),A(r,Be),A(r,je),0,0,0,0,0,0,A(r,be));u=L_(r);const f=Ct(r,Sn(u,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]),[]);({year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c}=j_(u,f,e))}else{let f;if(vn(e),{year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c,calendar:u,z:f}=function(p){return pd(p)}(bo(r)),f)throw new RangeError("Z designator not supported for PlainDateTime");if(NC(t,n,i,o,s,a,l,d,c),u||(u="iso8601"),!Ou(u))throw new RangeError(`invalid calendar identifier ${u}`);u=rd(u)}return hs(t,n,i,o,s,a,l,d,c,u)}function ug(r){if(en(r))return r;let{years:e,months:t,weeks:n,days:i,hours:o,minutes:s,seconds:a,milliseconds:l,microseconds:d,nanoseconds:c}=rm(r);return new(Pe("%Temporal.Duration%"))(e,t,n,i,o,s,a,l,d,c)}function Nc(r){if(kn(r))return r;if(Fe(r))return new(Pe("%Temporal.Instant%"))(A(r,tt));const e=She(bo(r));return new(Pe("%Temporal.Instant%"))(e)}function tB(r,e){let t=r;if(Mr(t)){if(Nn(t))return t;let a,l;if(Hn(t,be))a=A(t,be),l=!1;else{let c=t.calendar;l=c===void 0,c===void 0&&(c="iso8601"),a=bs(c)}const d=Ct(t,Sn(a,["day","month","monthCode","year"]),[]);return l&&d.month!==void 0&&d.monthCode===void 0&&d.year===void 0&&(d.year=1972),Wg(a,d,e)}vn(e);let{month:n,day:i,referenceISOYear:o,calendar:s}=kC(bo(t));if(s===void 0&&(s="iso8601"),!Ou(s))throw new RangeError(`invalid calendar identifier ${s}`);return s=rd(s),o===void 0?(td(1972,n,i),Ow(n,i,s)):Wg(s,Ow(n,i,s,o))}function pu(r,e="constrain"){let t,n,i,o,s,a,l=r;if(Mr(l)){if(tn(l))return l;if(Fe(l)&&(l=Ds(A(l,hr),A(l,Pi),A(l,be))),bt(l))return new(Pe("%Temporal.PlainTime%"))(A(l,Et),A(l,At),A(l,xt),A(l,St),A(l,Tt),A(l,$t));({hour:t,minute:n,second:i,millisecond:o,microsecond:s,nanosecond:a}=kA(l)),{hour:t,minute:n,second:i,millisecond:o,microsecond:s,nanosecond:a}=pS(t,n,i,o,s,a,e)}else({hour:t,minute:n,second:i,millisecond:o,microsecond:s,nanosecond:a}=function(c){const u=ahe.exec(c);let f,h,p,y,g,w,v;if(u){f=En(u[1]),h=En(u[2]||u[5]),p=En(u[3]||u[6]),p===60&&(p=59);const m=(u[4]||u[7])+"000000000";y=En(m.slice(0,3)),g=En(m.slice(3,6)),w=En(m.slice(6,9)),v=u[14];for(const[,b,_,E]of v.matchAll(zh))if(_!=="u-ca"&&b==="!")throw new RangeError(`Unrecognized annotation: !${_}=${E}`);if(u[8])throw new RangeError("Z designator not supported for PlainTime")}else{let m,b;if({hasTime:b,hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w,z:m}=pd(c),!b)throw new RangeError(`time is missing in string: ${c}`);if(m)throw new RangeError("Z designator not supported for PlainTime")}if(/[tT ][0-9][0-9]/.test(c))return{hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w};try{const{month:m,day:b}=kC(c);td(1972,m,b)}catch{try{const{year:m,month:b}=$C(c);td(m,b,1)}catch{return{hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w}}}throw new RangeError(`invalid ISO 8601 time-only string ${c}; may need a T prefix`)}(bo(l))),$S(t,n,i,o,s,a);return new(Pe("%Temporal.PlainTime%"))(t,n,i,o,s,a)}function pb(r,e){if(Mr(r)){if(Qt(r))return r;const s=L_(r);return By(s,Ct(r,Sn(s,["month","monthCode","year"]),[]),e)}vn(e);let{year:t,month:n,referenceISODay:i,calendar:o}=$C(bo(r));if(o===void 0&&(o="iso8601"),!Ou(o))throw new RangeError(`invalid calendar identifier ${o}`);return o=rd(o),i===void 0?(td(t,n,1),Cw(t,n,o)):By(o,Cw(t,n,o,i))}function PA(r,e,t,n,i,o,s,a,l,d,c,u,f,h,p){const y=new(Pe("%Temporal.PlainDateTime%"))(r,e,t,n,i,o,s,a,l);if(d==="wall"||h==="ignore")return A(fo(u,y,f),tt);if(d==="exact"||h==="use"){const w=Ch(r,e,t,n,i,o,s,a,l);if(w===null)throw new RangeError("ZonedDateTime outside of supported range");return x.subtract(w,x.BigInt(c))}const g=IA(u,y);for(const w of g){const v=Yc(u,w),m=x.toNumber($s(x.BigInt(v),t7,"halfExpand"));if(v===c||p&&m===c)return A(w,tt)}if(h==="reject"){const w=SS(c),v=Qs(u)?A(u,El):"time zone";throw new RangeError(`Offset ${w} is invalid for ${y.toString()} in ${v}`)}return A(h7(g,u,y,f),tt)}function yb(r,e){let t,n,i,o,s,a,l,d,c,u,f,h,p,y,g=!1,w="option";if(Mr(r)){if(Fe(r))return r;h=L_(r);const m=Sn(h,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);m.push("timeZone","offset");const b=Ct(r,m,["timeZone"]);u=Ri(b.timeZone),f=b.offset,f===void 0&&(w="wall"),p=Vg(e),y=$A(e,"reject"),{year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c}=j_(h,b,e)}else{let m,b;if({year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c,ianaName:m,offset:f,z:b,calendar:h}=function(E){const S=pd(E);if(!S.ianaName)throw new RangeError("Temporal.ZonedDateTime requires a time zone ID in brackets");return S}(bo(r)),u=Ri(m),b?w="exact":f||(w="wall"),h||(h="iso8601"),!Ou(h))throw new RangeError(`invalid calendar identifier ${h}`);h=rd(h),g=!0,p=Vg(e),y=$A(e,"reject"),vn(e)}let v=0;return w==="option"&&(v=Oh(f)),ai(PA(t,n,i,o,s,a,l,d,c,w,v,u,p,y,g),u,h)}function o7(r,e,t,n,i){td(e,t,n),E7(e,t,n),hd(r),Pt(r,Me,e),Pt(r,Be,t),Pt(r,je,n),Pt(r,be,i),Pt(r,F9,!0)}function Aa(r,e,t,n="iso8601"){const i=Pe("%Temporal.PlainDate%"),o=Di(i.prototype);return o7(o,r,e,t,n),o}function s7(r,e,t,n,i,o,s,a,l,d,c){NC(e,t,n,i,o,s,a,l,d),A7(e,t,n,i,o,s,a,l,d),hd(r),Pt(r,Me,e),Pt(r,Be,t),Pt(r,je,n),Pt(r,Et,i),Pt(r,At,o),Pt(r,xt,s),Pt(r,St,a),Pt(r,Tt,l),Pt(r,$t,d),Pt(r,be,c)}function hs(r,e,t,n,i,o,s,a,l,d="iso8601"){const c=Pe("%Temporal.PlainDateTime%"),u=Di(c.prototype);return s7(u,r,e,t,n,i,o,s,a,l,d),u}function a7(r,e,t,n,i){td(i,e,t),E7(i,e,t),hd(r),Pt(r,Be,e),Pt(r,je,t),Pt(r,Me,i),Pt(r,be,n),Pt(r,V9,!0)}function Ow(r,e,t="iso8601",n=1972){const i=Pe("%Temporal.PlainMonthDay%"),o=Di(i.prototype);return a7(o,r,e,t,n),o}function c7(r,e,t,n,i){td(e,t,i),function(s,a){ui(s,EA,AA),s===EA?ui(a,4,12):s===AA&&ui(a,1,9)}(e,t),hd(r),Pt(r,Me,e),Pt(r,Be,t),Pt(r,je,i),Pt(r,be,n),Pt(r,q9,!0)}function Cw(r,e,t="iso8601",n=1){const i=Pe("%Temporal.PlainYearMonth%"),o=Di(i.prototype);return c7(o,r,e,t,n),o}function l7(r,e,t,n){Cp(e),hd(r),Pt(r,tt,e),Pt(r,hr,t),Pt(r,be,n);const i=new(Pe("%Temporal.Instant%"))(A(r,tt));Pt(r,Pi,i)}function ai(r,e,t="iso8601"){const n=Pe("%Temporal.ZonedDateTime%"),i=Di(n.prototype);return l7(i,r,e,t),i}function Sn(r,e){if(typeof r=="string"){const i=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.fields%"),i,[e])}const t=We(cr(r,"fields"),r,[e]),n=[];for(const i of t){if(typeof i!="string")throw new TypeError("bad return from calendar.fields()");J9.call(n,i)}return n}function My(r,e,t){if(typeof r=="string"){const i=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.mergeFields%"),i,[e,t])}const n=We(cr(r,"mergeFields"),r,[e,t]);if(!Mr(n))throw new TypeError("bad return from calendar.mergeFields()");return n}function di(r,e,t,n,i){let o=i;if(typeof r=="string"){const a=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.dateAdd%"),a,[e,t,n])}o===void 0&&(o=cr(r,"dateAdd"));const s=hS(o,r,[e,t,n]);if(!Nt(s))throw new TypeError("invalid result");return s}function Ih(r,e,t,n,i){let o=i;if(typeof r=="string"){const a=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.dateUntil%"),a,[e,t,n])}o===void 0&&(o=cr(r,"dateUntil"));const s=hS(o,r,[e,t,n]);if(!en(s))throw new TypeError("invalid result");return s}function yS(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.year%"),n,[e])}let t=We(cr(r,"year"),r,[e]);if(typeof t!="number")throw new TypeError("calendar year result must be an integer");if(!Ls(t))throw new RangeError("calendar year result must be an integer");return t}function mS(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.month%"),n,[e])}let t=We(cr(r,"month"),r,[e]);if(typeof t!="number")throw new TypeError("calendar month result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar month result must be a positive integer");return t}function N_(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.monthCode%"),n,[e])}let t=We(cr(r,"monthCode"),r,[e]);if(typeof t!="string")throw new TypeError("calendar monthCode result must be a string");return t}function U_(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.day%"),n,[e])}const t=We(cr(r,"day"),r,[e]);if(typeof t!="number")throw new TypeError("calendar day result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar day result must be a positive integer");return t}function gS(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.era%"),n,[e])}let t=We(cr(r,"era"),r,[e]);if(t===void 0)return t;if(typeof t!="string")throw new TypeError("calendar era result must be a string or undefined");return t}function vS(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.eraYear%"),n,[e])}let t=We(cr(r,"eraYear"),r,[e]);if(t===void 0)return t;if(typeof t!="number")throw new TypeError("calendar eraYear result must be an integer or undefined");if(!Ls(t))throw new RangeError("calendar eraYear result must be an integer or undefined");return t}function PC(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.dayOfWeek%"),n,[e])}const t=We(cr(r,"dayOfWeek"),r,[e]);if(typeof t!="number")throw new TypeError("calendar dayOfWeek result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar dayOfWeek result must be a positive integer");return t}function IC(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.dayOfYear%"),n,[e])}const t=We(cr(r,"dayOfYear"),r,[e]);if(typeof t!="number")throw new TypeError("calendar dayOfYear result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar dayOfYear result must be a positive integer");return t}function OC(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.weekOfYear%"),n,[e])}const t=We(cr(r,"weekOfYear"),r,[e]);if(typeof t!="number")throw new TypeError("calendar weekOfYear result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar weekOfYear result must be a positive integer");return t}function CC(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.yearOfWeek%"),n,[e])}const t=We(cr(r,"yearOfWeek"),r,[e]);if(typeof t!="number")throw new TypeError("calendar yearOfWeek result must be an integer");if(!Ls(t))throw new RangeError("calendar yearOfWeek result must be an integer");return t}function RC(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.daysInWeek%"),n,[e])}const t=We(cr(r,"daysInWeek"),r,[e]);if(typeof t!="number")throw new TypeError("calendar daysInWeek result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar daysInWeek result must be a positive integer");return t}function bS(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.daysInMonth%"),n,[e])}const t=We(cr(r,"daysInMonth"),r,[e]);if(typeof t!="number")throw new TypeError("calendar daysInMonth result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar daysInMonth result must be a positive integer");return t}function wS(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.daysInYear%"),n,[e])}const t=We(cr(r,"daysInYear"),r,[e]);if(typeof t!="number")throw new TypeError("calendar daysInYear result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar daysInYear result must be a positive integer");return t}function _S(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.monthsInYear%"),n,[e])}const t=We(cr(r,"monthsInYear"),r,[e]);if(typeof t!="number")throw new TypeError("calendar monthsInYear result must be a positive integer");if(!Ls(t)||t<1)throw new RangeError("calendar monthsInYear result must be a positive integer");return t}function ES(r,e){if(typeof r=="string"){const n=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.inLeapYear%"),n,[e])}const t=We(cr(r,"inLeapYear"),r,[e]);if(typeof t!="boolean")throw new TypeError("calendar inLeapYear result must be a boolean");return t}function bs(r){if(Mr(r)){if(Hn(r,be))return A(r,be);if(!function(i){return!!Xr(i)||"dateAdd"in i&&"dateFromFields"in i&&"dateUntil"in i&&"day"in i&&"dayOfWeek"in i&&"dayOfYear"in i&&"daysInMonth"in i&&"daysInWeek"in i&&"daysInYear"in i&&"fields"in i&&"id"in i&&"inLeapYear"in i&&"mergeFields"in i&&"month"in i&&"monthCode"in i&&"monthDayFromFields"in i&&"monthsInYear"in i&&"weekOfYear"in i&&"year"in i&&"yearMonthFromFields"in i&&"yearOfWeek"in i}(r))throw new TypeError("expected a Temporal.Calendar or object implementing the Temporal.Calendar protocol");return r}const e=bo(r);if(Ou(e))return rd(e);let t;try{({calendar:t}=pd(e))}catch{try{({calendar:t}=$C(e))}catch{({calendar:t}=kC(e))}}if(t||(t="iso8601"),!Ou(t))throw new RangeError(`invalid calendar identifier ${t}`);return rd(t)}function L_(r){if(Hn(r,be))return A(r,be);const{calendar:e}=r;return e===void 0?"iso8601":bs(e)}function fi(r){if(typeof r=="string")return r;const e=r.id;if(typeof e!="string")throw new TypeError("calendar.id should be a string");return e}function jv(r){return Mr(r)?r:new(Pe("%Temporal.Calendar%"))(r)}function K_(r,e){return r===e?!0:fi(r)===fi(e)}function AS(r,e,t){if(r===e)return;const n=fi(r),i=fi(e);if(n!==i)throw new RangeError(`cannot ${t} of ${n} and ${i} calendars`)}function d7(r,e){if(r===e)return e;const t=fi(r),n=fi(e);if(t===n||t==="iso8601")return e;if(n==="iso8601")return r;throw new RangeError("irreconcilable calendars")}function Pu(r,e,t,n){if(typeof r=="string"){const o=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.dateFromFields%"),o,[e,t])}const i=We(cr(r,"dateFromFields"),r,[e,t]);if(!Nt(i))throw new TypeError("invalid result");return i}function By(r,e,t){if(typeof r=="string"){const i=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.yearMonthFromFields%"),i,[e,t])}let n=We(cr(r,"yearMonthFromFields"),r,[e,t]);if(!Qt(n))throw new TypeError("invalid result");return n}function Wg(r,e,t){if(typeof r=="string"){const i=new(Pe("%Temporal.Calendar%"))(r);return We(Pe("%Temporal.Calendar.prototype.monthDayFromFields%"),i,[e,t])}let n=We(cr(r,"monthDayFromFields"),r,[e,t]);if(!Nn(n))throw new TypeError("invalid result");return n}function Ri(r){if(Mr(r)){if(Fe(r))return A(r,hr);if(!function(t){return!!Qs(t)||"getOffsetNanosecondsFor"in t&&"getPossibleInstantsFor"in t&&"id"in t}(r))throw new TypeError("expected a Temporal.TimeZone or object implementing the Temporal.TimeZone protocol");return r}return xhe(bo(r))}function Rw(r){if(typeof r=="string")return r;const e=r.id;if(typeof e!="string")throw new TypeError("timeZone.id should be a string");return e}function u7(r){return Mr(r)?r:new(Pe("%Temporal.TimeZone%"))(r)}function f7(r,e){return r===e?!0:Rw(r)===Rw(e)}function Hg(r){return Aa(A(r,Me),A(r,Be),A(r,je),A(r,be))}function DC(r){return new(Pe("%Temporal.PlainTime%"))(A(r,Et),A(r,At),A(r,xt),A(r,St),A(r,Tt),A(r,$t))}function Yc(r,e,t){if(typeof r=="string"){const i=new(Pe("%Temporal.TimeZone%"))(r);return We(Pe("%Temporal.TimeZone.prototype.getOffsetNanosecondsFor%"),i,[e])}const n=We(cr(r,"getOffsetNanosecondsFor"),r,[e]);if(typeof n!="number")throw new TypeError("bad return from getOffsetNanosecondsFor");if(!Ls(n)||Rr(n)>=864e11)throw new RangeError("out-of-range return from getOffsetNanosecondsFor");return n}function yI(r,e){return SS(Yc(r,e))}function Ds(r,e,t){const n=A(e,tt),i=Yc(r,e);let{year:o,month:s,day:a,hour:l,minute:d,second:c,millisecond:u,microsecond:f,nanosecond:h}=y7(n);return{year:o,month:s,day:a,hour:l,minute:d,second:c,millisecond:u,microsecond:f,nanosecond:h}=BC(o,s,a,l,d,c,u,f,h+i),hs(o,s,a,l,d,c,u,f,h,t)}function fo(r,e,t){return h7(IA(r,e),r,e,t)}function h7(r,e,t,n){const i=Pe("%Temporal.Instant%"),o=r.length;if(o===1)return r[0];if(o)switch(n){case"compatible":case"earlier":return r[0];case"later":return r[o-1];case"reject":throw new RangeError("multiple instants found")}const s=A(t,Me),a=A(t,Be),l=A(t,je),d=A(t,Et),c=A(t,At),u=A(t,xt),f=A(t,St),h=A(t,Tt),p=A(t,$t),y=Ch(s,a,l,d,c,u,f,h,p);if(y===null)throw new RangeError("DateTime outside of supported range");const g=new i(x.subtract(y,ed)),w=new i(x.add(y,ed)),v=Yc(e,g),m=Yc(e,w)-v;switch(n){case"earlier":{const b=A(t,be),_=Pe("%Temporal.PlainDateTime%"),E=bI(s,a,l,d,c,u,f,h,p,b,0,0,0,0,0,0,0,0,0,-m,void 0);return IA(e,new _(E.year,E.month,E.day,E.hour,E.minute,E.second,E.millisecond,E.microsecond,E.nanosecond,b))[0]}case"compatible":case"later":{const b=A(t,be),_=Pe("%Temporal.PlainDateTime%"),E=bI(s,a,l,d,c,u,f,h,p,b,0,0,0,0,0,0,0,0,0,m,void 0),S=IA(e,new _(E.year,E.month,E.day,E.hour,E.minute,E.second,E.millisecond,E.microsecond,E.nanosecond,b));return S[S.length-1]}case"reject":throw new RangeError("no such instant found")}}function IA(r,e,t){if(typeof r=="string"){const o=new(Pe("%Temporal.TimeZone%"))(r);return We(Pe("%Temporal.TimeZone.prototype.getPossibleInstantsFor%"),o,[e])}const n=We(cr(r,"getPossibleInstantsFor"),r,[e]),i=[];for(const o of n){if(!kn(o))throw new TypeError("bad return from getPossibleInstantsFor");J9.call(i,o)}return i}function nm(r){let e;return r<0||r>9999?e=(r<0?"-":"+")+`000000${Rr(r)}`.slice(-6):e=`0000${r}`.slice(-4),e}function qr(r){return`00${r}`.slice(-2)}function xS(r,e,t,n,i){if(i==="minute")return"";const o=`:${qr(r)}`;let s,a=1e6*e+1e3*t+n;if(i==="auto"){if(a===0)return o;for(s=`${a}`.padStart(9,"0");s[s.length-1]==="0";)s=s.slice(0,-1)}else{if(i===0)return o;s=`${a}`.padStart(9,"0").slice(0,i)}return`${o}.${s}`}function rB(r,e,t){let n=e;n===void 0&&(n="UTC");const i=Ds(n,r,"iso8601"),o=nm(A(i,Me)),s=qr(A(i,Be)),a=qr(A(i,je)),l=qr(A(i,Et)),d=qr(A(i,At)),c=xS(A(i,xt),A(i,St),A(i,Tt),A(i,$t),t);let u="Z";return e!==void 0&&(u=p7(Yc(n,r))),`${o}-${s}-${a}T${l}:${d}${c}${u}`}function y$(r,e="auto",t){function n(O){return O<=mhe?O.toString(10):x.BigInt(O).toString(10)}const i=A(r,to),o=A(r,Qn),s=A(r,No),a=A(r,ro),l=A(r,no),d=A(r,io);let c=A(r,oo),u=A(r,so),f=A(r,ao),h=A(r,co);const p=ql(i,o,s,a,l,d,c,u,f,h);if(t){const{unit:O,increment:M,roundingMode:Q}=t;({seconds:c,milliseconds:u,microseconds:f,nanoseconds:h}=Iu(0,0,0,0,0,0,c,u,f,h,M,O,Q))}const y=[];i&&y.push(`${n(Rr(i))}Y`),o&&y.push(`${n(Rr(o))}M`),s&&y.push(`${n(Rr(s))}W`),a&&y.push(`${n(Rr(a))}D`);const g=[];l&&g.push(`${n(Rr(l))}H`),d&&g.push(`${n(Rr(d))}M`);const w=[];let v,m,b,_,E=Gg(0,0,0,c,u,f,h,0);({quotient:E,remainder:v}=gn(E,rr)),{quotient:E,remainder:m}=gn(E,rr),{quotient:_,remainder:b}=gn(E,rr);const S=1e6*Rr(x.toNumber(b))+1e3*Rr(x.toNumber(m))+Rr(x.toNumber(v));let T;if(e==="auto"){if(S!==0)for(T=`${S}`.padStart(9,"0");T[T.length-1]==="0";)T=T.slice(0,-1)}else e!==0&&(T=`${S}`.padStart(9,"0").slice(0,e));return T&&w.unshift(".",T),x.equal(_,nn)&&!w.length&&e==="auto"||w.unshift(jc(_).toString()),w.length&&g.push(`${w.join("")}S`),g.length&&g.unshift("T"),y.length||g.length?`${p<0?"-":""}P${y.join("")}${g.join("")}`:"PT0S"}function nB(r,e="auto"){return`${nm(A(r,Me))}-${qr(A(r,Be))}-${qr(A(r,je))}${SC(A(r,be),e)}`}function iB(r,e,t="auto",n){let i=A(r,Me),o=A(r,Be),s=A(r,je),a=A(r,Et),l=A(r,At),d=A(r,xt),c=A(r,St),u=A(r,Tt),f=A(r,$t);if(n){const{unit:h,increment:p,roundingMode:y}=n;({year:i,month:o,day:s,hour:a,minute:l,second:d,millisecond:c,microsecond:u,nanosecond:f}=zC(i,o,s,a,l,d,c,u,f,p,h,y))}return`${nm(i)}-${qr(o)}-${qr(s)}T${qr(a)}:${qr(l)}${xS(d,c,u,f,e)}${SC(A(r,be),t)}`}function oB(r,e="auto"){let t=`${qr(A(r,Be))}-${qr(A(r,je))}`;const n=fi(A(r,be));(e==="always"||e==="critical"||n!=="iso8601")&&(t=`${nm(A(r,Me))}-${t}`);const i=TC(n,e);return i&&(t+=i),t}function sB(r,e="auto"){let t=`${nm(A(r,Me))}-${qr(A(r,Be))}`;const n=fi(A(r,be));(e==="always"||e==="critical"||n!=="iso8601")&&(t+=`-${qr(A(r,je))}`);const i=TC(n,e);return i&&(t+=i),t}function aB(r,e,t="auto",n="auto",i="auto",o){let s=A(r,Pi);if(o){const{unit:c,increment:u,roundingMode:f}=o,h=RA(A(r,tt),u,c,f);s=new(Pe("%Temporal.Instant%"))(h)}const a=A(r,hr),l=Ds(a,s,"iso8601");let d=`${nm(A(l,Me))}-${qr(A(l,Be))}-${qr(A(l,je))}T${qr(A(l,Et))}:${qr(A(l,At))}${xS(A(l,xt),A(l,St),A(l,Tt),A(l,$t),e)}`;return i!=="never"&&(d+=p7(Yc(a,s))),n!=="never"&&(d+=`[${n==="critical"?"!":""}${Rw(a)}]`),d+=SC(A(r,be),t),d}function Jm(r){return I7.test(C_(r))}function Oh(r){const e=I7.exec(C_(r));if(!e)throw new RangeError(`invalid time zone offset: ${r}`);return(e[1]==="-"||e[1]===""?-1:1)*(1e9*(60*(60*+e[2]+ +(e[3]||0))+ +(e[4]||0))+ +((e[5]||0)+"000000000").slice(0,9))}function MC(r){return Jm(r)?SS(Oh(r)):i7(C_(r)).resolvedOptions().timeZone}function bu(r,e){const{year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d,nanosecond:c}=m7(r,e),u=t%400,f=(t-u)/400,h=x.multiply(x.BigInt(146097),ed),p=Ch(u,n,i,o,s,a,l,d,c),y=x.add(p,x.multiply(h,x.BigInt(f)));return x.toNumber(x.subtract(y,e))}function SS(r){const e=r<0?"-":"+",t=Rr(r),n=t%1e9,i=ms(t/1e9)%60,o=ms(t/6e10)%60,s=qr(ms(t/36e11)),a=qr(o),l=qr(i);let d="";if(n){let c=`${n}`.padStart(9,"0");for(;c[c.length-1]==="0";)c=c.slice(0,-1);d=`:${l}.${c}`}else i&&(d=`:${l}`);return`${e}${s}:${a}${d}`}function p7(r){let e=x.toNumber($s(x.BigInt(r),t7,"halfExpand"));const t=e<0?"-":"+";e=Rr(e);const n=e/6e10%60;return`${t}${qr(ms(e/36e11))}:${qr(n)}`}function Ch(r,e,t,n,i,o,s,a,l){const d=new Date;d.setUTCHours(n,i,o,s),d.setUTCFullYear(r,e-1,t);const c=d.getTime();if(fS(c))return null;let u=x.multiply(x.BigInt(c),ba);return u=x.add(u,x.multiply(x.BigInt(a),rr)),u=x.add(u,x.BigInt(l)),x.lessThan(u,Iw)||x.greaterThan(u,Fg)?null:u}function y7(r){const{quotient:e,remainder:t}=gn(r,ba);let n=x.toNumber(e),i=x.toNumber(t);i<0&&(i+=1e6,n-=1);const o=ms(i/1e3)%1e3,s=i%1e3,a=new Date(n);return{epochMilliseconds:n,year:a.getUTCFullYear(),month:a.getUTCMonth()+1,day:a.getUTCDate(),hour:a.getUTCHours(),minute:a.getUTCMinutes(),second:a.getUTCSeconds(),millisecond:a.getUTCMilliseconds(),microsecond:o,nanosecond:s}}function m7(r,e){const{epochMilliseconds:t,millisecond:n,microsecond:i,nanosecond:o}=y7(e),{year:s,month:a,day:l,hour:d,minute:c,second:u}=function(h,p){const y=i7(h).format(new Date(p));return function(w){const v=w.split(/[^\w]+/);if(v.length!==7)throw new RangeError(`expected 7 parts in "${w}`);const m=+v[0],b=+v[1];let _=+v[2];const E=v[3].toUpperCase();if(E==="B"||E==="BC")_=1-_;else if(E!=="A"&&E!=="AD")throw new RangeError(`Unknown era ${E} in "${w}`);let S=+v[4];S===24&&(S=0);const T=+v[5],O=+v[6];if(!(uo(_)&&uo(m)&&uo(b)&&uo(S)&&uo(T)&&uo(O)))throw new RangeError(`Invalid number in "${w}`);return{year:_,month:m,day:b,hour:S,minute:T,second:O}}(y)}(r,t);return BC(s,a,l,d,c,u,n,i,o)}function cB(r,e){return x.lessThan(r,e)?e:r}function g7(){return x.add(qC(),whe)}function v7(r,e){if(x.lessThan(e,lg))return v7(r,lg);const t=x.add(e,r7),n=cB(g7(),t);let i=cB(lg,e);const o=bu(r,i);let s=i,a=o;for(;o===a&&x.lessThan(x.BigInt(i),n);){if(s=x.add(i,n7),x.greaterThan(s,Fg))return null;a=bu(r,s),o===a&&(i=s)}return o===a?null:O7(l=>bu(r,l),i,s,o,a)}function mI(r,e){const t=g7(),n=x.greaterThan(e,t),i=n?x.subtract(e,r7):lg;if(r==="Africa/Casablanca"||r==="Africa/El_Aaiun"){const d=A(Nc("2088-01-01T00Z"),tt);if(x.lessThan(d,e))return mI(r,d)}let o=x.subtract(e,Rv);if(x.lessThan(o,lg))return null;const s=bu(r,o);let a=o,l=s;for(;s===l&&x.greaterThan(o,i);){if(a=x.subtract(o,n7),x.lessThan(a,lg))return null;l=bu(r,a),s===l&&(o=a)}if(s===l){if(n){const d=x.subtract(t,ed);return mI(r,d)}return null}return O7(d=>bu(r,d),a,o,l,s)}function Rh(r){return r===void 0?!1:r%4==0&&(r%100!=0||r%400==0)}function wu(r,e){return{standard:[31,28,31,30,31,30,31,31,30,31,30,31],leapyear:[31,29,31,30,31,30,31,31,30,31,30,31]}[Rh(r)?"leapyear":"standard"][e-1]}function gI(r,e,t){const n=e+(e<3?10:-2),i=r-(e<3?1:0),o=ms(i/100),s=i-100*o,a=(t+ms(2.6*n-.2)+(s+ms(s/4))+(ms(o/4)-2*o))%7;return a+(a<=0?7:0)}function OA(r,e,t){let n=t;for(let i=e-1;i>0;i--)n+=wu(r,i);return n}function lB(r,e,t){const n=OA(r,e,t),i=gI(r,e,t)||7,o=gI(r,1,1),s=ms((n-i+10)/7);return s<1?o===5||o===6&&Rh(r-1)?{week:53,year:r-1}:{week:52,year:r-1}:s===53&&(Rh(r)?366:365)-n<4-i?{week:1,year:r+1}:{week:s,year:r}}function ql(r,e,t,n,i,o,s,a,l,d){for(const c of[r,e,t,n,i,o,s,a,l,d])if(c!==0)return c<0?-1:1;return 0}function sE(r,e){let t=r,n=e;if(!uo(t)||!uo(n))throw new RangeError("infinity is out of range");return n-=1,t+=ms(n/12),n%=12,n<0&&(n+=12),n+=1,{year:t,month:n}}function TS(r,e,t){let n=r,i=e,o=t;if(!uo(o))throw new RangeError("infinity is out of range");({year:n,month:i}=sE(n,i));const s=146097;if(Rr(o)>s){const d=Hp(o/s);n+=400*d,o-=d*s}let a=0,l=i>2?n:n-1;for(;a=Rh(l)?366:365,o<-a;)n-=1,l-=1,o+=a;for(l+=1;a=Rh(l)?366:365,o>a;)n+=1,l+=1,o-=a;for(;o<1;)({year:n,month:i}=sE(n,i-1)),o+=wu(n,i);for(;o>wu(n,i);)o-=wu(n,i),{year:n,month:i}=sE(n,i+1);return{year:n,month:i,day:o}}function BC(r,e,t,n,i,o,s,a,l){const{deltaDays:d,hour:c,minute:u,second:f,millisecond:h,microsecond:p,nanosecond:y}=tu(n,i,o,s,a,l),{year:g,month:w,day:v}=TS(r,e,t+d);return{year:g,month:w,day:v,hour:c,minute:u,second:f,millisecond:h,microsecond:p,nanosecond:y}}function tu(r,e,t,n,i,o){let s,a=x.BigInt(r),l=x.BigInt(e),d=x.BigInt(t),c=x.BigInt(n),u=x.BigInt(i),f=x.BigInt(o);return{quotient:s,remainder:f}=vp(f,rr),u=x.add(u,s),{quotient:s,remainder:u}=vp(u,rr),c=x.add(c,s),{quotient:s,remainder:c}=vp(c,rr),d=x.add(d,s),{quotient:s,remainder:d}=vp(d,zl),l=x.add(l,s),{quotient:s,remainder:l}=vp(l,zl),a=x.add(a,s),{quotient:s,remainder:a}=vp(a,Q9),{deltaDays:x.toNumber(s),hour:x.toNumber(a),minute:x.toNumber(l),second:x.toNumber(d),millisecond:x.toNumber(c),microsecond:x.toNumber(u),nanosecond:x.toNumber(f)}}function Gg(r,e,t,n,i,o,s,a){const l=x.BigInt(r);let d=x.BigInt(s);r!==0&&(d=x.subtract(x.BigInt(s),x.BigInt(a)));const c=x.add(x.BigInt(e),x.multiply(l,x.BigInt(24))),u=x.add(x.BigInt(t),x.multiply(c,zl)),f=x.add(x.BigInt(n),x.multiply(u,zl)),h=x.add(x.BigInt(i),x.multiply(f,rr)),p=x.add(x.BigInt(o),x.multiply(h,rr));return x.add(x.BigInt(d),x.multiply(p,rr))}function jC(r,e){const t=Pe("%Temporal.Instant%"),n=zg(x.toNumber(r));let i=x.BigInt(r),o=864e11;if(n===0)return{days:0,nanoseconds:nn,dayLengthNs:o};if(!Fe(e)){let m;return{quotient:m,remainder:i}=gn(i,x.BigInt(o)),{days:x.toNumber(m),nanoseconds:i,dayLengthNs:o}}const s=A(e,tt),a=A(e,Pi),l=x.add(s,i),d=new t(l),c=A(e,hr),u=A(e,be),f=Ds(c,a,u),h=Ds(c,d,u);let{days:p}=KC(A(f,Me),A(f,Be),A(f,je),A(f,Et),A(f,At),A(f,xt),A(f,St),A(f,Tt),A(f,$t),A(h,Me),A(h,Be),A(h,je),A(h,Et),A(h,At),A(h,xt),A(h,St),A(h,Tt),A(h,$t),u,"day",Di(null)),y=_a(a,c,u,0,0,0,p,0,0,0,0,0,0),g=x.BigInt(p);if(n===1)for(;x.greaterThan(g,nn)&&x.greaterThan(y,l);)g=x.subtract(g,Rv),y=_a(a,c,u,0,0,0,x.toNumber(g),0,0,0,0,0,0);i=x.subtract(l,y);let w=!1,v=new t(y);do{const m=_a(v,c,u,0,0,0,n,0,0,0,0,0,0),b=A(v,tt);o=x.toNumber(x.subtract(m,b)),w=x.greaterThanOrEqual(x.multiply(x.subtract(i,x.BigInt(o)),x.BigInt(n)),nn),w&&(i=x.subtract(i,x.BigInt(o)),v=new t(m),g=x.add(g,x.BigInt(n)))}while(w);if(!na(g)&&Y8(g)!==n)throw new RangeError("Time zone or calendar converted nanoseconds into a number of days with the opposite sign");if(!na(i)&&Y8(i)!==n)throw xA(i)&&n===1?new Error("assert not reached"):new RangeError("Time zone or calendar ended up with a remainder of nanoseconds with the opposite sign");if(x.greaterThanOrEqual(jc(i),jc(x.BigInt(o))))throw new Error("assert not reached");return{days:x.toNumber(g),nanoseconds:i,dayLengthNs:Rr(o)}}function uc(r,e,t,n,i,o,s,a,l){let d=b7(r,e,t,n,i,o,s,a,l);if(d==="positive overflow"||d==="negative overflow")throw new RangeError("Duration out of range");return d}function b7(r,e,t,n,i,o,s,a,l){let d,c,u,f,h,p,y=r;if(Fe(l)){const S=_a(A(l,Pi),A(l,hr),A(l,be),0,0,0,y,e,t,n,i,o,s),T=A(l,tt);d=x.subtract(S,T)}else d=Gg(y,e,t,n,i,o,s,0);a==="year"||a==="month"||a==="week"||a==="day"?{days:y,nanoseconds:d}=jC(d,l):y=0;const g=x.lessThan(d,nn)?-1:1;switch(d=jc(d),c=u=f=h=p=nn,a){case"year":case"month":case"week":case"day":case"hour":({quotient:c,remainder:d}=gn(d,rr)),{quotient:u,remainder:c}=gn(c,rr),{quotient:f,remainder:u}=gn(u,rr),{quotient:h,remainder:f}=gn(f,zl),{quotient:p,remainder:h}=gn(h,zl);break;case"minute":({quotient:c,remainder:d}=gn(d,rr)),{quotient:u,remainder:c}=gn(c,rr),{quotient:f,remainder:u}=gn(u,rr),{quotient:h,remainder:f}=gn(f,zl);break;case"second":({quotient:c,remainder:d}=gn(d,rr)),{quotient:u,remainder:c}=gn(c,rr),{quotient:f,remainder:u}=gn(u,rr);break;case"millisecond":({quotient:c,remainder:d}=gn(d,rr)),{quotient:u,remainder:c}=gn(c,rr);break;case"microsecond":({quotient:c,remainder:d}=gn(d,rr));break;case"nanosecond":break;default:throw new Error("assert not reached")}const w=x.toNumber(p)*g,v=x.toNumber(h)*g,m=x.toNumber(f)*g,b=x.toNumber(u)*g,_=x.toNumber(c)*g,E=x.toNumber(d)*g;for(const S of[y,w,v,m,b,_,E])if(!uo(S))return g===1?"positive overflow":"negative overflow";return{days:y,hours:w,minutes:v,seconds:m,milliseconds:b,microseconds:_,nanoseconds:E}}function K1(r,e,t,n,i,o){const s=Pe("%Temporal.Duration%"),a=ql(r,e,t,n,0,0,0,0,0,0);if(a===0)return{years:r,months:e,weeks:t,days:n};const l=x.BigInt(a);let d,c,u=x.BigInt(r),f=x.BigInt(e),h=x.BigInt(t),p=x.BigInt(n);o&&(c=yr(o),d=A(c,be));const y=new s(a),g=new s(0,a),w=new s(0,0,a);switch(i){case"year":break;case"month":{if(!d)throw new RangeError("a starting point is required for months balancing");let v,m;for(typeof d!="string"&&(v=cr(d,"dateAdd"),m=cr(d,"dateUntil"));!na(u);){const b=di(d,c,y,void 0,v),_=Di(null);_.largestUnit="month";const E=Ih(d,c,b,_,m),S=x.BigInt(A(E,Qn));c=b,f=x.add(f,S),u=x.subtract(u,l)}}break;case"week":{if(!d)throw new RangeError("a starting point is required for weeks balancing");const v=typeof d!="string"?cr(d,"dateAdd"):void 0;for(;!na(u);){let m;({relativeTo:c,days:m}=Ai(d,c,y,v)),p=x.add(p,x.BigInt(m)),u=x.subtract(u,l)}for(;!na(f);){let m;({relativeTo:c,days:m}=Ai(d,c,g,v)),p=x.add(p,x.BigInt(m)),f=x.subtract(f,l)}break}default:{if(na(u)&&na(f)&&na(h))break;if(!d)throw new RangeError("a starting point is required for balancing calendar units");const v=typeof d!="string"?cr(d,"dateAdd"):void 0;for(;!na(u);){let m;({relativeTo:c,days:m}=Ai(d,c,y,v)),p=x.add(p,x.BigInt(m)),u=x.subtract(u,l)}for(;!na(f);){let m;({relativeTo:c,days:m}=Ai(d,c,g,v)),p=x.add(p,x.BigInt(m)),f=x.subtract(f,l)}for(;!na(h);){let m;({relativeTo:c,days:m}=Ai(d,c,w,v)),p=x.add(p,x.BigInt(m)),h=x.subtract(h,l)}break}}return{years:x.toNumber(u),months:x.toNumber(f),weeks:x.toNumber(h),days:x.toNumber(p)}}function dB(r,e,t,n,i){if(Fe(r)){const o=A(r,Pi),s=A(r,hr),a=A(r,be),l=Yc(s,o),d=_a(o,s,a,e,t,n,i,0,0,0,0,0,0);return Yc(s,new(Pe("%Temporal.Instant%"))(d))-l}return 0}function w7(r){return new(Pe("%Temporal.Duration%"))(-A(r,to),-A(r,Qn),-A(r,No),-A(r,ro),-A(r,no),-A(r,io),-A(r,oo),-A(r,so),-A(r,ao),-A(r,co))}function ps(r,e,t){return hhe(t,phe(e,r))}function _7(r,e,t){const n=ps(e,1,12);return{year:r,month:n,day:ps(t,1,wu(r,n))}}function ui(r,e,t){if(r<e||r>t)throw new RangeError(`value out of range: ${e} <= ${r} <= ${t}`)}function td(r,e,t){ui(e,1,12),ui(t,1,wu(r,e))}function E7(r,e,t){A7(r,e,t,12,0,0,0,0,0)}function $S(r,e,t,n,i,o){ui(r,0,23),ui(e,0,59),ui(t,0,59),ui(n,0,999),ui(i,0,999),ui(o,0,999)}function NC(r,e,t,n,i,o,s,a,l){td(r,e,t),$S(n,i,o,s,a,l)}function A7(r,e,t,n,i,o,s,a,l){if(ui(r,EA,AA),r===EA&&Ch(r,e,t+1,n,i,o,s,a,l-1)==null||r===AA&&Ch(r,e,t-1,n,i,o,s,a,l+1)==null)throw new RangeError("DateTime outside of supported range")}function Cp(r){if(x.lessThan(r,Iw)||x.greaterThan(r,Fg))throw new RangeError("Instant outside of supported range")}function CA(r,e,t,n,i,o,s,a,l,d){const c=ql(r,e,t,n,i,o,s,a,l,d);for(const u of[r,e,t,n,i,o,s,a,l,d]){if(!uo(u))throw new RangeError("infinite values not allowed as duration fields");const f=zg(u);if(f!==0&&f!==c)throw new RangeError("mixed-sign values not allowed as duration fields")}}function UC(r,e,t,n,i,o,s){switch(s){case"year":case"month":{const a=-sh(r,e,t,n,i,o);if(a===0)return{years:0,months:0,weeks:0,days:0};const l={year:r,month:e,day:t},d={year:n,month:i,day:o};let c=d.year-l.year,u=dy(r,e,t,c,0,0,0,"constrain"),f=-sh(u.year,u.month,u.day,n,i,o);if(f===0)return s==="year"?{years:c,months:0,weeks:0,days:0}:{years:0,months:12*c,weeks:0,days:0};let h=d.month-l.month;if(f!==a&&(c-=a,h+=12*a),u=dy(r,e,t,c,h,0,0,"constrain"),f=-sh(u.year,u.month,u.day,n,i,o),f===0)return s==="year"?{years:c,months:h,weeks:0,days:0}:{years:0,months:h+12*c,weeks:0,days:0};f!==a&&(h-=a,h===-a&&(c-=a,h=11*a),u=dy(r,e,t,c,h,0,0,"constrain"));let p=0;return p=u.month===d.month?d.day-u.day:a<0?-u.day-(wu(d.year,d.month)-d.day):d.day+(wu(u.year,u.month)-u.day),s==="month"&&(h+=12*c,c=0),{years:c,months:h,weeks:0,days:p}}case"week":case"day":{let a,l,d;sh(r,e,t,n,i,o)<0?(l={year:r,month:e,day:t},a={year:n,month:i,day:o},d=1):(l={year:n,month:i,day:o},a={year:r,month:e,day:t},d=-1);let c=OA(a.year,a.month,a.day)-OA(l.year,l.month,l.day);for(let f=l.year;f<a.year;++f)c+=Rh(f)?366:365;let u=0;return s==="week"&&(u=ms(c/7),c%=7),u*=d,c*=d,{years:0,months:0,weeks:u,days:c}}default:throw new Error("assert not reached")}}function x7(r,e,t,n,i,o,s,a,l,d,c,u){let f=s-r,h=a-e,p=l-t,y=d-n,g=c-i,w=u-o;const v=ql(0,0,0,0,f,h,p,y,g,w);f*=v,h*=v,p*=v,y*=v,g*=v,w*=v;let m=0;if({deltaDays:m,hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w}=tu(f,h,p,y,g,w),m!=0)throw new Error("assertion failure in DifferenceTime: _bt_.[[Days]] should be 0");return f*=v,h*=v,p*=v,y*=v,g*=v,w*=v,{hours:f,minutes:h,seconds:p,milliseconds:y,microseconds:g,nanoseconds:w}}function LC(r,e,t,n,i,o){const s=x.subtract(e,r);let a=0,l=0,d=x.toNumber(x.remainder(s,rr)),c=x.toNumber(x.remainder(x.divide(s,rr),rr)),u=x.toNumber(x.remainder(x.divide(s,ba),rr)),f=x.toNumber(x.divide(s,Fl));return{hours:a,minutes:l,seconds:f,milliseconds:u,microseconds:c,nanoseconds:d}=Iu(0,0,0,0,0,0,f,u,c,d,t,n,o),uc(0,a,l,f,u,c,d,i)}function KC(r,e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g,w,v,m,b){let _=r,E=e,S=t,{hours:T,minutes:O,seconds:M,milliseconds:Q,microseconds:W,nanoseconds:U}=x7(n,i,o,s,a,l,f,h,p,y,g,w);const ee=ql(0,0,0,0,T,O,M,Q,W,U);sh(d,c,u,_,E,S)===-ee&&({year:_,month:E,day:S}=TS(_,E,S-ee),{hours:T,minutes:O,seconds:M,milliseconds:Q,microseconds:W,nanoseconds:U}=uc(-ee,T,O,M,Q,W,U,m));const R=Aa(_,E,S,v),z=Aa(d,c,u,v),K=Dy("day",m),Y=Fh(b);Y.largestUnit=K;let{years:I,months:D,weeks:N,days:V}=Ih(v,R,z,Y);return{days:V,hours:T,minutes:O,seconds:M,milliseconds:Q,microseconds:W,nanoseconds:U}=uc(V,T,O,M,Q,W,U,m),{years:I,months:D,weeks:N,days:V,hours:T,minutes:O,seconds:M,milliseconds:Q,microseconds:W,nanoseconds:U}}function S7(r,e,t,n,i,o){const s=x.subtract(e,r);if(x.equal(s,nn))return{years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0,microseconds:0,nanoseconds:0};const a=Pe("%Temporal.Instant%"),l=new a(r),d=new a(e),c=Ds(t,l,n),u=Ds(t,d,n);let{years:f,months:h,weeks:p,days:y}=KC(A(c,Me),A(c,Be),A(c,je),A(c,Et),A(c,At),A(c,xt),A(c,St),A(c,Tt),A(c,$t),A(u,Me),A(u,Be),A(u,je),A(u,Et),A(u,At),A(u,xt),A(u,St),A(u,Tt),A(u,$t),n,i,o);const g=_a(l,t,n,f,h,p,0,0,0,0,0,0,0);let w=x.subtract(e,g);const v=ai(g,t,n);({nanoseconds:w,days:y}=jC(w,v));const{hours:m,minutes:b,seconds:_,milliseconds:E,microseconds:S,nanoseconds:T}=uc(0,0,0,0,0,0,x.toNumber(w),"hour");return{years:f,months:h,weeks:p,days:y,hours:m,minutes:b,seconds:_,milliseconds:E,microseconds:S,nanoseconds:T}}function Nv(r,e,t,n,i,o){const s=R_.reduce((h,p)=>{const y=p[0],g=p[1],w=p[2];return t!=="datetime"&&w!==t||n.includes(g)||h.push(g,y),h},[]);let a=gs(e,"largestUnit",t,"auto");if(n.includes(a))throw new RangeError(`largestUnit must be one of ${s.join(", ")}, not ${a}`);const l=Mv(e);let d=Gc(e,"trunc");r==="since"&&(d=function(p){switch(p){case"ceil":return"floor";case"floor":return"ceil";case"halfCeil":return"halfFloor";case"halfFloor":return"halfCeil";default:return p}}(d));const c=gs(e,"smallestUnit",t,i);if(n.includes(c))throw new RangeError(`smallestUnit must be one of ${s.join(", ")}, not ${c}`);const u=Dy(o,c);if(a==="auto"&&(a=u),Dy(a,c)!==a)throw new RangeError(`largestUnit ${a} cannot be smaller than smallestUnit ${c}`);const f={hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[c];return f!==void 0&&Bv(l,f,!1),{largestUnit:a,roundingIncrement:l,roundingMode:d,smallestUnit:c}}function uB(r,e,t,n){const i=r==="since"?-1:1,o=Nc(t),s=Nv(r,Fh(n),"time",[],"nanosecond","second"),a=A(e,tt),l=A(o,tt);let{hours:d,minutes:c,seconds:u,milliseconds:f,microseconds:h,nanoseconds:p}=LC(a,l,s.roundingIncrement,s.smallestUnit,s.largestUnit,s.roundingMode);return new(Pe("%Temporal.Duration%"))(0,0,0,0,i*d,i*c,i*u,i*f,i*h,i*p)}function fB(r,e,t,n){const i=r==="since"?-1:1,o=yr(t),s=A(e,be);AS(s,A(o,be),"compute difference between dates");const a=Fh(n),l=Nv(r,a,"date",[],"day","day");a.largestUnit=l.largestUnit;let{years:d,months:c,weeks:u,days:f}=Ih(s,e,o,a);return l.smallestUnit==="day"&&l.roundingIncrement===1||({years:d,months:c,weeks:u,days:f}=Iu(d,c,u,f,0,0,0,0,0,0,l.roundingIncrement,l.smallestUnit,l.roundingMode,e)),new(Pe("%Temporal.Duration%"))(i*d,i*c,i*u,i*f,0,0,0,0,0,0)}function hB(r,e,t,n){const i=r==="since"?-1:1,o=Gp(t),s=A(e,be);AS(s,A(o,be),"compute difference between dates");const a=Fh(n),l=Nv(r,a,"datetime",[],"nanosecond","day");let{years:d,months:c,weeks:u,days:f,hours:h,minutes:p,seconds:y,milliseconds:g,microseconds:w,nanoseconds:v}=KC(A(e,Me),A(e,Be),A(e,je),A(e,Et),A(e,At),A(e,xt),A(e,St),A(e,Tt),A(e,$t),A(o,Me),A(o,Be),A(o,je),A(o,Et),A(o,At),A(o,xt),A(o,St),A(o,Tt),A(o,$t),s,l.largestUnit,a);const m=Hg(e);return{years:d,months:c,weeks:u,days:f,hours:h,minutes:p,seconds:y,milliseconds:g,microseconds:w,nanoseconds:v}=Iu(d,c,u,f,h,p,y,g,w,v,l.roundingIncrement,l.smallestUnit,l.roundingMode,m),{days:f,hours:h,minutes:p,seconds:y,milliseconds:g,microseconds:w,nanoseconds:v}=uc(f,h,p,y,g,w,v,l.largestUnit),new(Pe("%Temporal.Duration%"))(i*d,i*c,i*u,i*f,i*h,i*p,i*y,i*g,i*w,i*v)}function pB(r,e,t,n){const i=r==="since"?-1:1,o=pu(t),s=Nv(r,Fh(n),"time",[],"nanosecond","hour");let{hours:a,minutes:l,seconds:d,milliseconds:c,microseconds:u,nanoseconds:f}=x7(A(e,Et),A(e,At),A(e,xt),A(e,St),A(e,Tt),A(e,$t),A(o,Et),A(o,At),A(o,xt),A(o,St),A(o,Tt),A(o,$t));return{hours:a,minutes:l,seconds:d,milliseconds:c,microseconds:u,nanoseconds:f}=Iu(0,0,0,0,a,l,d,c,u,f,s.roundingIncrement,s.smallestUnit,s.roundingMode),{hours:a,minutes:l,seconds:d,milliseconds:c,microseconds:u,nanoseconds:f}=uc(0,a,l,d,c,u,f,s.largestUnit),new(Pe("%Temporal.Duration%"))(0,0,0,0,i*a,i*l,i*d,i*c,i*u,i*f)}function yB(r,e,t,n){const i=r==="since"?-1:1,o=pb(t),s=A(e,be);AS(s,A(o,be),"compute difference between months");const a=Fh(n),l=Nv(r,a,"date",["week","day"],"month","year");a.largestUnit=l.largestUnit;const d=Sn(s,["monthCode","year"]),c=Ct(e,d,[]);c.day=1;const u=Pu(s,c),f=Ct(o,d,[]);f.day=1;const h=Pu(s,f);let{years:p,months:y}=Ih(s,u,h,a);return l.smallestUnit==="month"&&l.roundingIncrement===1||({years:p,months:y}=Iu(p,y,0,0,0,0,0,0,0,0,l.roundingIncrement,l.smallestUnit,l.roundingMode,u)),new(Pe("%Temporal.Duration%"))(i*p,i*y,0,0,0,0,0,0,0,0)}function mB(r,e,t,n){const i=r==="since"?-1:1,o=yb(t),s=A(e,be);AS(s,A(o,be),"compute difference between dates");const a=Fh(n),l=Nv(r,a,"datetime",[],"nanosecond","hour");a.largestUnit=l.largestUnit;const d=A(e,tt),c=A(o,tt);let u,f,h,p,y,g,w,v,m,b;if(l.largestUnit!=="year"&&l.largestUnit!=="month"&&l.largestUnit!=="week"&&l.largestUnit!=="day")u=0,f=0,h=0,p=0,{hours:y,minutes:g,seconds:w,milliseconds:v,microseconds:m,nanoseconds:b}=LC(d,c,l.roundingIncrement,l.smallestUnit,l.largestUnit,l.roundingMode);else{const _=A(e,hr);if(!f7(_,A(o,hr)))throw new RangeError("When calculating difference between time zones, largestUnit must be 'hours' or smaller because day lengths can vary between time zones due to DST or time zone offset changes.");({years:u,months:f,weeks:h,days:p,hours:y,minutes:g,seconds:w,milliseconds:v,microseconds:m,nanoseconds:b}=S7(d,c,_,s,l.largestUnit,a)),{years:u,months:f,weeks:h,days:p,hours:y,minutes:g,seconds:w,milliseconds:v,microseconds:m,nanoseconds:b}=Iu(u,f,h,p,y,g,w,v,m,b,l.roundingIncrement,l.smallestUnit,l.roundingMode,e),{years:u,months:f,weeks:h,days:p,hours:y,minutes:g,seconds:w,milliseconds:v,microseconds:m,nanoseconds:b}=P7(u,f,h,p,y,g,w,v,m,b,l.roundingIncrement,l.smallestUnit,l.roundingMode,e)}return new(Pe("%Temporal.Duration%"))(i*u,i*f,i*h,i*p,i*y,i*g,i*w,i*v,i*m,i*b)}function dy(r,e,t,n,i,o,s,a){let l=r,d=e,c=t,u=o,f=s;return l+=n,d+=i,{year:l,month:d}=sE(l,d),{year:l,month:d,day:c}=TA(l,d,c,a),f+=7*u,c+=f,{year:l,month:d,day:c}=TS(l,d,c),{year:l,month:d,day:c}}function T7(r,e,t,n,i,o,s,a,l,d,c,u){let f=r,h=e,p=t,y=n,g=i,w=o;f+=s,h+=a,p+=l,y+=d,g+=c,w+=u;let v=0;return{deltaDays:v,hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w}=tu(f,h,p,y,g,w),{deltaDays:v,hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w}}function $7(r,e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g,w,v,m,b){const _=Dy(pI(r,e,t,n,i,o,s,a,l,d),pI(c,u,f,h,p,y,g,w,v,m));let E,S,T,O,M,Q,W,U,ee,R;if(b)if(Nt(b)){const z=Pe("%Temporal.Duration%"),K=A(b,be),Y=new z(r,e,t,n,0,0,0,0,0,0),I=new z(c,u,f,h,0,0,0,0,0,0),D=typeof K!="string"?cr(K,"dateAdd"):void 0,N=di(K,b,Y,void 0,D),V=di(K,N,I,void 0,D),J=Dy("day",_),j=Di(null);j.largestUnit=J,{years:E,months:S,weeks:T,days:O}=Ih(K,b,V,j),{days:O,hours:M,minutes:Q,seconds:W,milliseconds:U,microseconds:ee,nanoseconds:R}=uc(O,x.add(x.BigInt(i),x.BigInt(p)),x.add(x.BigInt(o),x.BigInt(y)),x.add(x.BigInt(s),x.BigInt(g)),x.add(x.BigInt(a),x.BigInt(w)),x.add(x.BigInt(l),x.BigInt(v)),x.add(x.BigInt(d),x.BigInt(m)),_)}else{const z=Pe("%Temporal.Instant%"),K=A(b,hr),Y=A(b,be),I=_a(A(b,Pi),K,Y,r,e,t,n,i,o,s,a,l,d),D=_a(new z(I),K,Y,c,u,f,h,p,y,g,w,v,m);_!=="year"&&_!=="month"&&_!=="week"&&_!=="day"?(E=0,S=0,T=0,O=0,{hours:M,minutes:Q,seconds:W,milliseconds:U,microseconds:ee,nanoseconds:R}=LC(A(b,tt),D,1,"nanosecond",_,"halfExpand")):{years:E,months:S,weeks:T,days:O,hours:M,minutes:Q,seconds:W,milliseconds:U,microseconds:ee,nanoseconds:R}=S7(A(b,tt),D,K,Y,_,Di(null))}else{if(_==="year"||_==="month"||_==="week")throw new RangeError("relativeTo is required for years, months, or weeks arithmetic");E=S=T=0,{days:O,hours:M,minutes:Q,seconds:W,milliseconds:U,microseconds:ee,nanoseconds:R}=uc(n+h,x.add(x.BigInt(i),x.BigInt(p)),x.add(x.BigInt(o),x.BigInt(y)),x.add(x.BigInt(s),x.BigInt(g)),x.add(x.BigInt(a),x.BigInt(w)),x.add(x.BigInt(l),x.BigInt(v)),x.add(x.BigInt(d),x.BigInt(m)),_)}return CA(E,S,T,O,M,Q,W,U,ee,R),{years:E,months:S,weeks:T,days:O,hours:M,minutes:Q,seconds:W,milliseconds:U,microseconds:ee,nanoseconds:R}}function vI(r,e,t,n,i,o,s){let a=nn;a=x.add(a,x.BigInt(s)),a=x.add(a,x.multiply(x.BigInt(o),rr)),a=x.add(a,x.multiply(x.BigInt(i),ba)),a=x.add(a,x.multiply(x.BigInt(n),Fl)),a=x.add(a,x.multiply(x.BigInt(t),x.BigInt(6e10))),a=x.add(a,x.multiply(x.BigInt(e),x.BigInt(36e11)));const l=x.add(r,a);return Cp(l),l}function bI(r,e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g,w,v,m,b){let _=h,{deltaDays:E,hour:S,minute:T,second:O,millisecond:M,microsecond:Q,nanosecond:W}=T7(n,i,o,s,a,l,p,y,g,w,v,m);_+=E;const U=Pe("%Temporal.Duration%"),ee=di(d,Aa(r,e,t,d),new U(c,u,f,_,0,0,0,0,0,0),b);return{year:A(ee,Me),month:A(ee,Be),day:A(ee,je),hour:S,minute:T,second:O,millisecond:M,microsecond:Q,nanosecond:W}}function _a(r,e,t,n,i,o,s,a,l,d,c,u,f,h){const p=Pe("%Temporal.Duration%");if(ql(n,i,o,s,0,0,0,0,0,0)===0)return vI(A(r,tt),a,l,d,c,u,f);const y=Ds(e,r,t),g=di(t,Aa(A(y,Me),A(y,Be),A(y,je),t),new p(n,i,o,s,0,0,0,0,0,0),h),w=hs(A(g,Me),A(g,Be),A(g,je),A(y,Et),A(y,At),A(y,xt),A(y,St),A(y,Tt),A(y,$t),t);return vI(A(fo(e,w,"compatible"),tt),a,l,d,c,u,f)}function gB(r,e,t,n){const i=r==="subtract"?-1:1;let{years:o,months:s,weeks:a,days:l,hours:d,minutes:c,seconds:u,milliseconds:f,microseconds:h,nanoseconds:p}=rm(t);const y=oE(Kt(n));return{years:o,months:s,weeks:a,days:l,hours:d,minutes:c,seconds:u,milliseconds:f,microseconds:h,nanoseconds:p}=$7(A(e,to),A(e,Qn),A(e,No),A(e,ro),A(e,no),A(e,io),A(e,oo),A(e,so),A(e,ao),A(e,co),i*o,i*s,i*a,i*l,i*d,i*c,i*u,i*f,i*h,i*p,y),new(Pe("%Temporal.Duration%"))(o,s,a,l,d,c,u,f,h,p)}function vB(r,e,t){const n=r==="subtract"?-1:1,{hours:i,minutes:o,seconds:s,milliseconds:a,microseconds:l,nanoseconds:d}=function(f,h){let p=rm(f);for(const y of h)if(p[y]!==0)throw new RangeError(`Duration field ${y} not supported by Temporal.Instant. Try Temporal.ZonedDateTime instead.`);return p}(t,["years","months","weeks","days"]),c=vI(A(e,tt),n*i,n*o,n*s,n*a,n*l,n*d);return new(Pe("%Temporal.Instant%"))(c)}function bB(r,e,t,n){const i=r==="subtract"?-1:1,{years:o,months:s,weeks:a,days:l,hours:d,minutes:c,seconds:u,milliseconds:f,microseconds:h,nanoseconds:p}=rm(t),y=Kt(n),g=A(e,be),{year:w,month:v,day:m,hour:b,minute:_,second:E,millisecond:S,microsecond:T,nanosecond:O}=bI(A(e,Me),A(e,Be),A(e,je),A(e,Et),A(e,At),A(e,xt),A(e,St),A(e,Tt),A(e,$t),g,i*o,i*s,i*a,i*l,i*d,i*c,i*u,i*f,i*h,i*p,y);return hs(w,v,m,b,_,E,S,T,O,g)}function wB(r,e,t){const n=r==="subtract"?-1:1,{hours:i,minutes:o,seconds:s,milliseconds:a,microseconds:l,nanoseconds:d}=rm(t);let{hour:c,minute:u,second:f,millisecond:h,microsecond:p,nanosecond:y}=T7(A(e,Et),A(e,At),A(e,xt),A(e,St),A(e,Tt),A(e,$t),n*i,n*o,n*s,n*a,n*l,n*d);return{hour:c,minute:u,second:f,millisecond:h,microsecond:p,nanosecond:y}=pS(c,u,f,h,p,y,"reject"),new(Pe("%Temporal.PlainTime%"))(c,u,f,h,p,y)}function _B(r,e,t,n){let i=rm(t);r==="subtract"&&(i={years:-i.years,months:-i.months,weeks:-i.weeks,days:-i.days,hours:-i.hours,minutes:-i.minutes,seconds:-i.seconds,milliseconds:-i.milliseconds,microseconds:-i.microseconds,nanoseconds:-i.nanoseconds});let{years:o,months:s,weeks:a,days:l,hours:d,minutes:c,seconds:u,milliseconds:f,microseconds:h,nanoseconds:p}=i;({days:l}=uc(l,d,c,u,f,h,p,"day"));const y=Kt(n),g=A(e,be),w=Sn(g,["monthCode","year"]),v=Ct(e,w,[]),m=Di(null);dg(m,v,[]),v.day=1;let b=Pu(g,v);const _=ql(o,s,a,l,0,0,0,0,0,0),E=cr(g,"dateAdd"),S=Pe("%Temporal.Duration%");if(_<0){const M=di(g,b,new S(0,1,0,0,0,0,0,0,0,0),void 0,E),Q=di(g,M,new S(0,0,0,-1,0,0,0,0,0,0),void 0,E);m.day=U_(g,Q),b=Pu(g,m)}const T=new S(o,s,a,l,0,0,0,0,0,0),O=Fh(y);return By(g,Ct(di(g,b,T,y,E),w,[]),O)}function EB(r,e,t,n){const i=r==="subtract"?-1:1,{years:o,months:s,weeks:a,days:l,hours:d,minutes:c,seconds:u,milliseconds:f,microseconds:h,nanoseconds:p}=rm(t),y=Kt(n),g=A(e,hr),w=A(e,be);return ai(_a(A(e,Pi),g,w,i*o,i*s,i*a,i*l,i*d,i*c,i*u,i*f,i*h,i*p,y),g,w)}function $s(r,e,t){if(x.equal(e,Rv))return r;let{quotient:n,remainder:i}=gn(r,e);if(x.equal(i,nn))return r;const o=x.lessThan(i,nn)?-1:1,s=jc(x.multiply(i,x.BigInt(2))),a=x.equal(s,e),l=x.greaterThan(s,e);switch(t){case"ceil":o>0&&(n=x.add(n,x.BigInt(o)));break;case"floor":o<0&&(n=x.add(n,x.BigInt(o)));break;case"expand":n=x.add(n,x.BigInt(o));break;case"trunc":break;case"halfCeil":(l||a&&o>0)&&(n=x.add(n,x.BigInt(o)));break;case"halfFloor":(l||a&&o<0)&&(n=x.add(n,x.BigInt(o)));break;case"halfExpand":(l||a)&&(n=x.add(n,x.BigInt(o)));break;case"halfTrunc":l&&(n=x.add(n,x.BigInt(o)));break;case"halfEven":(l||a&&x.toNumber(x.remainder(jc(n),x.BigInt(2)))===1)&&(n=x.add(n,x.BigInt(o)))}return x.multiply(n,e)}function RA(r,e,t,n){let{remainder:i}=vp(r,ed);const o=x.subtract(r,i),s=$s(i,x.BigInt(C7[t]*e),n);return x.add(o,s)}function zC(r,e,t,n,i,o,s,a,l,d,c,u,f=864e11){const{deltaDays:h,hour:p,minute:y,second:g,millisecond:w,microsecond:v,nanosecond:m}=FC(n,i,o,s,a,l,d,c,u,f),{year:b,month:_,day:E}=TS(r,e,t+h);return{year:b,month:_,day:E,hour:p,minute:y,second:g,millisecond:w,microsecond:v,nanosecond:m}}function FC(r,e,t,n,i,o,s,a,l,d=864e11){let c=nn;switch(a){case"day":case"hour":c=x.BigInt(r);case"minute":c=x.add(x.multiply(c,zl),x.BigInt(e));case"second":c=x.add(x.multiply(c,zl),x.BigInt(t));case"millisecond":c=x.add(x.multiply(c,rr),x.BigInt(n));case"microsecond":c=x.add(x.multiply(c,rr),x.BigInt(i));case"nanosecond":c=x.add(x.multiply(c,rr),x.BigInt(o))}const u=a==="day"?d:C7[a],f=$s(c,x.BigInt(u*s),l),h=x.toNumber(x.divide(f,x.BigInt(u)));switch(a){case"day":return{deltaDays:h,hour:0,minute:0,second:0,millisecond:0,microsecond:0,nanosecond:0};case"hour":return tu(h,0,0,0,0,0);case"minute":return tu(r,h,0,0,0,0);case"second":return tu(r,e,h,0,0,0);case"millisecond":return tu(r,e,t,h,0,0);case"microsecond":return tu(r,e,t,n,h,0);case"nanosecond":return tu(r,e,t,n,i,h);default:throw new Error(`Invalid unit ${a}`)}}function aE(r,e){return UC(A(r,Me),A(r,Be),A(r,je),A(e,Me),A(e,Be),A(e,je),"day").days}function Ai(r,e,t,n){const i=di(r,e,t,void 0,n);return{relativeTo:i,days:aE(e,i)}}function k7(r,e,t,n,i){const o=A(r,hr),s=A(r,be);return ai(_a(A(r,Pi),o,s,e,t,n,i,0,0,0,0,0,0),o,s)}function P7(r,e,t,n,i,o,s,a,l,d,c,u,f,h){let p=r,y=e,g=t,w=n,v=i,m=o,b=s,_=a,E=l,S=d;if(!Fe(h)||u==="year"||u==="month"||u==="week"||u==="day"||u==="nanosecond"&&c===1)return{years:p,months:y,weeks:g,days:w,hours:v,minutes:m,seconds:b,milliseconds:_,microseconds:E,nanoseconds:S};let T=Gg(0,v,m,b,_,E,S,0);const O=zg(x.toNumber(T)),M=A(h,hr),Q=A(h,be),W=_a(A(h,Pi),M,Q,p,y,g,w,0,0,0,0,0,0),U=_a(new(Pe("%Temporal.Instant%"))(W),M,Q,0,0,0,O,0,0,0,0,0,0),ee=x.subtract(U,W);return x.greaterThanOrEqual(x.multiply(x.subtract(T,ee),x.BigInt(O)),nn)&&({years:p,months:y,weeks:g,days:w}=$7(p,y,g,w,0,0,0,0,0,0,0,0,0,O,0,0,0,0,0,0,h),T=RA(x.subtract(T,ee),c,u,f),{hours:v,minutes:m,seconds:b,milliseconds:_,microseconds:E,nanoseconds:S}=uc(0,0,0,0,0,0,x.toNumber(T),"hour")),{years:p,months:y,weeks:g,days:w,hours:v,minutes:m,seconds:b,milliseconds:_,microseconds:E,nanoseconds:S}}function Iu(r,e,t,n,i,o,s,a,l,d,c,u,f,h){let p=r,y=e,g=t,w=n,v=i,m=o,b=s,_=a,E=l,S=x.BigInt(d);const T=Pe("%Temporal.Duration%");let O,M,Q,W,U=h;if(U){if(Fe(U))M=U,U=yr(U);else if(!Nt(U))throw new TypeError("starting point must be PlainDate or ZonedDateTime");O=A(U,be)}if(u==="year"||u==="month"||u==="week"||u==="day"){let ee,R,z;S=Gg(0,v,m,b,_,E,d,0),M&&(ee=k7(M,p,y,g,w)),{days:R,nanoseconds:S,dayLengthNs:z}=jC(S,ee),Q=x.BigInt(z),w+=R,v=m=b=_=E=0}switch(u){case"year":{if(!O)throw new RangeError("A starting point is required for years rounding");const ee=new T(p),R=typeof O!="string"?cr(O,"dateAdd"):void 0,z=di(O,U,ee,void 0,R),K=di(O,U,new T(p,y,g),void 0,R);U=z,w+=aE(z,K);const Y=di(O,U,new T(0,0,0,w),void 0,R),I=Di(null);I.largestUnit="year";const D=Ih(O,U,Y,I).years;p+=D;const N=U;U=di(O,U,new T(D),void 0,R),w-=aE(N,U);const V=new T(w<0?-1:1);let{days:J}=Ai(O,U,V,R);J=Rr(J);const j=x.multiply(x.BigInt(J),Q);S=x.add(x.add(x.multiply(j,x.BigInt(p)),x.multiply(x.BigInt(w),Q)),S);const G=$s(S,x.multiply(j,x.BigInt(c)),f);W=yl(S,j),p=x.toNumber(x.divide(G,j)),S=nn,y=g=w=0;break}case"month":{if(!O)throw new RangeError("A starting point is required for months rounding");const ee=new T(p,y),R=typeof O!="string"?cr(O,"dateAdd"):void 0,z=di(O,U,ee,void 0,R),K=di(O,U,new T(p,y,g),void 0,R);U=z,w+=aE(z,K);const Y=zg(w),I=new T(0,w<0?-1:1);let D;for({relativeTo:U,days:D}=Ai(O,U,I,R);Rr(w)>=Rr(D);)y+=Y,w-=D,{relativeTo:U,days:D}=Ai(O,U,I,R);D=Rr(D);const N=x.multiply(x.BigInt(D),Q);S=x.add(x.add(x.multiply(N,x.BigInt(y)),x.multiply(x.BigInt(w),Q)),S);const V=$s(S,x.multiply(N,x.BigInt(c)),f);W=yl(S,N),y=x.toNumber(x.divide(V,N)),S=nn,g=w=0;break}case"week":{if(!O)throw new RangeError("A starting point is required for weeks rounding");const ee=zg(w),R=new T(0,0,w<0?-1:1),z=typeof O!="string"?cr(O,"dateAdd"):void 0;let K;for({relativeTo:U,days:K}=Ai(O,U,R,z);Rr(w)>=Rr(K);)g+=ee,w-=K,{relativeTo:U,days:K}=Ai(O,U,R,z);K=Rr(K);const Y=x.multiply(x.BigInt(K),Q);S=x.add(x.add(x.multiply(Y,x.BigInt(g)),x.multiply(x.BigInt(w),Q)),S);const I=$s(S,x.multiply(Y,x.BigInt(c)),f);W=yl(S,Y),g=x.toNumber(x.divide(I,Y)),S=nn,w=0;break}case"day":{const ee=Q;S=x.add(x.multiply(ee,x.BigInt(w)),S);const R=$s(S,x.multiply(ee,x.BigInt(c)),f);W=yl(S,ee),w=x.toNumber(x.divide(R,ee)),S=nn;break}case"hour":{let R=x.multiply(x.BigInt(v),x.BigInt(36e11));R=x.add(R,x.multiply(x.BigInt(m),x.BigInt(6e10))),R=x.add(R,x.multiply(x.BigInt(b),Fl)),R=x.add(R,x.multiply(x.BigInt(_),ba)),R=x.add(R,x.multiply(x.BigInt(E),rr)),R=x.add(R,S),W=yl(R,x.BigInt(36e11));const z=$s(R,x.BigInt(36e11*c),f);v=x.toNumber(x.divide(z,x.BigInt(36e11))),S=nn,m=b=_=E=0;break}case"minute":{let R=x.multiply(x.BigInt(m),x.BigInt(6e10));R=x.add(R,x.multiply(x.BigInt(b),Fl)),R=x.add(R,x.multiply(x.BigInt(_),ba)),R=x.add(R,x.multiply(x.BigInt(E),rr)),R=x.add(R,S),W=yl(R,x.BigInt(6e10));const z=$s(R,x.BigInt(6e10*c),f);m=x.toNumber(x.divide(z,x.BigInt(6e10))),S=nn,b=_=E=0;break}case"second":{let R=x.multiply(x.BigInt(b),Fl);R=x.add(R,x.multiply(x.BigInt(_),ba)),R=x.add(R,x.multiply(x.BigInt(E),rr)),R=x.add(R,S),W=yl(R,x.BigInt(1e9));const z=$s(R,x.BigInt(1e9*c),f);b=x.toNumber(x.divide(z,x.BigInt(1e9))),S=nn,_=E=0;break}case"millisecond":{let R=x.multiply(x.BigInt(_),ba);R=x.add(R,x.multiply(x.BigInt(E),rr)),R=x.add(R,S),W=yl(R,x.BigInt(1e6));const z=$s(R,x.BigInt(1e6*c),f);_=x.toNumber(x.divide(z,x.BigInt(1e6))),S=nn,E=0;break}case"microsecond":{let R=x.multiply(x.BigInt(E),rr);R=x.add(R,S),W=yl(R,x.BigInt(1e3));const z=$s(R,x.BigInt(1e3*c),f);E=x.toNumber(x.divide(z,x.BigInt(1e3))),S=nn;break}case"nanosecond":W=x.toNumber(S),S=$s(x.BigInt(S),x.BigInt(c),f)}return{years:p,months:y,weeks:g,days:w,hours:v,minutes:m,seconds:b,milliseconds:_,microseconds:E,nanoseconds:x.toNumber(S),total:W}}function sh(r,e,t,n,i,o){for(const[s,a]of[[r,n],[e,i],[t,o]])if(s!==a)return uy(s-a);return 0}function vp(r,e){let{quotient:t,remainder:n}=gn(r,e);return x.lessThan(n,nn)&&(t=x.subtract(t,Rv),n=x.add(n,e)),{quotient:t,remainder:n}}function fg(r,e){const{quotient:t,remainder:n}=gn(r,e);return na(n)||!xA(r)==!xA(e)?t:x.subtract(t,Rv)}function yl(r,e){const{quotient:t,remainder:n}=gn(r,e);return x.toNumber(t)+x.toNumber(n)/x.toNumber(e)}function DA(r){const e=Gb(r);return globalThis.BigInt!==void 0?globalThis.BigInt(e.toString(10)):e}function Gb(r){let e=r;if(typeof r=="object"){const t=r[Symbol.toPrimitive];t&&typeof t=="function"&&(e=hS(t,r,["number"]))}if(typeof e=="number")throw new TypeError("cannot convert number to bigint");return typeof e=="bigint"?x.BigInt(e.toString(10)):x.BigInt(e)}const qC=(()=>{let r=x.BigInt(Date.now()%1e6);return()=>{const e=x.BigInt(Date.now()),t=x.add(x.multiply(e,ba),r);return r=x.remainder(e,ba),x.greaterThan(t,Fg)?Fg:x.lessThan(t,Iw)?Iw:t}})();function Jf(){return new X9().resolvedOptions().timeZone}function uy(r){return r<0?-1:r>0?1:r}function Kt(r){if(r===void 0)return Di(null);if(Mr(r)&&r!==null)return r;throw new TypeError("Options parameter must be an object, not "+(r===null?"null":typeof r))}function Yg(r,e){const t=Di(null);return t[r]=e,t}function Fh(r){const e=Di(null);return dg(e,Kt(r),[]),e}function Dh(r,e,t,n){let i=r[e];if(i!==void 0){if(i=bo(i),!t.includes(i))throw new RangeError(`${e} must be one of ${t.join(", ")}, not ${i}`);return i}return n}function Ou(r){return _he.includes(rd(r))}function rd(r){return r.replace(/[A-Z]/g,e=>{const t=e.charCodeAt(0);return String.fromCharCode(t+32)})}const I7=new RegExp(`^${Y9.source}$`);function O7(r,e,t,n=r(e),i=r(t)){let o=x.BigInt(e),s=x.BigInt(t),a=n,l=i;for(;x.greaterThan(x.subtract(s,o),Rv);){const d=x.divide(x.add(o,s),x.BigInt(2)),c=r(d);if(c===a)o=d,a=c;else{if(c!==l)throw new Error(`invalid state in bisection ${a} - ${c} - ${l}`);s=d,l=c}}return s}const C7={hour:36e11,minute:6e10,second:1e9,millisecond:1e6,microsecond:1e3,nanosecond:1},R7=Symbol("date"),D7=Symbol("ym"),M7=Symbol("md"),B7=Symbol("time"),j7=Symbol("datetime"),N7=Symbol("instant"),hg=Symbol("original"),Um=Symbol("timezone"),Na=Symbol("calendar-id"),U7=Symbol("locale"),wI=Symbol("options"),Yb=r=>({value:r,enumerable:!0,writable:!1,configurable:!0}),pg=globalThis.Intl.DateTimeFormat,Cu=Object.assign,The=Object.prototype.hasOwnProperty,$he=Reflect.apply;function bm(r,e){let t=r[e];return typeof t=="function"&&(t=new pg(r[U7],t(r[wI])),r[e]=t),t}function jy(r,e={}){if(!(this instanceof jy))return new jy(r,e);const t=e!==void 0,n=t?Cu({},e):{},i=new pg(r,n),o=i.resolvedOptions();if(t){const s=Cu({},o);for(const a in s)$he(The,n,[a])||delete s[a];this[wI]=s}else this[wI]=n;this[U7]=o.locale,this[hg]=i,this[Um]=o.timeZone,this[Na]=o.calendar,this[R7]=Ohe,this[D7]=Phe,this[M7]=Ihe,this[B7]=khe,this[j7]=Che,this[N7]=Rhe}Object.defineProperty(jy,"name",{writable:!0,value:"DateTimeFormat"}),jy.supportedLocalesOf=function(r,e){return pg.supportedLocalesOf(r,e)};const m$={resolvedOptions:Yb(function(){return this[hg].resolvedOptions()}),format:Yb(function(e,...t){let{instant:n,formatter:i}=yg(e,this);return n&&i?i.format(n.epochMilliseconds):this[hg].format(e,...t)}),formatRange:Yb(function(e,t){if(Zg(e)||Zg(t)){if(!L7(e,t))throw new TypeError("Intl.DateTimeFormat.formatRange accepts two values of the same type");const{instant:n,formatter:i}=yg(e,this),{instant:o,formatter:s}=yg(t,this);if(n&&o&&i&&s&&i===s)return i.formatRange(n.epochMilliseconds,o.epochMilliseconds)}return this[hg].formatRange(e,t)})};"formatToParts"in pg.prototype&&(m$.formatToParts=Yb(function(e,...t){let{instant:n,formatter:i}=yg(e,this);return n&&i?i.formatToParts(n.epochMilliseconds):this[hg].formatToParts(e,...t)})),"formatRangeToParts"in pg.prototype&&(m$.formatRangeToParts=Yb(function(e,t){if(Zg(e)||Zg(t)){if(!L7(e,t))throw new TypeError("Intl.DateTimeFormat.formatRangeToParts accepts two values of the same type");const{instant:n,formatter:i}=yg(e,this),{instant:o,formatter:s}=yg(t,this);if(n&&o&&i&&s&&i===s)return i.formatRangeToParts(n.epochMilliseconds,o.epochMilliseconds)}return this[hg].formatRangeToParts(e,t)})),jy.prototype=Object.create(pg.prototype,m$),Object.defineProperty(jy,"prototype",{writable:!1,enumerable:!1,configurable:!1});const qh=jy;function z_(r={},e={}){const t=Cu({},r);for(const n of["year","month","day","hour","minute","second","weekday","dayPeriod","timeZoneName","dateStyle","timeStyle"])t[n]=n in e?e[n]:t[n],t[n]!==!1&&t[n]!==void 0||delete t[n];return t}function khe(r){let e=z_(r,{year:!1,month:!1,day:!1,weekday:!1,timeZoneName:!1,dateStyle:!1});return WC(e)||(e=Cu({},e,{hour:"numeric",minute:"numeric",second:"numeric"})),e}function Phe(r){let e=z_(r,{day:!1,hour:!1,minute:!1,second:!1,weekday:!1,dayPeriod:!1,timeZoneName:!1,dateStyle:!1,timeStyle:!1});return"year"in e||"month"in e||(e=Cu(e,{year:"numeric",month:"numeric"})),e}function Ihe(r){let e=z_(r,{year:!1,hour:!1,minute:!1,second:!1,weekday:!1,dayPeriod:!1,timeZoneName:!1,dateStyle:!1,timeStyle:!1});return"month"in e||"day"in e||(e=Cu({},e,{month:"numeric",day:"numeric"})),e}function Ohe(r){let e=z_(r,{hour:!1,minute:!1,second:!1,dayPeriod:!1,timeZoneName:!1,timeStyle:!1});return VC(e)||(e=Cu({},e,{year:"numeric",month:"numeric",day:"numeric"})),e}function Che(r){let e=z_(r,{timeZoneName:!1});return WC(e)||VC(e)||(e=Cu({},e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})),e}function Rhe(r){let e=r;return WC(e)||VC(e)||(e=Cu({},e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})),e}function VC(r){return"year"in r||"month"in r||"day"in r||"weekday"in r||"dateStyle"in r}function WC(r){return"hour"in r||"minute"in r||"second"in r||"timeStyle"in r||"dayPeriod"in r}function Zg(r){return Nt(r)||tn(r)||bt(r)||Fe(r)||Qt(r)||Nn(r)||kn(r)}function L7(r,e){return!(!Zg(r)||!Zg(e))&&!(tn(r)&&!tn(e))&&!(Nt(r)&&!Nt(e))&&!(bt(r)&&!bt(e))&&!(Fe(r)&&!Fe(e))&&!(Qt(r)&&!Qt(e))&&!(Nn(r)&&!Nn(e))&&!(kn(r)&&!kn(e))}function yg(r,e){const t=Pe("%Temporal.PlainDateTime%");if(tn(r)){const n=new t(1970,1,1,A(r,Et),A(r,At),A(r,xt),A(r,St),A(r,Tt),A(r,$t),e[Na]);return{instant:fo(e[Um],n,"compatible"),formatter:bm(e,B7)}}if(Qt(r)){const n=A(r,Me),i=A(r,Be),o=A(r,je),s=fi(A(r,be));if(s!==e[Na])throw new RangeError(`cannot format PlainYearMonth with calendar ${s} in locale with calendar ${e[Na]}`);const a=new t(n,i,o,12,0,0,0,0,0,s);return{instant:fo(e[Um],a,"compatible"),formatter:bm(e,D7)}}if(Nn(r)){const n=A(r,Me),i=A(r,Be),o=A(r,je),s=fi(A(r,be));if(s!==e[Na])throw new RangeError(`cannot format PlainMonthDay with calendar ${s} in locale with calendar ${e[Na]}`);const a=new t(n,i,o,12,0,0,0,0,0,s);return{instant:fo(e[Um],a,"compatible"),formatter:bm(e,M7)}}if(Nt(r)){const n=A(r,Me),i=A(r,Be),o=A(r,je),s=fi(A(r,be));if(s!=="iso8601"&&s!==e[Na])throw new RangeError(`cannot format PlainDate with calendar ${s} in locale with calendar ${e[Na]}`);const a=new t(n,i,o,12,0,0,0,0,0,e[Na]);return{instant:fo(e[Um],a,"compatible"),formatter:bm(e,R7)}}if(bt(r)){const n=A(r,Me),i=A(r,Be),o=A(r,je),s=A(r,Et),a=A(r,At),l=A(r,xt),d=A(r,St),c=A(r,Tt),u=A(r,$t),f=fi(A(r,be));if(f!=="iso8601"&&f!==e[Na])throw new RangeError(`cannot format PlainDateTime with calendar ${f} in locale with calendar ${e[Na]}`);let h=r;return f==="iso8601"&&(h=new t(n,i,o,s,a,l,d,c,u,e[Na])),{instant:fo(e[Um],h,"compatible"),formatter:bm(e,j7)}}if(Fe(r))throw new TypeError("Temporal.ZonedDateTime not supported in DateTimeFormat methods. Use toLocaleString() instead.");return kn(r)?{instant:r,formatter:bm(e,N7)}:{}}class Dc{constructor(e){if(arguments.length<1)throw new TypeError("missing argument: epochNanoseconds is required");const t=Gb(e);Cp(t),hd(this),Pt(this,tt,t)}get epochSeconds(){if(!kn(this))throw new TypeError("invalid receiver");const e=A(this,tt);return x.toNumber(fg(e,Fl))}get epochMilliseconds(){if(!kn(this))throw new TypeError("invalid receiver");const e=x.BigInt(A(this,tt));return x.toNumber(fg(e,ba))}get epochMicroseconds(){if(!kn(this))throw new TypeError("invalid receiver");return DA(fg(x.BigInt(A(this,tt)),rr))}get epochNanoseconds(){if(!kn(this))throw new TypeError("invalid receiver");return DA(x.BigInt(A(this,tt)))}add(e){if(!kn(this))throw new TypeError("invalid receiver");return vB("add",this,e)}subtract(e){if(!kn(this))throw new TypeError("invalid receiver");return vB("subtract",this,e)}until(e,t){if(!kn(this))throw new TypeError("invalid receiver");return uB("until",this,e,t)}since(e,t){if(!kn(this))throw new TypeError("invalid receiver");return uB("since",this,e,t)}round(e){if(!kn(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const t=typeof e=="string"?Yg("smallestUnit",e):Kt(e),n=Mv(t),i=Gc(t,"halfExpand"),o=gs(t,"smallestUnit","time",Ry);Bv(n,{hour:24,minute:1440,second:86400,millisecond:864e5,microsecond:864e8,nanosecond:864e11}[o],!0);const s=RA(A(this,tt),n,o,i);return new Dc(s)}equals(e){if(!kn(this))throw new TypeError("invalid receiver");const t=Nc(e),n=A(this,tt),i=A(t,tt);return x.equal(x.BigInt(n),x.BigInt(i))}toString(e){if(!kn(this))throw new TypeError("invalid receiver");const t=Kt(e),n=M_(t),i=Gc(t,"trunc"),o=gs(t,"smallestUnit","time",void 0);if(o==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');let s=t.timeZone;s!==void 0&&(s=Ri(s));const{precision:a,unit:l,increment:d}=B_(o,n),c=RA(A(this,tt),d,l,i);return rB(new Dc(c),s,a)}toJSON(){if(!kn(this))throw new TypeError("invalid receiver");return rB(this,void 0,"auto")}toLocaleString(e,t){if(!kn(this))throw new TypeError("invalid receiver");return new qh(e,t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.Instant")}toZonedDateTime(e){if(!kn(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument in toZonedDateTime");const t=e.calendar;if(t===void 0)throw new TypeError("missing calendar property in toZonedDateTime");const n=bs(t),i=e.timeZone;if(i===void 0)throw new TypeError("missing timeZone property in toZonedDateTime");const o=Ri(i);return ai(A(this,tt),o,n)}toZonedDateTimeISO(e){if(!kn(this))throw new TypeError("invalid receiver");const t=Ri(e);return ai(A(this,tt),t,"iso8601")}static fromEpochSeconds(e){const t=qg(e),n=x.multiply(x.BigInt(t),Fl);return Cp(n),new Dc(n)}static fromEpochMilliseconds(e){const t=qg(e),n=x.multiply(x.BigInt(t),ba);return Cp(n),new Dc(n)}static fromEpochMicroseconds(e){const t=Gb(e),n=x.multiply(t,rr);return Cp(n),new Dc(n)}static fromEpochNanoseconds(e){const t=Gb(e);return Cp(t),new Dc(t)}static from(e){return kn(e)?new Dc(A(e,tt)):Nc(e)}static compare(e,t){const n=Nc(e),i=Nc(t),o=A(n,tt),s=A(i,tt);return x.lessThan(o,s)?-1:x.greaterThan(o,s)?1:0}}fd(Dc,"Temporal.Instant");const K7=Array.prototype.includes,Dhe=Array.prototype.push,Mhe=globalThis.Intl.DateTimeFormat,Bhe=Array.prototype.sort,jhe=Math.abs,Nhe=Math.floor,g$=Object.create,_I=Object.entries,z7=Set,AB=Reflect.ownKeys,vi=Set.prototype.add,F7=Set.prototype.values,Lr={};class Qr{constructor(e){if(arguments.length<1)throw new RangeError("missing argument: id is required");const t=bo(e);if(!Ou(t))throw new RangeError(`invalid calendar identifier ${t}`);hd(this),Pt(this,Hr,rd(t))}get id(){if(!Xr(this))throw new TypeError("invalid receiver");return A(this,Hr)}dateFromFields(e,t){if(!Xr(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid fields");const n=Kt(t),i=A(this,Hr);return Lr[i].dateFromFields(e,n,i)}yearMonthFromFields(e,t){if(!Xr(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid fields");const n=Kt(t),i=A(this,Hr);return Lr[i].yearMonthFromFields(e,n,i)}monthDayFromFields(e,t){if(!Xr(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid fields");const n=Kt(t),i=A(this,Hr);return Lr[i].monthDayFromFields(e,n,i)}fields(e){if(!Xr(this))throw new TypeError("invalid receiver");const t=[],n=new Set(["year","month","monthCode","day","hour","minute","second","millisecond","microsecond","nanosecond"]);for(const i of e){if(typeof i!="string")throw new TypeError("invalid fields");if(!n.has(i))throw new RangeError(`invalid field name ${i}`);n.delete(i),Dhe.call(t,i)}return Lr[A(this,Hr)].fields(t)}mergeFields(e,t){if(!Xr(this))throw new TypeError("invalid receiver");const n=eB(e),i=g$(null);dg(i,n,[],[void 0]);const o=eB(t),s=g$(null);dg(s,o,[],[void 0]);const a=AB(s),l=Lr[A(this,Hr)].fieldKeysToIgnore(a),d=g$(null),c=AB(i);for(const u of c){let f;f=We(K7,l,[u])?s[u]:i[u],f!==void 0&&(d[u]=f)}return dg(d,s,[]),d}dateAdd(e,t,n){if(!Xr(this))throw new TypeError("invalid receiver");const i=yr(e),o=ug(t),s=vn(Kt(n)),{days:a}=uc(A(o,ro),A(o,no),A(o,io),A(o,oo),A(o,so),A(o,ao),A(o,co),"day"),l=A(this,Hr);return Lr[l].dateAdd(i,A(o,to),A(o,Qn),A(o,No),a,s,l)}dateUntil(e,t,n){if(!Xr(this))throw new TypeError("invalid receiver");const i=yr(e),o=yr(t);let s=gs(Kt(n),"largestUnit","date","auto");s==="auto"&&(s="day");const{years:a,months:l,weeks:d,days:c}=Lr[A(this,Hr)].dateUntil(i,o,s);return new(Pe("%Temporal.Duration%"))(a,l,d,c,0,0,0,0,0,0)}year(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].year(t)}month(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");if(Nn(t))throw new TypeError("use monthCode on PlainMonthDay instead");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].month(t)}monthCode(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||Nn(t)||(t=yr(t)),Lr[A(this,Hr)].monthCode(t)}day(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Nn(t)||(t=yr(t)),Lr[A(this,Hr)].day(t)}era(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].era(t)}eraYear(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].eraYear(t)}dayOfWeek(e){if(!Xr(this))throw new TypeError("invalid receiver");const t=yr(e);return Lr[A(this,Hr)].dayOfWeek(t)}dayOfYear(e){if(!Xr(this))throw new TypeError("invalid receiver");const t=yr(e);return Lr[A(this,Hr)].dayOfYear(t)}weekOfYear(e){if(!Xr(this))throw new TypeError("invalid receiver");const t=yr(e);return Lr[A(this,Hr)].weekOfYear(t)}yearOfWeek(e){if(!Xr(this))throw new TypeError("invalid receiver");const t=yr(e);return Lr[A(this,Hr)].yearOfWeek(t)}daysInWeek(e){if(!Xr(this))throw new TypeError("invalid receiver");const t=yr(e);return Lr[A(this,Hr)].daysInWeek(t)}daysInMonth(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].daysInMonth(t)}daysInYear(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].daysInYear(t)}monthsInYear(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].monthsInYear(t)}inLeapYear(e){let t=e;if(!Xr(this))throw new TypeError("invalid receiver");return Qt(t)||(t=yr(t)),Lr[A(this,Hr)].inLeapYear(t)}toString(){if(!Xr(this))throw new TypeError("invalid receiver");return A(this,Hr)}toJSON(){if(!Xr(this))throw new TypeError("invalid receiver");return A(this,Hr)}static from(e){return jv(bs(e))}}function HC(r){if(!r.startsWith("M"))throw new RangeError(`Invalid month code: ${r}.  Month codes must start with M.`);const e=+r.slice(1);if(isNaN(e))throw new RangeError(`Invalid month code: ${r}`);return e}function _u(r,e=!1){return`M${r.toString().padStart(2,"0")}${e?"L":""}`}function cE(r,e,t=12){let{month:n,monthCode:i}=r;if(i===void 0){if(n===void 0)throw new TypeError("Either month or monthCode are required");e==="reject"&&ui(n,1,t),e==="constrain"&&(n=ps(n,1,t)),i=_u(n)}else{const o=HC(i);if(n!==void 0&&n!==o)throw new RangeError(`monthCode ${i} and month ${n} must match if both are present`);if(i!==_u(o))throw new RangeError(`Invalid month code: ${i}`);if(n=o,n<1||n>t)throw new RangeError(`Invalid monthCode: ${i}`)}return{...r,month:n,monthCode:i}}fd(Qr,"Temporal.Calendar"),Gr("Temporal.Calendar.from",Qr.from),Gr("Temporal.Calendar.prototype.dateAdd",Qr.prototype.dateAdd),Gr("Temporal.Calendar.prototype.dateFromFields",Qr.prototype.dateFromFields),Gr("Temporal.Calendar.prototype.dateUntil",Qr.prototype.dateUntil),Gr("Temporal.Calendar.prototype.day",Qr.prototype.day),Gr("Temporal.Calendar.prototype.dayOfWeek",Qr.prototype.dayOfWeek),Gr("Temporal.Calendar.prototype.dayOfYear",Qr.prototype.dayOfYear),Gr("Temporal.Calendar.prototype.daysInMonth",Qr.prototype.daysInMonth),Gr("Temporal.Calendar.prototype.daysInWeek",Qr.prototype.daysInWeek),Gr("Temporal.Calendar.prototype.daysInYear",Qr.prototype.daysInYear),Gr("Temporal.Calendar.prototype.era",Qr.prototype.era),Gr("Temporal.Calendar.prototype.eraYear",Qr.prototype.eraYear),Gr("Temporal.Calendar.prototype.fields",Qr.prototype.fields),Gr("Temporal.Calendar.prototype.inLeapYear",Qr.prototype.inLeapYear),Gr("Temporal.Calendar.prototype.mergeFields",Qr.prototype.mergeFields),Gr("Temporal.Calendar.prototype.month",Qr.prototype.month),Gr("Temporal.Calendar.prototype.monthCode",Qr.prototype.monthCode),Gr("Temporal.Calendar.prototype.monthDayFromFields",Qr.prototype.monthDayFromFields),Gr("Temporal.Calendar.prototype.monthsInYear",Qr.prototype.monthsInYear),Gr("Temporal.Calendar.prototype.weekOfYear",Qr.prototype.weekOfYear),Gr("Temporal.Calendar.prototype.year",Qr.prototype.year),Gr("Temporal.Calendar.prototype.yearMonthFromFields",Qr.prototype.yearMonthFromFields),Gr("Temporal.Calendar.prototype.yearOfWeek",Qr.prototype.yearOfWeek),Lr.iso8601={dateFromFields(r,e,t){let n=Ct(r,["day","month","monthCode","year"],["year","day"]);const i=vn(e);n=cE(n);let{year:o,month:s,day:a}=n;return{year:o,month:s,day:a}=TA(o,s,a,i),Aa(o,s,a,t)},yearMonthFromFields(r,e,t){let n=Ct(r,["month","monthCode","year"],["year"]);const i=vn(e);n=cE(n);let{year:o,month:s}=n;return{year:o,month:s}=function(l,d,c){let u=l,f=d;switch(c){case"reject":td(u,f,1);break;case"constrain":({year:u,month:f}=_7(u,f))}return{year:u,month:f}}(o,s,i),Cw(o,s,t,1)},monthDayFromFields(r,e,t){let n=Ct(r,["day","month","monthCode","year"],["day"]);const i=vn(e);if(n.month!==void 0&&n.year===void 0&&n.monthCode===void 0)throw new TypeError("either year or monthCode required with month");const o=n.monthCode===void 0;n=cE(n);let{month:s,day:a,year:l}=n;return{month:s,day:a}=TA(o?l:1972,s,a,i),Ow(s,a,t,1972)},fields:r=>r,fieldKeysToIgnore(r){const e=new z7;for(let t=0;t<r.length;t++){const n=r[t];We(vi,e,[n]),n==="month"?We(vi,e,["monthCode"]):n==="monthCode"&&We(vi,e,["month"])}return[...We(F7,e,[])]},dateAdd(r,e,t,n,i,o,s){let a=A(r,Me),l=A(r,Be),d=A(r,je);return{year:a,month:l,day:d}=dy(a,l,d,e,t,n,i,o),Aa(a,l,d,s)},dateUntil:(r,e,t)=>UC(A(r,Me),A(r,Be),A(r,je),A(e,Me),A(e,Be),A(e,je),t),year:r=>A(r,Me),era(){},eraYear(){},month:r=>A(r,Be),monthCode:r=>_u(A(r,Be)),day:r=>A(r,je),dayOfWeek:r=>gI(A(r,Me),A(r,Be),A(r,je)),dayOfYear:r=>OA(A(r,Me),A(r,Be),A(r,je)),weekOfYear:r=>lB(A(r,Me),A(r,Be),A(r,je)).week,yearOfWeek:r=>lB(A(r,Me),A(r,Be),A(r,je)).year,daysInWeek:()=>7,daysInMonth:r=>wu(A(r,Me),A(r,Be)),daysInYear(r){let e=r;return Hn(e,Me)||(e=yr(e)),Rh(A(e,Me))?366:365},monthsInYear:()=>12,inLeapYear(r){let e=r;return Hn(e,Me)||(e=yr(e)),Rh(A(e,Me))}};class Yr{constructor(e){if(this.map=new Map,this.calls=0,this.hits=0,this.misses=0,this.now=globalThis.performance?globalThis.performance.now():Date.now(),e!==void 0){let t=0;for(const n of e.map.entries()){if(++t>Yr.MAX_CACHE_ENTRIES)break;this.map.set(...n)}}}get(e){const t=this.map.get(e);return t&&(this.hits++,this.report()),this.calls++,t}set(e,t){this.map.set(e,t),this.misses++,this.report()}report(){}setObject(e){if(Yr.objectMap.get(e))throw new RangeError("object already cached");Yr.objectMap.set(e,this),this.report()}static getCacheForObject(e){let t=Yr.objectMap.get(e);return t||(t=new Yr,Yr.objectMap.set(e,t)),t}}function q7({isoYear:r,isoMonth:e,isoDay:t}){return`${nm(r)}-${qr(e)}-${qr(t)}T00:00Z`}function v$(r,e){return{years:r.year-e.year,months:r.month-e.month,days:r.day-e.day}}Yr.objectMap=new WeakMap,Yr.MAX_CACHE_ENTRIES=1e3;class Uv{constructor(){this.eraLength="short",this.hasEra=!0,this.erasBeginMidYear=!1}getFormatter(){return this.formatter===void 0&&(this.formatter=new Mhe(`en-US-u-ca-${this.id}`,{day:"numeric",month:"numeric",year:"numeric",era:this.eraLength,timeZone:"UTC"})),this.formatter}isoToCalendarDate(e,t){const{year:n,month:i,day:o}=e,s=JSON.stringify({func:"isoToCalendarDate",isoYear:n,isoMonth:i,isoDay:o,id:this.id}),a=t.get(s);if(a)return a;const l=this.getFormatter();let d,c;try{c=q7({isoYear:n,isoMonth:i,isoDay:o}),d=l.formatToParts(new Date(c))}catch{throw new RangeError(`Invalid ISO date: ${JSON.stringify({isoYear:n,isoMonth:i,isoDay:o})}`)}const u={};for(let{type:h,value:p}of d){if(h==="year"&&(u.eraYear=+p),h==="relatedYear"&&(u.eraYear=+p),h==="month"){const y=/^([0-9]*)(.*?)$/.exec(p);if(!y||y.length!=3||!y[1]&&!y[2])throw new RangeError(`Unexpected month: ${p}`);if(u.month=y[1]?+y[1]:1,u.month<1)throw new RangeError(`Invalid month ${p} from ${c}[u-ca-${this.id}] (probably due to https://bugs.chromium.org/p/v8/issues/detail?id=10527)`);if(u.month>13)throw new RangeError(`Invalid month ${p} from ${c}[u-ca-${this.id}] (probably due to https://bugs.chromium.org/p/v8/issues/detail?id=10529)`);y[2]&&(u.monthExtra=y[2])}h==="day"&&(u.day=+p),this.hasEra&&h==="era"&&p!=null&&p!==""&&(p=p.split(" (")[0],u.era=p.normalize("NFD").replace(/[^-0-9 \p{L}]/gu,"").replace(" ","-").toLowerCase())}if(u.eraYear===void 0)throw new RangeError(`Intl.DateTimeFormat.formatToParts lacks relatedYear in ${this.id} calendar. Try Node 14+ or modern browsers.`);if(this.reviseIntlEra){const{era:h,eraYear:p}=this.reviseIntlEra(u,e);u.era=h,u.eraYear=p}this.checkIcuBugs&&this.checkIcuBugs(e);const f=this.adjustCalendarDate(u,t,"constrain",!0);if(f.year===void 0)throw new RangeError(`Missing year converting ${JSON.stringify(e)}`);if(f.month===void 0)throw new RangeError(`Missing month converting ${JSON.stringify(e)}`);if(f.day===void 0)throw new RangeError(`Missing day converting ${JSON.stringify(e)}`);return t.set(s,f),["constrain","reject"].forEach(h=>{const p=JSON.stringify({func:"calendarToIsoDate",year:f.year,month:f.month,day:f.day,overflow:h,id:this.id});t.set(p,e)}),f}validateCalendarDate(e){const{era:t,month:n,year:i,day:o,eraYear:s,monthCode:a,monthExtra:l}=e;if(l!==void 0)throw new RangeError("Unexpected `monthExtra` value");if(i===void 0&&s===void 0)throw new TypeError("year or eraYear is required");if(n===void 0&&a===void 0)throw new TypeError("month or monthCode is required");if(o===void 0)throw new RangeError("Missing day");if(a!==void 0){if(typeof a!="string")throw new RangeError("monthCode must be a string, not "+typeof a);if(!/^M([01]?\d)(L?)$/.test(a))throw new RangeError(`Invalid monthCode: ${a}`)}if(this.constantEra){if(t!==void 0&&t!==this.constantEra)throw new RangeError(`era must be ${this.constantEra}, not ${t}`);if(s!==void 0&&i!==void 0&&s!==i)throw new RangeError(`eraYear ${s} does not match year ${i}`)}if(this.hasEra&&e.era===void 0!=(e.eraYear===void 0))throw new RangeError("properties 'era' and 'eraYear' must be provided together")}adjustCalendarDate(e,t,n="constrain",i=!1){if(this.calendarType==="lunisolar")throw new RangeError("Override required for lunisolar calendars");let o=e;if(this.validateCalendarDate(o),this.constantEra){const{year:d,eraYear:c}=o;o={...o,era:this.constantEra,year:d!==void 0?d:c,eraYear:c!==void 0?c:d}}const s=this.monthsInYear(o,t);let{month:a,monthCode:l}=o;return{month:a,monthCode:l}=cE(o,n,s),{...o,month:a,monthCode:l}}regulateMonthDayNaive(e,t,n){const i=this.monthsInYear(e,n);let{month:o,day:s}=e;return t==="reject"?(ui(o,1,i),ui(s,1,this.maximumMonthLength(e))):(o=ps(o,1,i),s=ps(s,1,this.maximumMonthLength({...e,month:o}))),{...e,month:o,day:s}}calendarToIsoDate(e,t="constrain",n){const i=e;let o=this.adjustCalendarDate(e,n,t,!1);o=this.regulateMonthDayNaive(o,t,n);const{year:s,month:a,day:l}=o,d=JSON.stringify({func:"calendarToIsoDate",year:s,month:a,day:l,overflow:t,id:this.id});let c,u=n.get(d);if(u||i.year!==void 0&&i.month!==void 0&&i.day!==void 0&&(i.year!==o.year||i.month!==o.month||i.day!==o.day)&&(c=JSON.stringify({func:"calendarToIsoDate",year:i.year,month:i.month,day:i.day,overflow:t,id:this.id}),u=n.get(c),u))return u;let f=this.estimateIsoDate({year:s,month:a,day:l});const h=v=>{let m=this.addDaysIso(f,v);if(o.day>this.minimumMonthLength(o)){let b=this.isoToCalendarDate(m,n);for(;b.month!==a||b.year!==s;){if(t==="reject")throw new RangeError(`day ${l} does not exist in month ${a} of year ${s}`);m=this.addDaysIso(m,-1),b=this.isoToCalendarDate(m,n)}}return m};let p=0,y=this.isoToCalendarDate(f,n),g=v$(o,y);if(g.years!==0||g.months!==0||g.days!==0){const v=365*g.years+30*g.months+g.days;f=this.addDaysIso(f,v),y=this.isoToCalendarDate(f,n),g=v$(o,y),g.years===0&&g.months===0?f=h(g.days):p=this.compareCalendarDates(o,y)}let w=8;for(;p;){f=this.addDaysIso(f,p*w);const v=y;y=this.isoToCalendarDate(f,n);const m=p;if(p=this.compareCalendarDates(o,y),p){if(g=v$(o,y),g.years===0&&g.months===0)f=h(g.days),p=0;else if(m&&p!==m)if(w>1)w/=2;else{if(t==="reject")throw new RangeError(`Can't find ISO date from calendar date: ${JSON.stringify({...i})}`);this.compareCalendarDates(y,v)>0&&(f=this.addDaysIso(f,-1)),p=0}}}if(n.set(d,f),c&&n.set(c,f),o.year===void 0||o.month===void 0||o.day===void 0||o.monthCode===void 0||this.hasEra&&(o.era===void 0||o.eraYear===void 0))throw new RangeError("Unexpected missing property");return f}temporalToCalendarDate(e,t){const n={year:A(e,Me),month:A(e,Be),day:A(e,je)};return this.isoToCalendarDate(n,t)}compareCalendarDates(e,t){const n=Ct(e,["day","month","year"],["day","month","year"]),i=Ct(t,["day","month","year"],["day","month","year"]);return n.year!==i.year?uy(n.year-i.year):n.month!==i.month?uy(n.month-i.month):n.day!==i.day?uy(n.day-i.day):0}regulateDate(e,t="constrain",n){const i=this.calendarToIsoDate(e,t,n);return this.isoToCalendarDate(i,n)}addDaysIso(e,t){return dy(e.year,e.month,e.day,0,0,0,t,"constrain")}addDaysCalendar(e,t,n){const i=this.calendarToIsoDate(e,"constrain",n),o=this.addDaysIso(i,t);return this.isoToCalendarDate(o,n)}addMonthsCalendar(e,t,n,i){let o=e;const{day:s}=o;for(let a=0,l=jhe(t);a<l;a++){const{month:d}=o,c=o,u=t<0?-Math.max(s,this.daysInPreviousMonth(o,i)):this.daysInMonth(o,i),f=this.calendarToIsoDate(o,"constrain",i);let h=this.addDaysIso(f,u);if(o=this.isoToCalendarDate(h,i),t>0){const p=this.monthsInYear(c,i);for(;o.month-1!=d%p;)h=this.addDaysIso(h,-1),o=this.isoToCalendarDate(h,i)}o.day!==s&&(o=this.regulateDate({...o,day:s},"constrain",i))}if(n==="reject"&&o.day!==s)throw new RangeError(`Day ${s} does not exist in resulting calendar month`);return o}addCalendar(e,{years:t=0,months:n=0,weeks:i=0,days:o=0},s,a){const{year:l,day:d,monthCode:c}=e,u=this.adjustCalendarDate({year:l+t,monthCode:c,day:d},a),f=this.addMonthsCalendar(u,n,s,a),h=o+7*i;return this.addDaysCalendar(f,h,a)}untilCalendar(e,t,n,i){let o=0,s=0,a=0,l=0;switch(n){case"day":o=this.calendarDaysUntil(e,t,i);break;case"week":{const d=this.calendarDaysUntil(e,t,i);o=d%7,s=(d-o)/7;break}case"month":case"year":{const d=this.compareCalendarDates(t,e);if(!d)return{years:0,months:0,weeks:0,days:0};const c=t.year-e.year,u=t.day-e.day;if(n==="year"&&c){let p=0;t.monthCode>e.monthCode&&(p=1),t.monthCode<e.monthCode&&(p=-1),p||(p=Math.sign(u)),l=p*d<0?c-d:c}let f,h=l?this.addCalendar(e,{years:l},"constrain",i):e;do a+=d,f=h,h=this.addMonthsCalendar(f,d,"constrain",i),h.day!==e.day&&(h=this.regulateDate({...h,day:e.day},"constrain",i));while(this.compareCalendarDates(t,h)*d>=0);a-=d,o=this.calendarDaysUntil(f,t,i);break}}return{years:l,months:a,weeks:s,days:o}}daysInMonth(e,t){const{day:n}=e,i=this.maximumMonthLength(e),o=this.minimumMonthLength(e);if(o===i)return o;const s=n<=i-o?i:o,a=this.calendarToIsoDate(e,"constrain",t),l=this.addDaysIso(a,s),d=this.isoToCalendarDate(l,t),c=this.addDaysIso(l,-d.day);return this.isoToCalendarDate(c,t).day}daysInPreviousMonth(e,t){const{day:n,month:i,year:o}=e;let s={year:i>1?o:o-1,month:i,day:1};const a=i>1?i-1:this.monthsInYear(s,t);s={...s,month:a};const l=this.minimumMonthLength(s),d=this.maximumMonthLength(s);if(l===d)return d;const c=this.calendarToIsoDate(e,"constrain",t),u=this.addDaysIso(c,-n);return this.isoToCalendarDate(u,t).day}startOfCalendarYear(e){return{year:e.year,month:1,monthCode:"M01",day:1}}startOfCalendarMonth(e){return{year:e.year,month:e.month,day:1}}calendarDaysUntil(e,t,n){const i=this.calendarToIsoDate(e,"constrain",n),o=this.calendarToIsoDate(t,"constrain",n);return this.isoDaysUntil(i,o)}isoDaysUntil(e,t){return UC(e.year,e.month,e.day,t.year,t.month,t.day,"day").days}monthDayFromFields(e,t,n){let i,o,s,a,l,{monthCode:d,day:c}=e;if(d===void 0){let{year:h,era:p,eraYear:y}=e;if(h===void 0&&(p===void 0||y===void 0))throw new TypeError("when `monthCode` is omitted, `year` (or `era` and `eraYear`) and `month` are required");({monthCode:d,day:c}=this.isoToCalendarDate(this.calendarToIsoDate(e,t,n),n))}const u=this.isoToCalendarDate({year:1972,month:12,day:31},n),f=u.monthCode>d||u.monthCode===d&&u.day>=c?u.year:u.year-1;for(let h=0;h<100;h++){const p=this.adjustCalendarDate({day:c,monthCode:d,year:f-h},n),y=this.calendarToIsoDate(p,"constrain",n),g=this.isoToCalendarDate(y,n);if({year:i,month:o,day:s}=y,g.monthCode===d&&g.day===c)return{month:o,day:s,year:i};t==="constrain"&&(a===void 0||g.monthCode===a.monthCode&&g.day>a.day)&&(a=g,l=y)}if(t==="constrain"&&l!==void 0)return l;throw new RangeError(`No recent ${this.id} year with monthCode ${d} and day ${c}`)}}class Uhe extends Uv{constructor(){super(...arguments),this.id="hebrew",this.calendarType="lunisolar",this.months={Tishri:{leap:1,regular:1,monthCode:"M01",days:30},Heshvan:{leap:2,regular:2,monthCode:"M02",days:{min:29,max:30}},Kislev:{leap:3,regular:3,monthCode:"M03",days:{min:29,max:30}},Tevet:{leap:4,regular:4,monthCode:"M04",days:29},Shevat:{leap:5,regular:5,monthCode:"M05",days:30},Adar:{leap:void 0,regular:6,monthCode:"M06",days:29},"Adar I":{leap:6,regular:void 0,monthCode:"M05L",days:30},"Adar II":{leap:7,regular:void 0,monthCode:"M06",days:29},Nisan:{leap:8,regular:7,monthCode:"M07",days:30},Iyar:{leap:9,regular:8,monthCode:"M08",days:29},Sivan:{leap:10,regular:9,monthCode:"M09",days:30},Tamuz:{leap:11,regular:10,monthCode:"M10",days:29},Av:{leap:12,regular:11,monthCode:"M11",days:30},Elul:{leap:13,regular:12,monthCode:"M12",days:29}},this.hasEra=!1}inLeapYear(e){const{year:t}=e;return(7*t+1)%19<7}monthsInYear(e){return this.inLeapYear(e)?13:12}minimumMonthLength(e){return this.minMaxMonthLength(e,"min")}maximumMonthLength(e){return this.minMaxMonthLength(e,"max")}minMaxMonthLength(e,t){const{month:n,year:i}=e,o=this.getMonthCode(i,n),s=_I(this.months).find(l=>l[1].monthCode===o);if(s===void 0)throw new RangeError(`unmatched Hebrew month: ${n}`);const a=s[1].days;return typeof a=="number"?a:a[t]}estimateIsoDate(e){const{year:t}=e;return{year:t-3760,month:1,day:1}}getMonthCode(e,t){return this.inLeapYear({year:e})?t===6?_u(5,!0):_u(t<6?t:t-1):_u(t)}adjustCalendarDate(e,t,n="constrain",i=!1){let{year:o,eraYear:s,month:a,monthCode:l,day:d,monthExtra:c}=e;if(o===void 0&&s!==void 0&&(o=s),s===void 0&&o!==void 0&&(s=o),i){if(c){const u=this.months[c];if(!u)throw new RangeError(`Unrecognized month from formatToParts: ${c}`);a=this.inLeapYear({year:o})?u.leap:u.regular}return l=this.getMonthCode(o,a),{year:o,month:a,day:d,era:void 0,eraYear:s,monthCode:l}}if(this.validateCalendarDate(e),a===void 0)if(l.endsWith("L")){if(l!=="M05L")throw new RangeError(`Hebrew leap month must have monthCode M05L, not ${l}`);if(a=6,!this.inLeapYear({year:o})){if(n==="reject")throw new RangeError(`Hebrew monthCode M05L is invalid in year ${o} which is not a leap year`);a=6,l="M06"}}else{a=HC(l),this.inLeapYear({year:o})&&a>=6&&a++;const u=this.monthsInYear({year:o});if(a<1||a>u)throw new RangeError(`Invalid monthCode: ${l}`)}else if(n==="reject"?(ui(a,1,this.monthsInYear({year:o})),ui(d,1,this.maximumMonthLength({year:o,month:a}))):(a=ps(a,1,this.monthsInYear({year:o})),d=ps(d,1,this.maximumMonthLength({year:o,month:a}))),l===void 0)l=this.getMonthCode(o,a);else if(this.getMonthCode(o,a)!==l)throw new RangeError(`monthCode ${l} doesn't correspond to month ${a} in Hebrew year ${o}`);return{...e,day:d,month:a,monthCode:l,year:o,eraYear:s}}}class Lv extends Uv{constructor(){super(...arguments),this.calendarType="lunar",this.DAYS_PER_ISLAMIC_YEAR=354+11/30,this.DAYS_PER_ISO_YEAR=365.2425,this.constantEra="ah"}inLeapYear(e,t){return this.daysInMonth({year:e.year,month:12,day:1},t)===30}monthsInYear(){return 12}minimumMonthLength(){return 29}maximumMonthLength(){return 30}estimateIsoDate(e){const{year:t}=this.adjustCalendarDate(e);return{year:Nhe(t*this.DAYS_PER_ISLAMIC_YEAR/this.DAYS_PER_ISO_YEAR)+622,month:1,day:1}}}class V7 extends Lv{constructor(){super(...arguments),this.id="islamic"}}class Lhe extends Lv{constructor(){super(...arguments),this.id="islamic-umalqura"}}class Khe extends Lv{constructor(){super(...arguments),this.id="islamic-tbla"}}class zhe extends Lv{constructor(){super(...arguments),this.id="islamic-civil"}}class Fhe extends Lv{constructor(){super(...arguments),this.id="islamic-rgsa"}}class qhe extends Lv{constructor(){super(...arguments),this.id="islamicc"}}class Vhe extends Uv{constructor(){super(...arguments),this.id="persian",this.calendarType="solar",this.constantEra="ap"}inLeapYear(e,t){return V7.prototype.inLeapYear.call(this,e,t)}monthsInYear(){return 12}minimumMonthLength(e){const{month:t}=e;return t===12?29:t<=6?31:30}maximumMonthLength(e){const{month:t}=e;return t===12?30:t<=6?31:30}estimateIsoDate(e){const{year:t}=this.adjustCalendarDate(e);return{year:t+621,month:1,day:1}}}class Whe extends Uv{constructor(){super(...arguments),this.id="indian",this.calendarType="solar",this.constantEra="saka",this.months={1:{length:30,month:3,day:22,leap:{length:31,month:3,day:21}},2:{length:31,month:4,day:21},3:{length:31,month:5,day:22},4:{length:31,month:6,day:22},5:{length:31,month:7,day:23},6:{length:31,month:8,day:23},7:{length:30,month:9,day:23},8:{length:30,month:10,day:23},9:{length:30,month:11,day:22},10:{length:30,month:12,day:22},11:{length:30,month:1,nextYear:!0,day:21},12:{length:30,month:2,nextYear:!0,day:20}},this.vulnerableToBceBug=new Date("0000-01-01T00:00Z").toLocaleDateString("en-US-u-ca-indian",{timeZone:"UTC"})!=="10/11/-79 Saka"}inLeapYear(e){return W7(e.year+78)}monthsInYear(){return 12}minimumMonthLength(e){return this.getMonthInfo(e).length}maximumMonthLength(e){return this.getMonthInfo(e).length}getMonthInfo(e){const{month:t}=e;let n=this.months[t];if(n===void 0)throw new RangeError(`Invalid month: ${t}`);return this.inLeapYear(e)&&n.leap&&(n=n.leap),n}estimateIsoDate(e){const t=this.adjustCalendarDate(e),n=this.getMonthInfo(t);return dy(t.year+78+(n.nextYear?1:0),n.month,n.day,0,0,0,t.day-1,"constrain")}checkIcuBugs(e){if(this.vulnerableToBceBug&&e.year<1)throw new RangeError(`calendar '${this.id}' is broken for ISO dates before 0001-01-01 (see https://bugs.chromium.org/p/v8/issues/detail?id=10529)`)}}function W7(r){return r%4==0&&(r%100!=0||r%400==0)}class F_ extends Uv{constructor(e,t){super(),this.calendarType="solar",this.v8IsVulnerableToJulianBug=new Date("+001001-01-01T00:00Z").toLocaleDateString("en-US-u-ca-japanese",{timeZone:"UTC"}).startsWith("12"),this.calendarIsVulnerableToJulianBug=!1,this.id=e;const{eras:n,anchorEra:i}=function(s){let a,l=s;if(l.length===0)throw new RangeError("Invalid era data: eras are required");if(l.length===1&&l[0].reverseOf)throw new RangeError("Invalid era data: anchor era cannot count years backwards");if(l.length===1&&!l[0].name)throw new RangeError("Invalid era data: at least one named era is required");if(l.filter(c=>c.reverseOf!=null).length>1)throw new RangeError("Invalid era data: only one era can count years backwards");l.forEach(c=>{if(c.isAnchor||!c.anchorEpoch&&!c.reverseOf){if(a)throw new RangeError("Invalid era data: cannot have multiple anchor eras");a=c,c.anchorEpoch={year:c.hasYearZero?0:1}}else if(!c.name)throw new RangeError("If era name is blank, it must be the anchor era")}),l=l.filter(c=>c.name),l.forEach(c=>{const{reverseOf:u}=c;if(u){const f=l.find(h=>h.name===u);if(f===void 0)throw new RangeError(`Invalid era data: unmatched reverseOf era: ${u}`);c.reverseOf=f,c.anchorEpoch=f.anchorEpoch,c.isoEpoch=f.isoEpoch}c.anchorEpoch.month===void 0&&(c.anchorEpoch.month=1),c.anchorEpoch.day===void 0&&(c.anchorEpoch.day=1)}),Bhe.call(l,(c,u)=>{if(c.reverseOf)return 1;if(u.reverseOf)return-1;if(!c.isoEpoch||!u.isoEpoch)throw new RangeError("Invalid era data: missing ISO epoch");return u.isoEpoch.year-c.isoEpoch.year});const d=l[l.length-1].reverseOf;if(d&&d!==l[l.length-2])throw new RangeError("Invalid era data: invalid reverse-sign era");return l.forEach((c,u)=>{c.genericName="era"+(l.length-1-u)}),{eras:l,anchorEra:a||l[0]}}(t);this.anchorEra=i,this.eras=n}inLeapYear(e){const{year:t}=this.estimateIsoDate({month:1,day:1,year:e.year});return W7(t)}monthsInYear(){return 12}minimumMonthLength(e){const{month:t}=e;return t===2?this.inLeapYear(e)?29:28:[4,6,9,11].indexOf(t)>=0?30:31}maximumMonthLength(e){return this.minimumMonthLength(e)}completeEraYear(e){const t=(a,l)=>{const d=e[a];if(d!=null&&d!=l)throw new RangeError(`Input ${a} ${d} doesn't match calculated value ${l}`)},n=a=>{let l;const d={...e,year:a},c=this.eras.find((u,f)=>{if(f===this.eras.length-1){if(u.reverseOf){if(a>0)throw new RangeError(`Signed year ${a} is invalid for era ${u.name}`);return l=u.anchorEpoch.year-a,!0}return l=a-u.anchorEpoch.year+(u.hasYearZero?0:1),!0}return this.compareCalendarDates(d,u.anchorEpoch)>=0&&(l=a-u.anchorEpoch.year+(u.hasYearZero?0:1),!0)});if(!c)throw new RangeError(`Year ${a} was not matched by any era`);return{eraYear:l,era:c.name}};let{year:i,eraYear:o,era:s}=e;if(i!=null)({eraYear:o,era:s}=n(i)),t("era",s),t("eraYear",o);else{if(o==null)throw new RangeError("Either `year` or `eraYear` and `era` are required");{const a=s===void 0?void 0:this.eras.find(l=>l.name===s||l.genericName===s);if(!a)throw new RangeError(`Era ${s} (ISO year ${o}) was not matched by any era`);if(o<1&&a.reverseOf)throw new RangeError(`Years in ${s} era must be positive, not ${i}`);i=a.reverseOf?a.anchorEpoch.year-o:o+a.anchorEpoch.year-(a.hasYearZero?0:1),t("year",i),{eraYear:o,era:s}=n(i)}}return{...e,year:i,eraYear:o,era:s}}adjustCalendarDate(e,t,n="constrain"){let i=e;const{month:o,monthCode:s}=i;return o===void 0&&(i={...i,month:HC(s)}),this.validateCalendarDate(i),i=this.completeEraYear(i),super.adjustCalendarDate(i,t,n)}estimateIsoDate(e){const t=this.adjustCalendarDate(e),{year:n,month:i,day:o}=t,{anchorEra:s}=this;return TA(n+s.isoEpoch.year-(s.hasYearZero?0:1),i,o,"constrain")}checkIcuBugs(e){if(this.calendarIsVulnerableToJulianBug&&this.v8IsVulnerableToJulianBug&&sh(e.year,e.month,e.day,1582,10,15)<0)throw new RangeError(`calendar '${this.id}' is broken for ISO dates before 1582-10-15 (see https://bugs.chromium.org/p/chromium/issues/detail?id=1173158)`)}}class GC extends F_{constructor(e,t){super(e,t)}inLeapYear(e){const{year:t}=e;return(t+1)%4==0}monthsInYear(){return 13}minimumMonthLength(e){const{month:t}=e;return t===13?this.inLeapYear(e)?6:5:30}maximumMonthLength(e){return this.minimumMonthLength(e)}}class Hhe extends GC{constructor(){super("ethioaa",[{name:"era0",isoEpoch:{year:-5492,month:7,day:17}}])}}class Ghe extends GC{constructor(){super("coptic",[{name:"era1",isoEpoch:{year:284,month:8,day:29}},{name:"era0",reverseOf:"era1"}])}}class Yhe extends GC{constructor(){super("ethiopic",[{name:"era0",isoEpoch:{year:-5492,month:7,day:17}},{name:"era1",isoEpoch:{year:8,month:8,day:27},anchorEpoch:{year:5501}}])}}class Zhe extends F_{constructor(){super("roc",[{name:"minguo",isoEpoch:{year:1912,month:1,day:1}},{name:"before-roc",reverseOf:"minguo"}]),this.calendarIsVulnerableToJulianBug=!0}}class Jhe extends F_{constructor(){super("buddhist",[{name:"be",hasYearZero:!0,isoEpoch:{year:-543,month:1,day:1}}]),this.calendarIsVulnerableToJulianBug=!0}}class Xhe extends F_{constructor(){super("gregory",[{name:"ce",isoEpoch:{year:1,month:1,day:1}},{name:"bce",reverseOf:"ce"}])}reviseIntlEra(e){let{era:t,eraYear:n}=e;return t!=="bc"&&t!=="b"||(t="bce"),t!=="ad"&&t!=="a"||(t="ce"),{era:t,eraYear:n}}}class Qhe extends F_{constructor(){super("japanese",[{name:"reiwa",isoEpoch:{year:2019,month:5,day:1},anchorEpoch:{year:2019,month:5,day:1}},{name:"heisei",isoEpoch:{year:1989,month:1,day:8},anchorEpoch:{year:1989,month:1,day:8}},{name:"showa",isoEpoch:{year:1926,month:12,day:25},anchorEpoch:{year:1926,month:12,day:25}},{name:"taisho",isoEpoch:{year:1912,month:7,day:30},anchorEpoch:{year:1912,month:7,day:30}},{name:"meiji",isoEpoch:{year:1868,month:9,day:8},anchorEpoch:{year:1868,month:9,day:8}},{name:"ce",isoEpoch:{year:1,month:1,day:1}},{name:"bce",reverseOf:"ce"}]),this.calendarIsVulnerableToJulianBug=!0,this.eraLength="long",this.erasBeginMidYear=!0}reviseIntlEra(e,t){const{era:n,eraYear:i}=e,{year:o}=t;return this.eras.find(s=>s.name===n)?{era:n,eraYear:i}:o<1?{era:"bce",eraYear:1-o}:{era:"ce",eraYear:o}}}class H7 extends Uv{constructor(){super(...arguments),this.calendarType="lunisolar",this.hasEra=!1}inLeapYear(e,t){const n=this.getMonthList(e.year,t);return _I(n).length===13}monthsInYear(e,t){return this.inLeapYear(e,t)?13:12}minimumMonthLength(){return 29}maximumMonthLength(){return 30}getMonthList(e,t){if(e===void 0)throw new TypeError("Missing year");const n=JSON.stringify({func:"getMonthList",calendarYear:e,id:this.id}),i=t.get(n);if(i)return i;const o=this.getFormatter(),s=(g,w)=>{const v=q7({isoYear:g,isoMonth:2,isoDay:1}),m=new Date(v);m.setUTCDate(w+1);const b=o.formatToParts(m),_=b.find(T=>T.type==="month").value,E=+b.find(T=>T.type==="day").value;let S=b.find(T=>T.type==="relatedYear");if(S===void 0)throw new RangeError(`Intl.DateTimeFormat.formatToParts lacks relatedYear in ${this.id} calendar. Try Node 14+ or modern browsers.`);return S=+S.value,{calendarMonthString:_,calendarDay:E,calendarYearToVerify:S}};let a=17,{calendarMonthString:l,calendarDay:d,calendarYearToVerify:c}=s(e,a);l!=="1"&&(a+=29,{calendarMonthString:l,calendarDay:d}=s(e,a)),a-=d-5;const u={};let f,h,p=1,y=!1;do({calendarMonthString:l,calendarDay:d,calendarYearToVerify:c}=s(e,a)),f&&(u[h].daysInMonth=f+30-d),c!==e?y=!0:(u[l]={monthIndex:p++},a+=30),f=d,h=l;while(!y);return u[h].daysInMonth=f+30-d,t.set(n,u),u}estimateIsoDate(e){const{year:t,month:n}=e;return{year:t,month:n>=12?12:n+1,day:1}}adjustCalendarDate(e,t,n="constrain",i=!1){let{year:o,month:s,monthExtra:a,day:l,monthCode:d,eraYear:c}=e;if(i){if(o=c,a&&a!=="bis")throw new RangeError(`Unexpected leap month suffix: ${a}`);const u=_u(s,a!==void 0),f=`${s}${a||""}`,h=this.getMonthList(o,t)[f];if(h===void 0)throw new RangeError(`Unmatched month ${f} in Chinese year ${o}`);return s=h.monthIndex,{year:o,month:s,day:l,era:void 0,eraYear:c,monthCode:u}}if(this.validateCalendarDate(e),o===void 0&&(o=c),c===void 0&&(c=o),s===void 0){const u=this.getMonthList(o,t);let f=d.replace("L","bis").slice(1);f[0]==="0"&&(f=f.slice(1));let h=u[f];if(s=h&&h.monthIndex,s===void 0&&d.endsWith("L")&&d!="M13L"&&n==="constrain"){let p=d.slice(1,-1);p[0]==="0"&&(p=p.slice(1)),h=u[p],h&&(s=h.monthIndex,d=_u(p))}if(s===void 0)throw new RangeError(`Unmatched month ${d} in Chinese year ${o}`)}else if(d===void 0){const u=this.getMonthList(o,t),f=_I(u),h=f.length;n==="reject"?(ui(s,1,h),ui(l,1,this.maximumMonthLength())):(s=ps(s,1,h),l=ps(l,1,this.maximumMonthLength()));const p=f.find(([,y])=>y.monthIndex===s);if(p===void 0)throw new RangeError(`Invalid month ${s} in Chinese year ${o}`);d=_u(p[0].replace("bis",""),p[0].indexOf("bis")!==-1)}else{const u=this.getMonthList(o,t);let f=d.replace("L","bis").slice(1);f[0]==="0"&&(f=f.slice(1));const h=u[f];if(!h)throw new RangeError(`Unmatched monthCode ${d} in Chinese year ${o}`);if(s!==h.monthIndex)throw new RangeError(`monthCode ${d} doesn't correspond to month ${s} in Chinese year ${o}`)}return{...e,year:o,eraYear:c,month:s,monthCode:d,day:l}}}class epe extends H7{constructor(){super(...arguments),this.id="chinese"}}class tpe extends H7{constructor(){super(...arguments),this.id="dangi"}}class rpe{constructor(e){this.helper=e}dateFromFields(e,t,n){const i=new Yr,o=Ct(e,this.fields(["day","month","monthCode","year"]),[]),s=vn(t),{year:a,month:l,day:d}=this.helper.calendarToIsoDate(o,s,i),c=Aa(a,l,d,n);return i.setObject(c),c}yearMonthFromFields(e,t,n){const i=new Yr,o=Ct(e,this.fields(["month","monthCode","year"]),[]),s=vn(t),{year:a,month:l,day:d}=this.helper.calendarToIsoDate({...o,day:1},s,i),c=Cw(a,l,n,d);return i.setObject(c),c}monthDayFromFields(e,t,n){const i=new Yr,o=Ct(e,this.fields(["day","month","monthCode","year"]),[]),s=vn(t),{year:a,month:l,day:d}=this.helper.monthDayFromFields(o,s,i),c=Ow(l,d,n,a);return i.setObject(c),c}fields(e){let t=e;return K7.call(t,"year")&&(t=[...t,"era","eraYear"]),t}fieldKeysToIgnore(e){const t=new z7;for(let n=0;n<e.length;n++){const i=e[n];switch(We(vi,t,[i]),i){case"era":We(vi,t,["eraYear"]),We(vi,t,["year"]);break;case"eraYear":We(vi,t,["era"]),We(vi,t,["year"]);break;case"year":We(vi,t,["era"]),We(vi,t,["eraYear"]);break;case"month":We(vi,t,["monthCode"]),this.helper.erasBeginMidYear&&(We(vi,t,["era"]),We(vi,t,["eraYear"]));break;case"monthCode":We(vi,t,["month"]),this.helper.erasBeginMidYear&&(We(vi,t,["era"]),We(vi,t,["eraYear"]));break;case"day":this.helper.erasBeginMidYear&&(We(vi,t,["era"]),We(vi,t,["eraYear"]))}}return[...We(F7,t,[])]}dateAdd(e,t,n,i,o,s,a){const l=Yr.getCacheForObject(e),d=this.helper.temporalToCalendarDate(e,l),c=this.helper.addCalendar(d,{years:t,months:n,weeks:i,days:o},s,l),u=this.helper.calendarToIsoDate(c,"constrain",l),{year:f,month:h,day:p}=u,y=Aa(f,h,p,a);return new Yr(l).setObject(y),y}dateUntil(e,t,n){const i=Yr.getCacheForObject(e),o=Yr.getCacheForObject(t),s=this.helper.temporalToCalendarDate(e,i),a=this.helper.temporalToCalendarDate(t,o);return this.helper.untilCalendar(s,a,n,i)}year(e){const t=Yr.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,t).year}month(e){const t=Yr.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,t).month}day(e){const t=Yr.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,t).day}era(e){if(!this.helper.hasEra)return;const t=Yr.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,t).era}eraYear(e){if(!this.helper.hasEra)return;const t=Yr.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,t).eraYear}monthCode(e){const t=Yr.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,t).monthCode}dayOfWeek(e){return Lr.iso8601.dayOfWeek(e)}dayOfYear(e){const t=Yr.getCacheForObject(e),n=this.helper.isoToCalendarDate(e,t),i=this.helper.startOfCalendarYear(n);return this.helper.calendarDaysUntil(i,n,t)+1}weekOfYear(e){return Lr.iso8601.weekOfYear(e)}yearOfWeek(e){return Lr.iso8601.yearOfWeek(e)}daysInWeek(e){return Lr.iso8601.daysInWeek(e)}daysInMonth(e){const t=Yr.getCacheForObject(e),n=this.helper.temporalToCalendarDate(e,t),i=this.helper.maximumMonthLength(n);if(i===this.helper.minimumMonthLength(n))return i;const o=this.helper.startOfCalendarMonth(n),s=this.helper.addMonthsCalendar(o,1,"constrain",t);return this.helper.calendarDaysUntil(o,s,t)}daysInYear(e){let t=e;Hn(t,Me)||(t=yr(t));const n=Yr.getCacheForObject(t),i=this.helper.temporalToCalendarDate(t,n),o=this.helper.startOfCalendarYear(i),s=this.helper.addCalendar(o,{years:1},"constrain",n);return this.helper.calendarDaysUntil(o,s,n)}monthsInYear(e){const t=Yr.getCacheForObject(e),n=this.helper.temporalToCalendarDate(e,t);return this.helper.monthsInYear(n,t)}inLeapYear(e){let t=e;Hn(t,Me)||(t=yr(t));const n=Yr.getCacheForObject(t),i=this.helper.temporalToCalendarDate(t,n);return this.helper.inLeapYear(i,n)}}for(const r of[Uhe,Vhe,Yhe,Hhe,Ghe,epe,tpe,Zhe,Whe,Jhe,Xhe,Qhe,V7,Lhe,Khe,zhe,Fhe,qhe]){const e=new r;Lr[e.id]=new rpe(e)}class q_{constructor(e,t,n,i="iso8601"){o7(this,Yt(e),Yt(t),Yt(n),bs(i))}get calendarId(){if(!Nt(this))throw new TypeError("invalid receiver");return fi(A(this,be))}get era(){if(!Nt(this))throw new TypeError("invalid receiver");return gS(A(this,be),this)}get eraYear(){if(!Nt(this))throw new TypeError("invalid receiver");return vS(A(this,be),this)}get year(){if(!Nt(this))throw new TypeError("invalid receiver");return yS(A(this,be),this)}get month(){if(!Nt(this))throw new TypeError("invalid receiver");return mS(A(this,be),this)}get monthCode(){if(!Nt(this))throw new TypeError("invalid receiver");return N_(A(this,be),this)}get day(){if(!Nt(this))throw new TypeError("invalid receiver");return U_(A(this,be),this)}get dayOfWeek(){if(!Nt(this))throw new TypeError("invalid receiver");return PC(A(this,be),this)}get dayOfYear(){if(!Nt(this))throw new TypeError("invalid receiver");return IC(A(this,be),this)}get weekOfYear(){if(!Nt(this))throw new TypeError("invalid receiver");return OC(A(this,be),this)}get yearOfWeek(){if(!Nt(this))throw new TypeError("invalid receiver");return CC(A(this,be),this)}get daysInWeek(){if(!Nt(this))throw new TypeError("invalid receiver");return RC(A(this,be),this)}get daysInMonth(){if(!Nt(this))throw new TypeError("invalid receiver");return bS(A(this,be),this)}get daysInYear(){if(!Nt(this))throw new TypeError("invalid receiver");return wS(A(this,be),this)}get monthsInYear(){if(!Nt(this))throw new TypeError("invalid receiver");return _S(A(this,be),this)}get inLeapYear(){if(!Nt(this))throw new TypeError("invalid receiver");return ES(A(this,be),this)}with(e,t){if(!Nt(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument");Dv(e);const n=Kt(t),i=A(this,be),o=Sn(i,["day","month","monthCode","year"]);let s=Ct(this,o,[]);return s=My(i,s,Ct(e,o,"partial")),s=Ct(s,o,[]),Pu(i,s,n)}withCalendar(e){if(!Nt(this))throw new TypeError("invalid receiver");const t=bs(e);return new q_(A(this,Me),A(this,Be),A(this,je),t)}add(e,t){if(!Nt(this))throw new TypeError("invalid receiver");const n=ug(e),i=Kt(t);return di(A(this,be),this,n,i)}subtract(e,t){if(!Nt(this))throw new TypeError("invalid receiver");const n=w7(ug(e)),i=Kt(t);return di(A(this,be),this,n,i)}until(e,t){if(!Nt(this))throw new TypeError("invalid receiver");return fB("until",this,e,t)}since(e,t){if(!Nt(this))throw new TypeError("invalid receiver");return fB("since",this,e,t)}equals(e){if(!Nt(this))throw new TypeError("invalid receiver");const t=yr(e);for(const n of[Me,Be,je])if(A(this,n)!==A(t,n))return!1;return K_(A(this,be),A(t,be))}toString(e){if(!Nt(this))throw new TypeError("invalid receiver");return nB(this,D_(Kt(e)))}toJSON(){if(!Nt(this))throw new TypeError("invalid receiver");return nB(this)}toLocaleString(e,t){if(!Nt(this))throw new TypeError("invalid receiver");return new qh(e,t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainDate")}toPlainDateTime(e){if(!Nt(this))throw new TypeError("invalid receiver");const t=A(this,Me),n=A(this,Be),i=A(this,je),o=A(this,be);if(e===void 0)return hs(t,n,i,0,0,0,0,0,0,o);const s=pu(e);return hs(t,n,i,A(s,Et),A(s,At),A(s,xt),A(s,St),A(s,Tt),A(s,$t),o)}toZonedDateTime(e){if(!Nt(this))throw new TypeError("invalid receiver");let t,n;if(Mr(e))if(Qs(e))t=e;else{const p=e.timeZone;p===void 0?t=Ri(e):(t=Ri(p),n=e.plainTime)}else t=Ri(e);const i=A(this,Me),o=A(this,Be),s=A(this,je),a=A(this,be);let l=0,d=0,c=0,u=0,f=0,h=0;return n!==void 0&&(n=pu(n),l=A(n,Et),d=A(n,At),c=A(n,xt),u=A(n,St),f=A(n,Tt),h=A(n,$t)),ai(A(fo(t,hs(i,o,s,l,d,c,u,f,h,a),"compatible"),tt),t,a)}toPlainYearMonth(){if(!Nt(this))throw new TypeError("invalid receiver");const e=A(this,be);return By(e,Ct(this,Sn(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!Nt(this))throw new TypeError("invalid receiver");const e=A(this,be);return Wg(e,Ct(this,Sn(e,["day","monthCode"]),[]))}getISOFields(){if(!Nt(this))throw new TypeError("invalid receiver");return{calendar:A(this,be),isoDay:A(this,je),isoMonth:A(this,Be),isoYear:A(this,Me)}}getCalendar(){if(!Nt(this))throw new TypeError("invalid receiver");return jv(A(this,be))}static from(e,t){const n=Kt(t);return Nt(e)?(vn(n),Aa(A(e,Me),A(e,Be),A(e,je),A(e,be))):yr(e,n)}static compare(e,t){const n=yr(e),i=yr(t);return sh(A(n,Me),A(n,Be),A(n,je),A(i,Me),A(i,Be),A(i,je))}}fd(q_,"Temporal.PlainDate");class V_{constructor(e,t,n,i=0,o=0,s=0,a=0,l=0,d=0,c="iso8601"){s7(this,Yt(e),Yt(t),Yt(n),i===void 0?0:Yt(i),o===void 0?0:Yt(o),s===void 0?0:Yt(s),a===void 0?0:Yt(a),l===void 0?0:Yt(l),d===void 0?0:Yt(d),bs(c))}get calendarId(){if(!bt(this))throw new TypeError("invalid receiver");return fi(A(this,be))}get year(){if(!bt(this))throw new TypeError("invalid receiver");return yS(A(this,be),this)}get month(){if(!bt(this))throw new TypeError("invalid receiver");return mS(A(this,be),this)}get monthCode(){if(!bt(this))throw new TypeError("invalid receiver");return N_(A(this,be),this)}get day(){if(!bt(this))throw new TypeError("invalid receiver");return U_(A(this,be),this)}get hour(){if(!bt(this))throw new TypeError("invalid receiver");return A(this,Et)}get minute(){if(!bt(this))throw new TypeError("invalid receiver");return A(this,At)}get second(){if(!bt(this))throw new TypeError("invalid receiver");return A(this,xt)}get millisecond(){if(!bt(this))throw new TypeError("invalid receiver");return A(this,St)}get microsecond(){if(!bt(this))throw new TypeError("invalid receiver");return A(this,Tt)}get nanosecond(){if(!bt(this))throw new TypeError("invalid receiver");return A(this,$t)}get era(){if(!bt(this))throw new TypeError("invalid receiver");return gS(A(this,be),this)}get eraYear(){if(!bt(this))throw new TypeError("invalid receiver");return vS(A(this,be),this)}get dayOfWeek(){if(!bt(this))throw new TypeError("invalid receiver");return PC(A(this,be),this)}get dayOfYear(){if(!bt(this))throw new TypeError("invalid receiver");return IC(A(this,be),this)}get weekOfYear(){if(!bt(this))throw new TypeError("invalid receiver");return OC(A(this,be),this)}get yearOfWeek(){if(!bt(this))throw new TypeError("invalid receiver");return CC(A(this,be),this)}get daysInWeek(){if(!bt(this))throw new TypeError("invalid receiver");return RC(A(this,be),this)}get daysInYear(){if(!bt(this))throw new TypeError("invalid receiver");return wS(A(this,be),this)}get daysInMonth(){if(!bt(this))throw new TypeError("invalid receiver");return bS(A(this,be),this)}get monthsInYear(){if(!bt(this))throw new TypeError("invalid receiver");return _S(A(this,be),this)}get inLeapYear(){if(!bt(this))throw new TypeError("invalid receiver");return ES(A(this,be),this)}with(e,t){if(!bt(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument");Dv(e);const n=Kt(t),i=A(this,be),o=Sn(i,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);let s=Ct(this,o,[]);s=My(i,s,Ct(e,o,"partial")),s=Ct(s,o,[]);const{year:a,month:l,day:d,hour:c,minute:u,second:f,millisecond:h,microsecond:p,nanosecond:y}=j_(i,s,n);return hs(a,l,d,c,u,f,h,p,y,i)}withPlainTime(e){if(!bt(this))throw new TypeError("invalid receiver");const t=A(this,Me),n=A(this,Be),i=A(this,je),o=A(this,be);if(e===void 0)return hs(t,n,i,0,0,0,0,0,0,o);const s=pu(e);return hs(t,n,i,A(s,Et),A(s,At),A(s,xt),A(s,St),A(s,Tt),A(s,$t),o)}withPlainDate(e){if(!bt(this))throw new TypeError("invalid receiver");const t=yr(e),n=A(t,Me),i=A(t,Be),o=A(t,je);let s=A(t,be);const a=A(this,Et),l=A(this,At),d=A(this,xt),c=A(this,St),u=A(this,Tt),f=A(this,$t);return s=d7(A(this,be),s),hs(n,i,o,a,l,d,c,u,f,s)}withCalendar(e){if(!bt(this))throw new TypeError("invalid receiver");const t=bs(e);return new V_(A(this,Me),A(this,Be),A(this,je),A(this,Et),A(this,At),A(this,xt),A(this,St),A(this,Tt),A(this,$t),t)}add(e,t){if(!bt(this))throw new TypeError("invalid receiver");return bB("add",this,e,t)}subtract(e,t){if(!bt(this))throw new TypeError("invalid receiver");return bB("subtract",this,e,t)}until(e,t){if(!bt(this))throw new TypeError("invalid receiver");return hB("until",this,e,t)}since(e,t){if(!bt(this))throw new TypeError("invalid receiver");return hB("since",this,e,t)}round(e){if(!bt(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const t=typeof e=="string"?Yg("smallestUnit",e):Kt(e),n=Mv(t),i=Gc(t,"halfExpand"),o=gs(t,"smallestUnit","time",Ry,["day"]),s={day:1,hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[o];Bv(n,s,s===1);let a=A(this,Me),l=A(this,Be),d=A(this,je),c=A(this,Et),u=A(this,At),f=A(this,xt),h=A(this,St),p=A(this,Tt),y=A(this,$t);return{year:a,month:l,day:d,hour:c,minute:u,second:f,millisecond:h,microsecond:p,nanosecond:y}=zC(a,l,d,c,u,f,h,p,y,n,o,i),hs(a,l,d,c,u,f,h,p,y,A(this,be))}equals(e){if(!bt(this))throw new TypeError("invalid receiver");const t=Gp(e);for(const n of[Me,Be,je,Et,At,xt,St,Tt,$t])if(A(this,n)!==A(t,n))return!1;return K_(A(this,be),A(t,be))}toString(e){if(!bt(this))throw new TypeError("invalid receiver");const t=Kt(e),n=D_(t),i=M_(t),o=Gc(t,"trunc"),s=gs(t,"smallestUnit","time",void 0);if(s==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const{precision:a,unit:l,increment:d}=B_(s,i);return iB(this,a,n,{unit:l,increment:d,roundingMode:o})}toJSON(){if(!bt(this))throw new TypeError("invalid receiver");return iB(this,"auto")}toLocaleString(e,t){if(!bt(this))throw new TypeError("invalid receiver");return new qh(e,t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainDateTime")}toZonedDateTime(e,t){if(!bt(this))throw new TypeError("invalid receiver");const n=Ri(e);return ai(A(fo(n,this,Vg(Kt(t))),tt),n,A(this,be))}toPlainDate(){if(!bt(this))throw new TypeError("invalid receiver");return Hg(this)}toPlainYearMonth(){if(!bt(this))throw new TypeError("invalid receiver");const e=A(this,be);return By(e,Ct(this,Sn(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!bt(this))throw new TypeError("invalid receiver");const e=A(this,be);return Wg(e,Ct(this,Sn(e,["day","monthCode"]),[]))}toPlainTime(){if(!bt(this))throw new TypeError("invalid receiver");return DC(this)}getISOFields(){if(!bt(this))throw new TypeError("invalid receiver");return{calendar:A(this,be),isoDay:A(this,je),isoHour:A(this,Et),isoMicrosecond:A(this,Tt),isoMillisecond:A(this,St),isoMinute:A(this,At),isoMonth:A(this,Be),isoNanosecond:A(this,$t),isoSecond:A(this,xt),isoYear:A(this,Me)}}getCalendar(){if(!bt(this))throw new TypeError("invalid receiver");return jv(A(this,be))}static from(e,t){const n=Kt(t);return bt(e)?(vn(n),hs(A(e,Me),A(e,Be),A(e,je),A(e,Et),A(e,At),A(e,xt),A(e,St),A(e,Tt),A(e,$t),A(e,be))):Gp(e,n)}static compare(e,t){const n=Gp(e),i=Gp(t);for(const o of[Me,Be,je,Et,At,xt,St,Tt,$t]){const s=A(n,o),a=A(i,o);if(s!==a)return uy(s-a)}return 0}}fd(V_,"Temporal.PlainDateTime");class ah{constructor(e=0,t=0,n=0,i=0,o=0,s=0,a=0,l=0,d=0,c=0){const u=e===void 0?0:Ln(e),f=t===void 0?0:Ln(t),h=n===void 0?0:Ln(n),p=i===void 0?0:Ln(i),y=o===void 0?0:Ln(o),g=s===void 0?0:Ln(s),w=a===void 0?0:Ln(a),v=l===void 0?0:Ln(l),m=d===void 0?0:Ln(d),b=c===void 0?0:Ln(c);CA(u,f,h,p,y,g,w,v,m,b),hd(this),Pt(this,to,u),Pt(this,Qn,f),Pt(this,No,h),Pt(this,ro,p),Pt(this,no,y),Pt(this,io,g),Pt(this,oo,w),Pt(this,so,v),Pt(this,ao,m),Pt(this,co,b)}get years(){if(!en(this))throw new TypeError("invalid receiver");return A(this,to)}get months(){if(!en(this))throw new TypeError("invalid receiver");return A(this,Qn)}get weeks(){if(!en(this))throw new TypeError("invalid receiver");return A(this,No)}get days(){if(!en(this))throw new TypeError("invalid receiver");return A(this,ro)}get hours(){if(!en(this))throw new TypeError("invalid receiver");return A(this,no)}get minutes(){if(!en(this))throw new TypeError("invalid receiver");return A(this,io)}get seconds(){if(!en(this))throw new TypeError("invalid receiver");return A(this,oo)}get milliseconds(){if(!en(this))throw new TypeError("invalid receiver");return A(this,so)}get microseconds(){if(!en(this))throw new TypeError("invalid receiver");return A(this,ao)}get nanoseconds(){if(!en(this))throw new TypeError("invalid receiver");return A(this,co)}get sign(){if(!en(this))throw new TypeError("invalid receiver");return ql(A(this,to),A(this,Qn),A(this,No),A(this,ro),A(this,no),A(this,io),A(this,oo),A(this,so),A(this,ao),A(this,co))}get blank(){if(!en(this))throw new TypeError("invalid receiver");return ql(A(this,to),A(this,Qn),A(this,No),A(this,ro),A(this,no),A(this,io),A(this,oo),A(this,so),A(this,ao),A(this,co))===0}with(e){if(!en(this))throw new TypeError("invalid receiver");const t=Ct(e,["days","hours","microseconds","milliseconds","minutes","months","nanoseconds","seconds","weeks","years"],"partial"),{years:n=A(this,to),months:i=A(this,Qn),weeks:o=A(this,No),days:s=A(this,ro),hours:a=A(this,no),minutes:l=A(this,io),seconds:d=A(this,oo),milliseconds:c=A(this,so),microseconds:u=A(this,ao),nanoseconds:f=A(this,co)}=t;return new ah(n,i,o,s,a,l,d,c,u,f)}negated(){if(!en(this))throw new TypeError("invalid receiver");return w7(this)}abs(){if(!en(this))throw new TypeError("invalid receiver");return new ah(Math.abs(A(this,to)),Math.abs(A(this,Qn)),Math.abs(A(this,No)),Math.abs(A(this,ro)),Math.abs(A(this,no)),Math.abs(A(this,io)),Math.abs(A(this,oo)),Math.abs(A(this,so)),Math.abs(A(this,ao)),Math.abs(A(this,co)))}add(e,t){if(!en(this))throw new TypeError("invalid receiver");return gB("add",this,e,t)}subtract(e,t){if(!en(this))throw new TypeError("invalid receiver");return gB("subtract",this,e,t)}round(e){if(!en(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");let t=A(this,to),n=A(this,Qn),i=A(this,No),o=A(this,ro),s=A(this,no),a=A(this,io),l=A(this,oo),d=A(this,so),c=A(this,ao),u=A(this,co),f=pI(t,n,i,o,s,a,l,d,c,u);const h=typeof e=="string"?Yg("smallestUnit",e):Kt(e);let p=gs(h,"largestUnit","datetime",void 0,["auto"]),y=oE(h);const g=Mv(h),w=Gc(h,"halfExpand");let v=gs(h,"smallestUnit","datetime",void 0),m=!0;v||(m=!1,v="nanosecond"),f=Dy(f,v);let b=!0;if(p||(b=!1,p=f),p==="auto"&&(p=f),!m&&!b)throw new RangeError("at least one of smallestUnit or largestUnit is required");if(Dy(p,v)!==p)throw new RangeError(`largestUnit ${p} cannot be smaller than smallestUnit ${v}`);const _={hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[v];return _!==void 0&&Bv(g,_,!1),{years:t,months:n,weeks:i,days:o}=K1(t,n,i,o,p,y),{years:t,months:n,weeks:i,days:o,hours:s,minutes:a,seconds:l,milliseconds:d,microseconds:c,nanoseconds:u}=Iu(t,n,i,o,s,a,l,d,c,u,g,v,w,y),{years:t,months:n,weeks:i,days:o,hours:s,minutes:a,seconds:l,milliseconds:d,microseconds:c,nanoseconds:u}=P7(t,n,i,o,s,a,l,d,c,u,g,v,w,y),{days:o,hours:s,minutes:a,seconds:l,milliseconds:d,microseconds:c,nanoseconds:u}=uc(o,s,a,l,d,c,u,p,y),{years:t,months:n,weeks:i,days:o}=function(S,T,O,M,Q,W){const U=Pe("%Temporal.Duration%"),ee=ql(S,T,O,M,0,0,0,0,0,0);if(ee===0)return{years:S,months:T,weeks:O,days:M};const R=x.BigInt(ee);let z,K,Y=x.BigInt(S),I=x.BigInt(T),D=x.BigInt(O),N=x.BigInt(M);W&&(K=yr(W),z=A(K,be));const V=new U(ee),J=new U(0,ee),j=new U(0,0,ee);switch(Q){case"year":{if(!z)throw new RangeError("a starting point is required for years balancing");const G=typeof z!="string"?cr(z,"dateAdd"):void 0;let C,F,Z;for({relativeTo:C,days:F}=Ai(z,K,V,G);x.greaterThanOrEqual(jc(N),x.BigInt(Rr(F)));)N=x.subtract(N,x.BigInt(F)),Y=x.add(Y,R),K=C,{relativeTo:C,days:F}=Ai(z,K,V,G);for({relativeTo:C,days:Z}=Ai(z,K,J,G);x.greaterThanOrEqual(jc(N),x.BigInt(Rr(Z)));)N=x.subtract(N,x.BigInt(Z)),I=x.add(I,R),K=C,{relativeTo:C,days:Z}=Ai(z,K,J,G);C=di(z,K,V,void 0,G);const te=typeof z!="string"?cr(z,"dateUntil"):void 0,re=Di(null);re.largestUnit="month";let q=Ih(z,K,C,re,te),L=A(q,Qn);for(;x.greaterThanOrEqual(jc(I),x.BigInt(Rr(L)));){I=x.subtract(I,x.BigInt(L)),Y=x.add(Y,R),K=C,C=di(z,K,V,void 0,G);const k=Di(null);k.largestUnit="month",q=Ih(z,K,C,k,te),L=A(q,Qn)}break}case"month":{if(!z)throw new RangeError("a starting point is required for months balancing");const G=typeof z!="string"?cr(z,"dateAdd"):void 0;let C,F;for({relativeTo:C,days:F}=Ai(z,K,J,G);x.greaterThanOrEqual(jc(N),x.BigInt(Rr(F)));)N=x.subtract(N,x.BigInt(F)),I=x.add(I,R),K=C,{relativeTo:C,days:F}=Ai(z,K,J,G);break}case"week":{if(!z)throw new RangeError("a starting point is required for weeks balancing");const G=typeof z!="string"?cr(z,"dateAdd"):void 0;let C,F;for({relativeTo:C,days:F}=Ai(z,K,j,G);x.greaterThanOrEqual(jc(N),x.BigInt(Rr(F)));)N=x.subtract(N,x.BigInt(F)),D=x.add(D,R),K=C,{relativeTo:C,days:F}=Ai(z,K,j,G);break}}return{years:x.toNumber(Y),months:x.toNumber(I),weeks:x.toNumber(D),days:x.toNumber(N)}}(t,n,i,o,p,y),new ah(t,n,i,o,s,a,l,d,c,u)}total(e){if(!en(this))throw new TypeError("invalid receiver");let t=A(this,to),n=A(this,Qn),i=A(this,No),o=A(this,ro),s=A(this,no),a=A(this,io),l=A(this,oo),d=A(this,so),c=A(this,ao),u=A(this,co);if(e===void 0)throw new TypeError("options argument is required");const f=typeof e=="string"?Yg("unit",e):Kt(e),h=oE(f),p=gs(f,"unit","datetime",Ry);let y;({years:t,months:n,weeks:i,days:o}=K1(t,n,i,o,p,h)),Fe(h)&&(y=k7(h,t,n,i,0));let g=b7(o,s,a,l,d,c,u,p,y);if(g==="positive overflow")return 1/0;if(g==="negative overflow")return-1/0;({days:o,hours:s,minutes:a,seconds:l,milliseconds:d,microseconds:c,nanoseconds:u}=g);const{total:w}=Iu(t,n,i,o,s,a,l,d,c,u,1,p,"trunc",h);return w}toString(e){if(!en(this))throw new TypeError("invalid receiver");const t=Kt(e),n=M_(t),i=Gc(t,"trunc"),o=gs(t,"smallestUnit","time",void 0);if(o==="hour"||o==="minute")throw new RangeError('smallestUnit must be a time unit other than "hours" or "minutes"');const{precision:s,unit:a,increment:l}=B_(o,n);return y$(this,s,{unit:a,increment:l,roundingMode:i})}toJSON(){if(!en(this))throw new TypeError("invalid receiver");return y$(this)}toLocaleString(e,t){if(!en(this))throw new TypeError("invalid receiver");return typeof Intl<"u"&&Intl.DurationFormat!==void 0?new Intl.DurationFormat(e,t).format(this):(console.warn("Temporal.Duration.prototype.toLocaleString() requires Intl.DurationFormat."),y$(this))}valueOf(){throw new TypeError("use compare() to compare Temporal.Duration")}static from(e){return en(e)?new ah(A(e,to),A(e,Qn),A(e,No),A(e,ro),A(e,no),A(e,io),A(e,oo),A(e,so),A(e,ao),A(e,co)):ug(e)}static compare(e,t,n){const i=ug(e),o=ug(t),s=oE(Kt(n)),a=A(i,to),l=A(i,Qn),d=A(i,No);let c=A(i,ro);const u=A(i,no),f=A(i,io),h=A(i,oo),p=A(i,so),y=A(i,ao);let g=A(i,co);const w=A(o,to),v=A(o,Qn),m=A(o,No);let b=A(o,ro);const _=A(o,no),E=A(o,io),S=A(o,oo),T=A(o,so),O=A(o,ao);let M=A(o,co);const Q=dB(s,a,l,d,c),W=dB(s,w,v,m,b);a===0&&w===0&&l===0&&v===0&&d===0&&m===0||({days:c}=K1(a,l,d,c,"day",s),{days:b}=K1(w,v,m,b,"day",s));const U=Gg(c,u,f,h,p,y,g,Q),ee=Gg(b,_,E,S,T,O,M,W);return uy(x.toNumber(x.subtract(U,ee)))}}fd(ah,"Temporal.Duration");const npe=Object.create;class YC{constructor(e,t,n="iso8601",i=1972){a7(this,Yt(e),Yt(t),bs(n),Yt(i))}get monthCode(){if(!Nn(this))throw new TypeError("invalid receiver");return N_(A(this,be),this)}get day(){if(!Nn(this))throw new TypeError("invalid receiver");return U_(A(this,be),this)}get calendarId(){if(!Nn(this))throw new TypeError("invalid receiver");return fi(A(this,be))}with(e,t){if(!Nn(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument");Dv(e);const n=Kt(t),i=A(this,be),o=Sn(i,["day","month","monthCode","year"]);let s=Ct(this,o,[]);return s=My(i,s,Ct(e,o,"partial")),s=Ct(s,o,[]),Wg(i,s,n)}equals(e){if(!Nn(this))throw new TypeError("invalid receiver");const t=tB(e);for(const n of[Be,je,Me])if(A(this,n)!==A(t,n))return!1;return K_(A(this,be),A(t,be))}toString(e){if(!Nn(this))throw new TypeError("invalid receiver");return oB(this,D_(Kt(e)))}toJSON(){if(!Nn(this))throw new TypeError("invalid receiver");return oB(this)}toLocaleString(e,t){if(!Nn(this))throw new TypeError("invalid receiver");return new qh(e,t).format(this)}valueOf(){throw new TypeError("use equals() to compare Temporal.PlainMonthDay")}toPlainDate(e){if(!Nn(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("argument should be an object");const t=A(this,be),n=Sn(t,["day","monthCode"]),i=Ct(this,n,[]),o=Sn(t,["year"]);let s=My(t,i,Ct(e,o,[]));s=Ct(s,[...new Set([...n,...o])],[]);const a=npe(null);return a.overflow="reject",Pu(t,s,a)}getISOFields(){if(!Nn(this))throw new TypeError("invalid receiver");return{calendar:A(this,be),isoDay:A(this,je),isoMonth:A(this,Be),isoYear:A(this,Me)}}getCalendar(){if(!Nn(this))throw new TypeError("invalid receiver");return jv(A(this,be))}static from(e,t){const n=Kt(t);return Nn(e)?(vn(n),Ow(A(e,Be),A(e,je),A(e,be),A(e,Me))):tB(e,n)}}fd(YC,"Temporal.PlainMonthDay");const ZC=()=>new(Pe("%Temporal.Instant%"))(qC()),xB=(r,e=Jf())=>{const t=Ri(e),n=bs(r);return Ds(t,ZC(),n)},b$=(r=Jf())=>Ds(Ri(r),ZC(),"iso8601"),SB=(r,e=Jf())=>{const t=Ri(e),n=bs(r);return ai(qC(),t,n)},G7={instant:ZC,plainDateTime:xB,plainDateTimeISO:b$,plainDate:(r,e=Jf())=>Hg(xB(r,e)),plainDateISO:(r=Jf())=>Hg(b$(r)),plainTimeISO:(r=Jf())=>DC(b$(r)),timeZoneId:()=>Jf(),zonedDateTime:SB,zonedDateTimeISO:(r=Jf())=>SB("iso8601",r),[Symbol.toStringTag]:"Temporal.Now"};Object.defineProperty(G7,Symbol.toStringTag,{value:"Temporal.Now",writable:!1,enumerable:!1,configurable:!0});const ipe=Object.assign;function TB(r,e,t){let n=A(r,Et),i=A(r,At),o=A(r,xt),s=A(r,St),a=A(r,Tt),l=A(r,$t);if(t){const{unit:d,increment:c,roundingMode:u}=t;({hour:n,minute:i,second:o,millisecond:s,microsecond:a,nanosecond:l}=FC(n,i,o,s,a,l,c,d,u))}return`${qr(n)}:${qr(i)}${xS(o,s,a,l,e)}`}class fy{constructor(e=0,t=0,n=0,i=0,o=0,s=0){const a=e===void 0?0:Yt(e),l=t===void 0?0:Yt(t),d=n===void 0?0:Yt(n),c=i===void 0?0:Yt(i),u=o===void 0?0:Yt(o),f=s===void 0?0:Yt(s);$S(a,l,d,c,u,f),hd(this),Pt(this,Et,a),Pt(this,At,l),Pt(this,xt,d),Pt(this,St,c),Pt(this,Tt,u),Pt(this,$t,f)}get hour(){if(!tn(this))throw new TypeError("invalid receiver");return A(this,Et)}get minute(){if(!tn(this))throw new TypeError("invalid receiver");return A(this,At)}get second(){if(!tn(this))throw new TypeError("invalid receiver");return A(this,xt)}get millisecond(){if(!tn(this))throw new TypeError("invalid receiver");return A(this,St)}get microsecond(){if(!tn(this))throw new TypeError("invalid receiver");return A(this,Tt)}get nanosecond(){if(!tn(this))throw new TypeError("invalid receiver");return A(this,$t)}with(e,t){if(!tn(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument");Dv(e);const n=vn(Kt(t)),i=kA(e,"partial"),o=kA(this);let{hour:s,minute:a,second:l,millisecond:d,microsecond:c,nanosecond:u}=ipe(o,i);return{hour:s,minute:a,second:l,millisecond:d,microsecond:c,nanosecond:u}=pS(s,a,l,d,c,u,n),new fy(s,a,l,d,c,u)}add(e){if(!tn(this))throw new TypeError("invalid receiver");return wB("add",this,e)}subtract(e){if(!tn(this))throw new TypeError("invalid receiver");return wB("subtract",this,e)}until(e,t){if(!tn(this))throw new TypeError("invalid receiver");return pB("until",this,e,t)}since(e,t){if(!tn(this))throw new TypeError("invalid receiver");return pB("since",this,e,t)}round(e){if(!tn(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const t=typeof e=="string"?Yg("smallestUnit",e):Kt(e),n=Mv(t),i=Gc(t,"halfExpand"),o=gs(t,"smallestUnit","time",Ry);Bv(n,{hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[o],!1);let s=A(this,Et),a=A(this,At),l=A(this,xt),d=A(this,St),c=A(this,Tt),u=A(this,$t);return{hour:s,minute:a,second:l,millisecond:d,microsecond:c,nanosecond:u}=FC(s,a,l,d,c,u,n,o,i),new fy(s,a,l,d,c,u)}equals(e){if(!tn(this))throw new TypeError("invalid receiver");const t=pu(e);for(const n of[Et,At,xt,St,Tt,$t])if(A(this,n)!==A(t,n))return!1;return!0}toString(e){if(!tn(this))throw new TypeError("invalid receiver");const t=Kt(e),n=M_(t),i=Gc(t,"trunc"),o=gs(t,"smallestUnit","time",void 0);if(o==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const{precision:s,unit:a,increment:l}=B_(o,n);return TB(this,s,{unit:a,increment:l,roundingMode:i})}toJSON(){if(!tn(this))throw new TypeError("invalid receiver");return TB(this,"auto")}toLocaleString(e,t){if(!tn(this))throw new TypeError("invalid receiver");return new qh(e,t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainTime")}toPlainDateTime(e){if(!tn(this))throw new TypeError("invalid receiver");const t=yr(e),n=A(t,Me),i=A(t,Be),o=A(t,je),s=A(t,be);return hs(n,i,o,A(this,Et),A(this,At),A(this,xt),A(this,St),A(this,Tt),A(this,$t),s)}toZonedDateTime(e){if(!tn(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument");const t=e.plainDate;if(t===void 0)throw new TypeError("missing date property");const n=yr(t),i=e.timeZone;if(i===void 0)throw new TypeError("missing timeZone property");const o=Ri(i),s=A(n,Me),a=A(n,Be),l=A(n,je),d=A(n,be),c=A(this,Et),u=A(this,At),f=A(this,xt),h=A(this,St),p=A(this,Tt),y=A(this,$t);return ai(A(fo(o,new(Pe("%Temporal.PlainDateTime%"))(s,a,l,c,u,f,h,p,y,d),"compatible"),tt),o,d)}getISOFields(){if(!tn(this))throw new TypeError("invalid receiver");return{isoHour:A(this,Et),isoMicrosecond:A(this,Tt),isoMillisecond:A(this,St),isoMinute:A(this,At),isoNanosecond:A(this,$t),isoSecond:A(this,xt)}}static from(e,t){const n=vn(Kt(t));return tn(e)?new fy(A(e,Et),A(e,At),A(e,xt),A(e,St),A(e,Tt),A(e,$t)):pu(e,n)}static compare(e,t){const n=pu(e),i=pu(t);for(const o of[Et,At,xt,St,Tt,$t]){const s=A(n,o),a=A(i,o);if(s!==a)return uy(s-a)}return 0}}fd(fy,"Temporal.PlainTime");class Zb{constructor(e){if(arguments.length<1)throw new RangeError("missing argument: identifier is required");const t=MC(e);hd(this),Pt(this,El,t)}get id(){if(!Qs(this))throw new TypeError("invalid receiver");return A(this,El)}getOffsetNanosecondsFor(e){if(!Qs(this))throw new TypeError("invalid receiver");const t=Nc(e),n=A(this,El);return Jm(n)?Oh(n):bu(n,A(t,tt))}getOffsetStringFor(e){if(!Qs(this))throw new TypeError("invalid receiver");return yI(this,Nc(e))}getPlainDateTimeFor(e,t="iso8601"){if(!Qs(this))throw new TypeError("invalid receiver");return Ds(this,Nc(e),bs(t))}getInstantFor(e,t){if(!Qs(this))throw new TypeError("invalid receiver");return fo(this,Gp(e),Vg(Kt(t)))}getPossibleInstantsFor(e){if(!Qs(this))throw new TypeError("invalid receiver");const t=Gp(e),n=Pe("%Temporal.Instant%"),i=A(this,El);if(Jm(i)){const s=Ch(A(t,Me),A(t,Be),A(t,je),A(t,Et),A(t,At),A(t,xt),A(t,St),A(t,Tt),A(t,$t));if(s===null)throw new RangeError("DateTime outside of supported range");const a=Oh(i);return[new n(x.subtract(s,x.BigInt(a)))]}return function(a,l,d,c,u,f,h,p,y,g){const w=Ch(l,d,c,u,f,h,p,y,g);if(w===null)throw new RangeError("DateTime outside of supported range");let v=x.subtract(w,ed);x.lessThan(v,Iw)&&(v=w);let m=x.add(w,ed);x.greaterThan(m,Fg)&&(m=w);const b=bu(a,v),_=bu(a,m);return(b===_?[b]:[b,_]).map(E=>{const S=x.subtract(w,x.BigInt(E)),T=m7(a,S);if(l===T.year&&d===T.month&&c===T.day&&u===T.hour&&f===T.minute&&h===T.second&&p===T.millisecond&&y===T.microsecond&&g===T.nanosecond)return S}).filter(E=>E!==void 0)}(i,A(t,Me),A(t,Be),A(t,je),A(t,Et),A(t,At),A(t,xt),A(t,St),A(t,Tt),A(t,$t)).map(s=>new n(s))}getNextTransition(e){if(!Qs(this))throw new TypeError("invalid receiver");const t=Nc(e),n=A(this,El);if(Jm(n)||n==="UTC")return null;let i=A(t,tt);const o=Pe("%Temporal.Instant%");return i=v7(n,i),i===null?null:new o(i)}getPreviousTransition(e){if(!Qs(this))throw new TypeError("invalid receiver");const t=Nc(e),n=A(this,El);if(Jm(n)||n==="UTC")return null;let i=A(t,tt);const o=Pe("%Temporal.Instant%");return i=mI(n,i),i===null?null:new o(i)}toString(){if(!Qs(this))throw new TypeError("invalid receiver");return A(this,El)}toJSON(){if(!Qs(this))throw new TypeError("invalid receiver");return A(this,El)}static from(e){return u7(Ri(e))}}fd(Zb,"Temporal.TimeZone"),Gr("Temporal.TimeZone.prototype.getOffsetNanosecondsFor",Zb.prototype.getOffsetNanosecondsFor),Gr("Temporal.TimeZone.prototype.getPossibleInstantsFor",Zb.prototype.getPossibleInstantsFor);const ope=Object.create;class JC{constructor(e,t,n="iso8601",i=1){c7(this,Yt(e),Yt(t),bs(n),Yt(i))}get year(){if(!Qt(this))throw new TypeError("invalid receiver");return yS(A(this,be),this)}get month(){if(!Qt(this))throw new TypeError("invalid receiver");return mS(A(this,be),this)}get monthCode(){if(!Qt(this))throw new TypeError("invalid receiver");return N_(A(this,be),this)}get calendarId(){if(!Qt(this))throw new TypeError("invalid receiver");return fi(A(this,be))}get era(){if(!Qt(this))throw new TypeError("invalid receiver");return gS(A(this,be),this)}get eraYear(){if(!Qt(this))throw new TypeError("invalid receiver");return vS(A(this,be),this)}get daysInMonth(){if(!Qt(this))throw new TypeError("invalid receiver");return bS(A(this,be),this)}get daysInYear(){if(!Qt(this))throw new TypeError("invalid receiver");return wS(A(this,be),this)}get monthsInYear(){if(!Qt(this))throw new TypeError("invalid receiver");return _S(A(this,be),this)}get inLeapYear(){if(!Qt(this))throw new TypeError("invalid receiver");return ES(A(this,be),this)}with(e,t){if(!Qt(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid argument");Dv(e);const n=Kt(t),i=A(this,be),o=Sn(i,["month","monthCode","year"]);let s=Ct(this,o,[]);return s=My(i,s,Ct(e,o,"partial")),s=Ct(s,o,[]),By(i,s,n)}add(e,t){if(!Qt(this))throw new TypeError("invalid receiver");return _B("add",this,e,t)}subtract(e,t){if(!Qt(this))throw new TypeError("invalid receiver");return _B("subtract",this,e,t)}until(e,t){if(!Qt(this))throw new TypeError("invalid receiver");return yB("until",this,e,t)}since(e,t){if(!Qt(this))throw new TypeError("invalid receiver");return yB("since",this,e,t)}equals(e){if(!Qt(this))throw new TypeError("invalid receiver");const t=pb(e);for(const n of[Me,Be,je])if(A(this,n)!==A(t,n))return!1;return K_(A(this,be),A(t,be))}toString(e){if(!Qt(this))throw new TypeError("invalid receiver");return sB(this,D_(Kt(e)))}toJSON(){if(!Qt(this))throw new TypeError("invalid receiver");return sB(this)}toLocaleString(e,t){if(!Qt(this))throw new TypeError("invalid receiver");return new qh(e,t).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainYearMonth")}toPlainDate(e){if(!Qt(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("argument should be an object");const t=A(this,be),n=Sn(t,["monthCode","year"]),i=Ct(this,n,[]),o=Sn(t,["day"]);let s=My(t,i,Ct(e,o,[]));s=Ct(s,[...new Set([...n,...o])],[]);const a=ope(null);return a.overflow="reject",Pu(t,s,a)}getISOFields(){if(!Qt(this))throw new TypeError("invalid receiver");return{calendar:A(this,be),isoDay:A(this,je),isoMonth:A(this,Be),isoYear:A(this,Me)}}getCalendar(){if(!Qt(this))throw new TypeError("invalid receiver");return jv(A(this,be))}static from(e,t){const n=Kt(t);return Qt(e)?(vn(n),Cw(A(e,Me),A(e,Be),A(e,be),A(e,je))):pb(e,n)}static compare(e,t){const n=pb(e),i=pb(t);return sh(A(n,Me),A(n,Be),A(n,je),A(i,Me),A(i,Be),A(i,je))}}fd(JC,"Temporal.PlainYearMonth");const spe=qh.prototype.resolvedOptions,ape=Object.create;class XC{constructor(e,t,n="iso8601"){if(arguments.length<1)throw new TypeError("missing argument: epochNanoseconds is required");l7(this,Gb(e),Ri(t),bs(n))}get calendarId(){if(!Fe(this))throw new TypeError("invalid receiver");return fi(A(this,be))}get timeZoneId(){if(!Fe(this))throw new TypeError("invalid receiver");return Rw(A(this,hr))}get year(){if(!Fe(this))throw new TypeError("invalid receiver");return yS(A(this,be),kr(this))}get month(){if(!Fe(this))throw new TypeError("invalid receiver");return mS(A(this,be),kr(this))}get monthCode(){if(!Fe(this))throw new TypeError("invalid receiver");return N_(A(this,be),kr(this))}get day(){if(!Fe(this))throw new TypeError("invalid receiver");return U_(A(this,be),kr(this))}get hour(){if(!Fe(this))throw new TypeError("invalid receiver");return A(kr(this),Et)}get minute(){if(!Fe(this))throw new TypeError("invalid receiver");return A(kr(this),At)}get second(){if(!Fe(this))throw new TypeError("invalid receiver");return A(kr(this),xt)}get millisecond(){if(!Fe(this))throw new TypeError("invalid receiver");return A(kr(this),St)}get microsecond(){if(!Fe(this))throw new TypeError("invalid receiver");return A(kr(this),Tt)}get nanosecond(){if(!Fe(this))throw new TypeError("invalid receiver");return A(kr(this),$t)}get era(){if(!Fe(this))throw new TypeError("invalid receiver");return gS(A(this,be),kr(this))}get eraYear(){if(!Fe(this))throw new TypeError("invalid receiver");return vS(A(this,be),kr(this))}get epochSeconds(){if(!Fe(this))throw new TypeError("invalid receiver");const e=A(this,tt);return x.toNumber(fg(e,Fl))}get epochMilliseconds(){if(!Fe(this))throw new TypeError("invalid receiver");const e=A(this,tt);return x.toNumber(fg(e,ba))}get epochMicroseconds(){if(!Fe(this))throw new TypeError("invalid receiver");return DA(fg(A(this,tt),rr))}get epochNanoseconds(){if(!Fe(this))throw new TypeError("invalid receiver");return DA(A(this,tt))}get dayOfWeek(){if(!Fe(this))throw new TypeError("invalid receiver");return PC(A(this,be),kr(this))}get dayOfYear(){if(!Fe(this))throw new TypeError("invalid receiver");return IC(A(this,be),kr(this))}get weekOfYear(){if(!Fe(this))throw new TypeError("invalid receiver");return OC(A(this,be),kr(this))}get yearOfWeek(){if(!Fe(this))throw new TypeError("invalid receiver");return CC(A(this,be),kr(this))}get hoursInDay(){if(!Fe(this))throw new TypeError("invalid receiver");const e=kr(this),t=Pe("%Temporal.PlainDateTime%"),n=A(e,Me),i=A(e,Be),o=A(e,je),s=new t(n,i,o,0,0,0,0,0,0),a=dy(n,i,o,0,0,0,1,"reject"),l=new t(a.year,a.month,a.day,0,0,0,0,0,0),d=A(this,hr),c=A(fo(d,s,"compatible"),tt),u=A(fo(d,l,"compatible"),tt);return yl(x.subtract(u,c),e7)}get daysInWeek(){if(!Fe(this))throw new TypeError("invalid receiver");return RC(A(this,be),kr(this))}get daysInMonth(){if(!Fe(this))throw new TypeError("invalid receiver");return bS(A(this,be),kr(this))}get daysInYear(){if(!Fe(this))throw new TypeError("invalid receiver");return wS(A(this,be),kr(this))}get monthsInYear(){if(!Fe(this))throw new TypeError("invalid receiver");return _S(A(this,be),kr(this))}get inLeapYear(){if(!Fe(this))throw new TypeError("invalid receiver");return ES(A(this,be),kr(this))}get offset(){if(!Fe(this))throw new TypeError("invalid receiver");return yI(A(this,hr),A(this,Pi))}get offsetNanoseconds(){if(!Fe(this))throw new TypeError("invalid receiver");return Yc(A(this,hr),A(this,Pi))}with(e,t){if(!Fe(this))throw new TypeError("invalid receiver");if(!Mr(e))throw new TypeError("invalid zoned-date-time-like");Dv(e);const n=Kt(t),i=A(this,be);let o=Sn(i,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);o.push("offset");let s=Ct(this,o,["offset"]);s=My(i,s,Ct(e,o,"partial")),s=Ct(s,o,["offset"]);const a=Vg(n),l=$A(n,"prefer");let{year:d,month:c,day:u,hour:f,minute:h,second:p,millisecond:y,microsecond:g,nanosecond:w}=j_(i,s,n);const v=Oh(s.offset),m=A(this,hr);return ai(PA(d,c,u,f,h,p,y,g,w,"option",v,m,a,l,!1),m,i)}withPlainDate(e){if(!Fe(this))throw new TypeError("invalid receiver");const t=yr(e),n=A(t,Me),i=A(t,Be),o=A(t,je);let s=A(t,be);const a=kr(this),l=A(a,Et),d=A(a,At),c=A(a,xt),u=A(a,St),f=A(a,Tt),h=A(a,$t);s=d7(A(this,be),s);const p=A(this,hr);return ai(A(fo(p,new(Pe("%Temporal.PlainDateTime%"))(n,i,o,l,d,c,u,f,h,s),"compatible"),tt),p,s)}withPlainTime(e){if(!Fe(this))throw new TypeError("invalid receiver");const t=Pe("%Temporal.PlainTime%"),n=e===void 0?new t:pu(e),i=kr(this),o=A(i,Me),s=A(i,Be),a=A(i,je),l=A(this,be),d=A(n,Et),c=A(n,At),u=A(n,xt),f=A(n,St),h=A(n,Tt),p=A(n,$t),y=A(this,hr);return ai(A(fo(y,new(Pe("%Temporal.PlainDateTime%"))(o,s,a,d,c,u,f,h,p,l),"compatible"),tt),y,l)}withTimeZone(e){if(!Fe(this))throw new TypeError("invalid receiver");const t=Ri(e);return ai(A(this,tt),t,A(this,be))}withCalendar(e){if(!Fe(this))throw new TypeError("invalid receiver");const t=bs(e);return ai(A(this,tt),A(this,hr),t)}add(e,t){if(!Fe(this))throw new TypeError("invalid receiver");return EB("add",this,e,t)}subtract(e,t){if(!Fe(this))throw new TypeError("invalid receiver");return EB("subtract",this,e,t)}until(e,t){if(!Fe(this))throw new TypeError("invalid receiver");return mB("until",this,e,t)}since(e,t){if(!Fe(this))throw new TypeError("invalid receiver");return mB("since",this,e,t)}round(e){if(!Fe(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const t=typeof e=="string"?Yg("smallestUnit",e):Kt(e),n=Mv(t),i=Gc(t,"halfExpand"),o=gs(t,"smallestUnit","time",Ry,["day"]),s={day:1,hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[o];Bv(n,s,s===1);const a=kr(this);let l=A(a,Me),d=A(a,Be),c=A(a,je),u=A(a,Et),f=A(a,At),h=A(a,xt),p=A(a,St),y=A(a,Tt),g=A(a,$t);const w=Pe("%Temporal.PlainDateTime%"),v=A(this,hr),m=A(this,be),b=fo(v,new w(A(a,Me),A(a,Be),A(a,je),0,0,0,0,0,0),"compatible"),_=_a(b,v,m,0,0,0,1,0,0,0,0,0,0),E=x.subtract(_,x.BigInt(A(b,tt)));if(x.lessThanOrEqual(E,nn))throw new RangeError("cannot round a ZonedDateTime in a calendar with zero or negative length days");return{year:l,month:d,day:c,hour:u,minute:f,second:h,millisecond:p,microsecond:y,nanosecond:g}=zC(l,d,c,u,f,h,p,y,g,n,o,i,x.toNumber(E)),ai(PA(l,d,c,u,f,h,p,y,g,"option",Yc(v,A(this,Pi)),v,"compatible","prefer",!1),v,A(this,be))}equals(e){if(!Fe(this))throw new TypeError("invalid receiver");const t=yb(e),n=A(this,tt),i=A(t,tt);return!!x.equal(x.BigInt(n),x.BigInt(i))&&!!f7(A(this,hr),A(t,hr))&&K_(A(this,be),A(t,be))}toString(e){if(!Fe(this))throw new TypeError("invalid receiver");const t=Kt(e),n=D_(t),i=M_(t),o=function(h){return Dh(h,"offset",["auto","never"],"auto")}(t),s=Gc(t,"trunc"),a=gs(t,"smallestUnit","time",void 0);if(a==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const l=function(h){return Dh(h,"timeZoneName",["auto","never","critical"],"auto")}(t),{precision:d,unit:c,increment:u}=B_(a,i);return aB(this,d,n,l,o,{unit:c,increment:u,roundingMode:s})}toLocaleString(e,t){if(!Fe(this))throw new TypeError("invalid receiver");const n=Kt(t),i=ape(null);if(dg(i,n,["timeZone"]),n.timeZone!==void 0)throw new TypeError("ZonedDateTime toLocaleString does not accept a timeZone option");i.year===void 0&&i.month===void 0&&i.day===void 0&&i.weekday===void 0&&i.dateStyle===void 0&&i.hour===void 0&&i.minute===void 0&&i.second===void 0&&i.timeStyle===void 0&&i.dayPeriod===void 0&&i.timeZoneName===void 0&&(i.timeZoneName="short");let o=Rw(A(this,hr));if(Jm(o))throw new RangeError("toLocaleString does not support offset string time zones");o=MC(o),i.timeZone=o;const s=new qh(e,i),a=We(spe,s,[]).calendar,l=fi(A(this,be));if(l!=="iso8601"&&a!=="iso8601"&&a!==l)throw new RangeError(`cannot format ZonedDateTime with calendar ${l} in locale with calendar ${a}`);return s.format(A(this,Pi))}toJSON(){if(!Fe(this))throw new TypeError("invalid receiver");return aB(this,"auto")}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.ZonedDateTime")}startOfDay(){if(!Fe(this))throw new TypeError("invalid receiver");const e=kr(this),t=Pe("%Temporal.PlainDateTime%"),n=A(this,be),i=new t(A(e,Me),A(e,Be),A(e,je),0,0,0,0,0,0,n),o=A(this,hr);return ai(A(fo(o,i,"compatible"),tt),o,n)}toInstant(){if(!Fe(this))throw new TypeError("invalid receiver");return new(Pe("%Temporal.Instant%"))(A(this,tt))}toPlainDate(){if(!Fe(this))throw new TypeError("invalid receiver");return Hg(kr(this))}toPlainTime(){if(!Fe(this))throw new TypeError("invalid receiver");return DC(kr(this))}toPlainDateTime(){if(!Fe(this))throw new TypeError("invalid receiver");return kr(this)}toPlainYearMonth(){if(!Fe(this))throw new TypeError("invalid receiver");const e=A(this,be);return By(e,Ct(this,Sn(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!Fe(this))throw new TypeError("invalid receiver");const e=A(this,be);return Wg(e,Ct(this,Sn(e,["day","monthCode"]),[]))}getISOFields(){if(!Fe(this))throw new TypeError("invalid receiver");const e=kr(this),t=A(this,hr);return{calendar:A(this,be),isoDay:A(e,je),isoHour:A(e,Et),isoMicrosecond:A(e,Tt),isoMillisecond:A(e,St),isoMinute:A(e,At),isoMonth:A(e,Be),isoNanosecond:A(e,$t),isoSecond:A(e,xt),isoYear:A(e,Me),offset:yI(t,A(this,Pi)),timeZone:t}}getCalendar(){if(!Fe(this))throw new TypeError("invalid receiver");return jv(A(this,be))}getTimeZone(){if(!Fe(this))throw new TypeError("invalid receiver");return u7(A(this,hr))}static from(e,t){const n=Kt(t);return Fe(e)?(Vg(n),$A(n,"reject"),vn(n),ai(A(e,tt),A(e,hr),A(e,be))):yb(e,n)}static compare(e,t){const n=yb(e),i=yb(t),o=A(n,tt),s=A(i,tt);return x.lessThan(x.BigInt(o),x.BigInt(s))?-1:x.greaterThan(x.BigInt(o),x.BigInt(s))?1:0}}function kr(r){return Ds(A(r,hr),A(r,Pi),A(r,be))}fd(XC,"Temporal.ZonedDateTime");var wm=Object.freeze({__proto__:null,Calendar:Qr,Duration:ah,Instant:Dc,Now:G7,PlainDate:q_,PlainDateTime:V_,PlainMonthDay:YC,PlainTime:fy,PlainYearMonth:JC,TimeZone:Zb,ZonedDateTime:XC});const cpe=[Dc,Qr,q_,V_,ah,YC,fy,Zb,JC,XC];for(const r of cpe){const e=Object.getOwnPropertyDescriptor(r,"prototype");(e.configurable||e.enumerable||e.writable)&&(e.configurable=!1,e.enumerable=!1,e.writable=!1,Object.defineProperty(r,"prototype",e))}var $B=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class pn{static sleep(e){return $B(this,void 0,void 0,function*(){return new Promise(t=>setTimeout(t,e))})}static minimalSleep(){return $B(this,void 0,void 0,function*(){yield pn.sleep(2)})}static getCurrentTimestamp(){return wm.Now.instant().toString({smallestUnit:"microseconds"})}static createTimestamp(e){const{year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d}=e;return wm.ZonedDateTime.from({timeZone:"UTC",year:t,month:n,day:i,hour:o,minute:s,second:a,millisecond:l,microsecond:d}).toInstant().toString({smallestUnit:"microseconds"})}static createOffsetTimestamp(e,t){const n=t?wm.Instant.from(t):wm.Now.instant(),i=wm.Duration.from(e);return n.add(i).toString({smallestUnit:"microseconds"})}static validateTimestamp(e){try{wm.Instant.from(e)}catch{throw new Ae(we.TimestampInvalid,`Invalid timestamp: ${e}`)}}}var Tn=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},lpe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Gt{get message(){if(this._message.authorization===void 0)throw new Ae(we.RecordsWriteMissingSigner,"This RecordsWrite is not yet signed, JSON message cannot be generated from an incomplete state.");return this._message}get author(){return this._author}get signaturePayload(){return this._signaturePayload}get owner(){return this._owner}get ownerSignaturePayload(){return this._ownerSignaturePayload}get isSignedByAuthorDelegate(){return Oe.isSignedByAuthorDelegate(this._message)}get isSignedByOwnerDelegate(){return Oe.isSignedByOwnerDelegate(this._message)}get signer(){return Oe.getSigner(this._message)}get ownerSignatureSigner(){var e;return((e=this._message.authorization)===null||e===void 0?void 0:e.ownerSignature)===void 0?void 0:un.getSignerDid(this._message.authorization.ownerSignature.signatures[0])}constructor(e,t){this.parentContextId=t,this._message=e,e.authorization!==void 0&&(this._author=Oe.getAuthor(e),this._signaturePayload=un.decodePlainObjectPayload(e.authorization.signature),e.authorization.ownerSignature!==void 0&&(e.authorization.ownerDelegatedGrant!==void 0?this._owner=Oe.getSigner(e.authorization.ownerDelegatedGrant):this._owner=un.getSignerDid(e.authorization.ownerSignature.signatures[0]),this._ownerSignaturePayload=un.decodePlainObjectPayload(e.authorization.ownerSignature))),this.attesters=Gt.getAttesters(e)}static parse(e){return Tn(this,void 0,void 0,function*(){const t=JSON.parse(JSON.stringify(e));yield Oe.validateSignatureStructure(t.authorization.signature,t.descriptor,"RecordsWriteSignaturePayload"),t.authorization.ownerSignature!==void 0&&(yield Oe.validateSignatureStructure(t.authorization.ownerSignature,t.descriptor)),yield Gt.validateAttestationIntegrity(t);const n=new Gt(t);return yield n.validateIntegrity(),n})}static create(e){var t,n,i,o;return Tn(this,void 0,void 0,function*(){if(e.protocol===void 0&&e.protocolPath!==void 0||e.protocol!==void 0&&e.protocolPath===void 0)throw new Ae(we.RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive,"`protocol` and `protocolPath` must both be defined or undefined at the same time");if(e.data===void 0&&e.dataCid===void 0||e.data!==void 0&&e.dataCid!==void 0)throw new Ae(we.RecordsWriteCreateDataAndDataCidMutuallyExclusive,"one and only one parameter between `data` and `dataCid` is required");if(e.dataCid===void 0&&e.dataSize!==void 0||e.dataCid!==void 0&&e.dataSize===void 0)throw new Ae(we.RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive,"`dataCid` and `dataSize` must both be defined or undefined at the same time");if(e.signer===void 0&&e.delegatedGrant!==void 0)throw new Ae(we.RecordsWriteCreateMissingSigner,"`signer` must be given when `delegatedGrant` is given");const s=(t=e.dataCid)!==null&&t!==void 0?t:yield _i.computeDagPbCidFromBytes(e.data),a=(n=e.dataSize)!==null&&n!==void 0?n:e.data.length,l=pn.getCurrentTimestamp(),d={interface:Ge.Records,method:Le.Write,protocol:e.protocol!==void 0?Ph(e.protocol):void 0,protocolPath:e.protocolPath,recipient:e.recipient,schema:e.schema!==void 0?uS(e.schema):void 0,tags:e.tags,parentId:Gt.getRecordIdFromContextId(e.parentContextId),dataCid:s,dataSize:a,dateCreated:(i=e.dateCreated)!==null&&i!==void 0?i:l,messageTimestamp:(o=e.messageTimestamp)!==null&&o!==void 0?o:l,published:e.published,datePublished:e.datePublished,dataFormat:e.dataFormat};e.published===!0&&e.datePublished===void 0&&(d.datePublished=l),Cs(d);const c=e.recordId,u=yield _i.computeCid(d),f=yield Gt.createAttestation(u,e.attestationSigners),h=yield Gt.createEncryptionProperty(d,e.encryptionInput),p={recordId:c,descriptor:d};f!==void 0&&(p.attestation=f),h!==void 0&&(p.encryption=h);const y=new Gt(p,e.parentContextId);return e.signer!==void 0&&(yield y.sign({signer:e.signer,delegatedGrant:e.delegatedGrant,permissionGrantId:e.permissionGrantId,protocolRole:e.protocolRole})),y})}static getRecordIdFromContextId(e){return e?.split("/").filter(t=>t!=="").pop()}static createFrom(e){var t,n,i,o;return Tn(this,void 0,void 0,function*(){const s=e.recordsWriteMessage,a=yield Gt.parse(s),l=pn.getCurrentTimestamp(),d=(t=e.published)!==null&&t!==void 0?t:e.datePublished?!0:s.descriptor.published;let c;e.datePublished?c=e.datePublished:d&&(s.descriptor.published?c=s.descriptor.datePublished:c=l);const u={recipient:s.descriptor.recipient,recordId:s.recordId,dateCreated:s.descriptor.dateCreated,protocol:s.descriptor.protocol,protocolPath:s.descriptor.protocolPath,schema:s.descriptor.schema,parentContextId:_t.getParentContextFromOfContextId(s.contextId),messageTimestamp:(n=e.messageTimestamp)!==null&&n!==void 0?n:l,published:d,datePublished:c,tags:e.tags,data:e.data,dataCid:e.data?void 0:s.descriptor.dataCid,dataSize:e.data?void 0:s.descriptor.dataSize,dataFormat:(i=e.dataFormat)!==null&&i!==void 0?i:s.descriptor.dataFormat,protocolRole:(o=e.protocolRole)!==null&&o!==void 0?o:a.signaturePayload.protocolRole,delegatedGrant:e.delegatedGrant,signer:e.signer,attestationSigners:e.attestationSigners};return yield Gt.create(u)})}toJSON(){return this.message}encryptSymmetricEncryptionKey(e){return Tn(this,void 0,void 0,function*(){this._message.encryption=yield Gt.createEncryptionProperty(this._message.descriptor,e),delete this._message.authorization,this._signaturePayload=void 0,this._author=void 0})}sign(e){var t;return Tn(this,void 0,void 0,function*(){const{signer:n,delegatedGrant:i,permissionGrantId:o,protocolRole:s}=e;let a,l;i!==void 0?(a=yield Oe.getCid(i),l=un.getSignerDid(i.authorization.signature.signatures[0])):l=un.extractDid(n.keyId);const d=this._message.descriptor,c=yield _i.computeCid(d);this._message.recordId=(t=this._message.recordId)!==null&&t!==void 0?t:yield Gt.getEntryId(l,d),this._message.descriptor.protocol!==void 0&&(this.parentContextId===void 0||this.parentContextId===""?this._message.contextId=this._message.recordId:this._message.contextId=this.parentContextId+"/"+this._message.recordId);const u=yield Gt.createSignerSignature({recordId:this._message.recordId,contextId:this._message.contextId,descriptorCid:c,attestation:this._message.attestation,encryption:this._message.encryption,signer:n,delegatedGrantId:a,permissionGrantId:o,protocolRole:s});this._message.authorization={signature:u},i!==void 0&&(this._message.authorization.authorDelegatedGrant=i),this._signaturePayload=un.decodePlainObjectPayload(u),this._author=l})}signAsOwner(e){return Tn(this,void 0,void 0,function*(){if(this._author===void 0)throw new Ae(we.RecordsWriteSignAsOwnerUnknownAuthor,"Unable to sign as owner without message signature because owner needs to sign over `recordId` which depends on author DID.");const t=this._message.descriptor,n=yield Oe.createSignature(t,e);this._message.authorization.ownerSignature=n,this._ownerSignaturePayload=un.decodePlainObjectPayload(n),this._owner=un.extractDid(e.keyId)})}signAsOwnerDelegate(e,t){return Tn(this,void 0,void 0,function*(){if(this._author===void 0)throw new Ae(we.RecordsWriteSignAsOwnerDelegateUnknownAuthor,"Unable to sign as owner delegate without message signature because owner delegate needs to sign over `recordId` which depends on author DID.");const n=yield Oe.getCid(t),i=this._message.descriptor,o=yield Oe.createSignature(i,e,{delegatedGrantId:n});this._message.authorization.ownerSignature=o,this._message.authorization.ownerDelegatedGrant=t,this._ownerSignaturePayload=un.decodePlainObjectPayload(o),this._owner=un.getSignerDid(t.authorization.signature.signatures[0])})}validateIntegrity(){return Tn(this,void 0,void 0,function*(){if(yield this.isInitialWrite()){const n=this.message.descriptor.dateCreated,i=this.message.descriptor.messageTimestamp;if(i!==n)throw new Ae(we.RecordsWriteValidateIntegrityDateCreatedMismatch,`messageTimestamp ${i} must match dateCreated ${n} for the initial write`);if(this.message.descriptor.protocol!==void 0&&this.message.descriptor.parentId===void 0){const o=yield this.getEntryId();if(this.message.contextId!==o)throw new Ae(we.RecordsWriteValidateIntegrityContextIdMismatch,`contextId in message: ${this.message.contextId} does not match deterministic contextId: ${o}`)}}const t=this.signaturePayload;if(this.message.recordId!==t.recordId)throw new Ae(we.RecordsWriteValidateIntegrityRecordIdUnauthorized,`recordId in message ${this.message.recordId} does not match recordId in authorization: ${t.recordId}`);if(this.message.contextId!==t.contextId)throw new Ae(we.RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload,`contextId in message ${this.message.contextId} does not match contextId in authorization: ${t.contextId}`);if(yield _t.validateDelegatedGrantReferentialIntegrity(this.message,t,this.ownerSignaturePayload),t.attestationCid!==void 0){const n=yield _i.computeCid(this.message.attestation),i=t.attestationCid;if(i!==n)throw new Ae(we.RecordsWriteValidateIntegrityAttestationMismatch,`CID ${n} of attestation property in message does not match attestationCid in authorization: ${i}`)}if(t.encryptionCid!==void 0){const n=yield _i.computeCid(this.message.encryption),i=t.encryptionCid;if(i!==n)throw new Ae(we.RecordsWriteValidateIntegrityEncryptionCidMismatch,`CID ${n} of encryption property in message does not match encryptionCid in authorization: ${i}`)}this.message.descriptor.protocol!==void 0&&Kh(this.message.descriptor.protocol),this.message.descriptor.schema!==void 0&&dS(this.message.descriptor.schema),pn.validateTimestamp(this.message.descriptor.messageTimestamp),pn.validateTimestamp(this.message.descriptor.dateCreated),this.message.descriptor.datePublished&&pn.validateTimestamp(this.message.descriptor.datePublished)})}static validateAttestationIntegrity(e){return Tn(this,void 0,void 0,function*(){if(e.attestation===void 0)return;if(e.attestation.signatures.length!==1)throw new Ae(we.RecordsWriteAttestationIntegrityMoreThanOneSignature,`Currently implementation only supports 1 attester, but got ${e.attestation.signatures.length}`);const t=un.decodePlainObjectPayload(e.attestation),{descriptorCid:n}=t,i=yield _i.computeCid(e.descriptor);if(n!==i)throw new Ae(we.RecordsWriteAttestationIntegrityDescriptorCidMismatch,`descriptorCid ${n} does not match expected descriptorCid ${i}`);const o=Object.keys(t).length;if(o>1)throw new Ae(we.RecordsWriteAttestationIntegrityInvalidPayloadProperty,`Only 'descriptorCid' is allowed in attestation payload, but got ${o} properties.`)})}getEntryId(){return Tn(this,void 0,void 0,function*(){return yield Gt.getEntryId(this.author,this.message.descriptor)})}static getEntryId(e,t){return Tn(this,void 0,void 0,function*(){if(e===void 0)throw new Ae(we.RecordsWriteGetEntryIdUndefinedAuthor,"Property `author` is needed to compute entry ID.");const n=Object.assign({},t);return n.author=e,yield _i.computeCid(n)})}isInitialWrite(){return Tn(this,void 0,void 0,function*(){return(yield this.getEntryId())===this.message.recordId})}constructIndexes(e){return Tn(this,void 0,void 0,function*(){const t=this.message,n=t.descriptor,{tags:i}=n,o=lpe(n,["tags"]);delete o.published;let s=Object.assign(Object.assign({},o),{isLatestBaseState:e,published:!!t.descriptor.published,author:this.author,recordId:t.recordId,entryId:yield Gt.getEntryId(this.author,this.message.descriptor)});if(i!==void 0&&e===!0){const a=_t.buildTagIndexes(Object.assign({},i));s=Object.assign(Object.assign({},s),a)}return this.attesters.length>0&&(s.attester=this.attesters[0]),t.contextId!==void 0&&(s.contextId=t.contextId),s})}authorizeAuthorDelegate(e){return Tn(this,void 0,void 0,function*(){const t=yield Rs.parse(this.message.authorization.authorDelegatedGrant);yield sc.authorizeWrite({recordsWriteMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:t,messageStore:e})})}authorizeOwnerDelegate(e){return Tn(this,void 0,void 0,function*(){const t=yield Rs.parse(this.message.authorization.ownerDelegatedGrant);yield sc.authorizeWrite({recordsWriteMessage:this.message,expectedGrantor:this.owner,expectedGrantee:this.ownerSignatureSigner,permissionGrant:t,messageStore:e})})}static isInitialWrite(e){return Tn(this,void 0,void 0,function*(){if(e.descriptor.interface!==Ge.Records||e.descriptor.method!==Le.Write)return!1;const t=e,n=Oe.getAuthor(t);return(yield Gt.getEntryId(n,t.descriptor))===t.recordId})}static createEncryptionProperty(e,t){var n,i;return Tn(this,void 0,void 0,function*(){if(t===void 0)return;const o=[];for(const a of t.keyEncryptionInputs){if(a.derivationScheme===aa.ProtocolPath&&e.protocol===void 0)throw new Ae(we.RecordsWriteMissingProtocol,"`protocols` encryption scheme cannot be applied to record without the `protocol` property.");if(a.derivationScheme===aa.Schemas&&e.schema===void 0)throw new Ae(we.RecordsWriteMissingSchema,"`schemas` encryption scheme cannot be applied to record without the `schema` property.");const l=Lc.publicJwkToBytes(a.publicKey),d=yield kw.eciesSecp256k1Encrypt(l,t.key),c=vt.bytesToBase64Url(d.ciphertext),u=yield Lc.publicKeyToJwk(d.ephemeralPublicKey),f=vt.bytesToBase64Url(d.initializationVector),h=vt.bytesToBase64Url(d.messageAuthenticationCode),p={rootKeyId:a.publicKeyId,algorithm:(n=a.algorithm)!==null&&n!==void 0?n:bA.EciesSecp256k1,derivationScheme:a.derivationScheme,ephemeralPublicKey:u,initializationVector:f,messageAuthenticationCode:h,encryptedKey:c};a.derivationScheme===aa.ProtocolContext&&(p.derivedPublicKey=a.publicKey),o.push(p)}return{algorithm:(i=t.algorithm)!==null&&i!==void 0?i:bA.Aes256Ctr,initializationVector:vt.bytesToBase64Url(t.initializationVector),keyEncryption:o}})}static createAttestation(e,t){return Tn(this,void 0,void 0,function*(){if(t===void 0||t.length===0)return;const n={descriptorCid:e},i=vt.objectToBytes(n);return(yield Pw.create(i,t)).getJws()})}static createSignerSignature(e){return Tn(this,void 0,void 0,function*(){const{recordId:t,contextId:n,descriptorCid:i,attestation:o,encryption:s,signer:a,delegatedGrantId:l,permissionGrantId:d,protocolRole:c}=e,u=o?yield _i.computeCid(o):void 0,f=s?yield _i.computeCid(s):void 0,h={recordId:t,descriptorCid:i,contextId:n,attestationCid:u,encryptionCid:f,delegatedGrantId:l,permissionGrantId:d,protocolRole:c};Cs(h);const p=vt.objectToBytes(h);return(yield Pw.create(p,[a])).getJws()})}static getInitialWrite(e){return Tn(this,void 0,void 0,function*(){for(const t of e)if(yield Gt.isInitialWrite(t))return t;throw new Ae(we.RecordsWriteGetInitialWriteNotFound,"Initial write is not found.")})}static verifyEqualityOfImmutableProperties(e,t){const n=["dataCid","dataSize","dataFormat","datePublished","published","messageTimestamp","tags"];let i=[];i.push(...Object.keys(e.descriptor)),i.push(...Object.keys(t.descriptor)),i=[...new Set(i)];for(const o of i)if(n.indexOf(o)===-1){const s=e.descriptor[o],a=t.descriptor[o];if(a!==s)throw new Ae(we.RecordsWriteImmutablePropertyChanged,`${o} is an immutable property: cannot change '${s}' to '${a}'`)}return!0}static getAttesters(e){var t,n;return((n=(t=e.attestation)===null||t===void 0?void 0:t.signatures)!==null&&n!==void 0?n:[]).map(s=>un.getSignerDid(s))}static fetchNewestRecordsWrite(e,t,n){return Tn(this,void 0,void 0,function*(){const i={interface:Ge.Records,method:Le.Write,recordId:n},{messages:o}=yield e.query(t,[i]),s=yield Oe.getNewestMessage(o);if(s!==void 0)return s;throw new Ae(we.RecordsWriteGetNewestWriteRecordNotFound,"record not found")})}static fetchInitialRecordsWrite(e,t,n){return Tn(this,void 0,void 0,function*(){const i={entryId:n},{messages:o}=yield e.query(t,[i]);return o.length===0?void 0:yield Gt.parse(o[0])})}}var dpe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function yd(r,e){return dpe(this,void 0,void 0,function*(){if(r===void 0)throw new Ae(we.AuthenticateJwsMissing,"Missing JWS.");if(yield Bc.verifySignatures(r.signature,e),r.ownerSignature!==void 0&&(yield Bc.verifySignatures(r.ownerSignature,e)),r.authorDelegatedGrant!==void 0){const t=yield Gt.parse(r.authorDelegatedGrant);yield Bc.verifySignatures(t.message.authorization.signature,e)}if(r.ownerDelegatedGrant!==void 0){const t=yield Gt.parse(r.ownerDelegatedGrant);yield Bc.verifySignatures(t.message.authorization.signature,e)}})}var upe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class fpe{isActiveTenant(e){return upe(this,void 0,void 0,function*(){return{isActiveTenant:!0}})}}class Gu{get message(){return this._message}get signer(){return this._signer}get author(){return this._author}get signaturePayload(){return this._signaturePayload}get isSignedByAuthorDelegate(){return Oe.isSignedByAuthorDelegate(this._message)}constructor(e){this._message=e,e.authorization!==void 0&&(this._signer=Oe.getSigner(e),e.authorization.authorDelegatedGrant!==void 0?this._author=Oe.getSigner(e.authorization.authorDelegatedGrant):this._author=this._signer,this._signaturePayload=un.decodePlainObjectPayload(e.authorization.signature))}toJSON(){return this.message}}var w$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Dw extends Gu{static parse(e){return w$(this,void 0,void 0,function*(){if(e.descriptor.filter.published===!1&&(e.descriptor.dateSort===Os.PublishedAscending||e.descriptor.dateSort===Os.PublishedDescending))throw new Ae(we.RecordsQueryParseFilterPublishedSortInvalid,`queries must not filter for \`published:false\` and sort by ${e.descriptor.dateSort}`);let t;if(e.authorization!==void 0&&(t=yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield _t.validateDelegatedGrantReferentialIntegrity(e,t),t?.protocolRole!==void 0&&e.descriptor.filter.protocolPath===void 0)throw new Ae(we.RecordsQueryFilterMissingRequiredProperties,"Role-authorized queries must include `protocolPath` in the filter");return e.descriptor.filter.protocol!==void 0&&Kh(e.descriptor.filter.protocol),e.descriptor.filter.schema!==void 0&&dS(e.descriptor.filter.schema),pn.validateTimestamp(e.descriptor.messageTimestamp),new Dw(e)})}static create(e){var t;return w$(this,void 0,void 0,function*(){const n={interface:Ge.Records,method:Le.Query,messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:pn.getCurrentTimestamp(),filter:_t.normalizeFilter(e.filter),dateSort:e.dateSort,pagination:e.pagination};if(e.filter.published===!1&&(e.dateSort===Os.PublishedAscending||e.dateSort===Os.PublishedDescending))throw new Ae(we.RecordsQueryCreateFilterPublishedSortInvalid,`queries must not filter for \`published:false\` and sort by ${e.dateSort}`);Cs(n);const i=e.signer;let o;i&&(o=yield Oe.createAuthorization({descriptor:n,signer:i,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}));const s={descriptor:n,authorization:o};return Oe.validateJsonSchema(s),new Dw(s)})}authorizeDelegate(e){return w$(this,void 0,void 0,function*(){const t=yield Rs.parse(this.message.authorization.authorDelegatedGrant);yield sc.authorizeQueryOrSubscribe({incomingMessage:this.message,expectedGrantee:this.signer,expectedGrantor:this.author,permissionGrant:t,messageStore:e})})}}var kB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class hh{static toBytes(e){return kB(this,void 0,void 0,function*(){return new Promise((t,n)=>{const i=[];e.on("data",o=>{i.push(o)}),e.on("end",()=>{const o=hh.concatenateArrayOfBytes(i);t(o)}),e.on("error",n)})})}static toObject(e){return kB(this,void 0,void 0,function*(){const t=yield hh.toBytes(e);return vt.bytesToObject(t)})}static concatenateArrayOfBytes(e){const t=e.reduce((o,s)=>o+s.length,0),n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.length;return n}static fromBytes(e){let n=0;return new $w.Readable({read(o){n+1e5>e.length?(this.push(e.subarray(n)),this.push(null)):(this.push(e.subarray(n,n+1e5)),n=n+1e5)}})}static fromObject(e){const t=vt.objectToBytes(e);return hh.fromBytes(t)}static duplicateDataStream(e,t){const n=[];for(let i=0;i<t;i++){const o=new $w.PassThrough;e.pipe(o),n.push(o)}return n}}function Dr(r,e){const t=r instanceof Error?r.message:"Error";return{status:{code:e,detail:t}}}var hpe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let MA=class Y7{static parse(e){return hpe(this,void 0,void 0,function*(){return new Y7(e)})}constructor(e){this.id=e.recordId,this.requester=Oe.getSigner(e);const t=e.encodedData,n=vt.base64UrlToObject(t);this.delegated=n.delegated,this.description=n.description,this.scope=n.scope,this.conditions=n.conditions}};var v0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class et{static parseRequest(e){return vt.base64UrlToObject(e)}static createRequest(e){return v0(this,void 0,void 0,function*(){if(this.isRecordPermissionScope(e.scope)&&e.scope.protocol===void 0)throw new Ae(we.PermissionsProtocolCreateRequestRecordsScopeMissingProtocol,"Permission request for Records must have a scope with a `protocol` property");const t=et.normalizePermissionScope(e.scope),n={description:e.description,delegated:e.delegated,scope:t,conditions:e.conditions};let i;this.hasProtocolScope(t)&&(i={protocol:t.protocol});const o=vt.objectToBytes(n),s=yield Gt.create({signer:e.signer,messageTimestamp:e.dateRequested,protocol:et.uri,protocolPath:et.requestPath,dataFormat:"application/json",data:o,tags:i}),a=Object.assign(Object.assign({},s.message),{encodedData:vt.bytesToBase64Url(o)});return{recordsWrite:s,permissionRequestData:n,permissionRequestBytes:o,dataEncodedMessage:a}})}static createGrant(e){return v0(this,void 0,void 0,function*(){if(this.isRecordPermissionScope(e.scope)&&e.scope.protocol===void 0)throw new Ae(we.PermissionsProtocolCreateGrantRecordsScopeMissingProtocol,"Permission grants for Records must have a scope with a `protocol` property");const t=et.normalizePermissionScope(e.scope),n={dateExpires:e.dateExpires,requestId:e.requestId,description:e.description,delegated:e.delegated,scope:t,conditions:e.conditions};let i;this.hasProtocolScope(t)&&(i={protocol:t.protocol});const o=vt.objectToBytes(n),s=yield Gt.create({signer:e.signer,messageTimestamp:e.dateGranted,dateCreated:e.dateGranted,recipient:e.grantedTo,protocol:et.uri,protocolPath:et.grantPath,dataFormat:"application/json",data:o,tags:i}),a=Object.assign(Object.assign({},s.message),{encodedData:vt.bytesToBase64Url(o)});return{recordsWrite:s,permissionGrantData:n,permissionGrantBytes:o,dataEncodedMessage:a}})}static createRevocation(e){return v0(this,void 0,void 0,function*(){const t={description:e.description},n=e.grant.id;let i;this.hasProtocolScope(e.grant.scope)&&(i={protocol:Ph(e.grant.scope.protocol)});const o=vt.objectToBytes(t),s=yield Gt.create({signer:e.signer,parentContextId:n,protocol:et.uri,protocolPath:et.revocationPath,dataFormat:"application/json",data:o,tags:i}),a=Object.assign(Object.assign({},s.message),{encodedData:vt.bytesToBase64Url(o)});return{recordsWrite:s,permissionRevocationData:t,permissionRevocationBytes:o,dataEncodedMessage:a}})}static validateSchema(e,t){const n=vt.bytesToString(t),i=JSON.parse(n);if(e.descriptor.protocolPath===et.requestPath){const o=i;ig("PermissionRequestData",o),et.validateScopeAndTags(o.scope,e)}else if(e.descriptor.protocolPath===et.grantPath){ig("PermissionGrantData",i);const o=i;et.validateScopeAndTags(o.scope,e),pn.validateTimestamp(o.dateExpires)}else if(e.descriptor.protocolPath===et.revocationPath)ig("PermissionRevocationData",i);else throw new Ae(we.PermissionsProtocolValidateSchemaUnexpectedRecord,`Unexpected permission record: ${e.descriptor.protocolPath}`)}static fetchGrant(e,t,n){return v0(this,void 0,void 0,function*(){const i={recordId:n,isLatestBaseState:!0},{messages:o}=yield t.query(e,[i]),s=o[0],a=s?.descriptor.interface,l=s?.descriptor.method;if(a!==Ge.Records||l!==Le.Write||s.descriptor.protocolPath!==et.grantPath)throw new Ae(we.GrantAuthorizationGrantMissing,`Could not find permission grant with record ID ${n}.`);const d=s;return yield Rs.parse(d)})}static getScopeFromPermissionRecord(e,t,n){return v0(this,void 0,void 0,function*(){if(n.descriptor.protocol!==et.uri)throw new Ae(we.PermissionsProtocolGetScopeInvalidProtocol,`Unexpected protocol for permission record: ${n.descriptor.protocol}`);return n.descriptor.protocolPath===et.revocationPath?(yield et.fetchGrant(e,t,n.descriptor.parentId)).scope:n.descriptor.protocolPath===et.grantPath?(yield Rs.parse(n)).scope:(yield MA.parse(n)).scope})}static normalizePermissionScope(e){const t=Object.assign({},e);return et.hasProtocolScope(t)&&(t.protocol=Ph(t.protocol)),t}static isRecordPermissionScope(e){return e.interface==="Records"}static hasProtocolScope(e){return"protocol"in e&&e.protocol!==void 0}static validateTags(e,t){if(e.descriptor.tags===void 0||e.descriptor.tags.protocol===void 0)throw new Ae(we.PermissionsProtocolValidateScopeMissingProtocolTag,"Permission grants must have a `tags` property that contains a protocol tag");const n=e.descriptor.tags.protocol;if(n!==t)throw new Ae(we.PermissionsProtocolValidateScopeProtocolMismatch,`Permission grants must have a scope with a protocol that matches the tagged protocol: ${n}`)}static validateScopeAndTags(e,t){if(this.hasProtocolScope(e)&&(Kh(e.protocol),this.validateTags(t,e.protocol)),!!this.isRecordPermissionScope(e)&&e.contextId!==void 0&&e.protocolPath!==void 0)throw new Ae(we.PermissionsProtocolValidateScopeContextIdProhibitedProperties,"Permission grants cannot have both `contextId` and `protocolPath` present")}}et.uri="https://tbd.website/dwn/permissions";et.requestPath="request";et.grantPath="grant";et.revocationPath="grant/revocation";et.definition={published:!0,protocol:et.uri,types:{request:{dataFormats:["application/json"]},grant:{dataFormats:["application/json"]},revocation:{dataFormats:["application/json"]}},structure:{request:{$size:{max:1e4},$actions:[{who:"anyone",can:["create"]}]},grant:{$size:{max:1e4},$actions:[{who:"recipient",of:"grant",can:["read","query"]}],revocation:{$size:{max:1e4},$actions:[{who:"anyone",can:["read"]}]}}}};class QC{static normalizeFilters(e){const t=[];for(const n of e){const i=n.protocol!==void 0?Ph(n.protocol):void 0,o=Object.assign(Object.assign({},n),{protocol:i});Cs(o),lI(o)||t.push(o)}return t}static convertFilters(e){const t=[];for(const n of e){const i=this.constructPermissionRecordsFilter(n);i&&t.push(i),t.push(this.convertFilter(n))}return t}static constructPermissionRecordsFilter(e){const{protocol:t,messageTimestamp:n}=e;if(t!==void 0){const i=Object.assign({protocol:et.uri},_t.convertTagsFilter({protocol:t}));if(n!=null){const o=Wo.convertRangeCriterion(n);o&&(i.messageTimestamp=o)}return i}}static convertFilter(e){const t=Object.assign({},e),{messageTimestamp:n}=e,i=n?Wo.convertRangeCriterion(n):void 0;return i&&(t.messageTimestamp=i,delete t.dateUpdated),t}}var _$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class W_{static authorizeMessagesRead(e){return _$(this,void 0,void 0,function*(){const{messagesReadMessage:t,messageToRead:n,expectedGrantor:i,expectedGrantee:o,permissionGrant:s,messageStore:a}=e;yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:i,expectedGrantee:o,permissionGrant:s,messageStore:a});const l=s.scope;yield W_.verifyScope(i,n,l,a)})}static authorizeQueryOrSubscribe(e){return _$(this,void 0,void 0,function*(){const{incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}=e;if(yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}),et.hasProtocolScope(o.scope)){const a=o.scope.protocol;for(const l of t.descriptor.filters)if(l.protocol!==a)throw new Ae(we.MessagesGrantAuthorizationMismatchedProtocol,`The protocol ${l.protocol} does not match the scoped protocol ${a}`)}})}static verifyScope(e,t,n,i){return _$(this,void 0,void 0,function*(){if(n.protocol!==void 0){if(t.descriptor.interface===Ge.Records){const o=t,s=_t.isRecordsWrite(o)?o:yield Gt.fetchNewestRecordsWrite(i,e,o.descriptor.recordId);if(s.descriptor.protocol===n.protocol)return;if(s.descriptor.protocol===et.uri){const a=yield et.getScopeFromPermissionRecord(e,i,s);if(et.hasProtocolScope(a)&&a.protocol===n.protocol)return}}else if(t.descriptor.interface===Ge.Protocols&&t.descriptor.definition.protocol===n.protocol)return;throw new Ae(we.MessagesReadVerifyScopeFailed,"record message failed scope authorization")}})}}var PB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Mw extends Gu{static parse(e){return PB(this,void 0,void 0,function*(){Oe.validateJsonSchema(e),yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor);for(const t of e.descriptor.filters)"protocol"in t&&t.protocol!==void 0&&Kh(t.protocol);return new Mw(e)})}static create(e){var t;return PB(this,void 0,void 0,function*(){const n={interface:Ge.Messages,method:Le.Query,filters:e.filters?QC.normalizeFilters(e.filters):[],messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:pn.getCurrentTimestamp(),cursor:e.cursor};Cs(n);const{permissionGrantId:i,signer:o}=e,s=yield Oe.createAuthorization({descriptor:n,signer:o,permissionGrantId:i}),a={descriptor:n,authorization:s};return Oe.validateJsonSchema(a),new Mw(a)})}}var IB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class eR{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.eventLog=n}handle({tenant:e,message:t}){return IB(this,void 0,void 0,function*(){let n;try{n=yield Mw.parse(t)}catch(a){return Dr(a,400)}try{yield yd(t.authorization,this.didResolver),yield eR.authorizeMessagesQuery(e,n,this.messageStore)}catch(a){return Dr(a,401)}const i=QC.convertFilters(t.descriptor.filters),{events:o,cursor:s}=yield this.eventLog.queryEvents(e,i,t.descriptor.cursor);return{status:{code:200,detail:"OK"},entries:o,cursor:s}})}static authorizeMessagesQuery(e,t,n){return IB(this,void 0,void 0,function*(){if(t.author!==e)if(t.author!==void 0&&t.signaturePayload.permissionGrantId!==void 0){const i=yield et.fetchGrant(e,n,t.signaturePayload.permissionGrantId);yield W_.authorizeQueryOrSubscribe({incomingMessage:t.message,expectedGrantor:e,expectedGrantee:t.author,permissionGrant:i,messageStore:n})}else throw new Ae(we.MessagesQueryAuthorizationFailed,"message failed authorization")})}}var OB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class mg extends Gu{static parse(e){return OB(this,void 0,void 0,function*(){return Oe.validateJsonSchema(e),this.validateMessageCid(e.descriptor.messageCid),yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor),pn.validateTimestamp(e.descriptor.messageTimestamp),new mg(e)})}static create(e){var t;return OB(this,void 0,void 0,function*(){const n={interface:Ge.Messages,method:Le.Read,messageCid:e.messageCid,messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:pn.getCurrentTimestamp()},{signer:i,permissionGrantId:o}=e,s=yield Oe.createAuthorization({descriptor:n,signer:i,permissionGrantId:o}),a={descriptor:n,authorization:s};return Oe.validateJsonSchema(a),mg.validateMessageCid(e.messageCid),new mg(a)})}static validateMessageCid(e){try{_i.parseCid(e)}catch{throw new Ae(we.MessagesReadInvalidCid,`${e} is not a valid CID`)}}}var CB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class tR{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.dataStore=n}handle({tenant:e,message:t}){return CB(this,void 0,void 0,function*(){let n;try{n=yield mg.parse(t)}catch(s){return Dr(s,400)}try{yield yd(t.authorization,this.didResolver)}catch(s){return Dr(s,401)}const i=yield this.messageStore.get(e,t.descriptor.messageCid);if(i===void 0)return{status:{code:404,detail:"Not Found"}};try{yield tR.authorizeMessagesRead(e,n,i,this.messageStore)}catch(s){return Dr(s,401)}const o={message:i,messageCid:t.descriptor.messageCid};if(_t.isRecordsWrite(i)){const s=o.message;if(s.encodedData!==void 0){const a=vt.base64UrlToBytes(s.encodedData);o.data=hh.fromBytes(a),delete s.encodedData}else{const a=yield this.dataStore.get(e,s.recordId,s.descriptor.dataCid);a?.dataStream!==void 0&&(o.data=a.dataStream)}}return{status:{code:200,detail:"OK"},entry:o}})}static authorizeMessagesRead(e,t,n,i){return CB(this,void 0,void 0,function*(){if(t.author!==e)if(t.author!==void 0&&t.signaturePayload.permissionGrantId!==void 0){const o=yield et.fetchGrant(e,i,t.signaturePayload.permissionGrantId);yield W_.authorizeMessagesRead({messagesReadMessage:t.message,messageToRead:n,expectedGrantor:e,expectedGrantee:t.author,permissionGrant:o,messageStore:i})}else throw new Ae(we.MessagesReadAuthorizationFailed,"protocol message failed authorization")})}}var RB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Bw extends Gu{static parse(e){return RB(this,void 0,void 0,function*(){Oe.validateJsonSchema(e),yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor);for(const t of e.descriptor.filters)"protocol"in t&&t.protocol!==void 0&&Kh(t.protocol);return pn.validateTimestamp(e.descriptor.messageTimestamp),new Bw(e)})}static create(e){var t,n;return RB(this,void 0,void 0,function*(){const i=pn.getCurrentTimestamp(),o={interface:Ge.Messages,method:Le.Subscribe,filters:(t=e.filters)!==null&&t!==void 0?t:[],messageTimestamp:(n=e.messageTimestamp)!==null&&n!==void 0?n:i};Cs(o);const{permissionGrantId:s,signer:a}=e,l=yield Oe.createAuthorization({descriptor:o,signer:a,permissionGrantId:s}),d={descriptor:o,authorization:l};return Oe.validateJsonSchema(d),new Bw(d)})}}var DB=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class rR{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.eventStream=n}handle({tenant:e,message:t,subscriptionHandler:n}){return DB(this,void 0,void 0,function*(){if(this.eventStream===void 0)return Dr(new Ae(we.MessagesSubscribeEventStreamUnimplemented,"Subscriptions are not supported"),501);let i;try{i=yield Bw.parse(t)}catch(c){return Dr(c,400)}try{yield yd(t.authorization,this.didResolver),yield rR.authorizeMessagesSubscribe(e,i,this.messageStore)}catch(c){return Dr(c,401)}const{filters:o}=t.descriptor,s=QC.convertFilters(o),a=yield Oe.getCid(t),l=(c,u,f)=>{e===c&&Wo.matchAnyFilter(f,s)&&n(u)},d=yield this.eventStream.subscribe(e,a,l);return{status:{code:200,detail:"OK"},subscription:d}})}static authorizeMessagesSubscribe(e,t,n){return DB(this,void 0,void 0,function*(){if(t.author!==e)if(t.author!==void 0&&t.signaturePayload.permissionGrantId!==void 0){const i=yield et.fetchGrant(e,n,t.signaturePayload.permissionGrantId);yield W_.authorizeQueryOrSubscribe({incomingMessage:t.message,expectedGrantor:e,expectedGrantee:t.author,permissionGrant:i,messageStore:n})}else throw new Ae(we.MessagesSubscribeAuthorizationFailed,"message failed authorization")})}}var EI={exports:{}},Z7={},qc={},Jg={},H_={},zt={},jw={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.regexpCode=r.getEsmExportName=r.getProperty=r.safeStringify=r.stringify=r.strConcat=r.addCodeArg=r.str=r._=r.nil=r._Code=r.Name=r.IDENTIFIER=r._CodeOrName=void 0;class e{}r._CodeOrName=e,r.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class t extends e{constructor(v){if(super(),!r.IDENTIFIER.test(v))throw new Error("CodeGen: name must be a valid identifier");this.str=v}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}r.Name=t;class n extends e{constructor(v){super(),this._items=typeof v=="string"?[v]:v}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const v=this._items[0];return v===""||v==='""'}get str(){var v;return(v=this._str)!==null&&v!==void 0?v:this._str=this._items.reduce((m,b)=>`${m}${b}`,"")}get names(){var v;return(v=this._names)!==null&&v!==void 0?v:this._names=this._items.reduce((m,b)=>(b instanceof t&&(m[b.str]=(m[b.str]||0)+1),m),{})}}r._Code=n,r.nil=new n("");function i(w,...v){const m=[w[0]];let b=0;for(;b<v.length;)a(m,v[b]),m.push(w[++b]);return new n(m)}r._=i;const o=new n("+");function s(w,...v){const m=[h(w[0])];let b=0;for(;b<v.length;)m.push(o),a(m,v[b]),m.push(o,h(w[++b]));return l(m),new n(m)}r.str=s;function a(w,v){v instanceof n?w.push(...v._items):v instanceof t?w.push(v):w.push(u(v))}r.addCodeArg=a;function l(w){let v=1;for(;v<w.length-1;){if(w[v]===o){const m=d(w[v-1],w[v+1]);if(m!==void 0){w.splice(v-1,3,m);continue}w[v++]="+"}v++}}function d(w,v){if(v==='""')return w;if(w==='""')return v;if(typeof w=="string")return v instanceof t||w[w.length-1]!=='"'?void 0:typeof v!="string"?`${w.slice(0,-1)}${v}"`:v[0]==='"'?w.slice(0,-1)+v.slice(1):void 0;if(typeof v=="string"&&v[0]==='"'&&!(w instanceof t))return`"${w}${v.slice(1)}`}function c(w,v){return v.emptyStr()?w:w.emptyStr()?v:s`${w}${v}`}r.strConcat=c;function u(w){return typeof w=="number"||typeof w=="boolean"||w===null?w:h(Array.isArray(w)?w.join(","):w)}function f(w){return new n(h(w))}r.stringify=f;function h(w){return JSON.stringify(w).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}r.safeStringify=h;function p(w){return typeof w=="string"&&r.IDENTIFIER.test(w)?new n(`.${w}`):i`[${w}]`}r.getProperty=p;function y(w){if(typeof w=="string"&&r.IDENTIFIER.test(w))return new n(`${w}`);throw new Error(`CodeGen: invalid export name: ${w}, use explicit $id name mapping`)}r.getEsmExportName=y;function g(w){return new n(w.toString())}r.regexpCode=g})(jw);var AI={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ValueScope=r.ValueScopeName=r.Scope=r.varKinds=r.UsedValueState=void 0;const e=jw;class t extends Error{constructor(d){super(`CodeGen: "code" for ${d} not defined`),this.value=d.value}}var n;(function(l){l[l.Started=0]="Started",l[l.Completed=1]="Completed"})(n=r.UsedValueState||(r.UsedValueState={})),r.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class i{constructor({prefixes:d,parent:c}={}){this._names={},this._prefixes=d,this._parent=c}toName(d){return d instanceof e.Name?d:this.name(d)}name(d){return new e.Name(this._newName(d))}_newName(d){const c=this._names[d]||this._nameGroup(d);return`${d}${c.index++}`}_nameGroup(d){var c,u;if(!((u=(c=this._parent)===null||c===void 0?void 0:c._prefixes)===null||u===void 0)&&u.has(d)||this._prefixes&&!this._prefixes.has(d))throw new Error(`CodeGen: prefix "${d}" is not allowed in this scope`);return this._names[d]={prefix:d,index:0}}}r.Scope=i;class o extends e.Name{constructor(d,c){super(c),this.prefix=d}setValue(d,{property:c,itemIndex:u}){this.value=d,this.scopePath=(0,e._)`.${new e.Name(c)}[${u}]`}}r.ValueScopeName=o;const s=(0,e._)`\n`;class a extends i{constructor(d){super(d),this._values={},this._scope=d.scope,this.opts={...d,_n:d.lines?s:e.nil}}get(){return this._scope}name(d){return new o(d,this._newName(d))}value(d,c){var u;if(c.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const f=this.toName(d),{prefix:h}=f,p=(u=c.key)!==null&&u!==void 0?u:c.ref;let y=this._values[h];if(y){const v=y.get(p);if(v)return v}else y=this._values[h]=new Map;y.set(p,f);const g=this._scope[h]||(this._scope[h]=[]),w=g.length;return g[w]=c.ref,f.setValue(c,{property:h,itemIndex:w}),f}getValue(d,c){const u=this._values[d];if(u)return u.get(c)}scopeRefs(d,c=this._values){return this._reduceValues(c,u=>{if(u.scopePath===void 0)throw new Error(`CodeGen: name "${u}" has no value`);return(0,e._)`${d}${u.scopePath}`})}scopeCode(d=this._values,c,u){return this._reduceValues(d,f=>{if(f.value===void 0)throw new Error(`CodeGen: name "${f}" has no value`);return f.value.code},c,u)}_reduceValues(d,c,u={},f){let h=e.nil;for(const p in d){const y=d[p];if(!y)continue;const g=u[p]=u[p]||new Map;y.forEach(w=>{if(g.has(w))return;g.set(w,n.Started);let v=c(w);if(v){const m=this.opts.es5?r.varKinds.var:r.varKinds.const;h=(0,e._)`${h}${m} ${w} = ${v};${this.opts._n}`}else if(v=f?.(w))h=(0,e._)`${h}${v}${this.opts._n}`;else throw new t(w);g.set(w,n.Completed)})}return h}}r.ValueScope=a})(AI);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.or=r.and=r.not=r.CodeGen=r.operators=r.varKinds=r.ValueScopeName=r.ValueScope=r.Scope=r.Name=r.regexpCode=r.stringify=r.getProperty=r.nil=r.strConcat=r.str=r._=void 0;const e=jw,t=AI;var n=jw;Object.defineProperty(r,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(r,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(r,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(r,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(r,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(r,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(r,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(r,"Name",{enumerable:!0,get:function(){return n.Name}});var i=AI;Object.defineProperty(r,"Scope",{enumerable:!0,get:function(){return i.Scope}}),Object.defineProperty(r,"ValueScope",{enumerable:!0,get:function(){return i.ValueScope}}),Object.defineProperty(r,"ValueScopeName",{enumerable:!0,get:function(){return i.ValueScopeName}}),Object.defineProperty(r,"varKinds",{enumerable:!0,get:function(){return i.varKinds}}),r.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class o{optimizeNodes(){return this}optimizeNames(j,G){return this}}class s extends o{constructor(j,G,C){super(),this.varKind=j,this.name=G,this.rhs=C}render({es5:j,_n:G}){const C=j?t.varKinds.var:this.varKind,F=this.rhs===void 0?"":` = ${this.rhs}`;return`${C} ${this.name}${F};`+G}optimizeNames(j,G){if(j[this.name.str])return this.rhs&&(this.rhs=ee(this.rhs,j,G)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class a extends o{constructor(j,G,C){super(),this.lhs=j,this.rhs=G,this.sideEffects=C}render({_n:j}){return`${this.lhs} = ${this.rhs};`+j}optimizeNames(j,G){if(!(this.lhs instanceof e.Name&&!j[this.lhs.str]&&!this.sideEffects))return this.rhs=ee(this.rhs,j,G),this}get names(){const j=this.lhs instanceof e.Name?{}:{...this.lhs.names};return U(j,this.rhs)}}class l extends a{constructor(j,G,C,F){super(j,C,F),this.op=G}render({_n:j}){return`${this.lhs} ${this.op}= ${this.rhs};`+j}}class d extends o{constructor(j){super(),this.label=j,this.names={}}render({_n:j}){return`${this.label}:`+j}}class c extends o{constructor(j){super(),this.label=j,this.names={}}render({_n:j}){return`break${this.label?` ${this.label}`:""};`+j}}class u extends o{constructor(j){super(),this.error=j}render({_n:j}){return`throw ${this.error};`+j}get names(){return this.error.names}}class f extends o{constructor(j){super(),this.code=j}render({_n:j}){return`${this.code};`+j}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(j,G){return this.code=ee(this.code,j,G),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class h extends o{constructor(j=[]){super(),this.nodes=j}render(j){return this.nodes.reduce((G,C)=>G+C.render(j),"")}optimizeNodes(){const{nodes:j}=this;let G=j.length;for(;G--;){const C=j[G].optimizeNodes();Array.isArray(C)?j.splice(G,1,...C):C?j[G]=C:j.splice(G,1)}return j.length>0?this:void 0}optimizeNames(j,G){const{nodes:C}=this;let F=C.length;for(;F--;){const Z=C[F];Z.optimizeNames(j,G)||(R(j,Z.names),C.splice(F,1))}return C.length>0?this:void 0}get names(){return this.nodes.reduce((j,G)=>W(j,G.names),{})}}class p extends h{render(j){return"{"+j._n+super.render(j)+"}"+j._n}}class y extends h{}class g extends p{}g.kind="else";class w extends p{constructor(j,G){super(G),this.condition=j}render(j){let G=`if(${this.condition})`+super.render(j);return this.else&&(G+="else "+this.else.render(j)),G}optimizeNodes(){super.optimizeNodes();const j=this.condition;if(j===!0)return this.nodes;let G=this.else;if(G){const C=G.optimizeNodes();G=this.else=Array.isArray(C)?new g(C):C}if(G)return j===!1?G instanceof w?G:G.nodes:this.nodes.length?this:new w(z(j),G instanceof w?[G]:G.nodes);if(!(j===!1||!this.nodes.length))return this}optimizeNames(j,G){var C;if(this.else=(C=this.else)===null||C===void 0?void 0:C.optimizeNames(j,G),!!(super.optimizeNames(j,G)||this.else))return this.condition=ee(this.condition,j,G),this}get names(){const j=super.names;return U(j,this.condition),this.else&&W(j,this.else.names),j}}w.kind="if";class v extends p{}v.kind="for";class m extends v{constructor(j){super(),this.iteration=j}render(j){return`for(${this.iteration})`+super.render(j)}optimizeNames(j,G){if(super.optimizeNames(j,G))return this.iteration=ee(this.iteration,j,G),this}get names(){return W(super.names,this.iteration.names)}}class b extends v{constructor(j,G,C,F){super(),this.varKind=j,this.name=G,this.from=C,this.to=F}render(j){const G=j.es5?t.varKinds.var:this.varKind,{name:C,from:F,to:Z}=this;return`for(${G} ${C}=${F}; ${C}<${Z}; ${C}++)`+super.render(j)}get names(){const j=U(super.names,this.from);return U(j,this.to)}}class _ extends v{constructor(j,G,C,F){super(),this.loop=j,this.varKind=G,this.name=C,this.iterable=F}render(j){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(j)}optimizeNames(j,G){if(super.optimizeNames(j,G))return this.iterable=ee(this.iterable,j,G),this}get names(){return W(super.names,this.iterable.names)}}class E extends p{constructor(j,G,C){super(),this.name=j,this.args=G,this.async=C}render(j){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(j)}}E.kind="func";class S extends h{render(j){return"return "+super.render(j)}}S.kind="return";class T extends p{render(j){let G="try"+super.render(j);return this.catch&&(G+=this.catch.render(j)),this.finally&&(G+=this.finally.render(j)),G}optimizeNodes(){var j,G;return super.optimizeNodes(),(j=this.catch)===null||j===void 0||j.optimizeNodes(),(G=this.finally)===null||G===void 0||G.optimizeNodes(),this}optimizeNames(j,G){var C,F;return super.optimizeNames(j,G),(C=this.catch)===null||C===void 0||C.optimizeNames(j,G),(F=this.finally)===null||F===void 0||F.optimizeNames(j,G),this}get names(){const j=super.names;return this.catch&&W(j,this.catch.names),this.finally&&W(j,this.finally.names),j}}class O extends p{constructor(j){super(),this.error=j}render(j){return`catch(${this.error})`+super.render(j)}}O.kind="catch";class M extends p{render(j){return"finally"+super.render(j)}}M.kind="finally";class Q{constructor(j,G={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...G,_n:G.lines?`
`:""},this._extScope=j,this._scope=new t.Scope({parent:j}),this._nodes=[new y]}toString(){return this._root.render(this.opts)}name(j){return this._scope.name(j)}scopeName(j){return this._extScope.name(j)}scopeValue(j,G){const C=this._extScope.value(j,G);return(this._values[C.prefix]||(this._values[C.prefix]=new Set)).add(C),C}getScopeValue(j,G){return this._extScope.getValue(j,G)}scopeRefs(j){return this._extScope.scopeRefs(j,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(j,G,C,F){const Z=this._scope.toName(G);return C!==void 0&&F&&(this._constants[Z.str]=C),this._leafNode(new s(j,Z,C)),Z}const(j,G,C){return this._def(t.varKinds.const,j,G,C)}let(j,G,C){return this._def(t.varKinds.let,j,G,C)}var(j,G,C){return this._def(t.varKinds.var,j,G,C)}assign(j,G,C){return this._leafNode(new a(j,G,C))}add(j,G){return this._leafNode(new l(j,r.operators.ADD,G))}code(j){return typeof j=="function"?j():j!==e.nil&&this._leafNode(new f(j)),this}object(...j){const G=["{"];for(const[C,F]of j)G.length>1&&G.push(","),G.push(C),(C!==F||this.opts.es5)&&(G.push(":"),(0,e.addCodeArg)(G,F));return G.push("}"),new e._Code(G)}if(j,G,C){if(this._blockNode(new w(j)),G&&C)this.code(G).else().code(C).endIf();else if(G)this.code(G).endIf();else if(C)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(j){return this._elseNode(new w(j))}else(){return this._elseNode(new g)}endIf(){return this._endBlockNode(w,g)}_for(j,G){return this._blockNode(j),G&&this.code(G).endFor(),this}for(j,G){return this._for(new m(j),G)}forRange(j,G,C,F,Z=this.opts.es5?t.varKinds.var:t.varKinds.let){const te=this._scope.toName(j);return this._for(new b(Z,te,G,C),()=>F(te))}forOf(j,G,C,F=t.varKinds.const){const Z=this._scope.toName(j);if(this.opts.es5){const te=G instanceof e.Name?G:this.var("_arr",G);return this.forRange("_i",0,(0,e._)`${te}.length`,re=>{this.var(Z,(0,e._)`${te}[${re}]`),C(Z)})}return this._for(new _("of",F,Z,G),()=>C(Z))}forIn(j,G,C,F=this.opts.es5?t.varKinds.var:t.varKinds.const){if(this.opts.ownProperties)return this.forOf(j,(0,e._)`Object.keys(${G})`,C);const Z=this._scope.toName(j);return this._for(new _("in",F,Z,G),()=>C(Z))}endFor(){return this._endBlockNode(v)}label(j){return this._leafNode(new d(j))}break(j){return this._leafNode(new c(j))}return(j){const G=new S;if(this._blockNode(G),this.code(j),G.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(S)}try(j,G,C){if(!G&&!C)throw new Error('CodeGen: "try" without "catch" and "finally"');const F=new T;if(this._blockNode(F),this.code(j),G){const Z=this.name("e");this._currNode=F.catch=new O(Z),G(Z)}return C&&(this._currNode=F.finally=new M,this.code(C)),this._endBlockNode(O,M)}throw(j){return this._leafNode(new u(j))}block(j,G){return this._blockStarts.push(this._nodes.length),j&&this.code(j).endBlock(G),this}endBlock(j){const G=this._blockStarts.pop();if(G===void 0)throw new Error("CodeGen: not in self-balancing block");const C=this._nodes.length-G;if(C<0||j!==void 0&&C!==j)throw new Error(`CodeGen: wrong number of nodes: ${C} vs ${j} expected`);return this._nodes.length=G,this}func(j,G=e.nil,C,F){return this._blockNode(new E(j,G,C)),F&&this.code(F).endFunc(),this}endFunc(){return this._endBlockNode(E)}optimize(j=1){for(;j-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(j){return this._currNode.nodes.push(j),this}_blockNode(j){this._currNode.nodes.push(j),this._nodes.push(j)}_endBlockNode(j,G){const C=this._currNode;if(C instanceof j||G&&C instanceof G)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${G?`${j.kind}/${G.kind}`:j.kind}"`)}_elseNode(j){const G=this._currNode;if(!(G instanceof w))throw new Error('CodeGen: "else" without "if"');return this._currNode=G.else=j,this}get _root(){return this._nodes[0]}get _currNode(){const j=this._nodes;return j[j.length-1]}set _currNode(j){const G=this._nodes;G[G.length-1]=j}}r.CodeGen=Q;function W(J,j){for(const G in j)J[G]=(J[G]||0)+(j[G]||0);return J}function U(J,j){return j instanceof e._CodeOrName?W(J,j.names):J}function ee(J,j,G){if(J instanceof e.Name)return C(J);if(!F(J))return J;return new e._Code(J._items.reduce((Z,te)=>(te instanceof e.Name&&(te=C(te)),te instanceof e._Code?Z.push(...te._items):Z.push(te),Z),[]));function C(Z){const te=G[Z.str];return te===void 0||j[Z.str]!==1?Z:(delete j[Z.str],te)}function F(Z){return Z instanceof e._Code&&Z._items.some(te=>te instanceof e.Name&&j[te.str]===1&&G[te.str]!==void 0)}}function R(J,j){for(const G in j)J[G]=(J[G]||0)-(j[G]||0)}function z(J){return typeof J=="boolean"||typeof J=="number"||J===null?!J:(0,e._)`!${V(J)}`}r.not=z;const K=N(r.operators.AND);function Y(...J){return J.reduce(K)}r.and=Y;const I=N(r.operators.OR);function D(...J){return J.reduce(I)}r.or=D;function N(J){return(j,G)=>j===e.nil?G:G===e.nil?j:(0,e._)`${V(j)} ${J} ${V(G)}`}function V(J){return J instanceof e.Name?J:(0,e._)`(${J})`}})(zt);var lr={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.checkStrictMode=r.getErrorPath=r.Type=r.useFunc=r.setEvaluated=r.evaluatedPropsToName=r.mergeEvaluated=r.eachItem=r.unescapeJsonPointer=r.escapeJsonPointer=r.escapeFragment=r.unescapeFragment=r.schemaRefOrVal=r.schemaHasRulesButRef=r.schemaHasRules=r.checkUnknownRules=r.alwaysValidSchema=r.toHash=void 0;const e=zt,t=jw;function n(E){const S={};for(const T of E)S[T]=!0;return S}r.toHash=n;function i(E,S){return typeof S=="boolean"?S:Object.keys(S).length===0?!0:(o(E,S),!s(S,E.self.RULES.all))}r.alwaysValidSchema=i;function o(E,S=E.schema){const{opts:T,self:O}=E;if(!T.strictSchema||typeof S=="boolean")return;const M=O.RULES.keywords;for(const Q in S)M[Q]||_(E,`unknown keyword: "${Q}"`)}r.checkUnknownRules=o;function s(E,S){if(typeof E=="boolean")return!E;for(const T in E)if(S[T])return!0;return!1}r.schemaHasRules=s;function a(E,S){if(typeof E=="boolean")return!E;for(const T in E)if(T!=="$ref"&&S.all[T])return!0;return!1}r.schemaHasRulesButRef=a;function l({topSchemaRef:E,schemaPath:S},T,O,M){if(!M){if(typeof T=="number"||typeof T=="boolean")return T;if(typeof T=="string")return(0,e._)`${T}`}return(0,e._)`${E}${S}${(0,e.getProperty)(O)}`}r.schemaRefOrVal=l;function d(E){return f(decodeURIComponent(E))}r.unescapeFragment=d;function c(E){return encodeURIComponent(u(E))}r.escapeFragment=c;function u(E){return typeof E=="number"?`${E}`:E.replace(/~/g,"~0").replace(/\//g,"~1")}r.escapeJsonPointer=u;function f(E){return E.replace(/~1/g,"/").replace(/~0/g,"~")}r.unescapeJsonPointer=f;function h(E,S){if(Array.isArray(E))for(const T of E)S(T);else S(E)}r.eachItem=h;function p({mergeNames:E,mergeToName:S,mergeValues:T,resultToName:O}){return(M,Q,W,U)=>{const ee=W===void 0?Q:W instanceof e.Name?(Q instanceof e.Name?E(M,Q,W):S(M,Q,W),W):Q instanceof e.Name?(S(M,W,Q),Q):T(Q,W);return U===e.Name&&!(ee instanceof e.Name)?O(M,ee):ee}}r.mergeEvaluated={props:p({mergeNames:(E,S,T)=>E.if((0,e._)`${T} !== true && ${S} !== undefined`,()=>{E.if((0,e._)`${S} === true`,()=>E.assign(T,!0),()=>E.assign(T,(0,e._)`${T} || {}`).code((0,e._)`Object.assign(${T}, ${S})`))}),mergeToName:(E,S,T)=>E.if((0,e._)`${T} !== true`,()=>{S===!0?E.assign(T,!0):(E.assign(T,(0,e._)`${T} || {}`),g(E,T,S))}),mergeValues:(E,S)=>E===!0?!0:{...E,...S},resultToName:y}),items:p({mergeNames:(E,S,T)=>E.if((0,e._)`${T} !== true && ${S} !== undefined`,()=>E.assign(T,(0,e._)`${S} === true ? true : ${T} > ${S} ? ${T} : ${S}`)),mergeToName:(E,S,T)=>E.if((0,e._)`${T} !== true`,()=>E.assign(T,S===!0?!0:(0,e._)`${T} > ${S} ? ${T} : ${S}`)),mergeValues:(E,S)=>E===!0?!0:Math.max(E,S),resultToName:(E,S)=>E.var("items",S)})};function y(E,S){if(S===!0)return E.var("props",!0);const T=E.var("props",(0,e._)`{}`);return S!==void 0&&g(E,T,S),T}r.evaluatedPropsToName=y;function g(E,S,T){Object.keys(T).forEach(O=>E.assign((0,e._)`${S}${(0,e.getProperty)(O)}`,!0))}r.setEvaluated=g;const w={};function v(E,S){return E.scopeValue("func",{ref:S,code:w[S.code]||(w[S.code]=new t._Code(S.code))})}r.useFunc=v;var m;(function(E){E[E.Num=0]="Num",E[E.Str=1]="Str"})(m=r.Type||(r.Type={}));function b(E,S,T){if(E instanceof e.Name){const O=S===m.Num;return T?O?(0,e._)`"[" + ${E} + "]"`:(0,e._)`"['" + ${E} + "']"`:O?(0,e._)`"/" + ${E}`:(0,e._)`"/" + ${E}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return T?(0,e.getProperty)(E).toString():"/"+u(E)}r.getErrorPath=b;function _(E,S,T=E.opts.strictSchema){if(T){if(S=`strict mode: ${S}`,T===!0)throw new Error(S);E.self.logger.warn(S)}}r.checkStrictMode=_})(lr);var Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});const To=zt,ppe={data:new To.Name("data"),valCxt:new To.Name("valCxt"),instancePath:new To.Name("instancePath"),parentData:new To.Name("parentData"),parentDataProperty:new To.Name("parentDataProperty"),rootData:new To.Name("rootData"),dynamicAnchors:new To.Name("dynamicAnchors"),vErrors:new To.Name("vErrors"),errors:new To.Name("errors"),this:new To.Name("this"),self:new To.Name("self"),scope:new To.Name("scope"),json:new To.Name("json"),jsonPos:new To.Name("jsonPos"),jsonLen:new To.Name("jsonLen"),jsonPart:new To.Name("jsonPart")};Pa.default=ppe;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.extendErrors=r.resetErrorsCount=r.reportExtraError=r.reportError=r.keyword$DataError=r.keywordError=void 0;const e=zt,t=lr,n=Pa;r.keywordError={message:({keyword:g})=>(0,e.str)`must pass "${g}" keyword validation`},r.keyword$DataError={message:({keyword:g,schemaType:w})=>w?(0,e.str)`"${g}" keyword must be ${w} ($data)`:(0,e.str)`"${g}" keyword is invalid ($data)`};function i(g,w=r.keywordError,v,m){const{it:b}=g,{gen:_,compositeRule:E,allErrors:S}=b,T=u(g,w,v);m??(E||S)?l(_,T):d(b,(0,e._)`[${T}]`)}r.reportError=i;function o(g,w=r.keywordError,v){const{it:m}=g,{gen:b,compositeRule:_,allErrors:E}=m,S=u(g,w,v);l(b,S),_||E||d(m,n.default.vErrors)}r.reportExtraError=o;function s(g,w){g.assign(n.default.errors,w),g.if((0,e._)`${n.default.vErrors} !== null`,()=>g.if(w,()=>g.assign((0,e._)`${n.default.vErrors}.length`,w),()=>g.assign(n.default.vErrors,null)))}r.resetErrorsCount=s;function a({gen:g,keyword:w,schemaValue:v,data:m,errsCount:b,it:_}){if(b===void 0)throw new Error("ajv implementation error");const E=g.name("err");g.forRange("i",b,n.default.errors,S=>{g.const(E,(0,e._)`${n.default.vErrors}[${S}]`),g.if((0,e._)`${E}.instancePath === undefined`,()=>g.assign((0,e._)`${E}.instancePath`,(0,e.strConcat)(n.default.instancePath,_.errorPath))),g.assign((0,e._)`${E}.schemaPath`,(0,e.str)`${_.errSchemaPath}/${w}`),_.opts.verbose&&(g.assign((0,e._)`${E}.schema`,v),g.assign((0,e._)`${E}.data`,m))})}r.extendErrors=a;function l(g,w){const v=g.const("err",w);g.if((0,e._)`${n.default.vErrors} === null`,()=>g.assign(n.default.vErrors,(0,e._)`[${v}]`),(0,e._)`${n.default.vErrors}.push(${v})`),g.code((0,e._)`${n.default.errors}++`)}function d(g,w){const{gen:v,validateName:m,schemaEnv:b}=g;b.$async?v.throw((0,e._)`new ${g.ValidationError}(${w})`):(v.assign((0,e._)`${m}.errors`,w),v.return(!1))}const c={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function u(g,w,v){const{createErrors:m}=g.it;return m===!1?(0,e._)`{}`:f(g,w,v)}function f(g,w,v={}){const{gen:m,it:b}=g,_=[h(b,v),p(g,v)];return y(g,w,_),m.object(..._)}function h({errorPath:g},{instancePath:w}){const v=w?(0,e.str)`${g}${(0,t.getErrorPath)(w,t.Type.Str)}`:g;return[n.default.instancePath,(0,e.strConcat)(n.default.instancePath,v)]}function p({keyword:g,it:{errSchemaPath:w}},{schemaPath:v,parentSchema:m}){let b=m?w:(0,e.str)`${w}/${g}`;return v&&(b=(0,e.str)`${b}${(0,t.getErrorPath)(v,t.Type.Str)}`),[c.schemaPath,b]}function y(g,{params:w,message:v},m){const{keyword:b,data:_,schemaValue:E,it:S}=g,{opts:T,propertyName:O,topSchemaRef:M,schemaPath:Q}=S;m.push([c.keyword,b],[c.params,typeof w=="function"?w(g):w||(0,e._)`{}`]),T.messages&&m.push([c.message,typeof v=="function"?v(g):v]),T.verbose&&m.push([c.schema,E],[c.parentSchema,(0,e._)`${M}${Q}`],[n.default.data,_]),O&&m.push([c.propertyName,O])}})(H_);Object.defineProperty(Jg,"__esModule",{value:!0});Jg.boolOrEmptySchema=Jg.topBoolOrEmptySchema=void 0;const ype=H_,mpe=zt,gpe=Pa,vpe={message:"boolean schema is false"};function bpe(r){const{gen:e,schema:t,validateName:n}=r;t===!1?J7(r,!1):typeof t=="object"&&t.$async===!0?e.return(gpe.default.data):(e.assign((0,mpe._)`${n}.errors`,null),e.return(!0))}Jg.topBoolOrEmptySchema=bpe;function wpe(r,e){const{gen:t,schema:n}=r;n===!1?(t.var(e,!1),J7(r)):t.var(e,!0)}Jg.boolOrEmptySchema=wpe;function J7(r,e){const{gen:t,data:n}=r,i={gen:t,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:r};(0,ype.reportError)(i,vpe,void 0,e)}var G_={},Ny={};Object.defineProperty(Ny,"__esModule",{value:!0});Ny.getRules=Ny.isJSONType=void 0;const _pe=["string","number","integer","boolean","null","object","array"],Epe=new Set(_pe);function Ape(r){return typeof r=="string"&&Epe.has(r)}Ny.isJSONType=Ape;function xpe(){const r={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...r,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},r.number,r.string,r.array,r.object],post:{rules:[]},all:{},keywords:{}}}Ny.getRules=xpe;var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});Eu.shouldUseRule=Eu.shouldUseGroup=Eu.schemaHasRulesForType=void 0;function Spe({schema:r,self:e},t){const n=e.RULES.types[t];return n&&n!==!0&&X7(r,n)}Eu.schemaHasRulesForType=Spe;function X7(r,e){return e.rules.some(t=>Q7(r,t))}Eu.shouldUseGroup=X7;function Q7(r,e){var t;return r[e.keyword]!==void 0||((t=e.definition.implements)===null||t===void 0?void 0:t.some(n=>r[n]!==void 0))}Eu.shouldUseRule=Q7;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.reportTypeError=r.checkDataTypes=r.checkDataType=r.coerceAndCheckDataType=r.getJSONTypes=r.getSchemaTypes=r.DataType=void 0;const e=Ny,t=Eu,n=H_,i=zt,o=lr;var s;(function(m){m[m.Correct=0]="Correct",m[m.Wrong=1]="Wrong"})(s=r.DataType||(r.DataType={}));function a(m){const b=l(m.type);if(b.includes("null")){if(m.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!b.length&&m.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');m.nullable===!0&&b.push("null")}return b}r.getSchemaTypes=a;function l(m){const b=Array.isArray(m)?m:m?[m]:[];if(b.every(e.isJSONType))return b;throw new Error("type must be JSONType or JSONType[]: "+b.join(","))}r.getJSONTypes=l;function d(m,b){const{gen:_,data:E,opts:S}=m,T=u(b,S.coerceTypes),O=b.length>0&&!(T.length===0&&b.length===1&&(0,t.schemaHasRulesForType)(m,b[0]));if(O){const M=y(b,E,S.strictNumbers,s.Wrong);_.if(M,()=>{T.length?f(m,b,T):w(m)})}return O}r.coerceAndCheckDataType=d;const c=new Set(["string","number","integer","boolean","null"]);function u(m,b){return b?m.filter(_=>c.has(_)||b==="array"&&_==="array"):[]}function f(m,b,_){const{gen:E,data:S,opts:T}=m,O=E.let("dataType",(0,i._)`typeof ${S}`),M=E.let("coerced",(0,i._)`undefined`);T.coerceTypes==="array"&&E.if((0,i._)`${O} == 'object' && Array.isArray(${S}) && ${S}.length == 1`,()=>E.assign(S,(0,i._)`${S}[0]`).assign(O,(0,i._)`typeof ${S}`).if(y(b,S,T.strictNumbers),()=>E.assign(M,S))),E.if((0,i._)`${M} !== undefined`);for(const W of _)(c.has(W)||W==="array"&&T.coerceTypes==="array")&&Q(W);E.else(),w(m),E.endIf(),E.if((0,i._)`${M} !== undefined`,()=>{E.assign(S,M),h(m,M)});function Q(W){switch(W){case"string":E.elseIf((0,i._)`${O} == "number" || ${O} == "boolean"`).assign(M,(0,i._)`"" + ${S}`).elseIf((0,i._)`${S} === null`).assign(M,(0,i._)`""`);return;case"number":E.elseIf((0,i._)`${O} == "boolean" || ${S} === null
              || (${O} == "string" && ${S} && ${S} == +${S})`).assign(M,(0,i._)`+${S}`);return;case"integer":E.elseIf((0,i._)`${O} === "boolean" || ${S} === null
              || (${O} === "string" && ${S} && ${S} == +${S} && !(${S} % 1))`).assign(M,(0,i._)`+${S}`);return;case"boolean":E.elseIf((0,i._)`${S} === "false" || ${S} === 0 || ${S} === null`).assign(M,!1).elseIf((0,i._)`${S} === "true" || ${S} === 1`).assign(M,!0);return;case"null":E.elseIf((0,i._)`${S} === "" || ${S} === 0 || ${S} === false`),E.assign(M,null);return;case"array":E.elseIf((0,i._)`${O} === "string" || ${O} === "number"
              || ${O} === "boolean" || ${S} === null`).assign(M,(0,i._)`[${S}]`)}}}function h({gen:m,parentData:b,parentDataProperty:_},E){m.if((0,i._)`${b} !== undefined`,()=>m.assign((0,i._)`${b}[${_}]`,E))}function p(m,b,_,E=s.Correct){const S=E===s.Correct?i.operators.EQ:i.operators.NEQ;let T;switch(m){case"null":return(0,i._)`${b} ${S} null`;case"array":T=(0,i._)`Array.isArray(${b})`;break;case"object":T=(0,i._)`${b} && typeof ${b} == "object" && !Array.isArray(${b})`;break;case"integer":T=O((0,i._)`!(${b} % 1) && !isNaN(${b})`);break;case"number":T=O();break;default:return(0,i._)`typeof ${b} ${S} ${m}`}return E===s.Correct?T:(0,i.not)(T);function O(M=i.nil){return(0,i.and)((0,i._)`typeof ${b} == "number"`,M,_?(0,i._)`isFinite(${b})`:i.nil)}}r.checkDataType=p;function y(m,b,_,E){if(m.length===1)return p(m[0],b,_,E);let S;const T=(0,o.toHash)(m);if(T.array&&T.object){const O=(0,i._)`typeof ${b} != "object"`;S=T.null?O:(0,i._)`!${b} || ${O}`,delete T.null,delete T.array,delete T.object}else S=i.nil;T.number&&delete T.integer;for(const O in T)S=(0,i.and)(S,p(O,b,_,E));return S}r.checkDataTypes=y;const g={message:({schema:m})=>`must be ${m}`,params:({schema:m,schemaValue:b})=>typeof m=="string"?(0,i._)`{type: ${m}}`:(0,i._)`{type: ${b}}`};function w(m){const b=v(m);(0,n.reportError)(b,g)}r.reportTypeError=w;function v(m){const{gen:b,data:_,schema:E}=m,S=(0,o.schemaRefOrVal)(m,E,"type");return{gen:b,keyword:"type",data:_,schema:E.type,schemaCode:S,schemaValue:S,parentSchema:E,params:{},it:m}}})(G_);var kS={};Object.defineProperty(kS,"__esModule",{value:!0});kS.assignDefaults=void 0;const _m=zt,Tpe=lr;function $pe(r,e){const{properties:t,items:n}=r.schema;if(e==="object"&&t)for(const i in t)MB(r,i,t[i].default);else e==="array"&&Array.isArray(n)&&n.forEach((i,o)=>MB(r,o,i.default))}kS.assignDefaults=$pe;function MB(r,e,t){const{gen:n,compositeRule:i,data:o,opts:s}=r;if(t===void 0)return;const a=(0,_m._)`${o}${(0,_m.getProperty)(e)}`;if(i){(0,Tpe.checkStrictMode)(r,`default is ignored for: ${a}`);return}let l=(0,_m._)`${a} === undefined`;s.useDefaults==="empty"&&(l=(0,_m._)`${l} || ${a} === null || ${a} === ""`),n.if(l,(0,_m._)`${a} = ${(0,_m.stringify)(t)}`)}var Ll={},tr={};Object.defineProperty(tr,"__esModule",{value:!0});tr.validateUnion=tr.validateArray=tr.usePattern=tr.callValidateCode=tr.schemaProperties=tr.allSchemaProperties=tr.noPropertyInData=tr.propertyInData=tr.isOwnProperty=tr.hasPropFunc=tr.reportMissingProp=tr.checkMissingProp=tr.checkReportMissingProp=void 0;const hn=zt,nR=lr,yf=Pa,kpe=lr;function Ppe(r,e){const{gen:t,data:n,it:i}=r;t.if(oR(t,n,e,i.opts.ownProperties),()=>{r.setParams({missingProperty:(0,hn._)`${e}`},!0),r.error()})}tr.checkReportMissingProp=Ppe;function Ipe({gen:r,data:e,it:{opts:t}},n,i){return(0,hn.or)(...n.map(o=>(0,hn.and)(oR(r,e,o,t.ownProperties),(0,hn._)`${i} = ${o}`)))}tr.checkMissingProp=Ipe;function Ope(r,e){r.setParams({missingProperty:e},!0),r.error()}tr.reportMissingProp=Ope;function eq(r){return r.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,hn._)`Object.prototype.hasOwnProperty`})}tr.hasPropFunc=eq;function iR(r,e,t){return(0,hn._)`${eq(r)}.call(${e}, ${t})`}tr.isOwnProperty=iR;function Cpe(r,e,t,n){const i=(0,hn._)`${e}${(0,hn.getProperty)(t)} !== undefined`;return n?(0,hn._)`${i} && ${iR(r,e,t)}`:i}tr.propertyInData=Cpe;function oR(r,e,t,n){const i=(0,hn._)`${e}${(0,hn.getProperty)(t)} === undefined`;return n?(0,hn.or)(i,(0,hn.not)(iR(r,e,t))):i}tr.noPropertyInData=oR;function tq(r){return r?Object.keys(r).filter(e=>e!=="__proto__"):[]}tr.allSchemaProperties=tq;function Rpe(r,e){return tq(e).filter(t=>!(0,nR.alwaysValidSchema)(r,e[t]))}tr.schemaProperties=Rpe;function Dpe({schemaCode:r,data:e,it:{gen:t,topSchemaRef:n,schemaPath:i,errorPath:o},it:s},a,l,d){const c=d?(0,hn._)`${r}, ${e}, ${n}${i}`:e,u=[[yf.default.instancePath,(0,hn.strConcat)(yf.default.instancePath,o)],[yf.default.parentData,s.parentData],[yf.default.parentDataProperty,s.parentDataProperty],[yf.default.rootData,yf.default.rootData]];s.opts.dynamicRef&&u.push([yf.default.dynamicAnchors,yf.default.dynamicAnchors]);const f=(0,hn._)`${c}, ${t.object(...u)}`;return l!==hn.nil?(0,hn._)`${a}.call(${l}, ${f})`:(0,hn._)`${a}(${f})`}tr.callValidateCode=Dpe;const Mpe=(0,hn._)`new RegExp`;function Bpe({gen:r,it:{opts:e}},t){const n=e.unicodeRegExp?"u":"",{regExp:i}=e.code,o=i(t,n);return r.scopeValue("pattern",{key:o.toString(),ref:o,code:(0,hn._)`${i.code==="new RegExp"?Mpe:(0,kpe.useFunc)(r,i)}(${t}, ${n})`})}tr.usePattern=Bpe;function jpe(r){const{gen:e,data:t,keyword:n,it:i}=r,o=e.name("valid");if(i.allErrors){const a=e.let("valid",!0);return s(()=>e.assign(a,!1)),a}return e.var(o,!0),s(()=>e.break()),o;function s(a){const l=e.const("len",(0,hn._)`${t}.length`);e.forRange("i",0,l,d=>{r.subschema({keyword:n,dataProp:d,dataPropType:nR.Type.Num},o),e.if((0,hn.not)(o),a)})}}tr.validateArray=jpe;function Npe(r){const{gen:e,schema:t,keyword:n,it:i}=r;if(!Array.isArray(t))throw new Error("ajv implementation error");if(t.some(l=>(0,nR.alwaysValidSchema)(i,l))&&!i.opts.unevaluated)return;const s=e.let("valid",!1),a=e.name("_valid");e.block(()=>t.forEach((l,d)=>{const c=r.subschema({keyword:n,schemaProp:d,compositeRule:!0},a);e.assign(s,(0,hn._)`${s} || ${a}`),r.mergeValidEvaluated(c,a)||e.if((0,hn.not)(s))})),r.result(s,()=>r.reset(),()=>r.error(!0))}tr.validateUnion=Npe;Object.defineProperty(Ll,"__esModule",{value:!0});Ll.validateKeywordUsage=Ll.validSchemaType=Ll.funcKeywordCode=Ll.macroKeywordCode=void 0;const ss=zt,Rp=Pa,Upe=tr,Lpe=H_;function Kpe(r,e){const{gen:t,keyword:n,schema:i,parentSchema:o,it:s}=r,a=e.macro.call(s.self,i,o,s),l=rq(t,n,a);s.opts.validateSchema!==!1&&s.self.validateSchema(a,!0);const d=t.name("valid");r.subschema({schema:a,schemaPath:ss.nil,errSchemaPath:`${s.errSchemaPath}/${n}`,topSchemaRef:l,compositeRule:!0},d),r.pass(d,()=>r.error(!0))}Ll.macroKeywordCode=Kpe;function zpe(r,e){var t;const{gen:n,keyword:i,schema:o,parentSchema:s,$data:a,it:l}=r;qpe(l,e);const d=!a&&e.compile?e.compile.call(l.self,o,s,l):e.validate,c=rq(n,i,d),u=n.let("valid");r.block$data(u,f),r.ok((t=e.valid)!==null&&t!==void 0?t:u);function f(){if(e.errors===!1)y(),e.modifying&&BB(r),g(()=>r.error());else{const w=e.async?h():p();e.modifying&&BB(r),g(()=>Fpe(r,w))}}function h(){const w=n.let("ruleErrs",null);return n.try(()=>y((0,ss._)`await `),v=>n.assign(u,!1).if((0,ss._)`${v} instanceof ${l.ValidationError}`,()=>n.assign(w,(0,ss._)`${v}.errors`),()=>n.throw(v))),w}function p(){const w=(0,ss._)`${c}.errors`;return n.assign(w,null),y(ss.nil),w}function y(w=e.async?(0,ss._)`await `:ss.nil){const v=l.opts.passContext?Rp.default.this:Rp.default.self,m=!("compile"in e&&!a||e.schema===!1);n.assign(u,(0,ss._)`${w}${(0,Upe.callValidateCode)(r,c,v,m)}`,e.modifying)}function g(w){var v;n.if((0,ss.not)((v=e.valid)!==null&&v!==void 0?v:u),w)}}Ll.funcKeywordCode=zpe;function BB(r){const{gen:e,data:t,it:n}=r;e.if(n.parentData,()=>e.assign(t,(0,ss._)`${n.parentData}[${n.parentDataProperty}]`))}function Fpe(r,e){const{gen:t}=r;t.if((0,ss._)`Array.isArray(${e})`,()=>{t.assign(Rp.default.vErrors,(0,ss._)`${Rp.default.vErrors} === null ? ${e} : ${Rp.default.vErrors}.concat(${e})`).assign(Rp.default.errors,(0,ss._)`${Rp.default.vErrors}.length`),(0,Lpe.extendErrors)(r)},()=>r.error())}function qpe({schemaEnv:r},e){if(e.async&&!r.$async)throw new Error("async keyword in sync schema")}function rq(r,e,t){if(t===void 0)throw new Error(`keyword "${e}" failed to compile`);return r.scopeValue("keyword",typeof t=="function"?{ref:t}:{ref:t,code:(0,ss.stringify)(t)})}function Vpe(r,e,t=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(r):n==="object"?r&&typeof r=="object"&&!Array.isArray(r):typeof r==n||t&&typeof r>"u")}Ll.validSchemaType=Vpe;function Wpe({schema:r,opts:e,self:t,errSchemaPath:n},i,o){if(Array.isArray(i.keyword)?!i.keyword.includes(o):i.keyword!==o)throw new Error("ajv implementation error");const s=i.dependencies;if(s?.some(a=>!Object.prototype.hasOwnProperty.call(r,a)))throw new Error(`parent schema must have dependencies of ${o}: ${s.join(",")}`);if(i.validateSchema&&!i.validateSchema(r[o])){const l=`keyword "${o}" value is invalid at path "${n}": `+t.errorsText(i.validateSchema.errors);if(e.validateSchema==="log")t.logger.error(l);else throw new Error(l)}}Ll.validateKeywordUsage=Wpe;var ph={};Object.defineProperty(ph,"__esModule",{value:!0});ph.extendSubschemaMode=ph.extendSubschemaData=ph.getSubschema=void 0;const Bl=zt,nq=lr;function Hpe(r,{keyword:e,schemaProp:t,schema:n,schemaPath:i,errSchemaPath:o,topSchemaRef:s}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const a=r.schema[e];return t===void 0?{schema:a,schemaPath:(0,Bl._)`${r.schemaPath}${(0,Bl.getProperty)(e)}`,errSchemaPath:`${r.errSchemaPath}/${e}`}:{schema:a[t],schemaPath:(0,Bl._)`${r.schemaPath}${(0,Bl.getProperty)(e)}${(0,Bl.getProperty)(t)}`,errSchemaPath:`${r.errSchemaPath}/${e}/${(0,nq.escapeFragment)(t)}`}}if(n!==void 0){if(i===void 0||o===void 0||s===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:i,topSchemaRef:s,errSchemaPath:o}}throw new Error('either "keyword" or "schema" must be passed')}ph.getSubschema=Hpe;function Gpe(r,e,{dataProp:t,dataPropType:n,data:i,dataTypes:o,propertyName:s}){if(i!==void 0&&t!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:a}=e;if(t!==void 0){const{errorPath:d,dataPathArr:c,opts:u}=e,f=a.let("data",(0,Bl._)`${e.data}${(0,Bl.getProperty)(t)}`,!0);l(f),r.errorPath=(0,Bl.str)`${d}${(0,nq.getErrorPath)(t,n,u.jsPropertySyntax)}`,r.parentDataProperty=(0,Bl._)`${t}`,r.dataPathArr=[...c,r.parentDataProperty]}if(i!==void 0){const d=i instanceof Bl.Name?i:a.let("data",i,!0);l(d),s!==void 0&&(r.propertyName=s)}o&&(r.dataTypes=o);function l(d){r.data=d,r.dataLevel=e.dataLevel+1,r.dataTypes=[],e.definedProperties=new Set,r.parentData=e.data,r.dataNames=[...e.dataNames,d]}}ph.extendSubschemaData=Gpe;function Ype(r,{jtdDiscriminator:e,jtdMetadata:t,compositeRule:n,createErrors:i,allErrors:o}){n!==void 0&&(r.compositeRule=n),i!==void 0&&(r.createErrors=i),o!==void 0&&(r.allErrors=o),r.jtdDiscriminator=e,r.jtdMetadata=t}ph.extendSubschemaMode=Ype;var ho={},iq=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,i,o;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(!r(e[i],t[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[i]))return!1;for(i=n;i--!==0;){var s=o[i];if(!r(e[s],t[s]))return!1}return!0}return e!==e&&t!==t},oq={exports:{}},ch=oq.exports=function(r,e,t){typeof e=="function"&&(t=e,e={}),t=e.cb||t;var n=typeof t=="function"?t:t.pre||function(){},i=t.post||function(){};lE(e,n,i,r,"",r)};ch.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};ch.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};ch.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};ch.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function lE(r,e,t,n,i,o,s,a,l,d){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,i,o,s,a,l,d);for(var c in n){var u=n[c];if(Array.isArray(u)){if(c in ch.arrayKeywords)for(var f=0;f<u.length;f++)lE(r,e,t,u[f],i+"/"+c+"/"+f,o,i,c,n,f)}else if(c in ch.propsKeywords){if(u&&typeof u=="object")for(var h in u)lE(r,e,t,u[h],i+"/"+c+"/"+Zpe(h),o,i,c,n,h)}else(c in ch.keywords||r.allKeys&&!(c in ch.skipKeywords))&&lE(r,e,t,u,i+"/"+c,o,i,c,n)}t(n,i,o,s,a,l,d)}}function Zpe(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var Jpe=oq.exports;Object.defineProperty(ho,"__esModule",{value:!0});ho.getSchemaRefs=ho.resolveUrl=ho.normalizeId=ho._getFullPath=ho.getFullPath=ho.inlineRef=void 0;const Xpe=lr,Qpe=iq,eye=Jpe,tye=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function rye(r,e=!0){return typeof r=="boolean"?!0:e===!0?!xI(r):e?sq(r)<=e:!1}ho.inlineRef=rye;const nye=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function xI(r){for(const e in r){if(nye.has(e))return!0;const t=r[e];if(Array.isArray(t)&&t.some(xI)||typeof t=="object"&&xI(t))return!0}return!1}function sq(r){let e=0;for(const t in r){if(t==="$ref")return 1/0;if(e++,!tye.has(t)&&(typeof r[t]=="object"&&(0,Xpe.eachItem)(r[t],n=>e+=sq(n)),e===1/0))return 1/0}return e}function aq(r,e="",t){t!==!1&&(e=gg(e));const n=r.parse(e);return cq(r,n)}ho.getFullPath=aq;function cq(r,e){return r.serialize(e).split("#")[0]+"#"}ho._getFullPath=cq;const iye=/#\/?$/;function gg(r){return r?r.replace(iye,""):""}ho.normalizeId=gg;function oye(r,e,t){return t=gg(t),r.resolve(e,t)}ho.resolveUrl=oye;const sye=/^[a-z_][-a-z0-9._]*$/i;function aye(r,e){if(typeof r=="boolean")return{};const{schemaId:t,uriResolver:n}=this.opts,i=gg(r[t]||e),o={"":i},s=aq(n,i,!1),a={},l=new Set;return eye(r,{allKeys:!0},(u,f,h,p)=>{if(p===void 0)return;const y=s+f;let g=o[p];typeof u[t]=="string"&&(g=w.call(this,u[t])),v.call(this,u.$anchor),v.call(this,u.$dynamicAnchor),o[f]=g;function w(m){const b=this.opts.uriResolver.resolve;if(m=gg(g?b(g,m):m),l.has(m))throw c(m);l.add(m);let _=this.refs[m];return typeof _=="string"&&(_=this.refs[_]),typeof _=="object"?d(u,_.schema,m):m!==gg(y)&&(m[0]==="#"?(d(u,a[m],m),a[m]=u):this.refs[m]=y),m}function v(m){if(typeof m=="string"){if(!sye.test(m))throw new Error(`invalid anchor "${m}"`);w.call(this,`#${m}`)}}}),a;function d(u,f,h){if(f!==void 0&&!Qpe(u,f))throw c(h)}function c(u){return new Error(`reference "${u}" resolves to more than one schema`)}}ho.getSchemaRefs=aye;Object.defineProperty(qc,"__esModule",{value:!0});qc.getData=qc.KeywordCxt=qc.validateFunctionCode=void 0;const lq=Jg,jB=G_,sR=Eu,BA=G_,cye=kS,Jb=Ll,E$=ph,it=zt,Rt=Pa,lye=ho,Au=lr,b0=H_;function dye(r){if(fq(r)&&(hq(r),uq(r))){hye(r);return}dq(r,()=>(0,lq.topBoolOrEmptySchema)(r))}qc.validateFunctionCode=dye;function dq({gen:r,validateName:e,schema:t,schemaEnv:n,opts:i},o){i.code.es5?r.func(e,(0,it._)`${Rt.default.data}, ${Rt.default.valCxt}`,n.$async,()=>{r.code((0,it._)`"use strict"; ${NB(t,i)}`),fye(r,i),r.code(o)}):r.func(e,(0,it._)`${Rt.default.data}, ${uye(i)}`,n.$async,()=>r.code(NB(t,i)).code(o))}function uye(r){return(0,it._)`{${Rt.default.instancePath}="", ${Rt.default.parentData}, ${Rt.default.parentDataProperty}, ${Rt.default.rootData}=${Rt.default.data}${r.dynamicRef?(0,it._)`, ${Rt.default.dynamicAnchors}={}`:it.nil}}={}`}function fye(r,e){r.if(Rt.default.valCxt,()=>{r.var(Rt.default.instancePath,(0,it._)`${Rt.default.valCxt}.${Rt.default.instancePath}`),r.var(Rt.default.parentData,(0,it._)`${Rt.default.valCxt}.${Rt.default.parentData}`),r.var(Rt.default.parentDataProperty,(0,it._)`${Rt.default.valCxt}.${Rt.default.parentDataProperty}`),r.var(Rt.default.rootData,(0,it._)`${Rt.default.valCxt}.${Rt.default.rootData}`),e.dynamicRef&&r.var(Rt.default.dynamicAnchors,(0,it._)`${Rt.default.valCxt}.${Rt.default.dynamicAnchors}`)},()=>{r.var(Rt.default.instancePath,(0,it._)`""`),r.var(Rt.default.parentData,(0,it._)`undefined`),r.var(Rt.default.parentDataProperty,(0,it._)`undefined`),r.var(Rt.default.rootData,Rt.default.data),e.dynamicRef&&r.var(Rt.default.dynamicAnchors,(0,it._)`{}`)})}function hye(r){const{schema:e,opts:t,gen:n}=r;dq(r,()=>{t.$comment&&e.$comment&&yq(r),vye(r),n.let(Rt.default.vErrors,null),n.let(Rt.default.errors,0),t.unevaluated&&pye(r),pq(r),_ye(r)})}function pye(r){const{gen:e,validateName:t}=r;r.evaluated=e.const("evaluated",(0,it._)`${t}.evaluated`),e.if((0,it._)`${r.evaluated}.dynamicProps`,()=>e.assign((0,it._)`${r.evaluated}.props`,(0,it._)`undefined`)),e.if((0,it._)`${r.evaluated}.dynamicItems`,()=>e.assign((0,it._)`${r.evaluated}.items`,(0,it._)`undefined`))}function NB(r,e){const t=typeof r=="object"&&r[e.schemaId];return t&&(e.code.source||e.code.process)?(0,it._)`/*# sourceURL=${t} */`:it.nil}function yye(r,e){if(fq(r)&&(hq(r),uq(r))){mye(r,e);return}(0,lq.boolOrEmptySchema)(r,e)}function uq({schema:r,self:e}){if(typeof r=="boolean")return!r;for(const t in r)if(e.RULES.all[t])return!0;return!1}function fq(r){return typeof r.schema!="boolean"}function mye(r,e){const{schema:t,gen:n,opts:i}=r;i.$comment&&t.$comment&&yq(r),bye(r),wye(r);const o=n.const("_errs",Rt.default.errors);pq(r,o),n.var(e,(0,it._)`${o} === ${Rt.default.errors}`)}function hq(r){(0,Au.checkUnknownRules)(r),gye(r)}function pq(r,e){if(r.opts.jtd)return UB(r,[],!1,e);const t=(0,jB.getSchemaTypes)(r.schema),n=(0,jB.coerceAndCheckDataType)(r,t);UB(r,t,!n,e)}function gye(r){const{schema:e,errSchemaPath:t,opts:n,self:i}=r;e.$ref&&n.ignoreKeywordsWithRef&&(0,Au.schemaHasRulesButRef)(e,i.RULES)&&i.logger.warn(`$ref: keywords ignored in schema at path "${t}"`)}function vye(r){const{schema:e,opts:t}=r;e.default!==void 0&&t.useDefaults&&t.strictSchema&&(0,Au.checkStrictMode)(r,"default is ignored in the schema root")}function bye(r){const e=r.schema[r.opts.schemaId];e&&(r.baseId=(0,lye.resolveUrl)(r.opts.uriResolver,r.baseId,e))}function wye(r){if(r.schema.$async&&!r.schemaEnv.$async)throw new Error("async schema in sync schema")}function yq({gen:r,schemaEnv:e,schema:t,errSchemaPath:n,opts:i}){const o=t.$comment;if(i.$comment===!0)r.code((0,it._)`${Rt.default.self}.logger.log(${o})`);else if(typeof i.$comment=="function"){const s=(0,it.str)`${n}/$comment`,a=r.scopeValue("root",{ref:e.root});r.code((0,it._)`${Rt.default.self}.opts.$comment(${o}, ${s}, ${a}.schema)`)}}function _ye(r){const{gen:e,schemaEnv:t,validateName:n,ValidationError:i,opts:o}=r;t.$async?e.if((0,it._)`${Rt.default.errors} === 0`,()=>e.return(Rt.default.data),()=>e.throw((0,it._)`new ${i}(${Rt.default.vErrors})`)):(e.assign((0,it._)`${n}.errors`,Rt.default.vErrors),o.unevaluated&&Eye(r),e.return((0,it._)`${Rt.default.errors} === 0`))}function Eye({gen:r,evaluated:e,props:t,items:n}){t instanceof it.Name&&r.assign((0,it._)`${e}.props`,t),n instanceof it.Name&&r.assign((0,it._)`${e}.items`,n)}function UB(r,e,t,n){const{gen:i,schema:o,data:s,allErrors:a,opts:l,self:d}=r,{RULES:c}=d;if(o.$ref&&(l.ignoreKeywordsWithRef||!(0,Au.schemaHasRulesButRef)(o,c))){i.block(()=>vq(r,"$ref",c.all.$ref.definition));return}l.jtd||Aye(r,e),i.block(()=>{for(const f of c.rules)u(f);u(c.post)});function u(f){(0,sR.shouldUseGroup)(o,f)&&(f.type?(i.if((0,BA.checkDataType)(f.type,s,l.strictNumbers)),LB(r,f),e.length===1&&e[0]===f.type&&t&&(i.else(),(0,BA.reportTypeError)(r)),i.endIf()):LB(r,f),a||i.if((0,it._)`${Rt.default.errors} === ${n||0}`))}}function LB(r,e){const{gen:t,schema:n,opts:{useDefaults:i}}=r;i&&(0,cye.assignDefaults)(r,e.type),t.block(()=>{for(const o of e.rules)(0,sR.shouldUseRule)(n,o)&&vq(r,o.keyword,o.definition,e.type)})}function Aye(r,e){r.schemaEnv.meta||!r.opts.strictTypes||(xye(r,e),r.opts.allowUnionTypes||Sye(r,e),Tye(r,r.dataTypes))}function xye(r,e){if(e.length){if(!r.dataTypes.length){r.dataTypes=e;return}e.forEach(t=>{mq(r.dataTypes,t)||aR(r,`type "${t}" not allowed by context "${r.dataTypes.join(",")}"`)}),kye(r,e)}}function Sye(r,e){e.length>1&&!(e.length===2&&e.includes("null"))&&aR(r,"use allowUnionTypes to allow union type keyword")}function Tye(r,e){const t=r.self.RULES.all;for(const n in t){const i=t[n];if(typeof i=="object"&&(0,sR.shouldUseRule)(r.schema,i)){const{type:o}=i.definition;o.length&&!o.some(s=>$ye(e,s))&&aR(r,`missing type "${o.join(",")}" for keyword "${n}"`)}}}function $ye(r,e){return r.includes(e)||e==="number"&&r.includes("integer")}function mq(r,e){return r.includes(e)||e==="integer"&&r.includes("number")}function kye(r,e){const t=[];for(const n of r.dataTypes)mq(e,n)?t.push(n):e.includes("integer")&&n==="number"&&t.push("integer");r.dataTypes=t}function aR(r,e){const t=r.schemaEnv.baseId+r.errSchemaPath;e+=` at "${t}" (strictTypes)`,(0,Au.checkStrictMode)(r,e,r.opts.strictTypes)}class gq{constructor(e,t,n){if((0,Jb.validateKeywordUsage)(e,t,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Au.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=t,this.$data)this.schemaCode=e.gen.const("vSchema",bq(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Jb.validSchemaType)(this.schema,t.schemaType,t.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(t.schemaType)}`);("code"in t?t.trackErrors:t.errors!==!1)&&(this.errsCount=e.gen.const("_errs",Rt.default.errors))}result(e,t,n){this.failResult((0,it.not)(e),t,n)}failResult(e,t,n){this.gen.if(e),n?n():this.error(),t?(this.gen.else(),t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,t){this.failResult((0,it.not)(e),void 0,t)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:t}=this;this.fail((0,it._)`${t} !== undefined && (${(0,it.or)(this.invalid$data(),e)})`)}error(e,t,n){if(t){this.setParams(t),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,t){(e?b0.reportExtraError:b0.reportError)(this,this.def.error,t)}$dataError(){(0,b0.reportError)(this,this.def.$dataError||b0.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,b0.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,t){t?Object.assign(this.params,e):this.params=e}block$data(e,t,n=it.nil){this.gen.block(()=>{this.check$data(e,n),t()})}check$data(e=it.nil,t=it.nil){if(!this.$data)return;const{gen:n,schemaCode:i,schemaType:o,def:s}=this;n.if((0,it.or)((0,it._)`${i} === undefined`,t)),e!==it.nil&&n.assign(e,!0),(o.length||s.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==it.nil&&n.assign(e,!1)),n.else()}invalid$data(){const{gen:e,schemaCode:t,schemaType:n,def:i,it:o}=this;return(0,it.or)(s(),a());function s(){if(n.length){if(!(t instanceof it.Name))throw new Error("ajv implementation error");const l=Array.isArray(n)?n:[n];return(0,it._)`${(0,BA.checkDataTypes)(l,t,o.opts.strictNumbers,BA.DataType.Wrong)}`}return it.nil}function a(){if(i.validateSchema){const l=e.scopeValue("validate$data",{ref:i.validateSchema});return(0,it._)`!${l}(${t})`}return it.nil}}subschema(e,t){const n=(0,E$.getSubschema)(this.it,e);(0,E$.extendSubschemaData)(n,this.it,e),(0,E$.extendSubschemaMode)(n,e);const i={...this.it,...n,items:void 0,props:void 0};return yye(i,t),i}mergeEvaluated(e,t){const{it:n,gen:i}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Au.mergeEvaluated.props(i,e.props,n.props,t)),n.items!==!0&&e.items!==void 0&&(n.items=Au.mergeEvaluated.items(i,e.items,n.items,t)))}mergeValidEvaluated(e,t){const{it:n,gen:i}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return i.if(t,()=>this.mergeEvaluated(e,it.Name)),!0}}qc.KeywordCxt=gq;function vq(r,e,t,n){const i=new gq(r,t,e);"code"in t?t.code(i,n):i.$data&&t.validate?(0,Jb.funcKeywordCode)(i,t):"macro"in t?(0,Jb.macroKeywordCode)(i,t):(t.compile||t.validate)&&(0,Jb.funcKeywordCode)(i,t)}const Pye=/^\/(?:[^~]|~0|~1)*$/,Iye=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function bq(r,{dataLevel:e,dataNames:t,dataPathArr:n}){let i,o;if(r==="")return Rt.default.rootData;if(r[0]==="/"){if(!Pye.test(r))throw new Error(`Invalid JSON-pointer: ${r}`);i=r,o=Rt.default.rootData}else{const d=Iye.exec(r);if(!d)throw new Error(`Invalid JSON-pointer: ${r}`);const c=+d[1];if(i=d[2],i==="#"){if(c>=e)throw new Error(l("property/index",c));return n[e-c]}if(c>e)throw new Error(l("data",c));if(o=t[e-c],!i)return o}let s=o;const a=i.split("/");for(const d of a)d&&(o=(0,it._)`${o}${(0,it.getProperty)((0,Au.unescapeJsonPointer)(d))}`,s=(0,it._)`${s} && ${o}`);return s;function l(d,c){return`Cannot access ${d} ${c} levels up, current level is ${e}`}}qc.getData=bq;var Y_={};Object.defineProperty(Y_,"__esModule",{value:!0});class Oye extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}Y_.default=Oye;var Z_={};Object.defineProperty(Z_,"__esModule",{value:!0});const A$=ho;class Cye extends Error{constructor(e,t,n,i){super(i||`can't resolve reference ${n} from id ${t}`),this.missingRef=(0,A$.resolveUrl)(e,t,n),this.missingSchema=(0,A$.normalizeId)((0,A$.getFullPath)(e,this.missingRef))}}Z_.default=Cye;var ys={};Object.defineProperty(ys,"__esModule",{value:!0});ys.resolveSchema=ys.getCompilingSchema=ys.resolveRef=ys.compileSchema=ys.SchemaEnv=void 0;const wc=zt,Rye=Y_,Qh=Pa,Uc=ho,KB=lr,Dye=qc;class PS{constructor(e){var t;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(t=e.baseId)!==null&&t!==void 0?t:(0,Uc.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}}ys.SchemaEnv=PS;function cR(r){const e=wq.call(this,r);if(e)return e;const t=(0,Uc.getFullPath)(this.opts.uriResolver,r.root.baseId),{es5:n,lines:i}=this.opts.code,{ownProperties:o}=this.opts,s=new wc.CodeGen(this.scope,{es5:n,lines:i,ownProperties:o});let a;r.$async&&(a=s.scopeValue("Error",{ref:Rye.default,code:(0,wc._)`require("ajv/dist/runtime/validation_error").default`}));const l=s.scopeName("validate");r.validateName=l;const d={gen:s,allErrors:this.opts.allErrors,data:Qh.default.data,parentData:Qh.default.parentData,parentDataProperty:Qh.default.parentDataProperty,dataNames:[Qh.default.data],dataPathArr:[wc.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:s.scopeValue("schema",this.opts.code.source===!0?{ref:r.schema,code:(0,wc.stringify)(r.schema)}:{ref:r.schema}),validateName:l,ValidationError:a,schema:r.schema,schemaEnv:r,rootId:t,baseId:r.baseId||t,schemaPath:wc.nil,errSchemaPath:r.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,wc._)`""`,opts:this.opts,self:this};let c;try{this._compilations.add(r),(0,Dye.validateFunctionCode)(d),s.optimize(this.opts.code.optimize);const u=s.toString();c=`${s.scopeRefs(Qh.default.scope)}return ${u}`,this.opts.code.process&&(c=this.opts.code.process(c,r));const h=new Function(`${Qh.default.self}`,`${Qh.default.scope}`,c)(this,this.scope.get());if(this.scope.value(l,{ref:h}),h.errors=null,h.schema=r.schema,h.schemaEnv=r,r.$async&&(h.$async=!0),this.opts.code.source===!0&&(h.source={validateName:l,validateCode:u,scopeValues:s._values}),this.opts.unevaluated){const{props:p,items:y}=d;h.evaluated={props:p instanceof wc.Name?void 0:p,items:y instanceof wc.Name?void 0:y,dynamicProps:p instanceof wc.Name,dynamicItems:y instanceof wc.Name},h.source&&(h.source.evaluated=(0,wc.stringify)(h.evaluated))}return r.validate=h,r}catch(u){throw delete r.validate,delete r.validateName,c&&this.logger.error("Error compiling schema, function code:",c),u}finally{this._compilations.delete(r)}}ys.compileSchema=cR;function Mye(r,e,t){var n;t=(0,Uc.resolveUrl)(this.opts.uriResolver,e,t);const i=r.refs[t];if(i)return i;let o=Nye.call(this,r,t);if(o===void 0){const s=(n=r.localRefs)===null||n===void 0?void 0:n[t],{schemaId:a}=this.opts;s&&(o=new PS({schema:s,schemaId:a,root:r,baseId:e}))}if(o!==void 0)return r.refs[t]=Bye.call(this,o)}ys.resolveRef=Mye;function Bye(r){return(0,Uc.inlineRef)(r.schema,this.opts.inlineRefs)?r.schema:r.validate?r:cR.call(this,r)}function wq(r){for(const e of this._compilations)if(jye(e,r))return e}ys.getCompilingSchema=wq;function jye(r,e){return r.schema===e.schema&&r.root===e.root&&r.baseId===e.baseId}function Nye(r,e){let t;for(;typeof(t=this.refs[e])=="string";)e=t;return t||this.schemas[e]||IS.call(this,r,e)}function IS(r,e){const t=this.opts.uriResolver.parse(e),n=(0,Uc._getFullPath)(this.opts.uriResolver,t);let i=(0,Uc.getFullPath)(this.opts.uriResolver,r.baseId,void 0);if(Object.keys(r.schema).length>0&&n===i)return x$.call(this,t,r);const o=(0,Uc.normalizeId)(n),s=this.refs[o]||this.schemas[o];if(typeof s=="string"){const a=IS.call(this,r,s);return typeof a?.schema!="object"?void 0:x$.call(this,t,a)}if(typeof s?.schema=="object"){if(s.validate||cR.call(this,s),o===(0,Uc.normalizeId)(e)){const{schema:a}=s,{schemaId:l}=this.opts,d=a[l];return d&&(i=(0,Uc.resolveUrl)(this.opts.uriResolver,i,d)),new PS({schema:a,schemaId:l,root:r,baseId:i})}return x$.call(this,t,s)}}ys.resolveSchema=IS;const Uye=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function x$(r,{baseId:e,schema:t,root:n}){var i;if(((i=r.fragment)===null||i===void 0?void 0:i[0])!=="/")return;for(const a of r.fragment.slice(1).split("/")){if(typeof t=="boolean")return;const l=t[(0,KB.unescapeFragment)(a)];if(l===void 0)return;t=l;const d=typeof t=="object"&&t[this.opts.schemaId];!Uye.has(a)&&d&&(e=(0,Uc.resolveUrl)(this.opts.uriResolver,e,d))}let o;if(typeof t!="boolean"&&t.$ref&&!(0,KB.schemaHasRulesButRef)(t,this.RULES)){const a=(0,Uc.resolveUrl)(this.opts.uriResolver,e,t.$ref);o=IS.call(this,n,a)}const{schemaId:s}=this.opts;if(o=o||new PS({schema:t,schemaId:s,root:n,baseId:e}),o.schema!==o.root.schema)return o}const Lye="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Kye="Meta-schema for $data reference (JSON AnySchema extension proposal)",zye="object",Fye=["$data"],qye={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},Vye=!1,Wye={$id:Lye,description:Kye,type:zye,required:Fye,properties:qye,additionalProperties:Vye};var lR={},SI={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(r,e){(function(t,n){n(e)})(db,function(t){function n(){for(var pe=arguments.length,de=Array(pe),me=0;me<pe;me++)de[me]=arguments[me];if(de.length>1){de[0]=de[0].slice(0,-1);for(var Se=de.length-1,xe=1;xe<Se;++xe)de[xe]=de[xe].slice(1,-1);return de[Se]=de[Se].slice(1),de.join("")}else return de[0]}function i(pe){return"(?:"+pe+")"}function o(pe){return pe===void 0?"undefined":pe===null?"null":Object.prototype.toString.call(pe).split(" ").pop().split("]").shift().toLowerCase()}function s(pe){return pe.toUpperCase()}function a(pe){return pe!=null?pe instanceof Array?pe:typeof pe.length!="number"||pe.split||pe.setInterval||pe.call?[pe]:Array.prototype.slice.call(pe):[]}function l(pe,de){var me=pe;if(de)for(var Se in de)me[Se]=de[Se];return me}function d(pe){var de="[A-Za-z]",me="[0-9]",Se=n(me,"[A-Fa-f]"),xe=i(i("%[EFef]"+Se+"%"+Se+Se+"%"+Se+Se)+"|"+i("%[89A-Fa-f]"+Se+"%"+Se+Se)+"|"+i("%"+Se+Se)),rt="[\\:\\/\\?\\#\\[\\]\\@]",nt="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Xt=n(rt,nt),Or=pe?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Wr=pe?"[\\uE000-\\uF8FF]":"[]",Bt=n(de,me,"[\\-\\.\\_\\~]",Or);i(de+n(de,me,"[\\+\\-\\.]")+"*"),i(i(xe+"|"+n(Bt,nt,"[\\:]"))+"*");var dr=i(i("25[0-5]")+"|"+i("2[0-4]"+me)+"|"+i("1"+me+me)+"|"+i("0?[1-9]"+me)+"|0?0?"+me),Bn=i(dr+"\\."+dr+"\\."+dr+"\\."+dr),jt=i(Se+"{1,4}"),yn=i(i(jt+"\\:"+jt)+"|"+Bn),Yn=i(i(jt+"\\:")+"{6}"+yn),mn=i("\\:\\:"+i(jt+"\\:")+"{5}"+yn),ef=i(i(jt)+"?\\:\\:"+i(jt+"\\:")+"{4}"+yn),ol=i(i(i(jt+"\\:")+"{0,1}"+jt)+"?\\:\\:"+i(jt+"\\:")+"{3}"+yn),sl=i(i(i(jt+"\\:")+"{0,2}"+jt)+"?\\:\\:"+i(jt+"\\:")+"{2}"+yn),hm=i(i(i(jt+"\\:")+"{0,3}"+jt)+"?\\:\\:"+jt+"\\:"+yn),Yh=i(i(i(jt+"\\:")+"{0,4}"+jt)+"?\\:\\:"+yn),Oa=i(i(i(jt+"\\:")+"{0,5}"+jt)+"?\\:\\:"+jt),al=i(i(i(jt+"\\:")+"{0,6}"+jt)+"?\\:\\:"),Zh=i([Yn,mn,ef,ol,sl,hm,Yh,Oa,al].join("|")),Ed=i(i(Bt+"|"+xe)+"+");i("[vV]"+Se+"+\\."+n(Bt,nt,"[\\:]")+"+"),i(i(xe+"|"+n(Bt,nt))+"*");var e0=i(xe+"|"+n(Bt,nt,"[\\:\\@]"));return i(i(xe+"|"+n(Bt,nt,"[\\@]"))+"+"),i(i(e0+"|"+n("[\\/\\?]",Wr))+"*"),{NOT_SCHEME:new RegExp(n("[^]",de,me,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(n("[^\\%\\:]",Bt,nt),"g"),NOT_HOST:new RegExp(n("[^\\%\\[\\]\\:]",Bt,nt),"g"),NOT_PATH:new RegExp(n("[^\\%\\/\\:\\@]",Bt,nt),"g"),NOT_PATH_NOSCHEME:new RegExp(n("[^\\%\\/\\@]",Bt,nt),"g"),NOT_QUERY:new RegExp(n("[^\\%]",Bt,nt,"[\\:\\@\\/\\?]",Wr),"g"),NOT_FRAGMENT:new RegExp(n("[^\\%]",Bt,nt,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(n("[^]",Bt,nt),"g"),UNRESERVED:new RegExp(Bt,"g"),OTHER_CHARS:new RegExp(n("[^\\%]",Bt,Xt),"g"),PCT_ENCODED:new RegExp(xe,"g"),IPV4ADDRESS:new RegExp("^("+Bn+")$"),IPV6ADDRESS:new RegExp("^\\[?("+Zh+")"+i(i("\\%25|\\%(?!"+Se+"{2})")+"("+Ed+")")+"?\\]?$")}}var c=d(!1),u=d(!0),f=function(){function pe(de,me){var Se=[],xe=!0,rt=!1,nt=void 0;try{for(var Xt=de[Symbol.iterator](),Or;!(xe=(Or=Xt.next()).done)&&(Se.push(Or.value),!(me&&Se.length===me));xe=!0);}catch(Wr){rt=!0,nt=Wr}finally{try{!xe&&Xt.return&&Xt.return()}finally{if(rt)throw nt}}return Se}return function(de,me){if(Array.isArray(de))return de;if(Symbol.iterator in Object(de))return pe(de,me);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(pe){if(Array.isArray(pe)){for(var de=0,me=Array(pe.length);de<pe.length;de++)me[de]=pe[de];return me}else return Array.from(pe)},p=2147483647,y=36,g=1,w=26,v=38,m=700,b=72,_=128,E="-",S=/^xn--/,T=/[^\0-\x7E]/,O=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Q=y-g,W=Math.floor,U=String.fromCharCode;function ee(pe){throw new RangeError(M[pe])}function R(pe,de){for(var me=[],Se=pe.length;Se--;)me[Se]=de(pe[Se]);return me}function z(pe,de){var me=pe.split("@"),Se="";me.length>1&&(Se=me[0]+"@",pe=me[1]),pe=pe.replace(O,".");var xe=pe.split("."),rt=R(xe,de).join(".");return Se+rt}function K(pe){for(var de=[],me=0,Se=pe.length;me<Se;){var xe=pe.charCodeAt(me++);if(xe>=55296&&xe<=56319&&me<Se){var rt=pe.charCodeAt(me++);(rt&64512)==56320?de.push(((xe&1023)<<10)+(rt&1023)+65536):(de.push(xe),me--)}else de.push(xe)}return de}var Y=function(de){return String.fromCodePoint.apply(String,h(de))},I=function(de){return de-48<10?de-22:de-65<26?de-65:de-97<26?de-97:y},D=function(de,me){return de+22+75*(de<26)-((me!=0)<<5)},N=function(de,me,Se){var xe=0;for(de=Se?W(de/m):de>>1,de+=W(de/me);de>Q*w>>1;xe+=y)de=W(de/Q);return W(xe+(Q+1)*de/(de+v))},V=function(de){var me=[],Se=de.length,xe=0,rt=_,nt=b,Xt=de.lastIndexOf(E);Xt<0&&(Xt=0);for(var Or=0;Or<Xt;++Or)de.charCodeAt(Or)>=128&&ee("not-basic"),me.push(de.charCodeAt(Or));for(var Wr=Xt>0?Xt+1:0;Wr<Se;){for(var Bt=xe,dr=1,Bn=y;;Bn+=y){Wr>=Se&&ee("invalid-input");var jt=I(de.charCodeAt(Wr++));(jt>=y||jt>W((p-xe)/dr))&&ee("overflow"),xe+=jt*dr;var yn=Bn<=nt?g:Bn>=nt+w?w:Bn-nt;if(jt<yn)break;var Yn=y-yn;dr>W(p/Yn)&&ee("overflow"),dr*=Yn}var mn=me.length+1;nt=N(xe-Bt,mn,Bt==0),W(xe/mn)>p-rt&&ee("overflow"),rt+=W(xe/mn),xe%=mn,me.splice(xe++,0,rt)}return String.fromCodePoint.apply(String,me)},J=function(de){var me=[];de=K(de);var Se=de.length,xe=_,rt=0,nt=b,Xt=!0,Or=!1,Wr=void 0;try{for(var Bt=de[Symbol.iterator](),dr;!(Xt=(dr=Bt.next()).done);Xt=!0){var Bn=dr.value;Bn<128&&me.push(U(Bn))}}catch(t0){Or=!0,Wr=t0}finally{try{!Xt&&Bt.return&&Bt.return()}finally{if(Or)throw Wr}}var jt=me.length,yn=jt;for(jt&&me.push(E);yn<Se;){var Yn=p,mn=!0,ef=!1,ol=void 0;try{for(var sl=de[Symbol.iterator](),hm;!(mn=(hm=sl.next()).done);mn=!0){var Yh=hm.value;Yh>=xe&&Yh<Yn&&(Yn=Yh)}}catch(t0){ef=!0,ol=t0}finally{try{!mn&&sl.return&&sl.return()}finally{if(ef)throw ol}}var Oa=yn+1;Yn-xe>W((p-rt)/Oa)&&ee("overflow"),rt+=(Yn-xe)*Oa,xe=Yn;var al=!0,Zh=!1,Ed=void 0;try{for(var e0=de[Symbol.iterator](),D6;!(al=(D6=e0.next()).done);al=!0){var M6=D6.value;if(M6<xe&&++rt>p&&ee("overflow"),M6==xe){for(var h1=rt,p1=y;;p1+=y){var y1=p1<=nt?g:p1>=nt+w?w:p1-nt;if(h1<y1)break;var B6=h1-y1,j6=y-y1;me.push(U(D(y1+B6%j6,0))),h1=W(B6/j6)}me.push(U(D(h1,0))),nt=N(rt,Oa,yn==jt),rt=0,++yn}}}catch(t0){Zh=!0,Ed=t0}finally{try{!al&&e0.return&&e0.return()}finally{if(Zh)throw Ed}}++rt,++xe}return me.join("")},j=function(de){return z(de,function(me){return S.test(me)?V(me.slice(4).toLowerCase()):me})},G=function(de){return z(de,function(me){return T.test(me)?"xn--"+J(me):me})},C={version:"2.1.0",ucs2:{decode:K,encode:Y},decode:V,encode:J,toASCII:G,toUnicode:j},F={};function Z(pe){var de=pe.charCodeAt(0),me=void 0;return de<16?me="%0"+de.toString(16).toUpperCase():de<128?me="%"+de.toString(16).toUpperCase():de<2048?me="%"+(de>>6|192).toString(16).toUpperCase()+"%"+(de&63|128).toString(16).toUpperCase():me="%"+(de>>12|224).toString(16).toUpperCase()+"%"+(de>>6&63|128).toString(16).toUpperCase()+"%"+(de&63|128).toString(16).toUpperCase(),me}function te(pe){for(var de="",me=0,Se=pe.length;me<Se;){var xe=parseInt(pe.substr(me+1,2),16);if(xe<128)de+=String.fromCharCode(xe),me+=3;else if(xe>=194&&xe<224){if(Se-me>=6){var rt=parseInt(pe.substr(me+4,2),16);de+=String.fromCharCode((xe&31)<<6|rt&63)}else de+=pe.substr(me,6);me+=6}else if(xe>=224){if(Se-me>=9){var nt=parseInt(pe.substr(me+4,2),16),Xt=parseInt(pe.substr(me+7,2),16);de+=String.fromCharCode((xe&15)<<12|(nt&63)<<6|Xt&63)}else de+=pe.substr(me,9);me+=9}else de+=pe.substr(me,3),me+=3}return de}function re(pe,de){function me(Se){var xe=te(Se);return xe.match(de.UNRESERVED)?xe:Se}return pe.scheme&&(pe.scheme=String(pe.scheme).replace(de.PCT_ENCODED,me).toLowerCase().replace(de.NOT_SCHEME,"")),pe.userinfo!==void 0&&(pe.userinfo=String(pe.userinfo).replace(de.PCT_ENCODED,me).replace(de.NOT_USERINFO,Z).replace(de.PCT_ENCODED,s)),pe.host!==void 0&&(pe.host=String(pe.host).replace(de.PCT_ENCODED,me).toLowerCase().replace(de.NOT_HOST,Z).replace(de.PCT_ENCODED,s)),pe.path!==void 0&&(pe.path=String(pe.path).replace(de.PCT_ENCODED,me).replace(pe.scheme?de.NOT_PATH:de.NOT_PATH_NOSCHEME,Z).replace(de.PCT_ENCODED,s)),pe.query!==void 0&&(pe.query=String(pe.query).replace(de.PCT_ENCODED,me).replace(de.NOT_QUERY,Z).replace(de.PCT_ENCODED,s)),pe.fragment!==void 0&&(pe.fragment=String(pe.fragment).replace(de.PCT_ENCODED,me).replace(de.NOT_FRAGMENT,Z).replace(de.PCT_ENCODED,s)),pe}function q(pe){return pe.replace(/^0*(.*)/,"$1")||"0"}function L(pe,de){var me=pe.match(de.IPV4ADDRESS)||[],Se=f(me,2),xe=Se[1];return xe?xe.split(".").map(q).join("."):pe}function k(pe,de){var me=pe.match(de.IPV6ADDRESS)||[],Se=f(me,3),xe=Se[1],rt=Se[2];if(xe){for(var nt=xe.toLowerCase().split("::").reverse(),Xt=f(nt,2),Or=Xt[0],Wr=Xt[1],Bt=Wr?Wr.split(":").map(q):[],dr=Or.split(":").map(q),Bn=de.IPV4ADDRESS.test(dr[dr.length-1]),jt=Bn?7:8,yn=dr.length-jt,Yn=Array(jt),mn=0;mn<jt;++mn)Yn[mn]=Bt[mn]||dr[yn+mn]||"";Bn&&(Yn[jt-1]=L(Yn[jt-1],de));var ef=Yn.reduce(function(Oa,al,Zh){if(!al||al==="0"){var Ed=Oa[Oa.length-1];Ed&&Ed.index+Ed.length===Zh?Ed.length++:Oa.push({index:Zh,length:1})}return Oa},[]),ol=ef.sort(function(Oa,al){return al.length-Oa.length})[0],sl=void 0;if(ol&&ol.length>1){var hm=Yn.slice(0,ol.index),Yh=Yn.slice(ol.index+ol.length);sl=hm.join(":")+"::"+Yh.join(":")}else sl=Yn.join(":");return rt&&(sl+="%"+rt),sl}else return pe}var B=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,X="".match(/(){0}/)[1]===void 0;function ne(pe){var de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},me={},Se=de.iri!==!1?u:c;de.reference==="suffix"&&(pe=(de.scheme?de.scheme+":":"")+"//"+pe);var xe=pe.match(B);if(xe){X?(me.scheme=xe[1],me.userinfo=xe[3],me.host=xe[4],me.port=parseInt(xe[5],10),me.path=xe[6]||"",me.query=xe[7],me.fragment=xe[8],isNaN(me.port)&&(me.port=xe[5])):(me.scheme=xe[1]||void 0,me.userinfo=pe.indexOf("@")!==-1?xe[3]:void 0,me.host=pe.indexOf("//")!==-1?xe[4]:void 0,me.port=parseInt(xe[5],10),me.path=xe[6]||"",me.query=pe.indexOf("?")!==-1?xe[7]:void 0,me.fragment=pe.indexOf("#")!==-1?xe[8]:void 0,isNaN(me.port)&&(me.port=pe.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?xe[4]:void 0)),me.host&&(me.host=k(L(me.host,Se),Se)),me.scheme===void 0&&me.userinfo===void 0&&me.host===void 0&&me.port===void 0&&!me.path&&me.query===void 0?me.reference="same-document":me.scheme===void 0?me.reference="relative":me.fragment===void 0?me.reference="absolute":me.reference="uri",de.reference&&de.reference!=="suffix"&&de.reference!==me.reference&&(me.error=me.error||"URI is not a "+de.reference+" reference.");var rt=F[(de.scheme||me.scheme||"").toLowerCase()];if(!de.unicodeSupport&&(!rt||!rt.unicodeSupport)){if(me.host&&(de.domainHost||rt&&rt.domainHost))try{me.host=C.toASCII(me.host.replace(Se.PCT_ENCODED,te).toLowerCase())}catch(nt){me.error=me.error||"Host's domain name can not be converted to ASCII via punycode: "+nt}re(me,c)}else re(me,Se);rt&&rt.parse&&rt.parse(me,de)}else me.error=me.error||"URI can not be parsed.";return me}function ae(pe,de){var me=de.iri!==!1?u:c,Se=[];return pe.userinfo!==void 0&&(Se.push(pe.userinfo),Se.push("@")),pe.host!==void 0&&Se.push(k(L(String(pe.host),me),me).replace(me.IPV6ADDRESS,function(xe,rt,nt){return"["+rt+(nt?"%25"+nt:"")+"]"})),(typeof pe.port=="number"||typeof pe.port=="string")&&(Se.push(":"),Se.push(String(pe.port))),Se.length?Se.join(""):void 0}var ye=/^\.\.?\//,_e=/^\/\.(\/|$)/,$e=/^\/\.\.(\/|$)/,Ce=/^\/?(?:.|\n)*?(?=\/|$)/;function Te(pe){for(var de=[];pe.length;)if(pe.match(ye))pe=pe.replace(ye,"");else if(pe.match(_e))pe=pe.replace(_e,"/");else if(pe.match($e))pe=pe.replace($e,"/"),de.pop();else if(pe==="."||pe==="..")pe="";else{var me=pe.match(Ce);if(me){var Se=me[0];pe=pe.slice(Se.length),de.push(Se)}else throw new Error("Unexpected dot segment condition")}return de.join("")}function ze(pe){var de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},me=de.iri?u:c,Se=[],xe=F[(de.scheme||pe.scheme||"").toLowerCase()];if(xe&&xe.serialize&&xe.serialize(pe,de),pe.host&&!me.IPV6ADDRESS.test(pe.host)){if(de.domainHost||xe&&xe.domainHost)try{pe.host=de.iri?C.toUnicode(pe.host):C.toASCII(pe.host.replace(me.PCT_ENCODED,te).toLowerCase())}catch(Xt){pe.error=pe.error||"Host's domain name can not be converted to "+(de.iri?"Unicode":"ASCII")+" via punycode: "+Xt}}re(pe,me),de.reference!=="suffix"&&pe.scheme&&(Se.push(pe.scheme),Se.push(":"));var rt=ae(pe,de);if(rt!==void 0&&(de.reference!=="suffix"&&Se.push("//"),Se.push(rt),pe.path&&pe.path.charAt(0)!=="/"&&Se.push("/")),pe.path!==void 0){var nt=pe.path;!de.absolutePath&&(!xe||!xe.absolutePath)&&(nt=Te(nt)),rt===void 0&&(nt=nt.replace(/^\/\//,"/%2F")),Se.push(nt)}return pe.query!==void 0&&(Se.push("?"),Se.push(pe.query)),pe.fragment!==void 0&&(Se.push("#"),Se.push(pe.fragment)),Se.join("")}function ht(pe,de){var me=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},Se=arguments[3],xe={};return Se||(pe=ne(ze(pe,me),me),de=ne(ze(de,me),me)),me=me||{},!me.tolerant&&de.scheme?(xe.scheme=de.scheme,xe.userinfo=de.userinfo,xe.host=de.host,xe.port=de.port,xe.path=Te(de.path||""),xe.query=de.query):(de.userinfo!==void 0||de.host!==void 0||de.port!==void 0?(xe.userinfo=de.userinfo,xe.host=de.host,xe.port=de.port,xe.path=Te(de.path||""),xe.query=de.query):(de.path?(de.path.charAt(0)==="/"?xe.path=Te(de.path):((pe.userinfo!==void 0||pe.host!==void 0||pe.port!==void 0)&&!pe.path?xe.path="/"+de.path:pe.path?xe.path=pe.path.slice(0,pe.path.lastIndexOf("/")+1)+de.path:xe.path=de.path,xe.path=Te(xe.path)),xe.query=de.query):(xe.path=pe.path,de.query!==void 0?xe.query=de.query:xe.query=pe.query),xe.userinfo=pe.userinfo,xe.host=pe.host,xe.port=pe.port),xe.scheme=pe.scheme),xe.fragment=de.fragment,xe}function ie(pe,de,me){var Se=l({scheme:"null"},me);return ze(ht(ne(pe,Se),ne(de,Se),Se,!0),Se)}function ce(pe,de){return typeof pe=="string"?pe=ze(ne(pe,de),de):o(pe)==="object"&&(pe=ne(ze(pe,de),de)),pe}function H(pe,de,me){return typeof pe=="string"?pe=ze(ne(pe,me),me):o(pe)==="object"&&(pe=ze(pe,me)),typeof de=="string"?de=ze(ne(de,me),me):o(de)==="object"&&(de=ze(de,me)),pe===de}function $(pe,de){return pe&&pe.toString().replace(!de||!de.iri?c.ESCAPE:u.ESCAPE,Z)}function P(pe,de){return pe&&pe.toString().replace(!de||!de.iri?c.PCT_ENCODED:u.PCT_ENCODED,te)}var se={scheme:"http",domainHost:!0,parse:function(de,me){return de.host||(de.error=de.error||"HTTP URIs must have a host."),de},serialize:function(de,me){var Se=String(de.scheme).toLowerCase()==="https";return(de.port===(Se?443:80)||de.port==="")&&(de.port=void 0),de.path||(de.path="/"),de}},fe={scheme:"https",domainHost:se.domainHost,parse:se.parse,serialize:se.serialize};function ve(pe){return typeof pe.secure=="boolean"?pe.secure:String(pe.scheme).toLowerCase()==="wss"}var Ee={scheme:"ws",domainHost:!0,parse:function(de,me){var Se=de;return Se.secure=ve(Se),Se.resourceName=(Se.path||"/")+(Se.query?"?"+Se.query:""),Se.path=void 0,Se.query=void 0,Se},serialize:function(de,me){if((de.port===(ve(de)?443:80)||de.port==="")&&(de.port=void 0),typeof de.secure=="boolean"&&(de.scheme=de.secure?"wss":"ws",de.secure=void 0),de.resourceName){var Se=de.resourceName.split("?"),xe=f(Se,2),rt=xe[0],nt=xe[1];de.path=rt&&rt!=="/"?rt:void 0,de.query=nt,de.resourceName=void 0}return de.fragment=void 0,de}},pt={scheme:"wss",domainHost:Ee.domainHost,parse:Ee.parse,serialize:Ee.serialize},Ft={},ir="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Mt="[0-9A-Fa-f]",Jt=i(i("%[EFef]"+Mt+"%"+Mt+Mt+"%"+Mt+Mt)+"|"+i("%[89A-Fa-f]"+Mt+"%"+Mt+Mt)+"|"+i("%"+Mt+Mt)),Xu="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",nl="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",il=n(nl,'[\\"\\\\]'),zs="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Fs=new RegExp(ir,"g"),Qu=new RegExp(Jt,"g"),Xv=new RegExp(n("[^]",Xu,"[\\.]",'[\\"]',il),"g"),Qv=new RegExp(n("[^]",ir,zs),"g"),le=Qv;function ue(pe){var de=te(pe);return de.match(Fs)?de:pe}var Re={scheme:"mailto",parse:function(de,me){var Se=de,xe=Se.to=Se.path?Se.path.split(","):[];if(Se.path=void 0,Se.query){for(var rt=!1,nt={},Xt=Se.query.split("&"),Or=0,Wr=Xt.length;Or<Wr;++Or){var Bt=Xt[Or].split("=");switch(Bt[0]){case"to":for(var dr=Bt[1].split(","),Bn=0,jt=dr.length;Bn<jt;++Bn)xe.push(dr[Bn]);break;case"subject":Se.subject=P(Bt[1],me);break;case"body":Se.body=P(Bt[1],me);break;default:rt=!0,nt[P(Bt[0],me)]=P(Bt[1],me);break}}rt&&(Se.headers=nt)}Se.query=void 0;for(var yn=0,Yn=xe.length;yn<Yn;++yn){var mn=xe[yn].split("@");if(mn[0]=P(mn[0]),me.unicodeSupport)mn[1]=P(mn[1],me).toLowerCase();else try{mn[1]=C.toASCII(P(mn[1],me).toLowerCase())}catch(ef){Se.error=Se.error||"Email address's domain name can not be converted to ASCII via punycode: "+ef}xe[yn]=mn.join("@")}return Se},serialize:function(de,me){var Se=de,xe=a(de.to);if(xe){for(var rt=0,nt=xe.length;rt<nt;++rt){var Xt=String(xe[rt]),Or=Xt.lastIndexOf("@"),Wr=Xt.slice(0,Or).replace(Qu,ue).replace(Qu,s).replace(Xv,Z),Bt=Xt.slice(Or+1);try{Bt=me.iri?C.toUnicode(Bt):C.toASCII(P(Bt,me).toLowerCase())}catch(yn){Se.error=Se.error||"Email address's domain name can not be converted to "+(me.iri?"Unicode":"ASCII")+" via punycode: "+yn}xe[rt]=Wr+"@"+Bt}Se.path=xe.join(",")}var dr=de.headers=de.headers||{};de.subject&&(dr.subject=de.subject),de.body&&(dr.body=de.body);var Bn=[];for(var jt in dr)dr[jt]!==Ft[jt]&&Bn.push(jt.replace(Qu,ue).replace(Qu,s).replace(Qv,Z)+"="+dr[jt].replace(Qu,ue).replace(Qu,s).replace(le,Z));return Bn.length&&(Se.query=Bn.join("&")),Se}},De=/^([^\:]+)\:(.*)/,Je={scheme:"urn",parse:function(de,me){var Se=de.path&&de.path.match(De),xe=de;if(Se){var rt=me.scheme||xe.scheme||"urn",nt=Se[1].toLowerCase(),Xt=Se[2],Or=rt+":"+(me.nid||nt),Wr=F[Or];xe.nid=nt,xe.nss=Xt,xe.path=void 0,Wr&&(xe=Wr.parse(xe,me))}else xe.error=xe.error||"URN can not be parsed.";return xe},serialize:function(de,me){var Se=me.scheme||de.scheme||"urn",xe=de.nid,rt=Se+":"+(me.nid||xe),nt=F[rt];nt&&(de=nt.serialize(de,me));var Xt=de,Or=de.nss;return Xt.path=(xe||me.nid)+":"+Or,Xt}},yi=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Qo={scheme:"urn:uuid",parse:function(de,me){var Se=de;return Se.uuid=Se.nss,Se.nss=void 0,!me.tolerant&&(!Se.uuid||!Se.uuid.match(yi))&&(Se.error=Se.error||"UUID is not valid."),Se},serialize:function(de,me){var Se=de;return Se.nss=(de.uuid||"").toLowerCase(),Se}};F[se.scheme]=se,F[fe.scheme]=fe,F[Ee.scheme]=Ee,F[pt.scheme]=pt,F[Re.scheme]=Re,F[Je.scheme]=Je,F[Qo.scheme]=Qo,t.SCHEMES=F,t.pctEncChar=Z,t.pctDecChars=te,t.parse=ne,t.removeDotSegments=Te,t.serialize=ze,t.resolveComponents=ht,t.resolve=ie,t.normalize=ce,t.equal=H,t.escapeComponent=$,t.unescapeComponent=P,Object.defineProperty(t,"__esModule",{value:!0})})})(SI,SI.exports);var _q=SI.exports;Object.defineProperty(lR,"__esModule",{value:!0});const Eq=_q;Eq.code='require("ajv/dist/runtime/uri").default';lR.default=Eq;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CodeGen=r.Name=r.nil=r.stringify=r.str=r._=r.KeywordCxt=void 0;var e=qc;Object.defineProperty(r,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var t=zt;Object.defineProperty(r,"_",{enumerable:!0,get:function(){return t._}}),Object.defineProperty(r,"str",{enumerable:!0,get:function(){return t.str}}),Object.defineProperty(r,"stringify",{enumerable:!0,get:function(){return t.stringify}}),Object.defineProperty(r,"nil",{enumerable:!0,get:function(){return t.nil}}),Object.defineProperty(r,"Name",{enumerable:!0,get:function(){return t.Name}}),Object.defineProperty(r,"CodeGen",{enumerable:!0,get:function(){return t.CodeGen}});const n=Y_,i=Z_,o=Ny,s=ys,a=zt,l=ho,d=G_,c=lr,u=Wye,f=lR,h=(D,N)=>new RegExp(D,N);h.code="new RegExp";const p=["removeAdditional","useDefaults","coerceTypes"],y=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),g={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},w={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},v=200;function m(D){var N,V,J,j,G,C,F,Z,te,re,q,L,k,B,X,ne,ae,ye,_e,$e,Ce,Te,ze,ht,ie;const ce=D.strict,H=(N=D.code)===null||N===void 0?void 0:N.optimize,$=H===!0||H===void 0?1:H||0,P=(J=(V=D.code)===null||V===void 0?void 0:V.regExp)!==null&&J!==void 0?J:h,se=(j=D.uriResolver)!==null&&j!==void 0?j:f.default;return{strictSchema:(C=(G=D.strictSchema)!==null&&G!==void 0?G:ce)!==null&&C!==void 0?C:!0,strictNumbers:(Z=(F=D.strictNumbers)!==null&&F!==void 0?F:ce)!==null&&Z!==void 0?Z:!0,strictTypes:(re=(te=D.strictTypes)!==null&&te!==void 0?te:ce)!==null&&re!==void 0?re:"log",strictTuples:(L=(q=D.strictTuples)!==null&&q!==void 0?q:ce)!==null&&L!==void 0?L:"log",strictRequired:(B=(k=D.strictRequired)!==null&&k!==void 0?k:ce)!==null&&B!==void 0?B:!1,code:D.code?{...D.code,optimize:$,regExp:P}:{optimize:$,regExp:P},loopRequired:(X=D.loopRequired)!==null&&X!==void 0?X:v,loopEnum:(ne=D.loopEnum)!==null&&ne!==void 0?ne:v,meta:(ae=D.meta)!==null&&ae!==void 0?ae:!0,messages:(ye=D.messages)!==null&&ye!==void 0?ye:!0,inlineRefs:(_e=D.inlineRefs)!==null&&_e!==void 0?_e:!0,schemaId:($e=D.schemaId)!==null&&$e!==void 0?$e:"$id",addUsedSchema:(Ce=D.addUsedSchema)!==null&&Ce!==void 0?Ce:!0,validateSchema:(Te=D.validateSchema)!==null&&Te!==void 0?Te:!0,validateFormats:(ze=D.validateFormats)!==null&&ze!==void 0?ze:!0,unicodeRegExp:(ht=D.unicodeRegExp)!==null&&ht!==void 0?ht:!0,int32range:(ie=D.int32range)!==null&&ie!==void 0?ie:!0,uriResolver:se}}class b{constructor(N={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,N=this.opts={...N,...m(N)};const{es5:V,lines:J}=this.opts.code;this.scope=new a.ValueScope({scope:{},prefixes:y,es5:V,lines:J}),this.logger=W(N.logger);const j=N.validateFormats;N.validateFormats=!1,this.RULES=(0,o.getRules)(),_.call(this,g,N,"NOT SUPPORTED"),_.call(this,w,N,"DEPRECATED","warn"),this._metaOpts=M.call(this),N.formats&&T.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),N.keywords&&O.call(this,N.keywords),typeof N.meta=="object"&&this.addMetaSchema(N.meta),S.call(this),N.validateFormats=j}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:N,meta:V,schemaId:J}=this.opts;let j=u;J==="id"&&(j={...u},j.id=j.$id,delete j.$id),V&&N&&this.addMetaSchema(j,j[J],!1)}defaultMeta(){const{meta:N,schemaId:V}=this.opts;return this.opts.defaultMeta=typeof N=="object"?N[V]||N:void 0}validate(N,V){let J;if(typeof N=="string"){if(J=this.getSchema(N),!J)throw new Error(`no schema with key or ref "${N}"`)}else J=this.compile(N);const j=J(V);return"$async"in J||(this.errors=J.errors),j}compile(N,V){const J=this._addSchema(N,V);return J.validate||this._compileSchemaEnv(J)}compileAsync(N,V){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:J}=this.opts;return j.call(this,N,V);async function j(re,q){await G.call(this,re.$schema);const L=this._addSchema(re,q);return L.validate||C.call(this,L)}async function G(re){re&&!this.getSchema(re)&&await j.call(this,{$ref:re},!0)}async function C(re){try{return this._compileSchemaEnv(re)}catch(q){if(!(q instanceof i.default))throw q;return F.call(this,q),await Z.call(this,q.missingSchema),C.call(this,re)}}function F({missingSchema:re,missingRef:q}){if(this.refs[re])throw new Error(`AnySchema ${re} is loaded but ${q} cannot be resolved`)}async function Z(re){const q=await te.call(this,re);this.refs[re]||await G.call(this,q.$schema),this.refs[re]||this.addSchema(q,re,V)}async function te(re){const q=this._loading[re];if(q)return q;try{return await(this._loading[re]=J(re))}finally{delete this._loading[re]}}}addSchema(N,V,J,j=this.opts.validateSchema){if(Array.isArray(N)){for(const C of N)this.addSchema(C,void 0,J,j);return this}let G;if(typeof N=="object"){const{schemaId:C}=this.opts;if(G=N[C],G!==void 0&&typeof G!="string")throw new Error(`schema ${C} must be string`)}return V=(0,l.normalizeId)(V||G),this._checkUnique(V),this.schemas[V]=this._addSchema(N,J,V,j,!0),this}addMetaSchema(N,V,J=this.opts.validateSchema){return this.addSchema(N,V,!0,J),this}validateSchema(N,V){if(typeof N=="boolean")return!0;let J;if(J=N.$schema,J!==void 0&&typeof J!="string")throw new Error("$schema must be a string");if(J=J||this.opts.defaultMeta||this.defaultMeta(),!J)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const j=this.validate(J,N);if(!j&&V){const G="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(G);else throw new Error(G)}return j}getSchema(N){let V;for(;typeof(V=E.call(this,N))=="string";)N=V;if(V===void 0){const{schemaId:J}=this.opts,j=new s.SchemaEnv({schema:{},schemaId:J});if(V=s.resolveSchema.call(this,j,N),!V)return;this.refs[N]=V}return V.validate||this._compileSchemaEnv(V)}removeSchema(N){if(N instanceof RegExp)return this._removeAllSchemas(this.schemas,N),this._removeAllSchemas(this.refs,N),this;switch(typeof N){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const V=E.call(this,N);return typeof V=="object"&&this._cache.delete(V.schema),delete this.schemas[N],delete this.refs[N],this}case"object":{const V=N;this._cache.delete(V);let J=N[this.opts.schemaId];return J&&(J=(0,l.normalizeId)(J),delete this.schemas[J],delete this.refs[J]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(N){for(const V of N)this.addKeyword(V);return this}addKeyword(N,V){let J;if(typeof N=="string")J=N,typeof V=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),V.keyword=J);else if(typeof N=="object"&&V===void 0){if(V=N,J=V.keyword,Array.isArray(J)&&!J.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(ee.call(this,J,V),!V)return(0,c.eachItem)(J,G=>R.call(this,G)),this;K.call(this,V);const j={...V,type:(0,d.getJSONTypes)(V.type),schemaType:(0,d.getJSONTypes)(V.schemaType)};return(0,c.eachItem)(J,j.type.length===0?G=>R.call(this,G,j):G=>j.type.forEach(C=>R.call(this,G,j,C))),this}getKeyword(N){const V=this.RULES.all[N];return typeof V=="object"?V.definition:!!V}removeKeyword(N){const{RULES:V}=this;delete V.keywords[N],delete V.all[N];for(const J of V.rules){const j=J.rules.findIndex(G=>G.keyword===N);j>=0&&J.rules.splice(j,1)}return this}addFormat(N,V){return typeof V=="string"&&(V=new RegExp(V)),this.formats[N]=V,this}errorsText(N=this.errors,{separator:V=", ",dataVar:J="data"}={}){return!N||N.length===0?"No errors":N.map(j=>`${J}${j.instancePath} ${j.message}`).reduce((j,G)=>j+V+G)}$dataMetaSchema(N,V){const J=this.RULES.all;N=JSON.parse(JSON.stringify(N));for(const j of V){const G=j.split("/").slice(1);let C=N;for(const F of G)C=C[F];for(const F in J){const Z=J[F];if(typeof Z!="object")continue;const{$data:te}=Z.definition,re=C[F];te&&re&&(C[F]=I(re))}}return N}_removeAllSchemas(N,V){for(const J in N){const j=N[J];(!V||V.test(J))&&(typeof j=="string"?delete N[J]:j&&!j.meta&&(this._cache.delete(j.schema),delete N[J]))}}_addSchema(N,V,J,j=this.opts.validateSchema,G=this.opts.addUsedSchema){let C;const{schemaId:F}=this.opts;if(typeof N=="object")C=N[F];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof N!="boolean")throw new Error("schema must be object or boolean")}let Z=this._cache.get(N);if(Z!==void 0)return Z;J=(0,l.normalizeId)(C||J);const te=l.getSchemaRefs.call(this,N,J);return Z=new s.SchemaEnv({schema:N,schemaId:F,meta:V,baseId:J,localRefs:te}),this._cache.set(Z.schema,Z),G&&!J.startsWith("#")&&(J&&this._checkUnique(J),this.refs[J]=Z),j&&this.validateSchema(N,!0),Z}_checkUnique(N){if(this.schemas[N]||this.refs[N])throw new Error(`schema with key or id "${N}" already exists`)}_compileSchemaEnv(N){if(N.meta?this._compileMetaSchema(N):s.compileSchema.call(this,N),!N.validate)throw new Error("ajv implementation error");return N.validate}_compileMetaSchema(N){const V=this.opts;this.opts=this._metaOpts;try{s.compileSchema.call(this,N)}finally{this.opts=V}}}r.default=b,b.ValidationError=n.default,b.MissingRefError=i.default;function _(D,N,V,J="error"){for(const j in D){const G=j;G in N&&this.logger[J](`${V}: option ${j}. ${D[G]}`)}}function E(D){return D=(0,l.normalizeId)(D),this.schemas[D]||this.refs[D]}function S(){const D=this.opts.schemas;if(D)if(Array.isArray(D))this.addSchema(D);else for(const N in D)this.addSchema(D[N],N)}function T(){for(const D in this.opts.formats){const N=this.opts.formats[D];N&&this.addFormat(D,N)}}function O(D){if(Array.isArray(D)){this.addVocabulary(D);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const N in D){const V=D[N];V.keyword||(V.keyword=N),this.addKeyword(V)}}function M(){const D={...this.opts};for(const N of p)delete D[N];return D}const Q={log(){},warn(){},error(){}};function W(D){if(D===!1)return Q;if(D===void 0)return console;if(D.log&&D.warn&&D.error)return D;throw new Error("logger must implement log, warn and error methods")}const U=/^[a-z_$][a-z0-9_$:-]*$/i;function ee(D,N){const{RULES:V}=this;if((0,c.eachItem)(D,J=>{if(V.keywords[J])throw new Error(`Keyword ${J} is already defined`);if(!U.test(J))throw new Error(`Keyword ${J} has invalid name`)}),!!N&&N.$data&&!("code"in N||"validate"in N))throw new Error('$data keyword must have "code" or "validate" function')}function R(D,N,V){var J;const j=N?.post;if(V&&j)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:G}=this;let C=j?G.post:G.rules.find(({type:Z})=>Z===V);if(C||(C={type:V,rules:[]},G.rules.push(C)),G.keywords[D]=!0,!N)return;const F={keyword:D,definition:{...N,type:(0,d.getJSONTypes)(N.type),schemaType:(0,d.getJSONTypes)(N.schemaType)}};N.before?z.call(this,C,F,N.before):C.rules.push(F),G.all[D]=F,(J=N.implements)===null||J===void 0||J.forEach(Z=>this.addKeyword(Z))}function z(D,N,V){const J=D.rules.findIndex(j=>j.keyword===V);J>=0?D.rules.splice(J,0,N):(D.rules.push(N),this.logger.warn(`rule ${V} is not defined`))}function K(D){let{metaSchema:N}=D;N!==void 0&&(D.$data&&this.opts.$data&&(N=I(N)),D.validateSchema=this.compile(N,!0))}const Y={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function I(D){return{anyOf:[D,Y]}}})(Z7);var dR={},uR={},fR={};Object.defineProperty(fR,"__esModule",{value:!0});const Hye={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};fR.default=Hye;var Ru={};Object.defineProperty(Ru,"__esModule",{value:!0});Ru.callRef=Ru.getValidate=void 0;const Gye=Z_,zB=tr,ks=zt,Em=Pa,FB=ys,z1=lr,Yye={keyword:"$ref",schemaType:"string",code(r){const{gen:e,schema:t,it:n}=r,{baseId:i,schemaEnv:o,validateName:s,opts:a,self:l}=n,{root:d}=o;if((t==="#"||t==="#/")&&i===d.baseId)return u();const c=FB.resolveRef.call(l,d,i,t);if(c===void 0)throw new Gye.default(n.opts.uriResolver,i,t);if(c instanceof FB.SchemaEnv)return f(c);return h(c);function u(){if(o===d)return dE(r,s,o,o.$async);const p=e.scopeValue("root",{ref:d});return dE(r,(0,ks._)`${p}.validate`,d,d.$async)}function f(p){const y=Aq(r,p);dE(r,y,p,p.$async)}function h(p){const y=e.scopeValue("schema",a.code.source===!0?{ref:p,code:(0,ks.stringify)(p)}:{ref:p}),g=e.name("valid"),w=r.subschema({schema:p,dataTypes:[],schemaPath:ks.nil,topSchemaRef:y,errSchemaPath:t},g);r.mergeEvaluated(w),r.ok(g)}}};function Aq(r,e){const{gen:t}=r;return e.validate?t.scopeValue("validate",{ref:e.validate}):(0,ks._)`${t.scopeValue("wrapper",{ref:e})}.validate`}Ru.getValidate=Aq;function dE(r,e,t,n){const{gen:i,it:o}=r,{allErrors:s,schemaEnv:a,opts:l}=o,d=l.passContext?Em.default.this:ks.nil;n?c():u();function c(){if(!a.$async)throw new Error("async schema referenced by sync schema");const p=i.let("valid");i.try(()=>{i.code((0,ks._)`await ${(0,zB.callValidateCode)(r,e,d)}`),h(e),s||i.assign(p,!0)},y=>{i.if((0,ks._)`!(${y} instanceof ${o.ValidationError})`,()=>i.throw(y)),f(y),s||i.assign(p,!1)}),r.ok(p)}function u(){r.result((0,zB.callValidateCode)(r,e,d),()=>h(e),()=>f(e))}function f(p){const y=(0,ks._)`${p}.errors`;i.assign(Em.default.vErrors,(0,ks._)`${Em.default.vErrors} === null ? ${y} : ${Em.default.vErrors}.concat(${y})`),i.assign(Em.default.errors,(0,ks._)`${Em.default.vErrors}.length`)}function h(p){var y;if(!o.opts.unevaluated)return;const g=(y=t?.validate)===null||y===void 0?void 0:y.evaluated;if(o.props!==!0)if(g&&!g.dynamicProps)g.props!==void 0&&(o.props=z1.mergeEvaluated.props(i,g.props,o.props));else{const w=i.var("props",(0,ks._)`${p}.evaluated.props`);o.props=z1.mergeEvaluated.props(i,w,o.props,ks.Name)}if(o.items!==!0)if(g&&!g.dynamicItems)g.items!==void 0&&(o.items=z1.mergeEvaluated.items(i,g.items,o.items));else{const w=i.var("items",(0,ks._)`${p}.evaluated.items`);o.items=z1.mergeEvaluated.items(i,w,o.items,ks.Name)}}}Ru.callRef=dE;Ru.default=Yye;Object.defineProperty(uR,"__esModule",{value:!0});const Zye=fR,Jye=Ru,Xye=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Zye.default,Jye.default];uR.default=Xye;var hR={},pR={};Object.defineProperty(pR,"__esModule",{value:!0});const jA=zt,mf=jA.operators,NA={maximum:{okStr:"<=",ok:mf.LTE,fail:mf.GT},minimum:{okStr:">=",ok:mf.GTE,fail:mf.LT},exclusiveMaximum:{okStr:"<",ok:mf.LT,fail:mf.GTE},exclusiveMinimum:{okStr:">",ok:mf.GT,fail:mf.LTE}},Qye={message:({keyword:r,schemaCode:e})=>(0,jA.str)`must be ${NA[r].okStr} ${e}`,params:({keyword:r,schemaCode:e})=>(0,jA._)`{comparison: ${NA[r].okStr}, limit: ${e}}`},eme={keyword:Object.keys(NA),type:"number",schemaType:"number",$data:!0,error:Qye,code(r){const{keyword:e,data:t,schemaCode:n}=r;r.fail$data((0,jA._)`${t} ${NA[e].fail} ${n} || isNaN(${t})`)}};pR.default=eme;var yR={};Object.defineProperty(yR,"__esModule",{value:!0});const Xb=zt,tme={message:({schemaCode:r})=>(0,Xb.str)`must be multiple of ${r}`,params:({schemaCode:r})=>(0,Xb._)`{multipleOf: ${r}}`},rme={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:tme,code(r){const{gen:e,data:t,schemaCode:n,it:i}=r,o=i.opts.multipleOfPrecision,s=e.let("res"),a=o?(0,Xb._)`Math.abs(Math.round(${s}) - ${s}) > 1e-${o}`:(0,Xb._)`${s} !== parseInt(${s})`;r.fail$data((0,Xb._)`(${n} === 0 || (${s} = ${t}/${n}, ${a}))`)}};yR.default=rme;var mR={},gR={};Object.defineProperty(gR,"__esModule",{value:!0});function xq(r){const e=r.length;let t=0,n=0,i;for(;n<e;)t++,i=r.charCodeAt(n++),i>=55296&&i<=56319&&n<e&&(i=r.charCodeAt(n),(i&64512)===56320&&n++);return t}gR.default=xq;xq.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(mR,"__esModule",{value:!0});const Dp=zt,nme=lr,ime=gR,ome={message({keyword:r,schemaCode:e}){const t=r==="maxLength"?"more":"fewer";return(0,Dp.str)`must NOT have ${t} than ${e} characters`},params:({schemaCode:r})=>(0,Dp._)`{limit: ${r}}`},sme={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:ome,code(r){const{keyword:e,data:t,schemaCode:n,it:i}=r,o=e==="maxLength"?Dp.operators.GT:Dp.operators.LT,s=i.opts.unicode===!1?(0,Dp._)`${t}.length`:(0,Dp._)`${(0,nme.useFunc)(r.gen,ime.default)}(${t})`;r.fail$data((0,Dp._)`${s} ${o} ${n}`)}};mR.default=sme;var vR={};Object.defineProperty(vR,"__esModule",{value:!0});const ame=tr,UA=zt,cme={message:({schemaCode:r})=>(0,UA.str)`must match pattern "${r}"`,params:({schemaCode:r})=>(0,UA._)`{pattern: ${r}}`},lme={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:cme,code(r){const{data:e,$data:t,schema:n,schemaCode:i,it:o}=r,s=o.opts.unicodeRegExp?"u":"",a=t?(0,UA._)`(new RegExp(${i}, ${s}))`:(0,ame.usePattern)(r,n);r.fail$data((0,UA._)`!${a}.test(${e})`)}};vR.default=lme;var bR={};Object.defineProperty(bR,"__esModule",{value:!0});const Qb=zt,dme={message({keyword:r,schemaCode:e}){const t=r==="maxProperties"?"more":"fewer";return(0,Qb.str)`must NOT have ${t} than ${e} properties`},params:({schemaCode:r})=>(0,Qb._)`{limit: ${r}}`},ume={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:dme,code(r){const{keyword:e,data:t,schemaCode:n}=r,i=e==="maxProperties"?Qb.operators.GT:Qb.operators.LT;r.fail$data((0,Qb._)`Object.keys(${t}).length ${i} ${n}`)}};bR.default=ume;var wR={};Object.defineProperty(wR,"__esModule",{value:!0});const w0=tr,ew=zt,fme=lr,hme={message:({params:{missingProperty:r}})=>(0,ew.str)`must have required property '${r}'`,params:({params:{missingProperty:r}})=>(0,ew._)`{missingProperty: ${r}}`},pme={keyword:"required",type:"object",schemaType:"array",$data:!0,error:hme,code(r){const{gen:e,schema:t,schemaCode:n,data:i,$data:o,it:s}=r,{opts:a}=s;if(!o&&t.length===0)return;const l=t.length>=a.loopRequired;if(s.allErrors?d():c(),a.strictRequired){const h=r.parentSchema.properties,{definedProperties:p}=r.it;for(const y of t)if(h?.[y]===void 0&&!p.has(y)){const g=s.schemaEnv.baseId+s.errSchemaPath,w=`required property "${y}" is not defined at "${g}" (strictRequired)`;(0,fme.checkStrictMode)(s,w,s.opts.strictRequired)}}function d(){if(l||o)r.block$data(ew.nil,u);else for(const h of t)(0,w0.checkReportMissingProp)(r,h)}function c(){const h=e.let("missing");if(l||o){const p=e.let("valid",!0);r.block$data(p,()=>f(h,p)),r.ok(p)}else e.if((0,w0.checkMissingProp)(r,t,h)),(0,w0.reportMissingProp)(r,h),e.else()}function u(){e.forOf("prop",n,h=>{r.setParams({missingProperty:h}),e.if((0,w0.noPropertyInData)(e,i,h,a.ownProperties),()=>r.error())})}function f(h,p){r.setParams({missingProperty:h}),e.forOf(h,n,()=>{e.assign(p,(0,w0.propertyInData)(e,i,h,a.ownProperties)),e.if((0,ew.not)(p),()=>{r.error(),e.break()})},ew.nil)}}};wR.default=pme;var _R={};Object.defineProperty(_R,"__esModule",{value:!0});const tw=zt,yme={message({keyword:r,schemaCode:e}){const t=r==="maxItems"?"more":"fewer";return(0,tw.str)`must NOT have ${t} than ${e} items`},params:({schemaCode:r})=>(0,tw._)`{limit: ${r}}`},mme={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:yme,code(r){const{keyword:e,data:t,schemaCode:n}=r,i=e==="maxItems"?tw.operators.GT:tw.operators.LT;r.fail$data((0,tw._)`${t}.length ${i} ${n}`)}};_R.default=mme;var ER={},J_={};Object.defineProperty(J_,"__esModule",{value:!0});const Sq=iq;Sq.code='require("ajv/dist/runtime/equal").default';J_.default=Sq;Object.defineProperty(ER,"__esModule",{value:!0});const S$=G_,Xi=zt,gme=lr,vme=J_,bme={message:({params:{i:r,j:e}})=>(0,Xi.str)`must NOT have duplicate items (items ## ${e} and ${r} are identical)`,params:({params:{i:r,j:e}})=>(0,Xi._)`{i: ${r}, j: ${e}}`},wme={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:bme,code(r){const{gen:e,data:t,$data:n,schema:i,parentSchema:o,schemaCode:s,it:a}=r;if(!n&&!i)return;const l=e.let("valid"),d=o.items?(0,S$.getSchemaTypes)(o.items):[];r.block$data(l,c,(0,Xi._)`${s} === false`),r.ok(l);function c(){const p=e.let("i",(0,Xi._)`${t}.length`),y=e.let("j");r.setParams({i:p,j:y}),e.assign(l,!0),e.if((0,Xi._)`${p} > 1`,()=>(u()?f:h)(p,y))}function u(){return d.length>0&&!d.some(p=>p==="object"||p==="array")}function f(p,y){const g=e.name("item"),w=(0,S$.checkDataTypes)(d,g,a.opts.strictNumbers,S$.DataType.Wrong),v=e.const("indices",(0,Xi._)`{}`);e.for((0,Xi._)`;${p}--;`,()=>{e.let(g,(0,Xi._)`${t}[${p}]`),e.if(w,(0,Xi._)`continue`),d.length>1&&e.if((0,Xi._)`typeof ${g} == "string"`,(0,Xi._)`${g} += "_"`),e.if((0,Xi._)`typeof ${v}[${g}] == "number"`,()=>{e.assign(y,(0,Xi._)`${v}[${g}]`),r.error(),e.assign(l,!1).break()}).code((0,Xi._)`${v}[${g}] = ${p}`)})}function h(p,y){const g=(0,gme.useFunc)(e,vme.default),w=e.name("outer");e.label(w).for((0,Xi._)`;${p}--;`,()=>e.for((0,Xi._)`${y} = ${p}; ${y}--;`,()=>e.if((0,Xi._)`${g}(${t}[${p}], ${t}[${y}])`,()=>{r.error(),e.assign(l,!1).break(w)})))}}};ER.default=wme;var AR={};Object.defineProperty(AR,"__esModule",{value:!0});const TI=zt,_me=lr,Eme=J_,Ame={message:"must be equal to constant",params:({schemaCode:r})=>(0,TI._)`{allowedValue: ${r}}`},xme={keyword:"const",$data:!0,error:Ame,code(r){const{gen:e,data:t,$data:n,schemaCode:i,schema:o}=r;n||o&&typeof o=="object"?r.fail$data((0,TI._)`!${(0,_me.useFunc)(e,Eme.default)}(${t}, ${i})`):r.fail((0,TI._)`${o} !== ${t}`)}};AR.default=xme;var xR={};Object.defineProperty(xR,"__esModule",{value:!0});const mb=zt,Sme=lr,Tme=J_,$me={message:"must be equal to one of the allowed values",params:({schemaCode:r})=>(0,mb._)`{allowedValues: ${r}}`},kme={keyword:"enum",schemaType:"array",$data:!0,error:$me,code(r){const{gen:e,data:t,$data:n,schema:i,schemaCode:o,it:s}=r;if(!n&&i.length===0)throw new Error("enum must have non-empty array");const a=i.length>=s.opts.loopEnum;let l;const d=()=>l??(l=(0,Sme.useFunc)(e,Tme.default));let c;if(a||n)c=e.let("valid"),r.block$data(c,u);else{if(!Array.isArray(i))throw new Error("ajv implementation error");const h=e.const("vSchema",o);c=(0,mb.or)(...i.map((p,y)=>f(h,y)))}r.pass(c);function u(){e.assign(c,!1),e.forOf("v",o,h=>e.if((0,mb._)`${d()}(${t}, ${h})`,()=>e.assign(c,!0).break()))}function f(h,p){const y=i[p];return typeof y=="object"&&y!==null?(0,mb._)`${d()}(${t}, ${h}[${p}])`:(0,mb._)`${t} === ${y}`}}};xR.default=kme;Object.defineProperty(hR,"__esModule",{value:!0});const Pme=pR,Ime=yR,Ome=mR,Cme=vR,Rme=bR,Dme=wR,Mme=_R,Bme=ER,jme=AR,Nme=xR,Ume=[Pme.default,Ime.default,Ome.default,Cme.default,Rme.default,Dme.default,Mme.default,Bme.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},jme.default,Nme.default];hR.default=Ume;var SR={},Kv={};Object.defineProperty(Kv,"__esModule",{value:!0});Kv.validateAdditionalItems=void 0;const Mp=zt,$I=lr,Lme={message:({params:{len:r}})=>(0,Mp.str)`must NOT have more than ${r} items`,params:({params:{len:r}})=>(0,Mp._)`{limit: ${r}}`},Kme={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Lme,code(r){const{parentSchema:e,it:t}=r,{items:n}=e;if(!Array.isArray(n)){(0,$I.checkStrictMode)(t,'"additionalItems" is ignored when "items" is not an array of schemas');return}Tq(r,n)}};function Tq(r,e){const{gen:t,schema:n,data:i,keyword:o,it:s}=r;s.items=!0;const a=t.const("len",(0,Mp._)`${i}.length`);if(n===!1)r.setParams({len:e.length}),r.pass((0,Mp._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,$I.alwaysValidSchema)(s,n)){const d=t.var("valid",(0,Mp._)`${a} <= ${e.length}`);t.if((0,Mp.not)(d),()=>l(d)),r.ok(d)}function l(d){t.forRange("i",e.length,a,c=>{r.subschema({keyword:o,dataProp:c,dataPropType:$I.Type.Num},d),s.allErrors||t.if((0,Mp.not)(d),()=>t.break())})}}Kv.validateAdditionalItems=Tq;Kv.default=Kme;var TR={},zv={};Object.defineProperty(zv,"__esModule",{value:!0});zv.validateTuple=void 0;const qB=zt,uE=lr,zme=tr,Fme={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(r){const{schema:e,it:t}=r;if(Array.isArray(e))return $q(r,"additionalItems",e);t.items=!0,!(0,uE.alwaysValidSchema)(t,e)&&r.ok((0,zme.validateArray)(r))}};function $q(r,e,t=r.schema){const{gen:n,parentSchema:i,data:o,keyword:s,it:a}=r;c(i),a.opts.unevaluated&&t.length&&a.items!==!0&&(a.items=uE.mergeEvaluated.items(n,t.length,a.items));const l=n.name("valid"),d=n.const("len",(0,qB._)`${o}.length`);t.forEach((u,f)=>{(0,uE.alwaysValidSchema)(a,u)||(n.if((0,qB._)`${d} > ${f}`,()=>r.subschema({keyword:s,schemaProp:f,dataProp:f},l)),r.ok(l))});function c(u){const{opts:f,errSchemaPath:h}=a,p=t.length,y=p===u.minItems&&(p===u.maxItems||u[e]===!1);if(f.strictTuples&&!y){const g=`"${s}" is ${p}-tuple, but minItems or maxItems/${e} are not specified or different at path "${h}"`;(0,uE.checkStrictMode)(a,g,f.strictTuples)}}}zv.validateTuple=$q;zv.default=Fme;Object.defineProperty(TR,"__esModule",{value:!0});const qme=zv,Vme={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:r=>(0,qme.validateTuple)(r,"items")};TR.default=Vme;var $R={};Object.defineProperty($R,"__esModule",{value:!0});const VB=zt,Wme=lr,Hme=tr,Gme=Kv,Yme={message:({params:{len:r}})=>(0,VB.str)`must NOT have more than ${r} items`,params:({params:{len:r}})=>(0,VB._)`{limit: ${r}}`},Zme={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Yme,code(r){const{schema:e,parentSchema:t,it:n}=r,{prefixItems:i}=t;n.items=!0,!(0,Wme.alwaysValidSchema)(n,e)&&(i?(0,Gme.validateAdditionalItems)(r,i):r.ok((0,Hme.validateArray)(r)))}};$R.default=Zme;var kR={};Object.defineProperty(kR,"__esModule",{value:!0});const Ha=zt,F1=lr,Jme={message:({params:{min:r,max:e}})=>e===void 0?(0,Ha.str)`must contain at least ${r} valid item(s)`:(0,Ha.str)`must contain at least ${r} and no more than ${e} valid item(s)`,params:({params:{min:r,max:e}})=>e===void 0?(0,Ha._)`{minContains: ${r}}`:(0,Ha._)`{minContains: ${r}, maxContains: ${e}}`},Xme={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:Jme,code(r){const{gen:e,schema:t,parentSchema:n,data:i,it:o}=r;let s,a;const{minContains:l,maxContains:d}=n;o.opts.next?(s=l===void 0?1:l,a=d):s=1;const c=e.const("len",(0,Ha._)`${i}.length`);if(r.setParams({min:s,max:a}),a===void 0&&s===0){(0,F1.checkStrictMode)(o,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&s>a){(0,F1.checkStrictMode)(o,'"minContains" > "maxContains" is always invalid'),r.fail();return}if((0,F1.alwaysValidSchema)(o,t)){let y=(0,Ha._)`${c} >= ${s}`;a!==void 0&&(y=(0,Ha._)`${y} && ${c} <= ${a}`),r.pass(y);return}o.items=!0;const u=e.name("valid");a===void 0&&s===1?h(u,()=>e.if(u,()=>e.break())):s===0?(e.let(u,!0),a!==void 0&&e.if((0,Ha._)`${i}.length > 0`,f)):(e.let(u,!1),f()),r.result(u,()=>r.reset());function f(){const y=e.name("_valid"),g=e.let("count",0);h(y,()=>e.if(y,()=>p(g)))}function h(y,g){e.forRange("i",0,c,w=>{r.subschema({keyword:"contains",dataProp:w,dataPropType:F1.Type.Num,compositeRule:!0},y),g()})}function p(y){e.code((0,Ha._)`${y}++`),a===void 0?e.if((0,Ha._)`${y} >= ${s}`,()=>e.assign(u,!0).break()):(e.if((0,Ha._)`${y} > ${a}`,()=>e.assign(u,!1).break()),s===1?e.assign(u,!0):e.if((0,Ha._)`${y} >= ${s}`,()=>e.assign(u,!0)))}}};kR.default=Xme;var OS={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.validateSchemaDeps=r.validatePropertyDeps=r.error=void 0;const e=zt,t=lr,n=tr;r.error={message:({params:{property:l,depsCount:d,deps:c}})=>{const u=d===1?"property":"properties";return(0,e.str)`must have ${u} ${c} when property ${l} is present`},params:({params:{property:l,depsCount:d,deps:c,missingProperty:u}})=>(0,e._)`{property: ${l},
    missingProperty: ${u},
    depsCount: ${d},
    deps: ${c}}`};const i={keyword:"dependencies",type:"object",schemaType:"object",error:r.error,code(l){const[d,c]=o(l);s(l,d),a(l,c)}};function o({schema:l}){const d={},c={};for(const u in l){if(u==="__proto__")continue;const f=Array.isArray(l[u])?d:c;f[u]=l[u]}return[d,c]}function s(l,d=l.schema){const{gen:c,data:u,it:f}=l;if(Object.keys(d).length===0)return;const h=c.let("missing");for(const p in d){const y=d[p];if(y.length===0)continue;const g=(0,n.propertyInData)(c,u,p,f.opts.ownProperties);l.setParams({property:p,depsCount:y.length,deps:y.join(", ")}),f.allErrors?c.if(g,()=>{for(const w of y)(0,n.checkReportMissingProp)(l,w)}):(c.if((0,e._)`${g} && (${(0,n.checkMissingProp)(l,y,h)})`),(0,n.reportMissingProp)(l,h),c.else())}}r.validatePropertyDeps=s;function a(l,d=l.schema){const{gen:c,data:u,keyword:f,it:h}=l,p=c.name("valid");for(const y in d)(0,t.alwaysValidSchema)(h,d[y])||(c.if((0,n.propertyInData)(c,u,y,h.opts.ownProperties),()=>{const g=l.subschema({keyword:f,schemaProp:y},p);l.mergeValidEvaluated(g,p)},()=>c.var(p,!0)),l.ok(p))}r.validateSchemaDeps=a,r.default=i})(OS);var PR={};Object.defineProperty(PR,"__esModule",{value:!0});const kq=zt,Qme=lr,ege={message:"property name must be valid",params:({params:r})=>(0,kq._)`{propertyName: ${r.propertyName}}`},tge={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:ege,code(r){const{gen:e,schema:t,data:n,it:i}=r;if((0,Qme.alwaysValidSchema)(i,t))return;const o=e.name("valid");e.forIn("key",n,s=>{r.setParams({propertyName:s}),r.subschema({keyword:"propertyNames",data:s,dataTypes:["string"],propertyName:s,compositeRule:!0},o),e.if((0,kq.not)(o),()=>{r.error(!0),i.allErrors||e.break()})}),r.ok(o)}};PR.default=tge;var CS={};Object.defineProperty(CS,"__esModule",{value:!0});const q1=tr,Ac=zt,rge=Pa,V1=lr,nge={message:"must NOT have additional properties",params:({params:r})=>(0,Ac._)`{additionalProperty: ${r.additionalProperty}}`},ige={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:nge,code(r){const{gen:e,schema:t,parentSchema:n,data:i,errsCount:o,it:s}=r;if(!o)throw new Error("ajv implementation error");const{allErrors:a,opts:l}=s;if(s.props=!0,l.removeAdditional!=="all"&&(0,V1.alwaysValidSchema)(s,t))return;const d=(0,q1.allSchemaProperties)(n.properties),c=(0,q1.allSchemaProperties)(n.patternProperties);u(),r.ok((0,Ac._)`${o} === ${rge.default.errors}`);function u(){e.forIn("key",i,g=>{!d.length&&!c.length?p(g):e.if(f(g),()=>p(g))})}function f(g){let w;if(d.length>8){const v=(0,V1.schemaRefOrVal)(s,n.properties,"properties");w=(0,q1.isOwnProperty)(e,v,g)}else d.length?w=(0,Ac.or)(...d.map(v=>(0,Ac._)`${g} === ${v}`)):w=Ac.nil;return c.length&&(w=(0,Ac.or)(w,...c.map(v=>(0,Ac._)`${(0,q1.usePattern)(r,v)}.test(${g})`))),(0,Ac.not)(w)}function h(g){e.code((0,Ac._)`delete ${i}[${g}]`)}function p(g){if(l.removeAdditional==="all"||l.removeAdditional&&t===!1){h(g);return}if(t===!1){r.setParams({additionalProperty:g}),r.error(),a||e.break();return}if(typeof t=="object"&&!(0,V1.alwaysValidSchema)(s,t)){const w=e.name("valid");l.removeAdditional==="failing"?(y(g,w,!1),e.if((0,Ac.not)(w),()=>{r.reset(),h(g)})):(y(g,w),a||e.if((0,Ac.not)(w),()=>e.break()))}}function y(g,w,v){const m={keyword:"additionalProperties",dataProp:g,dataPropType:V1.Type.Str};v===!1&&Object.assign(m,{compositeRule:!0,createErrors:!1,allErrors:!1}),r.subschema(m,w)}}};CS.default=ige;var IR={};Object.defineProperty(IR,"__esModule",{value:!0});const oge=qc,WB=tr,T$=lr,HB=CS,sge={keyword:"properties",type:"object",schemaType:"object",code(r){const{gen:e,schema:t,parentSchema:n,data:i,it:o}=r;o.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&HB.default.code(new oge.KeywordCxt(o,HB.default,"additionalProperties"));const s=(0,WB.allSchemaProperties)(t);for(const u of s)o.definedProperties.add(u);o.opts.unevaluated&&s.length&&o.props!==!0&&(o.props=T$.mergeEvaluated.props(e,(0,T$.toHash)(s),o.props));const a=s.filter(u=>!(0,T$.alwaysValidSchema)(o,t[u]));if(a.length===0)return;const l=e.name("valid");for(const u of a)d(u)?c(u):(e.if((0,WB.propertyInData)(e,i,u,o.opts.ownProperties)),c(u),o.allErrors||e.else().var(l,!0),e.endIf()),r.it.definedProperties.add(u),r.ok(l);function d(u){return o.opts.useDefaults&&!o.compositeRule&&t[u].default!==void 0}function c(u){r.subschema({keyword:"properties",schemaProp:u,dataProp:u},l)}}};IR.default=sge;var OR={};Object.defineProperty(OR,"__esModule",{value:!0});const GB=tr,W1=zt,YB=lr,ZB=lr,age={keyword:"patternProperties",type:"object",schemaType:"object",code(r){const{gen:e,schema:t,data:n,parentSchema:i,it:o}=r,{opts:s}=o,a=(0,GB.allSchemaProperties)(t),l=a.filter(y=>(0,YB.alwaysValidSchema)(o,t[y]));if(a.length===0||l.length===a.length&&(!o.opts.unevaluated||o.props===!0))return;const d=s.strictSchema&&!s.allowMatchingProperties&&i.properties,c=e.name("valid");o.props!==!0&&!(o.props instanceof W1.Name)&&(o.props=(0,ZB.evaluatedPropsToName)(e,o.props));const{props:u}=o;f();function f(){for(const y of a)d&&h(y),o.allErrors?p(y):(e.var(c,!0),p(y),e.if(c))}function h(y){for(const g in d)new RegExp(y).test(g)&&(0,YB.checkStrictMode)(o,`property ${g} matches pattern ${y} (use allowMatchingProperties)`)}function p(y){e.forIn("key",n,g=>{e.if((0,W1._)`${(0,GB.usePattern)(r,y)}.test(${g})`,()=>{const w=l.includes(y);w||r.subschema({keyword:"patternProperties",schemaProp:y,dataProp:g,dataPropType:ZB.Type.Str},c),o.opts.unevaluated&&u!==!0?e.assign((0,W1._)`${u}[${g}]`,!0):!w&&!o.allErrors&&e.if((0,W1.not)(c),()=>e.break())})})}}};OR.default=age;var CR={};Object.defineProperty(CR,"__esModule",{value:!0});const cge=lr,lge={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(r){const{gen:e,schema:t,it:n}=r;if((0,cge.alwaysValidSchema)(n,t)){r.fail();return}const i=e.name("valid");r.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},i),r.failResult(i,()=>r.reset(),()=>r.error())},error:{message:"must NOT be valid"}};CR.default=lge;var RR={};Object.defineProperty(RR,"__esModule",{value:!0});const dge=tr,uge={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:dge.validateUnion,error:{message:"must match a schema in anyOf"}};RR.default=uge;var DR={};Object.defineProperty(DR,"__esModule",{value:!0});const fE=zt,fge=lr,hge={message:"must match exactly one schema in oneOf",params:({params:r})=>(0,fE._)`{passingSchemas: ${r.passing}}`},pge={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:hge,code(r){const{gen:e,schema:t,parentSchema:n,it:i}=r;if(!Array.isArray(t))throw new Error("ajv implementation error");if(i.opts.discriminator&&n.discriminator)return;const o=t,s=e.let("valid",!1),a=e.let("passing",null),l=e.name("_valid");r.setParams({passing:a}),e.block(d),r.result(s,()=>r.reset(),()=>r.error(!0));function d(){o.forEach((c,u)=>{let f;(0,fge.alwaysValidSchema)(i,c)?e.var(l,!0):f=r.subschema({keyword:"oneOf",schemaProp:u,compositeRule:!0},l),u>0&&e.if((0,fE._)`${l} && ${s}`).assign(s,!1).assign(a,(0,fE._)`[${a}, ${u}]`).else(),e.if(l,()=>{e.assign(s,!0),e.assign(a,u),f&&r.mergeEvaluated(f,fE.Name)})})}}};DR.default=pge;var MR={};Object.defineProperty(MR,"__esModule",{value:!0});const yge=lr,mge={keyword:"allOf",schemaType:"array",code(r){const{gen:e,schema:t,it:n}=r;if(!Array.isArray(t))throw new Error("ajv implementation error");const i=e.name("valid");t.forEach((o,s)=>{if((0,yge.alwaysValidSchema)(n,o))return;const a=r.subschema({keyword:"allOf",schemaProp:s},i);r.ok(i),r.mergeEvaluated(a)})}};MR.default=mge;var BR={};Object.defineProperty(BR,"__esModule",{value:!0});const LA=zt,Pq=lr,gge={message:({params:r})=>(0,LA.str)`must match "${r.ifClause}" schema`,params:({params:r})=>(0,LA._)`{failingKeyword: ${r.ifClause}}`},vge={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:gge,code(r){const{gen:e,parentSchema:t,it:n}=r;t.then===void 0&&t.else===void 0&&(0,Pq.checkStrictMode)(n,'"if" without "then" and "else" is ignored');const i=JB(n,"then"),o=JB(n,"else");if(!i&&!o)return;const s=e.let("valid",!0),a=e.name("_valid");if(l(),r.reset(),i&&o){const c=e.let("ifClause");r.setParams({ifClause:c}),e.if(a,d("then",c),d("else",c))}else i?e.if(a,d("then")):e.if((0,LA.not)(a),d("else"));r.pass(s,()=>r.error(!0));function l(){const c=r.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);r.mergeEvaluated(c)}function d(c,u){return()=>{const f=r.subschema({keyword:c},a);e.assign(s,a),r.mergeValidEvaluated(f,s),u?e.assign(u,(0,LA._)`${c}`):r.setParams({ifClause:c})}}}};function JB(r,e){const t=r.schema[e];return t!==void 0&&!(0,Pq.alwaysValidSchema)(r,t)}BR.default=vge;var jR={};Object.defineProperty(jR,"__esModule",{value:!0});const bge=lr,wge={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:r,parentSchema:e,it:t}){e.if===void 0&&(0,bge.checkStrictMode)(t,`"${r}" without "if" is ignored`)}};jR.default=wge;Object.defineProperty(SR,"__esModule",{value:!0});const _ge=Kv,Ege=TR,Age=zv,xge=$R,Sge=kR,Tge=OS,$ge=PR,kge=CS,Pge=IR,Ige=OR,Oge=CR,Cge=RR,Rge=DR,Dge=MR,Mge=BR,Bge=jR;function jge(r=!1){const e=[Oge.default,Cge.default,Rge.default,Dge.default,Mge.default,Bge.default,$ge.default,kge.default,Tge.default,Pge.default,Ige.default];return r?e.push(Ege.default,xge.default):e.push(_ge.default,Age.default),e.push(Sge.default),e}SR.default=jge;var NR={},Fv={};Object.defineProperty(Fv,"__esModule",{value:!0});Fv.dynamicAnchor=void 0;const $$=zt,Nge=Pa,XB=ys,Uge=Ru,Lge={keyword:"$dynamicAnchor",schemaType:"string",code:r=>Iq(r,r.schema)};function Iq(r,e){const{gen:t,it:n}=r;n.schemaEnv.root.dynamicAnchors[e]=!0;const i=(0,$$._)`${Nge.default.dynamicAnchors}${(0,$$.getProperty)(e)}`,o=n.errSchemaPath==="#"?n.validateName:Kge(r);t.if((0,$$._)`!${i}`,()=>t.assign(i,o))}Fv.dynamicAnchor=Iq;function Kge(r){const{schemaEnv:e,schema:t,self:n}=r.it,{root:i,baseId:o,localRefs:s,meta:a}=e.root,{schemaId:l}=n.opts,d=new XB.SchemaEnv({schema:t,schemaId:l,root:i,baseId:o,localRefs:s,meta:a});return XB.compileSchema.call(n,d),(0,Uge.getValidate)(r,d)}Fv.default=Lge;var qv={};Object.defineProperty(qv,"__esModule",{value:!0});qv.dynamicRef=void 0;const QB=zt,zge=Pa,ej=Ru,Fge={keyword:"$dynamicRef",schemaType:"string",code:r=>Oq(r,r.schema)};function Oq(r,e){const{gen:t,keyword:n,it:i}=r;if(e[0]!=="#")throw new Error(`"${n}" only supports hash fragment reference`);const o=e.slice(1);if(i.allErrors)s();else{const l=t.let("valid",!1);s(l),r.ok(l)}function s(l){if(i.schemaEnv.root.dynamicAnchors[o]){const d=t.let("_v",(0,QB._)`${zge.default.dynamicAnchors}${(0,QB.getProperty)(o)}`);t.if(d,a(d,l),a(i.validateName,l))}else a(i.validateName,l)()}function a(l,d){return d?()=>t.block(()=>{(0,ej.callRef)(r,l),t.let(d,!0)}):()=>(0,ej.callRef)(r,l)}}qv.dynamicRef=Oq;qv.default=Fge;var UR={};Object.defineProperty(UR,"__esModule",{value:!0});const qge=Fv,Vge=lr,Wge={keyword:"$recursiveAnchor",schemaType:"boolean",code(r){r.schema?(0,qge.dynamicAnchor)(r,""):(0,Vge.checkStrictMode)(r.it,"$recursiveAnchor: false is ignored")}};UR.default=Wge;var LR={};Object.defineProperty(LR,"__esModule",{value:!0});const Hge=qv,Gge={keyword:"$recursiveRef",schemaType:"string",code:r=>(0,Hge.dynamicRef)(r,r.schema)};LR.default=Gge;Object.defineProperty(NR,"__esModule",{value:!0});const Yge=Fv,Zge=qv,Jge=UR,Xge=LR,Qge=[Yge.default,Zge.default,Jge.default,Xge.default];NR.default=Qge;var KR={},zR={};Object.defineProperty(zR,"__esModule",{value:!0});const tj=OS,eve={keyword:"dependentRequired",type:"object",schemaType:"object",error:tj.error,code:r=>(0,tj.validatePropertyDeps)(r)};zR.default=eve;var FR={};Object.defineProperty(FR,"__esModule",{value:!0});const tve=OS,rve={keyword:"dependentSchemas",type:"object",schemaType:"object",code:r=>(0,tve.validateSchemaDeps)(r)};FR.default=rve;var qR={};Object.defineProperty(qR,"__esModule",{value:!0});const nve=lr,ive={keyword:["maxContains","minContains"],type:"array",schemaType:"number",code({keyword:r,parentSchema:e,it:t}){e.contains===void 0&&(0,nve.checkStrictMode)(t,`"${r}" without "contains" is ignored`)}};qR.default=ive;Object.defineProperty(KR,"__esModule",{value:!0});const ove=zR,sve=FR,ave=qR,cve=[ove.default,sve.default,ave.default];KR.default=cve;var VR={},WR={};Object.defineProperty(WR,"__esModule",{value:!0});const Nf=zt,rj=lr,lve=Pa,dve={message:"must NOT have unevaluated properties",params:({params:r})=>(0,Nf._)`{unevaluatedProperty: ${r.unevaluatedProperty}}`},uve={keyword:"unevaluatedProperties",type:"object",schemaType:["boolean","object"],trackErrors:!0,error:dve,code(r){const{gen:e,schema:t,data:n,errsCount:i,it:o}=r;if(!i)throw new Error("ajv implementation error");const{allErrors:s,props:a}=o;a instanceof Nf.Name?e.if((0,Nf._)`${a} !== true`,()=>e.forIn("key",n,u=>e.if(d(a,u),()=>l(u)))):a!==!0&&e.forIn("key",n,u=>a===void 0?l(u):e.if(c(a,u),()=>l(u))),o.props=!0,r.ok((0,Nf._)`${i} === ${lve.default.errors}`);function l(u){if(t===!1){r.setParams({unevaluatedProperty:u}),r.error(),s||e.break();return}if(!(0,rj.alwaysValidSchema)(o,t)){const f=e.name("valid");r.subschema({keyword:"unevaluatedProperties",dataProp:u,dataPropType:rj.Type.Str},f),s||e.if((0,Nf.not)(f),()=>e.break())}}function d(u,f){return(0,Nf._)`!${u} || !${u}[${f}]`}function c(u,f){const h=[];for(const p in u)u[p]===!0&&h.push((0,Nf._)`${f} !== ${p}`);return(0,Nf.and)(...h)}}};WR.default=uve;var HR={};Object.defineProperty(HR,"__esModule",{value:!0});const Bp=zt,nj=lr,fve={message:({params:{len:r}})=>(0,Bp.str)`must NOT have more than ${r} items`,params:({params:{len:r}})=>(0,Bp._)`{limit: ${r}}`},hve={keyword:"unevaluatedItems",type:"array",schemaType:["boolean","object"],error:fve,code(r){const{gen:e,schema:t,data:n,it:i}=r,o=i.items||0;if(o===!0)return;const s=e.const("len",(0,Bp._)`${n}.length`);if(t===!1)r.setParams({len:o}),r.fail((0,Bp._)`${s} > ${o}`);else if(typeof t=="object"&&!(0,nj.alwaysValidSchema)(i,t)){const l=e.var("valid",(0,Bp._)`${s} <= ${o}`);e.if((0,Bp.not)(l),()=>a(l,o)),r.ok(l)}i.items=!0;function a(l,d){e.forRange("i",d,s,c=>{r.subschema({keyword:"unevaluatedItems",dataProp:c,dataPropType:nj.Type.Num},l),i.allErrors||e.if((0,Bp.not)(l),()=>e.break())})}}};HR.default=hve;Object.defineProperty(VR,"__esModule",{value:!0});const pve=WR,yve=HR,mve=[pve.default,yve.default];VR.default=mve;var GR={},YR={};Object.defineProperty(YR,"__esModule",{value:!0});const jn=zt,gve={message:({schemaCode:r})=>(0,jn.str)`must match format "${r}"`,params:({schemaCode:r})=>(0,jn._)`{format: ${r}}`},vve={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:gve,code(r,e){const{gen:t,data:n,$data:i,schema:o,schemaCode:s,it:a}=r,{opts:l,errSchemaPath:d,schemaEnv:c,self:u}=a;if(!l.validateFormats)return;i?f():h();function f(){const p=t.scopeValue("formats",{ref:u.formats,code:l.code.formats}),y=t.const("fDef",(0,jn._)`${p}[${s}]`),g=t.let("fType"),w=t.let("format");t.if((0,jn._)`typeof ${y} == "object" && !(${y} instanceof RegExp)`,()=>t.assign(g,(0,jn._)`${y}.type || "string"`).assign(w,(0,jn._)`${y}.validate`),()=>t.assign(g,(0,jn._)`"string"`).assign(w,y)),r.fail$data((0,jn.or)(v(),m()));function v(){return l.strictSchema===!1?jn.nil:(0,jn._)`${s} && !${w}`}function m(){const b=c.$async?(0,jn._)`(${y}.async ? await ${w}(${n}) : ${w}(${n}))`:(0,jn._)`${w}(${n})`,_=(0,jn._)`(typeof ${w} == "function" ? ${b} : ${w}.test(${n}))`;return(0,jn._)`${w} && ${w} !== true && ${g} === ${e} && !${_}`}}function h(){const p=u.formats[o];if(!p){v();return}if(p===!0)return;const[y,g,w]=m(p);y===e&&r.pass(b());function v(){if(l.strictSchema===!1){u.logger.warn(_());return}throw new Error(_());function _(){return`unknown format "${o}" ignored in schema at path "${d}"`}}function m(_){const E=_ instanceof RegExp?(0,jn.regexpCode)(_):l.code.formats?(0,jn._)`${l.code.formats}${(0,jn.getProperty)(o)}`:void 0,S=t.scopeValue("formats",{key:o,ref:_,code:E});return typeof _=="object"&&!(_ instanceof RegExp)?[_.type||"string",_.validate,(0,jn._)`${S}.validate`]:["string",_,S]}function b(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!c.$async)throw new Error("async format in sync schema");return(0,jn._)`await ${w}(${n})`}return typeof g=="function"?(0,jn._)`${w}(${n})`:(0,jn._)`${w}.test(${n})`}}}};YR.default=vve;Object.defineProperty(GR,"__esModule",{value:!0});const bve=YR,wve=[bve.default];GR.default=wve;var Xg={};Object.defineProperty(Xg,"__esModule",{value:!0});Xg.contentVocabulary=Xg.metadataVocabulary=void 0;Xg.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Xg.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(dR,"__esModule",{value:!0});const _ve=uR,Eve=hR,Ave=SR,xve=NR,Sve=KR,Tve=VR,$ve=GR,ij=Xg,kve=[xve.default,_ve.default,Eve.default,(0,Ave.default)(!0),$ve.default,ij.metadataVocabulary,ij.contentVocabulary,Sve.default,Tve.default];dR.default=kve;var ZR={},Cq={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}(r.DiscrError||(r.DiscrError={}))})(Cq);Object.defineProperty(ZR,"__esModule",{value:!0});const Lm=zt,kI=Cq,oj=ys,Pve=lr,Ive={message:({params:{discrError:r,tagName:e}})=>r===kI.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:r,tag:e,tagName:t}})=>(0,Lm._)`{error: ${r}, tag: ${t}, tagValue: ${e}}`},Ove={keyword:"discriminator",type:"object",schemaType:"object",error:Ive,code(r){const{gen:e,data:t,schema:n,parentSchema:i,it:o}=r,{oneOf:s}=i;if(!o.opts.discriminator)throw new Error("discriminator: requires discriminator option");const a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!s)throw new Error("discriminator: requires oneOf keyword");const l=e.let("valid",!1),d=e.const("tag",(0,Lm._)`${t}${(0,Lm.getProperty)(a)}`);e.if((0,Lm._)`typeof ${d} == "string"`,()=>c(),()=>r.error(!1,{discrError:kI.DiscrError.Tag,tag:d,tagName:a})),r.ok(l);function c(){const h=f();e.if(!1);for(const p in h)e.elseIf((0,Lm._)`${d} === ${p}`),e.assign(l,u(h[p]));e.else(),r.error(!1,{discrError:kI.DiscrError.Mapping,tag:d,tagName:a}),e.endIf()}function u(h){const p=e.name("valid"),y=r.subschema({keyword:"oneOf",schemaProp:h},p);return r.mergeEvaluated(y,Lm.Name),p}function f(){var h;const p={},y=w(i);let g=!0;for(let b=0;b<s.length;b++){let _=s[b];_?.$ref&&!(0,Pve.schemaHasRulesButRef)(_,o.self.RULES)&&(_=oj.resolveRef.call(o.self,o.schemaEnv.root,o.baseId,_?.$ref),_ instanceof oj.SchemaEnv&&(_=_.schema));const E=(h=_?.properties)===null||h===void 0?void 0:h[a];if(typeof E!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);g=g&&(y||w(_)),v(E,b)}if(!g)throw new Error(`discriminator: "${a}" must be required`);return p;function w({required:b}){return Array.isArray(b)&&b.includes(a)}function v(b,_){if(b.const)m(b.const,_);else if(b.enum)for(const E of b.enum)m(E,_);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function m(b,_){if(typeof b!="string"||b in p)throw new Error(`discriminator: "${a}" values must be unique strings`);p[b]=_}}}};ZR.default=Ove;var JR={};const Cve="https://json-schema.org/draft/2020-12/schema",Rve="https://json-schema.org/draft/2020-12/schema",Dve={"https://json-schema.org/draft/2020-12/vocab/core":!0,"https://json-schema.org/draft/2020-12/vocab/applicator":!0,"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0,"https://json-schema.org/draft/2020-12/vocab/validation":!0,"https://json-schema.org/draft/2020-12/vocab/meta-data":!0,"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0,"https://json-schema.org/draft/2020-12/vocab/content":!0},Mve="meta",Bve="Core and Validation specifications meta-schema",jve=[{$ref:"meta/core"},{$ref:"meta/applicator"},{$ref:"meta/unevaluated"},{$ref:"meta/validation"},{$ref:"meta/meta-data"},{$ref:"meta/format-annotation"},{$ref:"meta/content"}],Nve=["object","boolean"],Uve="This meta-schema also defines keywords that have appeared in previous drafts in order to prevent incompatible extensions as they remain in common use.",Lve={definitions:{$comment:'"definitions" has been replaced by "$defs".',type:"object",additionalProperties:{$dynamicRef:"#meta"},deprecated:!0,default:{}},dependencies:{$comment:'"dependencies" has been split and replaced by "dependentSchemas" and "dependentRequired" in order to serve their differing semantics.',type:"object",additionalProperties:{anyOf:[{$dynamicRef:"#meta"},{$ref:"meta/validation#/$defs/stringArray"}]},deprecated:!0,default:{}},$recursiveAnchor:{$comment:'"$recursiveAnchor" has been replaced by "$dynamicAnchor".',$ref:"meta/core#/$defs/anchorString",deprecated:!0},$recursiveRef:{$comment:'"$recursiveRef" has been replaced by "$dynamicRef".',$ref:"meta/core#/$defs/uriReferenceString",deprecated:!0}},Kve={$schema:Cve,$id:Rve,$vocabulary:Dve,$dynamicAnchor:Mve,title:Bve,allOf:jve,type:Nve,$comment:Uve,properties:Lve},zve="https://json-schema.org/draft/2020-12/schema",Fve="https://json-schema.org/draft/2020-12/meta/applicator",qve={"https://json-schema.org/draft/2020-12/vocab/applicator":!0},Vve="meta",Wve="Applicator vocabulary meta-schema",Hve=["object","boolean"],Gve={prefixItems:{$ref:"#/$defs/schemaArray"},items:{$dynamicRef:"#meta"},contains:{$dynamicRef:"#meta"},additionalProperties:{$dynamicRef:"#meta"},properties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},patternProperties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},propertyNames:{format:"regex"},default:{}},dependentSchemas:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},propertyNames:{$dynamicRef:"#meta"},if:{$dynamicRef:"#meta"},then:{$dynamicRef:"#meta"},else:{$dynamicRef:"#meta"},allOf:{$ref:"#/$defs/schemaArray"},anyOf:{$ref:"#/$defs/schemaArray"},oneOf:{$ref:"#/$defs/schemaArray"},not:{$dynamicRef:"#meta"}},Yve={schemaArray:{type:"array",minItems:1,items:{$dynamicRef:"#meta"}}},Zve={$schema:zve,$id:Fve,$vocabulary:qve,$dynamicAnchor:Vve,title:Wve,type:Hve,properties:Gve,$defs:Yve},Jve="https://json-schema.org/draft/2020-12/schema",Xve="https://json-schema.org/draft/2020-12/meta/unevaluated",Qve={"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0},e0e="meta",t0e="Unevaluated applicator vocabulary meta-schema",r0e=["object","boolean"],n0e={unevaluatedItems:{$dynamicRef:"#meta"},unevaluatedProperties:{$dynamicRef:"#meta"}},i0e={$schema:Jve,$id:Xve,$vocabulary:Qve,$dynamicAnchor:e0e,title:t0e,type:r0e,properties:n0e},o0e="https://json-schema.org/draft/2020-12/schema",s0e="https://json-schema.org/draft/2020-12/meta/content",a0e={"https://json-schema.org/draft/2020-12/vocab/content":!0},c0e="meta",l0e="Content vocabulary meta-schema",d0e=["object","boolean"],u0e={contentEncoding:{type:"string"},contentMediaType:{type:"string"},contentSchema:{$dynamicRef:"#meta"}},f0e={$schema:o0e,$id:s0e,$vocabulary:a0e,$dynamicAnchor:c0e,title:l0e,type:d0e,properties:u0e},h0e="https://json-schema.org/draft/2020-12/schema",p0e="https://json-schema.org/draft/2020-12/meta/core",y0e={"https://json-schema.org/draft/2020-12/vocab/core":!0},m0e="meta",g0e="Core vocabulary meta-schema",v0e=["object","boolean"],b0e={$id:{$ref:"#/$defs/uriReferenceString",$comment:"Non-empty fragments not allowed.",pattern:"^[^#]*#?$"},$schema:{$ref:"#/$defs/uriString"},$ref:{$ref:"#/$defs/uriReferenceString"},$anchor:{$ref:"#/$defs/anchorString"},$dynamicRef:{$ref:"#/$defs/uriReferenceString"},$dynamicAnchor:{$ref:"#/$defs/anchorString"},$vocabulary:{type:"object",propertyNames:{$ref:"#/$defs/uriString"},additionalProperties:{type:"boolean"}},$comment:{type:"string"},$defs:{type:"object",additionalProperties:{$dynamicRef:"#meta"}}},w0e={anchorString:{type:"string",pattern:"^[A-Za-z_][-A-Za-z0-9._]*$"},uriString:{type:"string",format:"uri"},uriReferenceString:{type:"string",format:"uri-reference"}},_0e={$schema:h0e,$id:p0e,$vocabulary:y0e,$dynamicAnchor:m0e,title:g0e,type:v0e,properties:b0e,$defs:w0e},E0e="https://json-schema.org/draft/2020-12/schema",A0e="https://json-schema.org/draft/2020-12/meta/format-annotation",x0e={"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0},S0e="meta",T0e="Format vocabulary meta-schema for annotation results",$0e=["object","boolean"],k0e={format:{type:"string"}},P0e={$schema:E0e,$id:A0e,$vocabulary:x0e,$dynamicAnchor:S0e,title:T0e,type:$0e,properties:k0e},I0e="https://json-schema.org/draft/2020-12/schema",O0e="https://json-schema.org/draft/2020-12/meta/meta-data",C0e={"https://json-schema.org/draft/2020-12/vocab/meta-data":!0},R0e="meta",D0e="Meta-data vocabulary meta-schema",M0e=["object","boolean"],B0e={title:{type:"string"},description:{type:"string"},default:!0,deprecated:{type:"boolean",default:!1},readOnly:{type:"boolean",default:!1},writeOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0}},j0e={$schema:I0e,$id:O0e,$vocabulary:C0e,$dynamicAnchor:R0e,title:D0e,type:M0e,properties:B0e},N0e="https://json-schema.org/draft/2020-12/schema",U0e="https://json-schema.org/draft/2020-12/meta/validation",L0e={"https://json-schema.org/draft/2020-12/vocab/validation":!0},K0e="meta",z0e="Validation vocabulary meta-schema",F0e=["object","boolean"],q0e={type:{anyOf:[{$ref:"#/$defs/simpleTypes"},{type:"array",items:{$ref:"#/$defs/simpleTypes"},minItems:1,uniqueItems:!0}]},const:!0,enum:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/$defs/nonNegativeInteger"},minLength:{$ref:"#/$defs/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},maxItems:{$ref:"#/$defs/nonNegativeInteger"},minItems:{$ref:"#/$defs/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},maxContains:{$ref:"#/$defs/nonNegativeInteger"},minContains:{$ref:"#/$defs/nonNegativeInteger",default:1},maxProperties:{$ref:"#/$defs/nonNegativeInteger"},minProperties:{$ref:"#/$defs/nonNegativeIntegerDefault0"},required:{$ref:"#/$defs/stringArray"},dependentRequired:{type:"object",additionalProperties:{$ref:"#/$defs/stringArray"}}},V0e={nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{$ref:"#/$defs/nonNegativeInteger",default:0},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},W0e={$schema:N0e,$id:U0e,$vocabulary:L0e,$dynamicAnchor:K0e,title:z0e,type:F0e,properties:q0e,$defs:V0e};Object.defineProperty(JR,"__esModule",{value:!0});const H0e=Kve,G0e=Zve,Y0e=i0e,Z0e=f0e,J0e=_0e,X0e=P0e,Q0e=j0e,ebe=W0e,tbe=["/properties"];function rbe(r){return[H0e,G0e,Y0e,Z0e,J0e,e(this,X0e),Q0e,e(this,ebe)].forEach(t=>this.addMetaSchema(t,void 0,!1)),this;function e(t,n){return r?t.$dataMetaSchema(n,tbe):n}}JR.default=rbe;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const t=Z7,n=dR,i=ZR,o=JR,s="https://json-schema.org/draft/2020-12/schema";class a extends t.default{constructor(h={}){super({...h,dynamicRef:!0,next:!0,unevaluated:!0})}_addVocabularies(){super._addVocabularies(),n.default.forEach(h=>this.addVocabulary(h)),this.opts.discriminator&&this.addKeyword(i.default)}_addDefaultMetaSchema(){super._addDefaultMetaSchema();const{$data:h,meta:p}=this.opts;p&&(o.default.call(this,h),this.refs["http://json-schema.org/schema"]=s)}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(s)?s:void 0)}}r.exports=e=a,Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var l=qc;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var d=zt;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var c=Y_;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return c.default}});var u=Z_;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return u.default}})})(EI,EI.exports);var nbe=EI.exports;const Rq=Vu(nbe);var sj=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class X_{static authorizeConfigure(e){return sj(this,void 0,void 0,function*(){const{protocolsConfigureMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}=e;yield oc.performBaseValidation({incomingMessage:t,expectedGrantor:n,expectedGrantee:i,permissionGrant:o,messageStore:s}),X_.verifyScope(t,o.scope)})}static authorizeQuery(e){var t;return sj(this,void 0,void 0,function*(){const{expectedGrantee:n,expectedGrantor:i,incomingMessage:o,permissionGrant:s,messageStore:a}=e;yield oc.performBaseValidation({incomingMessage:o,expectedGrantor:i,expectedGrantee:n,permissionGrant:s,messageStore:a});const d=s.scope.protocol,c=(t=o.descriptor.filter)===null||t===void 0?void 0:t.protocol;if(d!==void 0&&c!==d)throw new Ae(we.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch,`Grant protocol scope ${d} does not match protocol in message ${c}`)})}static verifyScope(e,t){if(t.protocol!==void 0&&t.protocol!==e.descriptor.definition.protocol)throw new Ae(we.ProtocolsGrantAuthorizationScopeProtocolMismatch,"Grant scope specifies different protocol than what appears in the configure message.")}}var hy;(function(r){r.Anyone="anyone",r.Author="author",r.Recipient="recipient"})(hy||(hy={}));var ei;(function(r){r.CoDelete="co-delete",r.CoPrune="co-prune",r.CoUpdate="co-update",r.Create="create",r.Delete="delete",r.Prune="prune",r.Query="query",r.Read="read",r.Subscribe="subscribe",r.Update="update"})(ei||(ei={}));var k$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},ibe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class ea extends Gu{static parse(e){return k$(this,void 0,void 0,function*(){return Oe.validateJsonSchema(e),ea.validateProtocolDefinition(e.descriptor.definition),yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor),pn.validateTimestamp(e.descriptor.messageTimestamp),new ea(e)})}static create(e){var t;return k$(this,void 0,void 0,function*(){const n={interface:Ge.Protocols,method:Le.Configure,messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:pn.getCurrentTimestamp(),definition:ea.normalizeDefinition(e.definition)},i=yield Oe.createAuthorization({descriptor:n,signer:e.signer,delegatedGrant:e.delegatedGrant,permissionGrantId:e.permissionGrantId}),o={descriptor:n,authorization:i};return Oe.validateJsonSchema(o),ea.validateProtocolDefinition(o.descriptor.definition),new ea(o)})}authorizeAuthorDelegate(e){return k$(this,void 0,void 0,function*(){const t=yield Rs.parse(this.message.authorization.authorDelegatedGrant);yield X_.authorizeConfigure({protocolsConfigureMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:t,messageStore:e})})}static validateProtocolDefinition(e){const{protocol:t,types:n}=e;Kh(t);for(const i in n){const o=n[i].schema;o!==void 0&&dS(o)}ea.validateStructure(e)}static validateStructure(e){const t=Object.keys(e.types),n=ea.fetchAllRolePathsRecursively("",e.structure,[]);ea.validateRuleSetRecursively({ruleSet:e.structure,ruleSetProtocolPath:"",recordTypes:t,roles:n})}static fetchAllRolePathsRecursively(e,t,n){if(e.split("/").length>10)throw new Ae(we.ProtocolsConfigureRecordNestingDepthExceeded,"Record nesting depth exceeded 10 levels.");for(const i in t){if(i.startsWith("$"))continue;const o=t[i];let s;e===""?s=i:s=`${e}/${i}`,o.$role?n.push(s):ea.fetchAllRolePathsRecursively(s,o,n)}return n}static validateRuleSetRecursively(e){var t;const{ruleSet:n,ruleSetProtocolPath:i,recordTypes:o,roles:s}=e;if(n.$size!==void 0){const{min:l=0,max:d}=n.$size;if(d!==void 0&&d<l)throw new Ae(we.ProtocolsConfigureInvalidSize,`Invalid size range found: max limit ${d} less than min limit ${l} at protocol path '${i}'`)}if(n.$tags){const l=new Rq.default,d=n.$tags,c=ibe(d,["$allowUndefinedTags","$requiredTags"]);for(const u in c){const f=c[u];if(!l.validateSchema(f)){const h=l.errorsText(l.errors,{dataVar:`${i}/$tags/${u}`});throw new Ae(we.ProtocolsConfigureInvalidTagSchema,`tags schema validation error: ${h}`)}}}const a=(t=n.$actions)!==null&&t!==void 0?t:[];for(let l=0;l<a.length;l++){const d=a[l];if(d.role!==void 0&&!s.includes(d.role))throw new Ae(we.ProtocolsConfigureRoleDoesNotExistAtGivenPath,`Role in action ${JSON.stringify(d)} for rule set ${i} does not exist.`);if(d.who==="anyone"&&d.of)throw new Ae(we.ProtocolsConfigureInvalidActionOfNotAllowed,`'of' is not allowed at rule set protocol path (${i})`);if(d.who===hy.Recipient&&d.of===void 0&&d.can.some(u=>![ei.CoUpdate,ei.CoDelete,ei.CoPrune].includes(u)))throw new Ae(we.ProtocolsConfigureInvalidRecipientOfAction,"Rules for `recipient` without `of` property must have `can` containing only `co-update`, `co-delete`, and `co-prune`.");if(d.who===hy.Author&&!d.of)throw new Ae(we.ProtocolsConfigureInvalidActionMissingOf,"'of' is required when 'author' is specified as 'who'");if(d.can!==void 0){if(d.can.includes(ei.Update)&&!d.can.includes(ei.Create))throw new Ae(we.ProtocolsConfigureInvalidActionUpdateWithoutCreate,`Action rule ${JSON.stringify(d)} contains 'update' action but missing the required 'create' action.`);if(d.can.includes(ei.Delete)&&!d.can.includes(ei.Create))throw new Ae(we.ProtocolsConfigureInvalidActionDeleteWithoutCreate,`Action rule ${JSON.stringify(d)} contains 'delete' action but missing the required 'create' action.`)}for(let c=l+1;c<a.length;c++){const u=a[c];if(d.who!==void 0){if(d.who===u.who&&d.of===u.of)throw new Ae(we.ProtocolsConfigureDuplicateActorInRuleSet,`More than one action rule per actor ${d.who} of ${d.of} not allowed within a rule set: ${JSON.stringify(d)}`)}else if(d.role===u.role)throw new Ae(we.ProtocolsConfigureDuplicateRoleInRuleSet,`More than one action rule per role ${d.role} not allowed within a rule set: ${JSON.stringify(d)}`)}}for(const l in n){if(l.startsWith("$"))continue;if(!o.includes(l))throw new Ae(we.ProtocolsConfigureInvalidRuleSetRecordType,`Rule set ${l} is not declared as an allowed type in the protocol definition.`);const d=n[l];let c;i===""?c=l:c=`${i}/${l}`,ea.validateRuleSetRecursively({ruleSet:d,ruleSetProtocolPath:c,recordTypes:o,roles:s})}}static normalizeDefinition(e){const t=Object.assign({},e.types);for(const n in t){const i=t[n].schema;i!==void 0&&(t[n].schema=uS(i))}return Object.assign(Object.assign({},e),{protocol:Ph(e.protocol),types:t})}}var aj=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},obe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class KA{constructor(e,t,n,i){this.didResolver=e,this.messageStore=t,this.eventLog=n,this.eventStream=i}handle({tenant:e,message:t}){return aj(this,void 0,void 0,function*(){let n;try{n=yield ea.parse(t)}catch(c){return Dr(c,400)}try{yield yd(t.authorization,this.didResolver),yield KA.authorizeProtocolsConfigure(e,n,this.messageStore)}catch(c){return Dr(c,401)}const i={interface:Ge.Protocols,method:Le.Configure,protocol:t.descriptor.definition.protocol},{messages:o}=yield this.messageStore.query(e,[i]);let s=yield Oe.getNewestMessage(o),a=!1;(s===void 0||(yield Oe.isNewer(t,s)))&&(a=!0,s=t);let l;if(a){const c=KA.constructIndexes(n);yield this.messageStore.put(e,t,c);const u=yield Oe.getCid(t);yield this.eventLog.append(e,u,c),this.eventStream!==void 0&&this.eventStream.emit(e,{message:t},c),l={status:{code:202,detail:"Accepted"}}}else l={status:{code:409,detail:"Conflict"}};const d=[];for(const c of o)if(yield Oe.isNewer(s,c)){const u=yield Oe.getCid(c);d.push(u),yield this.messageStore.delete(e,u)}return yield this.eventLog.deleteEventsByCid(e,d),l})}static constructIndexes(e){const t=e.message.descriptor,{definition:n}=t,i=obe(t,["definition"]),{author:o}=e;return Object.assign(Object.assign({},i),{author:o,protocol:n.protocol,published:n.published})}static authorizeProtocolsConfigure(e,t,n){return aj(this,void 0,void 0,function*(){if(t.isSignedByAuthorDelegate&&(yield t.authorizeAuthorDelegate(n)),t.author!==e)if(t.author!==void 0&&t.signaturePayload.permissionGrantId!==void 0){const i=yield et.fetchGrant(e,n,t.signaturePayload.permissionGrantId);yield X_.authorizeConfigure({protocolsConfigureMessage:t.message,expectedGrantor:e,expectedGrantee:t.author,permissionGrant:i,messageStore:n})}else throw new Ae(we.ProtocolsConfigureAuthorizationFailed,"message failed authorization")})}}var P$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class vg extends Gu{static parse(e){return P$(this,void 0,void 0,function*(){return e.authorization!==void 0&&(yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor)),e.descriptor.filter!==void 0&&Kh(e.descriptor.filter.protocol),pn.validateTimestamp(e.descriptor.messageTimestamp),new vg(e)})}static create(e){var t;return P$(this,void 0,void 0,function*(){const n={interface:Ge.Protocols,method:Le.Query,messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:pn.getCurrentTimestamp(),filter:e.filter?vg.normalizeFilter(e.filter):void 0};Cs(n);let i;e.signer!==void 0&&(i=yield Oe.createAuthorization({descriptor:n,signer:e.signer,permissionGrantId:e.permissionGrantId}));const o={descriptor:n,authorization:i};return Oe.validateJsonSchema(o),new vg(o)})}static normalizeFilter(e){return Object.assign(Object.assign({},e),{protocol:Ph(e.protocol)})}authorize(e,t){return P$(this,void 0,void 0,function*(){if(this.author!==e)if(this.author!==void 0&&this.signaturePayload.permissionGrantId){const n=yield et.fetchGrant(e,t,this.signaturePayload.permissionGrantId);yield X_.authorizeQuery({expectedGrantor:e,expectedGrantee:this.author,incomingMessage:this.message,permissionGrant:n,messageStore:t})}else throw new Ae(we.ProtocolsQueryUnauthorized,"The ProtocolsQuery failed authorization")})}}var cj=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class sbe{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.dataStore=n}handle({tenant:e,message:t}){return cj(this,void 0,void 0,function*(){let n;try{n=yield vg.parse(t)}catch(s){return Dr(s,400)}try{yield yd(t.authorization,this.didResolver),yield n.authorize(e,this.messageStore)}catch(s){if(s.code===we.AuthenticateJwsMissing||s.code===we.ProtocolsQueryUnauthorized||s.code===we.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch){const a=yield this.fetchPublishedProtocolsConfigure(e,n);return{status:{code:200,detail:"OK"},entries:a}}else return Dr(s,401)}const i=Object.assign(Object.assign({},t.descriptor.filter),{interface:Ge.Protocols,method:Le.Configure});Cs(i);const{messages:o}=yield this.messageStore.query(e,[i]);return{status:{code:200,detail:"OK"},entries:o}})}fetchPublishedProtocolsConfigure(e,t){return cj(this,void 0,void 0,function*(){const n=Object.assign(Object.assign({},t.message.descriptor.filter),{interface:Ge.Protocols,method:Le.Configure,published:!0}),{messages:i}=yield this.messageStore.query(e,[n]);return i})}}var Es=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},abe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Lt{static validateReferentialIntegrity(e,t,n){return Es(this,void 0,void 0,function*(){const i=yield Lt.fetchProtocolDefinition(e,t.message.descriptor.protocol,n);Lt.verifyType(t.message,i.types),yield Lt.verifyProtocolPathAndContextId(e,t,n);const o=Lt.getRuleSet(t.message.descriptor.protocolPath,i);yield Lt.verifyAsRoleRecordIfNeeded(e,t,o,n),Lt.verifySizeLimit(t,o),Lt.verifyTagsIfNeeded(t,o)})}static authorizeWrite(e,t,n){return Es(this,void 0,void 0,function*(){const i=yield Lt.fetchInitialWrite(e,t.message.recordId,n);let o;i===void 0?o=yield Lt.constructRecordChain(e,t.message.descriptor.parentId,n):o=yield Lt.constructRecordChain(e,t.message.recordId,n);const s=yield Lt.fetchProtocolDefinition(e,t.message.descriptor.protocol,n),a=Lt.getRuleSet(t.message.descriptor.protocolPath,s);yield Lt.verifyInvokedRole(e,t,t.message.descriptor.protocol,t.message.contextId,s,n),yield Lt.authorizeAgainstAllowedActions(e,t,a,o,n)})}static authorizeRead(e,t,n,i){return Es(this,void 0,void 0,function*(){const o=yield Lt.constructRecordChain(e,n.message.recordId,i),s=yield Lt.fetchProtocolDefinition(e,n.message.descriptor.protocol,i),a=Lt.getRuleSet(n.message.descriptor.protocolPath,s);yield Lt.verifyInvokedRole(e,t,n.message.descriptor.protocol,n.message.contextId,s,i),yield Lt.authorizeAgainstAllowedActions(e,t,a,o,i)})}static authorizeQueryOrSubscribe(e,t,n){return Es(this,void 0,void 0,function*(){const{protocol:i,protocolPath:o,contextId:s}=t.message.descriptor.filter,a=yield Lt.fetchProtocolDefinition(e,i,n),l=Lt.getRuleSet(o,a);yield Lt.verifyInvokedRole(e,t,i,s,a,n),yield Lt.authorizeAgainstAllowedActions(e,t,l,[],n)})}static authorizeDelete(e,t,n,i){return Es(this,void 0,void 0,function*(){const o=yield Lt.constructRecordChain(e,t.message.descriptor.recordId,i),s=yield Lt.fetchProtocolDefinition(e,n.message.descriptor.protocol,i),a=Lt.getRuleSet(n.message.descriptor.protocolPath,s);yield Lt.verifyInvokedRole(e,t,n.message.descriptor.protocol,n.message.contextId,s,i),yield Lt.authorizeAgainstAllowedActions(e,t,a,o,i)})}static fetchProtocolDefinition(e,t,n){return Es(this,void 0,void 0,function*(){if(t===et.uri)return et.definition;const i={interface:Ge.Protocols,method:Le.Configure,protocol:t},{messages:o}=yield n.query(e,[i]);if(o.length===0)throw new Ae(we.ProtocolAuthorizationProtocolNotFound,`unable to find protocol definition for ${t}`);return o[0].descriptor.definition})}static constructRecordChain(e,t,n){return Es(this,void 0,void 0,function*(){if(t===void 0)return[];const i=[];let o=t;for(;o!==void 0;){const s=yield Lt.fetchInitialWrite(e,o,n);if(s===void 0)throw new Ae(we.ProtocolAuthorizationParentNotFoundConstructingRecordChain,`Unexpected error that should never trigger: no parent found with ID ${o} when constructing record chain.`);i.push(s),o=s.descriptor.parentId}return i.reverse()})}static fetchInitialWrite(e,t,n){return Es(this,void 0,void 0,function*(){const i={interface:Ge.Records,method:Le.Write,recordId:t},{messages:o}=yield n.query(e,[i]);return o.length===0?void 0:yield Gt.getInitialWrite(o)})}static getRuleSet(e,t){const n=Lt.getRuleSetAtProtocolPath(e,t);if(n===void 0)throw new Ae(we.ProtocolAuthorizationMissingRuleSet,`No rule set defined for protocolPath ${e}`);return n}static verifyProtocolPathAndContextId(e,t,n){var i;return Es(this,void 0,void 0,function*(){const o=t.message.descriptor.protocolPath,s=Lt.getTypeName(o),a=t.message.descriptor.parentId;if(a===void 0){if(o!==s)throw new Ae(we.ProtocolAuthorizationParentlessIncorrectProtocolPath,`Declared protocol path '${o}' is not valid for records with no parent'.`);return}const l=t.message.descriptor.protocol,d={isLatestBaseState:!0,interface:Ge.Records,method:Le.Write,protocol:l,recordId:a},{messages:c}=yield n.query(e,[d]),u=c[0];if(`${(i=u?.descriptor)===null||i===void 0?void 0:i.protocolPath}/${s}`!==o)throw new Ae(we.ProtocolAuthorizationIncorrectProtocolPath,`Could not find matching parent record to verify declared protocol path '${o}'.`);const p=`${u.contextId}/${t.message.recordId}`,y=t.message.contextId;if(y!==p)throw new Ae(we.ProtocolAuthorizationIncorrectContextId,`Declared contextId '${y}' is not the same as expected: '${p}'.`)})}static verifyType(e,t){const n=Object.keys(t),i=e.descriptor.protocolPath,o=Lt.getTypeName(i);if(!n.includes(o))throw new Ae(we.ProtocolAuthorizationInvalidType,`record with type ${o} not allowed in protocol`);const s=e.descriptor.protocolPath,a=Lt.getTypeName(s),l=t[a],{schema:d}=e.descriptor;if(l.schema!==void 0&&l.schema!==d)throw new Ae(we.ProtocolAuthorizationInvalidSchema,`type '${a}' must have schema '${l.schema}',         instead has '${d}'`);const{dataFormat:c}=e.descriptor;if(l.dataFormats!==void 0&&!l.dataFormats.includes(c))throw new Ae(we.ProtocolAuthorizationIncorrectDataFormat,`type '${a}' must have data format in (${l.dataFormats}),         instead has '${c}'`)}static verifyInvokedRole(e,t,n,i,o,s){var a;return Es(this,void 0,void 0,function*(){const l=(a=t.signaturePayload)===null||a===void 0?void 0:a.protocolRole;if(l===void 0)return;const d=Lt.getRuleSetAtProtocolPath(l,o);if(d===void 0||!d.$role)throw new Ae(we.ProtocolAuthorizationNotARole,`Protocol path ${l} does not match role record type.`);const c={interface:Ge.Records,method:Le.Write,protocol:n,protocolPath:l,recipient:t.author,isLatestBaseState:!0},u=l.split("/").length-1;if(i===void 0&&u>0)throw new Ae(we.ProtocolAuthorizationMissingContextId,"Could not verify role because contextId is missing.");if(u>0){const p=i.split("/").slice(0,u).join("/"),y=Wo.constructPrefixFilterAsRangeFilter(p);c.contextId=y}const{messages:f}=yield s.query(e,[c]);if(f.length===0)throw new Ae(we.ProtocolAuthorizationMatchingRoleRecordNotFound,`No matching role record found for protocol path ${l}`)})}static getActionsSeekingARuleMatch(e,t,n){return Es(this,void 0,void 0,function*(){switch(t.message.descriptor.method){case Le.Delete:const i=t,o=i.message.descriptor.recordId,s=yield Gt.fetchInitialRecordsWrite(n,e,o);if(s===void 0)return[];const a=[];return i.message.descriptor.prune?(a.push(ei.CoPrune),t.author===s.author&&a.push(ei.Prune)):(a.push(ei.CoDelete),t.author===s.author&&a.push(ei.Delete)),a;case Le.Query:return[ei.Query];case Le.Read:return[ei.Read];case Le.Subscribe:return[ei.Subscribe];case Le.Write:if(yield t.isInitialWrite())return[ei.Create];{const c=t.message.recordId,u=yield Gt.fetchInitialRecordsWrite(n,e,c);return u===void 0?[]:t.author===u.author?[ei.CoUpdate,ei.Update]:[ei.CoUpdate]}}return[]})}static authorizeAgainstAllowedActions(e,t,n,i,o){var s;return Es(this,void 0,void 0,function*(){const a=t.message.descriptor.method,l=yield Lt.getActionsSeekingARuleMatch(e,t,o),d=t.author,c=n.$actions;if(c===void 0)throw new Ae(we.ProtocolAuthorizationActionRulesNotFound,`no action rule defined for Records${a}, ${d} is unauthorized`);const u=(s=t.signaturePayload)===null||s===void 0?void 0:s.protocolRole;for(const f of c){if(!f.can.some(y=>l.includes(y)))continue;if(f.who===hy.Anyone)return;if(d===void 0)continue;if(u!==void 0){if(f.role===u)return;continue}if(f.who===hy.Recipient&&f.of===void 0){let y;if(t.message.descriptor.method===Le.Write?y=t.message:y=i[i.length-1],y.descriptor.recipient===d)return;continue}if(yield Lt.checkActor(d,f,i))return}throw new Ae(we.ProtocolAuthorizationActionNotAllowed,`Inbound message action Records${a} by author ${t.author} not allowed.`)})}static verifySizeLimit(e,t){const{min:n=0,max:i}=t.$size||{},o=e.message.descriptor.dataSize;if(o<n)throw new Ae(we.ProtocolAuthorizationMinSizeInvalid,`data size ${o} is less than allowed ${n}`);if(i!==void 0&&o>i)throw new Ae(we.ProtocolAuthorizationMaxSizeInvalid,`data size ${o} is more than allowed ${i}`)}static verifyTagsIfNeeded(e,t){if(t.$tags!==void 0){const{tags:n={},protocol:i,protocolPath:o}=e.message.descriptor,s=t.$tags,{$allowUndefinedTags:a,$requiredTags:l}=s,d=abe(s,["$allowUndefinedTags","$requiredTags"]),c=a||!1,u=l||[],f=new Rq.default,h=f.compile({type:"object",properties:d,required:u,additionalProperties:c});if(!h(n)){const y=f.errorsText(h.errors,{dataVar:`${i}/${o}/$tags`});throw new Ae(we.ProtocolAuthorizationTagsInvalidSchema,`tags schema validation error: ${y}`)}}}static verifyAsRoleRecordIfNeeded(e,t,n,i){return Es(this,void 0,void 0,function*(){if(!n.$role)return;const o=t,s=o.message.descriptor.recipient;if(s===void 0)throw new Ae(we.ProtocolAuthorizationRoleMissingRecipient,"Role records must have a recipient");const a=o.message.descriptor.protocolPath,l={interface:Ge.Records,method:Le.Write,isLatestBaseState:!0,protocol:o.message.descriptor.protocol,protocolPath:a,recipient:s},d=_t.getParentContextFromOfContextId(o.message.contextId);if(d!==""){const h=Wo.constructPrefixFilterAsRangeFilter(d);l.contextId=h}const{messages:c}=yield i.query(e,[l]);if(c.filter(h=>h.recordId!==o.message.recordId).length>0)throw new Ae(we.ProtocolAuthorizationDuplicateRoleRecipient,`DID '${s}' is already recipient of a role record at protocol path '${a} under the parent context ${d}.`)})}static getRuleSetAtProtocolPath(e,t){const n=e.split("/");let i=t.structure,o=0;for(;o<n.length;){const s=n[o],a=i[s];if(a===void 0)return;i=a,o++}return i}static checkActor(e,t,n){return Es(this,void 0,void 0,function*(){const i=n.find(o=>o.descriptor.protocolPath===t.of);if(i===void 0)return!1;if(t.who===hy.Recipient)return e===i.descriptor.recipient;{const o=(yield Gt.parse(i)).author;return e===o}})}static getTypeName(e){return e.split("/").slice(-1)[0]}}var I$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Qg extends Gu{static parse(e){return I$(this,void 0,void 0,function*(){let t;return e.authorization!==void 0&&(t=yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield _t.validateDelegatedGrantReferentialIntegrity(e,t),pn.validateTimestamp(e.descriptor.messageTimestamp),new Qg(e)})}static create(e){var t,n;return I$(this,void 0,void 0,function*(){const i=e.recordId,o=pn.getCurrentTimestamp(),s={interface:Ge.Records,method:Le.Delete,messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:o,recordId:i,prune:(n=e.prune)!==null&&n!==void 0?n:!1},a=yield Oe.createAuthorization({descriptor:s,signer:e.signer,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}),l={descriptor:s,authorization:a};return Oe.validateJsonSchema(l),new Qg(l)})}constructIndexes(e){const t=this.message,n=Object.assign({},t.descriptor),{protocol:i,protocolPath:o,recipient:s,schema:a,parentId:l,dateCreated:d}=e.descriptor,c=Object.assign({protocol:i,protocolPath:o,recipient:s,schema:a,parentId:l,dateCreated:d,contextId:e.contextId,author:this.author},n);return Cs(c),c}authorizeDelegate(e,t){return I$(this,void 0,void 0,function*(){const n=yield Rs.parse(this.message.authorization.authorDelegatedGrant);yield sc.authorizeDelete({recordsDeleteMessage:this.message,recordsWriteToDelete:e,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:n,messageStore:t})})}}var Am=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},zA;(function(r){r.RecordsDelete="RecordsDelete"})(zA||(zA={}));class Yp{constructor(e,t){this.resumableTaskStore=e,this.resumableTaskBatchSize=100,this.resumableTaskHandlers={[zA.RecordsDelete]:n=>Am(this,void 0,void 0,function*(){return yield t.performRecordsDelete(n)})}}run(e){return Am(this,void 0,void 0,function*(){const t=Yp.timeoutExtensionFrequencyInSeconds*2,n=yield this.resumableTaskStore.register(e,t);yield this.runWithAutomaticTimeoutExtension(n)})}runWithAutomaticTimeoutExtension(e){return Am(this,void 0,void 0,function*(){const t=Yp.timeoutExtensionFrequencyInSeconds*2;let n;try{n=setInterval(()=>{this.resumableTaskStore.extend(e.id,t)},Yp.timeoutExtensionFrequencyInSeconds*1e3);const i=this.resumableTaskHandlers[e.task.name];yield i(e.task.data),yield this.resumableTaskStore.delete(e.id)}finally{Yp.clearTimeoutExtensionTimer(n)}})}static clearTimeoutExtensionTimer(e){clearInterval(e)}resumeTasksAndWaitForCompletion(){return Am(this,void 0,void 0,function*(){for(;;){const e=yield this.resumableTaskStore.grab(this.resumableTaskBatchSize);if(e===void 0||e.length===0)break;yield this.retryTasksUntilCompletion(e)}})}retryTasksUntilCompletion(e){return Am(this,void 0,void 0,function*(){let t=e;for(;t.length>0;){const n=t;t=[];const i=n.map(o=>Am(this,void 0,void 0,function*(){try{yield this.runWithAutomaticTimeoutExtension(o)}catch(s){console.error("Error while running resumable task:",s),console.error("Resumable task:",e),t.push(o)}}));yield Promise.all(i)}})}}Yp.timeoutExtensionFrequencyInSeconds=30;var lj=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class XR{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.resumableTaskManager=n}handle({tenant:e,message:t}){return lj(this,void 0,void 0,function*(){let n;try{n=yield Qg.parse(t)}catch(d){return Dr(d,400)}try{yield yd(t.authorization,this.didResolver)}catch(d){return Dr(d,401)}const i={interface:Ge.Records,recordId:t.descriptor.recordId},{messages:o}=yield this.messageStore.query(e,[i]),s=yield Oe.getNewestMessage(o);if(!_t.canPerformDeleteAgainstRecord(t,s))return{status:{code:404,detail:"Not Found"}};if(!(yield Oe.isNewer(t,s)))return{status:{code:409,detail:"Conflict"}};try{const d=yield Gt.fetchInitialRecordsWrite(this.messageStore,e,t.descriptor.recordId);yield XR.authorizeRecordsDelete(e,n,d,this.messageStore)}catch(d){return Dr(d,401)}return yield this.resumableTaskManager.run({name:zA.RecordsDelete,data:{tenant:e,message:t}}),{status:{code:202,detail:"Accepted"}}})}static authorizeRecordsDelete(e,t,n,i){return lj(this,void 0,void 0,function*(){if(Oe.isSignedByAuthorDelegate(t.message)&&(yield t.authorizeDelegate(n.message,i)),t.author!==e)if(n.message.descriptor.protocol!==void 0)yield Lt.authorizeDelete(e,t,n,i);else throw new Ae(we.RecordsDeleteAuthorizationFailed,"RecordsDelete message failed authorization")})}}var ya;(function(r){r[r.Descending=-1]="Descending",r[r.Ascending=1]="Ascending"})(ya||(ya={}));var _0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class qf{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.dataStore=n}handle({tenant:e,message:t}){return _0(this,void 0,void 0,function*(){let n;try{n=yield Dw.parse(t)}catch(s){return Dr(s,400)}let i,o;if(_t.filterIncludesPublishedRecords(n.message.descriptor.filter)&&n.author===void 0){const s=yield this.fetchPublishedRecords(e,n);i=s.messages,o=s.cursor}else{try{yield yd(t.authorization,this.didResolver),yield qf.authorizeRecordsQuery(e,n,this.messageStore)}catch(s){return Dr(s,401)}if(n.author===e){const s=yield this.fetchRecordsAsOwner(e,n);i=s.messages,o=s.cursor}else{const s=yield this.fetchRecordsAsNonOwner(e,n);i=s.messages,o=s.cursor}}for(const s of i)if(!(yield Gt.isInitialWrite(s))){const l=(yield this.messageStore.query(e,[{recordId:s.recordId,isLatestBaseState:!1,method:Le.Write}])).messages[0];delete l.encodedData,s.initialWrite=l}return{status:{code:200,detail:"OK"},entries:i,cursor:o}})}convertDateSort(e){switch(e){case Os.CreatedAscending:return{dateCreated:ya.Ascending};case Os.CreatedDescending:return{dateCreated:ya.Descending};case Os.PublishedAscending:return{datePublished:ya.Ascending};case Os.PublishedDescending:return{datePublished:ya.Descending};default:return{dateCreated:ya.Ascending}}}fetchRecordsAsOwner(e,t){return _0(this,void 0,void 0,function*(){const{dateSort:n,filter:i,pagination:o}=t.message.descriptor,s=Object.assign(Object.assign({},_t.convertFilter(i,n)),{interface:Ge.Records,method:Le.Write,isLatestBaseState:!0}),a=this.convertDateSort(n);return this.messageStore.query(e,[s],a,o)})}fetchRecordsAsNonOwner(e,t){return _0(this,void 0,void 0,function*(){const{dateSort:n,pagination:i,filter:o}=t.message.descriptor,s=[];_t.filterIncludesPublishedRecords(o)&&s.push(qf.buildPublishedRecordsFilter(t)),_t.filterIncludesUnpublishedRecords(o)&&(_t.shouldBuildUnpublishedAuthorFilter(o,t.author)&&s.push(qf.buildUnpublishedRecordsByQueryAuthorFilter(t)),_t.shouldProtocolAuthorize(t.signaturePayload)&&s.push(qf.buildUnpublishedProtocolAuthorizedRecordsFilter(t)),_t.shouldBuildUnpublishedRecipientFilter(o,t.author)&&s.push(qf.buildUnpublishedRecordsForQueryAuthorFilter(t)));const a=this.convertDateSort(n);return this.messageStore.query(e,s,a,i)})}fetchPublishedRecords(e,t){return _0(this,void 0,void 0,function*(){const{dateSort:n,pagination:i}=t.message.descriptor,o=qf.buildPublishedRecordsFilter(t),s=this.convertDateSort(n);return this.messageStore.query(e,[o],s,i)})}static buildPublishedRecordsFilter(e){const{dateSort:t,filter:n}=e.message.descriptor;return Object.assign(Object.assign({},_t.convertFilter(n,t)),{interface:Ge.Records,method:Le.Write,published:!0,isLatestBaseState:!0})}static buildUnpublishedRecordsForQueryAuthorFilter(e){const{dateSort:t,filter:n}=e.message.descriptor;return Object.assign(Object.assign({},_t.convertFilter(n,t)),{interface:Ge.Records,method:Le.Write,recipient:e.author,isLatestBaseState:!0,published:!1})}static buildUnpublishedProtocolAuthorizedRecordsFilter(e){const{dateSort:t,filter:n}=e.message.descriptor;return Object.assign(Object.assign({},_t.convertFilter(n,t)),{interface:Ge.Records,method:Le.Write,isLatestBaseState:!0,published:!1})}static buildUnpublishedRecordsByQueryAuthorFilter(e){const{dateSort:t,filter:n}=e.message.descriptor;return Object.assign(Object.assign({},_t.convertFilter(n,t)),{author:e.author,interface:Ge.Records,method:Le.Write,isLatestBaseState:!0,published:!1})}static authorizeRecordsQuery(e,t,n){return _0(this,void 0,void 0,function*(){Oe.isSignedByAuthorDelegate(t.message)&&(yield t.authorizeDelegate(n)),_t.shouldProtocolAuthorize(t.signaturePayload)&&(yield Lt.authorizeQueryOrSubscribe(e,t,n))})}}var O$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Nw extends Gu{static parse(e){return O$(this,void 0,void 0,function*(){let t;return e.authorization!==void 0&&(t=yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield _t.validateDelegatedGrantReferentialIntegrity(e,t),pn.validateTimestamp(e.descriptor.messageTimestamp),new Nw(e)})}static create(e){var t;return O$(this,void 0,void 0,function*(){const{filter:n,signer:i,permissionGrantId:o,protocolRole:s}=e,a=pn.getCurrentTimestamp(),l={interface:Ge.Records,method:Le.Read,filter:_t.normalizeFilter(n),messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:a};Cs(l);let d;i!==void 0&&(d=yield Oe.createAuthorization({descriptor:l,signer:i,permissionGrantId:o,protocolRole:s,delegatedGrant:e.delegatedGrant}));const c={descriptor:l,authorization:d};return Oe.validateJsonSchema(c),new Nw(c)})}authorizeDelegate(e,t){return O$(this,void 0,void 0,function*(){const n=yield Rs.parse(this.message.authorization.authorDelegatedGrant);yield sc.authorizeRead({recordsReadMessage:this.message,recordsWriteMessageToBeRead:e,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:n,messageStore:t})})}}var dj=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class QR{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.dataStore=n}handle({tenant:e,message:t}){return dj(this,void 0,void 0,function*(){let n;try{n=yield Nw.parse(t)}catch(c){return Dr(c,400)}try{n.author!==void 0&&(yield yd(t.authorization,this.didResolver))}catch(c){return Dr(c,401)}const i=Object.assign({interface:Ge.Records,isLatestBaseState:!0},_t.convertFilter(t.descriptor.filter)),{messages:o}=yield this.messageStore.query(e,[i]);if(o.length===0)return{status:{code:404,detail:"Not Found"}};if(o.length>1)return Dr(new Ae(we.RecordsReadReturnedMultiple,"Multiple records exist for the RecordsRead filter"),400);const s=o[0];try{yield QR.authorizeRecordsRead(e,n,yield Gt.parse(s),this.messageStore)}catch(c){return Dr(c,401)}let a;if(s.encodedData!==void 0){const c=vt.base64UrlToBytes(s.encodedData);a=hh.fromBytes(c),delete s.encodedData}else{const c=yield this.dataStore.get(e,s.recordId,s.descriptor.dataCid);if(c?.dataStream===void 0)return{status:{code:404,detail:"Not Found"}};a=c.dataStream}const l=Object.assign(Object.assign({},s),{data:a});if(!(yield Gt.isInitialWrite(l))){const u=(yield this.messageStore.query(e,[{recordId:l.recordId,isLatestBaseState:!1,method:Le.Write}])).messages[0];delete u.encodedData,l.initialWrite=u}return{status:{code:200,detail:"OK"},record:l}})}static authorizeRecordsRead(e,t,n,i){return dj(this,void 0,void 0,function*(){Oe.isSignedByAuthorDelegate(t.message)&&(yield t.authorizeDelegate(n.message,i));const{descriptor:o}=n.message;if(t.author!==e){if(o.published===!0)return;if(t.author!==void 0&&t.author===o.recipient)return;if(t.author!==void 0&&t.signaturePayload.permissionGrantId!==void 0){const s=yield et.fetchGrant(e,i,t.signaturePayload.permissionGrantId);yield sc.authorizeRead({recordsReadMessage:t.message,recordsWriteMessageToBeRead:n.message,expectedGrantor:e,expectedGrantee:t.author,permissionGrant:s,messageStore:i})}else if(o.protocol!==void 0)yield Lt.authorizeRead(e,t,n,i);else throw new Ae(we.RecordsReadAuthorizationFailed,"message failed authorization")}})}}var C$=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Uw extends Gu{static parse(e){return C$(this,void 0,void 0,function*(){let t;if(e.authorization!==void 0&&(t=yield Oe.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield _t.validateDelegatedGrantReferentialIntegrity(e,t),t?.protocolRole!==void 0&&e.descriptor.filter.protocolPath===void 0)throw new Ae(we.RecordsSubscribeFilterMissingRequiredProperties,"Role-authorized subscriptions must include `protocolPath` in the filter");return e.descriptor.filter.protocol!==void 0&&Kh(e.descriptor.filter.protocol),e.descriptor.filter.schema!==void 0&&dS(e.descriptor.filter.schema),pn.validateTimestamp(e.descriptor.messageTimestamp),new Uw(e)})}static create(e){var t;return C$(this,void 0,void 0,function*(){const n={interface:Ge.Records,method:Le.Subscribe,messageTimestamp:(t=e.messageTimestamp)!==null&&t!==void 0?t:pn.getCurrentTimestamp(),filter:_t.normalizeFilter(e.filter)};Cs(n);const i=e.signer;let o;i&&(o=yield Oe.createAuthorization({descriptor:n,signer:i,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}));const s={descriptor:n,authorization:o};return Oe.validateJsonSchema(s),new Uw(s)})}authorizeDelegate(e){return C$(this,void 0,void 0,function*(){const t=yield Rs.parse(this.message.authorization.authorDelegatedGrant);yield sc.authorizeQueryOrSubscribe({incomingMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:t,messageStore:e})})}}var H1=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Al{constructor(e,t,n){this.didResolver=e,this.messageStore=t,this.eventStream=n}handle({tenant:e,message:t,subscriptionHandler:n}){return H1(this,void 0,void 0,function*(){if(this.eventStream===void 0)return Dr(new Ae(we.RecordsSubscribeEventStreamUnimplemented,"Subscriptions are not supported"),501);let i;try{i=yield Uw.parse(t)}catch(d){return Dr(d,400)}let o=[];if(_t.filterIncludesPublishedRecords(i.message.descriptor.filter)&&i.author===void 0)o=[Al.buildPublishedRecordsFilter(i)],delete t.authorization;else{try{yield yd(t.authorization,this.didResolver),yield Al.authorizeRecordsSubscribe(e,i,this.messageStore)}catch(d){return Dr(d,401)}i.author===e?o=yield Al.filterAsOwner(i):o=yield Al.filterAsNonOwner(i)}const s=(d,c,u)=>{e===d&&Wo.matchAnyFilter(u,o)&&n(c)},a=yield Oe.getCid(t),l=yield this.eventStream.subscribe(e,a,s);return{status:{code:200,detail:"OK"},subscription:l}})}static filterAsOwner(e){return H1(this,void 0,void 0,function*(){const{filter:t}=e.message.descriptor;return[Object.assign(Object.assign({},_t.convertFilter(t)),{interface:Ge.Records,method:[Le.Write,Le.Delete]})]})}static filterAsNonOwner(e){return H1(this,void 0,void 0,function*(){const t=[],{filter:n}=e.message.descriptor;return _t.filterIncludesPublishedRecords(n)&&t.push(Al.buildPublishedRecordsFilter(e)),_t.filterIncludesUnpublishedRecords(n)&&(_t.shouldBuildUnpublishedAuthorFilter(n,e.author)&&t.push(Al.buildUnpublishedRecordsBySubscribeAuthorFilter(e)),_t.shouldProtocolAuthorize(e.signaturePayload)&&t.push(Al.buildUnpublishedProtocolAuthorizedRecordsFilter(e)),_t.shouldBuildUnpublishedRecipientFilter(n,e.author)&&t.push(Al.buildUnpublishedRecordsForSubscribeAuthorFilter(e))),t})}static buildPublishedRecordsFilter(e){return Object.assign(Object.assign({},_t.convertFilter(e.message.descriptor.filter)),{interface:Ge.Records,method:[Le.Write,Le.Delete],published:!0})}static buildUnpublishedRecordsForSubscribeAuthorFilter(e){return Object.assign(Object.assign({},_t.convertFilter(e.message.descriptor.filter)),{interface:Ge.Records,method:[Le.Write,Le.Delete],recipient:e.author,published:!1})}static buildUnpublishedProtocolAuthorizedRecordsFilter(e){return Object.assign(Object.assign({},_t.convertFilter(e.message.descriptor.filter)),{interface:Ge.Records,method:[Le.Write,Le.Delete],published:!1})}static buildUnpublishedRecordsBySubscribeAuthorFilter(e){return Object.assign(Object.assign({},_t.convertFilter(e.message.descriptor.filter)),{author:e.author,interface:Ge.Records,method:[Le.Write,Le.Delete],published:!1})}static authorizeRecordsSubscribe(e,t,n){return H1(this,void 0,void 0,function*(){Oe.isSignedByAuthorDelegate(t.message)&&(yield t.authorizeDelegate(n)),_t.shouldProtocolAuthorize(t.signaturePayload)&&(yield Lt.authorizeQueryOrSubscribe(e,t,n))})}}class FA{}FA.maxDataSizeAllowedToBeEncoded=3e4;var E0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Xf{constructor({messageStore:e,dataStore:t,eventLog:n,eventStream:i}){this.messageStore=e,this.dataStore=t,this.eventLog=n,this.eventStream=i}performRecordsDelete({tenant:e,message:t}){return E0(this,void 0,void 0,function*(){const n={interface:Ge.Records,recordId:t.descriptor.recordId},{messages:i}=yield this.messageStore.query(e,[n]),o=yield Oe.getNewestMessage(i);if(!_t.canPerformDeleteAgainstRecord(t,o))return;const s=yield Qg.parse(t),a=yield Gt.getInitialWrite(i),l=s.constructIndexes(a),d=yield Oe.getCid(t);yield this.messageStore.put(e,t,l),yield this.eventLog.append(e,d,l),this.eventStream!==void 0&&this.eventStream.emit(e,{message:t,initialWrite:a},l),t.descriptor.prune&&(yield Xf.purgeRecordDescendants(e,t.descriptor.recordId,this.messageStore,this.dataStore,this.eventLog)),yield Xf.deleteAllOlderMessagesButKeepInitialWrite(e,i,t,this.messageStore,this.dataStore,this.eventLog)})}static deleteFromDataStoreIfNeeded(e,t,n,i){return E0(this,void 0,void 0,function*(){if(n.descriptor.method!==Le.Write)return;const o=n;o.descriptor.dataSize<=FA.maxDataSizeAllowedToBeEncoded||o.descriptor.dataCid!==i.descriptor.dataCid&&(yield e.delete(t,o.recordId,o.descriptor.dataCid))})}static purgeRecordDescendants(e,t,n,i,o){return E0(this,void 0,void 0,function*(){const s={interface:Ge.Records,parentId:t},{messages:a}=yield n.query(e,[s]),l=new Map;for(const d of a){let c;_t.isRecordsWrite(d)?c=d.recordId:c=d.descriptor.recordId,l.has(c)||l.set(c,[]),l.get(c).push(d)}for(const d of l.keys())yield Xf.purgeRecordDescendants(e,d,n,i,o);for(const d of l.keys())yield Xf.purgeRecordMessages(e,l.get(d),n,i,o)})}static purgeRecordMessages(e,t,n,i,o){return E0(this,void 0,void 0,function*(){const s=t.filter(d=>d.descriptor.method===Le.Write),a=yield Oe.getNewestMessage(s);yield i.delete(e,a.recordId,a.descriptor.dataCid);const l=yield Promise.all(t.map(d=>Oe.getCid(d)));yield o.deleteEventsByCid(e,l),yield Promise.all(l.map(d=>n.delete(e,d)))})}static deleteAllOlderMessagesButKeepInitialWrite(e,t,n,i,o,s){return E0(this,void 0,void 0,function*(){const a=[];for(const l of t){if(yield Oe.isOlder(l,n)){yield Xf.deleteFromDataStoreIfNeeded(o,e,l,n);const c=yield Oe.getCid(l);if(yield i.delete(e,c),yield Gt.isInitialWrite(l)){const p=yield(yield Gt.parse(l)).constructIndexes(!1),y=l;delete y.encodedData,yield i.put(e,y,p)}else{const f=yield Oe.getCid(l);a.push(f)}}yield s.deleteEventsByCid(e,a)}})}}var ep=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class jp{constructor(e,t,n,i,o){this.didResolver=e,this.messageStore=t,this.dataStore=n,this.eventLog=i,this.eventStream=o}handle({tenant:e,message:t,dataStream:n}){return ep(this,void 0,void 0,function*(){let i;try{i=yield Gt.parse(t),t.descriptor.protocol!==void 0&&(yield Lt.validateReferentialIntegrity(e,i,this.messageStore))}catch(h){return Dr(h,400)}try{yield yd(t.authorization,this.didResolver),yield jp.authorizeRecordsWrite(e,i,this.messageStore)}catch(h){return Dr(h,401)}const o={interface:Ge.Records,recordId:t.recordId},{messages:s}=yield this.messageStore.query(e,[o]),a=yield i.isInitialWrite();let l;if(!a)try{l=yield Gt.getInitialWrite(s),Gt.verifyEqualityOfImmutableProperties(l,t)}catch(h){return Dr(h,400)}const d=yield Oe.getNewestMessage(s);let c=!1,u;if(d===void 0||(yield Oe.isNewer(t,d))?(c=!0,u=t):u=d,!c)return{status:{code:409,detail:"Conflict"}};try{if(d?.descriptor.method===Le.Delete)throw new Ae(we.RecordsWriteNotAllowedAfterDelete,"RecordsWrite is not allowed after a RecordsDelete.");yield this.preProcessingForCoreRecordsWrite(e,t);let h=!1,p=t;if(n!==void 0)p=yield this.processMessageWithDataStream(e,t,n),h=!0;else if(!a){const g=d;p=yield this.processMessageWithoutDataStream(e,t,g),h=!0}const y=yield i.constructIndexes(h);yield this.messageStore.put(e,p,y),yield this.eventLog.append(e,yield Oe.getCid(t),y),this.eventStream!==void 0&&h&&this.eventStream.emit(e,{message:t,initialWrite:l},y)}catch(h){const p=h;if(p.code!==void 0&&(p.code===we.RecordsWriteMissingEncodedDataInPrevious||p.code===we.RecordsWriteMissingDataInPrevious||p.code===we.RecordsWriteNotAllowedAfterDelete||p.code===we.RecordsWriteDataCidMismatch||p.code===we.RecordsWriteDataSizeMismatch||p.code.startsWith("PermissionsProtocolValidate")||p.code.startsWith("SchemaValidator")))return Dr(h,400);throw h}const f={status:a&&n===void 0?{code:204,detail:"No Content"}:{code:202,detail:"Accepted"}};return yield Xf.deleteAllOlderMessagesButKeepInitialWrite(e,s,u,this.messageStore,this.dataStore,this.eventLog),yield this.postProcessingForCoreRecordsWrite(e,i),f})}preProcessingForCoreRecordsWrite(e,t){var n;return ep(this,void 0,void 0,function*(){if(t.descriptor.protocol===et.uri&&t.descriptor.protocolPath===et.revocationPath){const i=t.descriptor.parentId,o=yield et.fetchGrant(e,this.messageStore,i),s=(n=t.descriptor.tags)===null||n===void 0?void 0:n.protocol,a="protocol"in o.scope?o.scope.protocol:void 0;if(a!==s)throw new Ae(we.PermissionsProtocolValidateRevocationProtocolTagMismatch,`Revocation protocol ${s} does not match grant protocol ${a}`)}})}static validateSchemaForCoreRecordsWrite(e,t){e.descriptor.protocol===et.uri&&et.validateSchema(e,t)}postProcessingForCoreRecordsWrite(e,t){return ep(this,void 0,void 0,function*(){if(t.message.descriptor.protocol===et.uri&&t.message.descriptor.protocolPath===et.revocationPath){const i={permissionGrantId:t.message.descriptor.parentId,dateCreated:{gte:t.message.descriptor.messageTimestamp}},{messages:o}=yield this.messageStore.query(e,[i]),s=[];for(const a of o){const l=yield Oe.getCid(a);yield this.messageStore.delete(e,l)}this.eventLog.deleteEventsByCid(e,s)}})}cloneAndAddEncodedData(e,t){return ep(this,void 0,void 0,function*(){const n=Object.assign({},e);return n.encodedData=vt.bytesToBase64Url(t),n})}processMessageWithDataStream(e,t,n){return ep(this,void 0,void 0,function*(){let i=t;if(t.descriptor.dataSize<=FA.maxDataSizeAllowedToBeEncoded){const o=yield hh.toBytes(n),s=yield _i.computeDagPbCidFromBytes(o);jp.validateDataIntegrity(t.descriptor.dataCid,t.descriptor.dataSize,s,o.length),jp.validateSchemaForCoreRecordsWrite(t,o),i=yield this.cloneAndAddEncodedData(t,o)}else{const[o,s]=hh.duplicateDataStream(n,2);try{const[a,l]=yield Promise.all([_i.computeDagPbCidFromStream(o),this.dataStore.put(e,t.recordId,t.descriptor.dataCid,s)]);jp.validateDataIntegrity(t.descriptor.dataCid,t.descriptor.dataSize,a,l.dataSize)}catch(a){throw yield this.dataStore.delete(e,t.recordId,t.descriptor.dataCid),a}}return i})}processMessageWithoutDataStream(e,t,n){return ep(this,void 0,void 0,function*(){const i=Object.assign({},t),{dataCid:o,dataSize:s}=t.descriptor;if(jp.validateDataIntegrity(o,s,n.descriptor.dataCid,n.descriptor.dataSize),s<=FA.maxDataSizeAllowedToBeEncoded)if(n.encodedData!==void 0)i.encodedData=n.encodedData;else throw new Ae(we.RecordsWriteMissingEncodedDataInPrevious,"No dataStream was provided and unable to get data from previous message");else if((yield this.dataStore.get(e,n.recordId,t.descriptor.dataCid))===void 0)throw new Ae(we.RecordsWriteMissingDataInPrevious,"No dataStream was provided and unable to get data from previous message");return i})}static validateDataIntegrity(e,t,n,i){if(e!==n)throw new Ae(we.RecordsWriteDataCidMismatch,`actual data CID ${n} does not match dataCid in descriptor: ${e}`);if(t!==i)throw new Ae(we.RecordsWriteDataSizeMismatch,`actual data size ${i} bytes does not match dataSize in descriptor: ${t}`)}static authorizeRecordsWrite(e,t,n){return ep(this,void 0,void 0,function*(){if(t.owner!==void 0&&t.owner!==e)throw new Ae(we.RecordsWriteOwnerAndTenantMismatch,`Owner ${t.owner} must be the same as tenant ${e} when specified.`);if(t.isSignedByAuthorDelegate&&(yield t.authorizeAuthorDelegate(n)),t.isSignedByOwnerDelegate&&(yield t.authorizeOwnerDelegate(n)),t.owner===void 0){if(t.author===e)return;if(t.author!==void 0&&t.signaturePayload.permissionGrantId!==void 0){const i=yield et.fetchGrant(e,n,t.signaturePayload.permissionGrantId);yield sc.authorizeWrite({recordsWriteMessage:t.message,expectedGrantor:e,expectedGrantee:t.author,permissionGrant:i,messageStore:n})}else if(t.message.descriptor.protocol!==void 0)yield Lt.authorizeWrite(e,t,n);else throw new Ae(we.RecordsWriteAuthorizationFailed,"message failed authorization")}})}}var Lw;(function(r){r.authentication="authentication",r.assertionMethod="assertionMethod",r.keyAgreement="keyAgreement",r.capabilityInvocation="capabilityInvocation",r.capabilityDelegation="capabilityDelegation"})(Lw||(Lw={}));const mo={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};let Sr=class Dq{constructor({method:e,id:t,path:n,query:i,fragment:o,params:s}){this.uri=`did:${e}:${t}`,this.method=e,this.id=t,this.path=n,this.query=i,this.fragment=o,this.params=s}static parse(e){if(!e)return null;const t=Dq.DID_URI_PATTERN.exec(e);if(!t||!t.groups)return null;const{method:n,id:i,path:o,query:s,fragment:a}=t.groups,l={uri:`did:${n}:${i}`,method:n,id:i};if(o&&(l.path=o),s&&(l.query=s.slice(1)),a&&(l.fragment=a.slice(1)),s){const d={},c=s.slice(1).split("&");for(const u of c){const[f,h]=u.split("=");d[f]=h}l.params=d}return l}};Sr.METHOD_PATTERN="([a-z0-9]+)";Sr.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Sr.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Sr.PCT_ENCODED_PATTERN})`;Sr.METHOD_ID_PATTERN=`((?:${Sr.ID_CHAR_PATTERN}*:)*(${Sr.ID_CHAR_PATTERN}+))`;Sr.PATH_PATTERN="(/[^#?]*)?";Sr.QUERY_PATTERN="([?][^#]*)?";Sr.FRAGMENT_PATTERN="(#.*)?";Sr.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Sr.METHOD_PATTERN}):(?<id>${Sr.METHOD_ID_PATTERN})(?<path>${Sr.PATH_PATTERN})(?<query>${Sr.QUERY_PATTERN})(?<fragment>${Sr.FRAGMENT_PATTERN})$`);let yt=class Mq extends Error{constructor(e,t){super(`${e}: ${t}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Mq)}};var ot;(function(r){r.InvalidDid="invalidDid",r.MethodNotSupported="methodNotSupported",r.InternalError="internalError",r.InvalidDidDocument="invalidDidDocument",r.InvalidDidDocumentLength="invalidDidDocumentLength",r.InvalidDidUrl="invalidDidUrl",r.InvalidPreviousDidProof="invalidPreviousDidProof",r.InvalidPublicKey="invalidPublicKey",r.InvalidPublicKeyLength="invalidPublicKeyLength",r.InvalidPublicKeyType="invalidPublicKeyType",r.InvalidSignature="invalidSignature",r.NotFound="notFound",r.RepresentationNotSupported="representationNotSupported",r.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(ot||(ot={}));const cbe=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,G1=()=>cbe.now(),lbe=r=>r&&r===Math.floor(r)&&r>0&&isFinite(r),R$=r=>r===1/0||lbe(r);class eD{constructor({max:e=1/0,ttl:t,updateAgeOnGet:n=!1,checkAgeOnGet:i=!1,noUpdateTTL:o=!1,dispose:s,noDisposeOnSet:a=!1}={}){if(this.expirations=Object.create(null),this.data=new Map,this.expirationMap=new Map,t!==void 0&&!R$(t))throw new TypeError("ttl must be positive integer or Infinity if set");if(!R$(e))throw new TypeError("max must be positive integer or Infinity");if(this.ttl=t,this.max=e,this.updateAgeOnGet=!!n,this.checkAgeOnGet=!!i,this.noUpdateTTL=!!o,this.noDisposeOnSet=!!a,s!==void 0){if(typeof s!="function")throw new TypeError("dispose must be function if set");this.dispose=s}this.timer=void 0,this.timerExpiration=void 0}setTimer(e,t){if(this.timerExpiration<e)return;this.timer&&clearTimeout(this.timer);const n=setTimeout(()=>{this.timer=void 0,this.timerExpiration=void 0,this.purgeStale();for(const i in this.expirations){this.setTimer(i,i-G1());break}},t);n.unref&&n.unref(),this.timerExpiration=e,this.timer=n}cancelTimer(){this.timer&&(clearTimeout(this.timer),this.timerExpiration=void 0,this.timer=void 0)}cancelTimers(){return process.emitWarning('TTLCache.cancelTimers has been renamed to TTLCache.cancelTimer (no "s"), and will be removed in the next major version update'),this.cancelTimer()}clear(){const e=this.dispose!==eD.prototype.dispose?[...this]:[];this.data.clear(),this.expirationMap.clear(),this.cancelTimer(),this.expirations=Object.create(null);for(const[t,n]of e)this.dispose(n,t,"delete")}setTTL(e,t=this.ttl){const n=this.expirationMap.get(e);if(n!==void 0){const i=this.expirations[n];!i||i.length<=1?delete this.expirations[n]:this.expirations[n]=i.filter(o=>o!==e)}if(t!==1/0){const i=Math.floor(G1()+t);this.expirationMap.set(e,i),this.expirations[i]||(this.expirations[i]=[],this.setTimer(i,t)),this.expirations[i].push(e)}else this.expirationMap.set(e,1/0)}set(e,t,{ttl:n=this.ttl,noUpdateTTL:i=this.noUpdateTTL,noDisposeOnSet:o=this.noDisposeOnSet}={}){if(!R$(n))throw new TypeError("ttl must be positive integer or Infinity");if(this.expirationMap.has(e)){i||this.setTTL(e,n);const s=this.data.get(e);s!==t&&(this.data.set(e,t),o||this.dispose(s,e,"set"))}else this.setTTL(e,n),this.data.set(e,t);for(;this.size>this.max;)this.purgeToCapacity();return this}has(e){return this.data.has(e)}getRemainingTTL(e){const t=this.expirationMap.get(e);return t===1/0?t:t!==void 0?Math.max(0,Math.ceil(t-G1())):0}get(e,{updateAgeOnGet:t=this.updateAgeOnGet,ttl:n=this.ttl,checkAgeOnGet:i=this.checkAgeOnGet}={}){const o=this.data.get(e);if(i&&this.getRemainingTTL(e)===0){this.delete(e);return}return t&&this.setTTL(e,n),o}dispose(e,t){}delete(e){const t=this.expirationMap.get(e);if(t!==void 0){const n=this.data.get(e);this.data.delete(e),this.expirationMap.delete(e);const i=this.expirations[t];return i&&(i.length<=1?delete this.expirations[t]:this.expirations[t]=i.filter(o=>o!==e)),this.dispose(n,e,"delete"),this.size===0&&this.cancelTimer(),!0}return!1}purgeToCapacity(){for(const e in this.expirations){const t=this.expirations[e];if(this.size-t.length>=this.max){delete this.expirations[e];const n=[];for(const i of t)n.push([i,this.data.get(i)]),this.data.delete(i),this.expirationMap.delete(i);for(const[i,o]of n)this.dispose(o,i,"evict")}else{const n=this.size-this.max,i=[];for(const o of t.splice(0,n))i.push([o,this.data.get(o)]),this.data.delete(o),this.expirationMap.delete(o);for(const[o,s]of i)this.dispose(s,o,"evict");return}}}get size(){return this.data.size}purgeStale(){const e=Math.ceil(G1());for(const t in this.expirations){if(t==="Infinity"||t>e)return;const n=[...this.expirations[t]||[]],i=[];delete this.expirations[t];for(const o of n)i.push([o,this.data.get(o)]),this.data.delete(o),this.expirationMap.delete(o);for(const[o,s]of i)this.dispose(s,o,"stale")}this.size===0&&this.cancelTimer()}*entries(){for(const e in this.expirations)for(const t of this.expirations[e])yield[t,this.data.get(t)]}*keys(){for(const e in this.expirations)for(const t of this.expirations[e])yield t}*values(){for(const e in this.expirations)for(const t of this.expirations[e])yield this.data.get(t)}[Symbol.iterator](){return this.entries()}}var dbe=eD;const rw=Vu(dbe);function ube(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function fbe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),s=o.charCodeAt(0);if(t[s]!==255)throw new TypeError(o+" is ambiguous");t[s]=i}var a=r.length,l=r.charAt(0),d=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,g=0,w=0,v=p.length;w!==v&&p[w]===0;)w++,y++;for(var m=(v-w)*c+1>>>0,b=new Uint8Array(m);w!==v;){for(var _=p[w],E=0,S=m-1;(_!==0||E<g)&&S!==-1;S--,E++)_+=256*b[S]>>>0,b[S]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");g=E,w++}for(var T=m-g;T!==m&&b[T]===0;)T++;for(var O=l.repeat(y);T<m;++T)O+=r.charAt(b[T]);return O}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var g=0,w=0;p[y]===l;)g++,y++;for(var v=(p.length-y)*d+1>>>0,m=new Uint8Array(v);p[y];){var b=t[p.charCodeAt(y)];if(b===255)return;for(var _=0,E=v-1;(b!==0||_<w)&&E!==-1;E--,_++)b+=a*m[E]>>>0,m[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");w=_,y++}if(p[y]!==" "){for(var S=v-w;S!==v&&m[S]===0;)S++;for(var T=new Uint8Array(g+(v-S)),O=g;S!==v;)T[O++]=m[S++];return T}}}function h(p){var y=f(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:h}}var hbe=fbe,pbe=hbe;let ybe=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}};class mbe{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Bq(this,e)}}class gbe{decoders;constructor(e){this.decoders=e}or(e){return Bq(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Bq(r,e){return new gbe({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class vbe{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new ybe(e,t,n),this.decoder=new mbe(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function jq({name:r,prefix:e,encode:t,decode:n}){return new vbe(r,e,t,n)}function Nq({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=pbe(t,r);return jq({prefix:e,name:r,encode:n,decode:o=>ube(i(o))})}function bbe(r,e,t,n){const i={};for(let c=0;c<e.length;++c)i[e[c]]=c;let o=r.length;for(;r[o-1]==="=";)--o;const s=new Uint8Array(o*t/8|0);let a=0,l=0,d=0;for(let c=0;c<o;++c){const u=i[r[c]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|u,a+=t,a>=8&&(a-=8,s[d++]=255&l>>a)}if(a>=t||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s}function wbe(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let o="",s=0,a=0;for(let l=0;l<r.length;++l)for(a=a<<8|r[l],s+=8;s>t;)s-=t,o+=e[i&a>>s];if(s!==0&&(o+=e[i&a<<t-s]),n)for(;o.length*t&7;)o+="=";return o}function Ia({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return jq({prefix:e,name:r,encode(i){return wbe(i,n,t)},decode(i){return bbe(i,n,t,r)}})}Ia({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ia({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ia({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ia({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ia({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ia({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ia({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ia({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const uj=Ia({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Y1=Nq({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Nq({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});Ia({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Ia({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const $d=Ia({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Ia({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function _be(r){return r.byteOffset!==0||r.byteLength!==r.buffer.byteLength}function Ebe(r){return typeof r!="object"||r===null?!1:typeof r[Symbol.asyncIterator]=="function"}function fj(r){const t=Object.prototype.toString.call(r).match(/\s([a-zA-Z0-9]+)/),[n,i]=t;return i}var A0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},hj=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}};const Z1=new TextEncoder,tp=new TextDecoder;let Ue=class xs{constructor(e,t){this.data=e,this.format=t}static arrayBuffer(e){return new xs(e,"ArrayBuffer")}static asyncIterable(e){if(!Ebe(e))throw new TypeError("Input must be of type AsyncIterable.");return new xs(e,"AsyncIterable")}static base32Z(e){return new xs(e,"Base32Z")}static base58Btc(e){return new xs(e,"Base58Btc")}static base64Url(e){return new xs(e,"Base64Url")}static bufferSource(e){return new xs(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new xs(e,"Hex")}static multibase(e){return new xs(e,"Multibase")}static object(e){return new xs(e,"Object")}static string(e){return new xs(e,"String")}static uint8Array(e){return new xs(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return Y1.baseDecode(this.data).buffer;case"Base64Url":return $d.baseDecode(this.data).buffer;case"BufferSource":{if(fj(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return _be(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return A0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return uj.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return Y1.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return Y1.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return $d.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return $d.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),t=Z1.encode(e);return $d.baseEncode(t)}case"String":{const e=Z1.encode(this.data);return $d.baseEncode(e)}case"Uint8Array":return $d.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){return A0(this,void 0,void 0,function*(){var e,t,n,i;switch(this.format){case"AsyncIterable":{const l=[];try{for(var o=!0,s=hj(this.data),a;a=yield s.next(),e=a.done,!e;o=!0){i=a.value,o=!1;const c=i;l.push(c)}}catch(c){t={error:c}}finally{try{!o&&!e&&(n=s.return)&&(yield n.call(s))}finally{if(t)throw t.error}}return new Blob(l)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(t,n)=>n.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const t=this.toUint8Array();return xs.uint8Array(t).toHex()}case"Base64Url":{const t=this.toUint8Array();return xs.uint8Array(t).toHex()}case"Uint8Array":{let t="";for(let n=0;n<this.data.length;n++)t+=e[this.data[n]];return t}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=$d.baseDecode(this.data),t=tp.decode(e);return JSON.parse(t)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=tp.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return A0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return tp.decode(this.data);case"Base64Url":{const e=$d.baseDecode(this.data);return tp.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return tp.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){return A0(this,void 0,void 0,function*(){var e,t,n,i;switch(this.format){case"AsyncIterable":{let l="";try{for(var o=!0,s=hj(this.data),a;a=yield s.next(),e=a.done,!e;o=!0){i=a.value,o=!1;const d=i;typeof d=="string"?l+=d:l+=tp.decode(d,{stream:!0})}}catch(d){t={error:d}}finally{try{!o&&!e&&(n=s.return)&&(yield n.call(s))}finally{if(t)throw t.error}}return l+=tp.decode(void 0,{stream:!1}),l}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return uj.baseDecode(this.data);case"Base58Btc":return Y1.baseDecode(this.data);case"Base64Url":return $d.baseDecode(this.data);case"BufferSource":{const e=fj(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let t=0;t<this.data.length;t+=2){const n=parseInt(this.data.substring(t,t+2),16);if(isNaN(n))throw new TypeError("Input is not a valid hexadecimal string.");e[t/2]=n}return e}case"Object":{const e=JSON.stringify(this.data);return Z1.encode(e)}case"String":return Z1.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return A0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}};var Abe=Uq,pj=128,xbe=127,Sbe=~xbe,Tbe=Math.pow(2,31);function Uq(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Tbe;)e[t++]=r&255|pj,r/=128;for(;r&Sbe;)e[t++]=r&255|pj,r>>>=7;return e[t]=r|0,Uq.bytes=t-n+1,e}var $be=PI,kbe=128,yj=127;function PI(r,n){var t=0,n=n||0,i=0,o=n,s,a=r.length;do{if(o>=a)throw PI.bytes=0,new RangeError("Could not decode varint");s=r[o++],t+=i<28?(s&yj)<<i:(s&yj)*Math.pow(2,i),i+=7}while(s>=kbe);return PI.bytes=o-n,t}var Pbe=Math.pow(2,7),Ibe=Math.pow(2,14),Obe=Math.pow(2,21),Cbe=Math.pow(2,28),Rbe=Math.pow(2,35),Dbe=Math.pow(2,42),Mbe=Math.pow(2,49),Bbe=Math.pow(2,56),jbe=Math.pow(2,63),Nbe=function(r){return r<Pbe?1:r<Ibe?2:r<Obe?3:r<Cbe?4:r<Rbe?5:r<Dbe?6:r<Mbe?7:r<Bbe?8:r<jbe?9:10},Ube={encode:Abe,decode:$be,encodingLength:Nbe},qA=Ube;function mj(r,e=0){return[qA.decode(r,e),qA.decode.bytes]}function Lbe(r,e,t=0){return qA.encode(r,e,t),e}function Kbe(r){return qA.encodingLength(r)}let Vh=class Uf{static addPrefix(e){var t;let{code:n,data:i,name:o}=e;if(!(o?!n:n))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(n=Uf.codeToName.has(n)?n:Uf.nameToCode.get(o),n===void 0)throw new Error(`Unsupported multicodec: ${(t=e.name)!==null&&t!==void 0?t:e.code}`);const s=Kbe(n),a=new Uint8Array(s+i.byteLength);return a.set(i,s),Lbe(n,a),a}static getCodeFromData(e){const{prefixedData:t}=e,[n,i]=mj(t);return n}static getCodeFromName(e){const{name:t}=e,n=Uf.nameToCode.get(t);if(n===void 0)throw new Error(`Unsupported multicodec: ${t}`);return n}static getNameFromCode(e){const{code:t}=e,n=Uf.codeToName.get(t);if(n===void 0)throw new Error(`Unsupported multicodec: ${t}`);return n}static registerCodec(e){Uf.codeToName.set(e.code,e.name),Uf.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:t}=e,[n,i]=mj(t),o=Uf.codeToName.get(n);if(o===void 0)throw new Error(`Unsupported multicodec: ${n}`);return{code:n,data:t.slice(i),name:o}}};Vh.codeToName=new Map;Vh.nameToCode=new Map;Vh.registerCodec({code:237,name:"ed25519-pub"});Vh.registerCodec({code:4864,name:"ed25519-priv"});Vh.registerCodec({code:236,name:"x25519-pub"});Vh.registerCodec({code:4866,name:"x25519-priv"});Vh.registerCodec({code:231,name:"secp256k1-pub"});Vh.registerCodec({code:4865,name:"secp256k1-priv"});function tD(r){Object.keys(r).forEach(e=>{r[e]===void 0?delete r[e]:typeof r[e]=="object"&&tD(r[e])})}var rD={},Wh={},RS={},Lq={};Lq.supports=function(...e){const t=e.reduce((n,i)=>Object.assign(n,i),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})};var Kq={},md=class extends Error{constructor(e,t){super(e||""),typeof t=="object"&&t!==null&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},im={};let D$=null;var zq=function(){return D$===null&&(D$={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),D$},Q_={},nD={};const M$=md,zbe=new Set(["buffer","view","utf8"]);let Fbe=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!zbe.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new M$(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new M$(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new M$(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};nD.Encoding=Fbe;const{Buffer:iD}=Dn||{},{Encoding:oD}=nD,qbe=zq;let sD=class extends oD{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new aD({encode:this.encode,decode:e=>this.decode(iD.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},aD=class extends oD{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new sD({encode:e=>{const t=this.encode(e);return iD.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},Vbe=class extends oD{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new sD({encode:e=>iD.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=qbe();return new aD({encode:n=>e.encode(this.encode(n)),decode:n=>this.decode(t.decode(n)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Q_.BufferFormat=sD;Q_.ViewFormat=aD;Q_.UTF8Format=Vbe;const{Buffer:Ho}=Dn||{Buffer:{isBuffer:()=>!1}},{textEncoder:Fq,textDecoder:gj}=zq(),{BufferFormat:e1,ViewFormat:cD,UTF8Format:qq}=Q_,VA=r=>r;im.utf8=new qq({encode:function(r){return Ho.isBuffer(r)?r.toString("utf8"):ArrayBuffer.isView(r)?gj.decode(r):String(r)},decode:VA,name:"utf8",createViewTranscoder(){return new cD({encode:function(r){return ArrayBuffer.isView(r)?r:Fq.encode(r)},decode:function(r){return gj.decode(r)},name:`${this.name}+view`})},createBufferTranscoder(){return new e1({encode:function(r){return Ho.isBuffer(r)?r:ArrayBuffer.isView(r)?Ho.from(r.buffer,r.byteOffset,r.byteLength):Ho.from(String(r),"utf8")},decode:function(r){return r.toString("utf8")},name:`${this.name}+buffer`})}});im.json=new qq({encode:JSON.stringify,decode:JSON.parse,name:"json"});im.buffer=new e1({encode:function(r){return Ho.isBuffer(r)?r:ArrayBuffer.isView(r)?Ho.from(r.buffer,r.byteOffset,r.byteLength):Ho.from(String(r),"utf8")},decode:VA,name:"buffer",createViewTranscoder(){return new cD({encode:function(r){return ArrayBuffer.isView(r)?r:Ho.from(String(r),"utf8")},decode:function(r){return Ho.from(r.buffer,r.byteOffset,r.byteLength)},name:`${this.name}+view`})}});im.view=new cD({encode:function(r){return ArrayBuffer.isView(r)?r:Fq.encode(r)},decode:VA,name:"view",createBufferTranscoder(){return new e1({encode:function(r){return Ho.isBuffer(r)?r:ArrayBuffer.isView(r)?Ho.from(r.buffer,r.byteOffset,r.byteLength):Ho.from(String(r),"utf8")},decode:VA,name:`${this.name}+buffer`})}});im.hex=new e1({encode:function(r){return Ho.isBuffer(r)?r:Ho.from(String(r),"hex")},decode:function(r){return r.toString("hex")},name:"hex"});im.base64=new e1({encode:function(r){return Ho.isBuffer(r)?r:Ho.from(String(r),"base64")},decode:function(r){return r.toString("base64")},name:"base64"});const vj=md,WA=im,{Encoding:Wbe}=nD,{BufferFormat:Hbe,ViewFormat:Gbe,UTF8Format:Ybe}=Q_,x0=Symbol("formats"),J1=Symbol("encodings"),Zbe=new Set(["buffer","view","utf8"]);let Jbe=class{constructor(e){if(Array.isArray(e)){if(!e.every(t=>Zbe.has(t)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[J1]=new Map,this[x0]=new Set(e);for(const t in WA)try{this.encoding(t)}catch(n){if(n.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw n}}encodings(){return Array.from(new Set(this[J1].values()))}encoding(e){let t=this[J1].get(e);if(t===void 0){if(typeof e=="string"&&e!==""){if(t=twe[e],!t)throw new vj(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");t=Xbe(e)}const{name:n,format:i}=t;if(!this[x0].has(i))if(this[x0].has("view"))t=t.createViewTranscoder();else if(this[x0].has("buffer"))t=t.createBufferTranscoder();else if(this[x0].has("utf8"))t=t.createUTF8Transcoder();else throw new vj(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const o of[e,n,t.name,t.commonName])this[J1].set(o,t)}return t}};Kq.Transcoder=Jbe;function Xbe(r){if(r instanceof Wbe)return r;const e="type"in r&&typeof r.type=="string"?r.type:void 0,t=r.name||e||`anonymous-${rwe++}`;switch(Qbe(r)){case"view":return new Gbe({...r,name:t});case"utf8":return new Ybe({...r,name:t});case"buffer":return new Hbe({...r,name:t});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function Qbe(r){return"format"in r&&r.format!==void 0?r.format:"buffer"in r&&typeof r.buffer=="boolean"?r.buffer?"buffer":"utf8":"code"in r&&Number.isInteger(r.code)?"view":"buffer"}const ewe={binary:WA.buffer,"utf-8":WA.utf8},twe={...WA,...ewe};let rwe=0;var Vv={},nwe=typeof queueMicrotask=="function"?queueMicrotask:r=>Promise.resolve().then(r),bj=nwe;Vv.fromCallback=function(r,e){if(r===void 0){var t=new Promise(function(n,i){r=function(o,s){o?i(o):n(s)}});r[e!==void 0?e:"promise"]=t}else if(typeof r!="function")throw new TypeError("Callback must be a function");return r};Vv.fromPromise=function(r,e){if(e===void 0)return r;r.then(function(t){bj(()=>e(null,t))}).catch(function(t){bj(()=>e(t))})};var gd={},t1={};t1.getCallback=function(r,e){return typeof r=="function"?r:e};t1.getOptions=function(r,e){return typeof r=="object"&&r!==null?r:e!==void 0?e:{}};const{fromCallback:B$}=Vv,ia=md,{getOptions:j$,getCallback:wj}=t1,rp=Symbol("promise"),xm=Symbol("callback"),ul=Symbol("working"),Zp=Symbol("handleOne"),ru=Symbol("handleMany"),N$=Symbol("autoClose"),Mh=Symbol("finishWork"),Vl=Symbol("returnMany"),gf=Symbol("closing"),S0=Symbol("handleClose"),X1=Symbol("closed"),T0=Symbol("closeCallbacks"),yh=Symbol("keyEncoding"),Uy=Symbol("valueEncoding"),U$=Symbol("abortOnClose"),Q1=Symbol("legacy"),L$=Symbol("keys"),K$=Symbol("values"),vf=Symbol("limit"),ec=Symbol("count"),e2=Object.freeze({}),iwe=()=>{};let _j=!1;class lD{constructor(e,t,n){if(typeof e!="object"||e===null){const i=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof t!="object"||t===null)throw new TypeError("The second argument must be an options object");this[X1]=!1,this[T0]=[],this[ul]=!1,this[gf]=!1,this[N$]=!1,this[xm]=null,this[Zp]=this[Zp].bind(this),this[ru]=this[ru].bind(this),this[S0]=this[S0].bind(this),this[yh]=t[yh],this[Uy]=t[Uy],this[Q1]=n,this[vf]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[ec]=0,this[U$]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[ec]}get limit(){return this[vf]}next(e){let t;if(e===void 0)t=new Promise((n,i)=>{e=(o,s,a)=>{o?i(o):this[Q1]?s===void 0&&a===void 0?n():n([s,a]):n(s)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[gf]?this.nextTick(e,new ia("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ul]?this.nextTick(e,new ia("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ul]=!0,this[xm]=e,this[ec]>=this[vf]?this.nextTick(this[Zp],null):this._next(this[Zp])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=wj(t,n),n=B$(n,rp),t=j$(t,e2),Number.isInteger(e)?(this[gf]?this.nextTick(n,new ia("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ul]?this.nextTick(n,new ia("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[vf]<1/0&&(e=Math.min(e,this[vf]-this[ec])),this[ul]=!0,this[xm]=n,e<=0?this.nextTick(this[ru],null,[]):this._nextv(e,t,this[ru])),n[rp]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[rp])}_nextv(e,t,n){const i=[],o=(s,a,l)=>{if(s)return n(s);if(this[Q1]?a===void 0&&l===void 0:a===void 0)return n(null,i);i.push(this[Q1]?[a,l]:a),i.length===e?n(null,i):this._next(o)};this._next(o)}all(e,t){return t=wj(e,t),t=B$(t,rp),e=j$(e,e2),this[gf]?this.nextTick(t,new ia("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[ul]?this.nextTick(t,new ia("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[ul]=!0,this[xm]=t,this[N$]=!0,this[ec]>=this[vf]?this.nextTick(this[ru],null,[]):this._all(e,this[ru])),t[rp]}_all(e,t){let n=this[ec];const i=[],o=()=>{const a=this[vf]<1/0?Math.min(1e3,this[vf]-n):1e3;a<=0?this.nextTick(t,null,i):this._nextv(a,e2,s)},s=(a,l)=>{a?t(a):l.length===0?t(null,i):(i.push.apply(i,l),n+=l.length,o())};o()}[Mh](){const e=this[xm];return this[U$]&&e===null?iwe:(this[ul]=!1,this[xm]=null,this[gf]&&this._close(this[S0]),e)}[Vl](e,t,n){this[N$]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=j$(t,e2),!this[gf]){if(this[ul])throw new ia("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[yh]),i=n.format;t.keyEncoding!==i&&(t={...t,keyEncoding:i});const o=this.db.prefixKey(n.encode(e),i);this._seek(o,t)}}}_seek(e,t){throw new ia("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=B$(e,rp),this[X1]?this.nextTick(e):this[gf]?this[T0].push(e):(this[gf]=!0,this[T0].push(e),this[ul]?this[U$]&&this[Mh]()(new ia("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[S0])),e[rp]}_close(e){this.nextTick(e)}[S0](){this[X1]=!0,this.db.detachResource(this);const e=this[T0];this[T0]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[X1]||await this.close()}}}let DS=class extends lD{constructor(e,t){super(e,t,!0),this[L$]=t.keys!==!1,this[K$]=t.values!==!1}[Zp](e,t,n){const i=this[Mh]();if(e)return i(e);try{t=this[L$]&&t!==void 0?this[yh].decode(t):void 0,n=this[K$]&&n!==void 0?this[Uy].decode(n):void 0}catch(o){return i(new ev("entry",o))}t===void 0&&n===void 0||this[ec]++,i(null,t,n)}[ru](e,t){const n=this[Mh]();if(e)return this[Vl](n,e);try{for(const i of t){const o=i[0],s=i[1];i[0]=this[L$]&&o!==void 0?this[yh].decode(o):void 0,i[1]=this[K$]&&s!==void 0?this[Uy].decode(s):void 0}}catch(i){return this[Vl](n,new ev("entries",i))}this[ec]+=t.length,this[Vl](n,null,t)}end(e){return!_j&&typeof console<"u"&&(_j=!0,console.warn(new ia("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},owe=class extends lD{constructor(e,t){super(e,t,!1)}[Zp](e,t){const n=this[Mh]();if(e)return n(e);try{t=t!==void 0?this[yh].decode(t):void 0}catch(i){return n(new ev("key",i))}t!==void 0&&this[ec]++,n(null,t)}[ru](e,t){const n=this[Mh]();if(e)return this[Vl](n,e);try{for(let i=0;i<t.length;i++){const o=t[i];t[i]=o!==void 0?this[yh].decode(o):void 0}}catch(i){return this[Vl](n,new ev("keys",i))}this[ec]+=t.length,this[Vl](n,null,t)}},swe=class extends lD{constructor(e,t){super(e,t,!1)}[Zp](e,t){const n=this[Mh]();if(e)return n(e);try{t=t!==void 0?this[Uy].decode(t):void 0}catch(i){return n(new ev("value",i))}t!==void 0&&this[ec]++,n(null,t)}[ru](e,t){const n=this[Mh]();if(e)return this[Vl](n,e);try{for(let i=0;i<t.length;i++){const o=t[i];t[i]=o!==void 0?this[Uy].decode(o):void 0}}catch(i){return this[Vl](n,new ev("values",i))}this[ec]+=t.length,this[Vl](n,null,t)}};class ev extends ia{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const r of["_ended property","_nexting property","_end method"])Object.defineProperty(DS.prototype,r.split(" ")[0],{get(){throw new ia(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new ia(`The ${r} has been removed`,{code:"LEVEL_LEGACY"})}});DS.keyEncoding=yh;DS.valueEncoding=Uy;gd.AbstractIterator=DS;gd.AbstractKeyIterator=owe;gd.AbstractValueIterator=swe;var dD={};const{AbstractKeyIterator:awe,AbstractValueIterator:cwe}=gd,Np=Symbol("iterator"),$0=Symbol("callback"),tv=Symbol("handleOne"),py=Symbol("handleMany");let II=class extends awe{constructor(e,t){super(e,t),this[Np]=e.iterator({...t,keys:!0,values:!1}),this[tv]=this[tv].bind(this),this[py]=this[py].bind(this)}},Vq=class extends cwe{constructor(e,t){super(e,t),this[Np]=e.iterator({...t,keys:!1,values:!0}),this[tv]=this[tv].bind(this),this[py]=this[py].bind(this)}};for(const r of[II,Vq]){const e=r===II,t=e?n=>n[0]:n=>n[1];r.prototype._next=function(n){this[$0]=n,this[Np].next(this[tv])},r.prototype[tv]=function(n,i,o){const s=this[$0];n?s(n):s(null,e?i:o)},r.prototype._nextv=function(n,i,o){this[$0]=o,this[Np].nextv(n,i,this[py])},r.prototype._all=function(n,i){this[$0]=i,this[Np].all(n,this[py])},r.prototype[py]=function(n,i){const o=this[$0];n?o(n):o(null,i.map(t))},r.prototype._seek=function(n,i){this[Np].seek(n,i)},r.prototype._close=function(n){this[Np].close(n)}}dD.DefaultKeyIterator=II;dD.DefaultValueIterator=Vq;var MS={};const{AbstractIterator:lwe,AbstractKeyIterator:dwe,AbstractValueIterator:uwe}=gd,z$=md,Ts=Symbol("nut"),BS=Symbol("undefer"),jS=Symbol("factory");let Wq=class extends lwe{constructor(e,t){super(e,t),this[Ts]=null,this[jS]=()=>e.iterator(t),this.db.defer(()=>this[BS]())}},Hq=class extends dwe{constructor(e,t){super(e,t),this[Ts]=null,this[jS]=()=>e.keys(t),this.db.defer(()=>this[BS]())}},Gq=class extends uwe{constructor(e,t){super(e,t),this[Ts]=null,this[jS]=()=>e.values(t),this.db.defer(()=>this[BS]())}};for(const r of[Wq,Hq,Gq])r.prototype[BS]=function(){this.db.status==="open"&&(this[Ts]=this[jS]())},r.prototype._next=function(e){this[Ts]!==null?this[Ts].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new z$("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._nextv=function(e,t,n){this[Ts]!==null?this[Ts].nextv(e,t,n):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,t,n)):this.nextTick(n,new z$("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._all=function(e,t){this[Ts]!==null?this[Ts].all(t):this.db.status==="opening"?this.db.defer(()=>this._all(e,t)):this.nextTick(t,new z$("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},r.prototype._seek=function(e,t){this[Ts]!==null?this[Ts]._seek(e,t):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,t))},r.prototype._close=function(e){this[Ts]!==null?this[Ts].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};MS.DeferredIterator=Wq;MS.DeferredKeyIterator=Hq;MS.DeferredValueIterator=Gq;var Yq={},uD={};const{fromCallback:Ej}=Vv,t2=md,{getCallback:fwe,getOptions:hwe}=t1,r2=Symbol("promise"),Ca=Symbol("status"),Sm=Symbol("operations"),k0=Symbol("finishClose"),Tm=Symbol("closeCallbacks");let pwe=class{constructor(e){if(typeof e!="object"||e===null){const t=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[Sm]=[],this[Tm]=[],this[Ca]="open",this[k0]=this[k0].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[Sm].length}put(e,t,n){if(this[Ca]!=="open")throw new t2("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;const o=n&&n.sublevel!=null?n.sublevel:this.db,s=n,a=o.keyEncoding(n&&n.keyEncoding),l=o.valueEncoding(n&&n.valueEncoding),d=a.format;n={...n,keyEncoding:d,valueEncoding:l.format},o!==this.db&&(n.sublevel=null);const c=o.prefixKey(a.encode(e),d),u=l.encode(t);return this._put(c,u,n),this[Sm].push({...s,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if(this[Ca]!=="open")throw new t2("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const i=t&&t.sublevel!=null?t.sublevel:this.db,o=t,s=i.keyEncoding(t&&t.keyEncoding),a=s.format;return t={...t,keyEncoding:a},i!==this.db&&(t.sublevel=null),this._del(i.prefixKey(s.encode(e),a),t),this[Sm].push({...o,type:"del",key:e}),this}_del(e,t){}clear(){if(this[Ca]!=="open")throw new t2("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[Sm]=[],this}_clear(){}write(e,t){return t=fwe(e,t),t=Ej(t,r2),e=hwe(e),this[Ca]!=="open"?this.nextTick(t,new t2("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(t):(this[Ca]="writing",this._write(e,n=>{this[Ca]="closing",this[Tm].push(()=>t(n)),n||this.db.emit("batch",this[Sm]),this._close(this[k0])})),t[r2]}_write(e,t){}close(e){return e=Ej(e,r2),this[Ca]==="closing"?this[Tm].push(e):this[Ca]==="closed"?this.nextTick(e):(this[Tm].push(e),this[Ca]!=="writing"&&(this[Ca]="closing",this._close(this[k0]))),e[r2]}_close(e){this.nextTick(e)}[k0](){this[Ca]="closed",this.db.detachResource(this);const e=this[Tm];this[Tm]=[];for(const t of e)t()}};uD.AbstractChainedBatch=pwe;const{AbstractChainedBatch:ywe}=uD,mwe=md,$m=Symbol("encoded");let gwe=class extends ywe{constructor(e){super(e),this[$m]=[]}_put(e,t,n){this[$m].push({...n,type:"put",key:e,value:t})}_del(e,t){this[$m].push({...t,type:"del",key:e})}_clear(){this[$m]=[]}_write(e,t){this.db.status==="opening"?this.db.defer(()=>this._write(e,t)):this.db.status==="open"?this[$m].length===0?this.nextTick(t):this.db._batch(this[$m],e,t):this.nextTick(t,new mwe("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};Yq.DefaultChainedBatch=gwe;const Aj=md,vwe=Object.prototype.hasOwnProperty,bwe=new Set(["lt","lte","gt","gte"]);var wwe=function(r,e){const t={};for(const n in r)if(vwe.call(r,n)&&!(n==="keyEncoding"||n==="valueEncoding")){if(n==="start"||n==="end")throw new Aj(`The legacy range option '${n}' has been removed`,{code:"LEVEL_LEGACY"});if(n==="encoding")throw new Aj("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});bwe.has(n)?t[n]=e.encode(r[n]):t[n]=r[n]}return t.reverse=!!t.reverse,t.limit=Number.isInteger(t.limit)&&t.limit>=0?t.limit:-1,t};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let xj;var Zq=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):r=>(xj||(xj=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),F$,Sj;function _we(){if(Sj)return F$;Sj=1;const r=Zq;return F$=function(e,...t){t.length===0?r(e):r(()=>e(...t))},F$}var P0={},Tj;function Ewe(){if(Tj)return P0;Tj=1;const{AbstractIterator:r,AbstractKeyIterator:e,AbstractValueIterator:t}=gd,n=Symbol("unfix"),i=Symbol("iterator"),o=Symbol("handleOne"),s=Symbol("handleMany"),a=Symbol("callback");class l extends r{constructor(f,h,p,y){super(f,h),this[i]=p,this[n]=y,this[o]=this[o].bind(this),this[s]=this[s].bind(this),this[a]=null}[o](f,h,p){const y=this[a];if(f)return y(f);h!==void 0&&(h=this[n](h)),y(f,h,p)}[s](f,h){const p=this[a];if(f)return p(f);for(const y of h){const g=y[0];g!==void 0&&(y[0]=this[n](g))}p(f,h)}}class d extends e{constructor(f,h,p,y){super(f,h),this[i]=p,this[n]=y,this[o]=this[o].bind(this),this[s]=this[s].bind(this),this[a]=null}[o](f,h){const p=this[a];if(f)return p(f);h!==void 0&&(h=this[n](h)),p(f,h)}[s](f,h){const p=this[a];if(f)return p(f);for(let y=0;y<h.length;y++){const g=h[y];g!==void 0&&(h[y]=this[n](g))}p(f,h)}}class c extends t{constructor(f,h,p){super(f,h),this[i]=p}}for(const u of[l,d])u.prototype._next=function(f){this[a]=f,this[i].next(this[o])},u.prototype._nextv=function(f,h,p){this[a]=p,this[i].nextv(f,h,this[s])},u.prototype._all=function(f,h){this[a]=h,this[i].all(f,this[s])};for(const u of[c])u.prototype._next=function(f){this[i].next(f)},u.prototype._nextv=function(f,h,p){this[i].nextv(f,h,p)},u.prototype._all=function(f,h){this[i].all(f,h)};for(const u of[l,d,c])u.prototype._seek=function(f,h){this[i].seek(f,h)},u.prototype._close=function(f){this[i].close(f)};return P0.AbstractSublevelIterator=l,P0.AbstractSublevelKeyIterator=d,P0.AbstractSublevelValueIterator=c,P0}var q$,$j;function Awe(){if($j)return q$;$j=1;const r=md,{Buffer:e}=Dn||{},{AbstractSublevelIterator:t,AbstractSublevelKeyIterator:n,AbstractSublevelValueIterator:i}=Ewe(),o=Symbol("prefix"),s=Symbol("upperBound"),a=Symbol("prefixRange"),l=Symbol("parent"),d=Symbol("unfix"),c=new TextEncoder,u={separator:"!"};q$=function({AbstractLevel:w}){class v extends w{static defaults(b){if(typeof b=="string")throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(b&&b.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return b==null?u:b.separator?b:{...b,separator:"!"}}constructor(b,_,E){const{separator:S,manifest:T,...O}=v.defaults(E);_=g(_,S);const M=S.charCodeAt(0)+1,Q=b[l]||b;if(!c.encode(_).every(ee=>ee>M&&ee<127))throw new r(`Prefix must use bytes > ${M} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(f(Q,T),O);const W=(b.prefix||"")+S+_+S,U=W.slice(0,-1)+String.fromCharCode(M);this[l]=Q,this[o]=new p(W),this[s]=new p(U),this[d]=new y,this.nextTick=Q.nextTick}prefixKey(b,_){if(_==="utf8")return this[o].utf8+b;if(b.byteLength===0)return this[o][_];if(_==="view"){const E=this[o].view,S=new Uint8Array(E.byteLength+b.byteLength);return S.set(E,0),S.set(b,E.byteLength),S}else{const E=this[o].buffer;return e.concat([E,b],E.byteLength+b.byteLength)}}[a](b,_){b.gte!==void 0?b.gte=this.prefixKey(b.gte,_):b.gt!==void 0?b.gt=this.prefixKey(b.gt,_):b.gte=this[o][_],b.lte!==void 0?b.lte=this.prefixKey(b.lte,_):b.lt!==void 0?b.lt=this.prefixKey(b.lt,_):b.lte=this[s][_]}get prefix(){return this[o].utf8}get db(){return this[l]}_open(b,_){this[l].open({passive:!0},_)}_put(b,_,E,S){this[l].put(b,_,E,S)}_get(b,_,E){this[l].get(b,_,E)}_getMany(b,_,E){this[l].getMany(b,_,E)}_del(b,_,E){this[l].del(b,_,E)}_batch(b,_,E){this[l].batch(b,_,E)}_clear(b,_){this[a](b,b.keyEncoding),this[l].clear(b,_)}_iterator(b){this[a](b,b.keyEncoding);const _=this[l].iterator(b),E=this[d].get(this[o].utf8.length,b.keyEncoding);return new t(this,b,_,E)}_keys(b){this[a](b,b.keyEncoding);const _=this[l].keys(b),E=this[d].get(this[o].utf8.length,b.keyEncoding);return new n(this,b,_,E)}_values(b){this[a](b,b.keyEncoding);const _=this[l].values(b);return new i(this,b,_)}}return{AbstractSublevel:v}};const f=function(w,v){return{...w.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...v,encodings:{utf8:h(w,"utf8"),buffer:h(w,"buffer"),view:h(w,"view")}}},h=function(w,v){return w.supports.encodings[v]?w.keyEncoding(v).name===v:!1};class p{constructor(v){this.utf8=v,this.view=c.encode(v),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class y{constructor(){this.cache=new Map}get(v,m){let b=this.cache.get(m);return b===void 0&&(m==="view"?b=function(_,E){return E.subarray(_)}.bind(null,v):b=function(_,E){return E.slice(_)}.bind(null,v),this.cache.set(m,b)),b}}const g=function(w,v){let m=0,b=w.length;for(;m<b&&w[m]===v;)m++;for(;b>m&&w[b-1]===v;)b--;return w.slice(m,b)};return q$}const{supports:xwe}=Lq,{Transcoder:Swe}=Kq,{EventEmitter:Twe}=dd,{fromCallback:bf}=Vv,xc=md,{AbstractIterator:np}=gd,{DefaultKeyIterator:$we,DefaultValueIterator:kwe}=dD,{DeferredIterator:Pwe,DeferredKeyIterator:Iwe,DeferredValueIterator:Owe}=MS,{DefaultChainedBatch:kj}=Yq,{getCallback:ip,getOptions:wf}=t1,n2=wwe,qt=Symbol("promise"),kd=Symbol("landed"),op=Symbol("resources"),V$=Symbol("closeResources"),I0=Symbol("operations"),O0=Symbol("undefer"),i2=Symbol("deferOpen"),Pj=Symbol("options"),or=Symbol("status"),sp=Symbol("defaultOptions"),km=Symbol("transcoder"),o2=Symbol("keyEncoding"),W$=Symbol("valueEncoding"),Cwe=()=>{};let fD=class extends Twe{constructor(e,t){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");t=wf(t);const{keyEncoding:n,valueEncoding:i,passive:o,...s}=t;this[op]=new Set,this[I0]=[],this[i2]=!0,this[Pj]=s,this[or]="opening",this.supports=xwe(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[km]=new Swe(Rwe(this)),this[o2]=this[km].encoding(n||"utf8"),this[W$]=this[km].encoding(i||"utf8");for(const a of this[km].encodings())this.supports.encodings[a.commonName]||(this.supports.encodings[a.commonName]=!0);this[sp]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[o2].commonName,valueEncoding:this[W$].commonName}),key:Object.freeze({keyEncoding:this[o2].commonName})},this.nextTick(()=>{this[i2]&&this.open({passive:!1},Cwe)})}get status(){return this[or]}keyEncoding(e){return this[km].encoding(e??this[o2])}valueEncoding(e){return this[km].encoding(e??this[W$])}open(e,t){t=ip(e,t),t=bf(t,qt),e={...this[Pj],...wf(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const n=i=>{this[or]==="closing"||this[or]==="opening"?this.once(kd,i?()=>n(i):n):this[or]!=="open"?t(new xc("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):t()};return e.passive?this[or]==="opening"?this.once(kd,n):this.nextTick(n):this[or]==="closed"||this[i2]?(this[i2]=!1,this[or]="opening",this.emit("opening"),this._open(e,i=>{if(i){this[or]="closed",this[V$](()=>{this.emit(kd),n(i)}),this[O0]();return}this[or]="open",this[O0](),this.emit(kd),this[or]==="open"&&this.emit("open"),this[or]==="open"&&this.emit("ready"),n()})):this[or]==="open"?this.nextTick(n):this.once(kd,()=>this.open(e,t)),t[qt]}_open(e,t){this.nextTick(t)}close(e){e=bf(e,qt);const t=n=>{this[or]==="opening"||this[or]==="closing"?this.once(kd,n?t(n):t):this[or]!=="closed"?e(new xc("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if(this[or]==="open"){this[or]="closing",this.emit("closing");const n=i=>{this[or]="open",this[O0](),this.emit(kd),t(i)};this[V$](()=>{this._close(i=>{if(i)return n(i);this[or]="closed",this[O0](),this.emit(kd),this[or]==="closed"&&this.emit("closed"),t()})})}else this[or]==="closed"?this.nextTick(t):this.once(kd,()=>this.close(e));return e[qt]}[V$](e){if(this[op].size===0)return this.nextTick(e);let t=this[op].size,n=!0;const i=()=>{--t===0&&(n?this.nextTick(e):e())};for(const o of this[op])o.close(i);n=!1,this[op].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=ip(t,n),n=bf(n,qt),t=wf(t,this[sp].entry),this[or]==="opening")return this.defer(()=>this.get(e,t,n)),n[qt];if(Pm(this,n))return n[qt];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[qt];const o=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),a=o.format,l=s.format;return(t.keyEncoding!==a||t.valueEncoding!==l)&&(t=Object.assign({},t,{keyEncoding:a,valueEncoding:l})),this._get(this.prefixKey(o.encode(e),a),t,(d,c)=>{if(d)return(d.code==="LEVEL_NOT_FOUND"||d.notFound||/NotFound/i.test(d))&&(d.code||(d.code="LEVEL_NOT_FOUND"),d.notFound||(d.notFound=!0),d.status||(d.status=404)),n(d);try{c=s.decode(c)}catch(u){return n(new xc("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:u}))}n(null,c)}),n[qt]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=ip(t,n),n=bf(n,qt),t=wf(t,this[sp].entry),this[or]==="opening")return this.defer(()=>this.getMany(e,t,n)),n[qt];if(Pm(this,n))return n[qt];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[qt];if(e.length===0)return this.nextTick(n,null,[]),n[qt];const i=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),s=i.format,a=o.format;(t.keyEncoding!==s||t.valueEncoding!==a)&&(t=Object.assign({},t,{keyEncoding:s,valueEncoding:a}));const l=new Array(e.length);for(let d=0;d<e.length;d++){const c=e[d],u=this._checkKey(c);if(u)return this.nextTick(n,u),n[qt];l[d]=this.prefixKey(i.encode(c),s)}return this._getMany(l,t,(d,c)=>{if(d)return n(d);try{for(let u=0;u<c.length;u++)c[u]!==void 0&&(c[u]=o.decode(c[u]))}catch(u){return n(new xc(`Could not decode one or more of ${c.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:u}))}n(null,c)}),n[qt]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,i){if(i=ip(n,i),i=bf(i,qt),n=wf(n,this[sp].entry),this[or]==="opening")return this.defer(()=>this.put(e,t,n,i)),i[qt];if(Pm(this,i))return i[qt];const o=this._checkKey(e)||this._checkValue(t);if(o)return this.nextTick(i,o),i[qt];const s=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),l=s.format,d=a.format;(n.keyEncoding!==l||n.valueEncoding!==d)&&(n=Object.assign({},n,{keyEncoding:l,valueEncoding:d}));const c=this.prefixKey(s.encode(e),l),u=a.encode(t);return this._put(c,u,n,f=>{if(f)return i(f);this.emit("put",e,t),i()}),i[qt]}_put(e,t,n,i){this.nextTick(i)}del(e,t,n){if(n=ip(t,n),n=bf(n,qt),t=wf(t,this[sp].key),this[or]==="opening")return this.defer(()=>this.del(e,t,n)),n[qt];if(Pm(this,n))return n[qt];const i=this._checkKey(e);if(i)return this.nextTick(n,i),n[qt];const o=this.keyEncoding(t.keyEncoding),s=o.format;return t.keyEncoding!==s&&(t=Object.assign({},t,{keyEncoding:s})),this._del(this.prefixKey(o.encode(e),s),t,a=>{if(a)return n(a);this.emit("del",e),n()}),n[qt]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if(this[or]==="opening")return new kj(this);if(this[or]!=="open")throw new xc("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?n=e:n=ip(t,n),n=bf(n,qt),t=wf(t,this[sp].empty),this[or]==="opening")return this.defer(()=>this.batch(e,t,n)),n[qt];if(Pm(this,n))return n[qt];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[qt];if(e.length===0)return this.nextTick(n),n[qt];const i=new Array(e.length),{keyEncoding:o,valueEncoding:s,...a}=t;for(let l=0;l<e.length;l++){if(typeof e[l]!="object"||e[l]===null)return this.nextTick(n,new TypeError("A batch operation must be an object")),n[qt];const d=Object.assign({},e[l]);if(d.type!=="put"&&d.type!=="del")return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[qt];const c=this._checkKey(d.key);if(c)return this.nextTick(n,c),n[qt];const u=d.sublevel!=null?d.sublevel:this,f=u.keyEncoding(d.keyEncoding||o),h=f.format;if(d.key=u.prefixKey(f.encode(d.key),h),d.keyEncoding=h,d.type==="put"){const p=this._checkValue(d.value);if(p)return this.nextTick(n,p),n[qt];const y=u.valueEncoding(d.valueEncoding||s);d.value=y.encode(d.value),d.valueEncoding=y.format}u!==this&&(d.sublevel=null),i[l]=d}return this._batch(i,a,l=>{if(l)return n(l);this.emit("batch",e),n()}),n[qt]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,OI.defaults(t))}_sublevel(e,t){return new OI(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=ip(e,t),t=bf(t,qt),e=wf(e,this[sp].empty),this[or]==="opening")return this.defer(()=>this.clear(e,t)),t[qt];if(Pm(this,t))return t[qt];const n=e,i=this.keyEncoding(e.keyEncoding);return e=n2(e,i),e.keyEncoding=i.format,e.limit===0?this.nextTick(t):this._clear(e,o=>{if(o)return t(o);this.emit("clear",n),t()}),t[qt]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=n2(e,t),e.keys=e.keys!==!1,e.values=e.values!==!1,e[np.keyEncoding]=t,e[np.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[or]==="opening")return new Pwe(this,e);if(this[or]!=="open")throw new xc("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new np(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=n2(e,t),e[np.keyEncoding]=t,e[np.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[or]==="opening")return new Iwe(this,e);if(this[or]!=="open")throw new xc("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new $we(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=n2(e,t),e[np.keyEncoding]=t,e[np.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,this[or]==="opening")return new Owe(this,e);if(this[or]!=="open")throw new xc("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new kwe(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[I0].push(e)}[O0](){if(this[I0].length===0)return;const e=this[I0];this[I0]=[];for(const t of e)t()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[op].add(e)}detachResource(e){this[op].delete(e)}_chainedBatch(){return new kj(this)}_checkKey(e){if(e==null)return new xc("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new xc("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};fD.prototype.nextTick=_we();const{AbstractSublevel:OI}=Awe()({AbstractLevel:fD});RS.AbstractLevel=fD;RS.AbstractSublevel=OI;const Pm=function(r,e){return r[or]!=="open"?(r.nextTick(e,new xc("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},Rwe=function(r){return Object.keys(r.supports.encodings).filter(e=>!!r.supports.encodings[e])};Wh.AbstractLevel=RS.AbstractLevel;Wh.AbstractSublevel=RS.AbstractSublevel;Wh.AbstractIterator=gd.AbstractIterator;Wh.AbstractKeyIterator=gd.AbstractKeyIterator;Wh.AbstractValueIterator=gd.AbstractValueIterator;Wh.AbstractChainedBatch=uD.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Dwe=Bwe;const Mwe=Zq;function Bwe(r,e,t){if(typeof e!="number")throw new Error("second argument must be a Number");let n,i,o,s,a,l=!0,d;Array.isArray(r)?(n=[],o=i=r.length):(s=Object.keys(r),n={},o=i=s.length);function c(f){function h(){t&&t(f,n),t=null}l?Mwe(h):h()}function u(f,h,p){if(n[f]=p,h&&(a=!0),--o===0||h)c(h);else if(!a&&d<i){let y;s?(y=s[d],d+=1,r[y](function(g,w){u(y,g,w)})):(y=d,d+=1,r[y](function(g,w){u(y,g,w)}))}}d=e,o?s?s.some(function(f,h){return r[f](function(p,y){u(f,p,y)}),h===e-1}):r.some(function(f,h){return f(function(p,y){u(h,p,y)}),h===e-1}):c(null),l=!1}var Jq={},Xq=function(e){const t=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,n=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,i=e.gte===void 0,o=e.lte===void 0;return t!==void 0&&n!==void 0?IDBKeyRange.bound(t,n,i,o):t!==void 0?IDBKeyRange.lowerBound(t,i):n!==void 0?IDBKeyRange.upperBound(n,o):null};const jwe=new TextEncoder;var Qq=function(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):jwe.encode(r)};const{AbstractIterator:Nwe}=Wh,Ij=Xq,s2=Qq,fl=Symbol("cache"),Pd=Symbol("finished"),Vs=Symbol("options"),Id=Symbol("currentOptions"),ap=Symbol("position"),H$=Symbol("location"),Im=Symbol("first"),Oj={};let Uwe=class extends Nwe{constructor(e,t,n){super(e,n),this[fl]=[],this[Pd]=this.limit===0,this[Vs]=n,this[Id]={...n},this[ap]=void 0,this[H$]=t,this[Im]=!0}_nextv(e,t,n){if(this[Im]=!1,this[Pd])return this.nextTick(n,null,[]);if(this[fl].length>0)return e=Math.min(e,this[fl].length),this.nextTick(n,null,this[fl].splice(0,e));this[ap]!==void 0&&(this[Vs].reverse?(this[Id].lt=this[ap],this[Id].lte=void 0):(this[Id].gt=this[ap],this[Id].gte=void 0));let i;try{i=Ij(this[Id])}catch{return this[Pd]=!0,this.nextTick(n,null,[])}const o=this.db.db.transaction([this[H$]],"readonly"),s=o.objectStore(this[H$]),a=[];if(this[Vs].reverse){const l=!this[Vs].values&&s.openKeyCursor?"openKeyCursor":"openCursor";s[l](i,"prev").onsuccess=d=>{const c=d.target.result;if(c){const{key:u,value:f}=c;this[ap]=u,a.push([this[Vs].keys&&u!==void 0?s2(u):void 0,this[Vs].values&&f!==void 0?s2(f):void 0]),a.length<e?c.continue():Cj(o)}else this[Pd]=!0}}else{let l,d;const c=()=>{if(l===void 0||d===void 0)return;const u=Math.max(l.length,d.length);u===0||e===1/0?this[Pd]=!0:this[ap]=l[u-1],a.length=u;for(let f=0;f<u;f++){const h=l[f],p=d[f];a[f]=[this[Vs].keys&&h!==void 0?s2(h):void 0,this[Vs].values&&p!==void 0?s2(p):void 0]}Cj(o)};this[Vs].keys||e<1/0?s.getAllKeys(i,e<1/0?e:void 0).onsuccess=u=>{l=u.target.result,c()}:(l=[],this.nextTick(c)),this[Vs].values?s.getAll(i,e<1/0?e:void 0).onsuccess=u=>{d=u.target.result,c()}:(d=[],this.nextTick(c))}o.onabort=()=>{n(o.error||new Error("aborted by user")),n=null},o.oncomplete=()=>{n(null,a),n=null}}_next(e){if(this[fl].length>0){const[t,n]=this[fl].shift();this.nextTick(e,null,t,n)}else if(this[Pd])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[Im]&&(this[Im]=!1,t=1),this._nextv(t,Oj,(n,i)=>{if(n)return e(n);this[fl]=i,this._next(e)})}}_all(e,t){this[Im]=!1;const n=this[fl].splice(0,this[fl].length),i=this.limit-this.count-n.length;if(i<=0)return this.nextTick(t,null,n);this._nextv(i,Oj,(o,s)=>{if(o)return t(o);n.length>0&&(s=n.concat(s)),t(null,s)})}_seek(e,t){this[Im]=!0,this[fl]=[],this[Pd]=!1,this[ap]=void 0,this[Id]={...this[Vs]};let n;try{n=Ij(this[Vs])}catch{this[Pd]=!0;return}n!==null&&!n.includes(e)?this[Pd]=!0:this[Vs].reverse?this[Id].lte=e:this[Id].gte=e}};Jq.Iterator=Uwe;function Cj(r){typeof r.commit=="function"&&r.commit()}var Lwe=function(e,t,n,i,o){if(i.limit===0)return e.nextTick(o);const s=e.db.transaction([t],"readwrite"),a=s.objectStore(t);let l=0;s.oncomplete=function(){o()},s.onabort=function(){o(s.error||new Error("aborted by user"))};const d=a.openKeyCursor?"openKeyCursor":"openCursor",c=i.reverse?"prev":"next";a[d](n,c).onsuccess=function(u){const f=u.target.result;f&&(a.delete(f.key).onsuccess=function(){(i.limit<=0||++l<i.limit)&&f.continue()})}};const{AbstractLevel:Kwe}=Wh,Rj=md,zwe=Dwe,{fromCallback:Fwe}=Vv,{Iterator:qwe}=Jq,Dj=Qq,Vwe=Lwe,Wwe=Xq,eV="level-js-",C0=Symbol("idb"),G$=Symbol("namePrefix"),Od=Symbol("location"),Y$=Symbol("version"),cp=Symbol("store"),R0=Symbol("onComplete"),Mj=Symbol("promise");class tV extends Kwe{constructor(e,t,n){if(typeof t=="function"||typeof n=="function")throw new Rj("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:i,version:o,...s}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},s),typeof e!="string")throw new Error("constructor requires a location string argument");this[Od]=e,this[G$]=i??eV,this[Y$]=parseInt(o||1,10),this[C0]=null}get location(){return this[Od]}get namePrefix(){return this[G$]}get version(){return this[Y$]}get db(){return this[C0]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[G$]+this[Od],this[Y$]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[C0]=n.result,t()},n.onupgradeneeded=i=>{const o=i.target.result;o.objectStoreNames.contains(this[Od])||o.createObjectStore(this[Od])}}[cp](e){return this[C0].transaction([this[Od]],e).objectStore(this[Od])}[R0](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const i=this[cp]("readonly");let o;try{o=i.get(e)}catch(s){return this.nextTick(n,s)}this[R0](o,function(s,a){if(s)return n(s);if(a===void 0)return n(new Rj("Entry not found",{code:"LEVEL_NOT_FOUND"}));n(null,Dj(a))})}_getMany(e,t,n){const i=this[cp]("readonly"),o=e.map(s=>a=>{let l;try{l=i.get(s)}catch(d){return a(d)}l.onsuccess=()=>{const d=l.result;a(null,d===void 0?d:Dj(d))},l.onerror=d=>{d.stopPropagation(),a(l.error)}});zwe(o,16,n)}_del(e,t,n){const i=this[cp]("readwrite");let o;try{o=i.delete(e)}catch(s){return this.nextTick(n,s)}this[R0](o,n)}_put(e,t,n,i){const o=this[cp]("readwrite");let s;try{s=o.put(t,e)}catch(a){return this.nextTick(i,a)}this[R0](s,i)}_iterator(e){return new qwe(this,this[Od],e)}_batch(e,t,n){const i=this[cp]("readwrite"),o=i.transaction;let s=0,a;o.onabort=function(){n(a||o.error||new Error("aborted by user"))},o.oncomplete=function(){n()};function l(){const d=e[s++],c=d.key;let u;try{u=d.type==="del"?i.delete(c):i.put(d.value,c)}catch(f){a=f,o.abort();return}s<e.length?u.onsuccess=l:typeof o.commit=="function"&&o.commit()}l()}_clear(e,t){let n,i;try{n=Wwe(e)}catch{return this.nextTick(t)}if(e.limit>=0)return Vwe(this,this[Od],n,e,t);try{const o=this[cp]("readwrite");i=n?o.delete(n):o.clear()}catch(o){return this.nextTick(t,o)}this[R0](i,t)}_close(e){this[C0].close(),this.nextTick(e)}}tV.destroy=function(r,e,t){typeof e=="function"&&(t=e,e=eV),t=Fwe(t,Mj);const n=indexedDB.deleteDatabase(e+r);return n.onsuccess=function(){t()},n.onerror=function(i){t(i)},t[Mj]};rD.BrowserLevel=tV;var rV=rD.BrowserLevel,lp=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let nV=class{constructor(){this.store=new Map}clear(){return lp(this,void 0,void 0,function*(){this.store.clear()})}close(){return lp(this,void 0,void 0,function*(){})}delete(e){return lp(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return lp(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return lp(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return lp(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,t){return lp(this,void 0,void 0,function*(){this.store.set(e,t)})}};var iV={exports:{}},Z$={exports:{}},pi={ArrayIsArray(r){return Array.isArray(r)},ArrayPrototypeIncludes(r,e){return r.includes(e)},ArrayPrototypeIndexOf(r,e){return r.indexOf(e)},ArrayPrototypeJoin(r,e){return r.join(e)},ArrayPrototypeMap(r,e){return r.map(e)},ArrayPrototypePop(r,e){return r.pop(e)},ArrayPrototypePush(r,e){return r.push(e)},ArrayPrototypeSlice(r,e,t){return r.slice(e,t)},Error,FunctionPrototypeCall(r,e,...t){return r.call(e,...t)},FunctionPrototypeSymbolHasInstance(r,e){return Function.prototype[Symbol.hasInstance].call(r,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(r,e){return Object.defineProperties(r,e)},ObjectDefineProperty(r,e,t){return Object.defineProperty(r,e,t)},ObjectGetOwnPropertyDescriptor(r,e){return Object.getOwnPropertyDescriptor(r,e)},ObjectKeys(r){return Object.keys(r)},ObjectSetPrototypeOf(r,e){return Object.setPrototypeOf(r,e)},Promise,PromisePrototypeCatch(r,e){return r.catch(e)},PromisePrototypeThen(r,e,t){return r.then(e,t)},PromiseReject(r){return Promise.reject(r)},ReflectApply:Reflect.apply,RegExpPrototypeTest(r,e){return r.test(e)},SafeSet:Set,String,StringPrototypeSlice(r,e,t){return r.slice(e,t)},StringPrototypeToLowerCase(r){return r.toLowerCase()},StringPrototypeToUpperCase(r){return r.toUpperCase()},StringPrototypeTrim(r){return r.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(r,e,t){return r.set(e,t)},Uint8Array},oV={exports:{}};(function(r){const e=Dn,t=Object.getPrototypeOf(async function(){}).constructor,n=globalThis.Blob||e.Blob,i=typeof n<"u"?function(a){return a instanceof n}:function(a){return!1};class o extends Error{constructor(a){if(!Array.isArray(a))throw new TypeError(`Expected input to be an Array, got ${typeof a}`);let l="";for(let d=0;d<a.length;d++)l+=`    ${a[d].stack}
`;super(l),this.name="AggregateError",this.errors=a}}r.exports={AggregateError:o,kEmptyObject:Object.freeze({}),once(s){let a=!1;return function(...l){a||(a=!0,s.apply(this,l))}},createDeferredPromise:function(){let s,a;return{promise:new Promise((d,c)=>{s=d,a=c}),resolve:s,reject:a}},promisify(s){return new Promise((a,l)=>{s((d,...c)=>d?l(d):a(...c))})},debuglog(){return function(){}},format(s,...a){return s.replace(/%([sdifj])/g,function(...[l,d]){const c=a.shift();return d==="f"?c.toFixed(6):d==="j"?JSON.stringify(c):d==="s"&&typeof c=="object"?`${c.constructor!==Object?c.constructor.name:""} {}`.trim():c.toString()})},inspect(s){switch(typeof s){case"string":if(s.includes("'"))if(s.includes('"')){if(!s.includes("`")&&!s.includes("${"))return`\`${s}\``}else return`"${s}"`;return`'${s}'`;case"number":return isNaN(s)?"NaN":Object.is(s,-0)?String(s):s;case"bigint":return`${String(s)}n`;case"boolean":case"undefined":return String(s);case"object":return"{}"}},types:{isAsyncFunction(s){return s instanceof t},isArrayBufferView(s){return ArrayBuffer.isView(s)}},isBlob:i},r.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(oV);var Yu=oV.exports,hD={};const{format:Hwe,inspect:HA,AggregateError:Gwe}=Yu,Ywe=globalThis.AggregateError||Gwe,Zwe=Symbol("kIsNodeError"),Jwe=["string","function","number","object","Function","Object","boolean","bigint","symbol"],Xwe=/^([A-Z][a-z0-9]*)+$/,Qwe="__node_internal_",NS={};function yy(r,e){if(!r)throw new NS.ERR_INTERNAL_ASSERTION(e)}function Bj(r){let e="",t=r.length;const n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function e_e(r,e,t){if(typeof e=="function")return yy(e.length<=t.length,`Code: ${r}; The provided arguments length (${t.length}) does not match the required ones (${e.length}).`),e(...t);const n=(e.match(/%[dfijoOs]/g)||[]).length;return yy(n===t.length,`Code: ${r}; The provided arguments length (${t.length}) does not match the required ones (${n}).`),t.length===0?e:Hwe(e,...t)}function So(r,e,t){t||(t=Error);class n extends t{constructor(...o){super(e_e(r,e,o))}toString(){return`${this.name} [${r}]: ${this.message}`}}Object.defineProperties(n.prototype,{name:{value:t.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${r}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),n.prototype.code=r,n.prototype[Zwe]=!0,NS[r]=n}function jj(r){const e=Qwe+r.name;return Object.defineProperty(r,"name",{value:e}),r}function t_e(r,e){if(r&&e&&r!==e){if(Array.isArray(e.errors))return e.errors.push(r),e;const t=new Ywe([e,r],e.message);return t.code=e.code,t}return r||e}let r_e=class extends Error{constructor(e="The operation was aborted",t=void 0){if(t!==void 0&&typeof t!="object")throw new NS.ERR_INVALID_ARG_TYPE("options","Object",t);super(e,t),this.code="ABORT_ERR",this.name="AbortError"}};So("ERR_ASSERTION","%s",Error);So("ERR_INVALID_ARG_TYPE",(r,e,t)=>{yy(typeof r=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let n="The ";r.endsWith(" argument")?n+=`${r} `:n+=`"${r}" ${r.includes(".")?"property":"argument"} `,n+="must be ";const i=[],o=[],s=[];for(const l of e)yy(typeof l=="string","All expected entries have to be of type string"),Jwe.includes(l)?i.push(l.toLowerCase()):Xwe.test(l)?o.push(l):(yy(l!=="object",'The value "object" should be written as "Object"'),s.push(l));if(o.length>0){const l=i.indexOf("object");l!==-1&&(i.splice(i,l,1),o.push("Object"))}if(i.length>0){switch(i.length){case 1:n+=`of type ${i[0]}`;break;case 2:n+=`one of type ${i[0]} or ${i[1]}`;break;default:{const l=i.pop();n+=`one of type ${i.join(", ")}, or ${l}`}}(o.length>0||s.length>0)&&(n+=" or ")}if(o.length>0){switch(o.length){case 1:n+=`an instance of ${o[0]}`;break;case 2:n+=`an instance of ${o[0]} or ${o[1]}`;break;default:{const l=o.pop();n+=`an instance of ${o.join(", ")}, or ${l}`}}s.length>0&&(n+=" or ")}switch(s.length){case 0:break;case 1:s[0].toLowerCase()!==s[0]&&(n+="an "),n+=`${s[0]}`;break;case 2:n+=`one of ${s[0]} or ${s[1]}`;break;default:{const l=s.pop();n+=`one of ${s.join(", ")}, or ${l}`}}if(t==null)n+=`. Received ${t}`;else if(typeof t=="function"&&t.name)n+=`. Received function ${t.name}`;else if(typeof t=="object"){var a;if((a=t.constructor)!==null&&a!==void 0&&a.name)n+=`. Received an instance of ${t.constructor.name}`;else{const l=HA(t,{depth:-1});n+=`. Received ${l}`}}else{let l=HA(t,{colors:!1});l.length>25&&(l=`${l.slice(0,25)}...`),n+=`. Received type ${typeof t} (${l})`}return n},TypeError);So("ERR_INVALID_ARG_VALUE",(r,e,t="is invalid")=>{let n=HA(e);return n.length>128&&(n=n.slice(0,128)+"..."),`The ${r.includes(".")?"property":"argument"} '${r}' ${t}. Received ${n}`},TypeError);So("ERR_INVALID_RETURN_VALUE",(r,e,t)=>{var n;const i=t!=null&&(n=t.constructor)!==null&&n!==void 0&&n.name?`instance of ${t.constructor.name}`:`type ${typeof t}`;return`Expected ${r} to be returned from the "${e}" function but got ${i}.`},TypeError);So("ERR_MISSING_ARGS",(...r)=>{yy(r.length>0,"At least one arg needs to be specified");let e;const t=r.length;switch(r=(Array.isArray(r)?r:[r]).map(n=>`"${n}"`).join(" or "),t){case 1:e+=`The ${r[0]} argument`;break;case 2:e+=`The ${r[0]} and ${r[1]} arguments`;break;default:{const n=r.pop();e+=`The ${r.join(", ")}, and ${n} arguments`}break}return`${e} must be specified`},TypeError);So("ERR_OUT_OF_RANGE",(r,e,t)=>{yy(e,'Missing "range" argument');let n;return Number.isInteger(t)&&Math.abs(t)>2**32?n=Bj(String(t)):typeof t=="bigint"?(n=String(t),(t>2n**32n||t<-(2n**32n))&&(n=Bj(n)),n+="n"):n=HA(t),`The value of "${r}" is out of range. It must be ${e}. Received ${n}`},RangeError);So("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);So("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);So("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);So("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);So("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);So("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);So("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);So("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);So("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);So("ERR_STREAM_WRITE_AFTER_END","write after end",Error);So("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var Ks={AbortError:r_e,aggregateTwoErrors:jj(t_e),hideStackFrames:jj,codes:NS};const{ArrayIsArray:pD,ArrayPrototypeIncludes:sV,ArrayPrototypeJoin:aV,ArrayPrototypeMap:n_e,NumberIsInteger:yD,NumberIsNaN:i_e,NumberMAX_SAFE_INTEGER:o_e,NumberMIN_SAFE_INTEGER:s_e,NumberParseInt:a_e,ObjectPrototypeHasOwnProperty:c_e,RegExpPrototypeExec:cV,String:l_e,StringPrototypeToUpperCase:d_e,StringPrototypeTrim:u_e}=pi,{hideStackFrames:yc,codes:{ERR_SOCKET_BAD_PORT:f_e,ERR_INVALID_ARG_TYPE:_s,ERR_INVALID_ARG_VALUE:Wv,ERR_OUT_OF_RANGE:Ly,ERR_UNKNOWN_SIGNAL:Nj}}=Ks,{normalizeEncoding:h_e}=Yu,{isAsyncFunction:p_e,isArrayBufferView:y_e}=Yu.types,Uj={};function m_e(r){return r===(r|0)}function g_e(r){return r===r>>>0}const v_e=/^[0-7]+$/,b_e="must be a 32-bit unsigned integer or an octal string";function w_e(r,e,t){if(typeof r>"u"&&(r=t),typeof r=="string"){if(cV(v_e,r)===null)throw new Wv(e,r,b_e);r=a_e(r,8)}return lV(r,e),r}const __e=yc((r,e,t=s_e,n=o_e)=>{if(typeof r!="number")throw new _s(e,"number",r);if(!yD(r))throw new Ly(e,"an integer",r);if(r<t||r>n)throw new Ly(e,`>= ${t} && <= ${n}`,r)}),E_e=yc((r,e,t=-2147483648,n=2147483647)=>{if(typeof r!="number")throw new _s(e,"number",r);if(!yD(r))throw new Ly(e,"an integer",r);if(r<t||r>n)throw new Ly(e,`>= ${t} && <= ${n}`,r)}),lV=yc((r,e,t=!1)=>{if(typeof r!="number")throw new _s(e,"number",r);if(!yD(r))throw new Ly(e,"an integer",r);const n=t?1:0,i=4294967295;if(r<n||r>i)throw new Ly(e,`>= ${n} && <= ${i}`,r)});function mD(r,e){if(typeof r!="string")throw new _s(e,"string",r)}function A_e(r,e,t=void 0,n){if(typeof r!="number")throw new _s(e,"number",r);if(t!=null&&r<t||n!=null&&r>n||(t!=null||n!=null)&&i_e(r))throw new Ly(e,`${t!=null?`>= ${t}`:""}${t!=null&&n!=null?" && ":""}${n!=null?`<= ${n}`:""}`,r)}const x_e=yc((r,e,t)=>{if(!sV(t,r)){const i="must be one of: "+aV(n_e(t,o=>typeof o=="string"?`'${o}'`:l_e(o)),", ");throw new Wv(e,r,i)}});function dV(r,e){if(typeof r!="boolean")throw new _s(e,"boolean",r)}function J$(r,e,t){return r==null||!c_e(r,e)?t:r[e]}const S_e=yc((r,e,t=null)=>{const n=J$(t,"allowArray",!1),i=J$(t,"allowFunction",!1);if(!J$(t,"nullable",!1)&&r===null||!n&&pD(r)||typeof r!="object"&&(!i||typeof r!="function"))throw new _s(e,"Object",r)}),T_e=yc((r,e)=>{if(r!=null&&typeof r!="object"&&typeof r!="function")throw new _s(e,"a dictionary",r)}),gD=yc((r,e,t=0)=>{if(!pD(r))throw new _s(e,"Array",r);if(r.length<t){const n=`must be longer than ${t}`;throw new Wv(e,r,n)}});function $_e(r,e){gD(r,e);for(let t=0;t<r.length;t++)mD(r[t],`${e}[${t}]`)}function k_e(r,e){gD(r,e);for(let t=0;t<r.length;t++)dV(r[t],`${e}[${t}]`)}function P_e(r,e="signal"){if(mD(r,e),Uj[r]===void 0)throw Uj[d_e(r)]!==void 0?new Nj(r+" (signals must use all capital letters)"):new Nj(r)}const I_e=yc((r,e="buffer")=>{if(!y_e(r))throw new _s(e,["Buffer","TypedArray","DataView"],r)});function O_e(r,e){const t=h_e(e),n=r.length;if(t==="hex"&&n%2!==0)throw new Wv("encoding",e,`is invalid for data of length ${n}`)}function C_e(r,e="Port",t=!0){if(typeof r!="number"&&typeof r!="string"||typeof r=="string"&&u_e(r).length===0||+r!==+r>>>0||r>65535||r===0&&!t)throw new f_e(e,r,t);return r|0}const R_e=yc((r,e)=>{if(r!==void 0&&(r===null||typeof r!="object"||!("aborted"in r)))throw new _s(e,"AbortSignal",r)}),D_e=yc((r,e)=>{if(typeof r!="function")throw new _s(e,"Function",r)}),M_e=yc((r,e)=>{if(typeof r!="function"||p_e(r))throw new _s(e,"Function",r)}),B_e=yc((r,e)=>{if(r!==void 0)throw new _s(e,"undefined",r)});function j_e(r,e,t){if(!sV(t,r))throw new _s(e,`('${aV(t,"|")}')`,r)}const N_e=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Lj(r,e){if(typeof r>"u"||!cV(N_e,r))throw new Wv(e,r,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function U_e(r){if(typeof r=="string")return Lj(r,"hints"),r;if(pD(r)){const e=r.length;let t="";if(e===0)return t;for(let n=0;n<e;n++){const i=r[n];Lj(i,"hints"),t+=i,n!==e-1&&(t+=", ")}return t}throw new Wv("hints",r,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var US={isInt32:m_e,isUint32:g_e,parseFileMode:w_e,validateArray:gD,validateStringArray:$_e,validateBooleanArray:k_e,validateBoolean:dV,validateBuffer:I_e,validateDictionary:T_e,validateEncoding:O_e,validateFunction:D_e,validateInt32:E_e,validateInteger:__e,validateNumber:A_e,validateObject:S_e,validateOneOf:x_e,validatePlainFunction:M_e,validatePort:C_e,validateSignalName:P_e,validateString:mD,validateUint32:lV,validateUndefined:B_e,validateUnion:j_e,validateAbortSignal:R_e,validateLinkHeaderValue:U_e},vD={exports:{}};const{Symbol:LS,SymbolAsyncIterator:Kj,SymbolIterator:zj,SymbolFor:uV}=pi,fV=LS("kDestroyed"),hV=LS("kIsErrored"),CI=LS("kIsReadable"),pV=LS("kIsDisturbed"),L_e=uV("nodejs.webstream.isClosedPromise"),K_e=uV("nodejs.webstream.controllerErrorFunction");function KS(r,e=!1){var t;return!!(r&&typeof r.pipe=="function"&&typeof r.on=="function"&&(!e||typeof r.pause=="function"&&typeof r.resume=="function")&&(!r._writableState||((t=r._readableState)===null||t===void 0?void 0:t.readable)!==!1)&&(!r._writableState||r._readableState))}function zS(r){var e;return!!(r&&typeof r.write=="function"&&typeof r.on=="function"&&(!r._readableState||((e=r._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function z_e(r){return!!(r&&typeof r.pipe=="function"&&r._readableState&&typeof r.on=="function"&&typeof r.write=="function")}function vd(r){return r&&(r._readableState||r._writableState||typeof r.write=="function"&&typeof r.on=="function"||typeof r.pipe=="function"&&typeof r.on=="function")}function yV(r){return!!(r&&!vd(r)&&typeof r.pipeThrough=="function"&&typeof r.getReader=="function"&&typeof r.cancel=="function")}function mV(r){return!!(r&&!vd(r)&&typeof r.getWriter=="function"&&typeof r.abort=="function")}function gV(r){return!!(r&&!vd(r)&&typeof r.readable=="object"&&typeof r.writable=="object")}function F_e(r){return yV(r)||mV(r)||gV(r)}function q_e(r,e){return r==null?!1:e===!0?typeof r[Kj]=="function":e===!1?typeof r[zj]=="function":typeof r[Kj]=="function"||typeof r[zj]=="function"}function FS(r){if(!vd(r))return null;const e=r._writableState,t=r._readableState,n=e||t;return!!(r.destroyed||r[fV]||n!=null&&n.destroyed)}function vV(r){if(!zS(r))return null;if(r.writableEnded===!0)return!0;const e=r._writableState;return e!=null&&e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function V_e(r,e){if(!zS(r))return null;if(r.writableFinished===!0)return!0;const t=r._writableState;return t!=null&&t.errored?!1:typeof t?.finished!="boolean"?null:!!(t.finished||e===!1&&t.ended===!0&&t.length===0)}function W_e(r){if(!KS(r))return null;if(r.readableEnded===!0)return!0;const e=r._readableState;return!e||e.errored?!1:typeof e?.ended!="boolean"?null:e.ended}function bV(r,e){if(!KS(r))return null;const t=r._readableState;return t!=null&&t.errored?!1:typeof t?.endEmitted!="boolean"?null:!!(t.endEmitted||e===!1&&t.ended===!0&&t.length===0)}function wV(r){return r&&r[CI]!=null?r[CI]:typeof r?.readable!="boolean"?null:FS(r)?!1:KS(r)&&r.readable&&!bV(r)}function _V(r){return typeof r?.writable!="boolean"?null:FS(r)?!1:zS(r)&&r.writable&&!vV(r)}function H_e(r,e){return vd(r)?FS(r)?!0:!(e?.readable!==!1&&wV(r)||e?.writable!==!1&&_V(r)):null}function G_e(r){var e,t;return vd(r)?r.writableErrored?r.writableErrored:(e=(t=r._writableState)===null||t===void 0?void 0:t.errored)!==null&&e!==void 0?e:null:null}function Y_e(r){var e,t;return vd(r)?r.readableErrored?r.readableErrored:(e=(t=r._readableState)===null||t===void 0?void 0:t.errored)!==null&&e!==void 0?e:null:null}function Z_e(r){if(!vd(r))return null;if(typeof r.closed=="boolean")return r.closed;const e=r._writableState,t=r._readableState;return typeof e?.closed=="boolean"||typeof t?.closed=="boolean"?e?.closed||t?.closed:typeof r._closed=="boolean"&&EV(r)?r._closed:null}function EV(r){return typeof r._closed=="boolean"&&typeof r._defaultKeepAlive=="boolean"&&typeof r._removedConnection=="boolean"&&typeof r._removedContLen=="boolean"}function AV(r){return typeof r._sent100=="boolean"&&EV(r)}function J_e(r){var e;return typeof r._consuming=="boolean"&&typeof r._dumped=="boolean"&&((e=r.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function X_e(r){if(!vd(r))return null;const e=r._writableState,t=r._readableState,n=e||t;return!n&&AV(r)||!!(n&&n.autoDestroy&&n.emitClose&&n.closed===!1)}function Q_e(r){var e;return!!(r&&((e=r[pV])!==null&&e!==void 0?e:r.readableDidRead||r.readableAborted))}function e1e(r){var e,t,n,i,o,s,a,l,d,c;return!!(r&&((e=(t=(n=(i=(o=(s=r[hV])!==null&&s!==void 0?s:r.readableErrored)!==null&&o!==void 0?o:r.writableErrored)!==null&&i!==void 0?i:(a=r._readableState)===null||a===void 0?void 0:a.errorEmitted)!==null&&n!==void 0?n:(l=r._writableState)===null||l===void 0?void 0:l.errorEmitted)!==null&&t!==void 0?t:(d=r._readableState)===null||d===void 0?void 0:d.errored)!==null&&e!==void 0?e:!((c=r._writableState)===null||c===void 0)&&c.errored))}var Zu={kDestroyed:fV,isDisturbed:Q_e,kIsDisturbed:pV,isErrored:e1e,kIsErrored:hV,isReadable:wV,kIsReadable:CI,kIsClosedPromise:L_e,kControllerErrorFunction:K_e,isClosed:Z_e,isDestroyed:FS,isDuplexNodeStream:z_e,isFinished:H_e,isIterable:q_e,isReadableNodeStream:KS,isReadableStream:yV,isReadableEnded:W_e,isReadableFinished:bV,isReadableErrored:Y_e,isNodeStream:vd,isWebStream:F_e,isWritable:_V,isWritableNodeStream:zS,isWritableStream:mV,isWritableEnded:vV,isWritableFinished:V_e,isWritableErrored:G_e,isServerRequest:J_e,isServerResponse:AV,willEmitClose:X_e,isTransformStream:gV};const Vf=Us,{AbortError:xV,codes:t1e}=Ks,{ERR_INVALID_ARG_TYPE:r1e,ERR_STREAM_PREMATURE_CLOSE:Fj}=t1e,{kEmptyObject:RI,once:DI}=Yu,{validateAbortSignal:n1e,validateFunction:i1e,validateObject:o1e,validateBoolean:s1e}=US,{Promise:a1e,PromisePrototypeThen:c1e}=pi,{isClosed:l1e,isReadable:qj,isReadableNodeStream:X$,isReadableStream:d1e,isReadableFinished:Vj,isReadableErrored:Wj,isWritable:Hj,isWritableNodeStream:Gj,isWritableStream:u1e,isWritableFinished:Yj,isWritableErrored:Zj,isNodeStream:f1e,willEmitClose:h1e,kIsClosedPromise:p1e}=Zu;function y1e(r){return r.setHeader&&typeof r.abort=="function"}const MI=()=>{};function SV(r,e,t){var n,i;if(arguments.length===2?(t=e,e=RI):e==null?e=RI:o1e(e,"options"),i1e(t,"callback"),n1e(e.signal,"options.signal"),t=DI(t),d1e(r)||u1e(r))return m1e(r,e,t);if(!f1e(r))throw new r1e("stream",["ReadableStream","WritableStream","Stream"],r);const o=(n=e.readable)!==null&&n!==void 0?n:X$(r),s=(i=e.writable)!==null&&i!==void 0?i:Gj(r),a=r._writableState,l=r._readableState,d=()=>{r.writable||f()};let c=h1e(r)&&X$(r)===o&&Gj(r)===s,u=Yj(r,!1);const f=()=>{u=!0,r.destroyed&&(c=!1),!(c&&(!r.readable||o))&&(!o||h)&&t.call(r)};let h=Vj(r,!1);const p=()=>{h=!0,r.destroyed&&(c=!1),!(c&&(!r.writable||s))&&(!s||u)&&t.call(r)},y=_=>{t.call(r,_)};let g=l1e(r);const w=()=>{g=!0;const _=Zj(r)||Wj(r);if(_&&typeof _!="boolean")return t.call(r,_);if(o&&!h&&X$(r,!0)&&!Vj(r,!1))return t.call(r,new Fj);if(s&&!u&&!Yj(r,!1))return t.call(r,new Fj);t.call(r)},v=()=>{g=!0;const _=Zj(r)||Wj(r);if(_&&typeof _!="boolean")return t.call(r,_);t.call(r)},m=()=>{r.req.on("finish",f)};y1e(r)?(r.on("complete",f),c||r.on("abort",w),r.req?m():r.on("request",m)):s&&!a&&(r.on("end",d),r.on("close",d)),!c&&typeof r.aborted=="boolean"&&r.on("aborted",w),r.on("end",p),r.on("finish",f),e.error!==!1&&r.on("error",y),r.on("close",w),g?Vf.nextTick(w):a!=null&&a.errorEmitted||l!=null&&l.errorEmitted?c||Vf.nextTick(v):(!o&&(!c||qj(r))&&(u||Hj(r)===!1)||!s&&(!c||Hj(r))&&(h||qj(r)===!1)||l&&r.req&&r.aborted)&&Vf.nextTick(v);const b=()=>{t=MI,r.removeListener("aborted",w),r.removeListener("complete",f),r.removeListener("abort",w),r.removeListener("request",m),r.req&&r.req.removeListener("finish",f),r.removeListener("end",d),r.removeListener("close",d),r.removeListener("finish",f),r.removeListener("end",p),r.removeListener("error",y),r.removeListener("close",w)};if(e.signal&&!g){const _=()=>{const E=t;b(),E.call(r,new xV(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)Vf.nextTick(_);else{const E=t;t=DI((...S)=>{e.signal.removeEventListener("abort",_),E.apply(r,S)}),e.signal.addEventListener("abort",_)}}return b}function m1e(r,e,t){let n=!1,i=MI;if(e.signal)if(i=()=>{n=!0,t.call(r,new xV(void 0,{cause:e.signal.reason}))},e.signal.aborted)Vf.nextTick(i);else{const s=t;t=DI((...a)=>{e.signal.removeEventListener("abort",i),s.apply(r,a)}),e.signal.addEventListener("abort",i)}const o=(...s)=>{n||Vf.nextTick(()=>t.apply(r,s))};return c1e(r[p1e].promise,o,o),MI}function g1e(r,e){var t;let n=!1;return e===null&&(e=RI),(t=e)!==null&&t!==void 0&&t.cleanup&&(s1e(e.cleanup,"cleanup"),n=e.cleanup),new a1e((i,o)=>{const s=SV(r,e,a=>{n&&s(),a?o(a):i()})})}vD.exports=SV;vD.exports.finished=g1e;var Hh=vD.exports;const Wl=Us,{aggregateTwoErrors:v1e,codes:{ERR_MULTIPLE_CALLBACK:b1e},AbortError:w1e}=Ks,{Symbol:TV}=pi,{kDestroyed:_1e,isDestroyed:E1e,isFinished:A1e,isServerRequest:x1e}=Zu,$V=TV("kDestroy"),BI=TV("kConstruct");function kV(r,e,t){r&&(r.stack,e&&!e.errored&&(e.errored=r),t&&!t.errored&&(t.errored=r))}function S1e(r,e){const t=this._readableState,n=this._writableState,i=n||t;return n!=null&&n.destroyed||t!=null&&t.destroyed?(typeof e=="function"&&e(),this):(kV(r,n,t),n&&(n.destroyed=!0),t&&(t.destroyed=!0),i.constructed?Jj(this,r,e):this.once($V,function(o){Jj(this,v1e(o,r),e)}),this)}function Jj(r,e,t){let n=!1;function i(o){if(n)return;n=!0;const s=r._readableState,a=r._writableState;kV(o,a,s),a&&(a.closed=!0),s&&(s.closed=!0),typeof t=="function"&&t(o),o?Wl.nextTick(T1e,r,o):Wl.nextTick(PV,r)}try{r._destroy(e||null,i)}catch(o){i(o)}}function T1e(r,e){jI(r,e),PV(r)}function PV(r){const e=r._readableState,t=r._writableState;t&&(t.closeEmitted=!0),e&&(e.closeEmitted=!0),(t!=null&&t.emitClose||e!=null&&e.emitClose)&&r.emit("close")}function jI(r,e){const t=r._readableState,n=r._writableState;n!=null&&n.errorEmitted||t!=null&&t.errorEmitted||(n&&(n.errorEmitted=!0),t&&(t.errorEmitted=!0),r.emit("error",e))}function $1e(){const r=this._readableState,e=this._writableState;r&&(r.constructed=!0,r.closed=!1,r.closeEmitted=!1,r.destroyed=!1,r.errored=null,r.errorEmitted=!1,r.reading=!1,r.ended=r.readable===!1,r.endEmitted=r.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function NI(r,e,t){const n=r._readableState,i=r._writableState;if(i!=null&&i.destroyed||n!=null&&n.destroyed)return this;n!=null&&n.autoDestroy||i!=null&&i.autoDestroy?r.destroy(e):e&&(e.stack,i&&!i.errored&&(i.errored=e),n&&!n.errored&&(n.errored=e),t?Wl.nextTick(jI,r,e):jI(r,e))}function k1e(r,e){if(typeof r._construct!="function")return;const t=r._readableState,n=r._writableState;t&&(t.constructed=!1),n&&(n.constructed=!1),r.once(BI,e),!(r.listenerCount(BI)>1)&&Wl.nextTick(P1e,r)}function P1e(r){let e=!1;function t(n){if(e){NI(r,n??new b1e);return}e=!0;const i=r._readableState,o=r._writableState,s=o||i;i&&(i.constructed=!0),o&&(o.constructed=!0),s.destroyed?r.emit($V,n):n?NI(r,n,!0):Wl.nextTick(I1e,r)}try{r._construct(n=>{Wl.nextTick(t,n)})}catch(n){Wl.nextTick(t,n)}}function I1e(r){r.emit(BI)}function Xj(r){return r?.setHeader&&typeof r.abort=="function"}function IV(r){r.emit("close")}function O1e(r,e){r.emit("error",e),Wl.nextTick(IV,r)}function C1e(r,e){!r||E1e(r)||(!e&&!A1e(r)&&(e=new w1e),x1e(r)?(r.socket=null,r.destroy(e)):Xj(r)?r.abort():Xj(r.req)?r.req.abort():typeof r.destroy=="function"?r.destroy(e):typeof r.close=="function"?r.close():e?Wl.nextTick(O1e,r,e):Wl.nextTick(IV,r),r.destroyed||(r[_1e]=!0))}var Hv={construct:k1e,destroyer:C1e,destroy:S1e,undestroy:$1e,errorOrDestroy:NI};const{ArrayIsArray:R1e,ObjectSetPrototypeOf:OV}=pi,{EventEmitter:qS}=dd;function VS(r){qS.call(this,r)}OV(VS.prototype,qS.prototype);OV(VS,qS);VS.prototype.pipe=function(r,e){const t=this;function n(c){r.writable&&r.write(c)===!1&&t.pause&&t.pause()}t.on("data",n);function i(){t.readable&&t.resume&&t.resume()}r.on("drain",i),!r._isStdio&&(!e||e.end!==!1)&&(t.on("end",s),t.on("close",a));let o=!1;function s(){o||(o=!0,r.end())}function a(){o||(o=!0,typeof r.destroy=="function"&&r.destroy())}function l(c){d(),qS.listenerCount(this,"error")===0&&this.emit("error",c)}UI(t,"error",l),UI(r,"error",l);function d(){t.removeListener("data",n),r.removeListener("drain",i),t.removeListener("end",s),t.removeListener("close",a),t.removeListener("error",l),r.removeListener("error",l),t.removeListener("end",d),t.removeListener("close",d),r.removeListener("close",d)}return t.on("end",d),t.on("close",d),r.on("close",d),r.emit("pipe",t),r};function UI(r,e,t){if(typeof r.prependListener=="function")return r.prependListener(e,t);!r._events||!r._events[e]?r.on(e,t):R1e(r._events[e])?r._events[e].unshift(t):r._events[e]=[t,r._events[e]]}var bD={Stream:VS,prependListener:UI},CV={exports:{}};(function(r){const{AbortError:e,codes:t}=Ks,{isNodeStream:n,isWebStream:i,kControllerErrorFunction:o}=Zu,s=Hh,{ERR_INVALID_ARG_TYPE:a}=t,l=(d,c)=>{if(typeof d!="object"||!("aborted"in d))throw new a(c,"AbortSignal",d)};r.exports.addAbortSignal=function(c,u){if(l(c,"signal"),!n(u)&&!i(u))throw new a("stream",["ReadableStream","WritableStream","Stream"],u);return r.exports.addAbortSignalNoValidate(c,u)},r.exports.addAbortSignalNoValidate=function(d,c){if(typeof d!="object"||!("aborted"in d))return c;const u=n(c)?()=>{c.destroy(new e(void 0,{cause:d.reason}))}:()=>{c[o](new e(void 0,{cause:d.reason}))};return d.aborted?u():(d.addEventListener("abort",u),s(c,()=>d.removeEventListener("abort",u))),c}})(CV);var WS=CV.exports;const{StringPrototypeSlice:Qj,SymbolIterator:D1e,TypedArrayPrototypeSet:a2,Uint8Array:M1e}=pi,{Buffer:Q$}=Dn,{inspect:B1e}=Yu;var j1e=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}unshift(e){const t={data:e,next:this.head};this.length===0&&(this.tail=t),this.head=t,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let t=this.head,n=""+t.data;for(;(t=t.next)!==null;)n+=e+t.data;return n}concat(e){if(this.length===0)return Q$.alloc(0);const t=Q$.allocUnsafe(e>>>0);let n=this.head,i=0;for(;n;)a2(t,n.data,i),i+=n.data.length,n=n.next;return t}consume(e,t){const n=this.head.data;if(e<n.length){const i=n.slice(0,e);return this.head.data=n.slice(e),i}return e===n.length?this.shift():t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[D1e](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let t="",n=this.head,i=0;do{const o=n.data;if(e>o.length)t+=o,e-=o.length;else{e===o.length?(t+=o,++i,n.next?this.head=n.next:this.head=this.tail=null):(t+=Qj(o,0,e),this.head=n,n.data=Qj(o,e));break}++i}while((n=n.next)!==null);return this.length-=i,t}_getBuffer(e){const t=Q$.allocUnsafe(e),n=e;let i=this.head,o=0;do{const s=i.data;if(e>s.length)a2(t,s,n-e),e-=s.length;else{e===s.length?(a2(t,s,n-e),++o,i.next?this.head=i.next:this.head=this.tail=null):(a2(t,new M1e(s.buffer,s.byteOffset,e),n-e),this.head=i,i.data=s.slice(e));break}++o}while((i=i.next)!==null);return this.length-=o,t}[Symbol.for("nodejs.util.inspect.custom")](e,t){return B1e(this,{...t,depth:0,customInspect:!1})}};const{MathFloor:N1e,NumberIsInteger:U1e}=pi,{ERR_INVALID_ARG_VALUE:L1e}=Ks.codes;function K1e(r,e,t){return r.highWaterMark!=null?r.highWaterMark:e?r[t]:null}function RV(r){return r?16:16*1024}function z1e(r,e,t,n){const i=K1e(e,n,t);if(i!=null){if(!U1e(i)||i<0){const o=n?`options.${t}`:"options.highWaterMark";throw new L1e(o,i)}return N1e(i)}return RV(r.objectMode)}var wD={getHighWaterMark:z1e,getDefaultHighWaterMark:RV};const e4=Us,{PromisePrototypeThen:F1e,SymbolAsyncIterator:t4,SymbolIterator:r4}=pi,{Buffer:q1e}=Dn,{ERR_INVALID_ARG_TYPE:V1e,ERR_STREAM_NULL_VALUES:W1e}=Ks.codes;function H1e(r,e,t){let n;if(typeof e=="string"||e instanceof q1e)return new r({objectMode:!0,...t,read(){this.push(e),this.push(null)}});let i;if(e&&e[t4])i=!0,n=e[t4]();else if(e&&e[r4])i=!1,n=e[r4]();else throw new V1e("iterable",["Iterable"],e);const o=new r({objectMode:!0,highWaterMark:1,...t});let s=!1;o._read=function(){s||(s=!0,l())},o._destroy=function(d,c){F1e(a(d),()=>e4.nextTick(c,d),u=>e4.nextTick(c,u||d))};async function a(d){const c=d!=null,u=typeof n.throw=="function";if(c&&u){const{value:f,done:h}=await n.throw(d);if(await f,h)return}if(typeof n.return=="function"){const{value:f}=await n.return();await f}}async function l(){for(;;){try{const{value:d,done:c}=i?await n.next():n.next();if(c)o.push(null);else{const u=d&&typeof d.then=="function"?await d:d;if(u===null)throw s=!1,new W1e;if(o.push(u))continue;s=!1}}catch(d){o.destroy(d)}break}}return o}var DV=H1e,ek,n4;function HS(){if(n4)return ek;n4=1;const r=Us,{ArrayPrototypeIndexOf:e,NumberIsInteger:t,NumberIsNaN:n,NumberParseInt:i,ObjectDefineProperties:o,ObjectKeys:s,ObjectSetPrototypeOf:a,Promise:l,SafeSet:d,SymbolAsyncIterator:c,Symbol:u}=pi;ek=D,D.ReadableState=I;const{EventEmitter:f}=dd,{Stream:h,prependListener:p}=bD,{Buffer:y}=Dn,{addAbortSignal:g}=WS,w=Hh;let v=Yu.debuglog("stream",ie=>{v=ie});const m=j1e,b=Hv,{getHighWaterMark:_,getDefaultHighWaterMark:E}=wD,{aggregateTwoErrors:S,codes:{ERR_INVALID_ARG_TYPE:T,ERR_METHOD_NOT_IMPLEMENTED:O,ERR_OUT_OF_RANGE:M,ERR_STREAM_PUSH_AFTER_EOF:Q,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:W}}=Ks,{validateObject:U}=US,ee=u("kPaused"),{StringDecoder:R}=Tw,z=DV;a(D.prototype,h.prototype),a(D,h);const K=()=>{},{errorOrDestroy:Y}=b;function I(ie,ce,H){typeof H!="boolean"&&(H=ce instanceof Du()),this.objectMode=!!(ie&&ie.objectMode),H&&(this.objectMode=this.objectMode||!!(ie&&ie.readableObjectMode)),this.highWaterMark=ie?_(this,ie,"readableHighWaterMark",H):E(!1),this.buffer=new m,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[ee]=null,this.errorEmitted=!1,this.emitClose=!ie||ie.emitClose!==!1,this.autoDestroy=!ie||ie.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=ie&&ie.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,ie&&ie.encoding&&(this.decoder=new R(ie.encoding),this.encoding=ie.encoding)}function D(ie){if(!(this instanceof D))return new D(ie);const ce=this instanceof Du();this._readableState=new I(ie,this,ce),ie&&(typeof ie.read=="function"&&(this._read=ie.read),typeof ie.destroy=="function"&&(this._destroy=ie.destroy),typeof ie.construct=="function"&&(this._construct=ie.construct),ie.signal&&!ce&&g(ie.signal,this)),h.call(this,ie),b.construct(this,()=>{this._readableState.needReadable&&te(this,this._readableState)})}D.prototype.destroy=b.destroy,D.prototype._undestroy=b.undestroy,D.prototype._destroy=function(ie,ce){ce(ie)},D.prototype[f.captureRejectionSymbol]=function(ie){this.destroy(ie)},D.prototype.push=function(ie,ce){return N(this,ie,ce,!1)},D.prototype.unshift=function(ie,ce){return N(this,ie,ce,!0)};function N(ie,ce,H,$){v("readableAddChunk",ce);const P=ie._readableState;let se;if(P.objectMode||(typeof ce=="string"?(H=H||P.defaultEncoding,P.encoding!==H&&($&&P.encoding?ce=y.from(ce,H).toString(P.encoding):(ce=y.from(ce,H),H=""))):ce instanceof y?H="":h._isUint8Array(ce)?(ce=h._uint8ArrayToBuffer(ce),H=""):ce!=null&&(se=new T("chunk",["string","Buffer","Uint8Array"],ce))),se)Y(ie,se);else if(ce===null)P.reading=!1,C(ie,P);else if(P.objectMode||ce&&ce.length>0)if($)if(P.endEmitted)Y(ie,new W);else{if(P.destroyed||P.errored)return!1;V(ie,P,ce,!0)}else if(P.ended)Y(ie,new Q);else{if(P.destroyed||P.errored)return!1;P.reading=!1,P.decoder&&!H?(ce=P.decoder.write(ce),P.objectMode||ce.length!==0?V(ie,P,ce,!1):te(ie,P)):V(ie,P,ce,!1)}else $||(P.reading=!1,te(ie,P));return!P.ended&&(P.length<P.highWaterMark||P.length===0)}function V(ie,ce,H,$){ce.flowing&&ce.length===0&&!ce.sync&&ie.listenerCount("data")>0?(ce.multiAwaitDrain?ce.awaitDrainWriters.clear():ce.awaitDrainWriters=null,ce.dataEmitted=!0,ie.emit("data",H)):(ce.length+=ce.objectMode?1:H.length,$?ce.buffer.unshift(H):ce.buffer.push(H),ce.needReadable&&F(ie)),te(ie,ce)}D.prototype.isPaused=function(){const ie=this._readableState;return ie[ee]===!0||ie.flowing===!1},D.prototype.setEncoding=function(ie){const ce=new R(ie);this._readableState.decoder=ce,this._readableState.encoding=this._readableState.decoder.encoding;const H=this._readableState.buffer;let $="";for(const P of H)$+=ce.write(P);return H.clear(),$!==""&&H.push($),this._readableState.length=$.length,this};const J=1073741824;function j(ie){if(ie>J)throw new M("size","<= 1GiB",ie);return ie--,ie|=ie>>>1,ie|=ie>>>2,ie|=ie>>>4,ie|=ie>>>8,ie|=ie>>>16,ie++,ie}function G(ie,ce){return ie<=0||ce.length===0&&ce.ended?0:ce.objectMode?1:n(ie)?ce.flowing&&ce.length?ce.buffer.first().length:ce.length:ie<=ce.length?ie:ce.ended?ce.length:0}D.prototype.read=function(ie){v("read",ie),ie===void 0?ie=NaN:t(ie)||(ie=i(ie,10));const ce=this._readableState,H=ie;if(ie>ce.highWaterMark&&(ce.highWaterMark=j(ie)),ie!==0&&(ce.emittedReadable=!1),ie===0&&ce.needReadable&&((ce.highWaterMark!==0?ce.length>=ce.highWaterMark:ce.length>0)||ce.ended))return v("read: emitReadable",ce.length,ce.ended),ce.length===0&&ce.ended?$e(this):F(this),null;if(ie=G(ie,ce),ie===0&&ce.ended)return ce.length===0&&$e(this),null;let $=ce.needReadable;if(v("need readable",$),(ce.length===0||ce.length-ie<ce.highWaterMark)&&($=!0,v("length less than watermark",$)),ce.ended||ce.reading||ce.destroyed||ce.errored||!ce.constructed)$=!1,v("reading, ended or constructing",$);else if($){v("do read"),ce.reading=!0,ce.sync=!0,ce.length===0&&(ce.needReadable=!0);try{this._read(ce.highWaterMark)}catch(se){Y(this,se)}ce.sync=!1,ce.reading||(ie=G(H,ce))}let P;return ie>0?P=_e(ie,ce):P=null,P===null?(ce.needReadable=ce.length<=ce.highWaterMark,ie=0):(ce.length-=ie,ce.multiAwaitDrain?ce.awaitDrainWriters.clear():ce.awaitDrainWriters=null),ce.length===0&&(ce.ended||(ce.needReadable=!0),H!==ie&&ce.ended&&$e(this)),P!==null&&!ce.errorEmitted&&!ce.closeEmitted&&(ce.dataEmitted=!0,this.emit("data",P)),P};function C(ie,ce){if(v("onEofChunk"),!ce.ended){if(ce.decoder){const H=ce.decoder.end();H&&H.length&&(ce.buffer.push(H),ce.length+=ce.objectMode?1:H.length)}ce.ended=!0,ce.sync?F(ie):(ce.needReadable=!1,ce.emittedReadable=!0,Z(ie))}}function F(ie){const ce=ie._readableState;v("emitReadable",ce.needReadable,ce.emittedReadable),ce.needReadable=!1,ce.emittedReadable||(v("emitReadable",ce.flowing),ce.emittedReadable=!0,r.nextTick(Z,ie))}function Z(ie){const ce=ie._readableState;v("emitReadable_",ce.destroyed,ce.length,ce.ended),!ce.destroyed&&!ce.errored&&(ce.length||ce.ended)&&(ie.emit("readable"),ce.emittedReadable=!1),ce.needReadable=!ce.flowing&&!ce.ended&&ce.length<=ce.highWaterMark,ne(ie)}function te(ie,ce){!ce.readingMore&&ce.constructed&&(ce.readingMore=!0,r.nextTick(re,ie,ce))}function re(ie,ce){for(;!ce.reading&&!ce.ended&&(ce.length<ce.highWaterMark||ce.flowing&&ce.length===0);){const H=ce.length;if(v("maybeReadMore read 0"),ie.read(0),H===ce.length)break}ce.readingMore=!1}D.prototype._read=function(ie){throw new O("_read()")},D.prototype.pipe=function(ie,ce){const H=this,$=this._readableState;$.pipes.length===1&&($.multiAwaitDrain||($.multiAwaitDrain=!0,$.awaitDrainWriters=new d($.awaitDrainWriters?[$.awaitDrainWriters]:[]))),$.pipes.push(ie),v("pipe count=%d opts=%j",$.pipes.length,ce);const se=(!ce||ce.end!==!1)&&ie!==r.stdout&&ie!==r.stderr?ve:il;$.endEmitted?r.nextTick(se):H.once("end",se),ie.on("unpipe",fe);function fe(zs,Fs){v("onunpipe"),zs===H&&Fs&&Fs.hasUnpiped===!1&&(Fs.hasUnpiped=!0,Ft())}function ve(){v("onend"),ie.end()}let Ee,pt=!1;function Ft(){v("cleanup"),ie.removeListener("close",Xu),ie.removeListener("finish",nl),Ee&&ie.removeListener("drain",Ee),ie.removeListener("error",Jt),ie.removeListener("unpipe",fe),H.removeListener("end",ve),H.removeListener("end",il),H.removeListener("data",Mt),pt=!0,Ee&&$.awaitDrainWriters&&(!ie._writableState||ie._writableState.needDrain)&&Ee()}function ir(){pt||($.pipes.length===1&&$.pipes[0]===ie?(v("false write response, pause",0),$.awaitDrainWriters=ie,$.multiAwaitDrain=!1):$.pipes.length>1&&$.pipes.includes(ie)&&(v("false write response, pause",$.awaitDrainWriters.size),$.awaitDrainWriters.add(ie)),H.pause()),Ee||(Ee=q(H,ie),ie.on("drain",Ee))}H.on("data",Mt);function Mt(zs){v("ondata");const Fs=ie.write(zs);v("dest.write",Fs),Fs===!1&&ir()}function Jt(zs){if(v("onerror",zs),il(),ie.removeListener("error",Jt),ie.listenerCount("error")===0){const Fs=ie._writableState||ie._readableState;Fs&&!Fs.errorEmitted?Y(ie,zs):ie.emit("error",zs)}}p(ie,"error",Jt);function Xu(){ie.removeListener("finish",nl),il()}ie.once("close",Xu);function nl(){v("onfinish"),ie.removeListener("close",Xu),il()}ie.once("finish",nl);function il(){v("unpipe"),H.unpipe(ie)}return ie.emit("pipe",H),ie.writableNeedDrain===!0?$.flowing&&ir():$.flowing||(v("pipe resume"),H.resume()),ie};function q(ie,ce){return function(){const $=ie._readableState;$.awaitDrainWriters===ce?(v("pipeOnDrain",1),$.awaitDrainWriters=null):$.multiAwaitDrain&&(v("pipeOnDrain",$.awaitDrainWriters.size),$.awaitDrainWriters.delete(ce)),(!$.awaitDrainWriters||$.awaitDrainWriters.size===0)&&ie.listenerCount("data")&&ie.resume()}}D.prototype.unpipe=function(ie){const ce=this._readableState,H={hasUnpiped:!1};if(ce.pipes.length===0)return this;if(!ie){const P=ce.pipes;ce.pipes=[],this.pause();for(let se=0;se<P.length;se++)P[se].emit("unpipe",this,{hasUnpiped:!1});return this}const $=e(ce.pipes,ie);return $===-1?this:(ce.pipes.splice($,1),ce.pipes.length===0&&this.pause(),ie.emit("unpipe",this,H),this)},D.prototype.on=function(ie,ce){const H=h.prototype.on.call(this,ie,ce),$=this._readableState;return ie==="data"?($.readableListening=this.listenerCount("readable")>0,$.flowing!==!1&&this.resume()):ie==="readable"&&!$.endEmitted&&!$.readableListening&&($.readableListening=$.needReadable=!0,$.flowing=!1,$.emittedReadable=!1,v("on readable",$.length,$.reading),$.length?F(this):$.reading||r.nextTick(k,this)),H},D.prototype.addListener=D.prototype.on,D.prototype.removeListener=function(ie,ce){const H=h.prototype.removeListener.call(this,ie,ce);return ie==="readable"&&r.nextTick(L,this),H},D.prototype.off=D.prototype.removeListener,D.prototype.removeAllListeners=function(ie){const ce=h.prototype.removeAllListeners.apply(this,arguments);return(ie==="readable"||ie===void 0)&&r.nextTick(L,this),ce};function L(ie){const ce=ie._readableState;ce.readableListening=ie.listenerCount("readable")>0,ce.resumeScheduled&&ce[ee]===!1?ce.flowing=!0:ie.listenerCount("data")>0?ie.resume():ce.readableListening||(ce.flowing=null)}function k(ie){v("readable nexttick read 0"),ie.read(0)}D.prototype.resume=function(){const ie=this._readableState;return ie.flowing||(v("resume"),ie.flowing=!ie.readableListening,B(this,ie)),ie[ee]=!1,this};function B(ie,ce){ce.resumeScheduled||(ce.resumeScheduled=!0,r.nextTick(X,ie,ce))}function X(ie,ce){v("resume",ce.reading),ce.reading||ie.read(0),ce.resumeScheduled=!1,ie.emit("resume"),ne(ie),ce.flowing&&!ce.reading&&ie.read(0)}D.prototype.pause=function(){return v("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(v("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[ee]=!0,this};function ne(ie){const ce=ie._readableState;for(v("flow",ce.flowing);ce.flowing&&ie.read()!==null;);}D.prototype.wrap=function(ie){let ce=!1;ie.on("data",$=>{!this.push($)&&ie.pause&&(ce=!0,ie.pause())}),ie.on("end",()=>{this.push(null)}),ie.on("error",$=>{Y(this,$)}),ie.on("close",()=>{this.destroy()}),ie.on("destroy",()=>{this.destroy()}),this._read=()=>{ce&&ie.resume&&(ce=!1,ie.resume())};const H=s(ie);for(let $=1;$<H.length;$++){const P=H[$];this[P]===void 0&&typeof ie[P]=="function"&&(this[P]=ie[P].bind(ie))}return this},D.prototype[c]=function(){return ae(this)},D.prototype.iterator=function(ie){return ie!==void 0&&U(ie,"options"),ae(this,ie)};function ae(ie,ce){typeof ie.read!="function"&&(ie=D.wrap(ie,{objectMode:!0}));const H=ye(ie,ce);return H.stream=ie,H}async function*ye(ie,ce){let H=K;function $(fe){this===ie?(H(),H=K):H=fe}ie.on("readable",$);let P;const se=w(ie,{writable:!1},fe=>{P=fe?S(P,fe):null,H(),H=K});try{for(;;){const fe=ie.destroyed?null:ie.read();if(fe!==null)yield fe;else{if(P)throw P;if(P===null)return;await new l($)}}}catch(fe){throw P=S(P,fe),P}finally{(P||ce?.destroyOnReturn!==!1)&&(P===void 0||ie._readableState.autoDestroy)?b.destroyer(ie,null):(ie.off("readable",$),se())}}o(D.prototype,{readable:{__proto__:null,get(){const ie=this._readableState;return!!ie&&ie.readable!==!1&&!ie.destroyed&&!ie.errorEmitted&&!ie.endEmitted},set(ie){this._readableState&&(this._readableState.readable=!!ie)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(ie){this._readableState&&(this._readableState.flowing=ie)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(ie){this._readableState&&(this._readableState.destroyed=ie)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),o(I.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[ee]!==!1},set(ie){this[ee]=!!ie}}}),D._fromList=_e;function _e(ie,ce){if(ce.length===0)return null;let H;return ce.objectMode?H=ce.buffer.shift():!ie||ie>=ce.length?(ce.decoder?H=ce.buffer.join(""):ce.buffer.length===1?H=ce.buffer.first():H=ce.buffer.concat(ce.length),ce.buffer.clear()):H=ce.buffer.consume(ie,ce.decoder),H}function $e(ie){const ce=ie._readableState;v("endReadable",ce.endEmitted),ce.endEmitted||(ce.ended=!0,r.nextTick(Ce,ce,ie))}function Ce(ie,ce){if(v("endReadableNT",ie.endEmitted,ie.length),!ie.errored&&!ie.closeEmitted&&!ie.endEmitted&&ie.length===0){if(ie.endEmitted=!0,ce.emit("end"),ce.writable&&ce.allowHalfOpen===!1)r.nextTick(Te,ce);else if(ie.autoDestroy){const H=ce._writableState;(!H||H.autoDestroy&&(H.finished||H.writable===!1))&&ce.destroy()}}}function Te(ie){ie.writable&&!ie.writableEnded&&!ie.destroyed&&ie.end()}D.from=function(ie,ce){return z(D,ie,ce)};let ze;function ht(){return ze===void 0&&(ze={}),ze}return D.fromWeb=function(ie,ce){return ht().newStreamReadableFromReadableStream(ie,ce)},D.toWeb=function(ie,ce){return ht().newReadableStreamFromStreamReadable(ie,ce)},D.wrap=function(ie,ce){var H,$;return new D({objectMode:(H=($=ie.readableObjectMode)!==null&&$!==void 0?$:ie.objectMode)!==null&&H!==void 0?H:!0,...ce,destroy(P,se){b.destroyer(ie,P),se(P)}}).wrap(ie)},ek}var tk,i4;function MV(){if(i4)return tk;i4=1;const r=Us,{ArrayPrototypeSlice:e,Error:t,FunctionPrototypeSymbolHasInstance:n,ObjectDefineProperty:i,ObjectDefineProperties:o,ObjectSetPrototypeOf:s,StringPrototypeToLowerCase:a,Symbol:l,SymbolHasInstance:d}=pi;tk=R,R.WritableState=U;const{EventEmitter:c}=dd,u=bD.Stream,{Buffer:f}=Dn,h=Hv,{addAbortSignal:p}=WS,{getHighWaterMark:y,getDefaultHighWaterMark:g}=wD,{ERR_INVALID_ARG_TYPE:w,ERR_METHOD_NOT_IMPLEMENTED:v,ERR_MULTIPLE_CALLBACK:m,ERR_STREAM_CANNOT_PIPE:b,ERR_STREAM_DESTROYED:_,ERR_STREAM_ALREADY_FINISHED:E,ERR_STREAM_NULL_VALUES:S,ERR_STREAM_WRITE_AFTER_END:T,ERR_UNKNOWN_ENCODING:O}=Ks.codes,{errorOrDestroy:M}=h;s(R.prototype,u.prototype),s(R,u);function Q(){}const W=l("kOnFinished");function U(k,B,X){typeof X!="boolean"&&(X=B instanceof Du()),this.objectMode=!!(k&&k.objectMode),X&&(this.objectMode=this.objectMode||!!(k&&k.writableObjectMode)),this.highWaterMark=k?y(this,k,"writableHighWaterMark",X):g(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const ne=!!(k&&k.decodeStrings===!1);this.decodeStrings=!ne,this.defaultEncoding=k&&k.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=D.bind(void 0,B),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,ee(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!k||k.emitClose!==!1,this.autoDestroy=!k||k.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[W]=[]}function ee(k){k.buffered=[],k.bufferedIndex=0,k.allBuffers=!0,k.allNoop=!0}U.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},i(U.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function R(k){const B=this instanceof Du();if(!B&&!n(R,this))return new R(k);this._writableState=new U(k,this,B),k&&(typeof k.write=="function"&&(this._write=k.write),typeof k.writev=="function"&&(this._writev=k.writev),typeof k.destroy=="function"&&(this._destroy=k.destroy),typeof k.final=="function"&&(this._final=k.final),typeof k.construct=="function"&&(this._construct=k.construct),k.signal&&p(k.signal,this)),u.call(this,k),h.construct(this,()=>{const X=this._writableState;X.writing||j(this,X),Z(this,X)})}i(R,d,{__proto__:null,value:function(k){return n(this,k)?!0:this!==R?!1:k&&k._writableState instanceof U}}),R.prototype.pipe=function(){M(this,new b)};function z(k,B,X,ne){const ae=k._writableState;if(typeof X=="function")ne=X,X=ae.defaultEncoding;else{if(!X)X=ae.defaultEncoding;else if(X!=="buffer"&&!f.isEncoding(X))throw new O(X);typeof ne!="function"&&(ne=Q)}if(B===null)throw new S;if(!ae.objectMode)if(typeof B=="string")ae.decodeStrings!==!1&&(B=f.from(B,X),X="buffer");else if(B instanceof f)X="buffer";else if(u._isUint8Array(B))B=u._uint8ArrayToBuffer(B),X="buffer";else throw new w("chunk",["string","Buffer","Uint8Array"],B);let ye;return ae.ending?ye=new T:ae.destroyed&&(ye=new _("write")),ye?(r.nextTick(ne,ye),M(k,ye,!0),ye):(ae.pendingcb++,K(k,ae,B,X,ne))}R.prototype.write=function(k,B,X){return z(this,k,B,X)===!0},R.prototype.cork=function(){this._writableState.corked++},R.prototype.uncork=function(){const k=this._writableState;k.corked&&(k.corked--,k.writing||j(this,k))},R.prototype.setDefaultEncoding=function(B){if(typeof B=="string"&&(B=a(B)),!f.isEncoding(B))throw new O(B);return this._writableState.defaultEncoding=B,this};function K(k,B,X,ne,ae){const ye=B.objectMode?1:X.length;B.length+=ye;const _e=B.length<B.highWaterMark;return _e||(B.needDrain=!0),B.writing||B.corked||B.errored||!B.constructed?(B.buffered.push({chunk:X,encoding:ne,callback:ae}),B.allBuffers&&ne!=="buffer"&&(B.allBuffers=!1),B.allNoop&&ae!==Q&&(B.allNoop=!1)):(B.writelen=ye,B.writecb=ae,B.writing=!0,B.sync=!0,k._write(X,ne,B.onwrite),B.sync=!1),_e&&!B.errored&&!B.destroyed}function Y(k,B,X,ne,ae,ye,_e){B.writelen=ne,B.writecb=_e,B.writing=!0,B.sync=!0,B.destroyed?B.onwrite(new _("write")):X?k._writev(ae,B.onwrite):k._write(ae,ye,B.onwrite),B.sync=!1}function I(k,B,X,ne){--B.pendingcb,ne(X),J(B),M(k,X)}function D(k,B){const X=k._writableState,ne=X.sync,ae=X.writecb;if(typeof ae!="function"){M(k,new m);return}X.writing=!1,X.writecb=null,X.length-=X.writelen,X.writelen=0,B?(B.stack,X.errored||(X.errored=B),k._readableState&&!k._readableState.errored&&(k._readableState.errored=B),ne?r.nextTick(I,k,X,B,ae):I(k,X,B,ae)):(X.buffered.length>X.bufferedIndex&&j(k,X),ne?X.afterWriteTickInfo!==null&&X.afterWriteTickInfo.cb===ae?X.afterWriteTickInfo.count++:(X.afterWriteTickInfo={count:1,cb:ae,stream:k,state:X},r.nextTick(N,X.afterWriteTickInfo)):V(k,X,1,ae))}function N({stream:k,state:B,count:X,cb:ne}){return B.afterWriteTickInfo=null,V(k,B,X,ne)}function V(k,B,X,ne){for(!B.ending&&!k.destroyed&&B.length===0&&B.needDrain&&(B.needDrain=!1,k.emit("drain"));X-- >0;)B.pendingcb--,ne();B.destroyed&&J(B),Z(k,B)}function J(k){if(k.writing)return;for(let ae=k.bufferedIndex;ae<k.buffered.length;++ae){var B;const{chunk:ye,callback:_e}=k.buffered[ae],$e=k.objectMode?1:ye.length;k.length-=$e,_e((B=k.errored)!==null&&B!==void 0?B:new _("write"))}const X=k[W].splice(0);for(let ae=0;ae<X.length;ae++){var ne;X[ae]((ne=k.errored)!==null&&ne!==void 0?ne:new _("end"))}ee(k)}function j(k,B){if(B.corked||B.bufferProcessing||B.destroyed||!B.constructed)return;const{buffered:X,bufferedIndex:ne,objectMode:ae}=B,ye=X.length-ne;if(!ye)return;let _e=ne;if(B.bufferProcessing=!0,ye>1&&k._writev){B.pendingcb-=ye-1;const $e=B.allNoop?Q:Te=>{for(let ze=_e;ze<X.length;++ze)X[ze].callback(Te)},Ce=B.allNoop&&_e===0?X:e(X,_e);Ce.allBuffers=B.allBuffers,Y(k,B,!0,B.length,Ce,"",$e),ee(B)}else{do{const{chunk:$e,encoding:Ce,callback:Te}=X[_e];X[_e++]=null;const ze=ae?1:$e.length;Y(k,B,!1,ze,$e,Ce,Te)}while(_e<X.length&&!B.writing);_e===X.length?ee(B):_e>256?(X.splice(0,_e),B.bufferedIndex=0):B.bufferedIndex=_e}B.bufferProcessing=!1}R.prototype._write=function(k,B,X){if(this._writev)this._writev([{chunk:k,encoding:B}],X);else throw new v("_write()")},R.prototype._writev=null,R.prototype.end=function(k,B,X){const ne=this._writableState;typeof k=="function"?(X=k,k=null,B=null):typeof B=="function"&&(X=B,B=null);let ae;if(k!=null){const ye=z(this,k,B);ye instanceof t&&(ae=ye)}return ne.corked&&(ne.corked=1,this.uncork()),ae||(!ne.errored&&!ne.ending?(ne.ending=!0,Z(this,ne,!0),ne.ended=!0):ne.finished?ae=new E("end"):ne.destroyed&&(ae=new _("end"))),typeof X=="function"&&(ae||ne.finished?r.nextTick(X,ae):ne[W].push(X)),this};function G(k){return k.ending&&!k.destroyed&&k.constructed&&k.length===0&&!k.errored&&k.buffered.length===0&&!k.finished&&!k.writing&&!k.errorEmitted&&!k.closeEmitted}function C(k,B){let X=!1;function ne(ae){if(X){M(k,ae??m());return}if(X=!0,B.pendingcb--,ae){const ye=B[W].splice(0);for(let _e=0;_e<ye.length;_e++)ye[_e](ae);M(k,ae,B.sync)}else G(B)&&(B.prefinished=!0,k.emit("prefinish"),B.pendingcb++,r.nextTick(te,k,B))}B.sync=!0,B.pendingcb++;try{k._final(ne)}catch(ae){ne(ae)}B.sync=!1}function F(k,B){!B.prefinished&&!B.finalCalled&&(typeof k._final=="function"&&!B.destroyed?(B.finalCalled=!0,C(k,B)):(B.prefinished=!0,k.emit("prefinish")))}function Z(k,B,X){G(B)&&(F(k,B),B.pendingcb===0&&(X?(B.pendingcb++,r.nextTick((ne,ae)=>{G(ae)?te(ne,ae):ae.pendingcb--},k,B)):G(B)&&(B.pendingcb++,te(k,B))))}function te(k,B){B.pendingcb--,B.finished=!0;const X=B[W].splice(0);for(let ne=0;ne<X.length;ne++)X[ne]();if(k.emit("finish"),B.autoDestroy){const ne=k._readableState;(!ne||ne.autoDestroy&&(ne.endEmitted||ne.readable===!1))&&k.destroy()}}o(R.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(k){this._writableState&&(this._writableState.destroyed=k)}},writable:{__proto__:null,get(){const k=this._writableState;return!!k&&k.writable!==!1&&!k.destroyed&&!k.errored&&!k.ending&&!k.ended},set(k){this._writableState&&(this._writableState.writable=!!k)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const k=this._writableState;return k?!k.destroyed&&!k.ending&&k.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const re=h.destroy;R.prototype.destroy=function(k,B){const X=this._writableState;return!X.destroyed&&(X.bufferedIndex<X.buffered.length||X[W].length)&&r.nextTick(J,X),re.call(this,k,B),this},R.prototype._undestroy=h.undestroy,R.prototype._destroy=function(k,B){B(k)},R.prototype[c.captureRejectionSymbol]=function(k){this.destroy(k)};let q;function L(){return q===void 0&&(q={}),q}return R.fromWeb=function(k,B){return L().newStreamWritableFromWritableStream(k,B)},R.toWeb=function(k){return L().newWritableStreamFromStreamWritable(k)},tk}var rk,o4;function G1e(){if(o4)return rk;o4=1;const r=Us,e=Dn,{isReadable:t,isWritable:n,isIterable:i,isNodeStream:o,isReadableNodeStream:s,isWritableNodeStream:a,isDuplexNodeStream:l}=Zu,d=Hh,{AbortError:c,codes:{ERR_INVALID_ARG_TYPE:u,ERR_INVALID_RETURN_VALUE:f}}=Ks,{destroyer:h}=Hv,p=Du(),y=HS(),{createDeferredPromise:g}=Yu,w=DV,v=globalThis.Blob||e.Blob,m=typeof v<"u"?function(M){return M instanceof v}:function(M){return!1},b=globalThis.AbortController||kh().AbortController,{FunctionPrototypeCall:_}=pi;class E extends p{constructor(M){super(M),M?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),M?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}rk=function O(M,Q){if(l(M))return M;if(s(M))return T({readable:M});if(a(M))return T({writable:M});if(o(M))return T({writable:!1,readable:!1});if(typeof M=="function"){const{value:U,write:ee,final:R,destroy:z}=S(M);if(i(U))return w(E,U,{objectMode:!0,write:ee,final:R,destroy:z});const K=U?.then;if(typeof K=="function"){let Y;const I=_(K,U,D=>{if(D!=null)throw new f("nully","body",D)},D=>{h(Y,D)});return Y=new E({objectMode:!0,readable:!1,write:ee,final(D){R(async()=>{try{await I,r.nextTick(D,null)}catch(N){r.nextTick(D,N)}})},destroy:z})}throw new f("Iterable, AsyncIterable or AsyncFunction",Q,U)}if(m(M))return O(M.arrayBuffer());if(i(M))return w(E,M,{objectMode:!0,writable:!1});if(typeof M?.writable=="object"||typeof M?.readable=="object"){const U=M!=null&&M.readable?s(M?.readable)?M?.readable:O(M.readable):void 0,ee=M!=null&&M.writable?a(M?.writable)?M?.writable:O(M.writable):void 0;return T({readable:U,writable:ee})}const W=M?.then;if(typeof W=="function"){let U;return _(W,M,ee=>{ee!=null&&U.push(ee),U.push(null)},ee=>{h(U,ee)}),U=new E({objectMode:!0,writable:!1,read(){}})}throw new u(Q,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],M)};function S(O){let{promise:M,resolve:Q}=g();const W=new b,U=W.signal;return{value:O(async function*(){for(;;){const R=M;M=null;const{chunk:z,done:K,cb:Y}=await R;if(r.nextTick(Y),K)return;if(U.aborted)throw new c(void 0,{cause:U.reason});({promise:M,resolve:Q}=g()),yield z}}(),{signal:U}),write(R,z,K){const Y=Q;Q=null,Y({chunk:R,done:!1,cb:K})},final(R){const z=Q;Q=null,z({done:!0,cb:R})},destroy(R,z){W.abort(),z(R)}}}function T(O){const M=O.readable&&typeof O.readable.read!="function"?y.wrap(O.readable):O.readable,Q=O.writable;let W=!!t(M),U=!!n(Q),ee,R,z,K,Y;function I(D){const N=K;K=null,N?N(D):D&&Y.destroy(D)}return Y=new E({readableObjectMode:!!(M!=null&&M.readableObjectMode),writableObjectMode:!!(Q!=null&&Q.writableObjectMode),readable:W,writable:U}),U&&(d(Q,D=>{U=!1,D&&h(M,D),I(D)}),Y._write=function(D,N,V){Q.write(D,N)?V():ee=V},Y._final=function(D){Q.end(),R=D},Q.on("drain",function(){if(ee){const D=ee;ee=null,D()}}),Q.on("finish",function(){if(R){const D=R;R=null,D()}})),W&&(d(M,D=>{W=!1,D&&h(M,D),I(D)}),M.on("readable",function(){if(z){const D=z;z=null,D()}}),M.on("end",function(){Y.push(null)}),Y._read=function(){for(;;){const D=M.read();if(D===null){z=Y._read;return}if(!Y.push(D))return}}),Y._destroy=function(D,N){!D&&K!==null&&(D=new c),z=null,ee=null,R=null,K===null?N(D):(K=N,h(Q,D),h(M,D))},Y}return rk}var nk,s4;function Du(){if(s4)return nk;s4=1;const{ObjectDefineProperties:r,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:t,ObjectSetPrototypeOf:n}=pi;nk=s;const i=HS(),o=MV();n(s.prototype,i.prototype),n(s,i);{const c=t(o.prototype);for(let u=0;u<c.length;u++){const f=c[u];s.prototype[f]||(s.prototype[f]=o.prototype[f])}}function s(c){if(!(this instanceof s))return new s(c);i.call(this,c),o.call(this,c),c?(this.allowHalfOpen=c.allowHalfOpen!==!1,c.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),c.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}r(s.prototype,{writable:{__proto__:null,...e(o.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(o.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(o.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(o.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(o.prototype,"writableLength")},writableFinished:{__proto__:null,...e(o.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(o.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(o.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(o.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(c){this._readableState&&this._writableState&&(this._readableState.destroyed=c,this._writableState.destroyed=c)}}});let a;function l(){return a===void 0&&(a={}),a}s.fromWeb=function(c,u){return l().newStreamDuplexFromReadableWritablePair(c,u)},s.toWeb=function(c){return l().newReadableWritablePairFromDuplex(c)};let d;return s.from=function(c){return d||(d=G1e()),d(c,"body")},nk}const{ObjectSetPrototypeOf:BV,Symbol:Y1e}=pi;var jV=Mu;const{ERR_METHOD_NOT_IMPLEMENTED:Z1e}=Ks.codes,_D=Du(),{getHighWaterMark:J1e}=wD;BV(Mu.prototype,_D.prototype);BV(Mu,_D);const nw=Y1e("kCallback");function Mu(r){if(!(this instanceof Mu))return new Mu(r);const e=r?J1e(this,r,"readableHighWaterMark",!0):null;e===0&&(r={...r,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:r.writableHighWaterMark||0}),_D.call(this,r),this._readableState.sync=!1,this[nw]=null,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",X1e)}function LI(r){typeof this._flush=="function"&&!this.destroyed?this._flush((e,t)=>{if(e){r?r(e):this.destroy(e);return}t!=null&&this.push(t),this.push(null),r&&r()}):(this.push(null),r&&r())}function X1e(){this._final!==LI&&LI.call(this)}Mu.prototype._final=LI;Mu.prototype._transform=function(r,e,t){throw new Z1e("_transform()")};Mu.prototype._write=function(r,e,t){const n=this._readableState,i=this._writableState,o=n.length;this._transform(r,e,(s,a)=>{if(s){t(s);return}a!=null&&this.push(a),i.ended||o===n.length||n.length<n.highWaterMark?t():this[nw]=t})};Mu.prototype._read=function(){if(this[nw]){const r=this[nw];this[nw]=null,r()}};const{ObjectSetPrototypeOf:NV}=pi;var UV=rv;const ED=jV;NV(rv.prototype,ED.prototype);NV(rv,ED);function rv(r){if(!(this instanceof rv))return new rv(r);ED.call(this,r)}rv.prototype._transform=function(r,e,t){t(null,r)};const gb=Us,{ArrayIsArray:Q1e,Promise:e2e,SymbolAsyncIterator:t2e}=pi,GA=Hh,{once:r2e}=Yu,n2e=Hv,a4=Du(),{aggregateTwoErrors:i2e,codes:{ERR_INVALID_ARG_TYPE:KI,ERR_INVALID_RETURN_VALUE:ik,ERR_MISSING_ARGS:o2e,ERR_STREAM_DESTROYED:s2e,ERR_STREAM_PREMATURE_CLOSE:a2e},AbortError:c2e}=Ks,{validateFunction:l2e,validateAbortSignal:d2e}=US,{isIterable:bp,isReadable:ok,isReadableNodeStream:hE,isNodeStream:c4,isTransformStream:Km,isWebStream:u2e,isReadableStream:sk,isReadableEnded:f2e}=Zu,h2e=globalThis.AbortController||kh().AbortController;let ak,ck;function l4(r,e,t){let n=!1;r.on("close",()=>{n=!0});const i=GA(r,{readable:e,writable:t},o=>{n=!o});return{destroy:o=>{n||(n=!0,n2e.destroyer(r,o||new s2e("pipe")))},cleanup:i}}function p2e(r){return l2e(r[r.length-1],"streams[stream.length - 1]"),r.pop()}function lk(r){if(bp(r))return r;if(hE(r))return y2e(r);throw new KI("val",["Readable","Iterable","AsyncIterable"],r)}async function*y2e(r){ck||(ck=HS()),yield*ck.prototype[t2e].call(r)}async function c2(r,e,t,{end:n}){let i,o=null;const s=d=>{if(d&&(i=d),o){const c=o;o=null,c()}},a=()=>new e2e((d,c)=>{i?c(i):o=()=>{i?c(i):d()}});e.on("drain",s);const l=GA(e,{readable:!1},s);try{e.writableNeedDrain&&await a();for await(const d of r)e.write(d)||await a();n&&e.end(),await a(),t()}catch(d){t(i!==d?i2e(i,d):d)}finally{l(),e.off("drain",s)}}async function dk(r,e,t,{end:n}){Km(e)&&(e=e.writable);const i=e.getWriter();try{for await(const o of r)await i.ready,i.write(o).catch(()=>{});await i.ready,n&&await i.close(),t()}catch(o){try{await i.abort(o),t(o)}catch(s){t(s)}}}function m2e(...r){return LV(r,r2e(p2e(r)))}function LV(r,e,t){if(r.length===1&&Q1e(r[0])&&(r=r[0]),r.length<2)throw new o2e("streams");const n=new h2e,i=n.signal,o=t?.signal,s=[];d2e(o,"options.signal");function a(){h(new c2e)}o?.addEventListener("abort",a);let l,d;const c=[];let u=0;function f(w){h(w,--u===0)}function h(w,v){if(w&&(!l||l.code==="ERR_STREAM_PREMATURE_CLOSE")&&(l=w),!(!l&&!v)){for(;c.length;)c.shift()(l);o?.removeEventListener("abort",a),n.abort(),v&&(l||s.forEach(m=>m()),gb.nextTick(e,l,d))}}let p;for(let w=0;w<r.length;w++){const v=r[w],m=w<r.length-1,b=w>0,_=m||t?.end!==!1,E=w===r.length-1;if(c4(v)){let S=function(T){T&&T.name!=="AbortError"&&T.code!=="ERR_STREAM_PREMATURE_CLOSE"&&f(T)};if(_){const{destroy:T,cleanup:O}=l4(v,m,b);c.push(T),ok(v)&&E&&s.push(O)}v.on("error",S),ok(v)&&E&&s.push(()=>{v.removeListener("error",S)})}if(w===0)if(typeof v=="function"){if(p=v({signal:i}),!bp(p))throw new ik("Iterable, AsyncIterable or Stream","source",p)}else bp(v)||hE(v)||Km(v)?p=v:p=a4.from(v);else if(typeof v=="function"){if(Km(p)){var y;p=lk((y=p)===null||y===void 0?void 0:y.readable)}else p=lk(p);if(p=v(p,{signal:i}),m){if(!bp(p,!0))throw new ik("AsyncIterable",`transform[${w-1}]`,p)}else{var g;ak||(ak=UV);const S=new ak({objectMode:!0}),T=(g=p)===null||g===void 0?void 0:g.then;if(typeof T=="function")u++,T.call(p,Q=>{d=Q,Q!=null&&S.write(Q),_&&S.end(),gb.nextTick(f)},Q=>{S.destroy(Q),gb.nextTick(f,Q)});else if(bp(p,!0))u++,c2(p,S,f,{end:_});else if(sk(p)||Km(p)){const Q=p.readable||p;u++,c2(Q,S,f,{end:_})}else throw new ik("AsyncIterable or Promise","destination",p);p=S;const{destroy:O,cleanup:M}=l4(p,!1,!0);c.push(O),E&&s.push(M)}}else if(c4(v)){if(hE(p)){u+=2;const S=g2e(p,v,f,{end:_});ok(v)&&E&&s.push(S)}else if(Km(p)||sk(p)){const S=p.readable||p;u++,c2(S,v,f,{end:_})}else if(bp(p))u++,c2(p,v,f,{end:_});else throw new KI("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],p);p=v}else if(u2e(v)){if(hE(p))u++,dk(lk(p),v,f,{end:_});else if(sk(p)||bp(p))u++,dk(p,v,f,{end:_});else if(Km(p))u++,dk(p.readable,v,f,{end:_});else throw new KI("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],p);p=v}else p=a4.from(v)}return(i!=null&&i.aborted||o!=null&&o.aborted)&&gb.nextTick(a),p}function g2e(r,e,t,{end:n}){let i=!1;if(e.on("close",()=>{i||t(new a2e)}),r.pipe(e,{end:!1}),n){let o=function(){i=!0,e.end()};f2e(r)?gb.nextTick(o):r.once("end",o)}else t();return GA(r,{readable:!0,writable:!1},o=>{const s=r._readableState;o&&o.code==="ERR_STREAM_PREMATURE_CLOSE"&&s&&s.ended&&!s.errored&&!s.errorEmitted?r.once("end",t).once("error",t):t(o)}),GA(e,{readable:!1,writable:!0},t)}var AD={pipelineImpl:LV,pipeline:m2e};const{pipeline:v2e}=AD,l2=Du(),{destroyer:b2e}=Hv,{isNodeStream:d2,isReadable:d4,isWritable:u4,isWebStream:uk,isTransformStream:dp,isWritableStream:f4,isReadableStream:h4}=Zu,{AbortError:w2e,codes:{ERR_INVALID_ARG_VALUE:p4,ERR_MISSING_ARGS:_2e}}=Ks,E2e=Hh;var KV=function(...e){if(e.length===0)throw new _2e("streams");if(e.length===1)return l2.from(e[0]);const t=[...e];if(typeof e[0]=="function"&&(e[0]=l2.from(e[0])),typeof e[e.length-1]=="function"){const h=e.length-1;e[h]=l2.from(e[h])}for(let h=0;h<e.length;++h)if(!(!d2(e[h])&&!uk(e[h]))){if(h<e.length-1&&!(d4(e[h])||h4(e[h])||dp(e[h])))throw new p4(`streams[${h}]`,t[h],"must be readable");if(h>0&&!(u4(e[h])||f4(e[h])||dp(e[h])))throw new p4(`streams[${h}]`,t[h],"must be writable")}let n,i,o,s,a;function l(h){const p=s;s=null,p?p(h):h?a.destroy(h):!f&&!u&&a.destroy()}const d=e[0],c=v2e(e,l),u=!!(u4(d)||f4(d)||dp(d)),f=!!(d4(c)||h4(c)||dp(c));if(a=new l2({writableObjectMode:!!(d!=null&&d.writableObjectMode),readableObjectMode:!!(c!=null&&c.writableObjectMode),writable:u,readable:f}),u){if(d2(d))a._write=function(p,y,g){d.write(p,y)?g():n=g},a._final=function(p){d.end(),i=p},d.on("drain",function(){if(n){const p=n;n=null,p()}});else if(uk(d)){const y=(dp(d)?d.writable:d).getWriter();a._write=async function(g,w,v){try{await y.ready,y.write(g).catch(()=>{}),v()}catch(m){v(m)}},a._final=async function(g){try{await y.ready,y.close().catch(()=>{}),i=g}catch(w){g(w)}}}const h=dp(c)?c.readable:c;E2e(h,()=>{if(i){const p=i;i=null,p()}})}if(f){if(d2(c))c.on("readable",function(){if(o){const h=o;o=null,h()}}),c.on("end",function(){a.push(null)}),a._read=function(){for(;;){const h=c.read();if(h===null){o=a._read;return}if(!a.push(h))return}};else if(uk(c)){const p=(dp(c)?c.readable:c).getReader();a._read=async function(){for(;;)try{const{value:y,done:g}=await p.read();if(!a.push(y))return;if(g){a.push(null);return}}catch{return}}}}return a._destroy=function(h,p){!h&&s!==null&&(h=new w2e),o=null,n=null,i=null,s===null?p(h):(s=p,d2(c)&&b2e(c,h))},a};const zV=globalThis.AbortController||kh().AbortController,{codes:{ERR_INVALID_ARG_VALUE:A2e,ERR_INVALID_ARG_TYPE:r1,ERR_MISSING_ARGS:x2e,ERR_OUT_OF_RANGE:S2e},AbortError:nd}=Ks,{validateAbortSignal:om,validateInteger:T2e,validateObject:sm}=US,$2e=pi.Symbol("kWeak"),{finished:k2e}=Hh,P2e=KV,{addAbortSignalNoValidate:I2e}=WS,{isWritable:O2e,isNodeStream:C2e}=Zu,{ArrayPrototypePush:R2e,MathFloor:D2e,Number:M2e,NumberIsNaN:B2e,Promise:y4,PromiseReject:m4,PromisePrototypeThen:j2e,Symbol:FV}=pi,YA=FV("kEmpty"),g4=FV("kEof");function N2e(r,e){if(e!=null&&sm(e,"options"),e?.signal!=null&&om(e.signal,"options.signal"),C2e(r)&&!O2e(r))throw new A2e("stream",r,"must be writable");const t=P2e(this,r);return e!=null&&e.signal&&I2e(e.signal,t),t}function GS(r,e){if(typeof r!="function")throw new r1("fn",["Function","AsyncFunction"],r);e!=null&&sm(e,"options"),e?.signal!=null&&om(e.signal,"options.signal");let t=1;return e?.concurrency!=null&&(t=D2e(e.concurrency)),T2e(t,"concurrency",1),async function*(){var i,o;const s=new zV,a=this,l=[],d=s.signal,c={signal:d},u=()=>s.abort();e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted&&u(),e==null||(o=e.signal)===null||o===void 0||o.addEventListener("abort",u);let f,h,p=!1;function y(){p=!0}async function g(){try{for await(let m of a){var w;if(p)return;if(d.aborted)throw new nd;try{m=r(m,c)}catch(b){m=m4(b)}m!==YA&&(typeof((w=m)===null||w===void 0?void 0:w.catch)=="function"&&m.catch(y),l.push(m),f&&(f(),f=null),!p&&l.length&&l.length>=t&&await new y4(b=>{h=b}))}l.push(g4)}catch(m){const b=m4(m);j2e(b,void 0,y),l.push(b)}finally{var v;p=!0,f&&(f(),f=null),e==null||(v=e.signal)===null||v===void 0||v.removeEventListener("abort",u)}}g();try{for(;;){for(;l.length>0;){const w=await l[0];if(w===g4)return;if(d.aborted)throw new nd;w!==YA&&(yield w),l.shift(),h&&(h(),h=null)}await new y4(w=>{f=w})}}finally{s.abort(),p=!0,h&&(h(),h=null)}}.call(this)}function U2e(r=void 0){return r!=null&&sm(r,"options"),r?.signal!=null&&om(r.signal,"options.signal"),async function*(){let t=0;for await(const i of this){var n;if(r!=null&&(n=r.signal)!==null&&n!==void 0&&n.aborted)throw new nd({cause:r.signal.reason});yield[t++,i]}}.call(this)}async function qV(r,e=void 0){for await(const t of xD.call(this,r,e))return!0;return!1}async function L2e(r,e=void 0){if(typeof r!="function")throw new r1("fn",["Function","AsyncFunction"],r);return!await qV.call(this,async(...t)=>!await r(...t),e)}async function K2e(r,e){for await(const t of xD.call(this,r,e))return t}async function z2e(r,e){if(typeof r!="function")throw new r1("fn",["Function","AsyncFunction"],r);async function t(n,i){return await r(n,i),YA}for await(const n of GS.call(this,t,e));}function xD(r,e){if(typeof r!="function")throw new r1("fn",["Function","AsyncFunction"],r);async function t(n,i){return await r(n,i)?n:YA}return GS.call(this,t,e)}class F2e extends x2e{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function q2e(r,e,t){var n;if(typeof r!="function")throw new r1("reducer",["Function","AsyncFunction"],r);t!=null&&sm(t,"options"),t?.signal!=null&&om(t.signal,"options.signal");let i=arguments.length>1;if(t!=null&&(n=t.signal)!==null&&n!==void 0&&n.aborted){const d=new nd(void 0,{cause:t.signal.reason});throw this.once("error",()=>{}),await k2e(this.destroy(d)),d}const o=new zV,s=o.signal;if(t!=null&&t.signal){const d={once:!0,[$2e]:this};t.signal.addEventListener("abort",()=>o.abort(),d)}let a=!1;try{for await(const d of this){var l;if(a=!0,t!=null&&(l=t.signal)!==null&&l!==void 0&&l.aborted)throw new nd;i?e=await r(e,d,{signal:s}):(e=d,i=!0)}if(!a&&!i)throw new F2e}finally{o.abort()}return e}async function V2e(r){r!=null&&sm(r,"options"),r?.signal!=null&&om(r.signal,"options.signal");const e=[];for await(const n of this){var t;if(r!=null&&(t=r.signal)!==null&&t!==void 0&&t.aborted)throw new nd(void 0,{cause:r.signal.reason});R2e(e,n)}return e}function W2e(r,e){const t=GS.call(this,r,e);return async function*(){for await(const i of t)yield*i}.call(this)}function VV(r){if(r=M2e(r),B2e(r))return 0;if(r<0)throw new S2e("number",">= 0",r);return r}function H2e(r,e=void 0){return e!=null&&sm(e,"options"),e?.signal!=null&&om(e.signal,"options.signal"),r=VV(r),async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new nd;for await(const o of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new nd;r--<=0&&(yield o)}}.call(this)}function G2e(r,e=void 0){return e!=null&&sm(e,"options"),e?.signal!=null&&om(e.signal,"options.signal"),r=VV(r),async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new nd;for await(const o of this){var i;if(e!=null&&(i=e.signal)!==null&&i!==void 0&&i.aborted)throw new nd;if(r-- >0)yield o;else return}}.call(this)}hD.streamReturningOperators={asIndexedPairs:U2e,drop:H2e,filter:xD,flatMap:W2e,map:GS,take:G2e,compose:N2e};hD.promiseReturningOperators={every:L2e,forEach:z2e,reduce:q2e,toArray:V2e,some:qV,find:K2e};var fk,v4;function WV(){if(v4)return fk;v4=1;const{ArrayPrototypePop:r,Promise:e}=pi,{isIterable:t,isNodeStream:n,isWebStream:i}=Zu,{pipelineImpl:o}=AD,{finished:s}=Hh;HV();function a(...l){return new e((d,c)=>{let u,f;const h=l[l.length-1];if(h&&typeof h=="object"&&!n(h)&&!t(h)&&!i(h)){const p=r(l);u=p.signal,f=p.end}o(l,(p,y)=>{p?c(p):d(y)},{signal:u,end:f})})}return fk={finished:s,pipeline:a},fk}var b4;function HV(){if(b4)return Z$.exports;b4=1;const{Buffer:r}=Dn,{ObjectDefineProperty:e,ObjectKeys:t,ReflectApply:n}=pi,{promisify:{custom:i}}=Yu,{streamReturningOperators:o,promiseReturningOperators:s}=hD,{codes:{ERR_ILLEGAL_CONSTRUCTOR:a}}=Ks,l=KV,{pipeline:d}=AD,{destroyer:c}=Hv,u=Hh,f=WV(),h=Zu,p=Z$.exports=bD.Stream;p.isDisturbed=h.isDisturbed,p.isErrored=h.isErrored,p.isReadable=h.isReadable,p.Readable=HS();for(const g of t(o)){let v=function(...m){if(new.target)throw a();return p.Readable.from(n(w,this,m))};const w=o[g];e(v,"name",{__proto__:null,value:w.name}),e(v,"length",{__proto__:null,value:w.length}),e(p.Readable.prototype,g,{__proto__:null,value:v,enumerable:!1,configurable:!0,writable:!0})}for(const g of t(s)){let v=function(...m){if(new.target)throw a();return n(w,this,m)};const w=s[g];e(v,"name",{__proto__:null,value:w.name}),e(v,"length",{__proto__:null,value:w.length}),e(p.Readable.prototype,g,{__proto__:null,value:v,enumerable:!1,configurable:!0,writable:!0})}p.Writable=MV(),p.Duplex=Du(),p.Transform=jV,p.PassThrough=UV,p.pipeline=d;const{addAbortSignal:y}=WS;return p.addAbortSignal=y,p.finished=u,p.destroy=c,p.compose=l,e(p,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return f}}),e(d,i,{__proto__:null,enumerable:!0,get(){return f.pipeline}}),e(u,i,{__proto__:null,enumerable:!0,get(){return f.finished}}),p.Stream=p,p._isUint8Array=function(w){return w instanceof Uint8Array},p._uint8ArrayToBuffer=function(w){return r.from(w.buffer,w.byteOffset,w.byteLength)},Z$.exports}(function(r){const e=HV(),t=WV(),n=e.Readable.destroy;r.exports=e.Readable,r.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,r.exports._isUint8Array=e._isUint8Array,r.exports.isDisturbed=e.isDisturbed,r.exports.isErrored=e.isErrored,r.exports.isReadable=e.isReadable,r.exports.Readable=e.Readable,r.exports.Writable=e.Writable,r.exports.Duplex=e.Duplex,r.exports.Transform=e.Transform,r.exports.PassThrough=e.PassThrough,r.exports.addAbortSignal=e.addAbortSignal,r.exports.finished=e.finished,r.exports.destroy=e.destroy,r.exports.destroy=n,r.exports.pipeline=e.pipeline,r.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return t}}),r.exports.Stream=e.Stream,r.exports.default=r.exports})(iV);var Y2e=iV.exports,Z2e=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let GV=class{static digest(e){return Z2e(this,arguments,void 0,function*({data:t}){return lc(t)})}},SD=class{};var J2e=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let X2e=class extends SD{digest(e){return J2e(this,arguments,void 0,function*({algorithm:t,data:n}){switch(t){case"SHA-256":return yield GV.digest({data:n})}})}};function bg(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function Q2e(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function nv(r,...e){if(!Q2e(r))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function YV(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");bg(r.outputLen),bg(r.blockLen)}function ZA(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function eEe(r,e){nv(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const hk=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function TD(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}const wg=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),hl=(r,e)=>r<<32-e|r>>>e,tEe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!tEe)throw new Error("Non little-endian hardware is not supported");const rEe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function w4(r){if(!TD(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=rEe[r[t]];return e}const Cd={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function _4(r){if(r>=Cd._0&&r<=Cd._9)return r-Cd._0;if(r>=Cd._A&&r<=Cd._F)return r-(Cd._A-10);if(r>=Cd._a&&r<=Cd._f)return r-(Cd._a-10)}function nEe(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,o=0;i<t;i++,o+=2){const s=_4(r.charCodeAt(o)),a=_4(r.charCodeAt(o+1));if(s===void 0||a===void 0){const l=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}n[i]=s*16+a}return n}const iEe=async()=>{};async function oEe(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const o=Date.now()-n;o>=0&&o<e||(await iEe(),n+=o)}}function $D(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Kw(r){if(typeof r=="string"&&(r=$D(r)),!TD(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function JA(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];if(!TD(i))throw new Error("Uint8Array expected");e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const o=r[n];t.set(o,i),i+=o.length}return t}class ZV{clone(){return this._cloneInto()}}const sEe={}.toString;function aEe(r,e){if(e!==void 0&&sEe.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(r,e)}function kD(r){const e=n=>r().update(Kw(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function YS(r=32){if(hk&&typeof hk.getRandomValues=="function")return hk.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function cEe(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),l=n?4:0,d=n?0:4;r.setUint32(e+l,s,n),r.setUint32(e+d,a,n)}class PD extends ZV{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=wg(this.buffer)}update(e){ZA(this);const{view:t,buffer:n,blockLen:i}=this;e=Kw(e);const o=e.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const l=wg(e);for(;i<=o-s;s+=i)this.process(l,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ZA(this),eEe(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:o}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let u=s;u<i;u++)t[u]=0;cEe(n,i-8,BigInt(this.length*8),o),this.process(n,0);const a=wg(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=l/4,c=this.get();if(d>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<d;u++)a.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}}const lEe=(r,e,t)=>r&e^~r&t,dEe=(r,e,t)=>r&e^r&t^e&t,uEe=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_f=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ef=new Uint32Array(64);class fEe extends PD{constructor(){super(64,32,8,!1),this.A=_f[0]|0,this.B=_f[1]|0,this.C=_f[2]|0,this.D=_f[3]|0,this.E=_f[4]|0,this.F=_f[5]|0,this.G=_f[6]|0,this.H=_f[7]|0}get(){const{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:l}=this;return[e,t,n,i,o,s,a,l]}set(e,t,n,i,o,s,a,l){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=l|0}process(e,t){for(let u=0;u<16;u++,t+=4)Ef[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const f=Ef[u-15],h=Ef[u-2],p=hl(f,7)^hl(f,18)^f>>>3,y=hl(h,17)^hl(h,19)^h>>>10;Ef[u]=y+Ef[u-7]+p+Ef[u-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:d,H:c}=this;for(let u=0;u<64;u++){const f=hl(a,6)^hl(a,11)^hl(a,25),h=c+f+lEe(a,l,d)+uEe[u]+Ef[u]|0,y=(hl(n,2)^hl(n,13)^hl(n,22))+dEe(n,i,o)|0;c=d,d=l,l=a,a=s+h|0,s=o,o=i,i=n,n=h+y|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,d=d+this.G|0,c=c+this.H|0,this.set(n,i,o,s,a,l,d,c)}roundClean(){Ef.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Bu=kD(()=>new fEe);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const JV=BigInt(0),ZS=BigInt(1),hEe=BigInt(2);function id(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}const pEe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ky(r){if(!id(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=pEe[r[t]];return e}function XV(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function ID(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}const Rd={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function E4(r){if(r>=Rd._0&&r<=Rd._9)return r-Rd._0;if(r>=Rd._A&&r<=Rd._F)return r-(Rd._A-10);if(r>=Rd._a&&r<=Rd._f)return r-(Rd._a-10)}function iv(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,o=0;i<t;i++,o+=2){const s=E4(r.charCodeAt(o)),a=E4(r.charCodeAt(o+1));if(s===void 0||a===void 0){const l=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}n[i]=s*16+a}return n}function my(r){return ID(Ky(r))}function mh(r){if(!id(r))throw new Error("Uint8Array expected");return ID(Ky(Uint8Array.from(r).reverse()))}function Mi(r,e){return iv(r.toString(16).padStart(e*2,"0"))}function ov(r,e){return Mi(r,e).reverse()}function yEe(r){return iv(XV(r))}function qn(r,e,t){let n;if(typeof e=="string")try{n=iv(e)}catch(o){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${o}`)}else if(id(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(`${r} expected ${t} bytes, got ${i}`);return n}function zy(...r){let e=0;for(let i=0;i<r.length;i++){const o=r[i];if(!id(o))throw new Error("Uint8Array expected");e+=o.length}let t=new Uint8Array(e),n=0;for(let i=0;i<r.length;i++){const o=r[i];t.set(o,n),n+=o.length}return t}function mEe(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}function gEe(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function vEe(r){let e;for(e=0;r>JV;r>>=ZS,e+=1);return e}function bEe(r,e){return r>>BigInt(e)&ZS}const wEe=(r,e,t)=>r|(t?ZS:JV)<<BigInt(e),OD=r=>(hEe<<BigInt(r-1))-ZS,pk=r=>new Uint8Array(r),A4=r=>Uint8Array.from(r);function QV(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=pk(r),i=pk(r),o=0;const s=()=>{n.fill(1),i.fill(0),o=0},a=(...u)=>t(i,n,...u),l=(u=pk())=>{i=a(A4([0]),u),n=a(),u.length!==0&&(i=a(A4([1]),u),n=a())},d=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){n=a();const h=n.slice();f.push(h),u+=n.length}return zy(...f)};return(u,f)=>{s(),l(u);let h;for(;!(h=f(d()));)l();return s(),h}}const _Ee={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||id(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function am(r,e,t={}){const n=(i,o,s)=>{const a=_Ee[o];if(typeof a!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=r[i];if(!(s&&l===void 0)&&!a(l,r))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${o}`)};for(const[i,o]of Object.entries(e))n(i,o,!1);for(const[i,o]of Object.entries(t))n(i,o,!0);return r}const EEe=Object.freeze(Object.defineProperty({__proto__:null,bitGet:bEe,bitLen:vEe,bitMask:OD,bitSet:wEe,bytesToHex:Ky,bytesToNumberBE:my,bytesToNumberLE:mh,concatBytes:zy,createHmacDrbg:QV,ensureBytes:qn,equalBytes:mEe,hexToBytes:iv,hexToNumber:ID,isBytes:id,numberToBytesBE:Mi,numberToBytesLE:ov,numberToHexUnpadded:XV,numberToVarBytesBE:yEe,utf8ToBytes:gEe,validateObject:am},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ci=BigInt(0),xn=BigInt(1),Up=BigInt(2),AEe=BigInt(3),zI=BigInt(4),x4=BigInt(5),S4=BigInt(8);BigInt(9);BigInt(16);function sn(r,e){const t=r%e;return t>=Ci?t:e+t}function eW(r,e,t){if(t<=Ci||e<Ci)throw new Error("Expected power/modulo > 0");if(t===xn)return Ci;let n=xn;for(;e>Ci;)e&xn&&(n=n*r%t),r=r*r%t,e>>=xn;return n}function _n(r,e,t){let n=r;for(;e-- >Ci;)n*=n,n%=t;return n}function FI(r,e){if(r===Ci||e<=Ci)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=sn(r,e),n=e,i=Ci,o=xn;for(;t!==Ci;){const a=n/t,l=n%t,d=i-o*a;n=t,t=l,i=o,o=d}if(n!==xn)throw new Error("invert: does not exist");return sn(i,e)}function xEe(r){const e=(r-xn)/Up;let t,n,i;for(t=r-xn,n=0;t%Up===Ci;t/=Up,n++);for(i=Up;i<r&&eW(i,e,r)!==r-xn;i++);if(n===1){const s=(r+xn)/zI;return function(l,d){const c=l.pow(d,s);if(!l.eql(l.sqr(c),d))throw new Error("Cannot find square root");return c}}const o=(t+xn)/Up;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let d=n,c=a.pow(a.mul(a.ONE,i),t),u=a.pow(l,o),f=a.pow(l,t);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let y=a.sqr(f);h<d&&!a.eql(y,a.ONE);h++)y=a.sqr(y);const p=a.pow(c,xn<<BigInt(d-h-1));c=a.sqr(p),u=a.mul(u,p),f=a.mul(f,c),d=h}return u}}function SEe(r){if(r%zI===AEe){const e=(r+xn)/zI;return function(n,i){const o=n.pow(i,e);if(!n.eql(n.sqr(o),i))throw new Error("Cannot find square root");return o}}if(r%S4===x4){const e=(r-x4)/S4;return function(n,i){const o=n.mul(i,Up),s=n.pow(o,e),a=n.mul(i,s),l=n.mul(n.mul(a,Up),s),d=n.mul(a,n.sub(l,n.ONE));if(!n.eql(n.sqr(d),i))throw new Error("Cannot find square root");return d}}return xEe(r)}const TEe=(r,e)=>(sn(r,e)&xn)===xn,$Ee=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kEe(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=$Ee.reduce((n,i)=>(n[i]="function",n),e);return am(r,t)}function PEe(r,e,t){if(t<Ci)throw new Error("Expected power > 0");if(t===Ci)return r.ONE;if(t===xn)return e;let n=r.ONE,i=e;for(;t>Ci;)t&xn&&(n=r.mul(n,i)),i=r.sqr(i),t>>=xn;return n}function IEe(r,e){const t=new Array(e.length),n=e.reduce((o,s,a)=>r.is0(s)?o:(t[a]=o,r.mul(o,s)),r.ONE),i=r.inv(n);return e.reduceRight((o,s,a)=>r.is0(s)?o:(t[a]=r.mul(o,t[a]),r.mul(o,s)),i),t}function tW(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function CD(r,e,t=!1,n={}){if(r<=Ci)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:i,nByteLength:o}=tW(r,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=SEe(r),a=Object.freeze({ORDER:r,BITS:i,BYTES:o,MASK:OD(i),ZERO:Ci,ONE:xn,create:l=>sn(l,r),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Ci<=l&&l<r},is0:l=>l===Ci,isOdd:l=>(l&xn)===xn,neg:l=>sn(-l,r),eql:(l,d)=>l===d,sqr:l=>sn(l*l,r),add:(l,d)=>sn(l+d,r),sub:(l,d)=>sn(l-d,r),mul:(l,d)=>sn(l*d,r),pow:(l,d)=>PEe(a,l,d),div:(l,d)=>sn(l*FI(d,r),r),sqrN:l=>l*l,addN:(l,d)=>l+d,subN:(l,d)=>l-d,mulN:(l,d)=>l*d,inv:l=>FI(l,r),sqrt:n.sqrt||(l=>s(a,l)),invertBatch:l=>IEe(a,l),cmov:(l,d,c)=>c?d:l,toBytes:l=>t?ov(l,o):Mi(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return t?mh(l):my(l)}});return Object.freeze(a)}function OEe(r,e){if(!r.isOdd)throw new Error("Field doesn't have isOdd");const t=r.sqrt(e);return r.isOdd(t)?r.neg(t):t}function rW(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function nW(r){const e=rW(r);return e+Math.ceil(e/2)}function CEe(r,e,t=!1){const n=r.length,i=rW(e),o=nW(e);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const s=t?my(r):mh(r),a=sn(s,e-xn)+xn;return t?ov(a,i):Mi(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const REe=BigInt(0),yk=BigInt(1);function iW(r,e){const t=(i,o)=>{const s=o.negate();return i?s:o},n=i=>{const o=Math.ceil(e/i)+1,s=2**(i-1);return{windows:o,windowSize:s}};return{constTimeNegate:t,unsafeLadder(i,o){let s=r.ZERO,a=i;for(;o>REe;)o&yk&&(s=s.add(a)),a=a.double(),o>>=yk;return s},precomputeWindow(i,o){const{windows:s,windowSize:a}=n(o),l=[];let d=i,c=d;for(let u=0;u<s;u++){c=d,l.push(c);for(let f=1;f<a;f++)c=c.add(d),l.push(c);d=c.double()}return l},wNAF(i,o,s){const{windows:a,windowSize:l}=n(i);let d=r.ZERO,c=r.BASE;const u=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const y=p*l;let g=Number(s&u);s>>=h,g>l&&(g-=f,s+=yk);const w=y,v=y+Math.abs(g)-1,m=p%2!==0,b=g<0;g===0?c=c.add(t(m,o[w])):d=d.add(t(b,o[v]))}return{p:d,f:c}},wNAFCached(i,o,s,a){const l=i._WINDOW_SIZE||1;let d=o.get(i);return d||(d=this.precomputeWindow(i,l),l!==1&&o.set(i,a(d))),this.wNAF(l,d,s)}}}function RD(r){return kEe(r.Fp),am(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...tW(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function DEe(r){const e=RD(r);am(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:MEe,hexToBytes:BEe}=EEe,Jp={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(r){const{Err:e}=Jp;if(r.length<2||r[0]!==2)throw new e("Invalid signature integer tag");const t=r[1],n=r.subarray(2,t+2);if(!t||n.length!==t)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:MEe(n),l:r.subarray(t+2)}},toSig(r){const{Err:e}=Jp,t=typeof r=="string"?BEe(r):r;if(!id(t))throw new Error("ui8a expected");let n=t.length;if(n<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:i,l:o}=Jp._parseInt(t.subarray(2)),{d:s,l:a}=Jp._parseInt(o);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(r){const e=d=>Number.parseInt(d[0],16)&8?"00"+d:d,t=d=>{const c=d.toString(16);return c.length&1?`0${c}`:c},n=e(t(r.s)),i=e(t(r.r)),o=n.length/2,s=i.length/2,a=t(o),l=t(s);return`30${t(s+o+4)}02${l}${i}02${a}${n}`}},su=BigInt(0),Ga=BigInt(1);BigInt(2);const T4=BigInt(3);BigInt(4);function jEe(r){const e=DEe(r),{Fp:t}=e,n=e.toBytes||((p,y,g)=>{const w=y.toAffine();return zy(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),i=e.fromBytes||(p=>{const y=p.subarray(1),g=t.fromBytes(y.subarray(0,t.BYTES)),w=t.fromBytes(y.subarray(t.BYTES,2*t.BYTES));return{x:g,y:w}});function o(p){const{a:y,b:g}=e,w=t.sqr(p),v=t.mul(w,p);return t.add(t.add(v,t.mul(p,y)),g)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function s(p){return typeof p=="bigint"&&su<p&&p<e.n}function a(p){if(!s(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:y,nByteLength:g,wrapPrivateKey:w,n:v}=e;if(y&&typeof p!="bigint"){if(id(p)&&(p=Ky(p)),typeof p!="string"||!y.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let m;try{m=typeof p=="bigint"?p:my(qn("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return w&&(m=sn(m,v)),a(m),m}const d=new Map;function c(p){if(!(p instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(y,g,w){if(this.px=y,this.py=g,this.pz=w,y==null||!t.isValid(y))throw new Error("x required");if(g==null||!t.isValid(g))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required")}static fromAffine(y){const{x:g,y:w}=y||{};if(!y||!t.isValid(g)||!t.isValid(w))throw new Error("invalid affine point");if(y instanceof u)throw new Error("projective point not allowed");const v=m=>t.eql(m,t.ZERO);return v(g)&&v(w)?u.ZERO:new u(g,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const g=t.invertBatch(y.map(w=>w.pz));return y.map((w,v)=>w.toAffine(g[v])).map(u.fromAffine)}static fromHex(y){const g=u.fromAffine(i(qn("pointHex",y)));return g.assertValidity(),g}static fromPrivateKey(y){return u.BASE.multiply(l(y))}_setWindowSize(y){this._WINDOW_SIZE=y,d.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:y,y:g}=this.toAffine();if(!t.isValid(y)||!t.isValid(g))throw new Error("bad point: x or y not FE");const w=t.sqr(g),v=o(y);if(!t.eql(w,v))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y}=this.toAffine();if(t.isOdd)return!t.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){c(y);const{px:g,py:w,pz:v}=this,{px:m,py:b,pz:_}=y,E=t.eql(t.mul(g,_),t.mul(m,v)),S=t.eql(t.mul(w,_),t.mul(b,v));return E&&S}negate(){return new u(this.px,t.neg(this.py),this.pz)}double(){const{a:y,b:g}=e,w=t.mul(g,T4),{px:v,py:m,pz:b}=this;let _=t.ZERO,E=t.ZERO,S=t.ZERO,T=t.mul(v,v),O=t.mul(m,m),M=t.mul(b,b),Q=t.mul(v,m);return Q=t.add(Q,Q),S=t.mul(v,b),S=t.add(S,S),_=t.mul(y,S),E=t.mul(w,M),E=t.add(_,E),_=t.sub(O,E),E=t.add(O,E),E=t.mul(_,E),_=t.mul(Q,_),S=t.mul(w,S),M=t.mul(y,M),Q=t.sub(T,M),Q=t.mul(y,Q),Q=t.add(Q,S),S=t.add(T,T),T=t.add(S,T),T=t.add(T,M),T=t.mul(T,Q),E=t.add(E,T),M=t.mul(m,b),M=t.add(M,M),T=t.mul(M,Q),_=t.sub(_,T),S=t.mul(M,O),S=t.add(S,S),S=t.add(S,S),new u(_,E,S)}add(y){c(y);const{px:g,py:w,pz:v}=this,{px:m,py:b,pz:_}=y;let E=t.ZERO,S=t.ZERO,T=t.ZERO;const O=e.a,M=t.mul(e.b,T4);let Q=t.mul(g,m),W=t.mul(w,b),U=t.mul(v,_),ee=t.add(g,w),R=t.add(m,b);ee=t.mul(ee,R),R=t.add(Q,W),ee=t.sub(ee,R),R=t.add(g,v);let z=t.add(m,_);return R=t.mul(R,z),z=t.add(Q,U),R=t.sub(R,z),z=t.add(w,v),E=t.add(b,_),z=t.mul(z,E),E=t.add(W,U),z=t.sub(z,E),T=t.mul(O,R),E=t.mul(M,U),T=t.add(E,T),E=t.sub(W,T),T=t.add(W,T),S=t.mul(E,T),W=t.add(Q,Q),W=t.add(W,Q),U=t.mul(O,U),R=t.mul(M,R),W=t.add(W,U),U=t.sub(Q,U),U=t.mul(O,U),R=t.add(R,U),Q=t.mul(W,R),S=t.add(S,Q),Q=t.mul(z,R),E=t.mul(ee,E),E=t.sub(E,Q),Q=t.mul(ee,W),T=t.mul(z,T),T=t.add(T,Q),new u(E,S,T)}subtract(y){return this.add(y.negate())}is0(){return this.equals(u.ZERO)}wNAF(y){return h.wNAFCached(this,d,y,g=>{const w=t.invertBatch(g.map(v=>v.pz));return g.map((v,m)=>v.toAffine(w[m])).map(u.fromAffine)})}multiplyUnsafe(y){const g=u.ZERO;if(y===su)return g;if(a(y),y===Ga)return this;const{endo:w}=e;if(!w)return h.unsafeLadder(this,y);let{k1neg:v,k1:m,k2neg:b,k2:_}=w.splitScalar(y),E=g,S=g,T=this;for(;m>su||_>su;)m&Ga&&(E=E.add(T)),_&Ga&&(S=S.add(T)),T=T.double(),m>>=Ga,_>>=Ga;return v&&(E=E.negate()),b&&(S=S.negate()),S=new u(t.mul(S.px,w.beta),S.py,S.pz),E.add(S)}multiply(y){a(y);let g=y,w,v;const{endo:m}=e;if(m){const{k1neg:b,k1:_,k2neg:E,k2:S}=m.splitScalar(g);let{p:T,f:O}=this.wNAF(_),{p:M,f:Q}=this.wNAF(S);T=h.constTimeNegate(b,T),M=h.constTimeNegate(E,M),M=new u(t.mul(M.px,m.beta),M.py,M.pz),w=T.add(M),v=O.add(Q)}else{const{p:b,f:_}=this.wNAF(g);w=b,v=_}return u.normalizeZ([w,v])[0]}multiplyAndAddUnsafe(y,g,w){const v=u.BASE,m=(_,E)=>E===su||E===Ga||!_.equals(v)?_.multiplyUnsafe(E):_.multiply(E),b=m(this,g).add(m(y,w));return b.is0()?void 0:b}toAffine(y){const{px:g,py:w,pz:v}=this,m=this.is0();y==null&&(y=m?t.ONE:t.inv(v));const b=t.mul(g,y),_=t.mul(w,y),E=t.mul(v,y);if(m)return{x:t.ZERO,y:t.ZERO};if(!t.eql(E,t.ONE))throw new Error("invZ was invalid");return{x:b,y:_}}isTorsionFree(){const{h:y,isTorsionFree:g}=e;if(y===Ga)return!0;if(g)return g(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:g}=e;return y===Ga?this:g?g(u,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return this.assertValidity(),n(u,this,y)}toHex(y=!0){return Ky(this.toRawBytes(y))}}u.BASE=new u(e.Gx,e.Gy,t.ONE),u.ZERO=new u(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,h=iW(u,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:s}}function NEe(r){const e=RD(r);return am(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function UEe(r){const e=NEe(r),{Fp:t,n}=e,i=t.BYTES+1,o=2*t.BYTES+1;function s(R){return su<R&&R<t.ORDER}function a(R){return sn(R,n)}function l(R){return FI(R,n)}const{ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:f}=jEe({...e,toBytes(R,z,K){const Y=z.toAffine(),I=t.toBytes(Y.x),D=zy;return K?D(Uint8Array.from([z.hasEvenY()?2:3]),I):D(Uint8Array.from([4]),I,t.toBytes(Y.y))},fromBytes(R){const z=R.length,K=R[0],Y=R.subarray(1);if(z===i&&(K===2||K===3)){const I=my(Y);if(!s(I))throw new Error("Point is not on curve");const D=u(I);let N=t.sqrt(D);const V=(N&Ga)===Ga;return(K&1)===1!==V&&(N=t.neg(N)),{x:I,y:N}}else if(z===o&&K===4){const I=t.fromBytes(Y.subarray(0,t.BYTES)),D=t.fromBytes(Y.subarray(t.BYTES,2*t.BYTES));return{x:I,y:D}}else throw new Error(`Point of length ${z} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}}),h=R=>Ky(Mi(R,e.nByteLength));function p(R){const z=n>>Ga;return R>z}function y(R){return p(R)?a(-R):R}const g=(R,z,K)=>my(R.slice(z,K));class w{constructor(z,K,Y){this.r=z,this.s=K,this.recovery=Y,this.assertValidity()}static fromCompact(z){const K=e.nByteLength;return z=qn("compactSignature",z,K*2),new w(g(z,0,K),g(z,K,2*K))}static fromDER(z){const{r:K,s:Y}=Jp.toSig(qn("DER",z));return new w(K,Y)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(z){return new w(this.r,this.s,z)}recoverPublicKey(z){const{r:K,s:Y,recovery:I}=this,D=S(qn("msgHash",z));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const N=I===2||I===3?K+e.n:K;if(N>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const V=I&1?"03":"02",J=d.fromHex(V+h(N)),j=l(N),G=a(-D*j),C=a(Y*j),F=d.BASE.multiplyAndAddUnsafe(J,G,C);if(!F)throw new Error("point at infinify");return F.assertValidity(),F}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return iv(this.toDERHex())}toDERHex(){return Jp.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return iv(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const v={isValidPrivateKey(R){try{return c(R),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const R=nW(e.n);return CEe(e.randomBytes(R),e.n)},precompute(R=8,z=d.BASE){return z._setWindowSize(R),z.multiply(BigInt(3)),z}};function m(R,z=!0){return d.fromPrivateKey(R).toRawBytes(z)}function b(R){const z=id(R),K=typeof R=="string",Y=(z||K)&&R.length;return z?Y===i||Y===o:K?Y===2*i||Y===2*o:R instanceof d}function _(R,z,K=!0){if(b(R))throw new Error("first arg must be private key");if(!b(z))throw new Error("second arg must be public key");return d.fromHex(z).multiply(c(R)).toRawBytes(K)}const E=e.bits2int||function(R){const z=my(R),K=R.length*8-e.nBitLength;return K>0?z>>BigInt(K):z},S=e.bits2int_modN||function(R){return a(E(R))},T=OD(e.nBitLength);function O(R){if(typeof R!="bigint")throw new Error("bigint expected");if(!(su<=R&&R<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Mi(R,e.nByteLength)}function M(R,z,K=Q){if(["recovered","canonical"].some(te=>te in K))throw new Error("sign() legacy options not supported");const{hash:Y,randomBytes:I}=e;let{lowS:D,prehash:N,extraEntropy:V}=K;D==null&&(D=!0),R=qn("msgHash",R),N&&(R=qn("prehashed msgHash",Y(R)));const J=S(R),j=c(z),G=[O(j),O(J)];if(V!=null){const te=V===!0?I(t.BYTES):V;G.push(qn("extraEntropy",te))}const C=zy(...G),F=J;function Z(te){const re=E(te);if(!f(re))return;const q=l(re),L=d.BASE.multiply(re).toAffine(),k=a(L.x);if(k===su)return;const B=a(q*a(F+k*j));if(B===su)return;let X=(L.x===k?0:2)|Number(L.y&Ga),ne=B;return D&&p(B)&&(ne=y(B),X^=1),new w(k,ne,X)}return{seed:C,k2sig:Z}}const Q={lowS:e.lowS,prehash:!1},W={lowS:e.lowS,prehash:!1};function U(R,z,K=Q){const{seed:Y,k2sig:I}=M(R,z,K),D=e;return QV(D.hash.outputLen,D.nByteLength,D.hmac)(Y,I)}d.BASE._setWindowSize(8);function ee(R,z,K,Y=W){const I=R;if(z=qn("msgHash",z),K=qn("publicKey",K),"strict"in Y)throw new Error("options.strict was renamed to lowS");const{lowS:D,prehash:N}=Y;let V,J;try{if(typeof I=="string"||id(I))try{V=w.fromDER(I)}catch(L){if(!(L instanceof Jp.Err))throw L;V=w.fromCompact(I)}else if(typeof I=="object"&&typeof I.r=="bigint"&&typeof I.s=="bigint"){const{r:L,s:k}=I;V=new w(L,k)}else throw new Error("PARSE");J=d.fromHex(K)}catch(L){if(L.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(D&&V.hasHighS())return!1;N&&(z=e.hash(z));const{r:j,s:G}=V,C=S(z),F=l(G),Z=a(C*F),te=a(j*F),re=d.BASE.multiplyAndAddUnsafe(J,Z,te)?.toAffine();return re?a(re.x)===j:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:_,sign:U,verify:ee,ProjectivePoint:d,Signature:w,utils:v}}class oW extends ZV{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,YV(e);const n=Kw(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(n.length>i?e.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=e.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(e){return ZA(this),this.iHash.update(e),this}digestInto(e){ZA(this),nv(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=o,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const zw=(r,e,t)=>new oW(r,e).update(t).digest();zw.create=(r,e)=>new oW(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function LEe(r){return{hash:r,hmac:(e,...t)=>zw(r,e,JA(...t)),randomBytes:YS}}function sW(r,e){const t=n=>UEe({...r,...LEe(n)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const aW=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),$4=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),KEe=BigInt(1),qI=BigInt(2),k4=(r,e)=>(r+e/qI)/e;function zEe(r){const e=aW,t=BigInt(3),n=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),d=r*r*r%e,c=d*d*r%e,u=_n(c,t,e)*c%e,f=_n(u,t,e)*c%e,h=_n(f,qI,e)*d%e,p=_n(h,i,e)*h%e,y=_n(p,o,e)*p%e,g=_n(y,a,e)*y%e,w=_n(g,l,e)*g%e,v=_n(w,a,e)*y%e,m=_n(v,t,e)*c%e,b=_n(m,s,e)*p%e,_=_n(b,n,e)*d%e,E=_n(_,qI,e);if(!VI.eql(VI.sqr(E),r))throw new Error("Cannot find square root");return E}const VI=CD(aW,void 0,void 0,{sqrt:zEe}),ar=sW({a:BigInt(0),b:BigInt(7),Fp:VI,n:$4,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=$4,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-KEe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,s=BigInt("0x100000000000000000000000000000000"),a=k4(o*r,e),l=k4(-n*r,e);let d=sn(r-a*t-l*i,e),c=sn(-a*n-l*o,e);const u=d>s,f=c>s;if(u&&(d=e-d),f&&(c=e-c),d>s||c>s)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:u,k1:d,k2neg:f,k2:c}}}},Bu);BigInt(0);ar.ProjectivePoint;function FEe(r){const e=n=>{if(n!==null&&typeof n=="object"&&!Array.isArray(n)){const i=Object.keys(n).sort(),o={};for(const s of i)o[s]=e(n[s]);return o}return n},t=e(r);return JSON.stringify(t)}var qEe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const P4="urn:jwk:";function Kr(r){return qEe(this,arguments,void 0,function*({jwk:e}){const t=e.kty;let n;if(t==="EC")n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(t==="oct")n={k:e.k,kty:e.kty};else if(t==="OKP")n={crv:e.crv,kty:e.kty,x:e.x};else if(t==="RSA")n={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${t}`);tD(n);const i=FEe(n),o=Ue.string(i).toUint8Array(),s=yield GV.digest({data:o});return Ue.uint8Array(s).toBase64Url()})}function gy(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r&&"d"in r)||r.kty!=="EC"||typeof r.d!="string"||typeof r.x!="string")}function DD(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r)||"d"in r||r.kty!=="EC"||typeof r.x!="string")}function vy(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r&&"d"in r)||r.kty!=="OKP"||typeof r.d!="string"||typeof r.x!="string")}function MD(r){return!(!r||typeof r!="object"||"d"in r||!("kty"in r&&"crv"in r&&"x"in r)||r.kty!=="OKP"||typeof r.x!="string")}function VEe(r){if(!r||typeof r!="object")return!1;switch(r.kty){case"EC":case"OKP":case"RSA":return"d"in r;case"oct":return"k"in r;default:return!1}}var zi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},WEe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let ma=class ml{static adjustSignatureToLowS(e){return zi(this,arguments,void 0,function*({signature:t}){const n=ar.Signature.fromCompact(t);return n.hasHighS()?n.normalizeS().toCompactRawBytes():t})}static bytesToPrivateKey(e){return zi(this,arguments,void 0,function*({privateKeyBytes:t}){const n=yield ml.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"secp256k1",d:Ue.uint8Array(t).toBase64Url(),x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield Kr({jwk:i}),i})}static bytesToPublicKey(e){return zi(this,arguments,void 0,function*({publicKeyBytes:t}){const n=yield ml.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"secp256k1",x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield Kr({jwk:i}),i})}static compressPublicKey(e){return zi(this,arguments,void 0,function*({publicKeyBytes:t}){return ar.ProjectivePoint.fromHex(t).toRawBytes(!0)})}static computePublicKey(e){return zi(this,arguments,void 0,function*({key:t}){const n=yield ml.privateKeyToBytes({privateKey:t}),i=yield ml.getCurvePoint({keyBytes:n}),o={kty:"EC",crv:"secp256k1",x:Ue.uint8Array(i.x).toBase64Url(),y:Ue.uint8Array(i.y).toBase64Url()};return o.kid=yield Kr({jwk:o}),o})}static convertDerToCompactSignature(e){return zi(this,arguments,void 0,function*({derSignature:t}){return ar.Signature.fromDER(t).toCompactRawBytes()})}static decompressPublicKey(e){return zi(this,arguments,void 0,function*({publicKeyBytes:t}){return ar.ProjectivePoint.fromHex(t).toRawBytes(!1)})}static generateKey(){return zi(this,void 0,void 0,function*(){const e=ar.utils.randomPrivateKey(),t=yield ml.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Kr({jwk:t}),t})}static getPublicKey(e){return zi(this,arguments,void 0,function*({key:t}){var n;if(!(gy(t)&&t.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let i=WEe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield Kr({jwk:i})),i})}static privateKeyToBytes(e){return zi(this,arguments,void 0,function*({privateKey:t}){if(!gy(t))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return zi(this,arguments,void 0,function*({publicKey:t}){if(!(DD(t)&&t.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const n=new Uint8Array([4]),i=Ue.base64Url(t.x).toUint8Array(),o=Ue.base64Url(t.y).toUint8Array();return new Uint8Array([...n,...i,...o])})}static sharedSecret(e){return zi(this,arguments,void 0,function*({privateKeyA:t,publicKeyB:n}){if("x"in t&&"x"in n&&t.x===n.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const i=yield ml.privateKeyToBytes({privateKey:t}),o=yield ml.publicKeyToBytes({publicKey:n});return ar.getSharedSecret(i,o,!0).slice(1)})}static sign(e){return zi(this,arguments,void 0,function*({data:t,key:n}){const i=yield ml.privateKeyToBytes({privateKey:n}),o=lc(t);return ar.sign(o,i).toCompactRawBytes()})}static validatePrivateKey(e){return zi(this,arguments,void 0,function*({privateKeyBytes:t}){return ar.utils.isValidPrivateKey(t)})}static validatePublicKey(e){return zi(this,arguments,void 0,function*({publicKeyBytes:t}){try{ar.ProjectivePoint.fromHex(t).assertValidity()}catch{return!1}return!0})}static verify(e){return zi(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=yield ml.publicKeyToBytes({publicKey:t}),s=lc(i);return ar.verify(n,s,o,{lowS:!1})})}static getCurvePoint(e){return zi(this,arguments,void 0,function*({keyBytes:t}){t.byteLength===32&&(t=ar.getPublicKey(t));const n=ar.ProjectivePoint.fromHex(t),i=Mi(n.x,32),o=Mi(n.y,32);return{x:i,y:o}})}};/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const cW=CD(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),HEe=cW.create(BigInt("-3")),GEe=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),YEe=sW({a:HEe,b:GEe,Fp:cW,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Bu),ur=YEe;var Fi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},ZEe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let nc=class gl{static adjustSignatureToLowS(e){return Fi(this,arguments,void 0,function*({signature:t}){const n=ur.Signature.fromCompact(t);return n.hasHighS()?n.normalizeS().toCompactRawBytes():t})}static bytesToPrivateKey(e){return Fi(this,arguments,void 0,function*({privateKeyBytes:t}){const n=yield gl.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"P-256",d:Ue.uint8Array(t).toBase64Url(),x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield Kr({jwk:i}),i})}static bytesToPublicKey(e){return Fi(this,arguments,void 0,function*({publicKeyBytes:t}){const n=yield gl.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"P-256",x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield Kr({jwk:i}),i})}static compressPublicKey(e){return Fi(this,arguments,void 0,function*({publicKeyBytes:t}){return ur.ProjectivePoint.fromHex(t).toRawBytes(!0)})}static computePublicKey(e){return Fi(this,arguments,void 0,function*({key:t}){const n=yield gl.privateKeyToBytes({privateKey:t}),i=yield gl.getCurvePoint({keyBytes:n}),o={kty:"EC",crv:"P-256",x:Ue.uint8Array(i.x).toBase64Url(),y:Ue.uint8Array(i.y).toBase64Url()};return o.kid=yield Kr({jwk:o}),o})}static convertDerToCompactSignature(e){return Fi(this,arguments,void 0,function*({derSignature:t}){return ur.Signature.fromDER(t).toCompactRawBytes()})}static decompressPublicKey(e){return Fi(this,arguments,void 0,function*({publicKeyBytes:t}){return ur.ProjectivePoint.fromHex(t).toRawBytes(!1)})}static generateKey(){return Fi(this,void 0,void 0,function*(){const e=ur.utils.randomPrivateKey(),t=yield gl.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Kr({jwk:t}),t})}static getPublicKey(e){return Fi(this,arguments,void 0,function*({key:t}){var n;if(!(gy(t)&&t.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let i=ZEe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield Kr({jwk:i})),i})}static privateKeyToBytes(e){return Fi(this,arguments,void 0,function*({privateKey:t}){if(!gy(t))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Fi(this,arguments,void 0,function*({publicKey:t}){if(!(DD(t)&&t.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const n=new Uint8Array([4]),i=Ue.base64Url(t.x).toUint8Array(),o=Ue.base64Url(t.y).toUint8Array();return new Uint8Array([...n,...i,...o])})}static sharedSecret(e){return Fi(this,arguments,void 0,function*({privateKeyA:t,publicKeyB:n}){if("x"in t&&"x"in n&&t.x===n.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const i=yield gl.privateKeyToBytes({privateKey:t}),o=yield gl.publicKeyToBytes({publicKey:n});return ur.getSharedSecret(i,o,!0).slice(1)})}static sign(e){return Fi(this,arguments,void 0,function*({data:t,key:n}){const i=yield gl.privateKeyToBytes({privateKey:n}),o=lc(t);return ur.sign(o,i).toCompactRawBytes()})}static validatePrivateKey(e){return Fi(this,arguments,void 0,function*({privateKeyBytes:t}){return ur.utils.isValidPrivateKey(t)})}static validatePublicKey(e){return Fi(this,arguments,void 0,function*({publicKeyBytes:t}){try{ur.ProjectivePoint.fromHex(t).assertValidity()}catch{return!1}return!0})}static verify(e){return Fi(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=yield gl.publicKeyToBytes({publicKey:t}),s=lc(i);return ur.verify(n,s,o,{lowS:!1})})}static getCurvePoint(e){return Fi(this,arguments,void 0,function*({keyBytes:t}){t.byteLength===32&&(t=ur.getPublicKey(t));const n=ur.ProjectivePoint.fromHex(t),i=Mi(n.x,32),o=Mi(n.y,32);return{x:i,y:o}})}};var D0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let I4=class extends SD{computePublicKey(e){return D0(this,arguments,void 0,function*({key:t}){if(!gy(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(t.crv){case"secp256k1":{const n=yield ma.computePublicKey({key:t});return n.alg="ES256K",n}case"P-256":{const n=yield nc.computePublicKey({key:t});return n.alg="ES256",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}generateKey(e){return D0(this,arguments,void 0,function*({algorithm:t}){switch(t){case"ES256K":case"secp256k1":{const n=yield ma.generateKey();return n.alg="ES256K",n}case"ES256":case"secp256r1":{const n=yield nc.generateKey();return n.alg="ES256",n}}})}getPublicKey(e){return D0(this,arguments,void 0,function*({key:t}){if(!gy(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(t.crv){case"secp256k1":{const n=yield ma.getPublicKey({key:t});return n.alg="ES256K",n}case"P-256":{const n=yield nc.getPublicKey({key:t});return n.alg="ES256",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}sign(e){return D0(this,arguments,void 0,function*({key:t,data:n}){if(!gy(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(t.crv){case"secp256k1":return yield ma.sign({key:t,data:n});case"P-256":return yield nc.sign({key:t,data:n});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}verify(e){return D0(this,arguments,void 0,function*({key:t,signature:n,data:i}){if(!DD(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(t.crv){case"secp256k1":return yield ma.verify({key:t,signature:n,data:i});case"P-256":return yield nc.verify({key:t,signature:n,data:i});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}};const u2=BigInt(2**32-1),WI=BigInt(32);function lW(r,e=!1){return e?{h:Number(r&u2),l:Number(r>>WI&u2)}:{h:Number(r>>WI&u2)|0,l:Number(r&u2)|0}}function JEe(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:o,l:s}=lW(r[i],e);[t[i],n[i]]=[o,s]}return[t,n]}const XEe=(r,e)=>BigInt(r>>>0)<<WI|BigInt(e>>>0),QEe=(r,e,t)=>r>>>t,eAe=(r,e,t)=>r<<32-t|e>>>t,tAe=(r,e,t)=>r>>>t|e<<32-t,rAe=(r,e,t)=>r<<32-t|e>>>t,nAe=(r,e,t)=>r<<64-t|e>>>t-32,iAe=(r,e,t)=>r>>>t-32|e<<64-t,oAe=(r,e)=>e,sAe=(r,e)=>r,aAe=(r,e,t)=>r<<t|e>>>32-t,cAe=(r,e,t)=>e<<t|r>>>32-t,lAe=(r,e,t)=>e<<t-32|r>>>64-t,dAe=(r,e,t)=>r<<t-32|e>>>64-t;function uAe(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const fAe=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),hAe=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,pAe=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),yAe=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,mAe=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),gAe=(r,e,t,n,i,o)=>e+t+n+i+o+(r/2**32|0)|0,Wt={fromBig:lW,split:JEe,toBig:XEe,shrSH:QEe,shrSL:eAe,rotrSH:tAe,rotrSL:rAe,rotrBH:nAe,rotrBL:iAe,rotr32H:oAe,rotr32L:sAe,rotlSH:aAe,rotlSL:cAe,rotlBH:lAe,rotlBL:dAe,add:uAe,add3L:fAe,add3H:hAe,add4L:pAe,add4H:yAe,add5H:gAe,add5L:mAe},[vAe,bAe]=Wt.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Af=new Uint32Array(80),xf=new Uint32Array(80);class wAe extends PD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:o,Cl:s,Dh:a,Dl:l,Eh:d,El:c,Fh:u,Fl:f,Gh:h,Gl:p,Hh:y,Hl:g}=this;return[e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g]}set(e,t,n,i,o,s,a,l,d,c,u,f,h,p,y,g){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=o|0,this.Cl=s|0,this.Dh=a|0,this.Dl=l|0,this.Eh=d|0,this.El=c|0,this.Fh=u|0,this.Fl=f|0,this.Gh=h|0,this.Gl=p|0,this.Hh=y|0,this.Hl=g|0}process(e,t){for(let m=0;m<16;m++,t+=4)Af[m]=e.getUint32(t),xf[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const b=Af[m-15]|0,_=xf[m-15]|0,E=Wt.rotrSH(b,_,1)^Wt.rotrSH(b,_,8)^Wt.shrSH(b,_,7),S=Wt.rotrSL(b,_,1)^Wt.rotrSL(b,_,8)^Wt.shrSL(b,_,7),T=Af[m-2]|0,O=xf[m-2]|0,M=Wt.rotrSH(T,O,19)^Wt.rotrBH(T,O,61)^Wt.shrSH(T,O,6),Q=Wt.rotrSL(T,O,19)^Wt.rotrBL(T,O,61)^Wt.shrSL(T,O,6),W=Wt.add4L(S,Q,xf[m-7],xf[m-16]),U=Wt.add4H(W,E,M,Af[m-7],Af[m-16]);Af[m]=U|0,xf[m]=W|0}let{Ah:n,Al:i,Bh:o,Bl:s,Ch:a,Cl:l,Dh:d,Dl:c,Eh:u,El:f,Fh:h,Fl:p,Gh:y,Gl:g,Hh:w,Hl:v}=this;for(let m=0;m<80;m++){const b=Wt.rotrSH(u,f,14)^Wt.rotrSH(u,f,18)^Wt.rotrBH(u,f,41),_=Wt.rotrSL(u,f,14)^Wt.rotrSL(u,f,18)^Wt.rotrBL(u,f,41),E=u&h^~u&y,S=f&p^~f&g,T=Wt.add5L(v,_,S,bAe[m],xf[m]),O=Wt.add5H(T,w,b,E,vAe[m],Af[m]),M=T|0,Q=Wt.rotrSH(n,i,28)^Wt.rotrBH(n,i,34)^Wt.rotrBH(n,i,39),W=Wt.rotrSL(n,i,28)^Wt.rotrBL(n,i,34)^Wt.rotrBL(n,i,39),U=n&o^n&a^o&a,ee=i&s^i&l^s&l;w=y|0,v=g|0,y=h|0,g=p|0,h=u|0,p=f|0,{h:u,l:f}=Wt.add(d|0,c|0,O|0,M|0),d=a|0,c=l|0,a=o|0,l=s|0,o=n|0,s=i|0;const R=Wt.add3L(M,W,ee);n=Wt.add3H(R,O,Q,U),i=R|0}({h:n,l:i}=Wt.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:o,l:s}=Wt.add(this.Bh|0,this.Bl|0,o|0,s|0),{h:a,l}=Wt.add(this.Ch|0,this.Cl|0,a|0,l|0),{h:d,l:c}=Wt.add(this.Dh|0,this.Dl|0,d|0,c|0),{h:u,l:f}=Wt.add(this.Eh|0,this.El|0,u|0,f|0),{h,l:p}=Wt.add(this.Fh|0,this.Fl|0,h|0,p|0),{h:y,l:g}=Wt.add(this.Gh|0,this.Gl|0,y|0,g|0),{h:w,l:v}=Wt.add(this.Hh|0,this.Hl|0,w|0,v|0),this.set(n,i,o,s,a,l,d,c,u,f,h,p,y,g,w,v)}roundClean(){Af.fill(0),xf.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Fw=kD(()=>new wAe);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _c=BigInt(0),Ws=BigInt(1),f2=BigInt(2),_Ae=BigInt(8),EAe={zip215:!0};function AAe(r){const e=RD(r);return am(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function BD(r){const e=AAe(r),{Fp:t,n,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:l}=e,d=f2<<BigInt(a*8)-Ws,c=t.create,u=e.uvRatio||((Y,I)=>{try{return{isValid:!0,value:t.sqrt(Y*t.inv(I))}}catch{return{isValid:!1,value:_c}}}),f=e.adjustScalarBytes||(Y=>Y),h=e.domain||((Y,I,D)=>{if(I.length||D)throw new Error("Contexts/pre-hash are not supported");return Y}),p=Y=>typeof Y=="bigint"&&_c<Y,y=(Y,I)=>p(Y)&&p(I)&&Y<I,g=Y=>Y===_c||y(Y,d);function w(Y,I){if(y(Y,I))return Y;throw new Error(`Expected valid scalar < ${I}, got ${typeof Y} ${Y}`)}function v(Y){return Y===_c?Y:w(Y,n)}const m=new Map;function b(Y){if(!(Y instanceof _))throw new Error("ExtendedPoint expected")}class _{constructor(I,D,N,V){if(this.ex=I,this.ey=D,this.ez=N,this.et=V,!g(I))throw new Error("x required");if(!g(D))throw new Error("y required");if(!g(N))throw new Error("z required");if(!g(V))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(I){if(I instanceof _)throw new Error("extended point not allowed");const{x:D,y:N}=I||{};if(!g(D)||!g(N))throw new Error("invalid affine point");return new _(D,N,Ws,c(D*N))}static normalizeZ(I){const D=t.invertBatch(I.map(N=>N.ez));return I.map((N,V)=>N.toAffine(D[V])).map(_.fromAffine)}_setWindowSize(I){this._WINDOW_SIZE=I,m.delete(this)}assertValidity(){const{a:I,d:D}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:N,ey:V,ez:J,et:j}=this,G=c(N*N),C=c(V*V),F=c(J*J),Z=c(F*F),te=c(G*I),re=c(F*c(te+C)),q=c(Z+c(D*c(G*C)));if(re!==q)throw new Error("bad point: equation left != right (1)");const L=c(N*V),k=c(J*j);if(L!==k)throw new Error("bad point: equation left != right (2)")}equals(I){b(I);const{ex:D,ey:N,ez:V}=this,{ex:J,ey:j,ez:G}=I,C=c(D*G),F=c(J*V),Z=c(N*G),te=c(j*V);return C===F&&Z===te}is0(){return this.equals(_.ZERO)}negate(){return new _(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){const{a:I}=e,{ex:D,ey:N,ez:V}=this,J=c(D*D),j=c(N*N),G=c(f2*c(V*V)),C=c(I*J),F=D+N,Z=c(c(F*F)-J-j),te=C+j,re=te-G,q=C-j,L=c(Z*re),k=c(te*q),B=c(Z*q),X=c(re*te);return new _(L,k,X,B)}add(I){b(I);const{a:D,d:N}=e,{ex:V,ey:J,ez:j,et:G}=this,{ex:C,ey:F,ez:Z,et:te}=I;if(D===BigInt(-1)){const Te=c((J-V)*(F+C)),ze=c((J+V)*(F-C)),ht=c(ze-Te);if(ht===_c)return this.double();const ie=c(j*f2*te),ce=c(G*f2*Z),H=ce+ie,$=ze+Te,P=ce-ie,se=c(H*ht),fe=c($*P),ve=c(H*P),Ee=c(ht*$);return new _(se,fe,Ee,ve)}const re=c(V*C),q=c(J*F),L=c(G*N*te),k=c(j*Z),B=c((V+J)*(C+F)-re-q),X=k-L,ne=k+L,ae=c(q-D*re),ye=c(B*X),_e=c(ne*ae),$e=c(B*ae),Ce=c(X*ne);return new _(ye,_e,Ce,$e)}subtract(I){return this.add(I.negate())}wNAF(I){return T.wNAFCached(this,m,I,_.normalizeZ)}multiply(I){const{p:D,f:N}=this.wNAF(w(I,n));return _.normalizeZ([D,N])[0]}multiplyUnsafe(I){let D=v(I);return D===_c?S:this.equals(S)||D===Ws?this:this.equals(E)?this.wNAF(D).p:T.unsafeLadder(this,D)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return T.unsafeLadder(this,n).is0()}toAffine(I){const{ex:D,ey:N,ez:V}=this,J=this.is0();I==null&&(I=J?_Ae:t.inv(V));const j=c(D*I),G=c(N*I),C=c(V*I);if(J)return{x:_c,y:Ws};if(C!==Ws)throw new Error("invZ was invalid");return{x:j,y:G}}clearCofactor(){const{h:I}=e;return I===Ws?this:this.multiplyUnsafe(I)}static fromHex(I,D=!1){const{d:N,a:V}=e,J=t.BYTES;I=qn("pointHex",I,J);const j=I.slice(),G=I[J-1];j[J-1]=G&-129;const C=mh(j);C===_c||(D?w(C,d):w(C,t.ORDER));const F=c(C*C),Z=c(F-Ws),te=c(N*F-V);let{isValid:re,value:q}=u(Z,te);if(!re)throw new Error("Point.fromHex: invalid y coordinate");const L=(q&Ws)===Ws,k=(G&128)!==0;if(!D&&q===_c&&k)throw new Error("Point.fromHex: x=0 and x_0=1");return k!==L&&(q=c(-q)),_.fromAffine({x:q,y:C})}static fromPrivateKey(I){return Q(I).point}toRawBytes(){const{x:I,y:D}=this.toAffine(),N=ov(D,t.BYTES);return N[N.length-1]|=I&Ws?128:0,N}toHex(){return Ky(this.toRawBytes())}}_.BASE=new _(e.Gx,e.Gy,Ws,c(e.Gx*e.Gy)),_.ZERO=new _(_c,Ws,Ws,_c);const{BASE:E,ZERO:S}=_,T=iW(_,a*8);function O(Y){return sn(Y,n)}function M(Y){return O(mh(Y))}function Q(Y){const I=a;Y=qn("private key",Y,I);const D=qn("hashed private key",o(Y),2*I),N=f(D.slice(0,I)),V=D.slice(I,2*I),J=M(N),j=E.multiply(J),G=j.toRawBytes();return{head:N,prefix:V,scalar:J,point:j,pointBytes:G}}function W(Y){return Q(Y).pointBytes}function U(Y=new Uint8Array,...I){const D=zy(...I);return M(o(h(D,qn("context",Y),!!i)))}function ee(Y,I,D={}){Y=qn("message",Y),i&&(Y=i(Y));const{prefix:N,scalar:V,pointBytes:J}=Q(I),j=U(D.context,N,Y),G=E.multiply(j).toRawBytes(),C=U(D.context,G,J,Y),F=O(j+C*V);v(F);const Z=zy(G,ov(F,t.BYTES));return qn("result",Z,a*2)}const R=EAe;function z(Y,I,D,N=R){const{context:V,zip215:J}=N,j=t.BYTES;Y=qn("signature",Y,2*j),I=qn("message",I),i&&(I=i(I));const G=mh(Y.slice(j,2*j));let C,F,Z;try{C=_.fromHex(D,J),F=_.fromHex(Y.slice(0,j),J),Z=E.multiplyUnsafe(G)}catch{return!1}if(!J&&C.isSmallOrder())return!1;const te=U(V,F.toRawBytes(),C.toRawBytes(),I);return F.add(C.multiplyUnsafe(te)).subtract(Z).clearCofactor().equals(_.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:W,sign:ee,verify:z,ExtendedPoint:_,utils:{getExtendedPublicKey:Q,randomPrivateKey:()=>s(t.BYTES),precompute(Y=8,I=_.BASE){return I._setWindowSize(Y),I.multiply(BigInt(3)),I}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const M0=BigInt(0),mk=BigInt(1);function xAe(r){return am(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function SAe(r){const e=xAe(r),{P:t}=e,n=m=>sn(m,t),i=e.montgomeryBits,o=Math.ceil(i/8),s=e.nByteLength,a=e.adjustScalarBytes||(m=>m),l=e.powPminus2||(m=>eW(m,t-BigInt(2),t));function d(m,b,_){const E=n(m*(b-_));return b=n(b-E),_=n(_+E),[b,_]}function c(m){if(typeof m=="bigint"&&M0<=m&&m<t)return m;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const u=(e.a-BigInt(2))/BigInt(4);function f(m,b){const _=c(m),E=c(b),S=_;let T=mk,O=M0,M=_,Q=mk,W=M0,U;for(let R=BigInt(i-1);R>=M0;R--){const z=E>>R&mk;W^=z,U=d(W,T,M),T=U[0],M=U[1],U=d(W,O,Q),O=U[0],Q=U[1],W=z;const K=T+O,Y=n(K*K),I=T-O,D=n(I*I),N=Y-D,V=M+Q,J=M-Q,j=n(J*K),G=n(V*I),C=j+G,F=j-G;M=n(C*C),Q=n(S*n(F*F)),T=n(Y*D),O=n(N*(Y+n(u*N)))}U=d(W,T,M),T=U[0],M=U[1],U=d(W,O,Q),O=U[0],Q=U[1];const ee=l(O);return n(T*ee)}function h(m){return ov(n(m),o)}function p(m){const b=qn("u coordinate",m,o);return s===32&&(b[31]&=127),mh(b)}function y(m){const b=qn("scalar",m),_=b.length;if(_!==o&&_!==s)throw new Error(`Expected ${o} or ${s} bytes, got ${_}`);return mh(a(b))}function g(m,b){const _=p(b),E=y(m),S=f(_,E);if(S===M0)throw new Error("Invalid private or public key received");return h(S)}const w=h(e.Gu);function v(m){return g(m,w)}return{scalarMult:g,scalarMultBase:v,getSharedSecret:(m,b)=>g(m,b),getPublicKey:m=>v(m),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const qw=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),O4=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const TAe=BigInt(1),HI=BigInt(2),$Ae=BigInt(5),C4=BigInt(10),kAe=BigInt(20),PAe=BigInt(40),R4=BigInt(80);function dW(r){const e=qw,n=r*r%e*r%e,i=_n(n,HI,e)*n%e,o=_n(i,TAe,e)*r%e,s=_n(o,$Ae,e)*o%e,a=_n(s,C4,e)*s%e,l=_n(a,kAe,e)*a%e,d=_n(l,PAe,e)*l%e,c=_n(d,R4,e)*d%e,u=_n(c,R4,e)*d%e,f=_n(u,C4,e)*s%e;return{pow_p_5_8:_n(f,HI,e)*r%e,b2:n}}function uW(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function IAe(r,e){const t=qw,n=sn(e*e*e,t),i=sn(n*n*e,t),o=dW(r*i).pow_p_5_8;let s=sn(r*n*o,t);const a=sn(e*s*s,t),l=s,d=sn(s*O4,t),c=a===r,u=a===sn(-r,t),f=a===sn(-r*O4,t);return c&&(s=l),(u||f)&&(s=d),TEe(s,t)&&(s=sn(-s,t)),{isValid:c||u,value:s}}const ac=CD(qw,void 0,!0),Vw={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ac,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Fw,randomBytes:YS,adjustScalarBytes:uW,uvRatio:IAe},Cn=BD(Vw);function fW(r,e,t){if(e.length>255)throw new Error("Context is too big");return JA($D("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,r)}({...Vw});({...Vw});const vs=SAe({P:qw,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=qw,{pow_p_5_8:t,b2:n}=dW(r);return sn(_n(t,BigInt(3),e)*n,e)},adjustScalarBytes:uW,randomBytes:YS});function jD(r){const{y:e}=Cn.ExtendedPoint.fromHex(r),t=BigInt(1);return ac.toBytes(ac.create((t+e)*ac.inv(t-e)))}function ND(r){const e=Vw.hash(r.subarray(0,32));return Vw.adjustScalarBytes(e).subarray(0,32)}const OAe=(ac.ORDER+BigInt(3))/BigInt(8);ac.pow(HI,OAe);ac.sqrt(ac.neg(ac.ONE));(ac.ORDER-BigInt(5))/BigInt(8);BigInt(486662);OEe(ac,ac.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235");BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578");BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838");BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var Ra=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},CAe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let Is=class Lf{static bytesToPrivateKey(e){return Ra(this,arguments,void 0,function*({privateKeyBytes:t}){const n=Cn.getPublicKey(t),i={crv:"Ed25519",d:Ue.uint8Array(t).toBase64Url(),kty:"OKP",x:Ue.uint8Array(n).toBase64Url()};return i.kid=yield Kr({jwk:i}),i})}static bytesToPublicKey(e){return Ra(this,arguments,void 0,function*({publicKeyBytes:t}){const n={kty:"OKP",crv:"Ed25519",x:Ue.uint8Array(t).toBase64Url()};return n.kid=yield Kr({jwk:n}),n})}static computePublicKey(e){return Ra(this,arguments,void 0,function*({key:t}){const n=yield Lf.privateKeyToBytes({privateKey:t}),i=Cn.getPublicKey(n),o={kty:"OKP",crv:"Ed25519",x:Ue.uint8Array(i).toBase64Url()};return o.kid=yield Kr({jwk:o}),o})}static convertPrivateKeyToX25519(e){return Ra(this,arguments,void 0,function*({privateKey:t}){const n=yield Lf.privateKeyToBytes({privateKey:t}),i=ND(n),o=vs.getPublicKey(i),s={kty:"OKP",crv:"X25519",d:Ue.uint8Array(i).toBase64Url(),x:Ue.uint8Array(o).toBase64Url()};return s.kid=yield Kr({jwk:s}),s})}static convertPublicKeyToX25519(e){return Ra(this,arguments,void 0,function*({publicKey:t}){const n=yield Lf.publicKeyToBytes({publicKey:t});if(!(yield Lf.validatePublicKey({publicKeyBytes:n})))throw new Error("Ed25519: Invalid public key.");const o=jD(n),s={kty:"OKP",crv:"X25519",x:Ue.uint8Array(o).toBase64Url()};return s.kid=yield Kr({jwk:s}),s})}static generateKey(){return Ra(this,void 0,void 0,function*(){const e=Cn.utils.randomPrivateKey(),t=yield Lf.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Kr({jwk:t}),t})}static getPublicKey(e){return Ra(this,arguments,void 0,function*({key:t}){var n;if(!(vy(t)&&t.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let i=CAe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield Kr({jwk:i})),i})}static privateKeyToBytes(e){return Ra(this,arguments,void 0,function*({privateKey:t}){if(!vy(t))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Ra(this,arguments,void 0,function*({publicKey:t}){if(!MD(t))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Ue.base64Url(t.x).toUint8Array()})}static sign(e){return Ra(this,arguments,void 0,function*({key:t,data:n}){const i=yield Lf.privateKeyToBytes({privateKey:t});return Cn.sign(n,i)})}static validatePublicKey(e){return Ra(this,arguments,void 0,function*({publicKeyBytes:t}){try{Cn.ExtendedPoint.fromHex(t).assertValidity()}catch{return!1}return!0})}static verify(e){return Ra(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=yield Lf.publicKeyToBytes({publicKey:t});return Cn.verify(n,i,o)})}};var B0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let RAe=class extends SD{computePublicKey(e){return B0(this,arguments,void 0,function*({key:t}){if(!vy(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(t.crv){case"Ed25519":{const n=yield Is.computePublicKey({key:t});return n.alg="EdDSA",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}generateKey(e){return B0(this,arguments,void 0,function*({algorithm:t}){switch(t){case"Ed25519":{const n=yield Is.generateKey();return n.alg="EdDSA",n}}})}getPublicKey(e){return B0(this,arguments,void 0,function*({key:t}){if(!vy(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(t.crv){case"Ed25519":{const n=yield Is.getPublicKey({key:t});return n.alg="EdDSA",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}sign(e){return B0(this,arguments,void 0,function*({key:t,data:n}){if(!vy(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(t.crv){case"Ed25519":return yield Is.sign({key:t,data:n});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}verify(e){return B0(this,arguments,void 0,function*({key:t,signature:n,data:i}){if(!MD(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(t.crv){case"Ed25519":return yield Is.verify({key:t,signature:n,data:i});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}};var Dd=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const gk={Ed25519:{implementation:RAe,names:["Ed25519"]},secp256k1:{implementation:I4,names:["ES256K","secp256k1"]},secp256r1:{implementation:I4,names:["ES256","secp256r1"]},"SHA-256":{implementation:X2e,names:["SHA-256"]}};let ju=class{constructor(e){var t;this._algorithmInstances=new Map,this._keyStore=(t=e?.keyStore)!==null&&t!==void 0?t:new nV}digest(e){return Dd(this,arguments,void 0,function*({algorithm:t,data:n}){return yield this.getAlgorithm({algorithm:t}).digest({algorithm:t,data:n})})}exportKey(e){return Dd(this,arguments,void 0,function*({keyUri:t}){return yield this.getPrivateKey({keyUri:t})})}generateKey(e){return Dd(this,arguments,void 0,function*({algorithm:t}){const i=yield this.getAlgorithm({algorithm:t}).generateKey({algorithm:t});if(i?.kid===void 0)throw new Error("Generated key is missing a required property: kid");const o=`${P4}${i.kid}`;return yield this._keyStore.set(o,i),o})}getKeyUri(e){return Dd(this,arguments,void 0,function*({key:t}){const n=yield Kr({jwk:t});return`${P4}${n}`})}getPublicKey(e){return Dd(this,arguments,void 0,function*({keyUri:t}){const n=yield this.getPrivateKey({keyUri:t}),i=this.getAlgorithmName({key:n});return yield this.getAlgorithm({algorithm:i}).getPublicKey({key:n})})}importKey(e){return Dd(this,arguments,void 0,function*({key:t}){var n;if(!VEe(t))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const i=structuredClone(t);(n=i.kid)!==null&&n!==void 0||(i.kid=yield Kr({jwk:i}));const o=yield this.getKeyUri({key:i});return yield this._keyStore.set(o,i),o})}sign(e){return Dd(this,arguments,void 0,function*({keyUri:t,data:n}){const i=yield this.getPrivateKey({keyUri:t}),o=this.getAlgorithmName({key:i});return this.getAlgorithm({algorithm:o}).sign({data:n,key:i})})}verify(e){return Dd(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=this.getAlgorithmName({key:t});return this.getAlgorithm({algorithm:o}).verify({key:t,signature:n,data:i})})}getAlgorithm({algorithm:e}){var t;const n=(t=gk[e])===null||t===void 0?void 0:t.implementation;if(!n)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(n)||this._algorithmInstances.set(n,new n),this._algorithmInstances.get(n)}getAlgorithmName({key:e}){const t=e.alg,n=e.crv;for(const i in gk){const o=gk[i];if(t&&o.names.includes(t))return i;if(n&&o.names.includes(n))return i}throw new Error(`Unable to determine algorithm based on provided input: alg=${t}, crv=${n}`)}getPrivateKey(e){return Dd(this,arguments,void 0,function*({keyUri:t}){const n=yield this._keyStore.get(t);if(!n)throw new Error(`Key not found: ${t}`);return n})}};function DAe(r){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if(r.alg&&Object.values(e).includes(r.alg))return r.alg;if(r.crv&&Object.keys(e).includes(r.crv))return e[r.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${r.alg}, crv=${r.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}var Sf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},MAe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let hW=class vb{static bytesToPrivateKey(e){return Sf(this,arguments,void 0,function*({privateKeyBytes:t}){const n=vs.getPublicKey(t),i={kty:"OKP",crv:"X25519",d:Ue.uint8Array(t).toBase64Url(),x:Ue.uint8Array(n).toBase64Url()};return i.kid=yield Kr({jwk:i}),i})}static bytesToPublicKey(e){return Sf(this,arguments,void 0,function*({publicKeyBytes:t}){const n={kty:"OKP",crv:"X25519",x:Ue.uint8Array(t).toBase64Url()};return n.kid=yield Kr({jwk:n}),n})}static computePublicKey(e){return Sf(this,arguments,void 0,function*({key:t}){const n=yield vb.privateKeyToBytes({privateKey:t}),i=vs.getPublicKey(n),o={kty:"OKP",crv:"X25519",x:Ue.uint8Array(i).toBase64Url()};return o.kid=yield Kr({jwk:o}),o})}static generateKey(){return Sf(this,void 0,void 0,function*(){const e=vs.utils.randomPrivateKey(),t=yield vb.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Kr({jwk:t}),t})}static getPublicKey(e){return Sf(this,arguments,void 0,function*({key:t}){var n;if(!(vy(t)&&t.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let i=MAe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield Kr({jwk:i})),i})}static privateKeyToBytes(e){return Sf(this,arguments,void 0,function*({privateKey:t}){if(!vy(t))throw new Error("X25519: The provided key is not a valid OKP private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Sf(this,arguments,void 0,function*({publicKey:t}){if(!MD(t))throw new Error("X25519: The provided key is not a valid OKP public key.");return Ue.base64Url(t.x).toUint8Array()})}static sharedSecret(e){return Sf(this,arguments,void 0,function*({privateKeyA:t,publicKeyB:n}){if("x"in t&&"x"in n&&t.x===n.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const i=yield vb.privateKeyToBytes({privateKey:t}),o=yield vb.publicKeyToBytes({publicKey:n});return vs.getSharedSecret(i,o)})}};const qi=(r,e)=>r[e++]&255|(r[e++]&255)<<8;let BAe=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=aI(e),Ul(e,32);const t=qi(e,0),n=qi(e,2),i=qi(e,4),o=qi(e,6),s=qi(e,8),a=qi(e,10),l=qi(e,12),d=qi(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|o<<9)&8191,this.r[4]=(o>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|l<<5)&8065,this.r[8]=(l>>>8|d<<8)&8191,this.r[9]=d>>>5&127;for(let c=0;c<8;c++)this.pad[c]=qi(e,16+2*c)}process(e,t,n=!1){const i=n?0:2048,{h:o,r:s}=this,a=s[0],l=s[1],d=s[2],c=s[3],u=s[4],f=s[5],h=s[6],p=s[7],y=s[8],g=s[9],w=qi(e,t+0),v=qi(e,t+2),m=qi(e,t+4),b=qi(e,t+6),_=qi(e,t+8),E=qi(e,t+10),S=qi(e,t+12),T=qi(e,t+14);let O=o[0]+(w&8191),M=o[1]+((w>>>13|v<<3)&8191),Q=o[2]+((v>>>10|m<<6)&8191),W=o[3]+((m>>>7|b<<9)&8191),U=o[4]+((b>>>4|_<<12)&8191),ee=o[5]+(_>>>1&8191),R=o[6]+((_>>>14|E<<2)&8191),z=o[7]+((E>>>11|S<<5)&8191),K=o[8]+((S>>>8|T<<8)&8191),Y=o[9]+(T>>>5|i),I=0,D=I+O*a+M*(5*g)+Q*(5*y)+W*(5*p)+U*(5*h);I=D>>>13,D&=8191,D+=ee*(5*f)+R*(5*u)+z*(5*c)+K*(5*d)+Y*(5*l),I+=D>>>13,D&=8191;let N=I+O*l+M*a+Q*(5*g)+W*(5*y)+U*(5*p);I=N>>>13,N&=8191,N+=ee*(5*h)+R*(5*f)+z*(5*u)+K*(5*c)+Y*(5*d),I+=N>>>13,N&=8191;let V=I+O*d+M*l+Q*a+W*(5*g)+U*(5*y);I=V>>>13,V&=8191,V+=ee*(5*p)+R*(5*h)+z*(5*f)+K*(5*u)+Y*(5*c),I+=V>>>13,V&=8191;let J=I+O*c+M*d+Q*l+W*a+U*(5*g);I=J>>>13,J&=8191,J+=ee*(5*y)+R*(5*p)+z*(5*h)+K*(5*f)+Y*(5*u),I+=J>>>13,J&=8191;let j=I+O*u+M*c+Q*d+W*l+U*a;I=j>>>13,j&=8191,j+=ee*(5*g)+R*(5*y)+z*(5*p)+K*(5*h)+Y*(5*f),I+=j>>>13,j&=8191;let G=I+O*f+M*u+Q*c+W*d+U*l;I=G>>>13,G&=8191,G+=ee*a+R*(5*g)+z*(5*y)+K*(5*p)+Y*(5*h),I+=G>>>13,G&=8191;let C=I+O*h+M*f+Q*u+W*c+U*d;I=C>>>13,C&=8191,C+=ee*l+R*a+z*(5*g)+K*(5*y)+Y*(5*p),I+=C>>>13,C&=8191;let F=I+O*p+M*h+Q*f+W*u+U*c;I=F>>>13,F&=8191,F+=ee*d+R*l+z*a+K*(5*g)+Y*(5*y),I+=F>>>13,F&=8191;let Z=I+O*y+M*p+Q*h+W*f+U*u;I=Z>>>13,Z&=8191,Z+=ee*c+R*d+z*l+K*a+Y*(5*g),I+=Z>>>13,Z&=8191;let te=I+O*g+M*y+Q*p+W*h+U*f;I=te>>>13,te&=8191,te+=ee*u+R*c+z*d+K*l+Y*a,I+=te>>>13,te&=8191,I=(I<<2)+I|0,I=I+D|0,D=I&8191,I=I>>>13,N+=I,o[0]=D,o[1]=N,o[2]=V,o[3]=J,o[4]=j,o[5]=G,o[6]=C,o[7]=F,o[8]=Z,o[9]=te}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let o=(i^1)-1;for(let a=0;a<10;a++)n[a]&=o;o=~o;for(let a=0;a<10;a++)e[a]=e[a]&o|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535}update(e){F8(this);const{buffer:t,blockLen:n}=this;e=aI(e);const i=e.length;for(let o=0;o<i;){const s=Math.min(n-this.pos,i-o);if(s===n){for(;n<=i-o;o+=n)this.process(e,o);continue}t.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){F8(this),Hfe(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let s=0;s<8;s++)e[o++]=n[s]>>>0,e[o++]=n[s]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}};function jAe(r){const e=(n,i)=>r(i).update(aI(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const NAe=jAe(r=>new BAe(r)),pW=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),UAe=pW("expand 16-byte k"),LAe=pW("expand 32-byte k"),KAe=fh(UAe),yW=fh(LAe);yW.slice();function Ze(r,e){return r<<e|r>>>32-e}function GI(r){return r.byteOffset%4===0}const h2=64,zAe=16,mW=2**32-1,D4=new Uint32Array;function FAe(r,e,t,n,i,o,s,a){const l=i.length,d=new Uint8Array(h2),c=fh(d),u=GI(i)&&GI(o),f=u?fh(i):D4,h=u?fh(o):D4;for(let p=0;p<l;s++){if(r(e,t,n,c,s,a),s>=mW)throw new Error("arx: counter overflow");const y=Math.min(h2,l-p);if(u&&y===h2){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let w=0,v;w<zAe;w++)v=g+w,h[v]=f[v]^c[w];p+=h2;continue}for(let g=0,w;g<y;g++)w=p+g,o[w]=i[w]^d[g];p+=y}}function qAe(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:o,rounds:s}=Jfe({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return u$(i),u$(s),z8(o),z8(t),(a,l,d,c,u=0)=>{Ul(a),Ul(l),Ul(d);const f=d.length;if(c||(c=new Uint8Array(f)),Ul(c),u$(u),u<0||u>=mW)throw new Error("arx: counter overflow");if(c.length<f)throw new Error(`arx: output (${c.length}) is shorter than data (${f})`);const h=[];let p=a.length,y,g;if(p===32)y=a.slice(),h.push(y),g=yW;else if(p===16&&t)y=new Uint8Array(32),y.set(a),y.set(a,16),g=KAe,h.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);GI(l)||(l=l.slice(),h.push(l));const w=fh(y);if(n){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(g,w,fh(l.subarray(0,16)),w),l=l.subarray(16)}const v=16-i;if(v!==l.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){const b=new Uint8Array(12);b.set(l,o?0:12-l.length),l=b,h.push(l)}const m=fh(l);for(FAe(r,g,w,m,d,c,u,s);h.length>0;)h.pop().fill(0);return c}}function VAe(r,e,t,n,i,o=20){let s=r[0],a=r[1],l=r[2],d=r[3],c=e[0],u=e[1],f=e[2],h=e[3],p=e[4],y=e[5],g=e[6],w=e[7],v=i,m=t[0],b=t[1],_=t[2],E=s,S=a,T=l,O=d,M=c,Q=u,W=f,U=h,ee=p,R=y,z=g,K=w,Y=v,I=m,D=b,N=_;for(let J=0;J<o;J+=2)E=E+M|0,Y=Ze(Y^E,16),ee=ee+Y|0,M=Ze(M^ee,12),E=E+M|0,Y=Ze(Y^E,8),ee=ee+Y|0,M=Ze(M^ee,7),S=S+Q|0,I=Ze(I^S,16),R=R+I|0,Q=Ze(Q^R,12),S=S+Q|0,I=Ze(I^S,8),R=R+I|0,Q=Ze(Q^R,7),T=T+W|0,D=Ze(D^T,16),z=z+D|0,W=Ze(W^z,12),T=T+W|0,D=Ze(D^T,8),z=z+D|0,W=Ze(W^z,7),O=O+U|0,N=Ze(N^O,16),K=K+N|0,U=Ze(U^K,12),O=O+U|0,N=Ze(N^O,8),K=K+N|0,U=Ze(U^K,7),E=E+Q|0,N=Ze(N^E,16),z=z+N|0,Q=Ze(Q^z,12),E=E+Q|0,N=Ze(N^E,8),z=z+N|0,Q=Ze(Q^z,7),S=S+W|0,Y=Ze(Y^S,16),K=K+Y|0,W=Ze(W^K,12),S=S+W|0,Y=Ze(Y^S,8),K=K+Y|0,W=Ze(W^K,7),T=T+U|0,I=Ze(I^T,16),ee=ee+I|0,U=Ze(U^ee,12),T=T+U|0,I=Ze(I^T,8),ee=ee+I|0,U=Ze(U^ee,7),O=O+M|0,D=Ze(D^O,16),R=R+D|0,M=Ze(M^R,12),O=O+M|0,D=Ze(D^O,8),R=R+D|0,M=Ze(M^R,7);let V=0;n[V++]=s+E|0,n[V++]=a+S|0,n[V++]=l+T|0,n[V++]=d+O|0,n[V++]=c+M|0,n[V++]=u+Q|0,n[V++]=f+W|0,n[V++]=h+U|0,n[V++]=p+ee|0,n[V++]=y+R|0,n[V++]=g+z|0,n[V++]=w+K|0,n[V++]=v+Y|0,n[V++]=m+I|0,n[V++]=b+D|0,n[V++]=_+N|0}function WAe(r,e,t,n){let i=r[0],o=r[1],s=r[2],a=r[3],l=e[0],d=e[1],c=e[2],u=e[3],f=e[4],h=e[5],p=e[6],y=e[7],g=t[0],w=t[1],v=t[2],m=t[3];for(let _=0;_<20;_+=2)i=i+l|0,g=Ze(g^i,16),f=f+g|0,l=Ze(l^f,12),i=i+l|0,g=Ze(g^i,8),f=f+g|0,l=Ze(l^f,7),o=o+d|0,w=Ze(w^o,16),h=h+w|0,d=Ze(d^h,12),o=o+d|0,w=Ze(w^o,8),h=h+w|0,d=Ze(d^h,7),s=s+c|0,v=Ze(v^s,16),p=p+v|0,c=Ze(c^p,12),s=s+c|0,v=Ze(v^s,8),p=p+v|0,c=Ze(c^p,7),a=a+u|0,m=Ze(m^a,16),y=y+m|0,u=Ze(u^y,12),a=a+u|0,m=Ze(m^a,8),y=y+m|0,u=Ze(u^y,7),i=i+d|0,m=Ze(m^i,16),p=p+m|0,d=Ze(d^p,12),i=i+d|0,m=Ze(m^i,8),p=p+m|0,d=Ze(d^p,7),o=o+c|0,g=Ze(g^o,16),y=y+g|0,c=Ze(c^y,12),o=o+c|0,g=Ze(g^o,8),y=y+g|0,c=Ze(c^y,7),s=s+u|0,w=Ze(w^s,16),f=f+w|0,u=Ze(u^f,12),s=s+u|0,w=Ze(w^s,8),f=f+w|0,u=Ze(u^f,7),a=a+l|0,v=Ze(v^a,16),h=h+v|0,l=Ze(l^h,12),a=a+l|0,v=Ze(v^a,8),h=h+v|0,l=Ze(l^h,7);let b=0;n[b++]=i,n[b++]=o,n[b++]=s,n[b++]=a,n[b++]=g,n[b++]=w,n[b++]=v,n[b++]=m}const HAe=qAe(VAe,{counterRight:!1,counterLength:8,extendNonceFn:WAe,allowShortKeys:!1}),GAe=new Uint8Array(16),M4=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(GAe.subarray(t))},YAe=new Uint8Array(32);function B4(r,e,t,n,i){const o=r(e,t,YAe),s=NAe.create(o);i&&M4(s,i),M4(s,n);const a=new Uint8Array(16),l=Gfe(a);q8(l,0,BigInt(i?i.length:0),!0),q8(l,8,BigInt(n.length),!0),s.update(a);const d=s.digest();return o.fill(0),d}const ZAe=r=>(e,t,n)=>(Ul(e,32),Ul(t),{encrypt:(o,s)=>{const a=o.length,l=a+16;s?Ul(s,l):s=new Uint8Array(l),r(e,t,o,s,1);const d=B4(r,e,t,s.subarray(0,-16),n);return s.set(d,a),s},decrypt:(o,s)=>{const a=o.length,l=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");s?Ul(s,l):s=new Uint8Array(l);const d=o.subarray(0,-16),c=o.subarray(-16),u=B4(r,e,t,d,n);if(!Xfe(c,u))throw new Error("invalid tag");return r(e,t,d,s,1),s}}),JS=Qfe({blockSize:64,nonceLength:24,tagLength:16},ZAe(HAe));function JAe(r){return r.byteOffset!==0||r.byteLength!==r.buffer.byteLength}function XAe(r){return typeof r!="object"||r===null?!1:typeof r[Symbol.asyncIterator]=="function"}function sv(r){const t=Object.prototype.toString.call(r).match(/\s([a-zA-Z0-9]+)/),[n,i]=t;return i}var j0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},j4=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}};const p2=new TextEncoder,up=new TextDecoder;class ge{constructor(e,t){this.data=e,this.format=t}static arrayBuffer(e){return new ge(e,"ArrayBuffer")}static asyncIterable(e){if(!XAe(e))throw new TypeError("Input must be of type AsyncIterable.");return new ge(e,"AsyncIterable")}static base32Z(e){return new ge(e,"Base32Z")}static base58Btc(e){return new ge(e,"Base58Btc")}static base64Url(e){return new ge(e,"Base64Url")}static bufferSource(e){return new ge(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new ge(e,"Hex")}static multibase(e){return new ge(e,"Multibase")}static object(e){return new ge(e,"Object")}static string(e){return new ge(e,"String")}static uint8Array(e){return new ge(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return Qa.baseDecode(this.data).buffer;case"Base64Url":return ra.baseDecode(this.data).buffer;case"BufferSource":{if(sv(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return JAe(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return j0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return hM.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return Qa.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return Qa.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return ra.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return ra.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),t=p2.encode(e);return ra.baseEncode(t)}case"String":{const e=p2.encode(this.data);return ra.baseEncode(e)}case"Uint8Array":return ra.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){var e,t,n,i;return j0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const l=[];try{for(var o=!0,s=j4(this.data),a;a=yield s.next(),e=a.done,!e;o=!0){i=a.value,o=!1;const c=i;l.push(c)}}catch(c){t={error:c}}finally{try{!o&&!e&&(n=s.return)&&(yield n.call(s))}finally{if(t)throw t.error}}return new Blob(l)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(t,n)=>n.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const t=this.toUint8Array();return ge.uint8Array(t).toHex()}case"Base64Url":{const t=this.toUint8Array();return ge.uint8Array(t).toHex()}case"Uint8Array":{let t="";for(let n=0;n<this.data.length;n++)t+=e[this.data[n]];return t}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=ra.baseDecode(this.data),t=up.decode(e);return JSON.parse(t)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=up.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return j0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return up.decode(this.data);case"Base64Url":{const e=ra.baseDecode(this.data);return up.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return up.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){var e,t,n,i;return j0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{let l="";try{for(var o=!0,s=j4(this.data),a;a=yield s.next(),e=a.done,!e;o=!0){i=a.value,o=!1;const d=i;typeof d=="string"?l+=d:l+=up.decode(d,{stream:!0})}}catch(d){t={error:d}}finally{try{!o&&!e&&(n=s.return)&&(yield n.call(s))}finally{if(t)throw t.error}}return l+=up.decode(void 0,{stream:!1}),l}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return hM.baseDecode(this.data);case"Base58Btc":return Qa.baseDecode(this.data);case"Base64Url":return ra.baseDecode(this.data);case"BufferSource":{const e=sv(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let t=0;t<this.data.length;t+=2){const n=parseInt(this.data.substring(t,t+2),16);if(isNaN(n))throw new TypeError("Input is not a valid hexadecimal string.");e[t/2]=n}return e}case"Object":{const e=JSON.stringify(this.data);return p2.encode(e)}case"String":return p2.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return j0(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}}class zr{static addPrefix(e){var t;let{code:n,data:i,name:o}=e;if(!(o?!n:n))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(n=zr.codeToName.has(n)?n:zr.nameToCode.get(o),n===void 0)throw new Error(`Unsupported multicodec: ${(t=e.name)!==null&&t!==void 0?t:e.code}`);const s=ww(n),a=new Uint8Array(s+i.byteLength);return a.set(i,s),bw(n,a),a}static getCodeFromData(e){const{prefixedData:t}=e,[n,i]=vw(t);return n}static getCodeFromName(e){const{name:t}=e,n=zr.nameToCode.get(t);if(n===void 0)throw new Error(`Unsupported multicodec: ${t}`);return n}static getNameFromCode(e){const{code:t}=e,n=zr.codeToName.get(t);if(n===void 0)throw new Error(`Unsupported multicodec: ${t}`);return n}static registerCodec(e){zr.codeToName.set(e.code,e.name),zr.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:t}=e,[n,i]=vw(t),o=zr.codeToName.get(n);if(o===void 0)throw new Error(`Unsupported multicodec: ${n}`);return{code:n,data:t.slice(i),name:o}}}zr.codeToName=new Map;zr.nameToCode=new Map;zr.registerCodec({code:237,name:"ed25519-pub"});zr.registerCodec({code:4864,name:"ed25519-priv"});zr.registerCodec({code:236,name:"x25519-pub"});zr.registerCodec({code:4866,name:"x25519-priv"});zr.registerCodec({code:231,name:"secp256k1-pub"});zr.registerCodec({code:4865,name:"secp256k1-priv"});function gW(r){return typeof r!="object"||r===null||Object.getOwnPropertySymbols(r).length>0?!1:Object.keys(r).length===0}function XA(r){Object.keys(r).forEach(e=>{r[e]===void 0?delete r[e]:typeof r[e]=="object"&&XA(r[e])})}var UD=rD.BrowserLevel,Ja=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class QAe{constructor({db:e,location:t="DATASTORE"}={}){this.store=e??new UD(t)}clear(){return Ja(this,void 0,void 0,function*(){yield this.store.clear()})}close(){return Ja(this,void 0,void 0,function*(){yield this.store.close()})}delete(e){return Ja(this,void 0,void 0,function*(){yield this.store.del(e)})}get(e){return Ja(this,void 0,void 0,function*(){try{return yield this.store.get(e)}catch(t){if(t.notFound)return;throw t}})}set(e,t){return Ja(this,void 0,void 0,function*(){yield this.store.put(e,t)})}}class vW{constructor(){this.store=new Map}clear(){return Ja(this,void 0,void 0,function*(){this.store.clear()})}close(){return Ja(this,void 0,void 0,function*(){})}delete(e){return Ja(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return Ja(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return Ja(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return Ja(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,t){return Ja(this,void 0,void 0,function*(){this.store.set(e,t)})}}var N0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Ww=function(r){return this instanceof Ww?(this.v=r,this):new Ww(r)},exe=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){n[f]&&(i[f]=function(h){return new Promise(function(p,y){o.push([f,h,p,y])>1||a(f,h)})})}function a(f,h){try{l(n[f](h))}catch(p){u(o[0][3],p)}}function l(f){f.value instanceof Ww?Promise.resolve(f.value.v).then(d,c):u(o[0][2],f)}function d(f){a("next",f)}function c(f){a("throw",f)}function u(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}};class oa{static asAsyncIterator(e){return exe(this,arguments,function*(){const n=e.getReader();try{for(;;){const{done:i,value:o}=yield Ww(n.read());if(i)break;yield yield Ww(o)}}finally{n.releaseLock()}})}static consumeToArrayBuffer({readableStream:e}){return N0(this,void 0,void 0,function*(){const t=oa.asAsyncIterator(e);return yield ge.asyncIterable(t).toArrayBufferAsync()})}static consumeToBlob({readableStream:e}){return N0(this,void 0,void 0,function*(){const t=oa.asAsyncIterator(e);return yield ge.asyncIterable(t).toBlobAsync()})}static consumeToBytes({readableStream:e}){return N0(this,void 0,void 0,function*(){const t=oa.asAsyncIterator(e);return yield ge.asyncIterable(t).toUint8ArrayAsync()})}static consumeToJson({readableStream:e}){return N0(this,void 0,void 0,function*(){const t=oa.asAsyncIterator(e);return yield ge.asyncIterable(t).toObjectAsync()})}static consumeToText({readableStream:e}){return N0(this,void 0,void 0,function*(){const t=oa.asAsyncIterator(e);return yield ge.asyncIterable(t).toStringAsync()})}static generateByteStream({streamLength:e,chunkLength:t,fillValue:n}){let i=e??1/0,o;function s(){const a=Math.min(i,t??1/0);i-=a;let l;if(typeof n=="number")l=new Uint8Array(a).fill(n);else if(Array.isArray(n)){l=new Uint8Array(a);const[d,c]=n,u=c-d+1;for(let f=0;f<a;f++)l[f]=Math.floor(Math.random()*u)+d}else l=new Uint8Array(a);o.enqueue(l),i<=0&&o.close()}return new ReadableStream({start(a){o=a,s()},pull(){s()}})}static isReadable({readableStream:e}){if(!oa.isReadableStream(e)||e.locked)return!1;try{return e.getReader().releaseLock(),!0}catch{return!1}}static isReadableStream(e){return typeof e=="object"&&e!==null&&"getReader"in e&&typeof e.getReader=="function"}static isStream(e){return oa.isReadableStream(e)||oa.isWritableStream(e)||oa.isTransformStream(e)}static isTransformStream(e){return typeof e=="object"&&e!==null&&"readable"in e&&typeof e.readable=="object"&&"writable"in e&&typeof e.writable=="object"}static isWritableStream(e){return typeof e=="object"&&e!==null&&"getWriter"in e&&typeof e.getWriter=="function"&&"abort"in e&&typeof e.abort=="function"}}var U0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class lo{static consumeToArrayBuffer({readable:e}){return U0(this,void 0,void 0,function*(){return yield ge.asyncIterable(e).toArrayBufferAsync()})}static consumeToBlob({readable:e}){return U0(this,void 0,void 0,function*(){return yield ge.asyncIterable(e).toBlobAsync()})}static consumeToBytes({readable:e}){return U0(this,void 0,void 0,function*(){return yield ge.asyncIterable(e).toUint8ArrayAsync()})}static consumeToJson({readable:e}){return U0(this,void 0,void 0,function*(){return yield ge.asyncIterable(e).toObjectAsync()})}static consumeToText({readable:e}){return U0(this,void 0,void 0,function*(){return yield ge.asyncIterable(e).toStringAsync()})}static fromWebReadable({readableStream:e,readableOptions:t}){if(!oa.isReadableStream(e))throw new TypeError("NodeStream.fromWebReadable: 'readableStream' is not a Web ReadableStream.");const n=e.getReader();let i=!1;const o=new Y2e.Readable(Object.assign(Object.assign({},t),{read:function(){n.read().then(({done:s,value:a})=>{if(s)this.push(null);else if(!this.push(a))return}).catch(s=>{this.destroy(s)})},destroy:function(s,a){function l(){a(s)}if(!i){n.cancel(s).then(l).catch(l);return}l()}}));return n.closed.then(()=>{i=!0}).catch(s=>{i=!0,o.destroy(s)}),o}static isDestroyed({stream:e}){if(!lo.isStream(e))throw new TypeError("NodeStream.isDestroyed: 'stream' is not a Node stream.");const t="_writableState"in e?e._writableState:void 0,n=e._readableState,i=t||n;return!!(e.destroyed||i.destroyed)}static isReadable({readable:e}){return lo.isReadableStream(e)?e.readable&&typeof e._readableState.ended=="boolean"&&!e._readableState.ended&&typeof e._readableState.endEmitted=="boolean"&&!e._readableState.endEmitted&&!e.destroyed&&!e.isPaused():!1}static isReadableStream(e){return typeof e=="object"&&e!==null&&"pipe"in e&&typeof e.pipe=="function"&&"on"in e&&typeof e.on=="function"&&!("_writableState"in e)&&"_readableState"in e}static isStream(e){return typeof e=="object"&&e!==null&&("_readableState"in e||"_writableState"in e)}static toWebReadable({readable:e}){if(!lo.isReadableStream(e))throw new TypeError("NodeStream.toWebReadable: 'readable' is not a Node Readable stream.");if(lo.isDestroyed({stream:e})){const t=new ReadableStream;return t.cancel(),t}return new ReadableStream({start(t){e.on("data",n=>{t.enqueue(n)}),e.on("end",()=>{t.close()}),e.on("error",n=>{t.error(n)})},cancel(){e.destroy()}})}}function Kc(r){if(typeof r=="string"&&r.length!==0)return r.split("#").pop()}function bW({didDocument:r}){var e,t;if(!r)throw new TypeError("Required parameter missing: 'didDocument'");const n=[];return n.push(...(t=(e=r.verificationMethod)===null||e===void 0?void 0:e.filter(YI))!==null&&t!==void 0?t:[]),Object.keys(Lw).forEach(i=>{var o,s;n.push(...(s=(o=r[i])===null||o===void 0?void 0:o.filter(YI))!==null&&s!==void 0?s:[])}),n}function txe({didDocument:r}){const t=bW({didDocument:r}).map(n=>n.type);return[...new Set(t)]}function rxe({didDocument:r,methodId:e}){const t=[];return Object.keys(Lw).forEach(n=>{if(Array.isArray(r[n])){const i=r[n],o=Kc(e);i.some(a=>{const l=Kc(a)===o,d=YI(a)&&Kc(a.id)===o;return l||d})&&t.push(n)}}),t}function YI(r){return!(!r||typeof r!="object"||r===null||!("id"in r&&"type"in r&&"controller"in r)||typeof r.id!="string"||typeof r.type!="string"||typeof r.controller!="string")}function wW({keyBytes:r,multicodecCode:e,multicodecName:t}){const n=zr.addPrefix({code:e,data:r,name:t}),i=ge.uint8Array(n).toBase58Btc();return ge.base58Btc(i).toMultibase()}function N4({multibaseKeyId:r}){try{const e=ge.multibase(r).toBase58Btc(),t=ge.base58Btc(e).toUint8Array(),{code:n,data:i,name:o}=zr.removePrefix({prefixedData:t});return{keyBytes:i,multicodecCode:n,multicodecName:o}}catch{throw new yt(ot.InvalidDid,`Invalid multibase identifier: ${r}`)}}var L0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let Nu=class _W{constructor({uri:e,document:t,metadata:n,keyManager:i}){this.uri=e,this.document=t,this.metadata=n,this.keyManager=i}export(){return L0(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const t=[];for(let n of this.document.verificationMethod){if(!n.publicKeyJwk)throw new Error(`Verification method '${n.id}' does not contain a public key in JWK format`);const i=yield this.keyManager.getKeyUri({key:n.publicKeyJwk}),o=yield this.keyManager.exportKey({keyUri:i});t.push(Object.assign({},o))}e.privateKeys=t}return e})}getSigner(e){return L0(this,void 0,void 0,function*(){var t;const n=(t=this.document.verificationMethod)===null||t===void 0?void 0:t.find(l=>{var d,c;return Kc(l.id)===((d=Kc(e?.methodId))!==null&&d!==void 0?d:Kc((c=this.document.assertionMethod)===null||c===void 0?void 0:c[0]))});if(!(n&&n.publicKeyJwk))throw new yt(ot.InternalError,"A verification method intended for signing could not be determined from the DID Document");const i=yield this.keyManager.getKeyUri({key:n.publicKeyJwk}),o=yield this.keyManager.getPublicKey({keyUri:i}),s=this.keyManager;return{algorithm:DAe(o),keyId:n.id,sign(l){return L0(this,arguments,void 0,function*({data:d}){return yield s.sign({data:d,keyUri:i})})},verify(l){return L0(this,arguments,void 0,function*({data:d,signature:c}){return yield s.verify({data:d,key:o,signature:c})})}}})}static import(e){return L0(this,arguments,void 0,function*({portableDid:t,keyManager:n=new ju}){var i;const o=bW({didDocument:t.document});if(o.length===0)throw new yt(ot.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let a of(i=t.privateKeys)!==null&&i!==void 0?i:[])yield n.importKey({key:a});for(let a of o){if(!a.publicKeyJwk)throw new Error(`Verification method '${a.id}' does not contain a public key in JWK format`);const l=yield n.getKeyUri({key:a.publicKeyJwk});yield n.getPublicKey({keyUri:l})}return new _W({uri:t.uri,document:t.document,metadata:t.metadata,keyManager:n})})}};/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const U4="0123456789abcdef",EW=[];for(let r=0;r<256;r++)EW[r]=U4[r>>4&15]+U4[r&15];const nxe=r=>{const e=r.length;let t="",n=0;for(;n<e;)t+=EW[r[n++]];return t},ixe=(r,e=0)=>{const t=r.length||0;if(!e){let s=t;for(;s--;)e+=r[s].length}const n=new Uint8Array(e);let i=e,o=t;for(;o--;)i-=r[o].length,n.set(r[o],i);return n};var L4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",oxe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var y2=0;y2<L4.length;y2++)oxe[L4.charCodeAt(y2)]=y2;const sxe=new TextDecoder,AW=(r,e)=>sxe.decode(r),axe=new TextEncoder,Uu=r=>axe.encode(r),K4=typeof window<"u"?window:self,z4=K4.crypto||K4.msCrypto||{};z4.subtle||z4.webkitSubtle;function n1(r){const e=r<0?1:0;return r=Math.abs(Number(r||1)),Math.floor(Math.log10(r))+1+e}function xW(r){return ArrayBuffer.isView(r)?"arraybufferview":Array.isArray(r)?"array":r instanceof Number?"number":r instanceof Boolean?"boolean":r instanceof Set?"set":r instanceof Map?"map":r instanceof String?"string":r instanceof ArrayBuffer?"arraybuffer":typeof r}function xr(r,e,t){const n=[];let i=null;return xr._encode(n,r),i=ixe(n),xr.bytes=i.length,ArrayBuffer.isView(e)?(e.set(i,t),e):i}xr.bytes=-1;xr._floatConversionDetected=!1;xr._encode=function(r,e){if(e!=null)switch(xW(e)){case"object":xr.dict(r,e);break;case"map":xr.dictMap(r,e);break;case"array":xr.list(r,e);break;case"set":xr.listSet(r,e);break;case"string":xr.string(r,e);break;case"number":xr.number(r,e);break;case"boolean":xr.number(r,e);break;case"arraybufferview":xr.buffer(r,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));break;case"arraybuffer":xr.buffer(r,new Uint8Array(e));break}};const XS=new Uint8Array([101]),SW=new Uint8Array([100]),TW=new Uint8Array([108]);xr.buffer=function(r,e){r.push(Uu(e.length+":"),e)};xr.string=function(r,e){r.push(Uu(Uu(e).byteLength+":"+e))};xr.number=function(r,e){if(Number.isInteger(e))return r.push(Uu("i"+BigInt(e)+"e"));const t=2147483648,n=e/t<<0,i=e%t<<0,o=n*t+i;r.push(Uu("i"+o+"e")),o!==e&&!xr._floatConversionDetected&&(xr._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+e+'":','Bencoding only defines support for integers, value was converted to "'+o+'"'),console.trace())};xr.dict=function(r,e){r.push(SW);let t=0,n;const i=Object.keys(e).sort(),o=i.length;for(;t<o;t++)n=i[t],e[n]!=null&&(xr.string(r,n),xr._encode(r,e[n]));r.push(XS)};xr.dictMap=function(r,e){r.push(SW);const t=Array.from(e.keys()).sort();for(const n of t)e.get(n)!=null&&(ArrayBuffer.isView(n)?xr._encode(r,n):xr.string(r,String(n)),xr._encode(r,e.get(n)));r.push(XS)};xr.list=function(r,e){let t=0;const n=e.length;for(r.push(TW);t<n;t++)e[t]!=null&&xr._encode(r,e[t]);r.push(XS)};xr.listSet=function(r,e){r.push(TW);for(const t of e)t!=null&&xr._encode(r,t);r.push(XS)};const cxe=105,lxe=58,dxe=100,uxe=108,LD=101;function $W(r,e,t){let n=0,i=1;for(let o=e;o<t;o++){const s=r[o];if(s<58&&s>=48){n=n*10+(s-48);continue}if(!(o===e&&s===43)){if(o===e&&s===45){i=-1;continue}if(s===46)break;throw new Error("not a number: buffer["+o+"] = "+s)}}return n*i}function kt(r,e,t,n){return r==null||r.length===0?null:(typeof e!="number"&&n==null&&(n=e,e=void 0),typeof t!="number"&&n==null&&(n=t,t=void 0),kt.position=0,kt.encoding=n||null,kt.data=ArrayBuffer.isView(r)?new Uint8Array(r.slice(e,t)):Uu(r),kt.bytes=kt.data.length,kt.next())}kt.bytes=0;kt.position=0;kt.data=null;kt.encoding=null;kt.next=function(){switch(kt.data[kt.position]){case dxe:return kt.dictionary();case uxe:return kt.list();case cxe:return kt.integer();default:return kt.buffer()}};kt.find=function(r){let e=kt.position;const t=kt.data.length,n=kt.data;for(;e<t;){if(n[e]===r)return e;e++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(r)+'" [0x'+r.toString(16)+"]")};kt.dictionary=function(){kt.position++;const r={};for(;kt.data[kt.position]!==LD;){const e=kt.buffer();let t=AW(e);t.includes("")&&(t=nxe(e)),r[t]=kt.next()}return kt.position++,r};kt.list=function(){kt.position++;const r=[];for(;kt.data[kt.position]!==LD;)r.push(kt.next());return kt.position++,r};kt.integer=function(){const r=kt.find(LD),e=$W(kt.data,kt.position+1,r);return kt.position+=r+1-kt.position,e};kt.buffer=function(){let r=kt.find(lxe);const e=$W(kt.data,kt.position,r),t=++r+e;return kt.position=t,kt.encoding?AW(kt.data.slice(r,t)):kt.data.slice(r,t)};function fxe(r){let e=2;for(const t of r)e+=i1(t);return e}function hxe(r){let e=2;for(const[t,n]of r){const i=Uu(t).byteLength;e+=n1(i)+1+i,e+=i1(n)}return e}function pxe(r){let e=2;const t=Object.keys(r);for(let n=0;n<t.length;n++){const i=Uu(t[n]).byteLength;e+=n1(i)+1+i,e+=i1(r[t[n]])}return e}function yxe(r){const e=Uu(r).byteLength;return n1(e)+1+e}function mxe(r){const e=r.byteLength-r.byteOffset;return n1(e)+1+e}function i1(r){if(r==null)return 0;const t=xW(r);switch(t){case"arraybufferview":return mxe(r);case"string":return yxe(r);case"array":case"set":return fxe(r);case"number":return 1+n1(Math.floor(r))+1;case"bigint":return 1+r.toString().length+1;case"object":return pxe(r);case"map":return hxe(r);default:throw new TypeError(`Unsupported value of type "${t}"`)}}const gxe=i1,av={encode:xr,decode:kt,byteLength:i1,encodingLength:gxe},vxe=/^(\d{1,3}\.){3,3}\d{1,3}$/,F4=4,bxe=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,m2=16,Hl={name:"v4",size:F4,isFormat:r=>vxe.test(r),encode(r,e,t){t=~~t,e=e||new Uint8Array(t+F4);const n=r.length;let i=0;for(let o=0;o<n;){const s=r.charCodeAt(o++);s===46?(e[t++]=i,i=0):i=i*10+(s-48)}return e[t]=i,e},decode(r,e){return e=~~e,`${r[e++]}.${r[e++]}.${r[e++]}.${r[e]}`}},gh={name:"v6",size:m2,isFormat:r=>r.length>0&&bxe.test(r),encode(r,e,t){t=~~t;let n=t+m2,i=-1,o=0,s=0,a=!0,l=!1;e=e||new Uint8Array(t+m2);for(let d=0;d<r.length;d++){let c=r.charCodeAt(d);c===58?(a?i!==-1?(t<n&&(e[t]=0),t<n-1&&(e[t+1]=0),t+=2):t<n&&(i=t):(l===!0?(t<n&&(e[t]=s),t++):(t<n&&(e[t]=o>>8),t<n-1&&(e[t+1]=o&255),t+=2),o=0,s=0),a=!0,l=!1):c===46?(t<n&&(e[t]=s),t++,s=0,o=0,a=!1,l=!0):(a=!1,c>=97?c-=87:c>=65?c-=55:(c-=48,s=s*10+c),o=(o<<4)+c)}if(a===!1)l===!0?(t<n&&(e[t]=s),t++):(t<n&&(e[t]=o>>8),t<n-1&&(e[t+1]=o&255),t+=2);else if(i===0)t<n&&(e[t]=0),t<n-1&&(e[t+1]=0),t+=2;else if(i!==-1){t+=2;for(let d=Math.min(t-1,n-1);d>=i+2;d--)e[d]=e[d-2];e[i]=0,e[i+1]=0,i=t}if(i!==t&&i!==-1)for(t>n-2&&(t=n-2);n>i;)e[--n]=t<n&&t>i?e[--t]:0;else for(;t<n;)e[t++]=0;return e},decode(r,e){e=~~e;let t="";for(let n=0;n<m2;n+=2)n!==0&&(t+=":"),t+=(r[e+n]<<8|r[e+n+1]).toString(16);return t.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};function kW(r){if(Hl.isFormat(r))return Hl.size;if(gh.isFormat(r))return gh.size;throw Error(`Invalid ip address: ${r}`)}function wxe(r){return kW(r)===Hl.size?1:2}function _xe(r,e,t){t=~~t;const n=kW(r);return typeof e=="function"&&(e=e(t+n)),n===Hl.size?Hl.encode(r,e,t):gh.encode(r,e,t)}function Exe(r,e,t){if(e=~~e,t=t||r.length-e,t===Hl.size)return Hl.decode(r,e,t);if(t===gh.size)return gh.decode(r,e,t);throw Error(`Invalid buffer size needs to be ${Hl.size} for v4 or ${gh.size} for v6.`)}function QS(r){switch(r){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+r}function Hw(r){switch(r.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":return 255;case"*":return 255}return r.toUpperCase().startsWith("UNKNOWN_")?parseInt(r.slice(8)):0}function Axe(r){switch(r){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+r}function xxe(r){switch(r){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+r}function PW(r){switch(r){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+r}function IW(r){switch(r.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}function Sxe(r){switch(r){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return r<0?null:`OPTION_${r}`}function q4(r){if(typeof r=="number")return r;if(!r)return-1;switch(r.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const e=r.match(/_(\d+)$/);return e?parseInt(e[1],10):-1}const KD=55296,Gw=56320;function OW(r){let e=0;const t=r.length;for(let n=0;n<t;n+=1){const i=r.charCodeAt(n);if(i<=127)e+=1;else if(i<=2047)e+=2;else if((i&63488)!==KD)e+=3;else{const o=n+1;o===t||i>=Gw||(r.charCodeAt(o)&64512)!==Gw?e+=3:(n=o,e+=4)}}return e}function Yw(r,e,t){const n=r.length;t==null&&(t=0),e===void 0&&(e=new Uint8Array(OW(r)+t));let i=t;for(let o=0;o<n;o+=1){let s=r.charCodeAt(o);if(s<=127)e[i++]=s;else if(s<=2047)e[i++]=192|(s&1984)>>6,e[i++]=128|s&63;else if((s&63488)!==KD)e[i++]=224|(s&61440)>>12,e[i++]=128|(s&4032)>>6,e[i++]=128|s&63;else{const a=o+1;if(a===n||s>=Gw)e[i++]=239,e[i++]=191,e[i++]=189;else{const l=r.charCodeAt(a);(l&64512)!==Gw?(e[i++]=239,e[i++]=191,e[i++]=189):(o=a,s=65536|(s&1023)<<10|l&1023,e[i++]=240|(s&1835008)>>18,e[i++]=128|(s&258048)>>12,e[i++]=128|(s&4032)>>6,e[i++]=128|s&63)}}}return Yw.bytes=i-t,e}Yw.bytes=0;function o1(r,e,t){let n="";e==null&&(e=0),t==null&&(t=r.length);for(let i=e;i<t;){const o=r[i++];let s;if(o<=128)s=o;else if(o>191&&o<224)s=(o&31)<<6|r[i++]&63;else if(o>239&&o<365){s=((o&7)<<18|(r[i++]&63)<<12|(r[i++]&63)<<6|r[i++]&63)-65536;const a=KD|s>>10&1023;n+=String.fromCharCode(a),s=Gw|s&1023}else s=(o&15)<<12|(r[i++]&63)<<6|r[i++]&63;n+=String.fromCharCode(s)}return o1.bytes=t-e,n}o1.bytes=0;const Fy=r=>r instanceof Uint8Array;function Gh(r){return typeof r=="string"?OW(r):r.byteLength}function zD(r){return r instanceof Uint8Array?r:Array.isArray(r)?new Uint8Array(r):Yw(r)}function FD(r,e,t){if(typeof e!="string")throw new Error("unknown input type");return Yw(e,r,t),Yw.bytes}const bb={},CW=new Array(255);for(let r=0;r<=15;r+=1){const e=r.toString(16),t=e.toUpperCase();for(let n=0;n<=15;n+=1){const i=n.toString(16),o=i.toUpperCase(),s=r<<4|n,a=`${e}${i}`;CW[s]=a,bb[a]=s,bb[`${t}${i}`]=s,bb[`${e}${o}`]=s,bb[`${t}${o}`]=s}}function Txe(r,e,t){let n="";for(let i=e;i<t;){const o=r[i++];n+=CW[o]}return n}function V4(r){return r.length>>>1}function $xe(r,e,t,n){let i=0;for(;t<n;){const o=e.substr(i,2),s=bb[o];if(s===void 0)return;r[t++]=s,i+=2}return r}const kxe=Math.pow(2,24),Pxe=Math.pow(2,16),Ixe=Math.pow(2,8),au=(r,e)=>r[e]*kxe+r[e+1]*Pxe+r[e+2]*Ixe+r[e+3],Zt=(r,e)=>r[e]<<8|r[e+1],cu=(r,e,t)=>(e=+e,r[t+3]=e,e=e>>>8,r[t+2]=e,e=e>>>8,r[t+1]=e,e=e>>>8,r[t]=e,t+4),wt=(r,e,t)=>(r[t]=e>>8,r[t+1]=e&255,t+2);function cc(r,e,t,n,i){return t<0&&(n-=t,t=0),n<0&&(n=0),i<0?new Uint8Array(0):t>=e.length||n>=i?0:Oxe(r,e,t,n,i)}function Oxe(r,e,t,n,i){i-n>e.length-t&&(i=n+e.length-t);let o=i-n;const s=r.length-n;return o>s&&(o=s),(n!==0||i<r.length)&&(r=new Uint8Array(r.buffer,r.byteOffset+n,o)),e.set(r,t),o}const Cxe=0,W4=32768,ZI=32768,Rxe=~ZI,RW=32768,Dxe=~RW;function Jr({bytes:r=0,encode:e,decode:t,encodingLength:n}){return e.bytes=r,t.bytes=r,{encode:e,decode:t,encodingLength:n||(()=>r)}}const Xe=Jr({encode(r,e,t){e||(e=new Uint8Array(Xe.encodingLength(r))),t||(t=0);const n=t,i=r.replace(/^\.|\.$/gm,"");if(i.length){const o=i.split(".");for(let s=0;s<o.length;s++){const a=FD(e,o[s],t+1);e[t]=a,t+=a+1}}return e[t++]=0,Xe.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=[];let n=e,i=0,o=0,s=!1;for(;;){if(e>=r.length)throw new Error("Cannot decode name (buffer overflow)");const a=r[e++];if(o+=s?0:1,a===0)break;if(a&192)if((a&192)===192){if(e+1>r.length)throw new Error("Cannot decode name (buffer overflow)");const l=Zt(r,e-1)-49152;if(l>=n)throw new Error("Cannot decode name (bad pointer)");e=l,n=l,o+=s?0:1,s=!0}else throw new Error("Cannot decode name (bad label)");else{if(e+a>r.length)throw new Error("Cannot decode name (buffer overflow)");if(i+=a+1,i>254)throw new Error("Cannot decode name (name too long)");t.push(o1(r,e,e+a)),e+=a,o+=s?0:a}}return Xe.decode.bytes=o,t.length===0?".":t.join(".")},encodingLength(r){return r==="."||r===".."?1:Gh(r.replace(/^\.|\.$/gm,""))+2}}),si=Jr({encode(r,e,t){e||(e=new Uint8Array(si.encodingLength(r))),t||(t=0);const n=FD(e,r,t+1);return e[t]=n,si.encode.bytes=n+1,e},decode(r,e){e||(e=0);const t=r[e],n=o1(r,e+1,e+1+t);return si.decode.bytes=t+1,n},encodingLength(r){return Gh(r)+1}}),zm=Jr({bytes:12,encode(r,e,t){e||(e=new Uint8Array(zm.encodingLength(r))),t||(t=0);const n=(r.flags||0)&32767,i=r.type==="response"?W4:Cxe;return wt(e,r.id||0,t),wt(e,n|i,t+2),wt(e,r.questions.length,t+4),wt(e,r.answers.length,t+6),wt(e,r.authorities.length,t+8),wt(e,r.additionals.length,t+10),e},decode(r,e){if(e||(e=0),r.length<12)throw new Error("Header must be 12 bytes");const t=Zt(r,e+2);return{id:Zt(r,e),type:t&W4?"response":"query",flags:t&32767,flag_qr:(t>>15&1)===1,opcode:xxe(t>>11&15),flag_aa:(t>>10&1)===1,flag_tc:(t>>9&1)===1,flag_rd:(t>>8&1)===1,flag_ra:(t>>7&1)===1,flag_z:(t>>6&1)===1,flag_ad:(t>>5&1)===1,flag_cd:(t>>4&1)===1,rcode:Axe(t&15),questions:new Array(Zt(r,e+4)),answers:new Array(Zt(r,e+6)),authorities:new Array(Zt(r,e+8)),additionals:new Array(Zt(r,e+10))}},encodingLength(){return 12}}),pE=Jr({encode(r,e,t){e||(e=new Uint8Array(pE.encodingLength(r))),t||(t=0);const n=r.length;return wt(e,n,t),cc(r,e,t+2,0,n),pE.encode.bytes=n+2,e},decode(r,e){e||(e=0);const t=Zt(r,e),n=r.slice(e+2,e+2+t);return pE.decode.bytes=t+2,n},encodingLength(r){return r.length+2}}),yE=Jr({encode(r,e,t){return e||(e=new Uint8Array(yE.encodingLength(r))),t||(t=0),Xe.encode(r,e,t+2),wt(e,Xe.encode.bytes,t),yE.encode.bytes=Xe.encode.bytes+2,e},decode(r,e){e||(e=0);const t=Zt(r,e),n=Xe.decode(r,e+2);return yE.decode.bytes=t+2,n},encodingLength(r){return Xe.encodingLength(r)+2}}),mE=Jr({encode(r,e,t){e||(e=new Uint8Array(mE.encodingLength(r))),t||(t=0);const n=t;return t+=2,Xe.encode(r.mname,e,t),t+=Xe.encode.bytes,Xe.encode(r.rname,e,t),t+=Xe.encode.bytes,cu(e,r.serial||0,t),t+=4,cu(e,r.refresh||0,t),t+=4,cu(e,r.retry||0,t),t+=4,cu(e,r.expire||0,t),t+=4,cu(e,r.minimum||0,t),t+=4,wt(e,t-n-2,n),mE.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=e,n={};return e+=2,n.mname=Xe.decode(r,e),e+=Xe.decode.bytes,n.rname=Xe.decode(r,e),e+=Xe.decode.bytes,n.serial=au(r,e),e+=4,n.refresh=au(r,e),e+=4,n.retry=au(r,e),e+=4,n.expire=au(r,e),e+=4,n.minimum=au(r,e),e+=4,mE.decode.bytes=e-t,n},encodingLength(r){return 22+Xe.encodingLength(r.mname)+Xe.encodingLength(r.rname)}}),gE=Jr({encode(r,e,t){Array.isArray(r)||(r=[r]);for(let i=0;i<r.length;i++)if(typeof r[i]=="string"&&(r[i]=zD(r[i])),!Fy(r[i]))throw new Error("Must be a Buffer");e||(e=new Uint8Array(gE.encodingLength(r))),t||(t=0);const n=t;return t+=2,r.forEach(function(i){e[t++]=i.length,cc(i,e,t,0,i.length),t+=i.length}),wt(e,t-n-2,n),gE.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=e;let n=Zt(r,e);e+=2;const i=[];for(;n>0;){const o=r[e++];if(--n,n<o)throw new Error("Buffer overflow");i.push(r.slice(e,e+o)),e+=o,n-=o}return gE.decode.bytes=e-t,i},encodingLength(r){Array.isArray(r)||(r=[r]);let e=2;return r.forEach(function(t){typeof t=="string"?e+=Gh(t)+1:e+=t.length+1}),e}}),vE=Jr({encode(r,e,t){e||(e=new Uint8Array(vE.encodingLength(r))),t||(t=0),typeof r=="string"&&(r=zD(r)),r||(r=new Uint8Array(0));const n=t;t+=2;const i=r.length;return cc(r,e,t,0,i),t+=i,wt(e,t-n-2,n),vE.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=e,n=Zt(r,e);e+=2;const i=r.slice(e,e+n);return e+=n,vE.decode.bytes=e-t,i},encodingLength(r){return r?(Fy(r)?r.length:Gh(r))+2:2}}),bE=Jr({encode(r,e,t){e||(e=new Uint8Array(bE.encodingLength(r))),t||(t=0);const n=t;return t+=2,si.encode(r.cpu,e,t),t+=si.encode.bytes,si.encode(r.os,e,t),t+=si.encode.bytes,wt(e,t-n-2,n),bE.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=e,n={};return e+=2,n.cpu=si.decode(r,e),e+=si.decode.bytes,n.os=si.decode(r,e),e+=si.decode.bytes,bE.decode.bytes=e-t,n},encodingLength(r){return si.encodingLength(r.cpu)+si.encodingLength(r.os)+2}}),_g=Jr({encode(r,e,t){return e||(e=new Uint8Array(_g.encodingLength(r))),t||(t=0),Xe.encode(r,e,t+2),wt(e,Xe.encode.bytes,t),_g.encode.bytes=Xe.encode.bytes+2,e},decode(r,e){e||(e=0);const t=Xe.decode(r,e+2);return _g.decode.bytes=Xe.decode.bytes+2,t},encodingLength(r){return Xe.encodingLength(r)+2}}),wE=Jr({encode(r,e,t){e||(e=new Uint8Array(wE.encodingLength(r))),t||(t=0),wt(e,r.priority||0,t+2),wt(e,r.weight||0,t+4),wt(e,r.port||0,t+6),Xe.encode(r.target,e,t+8);const n=Xe.encode.bytes+6;return wt(e,n,t),wE.encode.bytes=n+2,e},decode(r,e){e||(e=0);const t=Zt(r,e),n={};return n.priority=Zt(r,e+2),n.weight=Zt(r,e+4),n.port=Zt(r,e+6),n.target=Xe.decode(r,e+8),wE.decode.bytes=t+2,n},encodingLength(r){return 8+Xe.encodingLength(r.target)}}),Wf=Jr({encode(r,e,t){const n=Wf.encodingLength(r);return e||(e=new Uint8Array(Wf.encodingLength(r))),t||(t=0),r.issuerCritical&&(r.flags=Wf.ISSUER_CRITICAL),wt(e,n-2,t),t+=2,e[t]=r.flags||0,t+=1,si.encode(r.tag,e,t),t+=si.encode.bytes,FD(e,r.value,t),t+=Gh(r.value),Wf.encode.bytes=n,e},decode(r,e){e||(e=0);const t=Zt(r,e);e+=2;const n=e,i={};return i.flags=r[e],e+=1,i.tag=si.decode(r,e),e+=si.decode.bytes,i.value=o1(r,e,n+t),i.issuerCritical=!!(i.flags&Wf.ISSUER_CRITICAL),Wf.decode.bytes=t+2,i},encodingLength(r){return si.encodingLength(r.tag)+si.encodingLength(r.value)+2}});Wf.ISSUER_CRITICAL=128;const _E=Jr({encode(r,e,t){e||(e=new Uint8Array(_E.encodingLength(r))),t||(t=0);const n=t;return t+=2,wt(e,r.preference||0,t),t+=2,Xe.encode(r.exchange,e,t),t+=Xe.encode.bytes,wt(e,t-n-2,n),_E.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=e,n={};return e+=2,n.preference=Zt(r,e),e+=2,n.exchange=Xe.decode(r,e),e+=Xe.decode.bytes,_E.decode.bytes=e-t,n},encodingLength(r){return 4+Xe.encodingLength(r.exchange)}}),DW=Jr({encode(r,e,t){return e||(e=new Uint8Array(DW.encodingLength(r))),t||(t=0),wt(e,4,t),t+=2,Hl.encode(r,e,t),e},decode(r,e){return e||(e=0),e+=2,Hl.decode(r,e)},bytes:6}),EE=Jr({encode(r,e,t){return e||(e=new Uint8Array(EE.encodingLength(r))),t||(t=0),wt(e,16,t),t+=2,gh.encode(r,e,t),EE.encode.bytes=18,e},decode(r,e){e||(e=0),e+=2;const t=gh.decode(r,e);return EE.decode.bytes=18,t},bytes:18}),Mxe=r=>new Uint8Array(r),nu=Jr({encode(r,e,t){e||(e=new Uint8Array(nu.encodingLength(r))),t||(t=0);const n=t,i=q4(r.code);if(wt(e,i,t),t+=2,r.data)wt(e,r.data.length,t),t+=2,cc(r.data,e,t),t+=r.data.length;else switch(i){case 8:{const o=r.sourcePrefixLength||0,s=r.family||wxe(r.ip),a=_xe(r.ip,Mxe),l=Math.ceil(o/8);wt(e,l+4,t),t+=2,wt(e,s,t),t+=2,e[t++]=o,e[t++]=r.scopePrefixLength||0,cc(a,e,t,0,l),t+=l}break;case 11:r.timeout?(wt(e,2,t),t+=2,wt(e,r.timeout,t),t+=2):(wt(e,0,t),t+=2);break;case 12:{const o=r.length||0;wt(e,o,t),t+=2,e.fill(0,t,t+o),t+=o}break;case 14:{const o=r.tags.length*2;wt(e,o,t),t+=2;for(const s of r.tags)wt(e,s,t),t+=2}break;default:throw new Error(`Unknown roption code: ${r.code}`)}return nu.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t={};t.code=Zt(r,e),t.type=Sxe(t.code),e+=2;const n=Zt(r,e);switch(e+=2,t.data=r.slice(e,e+n),t.code){case 8:t.family=Zt(r,e),e+=2,t.sourcePrefixLength=r[e++],t.scopePrefixLength=r[e++];{const i=new Uint8Array(t.family===1?4:16);cc(r,i,0,e,e+n-4),t.ip=Exe(i)}break;case 11:n>0&&(t.timeout=Zt(r,e),e+=2);break;case 14:t.tags=[];for(let i=0;i<n;i+=2)t.tags.push(Zt(r,e)),e+=2}return nu.decode.bytes=n+4,t},encodingLength(r){if(r.data)return r.data.length+4;switch(q4(r.code)){case 8:{const t=r.sourcePrefixLength||0;return Math.ceil(t/8)+8}case 11:return typeof r.timeout=="number"?6:4;case 12:return r.length+4;case 14:return 4+r.tags.length*2}throw new Error(`Unknown roption code: ${r.code}`)}}),lh=Jr({encode(r,e,t){e||(e=new Uint8Array(lh.encodingLength(r))),t||(t=0);const n=t,i=Qm(r,nu);return wt(e,i,t),t=Sb(r,nu,e,t+2),lh.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t=e,n=[];let i=Zt(r,e);e+=2;let o=0;for(;i>0;)n[o++]=nu.decode(r,e),e+=nu.decode.bytes,i-=nu.decode.bytes;return lh.decode.bytes=e-t,n},encodingLength(r){return 2+Qm(r||[],nu)}}),Pl=Jr({encode(r,e,t){e||(e=new Uint8Array(Pl.encodingLength(r))),t||(t=0);const n=t,i=r.key;if(!Fy(i))throw new Error("Key must be a Buffer");return t+=2,wt(e,r.flags,t),t+=2,e[t]=Pl.PROTOCOL_DNSSEC,t+=1,e[t]=r.algorithm,t+=1,cc(i,e,t,0,i.length),t+=i.length,Pl.encode.bytes=t-n,wt(e,Pl.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={},i=Zt(r,e);if(e+=2,n.flags=Zt(r,e),e+=2,r[e]!==Pl.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return e+=1,n.algorithm=r[e],e+=1,n.key=r.slice(e,t+i+2),e+=n.key.length,Pl.decode.bytes=e-t,n},encodingLength(r){return 6+Gh(r.key)}});Pl.PROTOCOL_DNSSEC=3;Pl.ZONE_KEY=128;Pl.SECURE_ENTRYPOINT=32768;const wb=Jr({encode(r,e,t){e||(e=new Uint8Array(wb.encodingLength(r))),t||(t=0);const n=t,i=r.signature;if(!Fy(i))throw new Error("Signature must be a Buffer");return t+=2,wt(e,Hw(r.typeCovered),t),t+=2,e[t]=r.algorithm,t+=1,e[t]=r.labels,t+=1,cu(e,r.originalTTL,t),t+=4,cu(e,r.expiration,t),t+=4,cu(e,r.inception,t),t+=4,wt(e,r.keyTag,t),t+=2,Xe.encode(r.signersName,e,t),t+=Xe.encode.bytes,cc(i,e,t,0,i.length),t+=i.length,wb.encode.bytes=t-n,wt(e,wb.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={},i=Zt(r,e);return e+=2,n.typeCovered=QS(Zt(r,e)),e+=2,n.algorithm=r[e],e+=1,n.labels=r[e],e+=1,n.originalTTL=au(r,e),e+=4,n.expiration=au(r,e),e+=4,n.inception=au(r,e),e+=4,n.keyTag=Zt(r,e),e+=2,n.signersName=Xe.decode(r,e),e+=Xe.decode.bytes,n.signature=r.slice(e,t+i+2),e+=n.signature.length,wb.decode.bytes=e-t,n},encodingLength(r){return 20+Xe.encodingLength(r.signersName)+Gh(r.signature)}}),_b=Jr({encode(r,e,t){e||(e=new Uint8Array(_b.encodingLength(r))),t||(t=0);const n=t;return t+=2,Xe.encode(r.mbox||".",e,t),t+=Xe.encode.bytes,Xe.encode(r.txt||".",e,t),t+=Xe.encode.bytes,_b.encode.bytes=t-n,wt(e,_b.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={};return e+=2,n.mbox=Xe.decode(r,e)||".",e+=Xe.decode.bytes,n.txt=Xe.decode(r,e)||".",e+=Xe.decode.bytes,_b.decode.bytes=e-t,n},encodingLength(r){return 2+Xe.encodingLength(r.mbox||".")+Xe.encodingLength(r.txt||".")}}),ga=Jr({encode(r,e,t){e||(e=new Uint8Array(ga.encodingLength(r))),t||(t=0);const n=t,i=[];for(let o=0;o<r.length;o++){const s=Hw(r[o]);i[s>>8]===void 0&&(i[s>>8]=[]),i[s>>8][s>>3&31]|=1<<7-(s&7)}for(let o=0;o<i.length;o++)if(i[o]!==void 0){const s=zD(i[o]);e[t]=o,t+=1,e[t]=s.length,t+=1,cc(s,e,t,0,s.length),t+=s.length}return ga.encode.bytes=t-n,e},decode(r,e,t){e||(e=0);const n=e,i=[];for(;e-n<t;){const o=r[e];e+=1;const s=r[e];e+=1;for(let a=0;a<s;a++){const l=r[e+a];for(let d=0;d<8;d++)if(l&1<<7-d){const c=QS(o<<8|a<<3|d);i.push(c)}}e+=s}return ga.decode.bytes=e-n,i},encodingLength(r){const e=[];for(let n=0;n<r.length;n++){const i=Hw(r[n]);e[i>>8]=Math.max(e[i>>8]||0,i&255)}let t=0;for(let n=0;n<e.length;n++)e[n]!==void 0&&(t+=2+Math.ceil((e[n]+1)/8));return t}}),Eb=Jr({encode(r,e,t){e||(e=new Uint8Array(Eb.encodingLength(r))),t||(t=0);const n=t;return t+=2,Xe.encode(r.nextDomain,e,t),t+=Xe.encode.bytes,ga.encode(r.rrtypes,e,t),t+=ga.encode.bytes,Eb.encode.bytes=t-n,wt(e,Eb.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={},i=Zt(r,e);return e+=2,n.nextDomain=Xe.decode(r,e),e+=Xe.decode.bytes,n.rrtypes=ga.decode(r,e,i-(e-t)),e+=ga.decode.bytes,Eb.decode.bytes=e-t,n},encodingLength(r){return 2+Xe.encodingLength(r.nextDomain)+ga.encodingLength(r.rrtypes)}}),Ab=Jr({encode(r,e,t){e||(e=new Uint8Array(Ab.encodingLength(r))),t||(t=0);const n=t,i=r.salt;if(!Fy(i))throw new Error("salt must be a Buffer");const o=r.nextDomain;if(!Fy(o))throw new Error("nextDomain must be a Buffer");return t+=2,e[t]=r.algorithm,t+=1,e[t]=r.flags,t+=1,wt(e,r.iterations,t),t+=2,e[t]=i.length,t+=1,cc(i,e,t,0,i.length),t+=i.length,e[t]=o.length,t+=1,cc(o,e,t,0,o.length),t+=o.length,ga.encode(r.rrtypes,e,t),t+=ga.encode.bytes,Ab.encode.bytes=t-n,wt(e,Ab.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={},i=Zt(r,e);e+=2,n.algorithm=r[e],e+=1,n.flags=r[e],e+=1,n.iterations=Zt(r,e),e+=2;const o=r[e];e+=1,n.salt=r.slice(e,e+o),e+=o;const s=r[e];return e+=1,n.nextDomain=r.slice(e,e+s),e+=s,n.rrtypes=ga.decode(r,e,i-(e-t)),e+=ga.decode.bytes,Ab.decode.bytes=e-t,n},encodingLength(r){return 8+r.salt.length+r.nextDomain.length+ga.encodingLength(r.rrtypes)}}),xb=Jr({encode(r,e,t){e||(e=new Uint8Array(xb.encodingLength(r))),t||(t=0);const n=t,i=r.digest;if(!Fy(i))throw new Error("Digest must be a Buffer");return t+=2,wt(e,r.keyTag,t),t+=2,e[t]=r.algorithm,t+=1,e[t]=r.digestType,t+=1,cc(i,e,t,0,i.length),t+=i.length,xb.encode.bytes=t-n,wt(e,xb.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={},i=Zt(r,e);return e+=2,n.keyTag=Zt(r,e),e+=2,n.algorithm=r[e],e+=1,n.digestType=r[e],e+=1,n.digest=r.slice(e,t+i+2),e+=n.digest.length,xb.decode.bytes=e-t,n},encodingLength(r){return 6+Gh(r.digest)}}),Xm=Jr({encode(r,e,t){e||(e=new Uint8Array(Xm.encodingLength(r))),t||(t=0);const n=t;t+=2,e[t]=r.algorithm,t+=1,e[t]=r.hash,t+=1;const i=V4(r.fingerprint),o=JI(r.hash);if(i!==o)throw new Error(`Invalid length of fingerprint "${r.fingerprint}" for hashType=${r.hash}: ${i} != ${o}`);return $xe(e,r.fingerprint,t,t+=i),Xm.encode.bytes=t-n,wt(e,Xm.encode.bytes-2,n),e},decode(r,e){e||(e=0);const t=e,n={};e+=2,n.algorithm=r[e],e+=1,n.hash=r[e],e+=1;const i=JI(n.hash);return n.fingerprint=Txe(r,e,e+i),e+=i,Xm.decode.bytes=e-t,n},encodingLength(r){return 4+V4(r.fingerprint)}});function JI(r){if(r===1)return 20;if(r===2)return 32;throw new Error(`Invalid hashType=${r}, supported=1,2`)}Xm.getFingerprintLengthForHashType=JI;function vk(r){switch(r.toUpperCase()){case"A":return DW;case"PTR":return _g;case"CNAME":return _g;case"DNAME":return _g;case"TXT":return gE;case"NULL":return vE;case"AAAA":return EE;case"SRV":return wE;case"HINFO":return bE;case"CAA":return Wf;case"NS":return yE;case"SOA":return mE;case"MX":return _E;case"OPT":return lh;case"DNSKEY":return Pl;case"RRSIG":return wb;case"RP":return _b;case"NSEC":return Eb;case"NSEC3":return Ab;case"SSHFP":return Xm;case"DS":return xb}return pE}const za=Jr({encode(r,e,t){e||(e=new Uint8Array(za.encodingLength(r))),t||(t=0);const n=t;if(Xe.encode(r.name,e,t),t+=Xe.encode.bytes,wt(e,Hw(r.type),t),r.type.toUpperCase()==="OPT"){if(r.name!==".")throw new Error("OPT name must be root.");wt(e,r.udpPayloadSize||4096,t+2),e[t+4]=r.extendedRcode||0,e[t+5]=r.ednsVersion||0,wt(e,r.flags||0,t+6),t+=8,lh.encode(r.options||[],e,t),t+=lh.encode.bytes}else{let i=IW(r.class===void 0?"IN":r.class);r.flush&&(i|=ZI),wt(e,i,t+2),cu(e,r.ttl||0,t+4),t+=8;const o=vk(r.type);o.encode(r.data,e,t),t+=o.encode.bytes}return za.encode.bytes=t-n,e},decode(r,e){e||(e=0);const t={},n=e;if(t.name=Xe.decode(r,e),e+=Xe.decode.bytes,t.type=QS(Zt(r,e)),t.type==="OPT")t.udpPayloadSize=Zt(r,e+2),t.extendedRcode=r[e+4],t.ednsVersion=r[e+5],t.flags=Zt(r,e+6),t.flag_do=(t.flags>>15&1)===1,t.options=lh.decode(r,e+8),e+=8+lh.decode.bytes;else{const i=Zt(r,e+2);t.ttl=au(r,e+4),t.class=PW(i&Rxe),t.flush=!!(i&ZI);const o=vk(t.type);t.data=o.decode(r,e+8),e+=8+o.decode.bytes}return za.decode.bytes=e-n,t},encodingLength(r){const e=r.data!==null&&r.data!==void 0?r.data:r.options;return Xe.encodingLength(r.name)+8+vk(r.type).encodingLength(e)}}),Eg=Jr({encode(r,e,t){e||(e=new Uint8Array(Eg.encodingLength(r))),t||(t=0);const n=t;return Xe.encode(r.name,e,t),t+=Xe.encode.bytes,wt(e,Hw(r.type),t),t+=2,wt(e,IW(r.class===void 0?"IN":r.class),t),t+=2,Eg.encode.bytes=t-n,r},decode(r,e){e||(e=0);const t=e,n={};return n.name=Xe.decode(r,e),e+=Xe.decode.bytes,n.type=QS(Zt(r,e)),e+=2,n.class=PW(Zt(r,e)),e+=2,!!(n.class&RW)&&(n.class&=Dxe),Eg.decode.bytes=e-t,n},encodingLength(r){return Xe.encodingLength(r.name)+4}}),qD=1024,qy={encode:function(r,e,t){const n=!e;n&&(e=new Uint8Array(Bxe(r))),t||(t=0);const i=t;return r.questions||(r.questions=[]),r.answers||(r.answers=[]),r.authorities||(r.authorities=[]),r.additionals||(r.additionals=[]),zm.encode(r,e,t),t+=zm.encode.bytes,t=Sb(r.questions,Eg,e,t),t=Sb(r.answers,za,e,t),t=Sb(r.authorities,za,e,t),t=Sb(r.additionals,za,e,t),qy.encode.bytes=t-i,n&&Zw.bytes!==e.length?e.slice(0,Zw.bytes):e},decode:function(r,e){e||(e=0);const t=e,n=zm.decode(r,e);return e+=zm.decode.bytes,e=g2(n.questions,Eg,r,e),e=g2(n.answers,za,r,e),e=g2(n.authorities,za,r,e),e=g2(n.additionals,za,r,e),qy.decode.bytes=e-t,n},encodingLength:function(r){return zm.encodingLength(r)+Qm(r.questions||[],Eg)+Qm(r.answers||[],za)+Qm(r.authorities||[],za)+Qm(r.additionals||[],za)}};qy.encode.bytes=0;qy.decode.bytes=0;const Zw=qy.encode,VD=qy.decode,Bxe=qy.encodingLength;function Qm(r,e){let t=0;for(let n=0;n<r.length;n++)t+=e.encodingLength(r[n]);return t}function Sb(r,e,t,n){for(let i=0;i<r.length;i++)e.encode(r[i],t,n),n+=e.encode.bytes;return n}function g2(r,e,t,n){for(let i=0;i<r.length;i++)r[i]=e.decode(t,n),n+=e.decode.bytes;return n}var H4=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let s1=class{static getSigningMethod(e){return H4(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,t){return H4(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}};var xi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},G4=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const Y4="https://diddht.tbddev.org",jxe=0,Tf=7200,AE=";",es=",";var XI;(function(r){r[r.Discoverable=0]="Discoverable",r[r.Organization=1]="Organization",r[r.Government=2]="Government",r[r.Corporation=3]="Corporation",r[r.LocalBusiness=4]="LocalBusiness",r[r.SoftwarePackage=5]="SoftwarePackage",r[r.WebApp=6]="WebApp",r[r.FinancialInstitution=7]="FinancialInstitution"})(XI||(XI={}));var ls;(function(r){r[r.Ed25519=0]="Ed25519",r[r.secp256k1=1]="secp256k1",r[r.secp256r1=2]="secp256r1",r[r.X25519=3]="X25519"})(ls||(ls={}));var QI;(function(r){r.authentication="auth",r.assertionMethod="asm",r.capabilityDelegation="del",r.capabilityInvocation="inv",r.keyAgreement="agm"})(QI||(QI={}));const MW={Ed25519:ls.Ed25519,ES256K:ls.secp256k1,ES256:ls.secp256r1,"P-256":ls.secp256r1,secp256k1:ls.secp256k1,secp256r1:ls.secp256r1,X25519:ls.X25519},Z4={[ls.Ed25519]:"EdDSA",[ls.secp256k1]:"ES256K",[ls.secp256r1]:"ES256",[ls.X25519]:"ECDH-ES+A256KW"};let cv=class e5 extends s1{static create(){return xi(this,arguments,void 0,function*({keyManager:e=new ju,options:t={}}={}){var n,i,o,s,a,l,d,c,u,f,h;if(!((n=t.verificationMethods)===null||n===void 0)&&n.some(_=>!(_.algorithm in MW)))throw new Error("One or more verification method algorithms are not supported");const p=(i=t.verificationMethods)===null||i===void 0?void 0:i.filter(_=>"id"in _).map(_=>_.id);if(p&&p.length!==new Set(p).size)throw new Error("One or more verification method IDs are not unique");if(!((o=t.services)===null||o===void 0)&&o.some(_=>!_.id||!_.type||!_.serviceEndpoint))throw new Error("One or more services are missing required properties");const y=yield e.generateKey({algorithm:"Ed25519"}),g=yield e.getPublicKey({keyUri:y}),w=yield Bo.identityKeyToIdentifier({identityKey:g}),v=Object.assign(Object.assign({id:w},t.alsoKnownAs&&{alsoKnownAs:t.alsoKnownAs}),t.controllers&&{controller:t.controllers}),m=[...(s=t.verificationMethods)!==null&&s!==void 0?s:[]];m?.some(_=>{var E;return((E=_.id)===null||E===void 0?void 0:E.split("#").pop())==="0"})||m.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const _ of m){const E=_.id&&_.id.split("#").pop()==="0"?y:yield e.generateKey({algorithm:_.algorithm}),S=yield e.getPublicKey({keyUri:E});let T=(l=(a=_.id)!==null&&a!==void 0?a:S.kid)!==null&&l!==void 0?l:yield Kr({jwk:S});T=`${w}#${Kc(T)}`,(d=v.verificationMethod)!==null&&d!==void 0||(v.verificationMethod=[]),v.verificationMethod.push({id:T,type:"JsonWebKey",controller:(c=_.controller)!==null&&c!==void 0?c:w,publicKeyJwk:S});for(const O of(u=_.purposes)!==null&&u!==void 0?u:[])v[O]||(v[O]=[]),v[O].push(T)}(f=t.services)===null||f===void 0||f.forEach(_=>{var E;(E=v.service)!==null&&E!==void 0||(v.service=[]),_.id=`${w}#${_.id.split("#").pop()}`,v.service.push(_)});const b=new Nu({uri:w,document:v,metadata:Object.assign({published:!1},t.types&&{types:t.types}),keyManager:e});if(!((h=t.publish)!==null&&h!==void 0)||h){const _=yield e5.publish({did:b,gatewayUri:t.gatewayUri});b.metadata=_.didDocumentMetadata}return b})}static import(e){return xi(this,arguments,void 0,function*({portableDid:t,keyManager:n=new ju}){var i;const o=Sr.parse(t.uri);if(o?.method!==e5.methodName)throw new yt(ot.MethodNotSupported,"Method not supported");const s=yield Nu.import({portableDid:t,keyManager:n});if(!(!((i=s.document.verificationMethod)===null||i===void 0)&&i.some(a=>{var l;return((l=a.id)===null||l===void 0?void 0:l.split("#").pop())==="0"})))throw new yt(ot.InvalidDidDocument,"DID document must contain an Identity Key");return s})}static getSigningMethod(e){return xi(this,arguments,void 0,function*({didDocument:t,methodId:n="#0"}){var i;const o=Sr.parse(t.id);if(o&&o.method!==this.methodName)throw new yt(ot.MethodNotSupported,`Method not supported: ${o.method}`);const s=(i=t.verificationMethod)===null||i===void 0?void 0:i.find(a=>{var l,d;return Kc(a.id)===((l=Kc(n))!==null&&l!==void 0?l:Kc((d=t.assertionMethod)===null||d===void 0?void 0:d[0]))});if(!(s&&s.publicKeyJwk))throw new yt(ot.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static publish(e){return xi(this,arguments,void 0,function*({did:t,gatewayUri:n=Y4}){return yield J4.put({did:t,gatewayUri:n})})}static resolve(e){return xi(this,arguments,void 0,function*(t,n={}){var i;const o=(i=n?.gatewayUri)!==null&&i!==void 0?i:Y4;try{yield Bo.identifierToIdentityKey({didUri:t});const{didDocument:s,didDocumentMetadata:a}=yield J4.get({didUri:t,gatewayUri:o});return Object.assign(Object.assign({},mo),{didDocument:s,didDocumentMetadata:a})}catch(s){if(!(s instanceof yt))throw new Error(s);return Object.assign(Object.assign({},mo),{didResolutionMetadata:Object.assign({error:s.code},s.message&&{errorMessage:s.message})})}})}};cv.methodName="dht";let J4=class wp{static get(e){return xi(this,arguments,void 0,function*({didUri:t,gatewayUri:n}){const i=Bo.identifierToIdentityKeyBytes({didUri:t}),o=yield wp.pkarrGet({gatewayUri:n,publicKeyBytes:i}),s=yield Bo.parseBep44GetMessage({bep44Message:o}),a=yield wp.fromDnsPacket({didUri:t,dnsPacket:s});return a.didDocumentMetadata.versionId=o.seq.toString(),a})}static put(e){return xi(this,arguments,void 0,function*({did:t,gatewayUri:n}){const i=yield wp.toDnsPacket({didDocument:t.document,didMetadata:t.metadata,authoritativeGatewayUris:[n]}),o=yield Bo.createBep44PutMessage({dnsPacket:i,publicKeyBytes:Bo.identifierToIdentityKeyBytes({didUri:t.uri}),signer:yield t.getSigner({methodId:"0"})}),s=yield wp.pkarrPut({gatewayUri:n,bep44Message:o});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:s,versionId:o.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return xi(this,arguments,void 0,function*({gatewayUri:t,publicKeyBytes:n}){const i=ge.uint8Array(n).toBase32Z(),o=new URL(i,t).href;let s;try{if(s=yield fetch(o,{method:"GET"}),!s.ok)throw new yt(ot.NotFound,`Pkarr record not found for: ${i}`)}catch(d){throw d instanceof yt?d:new yt(ot.InternalError,`Failed to fetch Pkarr record: ${d.message}`)}const a=yield s.arrayBuffer();if(!a)throw new yt(ot.NotFound,`Pkarr record not found for: ${i}`);if(a.byteLength<72)throw new yt(ot.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${a.byteLength}`);if(a.byteLength>1072)throw new yt(ot.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${a.byteLength}`);return{k:n,seq:Number(new DataView(a).getBigUint64(64)),sig:new Uint8Array(a,0,64),v:new Uint8Array(a,72)}})}static pkarrPut(e){return xi(this,arguments,void 0,function*({gatewayUri:t,bep44Message:n}){const i=ge.uint8Array(n.k).toBase32Z(),o=new URL(i,t).href,s=new Uint8Array(n.v.length+72);s.set(n.sig,0),new DataView(s.buffer).setBigUint64(n.sig.length,BigInt(n.seq)),s.set(n.v,n.sig.length+8);let a;try{a=yield fetch(o,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:s})}catch(l){throw new yt(ot.InternalError,`Failed to put Pkarr record for identifier ${i}: ${l.message}`)}return a.ok})}static fromDnsPacket(e){return xi(this,arguments,void 0,function*({didUri:t,dnsPacket:n}){var i,o,s;const a={id:t},l={published:!0},d=new Map;for(const c of(i=n?.answers)!==null&&i!==void 0?i:[]){if(c.type!=="TXT")continue;const u=c.name.split(".")[0].substring(1);switch(!0){case u.startsWith("aka"):{const f=Bo.parseTxtDataToString(c.data);a.alsoKnownAs=f.split(es);break}case u.startsWith("cnt"):{const f=Bo.parseTxtDataToString(c.data);a.controller=f.includes(es)?f.split(es):f;break}case u.startsWith("k"):{const{id:f,t:h,k:p,c:y,a:g}=Bo.parseTxtDataToObject(c.data),w=ge.base64Url(p).toUint8Array(),v=ls[Number(h)];let m=yield Bo.keyConverter(v).bytesToPublicKey({publicKeyBytes:w});m.alg=g||Z4[Number(h)];const b=u==="k0"?"0":f!==void 0?f:yield Kr({jwk:m});(o=a.verificationMethod)!==null&&o!==void 0||(a.verificationMethod=[]);const _=`${t}#${b}`;a.verificationMethod.push({id:_,type:"JsonWebKey",controller:y??t,publicKeyJwk:m}),d.set(u,_);break}case u.startsWith("s"):{const f=Bo.parseTxtDataToObject(c.data),{id:h,t:p,se:y}=f,g=G4(f,["id","t","se"]),w=y.includes(es)?y.split(es):[y],v=Object.fromEntries(Object.entries(g).map(([m,b])=>[m,b.includes(es)?b.split(es):b]));(s=a.service)!==null&&s!==void 0||(a.service=[]),a.service.push(Object.assign(Object.assign({},v),{id:`${t}#${h}`,type:p,serviceEndpoint:w}));break}case u.startsWith("typ"):{const{id:f}=Bo.parseTxtDataToObject(c.data);l.types=f.split(es).map(h=>Number(h));break}case u.startsWith("did"):{const f=v=>v.split(es).map(m=>d.get(m)).filter(m=>typeof m=="string"),{auth:h,asm:p,del:y,inv:g,agm:w}=Bo.parseTxtDataToObject(c.data);h&&(a.authentication=f(h)),p&&(a.assertionMethod=f(p)),y&&(a.capabilityDelegation=f(y)),g&&(a.capabilityInvocation=f(g)),w&&(a.keyAgreement=f(w));break}}}return{didDocument:a,didDocumentMetadata:l,didResolutionMetadata:{}}})}static toDnsPacket(e){return xi(this,arguments,void 0,function*({didDocument:t,didMetadata:n,authoritativeGatewayUris:i,previousDidProof:o}){var s,a,l,d,c;const u=[],f=[],h=new Map,p=[],y=[];if(o!==void 0){const{signature:v,previousDid:m}=o;yield Bo.validatePreviousDidProof({newDid:t.id,previousDidProof:o}),u.push({type:"TXT",name:"_prv._did.",ttl:Tf,data:`id=${m};s=${v}`})}if(t.alsoKnownAs&&u.push({type:"TXT",name:"_aka._did.",ttl:Tf,data:t.alsoKnownAs.join(es)}),t.controller){const v=Array.isArray(t.controller)?t.controller.join(es):t.controller;u.push({type:"TXT",name:"_cnt._did.",ttl:Tf,data:v})}for(const[v,m]of(a=(s=t.verificationMethod)===null||s===void 0?void 0:s.entries())!==null&&a!==void 0?a:[]){const b=`k${v}`;y.push(b);let _=m.id.split("#").pop();h.set(_,b);const E=m.publicKeyJwk;if(!(E?.crv&&E.crv in MW))throw new yt(ot.InvalidPublicKeyType,`Verification method '${m.id}' contains an unsupported key type: ${(l=E?.crv)!==null&&l!==void 0?l:"undefined"}`);const S=ls[E.crv],T=yield Bo.keyConverter(E.crv).publicKeyToBytes({publicKey:E}),O=ge.uint8Array(T).toBase64Url(),M=[`t=${S}`,`k=${O}`];_!=="0"&&(yield Kr({jwk:E}))!==_&&M.unshift(`id=${_}`),E.alg!==Z4[S]&&M.push(`a=${E.alg}`),m.controller!==t.id&&M.push(`c=${m.controller}`),u.push({type:"TXT",name:`_${b}._did.`,ttl:Tf,data:M.join(AE)})}(d=t.service)===null||d===void 0||d.forEach((v,m)=>{const b=`s${m}`;p.push(b);let{id:_,type:E,serviceEndpoint:S}=v,T=G4(v,["id","type","serviceEndpoint"]);_=Kc(_),S=Array.isArray(S)?S.join(","):S;const M=Object.entries(Object.assign({id:_,t:E,se:S},T)).map(([W,U])=>`${W}=${U}`).join(AE),Q=Bo.chunkDataIfNeeded(M);u.push({type:"TXT",name:`_${b}._did.`,ttl:Tf,data:Q})});const g=[`v=${jxe}`];if(y.length&&g.push(`vm=${y.join(es)}`),Object.keys(Lw).forEach(v=>{var m;const b=(m=t[v])===null||m===void 0?void 0:m.map(_=>h.get(_.split("#").pop()));if(b){const _=QI[v];g.push(`${_}=${b.join(es)}`)}}),p.length&&g.push(`svc=${p.join(es)}`),!((c=n.types)===null||c===void 0)&&c.length){const m=n.types.map(b=>typeof b=="string"?XI[b]:b);u.push({type:"TXT",name:"_typ._did.",ttl:Tf,data:`id=${m.join(es)}`})}u.push({type:"TXT",name:"_did."+wp.getUniqueDidSuffix(t.id)+".",ttl:Tf,data:g.join(AE)});for(const v of i||[])f.push({type:"NS",name:"_did."+wp.getUniqueDidSuffix(t.id)+".",ttl:Tf,data:v+"."});return{id:0,type:"response",flags:qD,answers:[...u,...f]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}},Bo=class xE{static createBep44PutMessage(e){return xi(this,arguments,void 0,function*({dnsPacket:t,publicKeyBytes:n,signer:i}){const o=Math.ceil(Date.now()/1e3),s=Zw(t),a=av.encode({seq:o,v:s}).subarray(1,-1);if(a.length>1e3)throw new yt(ot.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${a.length} bytes`);const l=yield i.sign({data:a});return{k:n,seq:o,sig:l,v:s}})}static identifierToIdentityKey(e){return xi(this,arguments,void 0,function*({didUri:t}){let n=xE.identifierToIdentityKeyBytes({didUri:t});return yield Is.bytesToPublicKey({publicKeyBytes:n})})}static identifierToIdentityKeyBytes({didUri:e}){const t=Sr.parse(e);if(!t)throw new yt(ot.InvalidDid,`Invalid DID URI: ${e}`);if(t.method!==cv.methodName)throw new yt(ot.MethodNotSupported,`Method not supported: ${t.method}`);let n;try{n=ge.base32Z(t.id).toUint8Array()}catch{throw new yt(ot.InvalidPublicKey,"Failed to decode method-specific identifier")}if(n.length!==32)throw new yt(ot.InvalidPublicKeyLength,`Invalid public key length: ${n.length}`);return n}static identityKeyToIdentifier(e){return xi(this,arguments,void 0,function*({identityKey:t}){const n=yield Is.publicKeyToBytes({publicKey:t}),i=ge.uint8Array(n).toBase32Z();return`did:${cv.methodName}:${i}`})}static keyConverter(e){const n={Ed25519:Is,"P-256":{publicKeyToBytes:i=>xi(this,[i],void 0,function*({publicKey:o}){const s=yield nc.publicKeyToBytes({publicKey:o});return yield nc.compressPublicKey({publicKeyBytes:s})}),bytesToPublicKey:nc.bytesToPublicKey,privateKeyToBytes:nc.privateKeyToBytes,bytesToPrivateKey:nc.bytesToPrivateKey},secp256k1:{publicKeyToBytes:i=>xi(this,[i],void 0,function*({publicKey:o}){const s=yield ma.publicKeyToBytes({publicKey:o});return yield ma.compressPublicKey({publicKeyBytes:s})}),bytesToPublicKey:ma.bytesToPublicKey,privateKeyToBytes:ma.privateKeyToBytes,bytesToPrivateKey:ma.bytesToPrivateKey},X25519:hW}[e];if(!n)throw new yt(ot.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static parseBep44GetMessage(e){return xi(this,arguments,void 0,function*({bep44Message:t}){const n=yield Is.bytesToPublicKey({publicKeyBytes:t.k}),i=av.encode({seq:t.seq,v:t.v}).subarray(1,-1);if(!(yield Is.verify({key:n,signature:t.sig,data:i})))throw new yt(ot.InvalidSignature,"Invalid signature for DHT BEP44 message");return VD(t.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(AE).reduce((t,n)=>{const[i,o]=n.split("=");return t[i]=o,t},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return ge.uint8Array(e).toString();if(Array.isArray(e))return e.map(t=>this.parseTxtDataToString(t)).join("");throw new yt(ot.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return xi(this,arguments,void 0,function*({newDid:t,previousDidProof:n}){const i=yield xE.identifierToIdentityKey({didUri:n.previousDid}),o=xE.identifierToIdentityKeyBytes({didUri:t}),s=ge.base64Url(n.signature).toUint8Array();if(!(yield Is.verify({key:i,data:o,signature:s})))throw new yt(ot.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const t=[];for(let n=0;n<e.length;n+=255)t.push(e.slice(n,n+255));return t}};const Kn={DeltaExceedsMaximumSize:"DeltaExceedsMaximumSize",DidDocumentPublicKeyIdDuplicated:"DidDocumentPublicKeyIdDuplicated",DidDocumentPublicKeyMissingOrIncorrectType:"DidDocumentPublicKeyMissingOrIncorrectType",DidDocumentServiceIdDuplicated:"DidDocumentServiceIdDuplicated",DidSuffixIncorrectLength:"DidSuffixIncorrectLength",EncodedStringIncorrectEncoding:"EncodedStringIncorrectEncoding",IdNotUsingBase64UrlCharacterSet:"IdNotUsingBase64UrlCharacterSet",IdTooLong:"IdTooLong",JwkEs256kMissingOrInvalidCrv:"JwkEs256kMissingOrInvalidCrv",JwkEs256kMissingOrInvalidKty:"JwkEs256kMissingOrInvalidKty",JwkEs256kHasIncorrectLengthOfX:"JwkEs256kHasIncorrectLengthOfX",JwkEs256kHasIncorrectLengthOfY:"JwkEs256kHasIncorrectLengthOfY",JwkEs256kHasIncorrectLengthOfD:"JwkEs256kHasIncorrectLengthOfD",MultihashStringNotAMultihash:"MultihashStringNotAMultihash",MultihashUnsupportedHashAlgorithm:"MultihashUnsupportedHashAlgorithm",PublicKeyJwkEs256kHasUnexpectedProperty:"PublicKeyJwkEs256kHasUnexpectedProperty",PublicKeyPurposeDuplicated:"PublicKeyPurposeDuplicated",ServiceEndpointCannotBeAnArray:"ServiceEndpointCannotBeAnArray",ServiceEndpointStringNotValidUri:"ServiceEndpointStringNotValidUri",ServiceTypeTooLong:"ServiceTypeTooLong"};class zn extends Error{constructor(e,t){super(`${e}: ${t}`),this.code=e,Object.setPrototypeOf(this,new.target.prototype)}}class Gl{static encode(e){return jP.baseEncode(e)}static decodeAsBytes(e,t){if(!Gl.isBase64UrlString(e))throw new zn(Kn.EncodedStringIncorrectEncoding,`Given ${t} must be base64url string.`);return jP.baseDecode(e)}static decodeAsString(e,t){const n=Gl.decodeAsBytes(e,t);return Gl.bytesToString(n)}static isBase64UrlString(e){return/^[A-Za-z0-9_-]+$/.test(e)}static stringToBytes(e){return new TextEncoder().encode(e)}static bytesToString(e){return new TextDecoder().decode(e)}}var t5;(function(r){r.Public="public",r.Private="private"})(t5||(t5={}));const xl=t5;class Hs{static validateEs256kOperationKey(e,t){const n=new Set(["kty","crv","x","y"]);t===xl.Private&&n.add("d");for(const i in e)if(!n.has(i))throw new zn(Kn.PublicKeyJwkEs256kHasUnexpectedProperty,`SECP256K1 JWK key has unexpected property '${i}'.`);if(e.crv!=="secp256k1")throw new zn(Kn.JwkEs256kMissingOrInvalidCrv,`SECP256K1 JWK 'crv' property must be 'secp256k1' but got '${e.crv}.'`);if(e.kty!=="EC")throw new zn(Kn.JwkEs256kMissingOrInvalidKty,`SECP256K1 JWK 'kty' property must be 'EC' but got '${e.kty}.'`);if(e.x.length!==43)throw new zn(Kn.JwkEs256kHasIncorrectLengthOfX,"SECP256K1 JWK 'x' property must be 43 bytes.");if(e.y.length!==43)throw new zn(Kn.JwkEs256kHasIncorrectLengthOfY,"SECP256K1 JWK 'y' property must be 43 bytes.");if(t===xl.Private&&(e.d===void 0||e.d.length!==43))throw new zn(Kn.JwkEs256kHasIncorrectLengthOfD,"SECP256K1 JWK 'd' property must be 43 bytes.")}static validateId(e){if(e.length>50)throw new zn(Kn.IdTooLong,`Key ID length ${e.length} exceed max allowed length of 50.`);if(!Gl.isBase64UrlString(e))throw new zn(Kn.IdNotUsingBase64UrlCharacterSet,`Key ID '${e}' is not a Base64URL string.`)}static validatePublicKeyPurposes(e){if(e===void 0)return;const t=new Set;for(const n of e){if(t.has(n))throw new zn(Kn.PublicKeyPurposeDuplicated,`Public key purpose '${n}' already specified.`);t.add(n)}}}class fa{}fa.hashAlgorithmInMultihashCode=18;fa.maxCanonicalizedDeltaSizeInBytes=1e3;var Nxe=function r(e){if(typeof e=="number"&&isNaN(e))throw new Error("NaN is not allowed");if(typeof e=="number"&&!isFinite(e))throw new Error("Infinity is not allowed");return e===null||typeof e!="object"?JSON.stringify(e):e.toJSON instanceof Function?r(e.toJSON()):Array.isArray(e)?`[${e.reduce((i,o,s)=>`${i}${s===0?"":","}${r(o===void 0||typeof o=="symbol"?null:o)}`,"")}]`:`{${Object.keys(e).sort().reduce((n,i)=>{if(e[i]===void 0||typeof e[i]=="symbol")return n;const o=n.length===0?"":",";return`${n}${o}${r(i)}:${r(e[i])}`},"")}}`};const Uxe=Vu(Nxe);class Bh{static canonicalizeAsBytes(e){const t=Bh.removeAllUndefinedProperties(e),n=Uxe(t);return Gl.stringToBytes(n)}static removeAllUndefinedProperties(e){for(const t in e)typeof e[t]=="object"?Bh.removeAllUndefinedProperties(e[t]):e[t]===void 0&&delete e[t];return e}}var K0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class wi{static hash(e,t){return K0(this,void 0,void 0,function*(){let n;switch(t){case 18:n=(yield kM.digest(e)).bytes;break;default:throw new zn(Kn.MultihashUnsupportedHashAlgorithm,`Hash algorithm defined in multihash code ${t} is not supported.`)}return n})}static hashAsNonMultihashBytes(e,t){return K0(this,void 0,void 0,function*(){let n;switch(t){case 18:n=yield kM.encode(e);break;default:throw new zn(Kn.MultihashUnsupportedHashAlgorithm,`Hash algorithm defined in multihash code ${t} is not supported.`)}return n})}static canonicalizeThenHashThenEncode(e,t){return K0(this,void 0,void 0,function*(){const n=Bh.canonicalizeAsBytes(e);return yield wi.hashThenEncode(n,t)})}static canonicalizeThenDoubleHashThenEncode(e,t){return K0(this,void 0,void 0,function*(){const n=Bh.canonicalizeAsBytes(e),i=yield wi.hashAsNonMultihashBytes(n,t);return yield wi.hashThenEncode(i,t)})}static hashThenEncode(e,t){return K0(this,void 0,void 0,function*(){const n=yield wi.hash(e,t);return Gl.encode(n)})}static validateEncodedHashComputedUsingSupportedHashAlgorithm(e,t){let n;const i=Gl.decodeAsBytes(e,t);try{n=tz(i)}catch{throw new zn(Kn.MultihashStringNotAMultihash,`Given ${t} string '${e}' is not a multihash after decoding.`)}const o=fa.hashAlgorithmInMultihashCode;if(o!==n.code)throw new zn(Kn.MultihashUnsupportedHashAlgorithm,`Given ${t} uses unsupported multihash algorithm with code ${n.code}, should use ${o} or change IonSdkConfig to desired hashing algorithm.`)}}var r5;(function(r){r.Create="create",r.Update="update",r.Deactivate="deactivate",r.Recover="recover"})(r5||(r5={}));const v2=r5;var n5;(function(r){r.Replace="replace",r.AddPublicKeys="add-public-keys",r.RemovePublicKeys="remove-public-keys",r.AddServices="add-services",r.RemoveServices="remove-services"})(n5||(n5={}));const Om=n5;var b2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Uo{static createCreateRequest(e){return b2(this,void 0,void 0,function*(){const t=e.recoveryKey,n=e.updateKey,i=e.document.publicKeys,o=e.document.services;Hs.validateEs256kOperationKey(t,xl.Public),Hs.validateEs256kOperationKey(n,xl.Public),Uo.validateDidDocumentKeys(i),Uo.validateServices(o);const s=fa.hashAlgorithmInMultihashCode,a=[{action:Om.Replace,document:e.document}],l={updateCommitment:yield wi.canonicalizeThenDoubleHashThenEncode(n,s),patches:a};Uo.validateDeltaSize(l);const c={deltaHash:yield wi.canonicalizeThenHashThenEncode(l,s),recoveryCommitment:yield wi.canonicalizeThenDoubleHashThenEncode(t,s)};return{type:v2.Create,suffixData:c,delta:l}})}static createDeactivateRequest(e){return b2(this,void 0,void 0,function*(){Uo.validateDidSuffix(e.didSuffix),Hs.validateEs256kOperationKey(e.recoveryPublicKey,xl.Public);const t=fa.hashAlgorithmInMultihashCode,n=yield wi.canonicalizeThenHashThenEncode(e.recoveryPublicKey,t),i={didSuffix:e.didSuffix,recoveryKey:e.recoveryPublicKey},o=yield e.signer.sign({alg:"ES256K"},i);return{type:v2.Deactivate,didSuffix:e.didSuffix,revealValue:n,signedData:o}})}static createRecoverRequest(e){return b2(this,void 0,void 0,function*(){Uo.validateDidSuffix(e.didSuffix),Hs.validateEs256kOperationKey(e.recoveryPublicKey,xl.Public),Hs.validateEs256kOperationKey(e.nextRecoveryPublicKey,xl.Public),Hs.validateEs256kOperationKey(e.nextUpdatePublicKey,xl.Public),Uo.validateDidDocumentKeys(e.document.publicKeys),Uo.validateServices(e.document.services);const t=fa.hashAlgorithmInMultihashCode,n=yield wi.canonicalizeThenHashThenEncode(e.recoveryPublicKey,t),i=[{action:Om.Replace,document:e.document}],o=yield wi.canonicalizeThenDoubleHashThenEncode(e.nextUpdatePublicKey,t),s={patches:i,updateCommitment:o},a=yield wi.canonicalizeThenHashThenEncode(s,t),d={recoveryCommitment:yield wi.canonicalizeThenDoubleHashThenEncode(e.nextRecoveryPublicKey,t),recoveryKey:e.recoveryPublicKey,deltaHash:a},c=yield e.signer.sign({alg:"ES256K"},d);return{type:v2.Recover,didSuffix:e.didSuffix,revealValue:n,delta:s,signedData:c}})}static createUpdateRequest(e){return b2(this,void 0,void 0,function*(){if(Uo.validateDidSuffix(e.didSuffix),Hs.validateEs256kOperationKey(e.updatePublicKey,xl.Public),Hs.validateEs256kOperationKey(e.nextUpdatePublicKey,xl.Public),Uo.validateServices(e.servicesToAdd),Uo.validateDidDocumentKeys(e.publicKeysToAdd),e.idsOfServicesToRemove!==void 0)for(const p of e.idsOfServicesToRemove)Hs.validateId(p);if(e.idsOfPublicKeysToRemove!==void 0)for(const p of e.idsOfPublicKeysToRemove)Hs.validateId(p);const t=[],n=e.servicesToAdd;if(n!==void 0&&n.length>0){const p={action:Om.AddServices,services:n};t.push(p)}const i=e.idsOfServicesToRemove;if(i!==void 0&&i.length>0){const p={action:Om.RemoveServices,ids:i};t.push(p)}const o=e.publicKeysToAdd;if(o!==void 0&&o.length>0){const p={action:Om.AddPublicKeys,publicKeys:o};t.push(p)}const s=e.idsOfPublicKeysToRemove;if(s!==void 0&&s.length>0){const p={action:Om.RemovePublicKeys,ids:s};t.push(p)}const a=fa.hashAlgorithmInMultihashCode,l=yield wi.canonicalizeThenHashThenEncode(e.updatePublicKey,a),d=yield wi.canonicalizeThenDoubleHashThenEncode(e.nextUpdatePublicKey,a),c={patches:t,updateCommitment:d},u=yield wi.canonicalizeThenHashThenEncode(c,a),f={updateKey:e.updatePublicKey,deltaHash:u},h=yield e.signer.sign({alg:"ES256K"},f);return{type:v2.Update,didSuffix:e.didSuffix,revealValue:l,delta:c,signedData:h}})}static validateDidSuffix(e){wi.validateEncodedHashComputedUsingSupportedHashAlgorithm(e,"didSuffix")}static validateDidDocumentKeys(e){if(e===void 0)return;const t=new Set;for(const n of e){if(Array.isArray(n.publicKeyJwk))throw new zn(Kn.DidDocumentPublicKeyMissingOrIncorrectType,"DID Document key 'publicKeyJwk' property is not a non-array object.");if(Hs.validateId(n.id),t.has(n.id))throw new zn(Kn.DidDocumentPublicKeyIdDuplicated,`DID Document key with ID '${n.id}' already exists.`);t.add(n.id),Hs.validatePublicKeyPurposes(n.purposes)}}static validateServices(e){if(e!==void 0&&e.length!==0){const t=new Set;for(const n of e){if(Uo.validateService(n),t.has(n.id))throw new zn(Kn.DidDocumentServiceIdDuplicated,"Service id has to be unique");t.add(n.id)}}}static validateService(e){Hs.validateId(e.id);const t=30;if(e.type.length>t){const n=`Service endpoint type length ${e.type.length} exceeds max allowed length of ${t}.`;throw new zn(Kn.ServiceTypeTooLong,n)}if(Array.isArray(e.serviceEndpoint)){const n="Service endpoint value cannot be an array.";throw new zn(Kn.ServiceEndpointCannotBeAnArray,n)}if(typeof e.serviceEndpoint=="string"&&_q.parse(e.serviceEndpoint).error!==void 0)throw new zn(Kn.ServiceEndpointStringNotValidUri,`Service endpoint string '${e.serviceEndpoint}' is not a URI.`)}static validateDeltaSize(e){const t=Bh.canonicalizeAsBytes(e);if(t.length>fa.maxCanonicalizedDeltaSizeInBytes){const n=`Delta of ${t.length} bytes exceeded limit of ${fa.maxCanonicalizedDeltaSizeInBytes} bytes.`;throw new zn(Kn.DeltaExceedsMaximumSize,n)}}}var X4=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class a1{static createLongFormDid(e){return X4(this,void 0,void 0,function*(){const t=yield Uo.createCreateRequest(e),n=yield a1.computeDidUniqueSuffix(t.suffixData);let i;fa.network===void 0||fa.network==="mainnet"?i=`did:ion:${n}`:i=`did:ion:${fa.network}:${n}`;const o={suffixData:t.suffixData,delta:t.delta},s=Bh.canonicalizeAsBytes(o),a=Gl.encode(s);return`${i}:${a}`})}static computeDidUniqueSuffix(e){return X4(this,void 0,void 0,function*(){const t=Bh.canonicalizeAsBytes(e),n=yield wi.hash(t,fa.hashAlgorithmInMultihashCode);return Gl.encode(n)})}}var Q4;(function(r){r.Mainnet="mainnet",r.Testnet="test"})(Q4||(Q4={}));var eN;(function(r){r.Authentication="authentication",r.AssertionMethod="assertionMethod",r.CapabilityInvocation="capabilityInvocation",r.CapabilityDelegation="capabilityDelegation",r.KeyAgreement="keyAgreement"})(eN||(eN={}));var Qf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Il;(function(r){r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.secp256r1="secp256r1",r.X25519="X25519"})(Il||(Il={}));const Lxe={Ed25519:Il.Ed25519,ES256K:Il.secp256k1,ES256:Il.secp256r1,"P-256":Il.secp256r1,secp256k1:Il.secp256k1,secp256r1:Il.secp256r1},tN="https://ion.tbd.engineering";let Kxe=class Tb extends s1{static create(){return Qf(this,arguments,void 0,function*({keyManager:e=new ju,options:t={}}={}){var n,i,o,s,a,l,d;if(!((n=t.verificationMethods)===null||n===void 0)&&n.some(_=>!(_.algorithm in Lxe)))throw new Error("One or more verification method algorithms are not supported");const c=(i=t.verificationMethods)===null||i===void 0?void 0:i.filter(_=>"id"in _).map(_=>_.id);if(c&&c.length!==new Set(c).size)throw new Error("One or more verification method IDs are not unique");if(!((o=t.services)===null||o===void 0)&&o.some(_=>!_.id||!_.type||!_.serviceEndpoint))throw new Error("One or more services are missing required properties");const u={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},f=[];for(const _ of(s=t.verificationMethods)!==null&&s!==void 0?s:[u]){const E=yield e.generateKey({algorithm:_.algorithm}),S=yield e.getPublicKey({keyUri:E});f.push({id:_.id,publicKeyJwk:S,purposes:(a=_.purposes)!==null&&a!==void 0?a:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const h=yield e.generateKey({algorithm:Il.secp256k1}),p=yield e.getPublicKey({keyUri:h}),y=yield e.generateKey({algorithm:Il.secp256k1}),g=yield e.getPublicKey({keyUri:y}),w=yield z0.computeLongFormDidUri({recoveryKey:p,updateKey:g,services:(l=t.services)!==null&&l!==void 0?l:[],verificationMethods:f}),{didDocument:v,didResolutionMetadata:m}=yield Tb.resolve(w,{gatewayUri:t.gatewayUri});if(v===null)throw new Error(`Unable to resolve DID during creation: ${m?.error}`);const b=new Nu({uri:w,document:v,metadata:{published:!1,canonicalId:w.split(":",3).join(":"),recoveryKey:p,updateKey:g},keyManager:e});if(!((d=t.publish)!==null&&d!==void 0)||d){const _=yield Tb.publish({did:b,gatewayUri:t.gatewayUri});b.metadata=_.didDocumentMetadata}return b})}static getSigningMethod(e){return Qf(this,arguments,void 0,function*({didDocument:t,methodId:n}){var i;const o=Sr.parse(t.id);if(o&&o.method!==this.methodName)throw new yt(ot.MethodNotSupported,`Method not supported: ${o.method}`);const s=(i=t.verificationMethod)===null||i===void 0?void 0:i.find(a=>{var l;return a.id===(n??((l=t.assertionMethod)===null||l===void 0?void 0:l[0]))});if(!(s&&s.publicKeyJwk))throw new yt(ot.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static import(e){return Qf(this,arguments,void 0,function*({portableDid:t,keyManager:n=new ju}){const i=Sr.parse(t.uri);if(i?.method!==Tb.methodName)throw new yt(ot.MethodNotSupported,"Method not supported");return yield Nu.import({portableDid:t,keyManager:n})})}static publish(e){return Qf(this,arguments,void 0,function*({did:t,gatewayUri:n=tN}){var i,o,s;const a=(o=(i=t.document.verificationMethod)===null||i===void 0?void 0:i.map(c=>({id:c.id,publicKeyJwk:c.publicKeyJwk,purposes:rxe({didDocument:t.document,methodId:c.id})})))!==null&&o!==void 0?o:[],l=yield z0.createIonDocument({services:(s=t.document.service)!==null&&s!==void 0?s:[],verificationMethods:a}),d=yield z0.constructCreateRequest({ionDocument:l,recoveryKey:t.metadata.recoveryKey,updateKey:t.metadata.updateKey});try{const c=z0.appendPathToUrl({baseUrl:n,path:"/operations"}),u=yield fetch(c,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:u.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:ot.InternalError,errorMessage:`Failed to publish DID document for: ${t.uri}`}}}})}static resolve(e){return Qf(this,arguments,void 0,function*(t,n={}){var i,o;const s=Sr.parse(t);if(!s)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"invalidDid"}});if(s.method!==Tb.methodName)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"methodNotSupported"}});const a=(i=n?.gatewayUri)!==null&&i!==void 0?i:tN;try{const l=z0.appendPathToUrl({baseUrl:a,path:`/identifiers/${t}`}),d=yield fetch(l);if(!d.ok)throw new yt(ot.NotFound,`Unable to find DID document for: ${t}`);const{didDocument:c,didDocumentMetadata:u}=yield d.json();return Object.assign(Object.assign(Object.assign({},mo),c&&{didDocument:c}),{didDocumentMetadata:Object.assign({published:(o=u?.method)===null||o===void 0?void 0:o.published},u)})}catch(l){if(!(l instanceof yt))throw new Error(l);return Object.assign(Object.assign({},mo),{didResolutionMetadata:Object.assign({error:l.code},l.message&&{errorMessage:l.message})})}})}};Kxe.methodName="ion";let z0=class _p{static appendPathToUrl({baseUrl:e,path:t}){const n=new URL(e);return n.pathname=n.pathname.endsWith("/")?n.pathname:n.pathname+"/",n.pathname+=t.startsWith("/")?t.substring(1):t,n.toString()}static computeLongFormDidUri(e){return Qf(this,arguments,void 0,function*({recoveryKey:t,updateKey:n,services:i,verificationMethods:o}){const s=yield _p.createIonDocument({services:i,verificationMethods:o}),a=_p.normalizeJwk(t),l=_p.normalizeJwk(n);return yield a1.createLongFormDid({document:s,recoveryKey:a,updateKey:l})})}static constructCreateRequest(e){return Qf(this,arguments,void 0,function*({ionDocument:t,recoveryKey:n,updateKey:i}){return yield Uo.createCreateRequest({document:t,recoveryKey:_p.normalizeJwk(n),updateKey:_p.normalizeJwk(i)})})}static createIonDocument(e){return Qf(this,arguments,void 0,function*({services:t,verificationMethods:n}){var i,o;const s=[];for(const d of n){let c=(o=(i=d.id)!==null&&i!==void 0?i:d.publicKeyJwk.kid)!==null&&o!==void 0?o:yield Kr({jwk:d.publicKeyJwk});c=`${c.split("#").pop()}`;const u={id:c,publicKeyJwk:_p.normalizeJwk(d.publicKeyJwk),purposes:d.purposes,type:"JsonWebKey2020"};s.push(u)}const a=t.map(d=>Object.assign(Object.assign({},d),{id:`${d.id.split("#").pop()}`}));return{publicKeys:s,services:a}})}static normalizeJwk(e){const t=e.kty;let n;if(t==="EC")n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(t==="oct")n={k:e.k,kty:e.kty};else if(t==="OKP")n={crv:e.crv,kty:e.kty,x:e.x};else if(t==="RSA")n={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${t}`);return n}};var w2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let eT=class $b extends s1{static create(){return w2(this,arguments,void 0,function*({keyManager:e=new ju,options:t={}}={}){var n,i,o,s;if(t.algorithm&&t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(t.verificationMethods&&t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const a=(s=(n=t.algorithm)!==null&&n!==void 0?n:(o=(i=t.verificationMethods)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.algorithm)!==null&&s!==void 0?s:"Ed25519",l=yield e.generateKey({algorithm:a}),d=yield e.getPublicKey({keyUri:l}),c=ge.object(d).toBase64Url(),u=`did:${$b.methodName}:${c}`,h=(yield $b.resolve(u)).didDocument;return new Nu({uri:u,document:h,metadata:{},keyManager:e})})}static getSigningMethod(e){return w2(this,arguments,void 0,function*({didDocument:t}){var n;const i=Sr.parse(t.id);if(i&&i.method!==this.methodName)throw new yt(ot.MethodNotSupported,`Method not supported: ${i.method}`);const[o]=(n=t.verificationMethod)!==null&&n!==void 0?n:[];if(!(o&&o.publicKeyJwk))throw new yt(ot.InternalError,"A verification method intended for signing could not be determined from the DID Document");return o})}static import(e){return w2(this,arguments,void 0,function*({portableDid:t,keyManager:n=new ju}){const i=Sr.parse(t.uri);if(i?.method!==$b.methodName)throw new yt(ot.MethodNotSupported,"Method not supported");const o=yield Nu.import({portableDid:t,keyManager:n});if(o.document.verificationMethod.length!==1)throw new yt(ot.InvalidDidDocument,"DID document must contain exactly one verification method");return o})}static resolve(e,t){return w2(this,void 0,void 0,function*(){const n=Sr.parse(e);let i;try{i=ge.base64Url(n.id).toObject()}catch{}if(!n||!i)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"invalidDid"}});if(n.method!==$b.methodName)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"methodNotSupported"}});const o={"@context":["https://www.w3.org/ns/did/v1"],id:n.uri},s=`${o.id}#0`;switch(o.verificationMethod=[{id:s,type:"JsonWebKey",controller:o.id,publicKeyJwk:i}],o.authentication=[s],o.assertionMethod=[s],o.capabilityInvocation=[s],o.capabilityDelegation=[s],o.keyAgreement=[s],i.use){case"sig":{delete o.keyAgreement;break}case"enc":{delete o.authentication,delete o.assertionMethod,delete o.capabilityInvocation,delete o.capabilityDelegation;break}}return Object.assign(Object.assign({},mo),{didDocument:o})})}};eT.methodName="jwk";var Ic=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Gd;(function(r){r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.secp256r1="secp256r1",r.X25519="X25519"})(Gd||(Gd={}));const bk={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},zxe={Ed25519:Gd.Ed25519,ES256K:Gd.secp256k1,ES256:Gd.secp256r1,"P-256":Gd.secp256r1,secp256k1:Gd.secp256k1,secp256r1:Gd.secp256r1,X25519:Gd.X25519};let BW=class qd extends s1{static create(){return Ic(this,arguments,void 0,function*({keyManager:e=new ju,options:t={}}={}){var n,i,o,s;if(t.algorithm&&t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(t.verificationMethods&&t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const a=(s=(n=t.algorithm)!==null&&n!==void 0?n:(o=(i=t.verificationMethods)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.algorithm)!==null&&s!==void 0?s:"Ed25519",l=yield e.generateKey({algorithm:a}),d=yield e.getPublicKey({keyUri:l}),c=yield Fa.publicKeyToMultibaseId({publicKey:d}),u=`did:${qd.methodName}:${c}`,h=(yield qd.resolve(u,t)).didDocument;return new Nu({uri:u,document:h,metadata:{},keyManager:e})})}static getSigningMethod(e){return Ic(this,arguments,void 0,function*({didDocument:t}){var n;const i=Sr.parse(t.id);if(i&&i.method!==this.methodName)throw new yt(ot.MethodNotSupported,`Method not supported: ${i.method}`);const[o]=t.assertionMethod||[],s=(n=t.verificationMethod)===null||n===void 0?void 0:n.find(a=>a.id===o);if(!(s&&s.publicKeyJwk))throw new yt(ot.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static import(e){return Ic(this,arguments,void 0,function*({portableDid:t,keyManager:n=new ju}){const i=Sr.parse(t.uri);if(i?.method!==qd.methodName)throw new yt(ot.MethodNotSupported,"Method not supported");const o=yield Nu.import({portableDid:t,keyManager:n});if(o.document.verificationMethod.length!==1)throw new yt(ot.InvalidDidDocument,"DID document must contain exactly one verification method");return o})}static resolve(e,t){return Ic(this,void 0,void 0,function*(){try{const n=yield qd.createDocument({didUri:e,options:t});return Object.assign(Object.assign({},mo),{didDocument:n})}catch(n){if(!(n instanceof yt))throw new Error(n);return Object.assign(Object.assign({},mo),{didResolutionMetadata:Object.assign({error:n.code},n.message&&{errorMessage:n.message})})}})}static createDocument(e){return Ic(this,arguments,void 0,function*({didUri:t,options:n={}}){const{defaultContext:i="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:o=!1,enableExperimentalPublicKeyTypes:s=!1,publicKeyFormat:a="JsonWebKey2020"}=n,l={id:""},d=Sr.parse(t);if(!d)throw new yt(ot.InvalidDid,`Invalid DID URI: ${t}`);const c=d.id;if(d.method!==qd.methodName)throw new yt(ot.MethodNotSupported,`Method not supported: ${d.method}`);if(!qd.validateIdentifier(d))throw new yt(ot.InvalidDid,`Invalid DID URI: ${t}`);const u=yield qd.createSignatureMethod({didUri:t,multibaseValue:c,options:{enableExperimentalPublicKeyTypes:s,publicKeyFormat:a}});if(l.id=d.uri,l.verificationMethod=[u],l.authentication=[u.id],l.assertionMethod=[u.id],l.capabilityInvocation=[u.id],l.capabilityDelegation=[u.id],o===!0){const p=a==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",y=yield this.createEncryptionMethod({didUri:t,multibaseValue:c,options:{enableExperimentalPublicKeyTypes:s,publicKeyFormat:p}});l.verificationMethod.push(y),l.keyAgreement=[y.id]}const f=[i];return txe({didDocument:l}).forEach(p=>{const y=bk[p];f.push(y)}),l["@context"]=f,l})}static createEncryptionMethod(e){return Ic(this,arguments,void 0,function*({didUri:t,multibaseValue:n,options:i}){const{enableExperimentalPublicKeyTypes:o,publicKeyFormat:s}=i,a={id:"",type:"",controller:""},{keyBytes:l,multicodecCode:d}=yield qd.deriveEncryptionKey({multibaseValue:n}),c=l.byteLength,u=Fa.MULTICODEC_PUBLIC_KEY_LENGTH[d];if(c!==u)throw new yt(ot.InvalidPublicKeyLength,`Expected ${c} bytes. Actual: ${u}`);const f=wW({keyBytes:l,multicodecCode:d});a.id=`${t}#${f}`;try{new URL(a.id)}catch{throw new yt(ot.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(s in bk))throw new yt(ot.UnsupportedPublicKeyType,`Unsupported format: ${s}`);if(o===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(s))throw new yt(ot.InvalidPublicKeyType,`Specified '${s}' without setting enableExperimentalPublicKeyTypes to true.`);if(a.type=s,a.controller=t,s==="X25519KeyAgreementKey2020"&&(a.publicKeyMultibase=f),s==="JsonWebKey2020"){const{crv:p}=yield Fa.multicodecToJwk({code:d});a.publicKeyJwk=yield Fa.keyConverter(p).bytesToPublicKey({publicKeyBytes:l})}return a})}static createSignatureMethod(e){return Ic(this,arguments,void 0,function*({didUri:t,multibaseValue:n,options:i}){const{enableExperimentalPublicKeyTypes:o,publicKeyFormat:s}=i,a={id:"",type:"",controller:""},{keyBytes:l,multicodecCode:d,multicodecName:c}=N4({multibaseKeyId:n}),u=l.byteLength,f=Fa.MULTICODEC_PUBLIC_KEY_LENGTH[d];if(u!==f)throw new yt(ot.InvalidPublicKeyLength,`Expected ${u} bytes. Actual: ${f}`);let h=!1;switch(c){case"secp256k1-pub":h=yield ma.validatePublicKey({publicKeyBytes:l});break;case"ed25519-pub":h=yield Is.validatePublicKey({publicKeyBytes:l});break;case"x25519-pub":h=!0;break}if(!h)throw new yt(ot.InvalidPublicKey,"Invalid public key detected.");a.id=`${t}#${n}`;try{new URL(a.id)}catch{throw new yt(ot.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(s in bk))throw new yt(ot.UnsupportedPublicKeyType,`Unsupported format: ${s}`);if(o===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(s))throw new yt(ot.InvalidPublicKeyType,`Specified '${s}' without setting enableExperimentalPublicKeyTypes to true.`);if(a.type=s,a.controller=t,s==="Ed25519VerificationKey2020"&&(a.publicKeyMultibase=n),s==="JsonWebKey2020"){const{crv:y}=yield Fa.multicodecToJwk({code:d});a.publicKeyJwk=yield Fa.keyConverter(y).bytesToPublicKey({publicKeyBytes:l})}return a})}static deriveEncryptionKey(e){return Ic(this,arguments,void 0,function*({multibaseValue:t}){let n={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:i,multicodecCode:o}=N4({multibaseKeyId:t});if(o===237){const s=yield Fa.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:i}),a=yield Is.convertPublicKeyToX25519({publicKey:s});n={keyBytes:yield Fa.keyConverter("Ed25519").publicKeyToBytes({publicKey:a}),multicodecCode:236}}return n})}static validateIdentifier(e){const{method:t,id:n}=e,[i]=e.uri.split(":",1);return i==="did"&&t==="key"&&Number("1")>0&&sv(n)==="String"&&n.startsWith("z")}};BW.methodName="key";let Fa=class Fm{static jwkToMulticodec(e){return Ic(this,arguments,void 0,function*({jwk:t}){const n=[];t.crv&&(n.push(t.crv),t.d?n.push("private"):n.push("public"));const i=n.join(":"),o=Fm.JWK_TO_MULTICODEC[i];if(o===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${i}'`);return{code:zr.getCodeFromName({name:o}),name:o}})}static keyCompressor(e){const n={"P-256":nc.compressPublicKey,secp256k1:ma.compressPublicKey}[e];if(!n)throw new yt(ot.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static keyConverter(e){const n={Ed25519:Is,"P-256":nc,secp256k1:ma,X25519:hW}[e];if(!n)throw new yt(ot.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static multicodecToJwk(e){return Ic(this,arguments,void 0,function*({code:t,name:n}){if(!(n?!t:t))throw new Error("Either 'name' or 'code' must be defined, but not both.");n=n===void 0?zr.getNameFromCode({code:t}):n;const i=n,o=Fm.MULTICODEC_TO_JWK[i];if(o===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},o)})}static publicKeyToMultibaseId(e){return Ic(this,arguments,void 0,function*({publicKey:t}){var n;if(!(t?.crv&&t.crv in zxe))throw new yt(ot.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(n=t?.crv)!==null&&n!==void 0?n:"undefined"}`);let i=yield Fm.keyConverter(t.crv).publicKeyToBytes({publicKey:t});/^(secp256k1|P-256|P-384|P-521)$/.test(t.crv)&&(i=yield Fm.keyCompressor(t.crv)({publicKeyBytes:i}));const{name:o}=yield Fm.jwkToMulticodec({jwk:t});return wW({keyBytes:i,multicodecName:o})})}};Fa.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};Fa.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};Fa.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var Fxe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let qxe=class jW extends s1{static resolve(e,t){return Fxe(this,void 0,void 0,function*(){const n=Sr.parse(e);if(!n)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"invalidDid"}});if(n.method!==jW.methodName)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"methodNotSupported"}});let i=`https://${n.id.replace(/:/g,"/")}`;i=decodeURIComponent(i);const o=n.id.includes(":")?`${i}/did.json`:`${i}/.well-known/did.json`;try{const s=yield fetch(o);if(!s.ok)throw new Error("HTTP error status code returned");const a=yield s.json();return Object.assign(Object.assign({},mo),{didDocument:a})}catch{return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:"notFound"}})}})}};qxe.methodName="web";var lv=1e3,dv=lv*60,uv=dv*60,Vy=uv*24,Vxe=Vy*7,Wxe=Vy*365.25,Hxe=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Gxe(r);if(t==="number"&&isFinite(r))return e.long?Zxe(r):Yxe(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Gxe(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Wxe;case"weeks":case"week":case"w":return t*Vxe;case"days":case"day":case"d":return t*Vy;case"hours":case"hour":case"hrs":case"hr":case"h":return t*uv;case"minutes":case"minute":case"mins":case"min":case"m":return t*dv;case"seconds":case"second":case"secs":case"sec":case"s":return t*lv;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Yxe(r){var e=Math.abs(r);return e>=Vy?Math.round(r/Vy)+"d":e>=uv?Math.round(r/uv)+"h":e>=dv?Math.round(r/dv)+"m":e>=lv?Math.round(r/lv)+"s":r+"ms"}function Zxe(r){var e=Math.abs(r);return e>=Vy?_2(r,e,Vy,"day"):e>=uv?_2(r,e,uv,"hour"):e>=dv?_2(r,e,dv,"minute"):e>=lv?_2(r,e,lv,"second"):r+" ms"}function _2(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}const by=Vu(Hxe);var Jxe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let Xxe=class{constructor({db:e,location:t="DATA/DID_RESOLVERCACHE",ttl:n="15m"}={}){this.cache=e??new rV(t),this.ttl=by(n)}get(e){return Jxe(this,void 0,void 0,function*(){try{const t=yield this.cache.get(e),n=JSON.parse(t);if(Date.now()>=n.ttlMillis){this.cache.nextTick(()=>this.cache.del(e));return}else return n.value}catch(t){if(t.notFound)return;throw t}})}set(e,t){const n={ttlMillis:Date.now()+this.ttl,value:t},i=JSON.stringify(n);return this.cache.put(e,i)}delete(e){return this.cache.del(e)}clear(){return this.cache.clear()}close(){return this.cache.close()}};const Qxe={get:function(r){return null},set:function(r,e){return null},delete:function(r){return null},clear:function(){return null},close:function(){return null}};var rN=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let eSe=class{constructor({cache:e,didResolvers:t}){this.didResolvers=new Map,this.cache=e||Qxe;for(const n of t)this.didResolvers.set(n.methodName,n)}resolve(e,t){return rN(this,void 0,void 0,function*(){const n=Sr.parse(e);if(!n)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:ot.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const i=this.didResolvers.get(n.method);if(!i)return Object.assign(Object.assign({},mo),{didResolutionMetadata:{error:ot.MethodNotSupported,errorMessage:`Method not supported: ${n.method}`}});const o=yield this.cache.get(n.uri);if(o)return o;{const s=yield i.resolve(n.uri,t);return s.didResolutionMetadata.error||(yield this.cache.set(n.uri,s)),s}})}dereference(e,t){return rN(this,void 0,void 0,function*(){const n=Sr.parse(e);if(!n)return{dereferencingMetadata:{error:ot.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:i,didResolutionMetadata:o,didDocumentMetadata:s}=yield this.resolve(n.uri);if(!i)return{dereferencingMetadata:{error:o.error},contentStream:null,contentMetadata:{}};if(!n.fragment||n.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:i,contentMetadata:s};const{service:a=[],verificationMethod:l=[]}=i,d=new Set([e,n.fragment,`#${n.fragment}`]);let c;for(let u of l)if(d.has(u.id)){c=u;break}for(let u of a)if(d.has(u.id)){c=u;break}return c?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:c,contentMetadata:o}:{dereferencingMetadata:{error:ot.NotFound},contentStream:null,contentMetadata:{}}})}};var Cm=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class WD{constructor(e){this.didResolver=e.didResolver,this.tenantGate=e.tenantGate,this.eventStream=e.eventStream,this.messageStore=e.messageStore,this.dataStore=e.dataStore,this.resumableTaskStore=e.resumableTaskStore,this.eventLog=e.eventLog,this.eventStream=e.eventStream,this.storageController=new Xf({messageStore:this.messageStore,dataStore:this.dataStore,eventLog:this.eventLog,eventStream:this.eventStream}),this.resumableTaskManager=new Yp(e.resumableTaskStore,this.storageController),this.methodHandlers={[Ge.Messages+Le.Query]:new eR(this.didResolver,this.messageStore,this.eventLog),[Ge.Messages+Le.Read]:new tR(this.didResolver,this.messageStore,this.dataStore),[Ge.Messages+Le.Subscribe]:new rR(this.didResolver,this.messageStore,this.eventStream),[Ge.Protocols+Le.Configure]:new KA(this.didResolver,this.messageStore,this.eventLog,this.eventStream),[Ge.Protocols+Le.Query]:new sbe(this.didResolver,this.messageStore,this.dataStore),[Ge.Records+Le.Delete]:new XR(this.didResolver,this.messageStore,this.resumableTaskManager),[Ge.Records+Le.Query]:new qf(this.didResolver,this.messageStore,this.dataStore),[Ge.Records+Le.Read]:new QR(this.didResolver,this.messageStore,this.dataStore),[Ge.Records+Le.Subscribe]:new Al(this.didResolver,this.messageStore,this.eventStream),[Ge.Records+Le.Write]:new jp(this.didResolver,this.messageStore,this.dataStore,this.eventLog,this.eventStream)}}static create(e){var t,n;return Cm(this,void 0,void 0,function*(){(t=e.didResolver)!==null&&t!==void 0||(e.didResolver=new eSe({didResolvers:[cv,eT,BW],cache:new Xxe({location:"RESOLVERCACHE"})})),(n=e.tenantGate)!==null&&n!==void 0||(e.tenantGate=new fpe);const i=new WD(e);return yield i.open(),i})}open(){var e;return Cm(this,void 0,void 0,function*(){yield this.messageStore.open(),yield this.dataStore.open(),yield this.resumableTaskStore.open(),yield this.eventLog.open(),yield(e=this.eventStream)===null||e===void 0?void 0:e.open(),yield this.resumableTaskManager.resumeTasksAndWaitForCompletion()})}close(){var e;return Cm(this,void 0,void 0,function*(){yield(e=this.eventStream)===null||e===void 0?void 0:e.close(),yield this.messageStore.close(),yield this.dataStore.close(),yield this.resumableTaskStore.close(),yield this.eventLog.close()})}processMessage(e,t,n={}){var i;return Cm(this,void 0,void 0,function*(){const o=(i=yield this.validateTenant(e))!==null&&i!==void 0?i:yield this.validateMessageIntegrity(t);if(o!==void 0)return o;const{dataStream:s,subscriptionHandler:a}=n,l=t.descriptor.interface+t.descriptor.method;return yield this.methodHandlers[l].handle({tenant:e,message:t,dataStream:s,subscriptionHandler:a})})}validateTenant(e){var t;return Cm(this,void 0,void 0,function*(){const n=yield this.tenantGate.isActiveTenant(e);if(!n.isActiveTenant)return{status:{code:401,detail:(t=n.detail)!==null&&t!==void 0?t:`DID ${e} is not an active tenant.`}}})}validateMessageIntegrity(e){var t,n;return Cm(this,void 0,void 0,function*(){const i=(t=e?.descriptor)===null||t===void 0?void 0:t.interface,o=(n=e?.descriptor)===null||n===void 0?void 0:n.method;if(i===void 0||o===void 0)return{status:{code:400,detail:`Both interface and method must be present, interface: ${i}, method: ${o}`}};try{Oe.validateJsonSchema(e)}catch(s){return Dr(s,400)}})}}var tSe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function rSe(r){return new Promise((e,t)=>{if(r.aborted){t(r.reason);return}r.addEventListener("abort",()=>{t(r.reason)})})}function eo(r,e){return tSe(this,void 0,void 0,function*(){return e?Promise.race([r,rSe(e)]):r})}var Js=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Oc=function(r){return this instanceof Oc?(this.v=r,this):new Oc(r)},wk=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}},nN=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){n[f]&&(i[f]=function(h){return new Promise(function(p,y){o.push([f,h,p,y])>1||a(f,h)})})}function a(f,h){try{l(n[f](h))}catch(p){u(o[0][3],p)}}function l(f){f.value instanceof Oc?Promise.resolve(f.value.v).then(d,c):u(o[0][2],f)}function d(f){a("next",f)}function c(f){a("throw",f)}function u(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}};function cm(r,e){return Js(this,void 0,void 0,function*(){return new UD(r,Object.assign(Object.assign({},e),{keyEncoding:"utf8"}))})}class fv{constructor(e,t){this.config=Object.assign({createLevelDatabase:cm},e),this.db=t}open(){return Js(this,void 0,void 0,function*(){switch(yield this.createLevelDatabase(),this.db.status){case"open":return;case"opening":return new Promise(e=>{this.db.once("open",e)});case"closing":return new Promise((e,t)=>{const n=()=>{this.db.open().then(e).catch(t)};this.db.once("closed",n)});case"closed":return this.db.open()}})}close(){return Js(this,void 0,void 0,function*(){if(this.db)switch(this.db.status){case"open":return this.db.close();case"opening":return new Promise((e,t)=>{const n=()=>{this.db.close().then(e).catch(t)};this.db.once("open",n)});case"closing":return new Promise(e=>{this.db.once("closed",e)});case"closed":return}})}partition(e){return Js(this,void 0,void 0,function*(){return yield this.createLevelDatabase(),new fv(this.config,this.db.sublevel(e,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding}))})}get(e,t){var n;return Js(this,void 0,void 0,function*(){(n=t?.signal)===null||n===void 0||n.throwIfAborted(),yield eo(this.createLevelDatabase(),t?.signal);try{return yield eo(this.db.get(String(e)),t?.signal)}catch(i){if(i.code==="LEVEL_NOT_FOUND")return;throw i}})}has(e,t){return Js(this,void 0,void 0,function*(){return!!(yield this.get(e,t))})}keys(e){var t,n;return nN(this,arguments,function*(){var o,s,a,l;(t=e?.signal)===null||t===void 0||t.throwIfAborted(),yield Oc(eo(this.createLevelDatabase(),e?.signal));try{for(var d=!0,c=wk(this.db.keys()),u;u=yield Oc(c.next()),o=u.done,!o;d=!0){l=u.value,d=!1;const f=l;(n=e?.signal)===null||n===void 0||n.throwIfAborted(),yield yield Oc(f)}}catch(f){s={error:f}}finally{try{!d&&!o&&(a=c.return)&&(yield Oc(a.call(c)))}finally{if(s)throw s.error}}})}iterator(e,t){var n,i;return nN(this,arguments,function*(){var s,a,l,d;(n=t?.signal)===null||n===void 0||n.throwIfAborted(),yield Oc(eo(this.createLevelDatabase(),t?.signal));try{for(var c=!0,u=wk(this.db.iterator(e)),f;f=yield Oc(u.next()),s=f.done,!s;c=!0){d=f.value,c=!1;const h=d;(i=t?.signal)===null||i===void 0||i.throwIfAborted(),yield yield Oc(h)}}catch(h){a={error:h}}finally{try{!c&&!s&&(l=u.return)&&(yield Oc(l.call(u)))}finally{if(a)throw a.error}}})}put(e,t,n){var i;return Js(this,void 0,void 0,function*(){return(i=n?.signal)===null||i===void 0||i.throwIfAborted(),yield eo(this.createLevelDatabase(),n?.signal),eo(this.db.put(String(e),t),n?.signal)})}delete(e,t){var n;return Js(this,void 0,void 0,function*(){return(n=t?.signal)===null||n===void 0||n.throwIfAborted(),yield eo(this.createLevelDatabase(),t?.signal),eo(this.db.del(String(e)),t?.signal)})}isEmpty(e){var t,n,i,o;return Js(this,void 0,void 0,function*(){try{for(var s=!0,a=wk(this.keys(e)),l;l=yield a.next(),t=l.done,!t;s=!0){o=l.value,s=!1;const d=o;return!1}}catch(d){n={error:d}}finally{try{!s&&!t&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return!0})}clear(){return Js(this,void 0,void 0,function*(){yield this.createLevelDatabase(),yield this.db.clear(),yield this.compactUnderlyingStorage()})}batch(e,t){var n;return Js(this,void 0,void 0,function*(){return(n=t?.signal)===null||n===void 0||n.throwIfAborted(),yield eo(this.createLevelDatabase(),t?.signal),eo(this.db.batch(e),t?.signal)})}createPartitionOperation(e,t){return Object.assign(Object.assign({},t),{sublevel:this.db.sublevel(e,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding})})}compactUnderlyingStorage(e){var t,n,i;return Js(this,void 0,void 0,function*(){(t=e?.signal)===null||t===void 0||t.throwIfAborted(),yield eo(this.createLevelDatabase(),e?.signal);const o=this.sublevelRange;if(!o)return;const s=this.root;if(s.db.supports.additionalMethods.compactRange)return eo((i=(n=s.db).compactRange)===null||i===void 0?void 0:i.call(n,...o),e?.signal)})}get sublevelRange(){const e=this.db.prefix;if(!e)return;const t=e.slice(0,-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);return[e,t]}get root(){let e=this.db;for(const t=e.db;t&&t!==e;)e=t;return new fv(this.config,e)}createLevelDatabase(){var e;return Js(this,void 0,void 0,function*(){(e=this.db)!==null&&e!==void 0||(this.db=yield this.config.createLevelDatabase(this.config.location,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding}))})}}var Md=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},E2=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}},bi=function(r){return this instanceof bi?(this.v=r,this):new bi(r)},A2=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){n[f]&&(i[f]=function(h){return new Promise(function(p,y){o.push([f,h,p,y])>1||a(f,h)})})}function a(f,h){try{l(n[f](h))}catch(p){u(o[0][3],p)}}function l(f){f.value instanceof bi?Promise.resolve(f.value.v).then(d,c):u(o[0][2],f)}function d(f){a("next",f)}function c(f){a("throw",f)}function u(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}};class tT{constructor(e,t){this.config=Object.assign({createLevelDatabase:cm},e),this.db=t??new fv(Object.assign(Object.assign({},this.config),{valueEncoding:"binary"}))}open(){return Md(this,void 0,void 0,function*(){return this.db.open()})}close(){return Md(this,void 0,void 0,function*(){return this.db.close()})}partition(e){return Md(this,void 0,void 0,function*(){const t=yield this.db.partition(e);return new tT(Object.assign(Object.assign({},this.config),{location:""}),t)})}put(e,t,n){return Md(this,void 0,void 0,function*(){return yield this.db.put(String(e),t,n),er.parse(e.toString())})}get(e,t){return Md(this,void 0,void 0,function*(){return yield this.db.get(String(e),t)})}has(e,t){return Md(this,void 0,void 0,function*(){return this.db.has(String(e),t)})}delete(e,t){return Md(this,void 0,void 0,function*(){return this.db.delete(String(e),t)})}isEmpty(e){return Md(this,void 0,void 0,function*(){return this.db.isEmpty(e)})}putMany(e,t){return A2(this,arguments,function*(){var i,o,s,a;try{for(var l=!0,d=E2(e),c;c=yield bi(d.next()),i=c.done,!i;l=!0){a=c.value,l=!1;const u=a;yield bi(this.put(u.cid,u.block,t)),yield yield bi(u.cid)}}catch(u){o={error:u}}finally{try{!l&&!i&&(s=d.return)&&(yield bi(s.call(d)))}finally{if(o)throw o.error}}})}getMany(e,t){return A2(this,arguments,function*(){var i,o,s,a;try{for(var l=!0,d=E2(e),c;c=yield bi(d.next()),i=c.done,!i;l=!0){a=c.value,l=!1;const u=a;yield yield bi({cid:u,block:yield bi(this.get(u,t))})}}catch(u){o={error:u}}finally{try{!l&&!i&&(s=d.return)&&(yield bi(s.call(d)))}finally{if(o)throw o.error}}})}getAll(e){return A2(this,arguments,function*(){var n,i,o,s;const a=this.db.iterator({keys:!0,keyEncoding:"buffer"},e);try{for(var l=!0,d=E2(a),c;c=yield bi(d.next()),n=c.done,!n;l=!0){s=c.value,l=!1;const[u,f]=s;yield yield bi({cid:er.decode(u),block:f})}}catch(u){i={error:u}}finally{try{!l&&!n&&(o=d.return)&&(yield bi(o.call(d)))}finally{if(i)throw i.error}}})}deleteMany(e,t){return A2(this,arguments,function*(){var i,o,s,a;try{for(var l=!0,d=E2(e),c;c=yield bi(d.next()),i=c.done,!i;l=!0){a=c.value,l=!1;const u=a;yield bi(this.delete(u,t)),yield yield bi(u)}}catch(u){o={error:u}}finally{try{!l&&!i&&(s=d.return)&&(yield bi(s.call(d)))}finally{if(o)throw o.error}}})}clear(){return Md(this,void 0,void 0,function*(){return this.db.clear()})}}function nSe(r){return r[Symbol.asyncIterator]!=null}function iSe(r){if(nSe(r))return(async()=>{let t;for await(const n of r)t=n;return t})();let e;for(const t of r)e=t;return e}const NW=0,oSe="identity",UW=xv,sSe=r=>ZE(NW,UW(r)),aSe={code:NW,name:oSe,encode:UW,digest:sSe},cSe=async(r,e,t,n,i,o,s,a)=>{const l=await s.get(r,a),d=oz(l);let c=d,u=t;for(;n.length>0;){const f=n[0];if(f in c){n.shift(),u=`${u}/${f}`;const h=er.asCID(c[f]);if(h!=null)return{entry:{type:"object",name:e,path:t,cid:r,node:l,depth:o,size:BigInt(l.length),content:async function*(){yield d}},next:{cid:h,name:f,path:u,toResolve:n}};c=c[f]}else throw Zr(new Error(`No property named ${f} found in cbor node ${r}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:t,cid:r,node:l,depth:o,size:BigInt(l.length),content:async function*(){yield d}}}};function QA(r,e,t,n){const i=BigInt(r.length),o=BigInt(e+i);return t>=o||n<e?new Uint8Array(0):(n>=e&&n<o&&(r=r.subarray(0,Number(n-e))),t>=e&&t<o&&(r=r.subarray(Number(t-e))),r)}const HD=(r,e=0,t=r)=>{const n=BigInt(r),i=BigInt(e??0);let o=BigInt(t);if(o!==n&&(o=i+o),o>n&&(o=n),i<0n)throw Zr(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>n)throw Zr(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(o<0n)throw Zr(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>n)throw Zr(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:i,end:o}},lSe=r=>{async function*e(t={}){const{start:n,end:i}=HD(r.length,t.offset,t.length),o=QA(r,0n,n,i);t.onProgress?.(new dc("unixfs:exporter:progress:identity",{bytesRead:BigInt(o.byteLength),totalBytes:i-n,fileSize:BigInt(r.byteLength)})),yield o}return e},dSe=async(r,e,t,n,i,o,s,a)=>{if(n.length>0)throw Zr(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");const l=vK(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:lSe(l.digest),depth:o,size:BigInt(l.digest.length),node:l.digest}}},uSe=r=>{async function*e(t={}){const{start:n,end:i}=HD(r.length,t.offset,t.length),o=QA(r,0n,n,i);t.onProgress?.(new dc("unixfs:exporter:progress:raw",{bytesRead:BigInt(o.byteLength),totalBytes:i-n,fileSize:BigInt(r.byteLength)})),yield o}return e},fSe=async(r,e,t,n,i,o,s,a)=>{if(n.length>0)throw Zr(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");const l=await s.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:uSe(l),depth:o,size:BigInt(l.length),node:l}}},hSe=async function(r){return(await xz.encode(r)).slice(0,8).reverse()},pSe=async(r,e,t)=>{await Promise.all(r.map(async n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){const i=parseInt(n.Name,16);e._putObjectAt(i,new la({hash:t._options.hash,bits:t._options.bits},e,i));return}await t.put(n.Name.substring(2),!0)}))},iN=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),ySe=r=>{let e=r.bucket;const t=[];for(;e._parent!=null;)t.push(e),e=e._parent;return t.push(e),t.reverse()},LW=async(r,e,t,n,i)=>{if(n==null){const c=$z({hashFn:hSe});n={rootBucket:c,hamtDepth:1,lastBucket:c}}await pSe(r.Links,n.lastBucket,n.rootBucket);const o=await n.rootBucket._findNewBucketAndPos(e);let s=iN(o.pos);const a=ySe(o);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],s=iN(n.lastBucket._posAtParent));const l=r.Links.find(c=>{if(c.Name==null)return!1;const u=c.Name.substring(0,2),f=c.Name.substring(2);return!(u!==s||f!==""&&f!==e)});if(l==null)return;if(l.Name!=null&&l.Name.substring(2)===e)return l.Hash;n.hamtDepth++;const d=await t.get(l.Hash,i);return r=A_(d),LW(r,e,t,n,i)};function KW(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function mSe(r){return r[Symbol.asyncIterator]!=null}function gSe(r,e){let t=0;if(mSe(r))return async function*(){for await(const l of r)await e(l,t++)&&(yield l)}();const n=KW(r),{value:i,done:o}=n.next();if(o===!0)return function*(){}();const s=e(i,t++);if(typeof s.then=="function")return async function*(){await s&&(yield i);for await(const l of n)await e(l,t++)&&(yield l)}();const a=e;return function*(){s===!0&&(yield i);for(const l of n)a(l,t++)&&(yield l)}()}function vSe(r){return r[Symbol.asyncIterator]!=null}function GD(r,e){let t=0;if(vSe(r))return async function*(){for await(const l of r)yield e(l,t++)}();const n=KW(r),{value:i,done:o}=n.next();if(o===!0)return function*(){}();const s=e(i,t++);if(typeof s.then=="function")return async function*(){yield await s;for await(const l of n)yield e(l,t++)}();const a=e;return function*(){yield s;for(const l of n)yield a(l,t++)}()}function eg(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}const x2=globalThis.CustomEvent??Event;async function*YD(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered==null?!1:e.ordered,i=new EventTarget,o=[];let s=eg(),a=eg(),l=!1,d,c=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const p of r){if(o.length===t&&(s=eg(),await s.promise),c)break;const y={done:!1};o.push(y),p().then(g=>{y.done=!0,y.ok=!0,y.value=g,i.dispatchEvent(new x2("task-complete"))},g=>{y.done=!0,y.err=g,i.dispatchEvent(new x2("task-complete"))})}l=!0,i.dispatchEvent(new x2("task-complete"))}catch(p){d=p,i.dispatchEvent(new x2("task-complete"))}});function u(){return n?o[0]?.done:!!o.find(p=>p.done)}function*f(){for(;o.length>0&&o[0].done;){const p=o[0];if(o.shift(),p.ok)yield p.value;else throw c=!0,s.resolve(),p.err;s.resolve()}}function*h(){for(;u();)for(let p=0;p<o.length;p++)if(o[p].done){const y=o[p];if(o.splice(p,1),p--,y.ok)yield y.value;else throw c=!0,s.resolve(),y.err;s.resolve()}}for(;;){if(u()||(a=eg(),await a.promise),d!=null)throw d;if(n?yield*f():yield*h(),l&&o.length===0)break}}class oN{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class _k{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new oN(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new oN(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let bSe=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function ZD(r={}){return wSe(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function wSe(r,e){e=e??{};let t=e.onEnd,n=new _k,i,o,s,a=eg();const l=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((g,w)=>{o=v=>{o=null,n.push(v);try{g(r(n))}catch(m){w(m)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=eg()})}},d=g=>o!=null?o(g):(n.push(g),i),c=g=>(n=new _k,o!=null?o({error:g}):(n.push({error:g}),i)),u=g=>{if(s)return i;if(e?.objectMode!==!0&&g?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return d({done:!1,value:g})},f=g=>s?i:(s=!0,g!=null?c(g):d({done:!0})),h=()=>(n=new _k,f(),{done:!0}),p=g=>(f(g),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:l,return:h,throw:p,push:u,end:f,get readableLength(){return n.size},onEmpty:async g=>{const w=g?.signal;if(w?.throwIfAborted(),n.isEmpty())return;let v,m;w!=null&&(v=new Promise((b,_)=>{m=()=>{_(new bSe)},w.addEventListener("abort",m)}));try{await Promise.race([a.promise,v])}finally{m!=null&&w!=null&&w?.removeEventListener("abort",m)}}},t==null)return i;const y=i;return i={[Symbol.asyncIterator](){return this},next(){return y.next()},throw(g){return y.throw(g),t!=null&&(t(g),t=void 0),{done:!0}},return(){return y.return(),t!=null&&(t(),t=void 0),{done:!0}},push:u,end(g){return y.end(g),t!=null&&(t(g),t=void 0),i},get readableLength(){return y.readableLength},onEmpty:g=>y.onEmpty(g)},i}function _Se(r){return r[Symbol.asyncIterator]!=null}function ESe(...r){const e=[];for(const t of r)_Se(t)||e.push(t);return e.length===r.length?function*(){for(const t of e)yield*t}():async function*(){const t=ZD({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async n=>{for await(const i of n)t.push(i)})),t.end()}catch(n){t.end(n)}}),yield*t}()}function JD(r,...e){if(r==null)throw new Error("Empty pipeline");if(Ek(r)){const n=r;r=()=>n.source}else if(FW(r)||zW(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&Ek(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)Ek(t[n])&&(t[n]=xSe(t[n]));return ASe(...t)}const ASe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},zW=r=>r?.[Symbol.asyncIterator]!=null,FW=r=>r?.[Symbol.iterator]!=null,Ek=r=>r==null?!1:r.sink!=null&&r.source!=null,xSe=r=>e=>{const t=r.sink(e);if(t?.then!=null){const n=ZD({objectMode:!0});t.then(()=>{n.end()},s=>{n.end(s)});let i;const o=r.source;if(zW(o))i=async function*(){yield*o,n.end()};else if(FW(o))i=function*(){yield*o,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return ESe(n,i())}return r.source},SSe=(r,e,t,n,i,o,s)=>{async function*a(l={}){const d=l.offset??0,c=l.length??e.Links.length,u=e.Links.slice(d,c);l.onProgress?.(new dc("unixfs:exporter:walk:directory",{cid:r})),yield*JD(u,f=>GD(f,h=>async()=>{const p=h.Name??"",y=`${n}/${p}`;return(await i(h.Hash,p,y,[],o+1,s,l)).entry}),f=>YD(f,{ordered:!0}),f=>gSe(f,h=>h!=null))}return a};var qW={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(l,d,c){this.fn=l,this.context=d,this.once=c||!1}function o(l,d,c,u,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,u||l,f),p=t?t+d:d;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function s(l,d){--l._eventsCount===0?l._events=new n:delete l._events[d]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var d=[],c,u;if(this._eventsCount===0)return d;for(u in c=this._events)e.call(c,u)&&d.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(c)):d},a.prototype.listeners=function(d){var c=t?t+d:d,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var f=0,h=u.length,p=new Array(h);f<h;f++)p[f]=u[f].fn;return p},a.prototype.listenerCount=function(d){var c=t?t+d:d,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(d,c,u,f,h,p){var y=t?t+d:d;if(!this._events[y])return!1;var g=this._events[y],w=arguments.length,v,m;if(g.fn){switch(g.once&&this.removeListener(d,g.fn,void 0,!0),w){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,f),!0;case 5:return g.fn.call(g.context,c,u,f,h),!0;case 6:return g.fn.call(g.context,c,u,f,h,p),!0}for(m=1,v=new Array(w-1);m<w;m++)v[m-1]=arguments[m];g.fn.apply(g.context,v)}else{var b=g.length,_;for(m=0;m<b;m++)switch(g[m].once&&this.removeListener(d,g[m].fn,void 0,!0),w){case 1:g[m].fn.call(g[m].context);break;case 2:g[m].fn.call(g[m].context,c);break;case 3:g[m].fn.call(g[m].context,c,u);break;case 4:g[m].fn.call(g[m].context,c,u,f);break;default:if(!v)for(_=1,v=new Array(w-1);_<w;_++)v[_-1]=arguments[_];g[m].fn.apply(g[m].context,v)}}return!0},a.prototype.on=function(d,c,u){return o(this,d,c,u,!1)},a.prototype.once=function(d,c,u){return o(this,d,c,u,!0)},a.prototype.removeListener=function(d,c,u,f){var h=t?t+d:d;if(!this._events[h])return this;if(!c)return s(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!u||p.context===u)&&s(this,h);else{for(var y=0,g=[],w=p.length;y<w;y++)(p[y].fn!==c||f&&!p[y].once||u&&p[y].context!==u)&&g.push(p[y]);g.length?this._events[h]=g.length===1?g[0]:g:s(this,h)}return this},a.prototype.removeAllListeners=function(d){var c;return d?(c=t?t+d:d,this._events[c]&&s(this,c)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(qW);var TSe=qW.exports;const $Se=Vu(TSe);class VW extends Error{constructor(e){super(e),this.name="TimeoutError"}}let kSe=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const sN=r=>globalThis.DOMException===void 0?new kSe(r):new DOMException(r),aN=r=>{const e=r.reason===void 0?sN("This operation was aborted."):r.reason;return e instanceof Error?e:sN(e)};function PSe(r,e,t,n){let i;const o=new Promise((s,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){s(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){const{signal:l}=n;l.aborted&&a(aN(l)),l.addEventListener("abort",()=>{a(aN(l))})}i=n.customTimers.setTimeout.call(void 0,()=>{const l=`Promise timed out after ${e} milliseconds`,d=t instanceof Error?t:new VW(l);typeof r.cancel=="function"&&r.cancel(),a(d)},e),(async()=>{try{s(await r)}catch(l){a(l)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return o.clear=()=>{clearTimeout(i),i=void 0},o}function ISe(r,e,t){let n=0,i=r.length;for(;i>0;){const o=Math.trunc(i/2);let s=n+o;t(r[s],e)<=0?(n=++s,i-=o+1):i=o}return n}var fp=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Vd;class OSe{constructor(){Vd.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&fp(this,Vd,"f")[this.size-1].priority>=t.priority){fp(this,Vd,"f").push(n);return}const i=ISe(fp(this,Vd,"f"),n,(o,s)=>s.priority-o.priority);fp(this,Vd,"f").splice(i,0,n)}dequeue(){const e=fp(this,Vd,"f").shift();return e?.run}filter(e){return fp(this,Vd,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return fp(this,Vd,"f").length}}Vd=new WeakMap;var wn=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Qe=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Un,iw,ow,eh,ex,sw,SE,Sc,kb,ta,TE,ca,aw,Hf,$E,cN,lN,WW,dN,uN,kE,Ak,xk,tx,HW,PE;class GW extends Error{}class CSe extends $Se{constructor(e){var t,n,i,o;if(super(),Un.add(this),iw.set(this,void 0),ow.set(this,void 0),eh.set(this,0),ex.set(this,void 0),sw.set(this,void 0),SE.set(this,0),Sc.set(this,void 0),kb.set(this,void 0),ta.set(this,void 0),TE.set(this,void 0),ca.set(this,0),aw.set(this,void 0),Hf.set(this,void 0),$E.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:OSe,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(o=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""}\` (${typeof e.interval})`);wn(this,iw,e.carryoverConcurrencyCount,"f"),wn(this,ow,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),wn(this,ex,e.intervalCap,"f"),wn(this,sw,e.interval,"f"),wn(this,ta,new e.queueClass,"f"),wn(this,TE,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,wn(this,$E,e.throwOnTimeout===!0,"f"),wn(this,Hf,e.autoStart===!1,"f")}get concurrency(){return Qe(this,aw,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);wn(this,aw,e,"f"),Qe(this,Un,"m",tx).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:Qe(this,$E,"f"),...t},new Promise((n,i)=>{Qe(this,ta,"f").enqueue(async()=>{var o,s,a;wn(this,ca,(s=Qe(this,ca,"f"),s++,s),"f"),wn(this,eh,(a=Qe(this,eh,"f"),a++,a),"f");try{if(!((o=t.signal)===null||o===void 0)&&o.aborted)throw new GW("The task was aborted.");let l=e({signal:t.signal});t.timeout&&(l=PSe(Promise.resolve(l),t.timeout)),t.signal&&(l=Promise.race([l,Qe(this,Un,"m",HW).call(this,t.signal)]));const d=await l;n(d),this.emit("completed",d)}catch(l){if(l instanceof VW&&!t.throwOnTimeout){n();return}i(l),this.emit("error",l)}finally{Qe(this,Un,"m",WW).call(this)}},t),this.emit("add"),Qe(this,Un,"m",kE).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return Qe(this,Hf,"f")?(wn(this,Hf,!1,"f"),Qe(this,Un,"m",tx).call(this),this):this}pause(){wn(this,Hf,!0,"f")}clear(){wn(this,ta,new(Qe(this,TE,"f")),"f")}async onEmpty(){Qe(this,ta,"f").size!==0&&await Qe(this,Un,"m",PE).call(this,"empty")}async onSizeLessThan(e){Qe(this,ta,"f").size<e||await Qe(this,Un,"m",PE).call(this,"next",()=>Qe(this,ta,"f").size<e)}async onIdle(){Qe(this,ca,"f")===0&&Qe(this,ta,"f").size===0||await Qe(this,Un,"m",PE).call(this,"idle")}get size(){return Qe(this,ta,"f").size}sizeBy(e){return Qe(this,ta,"f").filter(e).length}get pending(){return Qe(this,ca,"f")}get isPaused(){return Qe(this,Hf,"f")}}iw=new WeakMap,ow=new WeakMap,eh=new WeakMap,ex=new WeakMap,sw=new WeakMap,SE=new WeakMap,Sc=new WeakMap,kb=new WeakMap,ta=new WeakMap,TE=new WeakMap,ca=new WeakMap,aw=new WeakMap,Hf=new WeakMap,$E=new WeakMap,Un=new WeakSet,cN=function(){return Qe(this,ow,"f")||Qe(this,eh,"f")<Qe(this,ex,"f")},lN=function(){return Qe(this,ca,"f")<Qe(this,aw,"f")},WW=function(){var e;wn(this,ca,(e=Qe(this,ca,"f"),e--,e),"f"),Qe(this,Un,"m",kE).call(this),this.emit("next")},dN=function(){Qe(this,Un,"m",xk).call(this),Qe(this,Un,"m",Ak).call(this),wn(this,kb,void 0,"f")},uN=function(){const e=Date.now();if(Qe(this,Sc,"f")===void 0){const t=Qe(this,SE,"f")-e;if(t<0)wn(this,eh,Qe(this,iw,"f")?Qe(this,ca,"f"):0,"f");else return Qe(this,kb,"f")===void 0&&wn(this,kb,setTimeout(()=>{Qe(this,Un,"m",dN).call(this)},t),"f"),!0}return!1},kE=function(){if(Qe(this,ta,"f").size===0)return Qe(this,Sc,"f")&&clearInterval(Qe(this,Sc,"f")),wn(this,Sc,void 0,"f"),this.emit("empty"),Qe(this,ca,"f")===0&&this.emit("idle"),!1;if(!Qe(this,Hf,"f")){const e=!Qe(this,Un,"a",uN);if(Qe(this,Un,"a",cN)&&Qe(this,Un,"a",lN)){const t=Qe(this,ta,"f").dequeue();return t?(this.emit("active"),t(),e&&Qe(this,Un,"m",Ak).call(this),!0):!1}}return!1},Ak=function(){Qe(this,ow,"f")||Qe(this,Sc,"f")!==void 0||(wn(this,Sc,setInterval(()=>{Qe(this,Un,"m",xk).call(this)},Qe(this,sw,"f")),"f"),wn(this,SE,Date.now()+Qe(this,sw,"f"),"f"))},xk=function(){Qe(this,eh,"f")===0&&Qe(this,ca,"f")===0&&Qe(this,Sc,"f")&&(clearInterval(Qe(this,Sc,"f")),wn(this,Sc,void 0,"f")),wn(this,eh,Qe(this,iw,"f")?Qe(this,ca,"f"):0,"f"),Qe(this,Un,"m",tx).call(this)},tx=function(){for(;Qe(this,Un,"m",kE).call(this););},HW=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new GW("The task was aborted."))},{once:!0})})},PE=async function(e,t){return new Promise(n=>{const i=()=>{t&&!t()||(this.off(e,i),n())};this.on(e,i)})};async function YW(r,e,t,n,i,o,s){if(e instanceof Uint8Array){const d=QA(e,n,i,o);t.push(d);return}if(e.Data==null)throw Zr(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=Hc.unmarshal(e.Data)}catch(d){throw Zr(d,"ERR_NOT_UNIXFS")}if(a.data!=null){const d=a.data,c=QA(d,n,i,o);t.push(c),n+=BigInt(c.byteLength)}const l=[];if(e.Links.length!==a.blockSizes.length)throw Zr(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let d=0;d<e.Links.length;d++){const c=e.Links[d],u=n,f=u+a.blockSizes[d];if((i>=u&&i<f||o>=u&&o<=f||i<u&&o>f)&&l.push({link:c,blockStart:n}),n=f,n>o)break}await JD(l,d=>GD(d,c=>async()=>{const u=await r.get(c.link.Hash,s);return{...c,block:u}}),d=>YD(d,{ordered:!0}),async d=>{for await(const{link:c,block:u,blockStart:f}of d){let h;switch(c.Hash.code){case FO:h=A_(u);break;case xw:h=u;break;default:t.end(Zr(new Error(`Unsupported codec: ${c.Hash.code}`),"ERR_NOT_UNIXFS"));return}const p=new CSe({concurrency:1});p.on("error",y=>{t.end(y)}),p.add(async()=>{s.onProgress?.(new dc("unixfs:exporter:walk:file",{cid:c.Hash})),await YW(r,h,t,f,i,o,s)}),await p.onIdle()}}),n>=o&&t.end()}const fN=(r,e,t,n,i,o,s)=>{async function*a(l={}){const d=t.fileSize();if(d===void 0)throw new Error("File was a directory");const{start:c,end:u}=HD(d,l.offset,l.length);if(u===0n)return;let f=0n;const h=u-c,p=ZD();l.onProgress?.(new dc("unixfs:exporter:walk:file",{cid:r})),YW(s,e,p,0n,c,u,l).catch(y=>{p.end(y)});for await(const y of p)if(y!=null){if(f+=BigInt(y.byteLength),f>h)throw p.end(),Zr(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");f===h&&p.end(),l.onProgress?.(new dc("unixfs:exporter:progress:unixfs:file",{bytesRead:f,totalBytes:h,fileSize:d})),yield y}if(f<h)throw Zr(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}return a},RSe=(r,e,t,n,i,o,s)=>{function a(l={}){return l.onProgress?.(new dc("unixfs:exporter:walk:hamt-sharded-directory",{cid:r})),ZW(e,n,i,o,s,l)}return a};async function*ZW(r,e,t,n,i,o){const s=r.Links,a=JD(s,l=>GD(l,d=>async()=>{const c=d.Name!=null?d.Name.substring(2):null;if(c!=null&&c!==""){const u=await t(d.Hash,c,`${e}/${c}`,[],n+1,i,o);return{entries:u.entry==null?[]:[u.entry]}}else{const u=await i.get(d.Hash,o);return r=A_(u),o.onProgress?.(new dc("unixfs:exporter:walk:hamt-sharded-directory",{cid:d.Hash})),{entries:ZW(r,e,t,n,i,o)}}}),l=>YD(l,{ordered:!0}));for await(const{entries:l}of a)yield*l}const DSe=(r,e)=>r.Links.find(n=>n.Name===e)?.Hash,MSe={raw:fN,file:fN,directory:SSe,"hamt-sharded-directory":RSe,metadata:(r,e,t,n,i,o,s)=>()=>[],symlink:(r,e,t,n,i,o,s)=>()=>[]},BSe=async(r,e,t,n,i,o,s,a)=>{const l=await s.get(r,a),d=A_(l);let c,u;if(e==null&&(e=r.toString()),d.Data==null)throw Zr(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{c=Hc.unmarshal(d.Data)}catch(h){throw Zr(h,"ERR_NOT_UNIXFS")}if(t==null&&(t=e),n.length>0){let h;if(c?.type==="hamt-sharded-directory"?h=await LW(d,n[0],s):h=DSe(d,n[0]),h==null)throw Zr(new Error("file does not exist"),"ERR_NOT_FOUND");const p=n.shift(),y=`${t}/${p}`;u={cid:h,toResolve:n,name:p??"",path:y}}const f=MSe[c.type](r,d,c,t,i,o,s);if(f==null)throw Zr(new Error("could not find content exporter"),"ERR_NOT_FOUND");return c.isDirectory()?{entry:{type:"directory",name:e,path:t,cid:r,content:f,unixfs:c,depth:o,node:d,size:c.fileSize()},next:u}:{entry:{type:"file",name:e,path:t,cid:r,content:f,unixfs:c,depth:o,node:d,size:c.fileSize()},next:u}},jSe={[FO]:BSe,[xw]:fSe,[Nx]:cSe,[aSe.code]:dSe},JW=async(r,e,t,n,i,o,s)=>{const a=jSe[r.code];if(a==null)throw Zr(new Error(`No resolver for code ${r.code}`),"ERR_NO_RESOLVER");return a(r,e,t,n,JW,i,o,s)},NSe=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),USe=r=>{if(r instanceof Uint8Array)return{cid:er.decode(r),toResolve:[]};const e=er.asCID(r);if(e!=null)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));const t=NSe(r);return{cid:er.parse(t[0]),toResolve:t.slice(1)}}throw Zr(new Error(`Unknown path type ${r}`),"ERR_BAD_PATH")};async function*LSe(r,e,t={}){let{cid:n,toResolve:i}=USe(r),o=n.toString(),s=o;const a=i.length;for(;;){const l=await JW(n,o,s,i,a,e,t);if(l.entry==null&&l.next==null)throw Zr(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");if(l.entry!=null&&(yield l.entry),l.next==null)return;i=l.next.toResolve,n=l.next.cid,o=l.next.name,s=l.next.path}}async function KSe(r,e,t={}){const n=await iSe(LSe(r,e,t));if(n==null)throw Zr(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");return n}var $f=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},zSe=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}};class FSe{constructor(e={}){this.config=Object.assign({blockstoreLocation:"DATASTORE",createLevelDatabase:cm},e),this.blockstore=new tT({location:this.config.blockstoreLocation,createLevelDatabase:this.config.createLevelDatabase})}open(){return $f(this,void 0,void 0,function*(){yield this.blockstore.open()})}close(){return $f(this,void 0,void 0,function*(){yield this.blockstore.close()})}put(e,t,n,i){var o,s,a,l,d,c;return $f(this,void 0,void 0,function*(){const u=yield this.getBlockstoreForStoringData(e,t,n),f=KP([{content:i}],u,{cidVersion:1});let h;try{for(var p=!0,y=zSe(f),g;g=yield y.next(),o=g.done,!o;p=!0)l=g.value,p=!1,h=l}catch(w){s={error:w}}finally{try{!p&&!o&&(a=y.return)&&(yield a.call(y))}finally{if(s)throw s.error}}return{dataSize:Number((c=(d=h.unixfs)===null||d===void 0?void 0:d.fileSize())!==null&&c!==void 0?c:h.size)}})}get(e,t,n){return $f(this,void 0,void 0,function*(){const i=yield this.getBlockstoreForStoringData(e,t,n);if(!(yield i.has(n)))return;const s=yield KSe(n,i),a=s.content(),l=new $w.Readable({read(){return $f(this,void 0,void 0,function*(){const c=yield a.next();c.done?this.push(null):this.push(c.value)})}});let d=s.size;return(s.type==="file"||s.type==="directory")&&(d=s.unixfs.fileSize()),{dataSize:Number(d),dataStream:l}})}delete(e,t,n){return $f(this,void 0,void 0,function*(){yield(yield this.getBlockstoreForStoringData(e,t,n)).clear()})}clear(){return $f(this,void 0,void 0,function*(){yield this.blockstore.clear()})}getBlockstoreForStoringData(e,t,n){return $f(this,void 0,void 0,function*(){return yield(yield(yield(yield this.blockstore.partition("data")).partition(e)).partition(t)).partition(n)})}}var oi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},F0=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}},Xp=function(r){return this instanceof Xp?(this.v=r,this):new Xp(r)},qSe=function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){n[f]&&(i[f]=function(h){return new Promise(function(p,y){o.push([f,h,p,y])>1||a(f,h)})})}function a(f,h){try{l(n[f](h))}catch(p){u(o[0][3],p)}}function l(f){f.value instanceof Xp?Promise.resolve(f.value.v).then(d,c):u(o[0][2],f)}function d(f){a("next",f)}function c(f){a("throw",f)}function u(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}};const hN="index";class rn{constructor(e){this.config=Object.assign({createLevelDatabase:cm},e),this.db=new fv({location:this.config.location,createLevelDatabase:this.config.createLevelDatabase,keyEncoding:"utf8"})}open(){return oi(this,void 0,void 0,function*(){yield this.db.open()})}close(){return oi(this,void 0,void 0,function*(){yield this.db.close()})}clear(){return oi(this,void 0,void 0,function*(){yield this.db.clear()})}put(e,t,n,i){return oi(this,void 0,void 0,function*(){if(lI(n))throw new Ae(we.IndexMissingIndexableProperty,"Index must include at least one valid indexable property");const o={messageCid:t,indexes:n},s=[];for(const c in n){const u=n[c];if(Array.isArray(u))for(const f of u){const h=this.createPutIndexedItemOperation(e,o,c,f);s.push(h)}else{const f=this.createPutIndexedItemOperation(e,o,c,u);s.push(f)}}const a=this.createOperationForIndexesLookupPartition(e,{type:"put",key:t,value:JSON.stringify(n)});s.push(a);const l=yield Promise.all(s);yield(yield this.db.partition(e)).batch(l,i)})}delete(e,t,n){return oi(this,void 0,void 0,function*(){const i=[],o=yield this.getIndexes(e,t);if(o===void 0)return;const s=this.createOperationForIndexesLookupPartition(e,{type:"del",key:t});i.push(s);for(const d in o){const c=o[d];if(Array.isArray(c))for(const u of c){const f=this.createDeleteIndexedItemOperation(e,t,d,u);i.push(f)}else{const u=this.createDeleteIndexedItemOperation(e,t,d,c);i.push(u)}}const a=yield Promise.all(i);yield(yield this.db.partition(e)).batch(a,n)})}createPutIndexedItemOperation(e,t,n,i){return oi(this,void 0,void 0,function*(){const{messageCid:o}=t,s=rn.keySegmentJoin(rn.encodeValue(i),o);return this.createOperationForIndexPartition(e,n,{type:"put",key:s,value:JSON.stringify(t)})})}createDeleteIndexedItemOperation(e,t,n,i){return oi(this,void 0,void 0,function*(){const o=rn.keySegmentJoin(rn.encodeValue(i),t);return this.createOperationForIndexPartition(e,n,{type:"del",key:o})})}createOperationForIndexPartition(e,t,n){return oi(this,void 0,void 0,function*(){const i=yield this.db.partition(e),o=rn.getIndexPartitionName(t);return i.createPartitionOperation(o,n)})}createOperationForIndexesLookupPartition(e,t){return oi(this,void 0,void 0,function*(){return(yield this.db.partition(e)).createPartitionOperation(hN,t)})}static getIndexPartitionName(e){return`__${e}__`}getIndexPartition(e,t){return oi(this,void 0,void 0,function*(){const n=rn.getIndexPartitionName(t);return(yield this.db.partition(e)).partition(n)})}getIndexesLookupPartition(e){return oi(this,void 0,void 0,function*(){return(yield this.db.partition(e)).partition(hN)})}query(e,t,n,i){return oi(this,void 0,void 0,function*(){return rn.shouldQueryWithInMemoryPaging(t,n)?this.queryWithInMemoryPaging(e,t,n,i):this.queryWithIteratorPaging(e,t,n,i)})}queryWithIteratorPaging(e,t,n,i){var o,s,a,l;return oi(this,void 0,void 0,function*(){const{cursor:d,limit:c}=n,u=d?this.createStartingKeyFromCursor(d):"",f=[];try{for(var h=!0,p=F0(this.getIndexIterator(e,u,n,i)),y;y=yield p.next(),o=y.done,!o;h=!0){l=y.value,h=!1;const g=l;if(c!==void 0&&c===f.length)break;const{indexes:w}=g;Wo.matchAnyFilter(w,t)&&f.push(g)}}catch(g){s={error:g}}finally{try{!h&&!o&&(a=p.return)&&(yield a.call(p))}finally{if(s)throw s.error}}return f})}getIndexIterator(e,t,n,i){return qSe(this,arguments,function*(){var s,a,l,d;const{sortProperty:c,sortDirection:u=ya.Ascending,cursor:f}=n,h={gt:t};u===ya.Descending&&(h.reverse=!0,f!==void 0&&(h.lt=t,delete h.gt));const p=yield Xp(this.getIndexPartition(e,c));try{for(var y=!0,g=F0(p.iterator(h,i)),w;w=yield Xp(g.next()),s=w.done,!s;y=!0){d=w.value,y=!1;const[v,m]=d,{indexes:b,messageCid:_}=JSON.parse(m);yield yield Xp({indexes:b,messageCid:_})}}catch(v){a={error:v}}finally{try{!y&&!s&&(l=g.return)&&(yield Xp(l.call(g)))}finally{if(a)throw a.error}}})}createStartingKeyFromCursor(e){const{messageCid:t,value:n}=e;return rn.keySegmentJoin(rn.encodeValue(n),t)}static createCursorFromLastArrayItem(e,t){if(e.length>0)return this.createCursorFromItem(e.at(-1),t)}static createCursorFromItem(e,t){const{messageCid:n,indexes:i}=e,o=i[t];if(o===void 0)throw new Ae(we.IndexInvalidCursorSortProperty,`the sort property '${t}' is not defined within the given item.`);if(typeof o=="boolean"||Array.isArray(o))throw new Ae(we.IndexInvalidCursorValueType,`only string or number values are supported for cursors, a(n) ${typeof o} was given.`);return{messageCid:n,value:o}}queryWithInMemoryPaging(e,t,n,i){return oi(this,void 0,void 0,function*(){const{sortProperty:o,sortDirection:s=ya.Ascending,cursor:a,limit:l}=n,d=a?this.createStartingKeyFromCursor(a):void 0,c=new Map;t.length===0&&(t=[{}]);try{yield Promise.all(t.map(p=>this.executeSingleFilterQuery(e,p,o,c,i)))}catch(p){if(p.code===we.IndexInvalidSortPropertyInMemory)return[]}const u=[...c.values()].sort((p,y)=>this.sortItems(p,y,o,s)),f=d!==void 0?this.findCursorStartingIndex(u,s,o,d):0;if(f<0)return[];const h=l!==void 0?f+l:void 0;return u.slice(f,h)})}executeSingleFilterQuery(e,t,n,i,o){return oi(this,void 0,void 0,function*(){const s=[];if(lI(t)){const l=this.getAllItems(e,n);s.push(l)}const a=rhe.reduceFilter(t);for(const l in a){const d=a[l];if(Wo.isEqualFilter(d)){const c=this.filterExactMatches(e,l,d,o);s.push(c)}else if(Wo.isOneOfFilter(d))for(const c of new Set(d)){const u=this.filterExactMatches(e,l,c,o);s.push(u)}else if(Wo.isRangeFilter(d)){const c=this.filterRangeMatches(e,l,d,o);s.push(c)}}for(const l of s){const d=yield l;for(const c of d)if(!(i.has(c.messageCid)||!Wo.matchFilter(c.indexes,t))){if(c.indexes[n]===void 0)throw new Ae(we.IndexInvalidSortPropertyInMemory,`invalid sort property ${n}`);i.set(c.messageCid,c)}}})}getAllItems(e,t){var n,i,o,s;return oi(this,void 0,void 0,function*(){const a=yield this.getIndexPartition(e,t),l=[];try{for(var d=!0,c=F0(a.iterator()),u;u=yield c.next(),n=u.done,!n;d=!0){s=u.value,d=!1;const[f,h]=s;l.push(JSON.parse(h))}}catch(f){i={error:f}}finally{try{!d&&!n&&(o=c.return)&&(yield o.call(c))}finally{if(i)throw i.error}}return l})}filterExactMatches(e,t,n,i){var o,s,a,l;return oi(this,void 0,void 0,function*(){const d=rn.keySegmentJoin(rn.encodeValue(n)),c={gt:d},u=yield this.getIndexPartition(e,t),f=[];try{for(var h=!0,p=F0(u.iterator(c,i)),y;y=yield p.next(),o=y.done,!o;h=!0){l=y.value,h=!1;const[g,w]=l;if(!g.startsWith(d))break;f.push(JSON.parse(w))}}catch(g){s={error:g}}finally{try{!h&&!o&&(a=p.return)&&(yield a.call(p))}finally{if(s)throw s.error}}return f})}filterRangeMatches(e,t,n,i){var o,s,a,l;return oi(this,void 0,void 0,function*(){const d={};for(const y in n){const g=y;d[g]=rn.encodeValue(n[g])}d.gt===void 0&&d.gte===void 0&&(d.reverse=!0);const c=[],u=yield this.getIndexPartition(e,t);try{for(var f=!0,h=F0(u.iterator(d,i)),p;p=yield h.next(),o=p.done,!o;f=!0){l=p.value,f=!1;const[y,g]=l;"gt"in n&&this.extractIndexValueFromKey(y)===rn.encodeValue(n.gt)||c.push(JSON.parse(g))}}catch(y){s={error:y}}finally{try{!f&&!o&&(a=h.return)&&(yield a.call(h))}finally{if(s)throw s.error}}if("lte"in n)for(const y of yield this.filterExactMatches(e,t,n.lte,i))c.push(y);return c})}sortItems(e,t,n,i){const o=e.indexes[n],s=t.indexes[n],a=rn.encodeValue(o)+e.messageCid,l=rn.encodeValue(s)+t.messageCid;return i===ya.Ascending?cI(a,l):cI(l,a)}findCursorStartingIndex(e,t,n,i){const o=s=>{const{messageCid:a,indexes:l}=s,d=l[n],c=rn.keySegmentJoin(rn.encodeValue(d),a);return t===ya.Ascending?c>i:c<i};return e.findIndex(o)}getIndexes(e,t){return oi(this,void 0,void 0,function*(){const i=yield(yield this.getIndexesLookupPartition(e)).get(t);if(i!==void 0)return JSON.parse(i)})}extractIndexValueFromKey(e){const[t]=e.split(rn.delimiter);return t}static keySegmentJoin(...e){return e.join(rn.delimiter)}static encodeNumberValue(e){const t=Number.MAX_SAFE_INTEGER,n="!",i=String(Number.MAX_SAFE_INTEGER).length,o=e<0?n:"",s=e<0?t:0;return o+String(e+s).padStart(i,"0")}static encodeValue(e){switch(typeof e){case"number":return this.encodeNumberValue(e);default:return JSON.stringify(e)}}static shouldQueryWithInMemoryPaging(e,t){for(const n of e)if(!rn.isFilterConcise(n,t))return!1;return!0}static isFilterConcise(e,t){return e.recordId!==void 0?!0:t.cursor!==void 0?!1:e.protocolPath!==void 0||e.contextId!==void 0||e.parentId!==void 0||e.schema!==void 0}}rn.delimiter="\0";function Sk(r){if(!XD(r))throw new Error("Parameter was not an error")}function XD(r){return VSe(r)==="[object Error]"||r instanceof Error}function VSe(r){return Object.prototype.toString.call(r)}function WSe(r){let e,t="";if(r.length===0)e={};else if(XD(r[0]))e={cause:r[0]},t=r.slice(1).join(" ")||"";else if(r[0]&&typeof r[0]=="object")e=Object.assign({},r[0]),t=r.slice(1).join(" ")||"";else if(typeof r[0]=="string")e={},t=t=r.join(" ")||"";else throw new Error("Invalid arguments passed to Layerr");return{options:e,shortMessage:t}}class va extends Error{constructor(e,t){const n=[...arguments],{options:i,shortMessage:o}=WSe(n);let s=o;if(i.cause&&(s=`${s}: ${i.cause.message}`),super(s),this.message=s,i.name&&typeof i.name=="string"?this.name=i.name:this.name="Layerr",i.cause&&Object.defineProperty(this,"_cause",{value:i.cause}),Object.defineProperty(this,"_info",{value:{}}),i.info&&typeof i.info=="object"&&Object.assign(this._info,i.info),Error.captureStackTrace){const a=i.constructorOpt||this.constructor;Error.captureStackTrace(this,a)}}static cause(e){return Sk(e),e._cause&&XD(e._cause)?e._cause:null}static fullStack(e){Sk(e);const t=va.cause(e);return t?`${e.stack}
caused by: ${va.fullStack(t)}`:e.stack}static info(e){Sk(e);const t={},n=va.cause(e);return n&&Object.assign(t,va.info(n)),e._info&&Object.assign(t,e._info),t}cause(){return va.cause(this)}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}const cw="0123456789ABCDEFGHJKMNPQRSTVWXYZ",Ag=32,pN=0xffffffffffff,yN=10,HSe=16,Qp=Object.freeze({source:"ulid"});function GSe(r){const e=YSe(),t=e&&(e.crypto||e.msCrypto)||null;if(typeof t?.getRandomValues=="function")return()=>{const n=new Uint8Array(1);return t.getRandomValues(n),n[0]/255};if(typeof t?.randomBytes=="function")return()=>t.randomBytes(1).readUInt8()/255;throw new va({info:{code:"PRNG_DETECT",...Qp}},"Failed to find a reliable PRNG")}function YSe(){return XSe()?self:typeof window<"u"?window:typeof globalThis<"u"||typeof globalThis<"u"?globalThis:null}function ZSe(r,e){let t="";for(;r>0;r--)t=QSe(e)+t;return t}function mN(r,e){if(isNaN(r))throw new va({info:{code:"ENC_TIME_NAN",...Qp}},`Time must be a number: ${r}`);if(r>pN)throw new va({info:{code:"ENC_TIME_SIZE_EXCEED",...Qp}},`Cannot encode a time larger than ${pN}: ${r}`);if(r<0)throw new va({info:{code:"ENC_TIME_NEG",...Qp}},`Time must be positive: ${r}`);if(Number.isInteger(r)===!1)throw new va({info:{code:"ENC_TIME_TYPE",...Qp}},`Time must be an integer: ${r}`);let t,n="";for(let i=e;i>0;i--)t=r%Ag,n=cw.charAt(t)+n,r=(r-t)/Ag;return n}function JSe(r){let e,t=r.length,n,i,o=r;const s=Ag-1;for(;!e&&t-->=0;){if(n=o[t],i=cw.indexOf(n),i===-1)throw new va({info:{code:"B32_INC_ENC",...Qp}},"Incorrectly encoded string");if(i===s){o=gN(o,t,cw[0]);continue}e=gN(o,t,cw[i+1])}if(typeof e=="string")return e;throw new va({info:{code:"B32_INC_INVALID",...Qp}},"Failed incrementing string")}function XSe(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function XW(r){const e=GSe();let t=0,n;return function(o){const s=isNaN(o)?Date.now():o;if(s<=t){const l=n=JSe(n);return mN(t,yN)+l}t=s;const a=n=ZSe(HSe,e);return mN(s,yN)+a}}function QSe(r){let e=Math.floor(r()*Ag);return e===Ag&&(e=Ag-1),cw.charAt(e)}function gN(r,e,t){return e>r.length-1?r:r.substr(0,e)+t+r.substr(e+1)}var hp=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class eTe{constructor(e){this.index=new rn(Object.assign({location:"EVENTLOG",createLevelDatabase:cm},e)),this.ulidFactory=XW()}open(){return hp(this,void 0,void 0,function*(){return this.index.open()})}close(){return hp(this,void 0,void 0,function*(){return this.index.close()})}clear(){return hp(this,void 0,void 0,function*(){return this.index.clear()})}append(e,t,n){return hp(this,void 0,void 0,function*(){const i=this.ulidFactory();yield this.index.put(e,t,Object.assign(Object.assign({},n),{watermark:i}))})}queryEvents(e,t,n){return hp(this,void 0,void 0,function*(){const i=yield this.index.query(e,t,{sortProperty:"watermark",cursor:n});return{events:i.map(({messageCid:o})=>o),cursor:rn.createCursorFromLastArrayItem(i,"watermark")}})}getEvents(e,t){return hp(this,void 0,void 0,function*(){return this.queryEvents(e,[],t)})}deleteEventsByCid(e,t){return hp(this,void 0,void 0,function*(){const n=[];for(const i of t)n.push(this.index.delete(e,i));yield Promise.all(n)})}}function S2({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*tTe(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t],o=er.asCID(n);o?yield[i.join("/"),o]:typeof n=="object"&&(yield*i5(n,i))}else{const t=er.asCID(e);t?yield[r.join("/"),t]:yield*i5(e,r)}}function*i5(r,e){if(r==null||r instanceof Uint8Array)return;const t=er.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,i]of Object.entries(r)){const o=[...e,n];yield*tTe(o,i)}}function*rTe(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const i=[...r,t];yield i.join("/"),typeof n=="object"&&!er.asCID(n)&&(yield*o5(n,i))}else yield*o5(e,r)}function*o5(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const i=[...e,t];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!er.asCID(n)&&(yield*rTe(i,n))}}function nTe(r,e){let t=r;for(const[n,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);const o=er.asCID(t);if(o)return{value:o,remaining:e.slice(n+1).join("/")}}return{value:t}}class QW{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:S2(),bytes:S2(),value:S2(),asBlock:S2()})}links(){return i5(this.value,[])}tree(){return o5(this.value,[])}get(e="/"){return nTe(this.value,e.split("/").filter(Boolean))}}async function iTe({value:r,codec:e,hasher:t}){if(typeof r>"u")throw new Error('Missing required argument "value"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.encode(r),i=await t.digest(n),o=er.create(1,e.code,i);return new QW({value:r,bytes:n,cid:o})}async function oTe({bytes:r,codec:e,hasher:t}){if(!r)throw new Error('Missing required argument "bytes"');if(!e||!t)throw new Error("Missing required argument: codec or hasher");const n=e.decode(r),i=await t.digest(r),o=er.create(1,e.code,i);return new QW({value:n,bytes:r,cid:o})}var pp=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class QD{constructor(e={}){this.config=Object.assign({blockstoreLocation:"MESSAGESTORE",indexLocation:"INDEX",createLevelDatabase:cm},e),this.blockstore=new tT({location:this.config.blockstoreLocation,createLevelDatabase:this.config.createLevelDatabase}),this.index=new rn({location:this.config.indexLocation,createLevelDatabase:this.config.createLevelDatabase})}open(){return pp(this,void 0,void 0,function*(){yield this.blockstore.open(),yield this.index.open()})}close(){return pp(this,void 0,void 0,function*(){yield this.blockstore.close(),yield this.index.close()})}get(e,t,n){var i;return pp(this,void 0,void 0,function*(){(i=n?.signal)===null||i===void 0||i.throwIfAborted();const o=yield eo(this.blockstore.partition(e),n?.signal),s=er.parse(t),a=yield o.get(s,n);return a?(yield eo(oTe({bytes:a,codec:RP,hasher:Xl}),n?.signal)).value:void 0})}query(e,t,n,i,o){var s;return pp(this,void 0,void 0,function*(){(s=o?.signal)===null||s===void 0||s.throwIfAborted();const a=QD.buildQueryOptions(n,i),l=yield this.index.query(e,t,a,o);let d;i?.limit!==void 0&&i.limit<l.length&&(l.splice(-1),d=rn.createCursorFromLastArrayItem(l,a.sortProperty));const c=[];for(let u=0;u<l.length;u++){const{messageCid:f}=l[u],h=yield this.get(e,f,o);h&&c.push(h)}return{messages:c,cursor:d}})}static buildQueryOptions(e={},t={}){let{limit:n,cursor:i}=t;const{dateCreated:o,datePublished:s,messageTimestamp:a}=e;let l=ya.Ascending,d="messageTimestamp";return o!==void 0?d="dateCreated":s!==void 0?d="datePublished":a!==void 0&&(d="messageTimestamp"),e[d]!==void 0&&(l=e[d]),n!==void 0&&n>0&&(n=n+1),{sortDirection:l,sortProperty:d,limit:n,cursor:i}}delete(e,t,n){var i;return pp(this,void 0,void 0,function*(){(i=n?.signal)===null||i===void 0||i.throwIfAborted();const o=yield eo(this.blockstore.partition(e),n?.signal),s=er.parse(t);yield o.delete(s,n),yield this.index.delete(e,t,n)})}put(e,t,n,i){var o;return pp(this,void 0,void 0,function*(){(o=i?.signal)===null||o===void 0||o.throwIfAborted();const s=yield eo(this.blockstore.partition(e),i?.signal),a=yield eo(iTe({value:t,codec:RP,hasher:Xl}),i?.signal),l=_i.parseCid(yield Oe.getCid(t));yield s.put(l,a.bytes,i);const d=l.toString();yield this.index.put(e,d,n,i)})}clear(){return pp(this,void 0,void 0,function*(){yield this.blockstore.clear(),yield this.index.clear()})}}var kf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},sTe=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}};class rT{constructor(e){this.config=Object.assign({location:"RESUMABLE-TASK-STORE",createLevelDatabase:cm},e),this.db=new fv({location:this.config.location,createLevelDatabase:this.config.createLevelDatabase,keyEncoding:"utf8"})}open(){return kf(this,void 0,void 0,function*(){yield this.db.open()})}close(){return kf(this,void 0,void 0,function*(){yield this.db.close()})}register(e,t){return kf(this,void 0,void 0,function*(){const n=yield _i.computeCid(e),i={id:n,timeout:Date.now()+t*1e3,retryCount:0,task:e};return yield this.db.put(n,JSON.stringify(i)),i})}grab(e){var t,n,i,o;return kf(this,void 0,void 0,function*(){const s=[];try{for(var a=!0,l=sTe(this.db.iterator()),d;d=yield l.next(),t=d.done,!t;a=!0){o=d.value,a=!1;const[c,u]=o,f=JSON.parse(u);if(Date.now()>=f.timeout&&(f.timeout=Date.now()+rT.taskTimeoutInSeconds*1e3,f.retryCount++,yield this.db.put(f.id,JSON.stringify(f)),s.push(f)),s.length>=e)break}}catch(c){n={error:c}}finally{try{!a&&!t&&(i=l.return)&&(yield i.call(l))}finally{if(n)throw n.error}}return s})}read(e){return kf(this,void 0,void 0,function*(){const t=yield this.db.get(e);if(t)return JSON.parse(t)})}extend(e,t){return kf(this,void 0,void 0,function*(){const n=yield this.db.get(e);if(n){const i=JSON.parse(n);i.timeout=Date.now()+t*1e3,yield this.db.put(i.id,JSON.stringify(i))}})}delete(e){return kf(this,void 0,void 0,function*(){return this.db.delete(e)})}clear(){return kf(this,void 0,void 0,function*(){yield this.db.clear()})}}rT.taskTimeoutInSeconds=60;var Ke;(function(r){r.MessagesQuery="MessagesQuery",r.MessagesRead="MessagesRead",r.MessagesSubscribe="MessagesSubscribe",r.ProtocolsConfigure="ProtocolsConfigure",r.ProtocolsQuery="ProtocolsQuery",r.RecordsDelete="RecordsDelete",r.RecordsQuery="RecordsQuery",r.RecordsRead="RecordsRead",r.RecordsSubscribe="RecordsSubscribe",r.RecordsWrite="RecordsWrite"})(Ke||(Ke={}));const vN={[Ke.MessagesQuery]:Mw,[Ke.MessagesRead]:mg,[Ke.MessagesSubscribe]:Bw,[Ke.ProtocolsConfigure]:ea,[Ke.ProtocolsQuery]:vg,[Ke.RecordsDelete]:Qg,[Ke.RecordsQuery]:Dw,[Ke.RecordsRead]:Nw,[Ke.RecordsSubscribe]:Uw,[Ke.RecordsWrite]:Gt};var Jw;(function(r){r.authentication="authentication",r.assertionMethod="assertionMethod",r.keyAgreement="keyAgreement",r.capabilityInvocation="capabilityInvocation",r.capabilityDelegation="capabilityDelegation"})(Jw||(Jw={}));const go={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};let Er=class eH{constructor({method:e,id:t,path:n,query:i,fragment:o,params:s}){this.uri=`did:${e}:${t}`,this.method=e,this.id=t,this.path=n,this.query=i,this.fragment=o,this.params=s}static parse(e){if(!e)return null;const t=eH.DID_URI_PATTERN.exec(e);if(!t||!t.groups)return null;const{method:n,id:i,path:o,query:s,fragment:a}=t.groups,l={uri:`did:${n}:${i}`,method:n,id:i};if(o&&(l.path=o),s&&(l.query=s.slice(1)),a&&(l.fragment=a.slice(1)),s){const d={},c=s.slice(1).split("&");for(const u of c){const[f,h]=u.split("=");d[f]=h}l.params=d}return l}};Er.METHOD_PATTERN="([a-z0-9]+)";Er.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Er.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Er.PCT_ENCODED_PATTERN})`;Er.METHOD_ID_PATTERN=`((?:${Er.ID_CHAR_PATTERN}*:)*(${Er.ID_CHAR_PATTERN}+))`;Er.PATH_PATTERN="(/[^#?]*)?";Er.QUERY_PATTERN="([?][^#]*)?";Er.FRAGMENT_PATTERN="(#.*)?";Er.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Er.METHOD_PATTERN}):(?<id>${Er.METHOD_ID_PATTERN})(?<path>${Er.PATH_PATTERN})(?<query>${Er.QUERY_PATTERN})(?<fragment>${Er.FRAGMENT_PATTERN})$`);let mt=class tH extends Error{constructor(e,t){super(`${e}: ${t}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tH)}};var st;(function(r){r.InvalidDid="invalidDid",r.MethodNotSupported="methodNotSupported",r.InternalError="internalError",r.InvalidDidDocument="invalidDidDocument",r.InvalidDidDocumentLength="invalidDidDocumentLength",r.InvalidDidUrl="invalidDidUrl",r.InvalidPreviousDidProof="invalidPreviousDidProof",r.InvalidPublicKey="invalidPublicKey",r.InvalidPublicKeyLength="invalidPublicKeyLength",r.InvalidPublicKeyType="invalidPublicKeyType",r.InvalidSignature="invalidSignature",r.NotFound="notFound",r.RepresentationNotSupported="representationNotSupported",r.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(st||(st={}));var aTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let nT=class{static digest(e){return aTe(this,arguments,void 0,function*({data:t}){return lc(t)})}},bd=class{};var cTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let e6=class extends bd{digest(e){return cTe(this,arguments,void 0,function*({algorithm:t,data:n}){switch(t){case"SHA-256":return yield nT.digest({data:n})}})}};function lTe(r){const e=n=>{if(n!==null&&typeof n=="object"&&!Array.isArray(n)){const i=Object.keys(n).sort(),o={};for(const s of i)o[s]=e(n[s]);return o}return n},t=e(r);return JSON.stringify(t)}var dTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const rx="urn:jwk:";function nr(r){return dTe(this,arguments,void 0,function*({jwk:e}){const t=e.kty;let n;if(t==="EC")n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(t==="oct")n={k:e.k,kty:e.kty};else if(t==="OKP")n={crv:e.crv,kty:e.kty,x:e.x};else if(t==="RSA")n={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${t}`);tD(n);const i=lTe(n),o=Ue.string(i).toUint8Array(),s=yield nT.digest({data:o});return Ue.uint8Array(s).toBase64Url()})}function Yl(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r&&"d"in r)||r.kty!=="EC"||typeof r.d!="string"||typeof r.x!="string")}function iT(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r)||"d"in r||r.kty!=="EC"||typeof r.x!="string")}function rH(r){return!(!r||typeof r!="object"||!("kty"in r&&"k"in r)||r.kty!=="oct"||typeof r.k!="string")}function Zl(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r&&"d"in r)||r.kty!=="OKP"||typeof r.d!="string"||typeof r.x!="string")}function oT(r){return!(!r||typeof r!="object"||"d"in r||!("kty"in r&&"crv"in r&&"x"in r)||r.kty!=="OKP"||typeof r.x!="string")}function t6(r){if(!r||typeof r!="object")return!1;switch(r.kty){case"EC":case"OKP":case"RSA":return"d"in r;case"oct":return"k"in r;default:return!1}}var Vi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},uTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let Pn=class vl{static adjustSignatureToLowS(e){return Vi(this,arguments,void 0,function*({signature:t}){const n=ar.Signature.fromCompact(t);return n.hasHighS()?n.normalizeS().toCompactRawBytes():t})}static bytesToPrivateKey(e){return Vi(this,arguments,void 0,function*({privateKeyBytes:t}){const n=yield vl.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"secp256k1",d:Ue.uint8Array(t).toBase64Url(),x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield nr({jwk:i}),i})}static bytesToPublicKey(e){return Vi(this,arguments,void 0,function*({publicKeyBytes:t}){const n=yield vl.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"secp256k1",x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield nr({jwk:i}),i})}static compressPublicKey(e){return Vi(this,arguments,void 0,function*({publicKeyBytes:t}){return ar.ProjectivePoint.fromHex(t).toRawBytes(!0)})}static computePublicKey(e){return Vi(this,arguments,void 0,function*({key:t}){const n=yield vl.privateKeyToBytes({privateKey:t}),i=yield vl.getCurvePoint({keyBytes:n}),o={kty:"EC",crv:"secp256k1",x:Ue.uint8Array(i.x).toBase64Url(),y:Ue.uint8Array(i.y).toBase64Url()};return o.kid=yield nr({jwk:o}),o})}static convertDerToCompactSignature(e){return Vi(this,arguments,void 0,function*({derSignature:t}){return ar.Signature.fromDER(t).toCompactRawBytes()})}static decompressPublicKey(e){return Vi(this,arguments,void 0,function*({publicKeyBytes:t}){return ar.ProjectivePoint.fromHex(t).toRawBytes(!1)})}static generateKey(){return Vi(this,void 0,void 0,function*(){const e=ar.utils.randomPrivateKey(),t=yield vl.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield nr({jwk:t}),t})}static getPublicKey(e){return Vi(this,arguments,void 0,function*({key:t}){var n;if(!(Yl(t)&&t.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let i=uTe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield nr({jwk:i})),i})}static privateKeyToBytes(e){return Vi(this,arguments,void 0,function*({privateKey:t}){if(!Yl(t))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Vi(this,arguments,void 0,function*({publicKey:t}){if(!(iT(t)&&t.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const n=new Uint8Array([4]),i=Ue.base64Url(t.x).toUint8Array(),o=Ue.base64Url(t.y).toUint8Array();return new Uint8Array([...n,...i,...o])})}static sharedSecret(e){return Vi(this,arguments,void 0,function*({privateKeyA:t,publicKeyB:n}){if("x"in t&&"x"in n&&t.x===n.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const i=yield vl.privateKeyToBytes({privateKey:t}),o=yield vl.publicKeyToBytes({publicKey:n});return ar.getSharedSecret(i,o,!0).slice(1)})}static sign(e){return Vi(this,arguments,void 0,function*({data:t,key:n}){const i=yield vl.privateKeyToBytes({privateKey:n}),o=lc(t);return ar.sign(o,i).toCompactRawBytes()})}static validatePrivateKey(e){return Vi(this,arguments,void 0,function*({privateKeyBytes:t}){return ar.utils.isValidPrivateKey(t)})}static validatePublicKey(e){return Vi(this,arguments,void 0,function*({publicKeyBytes:t}){try{ar.ProjectivePoint.fromHex(t).assertValidity()}catch{return!1}return!0})}static verify(e){return Vi(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=yield vl.publicKeyToBytes({publicKey:t}),s=lc(i);return ar.verify(n,s,o,{lowS:!1})})}static getCurvePoint(e){return Vi(this,arguments,void 0,function*({keyBytes:t}){t.byteLength===32&&(t=ar.getPublicKey(t));const n=ar.ProjectivePoint.fromHex(t),i=Mi(n.x,32),o=Mi(n.y,32);return{x:i,y:o}})}};var Wi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},fTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let Fn=class bl{static adjustSignatureToLowS(e){return Wi(this,arguments,void 0,function*({signature:t}){const n=ur.Signature.fromCompact(t);return n.hasHighS()?n.normalizeS().toCompactRawBytes():t})}static bytesToPrivateKey(e){return Wi(this,arguments,void 0,function*({privateKeyBytes:t}){const n=yield bl.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"P-256",d:Ue.uint8Array(t).toBase64Url(),x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield nr({jwk:i}),i})}static bytesToPublicKey(e){return Wi(this,arguments,void 0,function*({publicKeyBytes:t}){const n=yield bl.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"P-256",x:Ue.uint8Array(n.x).toBase64Url(),y:Ue.uint8Array(n.y).toBase64Url()};return i.kid=yield nr({jwk:i}),i})}static compressPublicKey(e){return Wi(this,arguments,void 0,function*({publicKeyBytes:t}){return ur.ProjectivePoint.fromHex(t).toRawBytes(!0)})}static computePublicKey(e){return Wi(this,arguments,void 0,function*({key:t}){const n=yield bl.privateKeyToBytes({privateKey:t}),i=yield bl.getCurvePoint({keyBytes:n}),o={kty:"EC",crv:"P-256",x:Ue.uint8Array(i.x).toBase64Url(),y:Ue.uint8Array(i.y).toBase64Url()};return o.kid=yield nr({jwk:o}),o})}static convertDerToCompactSignature(e){return Wi(this,arguments,void 0,function*({derSignature:t}){return ur.Signature.fromDER(t).toCompactRawBytes()})}static decompressPublicKey(e){return Wi(this,arguments,void 0,function*({publicKeyBytes:t}){return ur.ProjectivePoint.fromHex(t).toRawBytes(!1)})}static generateKey(){return Wi(this,void 0,void 0,function*(){const e=ur.utils.randomPrivateKey(),t=yield bl.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield nr({jwk:t}),t})}static getPublicKey(e){return Wi(this,arguments,void 0,function*({key:t}){var n;if(!(Yl(t)&&t.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let i=fTe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield nr({jwk:i})),i})}static privateKeyToBytes(e){return Wi(this,arguments,void 0,function*({privateKey:t}){if(!Yl(t))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Wi(this,arguments,void 0,function*({publicKey:t}){if(!(iT(t)&&t.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const n=new Uint8Array([4]),i=Ue.base64Url(t.x).toUint8Array(),o=Ue.base64Url(t.y).toUint8Array();return new Uint8Array([...n,...i,...o])})}static sharedSecret(e){return Wi(this,arguments,void 0,function*({privateKeyA:t,publicKeyB:n}){if("x"in t&&"x"in n&&t.x===n.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const i=yield bl.privateKeyToBytes({privateKey:t}),o=yield bl.publicKeyToBytes({publicKey:n});return ur.getSharedSecret(i,o,!0).slice(1)})}static sign(e){return Wi(this,arguments,void 0,function*({data:t,key:n}){const i=yield bl.privateKeyToBytes({privateKey:n}),o=lc(t);return ur.sign(o,i).toCompactRawBytes()})}static validatePrivateKey(e){return Wi(this,arguments,void 0,function*({privateKeyBytes:t}){return ur.utils.isValidPrivateKey(t)})}static validatePublicKey(e){return Wi(this,arguments,void 0,function*({publicKeyBytes:t}){try{ur.ProjectivePoint.fromHex(t).assertValidity()}catch{return!1}return!0})}static verify(e){return Wi(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=yield bl.publicKeyToBytes({publicKey:t}),s=lc(i);return ur.verify(n,s,o,{lowS:!1})})}static getCurvePoint(e){return Wi(this,arguments,void 0,function*({keyBytes:t}){t.byteLength===32&&(t=ur.getPublicKey(t));const n=ur.ProjectivePoint.fromHex(t),i=Mi(n.x,32),o=Mi(n.y,32);return{x:i,y:o}})}};var q0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let nx=class extends bd{computePublicKey(e){return q0(this,arguments,void 0,function*({key:t}){if(!Yl(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(t.crv){case"secp256k1":{const n=yield Pn.computePublicKey({key:t});return n.alg="ES256K",n}case"P-256":{const n=yield Fn.computePublicKey({key:t});return n.alg="ES256",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}generateKey(e){return q0(this,arguments,void 0,function*({algorithm:t}){switch(t){case"ES256K":case"secp256k1":{const n=yield Pn.generateKey();return n.alg="ES256K",n}case"ES256":case"secp256r1":{const n=yield Fn.generateKey();return n.alg="ES256",n}}})}getPublicKey(e){return q0(this,arguments,void 0,function*({key:t}){if(!Yl(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(t.crv){case"secp256k1":{const n=yield Pn.getPublicKey({key:t});return n.alg="ES256K",n}case"P-256":{const n=yield Fn.getPublicKey({key:t});return n.alg="ES256",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}sign(e){return q0(this,arguments,void 0,function*({key:t,data:n}){if(!Yl(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(t.crv){case"secp256k1":return yield Pn.sign({key:t,data:n});case"P-256":return yield Fn.sign({key:t,data:n});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}verify(e){return q0(this,arguments,void 0,function*({key:t,signature:n,data:i}){if(!iT(t))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(t.crv){case"secp256k1":return yield Pn.verify({key:t,signature:n,data:i});case"P-256":return yield Fn.verify({key:t,signature:n,data:i});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}};var Da=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},hTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let on=class Kf{static bytesToPrivateKey(e){return Da(this,arguments,void 0,function*({privateKeyBytes:t}){const n=Cn.getPublicKey(t),i={crv:"Ed25519",d:Ue.uint8Array(t).toBase64Url(),kty:"OKP",x:Ue.uint8Array(n).toBase64Url()};return i.kid=yield nr({jwk:i}),i})}static bytesToPublicKey(e){return Da(this,arguments,void 0,function*({publicKeyBytes:t}){const n={kty:"OKP",crv:"Ed25519",x:Ue.uint8Array(t).toBase64Url()};return n.kid=yield nr({jwk:n}),n})}static computePublicKey(e){return Da(this,arguments,void 0,function*({key:t}){const n=yield Kf.privateKeyToBytes({privateKey:t}),i=Cn.getPublicKey(n),o={kty:"OKP",crv:"Ed25519",x:Ue.uint8Array(i).toBase64Url()};return o.kid=yield nr({jwk:o}),o})}static convertPrivateKeyToX25519(e){return Da(this,arguments,void 0,function*({privateKey:t}){const n=yield Kf.privateKeyToBytes({privateKey:t}),i=ND(n),o=vs.getPublicKey(i),s={kty:"OKP",crv:"X25519",d:Ue.uint8Array(i).toBase64Url(),x:Ue.uint8Array(o).toBase64Url()};return s.kid=yield nr({jwk:s}),s})}static convertPublicKeyToX25519(e){return Da(this,arguments,void 0,function*({publicKey:t}){const n=yield Kf.publicKeyToBytes({publicKey:t});if(!(yield Kf.validatePublicKey({publicKeyBytes:n})))throw new Error("Ed25519: Invalid public key.");const o=jD(n),s={kty:"OKP",crv:"X25519",x:Ue.uint8Array(o).toBase64Url()};return s.kid=yield nr({jwk:s}),s})}static generateKey(){return Da(this,void 0,void 0,function*(){const e=Cn.utils.randomPrivateKey(),t=yield Kf.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield nr({jwk:t}),t})}static getPublicKey(e){return Da(this,arguments,void 0,function*({key:t}){var n;if(!(Zl(t)&&t.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let i=hTe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield nr({jwk:i})),i})}static privateKeyToBytes(e){return Da(this,arguments,void 0,function*({privateKey:t}){if(!Zl(t))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Da(this,arguments,void 0,function*({publicKey:t}){if(!oT(t))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Ue.base64Url(t.x).toUint8Array()})}static sign(e){return Da(this,arguments,void 0,function*({key:t,data:n}){const i=yield Kf.privateKeyToBytes({privateKey:t});return Cn.sign(n,i)})}static validatePublicKey(e){return Da(this,arguments,void 0,function*({publicKeyBytes:t}){try{Cn.ExtendedPoint.fromHex(t).assertValidity()}catch{return!1}return!0})}static verify(e){return Da(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=yield Kf.publicKeyToBytes({publicKey:t});return Cn.verify(n,i,o)})}};var V0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let r6=class extends bd{computePublicKey(e){return V0(this,arguments,void 0,function*({key:t}){if(!Zl(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(t.crv){case"Ed25519":{const n=yield on.computePublicKey({key:t});return n.alg="EdDSA",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}generateKey(e){return V0(this,arguments,void 0,function*({algorithm:t}){switch(t){case"Ed25519":{const n=yield on.generateKey();return n.alg="EdDSA",n}}})}getPublicKey(e){return V0(this,arguments,void 0,function*({key:t}){if(!Zl(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(t.crv){case"Ed25519":{const n=yield on.getPublicKey({key:t});return n.alg="EdDSA",n}default:throw new Error(`Unsupported curve: ${t.crv}`)}})}sign(e){return V0(this,arguments,void 0,function*({key:t,data:n}){if(!Zl(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(t.crv){case"Ed25519":return yield on.sign({key:t,data:n});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}verify(e){return V0(this,arguments,void 0,function*({key:t,signature:n,data:i}){if(!oT(t))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(t.crv){case"Ed25519":return yield on.verify({key:t,signature:n,data:i});default:throw new Error(`Unsupported curve: ${t.crv}`)}})}};var Bd=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const Tk={Ed25519:{implementation:r6,names:["Ed25519"]},secp256k1:{implementation:nx,names:["ES256K","secp256k1"]},secp256r1:{implementation:nx,names:["ES256","secp256r1"]},"SHA-256":{implementation:e6,names:["SHA-256"]}};let Ms=class{constructor(e){var t;this._algorithmInstances=new Map,this._keyStore=(t=e?.keyStore)!==null&&t!==void 0?t:new nV}digest(e){return Bd(this,arguments,void 0,function*({algorithm:t,data:n}){return yield this.getAlgorithm({algorithm:t}).digest({algorithm:t,data:n})})}exportKey(e){return Bd(this,arguments,void 0,function*({keyUri:t}){return yield this.getPrivateKey({keyUri:t})})}generateKey(e){return Bd(this,arguments,void 0,function*({algorithm:t}){const i=yield this.getAlgorithm({algorithm:t}).generateKey({algorithm:t});if(i?.kid===void 0)throw new Error("Generated key is missing a required property: kid");const o=`${rx}${i.kid}`;return yield this._keyStore.set(o,i),o})}getKeyUri(e){return Bd(this,arguments,void 0,function*({key:t}){const n=yield nr({jwk:t});return`${rx}${n}`})}getPublicKey(e){return Bd(this,arguments,void 0,function*({keyUri:t}){const n=yield this.getPrivateKey({keyUri:t}),i=this.getAlgorithmName({key:n});return yield this.getAlgorithm({algorithm:i}).getPublicKey({key:n})})}importKey(e){return Bd(this,arguments,void 0,function*({key:t}){var n;if(!t6(t))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const i=structuredClone(t);(n=i.kid)!==null&&n!==void 0||(i.kid=yield nr({jwk:i}));const o=yield this.getKeyUri({key:i});return yield this._keyStore.set(o,i),o})}sign(e){return Bd(this,arguments,void 0,function*({keyUri:t,data:n}){const i=yield this.getPrivateKey({keyUri:t}),o=this.getAlgorithmName({key:i});return this.getAlgorithm({algorithm:o}).sign({data:n,key:i})})}verify(e){return Bd(this,arguments,void 0,function*({key:t,signature:n,data:i}){const o=this.getAlgorithmName({key:t});return this.getAlgorithm({algorithm:o}).verify({key:t,signature:n,data:i})})}getAlgorithm({algorithm:e}){var t;const n=(t=Tk[e])===null||t===void 0?void 0:t.implementation;if(!n)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(n)||this._algorithmInstances.set(n,new n),this._algorithmInstances.get(n)}getAlgorithmName({key:e}){const t=e.alg,n=e.crv;for(const i in Tk){const o=Tk[i];if(t&&o.names.includes(t))return i;if(n&&o.names.includes(n))return i}throw new Error(`Unable to determine algorithm based on provided input: alg=${t}, crv=${n}`)}getPrivateKey(e){return Bd(this,arguments,void 0,function*({keyUri:t}){const n=yield this._keyStore.get(t);if(!n)throw new Error(`Key not found: ${t}`);return n})}};function pTe(r){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if(r.alg&&Object.values(e).includes(r.alg))return r.alg;if(r.crv&&Object.keys(e).includes(r.crv))return e[r.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${r.alg}, crv=${r.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}function s5(r){return vO(r)}function yTe(){return Z2.randomUUID()}function mTe({length:r}){if(3>r||r>10)throw new Error("randomPin() can securely generate a PIN between 3 to 10 digits.");const e=Math.pow(10,r)-1;let t;if(r<=6){const n=Math.pow(10,r);do{const i=s5(Math.ceil(r/2));t=new DataView(i.buffer).getUint16(0,!1)%n}while(t>e)}else{const n=Math.pow(10,10);do{const i=s5(4);t=new DataView(i.buffer).getUint32(0,!1)%n}while(t>e)}return t.toString().padStart(r,"0")}const wo={randomPin:mTe,randomUuid:yTe,randomBytes:s5,getJoseSignatureAlgorithmFromPublicKey:pTe};var W0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},gTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const T2=96,bN=[128,192,256],$2=[96,104,112,120,128];class th{static bytesToPrivateKey(e){return W0(this,arguments,void 0,function*({privateKeyBytes:t}){const n={k:Ue.uint8Array(t).toBase64Url(),kty:"oct"};return n.kid=yield nr({jwk:n}),n})}static decrypt(e){return W0(this,arguments,void 0,function*({key:t,data:n,iv:i,additionalData:o,tagLength:s}){if(i.byteLength!==T2/8)throw new TypeError(`The initialization vector must be ${T2} bits in length`);if(s&&!$2.includes(s))throw new RangeError(`The tag length is invalid: Must be ${$2.join(", ")} bits`);const a=vu(),l=yield a.importKey("jwk",t,{name:"AES-GCM"},!0,["decrypt"]),d=Object.assign(Object.assign({name:"AES-GCM",iv:i},s&&{tagLength:s}),o&&{additionalData:o}),c=yield a.decrypt(d,l,n);return new Uint8Array(c)})}static encrypt(e){return W0(this,arguments,void 0,function*({data:t,iv:n,key:i,additionalData:o,tagLength:s}){if(n.byteLength!==T2/8)throw new TypeError(`The initialization vector must be ${T2} bits in length`);if(s&&!$2.includes(s))throw new RangeError(`The tag length is invalid: Must be ${$2.join(", ")} bits`);const a=vu(),l=yield a.importKey("jwk",i,{name:"AES-GCM"},!0,["encrypt"]),d=Object.assign(Object.assign({name:"AES-GCM",iv:n},s&&{tagLength:s}),o&&{additionalData:o}),c=yield a.encrypt(d,l,t);return new Uint8Array(c)})}static generateKey(e){return W0(this,arguments,void 0,function*({length:t}){if(!bN.includes(t))throw new RangeError(`The key length is invalid: Must be ${bN.join(", ")} bits`);const n=vu(),i=yield n.generateKey({name:"AES-GCM",length:t},!0,["encrypt"]),o=yield n.exportKey("jwk",i),s=gTe(o,["ext","key_ops"]);return s.kid=yield nr({jwk:s}),s})}static privateKeyToBytes(e){return W0(this,arguments,void 0,function*({privateKey:t}){if(!rH(t))throw new Error("AesGcm: The provided key is not a valid oct private key.");return Ue.base64Url(t.k).toUint8Array()})}}var $k=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let vTe=class extends bd{decrypt(e){return $k(this,void 0,void 0,function*(){return th.decrypt(e)})}encrypt(e){return $k(this,void 0,void 0,function*(){return th.encrypt(e)})}generateKey(e){return $k(this,arguments,void 0,function*({algorithm:t}){const n={A128GCM:128,A192GCM:192,A256GCM:256}[t],i=yield th.generateKey({length:n});return i.alg=t,i})}};var Pf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},bTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};let n6=class Pb{static bytesToPrivateKey(e){return Pf(this,arguments,void 0,function*({privateKeyBytes:t}){const n=vs.getPublicKey(t),i={kty:"OKP",crv:"X25519",d:Ue.uint8Array(t).toBase64Url(),x:Ue.uint8Array(n).toBase64Url()};return i.kid=yield nr({jwk:i}),i})}static bytesToPublicKey(e){return Pf(this,arguments,void 0,function*({publicKeyBytes:t}){const n={kty:"OKP",crv:"X25519",x:Ue.uint8Array(t).toBase64Url()};return n.kid=yield nr({jwk:n}),n})}static computePublicKey(e){return Pf(this,arguments,void 0,function*({key:t}){const n=yield Pb.privateKeyToBytes({privateKey:t}),i=vs.getPublicKey(n),o={kty:"OKP",crv:"X25519",x:Ue.uint8Array(i).toBase64Url()};return o.kid=yield nr({jwk:o}),o})}static generateKey(){return Pf(this,void 0,void 0,function*(){const e=vs.utils.randomPrivateKey(),t=yield Pb.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield nr({jwk:t}),t})}static getPublicKey(e){return Pf(this,arguments,void 0,function*({key:t}){var n;if(!(Zl(t)&&t.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let i=bTe(t,["d"]);return(n=i.kid)!==null&&n!==void 0||(i.kid=yield nr({jwk:i})),i})}static privateKeyToBytes(e){return Pf(this,arguments,void 0,function*({privateKey:t}){if(!Zl(t))throw new Error("X25519: The provided key is not a valid OKP private key.");return Ue.base64Url(t.d).toUint8Array()})}static publicKeyToBytes(e){return Pf(this,arguments,void 0,function*({publicKey:t}){if(!oT(t))throw new Error("X25519: The provided key is not a valid OKP public key.");return Ue.base64Url(t.x).toUint8Array()})}static sharedSecret(e){return Pf(this,arguments,void 0,function*({privateKeyA:t,publicKeyB:n}){if("x"in t&&"x"in n&&t.x===n.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const i=yield Pb.privateKeyToBytes({privateKey:t}),o=yield Pb.publicKeyToBytes({publicKey:n});return vs.getSharedSecret(i,o)})}};function zc(r){if(typeof r=="string"&&r.length!==0)return r.split("#").pop()}function nH({didDocument:r}){var e,t;if(!r)throw new TypeError("Required parameter missing: 'didDocument'");const n=[];return n.push(...(t=(e=r.verificationMethod)===null||e===void 0?void 0:e.filter(a5))!==null&&t!==void 0?t:[]),Object.keys(Jw).forEach(i=>{var o,s;n.push(...(s=(o=r[i])===null||o===void 0?void 0:o.filter(a5))!==null&&s!==void 0?s:[])}),n}function wTe({didDocument:r}){const t=nH({didDocument:r}).map(n=>n.type);return[...new Set(t)]}function _Te({didDocument:r,methodId:e}){const t=[];return Object.keys(Jw).forEach(n=>{if(Array.isArray(r[n])){const i=r[n],o=zc(e);i.some(a=>{const l=zc(a)===o,d=a5(a)&&zc(a.id)===o;return l||d})&&t.push(n)}}),t}function ETe(r){return!r||typeof r!="object"||r===null?!1:"id"in r&&"type"in r&&"serviceEndpoint"in r}function ATe(r){if(!ETe(r)||r.type!=="DecentralizedWebNode"||!("enc"in r&&"sig"in r))return!1;const e=t=>typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string");return e(r.enc)&&e(r.sig)}function a5(r){return!(!r||typeof r!="object"||r===null||!("id"in r&&"type"in r&&"controller"in r)||typeof r.id!="string"||typeof r.type!="string"||typeof r.controller!="string")}function iH({keyBytes:r,multicodecCode:e,multicodecName:t}){const n=zr.addPrefix({code:e,data:r,name:t}),i=ge.uint8Array(n).toBase58Btc();return ge.base58Btc(i).toMultibase()}function wN({multibaseKeyId:r}){try{const e=ge.multibase(r).toBase58Btc(),t=ge.base58Btc(e).toUint8Array(),{code:n,data:i,name:o}=zr.removePrefix({prefixedData:t});return{keyBytes:i,multicodecCode:n,multicodecName:o}}catch{throw new mt(st.InvalidDid,`Invalid multibase identifier: ${r}`)}}var H0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let Zc=class oH{constructor({uri:e,document:t,metadata:n,keyManager:i}){this.uri=e,this.document=t,this.metadata=n,this.keyManager=i}export(){return H0(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const t=[];for(let n of this.document.verificationMethod){if(!n.publicKeyJwk)throw new Error(`Verification method '${n.id}' does not contain a public key in JWK format`);const i=yield this.keyManager.getKeyUri({key:n.publicKeyJwk}),o=yield this.keyManager.exportKey({keyUri:i});t.push(Object.assign({},o))}e.privateKeys=t}return e})}getSigner(e){return H0(this,void 0,void 0,function*(){var t;const n=(t=this.document.verificationMethod)===null||t===void 0?void 0:t.find(l=>{var d,c;return zc(l.id)===((d=zc(e?.methodId))!==null&&d!==void 0?d:zc((c=this.document.assertionMethod)===null||c===void 0?void 0:c[0]))});if(!(n&&n.publicKeyJwk))throw new mt(st.InternalError,"A verification method intended for signing could not be determined from the DID Document");const i=yield this.keyManager.getKeyUri({key:n.publicKeyJwk}),o=yield this.keyManager.getPublicKey({keyUri:i}),s=this.keyManager;return{algorithm:wo.getJoseSignatureAlgorithmFromPublicKey(o),keyId:n.id,sign(l){return H0(this,arguments,void 0,function*({data:d}){return yield s.sign({data:d,keyUri:i})})},verify(l){return H0(this,arguments,void 0,function*({data:d,signature:c}){return yield s.verify({data:d,key:o,signature:c})})}}})}static import(e){return H0(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ms}){var i;const o=nH({didDocument:t.document});if(o.length===0)throw new mt(st.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let a of(i=t.privateKeys)!==null&&i!==void 0?i:[])yield n.importKey({key:a});for(let a of o){if(!a.publicKeyJwk)throw new Error(`Verification method '${a.id}' does not contain a public key in JWK format`);const l=yield n.getKeyUri({key:a.publicKeyJwk});yield n.getPublicKey({keyUri:l})}return new oH({uri:t.uri,document:t.document,metadata:t.metadata,keyManager:n})})}};var _N=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let c1=class{static getSigningMethod(e){return _N(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,t){return _N(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}};var Si=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},EN=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const AN="https://diddht.tbddev.org",xTe=0,If=7200,IE=";",ts=",";var c5;(function(r){r[r.Discoverable=0]="Discoverable",r[r.Organization=1]="Organization",r[r.Government=2]="Government",r[r.Corporation=3]="Corporation",r[r.LocalBusiness=4]="LocalBusiness",r[r.SoftwarePackage=5]="SoftwarePackage",r[r.WebApp=6]="WebApp",r[r.FinancialInstitution=7]="FinancialInstitution"})(c5||(c5={}));var ds;(function(r){r[r.Ed25519=0]="Ed25519",r[r.secp256k1=1]="secp256k1",r[r.secp256r1=2]="secp256r1",r[r.X25519=3]="X25519"})(ds||(ds={}));var l5;(function(r){r.authentication="auth",r.assertionMethod="asm",r.capabilityDelegation="del",r.capabilityInvocation="inv",r.keyAgreement="agm"})(l5||(l5={}));const sH={Ed25519:ds.Ed25519,ES256K:ds.secp256k1,ES256:ds.secp256r1,"P-256":ds.secp256r1,secp256k1:ds.secp256k1,secp256r1:ds.secp256r1,X25519:ds.X25519},xN={[ds.Ed25519]:"EdDSA",[ds.secp256k1]:"ES256K",[ds.secp256r1]:"ES256",[ds.X25519]:"ECDH-ES+A256KW"};let Xw=class d5 extends c1{static create(){return Si(this,arguments,void 0,function*({keyManager:e=new Ms,options:t={}}={}){var n,i,o,s,a,l,d,c,u,f,h;if(!((n=t.verificationMethods)===null||n===void 0)&&n.some(_=>!(_.algorithm in sH)))throw new Error("One or more verification method algorithms are not supported");const p=(i=t.verificationMethods)===null||i===void 0?void 0:i.filter(_=>"id"in _).map(_=>_.id);if(p&&p.length!==new Set(p).size)throw new Error("One or more verification method IDs are not unique");if(!((o=t.services)===null||o===void 0)&&o.some(_=>!_.id||!_.type||!_.serviceEndpoint))throw new Error("One or more services are missing required properties");const y=yield e.generateKey({algorithm:"Ed25519"}),g=yield e.getPublicKey({keyUri:y}),w=yield jo.identityKeyToIdentifier({identityKey:g}),v=Object.assign(Object.assign({id:w},t.alsoKnownAs&&{alsoKnownAs:t.alsoKnownAs}),t.controllers&&{controller:t.controllers}),m=[...(s=t.verificationMethods)!==null&&s!==void 0?s:[]];m?.some(_=>{var E;return((E=_.id)===null||E===void 0?void 0:E.split("#").pop())==="0"})||m.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const _ of m){const E=_.id&&_.id.split("#").pop()==="0"?y:yield e.generateKey({algorithm:_.algorithm}),S=yield e.getPublicKey({keyUri:E});let T=(l=(a=_.id)!==null&&a!==void 0?a:S.kid)!==null&&l!==void 0?l:yield nr({jwk:S});T=`${w}#${zc(T)}`,(d=v.verificationMethod)!==null&&d!==void 0||(v.verificationMethod=[]),v.verificationMethod.push({id:T,type:"JsonWebKey",controller:(c=_.controller)!==null&&c!==void 0?c:w,publicKeyJwk:S});for(const O of(u=_.purposes)!==null&&u!==void 0?u:[])v[O]||(v[O]=[]),v[O].push(T)}(f=t.services)===null||f===void 0||f.forEach(_=>{var E;(E=v.service)!==null&&E!==void 0||(v.service=[]),_.id=`${w}#${_.id.split("#").pop()}`,v.service.push(_)});const b=new Zc({uri:w,document:v,metadata:Object.assign({published:!1},t.types&&{types:t.types}),keyManager:e});if(!((h=t.publish)!==null&&h!==void 0)||h){const _=yield d5.publish({did:b,gatewayUri:t.gatewayUri});b.metadata=_.didDocumentMetadata}return b})}static import(e){return Si(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ms}){var i;const o=Er.parse(t.uri);if(o?.method!==d5.methodName)throw new mt(st.MethodNotSupported,"Method not supported");const s=yield Zc.import({portableDid:t,keyManager:n});if(!(!((i=s.document.verificationMethod)===null||i===void 0)&&i.some(a=>{var l;return((l=a.id)===null||l===void 0?void 0:l.split("#").pop())==="0"})))throw new mt(st.InvalidDidDocument,"DID document must contain an Identity Key");return s})}static getSigningMethod(e){return Si(this,arguments,void 0,function*({didDocument:t,methodId:n="#0"}){var i;const o=Er.parse(t.id);if(o&&o.method!==this.methodName)throw new mt(st.MethodNotSupported,`Method not supported: ${o.method}`);const s=(i=t.verificationMethod)===null||i===void 0?void 0:i.find(a=>{var l,d;return zc(a.id)===((l=zc(n))!==null&&l!==void 0?l:zc((d=t.assertionMethod)===null||d===void 0?void 0:d[0]))});if(!(s&&s.publicKeyJwk))throw new mt(st.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static publish(e){return Si(this,arguments,void 0,function*({did:t,gatewayUri:n=AN}){return yield SN.put({did:t,gatewayUri:n})})}static resolve(e){return Si(this,arguments,void 0,function*(t,n={}){var i;const o=(i=n?.gatewayUri)!==null&&i!==void 0?i:AN;try{yield jo.identifierToIdentityKey({didUri:t});const{didDocument:s,didDocumentMetadata:a}=yield SN.get({didUri:t,gatewayUri:o});return Object.assign(Object.assign({},go),{didDocument:s,didDocumentMetadata:a})}catch(s){if(!(s instanceof mt))throw new Error(s);return Object.assign(Object.assign({},go),{didResolutionMetadata:Object.assign({error:s.code},s.message&&{errorMessage:s.message})})}})}};Xw.methodName="dht";let SN=class Ep{static get(e){return Si(this,arguments,void 0,function*({didUri:t,gatewayUri:n}){const i=jo.identifierToIdentityKeyBytes({didUri:t}),o=yield Ep.pkarrGet({gatewayUri:n,publicKeyBytes:i}),s=yield jo.parseBep44GetMessage({bep44Message:o}),a=yield Ep.fromDnsPacket({didUri:t,dnsPacket:s});return a.didDocumentMetadata.versionId=o.seq.toString(),a})}static put(e){return Si(this,arguments,void 0,function*({did:t,gatewayUri:n}){const i=yield Ep.toDnsPacket({didDocument:t.document,didMetadata:t.metadata,authoritativeGatewayUris:[n]}),o=yield jo.createBep44PutMessage({dnsPacket:i,publicKeyBytes:jo.identifierToIdentityKeyBytes({didUri:t.uri}),signer:yield t.getSigner({methodId:"0"})}),s=yield Ep.pkarrPut({gatewayUri:n,bep44Message:o});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:s,versionId:o.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return Si(this,arguments,void 0,function*({gatewayUri:t,publicKeyBytes:n}){const i=ge.uint8Array(n).toBase32Z(),o=new URL(i,t).href;let s;try{if(s=yield fetch(o,{method:"GET"}),!s.ok)throw new mt(st.NotFound,`Pkarr record not found for: ${i}`)}catch(d){throw d instanceof mt?d:new mt(st.InternalError,`Failed to fetch Pkarr record: ${d.message}`)}const a=yield s.arrayBuffer();if(!a)throw new mt(st.NotFound,`Pkarr record not found for: ${i}`);if(a.byteLength<72)throw new mt(st.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${a.byteLength}`);if(a.byteLength>1072)throw new mt(st.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${a.byteLength}`);return{k:n,seq:Number(new DataView(a).getBigUint64(64)),sig:new Uint8Array(a,0,64),v:new Uint8Array(a,72)}})}static pkarrPut(e){return Si(this,arguments,void 0,function*({gatewayUri:t,bep44Message:n}){const i=ge.uint8Array(n.k).toBase32Z(),o=new URL(i,t).href,s=new Uint8Array(n.v.length+72);s.set(n.sig,0),new DataView(s.buffer).setBigUint64(n.sig.length,BigInt(n.seq)),s.set(n.v,n.sig.length+8);let a;try{a=yield fetch(o,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:s})}catch(l){throw new mt(st.InternalError,`Failed to put Pkarr record for identifier ${i}: ${l.message}`)}return a.ok})}static fromDnsPacket(e){return Si(this,arguments,void 0,function*({didUri:t,dnsPacket:n}){var i,o,s;const a={id:t},l={published:!0},d=new Map;for(const c of(i=n?.answers)!==null&&i!==void 0?i:[]){if(c.type!=="TXT")continue;const u=c.name.split(".")[0].substring(1);switch(!0){case u.startsWith("aka"):{const f=jo.parseTxtDataToString(c.data);a.alsoKnownAs=f.split(ts);break}case u.startsWith("cnt"):{const f=jo.parseTxtDataToString(c.data);a.controller=f.includes(ts)?f.split(ts):f;break}case u.startsWith("k"):{const{id:f,t:h,k:p,c:y,a:g}=jo.parseTxtDataToObject(c.data),w=ge.base64Url(p).toUint8Array(),v=ds[Number(h)];let m=yield jo.keyConverter(v).bytesToPublicKey({publicKeyBytes:w});m.alg=g||xN[Number(h)];const b=u==="k0"?"0":f!==void 0?f:yield nr({jwk:m});(o=a.verificationMethod)!==null&&o!==void 0||(a.verificationMethod=[]);const _=`${t}#${b}`;a.verificationMethod.push({id:_,type:"JsonWebKey",controller:y??t,publicKeyJwk:m}),d.set(u,_);break}case u.startsWith("s"):{const f=jo.parseTxtDataToObject(c.data),{id:h,t:p,se:y}=f,g=EN(f,["id","t","se"]),w=y.includes(ts)?y.split(ts):[y],v=Object.fromEntries(Object.entries(g).map(([m,b])=>[m,b.includes(ts)?b.split(ts):b]));(s=a.service)!==null&&s!==void 0||(a.service=[]),a.service.push(Object.assign(Object.assign({},v),{id:`${t}#${h}`,type:p,serviceEndpoint:w}));break}case u.startsWith("typ"):{const{id:f}=jo.parseTxtDataToObject(c.data);l.types=f.split(ts).map(h=>Number(h));break}case u.startsWith("did"):{const f=v=>v.split(ts).map(m=>d.get(m)).filter(m=>typeof m=="string"),{auth:h,asm:p,del:y,inv:g,agm:w}=jo.parseTxtDataToObject(c.data);h&&(a.authentication=f(h)),p&&(a.assertionMethod=f(p)),y&&(a.capabilityDelegation=f(y)),g&&(a.capabilityInvocation=f(g)),w&&(a.keyAgreement=f(w));break}}}return{didDocument:a,didDocumentMetadata:l,didResolutionMetadata:{}}})}static toDnsPacket(e){return Si(this,arguments,void 0,function*({didDocument:t,didMetadata:n,authoritativeGatewayUris:i,previousDidProof:o}){var s,a,l,d,c;const u=[],f=[],h=new Map,p=[],y=[];if(o!==void 0){const{signature:v,previousDid:m}=o;yield jo.validatePreviousDidProof({newDid:t.id,previousDidProof:o}),u.push({type:"TXT",name:"_prv._did.",ttl:If,data:`id=${m};s=${v}`})}if(t.alsoKnownAs&&u.push({type:"TXT",name:"_aka._did.",ttl:If,data:t.alsoKnownAs.join(ts)}),t.controller){const v=Array.isArray(t.controller)?t.controller.join(ts):t.controller;u.push({type:"TXT",name:"_cnt._did.",ttl:If,data:v})}for(const[v,m]of(a=(s=t.verificationMethod)===null||s===void 0?void 0:s.entries())!==null&&a!==void 0?a:[]){const b=`k${v}`;y.push(b);let _=m.id.split("#").pop();h.set(_,b);const E=m.publicKeyJwk;if(!(E?.crv&&E.crv in sH))throw new mt(st.InvalidPublicKeyType,`Verification method '${m.id}' contains an unsupported key type: ${(l=E?.crv)!==null&&l!==void 0?l:"undefined"}`);const S=ds[E.crv],T=yield jo.keyConverter(E.crv).publicKeyToBytes({publicKey:E}),O=ge.uint8Array(T).toBase64Url(),M=[`t=${S}`,`k=${O}`];_!=="0"&&(yield nr({jwk:E}))!==_&&M.unshift(`id=${_}`),E.alg!==xN[S]&&M.push(`a=${E.alg}`),m.controller!==t.id&&M.push(`c=${m.controller}`),u.push({type:"TXT",name:`_${b}._did.`,ttl:If,data:M.join(IE)})}(d=t.service)===null||d===void 0||d.forEach((v,m)=>{const b=`s${m}`;p.push(b);let{id:_,type:E,serviceEndpoint:S}=v,T=EN(v,["id","type","serviceEndpoint"]);_=zc(_),S=Array.isArray(S)?S.join(","):S;const M=Object.entries(Object.assign({id:_,t:E,se:S},T)).map(([W,U])=>`${W}=${U}`).join(IE),Q=jo.chunkDataIfNeeded(M);u.push({type:"TXT",name:`_${b}._did.`,ttl:If,data:Q})});const g=[`v=${xTe}`];if(y.length&&g.push(`vm=${y.join(ts)}`),Object.keys(Jw).forEach(v=>{var m;const b=(m=t[v])===null||m===void 0?void 0:m.map(_=>h.get(_.split("#").pop()));if(b){const _=l5[v];g.push(`${_}=${b.join(ts)}`)}}),p.length&&g.push(`svc=${p.join(ts)}`),!((c=n.types)===null||c===void 0)&&c.length){const m=n.types.map(b=>typeof b=="string"?c5[b]:b);u.push({type:"TXT",name:"_typ._did.",ttl:If,data:`id=${m.join(ts)}`})}u.push({type:"TXT",name:"_did."+Ep.getUniqueDidSuffix(t.id)+".",ttl:If,data:g.join(IE)});for(const v of i||[])f.push({type:"NS",name:"_did."+Ep.getUniqueDidSuffix(t.id)+".",ttl:If,data:v+"."});return{id:0,type:"response",flags:qD,answers:[...u,...f]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}},jo=class OE{static createBep44PutMessage(e){return Si(this,arguments,void 0,function*({dnsPacket:t,publicKeyBytes:n,signer:i}){const o=Math.ceil(Date.now()/1e3),s=Zw(t),a=av.encode({seq:o,v:s}).subarray(1,-1);if(a.length>1e3)throw new mt(st.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${a.length} bytes`);const l=yield i.sign({data:a});return{k:n,seq:o,sig:l,v:s}})}static identifierToIdentityKey(e){return Si(this,arguments,void 0,function*({didUri:t}){let n=OE.identifierToIdentityKeyBytes({didUri:t});return yield on.bytesToPublicKey({publicKeyBytes:n})})}static identifierToIdentityKeyBytes({didUri:e}){const t=Er.parse(e);if(!t)throw new mt(st.InvalidDid,`Invalid DID URI: ${e}`);if(t.method!==Xw.methodName)throw new mt(st.MethodNotSupported,`Method not supported: ${t.method}`);let n;try{n=ge.base32Z(t.id).toUint8Array()}catch{throw new mt(st.InvalidPublicKey,"Failed to decode method-specific identifier")}if(n.length!==32)throw new mt(st.InvalidPublicKeyLength,`Invalid public key length: ${n.length}`);return n}static identityKeyToIdentifier(e){return Si(this,arguments,void 0,function*({identityKey:t}){const n=yield on.publicKeyToBytes({publicKey:t}),i=ge.uint8Array(n).toBase32Z();return`did:${Xw.methodName}:${i}`})}static keyConverter(e){const n={Ed25519:on,"P-256":{publicKeyToBytes:i=>Si(this,[i],void 0,function*({publicKey:o}){const s=yield Fn.publicKeyToBytes({publicKey:o});return yield Fn.compressPublicKey({publicKeyBytes:s})}),bytesToPublicKey:Fn.bytesToPublicKey,privateKeyToBytes:Fn.privateKeyToBytes,bytesToPrivateKey:Fn.bytesToPrivateKey},secp256k1:{publicKeyToBytes:i=>Si(this,[i],void 0,function*({publicKey:o}){const s=yield Pn.publicKeyToBytes({publicKey:o});return yield Pn.compressPublicKey({publicKeyBytes:s})}),bytesToPublicKey:Pn.bytesToPublicKey,privateKeyToBytes:Pn.privateKeyToBytes,bytesToPrivateKey:Pn.bytesToPrivateKey},X25519:n6}[e];if(!n)throw new mt(st.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static parseBep44GetMessage(e){return Si(this,arguments,void 0,function*({bep44Message:t}){const n=yield on.bytesToPublicKey({publicKeyBytes:t.k}),i=av.encode({seq:t.seq,v:t.v}).subarray(1,-1);if(!(yield on.verify({key:n,signature:t.sig,data:i})))throw new mt(st.InvalidSignature,"Invalid signature for DHT BEP44 message");return VD(t.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(IE).reduce((t,n)=>{const[i,o]=n.split("=");return t[i]=o,t},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return ge.uint8Array(e).toString();if(Array.isArray(e))return e.map(t=>this.parseTxtDataToString(t)).join("");throw new mt(st.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return Si(this,arguments,void 0,function*({newDid:t,previousDidProof:n}){const i=yield OE.identifierToIdentityKey({didUri:n.previousDid}),o=OE.identifierToIdentityKeyBytes({didUri:t}),s=ge.base64Url(n.signature).toUint8Array();if(!(yield on.verify({key:i,data:o,signature:s})))throw new mt(st.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const t=[];for(let n=0;n<e.length;n+=255)t.push(e.slice(n,n+255));return t}};var rh=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Ol;(function(r){r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.secp256r1="secp256r1",r.X25519="X25519"})(Ol||(Ol={}));const STe={Ed25519:Ol.Ed25519,ES256K:Ol.secp256k1,ES256:Ol.secp256r1,"P-256":Ol.secp256r1,secp256k1:Ol.secp256k1,secp256r1:Ol.secp256r1},TN="https://ion.tbd.engineering";let TTe=class Ib extends c1{static create(){return rh(this,arguments,void 0,function*({keyManager:e=new Ms,options:t={}}={}){var n,i,o,s,a,l,d;if(!((n=t.verificationMethods)===null||n===void 0)&&n.some(_=>!(_.algorithm in STe)))throw new Error("One or more verification method algorithms are not supported");const c=(i=t.verificationMethods)===null||i===void 0?void 0:i.filter(_=>"id"in _).map(_=>_.id);if(c&&c.length!==new Set(c).size)throw new Error("One or more verification method IDs are not unique");if(!((o=t.services)===null||o===void 0)&&o.some(_=>!_.id||!_.type||!_.serviceEndpoint))throw new Error("One or more services are missing required properties");const u={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},f=[];for(const _ of(s=t.verificationMethods)!==null&&s!==void 0?s:[u]){const E=yield e.generateKey({algorithm:_.algorithm}),S=yield e.getPublicKey({keyUri:E});f.push({id:_.id,publicKeyJwk:S,purposes:(a=_.purposes)!==null&&a!==void 0?a:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const h=yield e.generateKey({algorithm:Ol.secp256k1}),p=yield e.getPublicKey({keyUri:h}),y=yield e.generateKey({algorithm:Ol.secp256k1}),g=yield e.getPublicKey({keyUri:y}),w=yield G0.computeLongFormDidUri({recoveryKey:p,updateKey:g,services:(l=t.services)!==null&&l!==void 0?l:[],verificationMethods:f}),{didDocument:v,didResolutionMetadata:m}=yield Ib.resolve(w,{gatewayUri:t.gatewayUri});if(v===null)throw new Error(`Unable to resolve DID during creation: ${m?.error}`);const b=new Zc({uri:w,document:v,metadata:{published:!1,canonicalId:w.split(":",3).join(":"),recoveryKey:p,updateKey:g},keyManager:e});if(!((d=t.publish)!==null&&d!==void 0)||d){const _=yield Ib.publish({did:b,gatewayUri:t.gatewayUri});b.metadata=_.didDocumentMetadata}return b})}static getSigningMethod(e){return rh(this,arguments,void 0,function*({didDocument:t,methodId:n}){var i;const o=Er.parse(t.id);if(o&&o.method!==this.methodName)throw new mt(st.MethodNotSupported,`Method not supported: ${o.method}`);const s=(i=t.verificationMethod)===null||i===void 0?void 0:i.find(a=>{var l;return a.id===(n??((l=t.assertionMethod)===null||l===void 0?void 0:l[0]))});if(!(s&&s.publicKeyJwk))throw new mt(st.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static import(e){return rh(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ms}){const i=Er.parse(t.uri);if(i?.method!==Ib.methodName)throw new mt(st.MethodNotSupported,"Method not supported");return yield Zc.import({portableDid:t,keyManager:n})})}static publish(e){return rh(this,arguments,void 0,function*({did:t,gatewayUri:n=TN}){var i,o,s;const a=(o=(i=t.document.verificationMethod)===null||i===void 0?void 0:i.map(c=>({id:c.id,publicKeyJwk:c.publicKeyJwk,purposes:_Te({didDocument:t.document,methodId:c.id})})))!==null&&o!==void 0?o:[],l=yield G0.createIonDocument({services:(s=t.document.service)!==null&&s!==void 0?s:[],verificationMethods:a}),d=yield G0.constructCreateRequest({ionDocument:l,recoveryKey:t.metadata.recoveryKey,updateKey:t.metadata.updateKey});try{const c=G0.appendPathToUrl({baseUrl:n,path:"/operations"}),u=yield fetch(c,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:u.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:st.InternalError,errorMessage:`Failed to publish DID document for: ${t.uri}`}}}})}static resolve(e){return rh(this,arguments,void 0,function*(t,n={}){var i,o;const s=Er.parse(t);if(!s)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"invalidDid"}});if(s.method!==Ib.methodName)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"methodNotSupported"}});const a=(i=n?.gatewayUri)!==null&&i!==void 0?i:TN;try{const l=G0.appendPathToUrl({baseUrl:a,path:`/identifiers/${t}`}),d=yield fetch(l);if(!d.ok)throw new mt(st.NotFound,`Unable to find DID document for: ${t}`);const{didDocument:c,didDocumentMetadata:u}=yield d.json();return Object.assign(Object.assign(Object.assign({},go),c&&{didDocument:c}),{didDocumentMetadata:Object.assign({published:(o=u?.method)===null||o===void 0?void 0:o.published},u)})}catch(l){if(!(l instanceof mt))throw new Error(l);return Object.assign(Object.assign({},go),{didResolutionMetadata:Object.assign({error:l.code},l.message&&{errorMessage:l.message})})}})}};TTe.methodName="ion";let G0=class Ap{static appendPathToUrl({baseUrl:e,path:t}){const n=new URL(e);return n.pathname=n.pathname.endsWith("/")?n.pathname:n.pathname+"/",n.pathname+=t.startsWith("/")?t.substring(1):t,n.toString()}static computeLongFormDidUri(e){return rh(this,arguments,void 0,function*({recoveryKey:t,updateKey:n,services:i,verificationMethods:o}){const s=yield Ap.createIonDocument({services:i,verificationMethods:o}),a=Ap.normalizeJwk(t),l=Ap.normalizeJwk(n);return yield a1.createLongFormDid({document:s,recoveryKey:a,updateKey:l})})}static constructCreateRequest(e){return rh(this,arguments,void 0,function*({ionDocument:t,recoveryKey:n,updateKey:i}){return yield Uo.createCreateRequest({document:t,recoveryKey:Ap.normalizeJwk(n),updateKey:Ap.normalizeJwk(i)})})}static createIonDocument(e){return rh(this,arguments,void 0,function*({services:t,verificationMethods:n}){var i,o;const s=[];for(const d of n){let c=(o=(i=d.id)!==null&&i!==void 0?i:d.publicKeyJwk.kid)!==null&&o!==void 0?o:yield nr({jwk:d.publicKeyJwk});c=`${c.split("#").pop()}`;const u={id:c,publicKeyJwk:Ap.normalizeJwk(d.publicKeyJwk),purposes:d.purposes,type:"JsonWebKey2020"};s.push(u)}const a=t.map(d=>Object.assign(Object.assign({},d),{id:`${d.id.split("#").pop()}`}));return{publicKeys:s,services:a}})}static normalizeJwk(e){const t=e.kty;let n;if(t==="EC")n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(t==="oct")n={k:e.k,kty:e.kty};else if(t==="OKP")n={crv:e.crv,kty:e.kty,x:e.x};else if(t==="RSA")n={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${t}`);return n}};var k2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let Wy=class Ob extends c1{static create(){return k2(this,arguments,void 0,function*({keyManager:e=new Ms,options:t={}}={}){var n,i,o,s;if(t.algorithm&&t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(t.verificationMethods&&t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const a=(s=(n=t.algorithm)!==null&&n!==void 0?n:(o=(i=t.verificationMethods)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.algorithm)!==null&&s!==void 0?s:"Ed25519",l=yield e.generateKey({algorithm:a}),d=yield e.getPublicKey({keyUri:l}),c=ge.object(d).toBase64Url(),u=`did:${Ob.methodName}:${c}`,h=(yield Ob.resolve(u)).didDocument;return new Zc({uri:u,document:h,metadata:{},keyManager:e})})}static getSigningMethod(e){return k2(this,arguments,void 0,function*({didDocument:t}){var n;const i=Er.parse(t.id);if(i&&i.method!==this.methodName)throw new mt(st.MethodNotSupported,`Method not supported: ${i.method}`);const[o]=(n=t.verificationMethod)!==null&&n!==void 0?n:[];if(!(o&&o.publicKeyJwk))throw new mt(st.InternalError,"A verification method intended for signing could not be determined from the DID Document");return o})}static import(e){return k2(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ms}){const i=Er.parse(t.uri);if(i?.method!==Ob.methodName)throw new mt(st.MethodNotSupported,"Method not supported");const o=yield Zc.import({portableDid:t,keyManager:n});if(o.document.verificationMethod.length!==1)throw new mt(st.InvalidDidDocument,"DID document must contain exactly one verification method");return o})}static resolve(e,t){return k2(this,void 0,void 0,function*(){const n=Er.parse(e);let i;try{i=ge.base64Url(n.id).toObject()}catch{}if(!n||!i)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"invalidDid"}});if(n.method!==Ob.methodName)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"methodNotSupported"}});const o={"@context":["https://www.w3.org/ns/did/v1"],id:n.uri},s=`${o.id}#0`;switch(o.verificationMethod=[{id:s,type:"JsonWebKey",controller:o.id,publicKeyJwk:i}],o.authentication=[s],o.assertionMethod=[s],o.capabilityInvocation=[s],o.capabilityDelegation=[s],o.keyAgreement=[s],i.use){case"sig":{delete o.keyAgreement;break}case"enc":{delete o.authentication,delete o.assertionMethod,delete o.capabilityInvocation,delete o.capabilityDelegation;break}}return Object.assign(Object.assign({},go),{didDocument:o})})}};Wy.methodName="jwk";var Cc=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Yd;(function(r){r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.secp256r1="secp256r1",r.X25519="X25519"})(Yd||(Yd={}));const kk={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},$Te={Ed25519:Yd.Ed25519,ES256K:Yd.secp256k1,ES256:Yd.secp256r1,"P-256":Yd.secp256r1,secp256k1:Yd.secp256k1,secp256r1:Yd.secp256r1,X25519:Yd.X25519};let kTe=class Wd extends c1{static create(){return Cc(this,arguments,void 0,function*({keyManager:e=new Ms,options:t={}}={}){var n,i,o,s;if(t.algorithm&&t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(t.verificationMethods&&t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const a=(s=(n=t.algorithm)!==null&&n!==void 0?n:(o=(i=t.verificationMethods)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.algorithm)!==null&&s!==void 0?s:"Ed25519",l=yield e.generateKey({algorithm:a}),d=yield e.getPublicKey({keyUri:l}),c=yield qa.publicKeyToMultibaseId({publicKey:d}),u=`did:${Wd.methodName}:${c}`,h=(yield Wd.resolve(u,t)).didDocument;return new Zc({uri:u,document:h,metadata:{},keyManager:e})})}static getSigningMethod(e){return Cc(this,arguments,void 0,function*({didDocument:t}){var n;const i=Er.parse(t.id);if(i&&i.method!==this.methodName)throw new mt(st.MethodNotSupported,`Method not supported: ${i.method}`);const[o]=t.assertionMethod||[],s=(n=t.verificationMethod)===null||n===void 0?void 0:n.find(a=>a.id===o);if(!(s&&s.publicKeyJwk))throw new mt(st.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static import(e){return Cc(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ms}){const i=Er.parse(t.uri);if(i?.method!==Wd.methodName)throw new mt(st.MethodNotSupported,"Method not supported");const o=yield Zc.import({portableDid:t,keyManager:n});if(o.document.verificationMethod.length!==1)throw new mt(st.InvalidDidDocument,"DID document must contain exactly one verification method");return o})}static resolve(e,t){return Cc(this,void 0,void 0,function*(){try{const n=yield Wd.createDocument({didUri:e,options:t});return Object.assign(Object.assign({},go),{didDocument:n})}catch(n){if(!(n instanceof mt))throw new Error(n);return Object.assign(Object.assign({},go),{didResolutionMetadata:Object.assign({error:n.code},n.message&&{errorMessage:n.message})})}})}static createDocument(e){return Cc(this,arguments,void 0,function*({didUri:t,options:n={}}){const{defaultContext:i="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:o=!1,enableExperimentalPublicKeyTypes:s=!1,publicKeyFormat:a="JsonWebKey2020"}=n,l={id:""},d=Er.parse(t);if(!d)throw new mt(st.InvalidDid,`Invalid DID URI: ${t}`);const c=d.id;if(d.method!==Wd.methodName)throw new mt(st.MethodNotSupported,`Method not supported: ${d.method}`);if(!Wd.validateIdentifier(d))throw new mt(st.InvalidDid,`Invalid DID URI: ${t}`);const u=yield Wd.createSignatureMethod({didUri:t,multibaseValue:c,options:{enableExperimentalPublicKeyTypes:s,publicKeyFormat:a}});if(l.id=d.uri,l.verificationMethod=[u],l.authentication=[u.id],l.assertionMethod=[u.id],l.capabilityInvocation=[u.id],l.capabilityDelegation=[u.id],o===!0){const p=a==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",y=yield this.createEncryptionMethod({didUri:t,multibaseValue:c,options:{enableExperimentalPublicKeyTypes:s,publicKeyFormat:p}});l.verificationMethod.push(y),l.keyAgreement=[y.id]}const f=[i];return wTe({didDocument:l}).forEach(p=>{const y=kk[p];f.push(y)}),l["@context"]=f,l})}static createEncryptionMethod(e){return Cc(this,arguments,void 0,function*({didUri:t,multibaseValue:n,options:i}){const{enableExperimentalPublicKeyTypes:o,publicKeyFormat:s}=i,a={id:"",type:"",controller:""},{keyBytes:l,multicodecCode:d}=yield Wd.deriveEncryptionKey({multibaseValue:n}),c=l.byteLength,u=qa.MULTICODEC_PUBLIC_KEY_LENGTH[d];if(c!==u)throw new mt(st.InvalidPublicKeyLength,`Expected ${c} bytes. Actual: ${u}`);const f=iH({keyBytes:l,multicodecCode:d});a.id=`${t}#${f}`;try{new URL(a.id)}catch{throw new mt(st.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(s in kk))throw new mt(st.UnsupportedPublicKeyType,`Unsupported format: ${s}`);if(o===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(s))throw new mt(st.InvalidPublicKeyType,`Specified '${s}' without setting enableExperimentalPublicKeyTypes to true.`);if(a.type=s,a.controller=t,s==="X25519KeyAgreementKey2020"&&(a.publicKeyMultibase=f),s==="JsonWebKey2020"){const{crv:p}=yield qa.multicodecToJwk({code:d});a.publicKeyJwk=yield qa.keyConverter(p).bytesToPublicKey({publicKeyBytes:l})}return a})}static createSignatureMethod(e){return Cc(this,arguments,void 0,function*({didUri:t,multibaseValue:n,options:i}){const{enableExperimentalPublicKeyTypes:o,publicKeyFormat:s}=i,a={id:"",type:"",controller:""},{keyBytes:l,multicodecCode:d,multicodecName:c}=wN({multibaseKeyId:n}),u=l.byteLength,f=qa.MULTICODEC_PUBLIC_KEY_LENGTH[d];if(u!==f)throw new mt(st.InvalidPublicKeyLength,`Expected ${u} bytes. Actual: ${f}`);let h=!1;switch(c){case"secp256k1-pub":h=yield Pn.validatePublicKey({publicKeyBytes:l});break;case"ed25519-pub":h=yield on.validatePublicKey({publicKeyBytes:l});break;case"x25519-pub":h=!0;break}if(!h)throw new mt(st.InvalidPublicKey,"Invalid public key detected.");a.id=`${t}#${n}`;try{new URL(a.id)}catch{throw new mt(st.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(s in kk))throw new mt(st.UnsupportedPublicKeyType,`Unsupported format: ${s}`);if(o===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(s))throw new mt(st.InvalidPublicKeyType,`Specified '${s}' without setting enableExperimentalPublicKeyTypes to true.`);if(a.type=s,a.controller=t,s==="Ed25519VerificationKey2020"&&(a.publicKeyMultibase=n),s==="JsonWebKey2020"){const{crv:y}=yield qa.multicodecToJwk({code:d});a.publicKeyJwk=yield qa.keyConverter(y).bytesToPublicKey({publicKeyBytes:l})}return a})}static deriveEncryptionKey(e){return Cc(this,arguments,void 0,function*({multibaseValue:t}){let n={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:i,multicodecCode:o}=wN({multibaseKeyId:t});if(o===237){const s=yield qa.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:i}),a=yield on.convertPublicKeyToX25519({publicKey:s});n={keyBytes:yield qa.keyConverter("Ed25519").publicKeyToBytes({publicKey:a}),multicodecCode:236}}return n})}static validateIdentifier(e){const{method:t,id:n}=e,[i]=e.uri.split(":",1);return i==="did"&&t==="key"&&Number("1")>0&&sv(n)==="String"&&n.startsWith("z")}};kTe.methodName="key";let qa=class qm{static jwkToMulticodec(e){return Cc(this,arguments,void 0,function*({jwk:t}){const n=[];t.crv&&(n.push(t.crv),t.d?n.push("private"):n.push("public"));const i=n.join(":"),o=qm.JWK_TO_MULTICODEC[i];if(o===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${i}'`);return{code:zr.getCodeFromName({name:o}),name:o}})}static keyCompressor(e){const n={"P-256":Fn.compressPublicKey,secp256k1:Pn.compressPublicKey}[e];if(!n)throw new mt(st.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static keyConverter(e){const n={Ed25519:on,"P-256":Fn,secp256k1:Pn,X25519:n6}[e];if(!n)throw new mt(st.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static multicodecToJwk(e){return Cc(this,arguments,void 0,function*({code:t,name:n}){if(!(n?!t:t))throw new Error("Either 'name' or 'code' must be defined, but not both.");n=n===void 0?zr.getNameFromCode({code:t}):n;const i=n,o=qm.MULTICODEC_TO_JWK[i];if(o===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},o)})}static publicKeyToMultibaseId(e){return Cc(this,arguments,void 0,function*({publicKey:t}){var n;if(!(t?.crv&&t.crv in $Te))throw new mt(st.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(n=t?.crv)!==null&&n!==void 0?n:"undefined"}`);let i=yield qm.keyConverter(t.crv).publicKeyToBytes({publicKey:t});/^(secp256k1|P-256|P-384|P-521)$/.test(t.crv)&&(i=yield qm.keyCompressor(t.crv)({publicKeyBytes:i}));const{name:o}=yield qm.jwkToMulticodec({jwk:t});return iH({keyBytes:i,multicodecName:o})})}};qa.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};qa.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};qa.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var PTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let ITe=class aH extends c1{static resolve(e,t){return PTe(this,void 0,void 0,function*(){const n=Er.parse(e);if(!n)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"invalidDid"}});if(n.method!==aH.methodName)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"methodNotSupported"}});let i=`https://${n.id.replace(/:/g,"/")}`;i=decodeURIComponent(i);const o=n.id.includes(":")?`${i}/did.json`:`${i}/.well-known/did.json`;try{const s=yield fetch(o);if(!s.ok)throw new Error("HTTP error status code returned");const a=yield s.json();return Object.assign(Object.assign({},go),{didDocument:a})}catch{return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:"notFound"}})}})}};ITe.methodName="web";var OTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class cH{constructor({db:e,location:t="DATA/DID_RESOLVERCACHE",ttl:n="15m"}={}){this.cache=e??new rV(t),this.ttl=by(n)}get(e){return OTe(this,void 0,void 0,function*(){try{const t=yield this.cache.get(e),n=JSON.parse(t);if(Date.now()>=n.ttlMillis){this.cache.nextTick(()=>this.cache.del(e));return}else return n.value}catch(t){if(t.notFound)return;throw t}})}set(e,t){const n={ttlMillis:Date.now()+this.ttl,value:t},i=JSON.stringify(n);return this.cache.put(e,i)}delete(e){return this.cache.del(e)}clear(){return this.cache.clear()}close(){return this.cache.close()}}const CTe={get:function(r){return null},set:function(r,e){return null},delete:function(r){return null},clear:function(){return null},close:function(){return null}};var $N=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let lH=class{constructor({cache:e,didResolvers:t}){this.didResolvers=new Map,this.cache=e||CTe;for(const n of t)this.didResolvers.set(n.methodName,n)}resolve(e,t){return $N(this,void 0,void 0,function*(){const n=Er.parse(e);if(!n)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:st.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const i=this.didResolvers.get(n.method);if(!i)return Object.assign(Object.assign({},go),{didResolutionMetadata:{error:st.MethodNotSupported,errorMessage:`Method not supported: ${n.method}`}});const o=yield this.cache.get(n.uri);if(o)return o;{const s=yield i.resolve(n.uri,t);return s.didResolutionMetadata.error||(yield this.cache.set(n.uri,s)),s}})}dereference(e,t){return $N(this,void 0,void 0,function*(){const n=Er.parse(e);if(!n)return{dereferencingMetadata:{error:st.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:i,didResolutionMetadata:o,didDocumentMetadata:s}=yield this.resolve(n.uri);if(!i)return{dereferencingMetadata:{error:o.error},contentStream:null,contentMetadata:{}};if(!n.fragment||n.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:i,contentMetadata:s};const{service:a=[],verificationMethod:l=[]}=i,d=new Set([e,n.fragment,`#${n.fragment}`]);let c;for(let u of l)if(d.has(u.id)){c=u;break}for(let u of a)if(d.has(u.id)){c=u;break}return c?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:c,contentMetadata:o}:{dereferencingMetadata:{error:st.NotFound},contentStream:null,contentMetadata:{}}})}};var RTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class dH extends cH{constructor({agent:e,db:t,location:n,ttl:i}){super({db:t,location:n,ttl:i}),this._resolving=new Map,this._agent=e}get agent(){if(!this._agent)throw new Error("Agent not initialized");return this._agent}set agent(e){this._agent=e}get(e){return RTe(this,void 0,void 0,function*(){try{const t=yield this.cache.get(e),n=JSON.parse(t);if(!this._resolving.has(e)&&Date.now()>=n.ttlMillis)if(this._resolving.set(e,!0),this.agent.agentDid.uri===e||typeof(yield this.agent.identity.get({didUri:e}))<"u")try{const i=yield this.agent.did.resolve(e);i.didResolutionMetadata.error||this.set(e,i)}finally{this._resolving.delete(e)}else this._resolving.delete(e),this.cache.nextTick(()=>this.cache.del(e));return n.value}catch(t){if(t.notFound)return;throw t}})}}var DTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class P2{constructor({did:e,metadata:t}){this.did=e,this.metadata=t}export(){return DTe(this,void 0,void 0,function*(){return{portableDid:yield this.did.export(),metadata:this.metadata}})}}var MTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class BTe{static deriveKeyBytes({baseKeyBytes:e,length:t,hash:n,salt:i,info:o=new Uint8Array}){return MTe(this,void 0,void 0,function*(){const a=yield vu().importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]);i=typeof i=="string"?ge.string(i).toUint8Array():i,o=typeof o=="string"?ge.string(o).toUint8Array():o;const l=yield crypto.subtle.deriveBits({name:"HKDF",hash:n,salt:i,info:o},a,t);return new Uint8Array(l)})}}var jTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},NTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class UTe extends bd{deriveKeyBytes(e){var{algorithm:t}=e,n=NTe(e,["algorithm"]);return jTe(this,void 0,void 0,function*(){const i={"HKDF-256":"SHA-256","HKDF-384":"SHA-384","HKDF-512":"SHA-512"}[t];return yield BTe.deriveKeyBytes(Object.assign(Object.assign({},n),{hash:i}))})}}class ut extends Error{constructor(e,t){super(t),this.code=e,this.name="CryptoError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ut)}}var dt;(function(r){r.AlgorithmNotSupported="algorithmNotSupported",r.EncodingError="encodingError",r.InvalidJwe="invalidJwe",r.InvalidJwk="invalidJwk",r.OperationNotSupported="operationNotSupported"})(dt||(dt={}));var jd=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let kN=class extends bd{bytesToPrivateKey({algorithm:e,privateKeyBytes:t}){return jd(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const n=yield Pn.bytesToPrivateKey({privateKeyBytes:t});return n.alg="EdDSA",n}case"ES256":case"secp256r1":{const n=yield Fn.bytesToPrivateKey({privateKeyBytes:t});return n.alg="EdDSA",n}default:throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:t}){return jd(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const n=yield Pn.bytesToPublicKey({publicKeyBytes:t});return n.alg="EdDSA",n}case"ES256":case"secp256r1":{const n=yield Fn.bytesToPublicKey({publicKeyBytes:t});return n.alg="EdDSA",n}default:throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return jd(this,void 0,void 0,function*(){if(!Yl(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const t=yield Pn.computePublicKey({key:e});return t.alg="ES256K",t}case"P-256":{const t=yield Fn.computePublicKey({key:e});return t.alg="ES256",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return jd(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const t=yield Pn.generateKey();return t.alg="ES256K",t}case"ES256":case"secp256r1":{const t=yield Fn.generateKey();return t.alg="ES256",t}}})}getPublicKey({key:e}){return jd(this,void 0,void 0,function*(){if(!Yl(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const t=yield Pn.getPublicKey({key:e});return t.alg="ES256K",t}case"P-256":{const t=yield Fn.getPublicKey({key:e});return t.alg="ES256",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return jd(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Pn.privateKeyToBytes({privateKey:e});case"P-256":return yield Fn.privateKeyToBytes({privateKey:e});default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return jd(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Pn.publicKeyToBytes({publicKey:e});case"P-256":return yield Fn.publicKeyToBytes({publicKey:e});default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:t}){return jd(this,void 0,void 0,function*(){if(!Yl(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield Pn.sign({key:e,data:t});case"P-256":return yield Fn.sign({key:e,data:t});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:t,data:n}){return jd(this,void 0,void 0,function*(){if(!iT(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield Pn.verify({key:e,signature:t,data:n});case"P-256":return yield Fn.verify({key:e,signature:t,data:n});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}};var Nd=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};let LTe=class extends bd{bytesToPrivateKey({algorithm:e,privateKeyBytes:t}){return Nd(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const n=yield on.bytesToPrivateKey({privateKeyBytes:t});return n.alg="EdDSA",n}default:throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:t}){return Nd(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const n=yield on.bytesToPublicKey({publicKeyBytes:t});return n.alg="EdDSA",n}default:throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return Nd(this,void 0,void 0,function*(){if(!Zl(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const t=yield on.computePublicKey({key:e});return t.alg="EdDSA",t}default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}generateKey({algorithm:e}){return Nd(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const t=yield on.generateKey();return t.alg="EdDSA",t}}})}getPublicKey({key:e}){return Nd(this,void 0,void 0,function*(){if(!Zl(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const t=yield on.getPublicKey({key:e});return t.alg="EdDSA",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return Nd(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield on.privateKeyToBytes({privateKey:e});default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return Nd(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield on.publicKeyToBytes({publicKey:e});default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:t}){return Nd(this,void 0,void 0,function*(){if(!Zl(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield on.sign({key:e,data:t});default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}verify({key:e,signature:t,data:n}){return Nd(this,void 0,void 0,function*(){if(!oT(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield on.verify({key:e,signature:t,data:n});default:throw new ut(dt.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}};var Y0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},PN=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const IN=[128,192,256];class Z0{static bytesToPrivateKey({privateKeyBytes:e}){return Y0(this,void 0,void 0,function*(){const t={k:ge.uint8Array(e).toBase64Url(),kty:"oct"};t.kid=yield nr({jwk:t});const n=e.length*8;return t.alg={128:"A128KW",192:"A192KW",256:"A256KW"}[n],t})}static generateKey({length:e}){return Y0(this,void 0,void 0,function*(){if(!IN.includes(e))throw new RangeError(`The key length is invalid: Must be ${IN.join(", ")} bits`);const t=vu(),n=yield t.generateKey({name:"AES-KW",length:e},!0,["wrapKey","unwrapKey"]),i=yield t.exportKey("jwk",n),o=PN(i,["ext","key_ops"]);return o.kid=yield nr({jwk:o}),o})}static privateKeyToBytes({privateKey:e}){return Y0(this,void 0,void 0,function*(){if(!rH(e))throw new Error("AesKw: The provided key is not a valid oct private key.");return ge.base64Url(e.k).toUint8Array()})}static unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:t,decryptionKey:n}){return Y0(this,void 0,void 0,function*(){if(!("alg"in n&&n.alg))throw new ut(dt.InvalidJwk,"The decryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(n.alg))throw new ut(dt.AlgorithmNotSupported,`The 'decryptionKey' algorithm is not supported: ${n.alg}`);const i=vu(),o=yield i.importKey("jwk",n,{name:"AES-KW"},!0,["unwrapKey"]),s={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[t];if(!s)throw new ut(dt.AlgorithmNotSupported,`The 'wrappedKeyAlgorithm' is not supported: ${t}`);const a=yield i.unwrapKey("raw",e.buffer,o,"AES-KW",{name:s},!0,["unwrapKey"]),l=yield i.exportKey("jwk",a),c=PN(l,["ext","key_ops"]);return c.kid=yield nr({jwk:c}),c})}static wrapKey({unwrappedKey:e,encryptionKey:t}){return Y0(this,void 0,void 0,function*(){if(!("alg"in t&&t.alg))throw new ut(dt.InvalidJwk,"The encryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(t.alg))throw new ut(dt.AlgorithmNotSupported,`The 'encryptionKey' algorithm is not supported: ${t.alg}`);if(!("alg"in e&&e.alg))throw new ut(dt.InvalidJwk,"The private key to wrap is missing the 'alg' property.");const n=vu(),i=yield n.importKey("jwk",t,{name:"AES-KW"},!0,["wrapKey"]),o={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[e.alg];if(!o)throw new ut(dt.AlgorithmNotSupported,`The 'unwrappedKey' algorithm is not supported: ${e.alg}`);const s=yield n.importKey("jwk",e,{name:o},!0,["unwrapKey"]),a=yield n.wrapKey("raw",s,i,"AES-KW");return new Uint8Array(a)})}}var J0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class uH extends bd{bytesToPrivateKey({privateKeyBytes:e}){return J0(this,void 0,void 0,function*(){const t=yield Z0.bytesToPrivateKey({privateKeyBytes:e});return t.alg={16:"A128KW",24:"A192KW",32:"A256KW"}[e.length],t})}generateKey({algorithm:e}){return J0(this,void 0,void 0,function*(){const t={A128KW:128,A192KW:192,A256KW:256}[e],n=yield Z0.generateKey({length:t});return n.alg=e,n})}privateKeyToBytes({privateKey:e}){return J0(this,void 0,void 0,function*(){return yield Z0.privateKeyToBytes({privateKey:e})})}unwrapKey(e){return J0(this,void 0,void 0,function*(){return yield Z0.unwrapKey(e)})}wrapKey(e){return J0(this,void 0,void 0,function*(){return Z0.wrapKey(e)})}}var KTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class zTe{static deriveKeyBytes({baseKeyBytes:e,hash:t,salt:n,iterations:i,length:o}){return KTe(this,void 0,void 0,function*(){const s=vu(),a=yield s.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]),l=yield s.deriveBits({name:"PBKDF2",hash:t,salt:n,iterations:i},a,o);return new Uint8Array(l)})}}var FTe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},qTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class VTe extends bd{deriveKeyBytes(e){var{algorithm:t}=e,n=qTe(e,["algorithm"]);return FTe(this,void 0,void 0,function*(){const[,i]=t.split(/[-+]/),o={HS256:"SHA-256",HS384:"SHA-384",HS512:"SHA-512"}[i];return yield zTe.deriveKeyBytes(Object.assign(Object.assign({},n),{hash:o}))})}}var X0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class WTe extends bd{bytesToPrivateKey({privateKeyBytes:e}){return X0(this,void 0,void 0,function*(){const t=yield th.bytesToPrivateKey({privateKeyBytes:e});return t.alg={16:"A128GCM",24:"A192GCM",32:"A256GCM"}[e.length],t})}decrypt(e){return X0(this,void 0,void 0,function*(){return th.decrypt(e)})}encrypt(e){return X0(this,void 0,void 0,function*(){return th.encrypt(e)})}generateKey({algorithm:e}){return X0(this,void 0,void 0,function*(){const t={A128GCM:128,A192GCM:192,A256GCM:256}[e],n=yield th.generateKey({length:t});return n.alg=e,n})}privateKeyToBytes({privateKey:e}){return X0(this,void 0,void 0,function*(){return yield th.privateKeyToBytes({privateKey:e})})}}var $o=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const Pk={"AES-GCM":{implementation:WTe,names:["A128GCM","A192GCM","A256GCM"],operations:["bytesToPrivateKey","decrypt","encrypt","generateKey"]},"AES-KW":{implementation:uH,names:["A128KW","A192KW","A256KW"],operations:["bytesToPrivateKey","generateKey","privateKeyToBytes","wrapKey","unwrapKey"]},Ed25519:{implementation:LTe,names:["Ed25519"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},HKDF:{implementation:UTe,names:["HKDF-256","HKDF-384","HKDF-512"],operations:["deriveKey","deriveKeyBytes"]},PBKDF2:{implementation:VTe,names:["PBES2-HS256+A128KW","PBES2-HS384+A192KW","PBES2-HS512+A256KW"],operations:["deriveKey","deriveKeyBytes"]},secp256k1:{implementation:kN,names:["ES256K","secp256k1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},secp256r1:{implementation:kN,names:["ES256","secp256r1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},"SHA-256":{implementation:e6,names:["SHA-256"],operations:["digest"]}};class hv{constructor(){this._algorithmInstances=new Map}bytesToPrivateKey({algorithm:e,privateKeyBytes:t}){return $o(this,void 0,void 0,function*(){const n=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:n}).bytesToPrivateKey({algorithm:e,privateKeyBytes:t})})}bytesToPublicKey({algorithm:e,publicKeyBytes:t}){return $o(this,void 0,void 0,function*(){const n=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:n}).bytesToPublicKey({algorithm:e,publicKeyBytes:t})})}decrypt(e){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:t}).decrypt(e)})}deriveKey(e){var t,n;return $o(this,void 0,void 0,function*(){const i=this.getAlgorithmName({algorithm:e.algorithm}),o=this.getAlgorithm({algorithm:i});let s;switch(e.algorithm){case"HKDF-256":case"HKDF-384":case"HKDF-512":{s=e.derivedKeyAlgorithm;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{s=e.algorithm.split(/[-+]/)[2];break}default:throw new ut(dt.AlgorithmNotSupported,`The specified "algorithm" is not supported: ${e.algorithm}`)}const a=+((n=(t=s.match(/\d+/))===null||t===void 0?void 0:t[0])!==null&&n!==void 0?n:-1);if(a===-1)throw new ut(dt.AlgorithmNotSupported,`The derived key algorithm" is not supported: ${s}`);const l=yield o.deriveKeyBytes(Object.assign(Object.assign({},e),{length:a}));return yield this.bytesToPrivateKey({algorithm:s,privateKeyBytes:l})})}deriveKeyBytes(e){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({algorithm:e.algorithm});return yield this.getAlgorithm({algorithm:t}).deriveKeyBytes(e)})}digest({algorithm:e,data:t}){return $o(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:t})})}encrypt(e){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:t}).encrypt(e)})}generateKey(e){var t;return $o(this,void 0,void 0,function*(){const n=this.getAlgorithmName({algorithm:e.algorithm}),o=yield this.getAlgorithm({algorithm:n}).generateKey({algorithm:e.algorithm});return(t=o.kid)!==null&&t!==void 0||(o.kid=yield nr({jwk:o})),o})}getKeyUri(e){return $o(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}getPublicKey({key:e}){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:t}).getPublicKey({key:e})})}privateKeyToBytes({privateKey:e}){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:t}).privateKeyToBytes({privateKey:e})})}publicKeyToBytes({publicKey:e}){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:t}).publicKeyToBytes({publicKey:e})})}sign({key:e,data:t}){return $o(this,void 0,void 0,function*(){const n=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:n}).sign({data:t,key:e})})}unwrapKey(e){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e.decryptionKey});return yield this.getAlgorithm({algorithm:t}).unwrapKey(e)})}verify({key:e,signature:t,data:n}){return $o(this,void 0,void 0,function*(){const i=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:i}).verify({key:e,signature:t,data:n})})}wrapKey(e){return $o(this,void 0,void 0,function*(){const t=this.getAlgorithmName({key:e.encryptionKey});return yield this.getAlgorithm({algorithm:t}).wrapKey(e)})}getAlgorithm({algorithm:e}){var t;const n=(t=Pk[e])===null||t===void 0?void 0:t.implementation;if(!n)throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(n)||this._algorithmInstances.set(n,new n),this._algorithmInstances.get(n)}getAlgorithmName({algorithm:e,key:t}){var n;const i=(n=t?.alg)!==null&&n!==void 0?n:e,o=t?.crv;for(const s of Object.keys(Pk)){const a=Pk[s].names;if(i&&a.includes(i))return s;if(o&&a.includes(o))return s}throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${i}, crv=${o}. Please check the documentation for the list of supported algorithms.`)}}const fH={protocol:"http://identity.foundation/protocols/web5/identity-store",published:!1,types:{portableDid:{schema:"https://identity.foundation/schemas/web5/portable-did",dataFormats:["application/json"]},identityMetadata:{schema:"https://identity.foundation/schemas/web5/identity-metadata",dataFormats:["application/json"]}},structure:{portableDid:{},identityMetadata:{}}},HTe={protocol:"http://identity.foundation/protocols/web5/jwk-store",published:!1,types:{privateJwk:{schema:"https://identity.foundation/schemas/web5/private-jwk",dataFormats:["application/json"]}},structure:{privateJwk:{}}};function hH(r){return!(!r||typeof r!="object"||r===null)&&"uri"in r&&"document"in r&&"metadata"in r&&(!("keyManager"in r)||r.keyManager===void 0)}var Vm=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},GTe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const ha="^";class YTe extends Ms{constructor(){super(),this._predefinedKeys=new Map,this._keyGenerator=this._predefinedKeys.keys()}addPredefinedKeys({privateKeys:e}){var t;return Vm(this,void 0,void 0,function*(){const n={};for(const i of e){(t=i.kid)!==null&&t!==void 0||(i.kid=yield nr({jwk:i}));const o=yield this.getKeyUri({key:i});n[o]=i}this._predefinedKeys=new Map(Object.entries(n)),this._keyGenerator=this._predefinedKeys.keys()})}exportKey({keyUri:e}){return Vm(this,void 0,void 0,function*(){const t=this._predefinedKeys.get(e);if(!t)throw new Error(`DeterministicKeyGenerator.exportKey: Key not found: ${e}`);return t})}generateKey(e){return Vm(this,void 0,void 0,function*(){const{value:t,done:n}=this._keyGenerator.next();if(n)throw new Error("Ran out of predefined keys");return t})}getPublicKey({keyUri:e}){return Vm(this,void 0,void 0,function*(){const t=this._predefinedKeys.get(e);if(!t)throw new Error(`DeterministicKeyGenerator.getPublicKey: Key not found: ${e}`);return GTe(t,["d"])})}sign({keyUri:e,data:t}){return Vm(this,void 0,void 0,function*(){const n=this._predefinedKeys.get(e);if(!n)throw new Error(`DeterministicKeyGenerator.sign: Key not found: ${e}`);return yield on.sign({data:t,key:n})})}}function lu({agent:r,tenant:e,didUri:t}){return Vm(this,void 0,void 0,function*(){if(e)return e;if(r.agentDid)return r.agentDid.uri;if(!t)throw new Error("Failed to determine tenant DID: 'agent.agentDid', 'tenant', and 'didUri' are undefined");return t})}var sa=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class i6{constructor(){this.name="DwnDataStore",this._cache=new rw({ttl:by("15 minutes"),max:100}),this._index=new rw({ttl:by("21 days"),max:1e3}),this._protocolInitializedCache=new rw({ttl:by("21 days"),max:1e3}),this._recordProperties={dataFormat:"application/json"}}delete({id:e,agent:t,tenant:n}){return sa(this,void 0,void 0,function*(){const i=yield lu({agent:t,tenant:n,didUri:e});let o=yield this.lookupRecordId({id:e,tenantDid:i,agent:t});if(!o)return!1;const{reply:{status:s}}=yield t.dwn.processRequest({author:i,target:i,messageType:Ke.RecordsDelete,messageParams:{recordId:o}});if(s.code===202)return this._index.delete(`${i}${ha}${e}`),this._cache.delete(o),!0;throw new Error(`${this.name}: Failed to delete '${e}' from store: (${s.code}) ${s.detail}`)})}get({id:e,agent:t,tenant:n,useCache:i=!1}){return sa(this,void 0,void 0,function*(){const o=yield lu({agent:t,tenant:n,didUri:e});let s=yield this.lookupRecordId({id:e,tenantDid:o,agent:t});if(s)return yield this.getRecord({recordId:s,tenantDid:o,agent:t,useCache:i})})}list({agent:e,tenant:t}){return sa(this,void 0,void 0,function*(){const n=yield lu({tenant:t,agent:e});return yield this.getAllRecords({agent:e,tenantDid:n})})}set({id:e,data:t,tenant:n,agent:i,preventDuplicates:o=!0,useCache:s=!1}){return sa(this,void 0,void 0,function*(){const a=yield lu({agent:i,tenant:n,didUri:e});if(yield this.initialize({tenant:a,agent:i}),o&&(yield this.lookupRecordId({id:e,tenantDid:a,agent:i})))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const l=ge.object(t).toUint8Array(),{message:d,reply:{status:c}}=yield i.dwn.processRequest({author:a,target:a,messageType:Ke.RecordsWrite,messageParams:Object.assign({},this._recordProperties),dataStream:new Blob([l],{type:"application/json"})});if(!(d&&c.code===202))throw new Error(`${this.name}: Failed to write data to store for ${e}: ${c.detail}`);this._index.set(`${a}${ha}${e}`,d.recordId),s&&this._cache.set(d.recordId,t)})}initialize({tenant:e,agent:t}){return sa(this,void 0,void 0,function*(){const n=yield lu({agent:t,tenant:e});if(this._protocolInitializedCache.has(n))return;const{reply:{status:i,entries:o}}=yield t.dwn.processRequest({author:n,target:n,messageType:Ke.ProtocolsQuery,messageParams:{filter:{protocol:this._recordProtocolDefinition.protocol}}});if(i.code!==200)throw new Error(`Failed to query for protocols: ${i.code} - ${i.detail}`);o?.length===0&&(yield this.installProtocol(n,t)),this._protocolInitializedCache.set(n,!0)})}getAllRecords(e){return sa(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DwnDataStore must implement getAllRecords()")})}getRecord({recordId:e,tenantDid:t,agent:n,useCache:i}){var o;return sa(this,void 0,void 0,function*(){if(i){const l=this._cache.get(e);if(l)return l}const{reply:s}=yield n.dwn.processRequest({author:t,target:t,messageType:Ke.RecordsRead,messageParams:{filter:{recordId:e}}});if(!(!((o=s.record)===null||o===void 0)&&o.data))throw new Error(`${this.name}: Failed to read data from DWN for: ${e}`);const a=yield lo.consumeToJson({readable:s.record.data});return i&&this._cache.set(e,a),a})}installProtocol(e,t){return sa(this,void 0,void 0,function*(){const{reply:{status:n}}=yield t.dwn.processRequest({author:e,target:e,messageType:Ke.ProtocolsConfigure,messageParams:{definition:this._recordProtocolDefinition}});if(n.code!==202)throw new Error(`Failed to install protocol: ${n.code} - ${n.detail}`)})}lookupRecordId({id:e,tenantDid:t,agent:n}){return sa(this,void 0,void 0,function*(){let i=this._index.get(`${t}${ha}${e}`,{updateAgeOnGet:!0});return i||(yield this.getAllRecords({agent:n,tenantDid:t}),i=this._index.get(`${t}${ha}${e}`)),i})}}class o6{constructor(){this.name="InMemoryDataStore",this.store=new Map}delete({id:e,agent:t,tenant:n}){return sa(this,void 0,void 0,function*(){const i=yield lu({agent:t,tenant:n,didUri:e});return this.store.has(`${i}${ha}${e}`)?(this.store.delete(`${i}${ha}${e}`),!0):!1})}get({id:e,agent:t,tenant:n}){return sa(this,void 0,void 0,function*(){const i=yield lu({agent:t,tenant:n,didUri:e});return this.store.get(`${i}${ha}${e}`)})}list({agent:e,tenant:t}){return sa(this,void 0,void 0,function*(){const n=yield lu({tenant:t,agent:e}),i=[];for(const[o,s]of this.store.entries())o.startsWith(`${n}${ha}`)&&i.push(s);return i})}set({id:e,data:t,tenant:n,agent:i,preventDuplicates:o}){return sa(this,void 0,void 0,function*(){const s=yield lu({agent:i,tenant:n,didUri:e});if(o&&this.store.has(`${s}${ha}${e}`))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const a=structuredClone(t);this.store.set(`${s}${ha}${e}`,a)})}}var du=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class ZTe extends i6{constructor(){super(...arguments),this.name="DwnDidStore",this._recordProtocolDefinition=fH,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"portableDid",schema:this._recordProtocolDefinition.types.portableDid.schema}}delete(e){const t=Object.create(null,{delete:{get:()=>super.delete}});return du(this,void 0,void 0,function*(){return yield t.delete.call(this,e)})}get(e){const t=Object.create(null,{get:{get:()=>super.get}});return du(this,void 0,void 0,function*(){return yield t.get.call(this,e)})}list(e){const t=Object.create(null,{list:{get:()=>super.list}});return du(this,void 0,void 0,function*(){return yield t.list.call(this,e)})}set(e){const t=Object.create(null,{set:{get:()=>super.set}});return du(this,void 0,void 0,function*(){return yield t.set.call(this,e)})}getAllRecords({agent:e,tenantDid:t}){var n;return du(this,void 0,void 0,function*(){this._index.clear();const{reply:i}=yield e.dwn.processRequest({author:t,target:t,messageType:Ke.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let o=[];for(const s of(n=i.entries)!==null&&n!==void 0?n:[]){if(!s.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const a=ge.base64Url(s.encodedData).toObject();if(hH(a)){const l=`${t}${ha}${a.uri}`;this._index.set(l,s.recordId),this._cache.set(s.recordId,a),o.push(a)}}return o})}}class JTe extends o6{constructor(){super(...arguments),this.name="InMemoryDidStore"}delete(e){const t=Object.create(null,{delete:{get:()=>super.delete}});return du(this,void 0,void 0,function*(){return yield t.delete.call(this,e)})}get(e){const t=Object.create(null,{get:{get:()=>super.get}});return du(this,void 0,void 0,function*(){return yield t.get.call(this,e)})}list(e){const t=Object.create(null,{list:{get:()=>super.list}});return du(this,void 0,void 0,function*(){return yield t.list.call(this,e)})}set(e){const t=Object.create(null,{set:{get:()=>super.set}});return du(this,void 0,void 0,function*(){return yield t.set.call(this,e)})}}var Of=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},pv;(function(r){r.Create="Create",r.Resolve="Resolve"})(pv||(pv={}));function ON(r,e){return r.messageType===e}class XTe extends lH{constructor({agent:e,didMethods:t,resolverCache:n,store:i}){if(!t)throw new TypeError("AgentDidApi: Required parameter missing: 'didMethods'");super({didResolvers:t,cache:n??new dH({agent:e,location:"DATA/AGENT/DID_CACHE"})}),this._didMethods=new Map,this._agent=e,this._store=i??new JTe;for(const o of t)this._didMethods.set(o.methodName,o)}get agent(){if(this._agent===void 0)throw new Error("AgentDidApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,"agent"in this.cache&&(this.cache.agent=e)}create({method:e,tenant:t,options:n,store:i}){return Of(this,void 0,void 0,function*(){const s=yield this.getMethod(e).create({keyManager:this.agent.keyManager,options:n});if(i??!0){const{uri:a,document:l,metadata:d}=s,c={uri:a,document:l,metadata:d};yield this._store.set({id:c.uri,data:c,agent:this.agent,tenant:t??c.uri,preventDuplicates:!1,useCache:!0})}return s})}export({didUri:e,tenant:t}){return Of(this,void 0,void 0,function*(){const n=yield this.get({didUri:e,tenant:t});if(!n)throw new Error(`AgentDidApi: Failed to export due to DID not found: ${e}`);return yield n.export()})}get({didUri:e,tenant:t}){return Of(this,void 0,void 0,function*(){const n=yield this._store.get({id:e,agent:this.agent,tenant:t,useCache:!0});return n?yield Zc.import({portableDid:n,keyManager:this.agent.keyManager}):void 0})}getSigningMethod({didUri:e,methodId:t}){return Of(this,void 0,void 0,function*(){const n=Er.parse(e);if(!n)throw new Error(`Invalid DID URI: ${e}`);const i=this.getMethod(n.method),{didDocument:o,didResolutionMetadata:s}=yield this.resolve(e);if(!o)throw new Error(`DID resolution failed for '${e}': ${JSON.stringify(s)}`);return yield i.getSigningMethod({didDocument:o,methodId:t})})}import({portableDid:e,tenant:t}){return Of(this,void 0,void 0,function*(){const n=yield Zc.import({keyManager:this.agent.keyManager,portableDid:e}),{uri:i,document:o,metadata:s}=n,a={uri:i,document:o,metadata:s};return yield this._store.set({id:a.uri,data:a,agent:this.agent,tenant:t??a.uri,preventDuplicates:!0,useCache:!0}),n})}delete({didUri:e,tenant:t,deleteKey:n=!0}){return Of(this,void 0,void 0,function*(){const i=yield this._store.get({id:e,agent:this.agent,tenant:t,useCache:!1});if(!i)throw new Error("AgentDidApi: Could not delete, DID not found");yield this._store.delete({id:e,agent:this.agent,tenant:t}),n&&(yield this.deleteKeys({portableDid:i}))})}deleteKeys({portableDid:e}){return Of(this,void 0,void 0,function*(){for(const t of e.document.verificationMethod||[]){if(!t.publicKeyJwk)continue;const n=yield this.agent.keyManager.getKeyUri({key:t.publicKeyJwk});yield this.agent.keyManager.deleteKey({keyUri:n})}})}processRequest(e){var t;return Of(this,void 0,void 0,function*(){if(ON(e,pv.Create))try{const n=yield this.create(Object.assign({},e.messageParams));return{result:{uri:n.uri,document:n.document,metadata:n.metadata},ok:!0,status:{code:201,message:"Created"}}}catch(n){return{ok:!1,status:{code:500,message:(t=n.message)!==null&&t!==void 0?t:"Unknown error occurred"}}}if(ON(e,pv.Resolve)){const{didUri:n,options:i}=e.messageParams;return{result:yield this.resolve(n,i),ok:!0,status:{code:200,message:"OK"}}}throw new Error(`AgentDidApi: Unsupported request type: ${e.messageType}`)})}getMethod(e){const t=this._didMethods.get(e);if(t===void 0)throw new Error(`DID Method not supported: ${e}`);return t}}var s6={},u5={exports:{}},pH=dd.EventEmitter,Ik,CN;function QTe(){if(CN)return Ik;CN=1;function r(p,y){var g=Object.keys(p);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(p);y&&(w=w.filter(function(v){return Object.getOwnPropertyDescriptor(p,v).enumerable})),g.push.apply(g,w)}return g}function e(p){for(var y=1;y<arguments.length;y++){var g=arguments[y]!=null?arguments[y]:{};y%2?r(Object(g),!0).forEach(function(w){t(p,w,g[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(g)):r(Object(g)).forEach(function(w){Object.defineProperty(p,w,Object.getOwnPropertyDescriptor(g,w))})}return p}function t(p,y,g){return y=s(y),y in p?Object.defineProperty(p,y,{value:g,enumerable:!0,configurable:!0,writable:!0}):p[y]=g,p}function n(p,y){if(!(p instanceof y))throw new TypeError("Cannot call a class as a function")}function i(p,y){for(var g=0;g<y.length;g++){var w=y[g];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(p,s(w.key),w)}}function o(p,y,g){return y&&i(p.prototype,y),Object.defineProperty(p,"prototype",{writable:!1}),p}function s(p){var y=a(p,"string");return typeof y=="symbol"?y:String(y)}function a(p,y){if(typeof p!="object"||p===null)return p;var g=p[Symbol.toPrimitive];if(g!==void 0){var w=g.call(p,y||"default");if(typeof w!="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(p)}var l=Dn,d=l.Buffer,c=lC,u=c.inspect,f=u&&u.custom||"inspect";function h(p,y,g){d.prototype.copy.call(p,y,g)}return Ik=function(){function p(){n(this,p),this.head=null,this.tail=null,this.length=0}return o(p,[{key:"push",value:function(g){var w={data:g,next:null};this.length>0?this.tail.next=w:this.head=w,this.tail=w,++this.length}},{key:"unshift",value:function(g){var w={data:g,next:this.head};this.length===0&&(this.tail=w),this.head=w,++this.length}},{key:"shift",value:function(){if(this.length!==0){var g=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,g}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(g){if(this.length===0)return"";for(var w=this.head,v=""+w.data;w=w.next;)v+=g+w.data;return v}},{key:"concat",value:function(g){if(this.length===0)return d.alloc(0);for(var w=d.allocUnsafe(g>>>0),v=this.head,m=0;v;)h(v.data,w,m),m+=v.data.length,v=v.next;return w}},{key:"consume",value:function(g,w){var v;return g<this.head.data.length?(v=this.head.data.slice(0,g),this.head.data=this.head.data.slice(g)):g===this.head.data.length?v=this.shift():v=w?this._getString(g):this._getBuffer(g),v}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(g){var w=this.head,v=1,m=w.data;for(g-=m.length;w=w.next;){var b=w.data,_=g>b.length?b.length:g;if(_===b.length?m+=b:m+=b.slice(0,g),g-=_,g===0){_===b.length?(++v,w.next?this.head=w.next:this.head=this.tail=null):(this.head=w,w.data=b.slice(_));break}++v}return this.length-=v,m}},{key:"_getBuffer",value:function(g){var w=d.allocUnsafe(g),v=this.head,m=1;for(v.data.copy(w),g-=v.data.length;v=v.next;){var b=v.data,_=g>b.length?b.length:g;if(b.copy(w,w.length-g,0,_),g-=_,g===0){_===b.length?(++m,v.next?this.head=v.next:this.head=this.tail=null):(this.head=v,v.data=b.slice(_));break}++m}return this.length-=m,w}},{key:f,value:function(g,w){return u(this,e(e({},w),{},{depth:0,customInspect:!1}))}}]),p}(),Ik}function e$e(r,e){var t=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(f5,this,r)):process.nextTick(f5,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(o){!e&&o?t._writableState?t._writableState.errorEmitted?process.nextTick(CE,t):(t._writableState.errorEmitted=!0,process.nextTick(RN,t,o)):process.nextTick(RN,t,o):e?(process.nextTick(CE,t),e(o)):process.nextTick(CE,t)}),this)}function RN(r,e){f5(r,e),CE(r)}function CE(r){r._writableState&&!r._writableState.emitClose||r._readableState&&!r._readableState.emitClose||r.emit("close")}function t$e(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function f5(r,e){r.emit("error",e)}function r$e(r,e){var t=r._readableState,n=r._writableState;t&&t.autoDestroy||n&&n.autoDestroy?r.destroy(e):r.emit("error",e)}var yH={destroy:e$e,undestroy:t$e,errorOrDestroy:r$e},lm={};function n$e(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var mH={};function mc(r,e,t){t||(t=Error);function n(o,s,a){return typeof e=="string"?e:e(o,s,a)}var i=function(o){n$e(s,o);function s(a,l,d){return o.call(this,n(a,l,d))||this}return s}(t);i.prototype.name=t.name,i.prototype.code=r,mH[r]=i}function DN(r,e){if(Array.isArray(r)){var t=r.length;return r=r.map(function(n){return String(n)}),t>2?"one of ".concat(e," ").concat(r.slice(0,t-1).join(", "),", or ")+r[t-1]:t===2?"one of ".concat(e," ").concat(r[0]," or ").concat(r[1]):"of ".concat(e," ").concat(r[0])}else return"of ".concat(e," ").concat(String(r))}function i$e(r,e,t){return r.substr(0,e.length)===e}function o$e(r,e,t){return(t===void 0||t>r.length)&&(t=r.length),r.substring(t-e.length,t)===e}function s$e(r,e,t){return typeof t!="number"&&(t=0),t+e.length>r.length?!1:r.indexOf(e,t)!==-1}mc("ERR_INVALID_OPT_VALUE",function(r,e){return'The value "'+e+'" is invalid for option "'+r+'"'},TypeError);mc("ERR_INVALID_ARG_TYPE",function(r,e,t){var n;typeof e=="string"&&i$e(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(o$e(r," argument"))i="The ".concat(r," ").concat(n," ").concat(DN(e,"type"));else{var o=s$e(r,".")?"property":"argument";i='The "'.concat(r,'" ').concat(o," ").concat(n," ").concat(DN(e,"type"))}return i+=". Received type ".concat(typeof t),i},TypeError);mc("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");mc("ERR_METHOD_NOT_IMPLEMENTED",function(r){return"The "+r+" method is not implemented"});mc("ERR_STREAM_PREMATURE_CLOSE","Premature close");mc("ERR_STREAM_DESTROYED",function(r){return"Cannot call "+r+" after a stream was destroyed"});mc("ERR_MULTIPLE_CALLBACK","Callback called multiple times");mc("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");mc("ERR_STREAM_WRITE_AFTER_END","write after end");mc("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);mc("ERR_UNKNOWN_ENCODING",function(r){return"Unknown encoding: "+r},TypeError);mc("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");lm.codes=mH;var a$e=lm.codes.ERR_INVALID_OPT_VALUE;function c$e(r,e,t){return r.highWaterMark!=null?r.highWaterMark:e?r[t]:null}function l$e(r,e,t,n){var i=c$e(e,n,t);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var o=n?t:"highWaterMark";throw new a$e(o,i)}return Math.floor(i)}return r.objectMode?16:16*1024}var gH={getHighWaterMark:l$e},h5={exports:{}};typeof Object.create=="function"?h5.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:h5.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var l1=h5.exports,d$e=u$e;function u$e(r,e){if(Ok("noDeprecation"))return r;var t=!1;function n(){if(!t){if(Ok("throwDeprecation"))throw new Error(e);Ok("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return r.apply(this,arguments)}return n}function Ok(r){try{if(!globalThis.localStorage)return!1}catch{return!1}var e=globalThis.localStorage[r];return e==null?!1:String(e).toLowerCase()==="true"}var Ck,MN;function vH(){if(MN)return Ck;MN=1,Ck=T;function r(C){var F=this;this.next=null,this.entry=null,this.finish=function(){G(F,C)}}var e;T.WritableState=E;var t={deprecate:d$e},n=pH,i=Dn.Buffer,o=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(C){return i.from(C)}function a(C){return i.isBuffer(C)||C instanceof o}var l=yH,d=gH,c=d.getHighWaterMark,u=lm.codes,f=u.ERR_INVALID_ARG_TYPE,h=u.ERR_METHOD_NOT_IMPLEMENTED,p=u.ERR_MULTIPLE_CALLBACK,y=u.ERR_STREAM_CANNOT_PIPE,g=u.ERR_STREAM_DESTROYED,w=u.ERR_STREAM_NULL_VALUES,v=u.ERR_STREAM_WRITE_AFTER_END,m=u.ERR_UNKNOWN_ENCODING,b=l.errorOrDestroy;l1(T,n);function _(){}function E(C,F,Z){e=e||yv(),C=C||{},typeof Z!="boolean"&&(Z=F instanceof e),this.objectMode=!!C.objectMode,Z&&(this.objectMode=this.objectMode||!!C.writableObjectMode),this.highWaterMark=c(this,C,"writableHighWaterMark",Z),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var te=C.decodeStrings===!1;this.decodeStrings=!te,this.defaultEncoding=C.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(re){z(F,re)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=C.emitClose!==!1,this.autoDestroy=!!C.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}E.prototype.getBuffer=function(){for(var F=this.bufferedRequest,Z=[];F;)Z.push(F),F=F.next;return Z},function(){try{Object.defineProperty(E.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var S;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(S=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(F){return S.call(this,F)?!0:this!==T?!1:F&&F._writableState instanceof E}})):S=function(F){return F instanceof this};function T(C){e=e||yv();var F=this instanceof e;if(!F&&!S.call(T,this))return new T(C);this._writableState=new E(C,this,F),this.writable=!0,C&&(typeof C.write=="function"&&(this._write=C.write),typeof C.writev=="function"&&(this._writev=C.writev),typeof C.destroy=="function"&&(this._destroy=C.destroy),typeof C.final=="function"&&(this._final=C.final)),n.call(this)}T.prototype.pipe=function(){b(this,new y)};function O(C,F){var Z=new v;b(C,Z),process.nextTick(F,Z)}function M(C,F,Z,te){var re;return Z===null?re=new w:typeof Z!="string"&&!F.objectMode&&(re=new f("chunk",["string","Buffer"],Z)),re?(b(C,re),process.nextTick(te,re),!1):!0}T.prototype.write=function(C,F,Z){var te=this._writableState,re=!1,q=!te.objectMode&&a(C);return q&&!i.isBuffer(C)&&(C=s(C)),typeof F=="function"&&(Z=F,F=null),q?F="buffer":F||(F=te.defaultEncoding),typeof Z!="function"&&(Z=_),te.ending?O(this,Z):(q||M(this,te,C,Z))&&(te.pendingcb++,re=W(this,te,q,C,F,Z)),re},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var C=this._writableState;C.corked&&(C.corked--,!C.writing&&!C.corked&&!C.bufferProcessing&&C.bufferedRequest&&I(this,C))},T.prototype.setDefaultEncoding=function(F){if(typeof F=="string"&&(F=F.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((F+"").toLowerCase())>-1))throw new m(F);return this._writableState.defaultEncoding=F,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Q(C,F,Z){return!C.objectMode&&C.decodeStrings!==!1&&typeof F=="string"&&(F=i.from(F,Z)),F}Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function W(C,F,Z,te,re,q){if(!Z){var L=Q(F,te,re);te!==L&&(Z=!0,re="buffer",te=L)}var k=F.objectMode?1:te.length;F.length+=k;var B=F.length<F.highWaterMark;if(B||(F.needDrain=!0),F.writing||F.corked){var X=F.lastBufferedRequest;F.lastBufferedRequest={chunk:te,encoding:re,isBuf:Z,callback:q,next:null},X?X.next=F.lastBufferedRequest:F.bufferedRequest=F.lastBufferedRequest,F.bufferedRequestCount+=1}else U(C,F,!1,k,te,re,q);return B}function U(C,F,Z,te,re,q,L){F.writelen=te,F.writecb=L,F.writing=!0,F.sync=!0,F.destroyed?F.onwrite(new g("write")):Z?C._writev(re,F.onwrite):C._write(re,q,F.onwrite),F.sync=!1}function ee(C,F,Z,te,re){--F.pendingcb,Z?(process.nextTick(re,te),process.nextTick(J,C,F),C._writableState.errorEmitted=!0,b(C,te)):(re(te),C._writableState.errorEmitted=!0,b(C,te),J(C,F))}function R(C){C.writing=!1,C.writecb=null,C.length-=C.writelen,C.writelen=0}function z(C,F){var Z=C._writableState,te=Z.sync,re=Z.writecb;if(typeof re!="function")throw new p;if(R(Z),F)ee(C,Z,te,F,re);else{var q=D(Z)||C.destroyed;!q&&!Z.corked&&!Z.bufferProcessing&&Z.bufferedRequest&&I(C,Z),te?process.nextTick(K,C,Z,q,re):K(C,Z,q,re)}}function K(C,F,Z,te){Z||Y(C,F),F.pendingcb--,te(),J(C,F)}function Y(C,F){F.length===0&&F.needDrain&&(F.needDrain=!1,C.emit("drain"))}function I(C,F){F.bufferProcessing=!0;var Z=F.bufferedRequest;if(C._writev&&Z&&Z.next){var te=F.bufferedRequestCount,re=new Array(te),q=F.corkedRequestsFree;q.entry=Z;for(var L=0,k=!0;Z;)re[L]=Z,Z.isBuf||(k=!1),Z=Z.next,L+=1;re.allBuffers=k,U(C,F,!0,F.length,re,"",q.finish),F.pendingcb++,F.lastBufferedRequest=null,q.next?(F.corkedRequestsFree=q.next,q.next=null):F.corkedRequestsFree=new r(F),F.bufferedRequestCount=0}else{for(;Z;){var B=Z.chunk,X=Z.encoding,ne=Z.callback,ae=F.objectMode?1:B.length;if(U(C,F,!1,ae,B,X,ne),Z=Z.next,F.bufferedRequestCount--,F.writing)break}Z===null&&(F.lastBufferedRequest=null)}F.bufferedRequest=Z,F.bufferProcessing=!1}T.prototype._write=function(C,F,Z){Z(new h("_write()"))},T.prototype._writev=null,T.prototype.end=function(C,F,Z){var te=this._writableState;return typeof C=="function"?(Z=C,C=null,F=null):typeof F=="function"&&(Z=F,F=null),C!=null&&this.write(C,F),te.corked&&(te.corked=1,this.uncork()),te.ending||j(this,te,Z),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function D(C){return C.ending&&C.length===0&&C.bufferedRequest===null&&!C.finished&&!C.writing}function N(C,F){C._final(function(Z){F.pendingcb--,Z&&b(C,Z),F.prefinished=!0,C.emit("prefinish"),J(C,F)})}function V(C,F){!F.prefinished&&!F.finalCalled&&(typeof C._final=="function"&&!F.destroyed?(F.pendingcb++,F.finalCalled=!0,process.nextTick(N,C,F)):(F.prefinished=!0,C.emit("prefinish")))}function J(C,F){var Z=D(F);if(Z&&(V(C,F),F.pendingcb===0&&(F.finished=!0,C.emit("finish"),F.autoDestroy))){var te=C._readableState;(!te||te.autoDestroy&&te.endEmitted)&&C.destroy()}return Z}function j(C,F,Z){F.ending=!0,J(C,F),Z&&(F.finished?process.nextTick(Z):C.once("finish",Z)),F.ended=!0,C.writable=!1}function G(C,F,Z){var te=C.entry;for(C.entry=null;te;){var re=te.callback;F.pendingcb--,re(Z),te=te.next}F.corkedRequestsFree.next=C}return Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(F){this._writableState&&(this._writableState.destroyed=F)}}),T.prototype.destroy=l.destroy,T.prototype._undestroy=l.undestroy,T.prototype._destroy=function(C,F){F(C)},Ck}var Rk,BN;function yv(){if(BN)return Rk;BN=1;var r=Object.keys||function(d){var c=[];for(var u in d)c.push(u);return c};Rk=s;var e=wH(),t=vH();l1(s,e);for(var n=r(t.prototype),i=0;i<n.length;i++){var o=n[i];s.prototype[o]||(s.prototype[o]=t.prototype[o])}function s(d){if(!(this instanceof s))return new s(d);e.call(this,d),t.call(this,d),this.allowHalfOpen=!0,d&&(d.readable===!1&&(this.readable=!1),d.writable===!1&&(this.writable=!1),d.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||process.nextTick(l,this)}function l(d){d.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(c){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=c,this._writableState.destroyed=c)}}),Rk}var jN=lm.codes.ERR_STREAM_PREMATURE_CLOSE;function f$e(r){var e=!1;return function(){if(!e){e=!0;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.apply(this,n)}}}function h$e(){}function p$e(r){return r.setHeader&&typeof r.abort=="function"}function bH(r,e,t){if(typeof e=="function")return bH(r,null,e);e||(e={}),t=f$e(t||h$e);var n=e.readable||e.readable!==!1&&r.readable,i=e.writable||e.writable!==!1&&r.writable,o=function(){r.writable||a()},s=r._writableState&&r._writableState.finished,a=function(){i=!1,s=!0,n||t.call(r)},l=r._readableState&&r._readableState.endEmitted,d=function(){n=!1,l=!0,i||t.call(r)},c=function(p){t.call(r,p)},u=function(){var p;if(n&&!l)return(!r._readableState||!r._readableState.ended)&&(p=new jN),t.call(r,p);if(i&&!s)return(!r._writableState||!r._writableState.ended)&&(p=new jN),t.call(r,p)},f=function(){r.req.on("finish",a)};return p$e(r)?(r.on("complete",a),r.on("abort",u),r.req?f():r.on("request",f)):i&&!r._writableState&&(r.on("end",o),r.on("close",o)),r.on("end",d),r.on("finish",a),e.error!==!1&&r.on("error",c),r.on("close",u),function(){r.removeListener("complete",a),r.removeListener("abort",u),r.removeListener("request",f),r.req&&r.req.removeListener("finish",a),r.removeListener("end",o),r.removeListener("close",o),r.removeListener("finish",a),r.removeListener("end",d),r.removeListener("error",c),r.removeListener("close",u)}}var a6=bH,Dk,NN;function y$e(){if(NN)return Dk;NN=1;var r;function e(m,b,_){return b=t(b),b in m?Object.defineProperty(m,b,{value:_,enumerable:!0,configurable:!0,writable:!0}):m[b]=_,m}function t(m){var b=n(m,"string");return typeof b=="symbol"?b:String(b)}function n(m,b){if(typeof m!="object"||m===null)return m;var _=m[Symbol.toPrimitive];if(_!==void 0){var E=_.call(m,b||"default");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(m)}var i=a6,o=Symbol("lastResolve"),s=Symbol("lastReject"),a=Symbol("error"),l=Symbol("ended"),d=Symbol("lastPromise"),c=Symbol("handlePromise"),u=Symbol("stream");function f(m,b){return{value:m,done:b}}function h(m){var b=m[o];if(b!==null){var _=m[u].read();_!==null&&(m[d]=null,m[o]=null,m[s]=null,b(f(_,!1)))}}function p(m){process.nextTick(h,m)}function y(m,b){return function(_,E){m.then(function(){if(b[l]){_(f(void 0,!0));return}b[c](_,E)},E)}}var g=Object.getPrototypeOf(function(){}),w=Object.setPrototypeOf((r={get stream(){return this[u]},next:function(){var b=this,_=this[a];if(_!==null)return Promise.reject(_);if(this[l])return Promise.resolve(f(void 0,!0));if(this[u].destroyed)return new Promise(function(O,M){process.nextTick(function(){b[a]?M(b[a]):O(f(void 0,!0))})});var E=this[d],S;if(E)S=new Promise(y(E,this));else{var T=this[u].read();if(T!==null)return Promise.resolve(f(T,!1));S=new Promise(this[c])}return this[d]=S,S}},e(r,Symbol.asyncIterator,function(){return this}),e(r,"return",function(){var b=this;return new Promise(function(_,E){b[u].destroy(null,function(S){if(S){E(S);return}_(f(void 0,!0))})})}),r),g),v=function(b){var _,E=Object.create(w,(_={},e(_,u,{value:b,writable:!0}),e(_,o,{value:null,writable:!0}),e(_,s,{value:null,writable:!0}),e(_,a,{value:null,writable:!0}),e(_,l,{value:b._readableState.endEmitted,writable:!0}),e(_,c,{value:function(T,O){var M=E[u].read();M?(E[d]=null,E[o]=null,E[s]=null,T(f(M,!1))):(E[o]=T,E[s]=O)},writable:!0}),_));return E[d]=null,i(b,function(S){if(S&&S.code!=="ERR_STREAM_PREMATURE_CLOSE"){var T=E[s];T!==null&&(E[d]=null,E[o]=null,E[s]=null,T(S)),E[a]=S;return}var O=E[o];O!==null&&(E[d]=null,E[o]=null,E[s]=null,O(f(void 0,!0))),E[l]=!0}),b.on("readable",p.bind(null,E)),E};return Dk=v,Dk}var Mk,UN;function m$e(){return UN||(UN=1,Mk=function(){throw new Error("Readable.from is not available in the browser")}),Mk}var Bk,LN;function wH(){if(LN)return Bk;LN=1,Bk=O;var r;O.ReadableState=T,dd.EventEmitter;var e=function(L,k){return L.listeners(k).length},t=pH,n=Dn.Buffer,i=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(q){return n.from(q)}function s(q){return n.isBuffer(q)||q instanceof i}var a=lC,l;a&&a.debuglog?l=a.debuglog("stream"):l=function(){};var d=QTe(),c=yH,u=gH,f=u.getHighWaterMark,h=lm.codes,p=h.ERR_INVALID_ARG_TYPE,y=h.ERR_STREAM_PUSH_AFTER_EOF,g=h.ERR_METHOD_NOT_IMPLEMENTED,w=h.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,v,m,b;l1(O,t);var _=c.errorOrDestroy,E=["error","close","destroy","pause","resume"];function S(q,L,k){if(typeof q.prependListener=="function")return q.prependListener(L,k);!q._events||!q._events[L]?q.on(L,k):Array.isArray(q._events[L])?q._events[L].unshift(k):q._events[L]=[k,q._events[L]]}function T(q,L,k){r=r||yv(),q=q||{},typeof k!="boolean"&&(k=L instanceof r),this.objectMode=!!q.objectMode,k&&(this.objectMode=this.objectMode||!!q.readableObjectMode),this.highWaterMark=f(this,q,"readableHighWaterMark",k),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=q.emitClose!==!1,this.autoDestroy=!!q.autoDestroy,this.destroyed=!1,this.defaultEncoding=q.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,q.encoding&&(v||(v=Tw.StringDecoder),this.decoder=new v(q.encoding),this.encoding=q.encoding)}function O(q){if(r=r||yv(),!(this instanceof O))return new O(q);var L=this instanceof r;this._readableState=new T(q,this,L),this.readable=!0,q&&(typeof q.read=="function"&&(this._read=q.read),typeof q.destroy=="function"&&(this._destroy=q.destroy)),t.call(this)}Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(L){this._readableState&&(this._readableState.destroyed=L)}}),O.prototype.destroy=c.destroy,O.prototype._undestroy=c.undestroy,O.prototype._destroy=function(q,L){L(q)},O.prototype.push=function(q,L){var k=this._readableState,B;return k.objectMode?B=!0:typeof q=="string"&&(L=L||k.defaultEncoding,L!==k.encoding&&(q=n.from(q,L),L=""),B=!0),M(this,q,L,!1,B)},O.prototype.unshift=function(q){return M(this,q,null,!0,!1)};function M(q,L,k,B,X){l("readableAddChunk",L);var ne=q._readableState;if(L===null)ne.reading=!1,z(q,ne);else{var ae;if(X||(ae=W(ne,L)),ae)_(q,ae);else if(ne.objectMode||L&&L.length>0)if(typeof L!="string"&&!ne.objectMode&&Object.getPrototypeOf(L)!==n.prototype&&(L=o(L)),B)ne.endEmitted?_(q,new w):Q(q,ne,L,!0);else if(ne.ended)_(q,new y);else{if(ne.destroyed)return!1;ne.reading=!1,ne.decoder&&!k?(L=ne.decoder.write(L),ne.objectMode||L.length!==0?Q(q,ne,L,!1):I(q,ne)):Q(q,ne,L,!1)}else B||(ne.reading=!1,I(q,ne))}return!ne.ended&&(ne.length<ne.highWaterMark||ne.length===0)}function Q(q,L,k,B){L.flowing&&L.length===0&&!L.sync?(L.awaitDrain=0,q.emit("data",k)):(L.length+=L.objectMode?1:k.length,B?L.buffer.unshift(k):L.buffer.push(k),L.needReadable&&K(q)),I(q,L)}function W(q,L){var k;return!s(L)&&typeof L!="string"&&L!==void 0&&!q.objectMode&&(k=new p("chunk",["string","Buffer","Uint8Array"],L)),k}O.prototype.isPaused=function(){return this._readableState.flowing===!1},O.prototype.setEncoding=function(q){v||(v=Tw.StringDecoder);var L=new v(q);this._readableState.decoder=L,this._readableState.encoding=this._readableState.decoder.encoding;for(var k=this._readableState.buffer.head,B="";k!==null;)B+=L.write(k.data),k=k.next;return this._readableState.buffer.clear(),B!==""&&this._readableState.buffer.push(B),this._readableState.length=B.length,this};var U=1073741824;function ee(q){return q>=U?q=U:(q--,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,q|=q>>>16,q++),q}function R(q,L){return q<=0||L.length===0&&L.ended?0:L.objectMode?1:q!==q?L.flowing&&L.length?L.buffer.head.data.length:L.length:(q>L.highWaterMark&&(L.highWaterMark=ee(q)),q<=L.length?q:L.ended?L.length:(L.needReadable=!0,0))}O.prototype.read=function(q){l("read",q),q=parseInt(q,10);var L=this._readableState,k=q;if(q!==0&&(L.emittedReadable=!1),q===0&&L.needReadable&&((L.highWaterMark!==0?L.length>=L.highWaterMark:L.length>0)||L.ended))return l("read: emitReadable",L.length,L.ended),L.length===0&&L.ended?Z(this):K(this),null;if(q=R(q,L),q===0&&L.ended)return L.length===0&&Z(this),null;var B=L.needReadable;l("need readable",B),(L.length===0||L.length-q<L.highWaterMark)&&(B=!0,l("length less than watermark",B)),L.ended||L.reading?(B=!1,l("reading or ended",B)):B&&(l("do read"),L.reading=!0,L.sync=!0,L.length===0&&(L.needReadable=!0),this._read(L.highWaterMark),L.sync=!1,L.reading||(q=R(k,L)));var X;return q>0?X=F(q,L):X=null,X===null?(L.needReadable=L.length<=L.highWaterMark,q=0):(L.length-=q,L.awaitDrain=0),L.length===0&&(L.ended||(L.needReadable=!0),k!==q&&L.ended&&Z(this)),X!==null&&this.emit("data",X),X};function z(q,L){if(l("onEofChunk"),!L.ended){if(L.decoder){var k=L.decoder.end();k&&k.length&&(L.buffer.push(k),L.length+=L.objectMode?1:k.length)}L.ended=!0,L.sync?K(q):(L.needReadable=!1,L.emittedReadable||(L.emittedReadable=!0,Y(q)))}}function K(q){var L=q._readableState;l("emitReadable",L.needReadable,L.emittedReadable),L.needReadable=!1,L.emittedReadable||(l("emitReadable",L.flowing),L.emittedReadable=!0,process.nextTick(Y,q))}function Y(q){var L=q._readableState;l("emitReadable_",L.destroyed,L.length,L.ended),!L.destroyed&&(L.length||L.ended)&&(q.emit("readable"),L.emittedReadable=!1),L.needReadable=!L.flowing&&!L.ended&&L.length<=L.highWaterMark,C(q)}function I(q,L){L.readingMore||(L.readingMore=!0,process.nextTick(D,q,L))}function D(q,L){for(;!L.reading&&!L.ended&&(L.length<L.highWaterMark||L.flowing&&L.length===0);){var k=L.length;if(l("maybeReadMore read 0"),q.read(0),k===L.length)break}L.readingMore=!1}O.prototype._read=function(q){_(this,new g("_read()"))},O.prototype.pipe=function(q,L){var k=this,B=this._readableState;switch(B.pipesCount){case 0:B.pipes=q;break;case 1:B.pipes=[B.pipes,q];break;default:B.pipes.push(q);break}B.pipesCount+=1,l("pipe count=%d opts=%j",B.pipesCount,L);var X=(!L||L.end!==!1)&&q!==process.stdout&&q!==process.stderr,ne=X?ye:ce;B.endEmitted?process.nextTick(ne):k.once("end",ne),q.on("unpipe",ae);function ae(H,$){l("onunpipe"),H===k&&$&&$.hasUnpiped===!1&&($.hasUnpiped=!0,Ce())}function ye(){l("onend"),q.end()}var _e=N(k);q.on("drain",_e);var $e=!1;function Ce(){l("cleanup"),q.removeListener("close",ht),q.removeListener("finish",ie),q.removeListener("drain",_e),q.removeListener("error",ze),q.removeListener("unpipe",ae),k.removeListener("end",ye),k.removeListener("end",ce),k.removeListener("data",Te),$e=!0,B.awaitDrain&&(!q._writableState||q._writableState.needDrain)&&_e()}k.on("data",Te);function Te(H){l("ondata");var $=q.write(H);l("dest.write",$),$===!1&&((B.pipesCount===1&&B.pipes===q||B.pipesCount>1&&re(B.pipes,q)!==-1)&&!$e&&(l("false write response, pause",B.awaitDrain),B.awaitDrain++),k.pause())}function ze(H){l("onerror",H),ce(),q.removeListener("error",ze),e(q,"error")===0&&_(q,H)}S(q,"error",ze);function ht(){q.removeListener("finish",ie),ce()}q.once("close",ht);function ie(){l("onfinish"),q.removeListener("close",ht),ce()}q.once("finish",ie);function ce(){l("unpipe"),k.unpipe(q)}return q.emit("pipe",k),B.flowing||(l("pipe resume"),k.resume()),q};function N(q){return function(){var k=q._readableState;l("pipeOnDrain",k.awaitDrain),k.awaitDrain&&k.awaitDrain--,k.awaitDrain===0&&e(q,"data")&&(k.flowing=!0,C(q))}}O.prototype.unpipe=function(q){var L=this._readableState,k={hasUnpiped:!1};if(L.pipesCount===0)return this;if(L.pipesCount===1)return q&&q!==L.pipes?this:(q||(q=L.pipes),L.pipes=null,L.pipesCount=0,L.flowing=!1,q&&q.emit("unpipe",this,k),this);if(!q){var B=L.pipes,X=L.pipesCount;L.pipes=null,L.pipesCount=0,L.flowing=!1;for(var ne=0;ne<X;ne++)B[ne].emit("unpipe",this,{hasUnpiped:!1});return this}var ae=re(L.pipes,q);return ae===-1?this:(L.pipes.splice(ae,1),L.pipesCount-=1,L.pipesCount===1&&(L.pipes=L.pipes[0]),q.emit("unpipe",this,k),this)},O.prototype.on=function(q,L){var k=t.prototype.on.call(this,q,L),B=this._readableState;return q==="data"?(B.readableListening=this.listenerCount("readable")>0,B.flowing!==!1&&this.resume()):q==="readable"&&!B.endEmitted&&!B.readableListening&&(B.readableListening=B.needReadable=!0,B.flowing=!1,B.emittedReadable=!1,l("on readable",B.length,B.reading),B.length?K(this):B.reading||process.nextTick(J,this)),k},O.prototype.addListener=O.prototype.on,O.prototype.removeListener=function(q,L){var k=t.prototype.removeListener.call(this,q,L);return q==="readable"&&process.nextTick(V,this),k},O.prototype.removeAllListeners=function(q){var L=t.prototype.removeAllListeners.apply(this,arguments);return(q==="readable"||q===void 0)&&process.nextTick(V,this),L};function V(q){var L=q._readableState;L.readableListening=q.listenerCount("readable")>0,L.resumeScheduled&&!L.paused?L.flowing=!0:q.listenerCount("data")>0&&q.resume()}function J(q){l("readable nexttick read 0"),q.read(0)}O.prototype.resume=function(){var q=this._readableState;return q.flowing||(l("resume"),q.flowing=!q.readableListening,j(this,q)),q.paused=!1,this};function j(q,L){L.resumeScheduled||(L.resumeScheduled=!0,process.nextTick(G,q,L))}function G(q,L){l("resume",L.reading),L.reading||q.read(0),L.resumeScheduled=!1,q.emit("resume"),C(q),L.flowing&&!L.reading&&q.read(0)}O.prototype.pause=function(){return l("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(l("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function C(q){var L=q._readableState;for(l("flow",L.flowing);L.flowing&&q.read()!==null;);}O.prototype.wrap=function(q){var L=this,k=this._readableState,B=!1;q.on("end",function(){if(l("wrapped end"),k.decoder&&!k.ended){var ae=k.decoder.end();ae&&ae.length&&L.push(ae)}L.push(null)}),q.on("data",function(ae){if(l("wrapped data"),k.decoder&&(ae=k.decoder.write(ae)),!(k.objectMode&&ae==null)&&!(!k.objectMode&&(!ae||!ae.length))){var ye=L.push(ae);ye||(B=!0,q.pause())}});for(var X in q)this[X]===void 0&&typeof q[X]=="function"&&(this[X]=function(ye){return function(){return q[ye].apply(q,arguments)}}(X));for(var ne=0;ne<E.length;ne++)q.on(E[ne],this.emit.bind(this,E[ne]));return this._read=function(ae){l("wrapped _read",ae),B&&(B=!1,q.resume())},this},typeof Symbol=="function"&&(O.prototype[Symbol.asyncIterator]=function(){return m===void 0&&(m=y$e()),m(this)}),Object.defineProperty(O.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(O.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(O.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(L){this._readableState&&(this._readableState.flowing=L)}}),O._fromList=F,Object.defineProperty(O.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function F(q,L){if(L.length===0)return null;var k;return L.objectMode?k=L.buffer.shift():!q||q>=L.length?(L.decoder?k=L.buffer.join(""):L.buffer.length===1?k=L.buffer.first():k=L.buffer.concat(L.length),L.buffer.clear()):k=L.buffer.consume(q,L.decoder),k}function Z(q){var L=q._readableState;l("endReadable",L.endEmitted),L.endEmitted||(L.ended=!0,process.nextTick(te,L,q))}function te(q,L){if(l("endReadableNT",q.endEmitted,q.length),!q.endEmitted&&q.length===0&&(q.endEmitted=!0,L.readable=!1,L.emit("end"),q.autoDestroy)){var k=L._writableState;(!k||k.autoDestroy&&k.finished)&&L.destroy()}}typeof Symbol=="function"&&(O.from=function(q,L){return b===void 0&&(b=m$e()),b(O,q,L)});function re(q,L){for(var k=0,B=q.length;k<B;k++)if(q[k]===L)return k;return-1}return Bk}var _H=Lu,sT=lm.codes,g$e=sT.ERR_METHOD_NOT_IMPLEMENTED,v$e=sT.ERR_MULTIPLE_CALLBACK,b$e=sT.ERR_TRANSFORM_ALREADY_TRANSFORMING,w$e=sT.ERR_TRANSFORM_WITH_LENGTH_0,aT=yv();l1(Lu,aT);function _$e(r,e){var t=this._transformState;t.transforming=!1;var n=t.writecb;if(n===null)return this.emit("error",new v$e);t.writechunk=null,t.writecb=null,e!=null&&this.push(e),n(r);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Lu(r){if(!(this instanceof Lu))return new Lu(r);aT.call(this,r),this._transformState={afterTransform:_$e.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",E$e)}function E$e(){var r=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,t){KN(r,e,t)}):KN(this,null,null)}Lu.prototype.push=function(r,e){return this._transformState.needTransform=!1,aT.prototype.push.call(this,r,e)};Lu.prototype._transform=function(r,e,t){t(new g$e("_transform()"))};Lu.prototype._write=function(r,e,t){var n=this._transformState;if(n.writecb=t,n.writechunk=r,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};Lu.prototype._read=function(r){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Lu.prototype._destroy=function(r,e){aT.prototype._destroy.call(this,r,function(t){e(t)})};function KN(r,e,t){if(e)return r.emit("error",e);if(t!=null&&r.push(t),r._writableState.length)throw new w$e;if(r._transformState.transforming)throw new b$e;return r.push(null)}var A$e=Qw,EH=_H;l1(Qw,EH);function Qw(r){if(!(this instanceof Qw))return new Qw(r);EH.call(this,r)}Qw.prototype._transform=function(r,e,t){t(null,r)};var jk;function x$e(r){var e=!1;return function(){e||(e=!0,r.apply(void 0,arguments))}}var AH=lm.codes,S$e=AH.ERR_MISSING_ARGS,T$e=AH.ERR_STREAM_DESTROYED;function zN(r){if(r)throw r}function $$e(r){return r.setHeader&&typeof r.abort=="function"}function k$e(r,e,t,n){n=x$e(n);var i=!1;r.on("close",function(){i=!0}),jk===void 0&&(jk=a6),jk(r,{readable:e,writable:t},function(s){if(s)return n(s);i=!0,n()});var o=!1;return function(s){if(!i&&!o){if(o=!0,$$e(r))return r.abort();if(typeof r.destroy=="function")return r.destroy();n(s||new T$e("pipe"))}}}function FN(r){r()}function P$e(r,e){return r.pipe(e)}function I$e(r){return!r.length||typeof r[r.length-1]!="function"?zN:r.pop()}function O$e(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=I$e(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new S$e("streams");var i,o=e.map(function(s,a){var l=a<e.length-1,d=a>0;return k$e(s,l,d,function(c){i||(i=c),c&&o.forEach(FN),!l&&(o.forEach(FN),n(i))})});return e.reduce(P$e)}var C$e=O$e;(function(r,e){e=r.exports=wH(),e.Stream=e,e.Readable=e,e.Writable=vH(),e.Duplex=yv(),e.Transform=_H,e.PassThrough=A$e,e.finished=a6,e.pipeline=C$e})(u5,u5.exports);var R$e=u5.exports;Object.defineProperty(s6,"__esModule",{value:!0});var xH=s6.ReadableWebToNodeStream=void 0;const D$e=R$e;class M$e extends D$e.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}async _read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read();const e=await this.pendingRead;delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}xH=s6.ReadableWebToNodeStream=M$e;var c6=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function qN(r){return p5(r.stream())}function SH(r,e){return c6(this,void 0,void 0,function*(){const t=yield e.dereference(`${r}#dwn`);if(t.dereferencingMetadata.error)throw new Error(`Failed to dereference '${r}#dwn': ${t.dereferencingMetadata.error}`);if(ATe(t.contentStream)){const{serviceEndpoint:n}=t.contentStream,i=typeof n=="string"?[n]:Array.isArray(n)&&n.every(o=>typeof o=="string")?n:[];if(i.length>0)return i}return[]})}function mv(r){return Oe.getAuthor(r)}function lw(r){return!r||typeof r!="object"||r===null?!1:"message"in r&&typeof r.message=="object"&&r.message!==null&&"descriptor"in r.message&&typeof r.message.descriptor=="object"&&r.message.descriptor!==null&&"interface"in r.message.descriptor&&r.message.descriptor.interface===Ge.Records&&"method"in r.message.descriptor&&r.message.descriptor.method===Le.Write}function B$e(r){return Oe.getCid(r)}function j$e(r,e){return c6(this,void 0,void 0,function*(){const t=e===Os.CreatedAscending||e===Os.CreatedDescending?r.descriptor.dateCreated:r.descriptor.datePublished;if(t===void 0)throw new Error("The dateCreated or datePublished property is missing from the record descriptor.");return{messageCid:yield B$e(r),value:t}})}function p5(r){return new xH(r)}function N$e(r,e=3e3,t=3e5,n){const i=Date.now()+t;let o=null,s=!0;return new Promise((a,l)=>{function d(){return c6(this,void 0,void 0,function*(){if(!s)return;const c=i-Date.now();if(c<=0){s=!1,console.log("Polling stopped: TTL reached"),a(null);return}console.log(`Polling... (Remaining time: ${Math.ceil(c/1e3)}s)`);try{const u=yield r();if(u.ok){s=!1,o!==null&&clearTimeout(o),console.log("Polling stopped: Success condition met"),a(u);return}}catch(u){console.error("Error fetching data:",u),l(u)}s&&(o=setTimeout(d,e))})}d()})}function ey(r,e){return r.endsWith("/")&&(r=r.slice(0,-1)),e.startsWith("/")&&(e=e.slice(1)),`${r}/${e}`}var Ud=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function U$e(r,e){return r.messageType===e}function Nk(r,e){return e.descriptor.interface+e.descriptor.method===r}function L$e(r){return r===Ke.RecordsDelete||r===Ke.RecordsQuery||r===Ke.RecordsRead||r===Ke.RecordsSubscribe||r===Ke.RecordsWrite}function K$e(r){return r.interface===Ge.Records}class VN{constructor({agent:e,dwn:t}){this._agent=e,this._dwn=t}get agent(){if(this._agent===void 0)throw new Error("AgentDwnApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}get node(){return this._dwn}static createDwn({dataPath:e,dataStore:t,didResolver:n,eventLog:i,eventStream:o,messageStore:s,tenantGate:a,resumableTaskStore:l}){return Ud(this,void 0,void 0,function*(){return t??(t=new FSe({blockstoreLocation:`${e}/DWN_DATASTORE`})),n??(n=new lH({didResolvers:[Xw,Wy],cache:new cH({location:`${e}/DID_RESOLVERCACHE`})})),i??(i=new eTe({location:`${e}/DWN_EVENTLOG`})),s??(s=new QD({blockstoreLocation:`${e}/DWN_MESSAGESTORE`,indexLocation:`${e}/DWN_MESSAGEINDEX`})),l??(l=new rT({location:`${e}/DWN_RESUMABLETASKSTORE`})),yield WD.create({dataStore:t,didResolver:n,eventLog:i,eventStream:o,messageStore:s,tenantGate:a,resumableTaskStore:l})})}processRequest(e){return Ud(this,void 0,void 0,function*(){const{message:t,dataStream:n}=yield this.constructDwnMessage({request:e}),{subscriptionHandler:i}=e;return{reply:e.store!==!1?yield this._dwn.processMessage(e.target,t,{dataStream:n,subscriptionHandler:i}):{status:{code:202,detail:"Accepted"}},message:t,messageCid:yield Oe.getCid(t)}})}sendRequest(e){return Ud(this,void 0,void 0,function*(){const t=yield SH(e.target,this.agent.did);if(t.length===0)throw new Error(`AgentDwnApi: DID Service is missing or malformed: ${e.target}#dwn`);let n,i,o,s;if("messageCid"in e)({message:i,data:o}=yield this.getDwnMessage({author:e.author,messageCid:e.messageCid,messageType:e.messageType})),n=e.messageCid;else{if({message:i}=yield this.constructDwnMessage({request:e}),e.dataStream&&!(e.dataStream instanceof Blob))throw new Error("AgentDwnApi: DataStream must be provided as a Blob");o=e.dataStream,s=e.subscriptionHandler}const a=yield this.sendDwnRpcRequest({targetDid:e.target,dwnEndpointUrls:t,message:i,data:o,subscriptionHandler:s});return n??(n=yield Oe.getCid(i)),{reply:a,message:i,messageCid:n}})}sendDwnRpcRequest({targetDid:e,dwnEndpointUrls:t,message:n,data:i,subscriptionHandler:o}){return Ud(this,void 0,void 0,function*(){const s=[];if(n.descriptor.method===Le.Subscribe&&o===void 0)throw new Error("AgentDwnApi: Subscription handler is required for subscription requests.");for(let a of t)try{if(o!==void 0){if(!(yield this.agent.rpc.getServerInfo(a)).webSocketSupport){s.push({url:a,message:"WebSocket support is not enabled on the server."});continue}const c=new URL(a);c.protocol=c.protocol==="http:"?"ws:":"wss:",a=c.toString()}return yield this.agent.rpc.sendDwnRequest({dwnUrl:a,targetDid:e,message:n,data:i,subscriptionHandler:o})}catch(l){s.push({url:a,message:l instanceof Error?l.message:"Unknown error"})}throw new Error(`Failed to send DWN RPC request: ${JSON.stringify(s)}`)})}constructDwnMessage({request:e}){var t;return Ud(this,void 0,void 0,function*(){if(e.granteeDid&&!this.hasGrantParams(e.messageParams))throw new Error("AgentDwnApi: Requested to sign with a permission but no grant messageParams were provided in the request");const n=e.rawMessage;let i;if(U$e(e,Ke.RecordsWrite)){const a=e.messageParams;if(e.dataStream&&!a?.data){const{dataStream:l}=e;let d;if(l instanceof Blob)d=qN(l),i=qN(l);else if(l instanceof ReadableStream){const[c,u]=l.tee();d=p5(c),i=p5(u)}n||(a.dataCid=yield _i.computeDagPbCidFromStream(d),(t=a.dataSize)!==null&&t!==void 0||(a.dataSize=d.bytesRead))}}let o;const s=vN[e.messageType];if(n){if(o=yield s.parse(n),lw(o)&&e.signAsOwner){const a=yield this.getSigner(e.author);yield o.signAsOwner(a)}else if(e.granteeDid&&lw(o)&&e.signAsOwnerDelegate){const a=yield this.getSigner(e.granteeDid),l=e.messageParams;yield o.signAsOwnerDelegate(a,l.delegatedGrant)}}else{const a=e.granteeDid?yield this.getSigner(e.granteeDid):yield this.getSigner(e.author);o=yield s.create(Object.assign(Object.assign({},e.messageParams),{signer:a}))}return{message:o.message,dataStream:i}})}hasGrantParams(e){return e!==void 0&&("permissionGrantId"in e&&e.permissionGrantId!==void 0||"delegatedGrant"in e&&e.delegatedGrant!==void 0)}getSigner(e){return Ud(this,void 0,void 0,function*(){if(e===this.agent.agentDid.uri){const t=yield this.agent.agentDid.getSigner();return{algorithm:t.algorithm,keyId:t.keyId,sign:n=>Ud(this,void 0,void 0,function*(){return yield t.sign({data:n})})}}else try{const t=yield this.agent.did.getSigningMethod({didUri:e});if(!t.publicKeyJwk)throw new Error(`Verification method '${t.id}' does not contain a public key in JWK format`);const n=yield this.agent.keyManager.getKeyUri({key:t.publicKeyJwk}),i=yield this.agent.keyManager.getPublicKey({keyUri:n}),o=this.agent.keyManager;return{algorithm:wo.getJoseSignatureAlgorithmFromPublicKey(i),keyId:t.id,sign:s=>Ud(this,void 0,void 0,function*(){return yield o.sign({data:s,keyUri:n})})}}catch(t){throw new Error(`AgentDwnApi: Unable to get signer for author '${e}': ${t.message}`)}})}getDwnMessage({author:e,messageCid:t}){return Ud(this,void 0,void 0,function*(){const n=yield this.getSigner(e),i=yield vN[Ke.MessagesRead].create({messageCid:t,signer:n}),o=yield this._dwn.processMessage(e,i.message);if(o.status.code!==200)throw new Error(`AgentDwnApi: Failed to read message, response status: ${o.status.code} - ${o.status.detail}`);const s=o.entry;let l={message:s.message};if(lw(s)&&s.data){const d=yield lo.consumeToBytes({readable:s.data});l.data=new Blob([d],{type:s.message.descriptor.dataFormat})}return l})}}var I2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class vh{static registerTenant(e,t){return I2(this,void 0,void 0,function*(){const n=ey(e,"registration"),i=ey(n,"terms-of-service"),o=ey(n,"proof-of-work"),s=yield fetch(i,{method:"GET"});if(s.status!==200){const y=s.status,g=s.statusText,w=yield s.text();throw new Error(`Failed fetching terms-of-service: ${y} ${g}: ${w}`)}const a=yield s.text(),l=yield fetch(o,{method:"GET"}),{challengeNonce:d,maximumAllowedHashValue:c}=yield l.json(),u={did:t,termsOfServiceHash:yield vh.hashAsHexString(a)},f=yield vh.findQualifiedResponseNonce({challengeNonce:d,maximumAllowedHashValue:c,requestData:JSON.stringify(u)}),p=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({registrationData:u,proofOfWork:{challengeNonce:d,responseNonce:f}})});if(p.status!==200){const y=p.status,g=p.statusText,w=yield p.text();throw new Error(`Registration failed: ${y} ${g}: ${w}`)}})}static hashAsHexString(e){return I2(this,void 0,void 0,function*(){const t=yield nT.digest({data:ge.string(e).toUint8Array()});return ge.uint8Array(t).toHex()})}static findQualifiedResponseNonce(e){return I2(this,void 0,void 0,function*(){const t=Date.now(),{maximumAllowedHashValue:n,challengeNonce:i,requestData:o}=e,s=BigInt(`0x${n}`);let a=1,l,d=!1;do{l=yield this.generateNonce();const c=yield vh.hashAsHexString(i+l+o);d=BigInt(`0x${c}`)<=s,a++}while(!d);return console.log(`iterations: ${a}, time lapsed: ${Date.now()-t} ms`),l})}static generateNonce(){return I2(this,void 0,void 0,function*(){const e=wo.randomBytes(32);return ge.uint8Array(e).toHex().toUpperCase()})}}const z$e=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),TH=Uint8Array.from({length:16},(r,e)=>e),F$e=TH.map(r=>(9*r+5)%16);let l6=[TH],d6=[F$e];for(let r=0;r<4;r++)for(let e of[l6,d6])e.push(e[r].map(t=>z$e[t]));const $H=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(r=>new Uint8Array(r)),q$e=l6.map((r,e)=>r.map(t=>$H[e][t])),V$e=d6.map((r,e)=>r.map(t=>$H[e][t])),W$e=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),H$e=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),O2=(r,e)=>r<<e|r>>>32-e;function WN(r,e,t,n){return r===0?e^t^n:r===1?e&t|~e&n:r===2?(e|~t)^n:r===3?e&n|t&~n:e^(t|~n)}const C2=new Uint32Array(16);class G$e extends PD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:n,h3:i,h4:o}=this;return[e,t,n,i,o]}set(e,t,n,i,o){this.h0=e|0,this.h1=t|0,this.h2=n|0,this.h3=i|0,this.h4=o|0}process(e,t){for(let h=0;h<16;h++,t+=4)C2[h]=e.getUint32(t,!0);let n=this.h0|0,i=n,o=this.h1|0,s=o,a=this.h2|0,l=a,d=this.h3|0,c=d,u=this.h4|0,f=u;for(let h=0;h<5;h++){const p=4-h,y=W$e[h],g=H$e[h],w=l6[h],v=d6[h],m=q$e[h],b=V$e[h];for(let _=0;_<16;_++){const E=O2(n+WN(h,o,a,d)+C2[w[_]]+y,m[_])+u|0;n=u,u=d,d=O2(a,10)|0,a=o,o=E}for(let _=0;_<16;_++){const E=O2(i+WN(p,s,l,c)+C2[v[_]]+g,b[_])+f|0;i=f,f=c,c=O2(l,10)|0,l=s,s=E}}this.set(this.h1+a+c|0,this.h2+d+f|0,this.h3+u+i|0,this.h4+n+s|0,this.h0+o+l|0)}roundClean(){C2.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const Y$e=kD(()=>new G$e);/*! micro-ed25519-hdkey - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Z$e=$D("ed25519 seed"),Uk=2147483648,HN=new Uint8Array([0]);function GN(r,...e){return typeof r=="string"&&(r=nEe(r)),nv(r,...e),r}const J$e=r=>Y$e(Bu(r)),X$e=r=>wg(r).getUint32(0,!1),Lk=r=>{if(!Number.isSafeInteger(r)||r<0||r>2**32-1)throw new Error(`Invalid number=${r}. Should be from 0 to 2 ** 32 - 1`);const e=new Uint8Array(4);return wg(e).setUint32(0,r,!1),e};class ix{get publicKeyRaw(){return Cn.getPublicKey(this.privateKey)}get publicKey(){return JA(HN,this.publicKeyRaw)}get pubHash(){return J$e(this.publicKey)}get fingerprint(){return X$e(this.pubHash)}get fingerprintHex(){return w4(Lk(this.fingerprint))}get parentFingerprintHex(){return w4(Lk(this.parentFingerprint))}static fromMasterSeed(e){if(e=GN(e),8*e.length<128||8*e.length>512)throw new Error(`HDKey: wrong seed length=${e.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const t=zw(Fw,Z$e,e);return new ix({privateKey:t.slice(0,32),chainCode:t.slice(32)})}constructor(e){if(this.depth=0,this.index=0,this.parentFingerprint=0,!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(nv(e.privateKey,32),nv(e.chainCode,32),this.depth=e.depth||0,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");this.chainCode=e.chainCode,this.privateKey=e.privateKey}derive(e,t=!1){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const n=e.replace(/^[mM]'?\//,"").split("/");let i=this;for(const o of n){const s=/^(\d+)('?)$/.exec(o);if(!s||s.length!==3)throw new Error(`Invalid child index: ${o}`);let a=+s[1];if(!Number.isSafeInteger(a)||a>=Uk)throw new Error("Invalid index");(t||s[2]==="'")&&(a+=Uk),i=i.deriveChild(a)}return i}deriveChild(e){if(e<Uk)throw new Error(`Non-hardened child derivation not possible for Ed25519 (index=${e})`);const t=JA(HN,this.privateKey,Lk(e)),n=zw(Fw,this.chainCode,t);return new ix({chainCode:n.slice(32),depth:this.depth+1,parentFingerprint:this.fingerprint,index:e,privateKey:n.slice(0,32)})}sign(e){return Cn.sign(e,this.privateKey)}verify(e,t){return t=GN(t,64),Cn.verify(t,e,this.publicKeyRaw)}}const YN=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);function Q$e(r,e,t,n){YV(r);const i=aEe({dkLen:32,asyncTick:10},n),{c:o,dkLen:s,asyncTick:a}=i;if(bg(o),bg(s),bg(a),o<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const l=Kw(e),d=Kw(t),c=new Uint8Array(s),u=zw.create(r,l),f=u._cloneInto().update(d);return{c:o,dkLen:s,asyncTick:a,DK:c,PRF:u,PRFSalt:f}}function eke(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),i.fill(0),t}async function tke(r,e,t,n){const{c:i,dkLen:o,asyncTick:s,DK:a,PRF:l,PRFSalt:d}=Q$e(r,e,t,n);let c;const u=new Uint8Array(4),f=wg(u),h=new Uint8Array(l.outputLen);for(let p=1,y=0;y<o;p++,y+=l.outputLen){const g=a.subarray(y,y+l.outputLen);f.setInt32(0,p,!1),(c=d._cloneInto(c)).update(u).digestInto(h),g.set(h.subarray(0,g.length)),await oEe(i-1,s,()=>{l._cloneInto(c).update(h).digestInto(h);for(let w=0;w<g.length;w++)g[w]^=h[w]})}return eke(l,d,a,c,h)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ox(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function rke(...r){const e=o=>o,t=(o,s)=>a=>o(s(a)),n=r.map(o=>o.encode).reduceRight(t,e),i=r.map(o=>o.decode).reduce(t,e);return{encode:n,decode:i}}function nke(r){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(t=>{if(t<0||t>=r.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${r.length})`);return r[t]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(t=>{if(typeof t!="string")throw new Error(`alphabet.decode: not string element=${t}`);const n=r.indexOf(t);if(n===-1)throw new Error(`Unknown letter: "${t}". Allowed: ${r}`);return n})}}}function ike(r=""){if(typeof r!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let t of e)if(typeof t!="string")throw new Error(`join.encode: non-string input=${t}`);return e.join(r)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(r)}}}function oke(r,e="="){if(typeof e!="string")throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`padding.encode: non-string input=${n}`);for(;t.length*r%8;)t.push(e);return t},decode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of t)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let n=t.length;if(n*r%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&t[n-1]===e;n--)if(!((n-1)*r%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,n)}}}function y5(r,e,t){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(t<2)throw new Error(`convertRadix: wrong to=${t}, base cannot be less than 2`);if(!Array.isArray(r))throw new Error("convertRadix: data should be array");if(!r.length)return[];let n=0;const i=[],o=Array.from(r);for(o.forEach(s=>{if(s<0||s>=e)throw new Error(`Wrong integer: ${s}`)});;){let s=0,a=!0;for(let l=n;l<o.length;l++){const d=o[l],c=e*s+d;if(!Number.isSafeInteger(c)||e*s/e!==s||c-d!==e*s)throw new Error("convertRadix: carry overflow");s=c%t;const u=Math.floor(c/t);if(o[l]=u,!Number.isSafeInteger(u)||u*t+s!==c)throw new Error("convertRadix: carry overflow");if(a)u?a=!1:n=l;else continue}if(i.push(s),a)break}for(let s=0;s<r.length-1&&r[s]===0;s++)i.push(0);return i.reverse()}const kH=(r,e)=>e?kH(e,r%e):r,sx=(r,e)=>r+(e-kH(r,e));function m5(r,e,t,n){if(!Array.isArray(r))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(sx(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${sx(e,t)}`);let i=0,o=0;const s=2**t-1,a=[];for(const l of r){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=t;o-=t)a.push((i>>o-t&s)>>>0);i&=2**o-1}if(i=i<<t-o&s,!n&&o>=e)throw new Error("Excess padding");if(!n&&i)throw new Error(`Non-zero padding: ${i}`);return n&&o>0&&a.push(i>>>0),a}function ske(r){return{encode:e=>{if(!ox(e))throw new Error("radix.encode input should be Uint8Array");return y5(Array.from(e),2**8,r)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(y5(e,r,2**8))}}}function ake(r,e=!1){if(r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(sx(8,r)>32||sx(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!ox(t))throw new Error("radix2.encode input should be Uint8Array");return m5(Array.from(t),8,r,!e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(m5(t,r,8,e))}}}function cke(r,e){if(typeof e!="function")throw new Error("checksum fn should be function");return{encode(t){if(!ox(t))throw new Error("checksum.encode: input should be Uint8Array");const n=e(t).slice(0,r),i=new Uint8Array(t.length+r);return i.set(t),i.set(n,t.length),i},decode(t){if(!ox(t))throw new Error("checksum.decode: input should be Uint8Array");const n=t.slice(0,-r),i=e(n).slice(0,r),o=t.slice(-r);for(let s=0;s<r;s++)if(i[s]!==o[s])throw new Error("Invalid checksum");return n}}}const R2={alphabet:nke,chain:rke,checksum:cke,convertRadix:y5,convertRadix2:m5,radix:ske,radix2:ake,join:ike,padding:oke};/*! scure-bip39 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const lke=r=>r[0]==="";function PH(r){if(typeof r!="string")throw new TypeError(`Invalid mnemonic type: ${typeof r}`);return r.normalize("NFKD")}function IH(r){const e=PH(r),t=e.split(" ");if(![12,15,18,21,24].includes(t.length))throw new Error("Invalid mnemonic");return{nfkd:e,words:t}}function OH(r){nv(r,16,20,24,28,32)}function dke(r,e=128){if(bg(e),e%32!==0||e>256)throw new TypeError("Invalid entropy");return hke(YS(e/8),r)}const uke=r=>{const e=8-r.length/4;return new Uint8Array([Bu(r)[0]>>e<<e])};function CH(r){if(!Array.isArray(r)||r.length!==2048||typeof r[0]!="string")throw new Error("Wordlist: expected array of 2048 strings");return r.forEach(e=>{if(typeof e!="string")throw new Error(`Wordlist: non-string element: ${e}`)}),R2.chain(R2.checksum(1,uke),R2.radix2(11,!0),R2.alphabet(r))}function fke(r,e){const{words:t}=IH(r),n=CH(e).decode(t);return OH(n),n}function hke(r,e){return OH(r),CH(e).encode(r).join(lke(e)?"":" ")}function pke(r,e){try{fke(r,e)}catch{return!1}return!0}const yke=r=>PH(`mnemonic${r}`);function mke(r,e=""){return tke(Fw,IH(r).nfkd,yke(e),{c:2048,dkLen:64})}var uu=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class gke extends i6{constructor(){super(...arguments),this.name="DwnKeyStore",this._recordProtocolDefinition=HTe,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"privateJwk",schema:this._recordProtocolDefinition.types.privateJwk.schema}}delete(e){const t=Object.create(null,{delete:{get:()=>super.delete}});return uu(this,void 0,void 0,function*(){return yield t.delete.call(this,e)})}get(e){const t=Object.create(null,{get:{get:()=>super.get}});return uu(this,void 0,void 0,function*(){return yield t.get.call(this,e)})}set(e){const t=Object.create(null,{set:{get:()=>super.set}});return uu(this,void 0,void 0,function*(){yield t.set.call(this,e)})}list(e){const t=Object.create(null,{list:{get:()=>super.list}});return uu(this,void 0,void 0,function*(){return yield t.list.call(this,e)})}getAllRecords({agent:e,tenantDid:t}){var n;return uu(this,void 0,void 0,function*(){this._index.clear();const{reply:i}=yield e.dwn.processRequest({author:t,target:t,messageType:Ke.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let o=[];for(const s of(n=i.entries)!==null&&n!==void 0?n:[]){if(!s.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const a=ge.base64Url(s.encodedData).toObject();if(t6(a)){const l=`${t}${ha}${rx}${a.kid}`;this._index.set(l,s.recordId),this._cache.set(s.recordId,a),o.push(a)}}return o})}}class vke extends o6{constructor(){super(...arguments),this.name="InMemoryKeyStore"}delete(e){const t=Object.create(null,{delete:{get:()=>super.delete}});return uu(this,void 0,void 0,function*(){return yield t.delete.call(this,e)})}get(e){const t=Object.create(null,{get:{get:()=>super.get}});return uu(this,void 0,void 0,function*(){return yield t.get.call(this,e)})}list(e){const t=Object.create(null,{list:{get:()=>super.list}});return uu(this,void 0,void 0,function*(){return yield t.list.call(this,e)})}set(e){const t=Object.create(null,{set:{get:()=>super.set}});return uu(this,void 0,void 0,function*(){return yield t.set.call(this,e)})}}var Gs=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},ZN=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const Kk={"AES-GCM":{implementation:vTe,names:["A128GCM","A192GCM","A256GCM"]},"AES-KW":{implementation:uH,names:["A128KW","A192KW","A256KW"]},Ed25519:{implementation:r6,names:["Ed25519"]},secp256k1:{implementation:nx,names:["ES256K","secp256k1"]},secp256r1:{implementation:nx,names:["ES256","secp256r1"]},"SHA-256":{implementation:e6,names:["SHA-256"]}};let xp=class{constructor({agent:e,keyStore:t}={}){this._algorithmInstances=new Map,this._agent=e,this._keyStore=t??new vke}get agent(){if(this._agent===void 0)throw new Error("LocalKeyManager: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}decrypt(e){var{keyUri:t}=e,n=ZN(e,["keyUri"]);return Gs(this,void 0,void 0,function*(){const i=yield this.getPrivateKey({keyUri:t}),o=this.getAlgorithmName({key:i});return yield this.getAlgorithm({algorithm:o}).decrypt(Object.assign({key:i},n))})}digest(e){throw new Error("Method not implemented.")}encrypt(e){var{keyUri:t}=e,n=ZN(e,["keyUri"]);return Gs(this,void 0,void 0,function*(){const i=yield this.getPrivateKey({keyUri:t}),o=this.getAlgorithmName({key:i});return yield this.getAlgorithm({algorithm:o}).encrypt(Object.assign({key:i},n))})}exportKey({keyUri:e}){return Gs(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){var t;return Gs(this,void 0,void 0,function*(){const n=this.getAlgorithmName({key:{alg:e}}),o=yield this.getAlgorithm({algorithm:n}).generateKey({algorithm:e});(t=o.kid)!==null&&t!==void 0||(o.kid=yield nr({jwk:o}));const s=yield this.getKeyUri({key:o});return yield this._keyStore.set({id:s,data:o,agent:this.agent,preventDuplicates:!1,useCache:!0}),s})}getKeyUri({key:e}){return Gs(this,void 0,void 0,function*(){const t=yield nr({jwk:e});return`${rx}${t}`})}getPublicKey({keyUri:e}){return Gs(this,void 0,void 0,function*(){const t=yield this.getPrivateKey({keyUri:e}),n=this.getAlgorithmName({key:t});return yield this.getAlgorithm({algorithm:n}).getPublicKey({key:t})})}importKey({key:e}){var t;return Gs(this,void 0,void 0,function*(){if(!t6(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const n=structuredClone(e);(t=n.kid)!==null&&t!==void 0||(n.kid=yield nr({jwk:n}));const i=yield this.getKeyUri({key:n});return yield this._keyStore.set({id:i,data:n,agent:this.agent,preventDuplicates:!0,useCache:!0}),i})}sign({keyUri:e,data:t}){return Gs(this,void 0,void 0,function*(){const n=yield this.getPrivateKey({keyUri:e}),i=this.getAlgorithmName({key:n});return this.getAlgorithm({algorithm:i}).sign({data:t,key:n})})}unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:t,decryptionKeyUri:n}){return Gs(this,void 0,void 0,function*(){const i=yield this.getPrivateKey({keyUri:n}),o=this.getAlgorithmName({key:i});return yield this.getAlgorithm({algorithm:o}).unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:t,decryptionKey:i})})}verify({key:e,signature:t,data:n}){return Gs(this,void 0,void 0,function*(){const i=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:i}).verify({key:e,signature:t,data:n})})}wrapKey({unwrappedKey:e,encryptionKeyUri:t}){return Gs(this,void 0,void 0,function*(){const n=yield this.getPrivateKey({keyUri:t}),i=this.getAlgorithmName({key:n});return yield this.getAlgorithm({algorithm:i}).wrapKey({unwrappedKey:e,encryptionKey:n})})}deleteKey({keyUri:e}){return Gs(this,void 0,void 0,function*(){if(!(yield this._keyStore.get({id:e,agent:this.agent,useCache:!0})))throw new Error(`Key not found: ${e}`);yield this._keyStore.delete({id:e,agent:this.agent})})}getAlgorithm({algorithm:e}){var t;const n=(t=Kk[e])===null||t===void 0?void 0:t.implementation;if(!n)throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(n)||this._algorithmInstances.set(n,new n),this._algorithmInstances.get(n)}getAlgorithmName({key:e}){const t=e.alg,n=e.crv;for(const i of Object.keys(Kk)){const o=Kk[i].names;if(t&&o.includes(t))return i;if(n&&o.includes(n))return i}throw new ut(dt.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${t}, crv=${n}. Please check the documentation for the list of supported algorithms.`)}getPrivateKey({keyUri:e}){return Gs(this,void 0,void 0,function*(){const t=yield this._keyStore.get({id:e,agent:this.agent,useCache:!0});if(!t)throw new Error(`Key not found: ${e}`);return t})}};var JN=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function g5(r){return typeof r=="object"&&r!==null&&"alg"in r&&r.alg!==void 0&&"enc"in r&&r.enc!==void 0}class XN{static decrypt({key:e,encryptedKey:t,joseHeader:n,crypto:i}){return JN(this,void 0,void 0,function*(){switch(n.alg){case"dir":{if(t!==void 0)throw new ut(dt.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new ut(dt.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');return e}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof n.p2c!="number")throw new ut(dt.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof n.p2s!="string")throw new ut(dt.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new ut(dt.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');if(t===void 0)throw new ut(dt.InvalidJwe,'JWE "encrypted_key" is required when using "PBES2" (Key Encryption Mode).');let o;try{o=new Uint8Array([...ge.string(n.alg).toUint8Array(),0,...ge.base64Url(n.p2s).toUint8Array()])}catch{throw new ut(dt.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const s=yield i.deriveKey({algorithm:n.alg,baseKeyBytes:e,iterations:n.p2c,salt:o});if(!(s.alg&&["A128KW","A192KW","A256KW"].includes(s.alg)))throw new ut(dt.AlgorithmNotSupported,`Unsupported Key Encryption Algorithm (alg) value: ${s.alg}`);return yield i.unwrapKey({decryptionKey:s,wrappedKeyBytes:t,wrappedKeyAlgorithm:n.enc})}default:throw new ut(dt.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${n.alg}`)}})}static encrypt({key:e,joseHeader:t,crypto:n}){return JN(this,void 0,void 0,function*(){let i,o;switch(t.alg){case"dir":{if(o!==void 0)throw new ut(dt.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new ut(dt.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');i=e;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof t.p2c!="number")throw new ut(dt.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof t.p2s!="string")throw new ut(dt.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new ut(dt.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');i=yield n.generateKey({algorithm:t.enc});let s;try{s=new Uint8Array([...ge.string(t.alg).toUint8Array(),0,...ge.base64Url(t.p2s).toUint8Array()])}catch{throw new ut(dt.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const a=yield n.deriveKey({algorithm:t.alg,baseKeyBytes:e,iterations:t.p2c,salt:s});o=yield n.wrapKey({encryptionKey:a,unwrappedKey:i});break}default:throw new ut(dt.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${t.alg}`)}return{cek:i,encryptedKey:o}})}}function D2(r){return r!==null&&typeof r=="object"&&"encrypt"in r&&typeof r.encrypt=="function"&&"decrypt"in r&&typeof r.decrypt=="function"}function QN(...r){const e=new Set,t=r.filter(Boolean);for(const n of t)for(const i in n){if(e.has(i))return!0;e.add(i)}return!1}var eU=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function zk(r,e){if(e!==void 0)try{if(typeof e!="string")throw new Error;return ge.base64Url(e).toUint8Array()}catch{throw new ut(dt.InvalidJwe,`Failed to decode the JWE Header parameter '${r}' from Base64 URL format to Uint8Array. Ensure the value is properly encoded in Base64 URL format without padding.`)}}class ax{constructor(e){this.ciphertext="",Object.assign(this,e)}static decrypt({jwe:e,key:t,keyManager:n=new Ms,crypto:i=new hv,options:o={}}){var s,a;return eU(this,void 0,void 0,function*(){if(!D2(i))throw new ut(dt.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!D2(n))throw new ut(dt.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!e.protected&&!e.header&&!e.unprotected)throw new ut(dt.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protected", "header", or "unprotected"');if(typeof e.ciphertext!="string")throw new ut(dt.InvalidJwe,"JWE Ciphertext is missing or not a string.");let l;if(e.protected)try{l=ge.base64Url(e.protected).toObject()}catch{throw new Error("JWE Protected Header is invalid")}if(QN(l,e.header,e.unprotected))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "header", "protected", and "unprotected" objects.');const d=Object.assign(Object.assign(Object.assign({},l),e.header),e.unprotected);if(!g5(d))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');if(Array.isArray(o.allowedAlgValues)&&!o.allowedAlgValues.includes(d.alg))throw new Error(`"alg" (Algorithm) Header Parameter value not allowed: ${d.alg}`);if(Array.isArray(o.allowedEncValues)&&!o.allowedEncValues.includes(d.enc))throw new Error(`"enc" (Encryption Algorithm) Header Parameter value not allowed: ${d.enc}`);let c;try{const g=e.encrypted_key?ge.base64Url(e.encrypted_key).toUint8Array():void 0;c=yield XN.decrypt({key:t,encryptedKey:g,joseHeader:d,keyManager:n,crypto:i})}catch(g){if(g instanceof ut&&(g.code===dt.InvalidJwe||g.code===dt.AlgorithmNotSupported))throw g;c=typeof t=="string"?yield n.generateKey({algorithm:d.enc}):yield i.generateKey({algorithm:d.enc})}const u=zk("iv",e.iv),f=zk("tag",e.tag),h=f!==void 0?new Uint8Array([...ge.base64Url(e.ciphertext).toUint8Array(),...f??[]]):ge.base64Url(e.ciphertext).toUint8Array(),p=e.aad!==void 0?new Uint8Array([...ge.string((s=e.protected)!==null&&s!==void 0?s:"").toUint8Array(),...ge.string(".").toUint8Array(),...ge.string(e.aad).toUint8Array()]):ge.string((a=e.protected)!==null&&a!==void 0?a:"").toUint8Array();return{plaintext:typeof c=="string"?yield n.decrypt({keyUri:c,data:h,iv:u,additionalData:p}):yield i.decrypt({key:c,data:h,iv:u,additionalData:p}),protectedHeader:l,additionalAuthenticatedData:zk("aad",e.aad),sharedUnprotectedHeader:e.unprotected,unprotectedHeader:e.header}})}static encrypt({key:e,plaintext:t,additionalAuthenticatedData:n,protectedHeader:i,sharedUnprotectedHeader:o,unprotectedHeader:s,keyManager:a=new Ms,crypto:l=new hv}){return eU(this,void 0,void 0,function*(){if(!D2(l))throw new ut(dt.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!D2(a))throw new ut(dt.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!i&&!o&&!s)throw new ut(dt.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protectedHeader", "sharedUnprotectedHeader", or "unprotectedHeader"');if(!(t instanceof Uint8Array))throw new ut(dt.InvalidJwe,"Plaintext is missing or not a byte array.");if(QN(i,o,s))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "protectedHeader", "sharedUnprotectedHeader", and "unprotectedHeader" objects.');const d=Object.assign(Object.assign(Object.assign({},i),o),s);if(!g5(d))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');const{cek:c,encryptedKey:u}=yield XN.encrypt({key:e,joseHeader:d,keyManager:a,crypto:l});let f;switch(d.enc){case"A128GCM":case"A192GCM":case"A256GCM":f=wo.randomBytes(12);break;default:f=new Uint8Array(0)}const h=i?ge.object(i).toBase64Url():"";let p,y;n?(y=ge.uint8Array(n).toBase64Url(),p=ge.string(h+"."+y).toUint8Array()):p=ge.string(h).toUint8Array();const g=typeof c=="string"?yield a.encrypt({keyUri:c,data:t,iv:f,additionalData:p}):yield l.encrypt({key:c,data:t,iv:f,additionalData:p}),w=g.slice(0,-16),v=g.slice(-16),m=new ax({ciphertext:ge.uint8Array(w).toBase64Url()});return u&&(m.encrypted_key=ge.uint8Array(u).toBase64Url()),i&&(m.protected=h),o&&(m.unprotected=o),s&&(m.header=s),f&&(m.iv=ge.uint8Array(f).toBase64Url()),y&&(m.aad=y),v&&(m.tag=ge.uint8Array(v).toBase64Url()),m})}}var tU=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Rm{static decrypt({jwe:e,key:t,keyManager:n=new Ms,crypto:i=new hv,options:o={}}){return tU(this,void 0,void 0,function*(){if(typeof e!="string")throw new ut(dt.InvalidJwe,"Invalid JWE format. JWE must be a string.");const{0:s,1:a,2:l,3:d,4:c,length:u}=e.split(".");if(u!==5)throw new ut(dt.InvalidJwe,"Invalid JWE format. JWE must have 5 parts.");const f=yield ax.decrypt({jwe:{ciphertext:d,encrypted_key:a||void 0,iv:l||void 0,protected:s,tag:c||void 0},key:t,keyManager:n,crypto:i,options:o});if(!g5(f.protectedHeader))throw new ut(dt.InvalidJwe,"Decrypt operation failed due to missing or malformed JWE Protected Header");return{plaintext:f.plaintext,protectedHeader:f.protectedHeader}})}static encrypt({plaintext:e,protectedHeader:t,key:n,keyManager:i=new Ms,crypto:o=new hv,options:s={}}){return tU(this,void 0,void 0,function*(){const a=yield ax.encrypt({plaintext:e,protectedHeader:t,key:n,keyManager:i,crypto:o,options:s});return[a.protected,a.encrypted_key,a.iv,a.ciphertext,a.tag].join(".")})}}var Ma=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function rU(r){return typeof r!="string"||r.trim().length===0}function bke(r){return typeof r=="object"&&r!==null&&"dateCreated"in r&&typeof r.dateCreated=="string"&&"size"in r&&typeof r.size=="number"&&"data"in r&&typeof r.data=="string"}function wke(r){return typeof r=="object"&&r!==null&&"initialized"in r&&typeof r.initialized=="boolean"&&"lastBackup"in r&&"lastRestore"in r}class _ke{constructor({keyDerivationWorkFactor:e,store:t}={}){this.crypto=new hv,this._keyDerivationWorkFactor=e??21e4,this._store=t??new vW}backup(){return Ma(this,void 0,void 0,function*(){if(this.isLocked()||(yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the backup operation because the identity vault has not been initialized and unlocked. Please ensure the vault is properly initialized with a secure password before attempting to backup its contents.");const e={did:yield this.getStoredDid(),contentEncryptionKey:yield this.getStoredContentEncryptionKey(),status:yield this.getStatus()},t=ge.object(e).toBase64Url(),n={data:t,dateCreated:new Date().toISOString(),size:t.length};return yield this.setStatus({lastBackup:n.dateCreated}),n})}changePassword({oldPassword:e,newPassword:t}){return Ma(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the change password operation because the identity vault has not been initialized. Please ensure the vault is properly initialized with a secure password before trying again.");yield this.lock();const n=yield this.getStoredContentEncryptionKey();let i,o;try{let a;({plaintext:a,protectedHeader:i}=yield Rm.decrypt({jwe:n,key:ge.string(e).toUint8Array(),crypto:this.crypto,keyManager:new xp})),o=ge.uint8Array(a).toObject()}catch{throw new Error("HdIdentityVault: Unable to change the vault password due to an incorrectly entered old password.")}const s=yield Rm.encrypt({key:ge.string(t).toUint8Array(),protectedHeader:i,plaintext:ge.object(o).toUint8Array(),crypto:this.crypto,keyManager:new xp});yield this._store.set("contentEncryptionKey",s),this._contentEncryptionKey=o})}getDid(){return Ma(this,void 0,void 0,function*(){if(this.isLocked())throw new Error("HdIdentityVault: Vault has not been initialized and unlocked.");const e=yield this.getStoredDid(),{plaintext:t}=yield Rm.decrypt({jwe:e,key:this._contentEncryptionKey,crypto:this.crypto,keyManager:new xp}),n=ge.uint8Array(t).toObject();if(!hH(n))throw new Error("HdIdentityVault: Unable to decode malformed DID in identity vault");return yield Zc.import({portableDid:n})})}getStatus(){return Ma(this,void 0,void 0,function*(){const e=yield this._store.get("vaultStatus");if(!e)return{initialized:!1,lastBackup:null,lastRestore:null};const t=ge.string(e).toObject();if(!wke(t))throw new Error("HdIdentityVault: Invalid IdentityVaultStatus object in store");return t})}initialize({password:e,recoveryPhrase:t,dwnEndpoints:n}){return Ma(this,void 0,void 0,function*(){if(yield this.isInitialized())throw new Error("HdIdentityVault: Vault has already been initialized.");if(rU(e))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(t&&rU(t))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(t??(t=dke(YN,128)),!pke(t,YN))throw new Error("HdIdentityVault: The provided recovery phrase is invalid. Please ensure that the recovery phrase is a correctly formatted series of 12 words.");const i=yield mke(t),o=ix.fromMasterSeed(i),s=o.derive("m/44'/0'/0'/0'/0'"),a=yield this.crypto.deriveKey({algorithm:"HKDF-512",baseKeyBytes:s.privateKey,salt:"",info:"vault_cek",derivedKeyAlgorithm:"A256GCM"}),l=yield this.crypto.deriveKeyBytes({algorithm:"HKDF-512",baseKeyBytes:s.publicKey,salt:"",info:"vault_unlock_salt",length:256}),d={alg:"PBES2-HS512+A256KW",enc:"A256GCM",cty:"text/plain",p2c:this._keyDerivationWorkFactor,p2s:ge.uint8Array(l).toBase64Url()},c=yield Rm.encrypt({key:ge.string(e).toUint8Array(),protectedHeader:d,plaintext:ge.object(a).toUint8Array(),crypto:this.crypto,keyManager:new xp});yield this._store.set("contentEncryptionKey",c);const u=o.derive("m/44'/0'/1708523827'/0'/0'"),f=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:u.privateKey});let h=o.derive("m/44'/0'/1708523827'/0'/1'");const p=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:h.privateKey}),y=new YTe;yield y.addPredefinedKeys({privateKeys:[f,p]});const g={verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]}]};n&&n.length&&(g.services=[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:n,enc:"#enc",sig:"#sig"}]);const v=yield(yield Xw.create({keyManager:y,options:g})).export(),m={alg:"dir",enc:"A256GCM",cty:"json"},b=yield Rm.encrypt({key:a,plaintext:ge.object(v).toUint8Array(),protectedHeader:m,crypto:this.crypto,keyManager:new xp});return yield this._store.set("did",b),this._contentEncryptionKey=a,yield this.setStatus({initialized:!0}),t})}isInitialized(){return Ma(this,void 0,void 0,function*(){return this.getStatus().then(({initialized:e})=>e)})}isLocked(){return!this._contentEncryptionKey}lock(){return Ma(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Lock operation failed. Vault has not been initialized.");this._contentEncryptionKey&&(this._contentEncryptionKey.k=""),this._contentEncryptionKey=void 0})}restore({backup:e,password:t}){return Ma(this,void 0,void 0,function*(){if(!bke(e))throw new Error("HdIdentityVault: Restore operation failed due to invalid backup object.");let n,i,o;try{o=yield this.getStoredDid(),i=yield this.getStoredContentEncryptionKey(),n=yield this.getStatus()}catch{throw new Error("HdIdentityVault: The restore operation cannot proceed because the existing vault contents are missing or inaccessible. If the problem persists consider re-initializing the vault and retrying the restore.")}try{const s=ge.base64Url(e.data).toObject();yield this._store.set("did",s.did),yield this._store.set("contentEncryptionKey",s.contentEncryptionKey),yield this.setStatus(s.status),yield this.unlock({password:t})}catch{throw yield this.setStatus(n),yield this._store.set("contentEncryptionKey",i),yield this._store.set("did",o),new Error("HdIdentityVault: Restore operation failed due to invalid backup data or an incorrect password. Please verify the password is correct for the provided backup and try again.")}yield this.setStatus({lastRestore:new Date().toISOString()})})}unlock({password:e}){return Ma(this,void 0,void 0,function*(){yield this.lock();const t=yield this.getStoredContentEncryptionKey();try{const{plaintext:n}=yield Rm.decrypt({jwe:t,key:ge.string(e).toUint8Array(),crypto:this.crypto,keyManager:new xp}),i=ge.uint8Array(n).toObject();this._contentEncryptionKey=i}catch{throw new Error("HdIdentityVault: Unable to unlock the vault due to an incorrect password.")}})}getStoredDid(){return Ma(this,void 0,void 0,function*(){const e=yield this._store.get("did");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the DID record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}getStoredContentEncryptionKey(){return Ma(this,void 0,void 0,function*(){const e=yield this._store.get("contentEncryptionKey");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the Content Encryption Key record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}setStatus({initialized:e,lastBackup:t,lastRestore:n}){return Ma(this,void 0,void 0,function*(){let i=yield this.getStatus();return i.initialized=e??i.initialized,i.lastBackup=t??i.lastBackup,i.lastRestore=n??i.lastRestore,yield this._store.set("vaultStatus",JSON.stringify(i)),!0})}}var fu=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function Eke(r){return!(!r||typeof r!="object"||r===null)&&"name"in r}class Ake extends i6{constructor(){super(...arguments),this.name="DwnIdentityStore",this._recordProtocolDefinition=fH,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"identityMetadata",schema:this._recordProtocolDefinition.types.identityMetadata.schema}}delete(e){const t=Object.create(null,{delete:{get:()=>super.delete}});return fu(this,void 0,void 0,function*(){return yield t.delete.call(this,e)})}get(e){const t=Object.create(null,{get:{get:()=>super.get}});return fu(this,void 0,void 0,function*(){return yield t.get.call(this,e)})}set(e){const t=Object.create(null,{set:{get:()=>super.set}});return fu(this,void 0,void 0,function*(){return yield t.set.call(this,e)})}list(e){const t=Object.create(null,{list:{get:()=>super.list}});return fu(this,void 0,void 0,function*(){return yield t.list.call(this,e)})}getAllRecords({agent:e,tenantDid:t}){var n;return fu(this,void 0,void 0,function*(){this._index.clear();const{reply:i}=yield e.dwn.processRequest({author:t,target:t,messageType:Ke.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let o=[];for(const s of(n=i.entries)!==null&&n!==void 0?n:[]){if(!s.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const a=ge.base64Url(s.encodedData).toObject();if(Eke(a)){const l=`${t}${ha}${a.uri}`;this._index.set(l,s.recordId),this._cache.set(s.recordId,a),o.push(a)}}return o})}}class xke extends o6{constructor(){super(...arguments),this.name="InMemoryIdentityStore"}delete(e){const t=Object.create(null,{delete:{get:()=>super.delete}});return fu(this,void 0,void 0,function*(){return yield t.delete.call(this,e)})}get(e){const t=Object.create(null,{get:{get:()=>super.get}});return fu(this,void 0,void 0,function*(){return yield t.get.call(this,e)})}list(e){const t=Object.create(null,{list:{get:()=>super.list}});return fu(this,void 0,void 0,function*(){return yield t.list.call(this,e)})}set(e){const t=Object.create(null,{set:{get:()=>super.set}});return fu(this,void 0,void 0,function*(){return yield t.set.call(this,e)})}}var Ld=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Ske{constructor({agent:e,store:t}={}){this._agent=e,this._store=t??new xke}get agent(){if(this._agent===void 0)throw new Error("AgentIdentityApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}create({metadata:e,didMethod:t="dht",didOptions:n,store:i,tenant:o}){return Ld(this,void 0,void 0,function*(){const s=yield this.agent.did.create({method:t,options:n,store:i,tenant:o}),a=new P2({did:s,metadata:Object.assign(Object.assign({},e),{uri:s.uri,tenant:o??s.uri})});return(i??!0)&&(yield this._store.set({id:a.did.uri,data:a.metadata,agent:this.agent,tenant:a.metadata.tenant,preventDuplicates:!1,useCache:!0})),a})}export({didUri:e,tenant:t}){return Ld(this,void 0,void 0,function*(){const n=yield this.get({didUri:e,tenant:t});if(!n)throw new Error(`AgentIdentityApi: Failed to export due to Identity not found: ${e}`);return yield n.export()})}get({didUri:e,tenant:t}){return Ld(this,void 0,void 0,function*(){const n=yield this._store.get({id:e,agent:this.agent,tenant:t,useCache:!0});if(!n)return;const i=yield this.agent.did.get({didUri:e,tenant:n.tenant});if(!i)throw new Error(`AgentIdentityApi: Identity is present in the store but DID is missing: ${e}`);return new P2({did:i,metadata:n})})}import({portableIdentity:e}){return Ld(this,void 0,void 0,function*(){const t=yield this.agent.did.import({portableDid:e.portableDid,tenant:e.metadata.tenant});if(!t)throw new Error(`AgentIdentityApi: Failed to import Identity: ${e.metadata.uri}`);const n=new P2({did:t,metadata:e.metadata});return yield this._store.set({id:n.did.uri,data:n.metadata,agent:this.agent,tenant:n.metadata.tenant,preventDuplicates:!0,useCache:!0}),n})}list({tenant:e}={}){return Ld(this,void 0,void 0,function*(){const t=yield this._store.list({agent:this.agent,tenant:e});return(yield Promise.all(t.map(i=>Ld(this,void 0,void 0,function*(){return this.get({didUri:i.uri,tenant:i.tenant})})))).filter(i=>typeof i<"u")})}manage({portableIdentity:e}){return Ld(this,void 0,void 0,function*(){const t=yield this.agent.did.get({didUri:e.metadata.uri,tenant:e.metadata.tenant});if(!t)throw new Error(`AgentIdentityApi: Failed to manage Identity: ${e.metadata.uri}`);const n=new P2({did:t,metadata:e.metadata});return yield this._store.set({id:n.did.uri,data:n.metadata,agent:this.agent,preventDuplicates:!0,useCache:!0}),n})}delete({didUri:e,tenant:t}){return Ld(this,void 0,void 0,function*(){if(!(yield this._store.get({id:e,agent:this.agent,tenant:t,useCache:!0})))throw new Error(`AgentIdentityApi: Failed to purge due to Identity not found: ${e}`);yield this._store.delete({id:e,agent:this.agent,tenant:t})})}connectedIdentity({connectedDid:e}={}){return Ld(this,void 0,void 0,function*(){const t=yield this.list();if(!(t.length<1))return e?t.find(n=>n.metadata.connectedDid===e):t.find(n=>n.metadata.connectedDid!==void 0)})}}var Kd=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},nU=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class Jc{get agent(){if(!this._agent)throw new Error("AgentPermissionsApi: Agent is not set");return this._agent}set agent(e){this._agent=e}constructor({agent:e}={}){this._cachedPermissions=new rw({ttl:60*1e3}),this._agent=e}getPermissionForRequest({connectedDid:e,delegateDid:t,delegate:n,messageType:i,protocol:o,cached:s=!1}){return Kd(this,void 0,void 0,function*(){const a=[e,t,i,o].join("~"),l=s?this._cachedPermissions.get(a):void 0;if(l)return l;const d=yield this.fetchGrants({author:t,target:t,grantor:e,grantee:t}),c=yield Jc.matchGrantFromArray(e,t,{messageType:i,protocol:o},d,n);if(!c)throw new Error(`CachedPermissions: No permissions found for ${i}: ${o}`);return this._cachedPermissions.set(a,c),c})}fetchGrants({author:e,target:t,grantee:n,grantor:i,protocol:o,remote:s=!1}){return Kd(this,void 0,void 0,function*(){const a=o?{protocol:o}:void 0,l={author:e,target:t,messageType:Ke.RecordsQuery,messageParams:{filter:{author:i,recipient:n,protocol:et.uri,protocolPath:et.grantPath,tags:a}}},{reply:d}=s?yield this.agent.sendDwnRequest(l):yield this.agent.processDwnRequest(l);if(d.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch grants: ${d.status.detail}`);const c=[];for(const u of d.entries){const f=yield Rs.parse(u);c.push({grant:f,message:u})}return c})}fetchRequests({author:e,target:t,protocol:n,remote:i=!1}){return Kd(this,void 0,void 0,function*(){const o=n?{protocol:n}:void 0,s={author:e,target:t,messageType:Ke.RecordsQuery,messageParams:{filter:{protocol:et.uri,protocolPath:et.requestPath,tags:o}}},{reply:a}=i?yield this.agent.sendDwnRequest(s):yield this.agent.processDwnRequest(s);if(a.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch requests: ${a.status.detail}`);const l=[];for(const d of a.entries){const c=yield MA.parse(d);l.push({request:c,message:d})}return l})}isGrantRevoked({author:e,target:t,grantRecordId:n,remote:i=!1}){return Kd(this,void 0,void 0,function*(){const o={author:e,target:t,messageType:Ke.RecordsRead,messageParams:{filter:{parentId:n,protocol:et.uri,protocolPath:et.revocationPath}}},{reply:s}=i?yield this.agent.sendDwnRequest(o):yield this.agent.processDwnRequest(o);if(s.status.code===404)return!1;if(s.status.code===200)return!0;throw new Error(`PermissionsApi: Failed to check if grant is revoked: ${s.status.detail}`)})}createGrant(e){return Kd(this,void 0,void 0,function*(){const{author:t,store:n=!1,delegated:i=!1}=e,o=nU(e,["author","store","delegated"]);let s;et.hasProtocolScope(o.scope)&&(s={protocol:o.scope.protocol});const a={dateExpires:o.dateExpires,requestId:o.requestId,description:o.description,delegated:i,scope:o.scope},l=ge.object(a).toUint8Array(),d={recipient:o.grantedTo,protocol:et.uri,protocolPath:et.grantPath,dataFormat:"application/json",tags:s},{reply:c,message:u}=yield this.agent.processDwnRequest({store:n,author:t,target:t,messageType:Ke.RecordsWrite,messageParams:d,dataStream:new Blob([l])});if(c.status.code!==202)throw new Error(`PermissionsApi: Failed to create grant: ${c.status.detail}`);const f=Object.assign(Object.assign({},u),{encodedData:ge.uint8Array(l).toBase64Url()});return{grant:yield Rs.parse(f),message:f}})}createRequest(e){return Kd(this,void 0,void 0,function*(){const{author:t,store:n=!1,delegated:i=!1}=e,o=nU(e,["author","store","delegated"]);let s;et.hasProtocolScope(o.scope)&&(s={protocol:o.scope.protocol});const a={description:o.description,delegated:i,scope:o.scope},l=ge.object(a).toUint8Array(),d={protocol:et.uri,protocolPath:et.requestPath,dataFormat:"application/json",tags:s},{reply:c,message:u}=yield this.agent.processDwnRequest({store:n,author:t,target:t,messageType:Ke.RecordsWrite,messageParams:d,dataStream:new Blob([l])});if(c.status.code!==202)throw new Error(`PermissionsApi: Failed to create request: ${c.status.detail}`);const f=Object.assign(Object.assign({},u),{encodedData:ge.uint8Array(l).toBase64Url()});return{request:yield MA.parse(f),message:f}})}createRevocation(e){return Kd(this,void 0,void 0,function*(){const{author:t,store:n=!1,grant:i,description:o}=e,s={description:o},a=ge.object(s).toUint8Array();let l;et.hasProtocolScope(i.scope)&&(l={protocol:i.scope.protocol});const d={parentContextId:i.id,protocol:et.uri,protocolPath:et.revocationPath,dataFormat:"application/json",tags:l},{reply:c,message:u}=yield this.agent.processDwnRequest({store:n,author:t,target:t,messageType:Ke.RecordsWrite,messageParams:d,dataStream:new Blob([a])});if(c.status.code!==202)throw new Error(`PermissionsApi: Failed to create revocation: ${c.status.detail}`);return{message:Object.assign(Object.assign({},u),{encodedData:ge.uint8Array(a).toBase64Url()})}})}clear(){return Kd(this,void 0,void 0,function*(){this._cachedPermissions.clear()})}static matchGrantFromArray(e,t,n,i,o=!1){return Kd(this,void 0,void 0,function*(){for(const s of i){const{grant:a,message:l}=s;if(o===!0&&a.delegated!==!0)continue;const{messageType:d,protocol:c,protocolPath:u,contextId:f}=n;if(this.matchScopeFromGrant(e,t,d,a,c,u,f))return{grant:a,message:l}}})}static matchScopeFromGrant(e,t,n,i,o,s,a){if(i.grantee!==t||i.grantor!==e)return!1;const l=i.scope;if(l.interface+l.method===n)if(L$e(n)){const c=l;if(c.protocol!==o)return!1;if(this.isUnrestrictedProtocolScope(c)||c.protocolPath!==void 0&&c.protocolPath===s||c.contextId!==void 0&&a?.startsWith(c.contextId))return!0}else{const c=l;return c.protocol===void 0?!0:c.protocol!==o?!1:this.isUnrestrictedProtocolScope(c)}return!1}static isUnrestrictedProtocolScope(e){return e.contextId===void 0&&e.protocolPath===void 0}}var iU;(function(r){r[r.InvalidRequest=-32600]="InvalidRequest",r[r.MethodNotFound=-32601]="MethodNotFound",r[r.InvalidParams=-32602]="InvalidParams",r[r.InternalError=-32603]="InternalError",r[r.ParseError=-32700]="ParseError",r[r.TransportError=-32300]="TransportError",r[r.BadRequest=-50400]="BadRequest",r[r.Unauthorized=-50401]="Unauthorized",r[r.Forbidden=-50403]="Forbidden",r[r.Conflict=-50409]="Conflict"})(iU||(iU={}));const u6=(r,e,t)=>({jsonrpc:"2.0",id:r,method:e,params:t}),RH=(r,e,t,n)=>({jsonrpc:"2.0",id:r,method:`rpc.subscribe.${e}`,params:n,subscription:{id:t}});function RE(r){try{return JSON.parse(r)}catch{return null}}var Q0=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Tke{constructor({ttl:e="15m"}={}){this.cache=new rw({ttl:by(e)})}get(e){return Q0(this,void 0,void 0,function*(){return this.cache.get(e)})}set(e,t){return Q0(this,void 0,void 0,function*(){this.cache.set(e,t)})}delete(e){return Q0(this,void 0,void 0,function*(){this.cache.delete(e)})}clear(){return Q0(this,void 0,void 0,function*(){this.cache.clear()})}close(){return Q0(this,void 0,void 0,function*(){})}}var oU=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class $ke{constructor(e){this.serverInfoCache=e??new Tke}get transportProtocols(){return["http:","https:"]}sendDwnRequest(e){return oU(this,void 0,void 0,function*(){const t=wo.randomUuid(),n=u6(t,"dwn.processMessage",{target:e.targetDid,message:e.message}),i={method:"POST",headers:{"dwn-request":JSON.stringify(n)}};e.data&&(i.headers["content-type"]="application/octet-stream",i.body=e.data);const o=yield fetch(e.dwnUrl,i);let s,a;const{headers:l}=o;if(l.has("dwn-response")){const c=RE(l.get("dwn-response"));if(c==null)throw new Error(`failed to parse json rpc response. dwn url: ${e.dwnUrl}`);a=o.body,s=c}else{const c=yield o.text();s=JSON.parse(c)}if(s.error){const{code:c,message:u}=s.error;throw new Error(`(${c}) - ${u}`)}const{reply:d}=s.result;return a&&d.record?d.record.data=a:a&&d.entry&&(d.entry.data=a),d})}getServerInfo(e){return oU(this,void 0,void 0,function*(){const t=yield this.serverInfoCache.get(e);if(t)return t;const n=new URL(e);n.pathname.endsWith("/")?n.pathname+="info":n.pathname+="/info";try{const i=yield fetch(n.toString());if(i.ok){const o=yield i.json(),s={registrationRequirements:o.registrationRequirements,maxFileSize:o.maxFileSize,webSocketSupport:o.webSocketSupport};return this.serverInfoCache.set(e,s),s}else throw new Error(`HTTP (${i.status}) - ${i.statusText}`)}catch(i){throw new Error(`Error encountered while processing response from ${n.toString()}: ${i.message}`)}})}}var Wm=null;typeof WebSocket<"u"?Wm=WebSocket:typeof MozWebSocket<"u"?Wm=MozWebSocket:typeof globalThis<"u"?Wm=globalThis.WebSocket||globalThis.MozWebSocket:typeof window<"u"?Wm=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Wm=self.WebSocket||self.MozWebSocket);const kke=Wm;var M2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const Pke=3e3,Ike=3e4;class f6{constructor(e,t){this.socket=e,this.responseTimeout=t,this.messageHandlers=new Map}static connect(e,t={}){return M2(this,void 0,void 0,function*(){const{connectTimeout:n=Pke,responseTimeout:i=Ike,onclose:o,onerror:s}=t,a=new kke(e);return o?a.onclose=o:a.onclose=()=>{console.info(`JSON RPC Socket close ${e}`)},s?a.onerror=s:a.onerror=l=>{console.error(`JSON RPC Socket error ${e}`,l)},new Promise((l,d)=>{a.addEventListener("open",()=>{const c=new f6(a,i);a.addEventListener("message",u=>{const f=RE(u.data),h=c.messageHandlers.get(f.id);h&&h(u)}),l(c)}),a.addEventListener("error",c=>{d(c)}),setTimeout(()=>d,n)})})}close(){this.socket.close()}request(e){return M2(this,void 0,void 0,function*(){return new Promise((t,n)=>{var i;(i=e.id)!==null&&i!==void 0||(e.id=wo.randomUuid());const o=s=>{const a=RE(s.data);if(a.id===e.id)return this.messageHandlers.delete(e.id),t(a)};this.messageHandlers.set(e.id,o),this.send(e),setTimeout(()=>{this.messageHandlers.delete(e.id),n(new Error("request timed out"))},this.responseTimeout)})})}subscribe(e,t){return M2(this,void 0,void 0,function*(){if(!e.method.startsWith("rpc.subscribe."))throw new Error("subscribe rpc requests must include the `rpc.subscribe` prefix");if(!e.subscription)throw new Error("subscribe rpc requests must include subscribe options");const n=e.subscription.id,i=a=>{const l=RE(a.data.toString());l.id===n&&(l.error!==void 0&&(this.messageHandlers.delete(n),this.closeSubscription(n)),t(l))};this.messageHandlers.set(n,i);const o=yield this.request(e);return o.error?(this.messageHandlers.delete(n),{response:o}):{response:o,close:()=>M2(this,void 0,void 0,function*(){this.messageHandlers.delete(n),yield this.closeSubscription(n)})}})}closeSubscription(e){const t=wo.randomUuid(),n=RH(t,"close",e,{});return this.request(n)}send(e){this.socket.send(JSON.stringify(e))}}var Fk=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class nh{get transportProtocols(){return["ws:","wss:"]}sendDwnRequest(e,t){return Fk(this,void 0,void 0,function*(){const n=new URL(e.dwnUrl);if(n.protocol!=="ws:"&&n.protocol!=="wss:")throw new Error(`Invalid websocket protocol ${n.protocol}`);if(!nh.connections.has(n.host))try{const d=yield f6.connect(n.toString(),t),c=new Map;nh.connections.set(n.host,{socket:d,subscriptions:c})}catch(d){throw new Error(`Error connecting to ${n.host}: ${d.message}`)}const o=nh.connections.get(n.host),{targetDid:s,message:a,subscriptionHandler:l}=e;return l?nh.subscriptionRequest(o,s,a,l):nh.processMessage(o,s,a)})}static processMessage(e,t,n){return Fk(this,void 0,void 0,function*(){const i=wo.randomUuid(),o=u6(i,"dwn.processMessage",{target:t,message:n}),{socket:s}=e,a=yield s.request(o),{error:l,result:d}=a;if(l!==void 0)throw new Error(`error sending DWN request: ${l.message}`);return d.reply})}static subscriptionRequest(e,t,n,i){return Fk(this,void 0,void 0,function*(){const o=wo.randomUuid(),s=wo.randomUuid(),a=RH(o,"dwn.processMessage",s,{target:t,message:n}),{socket:l,subscriptions:d}=e,{response:c,close:u}=yield l.subscribe(a,y=>{const{result:g,error:w}=y;if(w){const m=d.get(s);m&&m.close(),d.delete(s);return}const{event:v}=g;i(v)}),{error:f,result:h}=c;if(f)throw new Error(`could not subscribe via jsonrpc socket: ${f.message}`);const{reply:p}=h;return p.subscription&&u&&(d.set(s,Object.assign(Object.assign({},p.subscription),{close:u})),p.subscription.close=u),p})}}nh.connections=new Map;var e_=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},sU;(function(r){r.Create="did.create",r.Resolve="did.resolve"})(sU||(sU={}));class Oke{constructor(e=[]){this.transportClients=new Map,e=[new Cke,new Rke,...e];for(let t of e)for(let n of t.transportProtocols)this.transportClients.set(n,t)}get transportProtocols(){return Array.from(this.transportClients.keys())}sendDidRequest(e){return e_(this,void 0,void 0,function*(){const t=new URL(e.url),n=this.transportClients.get(t.protocol);if(!n){const i=new Error(`no ${t.protocol} transport client available`);throw i.name="NO_TRANSPORT_CLIENT",i}return n.sendDidRequest(e)})}sendDwnRequest(e){const t=new URL(e.dwnUrl),n=this.transportClients.get(t.protocol);if(!n){const i=new Error(`no ${t.protocol} transport client available`);throw i.name="NO_TRANSPORT_CLIENT",i}return n.sendDwnRequest(e)}getServerInfo(e){return e_(this,void 0,void 0,function*(){const t=new URL(e),n=this.transportClients.get(t.protocol);if(!n){const i=new Error(`no ${t.protocol} transport client available`);throw i.name="NO_TRANSPORT_CLIENT",i}return n.getServerInfo(e)})}}class Cke extends $ke{sendDidRequest(e){return e_(this,void 0,void 0,function*(){const t=wo.randomUuid(),n=u6(t,e.method,{data:e.data}),i=new Request(e.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});let o;try{const s=yield fetch(i);if(s.ok){if(o=yield s.json(),o.error){const{code:a,message:l}=o.error;throw new Error(`JSON RPC (${a}) - ${l}`)}}else throw new Error(`HTTP (${s.status}) - ${s.statusText}`)}catch(s){throw new Error(`Error encountered while processing response from ${e.url}: ${s.message}`)}return o.result})}}class Rke extends nh{sendDidRequest(e){return e_(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}getServerInfo(e){return e_(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}}var B2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class Dke{constructor({agent:e,syncEngine:t}){this._syncEngine=t,this._agent=e}get agent(){if(this._agent===void 0)throw new Error("AgentSyncApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._syncEngine.agent=e}registerIdentity(e){return B2(this,void 0,void 0,function*(){yield this._syncEngine.registerIdentity(e)})}unregisterIdentity(e){return B2(this,void 0,void 0,function*(){yield this._syncEngine.unregisterIdentity(e)})}getIdentityOptions(e){return B2(this,void 0,void 0,function*(){return yield this._syncEngine.getIdentityOptions(e)})}updateIdentityOptions(e){return B2(this,void 0,void 0,function*(){yield this._syncEngine.updateIdentityOptions(e)})}sync(e){return this._syncEngine.sync(e)}startSync(e){return this._syncEngine.startSync(e)}stopSync(e){return this._syncEngine.stopSync(e)}}var Zn=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Mke=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(d){o({value:d,done:a})},s)}};class Lp{constructor({agent:e,dataPath:t,db:n}){this._syncLock=!1,this._agent=e,this._permissionsApi=new Jc({agent:e}),this._db=n||new UD(t??"DATA/AGENT/SYNC_STORE"),this._ulidFactory=XW()}get agent(){if(this._agent===void 0)throw new Error("SyncEngineLevel: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._permissionsApi=new Jc({agent:e})}clear(){return Zn(this,void 0,void 0,function*(){yield this._permissionsApi.clear(),yield this._db.clear()})}close(){return Zn(this,void 0,void 0,function*(){yield this._db.close()})}pull(){var e;return Zn(this,void 0,void 0,function*(){const t=yield this.getSyncPeerState({syncDirection:"pull"});yield this.enqueueOperations({syncDirection:"pull",syncPeerState:t});const n=this.getPullQueue(),i=yield n.iterator().all(),o=[],s=new Set;for(let a of i){const[l]=a,{did:d,dwnUrl:c,messageCid:u,delegateDid:f,protocol:h}=Lp.parseSyncMessageParamsKey(l);if(s.has(c))continue;if(yield this.messageExists(d,u)){o.push({type:"del",key:l});continue}let y,g;if(f)try{y=(yield this._permissionsApi.getPermissionForRequest({connectedDid:d,messageType:Ke.MessagesRead,delegateDid:f,protocol:h,cached:!0})).grant.id,g=f}catch(S){console.error("SyncEngineLevel: pull - Error fetching MessagesRead permission grant for delegate DID",S);continue}const w=yield this.agent.processDwnRequest({store:!1,author:d,target:d,messageType:Ke.MessagesRead,granteeDid:g,messageParams:{messageCid:u,permissionGrantId:y}});let v;try{v=yield this.agent.rpc.sendDwnRequest({dwnUrl:c,targetDid:d,message:w.message})}catch{s.add(c);continue}if(v.status.code!==200||!(!((e=v.entry)===null||e===void 0)&&e.message)){yield this.addMessage(d,u),o.push({type:"del",key:l});continue}const m=v.entry,b=m.message,_=lw(m)&&m.data?lo.fromWebReadable({readableStream:m.data}):void 0,E=yield this.agent.dwn.node.processMessage(d,b,{dataStream:_});Lp.syncMessageReplyIsSuccessful(E)&&(yield this.addMessage(d,u),o.push({type:"del",key:l}))}yield n.batch(o)})}push(){return Zn(this,void 0,void 0,function*(){const e=yield this.getSyncPeerState({syncDirection:"push"});yield this.enqueueOperations({syncDirection:"push",syncPeerState:e});const t=this.getPushQueue(),n=yield t.iterator().all(),i=[],o=new Set;for(let s of n){const[a]=s,{did:l,delegateDid:d,protocol:c,dwnUrl:u,messageCid:f}=Lp.parseSyncMessageParamsKey(a);if(o.has(u))continue;const h=yield this.getDwnMessage({author:l,messageCid:f,delegateDid:d,protocol:c});if(!h){i.push({type:"del",key:a}),yield this.addMessage(l,f);continue}try{const p=yield this.agent.rpc.sendDwnRequest({dwnUrl:u,targetDid:l,data:h.data,message:h.message});Lp.syncMessageReplyIsSuccessful(p)&&(yield this.addMessage(l,f),i.push({type:"del",key:a}))}catch{o.add(u)}}yield t.batch(i)})}registerIdentity({did:e,options:t}){return Zn(this,void 0,void 0,function*(){const n=this._db.sublevel("registeredIdentities");if(yield this.getIdentityOptions(e))throw new Error(`SyncEngineLevel: Identity with DID ${e} is already registered.`);t??(t={protocols:[]}),yield n.put(e,JSON.stringify(t))})}unregisterIdentity(e){return Zn(this,void 0,void 0,function*(){const t=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield t.del(e)})}getIdentityOptions(e){return Zn(this,void 0,void 0,function*(){const t=this._db.sublevel("registeredIdentities");try{const n=yield t.get(e);if(n)return JSON.parse(n)}catch(n){const i=n;if(i.code==="LEVEL_NOT_FOUND")return;throw new Error(`SyncEngineLevel: Error reading level: ${i.code}.`)}})}updateIdentityOptions({did:e,options:t}){return Zn(this,void 0,void 0,function*(){const n=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield n.put(e,JSON.stringify(t))})}sync(e){return Zn(this,void 0,void 0,function*(){if(this._syncLock)throw new Error("SyncEngineLevel: Sync operation is already in progress.");this._syncLock=!0;try{(!e||e==="push")&&(yield this.push()),(!e||e==="pull")&&(yield this.pull())}finally{this._syncLock=!1}})}startSync({interval:e}){return Zn(this,void 0,void 0,function*(){const t=by(e),n=()=>Zn(this,void 0,void 0,function*(){this._syncLock||(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0,yield this.sync(),this._syncIntervalId||(this._syncIntervalId=setInterval(n,t)))});this._syncIntervalId&&clearInterval(this._syncIntervalId),this._syncIntervalId=setInterval(n,t),this._syncLock||(yield this.sync())})}stopSync(e=2e3){return Zn(this,void 0,void 0,function*(){let t=0;for(;this._syncLock;){if(t>=e)throw new Error(`SyncEngineLevel: Existing sync operation did not complete within ${e} milliseconds.`);t+=100,yield new Promise(n=>setTimeout(n,e<100?e:100))}this._syncIntervalId&&(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0)})}static syncMessageReplyIsSuccessful(e){var t,n;return e.status.code===202||e.status.code===204||e.status.code===409||((t=e.entry)===null||t===void 0?void 0:t.message.descriptor.interface)===Ge.Records&&((n=e.entry)===null||n===void 0?void 0:n.message.descriptor.method)===Le.Delete&&e.status.code===404}enqueueOperations({syncDirection:e,syncPeerState:t}){return Zn(this,void 0,void 0,function*(){for(let n of t){const i=yield this.getDwnEventLog({did:n.did,delegateDid:n.delegateDid,dwnUrl:n.dwnUrl,cursor:n.cursor,protocol:n.protocol,syncDirection:e}),o=[];for(let s of i){const a=this._ulidFactory(),l=Lp.generateSyncMessageParamsKey(Object.assign(Object.assign({},n),{watermark:a,messageCid:s}));o.push({type:"put",key:l,value:""})}o.length>0&&(yield(e==="pull"?this.getPullQueue():this.getPushQueue()).batch(o))}})}static generateSyncMessageParamsKey({did:e,delegateDid:t,dwnUrl:n,protocol:i,watermark:o,messageCid:s}){return[e,t,n,i,o,s].join("~")}static parseSyncMessageParamsKey(e){const[t,n,i,o,s,a]=e.split("~");return{did:t,delegateDid:n===""?void 0:n,dwnUrl:i,watermark:s,messageCid:a,protocol:o===""?void 0:o}}getDwnEventLog({did:e,delegateDid:t,dwnUrl:n,syncDirection:i,cursor:o,protocol:s}){var a;return Zn(this,void 0,void 0,function*(){let l={},d;if(t)try{d=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:Ke.MessagesQuery,delegateDid:t,protocol:s,cached:!0})).grant.id}catch(u){return console.error("SyncEngineLevel: Error fetching MessagesQuery permission grant for delegate DID",u),[]}if(i==="pull"){const u=s?[{protocol:s}]:[],f=yield this.agent.dwn.processRequest({store:!1,target:e,author:e,messageType:Ke.MessagesQuery,granteeDid:t,messageParams:{filters:u,cursor:o,permissionGrantId:d}});try{l=yield this.agent.rpc.sendDwnRequest({dwnUrl:n,targetDid:e,message:f.message})}catch{}}else if(i==="push"){const u=s?[{protocol:s}]:[];l=(yield this.agent.dwn.processRequest({author:e,target:e,messageType:Ke.MessagesQuery,granteeDid:t,messageParams:{filters:u,cursor:o,permissionGrantId:d}})).reply}const c=(a=l.entries)!==null&&a!==void 0?a:[];return l.cursor&&this.setCursor(e,n,i,l.cursor,s),c})}getDwnMessage({author:e,delegateDid:t,protocol:n,messageCid:i}){return Zn(this,void 0,void 0,function*(){let o;if(t)try{o=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:Ke.MessagesRead,delegateDid:t,protocol:n,cached:!0})).grant.id}catch(d){console.error("SyncEngineLevel: push - Error fetching MessagesRead permission grant for delegate DID",d);return}let{reply:s}=yield this.agent.dwn.processRequest({author:e,target:e,messageType:Ke.MessagesRead,granteeDid:t,messageParams:{messageCid:i,permissionGrantId:o}});if(s.status.code!==200||!s.entry)return;const a=s.entry;let l={message:a.message};if(lw(a)&&a.data){const d=yield lo.consumeToBytes({readable:a.data});l.data=new Blob([d],{type:a.message.descriptor.dataFormat})}return l})}getSyncPeerState({syncDirection:e}){var t,n,i,o;return Zn(this,void 0,void 0,function*(){const s=[];try{for(var a=!0,l=Mke(this._db.sublevel("registeredIdentities").iterator()),d;d=yield l.next(),t=d.done,!t;a=!0){o=d.value,a=!1;const[c,u]=o,{protocols:f,delegateDid:h}=yield new Promise(y=>{try{const{protocols:g,delegateDid:w}=JSON.parse(u);y({protocols:g,delegateDid:w})}catch{y({protocols:[]})}}),p=yield SH(c,this.agent.did);if(p.length!==0)for(let y of p)if(f.length===0){const g=yield this.getCursor(c,y,e);s.push({did:c,delegateDid:h,dwnUrl:y,cursor:g})}else for(const g of f){const w=yield this.getCursor(c,y,e,g);s.push({did:c,delegateDid:h,dwnUrl:y,cursor:w,protocol:g})}}}catch(c){n={error:c}}finally{try{!a&&!t&&(i=l.return)&&(yield i.call(l))}finally{if(n)throw n.error}}return s})}getCursor(e,t,n,i){return Zn(this,void 0,void 0,function*(){const o=i?`${e}~${t}~${n}-${i}`:`${e}~${t}~${n}`,s=this.getCursorStore();try{const a=yield s.get(o);if(a)return JSON.parse(a)}catch(a){if(a.notFound)return}})}setCursor(e,t,n,i,o){return Zn(this,void 0,void 0,function*(){const s=o?`${e}~${t}~${n}-${o}`:`${e}~${t}~${n}`;yield this.getCursorStore().put(s,JSON.stringify(i))})}messageExists(e,t){return Zn(this,void 0,void 0,function*(){const n=this.getMessageStore(e);try{return yield n.get(t),!0}catch(i){if(i.notFound)return!1;throw i}})}addMessage(e,t){return Zn(this,void 0,void 0,function*(){return yield this.getMessageStore(e).put(t,"")})}getMessageStore(e){return this._db.sublevel("history").sublevel(e).sublevel("messages")}getCursorStore(){return this._db.sublevel("cursors")}getPushQueue(){return this._db.sublevel("pushQueue")}getPullQueue(){return this._db.sublevel("pullQueue")}}var Bs=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Bke=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};function jke({baseURL:r,endpoint:e,authParam:t,tokenParam:n}){switch(e){case"pushedAuthorizationRequest":return ey(r,"par");case"authorize":if(!t)throw new Error("authParam must be providied when building a token URL");return ey(r,`authorize/${t}.jwt`);case"callback":return ey(r,"callback");case"token":if(!n)throw new Error("tokenParam must be providied when building a token URL");return ey(r,`token/${n}.jwt`);default:throw new Error(`No matches for endpoint specified: ${e}`)}}function Nke(){return Bs(this,void 0,void 0,function*(){const r=wo.randomBytes(32),e=yield nT.digest({data:r}),t=ge.uint8Array(e).toBase64Url();return{codeChallengeBytes:e,codeChallengeBase64Url:t}})}function Uke(r){return Bs(this,void 0,void 0,function*(){const e=wo.randomBytes(16),t=wo.randomBytes(16);return Object.assign(Object.assign({},r),{nonce:ge.uint8Array(t).toBase64Url(),response_type:"id_token",response_mode:"direct_post",state:ge.uint8Array(e).toBase64Url(),client_metadata:{subject_syntax_types_supported:["did:dht","did:jwk"]}})})}function Lke({jwt:r,encryptionKey:e}){return Bs(this,void 0,void 0,function*(){const t={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT"},n=wo.randomBytes(24),i=ge.object(t).toUint8Array(),o=ge.string(r).toUint8Array(),a=JS(e,n,i).encrypt(o),l=a.subarray(0,-16),d=a.subarray(-16);return[ge.object(t).toBase64Url(),"",ge.uint8Array(n).toBase64Url(),ge.uint8Array(l).toBase64Url(),ge.uint8Array(d).toBase64Url()].join(".")})}function Kke(r){return Bs(this,void 0,void 0,function*(){const e=Math.floor(Date.now()/1e3);return Object.assign(Object.assign({},r),{iat:e,exp:e+600})})}function zke({did:r,data:e}){return Bs(this,void 0,void 0,function*(){const t=ge.object({alg:"EdDSA",kid:r.document.verificationMethod[0].id,typ:"JWT"}).toBase64Url(),n=ge.object(e).toBase64Url(),o=yield(yield r.getSigner()).sign({data:ge.string(`${t}.${n}`).toUint8Array()}),s=ge.uint8Array(o).toBase64Url();return`${t}.${n}.${s}`})}function DH({jwt:r}){var e,t;return Bs(this,void 0,void 0,function*(){const[n,i,o]=r.split("."),s=ge.base64Url(n).toObject();if(!s.kid)throw new Error("OIDC: Object could not be verified due to missing 'kid' header value.");const{didDocument:a}=yield Wy.resolve(s.kid.split("#")[0]);if(!a)throw new Error("OIDC: Object could not be verified due to Client DID resolution issue.");const{publicKeyJwk:l}=(t=(e=a.verificationMethod)===null||e===void 0?void 0:e.find(f=>f.id===s.kid))!==null&&t!==void 0?t:{};if(!l)throw new Error("OIDC: Object could not be verified due to missing public key in DID document.");if(!(yield new r6().verify({key:l,signature:ge.base64Url(o).toUint8Array(),data:ge.string(`${n}.${i}`).toUint8Array()})))throw new Error("OIDC: Object failed verification due to invalid signature.");return ge.base64Url(i).toObject()})}const Fke=(r,e)=>Bs(void 0,void 0,void 0,function*(){const n=yield(yield fetch(r)).text(),i=MH({jwe:n,encryption_key:e});return yield DH({jwt:i})});function MH({jwe:r,encryption_key:e}){const[t,,n,i,o]=r.split("."),s=ge.base64Url(e).toUint8Array(),l=ge.base64Url(t).toUint8Array(),d=ge.base64Url(n).toUint8Array(),c=ge.base64Url(i).toUint8Array(),u=ge.base64Url(o).toUint8Array(),f=new Uint8Array([...c,...u]),p=JS(s,d,l).decrypt(f);return ge.uint8Array(p).toString()}function qke(r,e,t){return Bs(this,void 0,void 0,function*(){const[n,,i,o,s]=e.split("."),a=ge.base64Url(n).toObject(),l=yield Wy.resolve(a.kid.split("#")[0]),d=yield cs.deriveSharedKey(r,l.didDocument),c=Object.assign(Object.assign({},a),{pin:t}),u=ge.object(c).toUint8Array(),f=ge.base64Url(i).toUint8Array(),h=ge.base64Url(o).toUint8Array(),p=ge.base64Url(s).toUint8Array(),y=new Uint8Array([...h,...p]),w=JS(d,f,u).decrypt(y);return ge.uint8Array(w).toString()})}function Vke(r,e){var t,n;return Bs(this,void 0,void 0,function*(){const i=yield r.export(),o=(t=e.verificationMethod)===null||t===void 0?void 0:t[0].publicKeyJwk,s=(n=i.privateKeys)===null||n===void 0?void 0:n[0];o.alg="EdDSA";const a=yield on.convertPublicKeyToX25519({publicKey:o}),l=yield on.convertPrivateKeyToX25519({privateKey:s}),d=yield n6.sharedSecret({privateKeyA:l,publicKeyB:a}),c=yield crypto.subtle.importKey("raw",d,{name:"HKDF"},!1,["deriveBits"]),u=yield crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",info:new Uint8Array,salt:new Uint8Array},c,256);return new Uint8Array(u)})}function Wke({jwt:r,encryptionKey:e,delegateDidKeyId:t,randomPin:n}){const i={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT",kid:t},o=wo.randomBytes(24),s=ge.object(Object.assign(Object.assign({},i),{pin:n})).toUint8Array(),a=ge.string(r).toUint8Array(),d=JS(e,o,s).encrypt(a),c=d.subarray(0,-16),u=d.subarray(-16);return[ge.object(i).toBase64Url(),"",ge.uint8Array(o).toBase64Url(),ge.uint8Array(c).toBase64Url(),ge.uint8Array(u).toBase64Url()].join(".")}function Hke(r){return K$e(r)?!0:r.interface===Ge.Protocols&&r.method===Le.Configure}function Gke(r,e,t,n){return Bs(this,void 0,void 0,function*(){const i=new Jc({agent:t}),s=(yield Promise.all(n.map(l=>{const d=Hke(l);return i.createGrant({delegated:d,store:!0,grantedTo:e.uri,scope:l,dateExpires:"2040-06-25T16:09:16.693356Z",author:r})}))).map(l=>Bs(this,void 0,void 0,function*(){const d=l.message,{encodedData:c}=d,u=Bke(d,["encodedData"]),f=ge.base64Url(c).toUint8Array(),{reply:h}=yield t.sendDwnRequest({author:r,target:r,messageType:Ke.RecordsWrite,dataStream:new Blob([f]),rawMessage:u});if(h.status.code!==202&&h.status.code!==409)throw new Error(`Could not send the message. Error details: ${h.status.detail}`);return l.message}));return yield Promise.all(s)})}function Yke(r,e,t){return Bs(this,void 0,void 0,function*(){const n=yield e.processDwnRequest({author:r,messageType:Ke.ProtocolsQuery,target:r,messageParams:{filter:{protocol:t.protocol}}});if(n.reply.status.code!==200)throw new Error(`Could not fetch protocol: ${n.reply.status.detail}`);if(n.reply.entries===void 0||n.reply.entries.length===0){const{reply:i,message:o}=yield e.sendDwnRequest({author:r,target:r,messageType:Ke.ProtocolsConfigure,messageParams:{definition:t}});if(i.status.code!==202&&i.status.code!==409)throw new Error(`Could not send protocol: ${i.status.detail}`);yield e.processDwnRequest({author:r,target:r,messageType:Ke.ProtocolsConfigure,rawMessage:o})}else{const i=n.reply.entries[0],{reply:o}=yield e.sendDwnRequest({author:r,target:r,messageType:Ke.ProtocolsConfigure,rawMessage:i});if(o.status.code!==202&&o.status.code!==409)throw new Error(`Could not send protocol: ${o.status.detail}`)}})}function Zke(r,e,t,n){return Bs(this,void 0,void 0,function*(){const i=yield Wy.create(),o=yield i.export(),s=e.permissionRequests.map(p=>Bs(this,void 0,void 0,function*(){const{protocolDefinition:y,permissionScopes:g}=p;if(!g.every(m=>"protocol"in m&&m.protocol===y.protocol))throw new Error("All permission scopes must match the protocol uri they are provided with.");return yield Yke(r,n,y),yield cs.createPermissionGrants(r,i,n,g)})),a=(yield Promise.all(s)).flat(),l=yield cs.createResponseObject({iss:r,sub:i.uri,aud:e.client_id,nonce:e.nonce,delegateGrants:a,delegatePortableDid:o}),d=yield cs.signJwt({did:i,data:l}),c=yield Wy.resolve(e.client_id),u=yield cs.deriveSharedKey(i,c?.didDocument),f=cs.encryptAuthResponse({jwt:d,encryptionKey:u,delegateDidKeyId:i.document.verificationMethod[0].id,randomPin:t}),h=new URLSearchParams({id_token:f,state:e.state}).toString();yield fetch(e.redirect_uri,{body:h,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})})}const cs={createAuthRequest:Uke,encryptAuthRequest:Lke,getAuthRequest:Fke,decryptAuthRequest:MH,createPermissionGrants:Gke,createResponseObject:Kke,encryptAuthResponse:Wke,decryptAuthResponse:qke,deriveSharedKey:Vke,signJwt:zke,verifyJwt:DH,buildOidcUrl:jke,generateCodeChallenge:Nke,submitAuthResponse:Zke};var Jke=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};function Xke({connectServerUrl:r,walletUri:e,permissionRequests:t,onWalletUriReady:n,validatePin:i}){return Jke(this,void 0,void 0,function*(){const o=yield Wy.create(),s=wo.randomBytes(32),a=cs.buildOidcUrl({baseURL:r,endpoint:"callback"}),l=yield cs.createAuthRequest({client_id:o.uri,scope:"openid did:jwk",permissionRequests:t,redirect_uri:a}),d=yield cs.signJwt({did:o,data:l});if(!d)throw new Error("Unable to sign requestObject");const c=yield cs.encryptAuthRequest({jwt:d,encryptionKey:s}),u=new URLSearchParams({request:c}),f=cs.buildOidcUrl({baseURL:r,endpoint:"pushedAuthorizationRequest"}),h=yield fetch(f,{body:u,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!h.ok)throw new Error(`${h.status}: ${h.statusText}`);const p=yield h.json(),y=new URL(e);y.searchParams.set("request_uri",p.request_uri),y.searchParams.set("encryption_key",ge.uint8Array(s).toBase64Url()),n(y.toString());const g=cs.buildOidcUrl({baseURL:r,endpoint:"token",tokenParam:l.state}),w=yield N$e(()=>fetch(g));if(w){const v=yield w?.text(),m=yield i(),b=yield cs.decryptAuthResponse(o,v,m),_=yield cs.verifyJwt({jwt:b});return{delegateGrants:_.delegateGrants,delegatePortableDid:_.delegatePortableDid,connectedDid:_.iss}}})}function Qke({definition:r,permissions:e}){const t=[];t.push({protocol:r.protocol,interface:Ge.Protocols,method:Le.Query}),t.push({protocol:r.protocol,interface:Ge.Messages,method:Le.Read},{protocol:r.protocol,interface:Ge.Messages,method:Le.Query},{protocol:r.protocol,interface:Ge.Messages,method:Le.Subscribe});for(const n of e)switch(n){case"write":t.push({protocol:r.protocol,interface:Ge.Records,method:Le.Write});break;case"read":t.push({protocol:r.protocol,interface:Ge.Records,method:Le.Read});break;case"delete":t.push({protocol:r.protocol,interface:Ge.Records,method:Le.Delete});break;case"query":t.push({protocol:r.protocol,interface:Ge.Records,method:Le.Query});break;case"subscribe":t.push({protocol:r.protocol,interface:Ge.Records,method:Le.Subscribe});break;case"configure":t.push({protocol:r.protocol,interface:Ge.Protocols,method:Le.Configure});break}return{protocolDefinition:r,permissionScopes:t}}const aU={initClient:Xke,createPermissionRequestForProtocol:Qke};var cU=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},ePe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class tPe{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid}create(e){return cU(this,void 0,void 0,function*(){const t=yield this.agent.processDidRequest({messageType:pv.Create,messageParams:Object.assign({},e)}),{result:n}=t,i=ePe(t,["result"]);return Object.assign({did:n},i)})}resolve(e,t){return cU(this,void 0,void 0,function*(){const{result:n}=yield this.agent.processDidRequest({messageParams:{didUri:e,options:t},messageType:pv.Resolve});return n})}}function BH(r,e){let t;const n=sv(r);if(e==="text/plain"||n==="String")t=new Blob([r],{type:"text/plain"});else if(e==="application/json"||n==="Object"){const i=ge.object(r).toUint8Array();t=new Blob([i],{type:"application/json"})}else if(n==="Uint8Array"||n==="ArrayBuffer")t=new Blob([r],{type:"application/octet-stream"});else if(n==="Blob")t=r;else throw new Error("data type not supported.");return e=e||t.type||"application/octet-stream",{dataBlob:t,dataFormat:e}}class Ya{static check(e,t){let n=Ya.cache.get(e);return n?n.has(t):!1}static set(e,t){let n=Ya.cache.get(e)||new Set;if(Ya.cache.delete(e),Ya.cache.set(e,n),this.cache.size>Ya.sendCacheLimit){const i=Ya.cache.keys().next().value;Ya.cache.delete(i)}if(n.delete(t),n.add(t),n.size>Ya.sendCacheLimit){const i=n.keys().next().value;n.delete(i)}}}Ya.cache=new Map;Ya.sendCacheLimit=100;var As=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},lU=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class xu{get _recordsWriteDescriptor(){if(Nk(Ke.RecordsWrite,this.rawMessage))return this._descriptor}get _immutableProperties(){return this._recordsWriteDescriptor||this._initialWrite.descriptor}get id(){return this._recordId}get contextId(){return this.deleted?this._initialWrite.contextId:this._contextId}get dateCreated(){return this._immutableProperties.dateCreated}get parentId(){return this._immutableProperties.parentId}get protocol(){return this._immutableProperties.protocol}get protocolPath(){return this._immutableProperties.protocolPath}get recipient(){return this._immutableProperties.recipient}get schema(){return this._immutableProperties.schema}get dataFormat(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataFormat}get dataCid(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataCid}get dataSize(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataSize}get datePublished(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.datePublished}get published(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.published}get tags(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.tags}get author(){return this._author}get creator(){return this._creator}get dateModified(){return this._descriptor.messageTimestamp}get encryption(){return this._encryption}get authorization(){return this._authorization}get attestation(){return this._attestation}get protocolRole(){return this._protocolRole}get deleted(){return Nk(Ke.RecordsDelete,this.rawMessage)}get initialWrite(){return this._initialWrite}get rawMessage(){const e=this._descriptor.interface+this._descriptor.method;let t;return e===Ke.RecordsWrite?t=JSON.parse(JSON.stringify({contextId:this._contextId,recordId:this._recordId,descriptor:this._descriptor,attestation:this._attestation,authorization:this._authorization,encryption:this._encryption})):t=JSON.parse(JSON.stringify({descriptor:this._descriptor,authorization:this._authorization})),XA(t),t}constructor(e,t,n){this._agent=e,this._author=t.author,this._creator=t.initialWrite?mv(t.initialWrite):t.author,this._connectedDid=t.connectedDid,this._delegateDid=t.delegateDid,this._permissionsApi=n??new Jc({agent:e}),this._remoteOrigin=t.remoteOrigin,this._attestation=t.attestation,this._authorization=t.authorization,this._contextId=t.contextId,this._descriptor=t.descriptor,this._encryption=t.encryption,this._initialWrite=t.initialWrite,this._recordId=this.isRecordsDeleteDescriptor(t.descriptor)?t.descriptor.recordId:t.recordId,this._protocolRole=t.protocolRole,t.encodedData&&(this._encodedData=typeof t.encodedData=="string"?new Blob([ge.base64Url(t.encodedData).toUint8Array()],{type:this.dataFormat}):t.encodedData),t.data&&(this._readableStream=oa.isReadableStream(t.data)?lo.fromWebReadable({readableStream:t.data}):t.data)}get data(){const e=this;return{blob(){return As(this,void 0,void 0,function*(){return new Blob([yield lo.consumeToBytes({readable:yield this.stream()})],{type:e.dataFormat})})},bytes(){return As(this,void 0,void 0,function*(){return yield lo.consumeToBytes({readable:yield this.stream()})})},json(){return As(this,void 0,void 0,function*(){return yield lo.consumeToJson({readable:yield this.stream()})})},text(){return As(this,void 0,void 0,function*(){return yield lo.consumeToText({readable:yield this.stream()})})},stream(){return As(this,void 0,void 0,function*(){if(e._encodedData?e._readableStream=lo.fromWebReadable({readableStream:e._encodedData.stream()}):lo.isReadable({readable:e._readableStream})||(e._readableStream=e._remoteOrigin?yield e.readRecordData({target:e._remoteOrigin,isRemote:!0}):yield e.readRecordData({target:e._connectedDid,isRemote:!1})),!e._readableStream)throw new Error("Record data is not available.");return e._readableStream})},then(n,i){return this.stream().then(n,i)},catch(n){return this.stream().catch(n)}}}store(e=!1){return As(this,void 0,void 0,function*(){return this.processRecord({signAsOwner:e,store:!0})})}import(e=!0){return As(this,void 0,void 0,function*(){return this.processRecord({store:e,signAsOwner:!0})})}send(e){return As(this,void 0,void 0,function*(){const t=this._initialWrite;if(e??(e=this._connectedDid),t&&!xu._sendCache.check(this._recordId,e)){const o=Object.assign({},t);XA(o),yield this._agent.sendDwnRequest({messageType:Ke.RecordsWrite,author:this._connectedDid,target:e,rawMessage:o}),xu._sendCache.set(this._recordId,e)}let n;this.deleted?n={messageType:Ke.RecordsDelete,author:this._connectedDid,target:e,rawMessage:Object.assign({},this.rawMessage)}:n={messageType:Ke.RecordsWrite,author:this._connectedDid,target:e,dataStream:yield this.data.blob(),rawMessage:Object.assign({},this.rawMessage)};const{reply:i}=yield this._agent.sendDwnRequest(n);return i})}toJSON(){return{attestation:this.attestation,author:this.author,authorization:this.authorization,contextId:this.contextId,dataCid:this.dataCid,dataFormat:this.dataFormat,dataSize:this.dataSize,dateCreated:this.dateCreated,messageTimestamp:this.dateModified,datePublished:this.datePublished,encryption:this.encryption,parentId:this.parentId,protocol:this.protocol,protocolPath:this.protocolPath,protocolRole:this.protocolRole,published:this.published,recipient:this.recipient,recordId:this.id,schema:this.schema,tags:this.tags}}toString(){let e=`Record: {
`;return e+=`  ID: ${this.id}
`,e+=this.contextId?`  Context ID: ${this.contextId}
`:"",e+=this.protocol?`  Protocol: ${this.protocol}
`:"",e+=this.schema?`  Schema: ${this.schema}
`:"",this.deleted||(e+=`  Data CID: ${this.dataCid}
`,e+=`  Data Format: ${this.dataFormat}
`,e+=`  Data Size: ${this.dataSize}
`),e+=`  Deleted: ${this.deleted}
`,e+=`  Created: ${this.dateCreated}
`,e+=`  Modified: ${this.dateModified}
`,e+="}",e}paginationCursor(e){return As(this,void 0,void 0,function*(){return Nk(Ke.RecordsWrite,this.rawMessage)?j$e(this.rawMessage,e):void 0})}update(e){var{dateModified:t,data:n}=e,i=lU(e,["dateModified","data"]);return As(this,void 0,void 0,function*(){if(this.deleted)throw new Error("Record: Cannot revive a deleted record.");const o=this._recordsWriteDescriptor,{parentId:s}=o,a=lU(o,["parentId"]),l=s?this._contextId.split("/").slice(0,-1).join("/"):void 0;let d=Object.assign(Object.assign(Object.assign({},a),i),{parentContextId:l,messageTimestamp:t,recordId:this._recordId});(gW(d.tags)||d.tags===null)&&delete d.tags;let c;n!==void 0&&(delete d.dataCid,delete d.dataSize,{dataBlob:c}=BH(n,d.dataFormat));const u=new Set(["data","dataCid","dataFormat","dataSize","datePublished","messageTimestamp","published","tags"]);xu.verifyPermittedMutation(Object.keys(i),u),i.published===!1&&d.datePublished!==void 0&&delete d.datePublished;const f={author:this._connectedDid,dataStream:c,messageParams:Object.assign({},d),messageType:Ke.RecordsWrite,target:this._connectedDid};if(this._delegateDid){const{message:w}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:f.messageType});f.messageParams.delegatedGrant=w,f.granteeDid=this._delegateDid}const h=yield this._agent.processDwnRequest(f),{message:p,reply:{status:y}}=h,g=p;return 200<=y.code&&y.code<=299&&(this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),this._authorization=g.authorization,this._protocolRole=i.protocolRole,u.forEach(w=>{this._descriptor[w]=g.descriptor[w]}),n!==void 0&&(this._encodedData=c)),{status:y}})}delete(e){return As(this,void 0,void 0,function*(){const{store:t=!0,signAsOwner:n,dateModified:i,prune:o=!1}=e||{},s=n&&this._delegateDid===void 0,a=n&&this._delegateDid!==void 0;if(this.deleted&&!this._initialWrite)throw new Error("Record: Record is in an invalid state, initial write is missing.");this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),yield this.processInitialWriteIfNeeded({store:t,signAsOwner:n});let l={messageType:Ke.RecordsDelete,author:this._connectedDid,target:this._connectedDid,signAsOwner:s,signAsOwnerDelegate:a,store:t};if(this.deleted?l.rawMessage=this.rawMessage:l.messageParams={prune:o,recordId:this._recordId,messageTimestamp:i},this._delegateDid){const{message:f}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:l.messageType});l.messageParams=Object.assign(Object.assign({},l.messageParams),{delegatedGrant:f}),l.granteeDid=this._delegateDid}const d=yield this._agent.processDwnRequest(l),{message:c,reply:{status:u}}=d;return u.code!==202?{status:u}:(this._author=mv(c),this._descriptor=c.descriptor,this._authorization=c.authorization,this._encodedData=void 0,this._encryption=void 0,this._attestation=void 0,this._contextId=void 0,{status:u})})}processInitialWriteIfNeeded({store:e,signAsOwner:t}){return As(this,void 0,void 0,function*(){if(this.initialWrite&&(t&&!this._initialWriteSigned||e&&!this._initialWriteStored)){const n=t&&this._delegateDid===void 0,i=t&&this._delegateDid!==void 0,o={messageType:Ke.RecordsWrite,rawMessage:this.initialWrite,author:this._connectedDid,target:this._connectedDid,signAsOwner:n,signAsOwnerDelegate:i,store:e};if(this._delegateDid){const{message:c}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:o.messageType});o.messageParams=Object.assign(Object.assign({},o.messageParams),{delegatedGrant:c}),o.granteeDid=this._delegateDid}const s=yield this._agent.processDwnRequest(o),{message:a,reply:{status:l}}=s,d=a;200<=l.code&&l.code<=299&&(e&&(this._initialWriteStored=!0),t&&(this._initialWriteSigned=!0,this.initialWrite.authorization=d.authorization))}})}processRecord({store:e,signAsOwner:t}){return As(this,void 0,void 0,function*(){const n=t&&this._delegateDid===void 0,i=t&&this._delegateDid!==void 0;yield this.processInitialWriteIfNeeded({store:e,signAsOwner:t});let o;if(this.deleted?o={messageType:Ke.RecordsDelete,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,signAsOwner:n,signAsOwnerDelegate:i,store:e}:o={messageType:Ke.RecordsWrite,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,dataStream:yield this.data.blob(),signAsOwner:n,signAsOwnerDelegate:i,store:e},this._delegateDid){const{message:c}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:o.messageType});o.messageParams=Object.assign(Object.assign({},o.messageParams),{delegatedGrant:c}),o.granteeDid=this._delegateDid}const s=yield this._agent.processDwnRequest(o),{message:a,reply:{status:l}}=s,d=a;return 200<=l.code&&l.code<=299&&t&&(this._authorization=d.authorization),{status:l}})}readRecordData({target:e,isRemote:t}){return As(this,void 0,void 0,function*(){const n={author:this._connectedDid,messageParams:{filter:{recordId:this.id}},messageType:Ke.RecordsRead,target:e};if(this._delegateDid)try{const{message:o}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:n.messageType});n.messageParams=Object.assign(Object.assign({},n.messageParams),{delegatedGrant:o}),n.granteeDid=this._delegateDid}catch{n.author=this._delegateDid}const i=t?this._agent.sendDwnRequest(n):this._agent.processDwnRequest(n);try{const{reply:{status:o,record:s}}=yield i;if(o.code!==200)throw new Error(`${o.code}: ${o.detail}`);const a=s.data;return oa.isReadableStream(a)?lo.fromWebReadable({readableStream:a}):a}catch(o){throw new Error(`Error encountered while attempting to read data: ${o.message}`)}})}static verifyPermittedMutation(e,t){for(const n of e)if(!t.has(n))throw new Error(`${n} is an immutable property. Its value cannot be changed.`)}isRecordsDeleteDescriptor(e){return e.interface+e.method===Ke.RecordsDelete}}xu._sendCache=Ya;var rPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class dU{constructor(e,t,n){this._agent=e,this._metadata=n,this._protocolsConfigureMessage=t}get definition(){return this._protocolsConfigureMessage.descriptor.definition}toJSON(){return this._protocolsConfigureMessage}send(e){return rPe(this,void 0,void 0,function*(){const{reply:t}=yield this._agent.sendDwnRequest({author:this._metadata.author,messageCid:this._metadata.messageCid,messageType:Ke.ProtocolsConfigure,target:e});return{status:t.status}})}}var qk=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},uU=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class h6{constructor(e,t){this._permissions=e,this._connectedDid=t.connectedDid,this._message=t.message}get author(){return mv(this._message)}static parse({connectedDid:e,agent:t,message:n}){return qk(this,void 0,void 0,function*(){const i=new Jc({agent:t});return new h6(i,{connectedDid:e,message:n})})}get agent(){return this._permissions.agent}get rawMessage(){return this._message}send(e){return qk(this,void 0,void 0,function*(){e??(e=this._connectedDid);const t=this._message,{encodedData:n}=t,i=uU(t,["encodedData"]),o=new Blob([ge.base64Url(n).toUint8Array()]),s={messageType:Ke.RecordsWrite,author:this._connectedDid,target:e,dataStream:o,rawMessage:i},{reply:a}=yield this.agent.sendDwnRequest(s);return a})}store(e){return qk(this,void 0,void 0,function*(){const t=this.rawMessage,{encodedData:n}=t,i=uU(t,["encodedData"]),o=new Blob([ge.base64Url(n).toUint8Array()]),{reply:s,message:a}=yield this.agent.processDwnRequest({author:this._connectedDid,target:this._connectedDid,messageType:Ke.RecordsWrite,signAsOwner:e,rawMessage:i,dataStream:o});return this._message=Object.assign(Object.assign({},a),{encodedData:n}),{status:s.status}})}}var eb=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Vk=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class gv{constructor({api:e,connectedDid:t,message:n,grant:i}){this._permissions=e,this._connectedDid=t,this._message=n,this._grant=i}static parse(e){return eb(this,void 0,void 0,function*(){const t=yield Rs.parse(e.message),n=new Jc({agent:e.agent});return new gv(Object.assign(Object.assign({},e),{grant:t,api:n}))})}get agent(){return this._permissions.agent}get id(){return this._grant.id}get grantor(){return this._grant.grantor}get grantee(){return this._grant.grantee}get dateGranted(){return this._grant.dateGranted}get description(){return this._grant.description}get requestId(){return this._grant.requestId}get dateExpires(){return this._grant.dateExpires}get delegated(){return this._grant.delegated}get scope(){return this._grant.scope}get conditions(){return this._grant.conditions}get rawMessage(){return this._message}send(e){return eb(this,void 0,void 0,function*(){e??(e=this._connectedDid);const t=this._message,{encodedData:n}=t,i=Vk(t,["encodedData"]),o=new Blob([ge.base64Url(n).toUint8Array()]),s={messageType:Ke.RecordsWrite,author:this._connectedDid,target:e,dataStream:o,rawMessage:i},{reply:a}=yield this.agent.sendDwnRequest(s);return a})}store(e=!1){return eb(this,void 0,void 0,function*(){const t=this.rawMessage,{encodedData:n}=t,i=Vk(t,["encodedData"]),o=new Blob([ge.base64Url(n).toUint8Array()]),{reply:s,message:a}=yield this.agent.processDwnRequest({store:!0,author:this._connectedDid,target:this._connectedDid,messageType:Ke.RecordsWrite,signAsOwner:e,rawMessage:i,dataStream:o});return this._message=Object.assign(Object.assign({},a),{encodedData:n}),{status:s.status}})}import(e=!1){return eb(this,void 0,void 0,function*(){const t=this.rawMessage,{encodedData:n}=t,i=Vk(t,["encodedData"]),o=new Blob([ge.base64Url(n).toUint8Array()]),{reply:s,message:a}=yield this.agent.processDwnRequest({store:e,author:this._connectedDid,target:this._connectedDid,messageType:Ke.RecordsWrite,signAsOwner:!0,rawMessage:i,dataStream:o});return this._message=Object.assign(Object.assign({},a),{encodedData:n}),{status:s.status}})}revoke(e=!0){return eb(this,void 0,void 0,function*(){const t=yield this._permissions.createRevocation({store:e,author:this._connectedDid,grant:this._grant});return h6.parse({connectedDid:this._connectedDid,agent:this.agent,message:t.message})})}isRevoked(e=!1){return this._permissions.isGrantRevoked({author:this._connectedDid,target:this.grantor,grantRecordId:this.id,remote:e})}toJSON(){return{id:this.id,grantor:this.grantor,grantee:this.grantee,dateGranted:this.dateGranted,description:this.description,requestId:this.requestId,dateExpires:this.dateExpires,delegated:this.delegated,scope:this.scope,conditions:this.conditions}}}var j2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},fU=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class cx{constructor({api:e,connectedDid:t,message:n,request:i}){this._permissions=e,this._connectedDid=t,this._request=i,this._message=n}static parse({connectedDid:e,agent:t,message:n}){return j2(this,void 0,void 0,function*(){const i=yield MA.parse(n),o=new Jc({agent:t});return new cx({api:o,connectedDid:e,message:n,request:i})})}get agent(){return this._permissions.agent}get id(){return this._request.id}get requester(){return this._request.requester}get description(){return this._request.description}get delegated(){return this._request.delegated}get scope(){return this._request.scope}get conditions(){return this._request.conditions}get rawMessage(){return this._message}send(e){return j2(this,void 0,void 0,function*(){e??(e=this._connectedDid);const t=this._message,{encodedData:n}=t,i=fU(t,["encodedData"]),o=new Blob([ge.base64Url(n).toUint8Array()]),s={messageType:Ke.RecordsWrite,author:this._connectedDid,target:e,dataStream:o,rawMessage:i},{reply:a}=yield this.agent.sendDwnRequest(s);return a})}store(){return j2(this,void 0,void 0,function*(){const e=this.rawMessage,{encodedData:t}=e,n=fU(e,["encodedData"]),i=new Blob([ge.base64Url(t).toUint8Array()]),{reply:o,message:s}=yield this.agent.processDwnRequest({author:this._connectedDid,target:this._connectedDid,messageType:Ke.RecordsWrite,rawMessage:n,dataStream:i});return this._message=Object.assign(Object.assign({},s),{encodedData:t}),{status:o.status}})}grant(e,t=!0){return j2(this,void 0,void 0,function*(){const{message:n}=yield this._permissions.createGrant({requestId:this.id,grantedTo:this.requester,scope:this.scope,delegated:this.delegated,author:this._connectedDid,store:t,dateExpires:e});return gv.parse({connectedDid:this._connectedDid,agent:this.agent,message:n})})}toJSON(){return this._request}}var nPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class iPe{static recordSubscriptionHandler({agent:e,connectedDid:t,request:n,delegateDid:i,permissionsApi:o}){const{subscriptionHandler:s,from:a}=n;return l=>nPe(this,void 0,void 0,function*(){const{message:d,initialWrite:c}=l,f={author:mv(d),connectedDid:t,remoteOrigin:a,initialWrite:c},h=new xu(e,Object.assign(Object.assign(Object.assign({},d),f),{delegateDid:i}),o);s(h)})}}var Ys=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Wk=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class oPe{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid,this.delegateDid=e.delegateDid,this.permissionsApi=new Jc({agent:this.agent})}get permissions(){return{request:e=>Ys(this,void 0,void 0,function*(){var t,n;const{message:i}=yield this.permissionsApi.createRequest(Object.assign(Object.assign({},e),{author:(t=this.delegateDid)!==null&&t!==void 0?t:this.connectedDid})),o={connectedDid:(n=this.delegateDid)!==null&&n!==void 0?n:this.connectedDid,agent:this.agent,message:i};return yield cx.parse(o)}),grant:e=>Ys(this,void 0,void 0,function*(){var t,n;const{message:i}=yield this.permissionsApi.createGrant(Object.assign(Object.assign({},e),{author:(t=this.delegateDid)!==null&&t!==void 0?t:this.connectedDid})),o={connectedDid:(n=this.delegateDid)!==null&&n!==void 0?n:this.connectedDid,agent:this.agent,message:i};return yield gv.parse(o)}),queryRequests:(e={})=>Ys(this,void 0,void 0,function*(){var t,n,i;const{from:o}=e,s=Wk(e,["from"]),a=yield this.permissionsApi.fetchRequests(Object.assign(Object.assign({},s),{author:(t=this.delegateDid)!==null&&t!==void 0?t:this.connectedDid,target:(n=o??this.delegateDid)!==null&&n!==void 0?n:this.connectedDid,remote:o!==void 0})),l=[];for(const d of a){const c={connectedDid:(i=this.delegateDid)!==null&&i!==void 0?i:this.connectedDid,agent:this.agent,message:d.message};l.push(yield cx.parse(c))}return l}),queryGrants:(e={})=>Ys(this,void 0,void 0,function*(){var t,n,i;const{checkRevoked:o,from:s}=e,a=Wk(e,["checkRevoked","from"]),l=s!==void 0,d=(t=this.delegateDid)!==null&&t!==void 0?t:this.connectedDid,c=(n=s??this.delegateDid)!==null&&n!==void 0?n:this.connectedDid,u=yield this.permissionsApi.fetchGrants(Object.assign(Object.assign({},a),{author:d,target:c,remote:l})),f=[];for(const h of u){const p={connectedDid:(i=this.delegateDid)!==null&&i!==void 0?i:this.connectedDid,agent:this.agent,message:h.message};if(o){const y=h.grant.id;if(yield this.permissionsApi.isGrantRevoked({author:d,target:c,grantRecordId:y,remote:l}))continue}f.push(yield gv.parse(p))}return f})}}get protocols(){return{configure:e=>Ys(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:e.message,messageType:Ke.ProtocolsConfigure,target:this.connectedDid};if(this.delegateDid){const{message:l}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.definition.protocol,delegate:!0,cached:!0,messageType:t.messageType});t.messageParams=Object.assign(Object.assign({},t.messageParams),{delegatedGrant:l}),t.granteeDid=this.delegateDid}const n=yield this.agent.processDwnRequest(t),{message:i,messageCid:o,reply:{status:s}}=n,a={status:s};if(s.code<300){const l={author:this.connectedDid,messageCid:o};a.protocol=new dU(this.agent,i,l)}return a}),query:e=>Ys(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:e.message,messageType:Ke.ProtocolsQuery,target:e.from||this.connectedDid};if(this.delegateDid)try{const{grant:{id:l}}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.filter.protocol,cached:!0,messageType:t.messageType});t.messageParams=Object.assign(Object.assign({},t.messageParams),{permissionGrantId:l}),t.granteeDid=this.delegateDid}catch{t.author=this.delegateDid}let n;e.from?n=yield this.agent.sendDwnRequest(t):n=yield this.agent.processDwnRequest(t);const i=n.reply,{entries:o=[],status:s}=i;return{protocols:o.map(l=>{const d={author:this.connectedDid};return new dU(this.agent,l,d)}),status:s}})}}get records(){return{create:e=>Ys(this,void 0,void 0,function*(){return this.records.write(e)}),createFrom:e=>Ys(this,void 0,void 0,function*(){var t;const n=e.record.toJSON(),{author:i}=n,o=Wk(n,["author"]);return e.data!==void 0&&(delete o.dataCid,delete o.dataSize),((t=e.message)===null||t===void 0?void 0:t.published)===!1&&o.datePublished!==void 0&&(delete o.datePublished,delete o.published),(!gW(e.message)||e.author&&e.author!==i)&&delete o.recordId,this.records.write({data:e.data,message:Object.assign(Object.assign({},o),e.message)})}),delete:e=>Ys(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:e.message,messageType:Ke.RecordsDelete,target:e.from||this.connectedDid};if(this.delegateDid){const{message:o}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:t.messageType});t.messageParams=Object.assign(Object.assign({},t.messageParams),{delegatedGrant:o}),t.granteeDid=this.delegateDid}let n;e.from?n=yield this.agent.sendDwnRequest(t):n=yield this.agent.processDwnRequest(t);const{reply:{status:i}}=n;return{status:i}}),query:e=>Ys(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:e.message,messageType:Ke.RecordsQuery,target:e.from||this.connectedDid};if(this.delegateDid)try{const{message:d}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:t.messageType});t.messageParams=Object.assign(Object.assign({},t.messageParams),{delegatedGrant:d}),t.granteeDid=this.delegateDid}catch{t.author=this.delegateDid}let n;e.from?n=yield this.agent.sendDwnRequest(t):n=yield this.agent.processDwnRequest(t);const i=n.reply,{entries:o=[],status:s,cursor:a}=i;return{records:o.map(d=>{const c=Object.assign({author:mv(d),connectedDid:this.connectedDid,remoteOrigin:e.from,delegateDid:this.delegateDid},d);return new xu(this.agent,c,this.permissionsApi)}),status:s,cursor:a}}),read:e=>Ys(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:e.message,messageType:Ke.RecordsRead,target:e.from||this.connectedDid};if(this.delegateDid)try{const{message:a}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:t.messageType});t.messageParams=Object.assign(Object.assign({},t.messageParams),{delegatedGrant:a}),t.granteeDid=this.delegateDid}catch{t.author=this.delegateDid}let n;e.from?n=yield this.agent.sendDwnRequest(t):n=yield this.agent.processDwnRequest(t);const{reply:{record:i,status:o}}=n;let s;if(200<=o.code&&o.code<=299){const a=Object.assign({author:mv(i),connectedDid:this.connectedDid,remoteOrigin:e.from,delegateDid:this.delegateDid},i);s=new xu(this.agent,a,this.permissionsApi)}return{record:s,status:o}}),subscribe:e=>Ys(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:e.message,messageType:Ke.RecordsSubscribe,target:e.from||this.connectedDid,subscriptionHandler:iPe.recordSubscriptionHandler({agent:this.agent,connectedDid:this.connectedDid,delegateDid:this.delegateDid,permissionsApi:this.permissionsApi,request:e})};if(this.delegateDid)try{const{message:a}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:t.messageType});t.messageParams=Object.assign(Object.assign({},t.messageParams),{delegatedGrant:a}),t.granteeDid=this.delegateDid}catch{t.author=this.delegateDid}let n;e.from?n=yield this.agent.sendDwnRequest(t):n=yield this.agent.processDwnRequest(t);const i=n.reply,{status:o,subscription:s}=i;return{status:o,subscription:s}}),write:e=>Ys(this,void 0,void 0,function*(){var t;const{dataBlob:n,dataFormat:i}=BH(e.data,(t=e.message)===null||t===void 0?void 0:t.dataFormat),o={store:e.store,messageType:Ke.RecordsWrite,messageParams:Object.assign(Object.assign({},e.message),{dataFormat:i}),author:this.connectedDid,target:this.connectedDid,dataStream:n};if(this.delegateDid){const{message:c}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.protocol,delegate:!0,cached:!0,messageType:o.messageType});o.messageParams=Object.assign(Object.assign({},o.messageParams),{delegatedGrant:c}),o.granteeDid=this.delegateDid}const s=yield this.agent.processDwnRequest(o),{message:a,reply:{status:l}}=s;let d;if(200<=l.code&&l.code<=299){const c=Object.assign({author:this.connectedDid,connectedDid:this.connectedDid,encodedData:n,delegateDid:this.delegateDid},a);d=new xu(this.agent,c,this.permissionsApi)}return{record:d,status:l}})}}}var sPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class aPe{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid}create(){return sPe(this,void 0,void 0,function*(){throw new Error("Not implemented.")})}}var t_;(function(r){r.authentication="authentication",r.assertionMethod="assertionMethod",r.keyAgreement="keyAgreement",r.capabilityInvocation="capabilityInvocation",r.capabilityDelegation="capabilityDelegation"})(t_||(t_={}));const vo={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};class vr{constructor({method:e,id:t,path:n,query:i,fragment:o,params:s}){this.uri=`did:${e}:${t}`,this.method=e,this.id=t,this.path=n,this.query=i,this.fragment=o,this.params=s}static parse(e){if(!e)return null;const t=vr.DID_URI_PATTERN.exec(e);if(!t||!t.groups)return null;const{method:n,id:i,path:o,query:s,fragment:a}=t.groups,l={uri:`did:${n}:${i}`,method:n,id:i};if(o&&(l.path=o),s&&(l.query=s.slice(1)),a&&(l.fragment=a.slice(1)),s){const d={},c=s.slice(1).split("&");for(const u of c){const[f,h]=u.split("=");d[f]=h}l.params=d}return l}}vr.METHOD_PATTERN="([a-z0-9]+)";vr.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";vr.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${vr.PCT_ENCODED_PATTERN})`;vr.METHOD_ID_PATTERN=`((?:${vr.ID_CHAR_PATTERN}*:)*(${vr.ID_CHAR_PATTERN}+))`;vr.PATH_PATTERN="(/[^#?]*)?";vr.QUERY_PATTERN="([?][^#]*)?";vr.FRAGMENT_PATTERN="(#.*)?";vr.DID_URI_PATTERN=new RegExp(`^did:(?<method>${vr.METHOD_PATTERN}):(?<id>${vr.METHOD_ID_PATTERN})(?<path>${vr.PATH_PATTERN})(?<query>${vr.QUERY_PATTERN})(?<fragment>${vr.FRAGMENT_PATTERN})$`);class lt extends Error{constructor(e,t){super(`${e}: ${t}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lt)}}var at;(function(r){r.InvalidDid="invalidDid",r.MethodNotSupported="methodNotSupported",r.InternalError="internalError",r.InvalidDidDocument="invalidDidDocument",r.InvalidDidDocumentLength="invalidDidDocumentLength",r.InvalidDidUrl="invalidDidUrl",r.InvalidPreviousDidProof="invalidPreviousDidProof",r.InvalidPublicKey="invalidPublicKey",r.InvalidPublicKeyLength="invalidPublicKeyLength",r.InvalidPublicKeyType="invalidPublicKeyType",r.InvalidSignature="invalidSignature",r.NotFound="notFound",r.RepresentationNotSupported="representationNotSupported",r.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(at||(at={}));var cPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class jH{static digest({data:e}){return cPe(this,void 0,void 0,function*(){return Bu(e)})}}class p6{}var lPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class dPe extends p6{digest({algorithm:e,data:t}){return lPe(this,void 0,void 0,function*(){switch(e){case"SHA-256":return yield jH.digest({data:t})}})}}function uPe(r){const e=n=>{if(n!==null&&typeof n=="object"&&!Array.isArray(n)){const i=Object.keys(n).sort(),o={};for(const s of i)o[s]=e(n[s]);return o}return n},t=e(r);return JSON.stringify(t)}var fPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const hU="urn:jwk:";function Fr({jwk:r}){return fPe(this,void 0,void 0,function*(){const e=r.kty;let t;if(e==="EC")t={crv:r.crv,kty:r.kty,x:r.x,y:r.y};else if(e==="oct")t={k:r.k,kty:r.kty};else if(e==="OKP")t={crv:r.crv,kty:r.kty,x:r.x};else if(e==="RSA")t={e:r.e,kty:r.kty,n:r.n};else throw new Error(`Unsupported key type: ${e}`);XA(t);const n=uPe(t),i=ge.string(n).toUint8Array(),o=yield jH.digest({data:i});return ge.uint8Array(o).toBase64Url()})}function wy(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r&&"d"in r)||r.kty!=="EC"||typeof r.d!="string"||typeof r.x!="string")}function y6(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r)||"d"in r||r.kty!=="EC"||typeof r.x!="string")}function _y(r){return!(!r||typeof r!="object"||!("kty"in r&&"crv"in r&&"x"in r&&"d"in r)||r.kty!=="OKP"||typeof r.d!="string"||typeof r.x!="string")}function m6(r){return!(!r||typeof r!="object"||"d"in r||!("kty"in r&&"crv"in r&&"x"in r)||r.kty!=="OKP"||typeof r.x!="string")}function hPe(r){if(!r||typeof r!="object")return!1;switch(r.kty){case"EC":case"OKP":case"RSA":return"d"in r;case"oct":return"k"in r;default:return!1}}var Hi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},pPe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class An{static adjustSignatureToLowS({signature:e}){return Hi(this,void 0,void 0,function*(){const t=ar.Signature.fromCompact(e);return t.hasHighS()?t.normalizeS().toCompactRawBytes():e})}static bytesToPrivateKey({privateKeyBytes:e}){return Hi(this,void 0,void 0,function*(){const t=yield An.getCurvePoint({keyBytes:e}),n={kty:"EC",crv:"secp256k1",d:ge.uint8Array(e).toBase64Url(),x:ge.uint8Array(t.x).toBase64Url(),y:ge.uint8Array(t.y).toBase64Url()};return n.kid=yield Fr({jwk:n}),n})}static bytesToPublicKey({publicKeyBytes:e}){return Hi(this,void 0,void 0,function*(){const t=yield An.getCurvePoint({keyBytes:e}),n={kty:"EC",crv:"secp256k1",x:ge.uint8Array(t.x).toBase64Url(),y:ge.uint8Array(t.y).toBase64Url()};return n.kid=yield Fr({jwk:n}),n})}static compressPublicKey({publicKeyBytes:e}){return Hi(this,void 0,void 0,function*(){return ar.ProjectivePoint.fromHex(e).toRawBytes(!0)})}static computePublicKey({key:e}){return Hi(this,void 0,void 0,function*(){const t=yield An.privateKeyToBytes({privateKey:e}),n=yield An.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"secp256k1",x:ge.uint8Array(n.x).toBase64Url(),y:ge.uint8Array(n.y).toBase64Url()};return i.kid=yield Fr({jwk:i}),i})}static convertDerToCompactSignature({derSignature:e}){return Hi(this,void 0,void 0,function*(){return ar.Signature.fromDER(e).toCompactRawBytes()})}static decompressPublicKey({publicKeyBytes:e}){return Hi(this,void 0,void 0,function*(){return ar.ProjectivePoint.fromHex(e).toRawBytes(!1)})}static generateKey(){return Hi(this,void 0,void 0,function*(){const e=ar.utils.randomPrivateKey(),t=yield An.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Fr({jwk:t}),t})}static getPublicKey({key:e}){var t;return Hi(this,void 0,void 0,function*(){if(!(wy(e)&&e.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let n=pPe(e,["d"]);return(t=n.kid)!==null&&t!==void 0||(n.kid=yield Fr({jwk:n})),n})}static privateKeyToBytes({privateKey:e}){return Hi(this,void 0,void 0,function*(){if(!wy(e))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return ge.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return Hi(this,void 0,void 0,function*(){if(!(y6(e)&&e.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const t=new Uint8Array([4]),n=ge.base64Url(e.x).toUint8Array(),i=ge.base64Url(e.y).toUint8Array();return new Uint8Array([...t,...n,...i])})}static sharedSecret({privateKeyA:e,publicKeyB:t}){return Hi(this,void 0,void 0,function*(){if("x"in e&&"x"in t&&e.x===t.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const n=yield An.privateKeyToBytes({privateKey:e}),i=yield An.publicKeyToBytes({publicKey:t});return ar.getSharedSecret(n,i,!0).slice(1)})}static sign({data:e,key:t}){return Hi(this,void 0,void 0,function*(){const n=yield An.privateKeyToBytes({privateKey:t}),i=Bu(e);return ar.sign(i,n).toCompactRawBytes()})}static validatePrivateKey({privateKeyBytes:e}){return Hi(this,void 0,void 0,function*(){return ar.utils.isValidPrivateKey(e)})}static validatePublicKey({publicKeyBytes:e}){return Hi(this,void 0,void 0,function*(){try{ar.ProjectivePoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:t,data:n}){return Hi(this,void 0,void 0,function*(){const i=yield An.publicKeyToBytes({publicKey:e}),o=Bu(n);return ar.verify(t,o,i,{lowS:!1})})}static getCurvePoint({keyBytes:e}){return Hi(this,void 0,void 0,function*(){e.byteLength===32&&(e=ar.getPublicKey(e));const t=ar.ProjectivePoint.fromHex(e),n=Mi(t.x,32),i=Mi(t.y,32);return{x:n,y:i}})}}var Gi=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},yPe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class In{static adjustSignatureToLowS({signature:e}){return Gi(this,void 0,void 0,function*(){const t=ur.Signature.fromCompact(e);return t.hasHighS()?t.normalizeS().toCompactRawBytes():e})}static bytesToPrivateKey({privateKeyBytes:e}){return Gi(this,void 0,void 0,function*(){const t=yield In.getCurvePoint({keyBytes:e}),n={kty:"EC",crv:"P-256",d:ge.uint8Array(e).toBase64Url(),x:ge.uint8Array(t.x).toBase64Url(),y:ge.uint8Array(t.y).toBase64Url()};return n.kid=yield Fr({jwk:n}),n})}static bytesToPublicKey({publicKeyBytes:e}){return Gi(this,void 0,void 0,function*(){const t=yield In.getCurvePoint({keyBytes:e}),n={kty:"EC",crv:"P-256",x:ge.uint8Array(t.x).toBase64Url(),y:ge.uint8Array(t.y).toBase64Url()};return n.kid=yield Fr({jwk:n}),n})}static compressPublicKey({publicKeyBytes:e}){return Gi(this,void 0,void 0,function*(){return ur.ProjectivePoint.fromHex(e).toRawBytes(!0)})}static computePublicKey({key:e}){return Gi(this,void 0,void 0,function*(){const t=yield In.privateKeyToBytes({privateKey:e}),n=yield In.getCurvePoint({keyBytes:t}),i={kty:"EC",crv:"P-256",x:ge.uint8Array(n.x).toBase64Url(),y:ge.uint8Array(n.y).toBase64Url()};return i.kid=yield Fr({jwk:i}),i})}static convertDerToCompactSignature({derSignature:e}){return Gi(this,void 0,void 0,function*(){return ur.Signature.fromDER(e).toCompactRawBytes()})}static decompressPublicKey({publicKeyBytes:e}){return Gi(this,void 0,void 0,function*(){return ur.ProjectivePoint.fromHex(e).toRawBytes(!1)})}static generateKey(){return Gi(this,void 0,void 0,function*(){const e=ur.utils.randomPrivateKey(),t=yield In.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Fr({jwk:t}),t})}static getPublicKey({key:e}){var t;return Gi(this,void 0,void 0,function*(){if(!(wy(e)&&e.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let n=yPe(e,["d"]);return(t=n.kid)!==null&&t!==void 0||(n.kid=yield Fr({jwk:n})),n})}static privateKeyToBytes({privateKey:e}){return Gi(this,void 0,void 0,function*(){if(!wy(e))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return ge.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return Gi(this,void 0,void 0,function*(){if(!(y6(e)&&e.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const t=new Uint8Array([4]),n=ge.base64Url(e.x).toUint8Array(),i=ge.base64Url(e.y).toUint8Array();return new Uint8Array([...t,...n,...i])})}static sharedSecret({privateKeyA:e,publicKeyB:t}){return Gi(this,void 0,void 0,function*(){if("x"in e&&"x"in t&&e.x===t.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const n=yield In.privateKeyToBytes({privateKey:e}),i=yield In.publicKeyToBytes({publicKey:t});return ur.getSharedSecret(n,i,!0).slice(1)})}static sign({data:e,key:t}){return Gi(this,void 0,void 0,function*(){const n=yield In.privateKeyToBytes({privateKey:t}),i=Bu(e);return ur.sign(i,n).toCompactRawBytes()})}static validatePrivateKey({privateKeyBytes:e}){return Gi(this,void 0,void 0,function*(){return ur.utils.isValidPrivateKey(e)})}static validatePublicKey({publicKeyBytes:e}){return Gi(this,void 0,void 0,function*(){try{ur.ProjectivePoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:t,data:n}){return Gi(this,void 0,void 0,function*(){const i=yield In.publicKeyToBytes({publicKey:e}),o=Bu(n);return ur.verify(t,o,i,{lowS:!1})})}static getCurvePoint({keyBytes:e}){return Gi(this,void 0,void 0,function*(){e.byteLength===32&&(e=ur.getPublicKey(e));const t=ur.ProjectivePoint.fromHex(e),n=Mi(t.x,32),i=Mi(t.y,32);return{x:n,y:i}})}}var tb=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class pU extends p6{computePublicKey({key:e}){return tb(this,void 0,void 0,function*(){if(!wy(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const t=yield An.computePublicKey({key:e});return t.alg="ES256K",t}case"P-256":{const t=yield In.computePublicKey({key:e});return t.alg="ES256",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return tb(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const t=yield An.generateKey();return t.alg="ES256K",t}case"ES256":case"secp256r1":{const t=yield In.generateKey();return t.alg="ES256",t}}})}getPublicKey({key:e}){return tb(this,void 0,void 0,function*(){if(!wy(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const t=yield An.getPublicKey({key:e});return t.alg="ES256K",t}case"P-256":{const t=yield In.getPublicKey({key:e});return t.alg="ES256",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}sign({key:e,data:t}){return tb(this,void 0,void 0,function*(){if(!wy(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield An.sign({key:e,data:t});case"P-256":return yield In.sign({key:e,data:t});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:t,data:n}){return tb(this,void 0,void 0,function*(){if(!y6(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield An.verify({key:e,signature:t,data:n});case"P-256":return yield In.verify({key:e,signature:t,data:n});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}}var Ba=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},mPe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class On{static bytesToPrivateKey({privateKeyBytes:e}){return Ba(this,void 0,void 0,function*(){const t=Cn.getPublicKey(e),n={crv:"Ed25519",d:ge.uint8Array(e).toBase64Url(),kty:"OKP",x:ge.uint8Array(t).toBase64Url()};return n.kid=yield Fr({jwk:n}),n})}static bytesToPublicKey({publicKeyBytes:e}){return Ba(this,void 0,void 0,function*(){const t={kty:"OKP",crv:"Ed25519",x:ge.uint8Array(e).toBase64Url()};return t.kid=yield Fr({jwk:t}),t})}static computePublicKey({key:e}){return Ba(this,void 0,void 0,function*(){const t=yield On.privateKeyToBytes({privateKey:e}),n=Cn.getPublicKey(t),i={kty:"OKP",crv:"Ed25519",x:ge.uint8Array(n).toBase64Url()};return i.kid=yield Fr({jwk:i}),i})}static convertPrivateKeyToX25519({privateKey:e}){return Ba(this,void 0,void 0,function*(){const t=yield On.privateKeyToBytes({privateKey:e}),n=ND(t),i=vs.getPublicKey(n),o={kty:"OKP",crv:"X25519",d:ge.uint8Array(n).toBase64Url(),x:ge.uint8Array(i).toBase64Url()};return o.kid=yield Fr({jwk:o}),o})}static convertPublicKeyToX25519({publicKey:e}){return Ba(this,void 0,void 0,function*(){const t=yield On.publicKeyToBytes({publicKey:e});if(!(yield On.validatePublicKey({publicKeyBytes:t})))throw new Error("Ed25519: Invalid public key.");const i=jD(t),o={kty:"OKP",crv:"X25519",x:ge.uint8Array(i).toBase64Url()};return o.kid=yield Fr({jwk:o}),o})}static generateKey(){return Ba(this,void 0,void 0,function*(){const e=Cn.utils.randomPrivateKey(),t=yield On.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Fr({jwk:t}),t})}static getPublicKey({key:e}){var t;return Ba(this,void 0,void 0,function*(){if(!(_y(e)&&e.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let n=mPe(e,["d"]);return(t=n.kid)!==null&&t!==void 0||(n.kid=yield Fr({jwk:n})),n})}static privateKeyToBytes({privateKey:e}){return Ba(this,void 0,void 0,function*(){if(!_y(e))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return ge.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return Ba(this,void 0,void 0,function*(){if(!m6(e))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return ge.base64Url(e.x).toUint8Array()})}static sign({key:e,data:t}){return Ba(this,void 0,void 0,function*(){const n=yield On.privateKeyToBytes({privateKey:e});return Cn.sign(t,n)})}static validatePublicKey({publicKeyBytes:e}){return Ba(this,void 0,void 0,function*(){try{Cn.ExtendedPoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:t,data:n}){return Ba(this,void 0,void 0,function*(){const i=yield On.publicKeyToBytes({publicKey:e});return Cn.verify(t,n,i)})}}var rb=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class gPe extends p6{computePublicKey({key:e}){return rb(this,void 0,void 0,function*(){if(!_y(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const t=yield On.computePublicKey({key:e});return t.alg="EdDSA",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return rb(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const t=yield On.generateKey();return t.alg="EdDSA",t}}})}getPublicKey({key:e}){return rb(this,void 0,void 0,function*(){if(!_y(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const t=yield On.getPublicKey({key:e});return t.alg="EdDSA",t}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}sign({key:e,data:t}){return rb(this,void 0,void 0,function*(){if(!_y(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield On.sign({key:e,data:t});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:t,data:n}){return rb(this,void 0,void 0,function*(){if(!m6(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield On.verify({key:e,signature:t,data:n});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}}var zd=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};const Hk={Ed25519:{implementation:gPe,names:["Ed25519"]},secp256k1:{implementation:pU,names:["ES256K","secp256k1"]},secp256r1:{implementation:pU,names:["ES256","secp256r1"]},"SHA-256":{implementation:dPe,names:["SHA-256"]}};class Ku{constructor(e){var t;this._algorithmInstances=new Map,this._keyStore=(t=e?.keyStore)!==null&&t!==void 0?t:new vW}digest({algorithm:e,data:t}){return zd(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:t})})}exportKey({keyUri:e}){return zd(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){return zd(this,void 0,void 0,function*(){const n=yield this.getAlgorithm({algorithm:e}).generateKey({algorithm:e});if(n?.kid===void 0)throw new Error("Generated key is missing a required property: kid");const i=`${hU}${n.kid}`;return yield this._keyStore.set(i,n),i})}getKeyUri({key:e}){return zd(this,void 0,void 0,function*(){const t=yield Fr({jwk:e});return`${hU}${t}`})}getPublicKey({keyUri:e}){return zd(this,void 0,void 0,function*(){const t=yield this.getPrivateKey({keyUri:e}),n=this.getAlgorithmName({key:t});return yield this.getAlgorithm({algorithm:n}).getPublicKey({key:t})})}importKey({key:e}){var t;return zd(this,void 0,void 0,function*(){if(!hPe(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const n=structuredClone(e);(t=n.kid)!==null&&t!==void 0||(n.kid=yield Fr({jwk:n}));const i=yield this.getKeyUri({key:n});return yield this._keyStore.set(i,n),i})}sign({keyUri:e,data:t}){return zd(this,void 0,void 0,function*(){const n=yield this.getPrivateKey({keyUri:e}),i=this.getAlgorithmName({key:n});return this.getAlgorithm({algorithm:i}).sign({data:t,key:n})})}verify({key:e,signature:t,data:n}){return zd(this,void 0,void 0,function*(){const i=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:i}).verify({key:e,signature:t,data:n})})}getAlgorithm({algorithm:e}){var t;const n=(t=Hk[e])===null||t===void 0?void 0:t.implementation;if(!n)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(n)||this._algorithmInstances.set(n,new n),this._algorithmInstances.get(n)}getAlgorithmName({key:e}){const t=e.alg,n=e.crv;for(const i in Hk){const o=Hk[i];if(t&&o.names.includes(t))return i;if(n&&o.names.includes(n))return i}throw new Error(`Unable to determine algorithm based on provided input: alg=${t}, crv=${n}`)}getPrivateKey({keyUri:e}){return zd(this,void 0,void 0,function*(){const t=yield this._keyStore.get(e);if(!t)throw new Error(`Key not found: ${e}`);return t})}}function vPe(r){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if(r.alg&&Object.values(e).includes(r.alg))return r.alg;if(r.crv&&Object.keys(e).includes(r.crv))return e[r.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${r.alg}, crv=${r.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const NH=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4));function UH(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}const bPe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!bPe)throw new Error("Non little-endian hardware is not supported");function g6(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function v5(r){if(typeof r=="string")r=g6(r);else if(UH(r))r=r.slice();else throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function wPe(r,e){if(!UH(r))throw new Error("Uint8Array expected");if(r.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function _Pe(r){return r!=null&&typeof r=="object"&&(r instanceof Uint8Array||r.constructor.name==="Uint8Array")}function EPe(r,...e){if(!_Pe(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function yU(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function APe(r,e){EPe(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Cf=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},xPe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class ty{static bytesToPrivateKey({privateKeyBytes:e}){return Cf(this,void 0,void 0,function*(){const t=vs.getPublicKey(e),n={kty:"OKP",crv:"X25519",d:ge.uint8Array(e).toBase64Url(),x:ge.uint8Array(t).toBase64Url()};return n.kid=yield Fr({jwk:n}),n})}static bytesToPublicKey({publicKeyBytes:e}){return Cf(this,void 0,void 0,function*(){const t={kty:"OKP",crv:"X25519",x:ge.uint8Array(e).toBase64Url()};return t.kid=yield Fr({jwk:t}),t})}static computePublicKey({key:e}){return Cf(this,void 0,void 0,function*(){const t=yield ty.privateKeyToBytes({privateKey:e}),n=vs.getPublicKey(t),i={kty:"OKP",crv:"X25519",x:ge.uint8Array(n).toBase64Url()};return i.kid=yield Fr({jwk:i}),i})}static generateKey(){return Cf(this,void 0,void 0,function*(){const e=vs.utils.randomPrivateKey(),t=yield ty.bytesToPrivateKey({privateKeyBytes:e});return t.kid=yield Fr({jwk:t}),t})}static getPublicKey({key:e}){var t;return Cf(this,void 0,void 0,function*(){if(!(_y(e)&&e.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let n=xPe(e,["d"]);return(t=n.kid)!==null&&t!==void 0||(n.kid=yield Fr({jwk:n})),n})}static privateKeyToBytes({privateKey:e}){return Cf(this,void 0,void 0,function*(){if(!_y(e))throw new Error("X25519: The provided key is not a valid OKP private key.");return ge.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return Cf(this,void 0,void 0,function*(){if(!m6(e))throw new Error("X25519: The provided key is not a valid OKP public key.");return ge.base64Url(e.x).toUint8Array()})}static sharedSecret({privateKeyA:e,publicKeyB:t}){return Cf(this,void 0,void 0,function*(){if("x"in e&&"x"in t&&e.x===t.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const n=yield ty.privateKeyToBytes({privateKey:e}),i=yield ty.publicKeyToBytes({publicKey:t});return vs.getSharedSecret(n,i)})}}const Yi=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class SPe{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=v5(e),wPe(e,32);const t=Yi(e,0),n=Yi(e,2),i=Yi(e,4),o=Yi(e,6),s=Yi(e,8),a=Yi(e,10),l=Yi(e,12),d=Yi(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|o<<9)&8191,this.r[4]=(o>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|l<<5)&8065,this.r[8]=(l>>>8|d<<8)&8191,this.r[9]=d>>>5&127;for(let c=0;c<8;c++)this.pad[c]=Yi(e,16+2*c)}process(e,t,n=!1){const i=n?0:2048,{h:o,r:s}=this,a=s[0],l=s[1],d=s[2],c=s[3],u=s[4],f=s[5],h=s[6],p=s[7],y=s[8],g=s[9],w=Yi(e,t+0),v=Yi(e,t+2),m=Yi(e,t+4),b=Yi(e,t+6),_=Yi(e,t+8),E=Yi(e,t+10),S=Yi(e,t+12),T=Yi(e,t+14);let O=o[0]+(w&8191),M=o[1]+((w>>>13|v<<3)&8191),Q=o[2]+((v>>>10|m<<6)&8191),W=o[3]+((m>>>7|b<<9)&8191),U=o[4]+((b>>>4|_<<12)&8191),ee=o[5]+(_>>>1&8191),R=o[6]+((_>>>14|E<<2)&8191),z=o[7]+((E>>>11|S<<5)&8191),K=o[8]+((S>>>8|T<<8)&8191),Y=o[9]+(T>>>5|i),I=0,D=I+O*a+M*(5*g)+Q*(5*y)+W*(5*p)+U*(5*h);I=D>>>13,D&=8191,D+=ee*(5*f)+R*(5*u)+z*(5*c)+K*(5*d)+Y*(5*l),I+=D>>>13,D&=8191;let N=I+O*l+M*a+Q*(5*g)+W*(5*y)+U*(5*p);I=N>>>13,N&=8191,N+=ee*(5*h)+R*(5*f)+z*(5*u)+K*(5*c)+Y*(5*d),I+=N>>>13,N&=8191;let V=I+O*d+M*l+Q*a+W*(5*g)+U*(5*y);I=V>>>13,V&=8191,V+=ee*(5*p)+R*(5*h)+z*(5*f)+K*(5*u)+Y*(5*c),I+=V>>>13,V&=8191;let J=I+O*c+M*d+Q*l+W*a+U*(5*g);I=J>>>13,J&=8191,J+=ee*(5*y)+R*(5*p)+z*(5*h)+K*(5*f)+Y*(5*u),I+=J>>>13,J&=8191;let j=I+O*u+M*c+Q*d+W*l+U*a;I=j>>>13,j&=8191,j+=ee*(5*g)+R*(5*y)+z*(5*p)+K*(5*h)+Y*(5*f),I+=j>>>13,j&=8191;let G=I+O*f+M*u+Q*c+W*d+U*l;I=G>>>13,G&=8191,G+=ee*a+R*(5*g)+z*(5*y)+K*(5*p)+Y*(5*h),I+=G>>>13,G&=8191;let C=I+O*h+M*f+Q*u+W*c+U*d;I=C>>>13,C&=8191,C+=ee*l+R*a+z*(5*g)+K*(5*y)+Y*(5*p),I+=C>>>13,C&=8191;let F=I+O*p+M*h+Q*f+W*u+U*c;I=F>>>13,F&=8191,F+=ee*d+R*l+z*a+K*(5*g)+Y*(5*y),I+=F>>>13,F&=8191;let Z=I+O*y+M*p+Q*h+W*f+U*u;I=Z>>>13,Z&=8191,Z+=ee*c+R*d+z*l+K*a+Y*(5*g),I+=Z>>>13,Z&=8191;let te=I+O*g+M*y+Q*p+W*h+U*f;I=te>>>13,te&=8191,te+=ee*u+R*c+z*d+K*l+Y*a,I+=te>>>13,te&=8191,I=(I<<2)+I|0,I=I+D|0,D=I&8191,I=I>>>13,N+=I,o[0]=D,o[1]=N,o[2]=V,o[3]=J,o[4]=j,o[5]=G,o[6]=C,o[7]=F,o[8]=Z,o[9]=te}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let o=(i^1)-1;for(let a=0;a<10;a++)n[a]&=o;o=~o;for(let a=0;a<10;a++)e[a]=e[a]&o|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535}update(e){yU(this);const{buffer:t,blockLen:n}=this;e=v5(e);const i=e.length;for(let o=0;o<i;){const s=Math.min(n-this.pos,i-o);if(s===n){for(;n<=i-o;o+=n)this.process(e,o);continue}t.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){yU(this),APe(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let s=0;s<8;s++)e[o++]=n[s]>>>0,e[o++]=n[s]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function TPe(r){const e=(n,i)=>r(i).update(v5(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}TPe(r=>new SPe(r));const $Pe=g6("expand 16-byte k"),kPe=g6("expand 32-byte k");NH($Pe);NH(kPe);function Fc(r){if(typeof r=="string"&&r.length!==0)return r.split("#").pop()}function LH({didDocument:r}){var e,t;if(!r)throw new TypeError("Required parameter missing: 'didDocument'");const n=[];return n.push(...(t=(e=r.verificationMethod)===null||e===void 0?void 0:e.filter(b5))!==null&&t!==void 0?t:[]),Object.keys(t_).forEach(i=>{var o,s;n.push(...(s=(o=r[i])===null||o===void 0?void 0:o.filter(b5))!==null&&s!==void 0?s:[])}),n}function PPe({didDocument:r}){const t=LH({didDocument:r}).map(n=>n.type);return[...new Set(t)]}function IPe({didDocument:r,methodId:e}){const t=[];return Object.keys(t_).forEach(n=>{if(Array.isArray(r[n])){const i=r[n],o=Fc(e);i.some(a=>{const l=Fc(a)===o,d=b5(a)&&Fc(a.id)===o;return l||d})&&t.push(n)}}),t}function b5(r){return!(!r||typeof r!="object"||r===null||!("id"in r&&"type"in r&&"controller"in r)||typeof r.id!="string"||typeof r.type!="string"||typeof r.controller!="string")}function KH({keyBytes:r,multicodecCode:e,multicodecName:t}){const n=zr.addPrefix({code:e,data:r,name:t}),i=ge.uint8Array(n).toBase58Btc();return ge.base58Btc(i).toMultibase()}function mU({multibaseKeyId:r}){try{const e=ge.multibase(r).toBase58Btc(),t=ge.base58Btc(e).toUint8Array(),{code:n,data:i,name:o}=zr.removePrefix({prefixedData:t});return{keyBytes:i,multicodecCode:n,multicodecName:o}}catch{throw new lt(at.InvalidDid,`Invalid multibase identifier: ${r}`)}}var nb=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class od{constructor({uri:e,document:t,metadata:n,keyManager:i}){this.uri=e,this.document=t,this.metadata=n,this.keyManager=i}export(){return nb(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const t=[];for(let n of this.document.verificationMethod){if(!n.publicKeyJwk)throw new Error(`Verification method '${n.id}' does not contain a public key in JWK format`);const i=yield this.keyManager.getKeyUri({key:n.publicKeyJwk}),o=yield this.keyManager.exportKey({keyUri:i});t.push(Object.assign({},o))}e.privateKeys=t}return e})}getSigner(e){return nb(this,void 0,void 0,function*(){var t;const n=(t=this.document.verificationMethod)===null||t===void 0?void 0:t.find(l=>{var d,c;return Fc(l.id)===((d=Fc(e?.methodId))!==null&&d!==void 0?d:Fc((c=this.document.assertionMethod)===null||c===void 0?void 0:c[0]))});if(!(n&&n.publicKeyJwk))throw new lt(at.InternalError,"A verification method intended for signing could not be determined from the DID Document");const i=yield this.keyManager.getKeyUri({key:n.publicKeyJwk}),o=yield this.keyManager.getPublicKey({keyUri:i}),s=this.keyManager;return{algorithm:vPe(o),keyId:n.id,sign(l){return nb(this,arguments,void 0,function*({data:d}){return yield s.sign({data:d,keyUri:i})})},verify(l){return nb(this,arguments,void 0,function*({data:d,signature:c}){return yield s.verify({data:d,key:o,signature:c})})}}})}static import(e){return nb(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ku}){var i;const o=LH({didDocument:t.document});if(o.length===0)throw new lt(at.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let a of(i=t.privateKeys)!==null&&i!==void 0?i:[])yield n.importKey({key:a});for(let a of o){if(!a.publicKeyJwk)throw new Error(`Verification method '${a.id}' does not contain a public key in JWK format`);const l=yield n.getKeyUri({key:a.publicKeyJwk});yield n.getPublicKey({keyUri:l})}return new od({uri:t.uri,document:t.document,metadata:t.metadata,keyManager:n})})}}var gU=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class d1{static getSigningMethod(e){return gU(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,t){return gU(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}}var Ti=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},vU=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};const bU="https://diddht.tbddev.org",OPe=0,Rf=7200,DE=";",rs=",";var w5;(function(r){r[r.Discoverable=0]="Discoverable",r[r.Organization=1]="Organization",r[r.Government=2]="Government",r[r.Corporation=3]="Corporation",r[r.LocalBusiness=4]="LocalBusiness",r[r.SoftwarePackage=5]="SoftwarePackage",r[r.WebApp=6]="WebApp",r[r.FinancialInstitution=7]="FinancialInstitution"})(w5||(w5={}));var us;(function(r){r[r.Ed25519=0]="Ed25519",r[r.secp256k1=1]="secp256k1",r[r.secp256r1=2]="secp256r1",r[r.X25519=3]="X25519"})(us||(us={}));var _5;(function(r){r.authentication="auth",r.assertionMethod="asm",r.capabilityDelegation="del",r.capabilityInvocation="inv",r.keyAgreement="agm"})(_5||(_5={}));const zH={Ed25519:us.Ed25519,ES256K:us.secp256k1,ES256:us.secp256r1,"P-256":us.secp256r1,secp256k1:us.secp256k1,secp256r1:us.secp256r1,X25519:us.X25519},wU={[us.Ed25519]:"Ed25519",[us.secp256k1]:"ES256K",[us.secp256r1]:"ES256",[us.X25519]:"ECDH-ES+A256KW"};class jh extends d1{static create(){return Ti(this,arguments,void 0,function*({keyManager:e=new Ku,options:t={}}={}){var n,i,o,s,a,l,d,c,u,f,h;if(!((n=t.verificationMethods)===null||n===void 0)&&n.some(_=>!(_.algorithm in zH)))throw new Error("One or more verification method algorithms are not supported");const p=(i=t.verificationMethods)===null||i===void 0?void 0:i.filter(_=>"id"in _).map(_=>_.id);if(p&&p.length!==new Set(p).size)throw new Error("One or more verification method IDs are not unique");if(!((o=t.services)===null||o===void 0)&&o.some(_=>!_.id||!_.type||!_.serviceEndpoint))throw new Error("One or more services are missing required properties");const y=yield e.generateKey({algorithm:"Ed25519"}),g=yield e.getPublicKey({keyUri:y}),w=yield Xn.identityKeyToIdentifier({identityKey:g}),v=Object.assign(Object.assign({id:w},t.alsoKnownAs&&{alsoKnownAs:t.alsoKnownAs}),t.controllers&&{controller:t.controllers}),m=[...(s=t.verificationMethods)!==null&&s!==void 0?s:[]];m?.some(_=>{var E;return((E=_.id)===null||E===void 0?void 0:E.split("#").pop())==="0"})||m.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const _ of m){const E=_.id&&_.id.split("#").pop()==="0"?y:yield e.generateKey({algorithm:_.algorithm}),S=yield e.getPublicKey({keyUri:E});let T=(l=(a=_.id)!==null&&a!==void 0?a:S.kid)!==null&&l!==void 0?l:yield Fr({jwk:S});T=`${w}#${Fc(T)}`,(d=v.verificationMethod)!==null&&d!==void 0||(v.verificationMethod=[]),v.verificationMethod.push({id:T,type:"JsonWebKey",controller:(c=_.controller)!==null&&c!==void 0?c:w,publicKeyJwk:S});for(const O of(u=_.purposes)!==null&&u!==void 0?u:[])v[O]||(v[O]=[]),v[O].push(T)}(f=t.services)===null||f===void 0||f.forEach(_=>{var E;(E=v.service)!==null&&E!==void 0||(v.service=[]),_.id=`${w}#${_.id.split("#").pop()}`,v.service.push(_)});const b=new od({uri:w,document:v,metadata:Object.assign({published:!1},t.types&&{types:t.types}),keyManager:e});if(!((h=t.publish)!==null&&h!==void 0)||h){const _=yield jh.publish({did:b,gatewayUri:t.gatewayUri});b.metadata=_.didDocumentMetadata}return b})}static import(e){return Ti(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ku}){var i;const o=vr.parse(t.uri);if(o?.method!==jh.methodName)throw new lt(at.MethodNotSupported,"Method not supported");const s=yield od.import({portableDid:t,keyManager:n});if(!(!((i=s.document.verificationMethod)===null||i===void 0)&&i.some(a=>{var l;return((l=a.id)===null||l===void 0?void 0:l.split("#").pop())==="0"})))throw new lt(at.InvalidDidDocument,"DID document must contain an Identity Key");return s})}static getSigningMethod(e){return Ti(this,arguments,void 0,function*({didDocument:t,methodId:n="#0"}){var i;const o=vr.parse(t.id);if(o&&o.method!==this.methodName)throw new lt(at.MethodNotSupported,`Method not supported: ${o.method}`);const s=(i=t.verificationMethod)===null||i===void 0?void 0:i.find(a=>{var l,d;return Fc(a.id)===((l=Fc(n))!==null&&l!==void 0?l:Fc((d=t.assertionMethod)===null||d===void 0?void 0:d[0]))});if(!(s&&s.publicKeyJwk))throw new lt(at.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static publish(e){return Ti(this,arguments,void 0,function*({did:t,gatewayUri:n=bU}){return yield iu.put({did:t,gatewayUri:n})})}static resolve(e){return Ti(this,arguments,void 0,function*(t,n={}){var i;const o=(i=n?.gatewayUri)!==null&&i!==void 0?i:bU;try{yield Xn.identifierToIdentityKey({didUri:t});const{didDocument:s,didDocumentMetadata:a}=yield iu.get({didUri:t,gatewayUri:o});return Object.assign(Object.assign({},vo),{didDocument:s,didDocumentMetadata:a})}catch(s){if(!(s instanceof lt))throw new Error(s);return Object.assign(Object.assign({},vo),{didResolutionMetadata:Object.assign({error:s.code},s.message&&{errorMessage:s.message})})}})}}jh.methodName="dht";class iu{static get(e){return Ti(this,arguments,void 0,function*({didUri:t,gatewayUri:n}){const i=Xn.identifierToIdentityKeyBytes({didUri:t}),o=yield iu.pkarrGet({gatewayUri:n,publicKeyBytes:i}),s=yield Xn.parseBep44GetMessage({bep44Message:o}),a=yield iu.fromDnsPacket({didUri:t,dnsPacket:s});return a.didDocumentMetadata.versionId=o.seq.toString(),a})}static put(e){return Ti(this,arguments,void 0,function*({did:t,gatewayUri:n}){const i=yield iu.toDnsPacket({didDocument:t.document,didMetadata:t.metadata,authoritativeGatewayUris:[n]}),o=yield Xn.createBep44PutMessage({dnsPacket:i,publicKeyBytes:Xn.identifierToIdentityKeyBytes({didUri:t.uri}),signer:yield t.getSigner({methodId:"0"})}),s=yield iu.pkarrPut({gatewayUri:n,bep44Message:o});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:s,versionId:o.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return Ti(this,arguments,void 0,function*({gatewayUri:t,publicKeyBytes:n}){const i=ge.uint8Array(n).toBase32Z(),o=new URL(i,t).href;let s;try{if(s=yield fetch(o,{method:"GET"}),!s.ok)throw new lt(at.NotFound,`Pkarr record not found for: ${i}`)}catch(d){throw d instanceof lt?d:new lt(at.InternalError,`Failed to fetch Pkarr record: ${d.message}`)}const a=yield s.arrayBuffer();if(!a)throw new lt(at.NotFound,`Pkarr record not found for: ${i}`);if(a.byteLength<72)throw new lt(at.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${a.byteLength}`);if(a.byteLength>1072)throw new lt(at.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${a.byteLength}`);return{k:n,seq:Number(new DataView(a).getBigUint64(64)),sig:new Uint8Array(a,0,64),v:new Uint8Array(a,72)}})}static pkarrPut(e){return Ti(this,arguments,void 0,function*({gatewayUri:t,bep44Message:n}){const i=ge.uint8Array(n.k).toBase32Z(),o=new URL(i,t).href,s=new Uint8Array(n.v.length+72);s.set(n.sig,0),new DataView(s.buffer).setBigUint64(n.sig.length,BigInt(n.seq)),s.set(n.v,n.sig.length+8);let a;try{a=yield fetch(o,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:s})}catch(l){throw new lt(at.InternalError,`Failed to put Pkarr record for identifier ${i}: ${l.message}`)}return a.ok})}static fromDnsPacket(e){return Ti(this,arguments,void 0,function*({didUri:t,dnsPacket:n}){var i,o,s;const a={id:t},l={published:!0},d=new Map;for(const c of(i=n?.answers)!==null&&i!==void 0?i:[]){if(c.type!=="TXT")continue;const u=c.name.split(".")[0].substring(1);switch(!0){case u.startsWith("aka"):{const f=Xn.parseTxtDataToString(c.data);a.alsoKnownAs=f.split(rs);break}case u.startsWith("cnt"):{const f=Xn.parseTxtDataToString(c.data);a.controller=f.includes(rs)?f.split(rs):f;break}case u.startsWith("k"):{const{id:f,t:h,k:p,c:y,a:g}=Xn.parseTxtDataToObject(c.data),w=ge.base64Url(p).toUint8Array(),v=us[Number(h)];let m=yield Xn.keyConverter(v).bytesToPublicKey({publicKeyBytes:w});m.alg=g||wU[Number(h)];const b=u==="k0"?"0":f!==void 0?f:yield Fr({jwk:m});(o=a.verificationMethod)!==null&&o!==void 0||(a.verificationMethod=[]);const _=`${t}#${b}`;a.verificationMethod.push({id:_,type:"JsonWebKey",controller:y??t,publicKeyJwk:m}),d.set(u,_);break}case u.startsWith("s"):{const f=Xn.parseTxtDataToObject(c.data),{id:h,t:p,se:y}=f,g=vU(f,["id","t","se"]),w=y.includes(rs)?y.split(rs):[y],v=Object.fromEntries(Object.entries(g).map(([m,b])=>[m,b.includes(rs)?b.split(rs):b]));(s=a.service)!==null&&s!==void 0||(a.service=[]),a.service.push(Object.assign(Object.assign({},v),{id:`${t}#${h}`,type:p,serviceEndpoint:w}));break}case u.startsWith("typ"):{const{id:f}=Xn.parseTxtDataToObject(c.data);l.types=f.split(rs).map(h=>Number(h));break}case u.startsWith("did"):{const f=v=>v.split(rs).map(m=>d.get(m)).filter(m=>typeof m=="string"),{auth:h,asm:p,del:y,inv:g,agm:w}=Xn.parseTxtDataToObject(c.data);h&&(a.authentication=f(h)),p&&(a.assertionMethod=f(p)),y&&(a.capabilityDelegation=f(y)),g&&(a.capabilityInvocation=f(g)),w&&(a.keyAgreement=f(w));break}}}return{didDocument:a,didDocumentMetadata:l,didResolutionMetadata:{}}})}static toDnsPacket(e){return Ti(this,arguments,void 0,function*({didDocument:t,didMetadata:n,authoritativeGatewayUris:i,previousDidProof:o}){var s,a,l,d,c;const u=[],f=[],h=new Map,p=[],y=[];if(o!==void 0){const{signature:v,previousDid:m}=o;yield Xn.validatePreviousDidProof({newDid:t.id,previousDidProof:o}),u.push({type:"TXT",name:"_prv._did.",ttl:Rf,data:`id=${m};s=${v}`})}if(t.alsoKnownAs&&u.push({type:"TXT",name:"_aka._did.",ttl:Rf,data:t.alsoKnownAs.join(rs)}),t.controller){const v=Array.isArray(t.controller)?t.controller.join(rs):t.controller;u.push({type:"TXT",name:"_cnt._did.",ttl:Rf,data:v})}for(const[v,m]of(a=(s=t.verificationMethod)===null||s===void 0?void 0:s.entries())!==null&&a!==void 0?a:[]){const b=`k${v}`;y.push(b);let _=m.id.split("#").pop();h.set(_,b);const E=m.publicKeyJwk;if(!(E?.crv&&E.crv in zH))throw new lt(at.InvalidPublicKeyType,`Verification method '${m.id}' contains an unsupported key type: ${(l=E?.crv)!==null&&l!==void 0?l:"undefined"}`);const S=us[E.crv],T=yield Xn.keyConverter(E.crv).publicKeyToBytes({publicKey:E}),O=ge.uint8Array(T).toBase64Url(),M=[`t=${S}`,`k=${O}`];_!=="0"&&(yield Fr({jwk:E}))!==_&&M.unshift(`id=${_}`),E.alg!==wU[S]&&M.push(`a=${E.alg}`),m.controller!==t.id&&M.push(`c=${m.controller}`),u.push({type:"TXT",name:`_${b}._did.`,ttl:Rf,data:M.join(DE)})}(d=t.service)===null||d===void 0||d.forEach((v,m)=>{const b=`s${m}`;p.push(b);let{id:_,type:E,serviceEndpoint:S}=v,T=vU(v,["id","type","serviceEndpoint"]);_=Fc(_),S=Array.isArray(S)?S.join(","):S;const M=Object.entries(Object.assign({id:_,t:E,se:S},T)).map(([W,U])=>`${W}=${U}`).join(DE),Q=Xn.chunkDataIfNeeded(M);u.push({type:"TXT",name:`_${b}._did.`,ttl:Rf,data:Q})});const g=[`v=${OPe}`];if(y.length&&g.push(`vm=${y.join(rs)}`),Object.keys(t_).forEach(v=>{var m;const b=(m=t[v])===null||m===void 0?void 0:m.map(_=>h.get(_.split("#").pop()));if(b){const _=_5[v];g.push(`${_}=${b.join(rs)}`)}}),p.length&&g.push(`svc=${p.join(rs)}`),!((c=n.types)===null||c===void 0)&&c.length){const m=n.types.map(b=>typeof b=="string"?w5[b]:b);u.push({type:"TXT",name:"_typ._did.",ttl:Rf,data:`id=${m.join(rs)}`})}u.push({type:"TXT",name:"_did."+iu.getUniqueDidSuffix(t.id)+".",ttl:Rf,data:g.join(DE)});for(const v of i||[])f.push({type:"NS",name:"_did."+iu.getUniqueDidSuffix(t.id)+".",ttl:Rf,data:v+"."});return{id:0,type:"response",flags:qD,answers:[...u,...f]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}}class Xn{static createBep44PutMessage(e){return Ti(this,arguments,void 0,function*({dnsPacket:t,publicKeyBytes:n,signer:i}){const o=Math.ceil(Date.now()/1e3),s=Zw(t),a=av.encode({seq:o,v:s}).subarray(1,-1);if(a.length>1e3)throw new lt(at.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${a.length} bytes`);const l=yield i.sign({data:a});return{k:n,seq:o,sig:l,v:s}})}static identifierToIdentityKey(e){return Ti(this,arguments,void 0,function*({didUri:t}){let n=Xn.identifierToIdentityKeyBytes({didUri:t});return yield On.bytesToPublicKey({publicKeyBytes:n})})}static identifierToIdentityKeyBytes({didUri:e}){const t=vr.parse(e);if(!t)throw new lt(at.InvalidDid,`Invalid DID URI: ${e}`);if(t.method!==jh.methodName)throw new lt(at.MethodNotSupported,`Method not supported: ${t.method}`);let n;try{n=ge.base32Z(t.id).toUint8Array()}catch{throw new lt(at.InvalidPublicKey,"Failed to decode method-specific identifier")}if(n.length!==32)throw new lt(at.InvalidPublicKeyLength,`Invalid public key length: ${n.length}`);return n}static identityKeyToIdentifier(e){return Ti(this,arguments,void 0,function*({identityKey:t}){const n=yield On.publicKeyToBytes({publicKey:t}),i=ge.uint8Array(n).toBase32Z();return`did:${jh.methodName}:${i}`})}static keyConverter(e){const n={Ed25519:On,"P-256":{publicKeyToBytes:i=>Ti(this,[i],void 0,function*({publicKey:o}){const s=yield In.publicKeyToBytes({publicKey:o});return yield In.compressPublicKey({publicKeyBytes:s})}),bytesToPublicKey:In.bytesToPublicKey,privateKeyToBytes:In.privateKeyToBytes,bytesToPrivateKey:In.bytesToPrivateKey},secp256k1:{publicKeyToBytes:i=>Ti(this,[i],void 0,function*({publicKey:o}){const s=yield An.publicKeyToBytes({publicKey:o});return yield An.compressPublicKey({publicKeyBytes:s})}),bytesToPublicKey:An.bytesToPublicKey,privateKeyToBytes:An.privateKeyToBytes,bytesToPrivateKey:An.bytesToPrivateKey},X25519:ty}[e];if(!n)throw new lt(at.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static parseBep44GetMessage(e){return Ti(this,arguments,void 0,function*({bep44Message:t}){const n=yield On.bytesToPublicKey({publicKeyBytes:t.k}),i=av.encode({seq:t.seq,v:t.v}).subarray(1,-1);if(!(yield On.verify({key:n,signature:t.sig,data:i})))throw new lt(at.InvalidSignature,"Invalid signature for DHT BEP44 message");return VD(t.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(DE).reduce((t,n)=>{const[i,o]=n.split("=");return t[i]=o,t},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return ge.uint8Array(e).toString();if(Array.isArray(e))return e.map(t=>this.parseTxtDataToString(t)).join("");throw new lt(at.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return Ti(this,arguments,void 0,function*({newDid:t,previousDidProof:n}){const i=yield Xn.identifierToIdentityKey({didUri:n.previousDid}),o=Xn.identifierToIdentityKeyBytes({didUri:t}),s=ge.base64Url(n.signature).toUint8Array();if(!(yield On.verify({key:i,data:o,signature:s})))throw new lt(at.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const t=[];for(let n=0;n<e.length;n+=255)t.push(e.slice(n,n+255));return t}}var ih=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Cl;(function(r){r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.secp256r1="secp256r1",r.X25519="X25519"})(Cl||(Cl={}));const CPe={Ed25519:Cl.Ed25519,ES256K:Cl.secp256k1,ES256:Cl.secp256r1,"P-256":Cl.secp256r1,secp256k1:Cl.secp256k1,secp256r1:Cl.secp256r1},_U="https://ion.tbd.engineering";class tg extends d1{static create(){return ih(this,arguments,void 0,function*({keyManager:e=new Ku,options:t={}}={}){var n,i,o,s,a,l,d;if(!((n=t.verificationMethods)===null||n===void 0)&&n.some(_=>!(_.algorithm in CPe)))throw new Error("One or more verification method algorithms are not supported");const c=(i=t.verificationMethods)===null||i===void 0?void 0:i.filter(_=>"id"in _).map(_=>_.id);if(c&&c.length!==new Set(c).size)throw new Error("One or more verification method IDs are not unique");if(!((o=t.services)===null||o===void 0)&&o.some(_=>!_.id||!_.type||!_.serviceEndpoint))throw new Error("One or more services are missing required properties");const u={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},f=[];for(const _ of(s=t.verificationMethods)!==null&&s!==void 0?s:[u]){const E=yield e.generateKey({algorithm:_.algorithm}),S=yield e.getPublicKey({keyUri:E});f.push({id:_.id,publicKeyJwk:S,purposes:(a=_.purposes)!==null&&a!==void 0?a:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const h=yield e.generateKey({algorithm:Cl.secp256k1}),p=yield e.getPublicKey({keyUri:h}),y=yield e.generateKey({algorithm:Cl.secp256k1}),g=yield e.getPublicKey({keyUri:y}),w=yield tc.computeLongFormDidUri({recoveryKey:p,updateKey:g,services:(l=t.services)!==null&&l!==void 0?l:[],verificationMethods:f}),{didDocument:v,didResolutionMetadata:m}=yield tg.resolve(w,{gatewayUri:t.gatewayUri});if(v===null)throw new Error(`Unable to resolve DID during creation: ${m?.error}`);const b=new od({uri:w,document:v,metadata:{published:!1,canonicalId:w.split(":",3).join(":"),recoveryKey:p,updateKey:g},keyManager:e});if(!((d=t.publish)!==null&&d!==void 0)||d){const _=yield tg.publish({did:b,gatewayUri:t.gatewayUri});b.metadata=_.didDocumentMetadata}return b})}static getSigningMethod(e){return ih(this,arguments,void 0,function*({didDocument:t,methodId:n}){var i;const o=vr.parse(t.id);if(o&&o.method!==this.methodName)throw new lt(at.MethodNotSupported,`Method not supported: ${o.method}`);const s=(i=t.verificationMethod)===null||i===void 0?void 0:i.find(a=>{var l;return a.id===(n??((l=t.assertionMethod)===null||l===void 0?void 0:l[0]))});if(!(s&&s.publicKeyJwk))throw new lt(at.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static import(e){return ih(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ku}){const i=vr.parse(t.uri);if(i?.method!==tg.methodName)throw new lt(at.MethodNotSupported,"Method not supported");return yield od.import({portableDid:t,keyManager:n})})}static publish(e){return ih(this,arguments,void 0,function*({did:t,gatewayUri:n=_U}){var i,o,s;const a=(o=(i=t.document.verificationMethod)===null||i===void 0?void 0:i.map(c=>({id:c.id,publicKeyJwk:c.publicKeyJwk,purposes:IPe({didDocument:t.document,methodId:c.id})})))!==null&&o!==void 0?o:[],l=yield tc.createIonDocument({services:(s=t.document.service)!==null&&s!==void 0?s:[],verificationMethods:a}),d=yield tc.constructCreateRequest({ionDocument:l,recoveryKey:t.metadata.recoveryKey,updateKey:t.metadata.updateKey});try{const c=tc.appendPathToUrl({baseUrl:n,path:"/operations"}),u=yield fetch(c,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:u.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:at.InternalError,errorMessage:`Failed to publish DID document for: ${t.uri}`}}}})}static resolve(e){return ih(this,arguments,void 0,function*(t,n={}){var i,o;const s=vr.parse(t);if(!s)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"invalidDid"}});if(s.method!==tg.methodName)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"methodNotSupported"}});const a=(i=n?.gatewayUri)!==null&&i!==void 0?i:_U;try{const l=tc.appendPathToUrl({baseUrl:a,path:`/identifiers/${t}`}),d=yield fetch(l);if(!d.ok)throw new lt(at.NotFound,`Unable to find DID document for: ${t}`);const{didDocument:c,didDocumentMetadata:u}=yield d.json();return Object.assign(Object.assign(Object.assign({},vo),c&&{didDocument:c}),{didDocumentMetadata:Object.assign({published:(o=u?.method)===null||o===void 0?void 0:o.published},u)})}catch(l){if(!(l instanceof lt))throw new Error(l);return Object.assign(Object.assign({},vo),{didResolutionMetadata:Object.assign({error:l.code},l.message&&{errorMessage:l.message})})}})}}tg.methodName="ion";class tc{static appendPathToUrl({baseUrl:e,path:t}){const n=new URL(e);return n.pathname=n.pathname.endsWith("/")?n.pathname:n.pathname+"/",n.pathname+=t.startsWith("/")?t.substring(1):t,n.toString()}static computeLongFormDidUri(e){return ih(this,arguments,void 0,function*({recoveryKey:t,updateKey:n,services:i,verificationMethods:o}){const s=yield tc.createIonDocument({services:i,verificationMethods:o}),a=tc.normalizeJwk(t),l=tc.normalizeJwk(n);return yield a1.createLongFormDid({document:s,recoveryKey:a,updateKey:l})})}static constructCreateRequest(e){return ih(this,arguments,void 0,function*({ionDocument:t,recoveryKey:n,updateKey:i}){return yield Uo.createCreateRequest({document:t,recoveryKey:tc.normalizeJwk(n),updateKey:tc.normalizeJwk(i)})})}static createIonDocument(e){return ih(this,arguments,void 0,function*({services:t,verificationMethods:n}){var i,o;const s=[];for(const d of n){let c=(o=(i=d.id)!==null&&i!==void 0?i:d.publicKeyJwk.kid)!==null&&o!==void 0?o:yield Fr({jwk:d.publicKeyJwk});c=`${c.split("#").pop()}`;const u={id:c,publicKeyJwk:tc.normalizeJwk(d.publicKeyJwk),purposes:d.purposes,type:"JsonWebKey2020"};s.push(u)}const a=t.map(d=>Object.assign(Object.assign({},d),{id:`${d.id.split("#").pop()}`}));return{publicKeys:s,services:a}})}static normalizeJwk(e){const t=e.kty;let n;if(t==="EC")n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(t==="oct")n={k:e.k,kty:e.kty};else if(t==="OKP")n={crv:e.crv,kty:e.kty,x:e.x};else if(t==="RSA")n={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${t}`);return n}}var N2=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class ry extends d1{static create(){return N2(this,arguments,void 0,function*({keyManager:e=new Ku,options:t={}}={}){var n,i,o,s;if(t.algorithm&&t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(t.verificationMethods&&t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const a=(s=(n=t.algorithm)!==null&&n!==void 0?n:(o=(i=t.verificationMethods)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.algorithm)!==null&&s!==void 0?s:"Ed25519",l=yield e.generateKey({algorithm:a}),d=yield e.getPublicKey({keyUri:l}),c=ge.object(d).toBase64Url(),u=`did:${ry.methodName}:${c}`,h=(yield ry.resolve(u)).didDocument;return new od({uri:u,document:h,metadata:{},keyManager:e})})}static getSigningMethod(e){return N2(this,arguments,void 0,function*({didDocument:t}){var n;const i=vr.parse(t.id);if(i&&i.method!==this.methodName)throw new lt(at.MethodNotSupported,`Method not supported: ${i.method}`);const[o]=(n=t.verificationMethod)!==null&&n!==void 0?n:[];if(!(o&&o.publicKeyJwk))throw new lt(at.InternalError,"A verification method intended for signing could not be determined from the DID Document");return o})}static import(e){return N2(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ku}){const i=vr.parse(t.uri);if(i?.method!==ry.methodName)throw new lt(at.MethodNotSupported,"Method not supported");const o=yield od.import({portableDid:t,keyManager:n});if(o.document.verificationMethod.length!==1)throw new lt(at.InvalidDidDocument,"DID document must contain exactly one verification method");return o})}static resolve(e,t){return N2(this,void 0,void 0,function*(){const n=vr.parse(e);let i;try{i=ge.base64Url(n.id).toObject()}catch{}if(!n||!i)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"invalidDid"}});if(n.method!==ry.methodName)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"methodNotSupported"}});const o={"@context":["https://www.w3.org/ns/did/v1"],id:n.uri},s=`${o.id}#0`;switch(o.verificationMethod=[{id:s,type:"JsonWebKey",controller:o.id,publicKeyJwk:i}],o.authentication=[s],o.assertionMethod=[s],o.capabilityInvocation=[s],o.capabilityDelegation=[s],o.keyAgreement=[s],i.use){case"sig":{delete o.keyAgreement;break}case"enc":{delete o.authentication,delete o.assertionMethod,delete o.capabilityInvocation,delete o.capabilityDelegation;break}}return Object.assign(Object.assign({},vo),{didDocument:o})})}}ry.methodName="jwk";var Rc=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},Zd;(function(r){r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.secp256r1="secp256r1",r.X25519="X25519"})(Zd||(Zd={}));const Gk={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},RPe={Ed25519:Zd.Ed25519,ES256K:Zd.secp256k1,ES256:Zd.secp256r1,"P-256":Zd.secp256r1,secp256k1:Zd.secp256k1,secp256r1:Zd.secp256r1,X25519:Zd.X25519};class Sl extends d1{static create(){return Rc(this,arguments,void 0,function*({keyManager:e=new Ku,options:t={}}={}){var n,i,o,s;if(t.algorithm&&t.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(t.verificationMethods&&t.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const a=(s=(n=t.algorithm)!==null&&n!==void 0?n:(o=(i=t.verificationMethods)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.algorithm)!==null&&s!==void 0?s:"Ed25519",l=yield e.generateKey({algorithm:a}),d=yield e.getPublicKey({keyUri:l}),c=yield Ei.publicKeyToMultibaseId({publicKey:d}),u=`did:${Sl.methodName}:${c}`,h=(yield Sl.resolve(u,t)).didDocument;return new od({uri:u,document:h,metadata:{},keyManager:e})})}static getSigningMethod(e){return Rc(this,arguments,void 0,function*({didDocument:t}){var n;const i=vr.parse(t.id);if(i&&i.method!==this.methodName)throw new lt(at.MethodNotSupported,`Method not supported: ${i.method}`);const[o]=t.assertionMethod||[],s=(n=t.verificationMethod)===null||n===void 0?void 0:n.find(a=>a.id===o);if(!(s&&s.publicKeyJwk))throw new lt(at.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static import(e){return Rc(this,arguments,void 0,function*({portableDid:t,keyManager:n=new Ku}){const i=vr.parse(t.uri);if(i?.method!==Sl.methodName)throw new lt(at.MethodNotSupported,"Method not supported");const o=yield od.import({portableDid:t,keyManager:n});if(o.document.verificationMethod.length!==1)throw new lt(at.InvalidDidDocument,"DID document must contain exactly one verification method");return o})}static resolve(e,t){return Rc(this,void 0,void 0,function*(){try{const n=yield Sl.createDocument({didUri:e,options:t});return Object.assign(Object.assign({},vo),{didDocument:n})}catch(n){if(!(n instanceof lt))throw new Error(n);return Object.assign(Object.assign({},vo),{didResolutionMetadata:Object.assign({error:n.code},n.message&&{errorMessage:n.message})})}})}static createDocument(e){return Rc(this,arguments,void 0,function*({didUri:t,options:n={}}){const{defaultContext:i="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:o=!1,enableExperimentalPublicKeyTypes:s=!1,publicKeyFormat:a="JsonWebKey2020"}=n,l={id:""},d=vr.parse(t);if(!d)throw new lt(at.InvalidDid,`Invalid DID URI: ${t}`);const c=d.id;if(d.method!==Sl.methodName)throw new lt(at.MethodNotSupported,`Method not supported: ${d.method}`);if(!Sl.validateIdentifier(d))throw new lt(at.InvalidDid,`Invalid DID URI: ${t}`);const u=yield Sl.createSignatureMethod({didUri:t,multibaseValue:c,options:{enableExperimentalPublicKeyTypes:s,publicKeyFormat:a}});if(l.id=d.uri,l.verificationMethod=[u],l.authentication=[u.id],l.assertionMethod=[u.id],l.capabilityInvocation=[u.id],l.capabilityDelegation=[u.id],o===!0){const p=a==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",y=yield this.createEncryptionMethod({didUri:t,multibaseValue:c,options:{enableExperimentalPublicKeyTypes:s,publicKeyFormat:p}});l.verificationMethod.push(y),l.keyAgreement=[y.id]}const f=[i];return PPe({didDocument:l}).forEach(p=>{const y=Gk[p];f.push(y)}),l["@context"]=f,l})}static createEncryptionMethod(e){return Rc(this,arguments,void 0,function*({didUri:t,multibaseValue:n,options:i}){const{enableExperimentalPublicKeyTypes:o,publicKeyFormat:s}=i,a={id:"",type:"",controller:""},{keyBytes:l,multicodecCode:d}=yield Sl.deriveEncryptionKey({multibaseValue:n}),c=l.byteLength,u=Ei.MULTICODEC_PUBLIC_KEY_LENGTH[d];if(c!==u)throw new lt(at.InvalidPublicKeyLength,`Expected ${c} bytes. Actual: ${u}`);const f=KH({keyBytes:l,multicodecCode:d});a.id=`${t}#${f}`;try{new URL(a.id)}catch{throw new lt(at.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(s in Gk))throw new lt(at.UnsupportedPublicKeyType,`Unsupported format: ${s}`);if(o===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(s))throw new lt(at.InvalidPublicKeyType,`Specified '${s}' without setting enableExperimentalPublicKeyTypes to true.`);if(a.type=s,a.controller=t,s==="X25519KeyAgreementKey2020"&&(a.publicKeyMultibase=f),s==="JsonWebKey2020"){const{crv:p}=yield Ei.multicodecToJwk({code:d});a.publicKeyJwk=yield Ei.keyConverter(p).bytesToPublicKey({publicKeyBytes:l})}return a})}static createSignatureMethod(e){return Rc(this,arguments,void 0,function*({didUri:t,multibaseValue:n,options:i}){const{enableExperimentalPublicKeyTypes:o,publicKeyFormat:s}=i,a={id:"",type:"",controller:""},{keyBytes:l,multicodecCode:d,multicodecName:c}=mU({multibaseKeyId:n}),u=l.byteLength,f=Ei.MULTICODEC_PUBLIC_KEY_LENGTH[d];if(u!==f)throw new lt(at.InvalidPublicKeyLength,`Expected ${u} bytes. Actual: ${f}`);let h=!1;switch(c){case"secp256k1-pub":h=yield An.validatePublicKey({publicKeyBytes:l});break;case"ed25519-pub":h=yield On.validatePublicKey({publicKeyBytes:l});break;case"x25519-pub":h=!0;break}if(!h)throw new lt(at.InvalidPublicKey,"Invalid public key detected.");a.id=`${t}#${n}`;try{new URL(a.id)}catch{throw new lt(at.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(s in Gk))throw new lt(at.UnsupportedPublicKeyType,`Unsupported format: ${s}`);if(o===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(s))throw new lt(at.InvalidPublicKeyType,`Specified '${s}' without setting enableExperimentalPublicKeyTypes to true.`);if(a.type=s,a.controller=t,s==="Ed25519VerificationKey2020"&&(a.publicKeyMultibase=n),s==="JsonWebKey2020"){const{crv:y}=yield Ei.multicodecToJwk({code:d});a.publicKeyJwk=yield Ei.keyConverter(y).bytesToPublicKey({publicKeyBytes:l})}return a})}static deriveEncryptionKey(e){return Rc(this,arguments,void 0,function*({multibaseValue:t}){let n={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:i,multicodecCode:o}=mU({multibaseKeyId:t});if(o===237){const s=yield Ei.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:i}),a=yield On.convertPublicKeyToX25519({publicKey:s});n={keyBytes:yield Ei.keyConverter("Ed25519").publicKeyToBytes({publicKey:a}),multicodecCode:236}}return n})}static validateIdentifier(e){const{method:t,id:n}=e,[i]=e.uri.split(":",1);return i==="did"&&t==="key"&&Number("1")>0&&sv(n)==="String"&&n.startsWith("z")}}Sl.methodName="key";class Ei{static jwkToMulticodec(e){return Rc(this,arguments,void 0,function*({jwk:t}){const n=[];t.crv&&(n.push(t.crv),t.d?n.push("private"):n.push("public"));const i=n.join(":"),o=Ei.JWK_TO_MULTICODEC[i];if(o===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${i}'`);return{code:zr.getCodeFromName({name:o}),name:o}})}static keyCompressor(e){const n={"P-256":In.compressPublicKey,secp256k1:An.compressPublicKey}[e];if(!n)throw new lt(at.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static keyConverter(e){const n={Ed25519:On,"P-256":In,secp256k1:An,X25519:ty}[e];if(!n)throw new lt(at.InvalidPublicKeyType,`Unsupported curve: ${e}`);return n}static multicodecToJwk(e){return Rc(this,arguments,void 0,function*({code:t,name:n}){if(!(n?!t:t))throw new Error("Either 'name' or 'code' must be defined, but not both.");n=n===void 0?zr.getNameFromCode({code:t}):n;const i=n,o=Ei.MULTICODEC_TO_JWK[i];if(o===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},o)})}static publicKeyToMultibaseId(e){return Rc(this,arguments,void 0,function*({publicKey:t}){var n;if(!(t?.crv&&t.crv in RPe))throw new lt(at.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(n=t?.crv)!==null&&n!==void 0?n:"undefined"}`);let i=yield Ei.keyConverter(t.crv).publicKeyToBytes({publicKey:t});/^(secp256k1|P-256|P-384|P-521)$/.test(t.crv)&&(i=yield Ei.keyCompressor(t.crv)({publicKeyBytes:i}));const{name:o}=yield Ei.jwkToMulticodec({jwk:t});return KH({keyBytes:i,multicodecName:o})})}}Ei.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};Ei.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};Ei.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var DPe=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class cT extends d1{static resolve(e,t){return DPe(this,void 0,void 0,function*(){const n=vr.parse(e);if(!n)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"invalidDid"}});if(n.method!==cT.methodName)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"methodNotSupported"}});let i=`https://${n.id.replace(/:/g,"/")}`;i=decodeURIComponent(i);const o=n.id.includes(":")?`${i}/did.json`:`${i}/.well-known/did.json`;try{const s=yield fetch(o);if(!s.ok)throw new Error("HTTP error status code returned");const a=yield s.json();return Object.assign(Object.assign({},vo),{didDocument:a})}catch{return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:"notFound"}})}})}}cT.methodName="web";const MPe={get:function(r){return null},set:function(r,e){return null},delete:function(r){return null},clear:function(){return null},close:function(){return null}};var EU=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class BPe{constructor({cache:e,didResolvers:t}){this.didResolvers=new Map,this.cache=e||MPe;for(const n of t)this.didResolvers.set(n.methodName,n)}resolve(e,t){return EU(this,void 0,void 0,function*(){const n=vr.parse(e);if(!n)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:at.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const i=this.didResolvers.get(n.method);if(!i)return Object.assign(Object.assign({},vo),{didResolutionMetadata:{error:at.MethodNotSupported,errorMessage:`Method not supported: ${n.method}`}});const o=yield this.cache.get(n.uri);if(o)return o;{const s=yield i.resolve(n.uri,t);return s.didResolutionMetadata.error||(yield this.cache.set(n.uri,s)),s}})}dereference(e,t){return EU(this,void 0,void 0,function*(){const n=vr.parse(e);if(!n)return{dereferencingMetadata:{error:at.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:i,didResolutionMetadata:o,didDocumentMetadata:s}=yield this.resolve(n.uri);if(!i)return{dereferencingMetadata:{error:o.error},contentStream:null,contentMetadata:{}};if(!n.fragment||n.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:i,contentMetadata:s};const{service:a=[],verificationMethod:l=[]}=i,d=new Set([e,n.fragment,`#${n.fragment}`]);let c;for(let u of l)if(d.has(u.id)){c=u;break}for(let u of a)if(d.has(u.id)){c=u;break}return c?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:c,contentMetadata:o}:{dereferencingMetadata:{error:at.NotFound},contentStream:null,contentMetadata:{}}})}}var pl=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})};class lT{constructor(e){this._agentDid=e.agentDid,this.crypto=e.cryptoApi,this.did=e.didApi,this.dwn=e.dwnApi,this.identity=e.identityApi,this.keyManager=e.keyManager,this.permissions=e.permissionsApi,this.rpc=e.rpcClient,this.sync=e.syncApi,this.vault=e.agentVault,this.did.agent=this,this.dwn.agent=this,this.identity.agent=this,this.keyManager.agent=this,this.permissions.agent=this,this.sync.agent=this}get agentDid(){if(this._agentDid===void 0)throw new Error('Web5UserAgent: The "agentDid" property is not set. Ensure the agent is properly initialized and a DID is assigned.');return this._agentDid}set agentDid(e){this._agentDid=e}static create({dataPath:e="DATA/AGENT",agentDid:t,agentVault:n,cryptoApi:i,didApi:o,dwnApi:s,identityApi:a,keyManager:l,permissionsApi:d,rpcClient:c,syncApi:u}={}){return pl(this,void 0,void 0,function*(){return n??(n=new _ke({keyDerivationWorkFactor:21e4,store:new QAe({location:`${e}/VAULT_STORE`})})),i??(i=new hv),o??(o=new XTe({didMethods:[jh,ry],resolverCache:new dH({location:`${e}/DID_RESOLVERCACHE`}),store:new ZTe})),s??(s=new VN({dwn:yield VN.createDwn({dataPath:e,didResolver:o})})),a??(a=new Ske({store:new Ake})),l??(l=new xp({keyStore:new gke})),d??(d=new Jc),c??(c=new Oke),u??(u=new Dke({syncEngine:new Lp({dataPath:e})})),new lT({agentDid:t,agentVault:n,cryptoApi:i,didApi:o,dwnApi:s,keyManager:l,permissionsApi:d,identityApi:a,rpcClient:c,syncApi:u})})}firstLaunch(){return pl(this,void 0,void 0,function*(){return(yield this.vault.isInitialized())===!1})}initialize({password:e,recoveryPhrase:t,dwnEndpoints:n}){return pl(this,void 0,void 0,function*(){return t=yield this.vault.initialize({password:e,recoveryPhrase:t,dwnEndpoints:n}),t})}processDidRequest(e){return pl(this,void 0,void 0,function*(){return this.did.processRequest(e)})}processDwnRequest(e){return pl(this,void 0,void 0,function*(){return this.dwn.processRequest(e)})}processVcRequest(e){return pl(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDidRequest(e){return pl(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDwnRequest(e){return pl(this,void 0,void 0,function*(){return this.dwn.sendRequest(e)})}sendVcRequest(e){return pl(this,void 0,void 0,function*(){throw new Error("Not implemented")})}start({password:e}){return pl(this,void 0,void 0,function*(){this.vault.isLocked()&&(yield this.vault.unlock({password:e})),this.agentDid=yield this.vault.getDid()})}}var Yk=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,e||[])).next())})},jPe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t};class lx{constructor({agent:e,connectedDid:t,delegateDid:n}){this.agent=e,this.did=new tPe({agent:e,connectedDid:t}),this.dwn=new oPe({agent:e,connectedDid:t,delegateDid:n}),this.vc=new aPe({agent:e,connectedDid:t})}static connect({agent:e,agentVault:t,connectedDid:n,password:i,recoveryPhrase:o,sync:s,techPreview:a,didCreateOptions:l,registration:d,walletConnectOptions:c}={}){var u,f,h;return Yk(this,void 0,void 0,function*(){let p;if(e===void 0){let g=!1;const w=yield lT.create({agentVault:t});e=w,i===void 0&&(i="insecure-static-phrase",console.warn("%cSECURITY WARNING:%c You have not set a password, which defaults to a static, guessable value. This significantly compromises the security of your data. Please configure a secure, unique password.","font-weight: bold; color: red;","font-weight: normal; color: inherit;"));const v=(f=(u=a?.dwnEndpoints)!==null&&u!==void 0?u:l?.dwnEndpoints)!==null&&f!==void 0?f:["https://dwn.tbddev.org/beta"];(yield w.firstLaunch())&&(o=yield w.initialize({password:i,recoveryPhrase:o,dwnEndpoints:v})),yield w.start({password:i});const m=yield w.identity.connectedIdentity();let b,_=[];if(m)b=m;else if(c){if(s==="off")throw new Error("Sync must not be disabled when using WalletConnect");g=!0;try{const{permissionRequests:E}=c,S=jPe(c,["permissionRequests"]),T=E.map(({protocolDefinition:W,permissions:U})=>aU.createPermissionRequestForProtocol({definition:W,permissions:U??["read","write","delete","query","subscribe"]})),{delegatePortableDid:O,connectedDid:M,delegateGrants:Q}=yield aU.initClient(Object.assign(Object.assign({},S),{permissionRequests:T}));b=yield w.identity.import({portableIdentity:{portableDid:O,metadata:{connectedDid:M,name:"Default",tenant:O.uri,uri:O.uri}}}),yield w.identity.manage({portableIdentity:yield b.export()}),_=yield this.processConnectedGrants({agent:e,delegateDid:O.uri,grants:Q})}catch(E){throw yield this.cleanUpIdentity({identity:b,userAgent:w}),new Error(`Failed to connect to wallet: ${E.message}`)}}else{const E=yield w.identity.list();E.length===0?(g=!0,b=yield w.identity.create({didMethod:"dht",metadata:{name:"Default"},didOptions:{services:[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:v,enc:"#enc",sig:"#sig"}],verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]},{algorithm:"secp256k1",id:"enc",purposes:["keyAgreement"]}]}}),yield w.identity.manage({portableIdentity:yield b.export()})):b=E[0]}if(n=(h=b.metadata.connectedDid)!==null&&h!==void 0?h:b.did.uri,p=b.metadata.connectedDid?b.did.uri:void 0,d!==void 0)try{for(const E of v)(yield w.rpc.getServerInfo(E)).registrationRequirements.length!==0&&(yield vh.registerTenant(E,e.agentDid.uri),yield vh.registerTenant(E,n));d.onSuccess()}catch(E){d.onFailure(E)}s!=="off"&&(g&&(yield w.sync.registerIdentity({did:n,options:{delegateDid:p,protocols:_}}),c!==void 0&&(yield w.sync.sync("pull"))),s??(s="2m"),w.sync.startSync({interval:s}).catch(E=>{console.error(`Sync failed: ${E}`)}))}return{web5:new lx({agent:e,connectedDid:n,delegateDid:p}),did:n,delegateDid:p,recoveryPhrase:o}})}static cleanUpIdentity({identity:e,userAgent:t}){return Yk(this,void 0,void 0,function*(){try{yield t.did.delete({didUri:e.did.uri,tenant:e.metadata.tenant,deleteKey:!0})}catch(n){console.error(`Failed to delete DID ${e.did.uri}: ${n.message}`)}try{yield t.identity.delete({didUri:e.did.uri})}catch(n){console.error(`Failed to delete Identity ${e.metadata.name}: ${n.message}`)}})}static processConnectedGrants({grants:e,agent:t,delegateDid:n}){return Yk(this,void 0,void 0,function*(){const i=new Set;for(const o of e){const s=yield gv.parse({connectedDid:n,agent:t,message:o}),{status:a}=yield s.store(!0);if(a.code!==202)throw new Error(`AgentDwnApi: Failed to process connected grant: ${a.detail}`);const l=s.scope.protocol;l&&i.add(l)}return[...i]})}}var Nh=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{d(n.next(c))}catch(u){s(u)}}function l(c){try{d(n.throw(c))}catch(u){s(u)}}function d(c){c.done?o(c.value):i(c.value).then(a,l)}d((n=n.apply(r,[])).next())})};const FH=new BPe({didResolvers:[jh,cT]}),E5=/^https?:\/\/dweb\/([^/]+)\/?(.*)?$/,qH=/^http:/,dx=/\/$/;function NPe(){try{return new Function("return import.meta")()}catch{return}}function VH(r){var e,t;return Nh(this,void 0,void 0,function*(){const{didDocument:n}=yield FH.resolve(r);let i=(t=(e=n?.service)===null||e===void 0?void 0:e.find(o=>o.type==="DecentralizedWebNode"))===null||t===void 0?void 0:t.serviceEndpoint;return(Array.isArray(i)?i:[i]).filter(o=>o.startsWith("http"))})}function UPe(r,e,t,n){return Nh(this,void 0,void 0,function*(){const i=r.request.url.replace(qH,"https:").replace(dx,""),o=yield caches.open("drl"),s=yield o.match(i);if(s){if(!navigator.onLine)return s;const a=yield n?.onCacheCheck(r,i);if(a){const l=s.headers.get("dwn-cache-time");if(l&&Date.now()<Number(l)+(Number(a.ttl)||0))return s}}try{if(t)return yield LPe(r,e,i,t,o,n);{const a=yield FH.resolve(e);return new Response(JSON.stringify(a),{status:200,headers:{"Content-Type":"application/json"}})}}catch(a){return a instanceof Response?a:(console.log(`Error in DID URL fetch: ${a}`),new Response("DID URL fetch error",{status:500}))}})}function LPe(r,e,t,n,i,o){return Nh(this,void 0,void 0,function*(){const s=yield VH(e);if(!s?.length)throw new Response("DWeb Node resolution failed: no valid endpoints found.",{status:530});for(const a of s)try{const l=`${a.replace(dx,"")}/${e}/${n}`,d=yield fetch(l,{headers:r.request.headers});return d.ok?((yield o?.onCacheCheck(r,t))&&KPe(t,l,d,i),d):(console.log(`DWN endpoint error: ${d.status}`),new Response("DWeb Node request failed",{status:d.status}))}catch(l){return console.log(`DWN endpoint error: ${l}`),new Response("DWeb Node request failed: "+l,{status:500})}})}function KPe(r,e,t,n){return Nh(this,void 0,void 0,function*(){const i=t.clone(),o=new Headers(i.headers);o.append("dwn-cache-time",Date.now().toString()),o.append("dwn-composed-url",e);const s=new Response(i.body,{headers:o});n.put(r,s)})}function zPe(r={}){var e,t,n;return Nh(this,void 0,void 0,function*(){const i=self;try{if(typeof ServiceWorkerGlobalScope<"u"&&i instanceof ServiceWorkerGlobalScope)i.skipWaiting(),i.addEventListener("activate",o=>{o.waitUntil(i.clients.claim())}),i.addEventListener("fetch",o=>{const s=o.request.url.match(E5);s&&o.respondWith(UPe(o,s[1],s[2],r))});else if(!((e=globalThis?.navigator)===null||e===void 0)&&e.serviceWorker){if(!(yield navigator.serviceWorker.getRegistration("/"))){const s=r.path||(globalThis.document?(t=document?.currentScript)===null||t===void 0?void 0:t.src:(n=NPe())===null||n===void 0?void 0:n.url);s&&navigator.serviceWorker.register(s,{type:"module"}).catch(a=>{console.error("DWeb networking feature installation failed: ",a)})}}else throw new Error("DWeb networking features are not available for install in this environment")}catch(o){console.error("Error in installing networking features:",o)}})}const WH=`
  .drl-loading-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    flex-wrap: wrap;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: #fff;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    z-index: 1000000;
  }

  .drl-loading-overlay > div {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .drl-loading-spinner {
    display: flex;
    align-items: center;
    justify-content: center;
  }

    .drl-loading-spinner div {
      position: relative;
      width: 2em;
      height: 2em;
      margin: 0.1em 0.25em 0 0;
    }
    .drl-loading-spinner div::after,
    .drl-loading-spinner div::before {
      content: '';  
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 0.1em solid #FFF;
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      animation: drl-loading-spinner 2s linear infinite;
    }
    .drl-loading-spinner div::after {
      animation-delay: 1s;
    }

  .drl-loading-overlay span {
    --text-opacity: 2;
    display: flex;
    align-items: center;
    margin: 2em auto 0;
    padding: 0.2em 0.75em 0.25em;
    text-align: center;
    border-radius: 5em;
    background: rgba(255 255 255 / 8%);
    opacity: 0.8;
    transition: opacity 0.3s ease;
    cursor: pointer;
  }

    .drl-loading-overlay span:focus {
      opacity: 1;
    }

    .drl-loading-overlay span:hover {
      opacity: 1;
    }

    .drl-loading-overlay span::before {
      content: " ";
      margin: 0 0.4em 0 0;
      color: red;
      font-size: 65%;
      font-weight: bold;
    }

    .drl-loading-overlay span::after {
      content: "stop";
      display: block;
      font-size: 60%;
      line-height: 0;
      color: rgba(255 255 255 / 60%);
    }

    .drl-loading-overlay.new-tab-overlay span::after {
      content: "close";
    }
  
  @keyframes drl-loading-spinner {
    0% {
      transform: scale(0);
      opacity: 1;
    }
    100% {
      transform: scale(1);
      opacity: 0;
    }
  }
`,FPe=`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading DRL...</title>
  <style>
    html, body {
      background-color: #151518;
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    ${WH}
  </style>
</head>
<body>
  <div class="drl-loading-overlay new-tab-overlay">
    <div class="drl-loading-spinner">
      <div></div>
      Loading DRL
    </div>
    <span onclick="window.close()" tabindex="0"></span>
  </div>
</body>
</html>
`;let AU=!1;function xU(){if(AU)return;const r=document.createElement("style");r.innerHTML=`
    ${WH}

    .drl-loading-overlay {
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    :root[drl-link-loading] .drl-loading-overlay {
      opacity: 1;
      pointer-events: all;
    }
  `,document.head.append(r);let e=document.createElement("div");e.classList.add("drl-loading-overlay"),e.innerHTML=`
    <div class="drl-loading-spinner">
      <div></div>
      Loading DRL
    </div> 
    <span tabindex="0"></span>
  `,e.lastElementChild.addEventListener("click",HH),document.body.prepend(e),AU=!0}function HH(){document.documentElement.removeAttribute("drl-link-loading"),ME=null}let ME,SU=!1;function qPe(){SU||(document.addEventListener("click",r=>Nh(this,void 0,void 0,function*(){let e=r.target.closest("a");if(e){let t=e.href;const n=t.match(E5);if(n){let i=n[1],o=n[2];const s=e.target==="_blank";r.preventDefault();try{let a;s?(a=window.open("","_blank"),a.document.write(FPe)):(ME=o,setTimeout(()=>document.documentElement.setAttribute("drl-link-loading",""),50));const l=yield VH(i);if(!l.length)throw null;let d=`${l[0].replace(dx,"")}/${i}/${o}`;s?a.closed||(a.location.href=d):ME===o&&(window.location.href=d)}catch{throw ME===o&&HH(),new Error(`DID endpoint resolution failed for the DRL: ${t}`)}}}})),document.addEventListener("pointercancel",U2),document.addEventListener("pointerdown",r=>Nh(this,void 0,void 0,function*(){var e;const t=r.composedPath()[0];if(r.pointerType==="mouse"&&r.button===2||r.pointerType==="touch"&&r.isPrimary){if(U2(),t&&(!((e=t?.src)===null||e===void 0)&&e.match(E5))){Kp=t,t.__src__=t.src;const n=t.src.replace(qH,"https:").replace(dx,""),s=(yield(yield caches.open("drl")).match(n)).headers.get("dwn-composed-url");s&&(t.src=s),t.addEventListener("pointerup",U2,{once:!0})}}else t===Kp&&U2()})),SU=!0)}let Kp;function U2(r){return Nh(this,void 0,void 0,function*(){r?.type==="pointerup"&&(yield new Promise(e=>requestAnimationFrame(e))),Kp&&(Kp.src=Kp.__src__,delete Kp.__src__,Kp=null)})}function VPe(r={}){r.serviceWorker!==!1&&zPe(r),typeof window<"u"&&typeof window.document<"u"&&(r.injectStyles!==!1&&(document.readyState!=="loading"?xU():document.addEventListener("DOMContentLoaded",xU,{once:!0})),r.links!==!1&&qPe())}function Zk(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):r.defaultWidth,n=r.formats[t]||r.formats[r.defaultWidth];return n}}function ib(r){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",i;if(n==="formatting"&&r.formattingValues){var o=r.defaultFormattingWidth||r.defaultWidth,s=t!=null&&t.width?String(t.width):o;i=r.formattingValues[s]||r.formattingValues[o]}else{var a=r.defaultWidth,l=t!=null&&t.width?String(t.width):r.defaultWidth;i=r.values[l]||r.values[a]}var d=r.argumentCallback?r.argumentCallback(e):e;return i[d]}}function ob(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,i=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],o=e.match(i);if(!o)return null;var s=o[0],a=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],l=Array.isArray(a)?HPe(a,function(u){return u.test(s)}):WPe(a,function(u){return u.test(s)}),d;d=r.valueCallback?r.valueCallback(l):l,d=t.valueCallback?t.valueCallback(d):d;var c=e.slice(s.length);return{value:d,rest:c}}}function WPe(r,e){for(var t in r)if(r.hasOwnProperty(t)&&e(r[t]))return t}function HPe(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return t}function GPe(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(r.matchPattern);if(!n)return null;var i=n[0],o=e.match(r.parsePattern);if(!o)return null;var s=r.valueCallback?r.valueCallback(o[0]):o[0];s=t.valueCallback?t.valueCallback(s):s;var a=e.slice(i.length);return{value:s,rest:a}}}function r_(r){"@babel/helpers - typeof";return r_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r_(r)}function Fo(r){if(r===null||r===!0||r===!1)return NaN;var e=Number(r);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function gr(r,e){if(e.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+e.length+" present")}function mr(r){gr(1,arguments);var e=Object.prototype.toString.call(r);return r instanceof Date||r_(r)==="object"&&e==="[object Date]"?new Date(r.getTime()):typeof r=="number"||e==="[object Number]"?new Date(r):((typeof r=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function YPe(r,e){gr(2,arguments);var t=mr(r),n=Fo(e);return isNaN(n)?new Date(NaN):(n&&t.setDate(t.getDate()+n),t)}function ZPe(r,e){gr(2,arguments);var t=mr(r),n=Fo(e);if(isNaN(n))return new Date(NaN);if(!n)return t;var i=t.getDate(),o=new Date(t.getTime());o.setMonth(t.getMonth()+n+1,0);var s=o.getDate();return i>=s?o:(t.setFullYear(o.getFullYear(),o.getMonth(),i),t)}function sb(r,e){if(gr(2,arguments),!e||r_(e)!=="object")return new Date(NaN);var t=e.years?Fo(e.years):0,n=e.months?Fo(e.months):0,i=e.weeks?Fo(e.weeks):0,o=e.days?Fo(e.days):0,s=e.hours?Fo(e.hours):0,a=e.minutes?Fo(e.minutes):0,l=e.seconds?Fo(e.seconds):0,d=mr(r),c=n||t?ZPe(d,n+t*12):d,u=o||i?YPe(c,o+i*7):c,f=a+s*60,h=l+f*60,p=h*1e3,y=new Date(u.getTime()+p);return y}function JPe(r,e){gr(2,arguments);var t=mr(r).getTime(),n=Fo(e);return new Date(t+n)}var XPe={};function u1(){return XPe}function A5(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return e.setUTCFullYear(r.getFullYear()),r.getTime()-e.getTime()}function TU(r){gr(1,arguments);var e=mr(r);return e.setHours(0,0,0,0),e}var QPe=864e5;function eIe(r,e){gr(2,arguments);var t=TU(r),n=TU(e),i=t.getTime()-A5(t),o=n.getTime()-A5(n);return Math.round((i-o)/QPe)}function xg(r,e){gr(2,arguments);var t=mr(r),n=mr(e),i=t.getTime()-n.getTime();return i<0?-1:i>0?1:i}var tIe=6e4,rIe=36e5;function nIe(r){return gr(1,arguments),r instanceof Date||r_(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function iIe(r){if(gr(1,arguments),!nIe(r)&&typeof r!="number")return!1;var e=mr(r);return!isNaN(Number(e))}function oIe(r,e){gr(2,arguments);var t=mr(r),n=mr(e),i=t.getFullYear()-n.getFullYear(),o=t.getMonth()-n.getMonth();return i*12+o}function sIe(r,e){gr(2,arguments);var t=mr(r),n=mr(e);return t.getFullYear()-n.getFullYear()}function $U(r,e){var t=r.getFullYear()-e.getFullYear()||r.getMonth()-e.getMonth()||r.getDate()-e.getDate()||r.getHours()-e.getHours()||r.getMinutes()-e.getMinutes()||r.getSeconds()-e.getSeconds()||r.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function aIe(r,e){gr(2,arguments);var t=mr(r),n=mr(e),i=$U(t,n),o=Math.abs(eIe(t,n));t.setDate(t.getDate()-i*o);var s=+($U(t,n)===-i),a=i*(o-s);return a===0?0:a}function v6(r,e){return gr(2,arguments),mr(r).getTime()-mr(e).getTime()}var kU={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},cIe="trunc";function b6(r){return r?kU[r]:kU[cIe]}function lIe(r,e,t){gr(2,arguments);var n=v6(r,e)/rIe;return b6(void 0)(n)}function dIe(r,e,t){gr(2,arguments);var n=v6(r,e)/tIe;return b6(void 0)(n)}function uIe(r){gr(1,arguments);var e=mr(r);return e.setHours(23,59,59,999),e}function fIe(r){gr(1,arguments);var e=mr(r),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function hIe(r){gr(1,arguments);var e=mr(r);return uIe(e).getTime()===fIe(e).getTime()}function pIe(r,e){gr(2,arguments);var t=mr(r),n=mr(e),i=xg(t,n),o=Math.abs(oIe(t,n)),s;if(o<1)s=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-i*o);var a=xg(t,n)===-i;hIe(mr(r))&&o===1&&xg(r,n)===1&&(a=!1),s=i*(o-Number(a))}return s===0?0:s}function yIe(r,e,t){gr(2,arguments);var n=v6(r,e)/1e3;return b6(void 0)(n)}function mIe(r,e){gr(2,arguments);var t=mr(r),n=mr(e),i=xg(t,n),o=Math.abs(sIe(t,n));t.setFullYear(1584),n.setFullYear(1584);var s=xg(t,n)===-i,a=i*(o-Number(s));return a===0?0:a}function gIe(r,e){gr(2,arguments);var t=Fo(e);return JPe(r,-t)}var vIe=864e5;function bIe(r){gr(1,arguments);var e=mr(r),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),i=t-n;return Math.floor(i/vIe)+1}function ux(r){gr(1,arguments);var e=1,t=mr(r),n=t.getUTCDay(),i=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-i),t.setUTCHours(0,0,0,0),t}function GH(r){gr(1,arguments);var e=mr(r),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var i=ux(n),o=new Date(0);o.setUTCFullYear(t,0,4),o.setUTCHours(0,0,0,0);var s=ux(o);return e.getTime()>=i.getTime()?t+1:e.getTime()>=s.getTime()?t:t-1}function wIe(r){gr(1,arguments);var e=GH(r),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=ux(t);return n}var _Ie=6048e5;function EIe(r){gr(1,arguments);var e=mr(r),t=ux(e).getTime()-wIe(e).getTime();return Math.round(t/_Ie)+1}function fx(r,e){var t,n,i,o,s,a,l,d;gr(1,arguments);var c=u1(),u=Fo((t=(n=(i=(o=e?.weekStartsOn)!==null&&o!==void 0?o:e==null||(s=e.locale)===null||s===void 0||(a=s.options)===null||a===void 0?void 0:a.weekStartsOn)!==null&&i!==void 0?i:c.weekStartsOn)!==null&&n!==void 0?n:(l=c.locale)===null||l===void 0||(d=l.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&t!==void 0?t:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=mr(r),h=f.getUTCDay(),p=(h<u?7:0)+h-u;return f.setUTCDate(f.getUTCDate()-p),f.setUTCHours(0,0,0,0),f}function YH(r,e){var t,n,i,o,s,a,l,d;gr(1,arguments);var c=mr(r),u=c.getUTCFullYear(),f=u1(),h=Fo((t=(n=(i=(o=e?.firstWeekContainsDate)!==null&&o!==void 0?o:e==null||(s=e.locale)===null||s===void 0||(a=s.options)===null||a===void 0?void 0:a.firstWeekContainsDate)!==null&&i!==void 0?i:f.firstWeekContainsDate)!==null&&n!==void 0?n:(l=f.locale)===null||l===void 0||(d=l.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(h>=1&&h<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var p=new Date(0);p.setUTCFullYear(u+1,0,h),p.setUTCHours(0,0,0,0);var y=fx(p,e),g=new Date(0);g.setUTCFullYear(u,0,h),g.setUTCHours(0,0,0,0);var w=fx(g,e);return c.getTime()>=y.getTime()?u+1:c.getTime()>=w.getTime()?u:u-1}function AIe(r,e){var t,n,i,o,s,a,l,d;gr(1,arguments);var c=u1(),u=Fo((t=(n=(i=(o=e?.firstWeekContainsDate)!==null&&o!==void 0?o:e==null||(s=e.locale)===null||s===void 0||(a=s.options)===null||a===void 0?void 0:a.firstWeekContainsDate)!==null&&i!==void 0?i:c.firstWeekContainsDate)!==null&&n!==void 0?n:(l=c.locale)===null||l===void 0||(d=l.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1),f=YH(r,e),h=new Date(0);h.setUTCFullYear(f,0,u),h.setUTCHours(0,0,0,0);var p=fx(h,e);return p}var xIe=6048e5;function SIe(r,e){gr(1,arguments);var t=mr(r),n=fx(t,e).getTime()-AIe(t,e).getTime();return Math.round(n/xIe)+1}function Cr(r,e){for(var t=r<0?"-":"",n=Math.abs(r).toString();n.length<e;)n="0"+n;return t+n}var Df={y:function(e,t){var n=e.getUTCFullYear(),i=n>0?n:1-n;return Cr(t==="yy"?i%100:i,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):Cr(n+1,2)},d:function(e,t){return Cr(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return Cr(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Cr(e.getUTCHours(),t.length)},m:function(e,t){return Cr(e.getUTCMinutes(),t.length)},s:function(e,t){return Cr(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,i=e.getUTCMilliseconds(),o=Math.floor(i*Math.pow(10,n-3));return Cr(o,t.length)}},Dm={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},TIe={G:function(e,t,n){var i=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(i,{width:"abbreviated"});case"GGGGG":return n.era(i,{width:"narrow"});case"GGGG":default:return n.era(i,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var i=e.getUTCFullYear(),o=i>0?i:1-i;return n.ordinalNumber(o,{unit:"year"})}return Df.y(e,t)},Y:function(e,t,n,i){var o=YH(e,i),s=o>0?o:1-o;if(t==="YY"){var a=s%100;return Cr(a,2)}return t==="Yo"?n.ordinalNumber(s,{unit:"year"}):Cr(s,t.length)},R:function(e,t){var n=GH(e);return Cr(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return Cr(n,t.length)},Q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(i);case"QQ":return Cr(i,2);case"Qo":return n.ordinalNumber(i,{unit:"quarter"});case"QQQ":return n.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(i,{width:"wide",context:"formatting"})}},q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(i);case"qq":return Cr(i,2);case"qo":return n.ordinalNumber(i,{unit:"quarter"});case"qqq":return n.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(i,{width:"wide",context:"standalone"})}},M:function(e,t,n){var i=e.getUTCMonth();switch(t){case"M":case"MM":return Df.M(e,t);case"Mo":return n.ordinalNumber(i+1,{unit:"month"});case"MMM":return n.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(i,{width:"wide",context:"formatting"})}},L:function(e,t,n){var i=e.getUTCMonth();switch(t){case"L":return String(i+1);case"LL":return Cr(i+1,2);case"Lo":return n.ordinalNumber(i+1,{unit:"month"});case"LLL":return n.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(i,{width:"wide",context:"standalone"})}},w:function(e,t,n,i){var o=SIe(e,i);return t==="wo"?n.ordinalNumber(o,{unit:"week"}):Cr(o,t.length)},I:function(e,t,n){var i=EIe(e);return t==="Io"?n.ordinalNumber(i,{unit:"week"}):Cr(i,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):Df.d(e,t)},D:function(e,t,n){var i=bIe(e);return t==="Do"?n.ordinalNumber(i,{unit:"dayOfYear"}):Cr(i,t.length)},E:function(e,t,n){var i=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(i,{width:"short",context:"formatting"});case"EEEE":default:return n.day(i,{width:"wide",context:"formatting"})}},e:function(e,t,n,i){var o=e.getUTCDay(),s=(o-i.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return Cr(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(e,t,n,i){var o=e.getUTCDay(),s=(o-i.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return Cr(s,t.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(e,t,n){var i=e.getUTCDay(),o=i===0?7:i;switch(t){case"i":return String(o);case"ii":return Cr(o,t.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(i,{width:"short",context:"formatting"});case"iiii":default:return n.day(i,{width:"wide",context:"formatting"})}},a:function(e,t,n){var i=e.getUTCHours(),o=i/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(e,t,n){var i=e.getUTCHours(),o;switch(i===12?o=Dm.noon:i===0?o=Dm.midnight:o=i/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(e,t,n){var i=e.getUTCHours(),o;switch(i>=17?o=Dm.evening:i>=12?o=Dm.afternoon:i>=4?o=Dm.morning:o=Dm.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var i=e.getUTCHours()%12;return i===0&&(i=12),n.ordinalNumber(i,{unit:"hour"})}return Df.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Df.H(e,t)},K:function(e,t,n){var i=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(i,{unit:"hour"}):Cr(i,t.length)},k:function(e,t,n){var i=e.getUTCHours();return i===0&&(i=24),t==="ko"?n.ordinalNumber(i,{unit:"hour"}):Cr(i,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Df.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Df.s(e,t)},S:function(e,t){return Df.S(e,t)},X:function(e,t,n,i){var o=i._originalDate||e,s=o.getTimezoneOffset();if(s===0)return"Z";switch(t){case"X":return IU(s);case"XXXX":case"XX":return Sp(s);case"XXXXX":case"XXX":default:return Sp(s,":")}},x:function(e,t,n,i){var o=i._originalDate||e,s=o.getTimezoneOffset();switch(t){case"x":return IU(s);case"xxxx":case"xx":return Sp(s);case"xxxxx":case"xxx":default:return Sp(s,":")}},O:function(e,t,n,i){var o=i._originalDate||e,s=o.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+PU(s,":");case"OOOO":default:return"GMT"+Sp(s,":")}},z:function(e,t,n,i){var o=i._originalDate||e,s=o.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+PU(s,":");case"zzzz":default:return"GMT"+Sp(s,":")}},t:function(e,t,n,i){var o=i._originalDate||e,s=Math.floor(o.getTime()/1e3);return Cr(s,t.length)},T:function(e,t,n,i){var o=i._originalDate||e,s=o.getTime();return Cr(s,t.length)}};function PU(r,e){var t=r>0?"-":"+",n=Math.abs(r),i=Math.floor(n/60),o=n%60;if(o===0)return t+String(i);var s=e;return t+String(i)+s+Cr(o,2)}function IU(r,e){if(r%60===0){var t=r>0?"-":"+";return t+Cr(Math.abs(r)/60,2)}return Sp(r,e)}function Sp(r,e){var t=e||"",n=r>0?"-":"+",i=Math.abs(r),o=Cr(Math.floor(i/60),2),s=Cr(i%60,2);return n+o+t+s}var OU=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},ZH=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},$Ie=function(e,t){var n=e.match(/(P+)(p+)?/)||[],i=n[1],o=n[2];if(!o)return OU(e,t);var s;switch(i){case"P":s=t.dateTime({width:"short"});break;case"PP":s=t.dateTime({width:"medium"});break;case"PPP":s=t.dateTime({width:"long"});break;case"PPPP":default:s=t.dateTime({width:"full"});break}return s.replace("{{date}}",OU(i,t)).replace("{{time}}",ZH(o,t))},kIe={p:ZH,P:$Ie},PIe=["D","DD"],IIe=["YY","YYYY"];function OIe(r){return PIe.indexOf(r)!==-1}function CIe(r){return IIe.indexOf(r)!==-1}function CU(r,e,t){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var RIe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},DIe=function(e,t,n){var i,o=RIe[e];return typeof o=="string"?i=o:t===1?i=o.one:i=o.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i},MIe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},BIe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},jIe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},NIe={date:Zk({formats:MIe,defaultWidth:"full"}),time:Zk({formats:BIe,defaultWidth:"full"}),dateTime:Zk({formats:jIe,defaultWidth:"full"})},UIe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},LIe=function(e,t,n,i){return UIe[e]},KIe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},zIe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},FIe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},qIe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},VIe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},WIe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},HIe=function(e,t){var n=Number(e),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},GIe={ordinalNumber:HIe,era:ib({values:KIe,defaultWidth:"wide"}),quarter:ib({values:zIe,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:ib({values:FIe,defaultWidth:"wide"}),day:ib({values:qIe,defaultWidth:"wide"}),dayPeriod:ib({values:VIe,defaultWidth:"wide",formattingValues:WIe,defaultFormattingWidth:"wide"})},YIe=/^(\d+)(th|st|nd|rd)?/i,ZIe=/\d+/i,JIe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},XIe={any:[/^b/i,/^(a|c)/i]},QIe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},e5e={any:[/1/i,/2/i,/3/i,/4/i]},t5e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},r5e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},n5e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},i5e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},o5e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},s5e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},a5e={ordinalNumber:GPe({matchPattern:YIe,parsePattern:ZIe,valueCallback:function(e){return parseInt(e,10)}}),era:ob({matchPatterns:JIe,defaultMatchWidth:"wide",parsePatterns:XIe,defaultParseWidth:"any"}),quarter:ob({matchPatterns:QIe,defaultMatchWidth:"wide",parsePatterns:e5e,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ob({matchPatterns:t5e,defaultMatchWidth:"wide",parsePatterns:r5e,defaultParseWidth:"any"}),day:ob({matchPatterns:n5e,defaultMatchWidth:"wide",parsePatterns:i5e,defaultParseWidth:"any"}),dayPeriod:ob({matchPatterns:o5e,defaultMatchWidth:"any",parsePatterns:s5e,defaultParseWidth:"any"})},JH={code:"en-US",formatDistance:DIe,formatLong:NIe,formatRelative:LIe,localize:GIe,match:a5e,options:{weekStartsOn:0,firstWeekContainsDate:1}},c5e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,l5e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,d5e=/^'([^]*?)'?$/,u5e=/''/g,f5e=/[a-zA-Z]/;function RU(r,e,t){var n,i,o,s,a,l,d,c,u,f,h,p,y,g;gr(2,arguments);var w=String(e),v=u1(),m=(n=(i=void 0)!==null&&i!==void 0?i:v.locale)!==null&&n!==void 0?n:JH,b=Fo((o=(s=(a=(l=void 0)!==null&&l!==void 0?l:void 0)!==null&&a!==void 0?a:v.firstWeekContainsDate)!==null&&s!==void 0?s:(d=v.locale)===null||d===void 0||(c=d.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(b>=1&&b<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var _=Fo((u=(f=(h=(p=void 0)!==null&&p!==void 0?p:void 0)!==null&&h!==void 0?h:v.weekStartsOn)!==null&&f!==void 0?f:(y=v.locale)===null||y===void 0||(g=y.options)===null||g===void 0?void 0:g.weekStartsOn)!==null&&u!==void 0?u:0);if(!(_>=0&&_<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!m.localize)throw new RangeError("locale must contain localize property");if(!m.formatLong)throw new RangeError("locale must contain formatLong property");var E=mr(r);if(!iIe(E))throw new RangeError("Invalid time value");var S=A5(E),T=gIe(E,S),O={firstWeekContainsDate:b,weekStartsOn:_,locale:m,_originalDate:E},M=w.match(l5e).map(function(Q){var W=Q[0];if(W==="p"||W==="P"){var U=kIe[W];return U(Q,m.formatLong)}return Q}).join("").match(c5e).map(function(Q){if(Q==="''")return"'";var W=Q[0];if(W==="'")return h5e(Q);var U=TIe[W];if(U)return CIe(Q)&&CU(Q,e,String(r)),OIe(Q)&&CU(Q,e,String(r)),U(T,Q,m.localize,O);if(W.match(f5e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+W+"`");return Q}).join("");return M}function h5e(r){var e=r.match(d5e);return e?e[1].replace(u5e,"'"):r}var p5e=["years","months","weeks","days","hours","minutes","seconds"];function y5e(r,e){var t,n,i,o,s;if(arguments.length<1)throw new TypeError("1 argument required, but only ".concat(arguments.length," present"));var a=u1(),l=(t=(n=e?.locale)!==null&&n!==void 0?n:a.locale)!==null&&t!==void 0?t:JH,d=(i=e?.format)!==null&&i!==void 0?i:p5e,c=(o=e?.zero)!==null&&o!==void 0?o:!1,u=(s=e?.delimiter)!==null&&s!==void 0?s:" ";if(!l.formatDistance)return"";var f=d.reduce(function(h,p){var y="x".concat(p.replace(/(^.)/,function(w){return w.toUpperCase()})),g=r[p];return typeof g=="number"&&(c||r[p])?h.concat(l.formatDistance(y,g)):h},[]).join(u);return f}function m5e(r){gr(1,arguments);var e=mr(r.start),t=mr(r.end);if(isNaN(e.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(t.getTime()))throw new RangeError("End Date is invalid");var n={};n.years=Math.abs(mIe(t,e));var i=xg(t,e),o=sb(e,{years:i*n.years});n.months=Math.abs(pIe(t,o));var s=sb(o,{months:i*n.months});n.days=Math.abs(aIe(t,s));var a=sb(s,{days:i*n.days});n.hours=Math.abs(lIe(t,a));var l=sb(a,{hours:i*n.hours});n.minutes=Math.abs(dIe(t,l));var d=sb(l,{minutes:i*n.minutes});return n.seconds=Math.abs(yIe(t,d)),n}function DU(r){var e="";return t(r),e;function t(n){if(n===null||typeof n!="object"||n.toJSON!=null)e+=JSON.stringify(n);else if(Array.isArray(n)){e+="[";let i=!1;n.forEach(o=>{i&&(e+=","),i=!0,t(o)}),e+="]"}else{e+="{";let i=!1;Object.keys(n).sort().forEach(o=>{i&&(e+=","),i=!0,e+=JSON.stringify(o),e+=":",t(n[o])}),e+="}"}}}const BE={get:(r,e)=>{let t=JSON.parse(localStorage.getItem("web5:"+r));if(t)return t;if(e!==void 0)return BE.set(r,e),e},set:(r,e)=>(localStorage.setItem("web5:"+r,JSON.stringify(e)),e),modify:(r,e)=>{const t=(void 0).get(r);return(void 0).set(r,e(t))}};function MU(r){return{services:[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:r||["https://dwn.tbddev.org/beta"],enc:"#enc",sig:"#sig"}],verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]},{algorithm:"secp256k1",id:"enc",purposes:["keyAgreement"]}]}}async function g5e(r,e,t=[],n){try{for(const i of t)(await r.rpc.getServerInfo(i)).registrationRequirements.length!==0&&(await vh.registerTenant(i,r.agentDid.uri),await vh.registerTenant(i,e.did.uri));n.onSuccess()}catch(i){n.onFailure(i)}}async function v5e(r,e,t=!1){try{let n,o=(await r.protocols.query({message:{}})).protocols.find(s=>e.protocol===s.definition.protocol);if(!o)n=e;else if(t){let s=DU(e),a=DU(o?.definition||null);s!==a&&(n=e)}n&&await(await r.protocols.configure({message:{definition:n}})).send()}catch(n){return console.log("Installation of protocol configuration failed",n),!1}return!0}async function b5e(r,e){const t=await eT.create(),n=await t.export();let i=await Promise.all(e.map(async o=>{const{protocolDefinition:s,permissionScopes:a}=o;if(console.log(o),!a.every(c=>"protocol"in c&&c.protocol===s.protocol))throw new Error("All permission scopes must match the protocol uri they are provided with.");return await v5e(r.dwn,s),console.log(a),await cs.createPermissionGrants(r.did.connectedDid,t,r.agent,a).catch(c=>console.log(c))})).then(o=>o.flat());return{delegateDid:n,grants:i}}const w5e=`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connecting...</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
      text-align: center;
      background: #000;
      color: #fff;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .text {
      font-size: 16px;
      color: #333;
    }
    .spinner {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      font-size: 2em;
    }
      .spinner div {
        position: relative;
        width: 2em;
        height: 2em;
        margin: 0.1em 0.25em 0 0;
      }
      .spinner div::after,
      .spinner div::before {
        content: '';  
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 0.1em solid #FFF;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        animation: spinner 2s linear infinite;
      }
      .spinner div::after {
        animation-delay: 1s;
      }

    @keyframes spinner {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="spinner">
      <div></div>
    </div>
    <div id="message">Locating wallets...</div>
  </div>
</body>
</html>
`;function _5e(r={}){const e=r.width||500,t=r.height||600,n=(screen.width-e)/2,i=(screen.height-t)/2,o=window.open("","_blank",`popup=true,width=${e},height=${t},left=${n},top=${i}`);return o.document.write(r.content||w5e),o}function E5e(r,e,t="application/json"){const n=new Blob([e],{type:t}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=r,document.body.append(o),o.click(),o.remove(),URL.revokeObjectURL(i)}const A5e={email:"email",password:"password"};async function x5e(r,e=document.body){return new Promise(t=>{XH({appendTo:e,srcdoc:`<body>${Object.keys(r).reduce((n,i)=>{const o=i==="password"?"current-password":i;return n+`<input type="${A5e[i]||"text"}" name="${i}" value="${r[i]}" autocomplete="${o}">`},'<form action="#" method="POST">')+"</form>"}<script>document.forms[0].submit();<\/script></body>`,onLoad:n=>setTimeout(()=>{n.remove(),t()},100)})})}function XH(r={}){const e=document.createElement("iframe");return e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.width="1px",e.style.height="1px",e.style.zIndex="-1000",r.onLoad&&e.addEventListener("load",()=>r.onLoad(e),{once:!0}),r.onError&&e.addEventListener("error",()=>r.onError(e),{once:!0}),r.src?e.src=r.src:r.srcdoc&&(e.srcdoc=r.srcdoc),r.appendTo&&r.appendTo.append(e),e}let BU,ko;const Jk={},S5e=/(?:[^@]*@)?(did:[a-z0-9]+:[a-zA-Z0-9-]+)/;window.addEventListener("load",r=>{const e=window.self!==window.top;location.pathname==="/dweb-connect"&&(e||window.opener)&&(window.addEventListener("message",async t=>{const{type:n,did:i,permissions:o}=t.data;if(n==="dweb-connect-support-request"&&e){const s=await fn.connect?.onSupportRequest?.(i).catch(a=>!1);window.parent.postMessage({type:"dweb-connect-support-response",supported:s===!1?!1:!!await fn.identity.get(i)},t.origin)}else if(n==="dweb-connect-authorization-request"){if(console.log("Authorization request from: ",t.origin),!window?.opener?.closed){let s,a;const{authorize:l}=await fn.connect?.onAuthorizationRequest?.(t.origin,i,o,t).catch(d=>{})||{};if(l)try{const d=await fn.use(i);({delegateDid:s,grants:a}=await b5e(d,o).catch(c=>(console.error(c),{}))),a||console.error("Failed to generate grants")}catch(d){console.log(d),fn.connect?.onGrantError?.(d.origin,i,o)}fn.connect?.onAuthorizationComplete?.(t.origin,i,o,a),window.opener.postMessage({type:"dweb-connect-authorization-response",delegateDid:s,grants:a},t.origin)}window.close()}}),window.opener?.postMessage({type:"dweb-connect-loaded"},"*"))});window.addEventListener("beforeunload",()=>fn.connect.abort());async function yp(){return fn.initialize({portableAgent:!1})}async function jU(r){return r?.export?.()||r}async function T5e(r,e,t=!1){const n=e?.portableDid?.uri;if(!await r.identity.get({didUri:n})){let o=await r.identity.import({portableIdentity:e});return t?await r.identity.manage({portableIdentity:e}):o}}const fn=globalThis.DWeb={storage:BE,async initialize(r={}){return BU||(BU=new Promise(async e=>{let t=BE.get("agentDid");t||(r.portableAgent!==!1?t=await cv.create({options:MU(r.dwnEndpoints)}):t=await eT.create({options:{algorithm:"Ed25519"}}),t=await t.export(),BE.set("agentDid",t));let n=await Nu.import({portableDid:t});(fn.agent=await lT.create({agentDid:n})).sync.startSync({interval:r.syncInterval||"2m"}).catch(o=>{console.error(`Sync failed: ${o}`)}),e(fn.agent)}))},did:{async update(r,e){if(!e)throw"You must pass in a function that modifies a copy of the DID Document, or an already modified DID Document.";typeof r=="string"&&(r=await(await yp()).identity.get({didUri:r}));let t=r.did.document,n=e;typeof e=="function"&&(n=structuredClone(r.did.document),await e(n)),r.did.document=n;try{return await cv.publish({did:r.did})}catch{throw r.did.document=t,"Failed to update DID Document"}}},identity:{async create(r={}){const e=await yp(),t=r.dwnEndpoints||["https://dwn.tbddev.org/beta"],n=await e.identity.create({didMethod:r.method||"dht",metadata:{name:"Default"},didOptions:MU(t)});return r.cache!==!1&&await e.identity.manage({portableIdentity:await n.export()}),r.registration!==void 0&&t&&await g5e(e,n,t,r.registration).catch(i=>console.log("Endpoint registration failed: ",i)),n},async list(){const r=await(await yp()).identity.list();return r.forEach(e=>{e.connectedDid=e.metadata?.connectedDid||e.did.uri}),r},async get(r){const e=await(await yp()).identity.get({didUri:r});if(e)return e.connectedDid=e?.metadata?.connectedDid||e.did.uri,e},async addAutofillDid(r){await x5e({email:r})},async backup(r,e={}){const t=await jU(r);!e.to||e.to==="file"?E5e(r.did.uri.replace(/:/g,"+"),JSON.stringify(t,null,2)):console.warn(`The mechanism to backup to ${e.to} is not yet implemented`)},async restore(r={}){const e=[],t=await yp();return new Promise(async(n,i)=>{if(!r.from||r.from==="file")try{await Promise.all(r?.files?.map(o=>new Promise(s=>{const a=new FileReader;a.onload=async l=>{const d=JSON.parse(l.target.result),c=await T5e(t,d,!0).catch(u=>console.log(u));c&&e.push(c),s()},a.readAsText(o)}))),n(e)}catch(o){i(o)}else console.warn(`The mechanism to restore from ${r.from} is not yet implemented`)})}},async use(r,e={}){const t=r?.metadata?.connectedDid?r.did.uri:void 0,n=r?.metadata?.connectedDid||r?.did?.uri||r?.uri||r;return Jk[n]||(Jk[n]=new Promise(async i=>{const o=await yp();await fn.identity.get(t||n)||await o.identity.manage({portableIdentity:await jU(r)});const a=new lx({agent:o,connectedDid:n,delegateDid:t});e.sync!==!1&&(await o.sync.getIdentityOptions(n)||await o.sync.registerIdentity({did:n})),i(a)}))},dispose(r){(r?.agent||r).sync.stopSync(),delete Jk[r.connectedDid]},connect:{abort:r=>{ko&&(clearInterval(ko.interval),window.removeEventListener("message",ko.listener),r!==!1&&ko.reject(),ko.window.close(),ko=null)},attachInput(r,e={}){if(r._dweb_connect)return;const t=r._dweb_connect={event:e.event||"change",listener:async n=>{const o=(n.target.closest("input")||n.composedPath().find(s=>s.tagName==="INPUT")||r).value?.match?.(S5e)?.[1];if(!o)e?.onError?.("Invalid DID");else if(ko)ko.window.focus();else{r.setAttribute("dweb-connect-active","");try{const s=await fn.connect.webWallet(o,n,e);e?.onConnect?.(...s)}catch(s){e?.onError?.(s)}r.removeAttribute("dweb-connect-active")}}};r.addEventListener(t.event,t.listener)},detachInput(r){r._dweb_connect&&(r.removeAttribute("dweb-connect-active"),r.removeEventListener(r._dweb_connect.event,r._dweb_connect.listener),delete r._dweb_connect)},async webWallet(r,e,t={}){return new Promise(async(i,o)=>{if(ko)throw ko.window.focus(),"An attempt to connect to a web wallet is already in progress";if(!e.isTrusted)throw"Connecting to a web wallet must be initiated by a user action";ko={window:_5e(),reject:o};const s=t.onProgress,l=(await fetch(`https://dweb/${r}/read/protocols/${encodeURIComponent("https://areweweb5yet.com/protocols/profile")}/connect`).then(p=>p.json()).catch(p=>{}))?.webWallets;if(!l?.length){o("No wallets found for "+r);return}ko.window.message.textContent="Wallets found. Attempting to connect...",s?.({stage:"wallets-found",wallets:l});const d=await Promise.any(l.reduce((p,y)=>{const g=new URL(y);return g.protocol.match("http")&&p.push(new Promise(async(w,v)=>{XH({appendTo:document.body,src:g.origin+"/dweb-connect",onLoad:m=>{window.addEventListener("message",b=>{b.origin===g.origin&&b.data.type==="dweb-connect-support-response"&&(m.remove(),b.data.supported?w(g.origin):v())}),m.contentWindow.postMessage({type:"dweb-connect-support-request",did:r},g.origin),setTimeout(()=>{m.remove(),v()},1e4)},onError:m=>{m.remove(),v()}})})),p},[])).catch(p=>null);if(!d){o("No wallet was able to provide connection support for "+r);return}let c=!1;async function u(p){const{type:y,delegateDid:g,grants:w}=p.data;if(p.origin===d){if(y==="dweb-connect-loaded")c=!0,ko.window.postMessage({type:"dweb-connect-authorization-request",did:r,permissions:t.permissions},d);else if(y==="dweb-connect-authorization-response")if(fn.connect.abort(!1),w){const v=await yp(),m=await v.identity.import({portableIdentity:{portableDid:g,metadata:{connectedDid:r,name:"Default",tenant:g.uri,uri:g.uri}}});await v.identity.manage({portableIdentity:await m.export()});const b=await lx.processConnectedGrants({grants:w,agent:v,delegateDid:g.uri});await v.sync.getIdentityOptions(r)||await v.sync.registerIdentity({did:r,options:{delegateDid:g.uri,protocols:b}}),await v.sync.sync("pull"),i({did:r,delegateDid:g,grants:w})}else o("Authorization rejected for connection request to "+r)}}window.addEventListener("message",u);let f=0;const h=500;ko.interval=setInterval(()=>{f+=h,(ko?.window?.closed||!c&&f>1e4)&&fn.connect.abort()},h),s?.({stage:"requesting-authorization",walletDomain:d}),ko.window.location.href=d+"/dweb-connect"}).finally(()=>{fn.connect.abort()})}}};class dw{static channels={};constructor(e,t={}){this.name=e,this.sender=new BroadcastChannel(e),this.receiver=new BroadcastChannel(e),this.receiver.addEventListener("message",n=>{this.data=n.data})}publish(e){this.data=e,this.sender.postMessage(e)}subscribe(e){this.receiver.addEventListener("message",e),this.data!==void 0&&e({data:this.data})}unsubscribe(e){this.receiver.removeEventListener("message",e)}close(){delete dw.channels[this.name],this.sender.close(),this.receiver.close()}}class Xk{static channels={};constructor(e,t={}){this.name=e,this.listeners=new Set}publish(e){this.data=e,this.listeners.forEach(t=>t({data:e}))}subscribe(e){this.listeners.add(e),this.data!==void 0&&e({data:this.data})}unsubscribe(e){this.listeners.delete(e)}}const NU={page:{get(r,e={}){return Xk.channels[r]||(Xk.channels[r]=new Xk(r))}},app:{get(r,e={}){return dw.channels[r]||(dw.channels[r]=new dw(r))}}},Ju=r=>class extends r{constructor(){super(),this.constructor.properties={...super.constructor.properties,...this.constructor.properties},Object.entries(this.constructor.properties||{}).forEach(([e,t])=>{if(t.store&&!t._channel){const n=t._channel=(t.store==="app"?NU.app:NU.page).get(e,{store:!0});n.data!==void 0&&(this[e]=n.data),n.subscribe(i=>{i.data!==this[e]&&(this[e]=i.data)})}})}willUpdate(e){if(!this.constructor._willUpdateRunning)return this.constructor._willUpdateRunning=!0,e.forEach((t,n)=>{const i=this.constructor?.properties?.[n];let o=this[n];i&&i.store&&o!==i._channel.data&&i._channel.publish(o)}),super.willUpdate(e)}updated(e){super.updated(e),this.constructor._willUpdateRunning=!1}},wd=r=>class extends r{#t=new Map;constructor(){if(super(),this.constructor.query)for(const[e,t]of Object.entries(this.constructor.query)){let n,i;typeof t=="string"?(n=t,i=!1):[n,i]=t,Object.defineProperty(this,e,{get:()=>this.#i(e,n,i),enumerable:!0,configurable:!0})}}#i(e,t,n){if(n&&this.#t.has(e))return this.#t.get(e);const i=this.renderRoot.querySelector(t);return n&&i&&this.#t.set(e,i),i}},Su=globalThis.DOM={ready:new Promise(r=>{document.addEventListener("DOMContentLoaded",e=>{document.documentElement.setAttribute("ready",""),r(e)})}),delay:r=>new Promise(e=>setTimeout(e,r)),query:r=>document.querySelector(r),queryAll:r=>document.querySelectorAll(r),skipFrame:r=>new Promise(e=>requestAnimationFrame(()=>{requestAnimationFrame(()=>{r&&r(),e()})})),wait:r=>new Promise(e=>setTimeout(()=>e(),r)),fireEvent(r,e,t={}){return r.dispatchEvent(new CustomEvent(e,Object.assign({bubbles:!0,composed:!0},t)))},addEventDelegate(r,e,t,n={}){let i=o=>{const s=o.composedPath?o.composedPath()[0]:o.target;let a=s.closest(e);a&&(!n.avoid||!s.closest(n.avoid))&&t(o,a)};return(n.container||document).addEventListener(r,i,n),i},removeEventDelegate(r,e,t={}){(t.container||document).removeEventListener(r,e)},getQueryParams(r){const e={};return new URLSearchParams(r||location.search).forEach((t,n)=>{e[n]?e[n].push(t):e[n]=[t]}),e},debounce(r,e=50){let t=null,n=null,i=null;const o=()=>{r.apply(i,n),t=null};return function(...s){n=s,i=this,t=t||setTimeout(o,e)}}},x5=[];document.addEventListener("pointerdown",r=>{const e=r.composedPath(),t=e.find(n=>n?.matches?.("[pressable]"))||e[0];t.setAttribute("pressed",""),x5.push(t)},{passive:!0,capture:!0});window.addEventListener("pointerup",r=>{x5.forEach(e=>e.removeAttribute("pressed")),x5.length=0},{passive:!0,capture:!0});const QH=300,dT=Ye`
  .spinner-mixin {
    --inset: 0;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    background: var(--body-bk);
    inset: var(--inset);
    opacity: 0;
    transition: opacity ${QH}ms ease;
    z-index: 1000;
    pointer-events: none;
  }

  .spinner-mixin[spinner-show] {
    opacity: 1;
    pointer-events: all;
  }

  .spinner-mixin[spinner-options~="fixed"] {
    position: fixed;
  }
`,f1=r=>class extends r{constructor(){super();let e;const t=this.firstUpdated;this.#t=new Promise(n=>e=n),this.firstUpdated=async n=>{e(),await t?.call(this,n)}}#t;#i(e){e.propertyName==="opacity"&&getComputedStyle(e.target).opacity==="0"&&e.target.remove()}#p(){const e=document.createElement("div");return e.classList.add("spinner-mixin"),e.ontransitionend=t=>this.#i(t),e.appendChild(document.createElement("sl-spinner")),e}async startSpinner(e={renderImmediate:!1,minimum:0,fixed:!1}){const t=e.fixed?"fixed":"";await this.#t;const n=typeof e.target=="string"?this.shadowRoot.querySelector(e.target):e.target||this.shadowRoot;let i=n.querySelector(".spinner-mixin");if(i){i.setAttribute("spinner-show","");return}i=this.#p(),i.setAttribute("spinner-options",t),n.append(i),e.minimum&&(i._spinnerMixinDelay=Su.delay(e.minimum)),e.renderImmediate?i.setAttribute("spinner-show",""):Su.skipFrame(()=>i.setAttribute("spinner-show","")),await Su.delay(QH)}async stopSpinner(e={}){const n=(typeof e.target=="string"?this.shadowRoot.querySelector(e.target):e.target||this.shadowRoot).querySelector(".spinner-mixin");await n?._spinnerMixinDelay,n?.removeAttribute?.("spinner-show"),document.visibilityState==="hidden"&&n?.remove()}};hi.with=function(...r){return r.reduce((e,t)=>t(e),this)};function $5e(r){const e=r.types,t=r.protocol;return Object.entries(e).reduce((n,[i,o])=>(o.dataFormats.some(s=>s.match("json"))&&(n[i]=e[i].schema=t+"/schemas/"+i),n),{})}const jE={published:!0,protocol:"https://areweweb5yet.com/protocols/profile",types:{name:{dataFormats:["application/json"]},social:{dataFormats:["application/json"]},messaging:{dataFormats:["application/json"]},phone:{dataFormats:["application/json"]},address:{dataFormats:["application/json"]},career:{dataFormats:["application/json"]},payment:{dataFormats:["application/json"]},connect:{dataFormats:["application/json"]},avatar:{dataFormats:["image/gif","image/png","image/jpeg"]},hero:{dataFormats:["image/gif","image/png","image/jpeg"]}},structure:{name:{},social:{},career:{},avatar:{},hero:{},messaging:{},address:{},phone:{},payment:{},connect:{}}},Hy={uri:jE.protocol,schemas:$5e(jE),definition:jE},S5={[jE.protocol]:Hy},L2=Object.freeze(Object.defineProperty({__proto__:null,byUri:S5,profile:Hy},Symbol.toStringTag,{value:"Module"}));globalThis.URLPattern||await xL(()=>import("./index-CBloBB_n.js"),[]);const k5e=/^(?:dweb:\/\/)?(did:[^\/]+)(?:\/protocols\/([^\/]+)\/?)?/,Qk=typeof Buffer<"u",Ps={canonicalize:function(r){var e="";return t(r),e;function t(n){if(n===null||typeof n!="object"||n.toJSON!=null)e+=JSON.stringify(n);else if(Array.isArray(n)){e+="[";let i=!1;n.forEach(o=>{i&&(e+=","),i=!0,t(o)}),e+="]"}else{e+="{";let i=!1;Object.keys(n).sort().forEach(o=>{i&&(e+=","),i=!0,e+=JSON.stringify(o),e+=":",t(n[o])}),e+="}"}}},deepSet(r,e,t){const n=e.split("."),i=n.pop(),o=n.reduce((s,a)=>s[a]=s[a]||{},r);o[i]=t},unslash(r){return r.endsWith("/")?r.slice(0,-1):r},randomString(r=32){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";const n=new Uint8Array(r);return crypto.getRandomValues(n),n.forEach(i=>{t+=e[i%e.length]}),t},url:{encode:r=>{let e=[Qk?Buffer.from:btoa](encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode("0x"+n)));return Qk&&(e=e.toString("base64")),e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},decode:r=>{let e=r.replace(/-/g,"+").replace(/_/g,"/");return e=Qk?Buffer.from(e,"base64").toString():atob(e),decodeURIComponent(e.split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}},drl:{async cache(r,e,t){return await(await caches.open("drl")).put(r,new Response(t||await e.data.blob(),{headers:{"Content-Type":e.dataFormat,"dwn-cache-time":Date.now().toString()}})),r},async fromRecord(r,e,t){const n=`https://dweb/${r.author}/records/${r.id}`;return e&&await this.cache(n,r,t),n},create(r,{protocol:e="",action:t="",path:n="",params:i={},hash:o="",flushCache:s=!1}){let a=`https://dweb/${r}${t?"/"+t:""}`;e&&(a+="/protocols/"+encodeURIComponent(e)),a+=Ps.unslash(n.startsWith("/")?n:"/"+n);const l=new URLSearchParams;for(let d in i){const c=i[d];Array.isArray(c)?c.forEach(u=>l.append(d,u)):l.append(d,c)}return a+l.toString()+(s?"?cache-updated="+new Date().getTime():"")+o},parse(r,e="*"){const t=Ps.unslash(r),n=new URLPattern({protocol:"dweb",pathname:e}).exec(t);if(!n)return null;const i=t.match(k5e),o=i?.[2];return{did:i?.[1]||null,protocol:o?decodeURIComponent(o):null,path:n.pathname.groups,params:Object.fromEntries(new URLSearchParams(n.search.input)),hash:n.hash.input}}},worker(r,e=!1){const t=new Blob([`
      self.onmessage = function(e) {
        const { data, code } = e.data;
        const execute = new Function('data', code);
        try {
          const result = execute(data);
          self.postMessage({ result });
        }
        catch (error) {
          self.postMessage({ error: error.message });
        }
      }
    `],{type:"application/javascript"}),n=URL.createObjectURL(t),i=new Worker(n);return{run:function(o){return new Promise((s,a)=>{i.onmessage=function(l){l.data.error?a(new Error(l.data.error)):s(l.data.result),e||this.terminate()},i.postMessage({data:o,code:r})})},terminate:function(){i.terminate(),URL.revokeObjectURL(n)}}}};setInterval(()=>Va.cache={},1e3*60*60);async function ja(r){await Promise.all((Array.isArray(r)?r:[r]).map(async e=>{e.cache={json:await e.data?.json?.()?.catch(t=>{})?.then(t=>t||{})}}))}class Va{static cache={};static setCache(e,t,n){(Va.cache[e]||(Va.cache[e]={}))[t]=n}static getCache(e,t){return Va.cache?.[e]?.[t]}constructor(e,t={}){this.options=t,this.did=e.did.connectedDid,this.dwn=e.dwn,this.ready=this.installProtocols()}async installProtocols(){const e=await this.dwn.protocols.query({message:{}}),t=[];if(this.options.aggregator){const n=(void 0).definition.structure;n.story.$actions=n.thread.$actions=[{who:"anyone",can:["create","update","delete"]}]}try{for(let i in S5){let o=e.protocols.find(d=>i===d.definition.protocol),s=S5[i].definition,a=Ps.canonicalize(s),l=Ps.canonicalize(o?.definition||null);a!==l&&(console.log("installing protocol: "+i),t.push(this.dwn.protocols.configure({message:{definition:s}})))}const n=await Promise.all(t);try{await Promise.all(n.map(({protocol:i})=>i.send(this.did)))}catch(i){return console.log("remote push of configuration failed",i),!0}}catch(n){return console.log("local install of configuration failed",n),!1}return!0}async getProtocol(e,t={}){const n={from:t.from,message:{filter:{protocol:e}}},{protocols:i,status:o}=await this.dwn.protocols.query(n);return{protocol:i[0],status:o}}async queryProtocolRecords(e,t,n={}){await this.ready;const i={filter:{protocol:L2[e].uri,protocolPath:t}},o={message:i};return n.from&&(o.from=n.from),n.recordId&&(i.filter.recordId=n.recordId),n.parentId&&(i.filter.parentId=n.parentId),n.contextId&&(i.filter.contextId=n.contextId),n.published!==void 0&&(i.filter.published=n.published),n.recipient&&(i.filter.recipient=n.recipient),n.role&&(i.protocolRole=n.role),(n.sort||n.latestRecord)&&(i.dateSort=n.latestRecord?"createdDescending":n.sort),(n.pagination||n.latestRecord)&&(i.pagination=n.latestRecord?{limit:1}:n.pagination),this.dwn.records.query(o)}async readProtocolRecord(e,t={}){await this.ready;const n={message:{filter:{recordId:e}}};return t.from&&(n.from=t.from),t.role&&(n.message.protocolRole=t.role),this.dwn.records.read(n)}async createProtocolRecord(e,t,n={}){await this.ready;const i={message:{protocol:L2[e].uri,protocolPath:t}},o=L2[e].schemas[t.split("/").pop()];o&&(i.message.schema=o),n.from&&(i.from=n.from),n.store===!1&&(i.store=n.store),n.parentContextId&&(i.message.parentContextId=n.parentContextId),n.contextId&&(i.message.contextId=n.contextId),i.message.dataFormat=n.dataFormat||"application/json",typeof n.data<"u"?i.data=n.data:n.dataFormat==="application/json"&&(i.data={}),n.published!==void 0&&(i.message.published=n.published),n.recipient&&(i.message.recipient=n.recipient),n.role&&(i.message.protocolRole=n.role);const s=await this.dwn.records.create(i);return console.log("create status",s),n.store!==!1&&await s.record.send(n.from||this.did).then(a=>{console.log("sent success",s)}).catch(a=>{console.log("send error",a)}),s}async putRecordPath(e,t,n,i={}){await this.ready;let o=i.record;if(!o){const{records:d}=await this.queryProtocolRecords(e,t,{latestRecord:!0});o=d[0]}n=n instanceof File?new Blob([n],{type:i.dataFormat||n.type}):n;const s=n instanceof Blob?n.type:i.dataFormat||"application/json";try{o?(await o.update({data:n,published:i.published}),await o.send(this.did)):o=(await this.createProtocolRecord(e,t,{data:n,dataFormat:s,published:i.published})).record}catch(d){console.log(d)}const a=o.drl=Ps.drl.create(this.did,{protocol:L2[e].uri,path:t,action:"read"}),l=o.blob=o.blob||await o.data.blob();return i.cache!==!1&&Ps.drl.cache(a,o,l),o}async readRecordPath(e,t,n={}){await this.ready,n.latestRecord=!0;const{records:i,status:o}=await this.queryProtocolRecords(e,t,n),s=i[0];if(s)return n.cache!==!1&&await ja(s),s}async getAggregators(e={}){e.latestRecord=!0;const{records:t}=await this.queryProtocolRecords("social","aggregators",e),n=t[0];return n&&await ja(n),n}async setAggregators(e,t={}){let n;try{n=await this.getAggregators(t),n?await n.update({data:e}):n=(await this.createProtocolRecord("social","aggregators",{published:!0,data:e,dataFormat:"application/json"})).record;const{status:i}=await n.send(t.from)}catch(i){console.log(i)}return n&&await ja(n),n}async createSocial(e={}){const{record:t,status:n}=await this.createProtocolRecord("profile","social",{published:!0,data:e.data||{},dataFormat:"application/json"});return e.cache!==!1&&await ja(t),t}async getSocial(e={}){await this.ready;const t=e.from||this.did;if(t!==this.did){const s=Va.getCache(t,"social");if(s)return s}const{records:n,status:i}=await this.queryProtocolRecords("profile","social",e),o=n[0];if(o)return e.cache!==!1&&await ja(o),Va.setCache(t,"social",o),o}async createProfileImage(e,t={}){t.data&&(t.dataFormat=t.data.type,t.data instanceof File&&(t.data=new Blob([t.data],{type:t.dataFormat}))),t.published=!0;const{record:n,status:i}=await this.createProtocolRecord("profile",e,t);return n}async getProfileImage(e,t={}){const{records:n,status:i}=await this.queryProtocolRecords("profile",e,t);return n[0]}async readProfileImage(e,t={}){await this.ready;const n=t.from=t.from||this.did;if(!t.skipCache){const o=Va.getCache(n,e);if(o)return o}const i=await this.getProfileImage(e,t);if(i){const o=await Ps.drl.fromRecord(i,!0);i.cache={uri:o},Va.setCache(n,e,i)}return i}async setProfileImage(e,t,n,i=this.did){let o=n||await this.getProfileImage(e,{from:i}),s=t?new Blob([t],{type:t.type}):void 0;try{if(s){o?await o.update({data:s}):o=await this.createProfileImage(e,{data:s,from:i});const{status:a}=await o.send(i)}else o&&(s=await o.data.blob())}catch(a){console.log(a)}return o&&(o.cache=o.cache||{},o.cache.blob=s,o.cache.uri=s?URL.createObjectURL(s):void 0),o}async createCareer(e={}){const{record:t,status:n}=await this.createProtocolRecord("profile","career",{published:!0,data:e.data,dataFormat:"application/json"});return e.cache!==!1&&await ja(t),t}async getCareer(e={}){await this.ready;const t=e.from||this.did;if(t!==this.did){const s=Va.getCache(t,"career");if(s)return s}const{records:n,status:i}=await this.queryProtocolRecords("profile","career",e),o=n[0];if(o)return e.cache!==!1&&await ja(o),Va.setCache(t,"career",o),o}async createStory(e={}){const{record:t,status:n}=await this.createProtocolRecord("social","story",{published:!1,data:e.data||{},dataFormat:"application/json"});return e.cache!==!1&&await ja(t),t}async deleteStory(e){const t=await this.dwn.records.delete({message:{recordId:e}});if(t.status>399)throw"Delete failed";return t}async readStory(e,t={}){const{record:n,status:i}=await this.readProtocolRecord(e,t);if(i.code>399){const o=new Error(i.detail);throw o.code=i.code,o.detail=i.detail,o}return t.cache!==!1&&await ja(n),n}async queryStories(e={}){const t=await this.queryProtocolRecords("social","story",e);return e.cache!==!1&&await ja(t.records),t}async createStoryMedia(e,t={}){t.data&&(t.dataFormat=t.data.type,t.data instanceof File&&(t.data=new Blob([t.data],{type:t.dataFormat}))),t.published=!0,t.parentContextId=e.id;const{record:n,status:i}=await this.createProtocolRecord("social","story/media",t);return n}async readStoryMedia(e,t={}){const{record:n,status:i}=await this.readProtocolRecord(e,t);if(i.code>399){const o=new Error(i.detail);throw o.code=i.code,o.detail=i.detail,o}if(t.cache!==!1){const o=await Ps.drl.fromRecord(n,!0);n.cache={uri:o}}return n}async setStoryHero(e,t={}){t.data&&(t.dataFormat=t.data.type,t.data instanceof File&&(t.data=new Blob([t.data],{type:t.dataFormat}))),t.published=!0;let n=e._hero,i=e.cache.json;const o=i.hero;n||o?(n||(n=(await this.queryProtocolRecords("social","story/media",{recordId:o})).records[0]),await n.update({data:t.data}),n.send(e.author)):(t.parentContextId=e.id,n=(await this.createProtocolRecord("social","story/media",t)).record);const s=await Ps.drl.fromRecord(n,!0);return n.cache={uri:s},o!==n.id&&(i.hero=n.id,console.log(i),await e.update({data:i}),e.send(e.author)),e._hero=n}async queryThreads(e={}){const t=await this.queryProtocolRecords("social","thread",e);return e.cache!==!1&&await ja(t.records),t}queryFollows=(e={})=>this.queryProtocolRecords("social","follow",e);async getFollows(e,t={}){return e&&(t.pagination=t.pagination||{},t.pagination.cursor=e),this.queryProtocolRecords("social","follow",t)}async toggleFollow(e,t){var{records:n,status:i}=await this.queryFollows({recipient:e}),o=n[0];if(o){if(o?.isDeleted)o.update();else if(!t){var{status:i}=await this.dwn.records.delete({message:{recordId:o.id}});return!1}}else{const s=await this.getAggregators({from:e});var{record:o}=await this.createProtocolRecord("social","follow",{recipient:e,data:{aggregators:s?.cache?.json?.aggregators||[],lastAggregatorFetch:s?.dateModified||null}})}return o}async sendInvite(e,t,n={}){if(!n.skipCheck){let a=await this.getActiveInvite(t,{recipient:e});if(a)return a}const{record:i,status:o}=await this.createProtocolRecord("social","invite",Object.assign({recipient:e,store:!1,dataFormat:"application/json",data:{link:t}},n));console.log("invite ",i),n.cache!==!1&&await ja(i);const{status:s}=await i.send(e);if(s.code===202){console.log(i);const a=await i.store();return console.log(a),i}}}async function UU(r){const e={},t=[];return r=r||await fn.identity.list(),await Promise.all(r.map(async n=>{if(e[n.did.uri]=n,n.web5)return;const i=n.web5=await fn.use(n),o=n.datastore=new Va(i);t.push(o.readRecordPath("profile","connect").then(async s=>{if(s){const a=s.cache.json||{},l=a?.webWallets||(a.webWallets=[]);l.find(d=>new URL(d).origin===location.origin)||(l.push(location.origin),await s.update({data:a,published:!0}),navigator.onLine&&await s.send())}else s=await o.putRecordPath("profile","connect",{webWallets:[location.origin]},{published:!0});n.connectRecord=s}).catch(s=>console.error(s)))})),Promise.allSettled(t).then(()=>zu.updateState("identities")).catch(n=>console.error(n)),e}let zu;const P5e=r=>class extends r.with(Ju){static properties={ready:{store:"page"},identities:{store:"page"},avatars:{store:"page"}};constructor(){if(super(),zu)throw"$App is a singleton and an instance already exists.";globalThis.App=zu=this;let e;this.ready=new Promise(t=>e=t),UU().then(t=>{this.identities=t,this.ready.state=!0,e(!0)})}async updateState(e,t,n){const i=this[e];return t=t===void 0?i:t,Array.isArray(t)?this[e]=n&&t!==i?[...i||[],...t||[]]:{...t}:typeof t=="object"&&t?this[e]=n&&t!==i?{...i||{},...t||{}}:{...t}:this[e]=t,this[e]}async updateProfileImage(e,t,n){const i=await e.datastore.putRecordPath("profile",t,n,{published:!0});return e[t]=i.drl+"?cache-updated="+new Date().getTime(),this.updateState("identities"),i}async addIdentities(e){const t=await UU(Array.isArray(e)?e:[e]);return this.identities={...this.identities,...t}}async saveIdentityLabel(e,t){const n=e.connectRecord;if(!n){console.log("No connect record found for identity: ",e);return}const i=n.cache.json;i.label=t,await n.update({data:i,published:!0}),navigator.onLine&&await n.send(),await fn.identity.addAutofillDid(t+"@"+e.did.uri),this.updateState("identities")}},dm=Ye`

:host-context(html.sl-scroll-lock) [lock-on-scroll] {
  z-index: 0 !important;
} 

:host([page]) > * {
  margin: 0 auto;
}

:host([route-state="active"]) {
  z-index: 1;
}

:host([route-state="active"]) > section {
  opacity: 1;
}

[page-section] {
  box-sizing: border-box;
  width: 100%;
  max-width: var(--content-max-width);
}

h2,h3,h4,h5,h6 {
  font-family: var(--app-font);
  font-weight: normal;
}

ul, ol {
  margin: 0;
  padding: 0;
}

.markdown-body *:is(ul, ol) {
  padding: 0.25em 1.2em;
}

form input,
form textarea,
form sl-input::part(input),
form sl-textarea::part(textarea) {
  transition: color 0.5s ease;
}

form[loading] input,
form[loading] textarea,
form[loading] sl-input::part(input),
form[loading] sl-textarea::part(textarea) {
  color: transparent;
}

::part(form-control-help-text) {
  font-size: 0.75em;
}

/* sl-input, sl-textarea, vaadin-combo-box {
  margin: 0 0 1em;
} */

sl-icon::part(svg) {
  width: 1em;
  height: 1em;
}

sl-button::part(base) {
  align-items: center;
}

sl-button:not([circle]) sl-icon { 
  font-size: 1rem;
  padding: 0.4rem 0;
}

sl-dialog::part(panel) {
  width: calc(100% - 1rem);
  max-width: 600px;
}

sl-dialog[fit-content]::part(panel) {
  width: -moz-fit-content;
  width: fit-content;
  height: fit-content;
}

sl-dialog::part(header) {
  border-bottom: 1px solid rgb(255 255 255 / 2%);
  box-shadow: 0 1px 1px 1px rgba(0, 0, 0, 0.15);
}

sl-dialog::part(header-actions) {
  padding: 0 1rem;
}

sl-dialog::part(title) {
  padding: 1rem 1.2rem;
}

sl-dialog[tabbed]:has(sl-tab-group)::part(body) {
  padding: 0;
}

sl-dialog[tabbed] sl-tab-panel::part(base) {
  padding: 1rem 1rem 1.5rem;
}

sl-dialog::part(footer) {
  border-top: 1px solid rgba(255 255 255 / 5%);
  box-shadow: 0 -1px 1px 0px rgba(0 0 0 / 15%);
}

sl-tab-group::part(tabs) {
  border-bottom: 1px solid var(--track-color);
}

*::part(input-field) {
  background: var(--sl-input-background-color);
  border: solid var(--sl-input-border-width) var(--sl-input-border-color);
}

*::part(form-control-label) {
  margin: 0 0 0.4em;
  font-size: var(--sl-input-label-font-size-medium)
}

[pressable] * {
  pointer-events: none;
}

[flex] {
  display: flex;
}

[flex~="inline"] {
  display: inline-flex;
}

[flex~="column"] {
  flex-direction: column;
}

[flex~="end"] {
  align-items: end;
}

[flex~="column"][flex~="end"],
[flex~="column-reverse"][flex~="end"] {
  justify-content: flex-end;
}

[flex~="column-reverse"] {
  flex-direction: column-reverse;
}

[flex~="wrap"] {
  flex-wrap: wrap;
}

[flex~="shrink"] {
  flex: 0;
}

[flex~="fill"] {
  flex: 1;
}

[flex~="align-start"] {
  align-items: start;
}

[flex~="center-x"]:not([flex~="column"]) {
  justify-content: center;
}

[flex~="center-x"][flex~="column"] {
  align-items: center;
}

[flex~="center-y"]:not([flex~="column"]) {
  align-items: center;
}

[flex~="center-y"][flex~="column"] {
  justify-content: center;
}

[flex~="gap-small"] > * {
  margin: 0 0.5em 0.5em 0;
}

[flex~="gap-medium"] > * {
  margin: 0 1em 1em 0;
}

[flex~="gap-large"] > * {
  margin: 0 2em 2em 0;
}

[default-content] {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

[default-content~="cover"] {
  position: absolute;
  inset: 0;
  z-index: 1000;
}

[default-content~="placeholder"] > :is(svg, sl-icon) {
  display: block;
  margin: 1rem auto 1.75rem;
  font-size: 9em;
  max-width: 300px;
  height: auto;
  color: var(--header-bk);
  transition: opacity 0.3s ease, visibility 0.3s;
}

[default-content~="firstrun"] > :is(svg, sl-icon) {
  display: block;
  margin: 4rem auto;
  font-size: 50vh;
  width: 100%;
  max-width: 800px;
  height: auto;
  color: var(--header-bk);
}

[default-content~="clickable"] {
  cursor: pointer;
}

[default-content~="clickable"] {
  transition: background-color 0.25s ease;
}

[default-content~="clickable"]:hover {
  background-color: rgba(255 255 255 / 0.075)
}

.text-logo {
  font-family: var(--app-font);
}

[break-text] {
  display: block;
  position: relative;
  width: 100%;
  margin: 1.5em 0;
  box-sizing: border-box;
  text-align: center;
}

[break-text]::before {
  content: "";
  display: block;
  position: absolute;
  width: 100%;
  height: 0px;
  top: 50%;
  transform: translateY(-50%);
  border-top: 1px solid rgba(255,255,255,0.1);
  border-bottom: 1px solid rgba(0,0,0,0.1);
}

[break-text]::after {
  content: attr(break-text);
  position: relative;
  top: -0.15em;
  padding: 0 0.5em;
  background: inherit;
}

[empty-text]:empty::before, [empty-text][empty]::before {
  content: attr(empty-text);
  display: block;
  width: 100%;
  font-size: 85%;
  color: rgba(255,255,255,0.5);
  font-style: italic;
}

[columns~="2"] {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 1rem;  /* Adjusts spacing between rows and columns */
  align-items: center;
}

[columns~="2"] > *:nth-child(2n + 1) {
  font-family: var(--app-font);
}

[columns~="2"][columns~="labels-right"] > *:nth-child(2n + 1) {
  text-align: right;
}

[ellipsis] {
  width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.shadow-icon {
  filter: drop-shadow(0px 1px 1px rgba(0 0 0 / 50%));
}

/* sl-icon-button:hover:not(.icon-button--disabled)::part(base), .icon-button:focus-visible:not(.icon-button--disabled)::part(base) {
  color: currentColor;
  filter: drop-shadow(0px 1px 2px rgba(0 0 0 / 35%));
} */


.page-dialog::part(panel) {
  max-height: calc(100% - var(--header-height) - var(--sl-spacing-2x-large));
  margin-top: var(--header-height);
}

.hero[src] {
  background: none;
}

.hero::part(fallback) {
  display: none;
}

.hero sl-icon-button {
  position: absolute;
  top: 1em;
  right: 1em;
  background: rgba(0 0 0 / 0.6);
  border-radius: 100%;
  cursor: pointer;
  z-index: 3;
} 

#view_header {
  position: sticky;
  top: 0;
  max-width: none;
  padding: 1.1em 1.2em 1em;
  background: rgba(44 44 49 / 90%);
  border-bottom: 1px solid rgba(0 0 0 / 50%);
  z-index: 1;
}

@media(max-width: 500px) {

  .page-dialog::part(panel) {
    width: 100%;
    height: calc(100% - var(--header-height));
    max-width: none;
    max-height: none;
    margin-top: var(--header-height);
    box-shadow: none;
    border-radius: none;
  }
}

`;class I5e extends hi.with(Ju,wd,f1){static properties={identities:{store:"page"}};static query={selectDidInput:["#select_did_input",!0]};constructor(){super()}firstUpdated(){fn.connect.attachInput(this.selectDidInput,{permissions:[{protocolDefinition:Hy.definition,permissionScopes:["Query","Read","Subscribe","Write","Delete","Query:Protocols","Query:Messages","Read:Messages","Subscribe:Messages"].map(e=>(e=e.split(":"),{protocol:Hy.uri,interface:e[1]||"Records",method:e[0]}))}],onConnect:async(e,t)=>{console.log(e,t)},onError:e=>{console.log(e)},onProgress:e=>{console.log(e)}})}render(){return this.connected?Ie`
      <div>connected</div>
    `:Ie`
      <section flex="column center-x center-y">
        <sl-button variant="default" size="large" @click="${async e=>{e.target.loading=!0;const t=await fn.identity.create({});zu.addIdentities(t),e.target.loading=!1,router.navigateTo(`/profiles/${t.did.uri}`)}}">
          <sl-icon slot="prefix" name="person-plus"></sl-icon>
          Create a new identity
        </sl-button>
        <div break-text="OR"></div>
        <div>
          <input id="select_did_input" name="email" type="email" label="Select a DID" placeholder="social@did:dht:..." autocomplete="on" />
        </div>
        <sl-button variant="default" size="large" @click="${e=>{}}">
          <sl-icon slot="prefix" name="wallet2"></sl-icon>
          Connect via Wallet
        </sl-button>
        <sl-button variant="default" size="large" @click="${e=>zu.restoreIdentityModal.show()}">
          <sl-icon slot="prefix" name="upload"></sl-icon>
          Restore from File
        </sl-button>
        <!-- <sl-button variant="default" size="large" @click="${e=>{}}">
          <sl-icon slot="prefix" name="key-fill"></sl-icon>
          Enter as Password
        </sl-button> -->
      </section>
    `}static styles=[dm,dT,Ye`
      :host {
        display: flex;
        justify-content: center;
      }

      sl-button {
        width: 100%;
      }

      sl-button + sl-button {
        margin: 1rem 0 0;
      }

      @media(max-width: 800px) {

      }
    `]}customElements.define("connect-widget",I5e);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const LU=new WeakMap,KU=r=>{if((t=>t.pattern!==void 0)(r))return r.pattern;let e=LU.get(r);return e===void 0&&LU.set(r,e=new URLPattern({pathname:r.path})),e};let O5e=class{constructor(e,t,n){this.routes=[],this.o=[],this.t={},this.i=i=>{if(i.routes===this)return;const o=i.routes;this.o.push(o),o.h=this,i.stopImmediatePropagation(),i.onDisconnect=()=>{this.o?.splice(this.o.indexOf(o)>>>0,1)};const s=zU(this.t);s!==void 0&&o.goto(s)},(this.l=e).addController(this),this.routes=[...t],this.fallback=n?.fallback}link(e){if(e?.startsWith("/"))return e;if(e?.startsWith("."))throw Error("Not implemented");return e??=this.u,(this.h?.link()??"")+e}async goto(e){let t;if(this.routes.length===0&&this.fallback===void 0)t=e,this.u="",this.t={0:t};else{const n=this.p(e);if(n===void 0)throw Error("No route found for "+e);const i=KU(n).exec({pathname:e}),o=i?.pathname.groups??{};if(t=zU(o),typeof n.enter=="function"&&await n.enter(o)===!1)return;this.v=n,this.t=o,this.u=t===void 0?e:e.substring(0,e.length-t.length)}if(t!==void 0)for(const n of this.o)n.goto(t);this.l.requestUpdate()}outlet(){return this.v?.render?.(this.t)}get params(){return this.t}p(e){const t=this.routes.find(n=>KU(n).test({pathname:e}));return t||this.fallback===void 0?t:this.fallback?{...this.fallback,path:"/*"}:void 0}hostConnected(){this.l.addEventListener(n_.eventName,this.i);const e=new n_(this);this.l.dispatchEvent(e),this._=e.onDisconnect}hostDisconnected(){this._?.(),this.h=void 0}};const zU=r=>{let e;for(const t of Object.keys(r))/\d+/.test(t)&&(e===void 0||t>e)&&(e=t);return e&&r[e]};class n_ extends Event{constructor(e){super(n_.eventName,{bubbles:!0,composed:!0,cancelable:!1}),this.routes=e}}n_.eventName="lit-routes-connected";/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const C5e=location.origin||location.protocol+"//"+location.host;class R5e extends O5e{constructor(){super(...arguments),this.m=e=>{const t=e.button!==0||e.metaKey||e.ctrlKey||e.shiftKey;if(e.defaultPrevented||t)return;const n=e.composedPath().find(s=>s.tagName==="A");if(n===void 0||n.target!==""||n.hasAttribute("download")||n.getAttribute("rel")==="external")return;const i=n.href;if(i===""||i.startsWith("mailto:"))return;const o=window.location;n.origin===C5e&&(e.preventDefault(),i!==o.href&&(window.history.pushState({},"",i),this.goto(n.pathname)))},this.R=e=>{this.goto(window.location.pathname)}}hostConnected(){super.hostConnected(),window.addEventListener("click",this.m),window.addEventListener("popstate",this.R),this.goto(window.location.pathname)}hostDisconnected(){super.hostDisconnected(),window.removeEventListener("click",this.m),window.removeEventListener("popstate",this.R)}}class D5e extends R5e{constructor(e,t){const n=t.routes;super(e,n.map((i,o,s)=>{const a=i.component;return typeof a=="string"&&(i.component=()=>e.renderRoot.querySelector(a)),i.enter=async l=>{this.activeComponent?.removeAttribute?.("route-state"),await Promise.all([t?.onRouteChange?.(i,l),this.activeComponent?.onRouteLeave?.(i,l),i?.onEnter?.(l)]),this.activeComponent=await i.component?.(i,l,!0),this.activeComponent?.setAttribute?.("route-state","active"),this.activeComponent?.onRouteEnter?.(i,l),i?.render?.call(this,l)},i}))}navigateTo=(e,t={})=>{history.pushState(t,t.title||"",e),this.goto(e)};replaceState=(e,t={})=>{history.replaceState(t,t.title||"",e)}}class M5e extends hi.with(Ju,f1,wd){static properties={identities:{store:"page"},origin:{type:String},permissions:{type:Object}};static query={acceptButton:["#accept_button"]};constructor(){super(),this.profileProtocolUri=encodeURIComponent(Hy.uri)}firstUpdated(){fn.connect.onAuthorizationRequest=async(e,t,n)=>(this.origin=e,this.did=t,this.permissions=n,new Promise(async(i,o)=>{this.#t=i,this.#i=o})),fn.connect.onAuthorizationComplete=()=>{this.acceptButton.loading=!1}}#t;allow(){this.acceptButton.loading=!0,this.#t({authorize:!0})}#i;deny(){this.#i({authorize:!1})}render(){const e=this.identities?.[this.did],t=e?.connectRecord?.cache?.json?.label;return this.did?Ie`
      <section flex="center-y column">
        <div id="requestor" flex="center-x center-y" ellipsis>
          <img src="https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${this.origin}&size=128"/>
          ${new URL(this.origin).host||this.origin}
        </div>
        <div>is requesting permissions for this identity:</div>
        <div id="identity" ellipsis>
          <sl-avatar image="${e?.avatar||`https://dweb/${this.did}/read/protocols/${this.profileProtocolUri}/avatar`}" shape="circle" size="small"></sl-avatar>
          ${(t?t+"@":"")+this.did}
        </div>
        ${this.permissions.reduce((n,i)=>{let o,s={};const a=[];return n.push(Ie`<h4 ellipsis>${i.protocolDefinition.protocol}</h4>`),i.permissionScopes.forEach(l=>{l.interface==="Records"?a.push(Ie`<strong>${l.method.toLowerCase()}</strong>`):l.interface==="Messages"?s[l.method]=!0:l.interface==="Protocols"&&l.method==="Configure"&&(o=!0)}),s=s.Query&&s.Read&&s.Subscribe?Ie`<strong>sync</strong>`:"",n.push(Ie`<ul class="permission-list">${[o?Ie`<li>Modify how this protocol works</li>`:Ot,a.length||s?Ie`<li>${a}${s} data</li>`:Ot]}</ul>`),n},[])}
        <div id="user_actions" flex="center-x center-y">
          <sl-button id="accept_button" variant="success" @click="${this.allow}">Accept</sl-button>
          <sl-button id="deny_button" variant="primary" @click="${this.deny}">Deny</sl-button>
        </div>
      </section>`:Ot}static styles=[dm,Ye`

      :host {
        padding: 0 !important;
      }

      :host > section {
        box-sizing: border-box;
        padding: 1rem 1.25rem;
      }

      :host > section > div {
        box-sizing: border-box;
        margin: 1rem 0;
        text-align: center;
      }

      #requestor, #identity {
        padding: 1rem;
        background: rgb(0 0 0 / 70%);
        border-radius: 10rem;
        border: 1px solid rgb(255 255 255 / 0.2);
      }

      #requestor {
        font-size: 1.5rem;
      }

      #requestor img, sl-avatar {
        --size: 2rem;
        height: var(--size);
        margin: 0 1rem 0 0;
      }

      .permission-list {
        padding: 0 0 0 2rem;
      }

      .permission-list strong:first-child {
        text-transform: capitalize;
      }
      .permission-list strong::before {
        content: ", ";
        font-weight: normal;
      }
      .permission-list strong:first-child::before {
        display: none;
      }
      .permission-list strong:last-child::before {
        content: ", and ";
      }

      #user_actions {
        margin: 2rem 0 0;
      }

      #user_actions sl-button {
        flex: 1;
        margin: 0 1rem;
      }

      @media(max-width: 800px) {

      }
    `]}customElements.define("connect-page",M5e);function B5e(r){return r.split("").map(e=>e.charCodeAt(0).toString(16)).join("").substring(0,64)}function FU(r,e,t){t/=100;const n=e*Math.min(t,1-t)/100,i=o=>{const s=(o+r/30)%12,a=t-n*Math.max(Math.min(s-3,9-s,1),-1);return Math.round(255*a).toString(16).padStart(2,"0")};return`#${i(0)}${i(8)}${i(4)}`}function qU(r,e=0){const t=(parseInt(r.substr(0,2),16)+e)%360,n=70+parseInt(r.substr(2,2),16)%31,i=40+parseInt(r.substr(4,2),16)%21;return{hue:t,saturation:n,lightness:i}}function j5e(r){const e=B5e(r).substring(0,64),t=qU(e.substring(0,6));let n=FU(t.hue,t.saturation,t.lightness),o=qU(e.substring(6,12),150),s=FU(o.hue,o.saturation,o.lightness);return`linear-gradient(${parseInt(e.substring(12,16),16)%360}deg, ${n}, ${s})`}const N5e={x:{profileUrl:"https://twitter.com/",icon:"twitter"},linkedin:{profileUrl:"https://www.linkedin.com/in/"},github:{profileUrl:"https://github.com/"},cash:{profileUrl:"https://cash.app/$",icon:"cash-app"}},jl={info(r,e={}){const t=Object.assign(document.createElement("sl-alert"),{variant:"primary",duration:3e3,closable:!0,innerHTML:`
        <sl-icon name="${e.icon||"info-circle"}" slot="icon"></sl-icon>
        ${document.createTextNode(r).textContent}
      `},e);return document.body.appendChild(t).toast()},success(r,e={}){jl.info(r,Object.assign({variant:"success"},e))},warning(r,e={}){jl.info(r,Object.assign({variant:"warning"},e))},error(r,e={}){jl.info(r,Object.assign({variant:"danger"},e))}};class U5e extends hi.with(wd){static styles=[Ye`

      :host {
        --size: 6rem;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        width: var(--size);
        height: var(--size);
        flex-shrink: 0;
      }

      #image {
        display: block;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        border: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        filter: drop-shadow(0px 1px 1px rgba(0, 0, 0, 1));
        z-index: 2;
      }

      #image[loaded] {
        opacity: 1;
      }

      [part="fallback"] {
        position: absolute;
        top: 50%;
        left: 50%;
        width: auto;
        margin: 0;
        padding: 0;
        font-size: 3rem;
        z-index: 1;
        transform: translate(-50%, -50%);
        transition: opacity 0.3s ease;
      }

      :host([loaded]) [part="fallback"] {
        opacity: 0;
      }
    `];static properties={src:{type:String,reflect:!0},fallback:{type:String}};static query={image:"#image"};updated(e){e.has("src")&&(this.removeAttribute("loaded"),this.image&&(this.image.removeAttribute("loaded"),this.image.src=this.src))}loaded(){this.setAttribute("loaded",""),this?.image.setAttribute("loaded","")}constructor(){super()}render(){return Ie`
      <img id="image" part="image" src="${ft(this.src)}" @load="${e=>this.loaded()}" @error="${e=>DOM.fireEvent(this,"error",{detail:{originalTarget:this}})}"/>
      ${this?.fallback?.match(/^[a-zA-Z0-9]+:/)?Ie`<img part="fallback" src="${this.fallback}">`:Ie`<sl-icon part="fallback" name="${this.fallback||"image"}"></sl-icon>`}
      <slot></slot>
    `}}customElements.define("w5-img",U5e);class L5e extends hi.with(wd){static styles=[Ye`
      :host {
        display: block;
        max-height: 10em;
        transition: max-height 0.3s ease;
        overflow: hidden;
      }

      #content {
        box-sizing: border-box;
        overflow: hidden;
      }

      #content:has(slot:not(:empty)) {
        padding: 0 0 2.5em;
      }

      #toggle {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: absolute;
        bottom: 0;
        width: 100%;
        font-size: 80%;
        text-align: center;
        overflow: hidden;
        cursor: pointer;
      }

        :host(:not([overflow])) #toggle {
          display: none;
        }

      #toggle::before {
        content: " See More";
        margin: 0.75em 0;
        padding: 0.25em 0.4em 0.35em 0.4em;
        border-radius: 3px;
        background: #000;
        box-shadow: 0 1px 3px 1px rgba(0 0 0 / 75%);
        border: 1px solid rgba(255 255 255 / 25%);
      }

        #toggle:hover::before {
          border-color: rgba(255 255 255 / 50%);
        }

        :host([open]) #toggle::before {
          content: " Close"
        }

      #toggle::after {
        content: "";
        display: block;
        position: absolute;
        bottom: -1em;
        height: 1em;
        width: calc(100% - 3em);
        border-radius: 100%;
        box-shadow: 0 0 1.5em 1em rgba(0 0 0 / 50%);
      }

        :host([open]) #toggle::after {
          opacity: 0.25;
        }
    `];static properties={open:{type:Boolean,reflect:!0},hideToggle:{type:Boolean,attribute:"hide-toggle"}};static query={content:["#content",!0]};firstUpdated(){Su.addEventDelegate("click","[detail-box-toggle]",t=>{this.toggle()},{container:this}),this.addEventListener("transitionend",t=>{t.target===this&&t.propertyName==="max-height"&&(this.style.maxHeight=this.open?"none":null)}),new ResizeObserver(()=>this.#t()).observe(this.content),this.#t()}#t(){this.content.scrollHeight>this.offsetHeight?this.setAttribute("overflow",""):this.open||this.removeAttribute("overflow")}updated(e){if(e.has("open")){const t=this.content.scrollHeight;this.open?this.offsetHeight<t&&(this.style.maxHeight=t+"px"):(this.style.maxHeight=t+"px",this.scrollHeight,this.style.removeProperty("max-height"))}super.updated(e)}toggle(){this.open=!this.open}render(){return Ie`
      <section id="content" part="content"><slot></slot></section>
      ${this.hideToggle?"":Ie`<div id="toggle" part="toggle" detail-box-toggle></div>`}
    `}}customElements.define("detail-box",L5e);async function K5e(r){return await datastore.getCommunity(r.path.community,{from:r.did,role:"community/member"})}class z5e extends hi.with(Ju,wd,f1){static styles=[dT,Ye`

      :host {
        position: relative;
        display: flex;
        max-width: 600px;
        border-radius: 0.2em;
        overflow: hidden;
        cursor: default;
      }

        :host * {
          transition: opacity 0.3s ease;
        }

      w5-img {
        margin: 0 1rem 0 0;
        border: 2px solid rgba(200, 200, 230, 0.5);
        border-radius: 0.2rem;
      }

      #content {
        flex: 1;
        position: relative;
        margin: 0 1em 0 0;
      }

      h3 {
        margin: -0.1em 0 0;
        font-size: 110%;
        text-wrap: nowrap;
      }

      p {
        margin: 0.3em 0 0;
      }

      #empty_text, #error_text {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        inset: 0;
        opacity: 0;
        z-index: 1000;
        pointer-events: none;
      }

      #empty_text:before,
      #error_text:before {
        content: attr(data-value);
      }

      :host(:not([drl])) *:not(#empty_text),
      :host([error]) *:not(#error_text),
      :host([loading]) *:not(.spinner-mixin) {
        opacity: 0;
        pointer-events: none;
      }

      :host(:not([drl])) #empty_text,
      :host([error]) #error_text {
        opacity: 1;
        pointer-events: all;
      }

      .spinner-mixin {
        font-size: 1.5rem;
      }

    `];static properties={loading:{type:Boolean,reflect:!0},drl:{type:String,reflect:!0},invite:{type:Object,attribute:!1},error:{type:Boolean,reflect:!0},errorText:{attribute:"error-text",type:String,reflect:!0},emptyText:{attribute:"empty-text",type:String,reflect:!0}};static query={installButton:"#install_button"};willUpdate(e){e.has("invite")&&this.invite&&(this.drl=Ps.drl.parse(this.invite.cache.json.link,"/:did/protocols/:protocol/communities/:community"),this.loadInvite())}async loadInvite(){this.error=!1,this.loading=!0,this.startSpinner();const e=this.drl;try{const t=await K5e(e);this.drl===e&&(this.community=t,this.requestUpdate())}catch{this.error=!0}this.loading=!1,this.stopSpinner()}async installCommunity(){if(this.community){this.installButton.loading=!0;try{await this.context.instance.installCommunity(this.community.id,this.drl.did,this.community),await this.invite.update({data:this.invite.cache.json}),await this.invite.send(this.context.did)}catch(e){console.log(e)}this.installButton.loading=!1}}render(){const e=this.community?.cache?.json||{};return Ie`
      <w5-img part="image" src="${ft(this.avatarDataUri)}" fallback="people"></w5-img>
      <div id="content">
        <h3 part="name">${e.name||"Unknown Community"}</h3>
        ${e.description?Ie`<p>${this.description}</p>`:Ot}
      </div>
      <sl-button id="install_button" variant="default" size="small" @click="${t=>this.installCommunity(t)}">
        <sl-icon slot="prefix" name="plus"></sl-icon>
        Add Community
      </sl-button>
      <div id="empty_text" data-value="${this.emptyText||""}"></div>
      <div id="error_text" data-value="${this.error&&this.errorText||"Couldn't find anything for that"}"></div>
    `}}customElements.define("invite-item",z5e);class w6 extends hi.with(Ju,wd){static query={heroImage:["#hero",!0],tabs:["#tabs",!0],profileForm:["#profile_form",!0],jobModal:["#job_modal",!0],jobForm:["#job_form",!0],qrModal:["#qr_modal",!0],qrCode:["#qr_code",!0],payModal:["#pay_modal",!0],heroInput:["#hero_input",!0],avatarInput:["#avatar_input",!0],profileEditModal:["#profile_edit_modal",!0]};static properties={ready:{type:Boolean,store:"page"},identities:{store:"page"},job:{type:Object},avatar:{type:String},hero:{type:Object},socialData:{type:Object},careerData:{type:Object},did:{type:String,reflect:!0},owner:{type:Boolean,reflect:!0},social:{type:Object},career:{type:Object},loading:{type:Boolean,reflect:!0},loadingError:{type:Boolean,attribute:"loading-error",reflect:!0},loaded:{type:Boolean,reflect:!0},panel:{type:String,reflect:!0}};static paymentTypes={cashtag:{icon:"cash-app",color:"#00c853",newTab:!0,normalize:(e,t)=>(e=e.replace(/^(?!\$)/,"$"),t?`https://cash.app/${e}`:e)},ln_address:{icon:"lightning-charge",color:"#cac55c",normalize:(e,t)=>t?`lightning:${e}`:e},btc_address:{icon:"currency-bitcoin",color:"#f18f19",normalize:(e,t)=>t?`bitcoin:${e}`:e},dap:{icon:"dap-white",color:"#37b4fc",normalize:(e,t)=>t?null:e.replace(/^(?!\@)/,"@")}};constructor(){super(),this.profileProtocolEncoded=encodeURIComponent(Hy.uri),this.clearData()}clearData(){this.social={},this.career={},this.socialData={displayName:"",bio:"",apps:{},payment:{}},this.careerData={jobs:[],skills:[],education:[]}}willUpdate(e){e.has("panel")&&this?.tabs?.show?.(this.panel||"profile"),e.has("did")&&this.did&&this.loadProfile(this.did)}async loadProfile(e){this.loaded=!1,this.loading=!0;try{await this.ready,this.owner=this.identities[e],this.datastore=this.owner?.datastore||Object.values(this.identities)[0]?.datastore,this.clearData(),this.heroImage.style.setProperty("--deterministic-background",j5e(e.split(":")[2]));const t=await Promise.all([this.datastore.getSocial({from:this.owner?void 0:e}),this.datastore.getCareer({from:this.owner?void 0:e})]);this.avatar=`https://dweb/${this.did}/read/protocols/${this.profileProtocolEncoded}/avatar`,this.hero=`https://dweb/${this.did}/read/protocols/${this.profileProtocolEncoded}/hero`,this.social=t[0],this.career=t[1],this.socialData=this.social?.cache?.json||this.socialData,this.careerData=this.career?.cache?.json||this.careerData,this.loadingError=!1,this.loaded=!0,Su.fireEvent(this,"profile-view-load-success")}catch{this.loadingError=!0,Su.fireEvent(this,"profile-view-load-error")}this.loading=!1,Su.fireEvent(this,"profile-view-load-complete")}async handleFileChange(e,t){await this.ready,await zu.updateProfileImage(this.owner,e,t.files[0]),this[e]=this.owner[e]}async saveSocialInfo(e){console.log(this.social);const t=new FormData(this.profileForm);for(const i of t.entries())Ps.deepSet(this.socialData,i[0],i[1]||void 0);try{await this.ready,this.social?await this.social.update({data:this.socialData}):this.social=await this.datastore.createSocial({data:this.socialData});var{status:n}=await this.social.send(this.did);jl.success("Your profile info was saved")}catch(i){console.log(i),jl.error("There was a problem saving your profile info")}this.requestUpdate()}showJobModal(e){this.job=e?typeof e=="string"?this.careerData.jobs.find(t=>t.id===e):e:{id:Ps.randomString(32)},this.jobModal.show()}async saveJob(e=!1){if(!this.jobForm.checkValidity()){jl.error("You haven't filled out all the required fields");return}const t=new FormData(this.jobForm);for(const i of t.entries())Ps.deepSet(this.job,i[0],i[1]?.trim?i[1].trim():i[1]||void 0);try{this.careerData.jobs.includes(this.job)||this.careerData.jobs.push(this.job),await this.ready,this.career?await this.career.update({data:this.careerData}):this.career=await this.datastore.createCareer({data:this.careerData});var{status:n}=await this.career.send(this.did);jl.success("Job info saved"),e&&this.jobModal.hide()}catch(i){console.log(i),jl.error("There was a problem saving this job info")}this.requestUpdate()}onTabShow(e){this.panel=e.detail.name,this.panel}showQrModal(e,t){this.qrModal.label=e,this.qrCode.value=t,this.qrModal.show()}render(){const e=new Date,t=e.getTime();let n={startTime:t,endTime:0};const i=this?.careerData?.jobs?.reduce((o,s)=>{const a=s?.employer?.trim().toLowerCase()||"";return(o[a]=o[a]||[]).push(s),s.startTime=new Date(s.start_date).getTime(),s.endTime=s.end_date?new Date(s.end_date).getTime():t,(s.endTime>n.endTime||s.endTime===n.endTime&&s.startTime<=n.startTime)&&(n=s),o},{});return Ie`

      <section id="profile_card" flex="column fill">

        <w5-img id="hero" src="${this.hero}">
          <sl-icon-button class="edit-button" name="pencil" size="medium" @click="${o=>this.heroInput.click()}"></sl-icon-button>
          <input id="hero_input" type="file" accept="image/png, image/jpeg, image/gif" style="display: none" @change="${o=>this.handleFileChange("hero",this.heroInput)}" />
        </w5-img>

        <div id="basic_info">
          <div id="avatar_wrapper" flex="end">
            <w5-img id="avatar" src="${this.avatar}" fallback="${this.owner?"person-fill-add":"person-fill"}" @click="${o=>this.avatarInput.click()}">
              <input id="avatar_input" type="file" accept="image/png, image/jpeg, image/gif" style="display: none" @change="${o=>this.handleFileChange("avatar",this.avatarInput)}" />
            </w5-img>
            ${Object.keys(this.socialData?.payment||{}).length?Ie`
              <sl-button class="pay-button" size="small" @click="${o=>this.payModal.show()}">
                $ Pay
              </sl-button>`:Ot}
            ${this.owner?Ie`
              <sl-button class="edit-button" size="small" @click="${o=>this.profileEditModal.show()}">
                Edit profile
              </sl-button>`:Ot}
          </div>
          <div id="profile_name">
            <h2>
              ${this.socialData.displayName||"Anon"} 
              <sl-copy-button value="${this.did}" copy-label="Copy this user's DID"></sl-copy-button>
              <sl-tooltip content="Scan this user's DID">
                <sl-icon-button class="qr_button" name="simple-qr" size="small" @click="${o=>this.showQrModal("Scan this user's DID",this.did)}"></sl-icon-button>
              </sl-tooltip>
            </h2>
            <small>${this.socialData.tagline||""}</small>
          </div> 
        </div>
      </section>

      <sl-tab-group id="tabs" flex="fill" @sl-tab-show="${this.onTabShow}">
        <sl-tab slot="nav" panel="profile" ?active="${this.panel==="profile"||Ot}">Profile</sl-tab>
        <!-- <sl-tab slot="nav" panel="threads" ?active="${this.panel==="threads"||Ot}">Threads</sl-tab> -->
        ${this.owner?Ie`
          <sl-tab slot="nav" panel="notifications" ?active="${this.panel==="notifications"||Ot}">Notifications</sl-tab>
        `:Ot}

        <sl-tab-panel id="profile_panel" name="profile" ?active="${this.panel==="profile"||Ot}">
          <section id="profile_about">
            <header flex="center-y">
              <sl-icon name="person-vcard" size="small"></sl-icon>
              <h3>About</h3>
              <sl-icon-button class="edit-button" name="pencil" variant="default" size="medium" @click="${o=>this.profileEditModal.show()}"></sl-icon-button>
            </header>
            <p class="section-content" empty-text="Tell people about yourself" ?empty="${!this.socialData.bio}">${this.socialData.bio||Ot}</p>
          </section>

          <section id="profile_social">
            <header flex="center-y">
              <sl-icon name="at" size="small"></sl-icon>
              <h3>Social</h3>
              <sl-icon-button class="edit-button" name="pencil" variant="default" size="medium" @click="${o=>this.profileEditModal.show()}"></sl-icon-button>
            </header>
            <div class="section-content" empty-text="Add social links" ?empty="${!Object.values(this.socialData.apps||{}).length}">
              ${Object.entries(this.socialData.apps).map(o=>{const s=o[0],a=N5e[s];return o[1]?Ie`<sl-icon-button name="${a?.icon||s}" target="_blank" href="${a?.profileUrl?a.profileUrl+o[1]:`https://${s}.com/${o[1]}`}"></sl-icon-button>`:Ot})}
            </div>
          </section>  
        
          <section id="profile_career">
            <header flex="center-y">
              <sl-icon name="briefcase" size="small"></sl-icon>
              <h3>Career</h3>
              <sl-icon-button class="edit-button" name="plus-lg" variant="default" size="medium" @click="${o=>this.showJobModal()}"></sl-icon-button>
            </header>
            <detail-box id="job_groups" flex="column-reverse end" class="section-content" empty-text="Where have you worked?" ?empty="${!this.careerData?.jobs?.length}">
              ${Object.keys(i).map((o,s)=>{const a=i[o]=i[o].sort((d,c)=>c.endTime-d.endTime),l=Math.round(a[0].endTime/1e8);return Ie`<ul class="job-group" style="order: ${l}">${a.map(d=>{d.id||(d.id=Ps.randomString(32));const c=new Date(d.start_date),u=d.end_date?new Date(d.end_date):null,f=y5e(m5e({start:c,end:u||e}),{format:["years","months"]});return d?Ie`
                        <li class="job" flex ?latest-job="${d===n||Ot}">
                          <div class="gutter" flex="column center-x">
                            <img src="https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${d.url}&size=128"/>
                            ${this.owner&&Ie`<sl-icon-button name="pencil" variant="default" size="medium" @click="${h=>this.showJobModal(d.id)}"></sl-icon-button>`}
                          </div>
                          <div class="content" flex="column align-start">
                            <strong>${d?.title}</strong>
                            <small>${d?.employer}</small>
                            <small>${RU(c,"MMM yyy")} - ${u?RU(u,"MMM yyy"):"Present"}  ${f}</small>
                            <p>${d?.description}</p>
                          </div>
                        </li>
                      `:Ot})}</ul>`})}
            </detail-box>
          </section>  
        </sl-tab-panel>

        <sl-tab-panel id="threads_panel" name="threads" ?active="${this.panel==="threads"||Ot}">
          <ul id="threads_list"></ul>
          <div default-content="placeholder">
            ${this.owner?Ie`
              <sl-icon name="card-heading"></sl-icon>
              <sl-button>
                <sl-icon name="plus-lg" slot="prefix"></sl-icon>
                Start your first thread
              </sl-button>
              `:Ie`
                <sl-icon name="file-earmark-richtext"></sl-icon>
                <p>Nothing to see here yet.</p>
              `}
          </div>
        </sl-tab-panel>

        ${this.owner?Ie`
          <sl-tab-panel name="notifications" ?active="${this.panel==="notifications"||Ot}">
            ${[].map(o=>o.initialWrite?Ot:Ie`<invite-item .invite="${o}"></invite-item>`)}
          </sl-tab-panel>
        `:Ot}
      </sl-tab-group>

      <sl-dialog id="profile_edit_modal" class="page-dialog" label="Edit Profile" placement="start">
        <form id="profile_form" @sl-change="${o=>this.saveSocialInfo(o)}" @submit="${o=>o.preventDefault()}">
          <sl-tab-group>

            <sl-tab slot="nav" panel="bio">Bio</sl-tab>
            <sl-tab slot="nav" panel="social">Social Accounts</sl-tab>
            <sl-tab slot="nav" panel="payment">Payment</sl-tab>
            
            <sl-tab-panel name="bio">
              <sl-input name="displayName" value="${this.socialData.displayName}" label="Display Name" help-text="A public name visible to everyone"></sl-input>
              <sl-input name="tagline" value="${this.socialData.tagline}" label="What you do" help-text="Your title or personal tagline" maxlength="80"></sl-input>
              <sl-textarea name="bio" value="${this.socialData.bio}" label="About" help-text="Tell people a little more about yourself" rows="4" resize="none"></sl-textarea>
            </sl-tab-panel>

            <sl-tab-panel name="social">
              <sl-input label="X (Twitter)" name="apps.x" value="${this.socialData.apps.x}" class="label-on-left"></sl-input>
              <sl-input label="Instagram" name="apps.instagram" value="${this.socialData.apps.instagram}" class="label-on-left"></sl-input>
              <sl-input label="Facebook" name="apps.facebook" value="${this.socialData.apps.facebook}" class="label-on-left"></sl-input>
              <sl-input label="GitHub" name="apps.github" value="${this.socialData.apps.github}" class="label-on-left"></sl-input>
              <sl-input label="LinkedIn" name="apps.linkedin" value="${this.socialData.apps.linkedin}" class="label-on-left"></sl-input>
              <sl-input label="Tidal" name="apps.tidal" value="${this.socialData.apps.tidal}" class="label-on-left"></sl-input>
              <sl-input label="Cash" name="apps.cash" value="${this.socialData.apps.cash}" class="label-on-left"></sl-input>
            </sl-tab-panel>

            <sl-tab-panel name="payment">
              <sl-input label="Cashtag" name="payment.cashtag" value="${this.socialData?.payment?.cashtag}" class="label-on-left"></sl-input>
              <sl-input label="Bitcoin Address" name="payment.btc_address" value="${this.socialData?.payment?.btc_address}" class="label-on-left"></sl-input>
              <sl-input label="Lightning Address" name="payment.ln_address" value="${this.socialData?.payment?.ln_address}" class="label-on-left"></sl-input>
              <sl-input label="DAP" name="payment.dap" value="${this.socialData?.payment?.dap}" class="label-on-left"></sl-input>
            </sl-tab-panel>
          </sl-tab-group>
        </form>
        <sl-button slot="footer" variant="primary" @click="${o=>this.profileEditModal.hide()}">Submit</sl-button>
      </sl-dialog> 
      
      <sl-dialog id="job_modal" class="page-dialog dialog-deny-close" label="Edit Job" placement="start">
        <form id="job_form" @submit="${o=>{o.preventDefault(),this.saveJob()}}">   
          <sl-input name="employer" required value="${this?.job?.employer}" label="Employer" help-text="What was the name of your employer?"></sl-input>
          <sl-input name="url" required value="${this?.job?.url}" label="Employer Website" pattern="https?://.+" help-text="Enter the URL of the company"></sl-input>
          <sl-input name="title" required value="${this?.job?.title}" label="Job Title" help-text="What was your job title?"></sl-input>
          <div flex="center-y gap-medium">
            <sl-input name="start_date" required value="${this?.job?.start_date}" type="date" label="Start date"></sl-input>
            <sl-input name="end_date" value="${this?.job?.end_date}" type="date" label="End date"></sl-input>
          </div>
          <sl-textarea name="description" required value="${this?.job?.description}" label="Job Description" help-text="What did you do there?" rows="4"></sl-textarea>
        </form>
        <sl-button slot="footer" variant="danger" @click="${o=>this.jobModal.hide()}">Cancel</sl-button>
        <sl-button slot="footer" variant="primary" @click="${o=>this.saveJob(!0)}">Save</sl-button>
      </sl-dialog>

      <sl-dialog id="pay_modal" class="page-dialog" label="Payment" placement="start">
        ${Object.entries(this.socialData.payment||{}).map(([o,s])=>{if(!s)return Ot;let a=w6.paymentTypes?.[o];if(a){let l=a?.normalize(s)||s,d=a?.normalize(s,!0);return Ie`
              <div class="payment-type" flex>
                <sl-icon name="${a.icon}" style="color: ${a.color||"#fff"}"></sl-icon>
                <a href="${d||Ot}" target="${a.newTab?"_blank":Ot}">
                  ${l}
                </a>
                <sl-copy-button value="${l}" copy-label="Copy"></sl-copy-button>
                <sl-tooltip content="Show QR">
                  <sl-icon-button class="qr_button" name="simple-qr" size="small" @click="${c=>this.showQrModal(l,d||l)}"></sl-icon-button>
                </sl-tooltip>
              </div>
            `}else return Ot})}
      </sl-dialog>

      <sl-dialog id="qr_modal" class="page-dialog" placement="start" fit-content>
        <sl-qr-code id="qr_code"></sl-qr-code>
      </sl-dialog>
    `}static styles=[dm,Ye`

      :host {
        --avatar-size: clamp(6em, 18vw, 9em);
        --block-padding: calc(var(--avatar-size) * 0.2);
        --hero-border-size: clamp(0.2em, 1vw, 0.4em);
        --hero-border: var(--hero-border-size) solid rgba(0 0 0 / 15%);
        position: relative;
        display: flex;
        box-sizing: border-box;
        justify-content: center;
        flex-direction: column;
        max-width: var(--content-max-width);
        background: var(--grey);
        border-radius: var(--block-radius);
        box-shadow: var(--block-shadow);
        overflow: hidden;
        cursor: default;
      }

      :host(:not([owner])) .edit-button {
        visibility: hidden;
        pointer-events: none;
      }

      form {
        max-width: 600px;
        margin: 0 auto;
      }

      sl-input, sl-textarea {
        margin: 0 0 1em;
      }

      sl-tab-panel {
        padding: 0.5em 1.5em;
      }

      #profile_card {
        position: relative;
        flex: 0;
        min-width: 250px;
        margin: 0 0 1.5em;
      }

      #hero {
        position: relative;
        width: 100%;
        height: var(--avatar-size);
        background: var(--deterministic-background);
      }

      #hero::after {
        content: "";
        box-sizing: border-box;
        position: absolute;
        inset: 0;
        border: 1px solid rgba(255 255 255 / 7%);
        border-bottom: var(--hero-border);
        border-radius: var(--block-radius) var(--block-radius) 0 0;
        z-index: 2;
      }

      #hero[src] {
        background: none;
      }

      #hero::part(fallback) {
        display: none;
      }

      #hero sl-icon-button {
        position: absolute;
        top: 1em;
        right: 1em;
        background: rgba(0 0 0 / 0.6);
        border-radius: 100%;
        cursor: pointer;
        z-index: 3;
      }

      #basic_info {
        margin: 0 0 0 var(--block-padding);
      }

      #avatar_wrapper {
        height: 2.75em;
        margin: 0 0 1.1em;
      }

      #avatar_wrapper sl-button {
        margin: 0.75em 0.75em 0 0;
      }

      #avatar_wrapper sl-button:first-of-type {
        margin-left: auto;
      }

      #avatar {
        --size: var(--avatar-size);
        position: absolute;
        background: var(--grey-lighter);
        outline: var(--hero-border);
        box-shadow: 0 1px 1px 0px rgba(0 0 0 / 0.6);
        border-radius: 6px;
        z-index: 2;
        cursor: pointer;
      }

      #profile_name {
        position: relative;
        margin: 0 0 0.5em 0.1em;
        z-index: 2;
      }

      #profile_name h2 {
        margin: 0 0 0.2em;
        /* font-size: calc(var(--avatar-size) * 0.2); */
      }

      sl-copy-button {
        font-size: 0.925rem;
        opacity: 0.5;
        transition: opacity 0.3s ease;
      }

      #profile_name sl-copy-button:hover {
        opacity: 1;
      }

      .qr_button {
        font-size: 0.95rem;
      }

      .qr_button::part(base) {
        padding-left: 0;
        padding-right: 0;
      }

      #profile_name small {
        color: #777;
      }

      #tabs {
        flex: 1;
      }

      #tabs::part(body),
      #tabs sl-tab-panel::part(base),
      #tabs sl-tab-panel[active] {
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      #tabs::part(base) {
        width: 100%;
      }

      #tabs::part(tabs) {
        box-sizing: border-box;
        background: rgba(0 0 0 / 15%);
        border: solid 1px var(--track-color);
        border-left: none;
        border-right: none;
      }

      #tabs::part(active-tab-indicator) {
        bottom: 0;
      }

      #tabs sl-tab-panel {
        flex: 1;
      }

      #tabs sl-tab-panel [default-content~="placeholder"]{
        flex: 1;
        padding: 0 0 5rem;
      }

      #profile_panel > section {
        margin: 0 0 2em;
      }

      #profile_panel > section:last-child {
        margin: 0 0 1em;
      }

      /* #profile_panel > section :last-child {
        margin-bottom: 0;
      } */

      :host(:not([owner])) #profile_panel > section:has([empty]) {
        display: none;
      }

      #profile_panel header {
        margin: 0 0 1em;
        border-bottom: 2px dotted rgba(255 255 255 / 0.05);
      }

      #profile_panel header sl-icon {
        margin-top: -0.15em;
        color: #bbb;
      }

        #profile_social header sl-icon::part(svg) {
          margin-top: -0.1em;
          font-size: 1.3em;
        }

      #profile_panel h3 {
        margin: 0 auto 0.2em 0.5em;
        font-weight: normal;
      }

      #profile_about .section-content {
        white-space: pre-wrap;
      }

      #profile_panel [empty-text][empty] {
        text-align: center;
      }

      #profile_social .section-content sl-icon-button {
        font-size: 1.5em;
      }

      #profile_career {
        position: relative;
      }

      #profile_career header {
        margin: 0 0 1.5em;
      }

      #job_groups {
        max-height: 20em;
      }

      #job_groups::part(content) {
        display: flex;
        flex-direction: column-reverse;
        justify-content: flex-end;
      }

      .job-group {
        margin: 1.25em 0 0;
        padding: 1.75em 0 0.5em;
        border-top: 1px solid rgba(255 255 255 / 0.05)
      }

      .job-group:has([latest-job]) {
        order: 1000000 !important;
        margin-top: 0;
        padding-top: 0.25em;
        border: none;
      }

      .job:not(:last-child) {
        margin: 0 0 1.5em;
      }

      .job img {
        box-sizing: border-box;
        width: 4em;
        padding: 0.2em;
        border: 1px solid rgba(255 255 255 / 0.25);
        border-radius: 6px;
      }

      .job .gutter {
        min-width: 4em;
        margin: 0 1em 0 0;
        font-size: clamp(0.6rem, 3vw, 1rem);
      }

      .job .content > :last-child {
        margin-bottom: 0;
      }

      .job:not(:first-child) .gutter img {
        width: 2.6em;
      }

      .job:not(:last-child) .gutter::after {
        content: "";
        display: block;
        flex: 1;
        width: 3px;
        background: rgba(255 255 255 / 0.2);
        margin: 0.7em 0 0;
        border-radius: 3px;
      }

      .job .gutter sl-icon-button {
        margin: 0.6em 0 0;
      }

      .job strong {
        margin: 0 0 0.4em;
        font-weight: normal;
      }

      .job small {
        margin: 0 0 0.2em;
        color: rgba(255 255 255 / 0.6);
      }

      .job p {
        white-space: pre-wrap;
      }

      .label-on-left {
        --label-width: 5.5rem;
        --gap-width: 1rem;
      }

      .label-on-left + .label-on-left {
        margin-top: var(--sl-spacing-medium);
      }

      .label-on-left::part(form-control) {
        display: grid;
        grid: auto / var(--label-width) 1fr;
        gap: var(--sl-spacing-3x-small) var(--gap-width);
        align-items: center;
      }

      .label-on-left::part(form-control-label) {
        text-align: right;
      }

      .label-on-left::part(form-control-help-text) {
        grid-column-start: 2;
      }

      #profile_edit_modal::part(body) {
        padding: 0;
      }

      #profile_edit_modal sl-tab-panel {
        height: 27em;
      }

      #qr_modal::part(title) {
        padding-right: 0;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      #qr_modal::part(panel) {
        max-width: 20em;
      }

      #qr_modal::part(body) {
        margin: 0 auto;
      }

      #qr_modal sl-qr-code {
        padding: 1em;
        background: #fff;
        border-radius: 0.25rem;
      }

      #qr_modal sl-qr-code::part(base) {  
        width: 100% !important;
        max-width: 15rem;
        height: auto !important;
        aspect-ratio: 1 / 1;
      }

      #pay_modal .payment-type {
        margin: 0 0 1.5em;
        font-size: 1.25em;
        align-items: center; 
      }

      #pay_modal .payment-type:last-child {
        margin: 0 0 0.5em;
      }

      #pay_modal .payment-type a {
        overflow: hidden;
        text-decoration: none;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      #pay_modal .payment-type sl-icon {
        font-size: 1.25em;
        margin: 0 0.25em 0 0;
      }

      @media(max-width: 500px) {
        :host {
          min-height: var(--content-height);
          border-radius: 0;
        }

        #hero::after {
          display: none;
        }
      }

    `]}customElements.define("profile-view",w6);class F5e extends hi.with(Ju,wd,f1){static properties={identities:{store:"page"},did:{type:String}};static query={searchInput:"#search_input",profileView:"#profile_view"};constructor(){super(),this.path={}}onRouteEnter(e,t){this.path=t,this.loadDid()}firstUpdated(){this.componentReady=!0,this.loadDid()}async loadDid(){if(this.componentReady){const e=this.path.did;this.did&&!e&&router.navigateTo(`/profiles/${this.did}`),e&&e!==this.did&&(this.searchInput.value=e,await this.startSpinner({minimum:1e3,fixed:!0}),this.did=e)}}async onLoadComplete(){this.stopSpinner()}lookupProfile(e=this.searchInput.value){!e||e===this.did||e!==this.path.did&&router.navigateTo(`/profiles/${e}`)}render(){return Ie`
      <header id="search_bar" flex="center-y center-x" lock-on-scroll>
        <sl-input id="search_input"
                  value="${ft(this.did)}"
                  required
                  size="small"
                  placeholder="Enter a DID to view a profile"
                  pattern="did:dht:[a-zA-Z0-9]+"
                  @keydown="${e=>e.key==="Enter"&&this.lookupProfile()}"
                  @keypress="${e=>/^[a-zA-Z0-9_\-:.]+$/.test(String.fromCharCode(e.charCode||e.which))?!0:e.preventDefault()}"
        ></sl-input>
        <sl-button variant="primary" size="small" @click="${e=>this.lookupProfile()}" slot="suffix">Find</sl-button>
      </header>
      <section>
        <profile-view id="profile_view" did="${ft(this.did)}" @profile-view-load-complete="${this.onLoadComplete}"></profile-view>
        <div id="placeholder" default-content="cover placeholder">
          <sl-icon name="search"></sl-icon>
          <p>Enter a DID above to view a profile.</p>
        </div>
      </section>
    `}static styles=[dm,dT,Ye`

      :host {
        padding: 0 !important;
      }

      .spinner-mixin {
        z-index: 0;
      }

      connect-widget {
        align-self: center;
      }

      #search_bar {
        position: sticky;
        top: var(--header-height);
        height: 4.25rem;
        box-sizing: border-box;
        padding: 0.2rem 1rem 0;
        border-bottom: 1px solid rgba(255 255 255 / 1%);
        box-shadow: 0 2px 1px -1px rgba(0 0 0 / 40%);
        background: hsl(240deg 7% 15% / 90%);
        backdrop-filter: blur(10px) saturate(100%);
        -webkit-backdrop-filter: blur(10px) saturate(100%);
        z-index: 1;
      }

      #search_bar sl-input {
        flex: 1;
        max-width: 700px;
        margin: 0 0.5em 0 0;
        transition: transform 0.4s ease;
      }

      :host > section {
        padding: var(--page-padding);
      }

      profile-view {
        width: 100%;
        max-width: var(--content-max-width);
        margin: 0 auto;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 0;
      }

      profile-view[loaded] {
        opacity: 1;
        /* height: 3000px; */
      }

      #placeholder {
        z-index: 0;
      }

        profile-view[did] ~ #placeholder {
          opacity: 0;
          visibility: hidden;
          z-index: -1;
        }

      #placeholder sl-icon{
        color: var(--sl-color-primary-600);
      }

      .spinner-mixin {
        --inset: var(--header-height) 0 0 var(--nav-width);
      }

      @media(max-width: 800px) {
        #search_bar {
          left: 0;
        }
        .spinner-mixin {
          --inset: var(--header-height) 0 0 0;
        }
      }

      @media(max-width: 500px) {
        :host > section {
          padding: 0;
        }
      }
    `]}customElements.define("find-page",F5e);/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */function um(r){const e=customElements.get(r.is);if(!e)Object.defineProperty(r,"version",{get(){return"24.4.6"}}),customElements.define(r.is,r);else{const t=e.version;t&&r.version&&t===r.version?console.warn(`The component ${r.is} has been loaded twice`):console.error(`Tried to define ${r.is} version ${r.version} when version ${e.version} is already in use. Something will probably break.`)}}/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class q5e extends HTMLElement{static get is(){return"vaadin-lumo-styles"}}um(q5e);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const V5e=r=>class extends r{static get properties(){return{_theme:{type:String,readOnly:!0}}}static get observedAttributes(){return[...super.observedAttributes,"theme"]}attributeChangedCallback(t,n,i){super.attributeChangedCallback(t,n,i),t==="theme"&&this._set_theme(i)}};/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const eG=[],T5=new Set,_6=new Set;function tG(r){return r&&Object.prototype.hasOwnProperty.call(r,"__themes")}function W5e(r){return tG(customElements.get(r))}function H5e(r=[]){return[r].flat(1/0).filter(e=>e instanceof z5?!0:(console.warn("An item in styles is not of type CSSResult. Use `unsafeCSS` or `css`."),!1))}function rG(r,e){return(r||"").split(" ").some(t=>new RegExp(`^${t.split("*").join(".*")}$`,"u").test(e))}function nG(r){return r.map(e=>e.cssText).join(`
`)}const hx="vaadin-themable-mixin-style";function G5e(r,e){const t=document.createElement("style");t.id=hx,t.textContent=nG(r),e.content.appendChild(t)}function Y5e(r){if(!r.shadowRoot)return;const e=r.constructor;if(r instanceof hi)[...r.shadowRoot.querySelectorAll("style")].forEach(t=>t.remove()),mL(r.shadowRoot,e.elementStyles);else{const t=r.shadowRoot.getElementById(hx),n=e.prototype._template;t.textContent=n.content.getElementById(hx).textContent}}function Z5e(r){T5.forEach(e=>{const t=e.deref();t instanceof r?Y5e(t):t||T5.delete(e)})}function iG(r){if(r.prototype instanceof hi)r.elementStyles=r.finalizeStyles(r.styles);else{const e=r.prototype._template;e.content.getElementById(hx).textContent=nG(r.getStylesForThis())}_6.forEach(e=>{const t=customElements.get(e);t!==r&&t.prototype instanceof r&&iG(t)})}function J5e(r,e){const t=r.__themes;return!t||!e?!1:t.some(n=>n.styles.some(i=>e.some(o=>o.cssText===i.cssText)))}function gc(r,e,t={}){e=H5e(e),window.Vaadin&&window.Vaadin.styleModules?window.Vaadin.styleModules.registerStyles(r,e,t):eG.push({themeFor:r,styles:e,include:t.include,moduleId:t.moduleId}),r&&_6.forEach(n=>{if(rG(r,n)&&W5e(n)){const i=customElements.get(n);J5e(i,e)?console.warn(`Registering styles that already exist for ${n}`):(!window.Vaadin||!window.Vaadin.suppressPostFinalizeStylesWarning)&&console.warn(`The custom element definition for "${n}" was finalized before a style module was registered. Ideally, import component specific style modules before importing the corresponding custom element. This warning can be suppressed by setting "window.Vaadin.suppressPostFinalizeStylesWarning = true".`),iG(i),Z5e(i)}})}function $5(){return window.Vaadin&&window.Vaadin.styleModules?window.Vaadin.styleModules.getAllThemes():eG}function X5e(r=""){let e=0;return r.startsWith("lumo-")||r.startsWith("material-")?e=1:r.startsWith("vaadin-")&&(e=2),e}function oG(r){const e=[];return r.include&&[].concat(r.include).forEach(t=>{const n=$5().find(i=>i.moduleId===t);n?e.push(...oG(n),...n.styles):console.warn(`Included moduleId ${t} not found in style registry`)},r.styles),e}function Q5e(r){const e=`${r}-default-theme`,t=$5().filter(n=>n.moduleId!==e&&rG(n.themeFor,r)).map(n=>({...n,styles:[...oG(n),...n.styles],includePriority:X5e(n.moduleId)})).sort((n,i)=>i.includePriority-n.includePriority);return t.length>0?t:$5().filter(n=>n.moduleId===e)}const Gv=r=>class extends V5e(r){constructor(){super(),T5.add(new WeakRef(this))}static finalize(){if(super.finalize(),this.is&&_6.add(this.is),this.elementStyles)return;const t=this.prototype._template;!t||tG(this)||G5e(this.getStylesForThis(),t)}static finalizeStyles(t){const n=this.getStylesForThis();return t?[...[t].flat(1/0),...n]:n}static getStylesForThis(){const t=r.__themes||[],n=Object.getPrototypeOf(this.prototype),i=(n?n.constructor.__themes:[])||[];this.__themes=[...t,...i,...Q5e(this.is)];const o=this.__themes.flatMap(s=>s.styles);return o.filter((s,a)=>a===o.lastIndexOf(s))}};/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const eOe=(r,...e)=>{const t=document.createElement("style");t.id=r,t.textContent=e.map(n=>n.toString()).join(`
`).replace(":host","html"),document.head.insertAdjacentElement("afterbegin",t)},Yv=(r,...e)=>{eOe(`lumo-${r}`,e)};/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const tOe=Ye`
  @font-face {
    font-family: 'lumo-icons';
    src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABEgAAsAAAAAIjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAQwAAAFZAIUuKY21hcAAAAYgAAAD4AAADrsCU8d5nbHlmAAACgAAAC2cAABeAWri7U2hlYWQAAA3oAAAAMAAAADZa/6SsaGhlYQAADhgAAAAdAAAAJAbpA35obXR4AAAOOAAAABAAAACspBAAAGxvY2EAAA5IAAAAWAAAAFh57oA4bWF4cAAADqAAAAAfAAAAIAFKAXBuYW1lAAAOwAAAATEAAAIuUUJZCHBvc3QAAA/0AAABKwAAAelm8SzVeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGS+yDiBgZWBgamKaQ8DA0MPhGZ8wGDIyAQUZWBlZsAKAtJcUxgcXjG+0mIO+p/FEMUcxDANKMwIkgMABn8MLQB4nO3SWW6DMABF0UtwCEnIPM/zhLK8LqhfXRybSP14XUYtHV9hGYQwQBNIo3cUIPkhQeM7rib1ekqnXg981XuC1qvy84lzojleh3puxL0hPjGjRU473teloEefAUNGjJkwZcacBUtWrNmwZceeA0dOnLlw5cadB09elPGhGf+j0NTI/65KfXerT6JhqKnpRKtgOpuqaTrtKjPUlqHmhto21I7pL6i6hlqY3q7qGWrfUAeGOjTUkaGODXViqFNDnRnq3FAXhro01JWhrg11Y6hbQ90Z6t5QD4Z6NNSToZ4N9WKoV0O9GerdUB+G+jTUl6GWRvkL24BkEXictVh9bFvVFb/nxvbz+7Rf/N6zHcd2bCfP+Wic1Z9N0jpNHCD9SNqqoVBgbQoMjY+pjA4hNnWa2pV1rHSIif0DGkyT2k10Kmu1Cag6huj4ZpqYBHSqJsTEJgZCG3TaVBFv595nO3ZIv4RIrPPuvefe884599zzO/cRF8G/tgn6CFFImNgkR0ggX8wlspbhSSWSdrC5ozd30s2dw5afzvgtyz9/zG9t1hV4RtF1pXolowvtzc2z6L2aYUQM45jKH9WDTvd1LRDoDASYWhfTzTyvboXz6uZX4ARX5wrF39y+HM2+CJ8d0pkyqBIqoze3D12ez4DrFoYzxI8dWwMrDlZ2DMqQAR9AROsJU+2smlTPaTTco52BVxXa2a2+I8vvqd2dVHm1LoPeTn/AZPRYGthDYOeZjBjKoFsVGulR3lGU95SeCK44oHU7MhWUGUKZDT3oSUcG2GWuh+EDDfUYA/jhIhl0TOsJNYSEu7mQmi3UzfXwZKA4BsVsHLXQYGgJW95qEtpJ1VcW9HiTriZBlFEqxsDjA09yCNUoQxxwd7KWSTt2y3GTKifkqHRCoWZc3m11Wa/dKdFgXD4kSYfkeJBKd8KMz7J8dZn/cGRCcLGDnA2Ge3bKzcvlnTDNthFWLH7Xt80ua5FMjA4WKelWv5Xo16vHuYzpRbJhhdVlftuRK0VlR27D9lu5TF0DPBi60OrHNO0AfP/uRWvhn/U3LXICE+nh+3IHPUJ8JE6GyBjZQLbjGchlrSgYngF8zyrIF4NJD3atUcgWsWunGN/UHX5B5/yg7uF87Nqp4Gf52F3gH73DjEZNRoqCKAr9giQJp5rGJABpiVE2htNhW9R8nw0jqYjCYcY4LIjwYNScf4WN06IZnZCEqsI4cFaQbo4Z1TsZBx40YhXkHOecaYE5oY37IIQ+iJJ+UsDYSun5MuRSBRZRUUhlY2DqOGajOR6zrSU/5My6l2DnusH1GQgnw5BZP7iuYM/ahcfQ7Z8y51ddfutvuwNqWQ0cBYr8fj0U0vsHpwerVaB2sWhXT2NExi2r1KUE2tUuVMnkepVQrxTmpQrZTG4iu8he8iPyM3KcPE/+RP5KPoE2CEAKclCBzXATxkYOtUY/o961PWRqsj0chRrHFBbtrjP9/P0ven5pcbRdpL94vfsy33e5+izuwz3nFLFPVNayPZx/jdG1fOChflFRvYzsW6L18efgLrSWIgvcqnGJYi4skO4xREURjbDuxKke5v0T3Mrzkt2fi31uyZlLLrqIpEuXXsMlgw442Jb0GAxjS1DM20kBoCzHLXm/jEm0IltdcvU0fEW24jgiwwRjVd9u4NJHcIyoHJcwvyVqgqj5hqBJ1ZWSJryh9p56UWhX1XbhRbW2ZopuZWsQd5y8mEQ8M+C6xjRYxZbDKWf5AgY+Qq/l6wSPk16zDFjowYuu+wjx13mfkxbyDDxadYT/LijZyI0THB+6yfLaWsRcO82zo9mWTNtpO18qlorZoIVMwSN40tky5DOQ1MCIAe24mvlsuwIIxPb10+uXDQ4uWz/9m3rj+ql7p6bufZARuPVq5tXtsn6KwfP8Jy0TeWOyNhUJN6mhX5rkUTtUppQWEMNTqEdaCGKFYKJaQrCE4JtDLYOlNEKmO5kBTPGY2A0N2sY3+dVlo1N9ycBsIGtOjQ2p/tlZvzo0ur4v6cOh8NTospB7U/X40KahoU3bGIH97dnwmtHlYffVG3R1YOwKM2vNhrPhCT5zk64sG53oS4b31aYjqe/B7+kQiXBN+b6h21hNUPMq29B8CU4elINdygMPKF1B+WBTG7Z9ZshpN/xwEuuDQZR+nuoo4CDaAiiwXmLpmukMQyPf/JMclqgL1ixZQ/nnP2VbdUODFGt2fgBvL123rlLYu/6A9ckb7F3K0/CyBMEu6aQoPscroCcacVehvyQyCZAsizsWWBkoLC+WAiWnOksLKaeuQDzGuqSk42aiYTiJ4zf9afl17SrqaTO1f+XlZAfIuYcq7/IqYMaMrksOJ6vHkOCPDq943xcCnHqVD9pHFRpMqSPXrIua1WNs+tOz1U+ciTCDpPk+c4QYJIHnYhxP/kVPAq+ahFpVhPcHp8qyarhiF+HsBU9Hrl+UZa876fbKipL0KqB6OdUveErgtOI97fZ63ae9SvWU6k2w1JfwqnUbHsYcFCJFrC/W12zIMMirWYEHxMPs6LGYSdkSZ5TsNP9PCpwnWC3HKZ1lydNjWHC2Mn3l6vL0dHn1ldP3LTSrX+vKrBqv7KmMr8p0SR6P1NqF63or6XRlIyO90f7+kf7+myOhvt4tq7f09oUiTc2/dycGgqFQcCDRLYmi1NL7fk0CknVMxEg/cdfs/TnpJMNkgqwj17B8beVazSrVbU4lG67IZYOCnWrYy3yBR9cyWcChywos3LJBEdhhFoAdYjiw0rLGm0xU5OzoGm5/ZfmHjVZpNNg6SznzGKDdwv2cCtVn6Eaxo12cfxLprpVtTcZ6hVx6dow7Yq7e8LXO8PY9Jgjoze9yCtU5FNbegcKkQMdCbt9au/te4Ebe0jkc0ukUL32eYnTpNs20h0KpUOhZPYwVcfhZnfdqeCvDfXiuCbAoYWcXERPc/mDQD3/hdF+wK4i/xv3kYfprIpAuMkk2kW3kdtS0kBIKpZwp8KxmsCyfM1MFzAss9LBkDxRyThiaqTLwKYKJVTwmWTudMyz+yks09346MDh4m72yOxCKrt1XMlQ1qPVlTEVVQ1ofdK/sCWjtZu9qGwZ8YZ9PPWlo1IV3eW3+U0aXblP39zrt+JPf6UhEQ1rUjNBULN+utyuaDNW34kpAVuSOeMTyWbSNWnooFu+QFNWQ4d/Ox4IPWx41fP/fB/Rjeoz08ezPA9TysMtmnOXfGN7Ui3xIYLDALrlDLOP09qtJuY2OeL0+QZXdRnR1nxRVBF/SOyKKPpcrn9mWzH4rH9IidE+PTNU2182+hOgSItrE1slByS24vaLvJpxOqe4Pduf3HJkZ+jLqUz9rRzB7p8gKcgWZwV1L8JtUS5Z2JxZSOCuBoMTQihMzLbCPA0KqGMAljRQjONklW/wjnXKy8vxT/Elvm3/KiMUMOoV0/vnDYlhec0SMKtt3/kKMyOt33tj2bqxQLsTjSGLl+EAsNhCnTyRGktW55EgCn/A4PlnWn+Mg8bgZrWqHxTbPwMuyy1u5YeZF2SUM7JRhddwRgiRuxpmgJmxn9ZW7XpcF3ViX/ar6ptRpGJ0S9Adg4qhb9sI3vbL7qNJV/y4i07t5TZBiho1imFoMz3gED+CtjYUxvP4SOxov4bFoNPg5aR1e+G4UgDPoedJTpogyCJ7oYvRqoVS0MQAy+CoNEdTDUjok5ZHZL/WtjV7rFj3PKQE3iKp7ou+rIxN3b9LB1dGjeT4cvKo3FrnWpYpuaFd/h3dtV8UeKN1Y9hpR3dt4p0H/zKuPQq0kZQUIIpuDfoiETsnIk+gCWMJZUXHtE8V9LkUc2TE8vOMbO4ax/MACabzyaGXc7u3FBr11ThBdB8SIeMAlCntG2KThHSPsaj2Dc9KNyY2a0KZ7ODaTHoRiFkeYz+shZBpCS4X6471KKKnuHd84edfk5F37d1XO5bbkcltu2ZLNbvnPXiUVAnVvprJrP+NObryjxrllS65md6Tm6wzFHRR4dY3QUUjb7MgxaIixU8hspi98fl/Xc+IB4iU66eCVL9YfAfahiSUt4TONS8x0D8W7u8vd3fGWx6OXlM/U1IoU/s61PGhpyXRFa3eReq2qG56lvmYtXavCC1iN7lbiBpWxXHU+cSlztVLVz0tVN600fVsLxaVDknhYioeoXP3t4lqV1r79MAw0GCI1FTL1YIGzPL1MMlJ9ZsN9P7lvA2yr9ZFUzwzPrVgxN/x/SS+chwB4nGNgZGBgAOLPrYdY4vltvjJwM78AijDUqG5oRND/XzNPZboF5HIwMIFEAU/lC+J4nGNgZGBgDvqfBSRfMAAB81QGRgZUoA0AVvYDbwAAAHicY2BgYGB+MTQwAM8EJo8AAAAAAE4AmgDoAQoBLAFOAXABmgHEAe4CGgKcAugEmgS8BNYE8gUOBSoFegXQBf4GRAZmBrYHGAeQCBgIUghqCP4JRgm+CdoKBAo+CoQKugr0C1QLmgvAeJxjYGRgYNBmTGEQZQABJiDmAkIGhv9gPgMAGJQBvAB4nG2RPU7DMBiG3/QP0UoIBGJh8QILavozdmRo9w7d09RpUzlx5LgVvQMn4BAcgoEzcAgOwVvzSZVQbcnf48fvFysJgGt8IcJxROiG9TgauODuj5ukG+EW+UG4jR4ehTv0Q+EunjER7uEWmk+IWpc0d3gVbuAKb8JN+nfhFvlDuI17fAp36L+Fu1jgR7iHp+jF7Arbz1Nb1nO93pnEncSJFtrVuS3VKB6e5EyX2iVer9TyoOr9eux9pjJnCzW1pdfGWFU5u9WpjzfeV5PBIBMfp7aAwQ4FLPrIkbKWqDHn+67pDRK4s4lzbsEux5qHvcIIMb/nueSMyTKkE3jWFdNLHLjW2PPmMa1Hxn3GjGW/wjT0HtOG09JU4WxLk9LH2ISuiv9twJn9y8fh9uIXI+BknAAAAHicbY7ZboMwEEW5CVBCSLrv+76kfJRjTwHFsdGAG+Xvy5JUfehIHp0rnxmNN/D6ir3/a4YBhvARIMQOIowQY4wEE0yxiz3s4wCHOMIxTnCKM5zjApe4wjVucIs73OMBj3jCM17wije84wMzfHqJ0EVmUkmmJo77oOmrHvfIRZbXsTCZplTZldlgb3TYGVHProwFs11t1A57tcON2rErR3PBqcwF1/6ctI6k0GSU4JHMSS6WghdJQ99sTbfuN7QLJ9vQ37dNrgyktnIxlDYLJNuqitpRbYWKFNuyDT6pog6oOYKHtKakeakqKjHXpPwlGRcsC+OqxLIiJpXqoqqDMreG2l5bv9Ri3TRX+c23DZna9WFFgmXuO6Ps1Jm/w6ErW8N3FbHn/QC444j0AA==)
      format('woff');
    font-weight: normal;
    font-style: normal;
  }

  html {
    --lumo-icons-align-center: '\\ea01';
    --lumo-icons-align-left: '\\ea02';
    --lumo-icons-align-right: '\\ea03';
    --lumo-icons-angle-down: '\\ea04';
    --lumo-icons-angle-left: '\\ea05';
    --lumo-icons-angle-right: '\\ea06';
    --lumo-icons-angle-up: '\\ea07';
    --lumo-icons-arrow-down: '\\ea08';
    --lumo-icons-arrow-left: '\\ea09';
    --lumo-icons-arrow-right: '\\ea0a';
    --lumo-icons-arrow-up: '\\ea0b';
    --lumo-icons-bar-chart: '\\ea0c';
    --lumo-icons-bell: '\\ea0d';
    --lumo-icons-calendar: '\\ea0e';
    --lumo-icons-checkmark: '\\ea0f';
    --lumo-icons-chevron-down: '\\ea10';
    --lumo-icons-chevron-left: '\\ea11';
    --lumo-icons-chevron-right: '\\ea12';
    --lumo-icons-chevron-up: '\\ea13';
    --lumo-icons-clock: '\\ea14';
    --lumo-icons-cog: '\\ea15';
    --lumo-icons-cross: '\\ea16';
    --lumo-icons-download: '\\ea17';
    --lumo-icons-dropdown: '\\ea18';
    --lumo-icons-edit: '\\ea19';
    --lumo-icons-error: '\\ea1a';
    --lumo-icons-eye: '\\ea1b';
    --lumo-icons-eye-disabled: '\\ea1c';
    --lumo-icons-menu: '\\ea1d';
    --lumo-icons-minus: '\\ea1e';
    --lumo-icons-ordered-list: '\\ea1f';
    --lumo-icons-phone: '\\ea20';
    --lumo-icons-photo: '\\ea21';
    --lumo-icons-play: '\\ea22';
    --lumo-icons-plus: '\\ea23';
    --lumo-icons-redo: '\\ea24';
    --lumo-icons-reload: '\\ea25';
    --lumo-icons-search: '\\ea26';
    --lumo-icons-undo: '\\ea27';
    --lumo-icons-unordered-list: '\\ea28';
    --lumo-icons-upload: '\\ea29';
    --lumo-icons-user: '\\ea2a';
  }
`;Yv("font-icons",tOe);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const rOe=Ye`
  :host {
    /* Base (background) */
    --lumo-base-color: #fff;

    /* Tint */
    --lumo-tint-5pct: hsla(0, 0%, 100%, 0.3);
    --lumo-tint-10pct: hsla(0, 0%, 100%, 0.37);
    --lumo-tint-20pct: hsla(0, 0%, 100%, 0.44);
    --lumo-tint-30pct: hsla(0, 0%, 100%, 0.5);
    --lumo-tint-40pct: hsla(0, 0%, 100%, 0.57);
    --lumo-tint-50pct: hsla(0, 0%, 100%, 0.64);
    --lumo-tint-60pct: hsla(0, 0%, 100%, 0.7);
    --lumo-tint-70pct: hsla(0, 0%, 100%, 0.77);
    --lumo-tint-80pct: hsla(0, 0%, 100%, 0.84);
    --lumo-tint-90pct: hsla(0, 0%, 100%, 0.9);
    --lumo-tint: #fff;

    /* Shade */
    --lumo-shade-5pct: hsla(214, 61%, 25%, 0.05);
    --lumo-shade-10pct: hsla(214, 57%, 24%, 0.1);
    --lumo-shade-20pct: hsla(214, 53%, 23%, 0.16);
    --lumo-shade-30pct: hsla(214, 50%, 22%, 0.26);
    --lumo-shade-40pct: hsla(214, 47%, 21%, 0.38);
    --lumo-shade-50pct: hsla(214, 45%, 20%, 0.52);
    --lumo-shade-60pct: hsla(214, 43%, 19%, 0.6);
    --lumo-shade-70pct: hsla(214, 42%, 18%, 0.69);
    --lumo-shade-80pct: hsla(214, 41%, 17%, 0.83);
    --lumo-shade-90pct: hsla(214, 40%, 16%, 0.94);
    --lumo-shade: hsl(214, 35%, 15%);

    /* Contrast */
    --lumo-contrast-5pct: var(--lumo-shade-5pct);
    --lumo-contrast-10pct: var(--lumo-shade-10pct);
    --lumo-contrast-20pct: var(--lumo-shade-20pct);
    --lumo-contrast-30pct: var(--lumo-shade-30pct);
    --lumo-contrast-40pct: var(--lumo-shade-40pct);
    --lumo-contrast-50pct: var(--lumo-shade-50pct);
    --lumo-contrast-60pct: var(--lumo-shade-60pct);
    --lumo-contrast-70pct: var(--lumo-shade-70pct);
    --lumo-contrast-80pct: var(--lumo-shade-80pct);
    --lumo-contrast-90pct: var(--lumo-shade-90pct);
    --lumo-contrast: var(--lumo-shade);

    /* Text */
    --lumo-header-text-color: var(--lumo-contrast);
    --lumo-body-text-color: var(--lumo-contrast-90pct);
    --lumo-secondary-text-color: var(--lumo-contrast-70pct);
    --lumo-tertiary-text-color: var(--lumo-contrast-50pct);
    --lumo-disabled-text-color: var(--lumo-contrast-30pct);

    /* Primary */
    --lumo-primary-color: hsl(214, 100%, 48%);
    --lumo-primary-color-50pct: hsla(214, 100%, 49%, 0.76);
    --lumo-primary-color-10pct: hsla(214, 100%, 60%, 0.13);
    --lumo-primary-text-color: hsl(214, 100%, 43%);
    --lumo-primary-contrast-color: #fff;

    /* Error */
    --lumo-error-color: hsl(3, 85%, 48%);
    --lumo-error-color-50pct: hsla(3, 85%, 49%, 0.5);
    --lumo-error-color-10pct: hsla(3, 85%, 49%, 0.1);
    --lumo-error-text-color: hsl(3, 89%, 42%);
    --lumo-error-contrast-color: #fff;

    /* Success */
    --lumo-success-color: hsl(145, 72%, 30%);
    --lumo-success-color-50pct: hsla(145, 72%, 31%, 0.5);
    --lumo-success-color-10pct: hsla(145, 72%, 31%, 0.1);
    --lumo-success-text-color: hsl(145, 85%, 25%);
    --lumo-success-contrast-color: #fff;

    /* Warning */
    --lumo-warning-color: hsl(48, 100%, 50%);
    --lumo-warning-color-10pct: hsla(48, 100%, 50%, 0.25);
    --lumo-warning-text-color: hsl(32, 100%, 30%);
    --lumo-warning-contrast-color: var(--lumo-shade-90pct);
  }

  /* forced-colors mode adjustments */
  @media (forced-colors: active) {
    html {
      --lumo-disabled-text-color: GrayText;
    }
  }
`;Yv("color-props",rOe);const nOe=Ye`
  [theme~='dark'] {
    /* Base (background) */
    --lumo-base-color: hsl(214, 35%, 21%);

    /* Tint */
    --lumo-tint-5pct: hsla(214, 65%, 85%, 0.06);
    --lumo-tint-10pct: hsla(214, 60%, 80%, 0.14);
    --lumo-tint-20pct: hsla(214, 64%, 82%, 0.23);
    --lumo-tint-30pct: hsla(214, 69%, 84%, 0.32);
    --lumo-tint-40pct: hsla(214, 73%, 86%, 0.41);
    --lumo-tint-50pct: hsla(214, 78%, 88%, 0.5);
    --lumo-tint-60pct: hsla(214, 82%, 90%, 0.58);
    --lumo-tint-70pct: hsla(214, 87%, 92%, 0.69);
    --lumo-tint-80pct: hsla(214, 91%, 94%, 0.8);
    --lumo-tint-90pct: hsla(214, 96%, 96%, 0.9);
    --lumo-tint: hsl(214, 100%, 98%);

    /* Shade */
    --lumo-shade-5pct: hsla(214, 0%, 0%, 0.07);
    --lumo-shade-10pct: hsla(214, 4%, 2%, 0.15);
    --lumo-shade-20pct: hsla(214, 8%, 4%, 0.23);
    --lumo-shade-30pct: hsla(214, 12%, 6%, 0.32);
    --lumo-shade-40pct: hsla(214, 16%, 8%, 0.41);
    --lumo-shade-50pct: hsla(214, 20%, 10%, 0.5);
    --lumo-shade-60pct: hsla(214, 24%, 12%, 0.6);
    --lumo-shade-70pct: hsla(214, 28%, 13%, 0.7);
    --lumo-shade-80pct: hsla(214, 32%, 13%, 0.8);
    --lumo-shade-90pct: hsla(214, 33%, 13%, 0.9);
    --lumo-shade: hsl(214, 33%, 13%);

    /* Contrast */
    --lumo-contrast-5pct: var(--lumo-tint-5pct);
    --lumo-contrast-10pct: var(--lumo-tint-10pct);
    --lumo-contrast-20pct: var(--lumo-tint-20pct);
    --lumo-contrast-30pct: var(--lumo-tint-30pct);
    --lumo-contrast-40pct: var(--lumo-tint-40pct);
    --lumo-contrast-50pct: var(--lumo-tint-50pct);
    --lumo-contrast-60pct: var(--lumo-tint-60pct);
    --lumo-contrast-70pct: var(--lumo-tint-70pct);
    --lumo-contrast-80pct: var(--lumo-tint-80pct);
    --lumo-contrast-90pct: var(--lumo-tint-90pct);
    --lumo-contrast: var(--lumo-tint);

    /* Text */
    --lumo-header-text-color: var(--lumo-contrast);
    --lumo-body-text-color: var(--lumo-contrast-90pct);
    --lumo-secondary-text-color: var(--lumo-contrast-70pct);
    --lumo-tertiary-text-color: var(--lumo-contrast-50pct);
    --lumo-disabled-text-color: var(--lumo-contrast-30pct);

    /* Primary */
    --lumo-primary-color: hsl(214, 90%, 48%);
    --lumo-primary-color-50pct: hsla(214, 90%, 70%, 0.69);
    --lumo-primary-color-10pct: hsla(214, 90%, 55%, 0.13);
    --lumo-primary-text-color: hsl(214, 90%, 77%);
    --lumo-primary-contrast-color: #fff;

    /* Error */
    --lumo-error-color: hsl(3, 79%, 49%);
    --lumo-error-color-50pct: hsla(3, 75%, 62%, 0.5);
    --lumo-error-color-10pct: hsla(3, 75%, 62%, 0.14);
    --lumo-error-text-color: hsl(3, 100%, 80%);

    /* Success */
    --lumo-success-color: hsl(145, 72%, 30%);
    --lumo-success-color-50pct: hsla(145, 92%, 51%, 0.5);
    --lumo-success-color-10pct: hsla(145, 92%, 51%, 0.1);
    --lumo-success-text-color: hsl(145, 85%, 46%);

    /* Warning */
    --lumo-warning-color: hsl(43, 100%, 48%);
    --lumo-warning-color-10pct: hsla(40, 100%, 50%, 0.2);
    --lumo-warning-text-color: hsl(45, 100%, 60%);
    --lumo-warning-contrast-color: var(--lumo-shade-90pct);
  }

  html {
    color: var(--lumo-body-text-color);
    background-color: var(--lumo-base-color);
    color-scheme: light;
  }

  [theme~='dark'] {
    color: var(--lumo-body-text-color);
    background-color: var(--lumo-base-color);
    color-scheme: dark;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    color: var(--lumo-header-text-color);
  }

  a:where(:any-link) {
    color: var(--lumo-primary-text-color);
  }

  a:not(:any-link) {
    color: var(--lumo-disabled-text-color);
  }

  blockquote {
    color: var(--lumo-secondary-text-color);
  }

  code,
  pre {
    background-color: var(--lumo-contrast-10pct);
    border-radius: var(--lumo-border-radius-m);
  }
  pre code {
    background: transparent;
  }
`;gc("",nOe,{moduleId:"lumo-color"});/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const iOe=Ye`
  :host {
    --lumo-size-xs: 1.625rem;
    --lumo-size-s: 1.875rem;
    --lumo-size-m: 2.25rem;
    --lumo-size-l: 2.75rem;
    --lumo-size-xl: 3.5rem;

    /* Icons */
    --lumo-icon-size-s: 1.25em;
    --lumo-icon-size-m: 1.5em;
    --lumo-icon-size-l: 2.25em;
    /* For backwards compatibility */
    --lumo-icon-size: var(--lumo-icon-size-m);
  }
`;Yv("sizing-props",iOe);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const oOe=Ye`
  :host {
    /* Square */
    --lumo-space-xs: 0.25rem;
    --lumo-space-s: 0.5rem;
    --lumo-space-m: 1rem;
    --lumo-space-l: 1.5rem;
    --lumo-space-xl: 2.5rem;

    /* Wide */
    --lumo-space-wide-xs: calc(var(--lumo-space-xs) / 2) var(--lumo-space-xs);
    --lumo-space-wide-s: calc(var(--lumo-space-s) / 2) var(--lumo-space-s);
    --lumo-space-wide-m: calc(var(--lumo-space-m) / 2) var(--lumo-space-m);
    --lumo-space-wide-l: calc(var(--lumo-space-l) / 2) var(--lumo-space-l);
    --lumo-space-wide-xl: calc(var(--lumo-space-xl) / 2) var(--lumo-space-xl);

    /* Tall */
    --lumo-space-tall-xs: var(--lumo-space-xs) calc(var(--lumo-space-xs) / 2);
    --lumo-space-tall-s: var(--lumo-space-s) calc(var(--lumo-space-s) / 2);
    --lumo-space-tall-m: var(--lumo-space-m) calc(var(--lumo-space-m) / 2);
    --lumo-space-tall-l: var(--lumo-space-l) calc(var(--lumo-space-l) / 2);
    --lumo-space-tall-xl: var(--lumo-space-xl) calc(var(--lumo-space-xl) / 2);
  }
`;Yv("spacing-props",oOe);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const sOe=Ye`
  :host {
    /* Border radius */
    --lumo-border-radius-s: 0.25em; /* Checkbox, badge, date-picker year indicator, etc */
    --lumo-border-radius-m: var(--lumo-border-radius, 0.25em); /* Button, text field, menu overlay, etc */
    --lumo-border-radius-l: 0.5em; /* Dialog, notification, etc */

    /* Shadow */
    --lumo-box-shadow-xs: 0 1px 4px -1px var(--lumo-shade-50pct);
    --lumo-box-shadow-s: 0 2px 4px -1px var(--lumo-shade-20pct), 0 3px 12px -1px var(--lumo-shade-30pct);
    --lumo-box-shadow-m: 0 2px 6px -1px var(--lumo-shade-20pct), 0 8px 24px -4px var(--lumo-shade-40pct);
    --lumo-box-shadow-l: 0 3px 18px -2px var(--lumo-shade-20pct), 0 12px 48px -6px var(--lumo-shade-40pct);
    --lumo-box-shadow-xl: 0 4px 24px -3px var(--lumo-shade-20pct), 0 18px 64px -8px var(--lumo-shade-40pct);

    /* Clickable element cursor */
    --lumo-clickable-cursor: default;
  }
`;Ye`
  html {
    /* Button */
    --vaadin-button-background: var(--lumo-contrast-5pct);
    --vaadin-button-border: none;
    --vaadin-button-border-radius: var(--lumo-border-radius-m);
    --vaadin-button-font-size: var(--lumo-font-size-m);
    --vaadin-button-font-weight: 500;
    --vaadin-button-height: var(--lumo-size-m);
    --vaadin-button-margin: var(--lumo-space-xs) 0;
    --vaadin-button-min-width: calc(var(--vaadin-button-height) * 2);
    --vaadin-button-padding: 0 calc(var(--vaadin-button-height) / 3 + var(--lumo-border-radius-m) / 2);
    --vaadin-button-text-color: var(--lumo-primary-text-color);
    --vaadin-button-primary-background: var(--lumo-primary-color);
    --vaadin-button-primary-border: none;
    --vaadin-button-primary-font-weight: 600;
    --vaadin-button-primary-text-color: var(--lumo-primary-contrast-color);
    --vaadin-button-tertiary-background: transparent !important;
    --vaadin-button-tertiary-text-color: var(--lumo-primary-text-color);
    --vaadin-button-tertiary-font-weight: 500;
    --vaadin-button-tertiary-padding: 0 calc(var(--vaadin-button-height) / 6);
    /* Checkbox */
    --vaadin-checkbox-background: var(--lumo-contrast-20pct);
    --vaadin-checkbox-background-hover: var(--lumo-contrast-30pct);
    --vaadin-checkbox-border-radius: var(--lumo-border-radius-s);
    --vaadin-checkbox-checkmark-char: var(--lumo-icons-checkmark);
    --vaadin-checkbox-checkmark-char-indeterminate: '';
    --vaadin-checkbox-checkmark-color: var(--lumo-primary-contrast-color);
    --vaadin-checkbox-checkmark-size: calc(var(--vaadin-checkbox-size) + 2px);
    --vaadin-checkbox-label-color: var(--lumo-body-text-color);
    --vaadin-checkbox-label-font-size: var(--lumo-font-size-m);
    --vaadin-checkbox-label-padding: var(--lumo-space-xs) var(--lumo-space-s) var(--lumo-space-xs) var(--lumo-space-xs);
    --vaadin-checkbox-size: calc(var(--lumo-size-m) / 2);
    /* Radio button */
    --vaadin-radio-button-background: var(--lumo-contrast-20pct);
    --vaadin-radio-button-background-hover: var(--lumo-contrast-30pct);
    --vaadin-radio-button-dot-color: var(--lumo-primary-contrast-color);
    --vaadin-radio-button-dot-size: 3px;
    --vaadin-radio-button-label-color: var(--lumo-body-text-color);
    --vaadin-radio-button-label-font-size: var(--lumo-font-size-m);
    --vaadin-radio-button-label-padding: var(--lumo-space-xs) var(--lumo-space-s) var(--lumo-space-xs)
      var(--lumo-space-xs);
    --vaadin-radio-button-size: calc(var(--lumo-size-m) / 2);
    --vaadin-selection-color: var(--lumo-primary-color);
    --vaadin-selection-color-text: var(--lumo-primary-text-color);
    --vaadin-input-field-border-radius: var(--lumo-border-radius-m);
    --vaadin-focus-ring-color: var(--lumo-primary-color-50pct);
    --vaadin-focus-ring-width: 2px;
    /* Label */
    --vaadin-input-field-label-color: var(--lumo-secondary-text-color);
    --vaadin-input-field-focused-label-color: var(--lumo-primary-text-color);
    --vaadin-input-field-hovered-label-color: var(--lumo-body-text-color);
    --vaadin-input-field-label-font-size: var(--lumo-font-size-s);
    --vaadin-input-field-label-font-weight: 500;
    /* Helper */
    --vaadin-input-field-helper-color: var(--lumo-secondary-text-color);
    --vaadin-input-field-helper-font-size: var(--lumo-font-size-xs);
    --vaadin-input-field-helper-font-weight: 400;
    --vaadin-input-field-helper-spacing: 0.4em;
    /* Error message */
    --vaadin-input-field-error-color: var(--lumo-error-text-color);
    --vaadin-input-field-error-font-size: var(--lumo-font-size-xs);
    --vaadin-input-field-error-font-weight: 400;
    /* Input field */
    --vaadin-input-field-background: var(--lumo-contrast-10pct);
    --vaadin-input-field-icon-color: var(--lumo-contrast-60pct);
    --vaadin-input-field-icon-size: var(--lumo-icon-size-m);
    --vaadin-input-field-invalid-background: var(--lumo-error-color-10pct);
    --vaadin-input-field-invalid-hover-highlight: var(--lumo-error-color-50pct);
    --vaadin-input-field-height: var(--lumo-size-m);
    --vaadin-input-field-hover-highlight: var(--lumo-contrast-50pct);
    --vaadin-input-field-placeholder-color: var(--lumo-secondary-text-color);
    --vaadin-input-field-readonly-border: 1px dashed var(--lumo-contrast-30pct);
    --vaadin-input-field-value-color: var(--lumo-body-text-color);
    --vaadin-input-field-value-font-size: var(--lumo-font-size-m);
    --vaadin-input-field-value-font-weight: 400;
  }
`;Yv("style-props",sOe);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const aOe=Ye`
  :host {
    /* prettier-ignore */
    --lumo-font-family: -apple-system, BlinkMacSystemFont, 'Roboto', 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';

    /* Font sizes */
    --lumo-font-size-xxs: 0.75rem;
    --lumo-font-size-xs: 0.8125rem;
    --lumo-font-size-s: 0.875rem;
    --lumo-font-size-m: 1rem;
    --lumo-font-size-l: 1.125rem;
    --lumo-font-size-xl: 1.375rem;
    --lumo-font-size-xxl: 1.75rem;
    --lumo-font-size-xxxl: 2.5rem;

    /* Line heights */
    --lumo-line-height-xs: 1.25;
    --lumo-line-height-s: 1.375;
    --lumo-line-height-m: 1.625;
  }
`,cOe=Ye`
  body,
  :host {
    font-family: var(--lumo-font-family);
    font-size: var(--lumo-font-size-m);
    line-height: var(--lumo-line-height-m);
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  small,
  [theme~='font-size-s'] {
    font-size: var(--lumo-font-size-s);
    line-height: var(--lumo-line-height-s);
  }

  [theme~='font-size-xs'] {
    font-size: var(--lumo-font-size-xs);
    line-height: var(--lumo-line-height-xs);
  }

  :where(h1, h2, h3, h4, h5, h6) {
    font-weight: 600;
    line-height: var(--lumo-line-height-xs);
    margin-block: 0;
  }

  :where(h1) {
    font-size: var(--lumo-font-size-xxxl);
  }

  :where(h2) {
    font-size: var(--lumo-font-size-xxl);
  }

  :where(h3) {
    font-size: var(--lumo-font-size-xl);
  }

  :where(h4) {
    font-size: var(--lumo-font-size-l);
  }

  :where(h5) {
    font-size: var(--lumo-font-size-m);
  }

  :where(h6) {
    font-size: var(--lumo-font-size-xs);
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  p,
  blockquote {
    margin-top: 0.5em;
    margin-bottom: 0.75em;
  }

  a {
    text-decoration: none;
  }

  a:where(:any-link):hover {
    text-decoration: underline;
  }

  hr {
    display: block;
    align-self: stretch;
    height: 1px;
    border: 0;
    padding: 0;
    margin: var(--lumo-space-s) calc(var(--lumo-border-radius-m) / 2);
    background-color: var(--lumo-contrast-10pct);
  }

  blockquote {
    border-left: 2px solid var(--lumo-contrast-30pct);
  }

  b,
  strong {
    font-weight: 600;
  }

  /* RTL specific styles */
  blockquote[dir='rtl'] {
    border-left: none;
    border-right: 2px solid var(--lumo-contrast-30pct);
  }
`;gc("",cOe,{moduleId:"lumo-typography"});Yv("typography-props",aOe);const lOe=Ye`
  :host {
    /* Sizing */
    --lumo-button-size: var(--lumo-size-m);
    min-width: var(--vaadin-button-min-width, calc(var(--_button-size) * 2));
    height: var(--_button-size);
    padding: var(--vaadin-button-padding, 0 calc(var(--_button-size) / 3 + var(--lumo-border-radius-m) / 2));
    margin: var(--vaadin-button-margin, var(--lumo-space-xs) 0);
    box-sizing: border-box;
    /* Style */
    font-family: var(--lumo-font-family);
    font-size: var(--vaadin-button-font-size, var(--lumo-font-size-m));
    font-weight: var(--vaadin-button-font-weight, 500);
    color: var(--_lumo-button-text-color);
    background: var(--_lumo-button-background);
    border: var(--vaadin-button-border, none);
    border-radius: var(--vaadin-button-border-radius, var(--lumo-border-radius-m));
    cursor: var(--lumo-clickable-cursor);
    -webkit-tap-highlight-color: transparent;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    flex-shrink: 0;
    --_button-size: var(--vaadin-button-height, var(--lumo-button-size));
    --_focus-ring-color: var(--vaadin-focus-ring-color, var(--lumo-primary-color-50pct));
    --_focus-ring-width: var(--vaadin-focus-ring-width, 2px);
    /* Used by notification */
    --_lumo-button-background: var(--vaadin-button-background, var(--lumo-contrast-5pct));
    --_lumo-button-text-color: var(--vaadin-button-text-color, var(--lumo-primary-text-color));
    --_lumo-button-primary-background: var(--vaadin-button-primary-background, var(--lumo-primary-color));
    --_lumo-button-primary-text-color: var(--vaadin-button-primary-text-color, var(--lumo-primary-contrast-color));
  }

  /* Set only for the internal parts so we don't affect the host vertical alignment */
  [part='label'],
  [part='prefix'],
  [part='suffix'] {
    line-height: var(--lumo-line-height-xs);
  }

  [part='label'] {
    padding: calc(var(--lumo-button-size) / 6) 0;
  }

  :host([theme~='small']) {
    font-size: var(--lumo-font-size-s);
    --lumo-button-size: var(--lumo-size-s);
  }

  :host([theme~='large']) {
    font-size: var(--lumo-font-size-l);
    --lumo-button-size: var(--lumo-size-l);
  }

  /* For interaction states */
  :host::before,
  :host::after {
    content: '';
    /* We rely on the host always being relative */
    position: absolute;
    z-index: 1;
    inset: 0;
    background-color: currentColor;
    border-radius: inherit;
    opacity: 0;
    pointer-events: none;
  }

  /* Hover */

  @media (any-hover: hover) {
    :host(:hover)::before {
      opacity: 0.02;
    }
  }

  /* Active */

  :host::after {
    transition: opacity 1.4s, transform 0.1s;
    filter: blur(8px);
  }

  :host([active])::before {
    opacity: 0.05;
    transition-duration: 0s;
  }

  :host([active])::after {
    opacity: 0.1;
    transition-duration: 0s, 0s;
    transform: scale(0);
  }

  /* Keyboard focus */

  :host([focus-ring]) {
    box-shadow: 0 0 0 var(--_focus-ring-width) var(--_focus-ring-color);
  }

  :host([theme~='primary'][focus-ring]) {
    box-shadow: 0 0 0 1px var(--lumo-base-color), 0 0 0 3px var(--lumo-primary-color-50pct);
  }

  /* Types (primary, tertiary, tertiary-inline */

  :host([theme~='tertiary']),
  :host([theme~='tertiary-inline']) {
    --_background: transparent !important;
    background: var(--vaadin-button-tertiary-background, var(--_background));
    min-width: 0;
  }

  :host([theme~='tertiary']) {
    border: var(--vaadin-button-tertiary-border, none);
    color: var(--vaadin-button-tertiary-text-color, var(--lumo-primary-text-color));
    font-weight: var(--vaadin-button-tertiary-font-weight, 500);
    padding: var(--vaadin-button-tertiary-padding, 0 calc(var(--_button-size) / 6));
  }

  :host([theme~='tertiary-inline'])::before {
    display: none;
  }

  :host([theme~='tertiary-inline']) {
    margin: 0;
    height: auto;
    padding: 0;
    line-height: inherit;
    font-size: inherit;
  }

  :host([theme~='tertiary-inline']) [part='label'] {
    padding: 0;
    overflow: visible;
    line-height: inherit;
  }

  :host([theme~='primary']) {
    background: var(--_lumo-button-primary-background);
    border: var(--vaadin-button-primary-border, none);
    color: var(--_lumo-button-primary-text-color);
    font-weight: var(--vaadin-button-primary-font-weight, 600);
    min-width: calc(var(--lumo-button-size) * 2.5);
  }

  :host([theme~='primary'])::before {
    background-color: black;
  }

  @media (any-hover: hover) {
    :host([theme~='primary']:hover)::before {
      opacity: 0.05;
    }
  }

  :host([theme~='primary'][active])::before {
    opacity: 0.1;
  }

  :host([theme~='primary'][active])::after {
    opacity: 0.2;
  }

  /* Colors (success, error, contrast) */

  :host([theme~='success']) {
    color: var(--lumo-success-text-color);
  }

  :host([theme~='success'][theme~='primary']) {
    background-color: var(--lumo-success-color);
    color: var(--lumo-success-contrast-color);
  }

  :host([theme~='error']) {
    color: var(--lumo-error-text-color);
  }

  :host([theme~='error'][theme~='primary']) {
    background-color: var(--lumo-error-color);
    color: var(--lumo-error-contrast-color);
  }

  :host([theme~='contrast']) {
    color: var(--lumo-contrast);
  }

  :host([theme~='contrast'][theme~='primary']) {
    background-color: var(--lumo-contrast);
    color: var(--lumo-base-color);
  }

  /* Disabled state. Keep selectors after other color variants. */

  :host([disabled]) {
    pointer-events: none;
    color: var(--lumo-disabled-text-color);
  }

  :host([theme~='primary'][disabled]) {
    background-color: var(--lumo-contrast-30pct);
    color: var(--lumo-base-color);
  }

  :host([theme~='primary'][disabled]) [part] {
    opacity: 0.7;
  }

  /* Icons */

  [part] ::slotted(vaadin-icon) {
    display: inline-block;
    width: var(--lumo-icon-size-m);
    height: var(--lumo-icon-size-m);
  }

  /* Vaadin icons are based on a 16x16 grid (unlike Lumo and Material icons with 24x24), so they look too big by default */
  [part] ::slotted(vaadin-icon[icon^='vaadin:']) {
    padding: 0.25em;
    box-sizing: border-box !important;
  }

  [part='prefix'] {
    margin-left: -0.25em;
    margin-right: 0.25em;
  }

  [part='suffix'] {
    margin-left: 0.25em;
    margin-right: -0.25em;
  }

  /* Icon-only */

  :host([theme~='icon']:not([theme~='tertiary-inline'])) {
    min-width: var(--lumo-button-size);
    padding-left: calc(var(--lumo-button-size) / 4);
    padding-right: calc(var(--lumo-button-size) / 4);
  }

  :host([theme~='icon']) [part='prefix'],
  :host([theme~='icon']) [part='suffix'] {
    margin-left: 0;
    margin-right: 0;
  }

  /* RTL specific styles */

  :host([dir='rtl']) [part='prefix'] {
    margin-left: 0.25em;
    margin-right: -0.25em;
  }

  :host([dir='rtl']) [part='suffix'] {
    margin-left: -0.25em;
    margin-right: 0.25em;
  }

  :host([dir='rtl'][theme~='icon']) [part='prefix'],
  :host([dir='rtl'][theme~='icon']) [part='suffix'] {
    margin-left: 0;
    margin-right: 0;
  }
`;gc("vaadin-button",lOe,{moduleId:"lumo-button"});/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/window.JSCompiler_renameProperty=function(r,e){return r};/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let dOe=/(url\()([^)]*)(\))/g,uOe=/(^\/[^\/])|(^#)|(^[\w-\d]*:)/,K2,Zs;function uw(r,e){if(r&&uOe.test(r)||r==="//")return r;if(K2===void 0){K2=!1;try{const t=new URL("b","http://a");t.pathname="c%20d",K2=t.href==="http://a/c%20d"}catch{}}if(e||(e=document.baseURI||window.location.href),K2)try{return new URL(r,e).href}catch{return r}return Zs||(Zs=document.implementation.createHTMLDocument("temp"),Zs.base=Zs.createElement("base"),Zs.head.appendChild(Zs.base),Zs.anchor=Zs.createElement("a"),Zs.body.appendChild(Zs.anchor)),Zs.base.href=e,Zs.anchor.href=r,Zs.anchor.href||r}function E6(r,e){return r.replace(dOe,function(t,n,i,o){return n+"'"+uw(i.replace(/["']/g,""),e)+"'"+o})}function A6(r){return r.substring(0,r.lastIndexOf("/")+1)}/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const fOe=!window.ShadyDOM||!window.ShadyDOM.inUse;!window.ShadyCSS||window.ShadyCSS.nativeCss;const hOe=fOe&&"adoptedStyleSheets"in Document.prototype&&"replaceSync"in CSSStyleSheet.prototype&&(()=>{try{const r=new CSSStyleSheet;r.replaceSync("");const e=document.createElement("div");return e.attachShadow({mode:"open"}),e.shadowRoot.adoptedStyleSheets=[r],e.shadowRoot.adoptedStyleSheets[0]===r}catch{return!1}})();let pOe=window.Polymer&&window.Polymer.rootPath||A6(document.baseURI||window.location.href),px=window.Polymer&&window.Polymer.sanitizeDOMValue||void 0;window.Polymer&&window.Polymer.setPassiveTouchGestures;let k5=window.Polymer&&window.Polymer.strictTemplatePolicy||!1,yOe=window.Polymer&&window.Polymer.allowTemplateFromDomModule||!1,mOe=window.Polymer&&window.Polymer.legacyOptimizations||!1,gOe=window.Polymer&&window.Polymer.legacyWarnings||!1,vOe=window.Polymer&&window.Polymer.syncInitialRender||!1,P5=window.Polymer&&window.Polymer.legacyUndefined||!1,bOe=window.Polymer&&window.Polymer.orderedComputed||!1,VU=window.Polymer&&window.Polymer.removeNestedTemplates||!1,wOe=window.Polymer&&window.Polymer.fastDomIf||!1;window.Polymer&&window.Polymer.suppressTemplateNotifications;window.Polymer&&window.Polymer.legacyNoObservedAttributes;let _Oe=window.Polymer&&window.Polymer.useAdoptedStyleSheetsWithBuiltCSS||!1;/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let EOe=0;const _d=function(r){let e=r.__mixinApplications;e||(e=new WeakMap,r.__mixinApplications=e);let t=EOe++;function n(i){let o=i.__mixinSet;if(o&&o[t])return i;let s=e,a=s.get(i);if(!a){a=r(i),s.set(i,a);let l=Object.create(a.__mixinSet||o||null);l[t]=!0,a.__mixinSet=l}return a}return n};/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let x6={},sG={};function WU(r,e){x6[r]=sG[r.toLowerCase()]=e}function HU(r){return x6[r]||sG[r.toLowerCase()]}function AOe(r){r.querySelector("style")&&console.warn("dom-module %s has style outside template",r.id)}class i_ extends HTMLElement{static get observedAttributes(){return["id"]}static import(e,t){if(e){let n=HU(e);return n&&t?n.querySelector(t):n}return null}attributeChangedCallback(e,t,n,i){t!==n&&this.register()}get assetpath(){if(!this.__assetpath){const e=window.HTMLImports&&HTMLImports.importForElement?HTMLImports.importForElement(this)||document:this.ownerDocument,t=uw(this.getAttribute("assetpath")||"",e.baseURI);this.__assetpath=A6(t)}return this.__assetpath}register(e){if(e=e||this.id,e){if(k5&&HU(e)!==void 0)throw WU(e,null),new Error(`strictTemplatePolicy: dom-module ${e} re-registered`);this.id=e,WU(e,this),AOe(this)}}}i_.prototype.modules=x6;customElements.define("dom-module",i_);/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const xOe="link[rel=import][type~=css]",SOe="include",GU="shady-unscoped";function aG(r){return i_.import(r)}function YU(r){let e=r.body?r.body:r;const t=E6(e.textContent,r.baseURI),n=document.createElement("style");return n.textContent=t,n}function TOe(r){const e=r.trim().split(/\s+/),t=[];for(let n=0;n<e.length;n++)t.push(...$Oe(e[n]));return t}function $Oe(r){const e=aG(r);if(!e)return console.warn("Could not find style data in module named",r),[];if(e._styles===void 0){const t=[];t.push(...lG(e));const n=e.querySelector("template");n&&t.push(...cG(n,e.assetpath)),e._styles=t}return e._styles}function cG(r,e){if(!r._styles){const t=[],n=r.content.querySelectorAll("style");for(let i=0;i<n.length;i++){let o=n[i],s=o.getAttribute(SOe);s&&t.push(...TOe(s).filter(function(a,l,d){return d.indexOf(a)===l})),e&&(o.textContent=E6(o.textContent,e)),t.push(o)}r._styles=t}return r._styles}function kOe(r){let e=aG(r);return e?lG(e):[]}function lG(r){const e=[],t=r.querySelectorAll(xOe);for(let n=0;n<t.length;n++){let i=t[n];if(i.import){const o=i.import,s=i.hasAttribute(GU);if(s&&!o._unscopedStyle){const a=YU(o);a.setAttribute(GU,""),o._unscopedStyle=a}else o._style||(o._style=YU(o));e.push(s?o._unscopedStyle:o._style)}}return e}/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const Ey=window.ShadyDOM&&window.ShadyDOM.noPatch&&window.ShadyDOM.wrap?window.ShadyDOM.wrap:window.ShadyDOM?r=>ShadyDOM.patch(r):r=>r;/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function I5(r){return r.indexOf(".")>=0}function fm(r){let e=r.indexOf(".");return e===-1?r:r.slice(0,e)}function POe(r,e){return r.indexOf(e+".")===0}function yx(r,e){return e.indexOf(r+".")===0}function mx(r,e,t){return e+t.slice(r.length)}function Cb(r){if(Array.isArray(r)){let e=[];for(let t=0;t<r.length;t++){let n=r[t].toString().split(".");for(let i=0;i<n.length;i++)e.push(n[i])}return e.join(".")}else return r}function dG(r){return Array.isArray(r)?Cb(r).split("."):r.toString().split(".")}function Ss(r,e,t){let n=r,i=dG(e);for(let o=0;o<i.length;o++){if(!n)return;let s=i[o];n=n[s]}return t&&(t.path=i.join(".")),n}function ZU(r,e,t){let n=r,i=dG(e),o=i[i.length-1];if(i.length>1){for(let s=0;s<i.length-1;s++){let a=i[s];if(n=n[a],!n)return}n[o]=t}else n[e]=t;return i.join(".")}/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const gx={},IOe=/-[a-z]/g,OOe=/([A-Z])/g;function uG(r){return gx[r]||(gx[r]=r.indexOf("-")<0?r:r.replace(IOe,e=>e[1].toUpperCase()))}function uT(r){return gx[r]||(gx[r]=r.replace(OOe,"-$1").toLowerCase())}/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let COe=0,fG=0,Sg=[],ROe=0,O5=!1,hG=document.createTextNode("");new window.MutationObserver(DOe).observe(hG,{characterData:!0});function DOe(){O5=!1;const r=Sg.length;for(let e=0;e<r;e++){let t=Sg[e];if(t)try{t()}catch(n){setTimeout(()=>{throw n})}}Sg.splice(0,r),fG+=r}const MOe={run(r){return O5||(O5=!0,hG.textContent=ROe++),Sg.push(r),COe++},cancel(r){const e=r-fG;if(e>=0){if(!Sg[e])throw new Error("invalid async handle: "+r);Sg[e]=null}}};/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const BOe=MOe,pG=_d(r=>{class e extends r{static createProperties(n){const i=this.prototype;for(let o in n)o in i||i._createPropertyAccessor(o)}static attributeNameForProperty(n){return n.toLowerCase()}static typeForProperty(n){}_createPropertyAccessor(n,i){this._addPropertyToAttributeMap(n),this.hasOwnProperty(JSCompiler_renameProperty("__dataHasAccessor",this))||(this.__dataHasAccessor=Object.assign({},this.__dataHasAccessor)),this.__dataHasAccessor[n]||(this.__dataHasAccessor[n]=!0,this._definePropertyAccessor(n,i))}_addPropertyToAttributeMap(n){this.hasOwnProperty(JSCompiler_renameProperty("__dataAttributes",this))||(this.__dataAttributes=Object.assign({},this.__dataAttributes));let i=this.__dataAttributes[n];return i||(i=this.constructor.attributeNameForProperty(n),this.__dataAttributes[i]=n),i}_definePropertyAccessor(n,i){Object.defineProperty(this,n,{get(){return this.__data[n]},set:i?function(){}:function(o){this._setPendingProperty(n,o,!0)&&this._invalidateProperties()}})}constructor(){super(),this.__dataEnabled=!1,this.__dataReady=!1,this.__dataInvalid=!1,this.__data={},this.__dataPending=null,this.__dataOld=null,this.__dataInstanceProps=null,this.__dataCounter=0,this.__serializing=!1,this._initializeProperties()}ready(){this.__dataReady=!0,this._flushProperties()}_initializeProperties(){for(let n in this.__dataHasAccessor)this.hasOwnProperty(n)&&(this.__dataInstanceProps=this.__dataInstanceProps||{},this.__dataInstanceProps[n]=this[n],delete this[n])}_initializeInstanceProperties(n){Object.assign(this,n)}_setProperty(n,i){this._setPendingProperty(n,i)&&this._invalidateProperties()}_getProperty(n){return this.__data[n]}_setPendingProperty(n,i,o){let s=this.__data[n],a=this._shouldPropertyChange(n,i,s);return a&&(this.__dataPending||(this.__dataPending={},this.__dataOld={}),this.__dataOld&&!(n in this.__dataOld)&&(this.__dataOld[n]=s),this.__data[n]=i,this.__dataPending[n]=i),a}_isPropertyPending(n){return!!(this.__dataPending&&this.__dataPending.hasOwnProperty(n))}_invalidateProperties(){!this.__dataInvalid&&this.__dataReady&&(this.__dataInvalid=!0,BOe.run(()=>{this.__dataInvalid&&(this.__dataInvalid=!1,this._flushProperties())}))}_enableProperties(){this.__dataEnabled||(this.__dataEnabled=!0,this.__dataInstanceProps&&(this._initializeInstanceProperties(this.__dataInstanceProps),this.__dataInstanceProps=null),this.ready())}_flushProperties(){this.__dataCounter++;const n=this.__data,i=this.__dataPending,o=this.__dataOld;this._shouldPropertiesChange(n,i,o)&&(this.__dataPending=null,this.__dataOld=null,this._propertiesChanged(n,i,o)),this.__dataCounter--}_shouldPropertiesChange(n,i,o){return!!i}_propertiesChanged(n,i,o){}_shouldPropertyChange(n,i,o){return o!==i&&(o===o||i===i)}attributeChangedCallback(n,i,o,s){i!==o&&this._attributeToProperty(n,o),super.attributeChangedCallback&&super.attributeChangedCallback(n,i,o,s)}_attributeToProperty(n,i,o){if(!this.__serializing){const s=this.__dataAttributes,a=s&&s[n]||n;this[a]=this._deserializeValue(i,o||this.constructor.typeForProperty(a))}}_propertyToAttribute(n,i,o){this.__serializing=!0,o=arguments.length<3?this[n]:o,this._valueToNodeAttribute(this,o,i||this.constructor.attributeNameForProperty(n)),this.__serializing=!1}_valueToNodeAttribute(n,i,o){const s=this._serializeValue(i);(o==="class"||o==="name"||o==="slot")&&(n=Ey(n)),s===void 0?n.removeAttribute(o):n.setAttribute(o,s===""&&window.trustedTypes?window.trustedTypes.emptyScript:s)}_serializeValue(n){switch(typeof n){case"boolean":return n?"":void 0;default:return n?.toString()}}_deserializeValue(n,i){switch(i){case Boolean:return n!==null;case Number:return Number(n);default:return n}}}return e});/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const yG={};let z2=HTMLElement.prototype;for(;z2;){let r=Object.getOwnPropertyNames(z2);for(let e=0;e<r.length;e++)yG[r[e]]=!0;z2=Object.getPrototypeOf(z2)}const jOe=window.trustedTypes?r=>trustedTypes.isHTML(r)||trustedTypes.isScript(r)||trustedTypes.isScriptURL(r):()=>!1;function NOe(r,e){if(!yG[e]){let t=r[e];t!==void 0&&(r.__data?r._setPendingProperty(e,t):(r.__dataProto?r.hasOwnProperty(JSCompiler_renameProperty("__dataProto",r))||(r.__dataProto=Object.create(r.__dataProto)):r.__dataProto={},r.__dataProto[e]=t))}}const UOe=_d(r=>{const e=pG(r);class t extends e{static createPropertiesForAttributes(){let i=this.observedAttributes;for(let o=0;o<i.length;o++)this.prototype._createPropertyAccessor(uG(i[o]))}static attributeNameForProperty(i){return uT(i)}_initializeProperties(){this.__dataProto&&(this._initializeProtoProperties(this.__dataProto),this.__dataProto=null),super._initializeProperties()}_initializeProtoProperties(i){for(let o in i)this._setProperty(o,i[o])}_ensureAttribute(i,o){const s=this;s.hasAttribute(i)||this._valueToNodeAttribute(s,o,i)}_serializeValue(i){switch(typeof i){case"object":if(i instanceof Date)return i.toString();if(i){if(jOe(i))return i;try{return JSON.stringify(i)}catch{return""}}default:return super._serializeValue(i)}}_deserializeValue(i,o){let s;switch(o){case Object:try{s=JSON.parse(i)}catch{s=i}break;case Array:try{s=JSON.parse(i)}catch{s=null,console.warn(`Polymer::Attributes: couldn't decode Array as JSON: ${i}`)}break;case Date:s=isNaN(i)?String(i):Number(i),s=new Date(s);break;default:s=super._deserializeValue(i,o);break}return s}_definePropertyAccessor(i,o){NOe(this,i),super._definePropertyAccessor(i,o)}_hasAccessor(i){return this.__dataHasAccessor&&this.__dataHasAccessor[i]}_isPropertyPending(i){return!!(this.__dataPending&&i in this.__dataPending)}}return t});/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const LOe={"dom-if":!0,"dom-repeat":!0};let JU=!1,XU=!1;function KOe(){if(!JU){JU=!0;const r=document.createElement("textarea");r.placeholder="a",XU=r.placeholder===r.textContent}return XU}function zOe(r){KOe()&&r.localName==="textarea"&&r.placeholder&&r.placeholder===r.textContent&&(r.textContent=null)}const FOe=(()=>{const r=window.trustedTypes&&window.trustedTypes.createPolicy("polymer-template-event-attribute-policy",{createScript:e=>e});return(e,t,n)=>{const i=t.getAttribute(n);if(r&&n.startsWith("on-")){e.setAttribute(n,r.createScript(i,n));return}e.setAttribute(n,i)}})();function qOe(r){let e=r.getAttribute("is");if(e&&LOe[e]){let t=r;for(t.removeAttribute("is"),r=t.ownerDocument.createElement(e),t.parentNode.replaceChild(r,t),r.appendChild(t);t.attributes.length;){const{name:n}=t.attributes[0];FOe(r,t,n),t.removeAttribute(n)}}return r}function mG(r,e){let t=e.parentInfo&&mG(r,e.parentInfo);if(t){for(let n=t.firstChild,i=0;n;n=n.nextSibling)if(e.parentIndex===i++)return n}else return r}function VOe(r,e,t,n){n.id&&(e[n.id]=t)}function WOe(r,e,t){if(t.events&&t.events.length)for(let n=0,i=t.events,o;n<i.length&&(o=i[n]);n++)r._addMethodEventListenerToNode(e,o.name,o.value,r)}function HOe(r,e,t,n){t.templateInfo&&(e._templateInfo=t.templateInfo,e._parentTemplateInfo=n)}function GOe(r,e,t){return r=r._methodHost||r,function(i){r[t]?r[t](i,i.detail):console.warn("listener method `"+t+"` not defined")}}const YOe=_d(r=>{class e extends r{static _parseTemplate(n,i){if(!n._templateInfo){let o=n._templateInfo={};o.nodeInfoList=[],o.nestedTemplate=!!i,o.stripWhiteSpace=i&&i.stripWhiteSpace||n.hasAttribute&&n.hasAttribute("strip-whitespace"),this._parseTemplateContent(n,o,{parent:null})}return n._templateInfo}static _parseTemplateContent(n,i,o){return this._parseTemplateNode(n.content,i,o)}static _parseTemplateNode(n,i,o){let s=!1,a=n;return a.localName=="template"&&!a.hasAttribute("preserve-content")?s=this._parseTemplateNestedTemplate(a,i,o)||s:a.localName==="slot"&&(i.hasInsertionPoint=!0),zOe(a),a.firstChild&&this._parseTemplateChildNodes(a,i,o),a.hasAttributes&&a.hasAttributes()&&(s=this._parseTemplateNodeAttributes(a,i,o)||s),s||o.noted}static _parseTemplateChildNodes(n,i,o){if(!(n.localName==="script"||n.localName==="style"))for(let s=n.firstChild,a=0,l;s;s=l){if(s.localName=="template"&&(s=qOe(s)),l=s.nextSibling,s.nodeType===Node.TEXT_NODE){let c=l;for(;c&&c.nodeType===Node.TEXT_NODE;)s.textContent+=c.textContent,l=c.nextSibling,n.removeChild(c),c=l;if(i.stripWhiteSpace&&!s.textContent.trim()){n.removeChild(s);continue}}let d={parentIndex:a,parentInfo:o};this._parseTemplateNode(s,i,d)&&(d.infoIndex=i.nodeInfoList.push(d)-1),s.parentNode&&a++}}static _parseTemplateNestedTemplate(n,i,o){let s=n,a=this._parseTemplate(s,i);return(a.content=s.content.ownerDocument.createDocumentFragment()).appendChild(s.content),o.templateInfo=a,!0}static _parseTemplateNodeAttributes(n,i,o){let s=!1,a=Array.from(n.attributes);for(let l=a.length-1,d;d=a[l];l--)s=this._parseTemplateNodeAttribute(n,i,o,d.name,d.value)||s;return s}static _parseTemplateNodeAttribute(n,i,o,s,a){return s.slice(0,3)==="on-"?(n.removeAttribute(s),o.events=o.events||[],o.events.push({name:s.slice(3),value:a}),!0):s==="id"?(o.id=a,!0):!1}static _contentForTemplate(n){let i=n._templateInfo;return i&&i.content||n.content}_stampTemplate(n,i){n&&!n.content&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(n),i=i||this.constructor._parseTemplate(n);let o=i.nodeInfoList,s=i.content||n.content,a=document.importNode(s,!0);a.__noInsertionPoint=!i.hasInsertionPoint;let l=a.nodeList=new Array(o.length);a.$={};for(let d=0,c=o.length,u;d<c&&(u=o[d]);d++){let f=l[d]=mG(a,u);VOe(this,a.$,f,u),HOe(this,f,u,i),WOe(this,f,u)}return a=a,a}_addMethodEventListenerToNode(n,i,o,s){s=s||n;let a=GOe(s,i,o);return this._addEventListenerToNode(n,i,a),a}_addEventListenerToNode(n,i,o){n.addEventListener(i,o)}_removeEventListenerFromNode(n,i,o){n.removeEventListener(i,o)}}return e});/**
 * @fileoverview
 * @suppress {checkPrototypalTypes}
 * @license Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt The complete set of authors may be found
 * at http://polymer.github.io/AUTHORS.txt The complete set of contributors may
 * be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by
 * Google as part of the polymer project is also subject to an additional IP
 * rights grant found at http://polymer.github.io/PATENTS.txt
 */let o_=0;const s_=[],_r={COMPUTE:"__computeEffects",REFLECT:"__reflectEffects",NOTIFY:"__notifyEffects",PROPAGATE:"__propagateEffects",OBSERVE:"__observeEffects",READ_ONLY:"__readOnly"},gG="__computeInfo",ZOe=/[A-Z]/;function eP(r,e,t){let n=r[e];if(!n)n=r[e]={};else if(!r.hasOwnProperty(e)&&(n=r[e]=Object.create(r[e]),t))for(let i in n){let o=n[i],s=n[i]=Array(o.length);for(let a=0;a<o.length;a++)s[a]=o[a]}return n}function Rb(r,e,t,n,i,o){if(e){let s=!1;const a=o_++;for(let l in t){let d=i?fm(l):l,c=e[d];if(c)for(let u=0,f=c.length,h;u<f&&(h=c[u]);u++)(!h.info||h.info.lastRun!==a)&&(!i||S6(l,h.trigger))&&(h.info&&(h.info.lastRun=a),h.fn(r,l,t,n,h.info,i,o),s=!0)}return s}return!1}function JOe(r,e,t,n,i,o,s,a){let l=!1,d=s?fm(n):n,c=e[d];if(c)for(let u=0,f=c.length,h;u<f&&(h=c[u]);u++)(!h.info||h.info.lastRun!==t)&&(!s||S6(n,h.trigger))&&(h.info&&(h.info.lastRun=t),h.fn(r,n,i,o,h.info,s,a),l=!0);return l}function S6(r,e){if(e){let t=e.name;return t==r||!!(e.structured&&POe(t,r))||!!(e.wildcard&&yx(t,r))}else return!0}function QU(r,e,t,n,i){let o=typeof i.method=="string"?r[i.method]:i.method,s=i.property;o?o.call(r,r.__data[s],n[s]):i.dynamicFn||console.warn("observer method `"+i.method+"` not defined")}function XOe(r,e,t,n,i){let o=r[_r.NOTIFY],s,a=o_++;for(let d in e)e[d]&&(o&&JOe(r,o,a,d,t,n,i)||i&&QOe(r,d,t))&&(s=!0);let l;s&&(l=r.__dataHost)&&l._invalidateProperties&&l._invalidateProperties()}function QOe(r,e,t){let n=fm(e);if(n!==e){let i=uT(n)+"-changed";return vG(r,i,t[e],e),!0}return!1}function vG(r,e,t,n){let i={value:t,queueProperty:!0};n&&(i.path=n),Ey(r).dispatchEvent(new CustomEvent(e,{detail:i}))}function eCe(r,e,t,n,i,o){let a=(o?fm(e):e)!=e?e:null,l=a?Ss(r,a):r.__data[e];a&&l===void 0&&(l=t[e]),vG(r,i.eventName,l,a)}function tCe(r,e,t,n,i){let o,s=r.detail,a=s&&s.path;a?(n=mx(t,n,a),o=s&&s.value):o=r.currentTarget[t],o=i?!o:o,(!e[_r.READ_ONLY]||!e[_r.READ_ONLY][n])&&e._setPendingPropertyOrPath(n,o,!0,!!a)&&(!s||!s.queueProperty)&&e._invalidateProperties()}function rCe(r,e,t,n,i){let o=r.__data[e];px&&(o=px(o,i.attrName,"attribute",r)),r._propertyToAttribute(e,i.attrName,o)}function nCe(r,e,t,n){let i=r[_r.COMPUTE];if(i)if(bOe){o_++;const o=oCe(r),s=[];for(let l in e)eL(l,i,s,o,n);let a;for(;a=s.shift();)bG(r,"",e,t,a)&&eL(a.methodInfo,i,s,o,n);Object.assign(t,r.__dataOld),Object.assign(e,r.__dataPending),r.__dataPending=null}else{let o=e;for(;Rb(r,i,o,t,n);)Object.assign(t,r.__dataOld),Object.assign(e,r.__dataPending),o=r.__dataPending,r.__dataPending=null}}const iCe=(r,e,t)=>{let n=0,i=e.length-1,o=-1;for(;n<=i;){const s=n+i>>1,a=t.get(e[s].methodInfo)-t.get(r.methodInfo);if(a<0)n=s+1;else if(a>0)i=s-1;else{o=s;break}}o<0&&(o=i+1),e.splice(o,0,r)},eL=(r,e,t,n,i)=>{const o=i?fm(r):r,s=e[o];if(s)for(let a=0;a<s.length;a++){const l=s[a];l.info.lastRun!==o_&&(!i||S6(r,l.trigger))&&(l.info.lastRun=o_,iCe(l.info,t,n))}};function oCe(r){let e=r.constructor.__orderedComputedDeps;if(!e){e=new Map;const t=r[_r.COMPUTE];let{counts:n,ready:i,total:o}=sCe(r),s;for(;s=i.shift();){e.set(s,e.size);const a=t[s];a&&a.forEach(l=>{const d=l.info.methodInfo;--o,--n[d]===0&&i.push(d)})}o!==0&&console.warn(`Computed graph for ${r.localName} incomplete; circular?`),r.constructor.__orderedComputedDeps=e}return e}function sCe(r){const e=r[gG],t={},n=r[_r.COMPUTE],i=[];let o=0;for(let s in e){const a=e[s];o+=t[s]=a.args.filter(l=>!l.literal).length+(a.dynamicFn?1:0)}for(let s in n)e[s]||i.push(s);return{counts:t,ready:i,total:o}}function bG(r,e,t,n,i){let o=C5(r,e,t,n,i);if(o===s_)return!1;let s=i.methodInfo;return r.__dataHasAccessor&&r.__dataHasAccessor[s]?r._setPendingProperty(s,o,!0):(r[s]=o,!1)}function aCe(r,e,t){let n=r.__dataLinkedPaths;if(n){let i;for(let o in n){let s=n[o];yx(o,e)?(i=mx(o,s,e),r._setPendingPropertyOrPath(i,t,!0,!0)):yx(s,e)&&(i=mx(s,o,e),r._setPendingPropertyOrPath(i,t,!0,!0))}}}function tP(r,e,t,n,i,o,s){t.bindings=t.bindings||[];let a={kind:n,target:i,parts:o,literal:s,isCompound:o.length!==1};if(t.bindings.push(a),fCe(a)){let{event:d,negate:c}=a.parts[0];a.listenerEvent=d||uT(i)+"-changed",a.listenerNegate=c}let l=e.nodeInfoList.length;for(let d=0;d<a.parts.length;d++){let c=a.parts[d];c.compoundIndex=d,cCe(r,e,a,c,l)}}function cCe(r,e,t,n,i){if(!n.literal)if(t.kind==="attribute"&&t.target[0]==="-")console.warn("Cannot set attribute "+t.target+' because "-" is not a valid attribute starting character');else{let o=n.dependencies,s={index:i,binding:t,part:n,evaluator:r};for(let a=0;a<o.length;a++){let l=o[a];typeof l=="string"&&(l=_G(l),l.wildcard=!0),r._addTemplatePropertyEffect(e,l.rootProperty,{fn:lCe,info:s,trigger:l})}}}function lCe(r,e,t,n,i,o,s){let a=s[i.index],l=i.binding,d=i.part;if(o&&d.source&&e.length>d.source.length&&l.kind=="property"&&!l.isCompound&&a.__isPropertyEffectsClient&&a.__dataHasAccessor&&a.__dataHasAccessor[l.target]){let c=t[e];e=mx(d.source,l.target,e),a._setPendingPropertyOrPath(e,c,!1,!0)&&r._enqueueClient(a)}else{let c=i.evaluator._evaluateBinding(r,d,e,t,n,o);c!==s_&&dCe(r,a,l,d,c)}}function dCe(r,e,t,n,i){if(i=uCe(e,i,t,n),px&&(i=px(i,t.target,t.kind,e)),t.kind=="attribute")r._valueToNodeAttribute(e,i,t.target);else{let o=t.target;e.__isPropertyEffectsClient&&e.__dataHasAccessor&&e.__dataHasAccessor[o]?(!e[_r.READ_ONLY]||!e[_r.READ_ONLY][o])&&e._setPendingProperty(o,i)&&r._enqueueClient(e):r._setUnmanagedPropertyToNode(e,o,i)}}function uCe(r,e,t,n){if(t.isCompound){let i=r.__dataCompoundStorage[t.target];i[n.compoundIndex]=e,e=i.join("")}return t.kind!=="attribute"&&(t.target==="textContent"||t.target==="value"&&(r.localName==="input"||r.localName==="textarea"))&&(e=e??""),e}function fCe(r){return!!r.target&&r.kind!="attribute"&&r.kind!="text"&&!r.isCompound&&r.parts[0].mode==="{"}function hCe(r,e){let{nodeList:t,nodeInfoList:n}=e;if(n.length)for(let i=0;i<n.length;i++){let o=n[i],s=t[i],a=o.bindings;if(a)for(let l=0;l<a.length;l++){let d=a[l];pCe(s,d),yCe(s,r,d)}s.__dataHost=r}}function pCe(r,e){if(e.isCompound){let t=r.__dataCompoundStorage||(r.__dataCompoundStorage={}),n=e.parts,i=new Array(n.length);for(let s=0;s<n.length;s++)i[s]=n[s].literal;let o=e.target;t[o]=i,e.literal&&e.kind=="property"&&(o==="className"&&(r=Ey(r)),r[o]=e.literal)}}function yCe(r,e,t){if(t.listenerEvent){let n=t.parts[0];r.addEventListener(t.listenerEvent,function(i){tCe(i,e,t.target,n.source,n.negate)})}}function tL(r,e,t,n,i,o){o=e.static||o&&(typeof o!="object"||o[e.methodName]);let s={methodName:e.methodName,args:e.args,methodInfo:i,dynamicFn:o};for(let a=0,l;a<e.args.length&&(l=e.args[a]);a++)l.literal||r._addPropertyEffect(l.rootProperty,t,{fn:n,info:s,trigger:l});return o&&r._addPropertyEffect(e.methodName,t,{fn:n,info:s}),s}function C5(r,e,t,n,i){let o=r._methodHost||r,s=o[i.methodName];if(s){let a=r._marshalArgs(i.args,e,t);return a===s_?s_:s.apply(o,a)}else i.dynamicFn||console.warn("method `"+i.methodName+"` not defined")}const mCe=[],wG="(?:[a-zA-Z_$][\\w.:$\\-*]*)",gCe="(?:[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)",vCe="(?:'(?:[^'\\\\]|\\\\.)*')",bCe='(?:"(?:[^"\\\\]|\\\\.)*")',wCe="(?:"+vCe+"|"+bCe+")",rL="(?:("+wG+"|"+gCe+"|"+wCe+")\\s*)",_Ce="(?:"+rL+"(?:,\\s*"+rL+")*)",ECe="(?:\\(\\s*(?:"+_Ce+"?)\\)\\s*)",ACe="("+wG+"\\s*"+ECe+"?)",xCe="(\\[\\[|{{)\\s*",SCe="(?:]]|}})",TCe="(?:(!)\\s*)?",$Ce=xCe+TCe+ACe+SCe,nL=new RegExp($Ce,"g");function iL(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].literal;e+=n||""}return e}function rP(r){let e=r.match(/([^\s]+?)\(([\s\S]*)\)/);if(e){let n={methodName:e[1],static:!0,args:mCe};if(e[2].trim()){let i=e[2].replace(/\\,/g,"&comma;").split(",");return kCe(i,n)}else return n}return null}function kCe(r,e){return e.args=r.map(function(t){let n=_G(t);return n.literal||(e.static=!1),n},this),e}function _G(r){let e=r.trim().replace(/&comma;/g,",").replace(/\\(.)/g,"$1"),t={name:e,value:"",literal:!1},n=e[0];switch(n==="-"&&(n=e[1]),n>="0"&&n<="9"&&(n="#"),n){case"'":case'"':t.value=e.slice(1,-1),t.literal=!0;break;case"#":t.value=Number(e),t.literal=!0;break}return t.literal||(t.rootProperty=fm(e),t.structured=I5(e),t.structured&&(t.wildcard=e.slice(-2)==".*",t.wildcard&&(t.name=e.slice(0,-2)))),t}function oL(r,e,t){let n=Ss(r,t);return n===void 0&&(n=e[t]),n}function EG(r,e,t,n){const i={indexSplices:n};P5&&!r._overrideLegacyUndefined&&(e.splices=i),r.notifyPath(t+".splices",i),r.notifyPath(t+".length",e.length),P5&&!r._overrideLegacyUndefined&&(i.indexSplices=[])}function ab(r,e,t,n,i,o){EG(r,e,t,[{index:n,addedCount:i,removed:o,object:e,type:"splice"}])}function PCe(r){return r[0].toUpperCase()+r.substring(1)}const ICe=_d(r=>{const e=YOe(UOe(r));class t extends e{constructor(){super(),this.__isPropertyEffectsClient=!0,this.__dataClientsReady,this.__dataPendingClients,this.__dataToNotify,this.__dataLinkedPaths,this.__dataHasPaths,this.__dataCompoundStorage,this.__dataHost,this.__dataTemp,this.__dataClientsInitialized,this.__data,this.__dataPending,this.__dataOld,this.__computeEffects,this.__computeInfo,this.__reflectEffects,this.__notifyEffects,this.__propagateEffects,this.__observeEffects,this.__readOnly,this.__templateInfo,this._overrideLegacyUndefined}get PROPERTY_EFFECT_TYPES(){return _r}_initializeProperties(){super._initializeProperties(),this._registerHost(),this.__dataClientsReady=!1,this.__dataPendingClients=null,this.__dataToNotify=null,this.__dataLinkedPaths=null,this.__dataHasPaths=!1,this.__dataCompoundStorage=this.__dataCompoundStorage||null,this.__dataHost=this.__dataHost||null,this.__dataTemp={},this.__dataClientsInitialized=!1}_registerHost(){if(cb.length){let i=cb[cb.length-1];i._enqueueClient(this),this.__dataHost=i}}_initializeProtoProperties(i){this.__data=Object.create(i),this.__dataPending=Object.create(i),this.__dataOld={}}_initializeInstanceProperties(i){let o=this[_r.READ_ONLY];for(let s in i)(!o||!o[s])&&(this.__dataPending=this.__dataPending||{},this.__dataOld=this.__dataOld||{},this.__data[s]=this.__dataPending[s]=i[s])}_addPropertyEffect(i,o,s){this._createPropertyAccessor(i,o==_r.READ_ONLY);let a=eP(this,o,!0)[i];a||(a=this[o][i]=[]),a.push(s)}_removePropertyEffect(i,o,s){let a=eP(this,o,!0)[i],l=a.indexOf(s);l>=0&&a.splice(l,1)}_hasPropertyEffect(i,o){let s=this[o];return!!(s&&s[i])}_hasReadOnlyEffect(i){return this._hasPropertyEffect(i,_r.READ_ONLY)}_hasNotifyEffect(i){return this._hasPropertyEffect(i,_r.NOTIFY)}_hasReflectEffect(i){return this._hasPropertyEffect(i,_r.REFLECT)}_hasComputedEffect(i){return this._hasPropertyEffect(i,_r.COMPUTE)}_setPendingPropertyOrPath(i,o,s,a){if(a||fm(Array.isArray(i)?i[0]:i)!==i){if(!a){let l=Ss(this,i);if(i=ZU(this,i,o),!i||!super._shouldPropertyChange(i,o,l))return!1}if(this.__dataHasPaths=!0,this._setPendingProperty(i,o,s))return aCe(this,i,o),!0}else{if(this.__dataHasAccessor&&this.__dataHasAccessor[i])return this._setPendingProperty(i,o,s);this[i]=o}return!1}_setUnmanagedPropertyToNode(i,o,s){(s!==i[o]||typeof s=="object")&&(o==="className"&&(i=Ey(i)),i[o]=s)}_setPendingProperty(i,o,s){let a=this.__dataHasPaths&&I5(i),l=a?this.__dataTemp:this.__data;return this._shouldPropertyChange(i,o,l[i])?(this.__dataPending||(this.__dataPending={},this.__dataOld={}),i in this.__dataOld||(this.__dataOld[i]=this.__data[i]),a?this.__dataTemp[i]=o:this.__data[i]=o,this.__dataPending[i]=o,(a||this[_r.NOTIFY]&&this[_r.NOTIFY][i])&&(this.__dataToNotify=this.__dataToNotify||{},this.__dataToNotify[i]=s),!0):!1}_setProperty(i,o){this._setPendingProperty(i,o,!0)&&this._invalidateProperties()}_invalidateProperties(){this.__dataReady&&this._flushProperties()}_enqueueClient(i){this.__dataPendingClients=this.__dataPendingClients||[],i!==this&&this.__dataPendingClients.push(i)}_flushClients(){this.__dataClientsReady?this.__enableOrFlushClients():(this.__dataClientsReady=!0,this._readyClients(),this.__dataReady=!0)}__enableOrFlushClients(){let i=this.__dataPendingClients;if(i){this.__dataPendingClients=null;for(let o=0;o<i.length;o++){let s=i[o];s.__dataEnabled?s.__dataPending&&s._flushProperties():s._enableProperties()}}}_readyClients(){this.__enableOrFlushClients()}setProperties(i,o){for(let s in i)(o||!this[_r.READ_ONLY]||!this[_r.READ_ONLY][s])&&this._setPendingPropertyOrPath(s,i[s],!0);this._invalidateProperties()}ready(){this._flushProperties(),this.__dataClientsReady||this._flushClients(),this.__dataPending&&this._flushProperties()}_propertiesChanged(i,o,s){let a=this.__dataHasPaths;this.__dataHasPaths=!1;let l;nCe(this,o,s,a),l=this.__dataToNotify,this.__dataToNotify=null,this._propagatePropertyChanges(o,s,a),this._flushClients(),Rb(this,this[_r.REFLECT],o,s,a),Rb(this,this[_r.OBSERVE],o,s,a),l&&XOe(this,l,o,s,a),this.__dataCounter==1&&(this.__dataTemp={})}_propagatePropertyChanges(i,o,s){this[_r.PROPAGATE]&&Rb(this,this[_r.PROPAGATE],i,o,s),this.__templateInfo&&this._runEffectsForTemplate(this.__templateInfo,i,o,s)}_runEffectsForTemplate(i,o,s,a){const l=(d,c)=>{Rb(this,i.propertyEffects,d,s,c,i.nodeList);for(let u=i.firstChild;u;u=u.nextSibling)this._runEffectsForTemplate(u,d,s,c)};i.runEffects?i.runEffects(l,o,a):l(o,a)}linkPaths(i,o){i=Cb(i),o=Cb(o),this.__dataLinkedPaths=this.__dataLinkedPaths||{},this.__dataLinkedPaths[i]=o}unlinkPaths(i){i=Cb(i),this.__dataLinkedPaths&&delete this.__dataLinkedPaths[i]}notifySplices(i,o){let s={path:""},a=Ss(this,i,s);EG(this,a,s.path,o)}get(i,o){return Ss(o||this,i)}set(i,o,s){s?ZU(s,i,o):(!this[_r.READ_ONLY]||!this[_r.READ_ONLY][i])&&this._setPendingPropertyOrPath(i,o,!0)&&this._invalidateProperties()}push(i,...o){let s={path:""},a=Ss(this,i,s),l=a.length,d=a.push(...o);return o.length&&ab(this,a,s.path,l,o.length,[]),d}pop(i){let o={path:""},s=Ss(this,i,o),a=!!s.length,l=s.pop();return a&&ab(this,s,o.path,s.length,0,[l]),l}splice(i,o,s,...a){let l={path:""},d=Ss(this,i,l);o<0?o=d.length-Math.floor(-o):o&&(o=Math.floor(o));let c;return arguments.length===2?c=d.splice(o):c=d.splice(o,s,...a),(a.length||c.length)&&ab(this,d,l.path,o,a.length,c),c}shift(i){let o={path:""},s=Ss(this,i,o),a=!!s.length,l=s.shift();return a&&ab(this,s,o.path,0,0,[l]),l}unshift(i,...o){let s={path:""},a=Ss(this,i,s),l=a.unshift(...o);return o.length&&ab(this,a,s.path,0,o.length,[]),l}notifyPath(i,o){let s;if(arguments.length==1){let a={path:""};o=Ss(this,i,a),s=a.path}else Array.isArray(i)?s=Cb(i):s=i;this._setPendingPropertyOrPath(s,o,!0,!0)&&this._invalidateProperties()}_createReadOnlyProperty(i,o){this._addPropertyEffect(i,_r.READ_ONLY),o&&(this["_set"+PCe(i)]=function(s){this._setProperty(i,s)})}_createPropertyObserver(i,o,s){let a={property:i,method:o,dynamicFn:!!s};this._addPropertyEffect(i,_r.OBSERVE,{fn:QU,info:a,trigger:{name:i}}),s&&this._addPropertyEffect(o,_r.OBSERVE,{fn:QU,info:a,trigger:{name:o}})}_createMethodObserver(i,o){let s=rP(i);if(!s)throw new Error("Malformed observer expression '"+i+"'");tL(this,s,_r.OBSERVE,C5,null,o)}_createNotifyingProperty(i){this._addPropertyEffect(i,_r.NOTIFY,{fn:eCe,info:{eventName:uT(i)+"-changed",property:i}})}_createReflectedProperty(i){let o=this.constructor.attributeNameForProperty(i);o[0]==="-"?console.warn("Property "+i+" cannot be reflected to attribute "+o+' because "-" is not a valid starting attribute name. Use a lowercase first letter for the property instead.'):this._addPropertyEffect(i,_r.REFLECT,{fn:rCe,info:{attrName:o}})}_createComputedProperty(i,o,s){let a=rP(o);if(!a)throw new Error("Malformed computed expression '"+o+"'");const l=tL(this,a,_r.COMPUTE,bG,i,s);eP(this,gG)[i]=l}_marshalArgs(i,o,s){const a=this.__data,l=[];for(let d=0,c=i.length;d<c;d++){let{name:u,structured:f,wildcard:h,value:p,literal:y}=i[d];if(!y)if(h){const g=yx(u,o),w=oL(a,s,g?o:u);p={path:g?o:u,value:w,base:g?Ss(a,u):w}}else p=f?oL(a,s,u):a[u];if(P5&&!this._overrideLegacyUndefined&&p===void 0&&i.length>1)return s_;l[d]=p}return l}static addPropertyEffect(i,o,s){this.prototype._addPropertyEffect(i,o,s)}static createPropertyObserver(i,o,s){this.prototype._createPropertyObserver(i,o,s)}static createMethodObserver(i,o){this.prototype._createMethodObserver(i,o)}static createNotifyingProperty(i){this.prototype._createNotifyingProperty(i)}static createReadOnlyProperty(i,o){this.prototype._createReadOnlyProperty(i,o)}static createReflectedProperty(i){this.prototype._createReflectedProperty(i)}static createComputedProperty(i,o,s){this.prototype._createComputedProperty(i,o,s)}static bindTemplate(i){return this.prototype._bindTemplate(i)}_bindTemplate(i,o){let s=this.constructor._parseTemplate(i),a=this.__preBoundTemplateInfo==s;if(!a)for(let l in s.propertyEffects)this._createPropertyAccessor(l);if(o)if(s=Object.create(s),s.wasPreBound=a,!this.__templateInfo)this.__templateInfo=s;else{const l=i._parentTemplateInfo||this.__templateInfo,d=l.lastChild;s.parent=l,l.lastChild=s,s.previousSibling=d,d?d.nextSibling=s:l.firstChild=s}else this.__preBoundTemplateInfo=s;return s}static _addTemplatePropertyEffect(i,o,s){let a=i.hostProps=i.hostProps||{};a[o]=!0;let l=i.propertyEffects=i.propertyEffects||{};(l[o]=l[o]||[]).push(s)}_stampTemplate(i,o){o=o||this._bindTemplate(i,!0),cb.push(this);let s=super._stampTemplate(i,o);if(cb.pop(),o.nodeList=s.nodeList,!o.wasPreBound){let a=o.childNodes=[];for(let l=s.firstChild;l;l=l.nextSibling)a.push(l)}return s.templateInfo=o,hCe(this,o),this.__dataClientsReady&&(this._runEffectsForTemplate(o,this.__data,null,!1),this._flushClients()),s}_removeBoundDom(i){const o=i.templateInfo,{previousSibling:s,nextSibling:a,parent:l}=o;s?s.nextSibling=a:l&&(l.firstChild=a),a?a.previousSibling=s:l&&(l.lastChild=s),o.nextSibling=o.previousSibling=null;let d=o.childNodes;for(let c=0;c<d.length;c++){let u=d[c];Ey(Ey(u).parentNode).removeChild(u)}}static _parseTemplateNode(i,o,s){let a=e._parseTemplateNode.call(this,i,o,s);if(i.nodeType===Node.TEXT_NODE){let l=this._parseBindings(i.textContent,o);l&&(i.textContent=iL(l)||" ",tP(this,o,s,"text","textContent",l),a=!0)}return a}static _parseTemplateNodeAttribute(i,o,s,a,l){let d=this._parseBindings(l,o);if(d){let c=a,u="property";ZOe.test(a)?u="attribute":a[a.length-1]=="$"&&(a=a.slice(0,-1),u="attribute");let f=iL(d);return f&&u=="attribute"&&(a=="class"&&i.hasAttribute("class")&&(f+=" "+i.getAttribute(a)),i.setAttribute(a,f)),u=="attribute"&&c=="disable-upgrade$"&&i.setAttribute(a,""),i.localName==="input"&&c==="value"&&i.setAttribute(c,""),i.removeAttribute(c),u==="property"&&(a=uG(a)),tP(this,o,s,u,a,d,f),!0}else return e._parseTemplateNodeAttribute.call(this,i,o,s,a,l)}static _parseTemplateNestedTemplate(i,o,s){let a=e._parseTemplateNestedTemplate.call(this,i,o,s);const l=i.parentNode,d=s.templateInfo,c=l.localName==="dom-if",u=l.localName==="dom-repeat";VU&&(c||u)&&(l.removeChild(i),s=s.parentInfo,s.templateInfo=d,s.noted=!0,a=!1);let f=d.hostProps;if(wOe&&c)f&&(o.hostProps=Object.assign(o.hostProps||{},f),VU||(s.parentInfo.noted=!0));else{let h="{";for(let p in f){let y=[{mode:h,source:p,dependencies:[p],hostProp:!0}];tP(this,o,s,"property","_host_"+p,y)}}return a}static _parseBindings(i,o){let s=[],a=0,l;for(;(l=nL.exec(i))!==null;){l.index>a&&s.push({literal:i.slice(a,l.index)});let d=l[1][0],c=!!l[2],u=l[3].trim(),f=!1,h="",p=-1;d=="{"&&(p=u.indexOf("::"))>0&&(h=u.substring(p+2),u=u.substring(0,p),f=!0);let y=rP(u),g=[];if(y){let{args:w,methodName:v}=y;for(let b=0;b<w.length;b++){let _=w[b];_.literal||g.push(_)}let m=o.dynamicFns;(m&&m[v]||y.static)&&(g.push(v),y.dynamicFn=!0)}else g.push(u);s.push({source:u,mode:d,negate:c,customEvent:f,signature:y,dependencies:g,event:h}),a=nL.lastIndex}if(a&&a<i.length){let d=i.substring(a);d&&s.push({literal:d})}return s.length?s:null}static _evaluateBinding(i,o,s,a,l,d){let c;return o.signature?c=C5(i,s,a,l,o.signature):s!=o.source?c=Ss(i,o.source):d&&I5(s)?c=Ss(i,s):c=i.__data[s],o.negate&&(c=!c),c}}return t}),cb=[];/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*//**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function OCe(r){const e={};for(let t in r){const n=r[t];e[t]=typeof n=="function"?{type:n}:n}return e}const CCe=_d(r=>{const e=pG(r);function t(o){const s=Object.getPrototypeOf(o);return s.prototype instanceof i?s:null}function n(o){if(!o.hasOwnProperty(JSCompiler_renameProperty("__ownProperties",o))){let s=null;if(o.hasOwnProperty(JSCompiler_renameProperty("properties",o))){const a=o.properties;a&&(s=OCe(a))}o.__ownProperties=s}return o.__ownProperties}class i extends e{static get observedAttributes(){if(!this.hasOwnProperty(JSCompiler_renameProperty("__observedAttributes",this))){this.prototype;const s=this._properties;this.__observedAttributes=s?Object.keys(s).map(a=>this.prototype._addPropertyToAttributeMap(a)):[]}return this.__observedAttributes}static finalize(){if(!this.hasOwnProperty(JSCompiler_renameProperty("__finalized",this))){const s=t(this);s&&s.finalize(),this.__finalized=!0,this._finalizeClass()}}static _finalizeClass(){const s=n(this);s&&this.createProperties(s)}static get _properties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("__properties",this))){const s=t(this);this.__properties=Object.assign({},s&&s._properties,n(this))}return this.__properties}static typeForProperty(s){const a=this._properties[s];return a&&a.type}_initializeProperties(){this.constructor.finalize(),super._initializeProperties()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this._enableProperties()}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback()}}return i});/**
 * @fileoverview
 * @suppress {checkPrototypalTypes}
 * @license Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt The complete set of authors may be found
 * at http://polymer.github.io/AUTHORS.txt The complete set of contributors may
 * be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by
 * Google as part of the polymer project is also subject to an additional IP
 * rights grant found at http://polymer.github.io/PATENTS.txt
 */const RCe="3.5.1",sL=window.ShadyCSS&&window.ShadyCSS.cssBuild,DCe=_d(r=>{const e=CCe(ICe(r));function t(l){if(!l.hasOwnProperty(JSCompiler_renameProperty("__propertyDefaults",l))){l.__propertyDefaults=null;let d=l._properties;for(let c in d){let u=d[c];"value"in u&&(l.__propertyDefaults=l.__propertyDefaults||{},l.__propertyDefaults[c]=u)}}return l.__propertyDefaults}function n(l){return l.hasOwnProperty(JSCompiler_renameProperty("__ownObservers",l))||(l.__ownObservers=l.hasOwnProperty(JSCompiler_renameProperty("observers",l))?l.observers:null),l.__ownObservers}function i(l,d,c,u){c.computed&&(c.readOnly=!0),c.computed&&(l._hasReadOnlyEffect(d)?console.warn(`Cannot redefine computed property '${d}'.`):l._createComputedProperty(d,c.computed,u)),c.readOnly&&!l._hasReadOnlyEffect(d)?l._createReadOnlyProperty(d,!c.computed):c.readOnly===!1&&l._hasReadOnlyEffect(d)&&console.warn(`Cannot make readOnly property '${d}' non-readOnly.`),c.reflectToAttribute&&!l._hasReflectEffect(d)?l._createReflectedProperty(d):c.reflectToAttribute===!1&&l._hasReflectEffect(d)&&console.warn(`Cannot make reflected property '${d}' non-reflected.`),c.notify&&!l._hasNotifyEffect(d)?l._createNotifyingProperty(d):c.notify===!1&&l._hasNotifyEffect(d)&&console.warn(`Cannot make notify property '${d}' non-notify.`),c.observer&&l._createPropertyObserver(d,c.observer,u[c.observer]),l._addPropertyToAttributeMap(d)}function o(l,d,c,u){if(!sL){const f=d.content.querySelectorAll("style"),h=cG(d),p=kOe(c),y=d.content.firstElementChild;for(let w=0;w<p.length;w++){let v=p[w];v.textContent=l._processStyleText(v.textContent,u),d.content.insertBefore(v,y)}let g=0;for(let w=0;w<h.length;w++){let v=h[w],m=f[g];m!==v?(v=v.cloneNode(!0),m.parentNode.insertBefore(v,m)):g++,v.textContent=l._processStyleText(v.textContent,u)}}if(window.ShadyCSS&&window.ShadyCSS.prepareTemplate(d,c),_Oe&&sL&&hOe){const f=d.content.querySelectorAll("style");if(f){let h="";Array.from(f).forEach(p=>{h+=p.textContent,p.parentNode.removeChild(p)}),l._styleSheet=new CSSStyleSheet,l._styleSheet.replaceSync(h)}}}function s(l){let d=null;if(l&&(!k5||yOe)&&(d=i_.import(l,"template"),k5&&!d))throw new Error(`strictTemplatePolicy: expecting dom-module or null template for ${l}`);return d}class a extends e{static get polymerElementVersion(){return RCe}static _finalizeClass(){e._finalizeClass.call(this);const d=n(this);d&&this.createObservers(d,this._properties),this._prepareTemplate()}static _prepareTemplate(){let d=this.template;d&&(typeof d=="string"?(console.error("template getter must return HTMLTemplateElement"),d=null):mOe||(d=d.cloneNode(!0))),this.prototype._template=d}static createProperties(d){for(let c in d)i(this.prototype,c,d[c],d)}static createObservers(d,c){const u=this.prototype;for(let f=0;f<d.length;f++)u._createMethodObserver(d[f],c)}static get template(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_template",this))){let d=this.prototype.hasOwnProperty(JSCompiler_renameProperty("_template",this.prototype))?this.prototype._template:void 0;typeof d=="function"&&(d=d()),this._template=d!==void 0?d:this.hasOwnProperty(JSCompiler_renameProperty("is",this))&&s(this.is)||Object.getPrototypeOf(this.prototype).constructor.template}return this._template}static set template(d){this._template=d}static get importPath(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_importPath",this))){const d=this.importMeta;if(d)this._importPath=A6(d.url);else{const c=i_.import(this.is);this._importPath=c&&c.assetpath||Object.getPrototypeOf(this.prototype).constructor.importPath}}return this._importPath}constructor(){super(),this._template,this._importPath,this.rootPath,this.importPath,this.root,this.$}_initializeProperties(){this.constructor.finalize(),this.constructor._finalizeTemplate(this.localName),super._initializeProperties(),this.rootPath=pOe,this.importPath=this.constructor.importPath;let d=t(this.constructor);if(d)for(let c in d){let u=d[c];if(this._canApplyPropertyDefault(c)){let f=typeof u.value=="function"?u.value.call(this):u.value;this._hasAccessor(c)?this._setPendingProperty(c,f,!0):this[c]=f}}}_canApplyPropertyDefault(d){return!this.hasOwnProperty(d)}static _processStyleText(d,c){return E6(d,c)}static _finalizeTemplate(d){const c=this.prototype._template;if(c&&!c.__polymerFinalized){c.__polymerFinalized=!0;const u=this.importPath,f=u?uw(u):"";o(this,c,d,f),this.prototype._bindTemplate(c)}}connectedCallback(){window.ShadyCSS&&this._template&&window.ShadyCSS.styleElement(this),super.connectedCallback()}ready(){this._template&&(this.root=this._stampTemplate(this._template),this.$=this.root.$),super.ready()}_readyClients(){this._template&&(this.root=this._attachDom(this.root)),super._readyClients()}_attachDom(d){const c=Ey(this);if(c.attachShadow)return d?(c.shadowRoot||(c.attachShadow({mode:"open",shadyUpgradeFragment:d}),c.shadowRoot.appendChild(d),this.constructor._styleSheet&&(c.shadowRoot.adoptedStyleSheets=[this.constructor._styleSheet])),vOe&&window.ShadyDOM&&window.ShadyDOM.flushInitial(c.shadowRoot),c.shadowRoot):null;throw new Error("ShadowDOM not available. PolymerElement can create dom as children instead of in ShadowDOM by setting `this.root = this;` before `ready`.")}updateStyles(d){window.ShadyCSS&&window.ShadyCSS.styleSubtree(this,d)}resolveUrl(d,c){return!c&&this.importPath&&(c=uw(this.importPath)),uw(d,c)}static _parseTemplateContent(d,c,u){return c.dynamicFns=c.dynamicFns||this._properties,e._parseTemplateContent.call(this,d,c,u)}static _addTemplatePropertyEffect(d,c,u){return gOe&&!(c in this._properties)&&!(u.info.part.signature&&u.info.part.signature.static)&&!u.info.part.hostProp&&!d.nestedTemplate&&console.warn(`Property '${c}' used in template but not declared in 'properties'; attribute will not be observed.`),e._addTemplatePropertyEffect.call(this,d,c,u)}}return a});/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const aL=window.trustedTypes&&trustedTypes.createPolicy("polymer-html-literal",{createHTML:r=>r});class AG{constructor(e,t){SG(e,t);const n=t.reduce((i,o,s)=>i+xG(o)+e[s+1],e[0]);this.value=n.toString()}toString(){return this.value}}function xG(r){if(r instanceof AG)return r.value;throw new Error(`non-literal value passed to Polymer's htmlLiteral function: ${r}`)}function MCe(r){if(r instanceof HTMLTemplateElement)return r.innerHTML;if(r instanceof AG)return xG(r);throw new Error(`non-template value passed to Polymer's html function: ${r}`)}const Zv=function(e,...t){SG(e,t);const n=document.createElement("template");let i=t.reduce((o,s,a)=>o+MCe(s)+e[a+1],e[0]);return aL&&(i=aL.createHTML(i)),n.innerHTML=i,n},SG=(r,e)=>{if(!Array.isArray(r)||!Array.isArray(r.raw)||e.length!==r.length-1)throw new TypeError("Invalid call to the html template tag")};/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const Jv=DCe(HTMLElement);/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const T6=_d(r=>typeof r.prototype.addController=="function"?r:class extends r{constructor(){super(),this.__controllers=new Set}connectedCallback(){super.connectedCallback(),this.__controllers.forEach(t=>{t.hostConnected&&t.hostConnected()})}disconnectedCallback(){super.disconnectedCallback(),this.__controllers.forEach(t=>{t.hostDisconnected&&t.hostDisconnected()})}addController(t){this.__controllers.add(t),this.$!==void 0&&this.isConnected&&t.hostConnected&&t.hostConnected()}removeController(t){this.__controllers.delete(t)}}),BCe=/\/\*[\*!]\s+vaadin-dev-mode:start([\s\S]*)vaadin-dev-mode:end\s+\*\*\//i,NE=window.Vaadin&&window.Vaadin.Flow&&window.Vaadin.Flow.clients;function jCe(){function r(){return!0}return TG(r)}function NCe(){try{return UCe()?!0:LCe()?NE?!KCe():!jCe():!1}catch{return!1}}function UCe(){return localStorage.getItem("vaadin.developmentmode.force")}function LCe(){return["localhost","127.0.0.1"].indexOf(window.location.hostname)>=0}function KCe(){return!!(NE&&Object.keys(NE).map(e=>NE[e]).filter(e=>e.productionMode).length>0)}function TG(r,e){if(typeof r!="function")return;const t=BCe.exec(r.toString());if(t)try{r=new Function(t[1])}catch(n){console.log("vaadin-development-mode-detector: uncommentAndRun() failed",n)}return r(e)}window.Vaadin=window.Vaadin||{};const cL=function(r,e){if(window.Vaadin.developmentMode)return TG(r,e)};window.Vaadin.developmentMode===void 0&&(window.Vaadin.developmentMode=NCe());function zCe(){}const FCe=function(){if(typeof cL=="function")return cL(zCe)};/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
 */let lL=0,$G=0;const Tg=[];let R5=!1;function qCe(){R5=!1;const r=Tg.length;for(let e=0;e<r;e++){const t=Tg[e];if(t)try{t()}catch(n){setTimeout(()=>{throw n})}}Tg.splice(0,r),$G+=r}const VCe={run(r){return window.requestAnimationFrame(r)},cancel(r){window.cancelAnimationFrame(r)}},WCe={run(r){return window.requestIdleCallback?window.requestIdleCallback(r):window.setTimeout(r,16)},cancel(r){window.cancelIdleCallback?window.cancelIdleCallback(r):window.clearTimeout(r)}},HCe={run(r){R5||(R5=!0,queueMicrotask(()=>qCe())),Tg.push(r);const e=lL;return lL+=1,e},cancel(r){const e=r-$G;if(e>=0){if(!Tg[e])throw new Error(`invalid async handle: ${r}`);Tg[e]=null}}};/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const D5=new Set;class a_{static debounce(e,t,n){return e instanceof a_?e._cancelAsync():e=new a_,e.setConfig(t,n),e}constructor(){this._asyncModule=null,this._callback=null,this._timer=null}setConfig(e,t){this._asyncModule=e,this._callback=t,this._timer=this._asyncModule.run(()=>{this._timer=null,D5.delete(this),this._callback()})}cancel(){this.isActive()&&(this._cancelAsync(),D5.delete(this))}_cancelAsync(){this.isActive()&&(this._asyncModule.cancel(this._timer),this._timer=null)}flush(){this.isActive()&&(this.cancel(),this._callback())}isActive(){return this._timer!=null}}function GCe(r){D5.add(r)}/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const Hd=[];function M5(r,e,t=r.getAttribute("dir")){e?r.setAttribute("dir",e):t!=null&&r.removeAttribute("dir")}function B5(){return document.documentElement.getAttribute("dir")}function YCe(){const r=B5();Hd.forEach(e=>{M5(e,r)})}const ZCe=new MutationObserver(YCe);ZCe.observe(document.documentElement,{attributes:!0,attributeFilter:["dir"]});const JCe=r=>class extends r{static get properties(){return{dir:{type:String,value:"",reflectToAttribute:!0,converter:{fromAttribute:t=>t||"",toAttribute:t=>t===""?null:t}}}}get __isRTL(){return this.getAttribute("dir")==="rtl"}connectedCallback(){super.connectedCallback(),(!this.hasAttribute("dir")||this.__restoreSubscription)&&(this.__subscribe(),M5(this,B5(),null))}attributeChangedCallback(t,n,i){if(super.attributeChangedCallback(t,n,i),t!=="dir")return;const o=B5(),s=i===o&&Hd.indexOf(this)===-1,a=!i&&n&&Hd.indexOf(this)===-1;s||a?(this.__subscribe(),M5(this,o,i)):i!==o&&n===o&&this.__unsubscribe()}disconnectedCallback(){super.disconnectedCallback(),this.__restoreSubscription=Hd.includes(this),this.__unsubscribe()}_valueToNodeAttribute(t,n,i){i==="dir"&&n===""&&!t.hasAttribute("dir")||super._valueToNodeAttribute(t,n,i)}_attributeToProperty(t,n,i){t==="dir"&&!n?this.dir="":super._attributeToProperty(t,n,i)}__subscribe(){Hd.includes(this)||Hd.push(this)}__unsubscribe(){Hd.includes(this)&&Hd.splice(Hd.indexOf(this),1)}};/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */window.Vaadin||(window.Vaadin={});window.Vaadin.registrations||(window.Vaadin.registrations=[]);window.Vaadin.developmentModeCallback||(window.Vaadin.developmentModeCallback={});window.Vaadin.developmentModeCallback["vaadin-usage-statistics"]=function(){FCe()};let nP;const dL=new Set,$6=r=>class extends JCe(r){static finalize(){super.finalize();const{is:t}=this;t&&!dL.has(t)&&(window.Vaadin.registrations.push(this),dL.add(t),window.Vaadin.developmentModeCallback&&(nP=a_.debounce(nP,WCe,()=>{window.Vaadin.developmentModeCallback["vaadin-usage-statistics"]()}),GCe(nP)))}constructor(){super(),document.doctype===null&&console.warn('Vaadin components require the "standards mode" declaration. Please add <!DOCTYPE html> to the HTML document.')}};/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */function XCe(r){return r.nodeType===Node.TEXT_NODE&&r.textContent.trim()===""}/**
 * @license
 * Copyright (c) 2023 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class QCe{constructor(e,t){this.slot=e,this.callback=t,this._storedNodes=[],this._connected=!1,this._scheduled=!1,this._boundSchedule=()=>{this._schedule()},this.connect(),this._schedule()}connect(){this.slot.addEventListener("slotchange",this._boundSchedule),this._connected=!0}disconnect(){this.slot.removeEventListener("slotchange",this._boundSchedule),this._connected=!1}_schedule(){this._scheduled||(this._scheduled=!0,queueMicrotask(()=>{this.flush()}))}flush(){this._connected&&(this._scheduled=!1,this._processNodes())}_processNodes(){const e=this.slot.assignedNodes({flatten:!0});let t=[];const n=[],i=[];e.length&&(t=e.filter(o=>!this._storedNodes.includes(o))),this._storedNodes.length&&this._storedNodes.forEach((o,s)=>{const a=e.indexOf(o);a===-1?n.push(o):a!==s&&i.push(o)}),(t.length||n.length||i.length)&&this.callback({addedNodes:t,movedNodes:i,removedNodes:n}),this._storedNodes=e}}/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */let eRe=0;function tRe(){return eRe++}/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class vv extends EventTarget{static generateId(e,t){return`${t||"default"}-${e.localName}-${tRe()}`}constructor(e,t,n,i={}){super();const{initializer:o,multiple:s,observe:a,useUniqueId:l}=i;this.host=e,this.slotName=t,this.tagName=n,this.observe=typeof a=="boolean"?a:!0,this.multiple=typeof s=="boolean"?s:!1,this.slotInitializer=o,s&&(this.nodes=[]),l&&(this.defaultId=this.constructor.generateId(e,t))}hostConnected(){this.initialized||(this.multiple?this.initMultiple():this.initSingle(),this.observe&&this.observeSlot(),this.initialized=!0)}initSingle(){let e=this.getSlotChild();e?(this.node=e,this.initAddedNode(e)):(e=this.attachDefaultNode(),this.initNode(e))}initMultiple(){const e=this.getSlotChildren();if(e.length===0){const t=this.attachDefaultNode();t&&(this.nodes=[t],this.initNode(t))}else this.nodes=e,e.forEach(t=>{this.initAddedNode(t)})}attachDefaultNode(){const{host:e,slotName:t,tagName:n}=this;let i=this.defaultNode;return!i&&n&&(i=document.createElement(n),i instanceof Element&&(t!==""&&i.setAttribute("slot",t),this.defaultNode=i)),i&&(this.node=i,e.appendChild(i)),i}getSlotChildren(){const{slotName:e}=this;return Array.from(this.host.childNodes).filter(t=>t.nodeType===Node.ELEMENT_NODE&&t.slot===e||t.nodeType===Node.TEXT_NODE&&t.textContent.trim()&&e==="")}getSlotChild(){return this.getSlotChildren()[0]}initNode(e){const{slotInitializer:t}=this;t&&t(e,this.host)}initCustomNode(e){}teardownNode(e){}initAddedNode(e){e!==this.defaultNode&&(this.initCustomNode(e),this.initNode(e))}observeSlot(){const{slotName:e}=this,t=e===""?"slot:not([name])":`slot[name=${e}]`,n=this.host.shadowRoot.querySelector(t);this.__slotObserver=new QCe(n,({addedNodes:i,removedNodes:o})=>{const s=this.multiple?this.nodes:[this.node],a=i.filter(l=>!XCe(l)&&!s.includes(l));o.length&&(this.nodes=s.filter(l=>!o.includes(l)),o.forEach(l=>{this.teardownNode(l)})),a&&a.length>0&&(this.multiple?(this.defaultNode&&this.defaultNode.remove(),this.nodes=[...s,...a].filter(l=>l!==this.defaultNode),a.forEach(l=>{this.initAddedNode(l)})):(this.node&&this.node.remove(),this.node=a[0],this.initAddedNode(this.node)))})}}/**
 * @license
 * Copyright (c) 2022 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class rRe extends vv{constructor(e){super(e,"tooltip"),this.setTarget(e)}initCustomNode(e){e.target=this.target,this.ariaTarget!==void 0&&(e.ariaTarget=this.ariaTarget),this.context!==void 0&&(e.context=this.context),this.manual!==void 0&&(e.manual=this.manual),this.opened!==void 0&&(e.opened=this.opened),this.position!==void 0&&(e._position=this.position),this.shouldShow!==void 0&&(e.shouldShow=this.shouldShow),this.__notifyChange()}teardownNode(){this.__notifyChange()}setAriaTarget(e){this.ariaTarget=e;const t=this.node;t&&(t.ariaTarget=e)}setContext(e){this.context=e;const t=this.node;t&&(t.context=e)}setManual(e){this.manual=e;const t=this.node;t&&(t.manual=e)}setOpened(e){this.opened=e;const t=this.node;t&&(t.opened=e)}setPosition(e){this.position=e;const t=this.node;t&&(t._position=e)}setShouldShow(e){this.shouldShow=e;const t=this.node;t&&(t.shouldShow=e)}setTarget(e){this.target=e;const t=this.node;t&&(t.target=e)}__notifyChange(){this.dispatchEvent(new CustomEvent("tooltip-changed",{detail:{node:this.node}}))}}/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const nRe=Ye`
  :host {
    display: inline-block;
    position: relative;
    outline: none;
    white-space: nowrap;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  :host([hidden]) {
    display: none !important;
  }

  /* Aligns the button with form fields when placed on the same line.
  Note, to make it work, the form fields should have the same "::before" pseudo-element. */
  .vaadin-button-container::before {
    content: '\\2003';
    display: inline-block;
    width: 0;
    max-height: 100%;
  }

  .vaadin-button-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    width: 100%;
    height: 100%;
    min-height: inherit;
    text-shadow: inherit;
  }

  [part='prefix'],
  [part='suffix'] {
    flex: none;
  }

  [part='label'] {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  @media (forced-colors: active) {
    :host {
      outline: 1px solid;
      outline-offset: -1px;
    }

    :host([focused]) {
      outline-width: 2px;
    }

    :host([disabled]) {
      outline-color: GrayText;
    }
  }
`,iRe=r=>r`
  <div class="vaadin-button-container">
    <span part="prefix" aria-hidden="true">
      <slot name="prefix"></slot>
    </span>
    <span part="label">
      <slot></slot>
    </span>
    <span part="suffix" aria-hidden="true">
      <slot name="suffix"></slot>
    </span>
  </div>
  <slot name="tooltip"></slot>
`;/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const oRe=!1,sRe=r=>r,k6=typeof document.head.style.touchAction=="string",j5="__polymerGestures",iP="__polymerGesturesHandled",N5="__polymerGesturesTouchAction",uL=25,fL=5,aRe=2,cRe=["mousedown","mousemove","mouseup","click"],lRe=[0,1,4,2],dRe=function(){try{return new MouseEvent("test",{buttons:1}).buttons===1}catch{return!1}}();function P6(r){return cRe.indexOf(r)>-1}let kG=!1;(function(){try{const r=Object.defineProperty({},"passive",{get(){kG=!0}});window.addEventListener("test",null,r),window.removeEventListener("test",null,r)}catch{}})();function uRe(r){if(!(P6(r)||r==="touchend")&&k6&&kG&&oRe)return{passive:!0}}const fRe=navigator.userAgent.match(/iP(?:[oa]d|hone)|Android/u),hRe={button:!0,command:!0,fieldset:!0,input:!0,keygen:!0,optgroup:!0,option:!0,select:!0,textarea:!0};function Ay(r){const e=r.type;if(!P6(e))return!1;if(e==="mousemove"){let n=r.buttons===void 0?1:r.buttons;return r instanceof window.MouseEvent&&!dRe&&(n=lRe[r.which]||0),!!(n&1)}return(r.button===void 0?0:r.button)===0}function pRe(r){if(r.type==="click"){if(r.detail===0)return!0;const e=bh(r);if(!e.nodeType||e.nodeType!==Node.ELEMENT_NODE)return!0;const t=e.getBoundingClientRect(),n=r.pageX,i=r.pageY;return!(n>=t.left&&n<=t.right&&i>=t.top&&i<=t.bottom)}return!1}const Jd={mouse:{target:null,mouseIgnoreJob:null},touch:{x:0,y:0,id:-1,scrollDecided:!1}};function yRe(r){let e="auto";const t=IG(r);for(let n=0,i;n<t.length;n++)if(i=t[n],i[N5]){e=i[N5];break}return e}function PG(r,e,t){r.movefn=e,r.upfn=t,document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)}function $g(r){document.removeEventListener("mousemove",r.movefn),document.removeEventListener("mouseup",r.upfn),r.movefn=null,r.upfn=null}const IG=window.ShadyDOM&&window.ShadyDOM.noPatch?window.ShadyDOM.composedPath:r=>r.composedPath&&r.composedPath()||[],I6={},ny=[];function mRe(r,e){let t=document.elementFromPoint(r,e),n=t;for(;n&&n.shadowRoot&&!window.ShadyDOM;){const i=n;if(n=n.shadowRoot.elementFromPoint(r,e),i===n)break;n&&(t=n)}return t}function bh(r){const e=IG(r);return e.length>0?e[0]:r.target}function gRe(r){const e=r.type,n=r.currentTarget[j5];if(!n)return;const i=n[e];if(!i)return;if(!r[iP]&&(r[iP]={},e.startsWith("touch"))){const s=r.changedTouches[0];if(e==="touchstart"&&r.touches.length===1&&(Jd.touch.id=s.identifier),Jd.touch.id!==s.identifier)return;k6||(e==="touchstart"||e==="touchmove")&&vRe(r)}const o=r[iP];if(!o.skip){for(let s=0,a;s<ny.length;s++)a=ny[s],i[a.name]&&!o[a.name]&&a.flow&&a.flow.start.indexOf(r.type)>-1&&a.reset&&a.reset();for(let s=0,a;s<ny.length;s++)a=ny[s],i[a.name]&&!o[a.name]&&(o[a.name]=!0,a[e](r))}}function vRe(r){const e=r.changedTouches[0],t=r.type;if(t==="touchstart")Jd.touch.x=e.clientX,Jd.touch.y=e.clientY,Jd.touch.scrollDecided=!1;else if(t==="touchmove"){if(Jd.touch.scrollDecided)return;Jd.touch.scrollDecided=!0;const n=yRe(r);let i=!1;const o=Math.abs(Jd.touch.x-e.clientX),s=Math.abs(Jd.touch.y-e.clientY);r.cancelable&&(n==="none"?i=!0:n==="pan-x"?i=s>o:n==="pan-y"&&(i=o>s)),i?r.preventDefault():vx("track")}}function hL(r,e,t){return I6[e]?(bRe(r,e,t),!0):!1}function bRe(r,e,t){const n=I6[e],i=n.deps,o=n.name;let s=r[j5];s||(r[j5]=s={});for(let a=0,l,d;a<i.length;a++)l=i[a],!(fRe&&P6(l)&&l!=="click")&&(d=s[l],d||(s[l]=d={_count:0}),d._count===0&&r.addEventListener(l,gRe,uRe(l)),d[o]=(d[o]||0)+1,d._count=(d._count||0)+1);r.addEventListener(e,t),n.touchAction&&_Re(r,n.touchAction)}function O6(r){ny.push(r),r.emits.forEach(e=>{I6[e]=r})}function wRe(r){for(let e=0,t;e<ny.length;e++){t=ny[e];for(let n=0,i;n<t.emits.length;n++)if(i=t.emits[n],i===r)return t}return null}function _Re(r,e){k6&&r instanceof HTMLElement&&HCe.run(()=>{r.style.touchAction=e}),r[N5]=e}function C6(r,e,t){const n=new Event(e,{bubbles:!0,cancelable:!0,composed:!0});if(n.detail=t,sRe(r).dispatchEvent(n),n.defaultPrevented){const i=t.preventer||t.sourceEvent;i&&i.preventDefault&&i.preventDefault()}}function vx(r){const e=wRe(r);e.info&&(e.info.prevent=!0)}O6({name:"downup",deps:["mousedown","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["down","up"],info:{movefn:null,upfn:null},reset(){$g(this.info)},mousedown(r){if(!Ay(r))return;const e=bh(r),t=this,n=o=>{Ay(o)||(lb("up",e,o),$g(t.info))},i=o=>{Ay(o)&&lb("up",e,o),$g(t.info)};PG(this.info,n,i),lb("down",e,r)},touchstart(r){lb("down",bh(r),r.changedTouches[0],r)},touchend(r){lb("up",bh(r),r.changedTouches[0],r)}});function lb(r,e,t,n){e&&C6(e,r,{x:t.clientX,y:t.clientY,sourceEvent:t,preventer:n,prevent(i){return vx(i)}})}O6({name:"track",touchAction:"none",deps:["mousedown","touchstart","touchmove","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["track"],info:{x:0,y:0,state:"start",started:!1,moves:[],addMove(r){this.moves.length>aRe&&this.moves.shift(),this.moves.push(r)},movefn:null,upfn:null,prevent:!1},reset(){this.info.state="start",this.info.started=!1,this.info.moves=[],this.info.x=0,this.info.y=0,this.info.prevent=!1,$g(this.info)},mousedown(r){if(!Ay(r))return;const e=bh(r),t=this,n=o=>{const s=o.clientX,a=o.clientY;pL(t.info,s,a)&&(t.info.state=t.info.started?o.type==="mouseup"?"end":"track":"start",t.info.state==="start"&&vx("tap"),t.info.addMove({x:s,y:a}),Ay(o)||(t.info.state="end",$g(t.info)),e&&oP(t.info,e,o),t.info.started=!0)},i=o=>{t.info.started&&n(o),$g(t.info)};PG(this.info,n,i),this.info.x=r.clientX,this.info.y=r.clientY},touchstart(r){const e=r.changedTouches[0];this.info.x=e.clientX,this.info.y=e.clientY},touchmove(r){const e=bh(r),t=r.changedTouches[0],n=t.clientX,i=t.clientY;pL(this.info,n,i)&&(this.info.state==="start"&&vx("tap"),this.info.addMove({x:n,y:i}),oP(this.info,e,t),this.info.state="track",this.info.started=!0)},touchend(r){const e=bh(r),t=r.changedTouches[0];this.info.started&&(this.info.state="end",this.info.addMove({x:t.clientX,y:t.clientY}),oP(this.info,e,t))}});function pL(r,e,t){if(r.prevent)return!1;if(r.started)return!0;const n=Math.abs(r.x-e),i=Math.abs(r.y-t);return n>=fL||i>=fL}function oP(r,e,t){if(!e)return;const n=r.moves[r.moves.length-2],i=r.moves[r.moves.length-1],o=i.x-r.x,s=i.y-r.y;let a,l=0;n&&(a=i.x-n.x,l=i.y-n.y),C6(e,"track",{state:r.state,x:t.clientX,y:t.clientY,dx:o,dy:s,ddx:a,ddy:l,sourceEvent:t,hover(){return mRe(t.clientX,t.clientY)}})}O6({name:"tap",deps:["mousedown","click","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["click","touchend"]},emits:["tap"],info:{x:NaN,y:NaN,prevent:!1},reset(){this.info.x=NaN,this.info.y=NaN,this.info.prevent=!1},mousedown(r){Ay(r)&&(this.info.x=r.clientX,this.info.y=r.clientY)},click(r){Ay(r)&&yL(this.info,r)},touchstart(r){const e=r.changedTouches[0];this.info.x=e.clientX,this.info.y=e.clientY},touchend(r){yL(this.info,r.changedTouches[0],r)}});function yL(r,e,t){const n=Math.abs(e.clientX-r.x),i=Math.abs(e.clientY-r.y),o=bh(t||e);!o||hRe[o.localName]&&o.hasAttribute("disabled")||(isNaN(n)||isNaN(i)||n<=uL&&i<=uL||pRe(e))&&(r.prevent||C6(o,"tap",{x:e.clientX,y:e.clientY,sourceEvent:e,preventer:t}))}/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const OG=_d(r=>class extends r{static get properties(){return{disabled:{type:Boolean,value:!1,observer:"_disabledChanged",reflectToAttribute:!0}}}_disabledChanged(t){this._setAriaDisabled(t)}_setAriaDisabled(t){t?this.setAttribute("aria-disabled","true"):this.removeAttribute("aria-disabled")}click(){this.disabled||super.click()}});/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const ERe=_d(r=>class extends r{ready(){super.ready(),this.addEventListener("keydown",t=>{this._onKeyDown(t)}),this.addEventListener("keyup",t=>{this._onKeyUp(t)})}_onKeyDown(t){switch(t.key){case"Enter":this._onEnter(t);break;case"Escape":this._onEscape(t);break}}_onKeyUp(t){}_onEnter(t){}_onEscape(t){}});/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const ARe=r=>class extends OG(ERe(r)){get _activeKeys(){return[" "]}ready(){super.ready(),hL(this,"down",t=>{this._shouldSetActive(t)&&this._setActive(!0)}),hL(this,"up",()=>{this._setActive(!1)})}disconnectedCallback(){super.disconnectedCallback(),this._setActive(!1)}_shouldSetActive(t){return!this.disabled}_onKeyDown(t){super._onKeyDown(t),this._shouldSetActive(t)&&this._activeKeys.includes(t.key)&&(this._setActive(!0),document.addEventListener("keyup",n=>{this._activeKeys.includes(n.key)&&this._setActive(!1)},{once:!0}))}_setActive(t){this.toggleAttribute("active",t)}};/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */let R6=!1;window.addEventListener("keydown",()=>{R6=!0},{capture:!0});window.addEventListener("mousedown",()=>{R6=!1},{capture:!0});function xRe(){return R6}/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const CG=_d(r=>class extends r{get _keyboardActive(){return xRe()}ready(){this.addEventListener("focusin",t=>{this._shouldSetFocus(t)&&this._setFocused(!0)}),this.addEventListener("focusout",t=>{this._shouldRemoveFocus(t)&&this._setFocused(!1)}),super.ready()}disconnectedCallback(){super.disconnectedCallback(),this.hasAttribute("focused")&&this._setFocused(!1)}_setFocused(t){this.toggleAttribute("focused",t),this.toggleAttribute("focus-ring",t&&this._keyboardActive)}_shouldSetFocus(t){return!0}_shouldRemoveFocus(t){return!0}});/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const SRe=r=>class extends OG(r){static get properties(){return{tabindex:{type:Number,reflectToAttribute:!0,observer:"_tabindexChanged"},_lastTabIndex:{type:Number}}}_disabledChanged(t,n){super._disabledChanged(t,n),t?(this.tabindex!==void 0&&(this._lastTabIndex=this.tabindex),this.tabindex=-1):n&&(this.tabindex=this._lastTabIndex)}_tabindexChanged(t){this.disabled&&t!==-1&&(this._lastTabIndex=t,this.tabindex=-1)}};/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const TRe=r=>class extends ARe(SRe(CG(r))){static get properties(){return{tabindex:{type:Number,value:0,reflectToAttribute:!0}}}get _activeKeys(){return["Enter"," "]}ready(){super.ready(),this.hasAttribute("role")||this.setAttribute("role","button")}_onKeyDown(t){super._onKeyDown(t),!(t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)&&this._activeKeys.includes(t.key)&&(t.preventDefault(),this.click())}};/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */gc("vaadin-button",nRe,{moduleId:"vaadin-button-styles"});class $Re extends TRe($6(Gv(T6(Jv)))){static get is(){return"vaadin-button"}static get template(){return iRe(Zv)}ready(){super.ready(),this._tooltipController=new rRe(this),this.addController(this._tooltipController)}}um($Re);gc("vaadin-progress-bar",Ye`
    :host {
      height: calc(var(--lumo-size-l) / 10);
      margin: var(--lumo-space-s) 0;
    }

    [part='bar'] {
      border-radius: var(--lumo-border-radius-m);
      background-color: var(--lumo-contrast-10pct);
    }

    [part='value'] {
      border-radius: var(--lumo-border-radius-m);
      background-color: var(--lumo-primary-color);
      /* Use width instead of transform to preserve border radius */
      transform: none;
      width: calc(var(--vaadin-progress-value) * 100%);
      will-change: width;
      transition: 0.1s width linear;
    }

    /* Indeterminate mode */
    :host([indeterminate]) [part='value'] {
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to right,
        var(--lumo-primary-color-10pct) 10%,
        var(--lumo-primary-color)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to left,
        var(--lumo-primary-color-10pct) 10%,
        var(--lumo-primary-color)
      );
      width: 100%;
      background-color: transparent !important;
      background-image: var(--lumo-progress-indeterminate-progress-bar-background);
      opacity: 0.75;
      will-change: transform;
      animation: vaadin-progress-indeterminate 1.6s infinite cubic-bezier(0.645, 0.045, 0.355, 1);
    }

    @keyframes vaadin-progress-indeterminate {
      0% {
        transform: scaleX(0.015);
        transform-origin: 0% 0%;
      }

      25% {
        transform: scaleX(0.4);
      }

      50% {
        transform: scaleX(0.015);
        transform-origin: 100% 0%;
        background-image: var(--lumo-progress-indeterminate-progress-bar-background);
      }

      50.1% {
        transform: scaleX(0.015);
        transform-origin: 100% 0%;
        background-image: var(--lumo-progress-indeterminate-progress-bar-background-reverse);
      }

      75% {
        transform: scaleX(0.4);
      }

      100% {
        transform: scaleX(0.015);
        transform-origin: 0% 0%;
        background-image: var(--lumo-progress-indeterminate-progress-bar-background-reverse);
      }
    }

    :host(:not([aria-valuenow])) [part='value']::before,
    :host([indeterminate]) [part='value']::before {
      content: '';
      display: block;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--lumo-primary-color);
      will-change: opacity;
      animation: vaadin-progress-pulse3 1.6s infinite cubic-bezier(0.645, 0.045, 0.355, 1);
    }

    @keyframes vaadin-progress-pulse3 {
      0% {
        opacity: 1;
      }

      10% {
        opacity: 0;
      }

      40% {
        opacity: 0;
      }

      50% {
        opacity: 1;
      }

      50.1% {
        opacity: 1;
      }

      60% {
        opacity: 0;
      }

      90% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    /* Contrast color */
    :host([theme~='contrast']) [part='value'],
    :host([theme~='contrast']) [part='value']::before {
      background-color: var(--lumo-contrast-80pct);
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to right,
        var(--lumo-contrast-5pct) 10%,
        var(--lumo-contrast-80pct)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to left,
        var(--lumo-contrast-5pct) 10%,
        var(--lumo-contrast-60pct)
      );
    }

    /* Error color */
    :host([theme~='error']) [part='value'],
    :host([theme~='error']) [part='value']::before {
      background-color: var(--lumo-error-color);
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to right,
        var(--lumo-error-color-10pct) 10%,
        var(--lumo-error-color)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to left,
        var(--lumo-error-color-10pct) 10%,
        var(--lumo-error-color)
      );
    }

    /* Primary color */
    :host([theme~='success']) [part='value'],
    :host([theme~='success']) [part='value']::before {
      background-color: var(--lumo-success-color);
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to right,
        var(--lumo-success-color-10pct) 10%,
        var(--lumo-success-color)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to left,
        var(--lumo-success-color-10pct) 10%,
        var(--lumo-success-color)
      );
    }

    /* RTL specific styles */
    :host([indeterminate][dir='rtl']) [part='value'] {
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to left,
        var(--lumo-primary-color-10pct) 10%,
        var(--lumo-primary-color)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to right,
        var(--lumo-primary-color-10pct) 10%,
        var(--lumo-primary-color)
      );
      animation: vaadin-progress-indeterminate-rtl 1.6s infinite cubic-bezier(0.355, 0.045, 0.645, 1);
    }

    :host(:not([aria-valuenow])[dir='rtl']) [part='value']::before,
    :host([indeterminate][dir='rtl']) [part='value']::before {
      animation: vaadin-progress-pulse3 1.6s infinite cubic-bezier(0.355, 0.045, 0.645, 1);
    }

    @keyframes vaadin-progress-indeterminate-rtl {
      0% {
        transform: scaleX(0.015);
        transform-origin: 100% 0%;
      }

      25% {
        transform: scaleX(0.4);
      }

      50% {
        transform: scaleX(0.015);
        transform-origin: 0% 0%;
        background-image: var(--lumo-progress-indeterminate-progress-bar-background);
      }

      50.1% {
        transform: scaleX(0.015);
        transform-origin: 0% 0%;
        background-image: var(--lumo-progress-indeterminate-progress-bar-background-reverse);
      }

      75% {
        transform: scaleX(0.4);
      }

      100% {
        transform: scaleX(0.015);
        transform-origin: 100% 0%;
        background-image: var(--lumo-progress-indeterminate-progress-bar-background-reverse);
      }
    }

    /* Contrast color */
    :host([theme~='contrast'][dir='rtl']) [part='value'],
    :host([theme~='contrast'][dir='rtl']) [part='value']::before {
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to left,
        var(--lumo-contrast-5pct) 10%,
        var(--lumo-contrast-80pct)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to right,
        var(--lumo-contrast-5pct) 10%,
        var(--lumo-contrast-60pct)
      );
    }

    /* Error color */
    :host([theme~='error'][dir='rtl']) [part='value'],
    :host([theme~='error'][dir='rtl']) [part='value']::before {
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to left,
        var(--lumo-error-color-10pct) 10%,
        var(--lumo-error-color)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to right,
        var(--lumo-error-color-10pct) 10%,
        var(--lumo-error-color)
      );
    }

    /* Primary color */
    :host([theme~='success'][dir='rtl']) [part='value'],
    :host([theme~='success'][dir='rtl']) [part='value']::before {
      --lumo-progress-indeterminate-progress-bar-background: linear-gradient(
        to left,
        var(--lumo-success-color-10pct) 10%,
        var(--lumo-success-color)
      );
      --lumo-progress-indeterminate-progress-bar-background-reverse: linear-gradient(
        to right,
        var(--lumo-success-color-10pct) 10%,
        var(--lumo-success-color)
      );
    }
  `,{moduleId:"lumo-progress-bar"});const RG=document.createElement("template");RG.innerHTML=`
  <style>
    @keyframes vaadin-progress-pulse3 {
      0% { opacity: 1; }
      10% { opacity: 0; }
      40% { opacity: 0; }
      50% { opacity: 1; }
      50.1% { opacity: 1; }
      60% { opacity: 0; }
      90% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
`;document.head.appendChild(RG.content);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const kRe=Ye`
  :host {
    display: block;
    width: 100%; /* prevent collapsing inside non-stretching column flex */
    height: 8px;
  }

  :host([hidden]) {
    display: none !important;
  }

  [part='bar'] {
    height: 100%;
  }

  [part='value'] {
    height: 100%;
    transform-origin: 0 50%;
    transform: scaleX(var(--vaadin-progress-value));
  }

  :host([dir='rtl']) [part='value'] {
    transform-origin: 100% 50%;
  }

  @media (forced-colors: active) {
    [part='bar'] {
      outline: 1px solid;
    }

    [part='value'] {
      background-color: AccentColor !important;
      forced-color-adjust: none;
    }
  }
`;/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const PRe=r=>class extends r{static get properties(){return{value:{type:Number,observer:"_valueChanged"},min:{type:Number,value:0,observer:"_minChanged"},max:{type:Number,value:1,observer:"_maxChanged"},indeterminate:{type:Boolean,value:!1,reflectToAttribute:!0}}}static get observers(){return["_normalizedValueChanged(value, min, max)"]}ready(){super.ready(),this.setAttribute("role","progressbar")}_normalizedValueChanged(t,n,i){const o=this._normalizeValue(t,n,i);this.style.setProperty("--vaadin-progress-value",o)}_valueChanged(t){this.setAttribute("aria-valuenow",t)}_minChanged(t){this.setAttribute("aria-valuemin",t)}_maxChanged(t){this.setAttribute("aria-valuemax",t)}_normalizeValue(t,n,i){let o;return!t&&t!==0?o=0:n>=i?o=1:(o=(t-n)/(i-n),o=Math.min(Math.max(o,0),1)),o}};/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */gc("vaadin-progress-bar",kRe,{moduleId:"vaadin-progress-bar-styles"});class IRe extends $6(Gv(PRe(Jv))){static get is(){return"vaadin-progress-bar"}static get template(){return Zv`
      <div part="bar">
        <div part="value"></div>
      </div>
    `}}um(IRe);/**
 * @license
 * Copyright (c) 2017 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const DG=Ye`
  [part$='button'] {
    flex: none;
    width: 1em;
    height: 1em;
    line-height: 1;
    font-size: var(--lumo-icon-size-m);
    text-align: center;
    color: var(--lumo-contrast-60pct);
    transition: 0.2s color;
    cursor: var(--lumo-clickable-cursor);
  }

  [part$='button']:hover {
    color: var(--lumo-contrast-90pct);
  }

  :host([disabled]) [part$='button'],
  :host([readonly]) [part$='button'] {
    color: var(--lumo-contrast-20pct);
    cursor: default;
  }

  [part$='button']::before {
    font-family: 'lumo-icons';
    display: block;
  }
`;gc("",DG,{moduleId:"lumo-field-button"});gc("vaadin-upload",Ye`
    :host {
      line-height: var(--lumo-line-height-m);
    }

    :host(:not([nodrop])) {
      overflow: hidden;
      border: 1px dashed var(--lumo-contrast-20pct);
      border-radius: var(--lumo-border-radius-l);
      padding: var(--lumo-space-m);
      transition: background-color 0.6s, border-color 0.6s;
    }

    [part='drop-label'] {
      display: inline-block;
      white-space: normal;
      padding: 0 var(--lumo-space-s);
      color: var(--lumo-secondary-text-color);
      font-family: var(--lumo-font-family);
    }

    :host([dragover-valid]) {
      border-color: var(--lumo-primary-color-50pct);
      background: var(--lumo-primary-color-10pct);
      transition: background-color 0.1s, border-color 0.1s;
    }

    :host([dragover-valid]) [part='drop-label'] {
      color: var(--lumo-primary-text-color);
    }

    :host([max-files-reached]) [part='drop-label'] {
      color: var(--lumo-disabled-text-color);
    }
  `,{moduleId:"lumo-upload"});gc("vaadin-upload-icon",Ye`
    :host::before {
      content: var(--lumo-icons-upload);
      font-family: lumo-icons;
      font-size: var(--lumo-icon-size-m);
      line-height: 1;
      vertical-align: -0.25em;
    }
  `,{moduleId:"lumo-upload-icon"});gc("vaadin-upload-file-list",Ye`
    ::slotted(li:not(:first-of-type)) {
      border-top: 1px solid var(--lumo-contrast-10pct);
    }
  `,{moduleId:"lumo-upload-file-list"});const ORe=Ye`
  :host {
    padding: var(--lumo-space-s) 0;
    outline: none;
    --_focus-ring-color: var(--vaadin-focus-ring-color, var(--lumo-primary-color-50pct));
    --_focus-ring-width: var(--vaadin-focus-ring-width, 2px);
  }

  :host([focus-ring]) [part='row'] {
    border-radius: var(--lumo-border-radius-s);
    box-shadow: 0 0 0 var(--_focus-ring-width) var(--_focus-ring-color);
  }

  [part='row'] {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
  }

  [part='status'],
  [part='error'] {
    color: var(--lumo-secondary-text-color);
    font-size: var(--lumo-font-size-s);
  }

  [part='info'] {
    display: flex;
    align-items: baseline;
    flex: auto;
  }

  [part='meta'] {
    width: 0.001px;
    flex: 1 1 auto;
  }

  [part='name'] {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  [part='commands'] {
    display: flex;
    align-items: baseline;
    flex: none;
  }

  [part$='icon'] {
    margin-right: var(--lumo-space-xs);
    font-size: var(--lumo-icon-size-m);
    font-family: 'lumo-icons';
    line-height: 1;
  }

  /* When both icons are hidden, let us keep space for one */
  [part='done-icon'][hidden] + [part='warning-icon'][hidden] {
    display: block !important;
    visibility: hidden;
  }

  [part$='button'] {
    flex: none;
    margin-left: var(--lumo-space-xs);
    cursor: var(--lumo-clickable-cursor);
  }

  [part$='button']:focus {
    outline: none;
    border-radius: var(--lumo-border-radius-s);
    box-shadow: 0 0 0 var(--_focus-ring-width) var(--_focus-ring-color);
  }

  [part$='icon']::before,
  [part$='button']::before {
    vertical-align: -0.25em;
  }

  [part='done-icon']::before {
    content: var(--lumo-icons-checkmark);
    color: var(--lumo-primary-text-color);
  }

  [part='warning-icon']::before {
    content: var(--lumo-icons-error);
    color: var(--lumo-error-text-color);
  }

  [part='start-button']::before {
    content: var(--lumo-icons-play);
  }

  [part='retry-button']::before {
    content: var(--lumo-icons-reload);
  }

  [part='remove-button']::before {
    content: var(--lumo-icons-cross);
  }

  [part='error'] {
    color: var(--lumo-error-text-color);
  }

  ::slotted([slot='progress']) {
    width: auto;
    margin-left: calc(var(--lumo-icon-size-m) + var(--lumo-space-xs));
    margin-right: calc(var(--lumo-icon-size-m) + var(--lumo-space-xs));
  }
`;gc("vaadin-upload-file",[DG,ORe],{moduleId:"lumo-upload-file"});/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class CRe extends Gv(Jv){static get is(){return"vaadin-upload-icon"}static get template(){return Zv`
      <style>
        :host {
          display: inline-block;
        }

        :host([hidden]) {
          display: none !important;
        }
      </style>
    `}}um(CRe);/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const MG=document.createElement("template");MG.innerHTML=`
  <style>
    @font-face {
      font-family: 'vaadin-upload-icons';
      src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAasAAsAAAAABmAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgDxIF5mNtYXAAAAFoAAAAVAAAAFQXVtKMZ2FzcAAAAbwAAAAIAAAACAAAABBnbHlmAAABxAAAAfQAAAH0bBJxYWhlYWQAAAO4AAAANgAAADYPD267aGhlYQAAA/AAAAAkAAAAJAfCA8tobXR4AAAEFAAAACgAAAAoHgAAx2xvY2EAAAQ8AAAAFgAAABYCSgHsbWF4cAAABFQAAAAgAAAAIAAOADVuYW1lAAAEdAAAAhYAAAIWmmcHf3Bvc3QAAAaMAAAAIAAAACAAAwAAAAMDtwGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA6QUDwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADgAAAAKAAgAAgACAAEAIOkF//3//wAAAAAAIOkA//3//wAB/+MXBAADAAEAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAgAA/8AEAAPAABkAMgAAEz4DMzIeAhczLgMjIg4CBycRIScFIRcOAyMiLgInIx4DMzI+AjcXphZGWmo6SH9kQwyADFiGrmJIhXJbIEYBAFoDWv76YBZGXGw8Rn5lRQyADFmIrWBIhHReIkYCWjJVPSIyVnVDXqN5RiVEYTxG/wBa2loyVT0iMlZ1Q16jeUYnRWE5RgAAAAABAIAAAAOAA4AAAgAAExEBgAMAA4D8gAHAAAAAAwAAAAAEAAOAAAIADgASAAAJASElIiY1NDYzMhYVFAYnETMRAgD+AAQA/gAdIyMdHSMjXYADgPyAgCMdHSMjHR0jwAEA/wAAAQANADMD5gNaAAUAACUBNwUBFwHT/jptATMBppMzAU2a4AIgdAAAAAEAOv/6A8YDhgALAAABJwkBBwkBFwkBNwEDxoz+xv7GjAFA/sCMAToBOoz+wAL6jP7AAUCM/sb+xowBQP7AjAE6AAAAAwAA/8AEAAPAAAcACwASAAABFSE1IREhEQEjNTMJAjMRIRECwP6A/sAEAP0AgIACQP7A/sDAAQABQICA/oABgP8AgAHAAUD+wP6AAYAAAAABAAAAAQAAdhiEdV8PPPUACwQAAAAAANX4FR8AAAAA1fgVHwAA/8AEAAPAAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAQAAAEAAAAAAAAAAAAAAAAAAAAKBAAAAAAAAAAAAAAAAgAAAAQAAAAEAACABAAAAAQAAA0EAAA6BAAAAAAAAAAACgAUAB4AagB4AJwAsADSAPoAAAABAAAACgAzAAMAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAADgCuAAEAAAAAAAEAEwAAAAEAAAAAAAIABwDMAAEAAAAAAAMAEwBaAAEAAAAAAAQAEwDhAAEAAAAAAAUACwA5AAEAAAAAAAYAEwCTAAEAAAAAAAoAGgEaAAMAAQQJAAEAJgATAAMAAQQJAAIADgDTAAMAAQQJAAMAJgBtAAMAAQQJAAQAJgD0AAMAAQQJAAUAFgBEAAMAAQQJAAYAJgCmAAMAAQQJAAoANAE0dmFhZGluLXVwbG9hZC1pY29ucwB2AGEAYQBkAGkAbgAtAHUAcABsAG8AYQBkAC0AaQBjAG8AbgBzVmVyc2lvbiAxLjAAVgBlAHIAcwBpAG8AbgAgADEALgAwdmFhZGluLXVwbG9hZC1pY29ucwB2AGEAYQBkAGkAbgAtAHUAcABsAG8AYQBkAC0AaQBjAG8AbgBzdmFhZGluLXVwbG9hZC1pY29ucwB2AGEAYQBkAGkAbgAtAHUAcABsAG8AYQBkAC0AaQBjAG8AbgBzUmVndWxhcgBSAGUAZwB1AGwAYQBydmFhZGluLXVwbG9hZC1pY29ucwB2AGEAYQBkAGkAbgAtAHUAcABsAG8AYQBkAC0AaQBjAG8AbgBzRm9udCBnZW5lcmF0ZWQgYnkgSWNvTW9vbi4ARgBvAG4AdAAgAGcAZQBuAGUAcgBhAHQAZQBkACAAYgB5ACAASQBjAG8ATQBvAG8AbgAuAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==) format('woff');
      font-weight: normal;
      font-style: normal;
    }
  </style>
`;document.head.appendChild(MG.content);/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const RRe=r=>class extends CG(r){static get properties(){return{complete:{type:Boolean,value:!1,reflectToAttribute:!0},errorMessage:{type:String,value:"",observer:"_errorMessageChanged"},file:{type:Object},fileName:{type:String},held:{type:Boolean,value:!1},indeterminate:{type:Boolean,value:!1,reflectToAttribute:!0},i18n:{type:Object},progress:{type:Number},status:{type:String},tabindex:{type:Number,value:0,reflectToAttribute:!0},uploading:{type:Boolean,value:!1,reflectToAttribute:!0},_progress:{type:Object}}}static get observers(){return["__updateProgress(_progress, progress, indeterminate)"]}ready(){super.ready(),this.addController(new vv(this,"progress","vaadin-progress-bar",{initializer:t=>{this._progress=t}})),this.shadowRoot.addEventListener("focusin",t=>{t.composedPath()[0].getAttribute("part").endsWith("button")&&this._setFocused(!1)}),this.shadowRoot.addEventListener("focusout",t=>{t.relatedTarget===this&&this._setFocused(!0)})}_shouldSetFocus(t){return t.composedPath()[0]===this}_errorMessageChanged(t){this.toggleAttribute("error",!!t)}__updateProgress(t,n,i){t&&(t.value=isNaN(n)?0:n/100,t.indeterminate=i)}_fireFileEvent(t){return t.preventDefault(),this.dispatchEvent(new CustomEvent(t.target.getAttribute("file-event"),{detail:{file:this.file},bubbles:!0,composed:!0}))}};/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const DRe=Ye`
  :host {
    display: block;
  }

  [hidden] {
    display: none;
  }

  [part='row'] {
    list-style-type: none;
  }

  button {
    background: transparent;
    padding: 0;
    border: none;
    box-shadow: none;
  }

  :host([complete]) ::slotted([slot='progress']),
  :host([error]) ::slotted([slot='progress']) {
    display: none !important;
  }
`;/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */gc("vaadin-upload-file",DRe,{moduleId:"vaadin-upload-file-styles"});class MRe extends RRe(Gv(T6(Jv))){static get template(){return Zv`
      <div part="row">
        <div part="info">
          <div part="done-icon" hidden$="[[!complete]]" aria-hidden="true"></div>
          <div part="warning-icon" hidden$="[[!errorMessage]]" aria-hidden="true"></div>

          <div part="meta">
            <div part="name" id="name">[[fileName]]</div>
            <div part="status" hidden$="[[!status]]" id="status">[[status]]</div>
            <div part="error" id="error" hidden$="[[!errorMessage]]">[[errorMessage]]</div>
          </div>
        </div>
        <div part="commands">
          <button
            type="button"
            part="start-button"
            file-event="file-start"
            on-click="_fireFileEvent"
            hidden$="[[!held]]"
            aria-label$="[[i18n.file.start]]"
            aria-describedby="name"
          ></button>
          <button
            type="button"
            part="retry-button"
            file-event="file-retry"
            on-click="_fireFileEvent"
            hidden$="[[!errorMessage]]"
            aria-label$="[[i18n.file.retry]]"
            aria-describedby="name"
          ></button>
          <button
            type="button"
            part="remove-button"
            file-event="file-abort"
            on-click="_fireFileEvent"
            aria-label$="[[i18n.file.remove]]"
            aria-describedby="name"
          ></button>
        </div>
      </div>

      <slot name="progress"></slot>
    `}static get is(){return"vaadin-upload-file"}}um(MRe);/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const BRe=r=>class extends r{static get properties(){return{items:{type:Array},i18n:{type:Object}}}static get observers(){return["__updateItems(items, i18n)"]}__updateItems(t,n){t&&n&&this.requestContentUpdate()}requestContentUpdate(){const{items:t,i18n:n}=this;AL(Ie`
          ${t.map(i=>Ie`
              <li>
                <vaadin-upload-file
                  .file="${i}"
                  .complete="${i.complete}"
                  .errorMessage="${i.error}"
                  .fileName="${i.name}"
                  .held="${i.held}"
                  .indeterminate="${i.indeterminate}"
                  .progress="${i.progress}"
                  .status="${i.status}"
                  .uploading="${i.uploading}"
                  .i18n="${n}"
                ></vaadin-upload-file>
              </li>
            `)}
        `,this)}};/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class jRe extends BRe(Gv(Jv)){static get is(){return"vaadin-upload-file-list"}static get template(){return Zv`
      <style>
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none !important;
        }

        [part='list'] {
          padding: 0;
          margin: 0;
          list-style-type: none;
        }
      </style>
      <ul part="list">
        <slot></slot>
      </ul>
    `}}um(jRe);/**
 * @license
 * Copyright (c) 2022 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const Mc=document.createElement("div");Mc.style.position="fixed";Mc.style.clip="rect(0px, 0px, 0px, 0px)";Mc.setAttribute("aria-live","polite");document.body.appendChild(Mc);let F2;function q2(r,e={}){const t=e.mode||"polite",n=e.timeout===void 0?150:e.timeout;t==="alert"?(Mc.removeAttribute("aria-live"),Mc.removeAttribute("role"),F2=a_.debounce(F2,VCe,()=>{Mc.setAttribute("role","alert")})):(F2&&F2.cancel(),Mc.removeAttribute("role"),Mc.setAttribute("aria-live",t)),Mc.textContent="",setTimeout(()=>{Mc.textContent=r},n)}/**
 * @license
 * Copyright (c) 2021 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */const fT=r=>r.test(navigator.userAgent),U5=r=>r.test(navigator.platform),NRe=r=>r.test(navigator.vendor);fT(/Android/u);fT(/Chrome/u)&&NRe(/Google Inc/u);fT(/Firefox/u);U5(/^iPad/u)||U5(/^Mac/u)&&navigator.maxTouchPoints>1;U5(/^iPhone/u);fT(/^((?!chrome|android).)*safari/iu);const URe=(()=>{try{return document.createEvent("TouchEvent"),!0}catch{return!1}})();/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class LRe extends vv{constructor(e){super(e,"add-button","vaadin-button")}initNode(e){e._isDefault&&(this.defaultNode=e),e.addEventListener("touchend",t=>{this.host._onAddFilesTouchEnd(t)}),e.addEventListener("click",t=>{this.host._onAddFilesClick(t)}),this.host._addButton=e}}class KRe extends vv{constructor(e){super(e,"drop-label","span")}initNode(e){e._isDefault&&(this.defaultNode=e),this.host._dropLabel=e}}const zRe=r=>class extends r{static get properties(){return{nodrop:{type:Boolean,reflectToAttribute:!0,value:URe},target:{type:String,value:""},method:{type:String,value:"POST"},headers:{type:Object,value:{}},timeout:{type:Number,value:0},_dragover:{type:Boolean,value:!1,observer:"_dragoverChanged"},files:{type:Array,notify:!0,value:()=>[],sync:!0},maxFiles:{type:Number,value:1/0,sync:!0},maxFilesReached:{type:Boolean,value:!1,notify:!0,readOnly:!0,reflectToAttribute:!0},accept:{type:String,value:""},maxFileSize:{type:Number,value:1/0},_dragoverValid:{type:Boolean,value:!1,observer:"_dragoverValidChanged"},formDataName:{type:String,value:"file"},noAuto:{type:Boolean,value:!1},withCredentials:{type:Boolean,value:!1},capture:String,i18n:{type:Object,value(){return{dropFiles:{one:"Drop file here",many:"Drop files here"},addFiles:{one:"Upload File...",many:"Upload Files..."},error:{tooManyFiles:"Too Many Files.",fileIsTooBig:"File is Too Big.",incorrectFileType:"Incorrect File Type."},uploading:{status:{connecting:"Connecting...",stalled:"Stalled",processing:"Processing File...",held:"Queued"},remainingTime:{prefix:"remaining time: ",unknown:"unknown remaining time"},error:{serverUnavailable:"Upload failed, please try again later",unexpectedServerError:"Upload failed due to server error",forbidden:"Upload forbidden"}},file:{retry:"Retry",start:"Start",remove:"Remove"},units:{size:["B","kB","MB","GB","TB","PB","EB","ZB","YB"]}}}},_addButton:{type:Object},_dropLabel:{type:Object},_fileList:{type:Object},_files:{type:Array}}}static get observers(){return["__updateAddButton(_addButton, maxFiles, i18n, maxFilesReached)","__updateDropLabel(_dropLabel, maxFiles, i18n)","__updateFileList(_fileList, files, i18n)","__updateMaxFilesReached(maxFiles, files)"]}get __acceptRegexp(){if(!this.accept)return null;const t=this.accept.split(",").map(n=>{let i=n.trim();return i=i.replace(/[+.]/gu,"\\$&"),i.startsWith("\\.")&&(i=`.*${i}$`),i.replace(/\/\*/gu,"/.*")});return new RegExp(`^(${t.join("|")})$`,"iu")}ready(){super.ready(),this.addEventListener("dragover",this._onDragover.bind(this)),this.addEventListener("dragleave",this._onDragleave.bind(this)),this.addEventListener("drop",this._onDrop.bind(this)),this.addEventListener("file-retry",this._onFileRetry.bind(this)),this.addEventListener("file-abort",this._onFileAbort.bind(this)),this.addEventListener("file-start",this._onFileStart.bind(this)),this.addEventListener("file-reject",this._onFileReject.bind(this)),this.addEventListener("upload-start",this._onUploadStart.bind(this)),this.addEventListener("upload-success",this._onUploadSuccess.bind(this)),this.addEventListener("upload-error",this._onUploadError.bind(this)),this._addButtonController=new LRe(this),this.addController(this._addButtonController),this._dropLabelController=new KRe(this),this.addController(this._dropLabelController),this.addController(new vv(this,"file-list","vaadin-upload-file-list",{initializer:t=>{this._fileList=t}})),this.addController(new vv(this,"drop-label-icon","vaadin-upload-icon"))}_formatSize(t){if(typeof this.i18n.formatSize=="function")return this.i18n.formatSize(t);const n=this.i18n.units.sizeBase||1e3,i=~~(Math.log(t)/Math.log(n)),o=Math.max(0,Math.min(3,i-1));return`${parseFloat((t/n**i).toFixed(o))} ${this.i18n.units.size[i]}`}_splitTimeByUnits(t){const n=[60,60,24,1/0],i=[0];for(let o=0;o<n.length&&t>0;o++)i[o]=t%n[o],t=Math.floor(t/n[o]);return i}_formatTime(t,n){if(typeof this.i18n.formatTime=="function")return this.i18n.formatTime(t,n);for(;n.length<3;)n.push(0);return n.reverse().map(i=>(i<10?"0":"")+i).join(":")}_formatFileProgress(t){const n=t.loaded>0?this.i18n.uploading.remainingTime.prefix+t.remainingStr:this.i18n.uploading.remainingTime.unknown;return`${t.totalStr}: ${t.progress}% (${n})`}__updateMaxFilesReached(t,n){this._setMaxFilesReached(t>=0&&n.length>=t)}__updateAddButton(t,n,i,o){t&&(t.disabled=o,t===this._addButtonController.defaultNode&&(t.textContent=this._i18nPlural(n,i.addFiles)))}__updateDropLabel(t,n,i){t&&t===this._dropLabelController.defaultNode&&(t.textContent=this._i18nPlural(n,i.dropFiles))}__updateFileList(t,n,i){t&&(t.items=[...n],t.i18n=i)}_onDragover(t){t.preventDefault(),!this.nodrop&&!this._dragover&&(this._dragoverValid=!this.maxFilesReached,this._dragover=!0),t.dataTransfer.dropEffect=!this._dragoverValid||this.nodrop?"none":"copy"}_onDragleave(t){t.preventDefault(),this._dragover&&!this.nodrop&&(this._dragover=this._dragoverValid=!1)}_onDrop(t){this.nodrop||(t.preventDefault(),this._dragover=this._dragoverValid=!1,this._addFiles(t.dataTransfer.files))}_createXhr(){return new XMLHttpRequest}_configureXhr(t){if(typeof this.headers=="string")try{this.headers=JSON.parse(this.headers)}catch{this.headers=void 0}Object.entries(this.headers).forEach(([n,i])=>{t.setRequestHeader(n,i)}),this.timeout&&(t.timeout=this.timeout),t.withCredentials=this.withCredentials}_setStatus(t,n,i,o){t.elapsed=o,t.elapsedStr=this._formatTime(t.elapsed,this._splitTimeByUnits(t.elapsed)),t.remaining=Math.ceil(o*(n/i-1)),t.remainingStr=this._formatTime(t.remaining,this._splitTimeByUnits(t.remaining)),t.speed=~~(n/o/1024),t.totalStr=this._formatSize(n),t.loadedStr=this._formatSize(i),t.status=this._formatFileProgress(t)}uploadFiles(t=this.files){t&&!Array.isArray(t)&&(t=[t]),t=t.filter(n=>!n.complete),Array.prototype.forEach.call(t,this._uploadFile.bind(this))}_uploadFile(t){if(t.uploading)return;const n=Date.now(),i=t.xhr=this._createXhr();let o,s;i.upload.onprogress=c=>{clearTimeout(o),s=Date.now();const u=(s-n)/1e3,f=c.loaded,h=c.total,p=~~(f/h*100);t.loaded=f,t.progress=p,t.indeterminate=f<=0||f>=h,t.error?t.indeterminate=t.status=void 0:t.abort||(p<100?(this._setStatus(t,h,f,u),o=setTimeout(()=>{t.status=this.i18n.uploading.status.stalled,this._renderFileList()},2e3)):(t.loadedStr=t.totalStr,t.status=this.i18n.uploading.status.processing)),this._renderFileList(),this.dispatchEvent(new CustomEvent("upload-progress",{detail:{file:t,xhr:i}}))},i.onreadystatechange=()=>{if(i.readyState===4){if(clearTimeout(o),t.indeterminate=t.uploading=!1,t.abort||(t.status="",!this.dispatchEvent(new CustomEvent("upload-response",{detail:{file:t,xhr:i},cancelable:!0}))))return;i.status===0?t.error=this.i18n.uploading.error.serverUnavailable:i.status>=500?t.error=this.i18n.uploading.error.unexpectedServerError:i.status>=400&&(t.error=this.i18n.uploading.error.forbidden),t.complete=!t.error,this.dispatchEvent(new CustomEvent(`upload-${t.error?"error":"success"}`,{detail:{file:t,xhr:i}})),this._renderFileList()}};const a=new FormData;if(t.uploadTarget=t.uploadTarget||this.target||"",t.formDataName=this.formDataName,!this.dispatchEvent(new CustomEvent("upload-before",{detail:{file:t,xhr:i},cancelable:!0})))return;a.append(t.formDataName,t,t.name),i.open(this.method,t.uploadTarget,!0),this._configureXhr(i),t.status=this.i18n.uploading.status.connecting,t.uploading=t.indeterminate=!0,t.complete=t.abort=t.error=t.held=!1,i.upload.onloadstart=()=>{this.dispatchEvent(new CustomEvent("upload-start",{detail:{file:t,xhr:i}})),this._renderFileList()},this.dispatchEvent(new CustomEvent("upload-request",{detail:{file:t,xhr:i,formData:a},cancelable:!0}))&&i.send(a)}_retryFileUpload(t){this.dispatchEvent(new CustomEvent("upload-retry",{detail:{file:t,xhr:t.xhr},cancelable:!0}))&&this._uploadFile(t)}_abortFileUpload(t){this.dispatchEvent(new CustomEvent("upload-abort",{detail:{file:t,xhr:t.xhr},cancelable:!0}))&&(t.abort=!0,t.xhr&&t.xhr.abort(),this._removeFile(t))}_renderFileList(){this._fileList&&this._fileList.requestContentUpdate()}_addFiles(t){Array.prototype.forEach.call(t,this._addFile.bind(this))}_addFile(t){if(this.maxFilesReached){this.dispatchEvent(new CustomEvent("file-reject",{detail:{file:t,error:this.i18n.error.tooManyFiles}}));return}if(this.maxFileSize>=0&&t.size>this.maxFileSize){this.dispatchEvent(new CustomEvent("file-reject",{detail:{file:t,error:this.i18n.error.fileIsTooBig}}));return}const n=this.__acceptRegexp;if(n&&!(n.test(t.type)||n.test(t.name))){this.dispatchEvent(new CustomEvent("file-reject",{detail:{file:t,error:this.i18n.error.incorrectFileType}}));return}t.loaded=0,t.held=!0,t.status=this.i18n.uploading.status.held,this.files=[t,...this.files],this.noAuto||this._uploadFile(t)}_removeFile(t){this.files.indexOf(t)>-1&&(this.files=this.files.filter(n=>n!==t),this.dispatchEvent(new CustomEvent("file-remove",{detail:{file:t},bubbles:!0,composed:!0})))}_onAddFilesTouchEnd(t){t.preventDefault(),this._onAddFilesClick(t)}_onAddFilesClick(t){this.maxFilesReached||(t.stopPropagation(),this.$.fileInput.value="",this.$.fileInput.click())}_onFileInputChange(t){this._addFiles(t.target.files)}_onFileStart(t){this._uploadFile(t.detail.file)}_onFileRetry(t){this._retryFileUpload(t.detail.file)}_onFileAbort(t){this._abortFileUpload(t.detail.file)}_onFileReject(t){q2(`${t.detail.file.name}: ${t.detail.error}`,{mode:"alert"})}_onUploadStart(t){q2(`${t.detail.file.name}: 0%`,{mode:"alert"})}_onUploadSuccess(t){q2(`${t.detail.file.name}: 100%`,{mode:"alert"})}_onUploadError(t){q2(`${t.detail.file.name}: ${t.detail.file.error}`,{mode:"alert"})}_dragoverChanged(t){t?this.setAttribute("dragover",t):this.removeAttribute("dragover")}_dragoverValidChanged(t){t?this.setAttribute("dragover-valid",t):this.removeAttribute("dragover-valid")}_i18nPlural(t,n){return t===1?n.one:n.many}_isMultiple(t){return t!==1}};/**
 * @license
 * Copyright (c) 2016 - 2024 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */class FRe extends zRe($6(Gv(T6(Jv)))){static get template(){return Zv`
      <style>
        :host {
          display: block;
          position: relative;
          box-sizing: border-box;
        }

        :host([hidden]) {
          display: none !important;
        }

        [hidden] {
          display: none !important;
        }
      </style>

      <div part="primary-buttons">
        <slot name="add-button"></slot>
        <div part="drop-label" hidden$="[[nodrop]]" id="dropLabelContainer" aria-hidden="true">
          <slot name="drop-label-icon"></slot>
          <slot name="drop-label"></slot>
        </div>
      </div>
      <slot name="file-list"></slot>
      <slot></slot>
      <input
        type="file"
        id="fileInput"
        hidden
        on-change="_onFileInputChange"
        accept$="{{accept}}"
        multiple$="[[_isMultiple(maxFiles)]]"
        capture$="[[capture]]"
      />
    `}static get is(){return"vaadin-upload"}}um(FRe);class qRe extends hi.with(Ju,wd){static properties={identities:{store:"page"}};static query={createIdentityLabel:"#create_identity_label",createIdentityButton:"#create_identity_button"};render(){return Ie`
      <sl-input id="create_identity_label" label="Add a Label" placeholder="Ex: social, career" pattern="^[a-zA-Z0-9]{3,}$" required></sl-input>
      <sl-button id="create_identity_button" variant="success" @click="${async e=>{const t=this.createIdentityLabel.value||"";if(!/^[a-zA-Z0-9]{3,}$/.test(t)){Su.fireEvent(this,"invalid-label");return}if(this.createIdentityButton.loading)return!1;this.createIdentityButton.loading=!0;const i=await fn.identity.create({dwnEndpoints:["http://localhost:3000"]});await fn.identity.addAutofillDid(t+"@"+i.did.uri),zu.addIdentities(i),this.createIdentityButton.loading=!1,Su.fireEvent(this,"identity-created",{detail:{identity:i}})}}">
        Create
      </sl-button>
    `}static styles=[dm,Ye`
      #create_identity_button {
        display: block;
        margin: 1.5rem auto 0;
      }
    `]}customElements.define("create-identity",qRe);class VRe extends hi.with(Ju,wd,f1){static properties={ready:{store:"page"},identities:{store:"page"},identityEndpointUpdate:{type:Object}};static query={createIdentityButton:"#create_identity_button",createIdentityModal:["#create_identity_modal",!0],restoreIdentityButton:"#restore_identity_button",modifyEndpointsModal:["#modify_endpoints_modal",!0]};constructor(){super(),this.lastIdentityLabelSave=Date.now(),this.profileProtocolUri=encodeURIComponent(Hy.uri)}firstUpdated(){this.ready.state||this.startSpinner({target:"section",minimum:500,renderImmediate:!0}),this.ready.then(()=>{this.stopSpinner()})}toggleIdentityDetails(e){const t=e.currentTarget,n=t.closest("li").querySelector("detail-box");n.toggle(),t.firstElementChild.name=n.open?"chevron-up":"chevron-down"}generateEndpointItems(e,t,n){return(e.did.document.service||[]).reduce((i,o)=>{if(!i&&o.type==="DecentralizedWebNode"){let s=o.serviceEndpoint||[];s=Array.isArray(s)?s:[s],n&&(s=this.identityEndpointUpdate.endpoints=this.identityEndpointUpdate.endpoints||[...s]),i=t(s,e)}return i},null)}openEndpointModal(e){(!this.identityEndpointUpdate||this.identityEndpointUpdate.identity!==e)&&(this.identityEndpointUpdate={identity:e}),this.modifyEndpointsModal.show()}closeEndpointModal(){this.modifyEndpointsModal.hide()}async updateEndpoints(e){if(!this.identityEndpointUpdate)return;const{identity:t,endpoints:n}=this.identityEndpointUpdate;console.log(n);try{const i=await DWeb.did.update(t,o=>{const s=o.service.find(a=>a.type==="DecentralizedWebNode");s&&(s.serviceEndpoint=n.reduce((a,l)=>(l=l.trim(),l.length&&a.push(l),a),[])),s.serviceEndpoint=n});return e&&this.closeEndpointModal(),i}catch{}}async saveIdentityLabel(e,t){console.log(e);let n=e.target.value.trim().toLowerCase(),i=t.connectRecord?.cache?.json?.label||"";n&&n!==i&&Date.now()>this.lastIdentityLabelSave+2e3&&(this.lastIdentityLabelSave=Date.now(),await zu.saveIdentityLabel(t,n).then(o=>jl.success("Your profile info was saved")).catch(o=>{o.target.value=i,jl.error("There was an error saving your new label for this identity")}))}render(){const e=Object.values(this.identities||{});return Ie`
      <section page-section>
        ${e?.length?Ie`
            <h2>Identities</h2>
            <ul id="identity_list" limit-width>
              ${e.map(t=>{const n=t.connectedDid;return Ie`
                <li>
                  <div flex="center-y">
                    <a href="/profiles/${n}">
                      <sl-avatar image="${t.avatar||`https://dweb/${n}/read/protocols/${this.profileProtocolUri}/avatar`}" shape="circle" size="small"></sl-avatar>
                      ${n}
                    </a> 
                    <sl-button detail-box-toggle circle size="small" @click="${this.toggleIdentityDetails}">
                      <sl-icon name="chevron-down"></sl-icon>
                    </sl-button>
                  </div>
                  <detail-box hide-toggle>
                    <div>
                      <div columns="2 labels-right">
                        <span>Identity Label:</span>
                        <div>
                          <sl-input size="small" value="${t?.connectRecord?.cache?.json?.label}" autocomplete="off" placeholder="Ex: social, career, family" 
                            @sl-input="${i=>i.target.value=i.target.value.trim().toLowerCase()}"
                            @sl-change="${i=>this.saveIdentityLabel(i,t)}"
                          ></sl-input>
                        </div>

                        <span>Backup:</span>
                        <div>
                          <sl-button size="small" @click="${i=>DWeb.identity.backup(t,{to:"file"})}">
                            <sl-icon slot="prefix" name="download"></sl-icon> Download identity backup
                          </sl-button>
                        </div>
                      </div>

                      <h3 flex="center-y">
                        <span>Datastore Locations</span>
                        <sl-icon-button name="pencil" variant="default" size="medium" @click="${i=>this.openEndpointModal(t)}"></sl-icon-button>
                      </h3>
                      ${this.generateEndpointItems(t,i=>Ie`<div>${i.join("<br>")}</div>`)}
                    </div>
                  </detail-box>
                </li>
              `})}
            </ul>
            <div id="create_restore_buttons" flex="center-x center-y">
              <sl-button id="create_identity_button" variant="success" size="small" @click="${t=>this.createIdentityModal.show()}">
                <sl-icon slot="prefix" name="person-plus"></sl-icon> Create an Identity
              </sl-button>
              <sl-button id="restore_identity_button" variant="primary" size="small" @click="${t=>zu.restoreIdentityModal.show()}">
                <sl-icon slot="prefix" name="person-up"></sl-icon> Restore an Identity
              </sl-button>
            </div>
          `:Ie`
            <connect-widget></connect-widget>
          `}
      </section>

      <sl-dialog id="create_identity_modal" label="Create an Identity" placement="start" fit-content>
        <create-identity @identity-created="${t=>this.createIdentityModal.hide()}"></create-identity>
      </sl-dialog>

      <sl-dialog id="modify_endpoints_modal" label="Modify Endpoints" placement="start" @sl-after-hide="${t=>this.identityEndpointUpdate=null}">
        <div id="modify_endpoints_identity" flex="center-y">
          ${this.identityEndpointUpdate?Ie`
                <sl-avatar image="${this.identityEndpointUpdate.identity?.avatar||`https://dweb/${this.identityEndpointUpdate.identity.connectedDid}/read/protocols/${this.profileProtocolUri}/avatar`}" shape="circle" size="small"></sl-avatar>
                <div>${this.identityEndpointUpdate.identity.connectedDid}</div>
              `:Ot}
        </div>
        <p>This is an advanced feature to edit the datastore locations of the DID above. Do not change these values unless you know what you are doing.</p>
        <section>
          ${this.identityEndpointUpdate?this.generateEndpointItems(this.identityEndpointUpdate.identity,t=>t.map((n,i)=>Ie`
                  <div index="${i}" class="service-endpoint-entry" flex="center-y">

                    <sl-input class="service-endpoint-input" size="small" value="${n}" @input="${o=>{t[i]=o.target.value}}"></sl-input>

                    <sl-button class="remove-endpoint-button" size="small" @click="${o=>{t.splice(i,1),this.identityEndpointUpdate={...this.identityEndpointUpdate}}}">
                        <sl-icon slot="prefix" name="x-lg">
                      </sl-icon>
                    </sl-button>

                    <sl-button class="add-endpoint-button" size="small" @click="${o=>{t.push(""),this.identityEndpointUpdate={...this.identityEndpointUpdate}}}">
                      <sl-icon slot="prefix" name="plus-lg"></sl-icon>
                    </sl-button>
                  </div>
                `),!0):Ot}
        </section>
        <sl-button id="close_endpoints_button" slot="footer" @click="${async t=>this.closeEndpointModal()}">Close</sl-button>
        <sl-button id="submit_endpoints_button" slot="footer" variant="success" @click="${async t=>this.updateEndpoints(!0)}">Submit</sl-button>
      </sl-dialog>

      
    `}static styles=[dm,dT,Ye`
      :host > section {
        
      }

      connect-widget {
        align-self: center;
      }

      #identity_list li {
        --border: 1px solid rgb(255 255 255 / 8%);
        list-style: none;
        border-bottom: var(--border);
      }

      #identity_list li:first-child {
        border-top: var(--border);
      } 

      #identity_list a {
        width: 100%;
        padding: 1.1rem 0 1rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-decoration: none;
        color: var(--sl-color-blue-700);
        cursor: pointer;
      }

      #identity_list sl-avatar {
        --size: 2.25rem;
        margin: 0 0.5rem 0 0;
      }

      #identity_list [detail-box-toggle] {
        margin: 0 0 0 0.75rem;
      }

      #identity_list detail-box {
        max-height: 0;
      }

      #identity_list detail-box > :first-child {
        margin-bottom: 1rem;
        padding: 1.2rem 1.1rem;
        background: rgb(183 192 254 / 4%);
        border: 1px solid rgb(183 192 254 / 9%);
        border-radius: 5px;
      }

      #identity_list detail-box h3 {
        margin: 1.75rem 0 1rem;
        border-bottom: 1px solid rgba(255 255 255 / 8%);
        padding: 0 0 0.25rem;
      }

      #identity_list detail-box h3 :not(span) {
        margin: 0 0 0 auto;
      }

      #create_restore_buttons {
        margin: 2rem 0 0;
      }

      #create_restore_buttons sl-button {
        margin: 0 0.5rem;
      }

    /* Modify Endpoints Dialog */

      #modify_endpoints_modal::part(panel) {
        max-width: 500px;
      }

      .service-endpoint-entry:not(:last-child) {
        margin-bottom: 1rem;
      }

      .service-endpoint-input {
        flex: 1;
        margin: 0;
      }

      .service-endpoint-input ~ sl-button {
        margin: 0 0 0 0.5rem;
      }

      .service-endpoint-entry sl-icon {
        stroke: currentColor;
      }

      .service-endpoint-entry .remove-endpoint-button::part(base) {
        color: #ff2e2e;
      }

      .service-endpoint-entry .add-endpoint-button::part(base) {
        color: #00ba00;
      }

      .service-endpoint-entry:not(:last-child) .add-endpoint-button {
        visibility: hidden;
        pointer-events: none;
      }

      #modify_endpoints_identity sl-avatar {
        --size: 2.25rem;
        margin: 0 0.6rem 0 0;
      }

      #modify_endpoints_identity div {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      #modify_endpoints_modal p {
        margin: 1rem 0 1.5rem;
        color: var(--sl-color-red-700);
      }

      @media(max-width: 800px) {

      }
    `]}customElements.define("identities-page",VRe);VPe();class WRe extends hi.with(P5e,Ju,wd){static query={connectModal:["#connect_modal",!0],nav:["#nav",!0],pages:["#pages",!0],connectPage:["#connect",!0],profilePage:["#profile",!0],directoryPage:["#directory",!0],identitiesPage:["#identities",!0],restoreIdentityModal:["#restore_identity_modal",!0],restoreUploader:["#restore_uploader",!0]};constructor(){super(),this.router=globalThis.router=new D5e(this,{onRouteChange:async(e,t)=>{this?.nav?.removeAttribute("open")},routes:[{path:"/",component:"#identities"},{path:"/profiles(/)?:did?",component:"#find"},{path:"/dweb-connect(/.*)?",component:"#connect"}]})}async handleRestoreUpload(e){if(!(!this.restoreUploader||!this.restoreUploader.files.length)){try{const t=await fn.identity.restore({from:"file",files:this.restoreUploader.files});t&&await App.addIdentities(t),this.restoreIdentityModal.hide()}catch(t){console.log(t)}this.restoreUploader.files=[]}}render(){return Ie`

      <header id="header">
        <sl-icon id="nav_toggle" name="list" @click="${e=>this.nav?.toggleAttribute("open")}"></sl-icon>
        <sl-icon id="logo_icon" name="app-logo"></sl-icon>
        <h1>Aliased</h1>
      </header>

      <nav id="nav" @click="${e=>this.nav?.removeAttribute("open")}">
        <a href="/" ?active="${location.pathname==="/"}">
          <sl-icon slot="prefix" name="people"></sl-icon>
          My IDs
        </a>
        <a href="/profiles" ?active="${location.pathname.startsWith("/profiles")}">
          <sl-icon slot="prefix" name="search"></sl-icon>
          Find
        </a>
      </nav>

      <main id="pages">
        <find-page id="find" page="full-width"></find-page>
        <identities-page id="identities" page></identities-page>
        <connect-page id="connect" page></connect-page>
      </main>

      <sl-dialog id="connect_modal" label="Connect" placement="start" fit-content ?open="${this?.connectModal?.open&&this.identity&&!1}">
        <connect-widget></connect-widget>
      </sl-dialog>

      <sl-dialog id="restore_identity_modal" label="Restore an Identity" placement="start" fit-content>
        <p>Upload or drop in a backup file to restore an identity.</p>
        <vaadin-upload
          id="restore_uploader"
          no-auto
          max-files="1"
          accept="text/json,application/json,.json"
          @files-changed="${this.handleRestoreUpload}"
        ></vaadin-upload>
      </sl-dialog>

      <pwa-badge></pwa-badge>

    `}static styles=[dm,Ye`
      :host {
        --header-height: 3rem;
        --nav-width: 4.5rem;
        --content-height: calc(100vh - var(--header-height));
        --page-padding: 3rem 2.25rem;
      }

      #header {
        position: sticky;
        top: 0;
        display: flex;
        align-items: center;
        height: var(--header-height);
        padding: 0 0.65rem;
        background: #17456d;
        box-shadow: 0 0 2px 2px rgba(0 0 0 / 25%);
        user-select: none;
        z-index: 2;
      }

      #nav_toggle {
        display: none;
        font-size: 1.75rem;
        margin: 0 0 0 -1.3rem;
        padding: 0 0.15em 0 0;
        opacity: 0.5;
        transition: opacity 0.3s ease;
        cursor: pointer;
      }

      #nav_toggle:hover {
        opacity: 1;
      }

      #logo_icon {
        /* Use the same hue value as the background color of the header */
        --background-color: 208; 
        font-size: 1.75rem;
      }

      #header h1 {
        margin: 0 auto -0.1rem 0.2rem;
        font-family: var(--app-font);
        font-size: 1.75rem;
        font-weight: normal
      }

      #header sl-avatar {
        --size: calc(var(--header-height) - 1rem);
      }

      :host-context(html.sl-scroll-lock) #pages {
        z-index: 3;
      } 

      #nav {
        position: fixed;
        bottom: 0;
        box-sizing: border-box;
        height: var(--content-height);
        width: var(--nav-width);
        padding: 0.6rem 0;
        background: var(--grey);
        box-shadow: 0 0 2px 1px rgba(0 0 0 / 25%);
        border-right: 1px solid rgba(0 0 0 / 60%);
        text-align: center;
        transition: transform 0.3s ease;
        z-index: 1;
      }

      #nav:before {
        content: " ";
        position: fixed;
        top: 0;
        left: 100%;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      #nav[open]:before { 
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
      }

      #nav a {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 4rem;
        margin: 0 0 0.5rem;
        font-size: 0.75rem;
        color: rgba(255,255,255,0.75);
        border-right: 2px solid transparent;
        opacity: 0.6;
        transition: opacity 0.3s ease;
        text-decoration: none;
        cursor: pointer;
      }

      #nav *:is(sl-icon, sl-avatar) {
        margin: 0 0 0.2rem;
        font-size: 1.5rem;
        color: #fff;
      }

      #nav sl-avatar {
        --size: 1.55rem;
      }

      #nav sl-icon[name="search"] {
        margin: 0 0 0.3rem;
        font-size: 1.2rem;
      }

      #nav a:hover {
        opacity: 1;
      }

      #nav a[active] {
        opacity: 1;
        color: var(--sl-color-blue-700);
        border-right: 2px solid rgb(51 117 174);
      }

      #nav a[active] sl-icon {
        color: currentColor;
      }

      #pages {
        position: relative;
        margin: 0 0 0 var(--nav-width);
      }

      #pages > * {
        display: block;
        position: absolute;
        top: 0;
        box-sizing: border-box;
        width: 100%;
        height: var(--content-height);
        padding: var(--page-padding);
        opacity: 0;
        visibility: hidden;
        transition: visibility 0.3s, opacity 0.3s ease;
        overflow-y: clip;
        z-index: -1;
      }

      #pages > [route-state="active"] {
        position: relative;
        height: auto;
        min-height: var(--content-height);
        opacity: 1;
        z-index: 0;
        visibility: visible;
        overflow: visible;
      }

      /* Restore Identity Dialog */

      vaadin-upload {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 8rem;
        border: 2px dashed rgba(255,255,255,0.2);
      }

      vaadin-upload::part(drop-label) {
        color: #fff;
      }

      vaadin-upload vaadin-button {
        color: #fff;
        background: var(--_lumo-button-primary-background);
        cursor: pointer;
      }

      @media(max-width: 800px) {
        #nav {
          top: var(--header-height);
          width: 150px;
          transform: translateX(-100%);
          z-index: 1;
        }
        #nav[open] {
          transform: translateX(0);
        }
        #nav a {
          flex-direction: row;
          justify-content: left;
          height: 3rem;
          margin: 0.5rem 0 0;
          font-size: 1rem;
        }
        #nav a > :first-child {
          display: flex;
          justify-content: center;
          width: 2rem;
          margin: 0 0.5rem 0 1rem;
        }
        #nav sl-avatar {
          --size: 1.55rem;
        }
        #pages {
          margin: 0; 
          overflow: visible;
        }

        #nav_toggle {
          display: unset;
        }
      }

      @media(max-width: 500px) {
        #pages > * {
          padding: 1.5rem 1.25rem 1rem;
        }

        #pages > [page~="full-width"] {
          padding: 0;
        }
      }

      @media (prefers-color-scheme: light) {
        a:hover {
          color: #747bff;
        }
        button {
          background-color: #f9f9f9;
        }
      }
    `]}customElements.define("app-view",WRe);
